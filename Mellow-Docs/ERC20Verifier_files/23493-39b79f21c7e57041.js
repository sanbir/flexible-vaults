"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[23493],{3431:(e,t,n)=>{n.d(t,{K:()=>c,s:()=>d});n(296540);var o=()=>n(160432),i=()=>n(69708),r=()=>n(971495),a=()=>n(430840),s=n(474848);const l=(0,i().YK)({connect:{defaultMessage:"Connect",id:"workflows.modules.useWorkflowModuleConfigurationConnections.connectLabel"}});function d(e){const{moduleValue:t,workflowDefinitionPointer:n,workflowModuleStore:r,onAuthComplete:a}=e,{handleConnect:d,authModal:u}=c({moduleValue:t,workflowDefinitionPointer:n,workflowModuleStore:r,onAuthComplete:a});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o().A,{colorPalette:"blue",onClick:d,children:(0,s.jsx)(i().sA,{...l.connect})}),u]})}function c(e){const{moduleValue:t,workflowDefinitionPointer:n,workflowModuleStore:o,onAuthComplete:d}=e,c=(0,i().tz)(),{handleConnect:u,authDetailModalArgs:g}=(0,r().U)({moduleValue:t,workflowDefinitionPointer:n,workflowModuleStore:o,onAuthComplete:d});return{handleConnect:u,connectCopy:c.formatMessage(l.connect),authModal:(0,s.jsx)(a().b,{...g})}}},6208:(e,t,n)=>{n.d(t,{L:()=>d,y:()=>l});var o=()=>n(907258),i=()=>n(590526),r=()=>n(849255),a=()=>n(798880),s=()=>n(69708);function l(e){const t=(0,s().tz)();return(0,i().K8)((()=>{const{sidebarSpaceStore:n}=o().default.state;if(!n||!e)return;return r().L.createChildStore(n,{table:a().oo,id:e}).getDisplayName(t)}),[t,e])}function d(){const e=(0,s().tz)();return(0,i().K8)((()=>{const{currentUserStore:t}=o().default.state,n=null!=t&&t.isDefined()?t.getModel():void 0;return n?n.getDisplayName(e):void 0}),[e])}},11688:(e,t,n)=>{n.d(t,{v:()=>m});n(898992),n(354520),n(581454);var o=()=>n(664594),i=()=>n(300474),r=()=>n(242422),a=()=>n(951500),s=()=>n(590526),l=()=>n(640182),d=()=>n(966249),c=()=>n(496603),u=()=>n(821062),g=()=>n(423493),f=()=>n(844317);function m(e){var t;const{workflowStore:n,workflowValue:m,showCurrentModules:p,isCustomAgentContext:h}=e,v=(0,o().T)(),w=(0,i().r)(),y=(0,a().l)(null==m||null===(t=m.modules)||void 0===t?void 0:t.map((e=>e.type)));return(0,s().K8)((()=>{const e=(0,f().getWorkflowAgentConfig)({isCustomAgent:!0,workflowId:n.id});return(0,c().oE)(l().zP.map((t=>{const n=(0,d().jK)(t);if(!n)return;let o=!0;var i;w&&(o=(null==n||null===(i=n.isAvailable)||void 0===i?void 0:i.call(n,{experimentService:r().default,userId:v,spaceId:w,configStep:e,isCustomAgentContext:h}))??!0);"computer"===t&&(o=Boolean(e.enableScriptAgentAdvanced));const a=g().y[t];return!p&&(0,d().sQ)(t)&&null!=y&&y.includes(t)&&(o=!1),{type:t,componentModule:a,sharedModule:n,available:o}})).filter((e=>null==e?void 0:e.available)))}),[v,w,y,p,n.id,h],{equalityFn:u().k})}},13668:(e,t,n)=>{n.d(t,{By:()=>f,Cc:()=>d,DT:()=>h,DZ:()=>a,Ei:()=>M,Gv:()=>g,LC:()=>x,P3:()=>c,QJ:()=>l,Qw:()=>s,eG:()=>p,sK:()=>m,xz:()=>u});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(581454);var o=()=>n(471636),i=()=>n(424641),r=()=>n(812109);const a=(0,n(69708).YK)({connectCalendarSuccessMessage:{id:"workflows.calendar.connectCalendarSuccessMessage",defaultMessage:"Your agent can now read and create calendar events"}});function s(e){var t,n;const{module:o,syncedAccounts:i,getCalendarsForAccount:r}=e;if(null!==(t=o.state)&&void 0!==t&&t.connectedAccountSnapshots&&o.state.connectedAccountSnapshots.length>0)return;const a=o.permissions??[];if(0===a.length)return;const s=new Set,l=new Map;for(const f of a)if("accountOrganizationCalendars"===f.type)s.add(f.identifier);else if("calendar"===f.type){var d;s.add(f.accountId),l.has(f.accountId)||l.set(f.accountId,new Set),null===(d=l.get(f.accountId))||void 0===d||d.add(f.calendarId)}if(0===s.size)return;const c=[];for(const f of i){if(!s.has(f.id))continue;const e=l.get(f.id),t=r(f.id),n=e?t.filter((t=>e.has(t.id))):[];c.push({...f,calendars:n})}if(0===c.length)return;let u=null===(n=o.state)||void 0===n?void 0:n.defaultCalendar;if(!u){var g;const e=c.find((e=>e.calendars&&e.calendars.length>0));if(null!=e&&null!==(g=e.calendars)&&void 0!==g&&g[0]){const t=e.calendars[0];u={accountId:e.id,calendarId:t.id}}}return{...o,state:{...o.state,connectedAccountSnapshots:c,defaultCalendar:u}}}function l(e){const{accountEmail:t,accountCalendars:n}=e;if(0===n.length)return;const o=n.find((e=>e.primary));if(o)return o;if(t){const e=n.find((e=>e.id===t));if(e)return e}return n[0]}function d(e){var t;const{module:n,account:o,defaultCalendarForAccount:i}=e,r=w({permissions:n.permissions??[],newPermission:{moduleType:"calendar",type:"accountOrganizationCalendars",identifier:o.id,actions:["read","readCoworker"]}}),a=function(e){const{connectedAccountSnapshots:t,account:n,calendars:o}=e,i=(null==t?void 0:t.filter((e=>e.id!==n.id)))??[];return[...i,{...n,calendars:o}]}({connectedAccountSnapshots:null===(t=n.state)||void 0===t?void 0:t.connectedAccountSnapshots,account:o,calendars:i?[i]:[]}),s={...n,permissions:r,state:{...n.state,connectedAccountSnapshots:a}};return i?f({module:s,calendar:i}):s}function c(e){var t;const{module:n,accountId:o,nextDefaultCalendar:i}=e,r=function(e){const{permissions:t,accountId:n}=e;if(!t)return[];return t.filter((e=>{const t="accountOrganizationCalendars"===e.type&&e.identifier===n,o="calendar"===e.type&&e.accountId===n;return!t&&!o}))}({permissions:n.permissions,accountId:o}),a=function(e){const{connectedAccountSnapshots:t,accountId:n}=e;if(!t)return[];return t.filter((e=>e.id!==n))}({connectedAccountSnapshots:null===(t=n.state)||void 0===t?void 0:t.connectedAccountSnapshots,accountId:o});return{...n,permissions:r,state:{...n.state,connectedAccountSnapshots:a,defaultCalendar:i?{accountId:i.accountId,calendarId:i.id}:void 0}}}function u(e){const{state:t,accountId:n,enabledAccounts:o}=e;if(!t)return;const i=new Set(M(t).filter((e=>e.calendars&&e.calendars.length>0)).map((e=>e.id))),r=o.filter((e=>i.has(e.id))),a=r.findIndex((e=>e.id===n));return a+1<r.length?r[a+1]:a-1>=0?r[a-1]:void 0}function g(e){const{module:t,accountId:n,calendarId:o}=e;return{...t,state:{...t.state,defaultCalendar:{accountId:n,calendarId:o}}}}function f(e){var t;const{module:n,calendar:r}=e,a=(0,i().Jx)(r)?o().r6:o().Po,s=w({permissions:n.permissions??[],newPermission:v({calendar:r,scopes:a})}),l=function(e){const{connectedAccountSnapshots:t,calendar:n}=e;if(!t)return[];return t.map((e=>{var t;if(e.id!==n.accountId)return e;return new Set(null===(t=e.calendars)||void 0===t?void 0:t.map((e=>e.id))).has(n.id)?e:{...e,calendars:[...e.calendars??[],n]}}))}({connectedAccountSnapshots:null===(t=n.state)||void 0===t?void 0:t.connectedAccountSnapshots,calendar:r});return{...n,permissions:s,state:{...n.state,connectedAccountSnapshots:l}}}function m(e){var t,n,o,i;const{module:r,calendar:a}=e,s=function(e){const{permissions:t,permissionToRemove:n}=e;return t.filter((e=>!y(e,n)))}({permissions:r.permissions??[],permissionToRemove:v({calendar:a})}),l=function(e){const{connectedAccountSnapshots:t,calendar:n}=e;if(!t)return[];return t.map((e=>{var t;return e.id!==n.accountId?e:{...e,calendars:null===(t=e.calendars)||void 0===t?void 0:t.filter((e=>e.id!==n.id))}}))}({connectedAccountSnapshots:null===(t=r.state)||void 0===t?void 0:t.connectedAccountSnapshots,calendar:a}),d=(null===(n=r.state)||void 0===n||null===(n=n.defaultCalendar)||void 0===n?void 0:n.accountId)===a.accountId&&(null===(o=r.state)||void 0===o||null===(o=o.defaultCalendar)||void 0===o?void 0:o.calendarId)===a.id||null===(i=r.state)||void 0===i?void 0:i.defaultCalendar;return{...r,permissions:s,state:{...r.state,connectedAccountSnapshots:l,defaultCalendar:d}}}function p(e){const{module:t,calendar:n,scopes:o}=e;return{...t,permissions:w({permissions:t.permissions??[],newPermission:v({calendar:n,scopes:o})})}}function h(e){const{module:t,accountId:n,actions:o}=e;return{...t,permissions:w({permissions:t.permissions??[],newPermission:{moduleType:"calendar",type:"accountOrganizationCalendars",identifier:n,actions:o}})}}function v(e){const{calendar:t,scopes:n}=e;return{moduleType:"calendar",type:"calendar",identifier:(0,r().N)(t),accountId:t.accountId,calendarId:t.id,actions:(null==n?void 0:n.actions)??[],constraints:null==n?void 0:n.constraints}}function w(e){const{permissions:t,newPermission:n}=e;return[...t.filter((e=>!y(e,n))),n]}function y(e,t){return e.type===t.type&&e.identifier===t.identifier}function M(e){return(null==e?void 0:e.connectedAccountSnapshots)??[]}function x(e){return{id:e.id,accountId:e.accountId,name:e.name,color:e.color,primary:e.primary,accessRole:e.accessRole}}},68528:(e,t,n)=>{n.d(t,{R:()=>c});n(296540);var o=()=>n(401497),i=()=>n(807449),r=()=>n(26697),a=()=>n(158661),s=()=>n(69708),l=n(474848);const d=(0,s().YK)({tooltip:{id:"mcpToolsInline.promptInjectionWarningTooltip",defaultMessage:"Prompt injection attempt(s) detected – malicious content has been removed. Proceed with caution."}});function c(){const e=(0,s().tz)(),t=(0,o().IS)((()=>({tooltip:{width:240},wrapper:{display:"flex",alignItems:"center",pointerEvents:"auto"}})),[]);return(0,l.jsx)(r().m,{style:t.tooltip,renderTooltip:()=>e.formatMessage(d.tooltip),render:e=>(0,l.jsx)("div",{...e,"aria-hidden":!0,style:t.wrapper,children:(0,l.jsx)(i().I,{icon:a().exclamationMarkTriangleFillSmallIcon,size:"sm",colorPalette:"yellow",colorVariant:"accentPrimary"})}),textWrap:!0})}},129398:(e,t,n)=>{n.d(t,{A:()=>r});var o=()=>n(242422),i=()=>n(534177);function r(e){const{triggerType:t,context:n}=e;if(!t)return!1;switch(t){case"calendar.event.created":case"calendar.event.updated":case"calendar.event.canceled":return o().default.checkGate({gateName:"notion_calendar_custom_agent_triggers"});case"notion.button.pressed":case"notion.database.agent.updated":return!1;case"recurrence":case"slack.thread.created":return"display"===n;case"notion.agent.mentioned":case"mail.email.received":case"mail.email.sent":case"mail.email.receivedorsent":case"mail.label.applied":case"notion.page.created":case"notion.page.deleted":case"notion.page.discussion.comment.added":case"notion.page.updated":case"slack.app.mention":case"slack.message":case"slack.reaction.added":return!0;default:(0,i().HB)(t)}}},147440:(e,t,n)=>{n.d(t,{b:()=>i});class o extends(()=>n(757695))().Store{getInitialState(){return{currentScreen:"none",onConfirm:void 0}}open(e){this.setState({currentScreen:"introduction",onConfirm:e})}close(){this.setState({currentScreen:"none",onConfirm:void 0})}setScreen(e){this.setState({...this.state,currentScreen:e})}}const i=new o;(0,n(852832).exposeDebugValue)("notionMailAccountRequiredModalStore",i)},148974:(e,t,n)=>{n.d(t,{Vq:()=>o,bt:()=>r,vx:()=>i});const o={mini:3,small:4,default:6,medium:8,large:12,max:16},i="0px 4px 0px -2px #00000005",r={opacity:.5,pointerEvents:"none",userSelect:"none"}},175249:(e,t,n)=>{n.d(t,{a:()=>i});n(296540);const o={viewBox:"0 0 16 16",fittedViewBox:"2.12 3.37 11.75 9.25",svg:(0,n(474848).jsx)("path",{d:"M4 3.375c-1.036 0-1.875.84-1.875 1.875v5.5c0 1.036.84 1.875 1.875 1.875h8c1.036 0 1.875-.84 1.875-1.875v-5.5c0-1.036-.84-1.875-1.875-1.875zM3.375 5.25c0-.345.28-.625.625-.625h3.375v1.417h-4zm5.25.792V4.625H12c.345 0 .625.28.625.625v.792zm0 2.666V7.292h4v1.416zm-5.25 0V7.292h4v1.416zm0 2.042v-.792h4v1.417H4a.625.625 0 0 1-.625-.625m5.25.625V9.958h4v.792c0 .345-.28.625-.625.625z"})},i=(0,n(340498).wt)("viewTableSmall",o,"small")},222334:(e,t,n)=>{n.r(t),n.d(t,{arrowChevronSingleRightIcon:()=>i,iconDefinition:()=>o});n(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"7.22 3.97 6.66 12.06",directional:!0,svg:(0,n(474848).jsx)("path",{d:"M13.692 10.442a.625.625 0 0 0 0-.884l-5.4-5.4a.625.625 0 1 0-.884.884L12.366 10l-4.958 4.958a.625.625 0 0 0 .884.884z"})},i=(0,n(340498).wt)("arrowChevronSingleRight",o,"default")},253708:(e,t,n)=>{n.d(t,{X:()=>o});const o=(0,n(340498).xh)("arrowLeftRight",{default:{loader:()=>n.e(70959).then(n.bind(n,377114))},small:{loader:()=>n.e(70959).then(n.bind(n,398544))},fill:{loader:()=>n.e(70959).then(n.bind(n,742280))},fillSmall:{loader:()=>n.e(70959).then(n.bind(n,249871))}},["arrows","sort","arrange","organize","order","categorize","switch","swap"])},266563:(e,t,n)=>{n.d(t,{s:()=>te,R:()=>X});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(581454);var o=n(296540),i=()=>n(907258),r=()=>n(242422),a=()=>n(726637),s=()=>n(383036),l=()=>n(484714),d=()=>n(590526),c=()=>n(401497),u=()=>n(718827),g=()=>n(250910),f=()=>n(118307),m=()=>n(807449),p=()=>n(546926),h=()=>n(631524),v=()=>n(493552),w=()=>n(26697),y=()=>n(890492),M=()=>n(81068),x=()=>n(663639),k=()=>n(736847),b=()=>n(477336),C=()=>n(863330),S=()=>n(340498),j=()=>n(905470),A=()=>n(966249),I=()=>n(69708),T=()=>n(100622),D=()=>n(534177),P=()=>n(656134),R=()=>n(301948),L=()=>n(662971),E=()=>n(451557),W=()=>n(22673),N=()=>n(11688),U=()=>n(664594),B=()=>n(59226),V=()=>n(192),_=()=>n(383616),F=()=>n(798880),O=()=>n(183541),z=()=>n(187174);function K(e){const{workflowStore:t}=e,n=(0,B().X)("workflow_module_ownership_validation"),r=(0,U().T)(),a=(0,d().O$)(i().AppStoreSidebarSpaceStore),s=(0,d().K8)((()=>{var e;return null==a||null===(e=a.pointer)||void 0===e?void 0:e.id}),[a]),c=(0,d().K8)((()=>{const e=t.getDraftData();return((null==e?void 0:e.modules)??[]).filter((e=>e.state&&"connectionPointer"in e.state&&e.state.connectionPointer)).map((e=>e.id)).sort().join(",")}),[t]),{connections:u,refetch:g}=function(e){const t=(0,l().v3)(),{spaceId:n,parent:o,integrationType:i,createdByCurrentUser:r}=e,a=null==o?void 0:o.id,s=null==o?void 0:o.table,[{status:d,value:c},u]=(0,z().Yb)((async()=>{const e=await t.api.callCellCompatibleApi({eventName:"listExternalConnections",environment:t,data:{spaceId:n,parent:a&&s?{id:a,table:s}:void 0,integrationType:i,createdByCurrentUser:r},cellNavigation:{spaceId:n}});if("success"===e.type)return e.data.connections}),[t,n,a,s,i,r]);return{loading:"pending"===d,connections:c,refetch:u}}({spaceId:s??"",createdByCurrentUser:!0});(0,o.useEffect)((()=>{c&&s&&g()}),[c,s,g]);const f=(0,o.useMemo)((()=>{const e=new Set;for(const t of u??[])e.add(t.id);return e}),[u]);return(0,d().K8)((()=>{const e=new Map;if(!n)return e;const o=t.getDraftData(),i=(null==o?void 0:o.modules)??[];for(const t of i){if("notion"===t.type){e.set(t.type,{canAddTrigger:!0});continue}const n=t.state,o=n&&"connectionPointer"in n?n.connectionPointer:void 0;if(!o||!a||!s){e.set(t.type,{canAddTrigger:!0});continue}if(o.spaceId!==s){e.set(t.type,{canAddTrigger:!0});continue}let i;if(o.table===O().tE){const e=V().s.createChildStore(a,o).getCreatedByPointer();i=(null==e?void 0:e.table)===F().oo?e.id:void 0}else{if(o.table===_().Kl){if(f.has(o.id)){e.set(t.type,{canAddTrigger:!0});continue}e.set(t.type,{canAddTrigger:!1,disabledReason:"Only the user who connected this integration can add triggers"});continue}(0,D().HB)(o)}i?i===r?e.set(t.type,{canAddTrigger:!0}):e.set(t.type,{canAddTrigger:!1,disabledReason:"Only the user who connected this integration can add triggers"}):e.set(t.type,{canAddTrigger:!0})}return e}),[n,r,f,a,s,t])}var Y=()=>n(912749),H=()=>n(423493),q=()=>n(129398),$=n(474848);function G(e){return"calendar"===e.moduleType||"mail"===e.moduleType}const Q=(0,I().YK)({addTriggerLabel:{defaultMessage:"Add trigger",id:"TriggerConfigModal.AddTriggerButton.addTriggerLabel"},recurringSection:{id:"TriggerConfigModal.AddTriggerButton.recurringSection",defaultMessage:"Recurring"},recurringMenuLabel:{id:"TriggerConfigModal.AddTriggerButton.recurringMenuLabel",defaultMessage:"Every..."},appTriggersSection:{id:"TriggerConfigModal.AddTriggerButton.appTriggersSection",defaultMessage:"App triggers"},day:{id:"TriggerConfigModal.AddTriggerButton.day",defaultMessage:"Day"},hour:{id:"TriggerConfigModal.AddTriggerButton.hour",defaultMessage:"Hour"},week:{id:"TriggerConfigModal.AddTriggerButton.week",defaultMessage:"Week"},month:{id:"TriggerConfigModal.AddTriggerButton.month",defaultMessage:"Month"},year:{id:"TriggerConfigModal.AddTriggerButton.year",defaultMessage:"Year"},singletonTriggerDisabled:{id:"TriggerConfigModal.AddTriggerButton.singletonTriggerDisabled",defaultMessage:"This trigger is already added"},notConnectionOwner:{id:"TriggerConfigModal.AddTriggerButton.notConnectionOwner",defaultMessage:"Only the user who connected this integration can add triggers"}}),J={day:Q.day,hour:Q.hour,week:Q.week,month:Q.month,year:Q.year},Z={modules:[]};function X(e){const{workflowStore:t,workflowValue:n}=e,o=(0,I().tz)(),i=(0,N().v)({workflowStore:t,workflowValue:n??Z,showCurrentModules:!0});return(0,d().K8)((()=>{const e=new Map,t=!!n&&(0,j().uP)(n);for(const n of i){const i=n.type,r=(0,A().jK)(i),a=H().y[i];if(!r)continue;if(t&&"notion"!==i)continue;const s=r.getName(o),l=(0,D().WP)(a.triggers).filter((([e])=>(0,q().A)({triggerType:e,context:"configuration"}))).filter((([e])=>!t||(0,D().Xk)(j().OW,e))).map((([e,t])=>({type:e,name:"description"in t?o.formatMessage(t.description):e,icon:n.sharedModule.getIcon(),moduleType:i})));l.length>0&&e.set(s,l)}return e}),[i,o,n])}function ee(e){const{workflowStore:t,availableTriggersByIntegration:n,createRecurrenceTrigger:l,onAddTrigger:c,buttonPopupStore:u,existingTriggerTypes:g,environment:f,modulePermissions:h}=e,v=(0,I().tz)(),C=(0,d().K8)((()=>r().default.getConfig({configName:"custom_agent_sub_features"}).hourly_recurrence_triggers??!1),[]),T=(0,o.useMemo)((()=>{const e=g.has("notion.agent.mentioned");return Array.from(n.entries()).map((([t,n])=>[t,e?n.filter((e=>"notion.agent.mentioned"!==e.type)):n])).sort((([e],[t])=>"notion"===e.toLowerCase()?-1:"notion"===t.toLowerCase()?1:e.toLowerCase().includes("notion")?-1:t.toLowerCase().includes("notion")?1:e.localeCompare(t)))}),[n,g]),D=(0,o.useMemo)((()=>j().eC.filter((e=>"hour"!==e.key||C))),[C]);return(0,o.useMemo)((()=>[{key:"recurring",render:e=>(0,$.jsx)(k().A,{...e,title:v.formatMessage(Q.recurringSection),topBorder:!1}),items:[{key:"recurring",render:(e,t)=>(0,$.jsx)(L().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,$.jsx)(M().A,{...e,ref:t,title:v.formatMessage(Q.recurringMenuLabel),icon:(0,$.jsx)(m().I,{icon:b().l,size:"sm"}),showExtensionArrow:!0}),renderExtension:(e,n)=>{let o;return o=a().A.isMobile?{menuType:p().gu.ActionSheet}:{menuType:p().gu.Popup,width:280},(0,$.jsx)(y().A,{...o,...e,children:(0,$.jsx)(x().A,{type:x().O.Vertical,initialFocus:void 0,sections:[{key:"frequencies",render:e=>(0,$.jsx)(k().A,{...e}),items:D.map((e=>({key:e.key,render:(t,n)=>(0,$.jsx)(M().A,{...t,onFocus:n.onFocus,title:v.formatMessage(J[e.key])}),action:()=>{l(e.trigger),n.close(),u.setState({open:!1})}})))}],onAccept:t.onAccept})})}}),action:()=>null}]},{key:"integrations",render:e=>(0,$.jsx)(k().A,{...e,title:v.formatMessage(Q.appTriggersSection)}),items:T.map((([e,n])=>({key:e,render:(r,l)=>{const d=n[0];return d?(0,$.jsx)(L().A,{...r,onFocus:l.onFocus,renderOrigin:(t,n)=>(0,$.jsx)(M().A,{...t,ref:n,title:e,icon:o.createElement(d.icon,{width:S().Ev.sm,height:S().Ev.sm}),showExtensionArrow:!0}),renderExtension:(e,o)=>{let r;return r=a().A.isMobile?{menuType:p().gu.ActionSheet}:{menuType:p().gu.Popup,width:280},(0,$.jsx)(y().A,{...r,...e,children:(0,$.jsx)(x().A,{type:x().O.Vertical,initialFocus:void 0,sections:[{key:"triggers",render:e=>(0,$.jsx)(k().A,{...e}),items:n.map((e=>{const n=function(e){const t=(0,A().Tc)(e);return(null==t?void 0:t.isSingleton)??!1}(e.type)&&g.has(e.type),r=h.get(e.moduleType),a=!1===(null==r?void 0:r.canAddTrigger),l=n||a,d=n?v.formatMessage(Q.singletonTriggerDisabled):a?v.formatMessage(Q.notConnectionOwner):void 0;return{key:`${e.moduleType}-${e.type}`,render:(t,n)=>l?(0,$.jsx)(w().m,{placement:"left",renderTooltip:()=>d,render:o=>(0,$.jsx)(M().A,{...(0,s().A)(t,o),onFocus:n.onFocus,title:e.name,right:G(e)?(0,$.jsx)(R().A,{}):void 0,disabled:!0,disabledFeedback:!0})}):(0,$.jsx)(M().A,{...t,onFocus:n.onFocus,title:e.name,right:G(e)?(0,$.jsx)(R().A,{}):void 0}),action:l?()=>{}:()=>{const n=()=>{var n;const r=(null===(n=t.getDraftData())||void 0===n?void 0:n.modules)??[];let a;if("mail"===e.moduleType){var s;const e=null===(s=i().default.state.currentUserStore)||void 0===s||null===(s=s.getModel())||void 0===s?void 0:s.getEmail();e&&(a=r.find((t=>{var n;return"mail"===t.type&&(null===(n=t.state)||void 0===n?void 0:n.creatorEmail)===e})))}else a=r.find((t=>t.type===e.moduleType));c({triggerType:e.type,moduleType:e.moduleType,moduleValue:a}),o.close(),u.setState({open:!1})};"mail"===e.moduleType?(0,E().ensureNotionMailAccountOrTriggerOnboarding)({environment:f,onConfirm:n}).then((e=>{if(!e)return o.close(),void u.setState({open:!1});n()})):n()}}}))}],onAccept:l.onAccept})})}}):null},action:()=>null})))}]),[T,l,v,D,c,t,u,g,f,h])}function te(e){const{onAddTrigger:t,workflowStore:n}=e,i=(0,l().v3)(),r=(0,P().j)(),{workflowValue:a}=(0,Y().N)(n,!0),s=(0,d().uB)(void 0,f().A),m=X({workflowStore:n,workflowValue:a}),w=K({workflowStore:n}),M=(0,o.useMemo)((()=>{var e;return null==a||null===(e=a.modules)||void 0===e?void 0:e.find((e=>"notion"===e.type))}),[null==a?void 0:a.modules]),k=(0,o.useMemo)((()=>{const e=new Set,t=(null==a?void 0:a.triggers)??[];for(const o of t){var n;null!==(n=o.state)&&void 0!==n&&n.type&&e.add(o.state.type)}return e}),[null==a?void 0:a.triggers]),b=(0,o.useCallback)((e=>{M&&t({triggerType:"recurrence",moduleType:"notion",moduleValue:M,initialState:e})}),[M,t]),S=ee({workflowStore:n,availableTriggersByIntegration:m,createRecurrenceTrigger:b,onAddTrigger:t,buttonPopupStore:s,existingTriggerTypes:k,environment:i,modulePermissions:w}),j=(0,c().eP)(),A=(0,c().IS)((()=>({listLikeButton:{paddingInlineStart:10,paddingInlineEnd:4,gap:8},hoveredButton:{background:T().Tj.background.secondaryTranslucent},pressedButton:{background:(0,u().yZ)({color:T().Tj.background.secondaryTranslucent,mode:j})}})),[j]),D=(0,o.useCallback)((()=>{(0,E().preloadNotionMailUserStatus)({environment:i})}),[i]);return(0,$.jsx)(g().A,{alignmentToOrigin:"start",placementToOrigin:"bottom",popupType:r,originGap:4,onOpen:D,onClick:()=>{(0,W().qt)({action:"open_add_trigger_menu",environment:i,workflowId:n.id})},render:()=>(0,$.jsx)(y().A,{menuType:p().gu.Popup,minWidth:220,children:(0,$.jsx)(x().A,{type:x().O.Vertical,initialFocus:0,sections:S})}),buttonPopupStore:s,renderOrigin:e=>(0,$.jsx)(h().p,{...e,size:"lg",iconLeading:{icon:C().plusSmallIcon,size:"sm",colorVariant:"secondary"},style:A.listLikeButton,hoveredStyle:A.hoveredButton,pressedStyle:A.pressedButton,children:(0,$.jsx)(v().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,$.jsx)(I().sA,{...Q.addTriggerLabel})})})})}},329366:(e,t,n)=>{n.d(t,{y:()=>i});var o=()=>n(966249);function i(e){const{moduleValue:t,existingModuleId:n,hasExternalConnection:i,hasDuplicateUrl:r,isAdded:a,connectionAuthState:s="unknown"}=e;if("needsAuthentication"===s||"needs_reauth"===s||"needs_setup"===s)return"needsAuthentication";if("connected"===s)return"connected";const l=function(e){if(!e)return!1;const t=(0,o().jK)(e);return!(null!=t&&t.authentication)}(null==t?void 0:t.type),d="mcpServer"===(null==t?void 0:t.type);if(Boolean(n&&!i&&(!l||d)))return"needsAuthentication";return Boolean(n&&i||r||n&&l)||a?"connected":"notInWorkflow"}},343489:(e,t,n)=>{n.d(t,{i:()=>s});var o=()=>n(590526),i=()=>n(743246),r=()=>n(498212),a=()=>n(964484);function s({module:e,store:t}){const n=(0,o().K8)((()=>t.canEdit()),[t]),s=t.table===i().C0,{canCurrentUserUpdateConnection:l,createdByUser:d}=(0,a().x)({module:e,workflowStore:s?t:void 0}),c="notion"===e.type;return n&&(c||l||!s||d===r().rN)?"read_and_write":"reader"}},398208:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(296540),i=()=>n(726637),r=n(474848);function a({onClose:e,style:t}){const o=(0,n(69708).tz)(),a=(0,n(401497).IS)((()=>({closeButton:{borderRadius:"100%",width:i().A.isMobile?28:22,height:i().A.isMobile?28:22,...t},closeButtonIconStyle:i().A.isMobile?{width:18,height:18}:{}})),[t]);return(0,r.jsx)(n(695115).A,{iconStyle:a.closeButtonIconStyle,style:a.closeButton,hovered:!0,icon:n(563692).xMarkFillSmallIcon,onClick:e,ariaLabel:o.formatMessage({id:"circleCloseButton.ariaLabel",defaultMessage:"Close"})})}const s=o.memo(a)},423493:(e,t,n)=>{n.d(t,{y:()=>bs});var o=()=>n(69708),i=n(296540),r=(n(898992),n(737550),()=>n(664594)),a=()=>n(699143),s=()=>n(493552),l=()=>n(401497),d=n(474848);function c(e){const{children:t,isDisabled:n}=e,o=(0,l().IS)((()=>({container:{opacity:n?.4:1,pointerEvents:n?"none":"auto",width:"100%"}})),[n]);return(0,d.jsx)(a().Y1,{align:"center",direction:"horizontal",gap:"auto",style:o.container,children:t})}function u(e){const{children:t}=e,n=(0,l().IS)((()=>({leftColumn:{flex:"0 60%"}})),[]);return(0,d.jsx)(a().Y1,{direction:"vertical",gap:2,style:n.leftColumn,children:t})}function g(e){const{children:t}=e,n=(0,l().IS)((()=>({rightColumn:{flex:"1 1 40%",minWidth:0,width:"100%"}})),[]);return(0,d.jsx)("div",{style:n.rightColumn,children:t})}var f=()=>n(100622),m=()=>n(265060),p=()=>n(253708),h=()=>n(558687),v=()=>n(449851),w=()=>n(814207);function y(e){const{moduleValue:t}=e,n=(0,o().tz)(),i=(0,w().c)(t),r=v().d.getDescription(t,n),c=(0,l().IS)((()=>({middleIcon:{height:24,width:24},moduleDescription:{marginBlock:"1em 0",maxWidth:400,textAlign:"center"},moduleIcon:{height:32,width:32},notionIcon:{height:32,width:32}})),[]);return(0,d.jsxs)("div",{children:[(0,d.jsxs)(a().Y1,{align:"center",direction:"horizontal",gap:4,children:[(0,d.jsx)("span",{style:c.moduleIcon,children:i(c.moduleIcon)}),(0,d.jsx)(m().Q,{iconGroup:p().X,colorVariant:"secondary",variantName:"default",style:c.middleIcon}),(0,d.jsx)("span",{style:c.notionIcon,children:(0,h().notionIcon)(c.notionIcon)})]}),(0,d.jsx)(s().D,{as:"p",styleKey:"bodyRegular",colorVariant:"secondary",style:c.moduleDescription,children:r})]})}function M(e){const{children:t,moduleValue:n}=e,o=(0,l().IS)((()=>({container:{alignItems:"center",border:`1px solid ${f().Tj.border.secondary}`,borderRadius:12,display:"flex",flexDirection:"column",gap:24,justifyContent:"center",marginBlock:16,paddingBlock:32,paddingInline:24,width:"100%"},section:{maxWidth:700,width:"100%"}})),[]);return(0,d.jsxs)("div",{style:o.container,children:[(0,d.jsx)("header",{children:(0,d.jsx)(y,{moduleValue:n})}),(0,d.jsx)("section",{style:o.section,children:t})]})}const x=(0,o().YK)({runAsTitle:{defaultMessage:"Run as",id:"workflows.modules.runAs.title"},runAsDescription:{defaultMessage:"{moduleName} searches run using this user’s connected account.",id:"workflows.modules.runAs.description"},runAsCurrentUser:{defaultMessage:"Current user",id:"workflows.modules.runAs.currentUser"}});function k(e){const{module:t,saveModule:n,userHasEditAccess:l,moduleName:f,buildPermission:m}=e,p=(0,o().tz)(),h=(0,r().T)();return(0,i.useEffect)((()=>{if(!l||!h)return;(t.permissions??[]).some((e=>e.type===t.type))||n({...t,permissions:[m(h)]})}),[h,m,t,n,l]),(0,d.jsx)(M,{moduleValue:t,children:(0,d.jsx)(a().Y1,{direction:"vertical",gap:16,width:"fill",children:(0,d.jsxs)(c,{isDisabled:!l,children:[(0,d.jsxs)(u,{children:[(0,d.jsx)(s().D,{colorVariant:"primary",styleKey:"bodyRegular",children:p.formatMessage(x.runAsTitle)}),(0,d.jsx)(s().D,{colorVariant:"secondary",styleKey:"bodySmRegular",children:p.formatMessage(x.runAsDescription,{moduleName:f})})]}),(0,d.jsx)(g,{children:(0,d.jsx)(s().D,{colorVariant:"primary",styleKey:"bodyRegular",children:p.formatMessage(x.runAsCurrentUser)})})]})})})}const b=(0,o().YK)({search:{defaultMessage:"Searched Asana",id:"workflow.run.effect.asana.search.description"},searchLoading:{defaultMessage:"Searching Asana",id:"workflow.run.effect.asana.search.loading"},loadTask:{defaultMessage:"Loaded Asana task",id:"workflow.run.effect.asana.loadTask.description"},loadTaskLoading:{defaultMessage:"Loading Asana task",id:"workflow.run.effect.asana.loadTask.loading"}}),C={triggers:{},effect:{"asana.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?b.searchLoading:b.search)},"asana.loadTask":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?b.loadTaskLoading:b.loadTask)}},ModuleConfiguration:function(e){const t=(0,i.useCallback)((e=>({type:"asana",moduleType:"asana",identifier:e,actions:["search"]})),[]);return(0,d.jsx)(k,{...e,moduleName:"Asana",buildPermission:t})}};const S=(0,o().YK)({search:{defaultMessage:"Searched Box",id:"workflow.run.effect.box.search.description"},searchLoading:{defaultMessage:"Searching Box",id:"workflow.run.effect.box.search.loading"}}),j={triggers:{},effect:{"box.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?S.searchLoading:S.search)}},ModuleConfiguration:function(e){const t=(0,i.useCallback)((e=>({type:"box",moduleType:"box",identifier:e,actions:["search"]})),[]);return(0,d.jsx)(k,{...e,moduleName:"Box",buildPermission:t})}};var A=()=>n(365646),I=()=>n(16789),T=(n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(354520),n(672577),n(581454),()=>n(59226)),D=()=>n(590526),P=()=>n(488776),R=()=>n(13668),L=()=>n(807449),E=()=>n(546926),W=()=>n(890492),N=()=>n(81068),U=()=>n(663639),B=()=>n(736847),V=()=>n(617668),_=()=>n(583238),F=()=>n(746791),O=()=>n(718827),z=()=>n(250910),K=()=>n(118307),Y=()=>n(98126),H=()=>n(631524),q=()=>n(496603),$=()=>n(284371),G=()=>n(340498);function Q(e){const{icon:t,content:n,paddingInline:o="4px 0"}=e;return(0,d.jsxs)(a().Y1,{direction:"horizontal",align:"center-left",gap:6,style:{minHeight:28,paddingInline:o},children:[(0,d.jsx)(a().Y1,{align:"center",height:G().Ev.default,width:G().Ev.default,style:{flexShrink:0},children:t}),(0,d.jsx)("div",{style:{flex:1,minWidth:0},children:n})]})}function J(e){const{disabled:t=!1,isLoading:n=!1,renderPopupContent:o,onClickOverride:i}=e,r=(0,D().uB)(void 0,K().A);return i?(0,d.jsx)(Z,{...q().cJ(e,"renderPopupContent")}):(0,d.jsx)(z().A,{buttonPopupStore:r,popupType:z().z.Popup,alignmentToOrigin:"start",placementToOrigin:"bottom",originGap:4,disabled:t||n,render:o,renderOrigin:t=>(0,d.jsx)(Z,{...q().cJ(e,"renderPopupContent"),buttonPopupEvents:t})})}function Z(e){const{icon:t,content:n,disabled:o=!1,isLoading:i=!1,paddingInline:r="4px",buttonPopupEvents:a,onClickOverride:c}=e,u=(0,l().eP)(),g=(0,l().IS)((()=>({button:{paddingInline:r},hoveredButton:{background:f().Tj.background.secondaryTranslucent},pressedButton:{background:(0,O().yZ)({color:f().Tj.background.secondaryTranslucent,mode:u})}})),[r,u]);return(0,d.jsx)(H().p,{size:"md",disabled:o||i,style:g.button,hoveredStyle:g.hoveredButton,pressedStyle:g.pressedButton,...c?{onClick:c}:a,children:(0,d.jsx)(Q,{icon:i?(0,d.jsx)(Y().k,{size:"default"}):(0,d.jsx)(L().I,{...t,colorVariant:o||i?"disabled":"secondary"}),content:(0,d.jsx)(s().D,{styleKey:"bodyRegular",colorVariant:o||i?"disabled":"secondary",style:$().RC,children:n}),paddingInline:"0px"})})}function X(e){const{accounts:t,disabled:n=!1,onAddCalendarAccount:r}=e,a=(0,o().tz)(),s=(0,T().X)("custom_agent_calendar_connection_workflow"),{isWaitingForCalendarConnection:l,calendarAccounts:c,handleConnectCalendar:u}=(0,F().N)({from:"notionAISignupClick",connectionSuccessMessage:a.formatMessage(R().DZ.connectCalendarSuccessMessage)}),g=s&&0===c.length,f=0===t.length&&!g,m=(0,i.useCallback)((e=>0===t.length?[]:[{key:"accounts",render:e=>(0,d.jsx)(B().A,{topBorder:!1,...e}),items:t.map((t=>({key:t.id,render:e=>{const n=(0,_().Fm)(t.provider);return(0,d.jsx)(N().A,{...e,left:n?(0,d.jsx)(L().I,{icon:n,size:"sm"}):void 0,title:t.displayName})},action:()=>{r(t),e.close()}})))}]),[t,r]);return(0,d.jsx)(J,{icon:{icon:V().plusIcon,size:"default"},content:(0,d.jsx)(o().sA,{...ee.addCalendarAccount}),disabled:n||f,isLoading:l,paddingInline:"8px",renderPopupContent:e=>(0,d.jsx)(W().A,{menuType:E().gu.Popup,width:280,maxHeight:360,children:(0,d.jsx)(U().A,{type:U().O.Vertical,sections:m(e),initialFocus:void 0})}),onClickOverride:g?u:void 0})}const ee=(0,o().YK)({addCalendarAccount:{id:"calendarAccountConfiguration.addCalendarAccount",defaultMessage:"Add calendar account"}});var te=()=>n(695115),ne=()=>n(349679),oe=()=>n(126617),ie=()=>n(877788),re=()=>n(599813),ae=()=>n(568721);const se={viewBox:"0 0 20 20",fittedViewBox:"2.96 1.99 14.08 15.13",svg:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("path",{d:"M7.3 1.995a.55.55 0 1 0 0 1.1h5.4a.55.55 0 0 0 0-1.1zm-2.35 2.8a.55.55 0 0 1 .55-.55h9a.55.55 0 0 1 0 1.1h-9a.55.55 0 0 1-.55-.55m3.504 4.594c.361-.45.896-.72 1.546-.72s1.185.27 1.546.72c.35.437.51 1.006.51 1.587 0 .58-.16 1.15-.51 1.586-.361.45-.896.72-1.546.72s-1.185-.27-1.546-.72c-.35-.437-.51-1.006-.51-1.586s.16-1.15.51-1.587m.858.689c-.16.199-.268.508-.268.898s.108.698.268.897c.15.187.368.31.688.31s.539-.123.688-.31c.16-.199.268-.508.268-.897 0-.39-.108-.7-.268-.898-.15-.187-.367-.31-.688-.31s-.538.123-.688.31"}),(0,d.jsx)("path",{d:"M2.963 8.545c0-1.174.951-2.125 2.125-2.125h9.825c1.174 0 2.125.951 2.125 2.125v6.45a2.125 2.125 0 0 1-2.125 2.125H5.088a2.125 2.125 0 0 1-2.125-2.125zm2.125-.875a.875.875 0 0 0-.875.875v6.45c0 .483.392.875.875.875h1.746c.348-1.256 1.722-2.076 3.166-2.076s2.818.82 3.166 2.076h1.747a.875.875 0 0 0 .875-.875v-6.45a.875.875 0 0 0-.875-.875zm6.883 8.2c-.312-.537-1.017-.976-1.971-.976s-1.659.439-1.971.976z"})]})},le=(0,G().wt)("personCropRectangleStack",se,"default");var de=()=>n(702723);function ce(e){const{permission:t,disabled:n=!1,onToggleScope:i}=e,r=(t.actions??[]).includes("readCoworker");return(0,d.jsx)(Q,{icon:(0,d.jsx)(L().I,{icon:le}),content:(0,d.jsx)(de().A,{type:"toggle",spaceStore:void 0,title:(0,d.jsx)(s().D,{styleKey:"bodyRegular",colorVariant:"primary",children:(0,d.jsx)(o().sA,{...ue.readTeammatesCalendars})}),disabled:n,isOn:r,onToggle:()=>i(!r)}),paddingInline:"4px 10px"})}const ue=(0,o().YK)({readTeammatesCalendars:{id:"calendarAccountConfiguration.readTeammatesCalendars",defaultMessage:"Read teammate’s calendars"}});var ge=()=>n(863330);const fe={viewBox:"0 0 20 20",fittedViewBox:"3.12 2.87 14.26 14.25",svg:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("path",{d:"M15.625 16.25C15.625 9.83 10.42 4.625 4 4.625a.875.875 0 1 1 0-1.75c7.387 0 13.375 5.988 13.375 13.375a.875.875 0 0 1-1.75 0"}),(0,d.jsx)("path",{d:"M11.125 16.25A7.125 7.125 0 0 0 4 9.125a.875.875 0 1 1 0-1.75 8.875 8.875 0 0 1 8.875 8.875.875.875 0 0 1-1.75 0"}),(0,d.jsx)("path",{d:"M6.625 16.25A2.625 2.625 0 0 0 4 13.625a.875.875 0 0 1 0-1.75 4.375 4.375 0 0 1 4.375 4.375.875.875 0 0 1-1.75 0"})]})},me=(0,G().wt)("rssFill",fe,"fill");var pe=()=>n(569243),he=()=>n(424641);const ve=20,we=13.75,ye=11;function Me(e){const{calendar:t,size:n="default",parentBackgroundColor:o}=e,i=(0,he().Jx)(t),r=((0,G().cr)(n)?G().Ev[n]:n)/ve,s=(0,l().DP)(),c=(0,l().IS)((()=>({container:{flexShrink:0,transform:`scale(${r})`,transformOrigin:"center"},roundedSquare:{backgroundColor:(0,pe().QL)({theme:s,calendarColor:t.color}),borderRadius:4},rssIcon:{color:o??f().Tj.background.primary,transform:"translate(-0.2px, 0.2px)"}})),[t.color,o,r,s]);return(0,d.jsx)(a().Y1,{align:"center",width:ve,height:ve,style:c.container,children:(0,d.jsx)(a().Y1,{align:"center",width:we,height:we,style:c.roundedSquare,children:i?void 0:(0,d.jsx)(L().I,{icon:me,size:ye,style:c.rssIcon})})})}const xe=(0,o().YK)({noCalendars:{id:"calendarMenuList.noCalendars",defaultMessage:"No calendars found"}});function ke(e){const{accounts:t,calendars:n,selectedCalendars:r,hideAccountNames:a=!1,onCalendarClick:s}=e,c=(0,l().IS)((()=>({menuContainer:{width:280,maxHeight:360,overflow:"auto",padding:4},emptyContainer:{padding:16,color:f().Tj.text.secondary,fontSize:14}})),[]),u=(0,i.useCallback)((e=>n.filter((t=>t.accountId===e.id)).map((e=>{const t=r.some((t=>t.accountId===e.accountId&&t.calendarId===e.id));return{key:`${e.accountId}:${e.id}`,render:n=>(0,d.jsx)(be,{...n,calendar:e,isSelected:t}),action:()=>s(e)}}))),[n,r,s]),g=(0,i.useMemo)((()=>t&&0!==t.length?t.map((e=>({key:e.id,render:t=>(0,d.jsx)(B().A,{title:e.displayName,hideTitle:a,topBorder:!1,...t}),items:u(e)}))):[]),[t,u,a]);return 0===g.length?(0,d.jsx)("div",{style:c.emptyContainer,children:(0,d.jsx)(o().sA,{...xe.noCalendars})}):(0,d.jsx)("div",{style:c.menuContainer,children:(0,d.jsx)(U().A,{type:U().O.Vertical,sections:g,initialFocus:void 0})})}function be(e){const{focused:t,calendar:n,isSelected:o,onClick:i}=e;return(0,d.jsx)(N().A,{focused:t,title:(0,d.jsx)(s().D,{styleKey:"bodyRegular",colorVariant:"primary",style:$().RC,children:n.name}),left:(0,d.jsx)(a().Y1,{align:"center",height:G().Ev.default,width:G().Ev.default,style:{flexShrink:0},children:(0,d.jsx)(Me,{calendar:n,size:18})}),isChecked:o,onClick:i,style:{gap:6}})}function Ce(e){const{account:t,calendars:n,disabled:i=!1,onAddCalendar:r}=e;return(0,d.jsx)(J,{icon:{icon:ge().plusSmallIcon,size:"sm"},content:(0,d.jsx)(o().sA,{...Se.addCalendar}),disabled:i,renderPopupContent:e=>(0,d.jsx)(ke,{accounts:[t],calendars:n,selectedCalendars:[],hideAccountNames:!0,onCalendarClick:t=>{r(t),e.close()}})})}const Se=(0,o().YK)({addCalendar:{id:"calendarAccountConfiguration.addCalendar",defaultMessage:"Add calendar"}});var je=()=>n(287188),Ae=()=>n(324254),Ie=()=>n(471636),Te=()=>n(107975),De=()=>n(373009);function Pe(e){const{open:t,onConfirm:n,onCancel:i}=e,r=(0,o().tz)(),c=(0,l().IS)((()=>({button:{justifyContent:"center",minWidth:0,overflow:"hidden",textAlign:"center"},buttonText:{width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}})),[]);return(0,d.jsx)(Te().a,{ariaLabel:r.formatMessage(Re.ariaLabel),open:t,onDismiss:i,showCloseIcon:!1,render:()=>(0,d.jsxs)(a().Y1,{direction:"vertical",gap:16,padding:16,width:270,children:[(0,d.jsxs)(a().Y1,{direction:"vertical",gap:2,width:210,children:[(0,d.jsx)(s().D,{styleKey:"bodySemibold",colorVariant:"primary",children:(0,d.jsx)(o().sA,{...Re.title})}),(0,d.jsx)(s().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,d.jsx)(o().sA,{...Re.description})})]}),(0,d.jsxs)(a().Y1,{direction:"vertical",gap:8,children:[(0,d.jsx)(De().E,{size:"lg",style:c.button,onClick:n,children:(0,d.jsx)(s().D,{styleKey:"bodyMedium",colorVariant:"primary",style:c.buttonText,children:(0,d.jsx)(o().sA,{...Re.confirmButtonLabel})})}),(0,d.jsx)(H().p,{size:"lg",style:c.button,onClick:i,children:(0,d.jsx)(s().D,{styleKey:"bodyMedium",colorVariant:"primary",style:c.buttonText,children:(0,d.jsx)(o().sA,{...Re.cancelButtonLabel})})})]})]})})}const Re=(0,o().YK)({ariaLabel:{id:"calendarPermissionsSkipConfirmationModal.ariaLabel",defaultMessage:"Calendar permissions skip confirmation modal"},title:{id:"calendarPermissionsRequireConfirmationModal.title",defaultMessage:"Allow AI to act without your confirmation?"},description:{id:"calendarPermissionsRequireConfirmationModal.description",defaultMessage:"AI will be able to send invites and edit events without requiring your review"},confirmButtonLabel:{id:"calendarPermissionsRequireConfirmationModal.confirmButtonLabel",defaultMessage:"Allow anyway"},cancelButtonLabel:{id:"calendarPermissionsRequireConfirmationModal.cancelButtonLabel",defaultMessage:"Continue requiring confirmation"}});function Le(e){var t,n,r;const{calendarWithPermission:l,disabled:c=!1,onChangeScopes:u,onRemoveCalendar:g}=e,{calendar:f,permission:m}=l,p=(0,o().tz)(),[h,v]=(0,i.useState)(!1),w=(0,he().Jx)(f),y=null===(t=m.actions)||void 0===t?void 0:t.includes("read"),M=null===(n=m.actions)||void 0===n?void 0:n.includes("write"),x=!Boolean(null===(r=m.constraints)||void 0===r?void 0:r.skipConfirmation),k=(0,i.useMemo)((()=>y&&M?p.formatMessage(Ee.permissionsScopeReadWrite):y?p.formatMessage(Ee.permissionsScopeRead):M?p.formatMessage(Ee.permissionsScopeWrite):p.formatMessage(Ee.permissionsScopeReadWrite)),[y,M,p]),b=(0,i.useCallback)((e=>{u({calendar:f,scopes:{actions:m.actions,constraints:{...m.constraints,skipConfirmation:!e}}})}),[f,m.actions,m.constraints,u]),C=(0,i.useCallback)((()=>{x?v(!0):b(!0)}),[x,b]),S=(0,i.useCallback)((()=>{v(!1),b(!1)}),[b]),j=(0,i.useCallback)((()=>{v(!1)}),[]),A=(0,i.useCallback)((e=>{const t=[],n=y&&!M,i=y&&M,r=[{key:"read",render:e=>(0,d.jsx)(N().A,{...e,title:p.formatMessage(Ee.permissionsScopeRead),isChecked:n}),action:()=>{n||u({calendar:f,scopes:Ie().Po})}}];return w&&r.push({key:"read-write",render:e=>(0,d.jsx)(N().A,{...e,title:p.formatMessage(Ee.permissionsScopeReadWrite),isChecked:i}),action:()=>{i||u({calendar:f,scopes:Ie().r6})}}),t.push({key:"permissions-scopes",render:e=>(0,d.jsx)(B().A,{topBorder:!1,...e}),items:r}),i&&t.push({key:"permissions-require-confirmation",render:e=>(0,d.jsx)(B().A,{topBorder:!0,...e}),items:[{key:"require-confirmation",render:e=>(0,d.jsx)(N().A,{...e,title:(0,d.jsxs)(a().Y1,{direction:"horizontal",align:"center",gap:"auto",minGap:8,children:[(0,d.jsx)(o().sA,{...Ee.requireConfirmation}),(0,d.jsx)(je().A,{on:x,onClick:C})]}),caption:p.formatMessage(Ee.requireConfirmationDescription),shouldWrapTitle:!0,shouldWrapCaption:!0}),action:C}]}),t.push({key:"permissions-remove-calendar",render:e=>(0,d.jsx)(B().A,{topBorder:!0,...e}),items:[{key:"remove-calendar",render:e=>(0,d.jsx)(N().A,{...e,title:p.formatMessage(Ee.removeCalendar),isRedOnHover:!0}),action:()=>{g(f),e.close()}}]}),t}),[p,f,w,y,M,x,C,u,g]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(z().A,{popupType:z().z.Popup,alignmentToOrigin:"end",originGap:4,disabled:c,render:e=>(0,d.jsx)(W().A,{menuType:E().gu.Popup,width:Ne,children:(0,d.jsx)(U().A,{type:U().O.Vertical,initialFocus:void 0,sections:A(e)})}),renderOrigin:e=>(0,d.jsx)(H().p,{...e,size:"md",disabled:c,children:(0,d.jsxs)(a().Y1,{direction:"horizontal",align:"center",gap:2,children:[(0,d.jsx)(s().D,{styleKey:"captionMedium",colorVariant:c?"disabled":"secondary",children:k}),(0,d.jsx)(L().I,{icon:Ae().arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:c?"disabled":"secondary"})]})})}),(0,d.jsx)(Pe,{open:h,onConfirm:S,onCancel:j})]})}const Ee=(0,o().YK)({permissionsScopeRead:{id:"calendarPermissionsButton.permissionsScopeRead",defaultMessage:"Read"},permissionsScopeWrite:{id:"calendarPermissionsButton.permissionsScopeWrite",defaultMessage:"Write"},permissionsScopeReadWrite:{id:"calendarPermissionsButton.permissionsScopeReadWrite",defaultMessage:"Read and write"},requireConfirmation:{id:"calendarPermissionsButton.requireConfirmation",defaultMessage:"Require confirmation"},requireConfirmationDescription:{id:"calendarPermissionsButton.requireConfirmationDescription",defaultMessage:"When turned off, agent can modify events and send invites without approval"},removeCalendar:{id:"calendarPermissionsButton.removeCalendar",defaultMessage:"Remove calendar"}});function We(e){const{calendarWithPermission:t,disabled:n=!1}=e,{calendar:o}=t;return(0,d.jsx)(Q,{icon:(0,d.jsx)(Me,{calendar:o,size:18}),content:(0,d.jsx)(de().A,{type:"custom",spaceStore:void 0,title:(0,d.jsx)(s().D,{styleKey:"bodyRegular",colorVariant:"primary",children:o.name}),disabled:n,disableSettingsItemClick:!0,customButton:(0,d.jsx)(Le,{...e})})})}const Ne=272;function Ue(e){var t;const{account:n,moduleConfiguration:r,onSetDefaultCalendar:c,onRemoveCalendarAccount:u}=e,{module:g,saveModule:m,userHasEditAccess:p}=r,h=!p,v=(null===(t=g.state)||void 0===t||null===(t=t.defaultCalendar)||void 0===t?void 0:t.accountId)===n.id,w=(0,o().tz)(),y=(0,D().uB)(void 0,K().A),M=(0,D().K8)((()=>(0,P().Y)().getCalendarsForAccount(n.id)),[n.id]),x=(0,i.useMemo)((()=>g.permissions??[]),[g.permissions]),k=x.filter((e=>"accountOrganizationCalendars"===e.type)).find((e=>e.identifier===n.id)),b=x.filter((e=>"calendar"===e.type)),{disconnectedCalendars:C,enabledCalendarsWithPermission:S}=(0,i.useMemo)((()=>{const e=[],t=[],o=[],i=(0,R().Ei)(g.state).find((e=>e.id===n.id)),r=(null==i?void 0:i.calendars)??[];if(!i)return{disconnectedCalendars:e,enabledCalendarsWithPermission:t};if(p){for(const e of r){const n=b.find((t=>t.accountId===e.accountId&&t.calendarId===e.id)),i=M.find((t=>t.id===e.id));n&&i?t.push({calendar:(0,R().LC)(i),permission:n}):o.push(e)}for(const n of M)t.find((e=>e.calendar.id===n.id))||e.push((0,R().LC)(n))}else for(const n of r){const e=b.find((e=>e.accountId===n.accountId&&e.calendarId===n.id));e&&t.push({calendar:n,permission:e})}return{disconnectedCalendars:e,enabledCalendarsWithPermission:t}}),[M,b,g.state,n.id,p]),j=(0,i.useCallback)((e=>{m((0,R().By)({module:g,calendar:e}))}),[g,m]),A=(0,i.useCallback)((e=>{m((0,R().sK)({module:g,calendar:e}))}),[g,m]),I=(0,i.useCallback)((e=>{const{calendar:t,scopes:n}=e;m((0,R().eG)({module:g,calendar:t,scopes:n}))}),[g,m]),T=(0,i.useCallback)((e=>{m((0,R().DT)({module:g,accountId:n.id,actions:e?["read","readCoworker"]:["read"]}))}),[g,m,n.id]),V=(0,l().IS)((()=>({calendarsCountContainer:{marginInlineEnd:8,backgroundColor:f().Tj.background.tertiaryTranslucent,borderRadius:4},calendarsCountLabel:{fontVariantNumeric:"tabular-nums"},settingsRowsContainer:{paddingTop:8,paddingBottom:8,paddingInlineStart:28,paddingInlineEnd:8}})),[]),_=(0,i.useCallback)((e=>{const t=[];return M.length>0&&t.push({key:"set-as-default-account",render:e=>(0,d.jsx)(N().A,{...e,icon:(0,d.jsx)(L().I,{icon:ie().w,size:"default"}),title:(0,d.jsxs)(a().Y1,{direction:"horizontal",align:"center",gap:"auto",minGap:8,children:[(0,d.jsx)(o().sA,{...Be.setAsDefaultTitle}),v?(0,d.jsx)(L().I,{icon:ne().checkmarkSmallIcon,size:"sm"}):void 0]}),caption:w.formatMessage(Be.setAsDefaultDescription),shouldWrapTitle:!0,shouldWrapCaption:!0}),action:()=>{const t=(0,R().QJ)({accountEmail:n.email,accountCalendars:M.map(R().LC)});!v&&t&&c(t),e.close()}}),t.push({key:"remove-calendar-account",render:e=>(0,d.jsx)(N().A,{...e,icon:(0,d.jsx)(L().I,{icon:re().xMarkIcon,size:"default"}),title:w.formatMessage(Be.removeCalendarAccount),isRedOnHover:!0}),action:()=>{u(n),e.close()}}),[{key:"account-settings",render:e=>(0,d.jsx)(B().A,{topBorder:!1,...e}),items:t}]}),[w,n,M,v,c,u]),F=(0,i.useMemo)((()=>[{key:n.id,initialExpanded:!0,headerDivider:!0,title:(0,d.jsxs)(a().Y1,{direction:"horizontal",align:"center-left",gap:8,children:[(0,d.jsx)(s().D,{styleKey:"bodyMedium",colorVariant:"primary",style:$().RC,children:n.displayName}),(0,d.jsx)("div",{style:V.calendarsCountContainer,children:(0,d.jsx)(a().Y1,{align:"center",height:16,padding:"0 4px",children:(0,d.jsx)(s().D,{styleKey:"captionSmMedium",colorPalette:"gray",colorVariant:"accentPrimary",style:V.calendarsCountLabel,children:(0,d.jsx)(o().sA,{...Be.enabledCalendarsCount,values:{count:S.length}})})})})]}),secondaryLabel:(0,d.jsxs)(a().Y1,{direction:"horizontal",align:"center-right",width:"hug",gap:8,children:[v?(0,d.jsx)(s().D,{styleKey:"captionMedium",colorVariant:"tertiary",children:(0,d.jsx)(o().sA,{...Be.default})}):void 0,(0,d.jsx)(z().A,{buttonPopupStore:y,popupType:z().z.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",originGap:4,disabled:h,render:e=>(0,d.jsx)(W().A,{menuType:E().gu.Popup,width:Ne,children:(0,d.jsx)(U().A,{type:U().O.Vertical,initialFocus:void 0,sections:_(e)})}),renderOrigin:e=>(0,d.jsx)(te().A,{...e,icon:oe().ellipsisSmallIcon,size:"sm",colorVariant:"secondary",ariaLabel:w.formatMessage(Be.accountSettingsButtonAriaLabel),disabled:h})})]}),content:(0,d.jsxs)(a().Y1,{direction:"vertical",gap:4,children:[k?(0,d.jsx)(ce,{permission:k,disabled:h,onToggleScope:T}):void 0,S.map((e=>(0,d.jsx)(We,{calendarWithPermission:e,disabled:h,onChangeScopes:I,onRemoveCalendar:A},e.permission.identifier))),(0,d.jsx)(Ce,{account:n,calendars:C,disabled:h||0===C.length,onAddCalendar:j})]}),sectionContentStyleOverride:V.settingsRowsContainer}]),[n,S,v,y,h,_,k,T,I,A,C,j,w,V.calendarsCountContainer,V.calendarsCountLabel,V.settingsRowsContainer]);return(0,d.jsx)(ae().b,{sections:F,chevronPosition:"start",borderedStyle:!0,compactMode:!0})}const Be=(0,o().YK)({accountSettingsButtonAriaLabel:{id:"calendarAccountConfiguration.accountSettingsButtonAriaLabel",defaultMessage:"Account settings button"},default:{id:"calendarAccountConfiguration.default",defaultMessage:"Default"},setAsDefaultTitle:{id:"calendarAccountConfiguration.setAsDefaultTitle",defaultMessage:"Set as default"},setAsDefaultDescription:{id:"calendarAccountConfiguration.setAsDefaultDescription",defaultMessage:"Agent will create and update events in this calendar account by default"},removeCalendarAccount:{id:"calendarAccountConfiguration.removeCalendarAccount",defaultMessage:"Remove calendar account"},enabledCalendarsCount:{id:"calendarAccountConfiguration.enabledCalendarsCount",defaultMessage:"{count, plural, one {# calendar enabled} other {# calendars enabled}}"}});var Ve=()=>n(970236),_e=()=>n(26697),Fe=()=>n(621594);const Oe=(0,o().YK)({reconnectCalendar:{id:"workflows.calendar.reconnectCalendar",defaultMessage:"Reconnect"},reconnectCalendarTooltip:{id:"workflows.calendar.reconnectCalendarTooltip",defaultMessage:"Reconnect a calendar account below to enable connection"}}),ze=(0,o().YK)({cancelEvent:{defaultMessage:"Canceled event",id:"workflow.run.effect.calendar.cancelEvent.description"},cancelEventWhileRunning:{defaultMessage:"Canceling event",id:"workflow.run.effect.calendar.cancelEvent.descriptionWhileRunning"},cancelEvents:{defaultMessage:"Canceled {numEvents} events",id:"workflow.run.effect.calendar.cancelEvents.description"},cancelEventsWhileRunning:{defaultMessage:"Canceling {numEvents} events",id:"workflow.run.effect.calendar.cancelEvents.descriptionWhileRunning"},createEvent:{defaultMessage:"Created event",id:"workflow.run.effect.calendar.createEvent.description"},createEventWhileRunning:{defaultMessage:"Creating event",id:"workflow.run.effect.calendar.createEvent.descriptionWhileRunning"},createEvents:{defaultMessage:"Created {numEvents} events",id:"workflow.run.effect.calendar.createEvents.description"},createEventsWhileRunning:{defaultMessage:"Creating {numEvents} events",id:"workflow.run.effect.calendar.createEvents.descriptionWhileRunning"},listCalendars:{defaultMessage:"Viewed calendars",id:"workflow.run.effect.calendar.listCalendars.description"},listCalendarsWhileRunning:{defaultMessage:"Viewing calendars",id:"workflow.run.effect.calendar.listCalendars.descriptionWhileRunning"},listCoworkersEvents:{defaultMessage:"Viewed coworkers’ events",id:"workflow.run.effect.calendar.listCoworkersEvents.description"},listCoworkersEventsWhileRunning:{defaultMessage:"Viewing coworkers’ events",id:"workflow.run.effect.calendar.listCoworkersEvents.descriptionWhileRunning"},listEvents:{defaultMessage:"Viewed events",id:"workflow.run.effect.calendar.listEvents.description"},listEventsWhileRunning:{defaultMessage:"Viewing events",id:"workflow.run.effect.calendar.listEvents.descriptionWhileRunning"},updateEvent:{defaultMessage:"Updated event",id:"workflow.run.effect.calendar.updateEvent.description"},updateEventWhileRunning:{defaultMessage:"Updating event",id:"workflow.run.effect.calendar.updateEvent.descriptionWhileRunning"},updateEvents:{defaultMessage:"Updated {numEvents} events",id:"workflow.run.effect.calendar.updateEvents.description"},updateEventsWhileRunning:{defaultMessage:"Updating {numEvents} events",id:"workflow.run.effect.calendar.updateEvents.descriptionWhileRunning"},runTool:{defaultMessage:"Ran Calendar tool",id:"workflow.run.effect.calendar.runTool.description"},runToolWhileRunning:{defaultMessage:"Running Calendar tool",id:"workflow.run.effect.calendar.runTool.descriptionWhileRunning"},runToolWithTitle:{defaultMessage:"Ran Calendar tool - {title}",id:"workflow.run.effect.calendar.runToolWithTitle.description"},runToolWithTitleWhileRunning:{defaultMessage:"Running Calendar tool - {title}",id:"workflow.run.effect.calendar.runToolWithTitle.descriptionWhileRunning"},fetchPlaybook:{defaultMessage:"Read Calendar best practices",id:"workflow.run.effect.calendar.fetchPlaybook.description"},fetchPlaybookWhileRunning:{defaultMessage:"Reading Calendar best practices",id:"workflow.run.effect.calendar.fetchPlaybook.descriptionWhileRunning"}});function Ke(e){const{children:t}=e;return(0,d.jsx)(a().Y1,{direction:"vertical",gap:6,children:t})}function Ye({label:e,children:t,footer:n,labelColorVariant:o="secondary"}){const i=(0,l().IS)((()=>({container:{boxShadow:`inset 0 0 0 1px ${f().Tj.border.secondary}`,minHeight:40}})),[]);return(0,d.jsxs)(a().Y1,{style:i.container,borderRadius:8,padding:"8px 8px 8px 14px",direction:"vertical",gap:"auto",align:"center",children:[(0,d.jsxs)(a().Y1,{direction:"horizontal",gap:"auto",align:"center",children:[(0,d.jsx)(s().D,{styleKey:"bodyRegular",colorVariant:o,children:e}),t]}),(0,d.jsx)(a().Y1,{children:n})]})}var He=()=>n(160432),qe=()=>n(955363),$e=()=>n(383036);function Ge(e){const{buttonPopupEvents:t,tooltipEvents:n,needsSetup:o,children:r,isLoading:a,isDisabled:c,dimDisabledAppearance:u=!1}=e,g=(0,$e().A)(t,n),m=(0,l().eP)(),p=(0,l().IS)((()=>{const e={hoveredButton:{background:f().Tj.background.secondaryTranslucent},pressedButton:{background:(0,O().yZ)({color:f().Tj.background.secondaryTranslucent,mode:m})}};return u&&(e.disabledChevron={color:f().Tj.border.secondary,fill:f().Tj.border.secondary}),e}),[u,m]),h=i.useMemo((()=>({icon:Ae().arrowChevronSingleDownSmallIcon,size:"xs",colorVariant:"secondary"})),[]),v=u&&c?p.disabledChevron:void 0;return o?(0,d.jsx)(De().E,{...g,iconTrailing:{icon:Ae().arrowChevronSingleDownSmallIcon,size:"xs",...v?{style:v}:{}},isLoading:a,colorPalette:"blue",size:"sm",children:(0,d.jsx)(s().D,{styleKey:"bodyMedium",textOverflow:"ellipsis",children:r})}):(0,d.jsx)(H().p,{...g,iconTrailing:v?{...h,style:v}:h,isLoading:a,size:"sm",hoveredStyle:p.hoveredButton,pressedStyle:p.pressedButton,children:(0,d.jsx)(s().D,{styleKey:"bodyMedium",textOverflow:"ellipsis",colorVariant:c&&u?"disabled":"secondary",children:r})})}const Qe=(0,o().YK)({noCalendars:{id:"workflows.calendarPicker.noCalendars",defaultMessage:"No calendars found"},connectCalendar:{id:"workflows.calendarPicker.connectCalendar",defaultMessage:"Connect calendar"},selectCalendars:{id:"workflows.calendarPicker.selectCalendars",defaultMessage:"Select calendars"},multipleCalendarsSelected:{id:"workflows.calendarPicker.multipleSelected",defaultMessage:"{count, plural, one {# calendar} other {# calendars}}"}});function Je(e){const{selectedCalendars:t,writeSelectedCalendars:n}=e,r=(0,o().tz)(),a=(0,T().X)("custom_agent_calendar_connection_workflow"),{isWaitingForCalendarConnection:s,calendarAccounts:l,handleConnectCalendar:c}=(0,F().N)({from:"notionAISignupClick",connectionSuccessMessage:r.formatMessage(R().DZ.connectCalendarSuccessMessage)}),u=(0,D().K8)((()=>(0,P().Y)().getCurrentCalendars()??[]),[]),g=(0,i.useCallback)((e=>Boolean(t.find((t=>t.accountId===e.accountId&&t.calendarId===e.id)))),[t]),f=(0,i.useMemo)((()=>new(K().A)),[]),m=(0,i.useCallback)((e=>{const o=g(e);n(o?t.filter((t=>!(t.accountId===e.accountId&&t.calendarId===e.id))):[...t,{accountId:e.accountId,calendarId:e.id}])}),[t,n,g]),p=(0,i.useMemo)((()=>{if(!u||0===u.length)return(0,d.jsx)(o().sA,{...Qe.noCalendars});if(!t||0===t.length)return(0,d.jsx)(o().sA,{...Qe.selectCalendars});if(1!==t.length)return(0,d.jsx)(o().sA,{...Qe.multipleCalendarsSelected,values:{count:t.length}});{const e=t[0],n=u.find((t=>t.accountId===e.accountId&&t.id===e.calendarId));if(n)return n.name}return(0,d.jsx)(o().sA,{...Qe.selectCalendars})}),[u,t]),h=(0,i.useCallback)((()=>(0,d.jsx)(ke,{accounts:l,calendars:u??[],selectedCalendars:t,onCalendarClick:m})),[l,u,t,m]);return a&&0===l.length?(0,d.jsx)(He().A,{colorPalette:"blue",iconTrailing:{icon:qe().arrowDiagonalUpRightIcon},isLoading:s,onClick:c,children:(0,d.jsx)(o().sA,{...Qe.connectCalendar})}):(0,d.jsx)(z().A,{buttonPopupStore:f,disabled:0===l.length,originGap:4,placementToOrigin:"bottom",popupType:z().z.Popup,renderOrigin:e=>(0,d.jsx)(Ge,{buttonPopupEvents:e,needsSetup:!t||0===t.length,children:p}),render:h})}const Ze=(0,o().YK)({calendarsFieldLabel:{id:"workflows.calendar.calendarsFieldLabel",defaultMessage:"Calendars"}});function Xe(e){const{selectedCalendars:t,writeSelectedCalendars:n}=e;return(0,d.jsx)(Ye,{label:(0,d.jsx)(o().sA,{...Ze.calendarsFieldLabel}),children:(0,d.jsx)(Je,{selectedCalendars:t,writeSelectedCalendars:n})})}const et=(0,o().YK)({eventCreatedTriggerTitle:{defaultMessage:"Event created",id:"workflow.run.trigger.calendar.eventCreatedTriggerTitle"},eventCreatedTriggerDescription:{defaultMessage:"When a calendar event is created",id:"workflow.run.trigger.calendar.eventCreatedTriggerDescription"},eventUpdatedTriggerTitle:{defaultMessage:"Event updated",id:"workflow.run.trigger.calendar.eventUpdatedTriggerTitle"},eventUpdatedTriggerDescription:{defaultMessage:"When a calendar event is updated",id:"workflow.run.trigger.calendar.eventUpdatedTriggerDescription"},eventCanceledTriggerTitle:{defaultMessage:"Event canceled",id:"workflow.run.trigger.calendar.eventCanceledTriggerTitle"},eventCanceledTriggerDescription:{defaultMessage:"When a calendar event is canceled",id:"workflow.run.trigger.calendar.eventCanceledTriggerDescription"}});function tt(e){if(e){var t,n,o;if((0,A().gY)(e,"calendar.createEvents"))return(null===(t=e.input)||void 0===t||null===(t=t.events)||void 0===t?void 0:t.length)||0;if((0,A().gY)(e,"calendar.updateEvents"))return(null===(n=e.input)||void 0===n||null===(n=n.updates)||void 0===n?void 0:n.length)||0;if((0,A().gY)(e,"calendar.cancelEvents"))return(null===(o=e.input)||void 0===o||null===(o=o.events)||void 0===o?void 0:o.length)||0}return 0}const nt={triggers:{"calendar.event.created":{icon:I().notionCalendarIcon,configuration:"minimal",description:et.eventCreatedTriggerTitle,TriggerOrRunTitle:function(){return(0,d.jsx)(o().sA,{...et.eventCreatedTriggerTitle})},SpecificTriggerDescription:function(){return(0,d.jsx)(o().sA,{...et.eventCreatedTriggerDescription})},ConfigurationComponent:function(e){var t;const{trigger:n,saveTrigger:o}=e,r=(null===(t=n.state)||void 0===t?void 0:t.calendars)??[],a=(0,i.useCallback)((e=>{o({...n,state:{...n.state,type:"calendar.event.created",calendars:e}})}),[n,o]);return(0,d.jsx)(Ke,{children:(0,d.jsx)(Xe,{selectedCalendars:r,writeSelectedCalendars:a})})}},"calendar.event.updated":{icon:I().notionCalendarIcon,configuration:"minimal",description:et.eventUpdatedTriggerTitle,TriggerOrRunTitle:function(){return(0,d.jsx)(o().sA,{...et.eventUpdatedTriggerTitle})},SpecificTriggerDescription:function(){return(0,d.jsx)(o().sA,{...et.eventUpdatedTriggerDescription})},ConfigurationComponent:function(e){var t;const{trigger:n,saveTrigger:o}=e,r=(null===(t=n.state)||void 0===t?void 0:t.calendars)??[],a=(0,i.useCallback)((e=>{o({...n,state:{...n.state,type:"calendar.event.updated",calendars:e}})}),[n,o]);return(0,d.jsx)(Ke,{children:(0,d.jsx)(Xe,{selectedCalendars:r,writeSelectedCalendars:a})})}},"calendar.event.canceled":{icon:I().notionCalendarIcon,configuration:"minimal",description:et.eventCanceledTriggerTitle,TriggerOrRunTitle:function(){return(0,d.jsx)(o().sA,{...et.eventCanceledTriggerTitle})},SpecificTriggerDescription:function(){return(0,d.jsx)(o().sA,{...et.eventCanceledTriggerDescription})},ConfigurationComponent:function(e){var t;const{trigger:n,saveTrigger:o}=e,r=(null===(t=n.state)||void 0===t?void 0:t.calendars)??[],a=(0,i.useCallback)((e=>{o({...n,state:{...n.state,type:"calendar.event.canceled",calendars:e}})}),[n,o]);return(0,d.jsx)(Ke,{children:(0,d.jsx)(Xe,{selectedCalendars:r,writeSelectedCalendars:a})})}}},effect:{"calendar.fetchPlaybook":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t,toolResultStep:n})=>t?e.formatMessage(ze.fetchPlaybookWhileRunning):e.formatMessage(ze.fetchPlaybook)},"calendar.listCalendars":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t,toolResultStep:n})=>t?e.formatMessage(ze.listCalendarsWhileRunning):e.formatMessage(ze.listCalendars)},"calendar.listEvents":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t,toolResultStep:n})=>t?e.formatMessage(ze.listEventsWhileRunning):e.formatMessage(ze.listEvents)},"calendar.listCoworkersEvents":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t,toolResultStep:n})=>t?e.formatMessage(ze.listCoworkersEventsWhileRunning):e.formatMessage(ze.listCoworkersEvents)},"calendar.createEvents":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t,toolResultStep:n})=>{const o=tt(n);return o>1?t?e.formatMessage(ze.createEventsWhileRunning,{numEvents:o}):e.formatMessage(ze.createEvents,{numEvents:o}):t?e.formatMessage(ze.createEventWhileRunning):e.formatMessage(ze.createEvent)}},"calendar.updateEvents":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t,toolResultStep:n})=>{const o=tt(n);return o>1?t?e.formatMessage(ze.updateEventsWhileRunning,{numEvents:o}):e.formatMessage(ze.updateEvents,{numEvents:o}):t?e.formatMessage(ze.updateEventWhileRunning):e.formatMessage(ze.updateEvent)}},"calendar.cancelEvents":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t,toolResultStep:n})=>{const o=tt(n);return o>1?t?e.formatMessage(ze.cancelEventsWhileRunning,{numEvents:o}):e.formatMessage(ze.cancelEvents,{numEvents:o}):t?e.formatMessage(ze.cancelEventWhileRunning):e.formatMessage(ze.cancelEvent)}},"calendar.suggestMeetingTimes":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t,toolResultStep:n})=>t?e.formatMessage(ze.runToolWhileRunning):e.formatMessage(ze.runTool)}},ModuleConfiguration:function(e){const{module:t,saveModule:n,userHasEditAccess:o}=e,r=(0,T().X)("custom_agent_calendar_module_permissions"),s=(0,D().K8)((()=>(0,P().Y)().getCalendarProviderAccounts()),[]);(0,i.useEffect)((()=>{if(!o||0===s.length)return;const e=(0,R().Qw)({module:t,syncedAccounts:s,getCalendarsForAccount:e=>(0,P().Y)().getCalendarsForAccount(e)});e&&n(e)}),[t,s,o,n]);const{enabledAccounts:l,disconnectedAccounts:c}=(0,i.useMemo)((()=>{const e=(0,R().Ei)(t.state);if(!o)return{enabledAccounts:e,disconnectedAccounts:[]};const n=[],i=[],r=[];for(const t of e){const e=s.find((e=>e.id===t.id));e?i.push(e):r.push(t)}for(const t of s)i.find((e=>e.id===t.id))||n.push(t);return{enabledAccounts:i,disconnectedAccounts:n}}),[s,t.state,o]),u=(0,i.useCallback)((e=>{const o=(0,P().Y)().getCalendarsForAccount(e.id).map(R().LC),i=(0,R().QJ)({accountEmail:e.email,accountCalendars:o}),r=(0,R().Cc)({module:t,account:e,defaultCalendarForAccount:i});i&&0===l.length?n((0,R().Gv)({module:r,accountId:e.id,calendarId:null==i?void 0:i.id})):n(r)}),[t,n,l]),g=(0,i.useCallback)((e=>{const o=(0,R().xz)({state:t.state,accountId:e.id,enabledAccounts:l});let i;if(o){var r;const e=new Set(null===(r=(0,R().Ei)(t.state).find((e=>e.id===o.id)))||void 0===r||null===(r=r.calendars)||void 0===r?void 0:r.map((e=>e.id))),n=(0,P().Y)().getCalendarsForAccount(o.id).filter((t=>e.has(t.id))).map(R().LC);i=(0,R().QJ)({accountEmail:o.email,accountCalendars:n})}n((0,R().P3)({module:t,accountId:e.id,nextDefaultCalendar:i}))}),[t,n,l]),f=(0,i.useCallback)((e=>{n((0,R().Gv)({module:t,accountId:e.accountId,calendarId:e.id}))}),[t,n]);return r?(0,d.jsxs)(a().Y1,{direction:"vertical",gap:12,style:{paddingTop:8},children:[l.map((t=>(0,d.jsx)(Ue,{account:t,moduleConfiguration:e,onSetDefaultCalendar:f,onRemoveCalendarAccount:g},t.id))),(0,d.jsx)(X,{accounts:c,disabled:!o,onAddCalendarAccount:u})]}):null},getSecondaryLabel:function(){const e=(0,T().X)("custom_agent_calendar_connection_workflow");if(!((0,D().K8)((()=>(0,P().Y)().getCalendarProviderAccounts().length),[])>0)&&e)return(0,d.jsx)(_e().m,{placement:"bottom",renderTooltip:()=>(0,d.jsx)(o().sA,{...Oe.reconnectCalendarTooltip}),render:e=>(0,d.jsx)(Ve().E,{...e,color:"yellow",content:(0,d.jsxs)(a().Y1,{direction:"horizontal",align:"center",gap:2,children:[(0,d.jsx)(L().I,{icon:Fe().exclamationMarkCircleSmallIcon,size:"xxs"}),(0,d.jsx)(o().sA,{...Oe.reconnectCalendar})]})})})}};n(16280),n(908872);var ot=()=>n(925255),it=()=>n(484714),rt=()=>n(792057),at=()=>n(394888),st=()=>n(128933),lt=()=>n(249046),dt=()=>n(31511),ct=()=>n(406094),ut=()=>n(835470),gt=()=>n(724639),ft=()=>n(534177);function mt(e,t){return e instanceof Error&&e.message.length>0?e.message:t}const pt="default";const ht=(0,o().YK)({listMachines:{defaultMessage:"Listed remote computers",id:"workflow.run.effect.computer.listMachines.description"},listMachinesLoading:{defaultMessage:"Listing remote computers",id:"workflow.run.effect.computer.listMachines.loading"},listSecrets:{defaultMessage:"Listed remote computer secrets",id:"workflow.run.effect.computer.listSecrets.description"},listSecretsLoading:{defaultMessage:"Listing remote computer secrets",id:"workflow.run.effect.computer.listSecrets.loading"},createMachine:{defaultMessage:"Created a remote computer",id:"workflow.run.effect.computer.createMachine.description"},createMachineLoading:{defaultMessage:"Creating a remote computer",id:"workflow.run.effect.computer.createMachine.loading"},destroyMachine:{defaultMessage:"Destroyed a remote computer",id:"workflow.run.effect.computer.destroyMachine.description"},destroyMachineLoading:{defaultMessage:"Destroying a remote computer",id:"workflow.run.effect.computer.destroyMachine.loading"},setSecret:{defaultMessage:"Stored a remote computer secret",id:"workflow.run.effect.computer.setSecret.description"},setSecretLoading:{defaultMessage:"Storing a remote computer secret",id:"workflow.run.effect.computer.setSecret.loading"},terminal:{defaultMessage:"Ran a terminal command on a remote computer",id:"workflow.run.effect.computer.terminal.description"},terminalLoading:{defaultMessage:"Running a terminal command on a remote computer",id:"workflow.run.effect.computer.terminal.loading"},browser:{defaultMessage:"Drove a browser on a remote computer",id:"workflow.run.effect.computer.browser.description"},browserLoading:{defaultMessage:"Driving a browser on a remote computer",id:"workflow.run.effect.computer.browser.loading"},getJobStatus:{defaultMessage:"Fetched remote computer job status",id:"workflow.run.effect.computer.getJobStatus.description"},viewFileUrl:{defaultMessage:"Viewed a file on a remote computer",id:"workflow.run.effect.computer.viewFileUrl.description"},viewFileUrlLoading:{defaultMessage:"Viewing a file on a remote computer",id:"workflow.run.effect.computer.viewFileUrl.loading"},getJobStatusLoading:{defaultMessage:"Fetching remote computer job status",id:"workflow.run.effect.computer.getJobStatus.loading"},getJobLogs:{defaultMessage:"Fetched remote computer job logs",id:"workflow.run.effect.computer.getJobLogs.description"},getJobLogsLoading:{defaultMessage:"Fetching remote computer job logs",id:"workflow.run.effect.computer.getJobLogs.loading"}}),vt={triggers:{},effect:{"computer.listMachines":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?ht.listMachinesLoading:ht.listMachines)},"computer.listSecrets":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?ht.listSecretsLoading:ht.listSecrets)},"computer.createMachine":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?ht.createMachineLoading:ht.createMachine)},"computer.destroyMachine":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?ht.destroyMachineLoading:ht.destroyMachine)},"computer.setSecret":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?ht.setSecretLoading:ht.setSecret)},"computer.terminal":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?ht.terminalLoading:ht.terminal)},"computer.browser":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?ht.browserLoading:ht.browser)},"computer.viewFileUrl":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?ht.viewFileUrlLoading:ht.viewFileUrl)},"computer.getJobStatus":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?ht.getJobStatusLoading:ht.getJobStatus)},"computer.getJobLogs":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?ht.getJobLogsLoading:ht.getJobLogs)}},ModuleConfiguration:function(e){var t;const{isInTranscript:r,module:a,saveModule:m,store:p,userHasEditAccess:h,workflowDefinitionPointer:v}=e,w=(0,it().v3)(),y=(0,o().tz)(),M=(0,l().IS)((()=>({environmentButton:{paddingInline:10,gap:8,marginInlineStart:"auto"},environmentButtonRow:{display:"flex",justifyContent:"flex-end",width:"100%"},environmentList:{display:"flex",flexDirection:"column",gap:8,width:"100%"},environmentRow:{display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"4px 0",width:"100%"},environmentListWrapper:{width:"100%"},environmentName:{fontWeight:600,textAlign:"start"},environmentNameWrapper:{flex:1,minWidth:0},environmentActions:{display:"flex",gap:8,marginInlineStart:"auto"},secretList:{display:"flex",flexDirection:"column",gap:8},secretRow:{display:"flex",alignItems:"center",justifyContent:"space-between",borderRadius:6,padding:"8px 12px",background:f().Tj.background.secondary},secretName:{fontWeight:600},form:{display:"flex",flexDirection:"column",gap:12},inputs:{display:"flex",flexDirection:"column",gap:8},input:{width:"100%"},environmentModal:{width:640,padding:24,display:"flex",flexDirection:"column",gap:16},actionsRow:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:8}})),[]),[x,k]=(0,i.useState)([]),[b,C]=(0,i.useState)(!1),[S,j]=(0,i.useState)({name:"",value:"",errorMessage:void 0,isSaving:!1,deletingKey:void 0}),A=(0,i.useMemo)((()=>{var e;return(null===(e=a.state)||void 0===e?void 0:e.environments)??{}}),[null===(t=a.state)||void 0===t?void 0:t.environments]),I=(0,i.useMemo)((()=>Object.keys(A).filter((e=>e!==pt)).sort(((e,t)=>e.localeCompare(t)))),[A]),[T,D]=(0,i.useState)(!1),[P,R]=(0,i.useState)(void 0),[L,E]=(0,i.useState)({name:"",setupScript:"",maintenanceScript:"",envVars:[],errorMessage:void 0}),[W,N]=(0,i.useState)(pt),{workflowId:U,spaceId:B}=(0,i.useMemo)((()=>(0,gt().kI)(v)),[v]),V=p.table===n(743246).C0,_=p.table===n(758256).U6||!h,F=(0,i.useCallback)((e=>{if(!h)return;const t=Object.entries(e).reduce(((e,[t,n])=>{const o=t.trim();return o.length>0&&(e[o]=n),e}),{}),n={...a.state??{}};Object.keys(t).length>0?n.environments=t:delete n.environments;const o={...a,state:Object.keys(n).length>0?n:void 0};m(o)}),[a,m,h]),O=S.name.trim().length>0&&S.value.length>0,z=(0,i.useCallback)((()=>{j({name:"",value:"",errorMessage:void 0,isSaving:!1,deletingKey:void 0})}),[]),K=(0,i.useCallback)((e=>{var t,n,o;E({name:(null==e?void 0:e.name)??"",setupScript:(null==e||null===(t=e.config)||void 0===t?void 0:t.setupScript)??"",maintenanceScript:(null==e||null===(n=e.config)||void 0===n?void 0:n.maintenanceScript)??"",envVars:(null==e||null===(o=e.config)||void 0===o||null===(o=o.envVars)||void 0===o?void 0:o.map((e=>({key:e.key,value:e.value}))))??[],errorMessage:void 0})}),[]),H=(0,i.useCallback)((()=>{h&&(R(void 0),K(),z(),N(pt),D(!0))}),[K,z,h]),q=(0,i.useCallback)((e=>{if(e===pt)return;const t=e===pt?{}:A[e]??void 0;h&&(e===pt||t)&&(R(e),K({name:e,config:t}),z(),N(e),D(!0))}),[A,K,z,h]),$=(0,i.useCallback)((()=>{D(!1),R(void 0),K(),z()}),[K,z]),G=(0,i.useCallback)(((e,t)=>e?e===pt?y.formatMessage({id:"workflows.notion.permissions.remoteComputer.environments.defaultReserved",defaultMessage:"Default is reserved and cannot be edited"}):t!==e&&Object.prototype.hasOwnProperty.call(A,e)?y.formatMessage({id:"workflows.notion.permissions.remoteComputer.environments.nameExists",defaultMessage:"An environment with this name already exists"}):void 0:y.formatMessage({id:"workflows.notion.permissions.remoteComputer.environments.nameRequired",defaultMessage:"Environment name is required"})),[A,y]),Q=(0,i.useCallback)((e=>{const t=e.envVars.map((e=>({key:e.key.trim(),value:e.value}))).filter((e=>e.key.length>0)),n=e.setupScript.trim(),o=e.maintenanceScript.trim();return{setupScript:n.length>0?n:void 0,maintenanceScript:o.length>0?o:void 0,envVars:t.length>0?t:void 0}}),[]),J=(0,i.useCallback)((e=>{if(!h)return void E((t=>({...e,errorMessage:t.errorMessage})));const t=e.name.trim(),n=P??L.name.trim(),o=n,i=G(t,n);if(i)return void E({...e,errorMessage:i});const r=Q(e),a={...A};o&&o!==t&&delete a[o],a[t]=r,F(a),R(t),N(t),E({...e,errorMessage:void 0})}),[Q,P,L.name,A,G,F,h]),Z=(0,i.useCallback)((e=>{if(!h)return;if(e===pt)return;if(!Object.prototype.hasOwnProperty.call(A,e))return;const t={...A};delete t[e],F(t)}),[A,F,h]),X=(0,i.useCallback)((()=>{J({...L,envVars:[...L.envVars,{key:"",value:""}]})}),[J,L]),ee=(0,i.useCallback)(((e,t)=>{const n=[...L.envVars];n[e]=t,J({...L,envVars:n})}),[J,L]),te=(0,i.useCallback)((e=>{J({...L,envVars:L.envVars.filter(((t,n)=>n!==e))})}),[J,L]),ne=(0,i.useCallback)((async()=>{if(B&&U&&P){C(!0);try{const e=await w.api.callApi({environment:w,eventName:"getMachineAgentSecrets",data:{workflowId:U,spaceId:B,environmentName:W}});if("failed"===e.type)throw e.error;k(e.data.secrets)}catch(e){const t=mt(e,y.formatMessage({id:"workflows.notion.permissions.remoteComputer.secrets.loadError",defaultMessage:"Failed to load secrets"}));rt().f1((0,d.jsx)(s().D,{styleKey:"bodyRegular",children:t}))}finally{C(!1)}}}),[P,w,y,W,B,U]);(0,i.useEffect)((()=>{T&&ne()}),[T,ne]);const oe=(0,i.useCallback)((async()=>{if(B&&U&&O&&!S.isSaving)if(V){j((e=>({...e,errorMessage:void 0,isSaving:!0})));try{const e=await w.api.callApi({environment:w,eventName:"setMachineAgentSecret",data:{workflowId:U,spaceId:B,secretName:S.name.trim(),secretValue:S.value,environmentName:W}});if("failed"===e.type)throw e.error;j((e=>({...e,name:"",value:"",isSaving:!1}))),await ne(),st().D6({label:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.secrets.saved",defaultMessage:"Secret saved"})})}catch(e){const t=mt(e,y.formatMessage({id:"workflows.notion.permissions.remoteComputer.secrets.saveError",defaultMessage:"Failed to save secret"}));j((e=>({...e,errorMessage:t,isSaving:!1})))}}else rt().f1(y.formatMessage({id:"workflows.notion.permissions.remoteComputer.secrets.invalidWorkflow",defaultMessage:"Secrets can only be set on editable agents"}))}),[O,w,y,V,ne,S.isSaving,S.name,S.value,W,B,U]),ie=(0,i.useCallback)((async e=>{if(B&&U&&!S.deletingKey){j((t=>({...t,deletingKey:e})));try{const t=await w.api.callApi({environment:w,eventName:"deleteMachineAgentSecret",data:{workflowId:U,spaceId:B,secretName:e,environmentName:W}});if("failed"===t.type)throw t.error;await ne(),st().D6({label:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.secrets.deleted",defaultMessage:"Secret deleted"})})}catch(t){const e=mt(t,y.formatMessage({id:"workflows.notion.permissions.remoteComputer.secrets.deleteError",defaultMessage:"Failed to delete secret"}));rt().f1((0,d.jsx)(s().D,{styleKey:"bodyRegular",children:e}))}finally{j((e=>({...e,deletingKey:void 0})))}}}),[w,y,ne,S.deletingKey,W,B,U]);if(r)return null;const re=P===pt,ae=V&&!_&&Boolean(P)&&P!==pt;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(c,{isDisabled:!h,children:[(0,d.jsx)(u,{children:(0,d.jsx)(s().D,{styleKey:"bodyMedium",children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.environments.title",defaultMessage:"Environments"})})}),(0,d.jsx)(g,{children:(0,d.jsx)("div",{style:M.environmentButtonRow,children:(0,d.jsx)(ct().A,{onClick:H,disabled:!h,style:M.environmentButton,children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.environments.add",defaultMessage:"Add environment"})})})})]}),(0,d.jsx)(c,{isDisabled:!h,children:(0,d.jsx)(g,{children:(0,d.jsx)("div",{style:M.environmentListWrapper,children:(0,d.jsx)(lt().wt,{style:M.environmentList,children:I.length>0?I.map((e=>(0,d.jsxs)("div",{style:M.environmentRow,children:[(0,d.jsx)("div",{style:M.environmentNameWrapper,children:(0,d.jsx)(s().D,{styleKey:"bodyRegular",style:M.environmentName,children:e})}),(0,d.jsxs)("div",{style:M.environmentActions,children:[(0,d.jsx)(ct().A,{onClick:()=>q(e),disabled:!h,children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.environments.edit",defaultMessage:"Edit"})}),(0,d.jsx)(ct().A,{onClick:()=>Z(e),disabled:!h,children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.environments.delete",defaultMessage:"Delete"})})]})]},e))):(0,d.jsx)(s().D,{styleKey:"bodyRegular",children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.environments.empty",defaultMessage:"No custom environments configured yet."})})})})})}),T?(0,d.jsx)(at().s,{isOpen:T,onDismiss:$,onClosed:$,ariaLabel:y.formatMessage({id:"workflows.notion.permissions.remoteComputer.environments.modalTitle",defaultMessage:"Edit environment"}),areaConstraint:{width:{type:"fixed",length:640},height:{type:"min",length:480}},render:({sizeRange:e})=>(0,d.jsxs)("div",{style:{...M.environmentModal,...e},children:[(0,d.jsxs)(lt().wt,{style:M.form,children:[(0,d.jsx)(s().D,{styleKey:"bodyMedium",children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.environments.nameLabel",defaultMessage:"Environment name"})}),(0,d.jsx)(dt().A,{placeholder:y.formatMessage({id:"workflows.notion.permissions.remoteComputer.environments.namePlaceholder",defaultMessage:"Staging"}),value:L.name,onChange:e=>{const t="string"==typeof e.target.value?e.target.value:"";J({...L,name:t})},disabled:re,style:M.input})]}),(0,d.jsxs)(lt().wt,{style:M.form,children:[(0,d.jsx)(s().D,{styleKey:"bodyMedium",children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.environments.setupScript",defaultMessage:"Setup script"})}),(0,d.jsx)(dt().A,{placeholder:y.formatMessage({id:"workflows.notion.permissions.remoteComputer.environments.setupScriptPlaceholder",defaultMessage:"Commands to run once when the environment is cached"}),value:L.setupScript,textarea:!0,textareaSubmitOnEnter:!1,textareaElementAttributes:{rows:5},onChange:e=>{const t="string"==typeof e.target.value?e.target.value:"";J({...L,setupScript:t})},disabled:re,style:M.input})]}),(0,d.jsxs)(lt().wt,{style:M.form,children:[(0,d.jsx)(s().D,{styleKey:"bodyMedium",children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.environments.maintenanceScript",defaultMessage:"Maintenance script"})}),(0,d.jsx)(dt().A,{placeholder:y.formatMessage({id:"workflows.notion.permissions.remoteComputer.environments.maintenanceScriptPlaceholder",defaultMessage:"Commands to run every time a machine starts"}),value:L.maintenanceScript,textarea:!0,textareaSubmitOnEnter:!1,textareaElementAttributes:{rows:5},onChange:e=>{const t="string"==typeof e.target.value?e.target.value:"";J({...L,maintenanceScript:t})},disabled:re,style:M.input})]}),(0,d.jsxs)(lt().wt,{style:M.form,children:[(0,d.jsx)(s().D,{styleKey:"bodyMedium",children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.environments.envVars",defaultMessage:"Environment variables"})}),L.envVars.length>0?(0,d.jsx)(lt().wt,{style:M.inputs,children:L.envVars.map(((e,t)=>(0,d.jsxs)(lt().Ye,{alignItems:"center",justifyContent:"space-between",gap:8,children:[(0,d.jsx)(dt().A,{placeholder:y.formatMessage({id:"workflows.notion.permissions.remoteComputer.environments.envVarKey",defaultMessage:"KEY"}),value:e.key,onChange:n=>{const o="string"==typeof n.target.value?n.target.value:"";ee(t,{key:o,value:e.value})},disabled:re,style:M.input}),(0,d.jsx)(dt().A,{placeholder:y.formatMessage({id:"workflows.notion.permissions.remoteComputer.environments.envVarValue",defaultMessage:"Value"}),value:e.value,onChange:n=>{const o="string"==typeof n.target.value?n.target.value:"";ee(t,{key:e.key,value:o})},disabled:re,style:M.input}),(0,d.jsx)(ct().A,{onClick:()=>te(t),disabled:re,children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.environments.envVarRemove",defaultMessage:"Remove"})})]},`${e.key}-${t}`)))}):(0,d.jsx)(s().D,{styleKey:"bodyRegular",children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.environments.envVarsEmpty",defaultMessage:"No environment variables configured."})}),(0,d.jsx)(ct().A,{onClick:X,disabled:re,children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.environments.envVarsAdd",defaultMessage:"Add variable"})})]}),(0,ft().O9)(L.errorMessage)?(0,d.jsx)(ot().W,{iconGroup:ut().F,children:(0,d.jsx)(s().D,{styleKey:"bodyRegular",children:L.errorMessage})}):null,ae?(0,d.jsxs)(lt().wt,{style:M.form,children:[(0,d.jsx)(s().D,{styleKey:"bodyMedium",children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.secrets.title",defaultMessage:"Remote computer secrets"})}),b?(0,d.jsx)(lt().Ye,{alignItems:"center",justifyContent:"center",children:(0,d.jsx)(Y().k,{})}):x.length>0?(0,d.jsx)(lt().wt,{style:M.secretList,children:x.map((e=>(0,d.jsxs)("div",{style:M.secretRow,children:[(0,d.jsx)(s().D,{styleKey:"bodyRegular",style:M.secretName,children:e.secretName}),(0,d.jsx)(ct().A,{onClick:()=>ie(e.secretName),disabled:Boolean(S.deletingKey),children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.secrets.delete",defaultMessage:"Delete"})})]},e.secretName)))}):(0,d.jsx)(s().D,{styleKey:"bodyRegular",children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.secrets.empty",defaultMessage:"No secrets configured yet."})}),(0,d.jsxs)(lt().wt,{style:M.form,children:[(0,d.jsx)(s().D,{styleKey:"bodyMedium",children:(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.secrets.addTitle",defaultMessage:"Add a new secret"})}),(0,d.jsxs)("div",{style:M.inputs,children:[(0,d.jsx)(dt().A,{placeholder:y.formatMessage({id:"workflows.notion.permissions.remoteComputer.secrets.namePlaceholder",defaultMessage:"Secret name"}),value:S.name,onChange:e=>{const t="string"==typeof e.target.value?e.target.value:"";j((e=>({...e,name:t})))},style:M.input}),(0,d.jsx)(dt().A,{placeholder:y.formatMessage({id:"workflows.notion.permissions.remoteComputer.secrets.valuePlaceholder",defaultMessage:"Secret value"}),value:S.value,textarea:!0,textareaSubmitOnEnter:!1,textareaElementAttributes:{rows:3},onChange:e=>{const t="string"==typeof e.target.value?e.target.value:"";j((e=>({...e,value:t})))},style:M.input})]}),(0,ft().O9)(S.errorMessage)?(0,d.jsx)(ot().W,{iconGroup:ut().F,children:(0,d.jsx)(s().D,{styleKey:"bodyRegular",children:S.errorMessage})}):null,(0,d.jsx)("div",{style:M.actionsRow,children:(0,d.jsx)(He().A,{onClick:oe,disabled:!O||S.isSaving,children:S.isSaving?(0,d.jsx)(Y().k,{size:"sm"}):(0,d.jsx)(o().sA,{id:"workflows.notion.permissions.remoteComputer.secrets.save",defaultMessage:"Save"})})})]})]}):null]})}):null]})}};var wt=()=>n(976792);const yt=(0,o().YK)({connectedBadge:{defaultMessage:"Connected",id:"cursor.connectedBadge"}});function Mt(e){const{module:t}=e,n=(0,o().tz)();return(0,wt().q8)(t)?(0,d.jsx)(Ve().E,{color:"green",content:n.formatMessage(yt.connectedBadge)}):null}function xt(e){const{description:t}=e,n=(0,l().IS)((()=>({container:{paddingInlineStart:10},textWrapper:{paddingBlock:6}})),[]);return(0,d.jsx)(a().Y1,{direction:"horizontal",align:"center-left",gap:8,style:n.container,children:(0,d.jsx)("div",{style:n.textWrapper,children:(0,d.jsx)(s().D,{styleKey:"bodyRegular",colorVariant:"primary",children:t})})})}const kt=(0,o().YK)({createAgent:{defaultMessage:"Created a Cursor run",id:"workflow.run.effect.cursor.createAgent.description"},addFollowup:{defaultMessage:"Added a follow-up to a Cursor run",id:"workflow.run.effect.cursor.addFollowup.description"},getAgent:{defaultMessage:"Retrieved a Cursor run status",id:"workflow.run.effect.cursor.getAgent.description"},listRepositories:{defaultMessage:"Listed accessible repositories",id:"workflow.run.effect.cursor.listRepositories.description"},createAgentLoading:{defaultMessage:"Creating a Cursor run",id:"workflow.run.effect.cursor.createAgent.loading"},addFollowupLoading:{defaultMessage:"Adding a follow-up to a Cursor run",id:"workflow.run.effect.cursor.addFollowup.loading"},getAgentLoading:{defaultMessage:"Retrieving a Cursor run status",id:"workflow.run.effect.cursor.getAgent.loading"},listRepositoriesLoading:{defaultMessage:"Listing accessible repositories",id:"workflow.run.effect.cursor.listRepositories.loading"}}),bt={triggers:{},getSecondaryLabel:e=>(0,d.jsx)(Mt,{module:e}),effect:{"cursor.createAgent":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?kt.createAgentLoading:kt.createAgent)},"cursor.addFollowup":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?kt.addFollowupLoading:kt.addFollowup)},"cursor.getAgent":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?kt.getAgentLoading:kt.getAgent)},"cursor.listRepositories":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?kt.listRepositoriesLoading:kt.listRepositories)}},ModuleConfiguration:function(e){const{module:t}=e,n=(0,o().tz)(),i=v().d.getDescription(t,n);return(0,d.jsx)(xt,{description:i})}};const Ct=(0,o().YK)({search:{defaultMessage:"Searched Discord",id:"workflow.run.effect.discord.search.description"},searchLoading:{defaultMessage:"Searching Discord",id:"workflow.run.effect.discord.search.loading"}}),St={triggers:{},effect:{"discord.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Ct.searchLoading:Ct.search)}},ModuleConfiguration:function(e){const t=(0,i.useCallback)((e=>({type:"discord",moduleType:"discord",identifier:e,actions:["search"]})),[]);return(0,d.jsx)(k,{...e,moduleName:"Discord",buildPermission:t})}},jt=(0,o().YK)({getFileName:{defaultMessage:"Retrieved the name of a file",id:"workflow.run.effect.files.getFileName.description"},getFileContent:{defaultMessage:"Retrieved the content of a file",id:"workflow.run.effect.files.getFileContent.description"},getFileUrl:{defaultMessage:"Retrieved the URL of a file",id:"workflow.run.effect.files.getFileUrl.description"},getFileNameLoading:{defaultMessage:"Retrieving the name of a file",id:"workflow.run.effect.files.getFileName.loading"},getFileContentLoading:{defaultMessage:"Retrieving the content of a file",id:"workflow.run.effect.files.getFileContent.loading"},getFileUrlLoading:{defaultMessage:"Retrieving the URL of a file",id:"workflow.run.effect.files.getFileUrl.loading"}}),At={triggers:{},effect:{"files.getFileName":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?jt.getFileNameLoading:jt.getFileName)},"files.getFileContent":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?jt.getFileContentLoading:jt.getFileContent)},"files.getFileUrl":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?jt.getFileUrlLoading:jt.getFileUrl)}}},It=(0,o().YK)({readDir:{defaultMessage:"Read directory",id:"workflow.run.effect.fs.readDir.description"},readDirLoading:{defaultMessage:"Reading directory",id:"workflow.run.effect.fs.readDir.loading"},readFiles:{defaultMessage:"Read files",id:"workflow.run.effect.fs.readFiles.description"},readFilesLoading:{defaultMessage:"Reading files",id:"workflow.run.effect.fs.readFiles.loading"}}),Tt={triggers:{},effect:{"fs.readDir":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?It.readDirLoading:It.readDir)},"fs.readFiles":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?It.readFilesLoading:It.readFiles)}}},Dt=(0,o().YK)({runAsTitle:{defaultMessage:"Run as",id:"workflows.modules.github.runAs.title"},runAsDescription:{defaultMessage:"Github searches run using this user’s connected account.",id:"workflows.modules.github.runAs.description"},runAsCurrentUser:{defaultMessage:"Current user",id:"workflows.modules.github.runAs.currentUser"}});const Pt=(0,o().YK)({search:{defaultMessage:"Searched Github",id:"workflow.run.effect.github.search.description"},searchLoading:{defaultMessage:"Searching Github",id:"workflow.run.effect.github.search.loading"},loadPR:{defaultMessage:"Loaded GitHub pull request",id:"workflow.run.effect.github.loadPR.description"},loadPRLoading:{defaultMessage:"Loading GitHub pull request",id:"workflow.run.effect.github.loadPR.loading"},loadIssue:{defaultMessage:"Loaded GitHub issue",id:"workflow.run.effect.github.loadIssue.description"},loadIssueLoading:{defaultMessage:"Loading GitHub issue",id:"workflow.run.effect.github.loadIssue.loading"},loadCommit:{defaultMessage:"Loaded GitHub commit",id:"workflow.run.effect.github.loadCommit.description"},loadCommitLoading:{defaultMessage:"Loading GitHub commit",id:"workflow.run.effect.github.loadCommit.loading"},loadFile:{defaultMessage:"Loaded GitHub file",id:"workflow.run.effect.github.loadFile.description"},loadFileLoading:{defaultMessage:"Loading GitHub file",id:"workflow.run.effect.github.loadFile.loading"},grepCode:{defaultMessage:"Searched GitHub code",id:"workflow.run.effect.github.grepCode.description"},grepCodeLoading:{defaultMessage:"Searching GitHub code",id:"workflow.run.effect.github.grepCode.loading"},lsDirectory:{defaultMessage:"Listed GitHub directory",id:"workflow.run.effect.github.lsDirectory.description"},lsDirectoryLoading:{defaultMessage:"Listing GitHub directory",id:"workflow.run.effect.github.lsDirectory.loading"}}),Rt={triggers:{},effect:{"github.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Pt.searchLoading:Pt.search)},"github.loadPR":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Pt.loadPRLoading:Pt.loadPR)},"github.loadIssue":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Pt.loadIssueLoading:Pt.loadIssue)},"github.loadCommit":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Pt.loadCommitLoading:Pt.loadCommit)},"github.loadFile":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Pt.loadFileLoading:Pt.loadFile)},"github.grepCode":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Pt.grepCodeLoading:Pt.grepCode)},"github.lsDirectory":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Pt.lsDirectoryLoading:Pt.lsDirectory)}},ModuleConfiguration:function(e){const{module:t,saveModule:n,userHasEditAccess:l}=e,f=(0,o().tz)(),m=(0,r().T)();return(0,i.useEffect)((()=>{if(!l||!m)return;(t.permissions??[]).some((e=>"github"===e.type))||n({...t,permissions:[{type:"github",moduleType:"github",identifier:m,actions:["search"]}]})}),[m,t,n,l]),(0,d.jsx)(M,{moduleValue:t,children:(0,d.jsx)(a().Y1,{direction:"vertical",gap:16,width:"fill",children:(0,d.jsxs)(c,{isDisabled:!l,children:[(0,d.jsxs)(u,{children:[(0,d.jsx)(s().D,{colorVariant:"primary",styleKey:"bodyRegular",children:f.formatMessage(Dt.runAsTitle)}),(0,d.jsx)(s().D,{colorVariant:"secondary",styleKey:"bodySmRegular",children:f.formatMessage(Dt.runAsDescription)})]}),(0,d.jsx)(g,{children:(0,d.jsx)(s().D,{colorVariant:"primary",styleKey:"bodyRegular",children:f.formatMessage(Dt.runAsCurrentUser)})})]})})})}};const Lt=(0,o().YK)({search:{defaultMessage:"Searched Gmail",id:"workflow.run.effect.gmail.search.description"},searchLoading:{defaultMessage:"Searching Gmail",id:"workflow.run.effect.gmail.search.loading"},loadThread:{defaultMessage:"Loaded Gmail thread",id:"workflow.run.effect.gmail.loadThread.description"},loadThreadLoading:{defaultMessage:"Loading Gmail thread",id:"workflow.run.effect.gmail.loadThread.loading"},query:{defaultMessage:"Queried Gmail",id:"workflow.run.effect.gmail.query.description"},queryLoading:{defaultMessage:"Querying Gmail",id:"workflow.run.effect.gmail.query.loading"}}),Et={triggers:{},effect:{"gmail.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Lt.searchLoading:Lt.search)},"gmail.loadThread":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Lt.loadThreadLoading:Lt.loadThread)},"gmail.query":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Lt.queryLoading:Lt.query)}},ModuleConfiguration:function(e){const t=(0,i.useCallback)((e=>({type:"gmail",moduleType:"gmail",identifier:e,actions:["search"]})),[]);return(0,d.jsx)(k,{...e,moduleName:"Gmail",buildPermission:t})}};const Wt=(0,o().YK)({search:{defaultMessage:"Searched Google Calendar",id:"workflow.run.effect.googleCalendar.search.description"},searchLoading:{defaultMessage:"Searching Google Calendar",id:"workflow.run.effect.googleCalendar.search.loading"},query:{defaultMessage:"Queried Google Calendar",id:"workflow.run.effect.googleCalendar.query.description"},queryLoading:{defaultMessage:"Querying Google Calendar",id:"workflow.run.effect.googleCalendar.query.loading"}}),Nt={triggers:{},effect:{"googleCalendar.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Wt.searchLoading:Wt.search)},"googleCalendar.query":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Wt.queryLoading:Wt.query)}},ModuleConfiguration:function(e){const t=(0,i.useCallback)((e=>({type:"googleCalendar",moduleType:"googleCalendar",identifier:e,actions:["search"]})),[]);return(0,d.jsx)(k,{...e,moduleName:"Google Calendar",buildPermission:t})}};const Ut=(0,o().YK)({search:{defaultMessage:"Searched Google Drive",id:"workflow.run.effect.googleDrive.search.description"},searchLoading:{defaultMessage:"Searching Google Drive",id:"workflow.run.effect.googleDrive.search.loading"},loadFile:{defaultMessage:"Loaded Google Drive file",id:"workflow.run.effect.googleDrive.loadFile.description"},loadFileLoading:{defaultMessage:"Loading Google Drive file",id:"workflow.run.effect.googleDrive.loadFile.loading"}}),Bt={triggers:{},effect:{"googleDrive.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Ut.searchLoading:Ut.search)},"googleDrive.loadFile":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Ut.loadFileLoading:Ut.loadFile)}},ModuleConfiguration:function(e){const t=(0,i.useCallback)((e=>({type:"googleDrive",moduleType:"googleDrive",identifier:e,actions:["search"]})),[]);return(0,d.jsx)(k,{...e,moduleName:"Google Drive",buildPermission:t})}},Vt=(0,o().YK)({generate:{defaultMessage:"Generate image",id:"workflow.run.effect.images.generate.description"},generateLoading:{defaultMessage:"Generating image",id:"workflow.run.effect.images.generate.loading"}}),_t={triggers:{},effect:{"images.generate":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Vt.generateLoading:Vt.generate)}}};const Ft=(0,o().YK)({search:{defaultMessage:"Searched Jira",id:"workflow.run.effect.jira.search.description"},searchLoading:{defaultMessage:"Searching Jira",id:"workflow.run.effect.jira.search.loading"},loadIssue:{defaultMessage:"Loaded Jira issue",id:"workflow.run.effect.jira.loadIssue.description"},loadIssueLoading:{defaultMessage:"Loading Jira issue",id:"workflow.run.effect.jira.loadIssue.loading"}}),Ot={triggers:{},effect:{"jira.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Ft.searchLoading:Ft.search)},"jira.loadIssue":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Ft.loadIssueLoading:Ft.loadIssue)}},ModuleConfiguration:function(e){const t=(0,i.useCallback)((e=>({type:"jira",moduleType:"jira",identifier:e,actions:["search"]})),[]);return(0,d.jsx)(k,{...e,moduleName:"Jira",buildPermission:t})}};const zt=(0,o().YK)({search:{defaultMessage:"Searched Linear",id:"workflow.run.effect.linear.search.description"},searchLoading:{defaultMessage:"Searching Linear",id:"workflow.run.effect.linear.search.loading"},loadIssue:{defaultMessage:"Loaded Linear issue",id:"workflow.run.effect.linear.loadIssue.description"},loadIssueLoading:{defaultMessage:"Loading Linear issue",id:"workflow.run.effect.linear.loadIssue.loading"}}),Kt={triggers:{},effect:{"linear.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?zt.searchLoading:zt.search)},"linear.loadIssue":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?zt.loadIssueLoading:zt.loadIssue)}},ModuleConfiguration:function(e){const t=(0,i.useCallback)((e=>({type:"linear",moduleType:"linear",identifier:e,actions:["search"]})),[]);return(0,d.jsx)(k,{...e,moduleName:"Linear",buildPermission:t})}};n(803949);var Yt=()=>n(705464);n(941795);const Ht=(0,o().YK)({moreCount:{id:"multiple.moreCount",defaultMessage:"{count, plural, one {# more} other {# more}}"}});function qt(e){const{separator:t="and",limit:n,noneContent:r,children:a}=e,s=(0,i.useMemo)((()=>i.Children.toArray(a)),[a]);if(0===s.length)return r?i.isValidElement(r)?r:(0,d.jsx)("span",{children:r}):null;if(1===s.length){const e=s[0];return i.isValidElement(e)?e:(0,d.jsx)("span",{children:e})}const l=n&&s.length>n?s.slice(0,n):s,c=n&&s.length>n?s.length-n:0;if("none"===t)return(0,d.jsxs)(d.Fragment,{children:[l,c>0?(0,d.jsxs)("span",{children:[" (",(0,d.jsx)(o().sA,{...Ht.moreCount,values:{count:c}}),")"]}):void 0]});if("comma"===t){const e=c>0?[...l,(0,d.jsx)(o().sA,{...Ht.moreCount,values:{count:c}},"more")]:l;return(0,d.jsx)(d.Fragment,{children:e.map(((e,t)=>(0,d.jsxs)(i.Fragment,{children:[t>0?", ":void 0,e]},t)))})}const u="and"===t?"conjunction":"disjunction";if(c>0){const e=[...l.map(((e,t)=>(0,d.jsx)(i.Fragment,{children:e},t))),(0,d.jsx)(o().sA,{...Ht.moreCount,values:{count:c}},"more")];return(0,d.jsx)(o().dT,{value:e,type:u})}const g=l.map(((e,t)=>(0,d.jsx)(i.Fragment,{children:e},t)));return(0,d.jsx)(o().dT,{value:g,type:u})}var $t=()=>n(933922),Gt=()=>n(756117),Qt=()=>n(395361),Jt=()=>n(30537),Zt=()=>n(62900),Xt=()=>n(537193);const en={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.12 15.25 11.75",svg:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("path",{d:"M5.5 6.75a.5.5 0 0 0 0 1h3.6a.5.5 0 0 0 0-1zM5 9.25a.5.5 0 0 1 .5-.5h1.8a.5.5 0 0 1 0 1H5.5a.5.5 0 0 1-.5-.5m8.425.65a1.575 1.575 0 1 0 0-3.15 1.575 1.575 0 0 0 0 3.15"}),(0,d.jsx)("path",{d:"M4.5 4.125A2.125 2.125 0 0 0 2.375 6.25v7.5c0 1.174.951 2.125 2.125 2.125h11a2.125 2.125 0 0 0 2.125-2.125v-7.5A2.125 2.125 0 0 0 15.5 4.125zM3.625 6.25c0-.483.392-.875.875-.875h11c.483 0 .875.392.875.875v7.5a.875.875 0 0 1-.875.875h-11a.875.875 0 0 1-.875-.875z"})]})},tn=(0,G().wt)("mail",en,"default");var nn=()=>n(372604),on=()=>n(995847),rn=()=>n(933117),an=()=>n(272630);const sn=(0,o().YK)({fieldFrom:{id:"workflow.mail.filter.field.from",defaultMessage:"From"},fieldTo:{id:"workflow.mail.filter.field.to",defaultMessage:"To"},fieldSubject:{id:"workflow.mail.filter.field.subject",defaultMessage:"Subject"},fieldBody:{id:"workflow.mail.filter.field.body",defaultMessage:"Body"},fieldDomain:{id:"workflow.mail.filter.field.domain",defaultMessage:"Domain"},operatorContains:{id:"workflow.mail.filter.operator.contains",defaultMessage:"Contains"},operatorDoesNotContain:{id:"workflow.mail.filter.operator.doesNotContain",defaultMessage:"Does not contain"},operatorIs:{id:"workflow.mail.filter.operator.is",defaultMessage:"Is"},operatorIsNot:{id:"workflow.mail.filter.operator.isNot",defaultMessage:"Is not"},operatorStartsWith:{id:"workflow.mail.filter.operator.startsWith",defaultMessage:"Starts with"},operatorEndsWith:{id:"workflow.mail.filter.operator.endsWith",defaultMessage:"Ends with"},operatorIsEmpty:{id:"workflow.mail.filter.operator.isEmpty",defaultMessage:"Is empty"},operatorIsNotEmpty:{id:"workflow.mail.filter.operator.isNotEmpty",defaultMessage:"Is not empty"},addFilter:{id:"workflow.mail.filter.addFilter",defaultMessage:"Add filter"},valuePlaceholder:{id:"workflow.mail.filter.valuePlaceholder",defaultMessage:"Enter value..."},removeFilterAriaLabel:{id:"workflow.mail.filter.removeFilterAriaLabel",defaultMessage:"Remove filter"},backButtonAriaLabel:{id:"workflow.mail.filter.backButtonAriaLabel",defaultMessage:"Back"},doneButton:{id:"workflow.mail.filter.doneButton",defaultMessage:"Done"},operatorLabel:{id:"workflow.mail.filter.operatorLabel",defaultMessage:"Operator"},valueLabel:{id:"workflow.mail.filter.valueLabel",defaultMessage:"Value"}}),ln=["from","to","subject","body","domain"],dn=["string_is","string_is_not","string_contains","string_does_not_contain"];function cn(e,t){switch(e){case"from":return t.formatMessage(sn.fieldFrom);case"to":return t.formatMessage(sn.fieldTo);case"subject":return t.formatMessage(sn.fieldSubject);case"body":return t.formatMessage(sn.fieldBody);case"domain":return t.formatMessage(sn.fieldDomain);default:return e}}function un(e){const{operator:t,intl:n}=e;switch(t){case"string_contains":return n.formatMessage(sn.operatorContains);case"string_does_not_contain":return n.formatMessage(sn.operatorDoesNotContain);case"string_is":return n.formatMessage(sn.operatorIs);case"string_is_not":return n.formatMessage(sn.operatorIsNot);case"string_starts_with":return n.formatMessage(sn.operatorStartsWith);case"string_ends_with":return n.formatMessage(sn.operatorEndsWith);case"is_empty":return n.formatMessage(sn.operatorIsEmpty);case"is_not_empty":return n.formatMessage(sn.operatorIsNotEmpty);default:return t}}function gn(e){return"is_empty"!==e&&"is_not_empty"!==e}function fn(e){return(null==e?void 0:e.trim())||""}function mn(e){const{filters:t,onChange:n}=e,r=(0,o().tz)(),[a,l]=(0,i.useState)(null),c=(0,i.useMemo)((()=>new Set((t||[]).map((e=>e.field)))),[t]),u=(0,i.useMemo)((()=>ln.filter((e=>!c.has(e)))),[c]),g=(0,i.useCallback)((e=>{const o=[...t||[],{field:e,operator:"string_contains",value:{type:"exact",value:void 0}}];n(o),l(o.length-1)}),[t,n]),f=(0,i.useCallback)((e=>{const o=[...t||[]];o.splice(e,1),n(o.length>0?o:void 0)}),[t,n]),m=(0,i.useCallback)(((e,o)=>{const i=[...t||[]];i[e]=o,n(i)}),[t,n]);return(0,d.jsxs)(d.Fragment,{children:[null==t?void 0:t.map(((e,t)=>(0,d.jsx)(pn,{filter:e,onChange:e=>m(t,e),onRemove:()=>f(t),isInitiallyOpen:a===t,onClose:()=>l(null)},e.field))),u.length>0?(0,d.jsx)(rn().A,{items:u,selectedItem:void 0,onSelect:g,getKey:e=>e,renderItem:e=>(0,d.jsx)(N().A,{title:cn(e.value,r),...e}),renderOrigin:e=>(0,d.jsx)(H().p,{...e,iconLeading:{icon:V().plusIcon,size:"xs"},size:"sm",style:{border:"1px solid transparent",borderRadius:8,padding:"6px 8px",width:"100%",justifyContent:"flex-start",minHeight:38},children:(0,d.jsx)(s().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:r.formatMessage(sn.addFilter)})}),menuTypeOverride:(0,E().PK)()}):void 0]})}function pn(e){const{filter:t,onChange:n,onRemove:r,isInitiallyOpen:a,onClose:s}=e,c=(0,o().tz)(),[u,g]=(0,i.useState)(!1),m=i.useRef(null);i.useEffect((()=>{a&&m.current&&m.current.setOpen(!0)}),[a]);const p=(0,l().eP)(),h=(0,l().IS)((()=>({rowButton:{alignItems:"center",background:f().Tj.background.primary,border:`1px solid ${f().Tj.border.secondary}`,borderRadius:8,display:"flex",gap:8,padding:"6px 8px",width:"100%",justifyContent:"space-between",minHeight:38},rowButtonHovered:{background:f().Tj.background.secondaryTranslucent},rowButtonPressed:{background:(0,O().yZ)({color:f().Tj.background.secondaryTranslucent,mode:p})},rowContent:{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0},iconWrapper:{alignItems:"center",background:f().Tj.background.secondaryTranslucent,borderRadius:6,display:"flex",height:28,justifyContent:"center",width:28,flex:"none"},display:{display:"flex",alignItems:"center",flex:1,minWidth:0,flexWrap:"wrap",gap:6},fieldName:{fontWeight:500},summaryText:{color:f().Tj.text.secondary},removeButton:{flex:"none",marginInlineStart:8}})),[p]),v=cn(t.field,c),w=function(e,t){var n;const o=un({operator:e.operator,intl:t}).toLowerCase();if("is_empty"===e.operator||"is_not_empty"===e.operator)return o;const i=null===(n=e.value)||void 0===n?void 0:n.value;return i?`${o} "${i}"`:o}(t,c),y=function(e){switch(e){case"from":case"to":case"domain":return Xt().b;case"subject":case"body":return nn().U;default:return tn}}(t.field),M=(0,i.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),r()}),[r]),x=(0,i.useCallback)((()=>{null==s||s()}),[s]);return(0,d.jsx)(z().A,{ref:m,popupType:Jt().n.Popup,onClose:x,renderOrigin:e=>(0,d.jsxs)(H().p,{...(0,$e().A)(e),size:"sm",style:h.rowButton,hoveredStyle:h.rowButtonHovered,pressedStyle:h.rowButtonPressed,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:[(0,d.jsxs)("div",{style:h.rowContent,children:[(0,d.jsx)("div",{style:h.iconWrapper,children:y({width:16,height:16})}),(0,d.jsxs)("div",{style:h.display,children:[(0,d.jsx)("span",{style:h.fieldName,children:v}),(0,d.jsx)("span",{style:h.summaryText,children:w})]})]}),(0,d.jsx)(Gt().A,{visible:u,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,d.jsx)(te().A,{icon:on().xMarkSmallIcon,onClick:M,ariaLabel:c.formatMessage(sn.removeFilterAriaLabel),style:{...h.removeButton,visibility:u?"visible":"hidden"}})})]}),render:e=>(0,d.jsx)(hn,{filter:t,onChange:n,onClose:()=>{e.close(),x()},onRemove:()=>{e.close(),x(),r()},intl:c})})}function hn(e){var t,n,o;const{filter:r,onChange:a,intl:s,onClose:c,onRemove:u}=e,g=(0,i.useRef)(null===(t=r.value)||void 0===t?void 0:t.value),m=(0,i.useRef)(),p=(0,l().IS)((()=>({container:{padding:12,display:"flex",flexDirection:"column",gap:12,minWidth:320,maxWidth:400},header:{display:"flex",alignItems:"center",gap:8,paddingBottom:8,borderBottom:`1px solid ${f().Tj.border.secondary}`},backButton:{padding:4},headerTitle:{flex:1,fontSize:14,fontWeight:$().Wy.medium},doneButton:{color:f().Tj.blue.text.accentPrimary,fontSize:14,fontWeight:$().Wy.medium,cursor:"pointer",background:"none",border:"none",padding:"4px 8px"},row:{display:"flex",flexDirection:"column",gap:8},label:{fontSize:12,color:f().Tj.text.tertiary,fontWeight:$().Wy.medium,textTransform:"uppercase",letterSpacing:"0.5px"}})),[]),h=(0,i.useCallback)((e=>{const t=!gn(e);a({field:r.field,operator:e,value:t?{type:"exact",value:void 0}:r.value}),t&&(g.current=void 0)}),[r,a]),v=(0,i.useCallback)((e=>{g.current=e,a({field:r.field,operator:r.operator,value:{type:"exact",value:e}})}),[r,a]),w=gn(r.operator),y=(0,i.useCallback)((e=>{var t,n;null===(t=m.current)||void 0===t||t.call(m);const o=e??fn(null===(n=r.value)||void 0===n?void 0:n.value);gn(r.operator)&&!o?u():c()}),[r.operator,null===(n=r.value)||void 0===n?void 0:n.value,c,u]);return(0,d.jsxs)("div",{style:p.container,children:[(0,d.jsxs)("div",{style:p.header,children:[(0,d.jsx)(te().A,{icon:Zt().arrowStraightLeftSmallIcon,onClick:()=>y(),ariaLabel:s.formatMessage(sn.backButtonAriaLabel),style:p.backButton}),(0,d.jsx)("div",{style:p.headerTitle,children:cn(r.field,s)}),(0,d.jsx)("button",{type:"button",style:p.doneButton,onClick:()=>y(),children:s.formatMessage(sn.doneButton)})]}),(0,d.jsxs)("div",{style:p.row,children:[(0,d.jsx)("div",{style:p.label,children:s.formatMessage(sn.operatorLabel)}),(0,d.jsx)(rn().A,{items:dn,selectedItem:r.operator,onSelect:h,getKey:e=>e,width:"100%",renderItem:e=>(0,d.jsx)(N().A,{title:un({operator:e.value,intl:s}),...e}),renderOrigin:e=>(0,d.jsx)(an().A,{...e,title:un({operator:r.operator,intl:s}),placeholder:"",disableMargins:!0}),menuTypeOverride:(0,E().PK)()})]}),w?(0,d.jsxs)("div",{style:p.row,children:[(0,d.jsx)("div",{style:p.label,children:s.formatMessage(sn.valueLabel)}),(0,d.jsx)(vn,{value:null===(o=r.value)||void 0===o?void 0:o.value,onChange:v,onSubmit:y,onRegisterFlush:e=>{m.current=e}})]}):void 0]})}function vn(e){const{value:t,onChange:n,onSubmit:r,onRegisterFlush:a}=e,s=(0,o().tz)(),[c,u]=(0,i.useState)(t??""),g=(0,Qt().Y)((e=>{const t=e.trim();n(t||void 0)}));(0,i.useEffect)((()=>(a&&a((()=>{var e;null===(e=g.flush)||void 0===e||e.call(g)})),()=>{a&&a((()=>{}))})),[a,g]);const m=(0,i.useCallback)((e=>{u(e.target.value),g(e.target.value)}),[g]),p=(0,i.useCallback)((e=>{if("Enter"===e.key){var t;e.preventDefault(),null===(t=g.flush)||void 0===t||t.call(g);const n=fn(c);null==r||r(n)}}),[g,r,c]),h=(0,i.useCallback)((()=>{u(""),n(void 0)}),[n]),v=(0,l().IS)((()=>({container:{flex:1,minWidth:120},input:{width:"100%",border:`1px solid ${f().Tj.border.secondary}`,borderRadius:6,padding:"4px 10px",fontSize:14}})),[]);return(0,d.jsx)($t().A,{capture:!0,render:e=>(0,d.jsx)("div",{...e,style:v.container,children:(0,d.jsx)(dt().A,{value:c,onChange:m,onKeyDown:p,placeholder:s.formatMessage(sn.valuePlaceholder),showClearButton:!0,onClearButtonClick:h,style:v.input})})})}var wn=()=>n(726637),yn=()=>n(543322),Mn=()=>n(22673),xn=()=>n(94522);function kn(e){const{titleAndIcon:t,rightContent:n}=e;return(0,d.jsxs)(a().Y1,{direction:"horizontal",align:"center",gap:8,padding:"0 0 0 10px",borderRadius:6,height:28,children:[t,(0,d.jsx)(a().Y1,{align:"end",gap:"auto",children:n})]})}function bn(e){const{title:t,icon:n}=e,o=(0,l().IS)((()=>({icon:{height:16,width:16}})),[]);return(0,d.jsxs)(d.Fragment,{children:[n(o.icon),(0,d.jsx)(s().D,{children:t})]})}var Cn=()=>n(222334),Sn=()=>n(407444);const jn=(0,o().YK)({readLabel:{id:"workflows.mail.permissions.read.label",defaultMessage:"Read"},modifyInboxLabel:{id:"workflows.mail.permissions.modifyInbox.label",defaultMessage:"Modify inbox"},modifyInboxSubtitle:{id:"workflows.mail.permissions.modifyInbox.subtitle.v2",defaultMessage:"Archive, trash, label, set reminders, block, and unsubscribe."},draftLabel:{id:"workflows.mail.permissions.draft.label",defaultMessage:"Draft"},sendLabel:{id:"workflows.mail.permissions.send.label",defaultMessage:"Send"},createDraftsIn:{id:"workflows.mail.permissions.draft.createDraftsIn",defaultMessage:"Create drafts in"},notionMail:{id:"workflows.mail.permissions.draft.notionMail",defaultMessage:"Notion Mail"},gmail:{id:"workflows.mail.permissions.draft.gmail",defaultMessage:"Gmail"},requireConfirmation:{id:"workflows.mail.permissions.send.requireConfirmation",defaultMessage:"Require confirmation"},removeAddress:{id:"workflows.mail.permissions.removeAddress",defaultMessage:"Remove address"},confirmSendTitle:{id:"workflows.mail.permissions.confirmSend.title",defaultMessage:"Allow AI to act without your confirmation?"},confirmSendSubtitle:{id:"workflows.mail.permissions.confirmSend.subtitle",defaultMessage:"Allowing AI to send email on your behalf introduces privacy and security risks"},confirmSendConfirm:{id:"workflows.mail.permissions.confirmSend.confirm",defaultMessage:"Allow anyway"},confirmSendCancel:{id:"workflows.mail.permissions.confirmSend.cancel",defaultMessage:"Continue requiring confirmation"}});function An(e){const{client:t,onChange:n,parent:i}=e,r=(0,o().tz)(),a=[{key:"notion_mail",action:()=>{n("notion_mail"),i.close()},render:e=>(0,d.jsx)(N().A,{...e,icon:(0,d.jsx)(L().I,{icon:Yt().notionMailIcon,size:"sm"}),title:r.formatMessage(jn.notionMail),isChecked:"notion_mail"===t})},{key:"gmail",action:()=>{n("gmail"),i.close()},render:e=>(0,d.jsx)(N().A,{...e,icon:(0,d.jsx)(L().I,{icon:Sn().gmailIcon,size:"sm"}),title:r.formatMessage(jn.gmail),isChecked:"gmail"===t})}];return(0,d.jsx)(W().A,{menuType:wn().A.isMobile?E().gu.Modal:E().gu.Popup,children:(0,d.jsx)(U().A,{type:U().O.Vertical,initialFocus:void 0,sections:[{key:"draft-client-options",render:e=>(0,d.jsx)(B().A,{...e}),items:a}]})})}function In(e,t){return"notion_mail"===e?t.formatMessage(jn.notionMail):t.formatMessage(jn.gmail)}function Tn(e){const{open:t,onConfirm:n,onCancel:i}=e,r=(0,o().tz)(),a=(0,l().IS)((()=>({container:{width:300,padding:20,display:"flex",flexDirection:"column",alignItems:"center"},title:{fontSize:17,fontWeight:$().Wy.semibold,color:f().Tj.text.primary,textAlign:"center"},subtitle:{fontSize:14,fontWeight:$().Wy.regular,color:f().Tj.text.secondary,paddingTop:8,textAlign:"center"},buttons:{display:"flex",flexDirection:"column",gap:8,paddingTop:20,width:"100%"},button:{width:"100%"},cancelButton:{width:"100%",display:"flex",justifyContent:"center"}})),[]);return(0,d.jsx)(Te().a,{ariaLabel:r.formatMessage(jn.confirmSendTitle),open:t,onDismiss:i,showCloseIcon:!1,render:()=>(0,d.jsxs)("div",{style:a.container,children:[(0,d.jsx)("div",{style:a.title,children:(0,d.jsx)(o().sA,{...jn.confirmSendTitle})}),(0,d.jsx)("div",{style:a.subtitle,children:(0,d.jsx)(o().sA,{...jn.confirmSendSubtitle})}),(0,d.jsxs)("div",{style:a.buttons,children:[(0,d.jsx)(De().E,{size:"lg",style:a.button,onClick:n,children:(0,d.jsx)(o().sA,{...jn.confirmSendConfirm})}),(0,d.jsx)(H().p,{size:"lg",style:a.cancelButton,onClick:i,children:(0,d.jsx)(o().sA,{...jn.confirmSendCancel})})]})]})})}function Dn(e){const{label:t,subtitle:n,checked:o,onChange:r,disabled:a}=e,s=(0,l().IS)((()=>({row:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",padding:"6px 8px",borderRadius:4,cursor:a?"default":"pointer",opacity:a?.5:1},labelContainer:{display:"flex",flexDirection:"column",gap:2,flex:1,paddingInlineEnd:8},label:{fontSize:14,color:f().Tj.text.primary},subtitle:{fontSize:12,color:f().Tj.text.secondary,lineHeight:1.4},switchContainer:{flexShrink:0,paddingBlockStart:2}})),[a]),c=(0,i.useCallback)((()=>{a||r(!o)}),[a,o,r]);return(0,d.jsxs)("div",{style:s.row,onClick:c,role:"button",tabIndex:a?-1:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),c())},children:[(0,d.jsxs)("div",{style:s.labelContainer,children:[(0,d.jsx)("span",{style:s.label,children:t}),n?(0,d.jsx)("span",{style:s.subtitle,children:n}):void 0]}),(0,d.jsx)("div",{style:s.switchContainer,children:(0,d.jsx)(je().A,{on:o,disabled:a,onClick:e=>{e.stopPropagation(),c()}})})]})}function Pn(e){const{label:t,value:n,onClick:o,onMouseEnter:i,onMouseLeave:r,disabled:a}=e,s=(0,l().IS)((()=>({row:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 8px",borderRadius:4,cursor:a?"default":"pointer",opacity:a?.5:1},label:{fontSize:14,color:f().Tj.text.primary},valueContainer:{display:"flex",alignItems:"center",gap:4},value:{fontSize:14,color:f().Tj.text.secondary}})),[a]);return(0,d.jsxs)("div",{style:s.row,onClick:a?void 0:o,onMouseEnter:i,onMouseLeave:r,role:"button",tabIndex:a?-1:0,onKeyDown:e=>{a||"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),null==o||o())},children:[(0,d.jsx)("span",{style:s.label,children:t}),(0,d.jsxs)("span",{style:s.valueContainer,children:[(0,d.jsx)("span",{style:s.value,children:n}),(0,d.jsx)(L().I,{icon:Cn().arrowChevronSingleRightIcon,size:"xs",colorVariant:"secondary"})]})]})}function Rn(e){const{settings:t,onSettingsChange:n,onRemoveAddress:r,disabled:a}=e,s=(0,o().tz)(),[c,u]=(0,i.useState)(!1),g=(0,l().IS)((()=>({container:{display:"flex",flexDirection:"column",width:272,padding:4},separator:{height:1,background:f().Tj.border.secondary,margin:"4px 0"}})),[]),m=(0,i.useCallback)((e=>{n({...t,modifyInbox:e})}),[t,n]),p=(0,i.useCallback)((e=>{n({...t,draft:{...t.draft,enabled:e}})}),[t,n]),h=(0,i.useCallback)((e=>{n({...t,draft:{...t.draft,client:e}})}),[t,n]),v=(0,i.useCallback)((e=>{n(e?{...t,send:"with_confirmation"}:{...t,send:"disallow"})}),[t,n]),w=(0,i.useCallback)((e=>{e?n({...t,send:"with_confirmation"}):u(!0)}),[t,n]),y=(0,i.useCallback)((()=>{n({...t,send:"without_confirmation"}),u(!1)}),[t,n]),M=(0,i.useCallback)((()=>{u(!1)}),[]),x="disallow"!==t.send,k="with_confirmation"===t.send;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{style:g.container,children:[(0,d.jsx)(Dn,{label:s.formatMessage(jn.modifyInboxLabel),subtitle:s.formatMessage(jn.modifyInboxSubtitle),checked:t.modifyInbox,onChange:m,disabled:a}),(0,d.jsx)("div",{style:g.separator}),(0,d.jsx)(Dn,{label:s.formatMessage(jn.draftLabel),checked:t.draft.enabled,onChange:p,disabled:a}),t.draft.enabled?(0,d.jsx)(z().A,{popupType:wn().A.isMobile?z().z.BottomSheet:z().z.Popup,placementToOrigin:"right",disabled:a,renderOrigin:e=>(0,d.jsx)(Pn,{...e,label:s.formatMessage(jn.createDraftsIn),value:In(t.draft.client,s),disabled:a}),render:e=>(0,d.jsx)(An,{client:t.draft.client,onChange:h,parent:e})}):void 0,(0,d.jsx)("div",{style:g.separator}),(0,d.jsx)(Dn,{label:s.formatMessage(jn.sendLabel),checked:x,onChange:v,disabled:a}),x?(0,d.jsx)(Dn,{label:s.formatMessage(jn.requireConfirmation),checked:k,onChange:w,disabled:a}):void 0,(0,d.jsx)("div",{style:g.separator}),(0,d.jsx)(N().A,{focused:!1,onClick:r,disabled:a||!r,title:s.formatMessage(jn.removeAddress),isRedOnHover:!0})]}),(0,d.jsx)(Tn,{open:c,onConfirm:y,onCancel:M})]})}var Ln=()=>n(803960);function En(e){const{disabled:t,settings:n,onClick:i,onMouseEnter:r,onMouseLeave:a}=e,s=(0,o().tz)(),c=(0,l().eP)(),u=(0,l().IS)((()=>({plainButton:{color:f().Tj.text.secondary,fontSize:12,fontWeight:$().Wy.medium,gap:4},hoveredButton:{background:f().Tj.background.secondaryTranslucent},pressedButton:{background:(0,O().yZ)({color:f().Tj.background.secondaryTranslucent,mode:c})}})),[c]),g=function(e,t){const n=[];if(n.push(t.formatMessage(jn.readLabel)),e.modifyInbox&&n.push(t.formatMessage(jn.modifyInboxLabel).toLowerCase()),e.draft.enabled&&n.push(t.formatMessage(jn.draftLabel).toLowerCase()),"disallow"!==e.send&&n.push(t.formatMessage(jn.sendLabel).toLowerCase()),1===n.length)return n[0];if(2===n.length)return`${n[0]} and ${n[1]}`;const o=n.pop();return`${n.join(", ")} and ${o}`}(n,s);return(0,d.jsx)(H().p,{onClick:i,onMouseEnter:r,onMouseLeave:a,colorPalette:"gray",disabled:t,iconTrailing:t?void 0:{icon:Ln().arrowChevronSingleDownIcon,size:"xs"},style:u.plainButton,hoveredStyle:u.hoveredButton,pressedStyle:u.pressedButton,children:g})}var Wn=()=>n(769864);function Nn(e){const t=(0,it().v3)(),[n,o]=(0,i.useState)([]),[r,a]=(0,i.useState)(!0),[s,l]=(0,i.useState)();return(0,i.useEffect)((()=>{(async function(){a(!0),l(void 0);try{const{spaceId:n}=(0,gt().kI)(e),i=await Wn().callApi({environment:t,eventName:"getUserMailAddressesForWorkflows",data:{spaceId:n}});"success"===i.type?o(i.data.emailAddresses):l("Failed to load email addresses")}catch(n){l("Failed to load email addresses")}finally{a(!1)}})().catch((()=>{l("Failed to load email addresses"),a(!1)}))}),[t,e]),{emailAddresses:n,isLoading:r,error:s}}const Un=(0,o().YK)({addEmailButton:{id:"workflows.mailEmailPicker.addEmailButton",defaultMessage:"Add address"},noEmails:{id:"workflows.mailEmailPicker.noEmails",defaultMessage:"No email addresses found"}});function Bn(e){const{selectedEmailAccountIds:t,workflowDefinitionPointer:n,writeEmailAccountIds:r}=e,a=(0,it().v3)(),{emailAddresses:s,isLoading:c,error:u}=Nn(n),g=(0,i.useMemo)((()=>new(K().A)),[]),m=(0,l().eP)(),p=(0,l().IS)((()=>({button:{width:"100%",paddingInlineStart:10,gap:8},hoveredButton:{background:f().Tj.background.secondaryTranslucent},pressedButton:{background:(0,O().yZ)({color:f().Tj.background.secondaryTranslucent,mode:m})},menuContainer:{width:320,maxHeight:400,overflow:"auto"},loadingContainer:{padding:16,display:"flex",justifyContent:"center",alignItems:"center"},errorContainer:{padding:16,color:f().Tj.text.secondary,fontSize:12}})),[m]),h=(0,i.useCallback)((e=>{const o=t??[];o.includes(e)?r(o.filter((t=>t!==e))):(r([...o,e]),(0,Mn().ik)({environment:a,connected_tool:"mail",workflow_id:n.id,resource_type:"email_address"}))}),[a,t,r,n.id]),v=(0,i.useMemo)((()=>s?s.filter((e=>!t.includes(e.emailAccountId))):[]),[s,t]),w=(0,i.useCallback)((()=>c||u||!v||0===v.length?[]:[{key:"emails",render:e=>(0,d.jsx)(B().A,{topBorder:!1,...e}),items:v.map((e=>({key:e.emailAccountId,render:t=>(0,d.jsx)(N().A,{...t,title:e.displayName?`${e.email} (${e.displayName})`:e.email}),action:()=>{h(e.emailAccountId)}})))}]),[c,u,v,h]),y=(0,i.useCallback)((()=>c?(0,d.jsx)("div",{style:p.loadingContainer,children:(0,d.jsx)(Y().A,{})}):u||!v||0===v.length?(0,d.jsx)("div",{style:p.errorContainer,children:(0,d.jsx)(o().sA,{...Un.noEmails})}):(0,d.jsx)("div",{style:p.menuContainer,children:(0,d.jsx)(U().A,{type:U().O.Vertical,initialFocus:void 0,sections:w()})})),[c,u,v,p.loadingContainer,p.errorContainer,p.menuContainer,w]);return!c&&!u&&s&&s.length>0&&v&&0===v.length?null:(0,d.jsx)(z().A,{buttonPopupStore:g,disabled:c||Boolean(u),originGap:4,placementToOrigin:"bottom",popupType:z().z.Popup,renderOrigin:e=>(0,d.jsx)(H().p,{...e,colorPalette:"gray",iconLeading:{icon:ge().plusSmallIcon,size:"sm"},style:p.button,hoveredStyle:p.hoveredButton,pressedStyle:p.pressedButton,children:(0,d.jsx)(o().sA,{...Un.addEmailButton})}),render:y})}function Vn(e){var t,n,o;const{module:r,saveModule:a,userHasEditAccess:s,workflowDefinitionPointer:l,store:c}=e,u=(0,it().v3)(),g=(0,i.useMemo)((()=>{var e;return(null===(e=r.state)||void 0===e?void 0:e.emailAddresses)??[]}),[null===(t=r.state)||void 0===t?void 0:t.emailAddresses]),f=(0,i.useMemo)((()=>{var e;const t=null===(e=r.state)||void 0===e?void 0:e.selectedEmailAccountIds;return t&&0!==t.length?g.filter((e=>t.includes(e.emailAccountId))):[]}),[g,null===(n=r.state)||void 0===n?void 0:n.selectedEmailAccountIds]),m=(0,i.useMemo)((()=>f.map((e=>e.emailAccountId))),[f]),p=(0,i.useCallback)((e=>(0,yn()._J)(r.state,e.email)),[r.state]),h=(0,i.useCallback)((e=>{var t;const n=(null===(t=r.state)||void 0===t?void 0:t.emailPermissionSettings)??{};a({...r,state:{...r.state,emailPermissionSettings:{...n,[e.email]:e.settings}}})}),[r,a]),v=(0,i.useCallback)((e=>{var t,n;const o=(0,xn().i4)(c);o&&(0,Mn().gn)({environment:u,tool:"mail",workflowId:o});const i=(null===(t=r.state)||void 0===t?void 0:t.selectedEmailAccountIds)??[],s=e.filter((e=>!i.includes(e))),l={...(null===(n=r.state)||void 0===n?void 0:n.emailPermissionSettings)??{}};for(const r of s){const e=g.find((e=>e.emailAccountId===r));e&&!l[e.email]&&(l[e.email]=yn().zy)}a({...r,state:{...r.state,selectedEmailAccountIds:e,emailPermissionSettings:l}})}),[r,a,u,c,g]),w=(0,i.useCallback)((e=>{var t;const n=m.filter((t=>t!==e)),o=g.find((t=>t.emailAccountId===e)),i={...(null===(t=r.state)||void 0===t?void 0:t.emailPermissionSettings)??{}};null!=o&&o.email&&delete i[o.email],a({...r,state:{...r.state,selectedEmailAccountIds:n,emailPermissionSettings:i}})}),[r,a,m,g]),y=(0,i.useMemo)((()=>{const e={};for(const t of g)e[t.emailAccountId]=t.email;return e}),[g]);return null!==(o=r.state)&&void 0!==o&&o.connectionPointer?(0,d.jsxs)(d.Fragment,{children:[f.map((e=>{const t=p({email:e.email});return(0,d.jsx)(kn,{titleAndIcon:(0,d.jsx)(bn,{title:e.email,icon:tn}),rightContent:(0,d.jsx)(z().A,{popupType:wn().A.isMobile?z().z.BottomSheet:z().z.Popup,alignmentToOrigin:"end",renderOrigin:e=>(0,d.jsx)(En,{...e,disabled:!s,settings:t}),render:n=>(0,d.jsx)(Rn,{settings:t,onSettingsChange:t=>h({email:e.email,settings:t}),onRemoveAddress:()=>{n.close(),w(e.emailAccountId)},disabled:!s})})},e.emailAccountId)})),s?(0,d.jsx)("div",{style:{alignSelf:"stretch"},children:(0,d.jsx)(Bn,{selectedEmailAccountIds:m,emailAccountDisplayInfo:y,workflowDefinitionPointer:l,writeEmailAccountIds:v})}):void 0]}):null}var _n=()=>n(960674),Fn=()=>n(687879);function On(e){const{mailModule:t,workflowDefinitionPointer:n,environment:o,workflowStore:r}=e,a=(0,i.useRef)(!1);(0,i.useEffect)((()=>{var e;"mail"===(null==t?void 0:t.type)&&!(null!==(e=t.state)&&void 0!==e&&e.connectionPointer)&&!a.current&&async function(){a.current=!0;try{const{spaceId:i}=(0,gt().kI)(n),a=await o.api.callApi({eventName:"initializeMailModuleConnection",environment:o,data:{spaceId:i}});if("success"===a.type&&"success"===a.data.type&&"mail"===(null==t?void 0:t.type)){var e;const{connectionPointer:n,creatorEmail:i,emailAddresses:s}=a.data,l=r.getDraftData(),d=null==l||null===(e=l.modules)||void 0===e?void 0:e.find((e=>e.id===t.id&&"mail"===e.type)),c="mail"===(null==d?void 0:d.type)?d:t;Fn().saveModule({workflowStore:r,module:{...c,state:{...c.state??{},connectionPointer:n,creatorEmail:i,emailAddresses:s}},environment:o})}}catch(i){}finally{a.current=!1}}().catch((()=>{a.current=!1}))}),[t,n,o,r])}function zn(e){var t;const{workflowDefinitionPointer:n,mailModule:o}=e,{emailAddresses:i}=Nn(n),r="mail"===(null==o?void 0:o.type)?((null===(t=o.state)||void 0===t?void 0:t.emailAddresses)??[]).map((e=>({...e,isDefault:!1}))):[];return i.length>0?i:r}function Kn(e){var t,n,o,i;const{moduleId:r,workflowStore:a,environment:s,allEmailAddresses:l}=e,d=a.getDraftData(),c=null==d||null===(t=d.modules)||void 0===t?void 0:t.find((e=>e.id===r&&"mail"===e.type));if(!c||"mail"!==c.type)return;const u=(null===(n=c.state)||void 0===n?void 0:n.selectedEmailAccountIds)??[],g=new Set(u);null==d||null===(o=d.triggers)||void 0===o||o.forEach((e=>{if(e.moduleId===r){var t,n,o,i;const r="mail.email.received"===(null===(t=e.state)||void 0===t?void 0:t.type)||"mail.email.sent"===(null===(n=e.state)||void 0===n?void 0:n.type)||"mail.email.receivedorsent"===(null===(o=e.state)||void 0===o?void 0:o.type)||"mail.label.applied"===(null===(i=e.state)||void 0===i?void 0:i.type)?e.state.emailAccountIds:void 0;null==r||r.forEach((e=>g.add(e)))}}));const f=l.length>0?l.map((e=>({emailAccountId:e.emailAccountId,email:e.email,displayName:e.displayName}))):null===(i=c.state)||void 0===i?void 0:i.emailAddresses;Fn().saveModule({workflowStore:a,module:{...c,state:{...c.state,selectedEmailAccountIds:g.size>0?Array.from(g):void 0,emailAddresses:f}},environment:s})}function Yn(e){const{emailAccountIds:t,allEmailAddresses:n}=e,o={};return t.forEach((e=>{const t=n.find((t=>t.emailAccountId===e));t&&(o[e]=t.email)})),o}const Hn=(0,o().YK)({loading:{id:"workflows.mailEmailPicker.loading",defaultMessage:"Loading email addresses"},noEmails:{id:"workflows.mailEmailPicker.noEmails",defaultMessage:"No email addresses found"},selectEmail:{id:"workflows.mailEmailPicker.selectEmail",defaultMessage:"Select email address"},multipleEmailsSelected:{id:"workflows.mailEmailPicker.multipleSelected",defaultMessage:"{count, plural, one {# email address} other {# email addresses}}"}});function qn(e){const{selectedEmailAccountIds:t,emailAccountDisplayInfo:n,workflowDefinitionPointer:r,writeEmailAccountIds:a,trigger:s}=e,{emailAddresses:c,isLoading:u,error:g}=Nn(r);(0,i.useEffect)((()=>{u||g||1!==c.length||t&&0!==t.length||a([c[0].emailAccountId])}),[u,g,c,t,a]);const m=(0,i.useMemo)((()=>new(K().A)),[]),p=(0,l().IS)((()=>({menuContainer:{maxHeight:400,overflow:"auto"},loadingContainer:{padding:16,display:"flex",justifyContent:"center",alignItems:"center"},errorContainer:{padding:16,color:f().Tj.text.secondary}})),[]),h=(0,i.useCallback)((e=>{const n=t??[];n.includes(e)?a(n.filter((t=>t!==e))):n.includes(e)||a([...n,e])}),[t,a]),v=(0,i.useCallback)((e=>u||g||!c||0===c.length?[]:[{key:"emails",render:e=>(0,d.jsx)(B().A,{topBorder:!1,...e}),items:c.map((e=>({key:e.emailAccountId,render:n=>{const o=(null==t?void 0:t.includes(e.emailAccountId))??!1;return(0,d.jsx)(N().A,{...n,title:e.email,isChecked:o})},action:()=>{h(e.emailAccountId)}})))}]),[u,g,c,t,h]),w=(0,i.useMemo)((()=>{if(u)return(0,d.jsx)(o().sA,{...Hn.loading});if(g)return(0,d.jsx)(o().sA,{...Hn.noEmails});if(!t||0===t.length)return(0,d.jsx)(o().sA,{...Hn.selectEmail});if(1!==t.length)return(0,d.jsx)(o().sA,{...Hn.multipleEmailsSelected,values:{count:t.length}});{const e=t[0],o=c.find((t=>t.emailAccountId===e));if(o)return o.email;if(null!=n&&n[e])return n[e]}return(0,d.jsx)(o().sA,{...Hn.selectEmail})}),[u,g,t,c,n]),y=(0,i.useCallback)((({close:e})=>u?(0,d.jsx)("div",{style:p.loadingContainer,children:(0,d.jsx)(Y().A,{})}):g||!c||0===c.length?(0,d.jsx)("div",{style:p.errorContainer,children:(0,d.jsx)(o().sA,{...Hn.noEmails})}):(0,d.jsx)("div",{style:p.menuContainer,children:(0,d.jsx)(U().A,{type:U().O.Vertical,initialFocus:void 0,sections:v(e)})})),[u,g,c,p.loadingContainer,p.errorContainer,p.menuContainer,v]),M=s?!(0,gt().n7)(s,"emailAddresses"):!t||0===t.length;return(0,d.jsx)(z().A,{buttonPopupStore:m,disabled:u||Boolean(g),originGap:4,placementToOrigin:"bottom",popupType:z().z.Popup,renderOrigin:e=>(0,d.jsx)(Ge,{buttonPopupEvents:e,needsSetup:M,children:w}),render:y})}var $n=()=>n(782482),Gn=()=>n(245720),Qn=()=>n(352321),Jn=()=>n(449279),Zn=()=>n(791177),Xn=()=>n(784892),eo=()=>n(778078),to=()=>n(399762),no=()=>n(591779),oo=()=>n(821062);const io=(0,o().YK)({searchPlaceholder:{id:"workflows.mailLabelPicker.searchPlaceholder",defaultMessage:"Select one or more labels…"},noResults:{id:"workflows.mailLabelPicker.noResults",defaultMessage:"No results"},error:{id:"workflows.mailLabelPicker.error",defaultMessage:"Failed to load labels"},noLabels:{id:"workflows.mailLabelPicker.noLabels",defaultMessage:"No labels found"},allLabels:{id:"workflows.mailLabelPicker.allLabels",defaultMessage:"All labels"},labelCount:{id:"workflows.mailLabelPicker.labelCount",defaultMessage:"{count, plural, one {# label} other {# labels}}"},labelsForEmail:{id:"workflows.mailLabelPicker.labelsForEmail",defaultMessage:"Labels for {emailAddress}"},labelTitle:{id:"workflows.mailLabelPicker.labelTitle",defaultMessage:"Labels"}});function ro({selectedLabelNames:e,labels:t,isLoading:n,error:r,writeLabelNames:a,onClose:c}){const u=(0,o().tz)(),{isAndroid:g}=(0,it().Y0)(),[f,m]=(0,i.useState)(""),[p,h]=(0,Zn().$)(),v=(0,l().IS)((()=>({desktopHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px"},loadingSpinner:{display:"flex",justifyContent:"center"}})),[]),{tokenizedInput:w,sections:y}=(0,i.useMemo)((()=>{const n=e??[],i=[];for(const e of n){const o=t.find((t=>t.labelName===e));o&&i.push((0,d.jsx)(to().O,{format:Xn().NY.Medium,isSingle:!0,value:o.labelName,color:"gray",showRemoveButton:!0,onClickRemove:()=>{const t=n.filter((t=>t!==e));a(t)}},o.labelId||e))}const r=(0,d.jsx)(Qn().Ay,{focus:!wn().A.isMobile||void 0,focusAfterAnimation:!0,format:Qn().le.FilterValue,tokens:i,placeholder:u.formatMessage(io.searchPlaceholder),onRemoveLastToken:()=>{if(n.length>0){const e=n.slice(0,n.length-1);a(e)}},onClearButtonClick:()=>{a([]),c()},value:f,onChange:e=>{m(e.target.value)},dontShowBorderBottom:g,showClearButton:!0,tokenWrapStyle:{gap:4},...p}),s=function(e){const{query:t,labels:n,selectedLabelNames:i,writeLabelNames:r}=e,a=n.filter((e=>!i.includes(e.labelName))),s=t?(0,eo().Ay)(t,a,(e=>e.labelName)):a,l=new Map;for(const o of s){const e=l.get(o.emailAddress)??[];e.push(o),l.set(o.emailAddress,e)}if(1===l.size)return[{key:"labels",render:e=>(0,d.jsx)(B().A,{topBorder:!1,...e}),items:Array.from(l.values())[0].map(((e,t)=>({key:e.labelId||e.labelName||`label-${t}`,render:t=>(0,d.jsx)(N().A,{title:(0,d.jsx)(to().O,{format:Xn().NY.Medium,isSingle:!0,value:e.labelName,color:"gray",showRemoveButton:!1}),isTokenTitle:!0,...t}),action:()=>{const t=[...i,e.labelName];r(t)}})))}];const c=[];let u=!0;for(const[g,f]of l.entries()){const e=!u;c.push({key:g,render:t=>(0,d.jsx)(B().A,{...t,title:(0,d.jsx)(o().sA,{...io.labelsForEmail,values:{emailAddress:g}}),topBorder:e}),items:f.map(((e,t)=>({key:e.labelId||e.labelName||`label-${t}`,render:t=>(0,d.jsx)(N().A,{title:(0,d.jsx)(to().O,{format:Xn().NY.Large,isSingle:!0,value:e.labelName,color:"gray",showRemoveButton:!1}),isTokenTitle:!0,...t}),action:()=>{const t=[...i,e.labelName];r(t)}})))}),u=!1}return c}({query:f,labels:t,selectedLabelNames:n,writeLabelNames:a});return{tokenizedInput:r,sections:s}}),[e,t,f,a,u,g,p,c]),M=(0,d.jsx)("div",{style:{paddingInlineStart:4,paddingInlineEnd:4},children:(0,d.jsx)(B().A,{topBorder:!1,desktopStyle:{marginTop:0},children:w})}),x=(0,d.jsxs)("div",{style:v.desktopHeader,children:[(0,d.jsx)(s().D,{styleKey:"bodyMedium",children:(0,d.jsx)(o().sA,{...io.labelTitle})}),(0,d.jsx)(H().p,{onClick:c,size:"sm",colorPalette:"blue",children:(0,d.jsx)(o().sA,{...Gn().W.done})})]}),k=wn().A.isMobile?{menuType:E().gu.Modal,title:(0,d.jsx)(o().sA,{...io.labelTitle}),right:(0,d.jsx)(o().sA,{...Gn().W.done}),onClickRight:c,header:M}:{menuType:E().gu.Popup,maxHeight:400,width:320,header:(0,d.jsxs)(d.Fragment,{children:[x,M]}),disableHeaderBorder:!0,tokenInputHeader:!0};if(n&&0===t.length)return(0,d.jsx)($n().N,{debugName:"WorkflowMailLabelDropdown",capture:!0,onEsc:c,children:(0,d.jsx)(W().A,{...k,children:(0,d.jsx)(B().A,{children:(0,d.jsx)(Jn().u,{title:(0,d.jsx)("div",{style:v.loadingSpinner,children:(0,d.jsx)(Y().k,{})})})})})});if(r)return(0,d.jsx)($n().N,{debugName:"WorkflowMailLabelDropdown",capture:!0,onEsc:c,children:(0,d.jsx)(W().A,{...k,children:(0,d.jsx)(B().A,{children:(0,d.jsx)(Jn().u,{title:(0,d.jsx)(o().sA,{...io.error})})})})});if(!t||0===t.length)return(0,d.jsx)($n().N,{debugName:"WorkflowMailLabelDropdown",capture:!0,onEsc:c,children:(0,d.jsx)(W().A,{...k,children:(0,d.jsx)(B().A,{children:(0,d.jsx)(Jn().u,{title:(0,d.jsx)(o().sA,{...io.noLabels})})})})});const b=y.some((e=>e.items.length>0));return(0,d.jsx)($n().N,{debugName:"WorkflowMailLabelDropdown",capture:!0,onEsc:c,children:(0,d.jsx)(W().A,{...k,children:b?(0,d.jsx)(U().A,{type:U().O.Vertical,initialFocus:0,sections:y,resetInitialFocusOnSectionChangeAlways:!0,onAccept:()=>{m("")},comboboxProps:h}):(0,d.jsx)(B().A,{children:(0,d.jsx)(Jn().u,{title:(0,d.jsx)(o().sA,{...io.noResults})})})})})}function ao(e){const{selectedLabelNames:t,selectedEmailAddresses:n,workflowDefinitionPointer:r,writeLabelNames:a}=e,{labels:s,isLoading:l,error:c}=function(e){const{workflowDefinitionPointer:t,emailAddresses:n}=e,o=(0,it().v3)(),[r,a]=(0,i.useState)([]),[s,l]=(0,i.useState)(!1),[d,c]=(0,i.useState)(),u=(0,no().Bq)(n,oo().A),{spaceId:g}=(0,gt().kI)(t);return(0,i.useEffect)((()=>{a([])}),[u]),(0,i.useEffect)((()=>{if(!n||0===n.length)return a([]),l(!1),void c(void 0);(async function(){if(l(!0),c(void 0),n&&0!==n.length)try{const e=await o.api.callApi({eventName:"getUserMailLabels",environment:o,data:{spaceId:g,emailAddresses:n}});if("success"===e.type){const t=[...e.data.labels].sort(((e,t)=>e.labelName.localeCompare(t.labelName)));a(t)}else c("Failed to load labels")}catch(e){c("Failed to load labels")}finally{l(!1)}else l(!1)})().catch((()=>{c("Failed to load labels"),l(!1)}))}),[o,g,u,n]),{labels:r,isLoading:s,error:d}}({workflowDefinitionPointer:r,emailAddresses:n}),u=(0,i.useMemo)((()=>new(K().A)),[]),g=(0,i.useMemo)((()=>t&&0!==t.length?1===t.length?t[0]:(0,d.jsx)(o().sA,{...io.labelCount,values:{count:t.length}}):(0,d.jsx)(o().sA,{...io.allLabels})),[t]),f=!n||0===n.length||l||Boolean(c);return(0,d.jsx)(z().A,{buttonPopupStore:u,disabled:f,originGap:4,placementToOrigin:"bottom",alignmentToOrigin:"end",popupType:z().z.Popup,renderOrigin:e=>(0,d.jsx)(Ge,{buttonPopupEvents:e,isDisabled:f,dimDisabledAppearance:!0,children:g}),render:e=>(0,d.jsx)(ro,{selectedLabelNames:t,labels:s,isLoading:l,error:c,writeLabelNames:a,onClose:e.close})})}const so=(0,o().YK)({emailReceived:{defaultMessage:"New email received",id:"aiWorkflow.trigger.title.mail.email.received"},emailReceivedDescription:{defaultMessage:"When a new email is received",id:"aiWorkflow.trigger.description.mail.email.received"},emailSent:{defaultMessage:"New email sent",id:"aiWorkflow.trigger.title.mail.email.sent"},emailSentDescription:{defaultMessage:"When a new email is sent",id:"aiWorkflow.trigger.description.mail.email.sent"},emailReceivedAndSent:{defaultMessage:"New email received or sent",id:"aiWorkflow.trigger.title.mail.email.receivedorsent"},emailReceivedAndSentDescription:{defaultMessage:"When a new email is received or sent",id:"aiWorkflow.trigger.description.mail.email.receivedorsent"},labelApplied:{defaultMessage:"Label applied to email",id:"aiWorkflow.trigger.title.mail.label.applied"},labelAppliedDescription:{defaultMessage:"When a label is applied to an email",id:"aiWorkflow.trigger.description.mail.label.applied"},labelAppliedToAccount:{defaultMessage:"When a label is applied to an email in {emailAccount}",id:"aiWorkflow.trigger.description.mail.label.applied.toAccount"},labelAppliedToAccountAnyLabel:{defaultMessage:"When any label is applied to an email in {emailAccount}",id:"aiWorkflow.trigger.description.mail.label.applied.toAccount.anyLabel"},labelAppliedWithLabel:{defaultMessage:"{baseDescription} with label {labelName}",id:"aiWorkflow.trigger.description.mail.label.applied.withLabel"},labelAppliedWithLabels:{defaultMessage:"{baseDescription} with labels: {labelNames}",id:"aiWorkflow.trigger.description.mail.label.applied.withLabels"},emailAddressLabel:{defaultMessage:"Email addresses",id:"aiWorkflow.trigger.config.mail.emailAddress"},emailReceivedToAccount:{defaultMessage:"When a new email is received by {emailAccount}",id:"aiWorkflow.trigger.description.mail.email.received.toAccount"},emailSentToAccount:{defaultMessage:"When a new email is sent from {emailAccount}",id:"aiWorkflow.trigger.description.mail.email.sent.toAccount"},emailReceivedAndSentToAccount:{defaultMessage:"When a new email is received or sent by {emailAccount}",id:"aiWorkflow.trigger.description.mail.email.receivedorsent.toAccount"},emailReceivedAccountCount:{defaultMessage:"{count, plural, one {# email account} other {# email accounts}}",id:"aiWorkflow.trigger.description.mail.email.received.accountCount"},emailReceivedWithFilters:{defaultMessage:"{baseDescription}, {filters}",id:"aiWorkflow.trigger.description.mail.email.received.withFilters"},createDraftWhileRunning:{defaultMessage:"Creating draft...",id:"workflow.run.effect.mail.createDraft.descriptionWhileRunning"},createdDraft:{defaultMessage:"Created draft",id:"workflow.run.effect.mail.createDraft.description"},sendEmailWhileRunning:{defaultMessage:"Sending email...",id:"workflow.run.effect.mail.sendNewEmail.descriptionWhileRunning"},sentEmail:{defaultMessage:"Sent email",id:"workflow.run.effect.mail.sendNewEmail.description"},sendDraftWhileRunning:{defaultMessage:"Sending draft...",id:"workflow.run.effect.mail.sendExistingDraft.descriptionWhileRunning"},sentDraft:{defaultMessage:"Sent draft",id:"workflow.run.effect.mail.sendExistingDraft.description"},searchEmails:{defaultMessage:"Searched emails",id:"workflow.run.effect.mail.searchEmails.description"},searchEmailsWhileRunning:{defaultMessage:"Searching emails",id:"workflow.run.effect.mail.searchEmails.descriptionWhileRunning"},viewThreadContent:{defaultMessage:"Viewed thread content",id:"workflow.run.effect.mail.viewThreadContent.description"},viewThreadContentWhileRunning:{defaultMessage:"Viewing thread content",id:"workflow.run.effect.mail.viewThreadContent.descriptionWhileRunning"},listTools:{defaultMessage:"Listed mail tools",id:"workflow.run.effect.mail.listTools.description"},listToolsWhileRunning:{defaultMessage:"Listing mail tools",id:"workflow.run.effect.mail.listTools.descriptionWhileRunning"},setReadStatus:{defaultMessage:"Updated read status",id:"workflow.run.effect.mail.setReadStatus.description"},setReadStatusWhileRunning:{defaultMessage:"Updating read status...",id:"workflow.run.effect.mail.setReadStatus.descriptionWhileRunning"},archiveThread:{defaultMessage:"Archived thread",id:"workflow.run.effect.mail.archiveThread.description"},archiveThreadWhileRunning:{defaultMessage:"Archiving thread...",id:"workflow.run.effect.mail.archiveThread.descriptionWhileRunning"},trashThread:{defaultMessage:"Moved to trash",id:"workflow.run.effect.mail.trashThread.description"},trashThreadWhileRunning:{defaultMessage:"Moving to trash...",id:"workflow.run.effect.mail.trashThread.descriptionWhileRunning"},moveThreadToInbox:{defaultMessage:"Moved to inbox",id:"workflow.run.effect.mail.moveThreadToInbox.description"},moveThreadToInboxWhileRunning:{defaultMessage:"Moving to inbox...",id:"workflow.run.effect.mail.moveThreadToInbox.descriptionWhileRunning"},markThreadSpam:{defaultMessage:"Marked as spam",id:"workflow.run.effect.mail.markThreadSpam.description"},markThreadSpamWhileRunning:{defaultMessage:"Marking as spam...",id:"workflow.run.effect.mail.markThreadSpam.descriptionWhileRunning"},starThread:{defaultMessage:"Updated star status",id:"workflow.run.effect.mail.starThread.description"},starThreadWhileRunning:{defaultMessage:"Updating star status...",id:"workflow.run.effect.mail.starThread.descriptionWhileRunning"},updateStatus:{defaultMessage:"Updated status",id:"workflow.run.effect.mail.updateStatus.description"},updateStatusWhileRunning:{defaultMessage:"Updating status...",id:"workflow.run.effect.mail.updateStatus.descriptionWhileRunning"},createStatusColumn:{defaultMessage:"Created status property",id:"workflow.run.effect.mail.createStatusColumn.description"},createStatusColumnWhileRunning:{defaultMessage:"Creating status property...",id:"workflow.run.effect.mail.createStatusColumn.descriptionWhileRunning"},blockSender:{defaultMessage:"Blocked sender",id:"workflow.run.effect.mail.blockSender.description"},blockSenderWhileRunning:{defaultMessage:"Blocking sender...",id:"workflow.run.effect.mail.blockSender.descriptionWhileRunning"},unblockSender:{defaultMessage:"Unblocked sender",id:"workflow.run.effect.mail.unblockSender.description"},unblockSenderWhileRunning:{defaultMessage:"Unblocking sender...",id:"workflow.run.effect.mail.unblockSender.descriptionWhileRunning"},unsubscribeSender:{defaultMessage:"Unsubscribed from sender",id:"workflow.run.effect.mail.unsubscribeSender.description"},unsubscribeSenderWhileRunning:{defaultMessage:"Unsubscribing from sender...",id:"workflow.run.effect.mail.unsubscribeSender.descriptionWhileRunning"},applyUserLabels:{defaultMessage:"Applied labels",id:"workflow.run.effect.mail.applyUserLabels.description"},applyUserLabelsWhileRunning:{defaultMessage:"Applying labels...",id:"workflow.run.effect.mail.applyUserLabels.descriptionWhileRunning"},createLabel:{defaultMessage:"Created label",id:"workflow.run.effect.mail.createLabel.description"},createLabelWhileRunning:{defaultMessage:"Creating label...",id:"workflow.run.effect.mail.createLabel.descriptionWhileRunning"},healthCheck:{defaultMessage:"Checked health",id:"workflow.run.effect.mail.healthCheck.description"},healthCheckWhileRunning:{defaultMessage:"Checking health...",id:"workflow.run.effect.mail.healthCheck.descriptionWhileRunning"},listStatusProperties:{defaultMessage:"Listed status properties",id:"workflow.run.effect.mail.listStatusProperties.description"},listStatusPropertiesWhileRunning:{defaultMessage:"Listing status properties...",id:"workflow.run.effect.mail.listStatusProperties.descriptionWhileRunning"},setReminder:{defaultMessage:"Set reminder",id:"workflow.run.effect.mail.setReminder.description"},setReminderWhileRunning:{defaultMessage:"Setting reminder...",id:"workflow.run.effect.mail.setReminder.descriptionWhileRunning"},unsetReminder:{defaultMessage:"Removed reminder",id:"workflow.run.effect.mail.unsetReminder.description"},unsetReminderWhileRunning:{defaultMessage:"Removing reminder...",id:"workflow.run.effect.mail.unsetReminder.descriptionWhileRunning"},listGmailFilters:{defaultMessage:"Listed Gmail filters",id:"workflow.run.effect.mail.listGmailFilters.description"},listGmailFiltersWhileRunning:{defaultMessage:"Listing Gmail filters...",id:"workflow.run.effect.mail.listGmailFilters.descriptionWhileRunning"},createGmailFilter:{defaultMessage:"Created Gmail filter",id:"workflow.run.effect.mail.createGmailFilter.description"},createGmailFilterWhileRunning:{defaultMessage:"Creating Gmail filter...",id:"workflow.run.effect.mail.createGmailFilter.descriptionWhileRunning"},deleteGmailFilter:{defaultMessage:"Deleted Gmail filter",id:"workflow.run.effect.mail.deleteGmailFilter.description"},deleteGmailFilterWhileRunning:{defaultMessage:"Deleting Gmail filter...",id:"workflow.run.effect.mail.deleteGmailFilter.descriptionWhileRunning"},updateGmailFilter:{defaultMessage:"Updated Gmail filter",id:"workflow.run.effect.mail.updateGmailFilter.description"},updateGmailFilterWhileRunning:{defaultMessage:"Updating Gmail filter...",id:"workflow.run.effect.mail.updateGmailFilter.descriptionWhileRunning"},getMailbox:{defaultMessage:"Viewed mailbox",id:"workflow.run.effect.mail.getMailbox.description"},getMailboxWhileRunning:{defaultMessage:"Viewing mailbox",id:"workflow.run.effect.mail.getMailbox.descriptionWhileRunning"},listMailboxViews:{defaultMessage:"Viewed mailbox views",id:"workflow.run.effect.mail.listMailboxViews.description"},listMailboxViewsWhileRunning:{defaultMessage:"Viewing mailbox views",id:"workflow.run.effect.mail.listMailboxViews.descriptionWhileRunning"},runTool:{defaultMessage:"Ran Mail tool",id:"workflow.run.effect.mail.runTool.description"},runToolWhileRunning:{defaultMessage:"Running Mail tool",id:"workflow.run.effect.mail.runTool.descriptionWhileRunning"},runToolWithTitle:{defaultMessage:"Ran Mail tool - {title}",id:"workflow.run.effect.mail.runToolWithTitle.description"},runToolWithTitleWhileRunning:{defaultMessage:"Running Mail tool - {title}",id:"workflow.run.effect.mail.runToolWithTitle.descriptionWhileRunning"},getPrompt:{defaultMessage:"Read Mail handbook",id:"workflow.run.effect.mail.getPrompt.description"},getPromptWhileRunning:{defaultMessage:"Reading Mail handbook",id:"workflow.run.effect.mail.getPrompt.descriptionWhileRunning"},getPromptWithTitle:{defaultMessage:"Read Mail handbook - {title}",id:"workflow.run.effect.mail.getPromptWithTitle.description"},getPromptWithTitleWhileRunning:{defaultMessage:"Reading Mail handbook - {title}",id:"workflow.run.effect.mail.getPromptWithTitle.descriptionWhileRunning"}});function lo(e){const{filter:t}=e,n={from:"from",to:"to",subject:"subject",body:"body"}[t.field]||t.field,o={string_contains:"contains",string_does_not_contain:"does not contain",string_is:"is",string_is_not:"is not",string_starts_with:"starts with",string_ends_with:"ends with",is_empty:"is empty",is_not_empty:"is not empty"}[t.operator]||t.operator;if("is_empty"!==t.operator&&"is_not_empty"!==t.operator){var i;const e=null===(i=t.value)||void 0===i?void 0:i.value;return e?`${n} ${o} "${e}"`:`${n} ${o} (no value)`}return`${n} ${o}`}const co={triggers:{"mail.email.received":{icon:Yt().notionMailIcon,configuration:"minimal",description:so.emailReceived,TriggerOrRunTitle:function(e){const t=(0,o().tz)(),{data:n,titleContext:i}=e;if("run"===i&&null!=n&&n.email){const{from:e,fromName:o}=n.email;if(e){const n=` — from ${o?`${o} (${e})`:e}`;return(0,d.jsxs)("span",{children:[t.formatMessage(so.emailReceived),n]})}}return(0,d.jsx)("span",{children:t.formatMessage(so.emailReceived)})},SpecificTriggerDescription:function(e){const{trigger:t}=e,{state:n}=t,i=(0,o().tz)();if(null==n||!n.emailAccountIds||0===n.emailAccountIds.length)return(0,d.jsx)(o().sA,{...so.emailReceivedDescription});const r=(()=>{const e=[];for(const o of n.emailAccountIds){var t;const i=null===(t=n.emailAccountDisplayInfo)||void 0===t?void 0:t[o];i&&e.push(i)}return e.length>0?(0,d.jsx)(qt,{separator:"or",children:e}):(0,d.jsx)(o().sA,{...so.emailReceivedAccountCount,values:{count:n.emailAccountIds.length}})})(),a=[];n.filters&&n.filters.length>0&&n.filters.forEach(((e,t)=>{const n=lo({filter:e,intl:i});n&&a.push((0,d.jsx)("span",{children:n},t))}));const s=(0,d.jsx)(o().sA,{...so.emailReceivedToAccount,values:{emailAccount:r}});if(a.length>0){const e=(0,d.jsx)(qt,{separator:"and",children:a});return(0,d.jsx)(o().sA,{...so.emailReceivedWithFilters,values:{baseDescription:s,filters:e}})}return s},ConfigurationComponent:function(e){var t;const{trigger:n,workflowDefinitionPointer:r,saveTrigger:a,workflowValue:s,workflowStore:l}=e,c=(0,o().tz)(),u=(0,it().v3)(),g=null===(t=s.modules)||void 0===t?void 0:t.find((e=>e.id===n.moduleId&&"mail"===e.type)),f="mail"===(null==g?void 0:g.type)?g:void 0;On({mailModule:f,workflowDefinitionPointer:r,environment:u,workflowStore:l});const m=zn({workflowDefinitionPointer:r,mailModule:f}),p=(0,i.useCallback)((e=>{var t;const o=Yn({emailAccountIds:e,allEmailAddresses:m}),i={...n,state:{type:"mail.email.received",...n.state,emailAccountIds:e.length>0?e:void 0,emailAccountDisplayInfo:Object.keys(o).length>0?o:null===(t=n.state)||void 0===t?void 0:t.emailAccountDisplayInfo}};a(i),n.moduleId&&Kn({moduleId:n.moduleId,workflowStore:l,environment:u,allEmailAddresses:m})}),[n,a,m,l,u]),h=(0,i.useCallback)((e=>{const t={...n,state:{type:"mail.email.received",...n.state,filters:e}};a(t)}),[n,a]);if(!n.state)throw new Error("Mail trigger state is required");return(0,d.jsxs)(Ke,{children:[(0,d.jsx)(Ye,{label:c.formatMessage(so.emailAddressLabel),children:(0,d.jsx)(qn,{selectedEmailAccountIds:n.state.emailAccountIds,emailAccountDisplayInfo:n.state.emailAccountDisplayInfo,workflowDefinitionPointer:r,writeEmailAccountIds:p,trigger:n})}),(0,d.jsx)(mn,{filters:n.state.filters,onChange:h,workflowDefinitionPointer:r})]})}},"mail.email.sent":{icon:Yt().notionMailIcon,configuration:"minimal",description:so.emailSent,TriggerOrRunTitle:function(e){const t=(0,o().tz)(),{data:n,titleContext:i}=e;if("run"===i&&null!=n&&n.email){const{to:e}=n.email;if(e&&e.length>0){const n=` — to ${e.join(", ")}`;return(0,d.jsxs)("span",{children:[t.formatMessage(so.emailSent),n]})}}return(0,d.jsx)("span",{children:t.formatMessage(so.emailSent)})},SpecificTriggerDescription:function(e){const{trigger:t}=e,{state:n}=t,i=(0,o().tz)();if(null==n||!n.emailAccountIds||0===n.emailAccountIds.length)return(0,d.jsx)(o().sA,{...so.emailSentDescription});const r=(()=>{const e=[];for(const o of n.emailAccountIds){var t;const i=null===(t=n.emailAccountDisplayInfo)||void 0===t?void 0:t[o];i&&e.push(i)}return e.length>0?(0,d.jsx)(qt,{separator:"or",children:e}):(0,d.jsx)(o().sA,{...so.emailReceivedAccountCount,values:{count:n.emailAccountIds.length}})})(),a=[];n.filters&&n.filters.length>0&&n.filters.forEach(((e,t)=>{const n=lo({filter:e,intl:i});n&&a.push((0,d.jsx)("span",{children:n},t))}));const s=(0,d.jsx)(o().sA,{...so.emailSentToAccount,values:{emailAccount:r}});if(a.length>0){const e=(0,d.jsx)(qt,{separator:"and",children:a});return(0,d.jsx)(o().sA,{...so.emailReceivedWithFilters,values:{baseDescription:s,filters:e}})}return s},ConfigurationComponent:function(e){var t;const{trigger:n,workflowDefinitionPointer:r,saveTrigger:a,workflowValue:s,workflowStore:l}=e,c=(0,o().tz)(),u=(0,it().v3)(),g=null===(t=s.modules)||void 0===t?void 0:t.find((e=>e.id===n.moduleId&&"mail"===e.type)),f="mail"===(null==g?void 0:g.type)?g:void 0;On({mailModule:f,workflowDefinitionPointer:r,environment:u,workflowStore:l});const m=zn({workflowDefinitionPointer:r,mailModule:f}),p=(0,i.useCallback)((e=>{var t;const o=Yn({emailAccountIds:e,allEmailAddresses:m}),i={...n,state:{type:"mail.email.sent",...n.state,emailAccountIds:e.length>0?e:void 0,emailAccountDisplayInfo:Object.keys(o).length>0?o:null===(t=n.state)||void 0===t?void 0:t.emailAccountDisplayInfo}};a(i),n.moduleId&&Kn({moduleId:n.moduleId,workflowStore:l,environment:u,allEmailAddresses:m})}),[n,a,m,l,u]),h=(0,i.useCallback)((e=>{const t={...n,state:{type:"mail.email.sent",...n.state,filters:e}};a(t)}),[n,a]);if(!n.state)throw new Error("Mail trigger state is required");return(0,d.jsxs)(Ke,{children:[(0,d.jsx)(Ye,{label:c.formatMessage(so.emailAddressLabel),children:(0,d.jsx)(qn,{selectedEmailAccountIds:n.state.emailAccountIds,emailAccountDisplayInfo:n.state.emailAccountDisplayInfo,workflowDefinitionPointer:r,writeEmailAccountIds:p,trigger:n})}),(0,d.jsx)(mn,{filters:n.state.filters,onChange:h,workflowDefinitionPointer:r})]})}},"mail.email.receivedorsent":{icon:Yt().notionMailIcon,configuration:"minimal",description:so.emailReceivedAndSent,TriggerOrRunTitle:function(e){const t=(0,o().tz)(),{data:n,titleContext:i}=e;if("run"===i&&null!=n&&n.email&&null!=n&&n.userEmail){const{from:e,fromName:o,to:i}=n.email;if(e.toLowerCase()===n.userEmail.toLowerCase()&&i&&i.length>0){const e=` — to ${i.join(", ")}`;return(0,d.jsxs)("span",{children:[t.formatMessage(so.emailReceivedAndSent),e]})}{const n=` — from ${o?`${o} (${e})`:e}`;return(0,d.jsxs)("span",{children:[t.formatMessage(so.emailReceivedAndSent),n]})}}return(0,d.jsx)("span",{children:t.formatMessage(so.emailReceivedAndSent)})},SpecificTriggerDescription:function(e){const{trigger:t}=e,{state:n}=t,i=(0,o().tz)();if(null==n||!n.emailAccountIds||0===n.emailAccountIds.length)return(0,d.jsx)(o().sA,{...so.emailReceivedAndSentDescription});const r=(()=>{const e=[];for(const o of n.emailAccountIds){var t;const i=null===(t=n.emailAccountDisplayInfo)||void 0===t?void 0:t[o];i&&e.push(i)}return e.length>0?(0,d.jsx)(qt,{separator:"or",children:e}):(0,d.jsx)(o().sA,{...so.emailReceivedAccountCount,values:{count:n.emailAccountIds.length}})})(),a=[];n.filters&&n.filters.length>0&&n.filters.forEach(((e,t)=>{const n=lo({filter:e,intl:i});n&&a.push((0,d.jsx)("span",{children:n},t))}));const s=(0,d.jsx)(o().sA,{...so.emailReceivedAndSentToAccount,values:{emailAccount:r}});if(a.length>0){const e=(0,d.jsx)(qt,{separator:"and",children:a});return(0,d.jsx)(o().sA,{...so.emailReceivedWithFilters,values:{baseDescription:s,filters:e}})}return s},ConfigurationComponent:function(e){var t;const{trigger:n,workflowDefinitionPointer:r,saveTrigger:a,workflowValue:s,workflowStore:l}=e,c=(0,o().tz)(),u=(0,it().v3)(),g=null===(t=s.modules)||void 0===t?void 0:t.find((e=>e.id===n.moduleId&&"mail"===e.type)),f="mail"===(null==g?void 0:g.type)?g:void 0;On({mailModule:f,workflowDefinitionPointer:r,environment:u,workflowStore:l});const m=zn({workflowDefinitionPointer:r,mailModule:f}),p=(0,i.useCallback)((e=>{var t;const o=Yn({emailAccountIds:e,allEmailAddresses:m}),i={...n,state:{type:"mail.email.receivedorsent",...n.state,emailAccountIds:e.length>0?e:void 0,emailAccountDisplayInfo:Object.keys(o).length>0?o:null===(t=n.state)||void 0===t?void 0:t.emailAccountDisplayInfo}};a(i),n.moduleId&&Kn({moduleId:n.moduleId,workflowStore:l,environment:u,allEmailAddresses:m})}),[n,a,m,l,u]),h=(0,i.useCallback)((e=>{const t={...n,state:{type:"mail.email.receivedorsent",...n.state,filters:e}};a(t)}),[n,a]);if(!n.state)throw new Error("Mail trigger state is required");return(0,d.jsxs)(Ke,{children:[(0,d.jsx)(Ye,{label:c.formatMessage(so.emailAddressLabel),children:(0,d.jsx)(qn,{selectedEmailAccountIds:n.state.emailAccountIds,emailAccountDisplayInfo:n.state.emailAccountDisplayInfo,workflowDefinitionPointer:r,writeEmailAccountIds:p,trigger:n})}),(0,d.jsx)(mn,{filters:n.state.filters,onChange:h,workflowDefinitionPointer:r})]})}},"mail.label.applied":{icon:Yt().notionMailIcon,configuration:"minimal",description:so.labelApplied,TriggerOrRunTitle:function(e){const t=(0,o().tz)(),{data:n,titleContext:i}=e;return"run"===i&&null!=n&&n.appliedLabel?(0,d.jsxs)("span",{children:[t.formatMessage(so.labelApplied)," ","-"," ",n.appliedLabel]}):(0,d.jsx)("span",{children:t.formatMessage(so.labelApplied)})},SpecificTriggerDescription:function(e){const{trigger:t}=e,{state:n}=t;if(null==n||!n.emailAccountIds||0===n.emailAccountIds.length)return(0,d.jsx)(o().sA,{...so.labelAppliedDescription});const i=(()=>{const e=[];for(const o of n.emailAccountIds){var t;const i=null===(t=n.emailAccountDisplayInfo)||void 0===t?void 0:t[o];i&&e.push(i)}return e.length>0?(0,d.jsx)(qt,{separator:"or",children:e}):(0,d.jsx)(o().sA,{...so.emailReceivedAccountCount,values:{count:n.emailAccountIds.length}})})();if(n.labelNames&&n.labelNames.length>0){const e=(0,d.jsx)(o().sA,{...so.labelAppliedToAccount,values:{emailAccount:i}});return 1===n.labelNames.length?(0,d.jsx)(o().sA,{...so.labelAppliedWithLabel,values:{baseDescription:e,labelName:n.labelNames[0]}}):(0,d.jsx)(o().sA,{...so.labelAppliedWithLabels,values:{baseDescription:e,labelNames:n.labelNames.join(", ")}})}return(0,d.jsx)(o().sA,{...so.labelAppliedToAccountAnyLabel,values:{emailAccount:i}})},ConfigurationComponent:function(e){var t,n;const{trigger:o,saveTrigger:r,workflowDefinitionPointer:a,workflowValue:s,workflowStore:l}=e,c=(0,it().v3)(),u=null===(t=s.modules)||void 0===t?void 0:t.find((e=>e.id===o.moduleId&&"mail"===e.type)),g="mail"===(null==u?void 0:u.type)?u:void 0;On({mailModule:g,workflowDefinitionPointer:a,environment:c,workflowStore:l});const f=zn({workflowDefinitionPointer:a,mailModule:g}),m=(0,i.useCallback)((e=>{var t;const n=Yn({emailAccountIds:e,allEmailAddresses:f});r({...o,state:{type:"mail.label.applied",...o.state,emailAccountIds:e.length>0?e:void 0,emailAccountDisplayInfo:Object.keys(n).length>0?n:null===(t=o.state)||void 0===t?void 0:t.emailAccountDisplayInfo}}),o.moduleId&&Kn({moduleId:o.moduleId,workflowStore:l,environment:c,allEmailAddresses:f})}),[o,r,f,l,c]),p=(0,i.useCallback)((e=>{r({...o,state:{type:"mail.label.applied",...o.state,labelNames:e.length>0?e:void 0}})}),[o,r]);if(!o.state)throw new Error("Mail trigger state is required");const h=(null===(n=o.state.emailAccountIds)||void 0===n?void 0:n.map((e=>{const t=f.find((t=>t.emailAccountId===e));return null==t?void 0:t.email})).filter((e=>void 0!==e)))??[],v=0===h.length;return(0,d.jsxs)(Ke,{children:[(0,d.jsx)(Ye,{label:"Email addresses",children:(0,d.jsx)(qn,{selectedEmailAccountIds:o.state.emailAccountIds,emailAccountDisplayInfo:o.state.emailAccountDisplayInfo,workflowDefinitionPointer:a,writeEmailAccountIds:m,trigger:o})}),(0,d.jsx)(Ye,{label:"Labels",labelColorVariant:v?"disabled":"secondary",children:(0,d.jsx)(ao,{selectedLabelNames:o.state.labelNames,selectedEmailAddresses:h,workflowDefinitionPointer:a,writeLabelNames:p})})]})}}},effect:{"mail.listTools":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>t?e.formatMessage(so.listToolsWhileRunning):e.formatMessage(so.listTools)},"mail.runTool":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t,toolResultStep:n})=>{if(n&&(0,A().gY)(n,"mail.runTool")){if(n.toolName===_n().U.CREATE_OR_UPDATE_DRAFT||n.toolName===_n().U.CREATE_OR_UPDATE_GMAIL_DRAFT)return t?e.formatMessage(so.createDraftWhileRunning):e.formatMessage(so.createdDraft);if(n.toolName===_n().U.SEND_NEW_EMAIL)return t?e.formatMessage(so.sendEmailWhileRunning):e.formatMessage(so.sentEmail);if(n.toolName===_n().U.SEND_EXISTING_DRAFT)return t?e.formatMessage(so.sendDraftWhileRunning):e.formatMessage(so.sentDraft);if(n.toolName===_n().U.SEARCH_EMAILS)return t?e.formatMessage(so.searchEmailsWhileRunning):e.formatMessage(so.searchEmails);if(n.toolName===_n().U.VIEW_THREAD_CONTENT)return t?e.formatMessage(so.viewThreadContentWhileRunning):e.formatMessage(so.viewThreadContent);if(n.toolName===_n().U.SET_READ_STATUS)return t?e.formatMessage(so.setReadStatusWhileRunning):e.formatMessage(so.setReadStatus);if(n.toolName===_n().U.ARCHIVE_THREAD)return t?e.formatMessage(so.archiveThreadWhileRunning):e.formatMessage(so.archiveThread);if(n.toolName===_n().U.TRASH_THREAD)return t?e.formatMessage(so.trashThreadWhileRunning):e.formatMessage(so.trashThread);if(n.toolName===_n().U.MOVE_THREAD_TO_INBOX)return t?e.formatMessage(so.moveThreadToInboxWhileRunning):e.formatMessage(so.moveThreadToInbox);if(n.toolName===_n().U.MARK_THREAD_SPAM)return t?e.formatMessage(so.markThreadSpamWhileRunning):e.formatMessage(so.markThreadSpam);if(n.toolName===_n().U.STAR_THREAD)return t?e.formatMessage(so.starThreadWhileRunning):e.formatMessage(so.starThread);if(n.toolName===_n().U.APPLY_USER_LABELS)return t?e.formatMessage(so.applyUserLabelsWhileRunning):e.formatMessage(so.applyUserLabels);if(n.toolName===_n().U.CREATE_LABEL)return t?e.formatMessage(so.createLabelWhileRunning):e.formatMessage(so.createLabel);if(n.toolName===_n().U.UPDATE_STATUS)return t?e.formatMessage(so.updateStatusWhileRunning):e.formatMessage(so.updateStatus);if(n.toolName===_n().U.CREATE_STATUS_COLUMN)return t?e.formatMessage(so.createStatusColumnWhileRunning):e.formatMessage(so.createStatusColumn);if(n.toolName===_n().U.BLOCK_SENDER)return t?e.formatMessage(so.blockSenderWhileRunning):e.formatMessage(so.blockSender);if(n.toolName===_n().U.UNBLOCK_SENDER)return t?e.formatMessage(so.unblockSenderWhileRunning):e.formatMessage(so.unblockSender);if(n.toolName===_n().U.UNSUBSCRIBE_SENDER)return t?e.formatMessage(so.unsubscribeSenderWhileRunning):e.formatMessage(so.unsubscribeSender);if(n.toolName===_n().U.HEALTH_CHECK)return t?e.formatMessage(so.healthCheckWhileRunning):e.formatMessage(so.healthCheck);if(n.toolName===_n().U.GET_MAILBOX)return t?e.formatMessage(so.getMailboxWhileRunning):e.formatMessage(so.getMailbox);if(n.toolName===_n().U.LIST_MAILBOX_VIEWS)return t?e.formatMessage(so.listMailboxViewsWhileRunning):e.formatMessage(so.listMailboxViews);if(n.toolName===_n().U.LIST_STATUS_PROPERTIES)return t?e.formatMessage(so.listStatusPropertiesWhileRunning):e.formatMessage(so.listStatusProperties);if(n.toolName===_n().U.SET_REMINDER)return t?e.formatMessage(so.setReminderWhileRunning):e.formatMessage(so.setReminder);if(n.toolName===_n().U.UNSET_REMINDER)return t?e.formatMessage(so.unsetReminderWhileRunning):e.formatMessage(so.unsetReminder);if(n.toolName===_n().U.LIST_GMAIL_FILTERS)return t?e.formatMessage(so.listGmailFiltersWhileRunning):e.formatMessage(so.listGmailFilters);if(n.toolName===_n().U.CREATE_GMAIL_FILTER)return t?e.formatMessage(so.createGmailFilterWhileRunning):e.formatMessage(so.createGmailFilter);if(n.toolName===_n().U.DELETE_GMAIL_FILTER)return t?e.formatMessage(so.deleteGmailFilterWhileRunning):e.formatMessage(so.deleteGmailFilter);if(n.toolName===_n().U.UPDATE_GMAIL_FILTER)return t?e.formatMessage(so.updateGmailFilterWhileRunning):e.formatMessage(so.updateGmailFilter);if(n.toolTitle)return t?e.formatMessage(so.runToolWithTitleWhileRunning,{title:n.toolTitle}):e.formatMessage(so.runToolWithTitle,{title:n.toolTitle})}return t?e.formatMessage(so.runToolWhileRunning):e.formatMessage(so.runTool)}},"mail.getPrompt":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t,toolResultStep:n})=>null!=n&&n.toolTitle?t?e.formatMessage(so.getPromptWithTitleWhileRunning,{title:n.toolTitle}):e.formatMessage(so.getPromptWithTitle,{title:n.toolTitle}):t?e.formatMessage(so.getPromptWhileRunning):e.formatMessage(so.getPrompt)}},ModuleConfiguration:function(e){const{module:t,saveModule:n,store:o,userHasEditAccess:i,workflowDefinitionPointer:r}=e;return(0,d.jsx)(a().Y1,{align:"center",direction:"vertical",gap:4,children:(0,d.jsx)(Vn,{module:t,saveModule:n,userHasEditAccess:i,workflowDefinitionPointer:r,store:o})})},getSecondaryLabel:()=>(0,d.jsx)(n(301948).A,{})};var uo=()=>n(30757),go=()=>n(133532),fo=()=>n(552559),mo=()=>n(524490),po=()=>n(112968),ho=()=>n(395546),vo=()=>n(388926),wo=()=>n(614818);const yo=(0,o().YK)({uriLabel:{id:"mcpResourceDetailModal.uriLabel",defaultMessage:"URI"},mimeTypeLabel:{id:"mcpResourceDetailModal.mimeTypeLabel",defaultMessage:"MIME Type"},enabled:{id:"mcpResourceDetailModal.enabled",defaultMessage:"Enabled"},disabled:{id:"mcpResourceDetailModal.disabled",defaultMessage:"Disabled"},close:{id:"mcpResourceDetailModal.close",defaultMessage:"Close"}});function Mo({resource:e,serverName:t,serverIconUrl:n,serverUrl:i,isOpen:r,onClose:c,isSelected:u,onToggle:g,disabled:m}){const p=(0,l().IS)((()=>({container:{width:480,maxWidth:"90vw"},topBar:{padding:"24px 24px 16px"},header:{paddingInlineStart:24},body:{paddingInlineStart:16},resourceTitle:{marginBottom:12,paddingInlineEnd:24},metadataRow:{display:"flex",flexDirection:"column",gap:8,marginBottom:12},metadataItem:{display:"flex",flexDirection:"column",gap:4},toggleRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:8,paddingInlineEnd:24,paddingBlock:12,marginTop:4,marginBottom:2},descriptionWrapper:{whiteSpace:"pre-wrap",maxHeight:400,overflowY:"auto",paddingInlineEnd:20,paddingTop:20,paddingBottom:20},descriptionMarkdown:{fontSize:14,lineHeight:"1.5em"},footer:{padding:20,borderTop:`1px solid ${f().Tj.border.secondary}`,display:"flex",justifyContent:"flex-start"},uriText:{fontFamily:"monospace",fontSize:13,wordBreak:"break-all"}})),[]),h=e.title||e.name||e.uri;return(0,d.jsx)(at().s,{isOpen:r,onDismiss:c,areaConstraint:{width:{type:"fixed",length:480},height:{type:"unlimited"}},render:()=>(0,d.jsxs)("div",{style:p.container,children:[(0,d.jsx)("div",{style:p.topBar,children:(0,d.jsxs)(a().Y1,{direction:"horizontal",gap:8,align:"center-left",children:[(0,d.jsx)(go().X,{iconUrl:n,serverUrl:i,serverName:t,size:G().Ev.default}),(0,d.jsx)(s().D,{styleKey:"bodyMedium",children:t}),(0,d.jsx)(uo().W,{serverUrl:i})]})}),(0,d.jsxs)("div",{style:p.header,children:[(0,d.jsx)("div",{style:p.resourceTitle,children:(0,d.jsx)(s().D,{styleKey:"titleMedium",children:h})}),(0,d.jsxs)("div",{style:p.metadataRow,children:[(0,d.jsxs)("div",{style:p.metadataItem,children:[(0,d.jsx)(s().D,{styleKey:"captionRegular",colorVariant:"secondary",children:(0,d.jsx)(o().sA,{...yo.uriLabel})}),(0,d.jsx)(s().D,{styleKey:"bodyRegular",style:p.uriText,children:e.uri})]}),e.mimeType?(0,d.jsxs)("div",{style:p.metadataItem,children:[(0,d.jsx)(s().D,{styleKey:"captionRegular",colorVariant:"secondary",children:(0,d.jsx)(o().sA,{...yo.mimeTypeLabel})}),(0,d.jsx)(s().D,{styleKey:"bodyRegular",children:e.mimeType})]}):void 0]}),(0,d.jsxs)("div",{style:p.toggleRow,children:[(0,d.jsx)(je().A,{on:u,onClick:g,disabled:m}),(0,d.jsx)(s().D,{styleKey:"bodyRegular",colorVariant:u?"accentPrimary":"secondary",colorPalette:u?"blue":void 0,children:(0,d.jsx)(o().sA,{...u?yo.enabled:yo.disabled})})]})]}),e.description?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(vo().A,{size:1,colorVariant:"secondary"}),(0,d.jsx)("div",{style:p.body,children:(0,d.jsx)("div",{style:p.descriptionWrapper,tabIndex:0,children:(0,d.jsx)(wo().d,{markdown:e.description,style:p.descriptionMarkdown})})})]}):void 0,(0,d.jsx)("div",{style:p.footer,children:(0,d.jsx)(ct().A,{onClick:c,children:(0,d.jsx)(o().sA,{...yo.close})})})]})})}const xo=(0,o().YK)({viewResourceDetailsAriaLabel:{id:"mcpResourcesInline.viewResourceDetailsAriaLabel",defaultMessage:"View resource details for {resourceUri}"}});function ko(e){const{resource:t,isSelected:n,onToggle:r,serverName:a,serverIconUrl:c,serverUrl:u,disabled:g}=e,[m,p]=(0,i.useState)(!1),[h,v]=(0,i.useState)(!1),[w,y]=(0,i.useState)(!1),M=(0,o().tz)(),x=(0,l().IS)((()=>({resourceItemContainer:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingBlock:6,paddingInline:8,position:"relative"},resourceItemButton:{position:"absolute",insetInlineStart:0,insetBlockStart:0,insetInlineEnd:0,insetBlockEnd:0,borderRadius:6,zIndex:0},resourceItemButtonHovered:{backgroundColor:f().Tj.background.secondaryTranslucent},resourceInfo:{display:"flex",flexDirection:"row",alignItems:"center",gap:8,flex:1,minWidth:0,position:"relative",zIndex:1,pointerEvents:"none"},infoIcon:{display:"flex",alignItems:"center"},toggleWrapper:{display:"flex",alignItems:"center",position:"relative",zIndex:1}})),[]),k=(0,i.useCallback)((e=>{e.stopPropagation(),r(t.uri)}),[r,t.uri]),b=(0,i.useCallback)((()=>{p(!0)}),[]),C=(0,i.useCallback)((()=>{p(!1)}),[]),S=h&&!w,j=t.title||t.name||t.uri;return(0,d.jsxs)("div",{style:x.resourceItemContainer,children:[(0,d.jsx)(O().Ay,{onClick:b,onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),style:x.resourceItemButton,hoveredStyle:S?x.resourceItemButtonHovered:void 0,ariaLabel:M.formatMessage(xo.viewResourceDetailsAriaLabel,{resourceUri:j})}),(0,d.jsxs)("div",{style:x.resourceInfo,children:[(0,d.jsx)(s().D,{styleKey:"bodyRegular",colorVariant:"primary",children:j}),h?(0,d.jsx)("div",{style:x.infoIcon,children:(0,d.jsx)(L().I,{icon:ho().infoCircleSmallIcon,colorVariant:"secondary",size:"sm"})}):void 0]}),(0,d.jsx)("div",{style:x.toggleWrapper,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),children:(0,d.jsx)(je().A,{on:n,onClick:k,disabled:g})}),(0,d.jsx)(Mo,{resource:t,serverName:a,serverIconUrl:c,serverUrl:u,isOpen:m,onClose:C,isSelected:n,onToggle:()=>r(t.uri),disabled:g})]})}const bo=(0,o().YK)({runAutomatically:{id:"mcpToolsInline.runAutomatically",defaultMessage:"Run automatically"},alwaysAsk:{id:"mcpToolsInline.alwaysAsk",defaultMessage:"Always ask"}});function Co(e){const{runAutomatically:t,onChange:n,enabledCount:i,isReadOnly:r,disabled:a}=e,c=(0,o().tz)(),u=(0,l().IS)((()=>({container:{visibility:0===i?"hidden":"visible"},button:{display:"flex",alignItems:"center",gap:4,color:f().Tj.text.secondary}})),[i]),g=r?!1===t?"ask":"auto":!0===t?"auto":"ask",m="auto"===g?c.formatMessage(bo.runAutomatically):c.formatMessage(bo.alwaysAsk),p=[{key:"auto",action:()=>n(!0),render:e=>(0,d.jsx)(N().A,{...e,title:(0,d.jsx)(o().sA,{...bo.runAutomatically}),isChecked:"auto"===g})},{key:"ask",action:()=>n(!1),render:e=>(0,d.jsx)(N().A,{...e,title:(0,d.jsx)(o().sA,{...bo.alwaysAsk}),isChecked:"ask"===g})}];return(0,d.jsx)("div",{style:u.container,children:(0,d.jsx)(z().A,{popupType:z().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"end",disabled:a,renderOrigin:e=>(0,d.jsxs)(H().p,{...e,style:u.button,disabled:a,children:[(0,d.jsx)(s().D,{styleKey:"captionMedium",colorVariant:"secondary",children:m}),(0,d.jsx)(L().I,{icon:Ae().arrowChevronSingleDownSmallIcon,size:"xxs"})]}),render:e=>(0,d.jsx)(W().A,{menuType:E().gu.Popup,width:200,children:(0,d.jsx)(U().A,{type:U().O.Vertical,sections:[{key:"run-automatically-options",render:e=>(0,d.jsx)(B().A,{...e}),items:p}],initialFocus:void 0})})})})}var So=()=>n(68528);const jo=(0,o().YK)({readOnlyBadge:{id:"mcpToolDetailModal.readOnlyBadge",defaultMessage:"Read-only"},destructiveBadge:{id:"mcpToolDetailModal.destructiveBadge",defaultMessage:"Destructive"},idempotentBadge:{id:"mcpToolDetailModal.idempotentBadge",defaultMessage:"Idempotent"},openWorldBadge:{id:"mcpToolDetailModal.openWorldBadge",defaultMessage:"Open-world"},enabled:{id:"mcpToolDetailModal.enabled",defaultMessage:"Enabled"},disabled:{id:"mcpToolDetailModal.disabled",defaultMessage:"Disabled"},close:{id:"mcpToolDetailModal.close",defaultMessage:"Close"}});function Ao({tool:e,serverName:t,serverIconUrl:n,serverUrl:i,isOpen:r,onClose:c,isSelected:u,onToggle:g,showPromptInjectionWarning:m,disabled:p}){var h,v,w,y;const M=(0,l().IS)((()=>({container:{width:480,maxWidth:"90vw"},topBar:{padding:"24px 24px 16px"},header:{paddingInlineStart:24},body:{paddingInlineStart:16},toolTitle:{marginBottom:12,paddingInlineEnd:24},badgesRow:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:6},toggleRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:8,paddingInlineEnd:24,paddingBlock:12,marginTop:4,marginBottom:2},descriptionWrapper:{whiteSpace:"pre-wrap",maxHeight:400,overflowY:"auto",paddingInlineEnd:20,paddingTop:20,paddingBottom:20},descriptionMarkdown:{fontSize:14,lineHeight:"1.5em"},footer:{padding:20,borderTop:`1px solid ${f().Tj.border.secondary}`,display:"flex",justifyContent:"flex-start"}})),[]),x=[];return m&&x.push((0,d.jsx)(So().R,{},"prompt-injection-warning")),null!==(h=e.annotations)&&void 0!==h&&h.readOnlyHint&&x.push((0,d.jsx)(Ve().E,{color:"gray",content:(0,d.jsx)(o().sA,{...jo.readOnlyBadge})},"read-only")),null!==(v=e.annotations)&&void 0!==v&&v.destructiveHint&&x.push((0,d.jsx)(Ve().E,{color:"gray",content:(0,d.jsx)(o().sA,{...jo.destructiveBadge})},"destructive")),null!==(w=e.annotations)&&void 0!==w&&w.idempotent&&x.push((0,d.jsx)(Ve().E,{color:"gray",content:(0,d.jsx)(o().sA,{...jo.idempotentBadge})},"idempotent")),null!==(y=e.annotations)&&void 0!==y&&y.openWorld&&x.push((0,d.jsx)(Ve().E,{color:"gray",content:(0,d.jsx)(o().sA,{...jo.openWorldBadge})},"open-world")),(0,d.jsx)(at().s,{isOpen:r,onDismiss:c,areaConstraint:{width:{type:"fixed",length:480},height:{type:"unlimited"}},render:()=>(0,d.jsxs)("div",{style:M.container,children:[(0,d.jsx)("div",{style:M.topBar,children:(0,d.jsxs)(a().Y1,{direction:"horizontal",gap:8,align:"center-left",children:[(0,d.jsx)(go().X,{iconUrl:n,serverUrl:i,serverName:t,size:G().Ev.default}),(0,d.jsx)(s().D,{styleKey:"bodyMedium",children:t}),(0,d.jsx)(uo().W,{serverUrl:i})]})}),(0,d.jsxs)("div",{style:M.header,children:[(0,d.jsx)("div",{style:M.toolTitle,children:(0,d.jsx)(s().D,{styleKey:"titleMedium",children:e.title})}),x.length>0?(0,d.jsx)("div",{style:M.badgesRow,children:x}):void 0,(0,d.jsxs)("div",{style:M.toggleRow,children:[(0,d.jsx)(je().A,{on:u,onClick:g,disabled:p}),(0,d.jsx)(s().D,{styleKey:"bodyRegular",colorVariant:u?"accentPrimary":"secondary",colorPalette:u?"blue":void 0,children:(0,d.jsx)(o().sA,{...u?jo.enabled:jo.disabled})})]})]}),(0,d.jsx)(vo().A,{size:1,colorVariant:"secondary"}),(0,d.jsx)("div",{style:M.body,children:(0,d.jsx)("div",{style:M.descriptionWrapper,tabIndex:0,children:(0,d.jsx)(wo().d,{markdown:e.description,style:M.descriptionMarkdown})})}),(0,d.jsx)("div",{style:M.footer,children:(0,d.jsx)(ct().A,{onClick:c,children:(0,d.jsx)(o().sA,{...jo.close})})})]})})}const Io=(0,o().YK)({viewToolDetailsAriaLabel:{id:"mcpToolsInline.viewToolDetailsAriaLabel",defaultMessage:"View tool details for {toolName}"}});function To(e){const{tool:t,isSelected:n,onToggle:r,serverName:a,serverIconUrl:c,serverUrl:u,showPromptInjectionWarning:g,disabled:m}=e,[p,h]=(0,i.useState)(!1),[v,w]=(0,i.useState)(!1),[y,M]=(0,i.useState)(!1),x=(0,o().tz)(),k=(0,l().IS)((()=>({toolItemContainer:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingBlock:6,paddingInline:8,position:"relative"},toolItemButton:{position:"absolute",insetInlineStart:0,insetBlockStart:0,insetInlineEnd:0,insetBlockEnd:0,borderRadius:6,zIndex:0},toolItemButtonHovered:{backgroundColor:f().Tj.background.secondaryTranslucent},toolInfo:{display:"flex",flexDirection:"row",alignItems:"center",gap:8,flex:1,minWidth:0,position:"relative",zIndex:1,pointerEvents:"none"},infoIcon:{display:"flex",alignItems:"center"},toggleWrapper:{display:"flex",alignItems:"center",position:"relative",zIndex:1}})),[]),b=(0,i.useCallback)((e=>{e.stopPropagation(),r(t.name)}),[r,t.name]),C=(0,i.useCallback)((()=>{h(!0)}),[]),S=(0,i.useCallback)((()=>{h(!1)}),[]),j=v&&!y;return(0,d.jsxs)("div",{style:k.toolItemContainer,children:[(0,d.jsx)(O().Ay,{onClick:C,onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),style:k.toolItemButton,hoveredStyle:j?k.toolItemButtonHovered:void 0,ariaLabel:x.formatMessage(Io.viewToolDetailsAriaLabel,{toolName:t.title})}),(0,d.jsxs)("div",{style:k.toolInfo,children:[(0,d.jsx)(s().D,{styleKey:"bodyRegular",colorVariant:"primary",children:t.title}),g?(0,d.jsx)(So().R,{}):void 0,v?(0,d.jsx)("div",{style:k.infoIcon,children:(0,d.jsx)(L().I,{icon:ho().infoCircleSmallIcon,colorVariant:"secondary",size:"sm"})}):void 0]}),(0,d.jsx)("div",{style:k.toggleWrapper,onMouseEnter:()=>M(!0),onMouseLeave:()=>M(!1),children:(0,d.jsx)(je().A,{on:n,onClick:b,disabled:m})}),(0,d.jsx)(Ao,{tool:t,serverName:a,serverIconUrl:c,serverUrl:u,isOpen:p,onClose:S,isSelected:n,onToggle:()=>r(t.name),showPromptInjectionWarning:g,disabled:m})]})}const Do=(0,o().YK)({readOnlyTools:{id:"mcpToolsInline.readOnlyTools",defaultMessage:"Read tools"},writeTools:{id:"mcpToolsInline.writeTools",defaultMessage:"Write tools"},allTools:{id:"mcpToolsInline.allTools",defaultMessage:"All tools"},resources:{id:"mcpToolsInline.resources",defaultMessage:"Resources"},customizeSelection:{id:"mcpToolsInline.customizeSelection",defaultMessage:"Customize selection"},enableAll:{id:"mcpToolsInline.enableAll",defaultMessage:"Enable all"},disableAll:{id:"mcpToolsInline.disableAll",defaultMessage:"Disable all"},toolsEnabledCount:{id:"mcpToolsInline.toolsEnabledCount",defaultMessage:"{enabled} of {total} enabled"},resourcesEnabledCount:{id:"mcpToolsInline.resourcesEnabledCount",defaultMessage:"{enabled} of {total} enabled"}});function Po(e){var t,n,r,a,c,u,g,m,p;const{moduleValue:h,saveModule:v,userHasEditAccess:w}=e,y=(0,o().tz)(),M=null===(t=h.state)||void 0===t?void 0:t.enabledToolNames,x=null===(n=h.state)||void 0===n?void 0:n.runReadToolsAutomatically,k=null===(r=h.state)||void 0===r?void 0:r.runWriteToolsAutomatically,b=null===(a=h.state)||void 0===a?void 0:a.enabledResourceUris,C=(0,i.useMemo)((()=>{var e;const t=null===(e=h.state)||void 0===e||null===(e=e.promptInjectionWarnings)||void 0===e?void 0:e.flaggedToolNames;return new Set(t??[])}),[null===(c=h.state)||void 0===c||null===(c=c.promptInjectionWarnings)||void 0===c?void 0:c.flaggedToolNames]),S=(0,i.useMemo)((()=>{var e;return(null===(e=h.state)||void 0===e?void 0:e.tools)??[]}),[null===(u=h.state)||void 0===u?void 0:u.tools]),j=(0,i.useMemo)((()=>{var e;return(null===(e=h.state)||void 0===e?void 0:e.resources)??[]}),[null===(g=h.state)||void 0===g?void 0:g.resources]),A=(0,i.useMemo)((()=>void 0===M?new Set(S.map((e=>e.name))):new Set(M.filter((e=>e!==po().Pc)))),[M,S]),I=(0,i.useMemo)((()=>void 0===b?new Set(j.map((e=>e.uri))):new Set(b.filter((e=>e!==po().Pc)))),[b,j]),T=(0,i.useMemo)((()=>{const e=[],t=[];for(const i of S){var n;null!==(n=i.annotations)&&void 0!==n&&n.readOnlyHint?e.push(i):t.push(i)}const o=[];return e.length>0&&o.push({title:y.formatMessage(Do.readOnlyTools),tools:e,isReadOnly:!0}),t.length>0&&o.push({title:y.formatMessage(Do.writeTools),tools:t,isReadOnly:!1}),1===o.length&&(o[0].title=y.formatMessage(Do.allTools)),o}),[S,y]),D=(0,i.useCallback)((e=>{const t=new Set(A);t.has(e)?t.delete(e):t.add(e);const n=0===t.size?[po().Pc]:Array.from(t),o={...h,state:{...h.state,enabledToolNames:n}};v(o)}),[h,v,A]),P=(0,i.useCallback)(((e,t)=>{const n=new Set(A),o=S.filter((t=>{var n;return Boolean(null===(n=t.annotations)||void 0===n?void 0:n.readOnlyHint)===e})).map((e=>e.name));for(const a of o)"select"===t?n.add(a):n.delete(a);const i=0===n.size?[po().Pc]:Array.from(n),r={...h,state:{...h.state,enabledToolNames:i}};v(r)}),[h,v,A,S]),R=(0,i.useCallback)(((e,t)=>{const n={...h,state:{...h.state,...t?{runReadToolsAutomatically:e}:{runWriteToolsAutomatically:e}}};v(n)}),[h,v]),L=(0,i.useCallback)((e=>{const t=new Set(I);t.has(e)?t.delete(e):t.add(e);const n=0===t.size?[po().Pc]:Array.from(t),o={...h,state:{...h.state,enabledResourceUris:n}};v(o)}),[h,v,I]),E=(0,i.useCallback)((e=>{const t="select"===e?j.map((e=>e.uri)):[po().Pc],n={...h,state:{...h.state,enabledResourceUris:t}};v(n)}),[h,v,j]),W=(0,i.useMemo)((()=>({sectionBackground:f().Tj.background.secondaryTranslucent,sectionButtonBackground:f().Tj.background.secondaryTranslucent})),[]),N=(0,l().IS)((()=>({container:{paddingBlock:10,paddingInlineEnd:10,paddingInlineStart:12},customizeRow:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingBottom:4,paddingInline:8,width:"100%"},sectionHeaderWithBadge:{display:"flex",flexDirection:"row",alignItems:"center",gap:6},toolsContainer:{display:"flex",flexDirection:"column",gap:4}})),[]),U=(0,i.useMemo)((()=>{const e=[];if(T.forEach((t=>{const n=t.tools.map((e=>e.name)),i=n.filter((e=>A.has(e))).length,r=n.length,a=i===r,l=t.isReadOnly?x:k;e.push({key:t.title,headerDivider:!0,initialExpanded:!1,title:(0,d.jsxs)("div",{style:N.sectionHeaderWithBadge,children:[(0,d.jsx)(s().D,{styleKey:"bodySmMedium",colorVariant:"primary",children:t.title}),(0,d.jsx)(Ve().E,{color:"gray",content:y.formatMessage(Do.toolsEnabledCount,{enabled:i,total:r})})]}),secondaryLabel:(0,d.jsx)(Co,{runAutomatically:l,onChange:e=>R(e,t.isReadOnly),enabledCount:i,totalCount:r,isReadOnly:t.isReadOnly,disabled:!w}),content:(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{style:N.customizeRow,children:[(0,d.jsx)(s().D,{styleKey:"captionRegular",colorVariant:"secondary",children:(0,d.jsx)(o().sA,{...Do.customizeSelection})}),(0,d.jsx)(H().p,{size:"sm",colorPalette:a?void 0:"blue",onClick:()=>{P(t.isReadOnly,a?"deselect":"select")},disabled:!w,children:(0,d.jsx)(s().D,{styleKey:"captionRegular",colorVariant:a?"secondary":void 0,children:a?y.formatMessage(Do.disableAll):y.formatMessage(Do.enableAll)})})]}),(0,d.jsx)("div",{style:N.toolsContainer,children:t.tools.map((e=>{var t,n;return(0,d.jsx)(To,{tool:e,isSelected:A.has(e.name),onToggle:D,serverName:h.name,serverIconUrl:null===(t=h.state)||void 0===t?void 0:t.serverIconUrl,serverUrl:null===(n=h.state)||void 0===n?void 0:n.serverUrl,showPromptInjectionWarning:C.has(e.name),disabled:!w},e.name)}))})]})})})),j.length>0){const t=j.filter((e=>I.has(e.uri))).length,n=t===j.length;e.push({key:"resources",headerDivider:!0,initialExpanded:!1,title:(0,d.jsxs)("div",{style:N.sectionHeaderWithBadge,children:[(0,d.jsx)(s().D,{styleKey:"bodySmMedium",colorVariant:"primary",children:(0,d.jsx)(o().sA,{...Do.resources})}),(0,d.jsx)(Ve().E,{color:"gray",content:y.formatMessage(Do.resourcesEnabledCount,{enabled:t,total:j.length})})]}),secondaryLabel:(0,d.jsx)(Co,{runAutomatically:!1,onChange:()=>{},enabledCount:0,totalCount:0,isReadOnly:!0,disabled:!0}),content:(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{style:N.customizeRow,children:[(0,d.jsx)(s().D,{styleKey:"captionRegular",colorVariant:"secondary",children:(0,d.jsx)(o().sA,{...Do.customizeSelection})}),(0,d.jsx)(H().p,{size:"sm",colorPalette:n?void 0:"blue",onClick:()=>{E(n?"deselect":"select")},disabled:!w,children:(0,d.jsx)(s().D,{styleKey:"captionRegular",colorVariant:n?"secondary":void 0,children:n?y.formatMessage(Do.disableAll):y.formatMessage(Do.enableAll)})})]}),(0,d.jsx)("div",{style:N.toolsContainer,children:j.map((e=>{var t,n;return(0,d.jsx)(ko,{resource:e,isSelected:I.has(e.uri),onToggle:L,serverName:h.name,serverIconUrl:null===(t=h.state)||void 0===t?void 0:t.serverIconUrl,serverUrl:null===(n=h.state)||void 0===n?void 0:n.serverUrl,disabled:!w},e.uri)}))})]})})}return e}),[T,j,A,I,C,x,k,R,P,D,L,E,h.name,null===(m=h.state)||void 0===m?void 0:m.serverIconUrl,null===(p=h.state)||void 0===p?void 0:p.serverUrl,N,y,w]);return 0===S.length&&0===j.length?null:(0,d.jsx)("div",{style:N.container,children:(0,d.jsx)(ae().b,{sections:U,chevronPosition:"start",styleOverrides:W,borderedStyle:!0})})}const Ro=(0,o().YK)({connectButton:{id:"mcpServer.connectButton",defaultMessage:"Connect to MCP Server"}});function Lo(e){var t;const{moduleValue:n,onUndoClick:r,showMcpModal:c,setShowMcpModal:u,spaceViewStore:g,currentUserPointer:m,onAuthComplete:p,existingModuleId:h}=e,v=function(){const e=(0,l().eP)();return(0,l().IS)((()=>({wrapper:{borderRadius:16,background:"dark"===e?f().Tj.background.secondary:f().Tj.background.primary,boxShadow:`0px 0px 0px 1px ${f().Tj.border.secondary}, 0px 3px 8px rgba(0, 0, 0, 0.04)`,overflow:"hidden",display:"flex",alignItems:"center",gap:8,padding:12},label:{flex:"1 1 0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}})),[e])}(),y=(0,w().c)(n),M=(0,i.useCallback)((()=>{u(!0)}),[u]),x=(0,i.useCallback)((()=>{u(!1),null==p||p()}),[p,u]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(a().Y1,{direction:"horizontal",gap:8,height:"hug",style:v.wrapper,width:"fill",children:[(0,d.jsx)(L().I,{icon:y}),(0,d.jsx)(s().D,{colorVariant:"primary",styleKey:"bodyMedium",style:v.label,children:(0,d.jsx)(o().sA,{defaultMessage:"Connect to {moduleName}",id:"workflows.modules.mcpServer.connectLabel",values:{moduleName:n.name}})}),r?(0,d.jsx)(H().p,{colorPalette:"blue",onClick:r,children:(0,d.jsx)(s().D,{styleKey:"bodyMedium",children:(0,d.jsx)(o().sA,{defaultMessage:"Undo",id:"workflows.modules.mcpServer.undo"})})}):null,(0,d.jsx)(He().A,{colorPalette:"blue",onClick:M,children:(0,d.jsx)(o().sA,{defaultMessage:"Connect",id:"workflows.modules.mcpServer.connect"})})]}),c&&g&&m?(0,d.jsx)(fo().Z,{isOpen:c,onClose:x,spaceViewStore:g,currentUserPointer:m,existingModuleId:h,existingAgentModules:[{name:n.name,serverUrl:null===(t=n.state)||void 0===t?void 0:t.serverUrl}]}):void 0]})}const Eo=(0,o().YK)({runTool:{defaultMessage:"Ran tool with MCP server",id:"workflow.run.effect.mcpServer.runTool.description"},runToolWhileRunning:{defaultMessage:"Running tool with MCP server",id:"workflow.run.effect.mcpServer.runTool.descriptionWhileRunning"},runToolWithTitle:{defaultMessage:"Ran MCP server tool - {title}",id:"workflow.run.effect.mcpServer.runToolWithTitle.description"},runToolWithTitleWhileRunning:{defaultMessage:"Running MCP server tool - {title}",id:"workflow.run.effect.mcpServer.runToolWithTitle.descriptionWhileRunning"},runToolSpecific:{defaultMessage:"{serverName} MCP called {toolName}",id:"workflow.run.effect.mcpServer.runToolSpecific.description"},runToolSpecificWhileRunning:{defaultMessage:"{serverName} MCP calling {toolName}",id:"workflow.run.effect.mcpServer.runToolSpecificWhileRunning.descriptionWhileRunning"},listResources:{defaultMessage:"Listed resources from MCP server",id:"workflow.run.effect.mcpServer.listResources.description"},listResourcesWhileRunning:{defaultMessage:"Listing resources from MCP server",id:"workflow.run.effect.mcpServer.listResources.descriptionWhileRunning"},readResource:{defaultMessage:"Read resource from MCP server",id:"workflow.run.effect.mcpServer.readResource.description"},readResourceWhileRunning:{defaultMessage:"Reading resource from MCP server",id:"workflow.run.effect.mcpServer.readResource.descriptionWhileRunning"},listPrompts:{defaultMessage:"Listed prompts from MCP server",id:"workflow.run.effect.mcpServer.listPrompts.description"},listPromptsWhileRunning:{defaultMessage:"Listing prompts from MCP server",id:"workflow.run.effect.mcpServer.listPrompts.descriptionWhileRunning"},getPrompt:{defaultMessage:"Got prompt from MCP server",id:"workflow.run.effect.mcpServer.getPrompt.description"},getPromptWhileRunning:{defaultMessage:"Getting prompt from MCP server",id:"workflow.run.effect.mcpServer.getPrompt.descriptionWhileRunning"},listTools:{defaultMessage:"Listed tools from MCP server",id:"workflow.run.effect.mcpServer.listTools.description"},listToolsWhileRunning:{defaultMessage:"Listing tools from MCP server",id:"workflow.run.effect.mcpServer.listTools.descriptionWhileRunning"},needsLoginBadge:{id:"mcpToolsInline.needsLoginBadge",defaultMessage:"Needs login"}});function Wo(e){var t,i;const{module:r}=e,a=(0,o().tz)(),s=null===(t=r.state)||void 0===t?void 0:t.serverUrl,l=s&&(0,n(110443).eH)(s),c=(0,n(821979).y)(r),u=(0,n(329366).y)({moduleValue:r,existingModuleId:r.id,hasExternalConnection:"connected"===c.status,hasDuplicateUrl:!1,isAdded:!0,connectionAuthState:c.status});let g;l||"needsAuthentication"!==u||(g=(0,d.jsx)(Ve().E,{color:c.color,content:a.formatMessage(Eo.needsLoginBadge)}));const f=Boolean(null===(i=r.state)||void 0===i||null===(i=i.promptInjectionWarnings)||void 0===i||null===(i=i.flaggedToolNames)||void 0===i?void 0:i.length)?(0,d.jsx)(So().R,{}):void 0;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(uo().W,{serverUrl:s}),(0,d.jsx)(n(774879).O,{}),f,g]})}const No={triggers:{},effect:{"mcpServer.runTool":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t,toolResultStep:n})=>{var o;const i=null==n||null===(o=n.moduleInfo)||void 0===o?void 0:o.name;let r=null==n?void 0:n.toolTitle;if(!r&&null!=n&&n.input){const e=n.input;if("object"==typeof e&&null!==e&&"toolName"in e){const t=e;"string"==typeof t.toolName&&(r=t.toolName)}}if(i&&r){const n=(i.includes("MCP"),i);return t?e.formatMessage(Eo.runToolSpecificWhileRunning,{serverName:n,toolName:r}):e.formatMessage(Eo.runToolSpecific,{serverName:n,toolName:r})}return null!=n&&n.toolTitle?t?e.formatMessage(Eo.runToolWithTitleWhileRunning,{title:n.toolTitle}):e.formatMessage(Eo.runToolWithTitle,{title:n.toolTitle}):t?e.formatMessage(Eo.runToolWhileRunning):e.formatMessage(Eo.runTool)}},"mcpServer.listResources":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>t?e.formatMessage(Eo.listResourcesWhileRunning):e.formatMessage(Eo.listResources)},"mcpServer.readResource":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>t?e.formatMessage(Eo.readResourceWhileRunning):e.formatMessage(Eo.readResource)},"mcpServer.listPrompts":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>t?e.formatMessage(Eo.listPromptsWhileRunning):e.formatMessage(Eo.listPrompts)},"mcpServer.getPrompt":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>t?e.formatMessage(Eo.getPromptWhileRunning):e.formatMessage(Eo.getPrompt)},"mcpServer.listTools":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>t?e.formatMessage(Eo.listToolsWhileRunning):e.formatMessage(Eo.listTools)}},ModuleConfiguration:function(e){const{isInTranscript:t,module:r,onUndoClick:c,workflowDefinitionPointer:u,workflowModuleStore:g,onAuthComplete:m}=e,p=(0,it().v3)(),h=(0,o().tz)(),[v,w]=(0,i.useState)(!1),y=function(){const e=(0,l().eP)();return(0,l().IS)((()=>({wrapper:{borderRadius:16,background:"dark"===e?f().Tj.background.secondary:f().Tj.background.primary,boxShadow:`0px 0px 0px 1px ${f().Tj.border.secondary}, 0px 3px 8px rgba(0, 0, 0, 0.04)`,overflow:"hidden",padding:12},textEllipsis:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},verticalContainer:{flex:1}})),[e])}(),{spaceId:M}=(0,gt().kI)(u),x=(0,D().K8)((()=>{const e=p.currentUser.id;if(e)return n(696706).L3.fromPointerLike({table:n(798880).oo,id:e})}),[p]),k=(0,D().K8)((()=>(0,n(111379).k)(M)),[M]),b=(0,i.useCallback)((()=>{w(!0)}),[]),C=(0,i.useCallback)((()=>{w(!1),null==m||m()}),[m]);if(t){var S,j,A,I;if(!(null!==(S=r.state)&&void 0!==S&&S.connectionPointer))return(0,d.jsx)(Lo,{moduleValue:r,onUndoClick:c,showMcpModal:v,setShowMcpModal:w,spaceViewStore:k,currentUserPointer:x,onAuthComplete:m,existingModuleId:r.id});const e=null===(j=r.state)||void 0===j?void 0:j.serverIconUrl,t=null===(A=r.state)||void 0===A?void 0:A.serverUrl,n=r.name;return(0,d.jsxs)(a().Y1,{direction:"horizontal",gap:8,height:"hug",style:y.wrapper,width:"fill",children:[(0,d.jsxs)(a().Y1,{direction:"vertical",gap:4,style:y.verticalContainer,children:[(0,d.jsxs)(a().Y1,{direction:"horizontal",gap:8,align:"center",children:[(0,d.jsx)(go().X,{iconUrl:e,serverUrl:t,serverName:r.name,size:16}),(0,d.jsx)(s().D,{colorVariant:"primary",styleKey:"bodyMedium",style:y.textEllipsis,children:n})]}),null!==(I=r.state)&&void 0!==I&&I.serverUrl?(0,d.jsx)(s().D,{colorVariant:"secondary",styleKey:"captionRegular",style:y.textEllipsis,children:h.formatMessage({id:"mcpServer.connectedToUrl",defaultMessage:"Connected to: {url}"},{url:r.state.serverUrl})}):void 0]}),c?(0,d.jsx)(H().p,{colorPalette:"blue",onClick:c,children:(0,d.jsx)(s().D,{styleKey:"bodyMedium",children:(0,d.jsx)(o().sA,{defaultMessage:"Undo",id:"workflows.modules.mcpServer.undo"})})}):void 0,(0,d.jsx)(mo().C,{asyncConnections:{status:"resolved",value:{sections:[]}},moduleValue:r,onMenuItemClick:()=>{},selectedScopedExternalConnectionStore:void 0,workflowDefinitionPointer:u,workflowModuleStore:g,onAuthComplete:m})]})}var T;return null!==(T=r.state)&&void 0!==T&&T.serverUrl?(0,d.jsx)(a().Y1,{direction:"vertical",gap:12,children:(0,d.jsx)(Po,{moduleValue:r,saveModule:e.saveModule,userHasEditAccess:e.userHasEditAccess})}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ct().A,{onClick:b,children:h.formatMessage(Ro.connectButton)}),v&&k&&x?(0,d.jsx)(fo().Z,{isOpen:v,onClose:C,spaceViewStore:k,currentUserPointer:x,existingModuleId:void 0,existingAgentModules:[]}):void 0]})},getSecondaryLabel:e=>(0,d.jsx)(Wo,{module:e}),getIcon:e=>{var t,n;const o=null===(t=e.state)||void 0===t?void 0:t.serverIconUrl,i=null===(n=e.state)||void 0===n?void 0:n.serverUrl;return Object.assign((t=>(0,d.jsx)(go().X,{iconUrl:o,serverUrl:i,serverName:e.name,size:"number"==typeof(null==t?void 0:t.width)?t.width:16})),{__iconDefinition:{svg:(0,d.jsx)(go().X,{iconUrl:o,serverUrl:i,serverName:e.name,size:G().Ev.sm}),viewBox:"0 0 16 16",variant:"default"}})}};const Uo=(0,o().YK)({search:{defaultMessage:"Searched Microsoft Teams",id:"workflow.run.effect.microsoftTeams.search.description"},searchLoading:{defaultMessage:"Searching Microsoft Teams",id:"workflow.run.effect.microsoftTeams.search.loading"},loadMessage:{defaultMessage:"Loaded Microsoft Teams message",id:"workflow.run.effect.microsoftTeams.loadMessage.description"},loadMessageLoading:{defaultMessage:"Loading Microsoft Teams message",id:"workflow.run.effect.microsoftTeams.loadMessage.loading"},viewChannel:{defaultMessage:"Viewed Microsoft Teams channel",id:"workflow.run.effect.microsoftTeams.viewChannel.description"},viewChannelLoading:{defaultMessage:"Viewing Microsoft Teams channel",id:"workflow.run.effect.microsoftTeams.viewChannel.loading"},viewChat:{defaultMessage:"Viewed Microsoft Teams chat",id:"workflow.run.effect.microsoftTeams.viewChat.description"},viewChatLoading:{defaultMessage:"Viewing Microsoft Teams chat",id:"workflow.run.effect.microsoftTeams.viewChat.loading"}}),Bo={triggers:{},effect:{"microsoftTeams.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Uo.searchLoading:Uo.search)},"microsoftTeams.loadMessage":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Uo.loadMessageLoading:Uo.loadMessage)},"microsoftTeams.viewChannel":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Uo.viewChannelLoading:Uo.viewChannel)},"microsoftTeams.viewChat":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Uo.viewChatLoading:Uo.viewChat)}},ModuleConfiguration:function(e){const t=(0,i.useCallback)((e=>({type:"microsoftTeams",moduleType:"microsoftTeams",identifier:e,actions:["search"]})),[]);return(0,d.jsx)(k,{...e,moduleName:"Microsoft Teams",buildPermission:t})}},Vo=(0,o().YK)({list:{defaultMessage:"Listed modules",id:"workflow.run.effect.modules.list.description"},listLoading:{defaultMessage:"Listing modules",id:"workflow.run.effect.modules.list.loading"},create:{defaultMessage:"Created module",id:"workflow.run.effect.modules.create.description"},createLoading:{defaultMessage:"Creating module",id:"workflow.run.effect.modules.create.loading"},update:{defaultMessage:"Updated module",id:"workflow.run.effect.modules.update.description"},updateLoading:{defaultMessage:"Updating module",id:"workflow.run.effect.modules.update.loading"},delete:{defaultMessage:"Deleted module",id:"workflow.run.effect.modules.delete.description"},deleteLoading:{defaultMessage:"Deleting module",id:"workflow.run.effect.modules.delete.loading"}}),_o={triggers:{},effect:{"modules.list":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Vo.listLoading:Vo.list)},"modules.create":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Vo.createLoading:Vo.create)},"modules.update":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Vo.updateLoading:Vo.update)},"modules.delete":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Vo.deleteLoading:Vo.delete)}}};var Fo=()=>n(242422),Oo=()=>n(175249),zo=()=>n(920198),Ko=()=>n(907258),Yo=()=>n(730240),Ho=()=>n(764880),qo=()=>n(381175),$o=()=>n(295633),Go=()=>n(584262),Qo=()=>n(857783);function Jo(e){const{text:t,metadata:n}=e,o=(0,l().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:8,marginTop:8},text:{color:f().Tj.text.secondary,fontSize:14,lineHeight:1.5,wordBreak:"break-word",maxHeight:200,overflow:"scroll",whiteSpace:"pre-line"},metadata:{display:"flex",gap:4,fontSize:12,color:f().Tj.text.tertiary}})),[]);if(!t&&!n)return null;const i="string"==typeof t?t.replace(/\n{2,}/g,"\n"):t;return(0,d.jsxs)("div",{style:o.container,children:[i?(0,d.jsx)("div",{style:o.text,children:i}):void 0,n?(0,d.jsx)("div",{style:o.metadata,children:n}):void 0]})}function Zo(e){const{href:t,pageId:n,children:o}=e,r=(0,it().v3)(),a=(0,zo().L)(),s=(0,l().IS)((()=>({link:{color:f().Tj.text.tertiary,textDecoration:"underline",cursor:"pointer"}})),[]),c=(0,i.useCallback)((e=>{if(!n||!a)return;e.preventDefault();const t=$o().B.createChildStore(a,{table:"block",id:n}),o=(0,qo().V)(e);Qo().uK({environment:r,store:t,openInNew:o,pageVisitSource:Go().y8.LinkInPage})}),[r,n,a]);if(n){const e=t||`#${n}`;return(0,d.jsx)("a",{href:e,style:s.link,onClick:c,children:o})}return t?(0,d.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",style:s.link,children:o}):(0,d.jsx)("span",{style:s.link,children:o})}const Xo=(0,o().YK)({waitingForEdits:{defaultMessage:"Waiting {timeRemaining, plural, one {# second} other {# seconds}} for edits to complete",id:"debounceCountdown.waitingForEdits.seconds"},waitingForEditsMinutes:{defaultMessage:"Waiting {timeRemaining, plural, one {# minute} other {# minutes}} for edits to complete",id:"debounceCountdown.waitingForEdits.minutes"},debounceResetTooltip:{defaultMessage:"Making more edits extends the wait time",id:"debounceCountdown.resetTooltip"}});function ei(e){const{runStore:t}=e,n=(0,o().tz)(),[,r]=(0,i.useState)({}),a=(0,D().K8)((()=>t.getDequeueAfter()),[t]),s=(0,D().K8)((()=>t.getStatus()),[t]);if((0,i.useEffect)((()=>{if(!a||"pending"!==s)return;const e=setInterval((()=>{Date.now()>=a&&clearInterval(e),r({})}),1e3);return()=>clearInterval(e)}),[a,s]),!a||"pending"!==s)return null;const l=Date.now(),c=Math.max(0,a-l),u=Math.ceil(c/1e3);if(u<=0)return null;const g=Math.floor(u/60),f=g>=1?n.formatMessage(Xo.waitingForEditsMinutes,{timeRemaining:g}):n.formatMessage(Xo.waitingForEdits,{timeRemaining:u});return(0,d.jsx)(_e().m,{placement:"top",renderTooltip:()=>(0,d.jsx)(o().sA,{...Xo.debounceResetTooltip}),render:e=>(0,d.jsx)("span",{...e,children:f})})}const ti=(0,o().YK)({viewPage:{defaultMessage:"View page",id:"notionTrigger.viewPage"},multipleEdits:{defaultMessage:"{count, plural, one {# edit} other {# edits}}",id:"notionTrigger.multipleEdits"},multipleEditsByEditor:{defaultMessage:"{count, plural, one {Edited by {editor}} other {# edits by {editor}}}",id:"notionTrigger.multipleEditsByEditor"},multipleEditsByMultiplePeople:{defaultMessage:"{count, plural, one {# edit by multiple people} other {# edits by multiple people}}",id:"notionTrigger.multipleEditsByMultiplePeople"},createdBy:{defaultMessage:"Created by {editor}",id:"notionTrigger.createdBy"}});function ni(e){const t=(0,o().tz)();return(0,D().K8)((()=>{const{sidebarSpaceStore:n}=Ko().default.state;if(!n||!e)return;return(0,Yo().JQ)({parentStore:n,pointer:e}).getDisplayName(t)}),[e,t])}function oi(e){const t=(0,o().tz)(),{data:r,runId:a,workflowId:s}=e,l=(0,zo().L)(),c=(0,D().K8)((()=>{if(!a||!s||!l)return;const e=n(350013).N.createChildStore(l,{table:"workflow",id:s,spaceId:l.id});return n(744947).t.createChildStore(e,{table:"workflow_automation_run",id:a,spaceId:l.id})}),[a,s,l]);let u,g;r&&"page"in r?(u=r.page,"edits"in r&&Array.isArray(r.edits)&&(g=r.edits)):r&&"update"in r?(u=r.update.after||{},"edits"in r&&Array.isArray(r.edits)&&(g=r.edits)):u={};const f="string"==typeof u.url?u.url:void 0,m=(0,i.useMemo)((()=>{if(!f)return;const e=(0,n(687249).X1)(f,{baseUrl:wn().A.domainBaseUrl,publicDomainName:wn().A.publicDomainName});return"pageOrCollectionViewBlock"===(null==e?void 0:e.type)?e.id:void 0}),[f]);let p;r&&"update"in r&&r.update.afterContent?p=r.update.afterContent:r&&"content"in r&&(p=r.content);const h=ni((0,i.useMemo)((()=>{if(r&&"createdBy"in r){const e=r.createdBy;return(0,Ho().Pu)(e)?e:void 0}}),[r])),v=(0,D().K8)((()=>null==c?void 0:c.getDequeueAfter()),[c]),w=(0,D().K8)((()=>null==c?void 0:c.getStatus()),[c]),[,y]=(0,i.useState)({});(0,i.useEffect)((()=>{if(!c||!v||"pending"!==w)return;const e=Date.now();if(e>=v)return;const t=setTimeout((()=>{y({})}),v-e+100);return()=>clearTimeout(t)}),[v,w,c]);const M=c&&v&&"pending"===w&&v>Date.now(),x=(0,i.useMemo)((()=>g&&0!==g.length?(0,q().hS)(g.map((e=>e.editedBy)).filter(Ho().Pu),(e=>`${e.table}:${e.id}:${e.spaceId}`)):[]),[g]),k=ni(1===x.length?x[0]:void 0),b=[];if(M&&c)b.push((0,d.jsx)("span",{children:(0,d.jsx)(ei,{runStore:c})},"debounce"));else if(h)b.push((0,d.jsx)("span",{children:t.formatMessage(ti.createdBy,{editor:h})},"createdBy"));else{var C;const e=(null===(C=g)||void 0===C?void 0:C.length)??1;x.length>1?b.push((0,d.jsx)("span",{children:t.formatMessage(ti.multipleEditsByMultiplePeople,{count:e})},"edits")):k?b.push((0,d.jsx)("span",{children:t.formatMessage(ti.multipleEditsByEditor,{count:e,editor:k})},"edits")):b.push((0,d.jsx)("span",{children:t.formatMessage(ti.multipleEdits,{count:e})},"edits"))}return(m||f)&&(b.length>0&&b.push((0,d.jsx)("span",{children:"—"},"separator")),b.push((0,d.jsx)("span",{children:(0,d.jsx)(Zo,{pageId:m,href:f,children:t.formatMessage(ti.viewPage)})},"link"))),p||0!==b.length?(0,d.jsx)(Jo,{text:p,metadata:b.length>0?b.filter(Boolean):void 0}):null}var ii=()=>n(732810),ri=()=>n(187820),ai=()=>n(16006);function si(e){const t=(0,zo().L)();return(0,D().K8)((()=>{if(!t||!e)return;const n=ii().m.createChildStore(t,{table:"collection",id:e});return n.isDefined()?n:void 0}),[t,e])}function li(e){return(0,d.jsx)(a().Y1,{direction:"horizontal",align:"center-left",width:"hug",children:e.children})}function di(e){const{store:t}=e,n=(0,D().K8)((()=>t.getParentCollectionViewBlockStore()),[t]),o=(0,D().K8)((()=>n&&!n.hasSingleOwnedCollection()),[n]),i=(0,D().K8)((()=>t.getIcon()),[t]),r=(0,D().K8)((()=>null==n?void 0:n.getIcon()),[n]);return(0,d.jsxs)(a().Y1,{direction:"horizontal",gap:4,align:"center",width:"hug",style:{marginInline:4},children:[o&&n?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ri().B6,{disabled:!0,icon:r,iconRecordCategory:"collectionViewBlock",isEmptyPage:!1,size:16}),(0,d.jsx)(s().D,{styleKey:"bodyMedium",colorVariant:"primary",children:(0,d.jsx)(ai().A,{store:n})}),"/"]}):void 0,(0,d.jsx)(ri().B6,{disabled:!0,icon:i,iconRecordCategory:"collection",isEmptyPage:!1,size:16}),(0,d.jsx)(s().D,{styleKey:"bodyMedium",colorVariant:"primary",children:(0,d.jsx)(ai().A,{store:t})})]})}function ci(e){const{trigger:t}=e,{state:n}=t,i=si(null==n?void 0:n.collectionId);return n&&n.collectionId?(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"When a page is created in {dataSource}",id:"notionTrigger.pageCreatedConfig.withDatabase",values:{dataSource:i?(0,d.jsx)(di,{store:i}):null}})}):(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"When a page is created",id:"notionTrigger.pageCreatedConfig.default"})})}function ui(e){return(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"Manually triggered run",id:"notionTrigger.buttonPressedConfig.default"})})}function gi(e){const{trigger:t}=e,{state:n}=t,r=si(null==n?void 0:n.collectionId),a=(0,i.useMemo)((()=>{var e,t,o;return n&&n.propertyFilters?"some"===n.propertyFilters.type?(null===(t=n.propertyFilters.some)||void 0===t?void 0:t.length)??0:"all"===n.propertyFilters.type?(null===(o=n.propertyFilters.all)||void 0===o?void 0:o.length)??0:0:(null==n||null===(e=n.propertyIds)||void 0===e?void 0:e.length)??0}),[n]);return n&&n.collectionId?a>0&&r?(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"When {propertyCount, plural, one {# property is} other {# properties are}} updated in {dataSource}",id:"notionTrigger.pageUpdatedConfig.withPropertiesAndDatabase",values:{propertyCount:a,dataSource:(0,d.jsx)(di,{store:r})}})}):r?(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"When a page is updated in {dataSource}",id:"notionTrigger.pageUpdatedConfig.withDatabase",values:{dataSource:(0,d.jsx)(di,{store:r})}})}):n.propertyIds&&n.propertyIds.length>0?(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"When {propertyCount, plural, one {# property is} other {# properties are}} updated in database",id:"notionTrigger.pageUpdatedConfig.withProperties",values:{propertyCount:n.propertyIds.length}})}):(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"When a page is updated",id:"notionTrigger.pageUpdatedConfig.default"})}):(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"When a page is updated",id:"notionTrigger.pageUpdatedConfig.default"})})}function fi(e){const{trigger:t}=e,{state:n}=t,i=si(null==n?void 0:n.collectionId);return n&&n.collectionId?(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"When a page is deleted from {dataSource}",id:"notionTrigger.pageDeletedConfig.withDatabase",values:{dataSource:i?(0,d.jsx)(di,{store:i}):null}})}):(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"When a page is deleted",id:"notionTrigger.pageDeletedConfig.default"})})}function mi(e){const t=(0,o().tz)(),{trigger:n}=e,{state:i}=n;if(!i)return(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"On a schedule",id:"notionTrigger.recurrenceConfig.default"})});let r="";const{frequency:a,interval:s}=i;if("hour"===a)r=1===s?t.formatMessage({id:"workflows.recurrence.everyHour",defaultMessage:"Every hour"}):t.formatMessage({id:"workflows.recurrence.everyNHours",defaultMessage:"Every {count} hours"},{count:s});else if("day"===a)r=1===s?t.formatMessage({id:"workflows.recurrence.everyDay",defaultMessage:"Every day"}):t.formatMessage({id:"workflows.recurrence.everyNDays",defaultMessage:"Every {count} days"},{count:s});else if("week"===a){const e=i.weekdays;if(r=e&&5===e.length&&e.includes("MO")&&e.includes("TU")&&e.includes("WE")&&e.includes("TH")&&e.includes("FR")&&!e.includes("SA")&&!e.includes("SU")?t.formatMessage({id:"workflows.recurrence.everyWeekday",defaultMessage:"Every weekday"}):1===s?t.formatMessage({id:"workflows.recurrence.everyWeek",defaultMessage:"Every week"}):t.formatMessage({id:"workflows.recurrence.everyNWeeks",defaultMessage:"Every {count} weeks"},{count:s}),e&&e.length>0&&!(5===e.length&&e.includes("MO")&&e.includes("TU")&&e.includes("WE")&&e.includes("TH")&&e.includes("FR"))){const n=e.map((e=>({MO:t.formatMessage({id:"workflows.recurrence.monday",defaultMessage:"Monday"}),TU:t.formatMessage({id:"workflows.recurrence.tuesday",defaultMessage:"Tuesday"}),WE:t.formatMessage({id:"workflows.recurrence.wednesday",defaultMessage:"Wednesday"}),TH:t.formatMessage({id:"workflows.recurrence.thursday",defaultMessage:"Thursday"}),FR:t.formatMessage({id:"workflows.recurrence.friday",defaultMessage:"Friday"}),SA:t.formatMessage({id:"workflows.recurrence.saturday",defaultMessage:"Saturday"}),SU:t.formatMessage({id:"workflows.recurrence.sunday",defaultMessage:"Sunday"})}[e]))).filter(Boolean).join(", ");r+=` ${t.formatMessage({id:"workflows.recurrence.onDays",defaultMessage:"on {days}"},{days:n})}`}}else"month"===a?r=1===s?t.formatMessage({id:"workflows.recurrence.everyMonth",defaultMessage:"Every month"}):t.formatMessage({id:"workflows.recurrence.everyNMonths",defaultMessage:"Every {count} months"},{count:s}):"year"===a&&(r=1===s?t.formatMessage({id:"workflows.recurrence.everyYear",defaultMessage:"Every year"}):t.formatMessage({id:"workflows.recurrence.everyNYears",defaultMessage:"Every {count} years"},{count:s}));let l="";if("hour"!==a&&void 0!==i.hour&&void 0!==i.minute){const e=t.formatTime(new Date(2e3,0,1,i.hour,i.minute),{hour:"numeric",minute:"2-digit"});l=t.formatMessage({id:"workflows.recurrence.atTime",defaultMessage:" at {time}"},{time:e})}return(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{id:"workflows.recurrence.schedule",defaultMessage:"{schedule}{time}",values:{schedule:r,time:l}})})}const pi=(0,o().YK)({pageCreated:{defaultMessage:"Page created",id:"notionTrigger.pageCreated"},pageUpdated:{defaultMessage:"Page updated",id:"notionTrigger.pageUpdated"},pageDeleted:{defaultMessage:"Page deleted",id:"notionTrigger.pageDeleted"},databaseAgentRanOverDatabase:{defaultMessage:"Database agent ran over entire database",id:"notionTrigger.databaseAgentRanOverDatabase"},databaseAgentUpdated:{defaultMessage:"Database agent updated",id:"notionTrigger.databaseAgentUpdated"},agentRanOverEntireDatabase:{defaultMessage:"Agent ran over entire database",id:"notionTrigger.agentRanOverEntireDatabase"},scheduledTrigger:{defaultMessage:"Scheduled trigger",id:"notionTrigger.scheduledTrigger"},commentPrefix:{defaultMessage:"Comment: {textSummary}",id:"notionTrigger.commentPrefix"},newComment:{defaultMessage:"New comment",id:"notionTrigger.newComment"},resolved:{defaultMessage:"Resolved",id:"notionTrigger.resolved"},commentsCount:{defaultMessage:"{count} comments",id:"notionTrigger.commentsCount"},view:{defaultMessage:"View",id:"notionTrigger.view"},agentMentioned:{defaultMessage:"Agent mentioned",id:"notionTrigger.agentMentioned"},agentMentionedBy:{defaultMessage:"Agent mentioned by {userName}",id:"notionTrigger.agentMentionedBy"},mentionedInComment:{defaultMessage:"In comment",id:"notionTrigger.mentionedInComment"},mentionedInCommentThread:{defaultMessage:"In thread with {count} comments",id:"notionTrigger.mentionedInCommentThread"},mentionedInPage:{defaultMessage:"In page content",id:"notionTrigger.mentionedInPage"},mentionedInPersonProperty:{defaultMessage:"In {propertyName} property",id:"notionTrigger.mentionedInPersonProperty"},mentionedInDatabase:{defaultMessage:"In database property",id:"notionTrigger.mentionedInDatabase"}});var hi=()=>n(906745),vi=()=>n(597777),wi=()=>n(621627),yi=()=>n(104636),Mi=()=>n(656134);function xi(e){const{recurrenceTrigger:t,updateRecurrenceState:n}=e,r=(0,o().tz)(),a=(0,Mi().j)(),s=(0,D().K8)((()=>Fo().default.getConfig({configName:"custom_agent_sub_features"}).hourly_recurrence_triggers??!1),[]),l=(0,i.useMemo)((()=>{const e=["day","week","month","year"];return s?["hour",...e]:e}),[s]),c=(0,i.useMemo)((()=>({frequency:t.frequency,hour:t.hour,interval:t.interval,minute:t.minute,start_date:(0,vi().Rz)(hi().DateTime.local().set({hour:0,minute:0,second:0,millisecond:0}).toJSDate()),timezone:t.timezone,..."week"===t.frequency&&{weekdays:t.weekdays},..."month"===t.frequency&&{monthly_restriction:t.monthly_restriction}})),[t]),u=c?(0,yi().LS)({intl:r,recurrence:c}):(0,d.jsx)(o().sA,{id:"RecurrenceTrigger.frequency",defaultMessage:"frequency"}),g=(0,wi().$)({recurrence:c,disallowStart:!0,disallowEnd:!0,allowedFrequencies:l,onChange:e=>{e&&n(e)},disabled:!1,autoFocusIfNew:!1});return(0,d.jsx)(z().A,{alignmentToOrigin:"end",disabled:!1,originGap:0,placementToOrigin:"bottom",popupType:a,renderOrigin:e=>(0,d.jsx)(Ge,{buttonPopupEvents:e,children:u}),...g})}const ki=(0,o().YK)({recurrence:{defaultMessage:"Recurring",id:"aiWorkflow.trigger.title.recurrence"}});const bi={icon:n(181088).clockSmallIcon,configuration:"minimal",description:ki.recurrence,ConfigurationComponent:function(e){const{workflowStore:t,trigger:n,saveTrigger:o}=e,r=(0,i.useCallback)((e=>{const t={...n,state:{frequency:e.frequency,hour:e.hour,interval:e.interval,minute:e.minute,timezone:e.timezone,type:"recurrence",weekdays:e.weekdays,..."month"===e.frequency&&{monthly_restriction:e.monthly_restriction}}};o(t)}),[o,n]);if(!n.state)throw new Error("Recurrence trigger state is required");if(!t)throw new Error("Workflow store is required");return(0,d.jsx)(Ke,{children:(0,d.jsx)(Ye,{label:"Schedule",children:(0,d.jsx)(xi,{recurrenceTrigger:n.state,updateRecurrenceState:r,workflowStore:t})})})},TriggerOrRunTitle:function(e){const t=(0,o().tz)(),n=(0,l().IS)((()=>({container:{display:"flex",alignItems:"center",gap:6,minWidth:0},primary:{flexGrow:1,flexShrink:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},secondary:{color:f().Tj.text.secondary,flexShrink:0}})),[]);return(0,d.jsxs)("span",{style:n.container,children:[(0,d.jsx)("span",{style:n.primary,children:t.formatMessage(pi.scheduledTrigger)}),(0,d.jsx)("span",{style:n.secondary,children:(0,d.jsx)(mi,{trigger:e.trigger})})]})},SpecificTriggerDescription:mi};var Ci=()=>n(179034),Si=()=>n(492414);function ji(e){const{propertyIds:t,collectionStore:n,isInTranscript:i}=e,r=(0,l().IS)((()=>({title:i?{color:f().Tj.text.tertiary,fontWeight:$().Wy.medium,fontSize:14}:{fontWeight:500},propertyNames:{fontWeight:$().Wy.regular}})),[i]),a=(0,D().K8)((()=>{if(!n)return;const e=n.getSchema();return e?t.map((t=>{var n;return null===(n=e[t])||void 0===n?void 0:n.name})).filter((e=>Boolean(e))):void 0}),[t,n]);return a&&0!==a.length?(0,d.jsx)("span",{style:r.title,children:(0,d.jsx)(o().sA,{id:"workflows.modules.notion.databaseTrigger.watchingProperties",defaultMessage:"watching properties: {properties}",values:{properties:(0,d.jsx)("span",{style:r.propertyNames,children:(0,d.jsx)(o().dT,{value:a,type:"conjunction"})})}})}):null}function Ai(e,t){return(0,D().K8)((()=>{if(!e)return;const n=t.getSpaceId();return n?ii().m.createChildStore(t,{id:e,table:"collection",spaceId:n}):void 0}),[e,t])}var Ii=()=>n(755531),Ti=()=>n(717137),Di=()=>n(951500),Pi=()=>n(207207),Ri=()=>n(763824),Li=()=>n(305390),Ei=()=>n(534619);async function Wi(e){const{environment:t,workflowDefinitionPointer:n,searchQuery:o}=e,{spaceId:i}=(0,gt().kI)(n),r=(0,Ii().S)();if(!r||r.id!==i)return{results:[],total:0};return await(0,Ei().searchCollectionsWithRecents)({environment:t,collectionViewBlockStore:void 0,parentStore:r,spaceStore:r,query:o,limit:50,requireEditPermissions:!1,searchSessionId:void 0,peopleBlocksToInclude:"none"})}function Ni(e){const{workflowDefinitionPointer:t,onSelectDatabase:n,selectedDatabaseId:r,renderButton:a}=e,{buttonPopupStore:s,onClose:c,searchQuery:u,setSearchQuery:g,isLoading:m,databases:p,setIsOpen:h,spaceId:v}=function(e){const{workflowDefinitionPointer:t}=e,n=(0,Di().l)(t),o=(0,D().uB)(void 0,K().A),r=(0,i.useCallback)((()=>o.reset()),[o]),{spaceId:a}=(0,i.useMemo)((()=>n?(0,gt().kI)(n):{spaceId:void 0}),[n]),s=(0,it().v3)(),[l,d]=(0,i.useState)(""),[c,u]=(0,i.useState)(!1),[g,f]=(0,i.useState)([]),[m,p]=(0,i.useState)(!1),h=(0,zo().L)(),v=(0,i.useCallback)((async e=>{if(a&&n){u(!0);try{const t=await Wi({environment:s,workflowDefinitionPointer:n,searchQuery:e});if(!h)return void f([]);const o=t.results.map((e=>ii().m.createChildStore(h,{table:"collection",id:e}))).filter(ft().O9);await(0,Ri().lX)(o,25,(e=>e.load())),f(o)}catch(t){f([])}finally{u(!1)}}}),[s,n,a,h]);return i.useEffect((()=>{m&&v(l)}),[l,m,v]),i.useEffect((()=>{m&&v("")}),[m,v]),{buttonPopupStore:o,onClose:r,searchQuery:l,setSearchQuery:d,isLoading:c,databases:g,isOpen:m,setIsOpen:p,spaceId:a}}({workflowDefinitionPointer:t}),w=(0,o().tz)(),y=(0,Mi().j)(),M=(0,D().K8)((()=>{if(!r||!v)return;const e=(0,Ii().S)();if(!e)return;const t=ii().m.createChildStore(e,{table:"collection",id:r});return t.load(),t}),[r,v]),x=Boolean(r),k=(0,l().IS)((()=>({container:{minWidth:300,width:"max-content",maxWidth:500},searchContainer:{padding:"8px 12px",borderBottom:`1px solid ${f().Tj.border.primary}`},menuContainer:{maxHeight:"300px",overflowY:"auto"},searchIcon:{marginInlineEnd:2,flexGrow:0,flexShrink:0},emptyState:{padding:"16px 12px",textAlign:"center",color:f().Tj.text.secondary}})),[]),b=(0,i.useCallback)((e=>{var t;const o=(null===(t=e.getName())||void 0===t?void 0:t.toString())||"Untitled";n({databaseId:e.id,databaseName:o}),c()}),[n,c]),C=(0,i.useCallback)((()=>{h(!0)}),[h]),S=(0,i.useCallback)((()=>{h(!1),g(""),c()}),[h,g,c]);return(0,d.jsx)(z().A,{alignmentToOrigin:"end",buttonPopupStore:s,disabled:!1,originGap:0,placementToOrigin:"bottom",popupType:y,onOpen:C,onClose:S,renderOrigin:e=>a(e,{hasValidConfig:x,isLoading:m,selectedDatabaseStore:M}),render:()=>(0,d.jsx)(Ti().A,{debugName:"WorkflowDatabasePicker",capture:!0,allowCopyPaste:!1,children:(0,d.jsxs)("div",{style:k.container,children:[(0,d.jsx)("div",{style:k.searchContainer,children:(0,d.jsx)(dt().A,{value:u,onChange:e=>g(e.target.value),placeholder:w.formatMessage({id:"workflows.notion.databasePicker.searchPlaceholder",defaultMessage:"Search databases..."}),left:(0,d.jsx)(L().I,{icon:Pi().magnifyingGlassIcon,size:"sm",colorVariant:"secondary",style:k.searchIcon})})}),(0,d.jsx)(W().A,{menuType:E().gu.Popup,width:300,maxHeight:"300px",children:(0,d.jsx)("div",{style:k.menuContainer,children:p.length>0?p.map((e=>(0,d.jsx)(Li().A,{store:e,onClick:()=>b(e),focused:!1},e.id))):m?(0,d.jsx)("div",{style:k.emptyState,children:(0,d.jsx)(o().sA,{id:"workflows.notion.databasePicker.loading",defaultMessage:"Loading databases..."})}):(0,d.jsx)("div",{style:k.emptyState,children:u?(0,d.jsx)(o().sA,{id:"workflows.notion.databasePicker.noResultsFound",defaultMessage:"No databases found"}):(0,d.jsx)(o().sA,{id:"workflows.notion.databasePicker.startTyping",defaultMessage:"Start typing to search databases..."})})})})]})})})}function Ui(e){const{workflowDefinitionPointer:t,onSelectDatabase:n,selectedDatabaseId:i,placeholder:r}=e;return(0,d.jsx)(Ni,{workflowDefinitionPointer:t,onSelectDatabase:n,selectedDatabaseId:i,renderButton:(e,{hasValidConfig:t,isLoading:n,selectedDatabaseStore:i})=>(0,d.jsx)(Ge,{buttonPopupEvents:e,needsSetup:!t,isLoading:n,children:i?(0,d.jsx)(ai().A,{store:i,shouldWrap:!1}):n?(0,d.jsx)(o().sA,{id:"workflows.notion.databasePicker.loading",defaultMessage:"Loading databases..."}):r||(0,d.jsx)(o().sA,{id:"workflows.notion.databasePicker.selectDatabase",defaultMessage:"Select database"})})})}var Bi=()=>n(852424),Vi=()=>n(344417),_i=()=>n(419357);const Fi=(0,o().YK)({searchPlaceholder:{id:"workflow.WorkflowPropertyMultiSelector.searchPlaceholder",defaultMessage:"Search properties…"},allProperties:{id:"workflow.WorkflowPropertyMultiSelector.allProperties",defaultMessage:"All properties"},pageContent:{id:"workflow.WorkflowPropertyMultiSelector.pageContent",defaultMessage:"Page content"}});function Oi(e){const{collectionStore:t,selectedPropertyIds:n,isAllPropertiesSelected:r,onPropertySelectionChange:a,shouldIgnorePageContentUpdates:s=!1,onPageContentSelectionChange:c,disabled:u=!1}=e,g=(0,Mi().j)(),m=(0,l().DP)(),p=(0,o().tz)(),[h,v]=(0,i.useState)(""),w=(0,D().K8)((()=>t.getSchema()??{}),[t]),y=(0,D().K8)((()=>{const e=[];for(const[t,n]of Object.entries(w))n&&"formula"!==n.type&&"rollup"!==n.type&&e.push({id:t,name:n.name,type:n.type});return e.sort(((e,t)=>e.name.localeCompare(t.name)))}),[w]),M=(0,l().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:8},propertyIcon:{fill:f().Tj.icon.primary,marginInlineStart:6,marginInlineEnd:2},searchContainer:{padding:"4px 4px",borderBottom:`1px solid ${f().Tj.border.primary}`}})),[]),x=(0,i.useMemo)((()=>h?(0,eo().Ay)(h,y,(e=>e.name)):y),[y,h]),k=p.formatMessage(Fi.pageContent),b=(0,i.useMemo)((()=>!h||(0,eo().Ay)(h,[k],(e=>e)).length>0),[h,k]),C=n.length+(s?0:1),S=!r&&0===n.length&&s,j=(0,i.useCallback)((e=>{const t=n.includes(e);t?a(n.filter((t=>t!==e)),!1):t||a([...n,e],!1)}),[n,a]),A=(0,i.useCallback)((()=>{r||a([],!0)}),[r,a]);return(0,d.jsx)("div",{style:M.container,children:(0,d.jsx)(z().A,{popupType:g,alignmentToOrigin:"end",placementToOrigin:"bottom",originGap:0,disabled:u,renderOrigin:e=>(0,d.jsx)(Ge,{buttonPopupEvents:e,needsSetup:S,children:r?(0,d.jsx)(o().sA,{...Fi.allProperties}):C>0?(0,d.jsx)(o().sA,{id:"workflow.WorkflowPropertyMultiSelector.selectedCount",defaultMessage:"{count} {count, plural, one {property} other {properties}} selected",values:{count:C}}):s?y.length>0?(0,d.jsx)(o().sA,{id:"workflow.WorkflowPropertyMultiSelector.selectProperties",defaultMessage:"Select properties to watch"}):(0,d.jsx)(o().sA,{id:"workflow.WorkflowPropertyMultiSelector.noProperties",defaultMessage:"No properties available"}):(0,d.jsx)(o().sA,{id:"workflow.WorkflowPropertyMultiSelector.watchingAllChanges",defaultMessage:"Watching all changes"})}),render:()=>(0,d.jsxs)(W().A,{menuType:E().gu.Popup,width:280,maxHeight:"300px",children:[(0,d.jsx)("div",{style:M.searchContainer,children:(0,d.jsx)(_i().Ay,{inputLeft:(0,d.jsx)(_i().Zf,{icon:Vi().magnifyingGlassSmallIcon}),value:h,onChange:e=>v(e.target.value),placeholder:p.formatMessage(Fi.searchPlaceholder),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation())},focusInitial:!0,showClearButton:!0})}),(0,d.jsxs)(B().A,{children:[(0,d.jsx)(N().A,{onClick:A,title:(0,d.jsx)(o().sA,{...Fi.allProperties}),isChecked:r,focused:!1},"all-properties"),b?(0,d.jsx)(N().A,{onClick:()=>{c&&c(!s)},title:(0,d.jsx)(o().sA,{...Fi.pageContent}),isChecked:!s,focused:!1},"page-content"):null,x.map((e=>{const t=n.includes(e.id);return(0,d.jsx)(N().A,{onClick:()=>{j(e.id)},title:e.name,isChecked:t,focused:!1,icon:(0,d.jsx)(Bi().zB,{icon:void 0,type:e.type,size:16,theme:m,style:M.propertyIcon})},e.id)}))]})]})})})}function zi(e){const{store:t,collectionId:n,workflowDefinitionPointer:r,trigger:s,saveTrigger:c}=e,u=(0,l().IS)((()=>({selectorContainer:{display:"flex",flexDirection:"column",gap:8}})),[]),g=Ai(n,t),f=(0,D().K8)((()=>{if(!g)return;const e=g.getParentPointer();if(!e||e.table!==Ci().ev)return;const t=$o().B.createChildStore(g,e);return(0,Si().Ay)({store:t,fullyQualified:!1,pageVisitSource:Go().y8.LinkInPage})}),[g]),m=(0,i.useCallback)((e=>{if(s&&c&&s.state){const t={...s,state:{...s.state,collectionId:e.databaseId,..."notion.page.updated"===s.state.type&&{propertyIds:void 0,shouldIgnorePageContentUpdates:void 0}}};c(t)}}),[s,c]);return g&&f?(0,d.jsx)("div",{style:u.selectorContainer,children:(0,d.jsx)(a().Y1,{direction:"horizontal",gap:8,align:"center",children:r?(0,d.jsx)(Ui,{workflowDefinitionPointer:r,onSelectDatabase:m,selectedDatabaseId:n}):(0,d.jsx)(ai().A,{store:g,shouldWrap:!1})})}):r?(0,d.jsx)("div",{style:u.selectorContainer,children:(0,d.jsx)(Ui,{workflowDefinitionPointer:r,onSelectDatabase:m,selectedDatabaseId:n,placeholder:(0,d.jsx)(o().sA,{defaultMessage:"Select database",id:"workflow.trigger.notion.database.select"})})}):null}function Ki(e){const{store:t,collectionId:n,isInTranscript:o,propertyIds:r=[],workflowDefinitionPointer:a,trigger:s,saveTrigger:c}=e,u=(0,l().IS)((()=>({selectorContainer:{display:"flex",flexDirection:"column",gap:8}})),[]),g=Ai(n,t),f=null==s?void 0:s.state,m="notion.page.updated"===(null==f?void 0:f.type),p=m&&!(null!=f&&f.propertyIds)&&!(null!=f&&f.shouldIgnorePageContentUpdates),h=(0,i.useMemo)((()=>r.length>0?r:"notion.page.updated"===(null==f?void 0:f.type)?f.propertyIds??[]:[]),[r,f]),v=h.length>0,w=(0,i.useCallback)(((e,t)=>{if(s&&c&&s.state&&"notion.page.updated"===s.state.type){const n={...s,state:{...s.state,propertyIds:t?void 0:e.length>0?e:void 0,shouldIgnorePageContentUpdates:t?void 0:s.state.shouldIgnorePageContentUpdates,propertyFilters:t?void 0:s.state.propertyFilters}};c(n)}}),[s,c]),y=(0,i.useCallback)((e=>{if(s&&c&&s.state&&"notion.page.updated"===s.state.type){const t={...s,state:{...s.state,shouldIgnorePageContentUpdates:e}};c(t)}}),[s,c]);if(!g)return null;return m&&Boolean(c)?(0,d.jsx)("div",{style:u.selectorContainer,children:(0,d.jsx)(Oi,{collectionStore:g,selectedPropertyIds:h,isAllPropertiesSelected:p,onPropertySelectionChange:w,shouldIgnorePageContentUpdates:null==f?void 0:f.shouldIgnorePageContentUpdates,onPageContentSelectionChange:y,disabled:!a})}):v?(0,d.jsx)(ji,{propertyIds:h,collectionStore:g,isInTranscript:o}):null}var Yi=()=>n(422540),Hi=()=>n(927826),qi=()=>n(478367),$i=()=>n(214388),Gi=()=>n(383688),Qi=()=>n(112588),Ji=()=>n(477329),Zi=()=>n(27511),Xi=()=>n(36697),er=()=>n(496401),tr=()=>n(214973),nr=()=>n(798941),or=()=>n(554548),ir=()=>n(609281),rr=()=>n(947589),ar=()=>n(23986),sr=()=>n(542550),lr=()=>n(835346),dr=()=>n(89240),cr=()=>n(822961),ur=()=>n(570270),gr=()=>n(749311),fr=()=>n(798971),mr=()=>n(615028),pr=()=>n(113952),hr=()=>n(153893);const vr=(0,o().YK)({addProperty:{id:"workflow.propertyFilterAddButton.addProperty",defaultMessage:"Add property"},searchPlaceholder:{id:"workflow.propertyFilterAddButton.searchPlaceholder",defaultMessage:"Search properties…"}});function wr(e){const{collectionStore:t,selectedPropertyIds:n,onAddProperty:r,renderOrigin:a,disabled:c=!1}=e,u=(0,Mi().j)(),g=(0,l().DP)(),m=(0,o().tz)(),[p,h]=(0,i.useState)(""),v=(0,l().eP)(),w=(0,l().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:8},searchContainer:{padding:"4px 4px",borderBottom:`1px solid ${f().Tj.border.primary}`},addButton:{alignSelf:"stretch",paddingInlineStart:10,paddingInlineEnd:4,gap:8,height:38,justifyContent:"flex-start",border:`1px solid ${f().Tj.border.secondary}`,borderRadius:8},addButtonHovered:{background:f().Tj.background.secondaryTranslucent},addButtonPressed:{background:(0,O().yZ)({color:f().Tj.background.secondaryTranslucent,mode:v})},propertyIcon:{fill:f().Tj.icon.primary,marginInlineStart:6,marginInlineEnd:2}})),[v]),y=(0,D().K8)((()=>t.getSchema()??{}),[t]),M=(0,i.useMemo)((()=>{const e=[];for(const[t,n]of Object.entries(y))n&&(0,Yi().nq)(n)&&e.push({id:t,name:n.name??t,type:n.type});return e.sort(((e,t)=>e.name.localeCompare(t.name)))}),[y]),x=(0,i.useMemo)((()=>M.filter((e=>!n.includes(e.id)))),[M,n]),k=(0,i.useMemo)((()=>p?(0,eo().Ay)(p,x,(e=>e.name)):x),[x,p]),b=(0,i.useCallback)((e=>{r(e)}),[r]),C=x.length>0;return(0,d.jsx)("div",{style:w.container,children:(0,d.jsx)(z().A,{popupType:u,alignmentToOrigin:"end",placementToOrigin:"bottom",originGap:4,disabled:!C||c,renderOrigin:e=>a?a({buttonPopupEvents:e,disabled:c}):(0,d.jsx)(H().p,{...e,size:"lg",iconLeading:{icon:ge().plusSmallIcon,size:"sm",colorVariant:"secondary"},style:w.addButton,hoveredStyle:w.addButtonHovered,pressedStyle:w.addButtonPressed,disabled:!C||c,children:(0,d.jsx)(s().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,d.jsx)(o().sA,{...vr.addProperty})})}),render:e=>(0,d.jsxs)(W().A,{menuType:E().gu.Popup,width:280,maxHeight:"300px",children:[(0,d.jsx)("div",{style:w.searchContainer,children:(0,d.jsx)(_i().Ay,{inputLeft:(0,d.jsx)(_i().Zf,{icon:Vi().magnifyingGlassSmallIcon}),value:p,onChange:e=>h(e.target.value),placeholder:m.formatMessage(vr.searchPlaceholder),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation())},focusInitial:!0,showClearButton:!0})}),k.length>0?(0,d.jsx)(B().A,{children:k.map((t=>(0,d.jsx)(N().A,{onClick:()=>{b(t.id),e.close()},title:t.name,focused:!1,icon:(0,d.jsx)(Bi().zB,{icon:void 0,type:t.type,size:16,theme:g,style:w.propertyIcon})},t.id)))}):null]})})})}const yr=(0,o().YK)({summaryAnyValue:{id:"workflow.propertyFilters.summary.anyValue",defaultMessage:"Any value"},summaryIsEmpty:{id:"workflow.propertyFilters.summary.isEmpty",defaultMessage:"Is empty"},summaryIsNotEmpty:{id:"workflow.propertyFilters.summary.isNotEmpty",defaultMessage:"Is not empty"},summaryCheckboxChecked:{id:"workflow.propertyFilters.summary.checkboxChecked",defaultMessage:"Checked"},summaryCheckboxUnchecked:{id:"workflow.propertyFilters.summary.checkboxUnchecked",defaultMessage:"Unchecked"},summaryStatusIs:{id:"workflow.propertyFilters.summary.statusIs",defaultMessage:"Is"},summaryStatusIsNot:{id:"workflow.propertyFilters.summary.statusIsNot",defaultMessage:"Is not"},summaryStatusGroup:{id:"workflow.propertyFilters.summary.statusGroup",defaultMessage:"Group: {groupName}"},summaryPersonRelativeMe:{id:"workflow.propertyFilters.summary.person.relativeMe",defaultMessage:"Me"},summaryPersonExactCount:{id:"workflow.propertyFilters.summary.person.count",defaultMessage:"{count, plural, one {# person} other {# people}}"},summaryRelationExactCount:{id:"workflow.propertyFilters.summary.relation.count",defaultMessage:"{count, plural, one {# page} other {# pages}}"},summaryRelationRelative:{id:"workflow.propertyFilters.summary.relation.relative",defaultMessage:"Relative"},removePropertyAriaLabel:{id:"workflow.propertyFilters.removeProperty.ariaLabel",defaultMessage:"Remove property filter"}});function Mr(e){const{store:t,collectionId:n,isInTranscript:r,workflowDefinitionPointer:c,trigger:u,saveTrigger:g}=e,f=(0,l().IS)((()=>({selectorContainer:{display:"flex",flexDirection:"column",gap:6,marginTop:8,marginBottom:2}})),[]),m=Ai(n,t),p=null==u?void 0:u.state,h="notion.page.updated"===(null==p?void 0:p.type),[v,w]=(0,i.useState)([]),y=(0,i.useMemo)((()=>{var e;return null!=p&&p.propertyFilters?p.propertyFilters:{type:"all",all:(null==p||null===(e=p.propertyIds)||void 0===e?void 0:e.map((e=>({property:e,filter:{operator:"changes_to_any"}}))))??[]}}),[null==p?void 0:p.propertyFilters,null==p?void 0:p.propertyIds]),M=(0,i.useCallback)((e=>{if(u&&g&&u.state&&"notion.page.updated"===u.state.type){const t={...y};let n=[];if("all"===t.type){const o=[...t.all??[]];o.push({property:e,filter:{operator:"changes_to_any"}}),n=o.map((e=>e.property)),t.all=o}else if("some"===t.type){const o=[...t.some??[]];o.push({property:e,filter:{operator:"changes_to_any"}}),n=o.map((e=>e.property)),t.some=o}const o={...u,state:{...u.state,propertyIds:n,propertyFilters:t}};w((t=>[...t,e])),g(o)}}),[u,g,y]),x=(0,i.useCallback)((e=>{var t;if(!u||!g||!u.state)return;const n={...y};var o;if("all"===n.type)n.all=null===(o=n.all)||void 0===o?void 0:o.filter((t=>t.property!==e));else if("some"===n.type){var i;n.some=null===(i=n.some)||void 0===i?void 0:i.filter((t=>t.property!==e))}const r={...u,state:{...u.state,propertyIds:null===(t=u.state.propertyIds)||void 0===t?void 0:t.filter((t=>t!==e)),propertyFilters:n}};w((t=>t.filter((t=>t!==e)))),g(r)}),[y,g,u]),k=Boolean(null==p?void 0:p.shouldIgnorePageContentUpdates),b=(0,i.useCallback)((()=>{if(u&&g&&u.state&&"notion.page.updated"===u.state.type){const e={...u,state:{...u.state,shouldIgnorePageContentUpdates:!k}};g(e)}}),[u,g,k]),C=(0,i.useCallback)((e=>{if(u&&g&&u.state&&"notion.page.updated"===u.state.type){const n={...y};if("all"===n.type){var t;const o={property:e.propertyId,filter:e.filter};n.all=null===(t=n.all)||void 0===t?void 0:t.map((t=>t.property===e.propertyId?o:t))}else if("some"===n.type){const t={property:e.propertyId,filter:e.filter},o=n.some??[];n.some=o.map((n=>n.property===e.propertyId?t:n))}const o={...u,state:{...u.state,propertyFilters:n}};w((t=>t.filter((t=>t!==e.propertyId)))),g(o)}}),[u,g,y]),S=(0,D().K8)((()=>Fo().default.getConfig({configName:"custom_agent_sub_features"}).property_trigger_filters),[]),j=h&&Boolean(g);if(!m)return null;const A=Tr(y).map((e=>e.property));return j?(0,d.jsxs)("div",{style:f.selectorContainer,children:[(0,d.jsxs)(a().Y1,{direction:"horizontal",gap:"auto",style:{paddingInlineEnd:2},children:[(0,d.jsx)(s().D,{styleKey:"caption",colorVariant:"secondary",children:(0,d.jsx)(o().sA,{id:"workflow.propertyFilters.contentEditedToggle",defaultMessage:"Trigger when page content edited"})}),(0,d.jsx)(je().A,{on:!k,onClick:b})]}),(0,d.jsx)(br,{addedPropertyIds:v,collectionStore:m,propertyFilters:y,onFilterChange:C,recordStore:t,onRemoveProperty:x,isEditable:j,canEditFilters:S}),(0,d.jsx)(wr,{collectionStore:m,selectedPropertyIds:A,onAddProperty:M,shouldIgnorePageContentUpdates:null==p?void 0:p.shouldIgnorePageContentUpdates,disabled:!c})]}):(0,d.jsx)(ji,{propertyIds:A,collectionStore:m,isInTranscript:r})}function xr(e){return void 0===e?[]:Array.isArray(e)?e:[e]}function kr(e){const{filter:t,intl:n}=e;if(!t||"changes_to_any"===t.operator)return n.formatMessage(yr.summaryAnyValue);switch(t.operator){case"is_empty":return n.formatMessage(yr.summaryIsEmpty);case"is_not_empty":return n.formatMessage(yr.summaryIsNotEmpty);case"checkbox_is":{var o;const e=null===(o=xr(t.value)[0])||void 0===o?void 0:o.value;return!0===e?n.formatMessage(yr.summaryCheckboxChecked):!1===e?n.formatMessage(yr.summaryCheckboxUnchecked):n.formatMessage(yr.summaryCheckboxChecked)}case"enum_contains":case"enum_does_not_contain":case"enum_is":case"enum_is_not":{const e=n.formatMessage(pr()._c[t.operator].text),o=xr(t.value).map((e=>e.value)).filter(ft().O9);return o.length>0?`${e}: ${o.join(", ")}`:e}case"person_contains":case"person_does_not_contain":{const e=n.formatMessage(fr().fJ[t.operator].text),o=[];if((0,qi().I)(t)){const e=(0,Hi().W)(t),i=e.filter((e=>"relative"===e.type));i.length>0&&o.push(n.formatMessage(yr.summaryPersonRelativeMe));const r=e.filter((e=>"exact"===e.type&&(0,ft().O9)(e.value))).length;r>0&&o.push(n.formatMessage(yr.summaryPersonExactCount,{count:r}))}return o.length>0?`${e}: ${o.join(", ")}`:e}case"status_is":case"status_is_not":{const e="status_is"===t.operator?n.formatMessage(yr.summaryStatusIs):n.formatMessage(yr.summaryStatusIsNot),o=function(e,t){return e.map((e=>{if((0,ft().O9)(e.value))return"is_group"===e.type?t.formatMessage(yr.summaryStatusGroup,{groupName:e.value}):e.value})).filter(ft().O9)}((0,$i().V6)(t),n);return o.length>0?`${e}: ${o.join(", ")}`:e}case"string_is":case"string_is_not":case"string_contains":case"string_does_not_contain":case"string_starts_with":case"string_ends_with":{const e=n.formatMessage(hr().bK[t.operator].text),o=t.value.value;return(0,ft().O9)(o)&&""!==o?`${e} “${o}”`:e}case"number_equals":case"number_does_not_equal":case"number_greater_than":case"number_greater_than_or_equal_to":case"number_less_than":case"number_less_than_or_equal_to":{const e=n.formatMessage(gr().$R[t.operator].text),o=t.value.value;return(0,ft().O9)(o)?`${e} ${o}`:e}case"relation_contains":case"relation_does_not_contain":{const e=n.formatMessage(mr().Yx[t.operator].text),o=(0,$i().Rh)(t),i=[],r=o.filter((e=>"exact"===e.type&&(0,ft().O9)(e.value))).length;return r>0&&i.push(n.formatMessage(yr.summaryRelationExactCount,{count:r})),o.some((e=>"relative"===e.type))&&i.push(n.formatMessage(yr.summaryRelationRelative)),i.length>0?`${e}: ${i.join(", ")}`:e}default:return t.operator}}function br(e){const{collectionStore:t,propertyFilters:n,onFilterChange:r,recordStore:a,onRemoveProperty:s,isEditable:c=!1,canEditFilters:u=!1,addedPropertyIds:g}=e,f=(0,o().tz)(),m=(0,D().K8)((()=>t.getSchema()??{}),[t]),p=(0,i.useMemo)((()=>[]),[]),h=(0,i.useCallback)(((e,n,o,i)=>{const s=new(ur().K8);s.setState({stack:[{type:"propertyChangedFilter",property:e}]});const l=t=>{r({propertyId:e,filter:!0===t.anyOptionCheckState?{operator:"changes_to_any"}:t.filter}),i()},c=g.includes(e),u={menuStore:s,onClose:i,propertyChangedFilter:o,propertyId:e,shouldUseDefaultPropertyOperator:c};if(!(0,Yi().nq)(n))return null;switch(n.type){case"select":case"multi_select":return(0,d.jsx)(lr().$,{...u,propertySchema:n,onCommit:l});case"status":return(0,d.jsx)(dr().r,{menuStore:s,onClose:i,onCommit:l,propertyChangedFilter:o,propertyId:e,propertySchema:n});case"checkbox":return(0,d.jsx)(ir().Y,{menuStore:s,onClose:i,onCommit:l,propertyChangedFilter:o,propertyId:e,propertySchema:n});case"person":return(0,d.jsx)(ar().y,{menuStore:s,onClose:i,onCommit:l,propertyChangedFilter:o,propertyId:e,propertySchema:n,shouldUseDefaultPropertyOperator:c,collectionStore:t,parentRecordStore:a,formulaTypecheckContextValues:p});case"text":case"title":case"url":case"email":case"phone_number":return(0,d.jsx)(cr().E,{menuStore:s,onClose:i,onCommit:l,propertyChangedFilter:o,propertyId:e,propertySchema:n,shouldUseDefaultPropertyOperator:c,parentRecordStore:a,formulaTypecheckContextValues:p});case"number":return(0,d.jsx)(rr().Q,{menuStore:s,onClose:i,onCommit:l,propertyChangedFilter:o,propertyId:e,propertySchema:n,shouldUseDefaultPropertyOperator:c,parentRecordStore:a,formulaTypecheckContextValues:p});case"relation":return(0,d.jsx)(sr().R,{menuStore:s,onClose:i,onCommit:l,propertyChangedFilter:o,propertyId:e,propertySchema:n,shouldUseDefaultPropertyOperator:c,collectionStore:t,parentRecordStore:a,formulaTypecheckContextValues:p});default:return(0,ft().HB)(n)}}),[t,r,a,p,g]),v=(0,l().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:8}})),[]),w=Tr(n);return(0,d.jsx)("div",{style:v.container,children:w.map((e=>{const{property:n,filter:o}=e,i=m[n];if(!i)return null;if(!(0,Yi().nq)(i))return null;const r=kr({filter:o,intl:f});return(0,d.jsx)(Cr,{propertyId:n,propertySchema:i,propertyFilter:o,summary:r,renderMenuForProperty:h,onRemoveProperty:s,canEditFilters:u,isEditable:c,recordStore:a,collectionStore:t},n)}))})}function Cr(e){const{propertyId:t,propertySchema:n,propertyFilter:r,summary:a,renderMenuForProperty:s,onRemoveProperty:c,canEditFilters:u,isEditable:g,recordStore:m,collectionStore:p}=e,h=(0,o().tz)(),v=function(){const e=(0,l().eP)();return(0,l().IS)((()=>({rowButton:{alignItems:"center",background:f().Tj.background.primary,border:`1px solid ${f().Tj.border.secondary}`,borderRadius:8,display:"flex",gap:8,padding:"6px 8px",width:"100%",justifyContent:"space-between",minHeight:38},rowButtonHovered:{background:f().Tj.background.secondaryTranslucent},rowButtonPressed:{background:(0,O().yZ)({color:f().Tj.background.secondaryTranslucent,mode:e})},rowContent:{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0},iconWrapper:{alignItems:"center",background:f().Tj.background.secondaryTranslucent,borderRadius:6,display:"flex",height:28,justifyContent:"center",width:28,flex:"none"},display:{display:"flex",alignItems:"center",flex:1,minWidth:0,flexWrap:"wrap",gap:4},relationList:{display:"flex",flexDirection:"column",gap:6,marginBlockStart:6},relationListItem:{display:"flex",alignItems:"center",gap:6,minWidth:0},fallback:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:6},propertyName:{fontWeight:$().Wy.medium},summaryText:{color:f().Tj.text.secondary},removeButton:{flex:"none",marginInlineStart:8}})),[e])}(),[w,y]=(0,i.useState)(!1),M=n.name??t,x=(0,D().K8)((()=>{const e=(0,d.jsxs)("div",{style:v.fallback,children:[(0,d.jsx)("span",{style:v.propertyName,children:M}),(0,d.jsx)("span",{style:v.summaryText,children:a})]});return function(e){const{propertyId:t,propertySchema:n,propertyFilter:i,intl:r,recordStore:a,styles:s,collectionStore:l}=e,{operator:c}=i;if("changes_to_any"===c){const e=(0,d.jsx)("span",{style:s.propertyName,children:n.name??t});return(0,d.jsx)("div",{style:s.display,children:(0,tr().Od)(r,{propertyName:e})})}if("status"===n.type&&("status_is"===c||"status_is_not"===c)){const e=(0,$i().V6)(i),o=e.map((e=>"is_group"===e.type?e.value:void 0)).filter(ft().O9),a=e.map((e=>"is_option"===e.type?e.value:void 0)).filter(ft().O9),s=(0,Zi().a)({intl:r,groupValues:o,optionValues:a,propertySchema:n});return(0,d.jsx)(jr,{propertyName:n.name??t,statusValues:s})}if("person"===n.type&&("person_contains"===c||"person_does_not_contain"===c)){const e=i,l=(0,Qi().Y)(e,a.getRecordModel),c=(0,Hi().W)(e).filter((e=>"relative"===e.type)).map((()=>r.formatMessage(yr.summaryPersonRelativeMe))),u=[...l.map((e=>(0,fr().Mn)(r,e))).filter(ft().O9),...c];if(0===u.length)return;const g=(0,d.jsx)("span",{style:s.propertyName,children:n.name??t}),f=r.formatList(u,{style:"long",type:"conjunction"}),m=(0,er().d)(f),p="person_contains"===e.operator?1===u.length?tr().a9:tr()._d:1===u.length?tr().dd:tr().Fp;return(0,d.jsx)(o().sA,{...p({propertyName:g,propertyValues:m})})}if("relation"===n.type&&("relation_contains"===c||"relation_does_not_contain"===c)){const e=i,a=(0,$i().Rh)(e),u=a.map(((e,t)=>"exact"===e.type&&e.value?{key:`relation-${e.value}`,node:(0,d.jsx)(or().A,{blockId:e.value,parentStore:l,format:Xn().NY.Medium,isSingle:a.length<=1,noUnderline:!0,disableLinks:!0,shouldShrink:!0},`relation-token-${e.value}`)}:"relative"===e.type?{key:`relation-relative-${t}`,node:(0,d.jsx)("span",{style:s.summaryText,children:r.formatMessage(yr.summaryRelationRelative)})}:void 0)).filter(ft().O9);if(0===u.length)return;const g=(0,d.jsx)("span",{style:s.propertyName,children:n.name??t});if(1===u.length){const e="relation_contains"===c?tr().TF:tr()._f;return(0,d.jsx)("div",{style:s.display,children:(0,d.jsx)(o().sA,{...e({propertyName:g,propertyValue:u[0].node})})})}const f="relation_contains"===c?tr().JQ:tr().SV;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{style:s.display,children:(0,d.jsx)(o().sA,{...f({propertyName:g,propertyValue:[]})})}),(0,d.jsx)("div",{style:s.relationList,children:u.map((e=>(0,d.jsx)("div",{style:s.relationListItem,children:e.node},e.key)))})]})}if("select"===n.type&&("enum_is"===c||"enum_is_not"===c))return(0,d.jsx)(Ar,{propertySchema:n,filter:i,propertyName:n.name??t});if("multi_select"===n.type&&("enum_contains"===c||"enum_does_not_contain"===c))return(0,d.jsx)(Ar,{propertySchema:n,filter:i,propertyName:n.name??t});if("checkbox"===n.type&&("checkbox_is"===c||"checkbox_is_not"===c))return(0,d.jsx)(Ir,{propertySchema:n,filter:i});if("number"===n.type&&("number_equals"===c||"number_does_not_equal"===c||"number_greater_than"===c||"number_greater_than_or_equal_to"===c||"number_less_than"===c||"number_less_than_or_equal_to"===c))return(0,d.jsx)(Sr,{filter:i,propertySchema:n});return}({propertyId:t,propertySchema:n,propertyFilter:r,intl:h,recordStore:m,styles:v,collectionStore:p})??e}),[t,n,r,h,m,v,M,a,p]),k=(0,i.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),c(t)}),[c,t]);return(0,d.jsx)(z().A,{disabled:!u,popupType:Jt().n.Popup,renderOrigin:e=>(0,d.jsxs)(H().p,{...(0,$e().A)(e),size:"sm",style:{...v.rowButton},hoveredStyle:v.rowButtonHovered,pressedStyle:v.rowButtonPressed,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),children:[(0,d.jsxs)("div",{style:v.rowContent,children:[(0,d.jsx)("div",{style:v.iconWrapper,children:(0,d.jsx)(Xi().P,{propertySchema:n})}),(0,d.jsx)("div",{style:v.display,children:x})]}),(0,d.jsx)(Gt().A,{visible:w&&g,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,d.jsx)(te().A,{disabled:!g,icon:on().xMarkSmallIcon,onClick:k,ariaLabel:h.formatMessage(yr.removePropertyAriaLabel),style:{...v.removeButton,visibility:w?"visible":"hidden"}})})]}),render:e=>s(t,n,r,(()=>e.close()))})}function Sr(e){const{filter:t,propertySchema:n}=e,{title:o,styles:i}=(0,nr().aR)({numberValue:t.value.value,operator:t.operator,propertySchema:n,messageType:"trigger"});return(0,d.jsx)("div",{style:i.content,children:o})}function jr(e){const{propertyName:t,statusValues:n}=e,i=(0,o().tz)(),r=(0,l().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",lineHeight:1.6,whiteSpace:"pre"},propertyName:{...$().RC,fontWeight:$().Wy.medium}})),[]),a=i.formatList(n,{style:"long",type:"disjunction"});return(0,d.jsx)("div",{style:r.content,children:(0,tr().Yx)(i,{propertyName:(0,d.jsx)("span",{style:r.propertyName,children:t}),propertyValues:(0,er().d)(a)})})}function Ar(e){const{propertySchema:t,filter:n,propertyName:i}=e,r=(0,o().tz)(),a=(0,l().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",lineHeight:1.6,whiteSpace:"pre"},propertyName:{...$().RC,fontWeight:$().Wy.medium}})),[]),s=(0,Ji().l5)({filter:n,propertySchema:t});if(!s)return null;const c=(0,Ji().JI)(s),u=n.value,g=(Array.isArray(u)?u:[u]).map((e=>e.value)).filter(ft().O9),f=(0,Ji().$5)({intl:r,optionValues:g,propertySchema:t}),m=r.formatList(f,{style:"long",type:"disjunction"}),p=c(r,{propertyName:(0,d.jsx)("span",{style:a.propertyName,children:i}),propertyValues:(0,er().d)(m)});return(0,d.jsx)("div",{style:a.content,children:p})}function Ir(e){const{propertySchema:t,filter:n}=e,i=(0,o().tz)(),r=(0,l().IS)((()=>({propertyName:{...$().RC,fontWeight:$().Wy.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),a=(0,Gi().jl)({filter:n,intl:i,propertySchema:t,styles:r});return(0,d.jsx)("span",{style:r.wrap,children:a})}function Tr(e){if(e){if("some"===e.type)return e.some??[];if("all"===e.type)return e.all??[]}return[]}const Dr=(0,o().YK)({sendNotification:{defaultMessage:"Send notification",id:"workflows.modules.notion.sendNotification.description"},pageDiscussionCommentAdded:{defaultMessage:"Comment added to page",id:"aiWorkflow.trigger.title.notion.page.discussion.comment.added"},databasePageCreated:{defaultMessage:"Page added to database",id:"aiWorkflow.trigger.title.notion.page.created"},databasePageUpdated:{defaultMessage:"Page updated in database",id:"aiWorkflow.trigger.title.notion.page.updated"},databasePageDeleted:{defaultMessage:"Page removed from database",id:"aiWorkflow.trigger.title.notion.page.deleted"},databaseAgentUpdated:{defaultMessage:"Database agent updated",id:"aiWorkflow.trigger.title.notion.database.agent.updated"},buttonPressed:{defaultMessage:"Button pressed",id:"aiWorkflow.trigger.title.notion.button.pressed"},agentMentioned:{defaultMessage:"When this agent is mentioned",id:"aiWorkflow.trigger.title.notion.agent.mentioned"},getPageDiscussions:{defaultMessage:"Got the discussions for a page",id:"workflow.run.effect.discussions.getPageDiscussions.description"},addCommentToDiscussion:{defaultMessage:"Added a comment to a discussion",id:"workflow.run.effect.discussions.addCommentToDiscussion.description"},createDatabase:{defaultMessage:"Created database",id:"workflow.run.effect.notion.createDatabase.description"},createAgent:{defaultMessage:"Created agent",id:"workflow.run.effect.notion.createAgent.description"},loadAgent:{defaultMessage:"Loaded agent",id:"workflow.run.effect.notion.loadAgent.description"},loadAgentLoading:{defaultMessage:"Loading agent",id:"workflow.run.effect.notion.loadAgent.loading"},loadUser:{defaultMessage:"Loaded user",id:"workflow.run.effect.notion.loadUser.description"},loadUserLoading:{defaultMessage:"Loading user",id:"workflow.run.effect.notion.loadUser.loading"},loadDatabase:{defaultMessage:"Loaded database",id:"workflow.run.effect.notion.loadDatabase.description"},loadDatabaseLoading:{defaultMessage:"Loading database",id:"workflow.run.effect.notion.loadDatabase.loading"},loadDataSource:{defaultMessage:"Loaded data source",id:"workflow.run.effect.notion.loadDataSource.description"},loadDataSourceLoading:{defaultMessage:"Loading data source",id:"workflow.run.effect.notion.loadDataSource.loading"},getFormulaValue:{defaultMessage:"Got formula value",id:"workflow.run.effect.notion.getFormulaValue.description"},getFormulaValueLoading:{defaultMessage:"Getting formula value",id:"workflow.run.effect.notion.getFormulaValue.loading"},loadPage:{defaultMessage:"Loaded page",id:"workflow.run.effect.notion.loadPage.description"},loadPageLoading:{defaultMessage:"Loading page",id:"workflow.run.effect.notion.loadPage.loading"},createPage:{defaultMessage:"Created page",id:"workflow.run.effect.notion.createPage.description"},createPageLoading:{defaultMessage:"Creating page",id:"workflow.run.effect.notion.createPage.loading"},updatePage:{defaultMessage:"Updated page",id:"workflow.run.effect.notion.updatePage.description"},updatePageLoading:{defaultMessage:"Updating page",id:"workflow.run.effect.notion.updatePage.loading"},updateDatabase:{defaultMessage:"Updated database",id:"workflow.run.effect.notion.updateDatabase.description"},updateAgent:{defaultMessage:"Updated agent",id:"workflow.run.effect.notion.updateAgent.description"},sendNotificationLoading:{defaultMessage:"Sending notification",id:"workflows.modules.notion.sendNotification.loading"},getPageDiscussionsLoading:{defaultMessage:"Getting the discussions for a page",id:"workflow.run.effect.discussions.getPageDiscussions.loading"},addCommentToDiscussionLoading:{defaultMessage:"Adding a comment to a discussion",id:"workflow.run.effect.discussions.addCommentToDiscussion.loading"},createDatabaseLoading:{defaultMessage:"Creating database",id:"workflow.run.effect.notion.createDatabase.loading"},createAgentLoading:{defaultMessage:"Creating agent",id:"workflow.run.effect.notion.createAgent.loading"},updateDatabaseLoading:{defaultMessage:"Updating database",id:"workflow.run.effect.notion.updateDatabase.loading"},updateAgentLoading:{defaultMessage:"Updating agent",id:"workflow.run.effect.notion.updateAgent.loading"},querySql:{defaultMessage:"Ran SQL query",id:"workflow.run.effect.notion.querySql.description"},querySqlLoading:{defaultMessage:"Running SQL query",id:"workflow.run.effect.notion.querySql.loading"},queryView:{defaultMessage:"Queried view",id:"workflow.run.effect.notion.queryView.description"},queryViewLoading:{defaultMessage:"Querying view",id:"workflow.run.effect.notion.queryView.loading"},viewFileUrl:{defaultMessage:"Viewed a Notion file",id:"workflow.run.effect.notion.viewFileUrl.description"},viewFileUrlLoading:{defaultMessage:"Viewing a Notion file",id:"workflow.run.effect.notion.viewFileUrl.loading"}});function Pr(e){var t;const{trigger:n,workflowStore:o,isInTranscript:r,workflowDefinitionPointer:a,saveTrigger:s}=e;if(!n.state)throw new Error("Trigger state is required");if(!o)throw new Error("Block store is required - is this running inside of a thread?");const l="notion.page.updated"===n.state.type?null===(t=n.state)||void 0===t?void 0:t.propertyIds:void 0,c=(0,D().K8)((()=>Fo().default.getConfig({configName:"custom_agent_sub_features"}).property_trigger_filters),[]),u="notion.page.created"===n.state.type&&0!==n.state.debounceTimeoutSeconds,g=(0,i.useCallback)((()=>{var e;if("notion.page.created"!==(null===(e=n.state)||void 0===e?void 0:e.type))return;const t={...n,state:{...n.state,debounceTimeoutSeconds:u?0:void 0}};s(t)}),[n,s,u]);return(0,d.jsxs)(Ke,{children:[(0,d.jsx)(Ye,{label:"Database",footer:"notion.page.updated"===n.state.type&&n.state.collectionId&&c?(0,d.jsx)(Mr,{store:o,collectionId:n.state.collectionId,propertyIds:l,isInTranscript:r,workflowDefinitionPointer:a,trigger:n,saveTrigger:s}):void 0,children:(0,d.jsx)(zi,{store:o,collectionId:n.state.collectionId,isInTranscript:r,workflowDefinitionPointer:a,trigger:n,saveTrigger:s})}),"notion.page.updated"!==n.state.type||c?void 0:(0,d.jsx)(Ye,{label:"Properties",children:(0,d.jsx)(Ki,{store:o,collectionId:n.state.collectionId,propertyIds:l,isInTranscript:r,workflowDefinitionPointer:a,trigger:n,saveTrigger:s})}),"notion.page.created"===n.state.type?(0,d.jsx)(Ye,{label:"Wait for edits to finish",children:(0,d.jsx)(je().A,{on:u,onClick:g})}):void 0]})}const Rr={triggers:{recurrence:bi,"notion.page.discussion.comment.added":{icon:n(566531).w,configuration:"minimal",description:Dr.pageDiscussionCommentAdded,ConfigurationComponent:Pr,TriggerOrRunTitle:function(e){const t=(0,o().tz)(),{data:n}=e,i=null==n?void 0:n.comment,r=null!=i&&i.text?i.text.length>60?i.text.substring(0,60)+"…":i.text:null;return r?(0,d.jsx)(d.Fragment,{children:t.formatMessage(pi.commentPrefix,{textSummary:r})}):(0,d.jsx)(d.Fragment,{children:t.formatMessage(pi.newComment)})},TriggerContent:function(e){const t=(0,o().tz)(),{data:n}=e;if(!n)return null;const i=n.comment,r=n.discussion,a=i.text,s=i.timestamp;if(!a)return null;const l=[null!=r&&r.resolved?(0,d.jsx)("span",{children:t.formatMessage(pi.resolved)},"resolved"):null,null!=r&&r.comments&&r.comments.length>1?(0,d.jsx)("span",{children:t.formatMessage(pi.commentsCount,{count:r.comments.length})},"comments"):null,s?(0,d.jsx)("span",{children:new Date(s).toLocaleTimeString()},"timestamp"):null,i.url?(0,d.jsxs)("span",{children:["— ",(0,d.jsx)(Zo,{href:i.url,children:t.formatMessage(pi.view)})]},"link"):null].filter(Boolean);return(0,d.jsx)(Jo,{text:a,metadata:l.length>0?l:void 0})},SpecificTriggerDescription:function(e){const{trigger:t}=e,{state:n}=t,i=si(null==n?void 0:n.collectionId);return n&&n.collectionId?(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"When a comment is added to pages in {dataSource}",id:"notionTrigger.pageDiscussionCommentConfig.withDatabase",values:{dataSource:i?(0,d.jsx)(di,{store:i}):null}})}):(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"When a comment is added to a page discussion",id:"notionTrigger.pageDiscussionCommentConfig.default"})})}},"notion.page.created":{icon:Oo().a,configuration:"minimal",description:Dr.databasePageCreated,ConfigurationComponent:Pr,TriggerOrRunTitle:ci,TriggerContent:oi,SpecificTriggerDescription:ci},"notion.button.pressed":{icon:Oo().a,configuration:"minimal",description:Dr.buttonPressed,TriggerOrRunTitle:ui,SpecificTriggerDescription:ui},"notion.page.updated":{icon:Oo().a,configuration:"minimal",description:Dr.databasePageUpdated,ConfigurationComponent:Pr,TriggerOrRunTitle:gi,TriggerContent:oi,SpecificTriggerDescription:gi},"notion.page.deleted":{icon:Oo().a,configuration:"minimal",description:Dr.databasePageDeleted,ConfigurationComponent:Pr,TriggerOrRunTitle:fi,TriggerContent:oi,SpecificTriggerDescription:fi},"notion.database.agent.updated":{icon:n(412237).aiFaceSmallIcon,configuration:"minimal",description:Dr.databaseAgentUpdated,ConfigurationComponent:Pr,TriggerOrRunTitle:function(e){const t=(0,o().tz)(),{data:n}=e,i=null==n?void 0:n.shouldRunOverDatabase;return(0,d.jsx)("span",{children:i?t.formatMessage(pi.databaseAgentRanOverDatabase):t.formatMessage(pi.databaseAgentUpdated)})},TriggerContent:function(e){const t=(0,o().tz)(),{data:n}=e;return n&&n.runtimeInstructions?(0,d.jsx)(Jo,{text:n.runtimeInstructions||void 0,metadata:n.shouldRunOverDatabase?(0,d.jsx)("span",{children:t.formatMessage(pi.agentRanOverEntireDatabase)}):void 0}):null},SpecificTriggerDescription:function(e){const{trigger:t}=e,{state:n}=t,i=si(null==n?void 0:n.collectionId);return n&&n.collectionId?(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"When database agent is updated for {dataSource}",id:"notionTrigger.databaseAgentUpdatedConfig.withDatabase",values:{dataSource:i?(0,d.jsx)(di,{store:i}):null}})}):(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"When a database agent is updated",id:"notionTrigger.databaseAgentUpdatedConfig.default"})})}},"notion.agent.mentioned":{icon:n(70899).U,configuration:"minimal",description:Dr.agentMentioned,ConfigurationComponent:function(e){return null},TriggerOrRunTitle:function(e){var t;const n=(0,o().tz)(),{data:i}=e;return null!=i&&null!==(t=i.mentionedBy)&&void 0!==t&&t.userName?(0,d.jsx)(d.Fragment,{children:n.formatMessage(pi.agentMentionedBy,{userName:i.mentionedBy.userName})}):(0,d.jsx)(d.Fragment,{children:n.formatMessage(pi.agentMentioned)})},TriggerContent:function(e){var t;const n=(0,o().tz)(),{data:i}=e;if(!i)return null;let r,a;"comment"===i.mentionLocation&&i.comment?(r=i.comment.text,a=i.comment.url):"person_property"===i.mentionLocation?(r=void 0,i.page&&"string"==typeof i.page.url&&(a=i.page.url)):(r=i.content,i.page&&"string"==typeof i.page.url&&(a=i.page.url));const s=["comment"===i.mentionLocation&&null!==(t=i.discussion)&&void 0!==t&&t.comments&&i.discussion.comments.length>1?(0,d.jsx)("span",{children:n.formatMessage(pi.mentionedInCommentThread,{count:i.discussion.comments.length})},"comments"):"comment"===i.mentionLocation?(0,d.jsx)("span",{children:n.formatMessage(pi.mentionedInComment)},"location"):"person_property"===i.mentionLocation?(0,d.jsx)("span",{children:i.propertyName?n.formatMessage(pi.mentionedInPersonProperty,{propertyName:i.propertyName}):n.formatMessage(pi.mentionedInDatabase)},"location"):(0,d.jsx)("span",{children:n.formatMessage(pi.mentionedInPage)},"location"),a?(0,d.jsxs)("span",{children:["— ",(0,d.jsx)(Zo,{href:a,children:n.formatMessage(pi.view)})]},"link"):null].filter(Boolean);return(0,d.jsx)(Jo,{text:r,metadata:s.length>0?s:void 0})},SpecificTriggerDescription:function(e){return(0,d.jsx)(li,{children:(0,d.jsx)(o().sA,{defaultMessage:"When this agent is mentioned in Notion",id:"notionTrigger.agentMentionedConfig.default"})})}}},effect:{"notion.sendNotification":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.sendNotificationLoading:Dr.sendNotification)},"notion.getPageDiscussions":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.getPageDiscussionsLoading:Dr.getPageDiscussions)},"notion.addCommentToDiscussion":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.addCommentToDiscussionLoading:Dr.addCommentToDiscussion)},"notion.loadAgent":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.loadAgentLoading:Dr.loadAgent)},"notion.loadUser":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.loadUserLoading:Dr.loadUser)},"notion.createDatabase":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.createDatabaseLoading:Dr.createDatabase)},"notion.createAgent":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.createAgentLoading:Dr.createAgent)},"notion.updateDatabase":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.updateDatabaseLoading:Dr.updateDatabase)},"notion.updateAgent":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.updateAgentLoading:Dr.updateAgent)},"notion.loadDatabase":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.loadDatabaseLoading:Dr.loadDatabase)},"notion.loadDataSource":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.loadDataSourceLoading:Dr.loadDataSource)},"notion.getFormulaValue":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.getFormulaValueLoading:Dr.getFormulaValue)},"notion.loadPage":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.loadPageLoading:Dr.loadPage)},"notion.createPage":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.createPageLoading:Dr.createPage)},"notion.updatePage":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.updatePageLoading:Dr.updatePage)},"notion.querySql":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.querySqlLoading:Dr.querySql)},"notion.queryView":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.queryViewLoading:Dr.queryView)},"notion.queryThreads":{runDefinitionType:"minimal",getDescription:()=>"Query threads (script-only)"},"notion.investigateThread":{runDefinitionType:"minimal",getDescription:()=>"Investigate thread (script-only)"},"notion.createAndRunThread":{runDefinitionType:"minimal",getDescription:()=>"Create and run thread (script-only)"},"notion.viewFileUrl":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Dr.viewFileUrlLoading:Dr.viewFileUrl)}},ModuleConfiguration:function(e){const{module:t,saveModule:o,store:i,workflowDefinitionPointer:r,workflowModuleStore:a,workflow:s}=e;return(0,d.jsx)(n(680849).C,{moduleValue:t,saveModule:o,store:i,workflowDefinitionPointer:r,workflowModuleStore:a,workflow:s})}};const Lr=(0,o().YK)({search:{defaultMessage:"Searched Outlook",id:"workflow.run.effect.outlook.search.description"},searchLoading:{defaultMessage:"Searching Outlook",id:"workflow.run.effect.outlook.search.loading"},loadMessage:{defaultMessage:"Loaded Outlook message",id:"workflow.run.effect.outlook.loadMessage.description"},loadMessageLoading:{defaultMessage:"Loading Outlook message",id:"workflow.run.effect.outlook.loadMessage.loading"},loadThread:{defaultMessage:"Loaded Outlook thread",id:"workflow.run.effect.outlook.loadThread.description"},loadThreadLoading:{defaultMessage:"Loading Outlook thread",id:"workflow.run.effect.outlook.loadThread.loading"},query:{defaultMessage:"Queried Outlook",id:"workflow.run.effect.outlook.query.description"},queryLoading:{defaultMessage:"Querying Outlook",id:"workflow.run.effect.outlook.query.loading"}}),Er={triggers:{},effect:{"outlook.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Lr.searchLoading:Lr.search)},"outlook.loadMessage":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Lr.loadMessageLoading:Lr.loadMessage)},"outlook.loadThread":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Lr.loadThreadLoading:Lr.loadThread)},"outlook.query":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Lr.queryLoading:Lr.query)}},ModuleConfiguration:function(e){const t=(0,i.useCallback)((e=>({type:"outlook",moduleType:"outlook",identifier:e,actions:["search"]})),[]);return(0,d.jsx)(k,{...e,moduleName:"Outlook",buildPermission:t})}};const Wr=(0,o().YK)({search:{defaultMessage:"Searched Salesforce",id:"workflow.run.effect.salesforce.search.description"},searchLoading:{defaultMessage:"Searching Salesforce",id:"workflow.run.effect.salesforce.search.loading"}}),Nr={triggers:{},effect:{"salesforce.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Wr.searchLoading:Wr.search)}},ModuleConfiguration:function(e){const t=(0,i.useCallback)((e=>({type:"salesforce",moduleType:"salesforce",identifier:e,actions:["search"]})),[]);return(0,d.jsx)(k,{...e,moduleName:"Salesforce",buildPermission:t})}},Ur=(0,o().YK)({autosearch:{defaultMessage:"Ran AI autosearch across connected sources",id:"workflow.run.effect.search.autosearch.description"},autosearchLoading:{defaultMessage:"Running AI autosearch across connected sources",id:"workflow.run.effect.search.autosearch.loading"}}),Br={triggers:{},effect:{"search.autosearch":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Ur.autosearchLoading:Ur.autosearch)}}};const Vr=(0,o().YK)({search:{defaultMessage:"Searched SharePoint",id:"workflow.run.effect.sharepoint.search.description"},searchLoading:{defaultMessage:"Searching SharePoint",id:"workflow.run.effect.sharepoint.search.loading"},loadFile:{defaultMessage:"Loaded SharePoint file",id:"workflow.run.effect.sharepoint.loadFile.description"},loadFileLoading:{defaultMessage:"Loading SharePoint file",id:"workflow.run.effect.sharepoint.loadFile.loading"}}),_r={triggers:{},effect:{"sharepoint.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Vr.searchLoading:Vr.search)},"sharepoint.loadFile":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?Vr.loadFileLoading:Vr.loadFile)}},ModuleConfiguration:function(e){const t=(0,i.useCallback)((e=>({type:"sharepoint",moduleType:"sharepoint",identifier:e,actions:["search"]})),[]);return(0,d.jsx)(k,{...e,moduleName:"SharePoint",buildPermission:t})}};var Fr=()=>n(888382),Or=()=>n(209660),zr=()=>n(655600),Kr=()=>n(604018),Yr=()=>n(638666),Hr=()=>n(416783),qr=()=>n(610083),$r=()=>n(383070),Gr=()=>n(330704),Qr=()=>n(942580);const Jr=(0,o().YK)({connectedBadge:{defaultMessage:"Connected",id:"slack.connectedBadge"},connectedToWorkspace:{defaultMessage:"Connected to {workspaceName}",id:"slack.connectedToWorkspace"},requiresReconnection:{defaultMessage:"Needs reconnection",id:"slack.requiresReconnectionBadge"},accessRevoked:{defaultMessage:"Access Revoked",id:"slack.accessRevokedBadge"},accessRevokedAdminTooltip:{defaultMessage:"The Slack AI Connector was uninstalled. Reinstall it in your <settingslink>Notion AI settings</settingslink>.",id:"slack.accessRevokedAdminTooltip"},accessRevokedMemberTooltip:{defaultMessage:"The Slack AI Connector was uninstalled. Contact your workspace owner to reconnect.",id:"slack.accessRevokedMemberTooltip"}});function Zr(e){const{module:t}=e,n=(0,o().tz)(),r=(0,Gr().E)(),a=(0,wt().q8)(t),{scopedExternalConnectionStore:s,externalConnection:l}=(0,Qr().q)({moduleValue:t}),c=(0,i.useMemo)((()=>{if("slack"===(null==l?void 0:l.integration_type)&&l.scopes)return(0,wt().YS)({module:t,connectionScopes:l.scopes})}),[l,t]),u=(0,D().K8)((()=>{const e=null==s?void 0:s.getWorkflowExternalConnectionStore(),n=null==e?void 0:e.getModel();return"slack"===(null==n?void 0:n.module_type)&&(0,wt().YS)({module:t,connectionScopes:null==n?void 0:n.getData().scope})}),[t,s]),g=c??u,f=(0,D().K8)((()=>qr().Rh.state.thirdPartyId),[]),m=(0,D().K8)((()=>qr().Rh.state.externalSourceName),[]),p=function(e){const{scopedExternalConnectionStore:t,externalConnection:n}=e,o=(0,i.useMemo)((()=>{var e;const t=null==n||null===(e=n.data)||void 0===e?void 0:e.teamId;if("string"==typeof t)return t}),[n]),r=(0,D().K8)((()=>{var e;const n=null==t||null===(e=t.getWorkflowExternalConnectionStore())||void 0===e||null===(e=e.getModel())||void 0===e?void 0:e.getData();if(n&&"team"in n)return n.team.id}),[t]);return o??r}({scopedExternalConnectionStore:s,externalConnection:l}),h=(0,D().K8)((()=>$r().zD.isSlackConnectorUnificationEnabled()),[]),v=(0,D().K8)((()=>(0,Kr().wd)().includes("slack")),[]),w=(0,D().K8)((()=>(0,zr().LT)("slack").isInProgress),[]),y=f&&p&&f===p&&m;if(!a)return null;const M=h&&!v&&!w,x=M||g?"yellow":"green",k=M?(0,d.jsx)(o().sA,{...Jr.accessRevoked}):g?(0,d.jsx)(o().sA,{...Jr.requiresReconnection}):y?(0,d.jsx)(o().sA,{...Jr.connectedToWorkspace,values:{workspaceName:m}}):n.formatMessage(Jr.connectedBadge);return M?(0,d.jsx)(_e().m,{alignment:"start",placement:"bottom",allowHover:r,closeDelay:r?150:void 0,originGap:r?0:void 0,renderTooltip:e=>(0,d.jsx)("div",{...e,children:(0,d.jsx)(Xr,{isWorkspaceAdmin:r})}),render:e=>(0,d.jsx)(Ve().E,{...e,color:x,content:k})}):(0,d.jsx)(Ve().E,{color:x,content:k})}function Xr(e){const{isWorkspaceAdmin:t}=e,n=()=>{Or().Ow({currentTab:"ai",subtab:"ai_connectors"})};return(0,d.jsx)(a().Y1,{direction:"vertical",gap:6,style:{minWidth:300,maxWidth:400,whiteSpace:"normal"},children:(0,d.jsx)(s().D,{style:{whiteSpace:"normal"},children:t?(0,d.jsx)(o().sA,{...Jr.accessRevokedAdminTooltip,values:{settingslink:e=>(0,d.jsx)(Hr().V,{onClick:n,hoverColor:"blue",children:e})}}):(0,d.jsx)(o().sA,{...Jr.accessRevokedMemberTooltip})})})}var ea=()=>n(976710),ta=()=>n(3431);function na(e){const{moduleValue:t,onUndoClick:n,saveModule:r,workflowDefinitionPointer:c,workflowModuleStore:u,onAuthComplete:g}=e,m=(0,o().tz)(),p=(0,l().eP)(),h=(0,l().IS)((()=>({wrapper:{borderRadius:16,background:"dark"===p?f().Tj.background.secondary:f().Tj.background.primary,boxShadow:`0px 0px 0px 1px ${f().Tj.border.secondary}, 0px 3px 8px rgba(0, 0, 0, 0.04)`,overflow:"hidden",display:"flex",alignItems:"center",gap:8,padding:12},label:{flex:"1 1 0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}})),[p]),{scopedExternalConnectionStore:y,externalConnection:M}=(0,Qr().q)({moduleValue:t}),[x,k]=(0,ea().j)({moduleValue:t,workflowDefinitionPointer:c,workflowModuleStore:u}),b=(0,i.useCallback)((e=>{const n={...t.state,connectionPointer:null==e?void 0:e.pointer};"error"in n&&(n.error=void 0),r({...t,state:n})}),[t,r]),C=(0,w().c)(t);return(0,d.jsxs)(a().Y1,{direction:"horizontal",gap:8,height:"hug",style:h.wrapper,width:"fill",children:[(0,d.jsx)(L().I,{icon:C}),(0,d.jsx)(s().D,{colorVariant:"primary",styleKey:"bodyMedium",style:h.label,children:(0,d.jsx)(o().sA,{defaultMessage:"Connect to {moduleName}",id:"workflows.modules.workflowModuleTranscriptConnections.connectLabel",values:{moduleName:v().d.getName(t,m)}})}),n?(0,d.jsx)(H().p,{colorPalette:"blue",onClick:n,children:(0,d.jsx)(s().D,{styleKey:"bodyMedium",children:(0,d.jsx)(o().sA,{defaultMessage:"Undo",id:"workflows.modules.workflowModuleTranscriptConnections.undo"})})}):null,"resolved"===x.status&&0===x.value.sections.length?(0,d.jsx)(ta().s,{moduleValue:t,workflowDefinitionPointer:c,workflowModuleStore:u,onAuthComplete:g}):(0,d.jsx)(mo().C,{asyncConnections:x,moduleValue:t,onMenuItemClick:b,selectedScopedExternalConnectionStore:y,selectedExternalConnection:M,workflowDefinitionPointer:c,workflowModuleStore:u,onAuthComplete:g})]})}var oa=()=>n(748977),ia=()=>n(234459),ra=()=>n(24153),aa=()=>n(159958);function sa(e){var t;const{moduleValue:n}=e,o=(0,Di().l)(null==n||null===(t=n.state)||void 0===t?void 0:t.connectionPointer),r=(0,i.useMemo)((()=>(0,wt().zz)(o)),[o]),{loadedChannelsForAccount:a,isLoading:s}=(0,aa().XN)(r);return{getSlackChannelIdentifier:(0,i.useCallback)((e=>la({identifier:e,channels:a})),[a]),isLoading:s}}function la(e){const{identifier:t,channels:n}=e;let o=t;if(!(0,ra().NL)(t)&&!(0,ra().YK)(t)){const e=ra().A2.slackChannel.parseUri(t);e instanceof Error||(o=e.channelId)}const i=null==n?void 0:n.find((e=>e.id===o||e.name===o||e.url===o));return{channelData:i,identifier:(null==i?void 0:i.url)||(null==i?void 0:i.id)||t}}var da=()=>n(338862);const ca={viewBox:"0 0 16 16",fittedViewBox:"2.55 2.19 10.9 11.61",svg:(0,d.jsx)("path",{d:"M7.122 2.221a.75.75 0 0 1 .608.87l-.437 2.48h2.23l.482-2.741a.75.75 0 1 1 1.477.26l-.436 2.48h1.65a.75.75 0 0 1 0 1.5H10.78l-.327 1.86h1.65a.75.75 0 0 1 0 1.5h-1.915l-.482 2.74a.75.75 0 1 1-1.478-.26l.437-2.48H6.437l-.483 2.74a.75.75 0 1 1-1.477-.26l.437-2.48h-1.61a.75.75 0 0 1 0-1.5h1.874l.328-1.86h-1.61a.75.75 0 0 1 0-1.5H5.77l.483-2.74a.75.75 0 0 1 .869-.609m1.808 6.71.328-1.86H7.03l-.328 1.86z"})},ua=(0,G().wt)("numberFillSmall",ca,"fillSmall");var ga=()=>n(32527);function fa(e){if(!e)return ua;switch(e.type){case"private":case"me":case"im":return da().lockFillSmallIcon;default:return ga().E}}var ma=()=>n(595743);const pa=(0,o().YK)({writeAccessRestrictedAdminTooltip:{id:"slackModule.permission.writeAccessRestricted.admin",defaultMessage:"Configure Slack write access in your <settingslink>Notion AI settings</settingslink>."},writeAccessRestrictedMemberTooltip:{id:"slackModule.permission.writeAccessRestricted.member",defaultMessage:"This feature is currently disabled. Contact your workspace owner to request access."},permissionNone:{id:"slackModule.permission.none",defaultMessage:"None"},permissionRead:{id:"slackModule.permission.read",defaultMessage:"Read"},permissionReadOnly:{id:"slackModule.permission.readOnly",defaultMessage:"Read only"},permissionReplyInThread:{id:"slackModule.permission.replyInThread",defaultMessage:"Read & Reply"},permissionReplyInThreadCaption:{id:"slackModule.permission.replyInThread.caption",defaultMessage:"Only replies in the thread where it was triggered"},permissionReadWrite:{id:"slackModule.permission.readWrite",defaultMessage:"Read & Write"},permissionReadWriteCaption:{id:"slackModule.permission.readWrite.caption",defaultMessage:"Can post new messages and reply in any threads"},permissionRemove:{id:"slackModule.permission.remove",defaultMessage:"Remove"}});function ha(e){const{disabled:t,currentLevel:n,isMissingResource:i=!1,isGlobalPermission:r=!1,onSelect:a,options:c}=e,u={"read-only":{title:r?pa.permissionRead:pa.permissionReadOnly,caption:void 0},"reply-in-thread":{title:pa.permissionReplyInThread,caption:pa.permissionReplyInThreadCaption},"read-write":{title:pa.permissionReadWrite,caption:pa.permissionReadWriteCaption},none:{title:pa.permissionNone,caption:void 0},remove:{title:pa.permissionRemove,caption:void 0}},g=(0,l().eP)(),m=(0,l().IS)((()=>({plainButton:{color:i?f().Tj.blue.text.accentPrimary:f().Tj.text.secondary,fontSize:12,opacity:i?.5:1,fontWeight:$().Wy.medium,gap:4},hoveredButton:{background:i?f().Tj.blue.background.secondaryTranslucent:f().Tj.background.secondaryTranslucent},pressedButton:{background:(0,O().yZ)({color:i?f().Tj.blue.background.secondaryTranslucent:f().Tj.background.secondaryTranslucent,mode:g})}})),[i,g]),p=(0,D().O$)(qr().Rh),h=(0,D().K8)((()=>$r().zD.isCustomAgentsWriteAccessRestricted(p)),[p]),v=(0,Gr().E)(),w=()=>{Or().Ow({currentTab:"ai",subtab:"ai_connectors"})},y=[{key:"permission-options",items:c.map(((e,t)=>({key:e,action:()=>a(e),render:t=>{const a="read-write"===e&&r||("read-write"===e||"reply-in-thread"===e)&&h,l=a&&h,c=l?v?(0,d.jsx)(o().sA,{...pa.writeAccessRestrictedAdminTooltip,values:{settingslink:e=>(0,d.jsx)(Hr().V,{onClick:w,hoverColor:"blue",children:e})}}):(0,d.jsx)(o().sA,{...pa.writeAccessRestrictedMemberTooltip}):void 0;return(0,d.jsx)(_e().m,{disableTooltip:!c,allowHover:v&&l,renderTooltip:e=>(0,d.jsx)("div",{...e,children:c}),closeDelay:v&&l?150:void 0,render:r=>(0,d.jsx)(N().A,{...(0,$e().A)(t,r),disabled:a,isChecked:e===n&&!i,title:(0,d.jsx)(s().D,{...a?{colorVariant:"disabled"}:{},..."remove"===e?{colorVariant:"accentPrimary",colorPalette:"red"}:{},children:(0,d.jsx)(o().sA,{...u[e].title})}),caption:u[e].caption?(0,d.jsx)(s().D,{...a?{colorVariant:"disabled"}:{},children:(0,d.jsx)(o().sA,{...u[e].caption})}):void 0,shouldWrapCaption:!0})})}}))),render:e=>(0,d.jsx)(B().A,{...e})}];return(0,d.jsx)(z().A,{popupType:wn().A.isMobile?z().z.BottomSheet:z().z.Popup,renderOrigin:e=>(0,d.jsx)(H().p,{...e,colorPalette:i?"blue":"gray",disabled:t,iconTrailing:t?void 0:{icon:Ln().arrowChevronSingleDownIcon,size:"xs"},style:m.plainButton,hoveredStyle:m.hoveredButton,pressedStyle:m.pressedButton,children:(0,d.jsx)(o().sA,{...u[n].title})}),render:()=>(0,d.jsx)(W().A,{menuType:wn().A.isMobile?E().gu.Modal:E().gu.Popup,width:230,children:(0,d.jsx)(U().A,{type:U().O.Vertical,sections:y,initialFocus:0})}),alignmentToOrigin:"end"})}var va=()=>n(148307),wa=()=>n(738471);const ya=(0,o().YK)({adminTooltip:{id:"slackModulePermissionRow.accessRevoked.adminTooltip",defaultMessage:"Select a read-only scope in the dropdown, or configure Slack write access in your <settingslink>Notion AI settings</settingslink>."},memberTooltip:{id:"slackModulePermissionRow.accessRevoked.memberTooltip",defaultMessage:"This feature is currently disabled. Select a read-only scope in the dropdown or contact your workspace owner to enable read + write permissions."}});function Ma(e){const{titleAndIcon:t,rightContent:n,isMissingResource:i=!1,error:r,isWriteAccessRestricted:s,permissionLevel:c}=e,u=(0,Gr().E)(),g=(0,l().IS)((()=>({container:{borderRadius:6,height:28,...i&&{backgroundColor:f().Tj.blue.background.primaryTranslucent}}})),[i]),m=s&&("reply-in-thread"===c||"read-write"===c);return(0,d.jsxs)(a().Y1,{direction:"horizontal",align:"center",gap:8,padding:"0 0 0 10px",style:g.container,children:[t,m?(0,d.jsx)(_e().m,{alignment:"start",placement:"bottom",allowHover:u,closeDelay:u?150:void 0,originGap:u?0:void 0,renderTooltip:e=>(0,d.jsx)("div",{...e,children:(0,d.jsx)(Sa,{isWorkspaceAdmin:u})}),render:e=>(0,d.jsx)(Ve().E,{...e,color:"yellow",content:(0,d.jsx)(o().sA,{id:"slackModulePermissionRow.accessRevoked.label",defaultMessage:"Access revoked"})})}):r?(0,d.jsx)(_e().m,{alignment:"start",placement:"bottom",renderTooltip:()=>function(e){switch(e){case"bot-is-not-part-of-channel":return(0,d.jsx)(ka,{});case"channel-is-archived":return(0,d.jsx)(ba,{});case"channel-unavailable":return(0,d.jsx)(Ca,{});default:(0,ft().HB)(e)}}(r),render:e=>(0,d.jsx)(Ve().E,{...e,color:"yellow",content:(0,d.jsxs)(a().Y1,{direction:"horizontal",align:"center",gap:2,children:[(0,d.jsx)(L().I,{icon:Fe().exclamationMarkCircleSmallIcon,size:"sm"}),xa(r)]})})}):void 0,(0,d.jsx)(a().Y1,{align:"end",gap:"auto",children:n})]})}function xa(e){switch(e){case"bot-is-not-part-of-channel":return(0,d.jsx)(o().sA,{id:"slackModulePermissionRow.needsSetup.label",defaultMessage:"Incomplete setup"});case"channel-is-archived":return(0,d.jsx)(o().sA,{id:"slackModulePermissionRow.archived.label",defaultMessage:"Archived"});case"channel-unavailable":return(0,d.jsx)(o().sA,{id:"slackModulePermissionRow.unavailable.label",defaultMessage:"Unavailable"});default:(0,ft().HB)(e)}}function ka(){return(0,d.jsxs)(a().Y1,{direction:"vertical",gap:6,children:[(0,d.jsx)(wa().A,{src:va().A.images.customAgentSlackSettingsPreviewPng,style:{minWidth:200,width:"100%"}}),(0,d.jsx)(s().D,{children:(0,d.jsx)(o().sA,{id:"slackModulePermissionRow.needsSetup.tooltipTitle",defaultMessage:"Add Notion AI to this channel"})}),(0,d.jsx)(s().D,{colorPalette:"gray",colorVariant:"secondary",children:(0,d.jsx)(o().sA,{id:"slackModulePermissionRow.needsSetup.tooltipMessage",defaultMessage:"Go to the channel’s settings, click the integrations tab, search apps for ‘Notion AI’"})})]})}function ba(){return(0,d.jsx)(a().Y1,{direction:"vertical",gap:6,children:(0,d.jsx)(s().D,{children:(0,d.jsx)(o().sA,{id:"slackModulePermissionRow.archived.tooltipTitle",defaultMessage:"This channel is archived"})})})}function Ca(){return(0,d.jsx)(a().Y1,{direction:"vertical",gap:6,children:(0,d.jsx)(s().D,{children:(0,d.jsx)(o().sA,{id:"slackModulePermissionRow.unavailable.tooltipTitle",defaultMessage:"Failed to load channel information"})})})}function Sa(e){const{isWorkspaceAdmin:t}=e,n=()=>{Or().Ow({currentTab:"ai",subtab:"ai_connectors"})};return(0,d.jsx)(a().Y1,{direction:"vertical",gap:6,style:{minWidth:300,maxWidth:400,whiteSpace:"normal"},children:(0,d.jsx)(s().D,{style:{whiteSpace:"normal"},children:t?(0,d.jsx)(o().sA,{...ya.adminTooltip,values:{settingslink:e=>(0,d.jsx)(Hr().V,{onClick:n,hoverColor:"blue",children:e})}}):(0,d.jsx)(o().sA,{...ya.memberTooltip})})})}function ja(e){const{title:t,icon:n,isMissingResource:o=!1}=e,i=(0,l().IS)((()=>({icon:{height:16,width:16,...o&&{color:f().Tj.blue.text.accentPrimary,opacity:.5}},text:{...o&&{color:f().Tj.blue.text.accentPrimary,opacity:.5}}})),[o]);return(0,d.jsxs)(d.Fragment,{children:[n(i.icon),(0,d.jsx)(s().D,{style:i.text,children:t})]})}function Aa(e){const{moduleValue:t,store:n,userHasEditAccess:o,handleUpdatePermission:r}=e,{autoGrantOperations:a}=(0,ma().B)({workflowStore:n}),{getSlackChannelIdentifier:s}=sa({moduleValue:t}),l=(0,i.useMemo)((()=>{const e=a.find((e=>e.args.value.id===t.id));return e?e.args.value.permissions:[]}),[a,null==t?void 0:t.id]),c=(0,i.useMemo)((()=>{const e=e=>Array.isArray(e)?e:[e],n=new Set;for(const i of t.permissions||[]){const t=e(i.identifier);for(const e of t){const{identifier:t}=s(e);n.add(t)}}const o=new Map;for(const t of l){const i=e(t.identifier);for(const e of i){const{channelData:i,identifier:r}=s(e);if(!n.has(r)&&!o.has(r)){const e=(null==i?void 0:i.name)??r,n=fa(i);o.set(r,{actions:t.actions,channelName:e,icon:n,identifier:r,permissionLevel:"none"})}}}return Array.from(o.values())}),[l,t,s]);return(0,d.jsx)(d.Fragment,{children:c.map((e=>(0,d.jsx)(Ma,{isMissingResource:!0,titleAndIcon:(0,d.jsx)(ja,{icon:e.icon,isMissingResource:!0,title:e.channelName}),rightContent:(0,d.jsx)(ha,{disabled:!o,currentLevel:e.permissionLevel,isMissingResource:!0,onSelect:t=>r({identifier:e.identifier,newLevel:t}),options:["read-only","reply-in-thread","read-write","none"]}),error:void 0},`${e.identifier}--missing`)))})}n(823215);var Ia=()=>n(651220),Ta=()=>n(162969),Da=()=>n(621859);const Pa=(0,o().YK)({channelSearchPlaceholder:{id:"workflowSlackChannelPicker.selectChannelView.searchInput.placeholder",defaultMessage:"Search Slack channels…"},addNewButton:{id:"workflows.targetPicker.addChannel",defaultMessage:"Add channel"},anyChannel:{defaultMessage:"All channels",id:"workflows.targetPicker.anyChannel"},loading:{id:"workflows.targetPicker.loading",defaultMessage:"Loading channels"},noTarget:{id:"workflows.targetPicker.noTarget",defaultMessage:"Select Slack channels"}});async function Ra(e){const{environment:t,externalAuthConfig:n,channelIds:o,moduleId:i,workflowDefinitionPointer:r}=e,{workflowId:a,spaceId:s,transcriptId:l}=(0,gt().kI)(r),d=await Wn().callApi({eventName:"getViaWorkflowModuleConfigurationUtil",environment:t,data:{workflowId:a,spaceId:s,transcriptId:l,moduleId:i,moduleType:"slack",callArguments:{functionName:"getExistingSlackChannels",functionArgs:[o]}}});if("success"===d.type){if("getExistingSlackChannels"!==d.data.functionName)throw new Error("Invalid function name");Ta().c.addChannelsForBot(n,d.data.functionReturn)}}async function La(e){const{environment:t,externalAuthConfig:n,moduleId:o,workflowDefinitionPointer:i}=e,{workflowId:r,spaceId:a,transcriptId:s}=(0,gt().kI)(i),l=await Wn().callApi({eventName:"getViaWorkflowModuleConfigurationUtil",environment:t,data:{workflowId:r,spaceId:a,transcriptId:s,moduleId:o,moduleType:"slack",callArguments:{functionName:"getExistingSlackChannels",functionArgs:[]}}});if("success"===l.type){if("getExistingSlackChannels"!==l.data.functionName)throw new Error("Invalid function name");Ta().c.addChannelsForBot(n,l.data.functionReturn)}}function Ea(e){const{channelId:t,moduleId:n,workflowDefinitionPointer:o,moduleValue:r}=e,{channelDataMap:a,isLoading:s}=function(e){const{channelIds:t,moduleId:n,workflowDefinitionPointer:o,moduleValue:r}=e,a=(0,Di().l)(t),s=(0,Di().l)(o),l=(0,Di().l)(r),d=(0,it().v3)(),c=(0,i.useMemo)((()=>{var e;if("slack"!==l.type)throw new Error("Module in useSlackChannelData is not a slack module");return(0,wt().zz)(null===(e=l.state)||void 0===e?void 0:e.connectionPointer)}),[l]),{loadedChannelsForAccount:u,isLoading:g}=(0,aa().XN)(c);return i.useEffect((()=>{c&&a&&0!==a.length&&(a.every((e=>u.some((t=>t.id===e||t.url===e))))||Ra({environment:d,workflowDefinitionPointer:s,externalAuthConfig:c,channelIds:a,moduleId:n}))}),[d,c,a,n,s,u]),{channelDataMap:(0,i.useMemo)((()=>{const e=new Map;for(const t of u)e.set(t.id,t),t.url&&e.set(t.url,t);return e}),[u]),isLoading:g,externalAuthConfig:c}}({channelIds:[t],moduleId:n,workflowDefinitionPointer:o,moduleValue:r}),{channelData:l}=la({identifier:t,channels:a.values().toArray()}),c=null==l?void 0:l.name;return s?(0,d.jsx)("span",{children:(0,d.jsx)(Y().A,{size:"sm"})}):c?(0,d.jsx)("span",{children:`#${c}`}):(0,d.jsx)("span",{children:`#${t}`})}function Wa(e){const{channelIds:t,isAllChannels:n,isMultiSelectMode:o,moduleId:r,workflowDefinitionPointer:a,writeChannelIds:s,showClearOption:l=!1,showLoginPromptIfNoConnection:c=!1,shouldShowSelectAllChannels:u,shouldHideSelectedChannels:g,moduleValue:f,renderButton:m,workflowStore:p,connectButtonVariant:h}=e,{buttonPopupStore:v,onClose:w,connectionPointer:y,loadedChannelsForAccount:M,areReferencedChannelsLoaded:x,currentNotificationChannels:k,isLoading:b}=function(e){var t;const{channelIds:n,moduleId:o,workflowDefinitionPointer:r,moduleValue:a}=e,s=(0,Di().l)(n),l=(0,Di().l)(r),d=(0,Di().l)(a),c=(0,D().uB)(void 0,K().A),u=(0,i.useCallback)((()=>c.reset()),[c]),{spaceId:g}=(0,i.useMemo)((()=>(0,gt().kI)(l)),[l]);if("slack"!==(null==d?void 0:d.type))throw new Error("Module in WorkflowSlackChannelPicker is not a slack module");const f=null==d||null===(t=d.state)||void 0===t?void 0:t.connectionPointer,m=(0,i.useMemo)((()=>(0,wt().zz)(f)),[f]),p=(0,it().v3)(),{loadedChannelsForAccount:h,isLoading:v}=(0,aa().XN)(m),w=(0,i.useMemo)((()=>s?s.map((e=>{const{channelData:t}=la({identifier:e,channels:h});return{id:(null==t?void 0:t.id)||e,type:(null==t?void 0:t.type)??"public",name:(null==t?void 0:t.name)??e,isMember:(null==t?void 0:t.isMember)??!1,url:null==t?void 0:t.url}})).filter(Boolean):void 0),[s,h]),y=Boolean(s&&s.length>0&&(null==w?void 0:w.length)===s.length);return i.useEffect((()=>{m&&g&&(La({environment:p,workflowDefinitionPointer:l,externalAuthConfig:m,moduleId:o}),(0,aa().Hn)({environment:p,spaceId:g,externalAuthConfig:m,moduleId:o,workflowId:l.id}))}),[p,g,m,l,o]),i.useEffect((()=>{m&&g&&s&&(La({environment:p,workflowDefinitionPointer:l,externalAuthConfig:m,moduleId:o}),Ra({environment:p,workflowDefinitionPointer:l,externalAuthConfig:m,channelIds:s,moduleId:o}))}),[p,g,m,s,o,l]),{buttonPopupStore:c,onClose:u,connectionPointer:f,externalAuthConfig:m,loadedChannelsForAccount:h,isLoading:v,areReferencedChannelsLoaded:y,currentNotificationChannels:w,environment:p,spaceId:g}}({channelIds:t,moduleId:r,workflowDefinitionPointer:a,moduleValue:f}),C=(0,Mi().j)(),S=Boolean(t&&t.length>0);if(!y&&c&&f&&p)return(0,d.jsx)(Da().m,{module:f,workflowStore:p,buttonVariant:h,size:"sm"});return(0,d.jsx)(z().A,{buttonPopupStore:v,disabled:!1,originGap:4,placementToOrigin:"bottom",popupType:C,renderOrigin:e=>m(e,{hasValidConfig:S,areReferencedChannelsLoaded:x,currentNotificationChannels:k,isLoading:b}),render:()=>(0,d.jsx)(Ua,{channelIds:t,connectionPointer:y,currentNotificationChannels:k,isAllChannels:n,isMultiSelectMode:o,loadedChannelsForAccount:M,moduleId:r,onClose:w,shouldHideSelectedChannels:g,shouldShowSelectAllChannels:u,showClearOption:l,writeChannelIds:s,workflowId:a.id})})}function Na(e){const{channelIds:t,isAllChannels:n,isMultiSelectMode:r,moduleId:a,workflowDefinitionPointer:s,writeChannelIds:c,showClearOption:u=!1,showLoginPromptIfNoConnection:g=!1,placeholder:f,moduleValue:m,workflowStore:p,connectButtonVariant:h,shouldShowSelectAllChannels:v,shouldHideSelectedChannels:w,trigger:y}=e,M=(0,l().IS)((()=>({tooltip:{display:"flex",gap:4,flexDirection:"column"}})),[]),x=(0,i.useMemo)((()=>e=>{const t=[];for(const n of e||[])t.push((0,d.jsx)("span",{children:`#${n.name}`},`channel-${n.name}`));return t}),[]);return(0,d.jsx)(Wa,{channelIds:t,isAllChannels:n,isMultiSelectMode:r,moduleId:a,workflowDefinitionPointer:s,writeChannelIds:c,showClearOption:u,showLoginPromptIfNoConnection:g,moduleValue:m,workflowStore:p,connectButtonVariant:h,shouldShowSelectAllChannels:v,shouldHideSelectedChannels:w,renderButton:(e,{hasValidConfig:t,areReferencedChannelsLoaded:i,currentNotificationChannels:r,isLoading:a})=>(0,d.jsx)(_e().m,{delayThreshold:0,disableTooltip:!(r&&r.length>1),placement:"bottom",renderTooltip:()=>r&&r.length>1?(0,d.jsx)("div",{style:M.tooltip,children:x(r)}):null,render:s=>{const l=y?!(0,gt().n7)(y,"channels"):!t;return(0,d.jsx)(Ge,{buttonPopupEvents:e,tooltipEvents:s,needsSetup:l,isLoading:a,children:n?(0,d.jsx)(o().sA,{...Pa.anyChannel}):i?null==r?void 0:r.map((e=>e.name)).join(", "):a?(0,d.jsx)(o().sA,{...Pa.loading}):f||(0,d.jsx)(o().sA,{...Pa.noTarget})})}})})}function Ua(e){const{connectionPointer:t,currentNotificationChannels:n,isAllChannels:o,isMultiSelectMode:r,loadedChannelsForAccount:a,moduleId:s,onClose:c,shouldHideSelectedChannels:u,shouldShowSelectAllChannels:g=!0,showClearOption:f=!1,workflowId:m,writeChannelIds:p}=e,h=i.useCallback(((e,t)=>{const o=null==n?void 0:n.map((e=>e.id));if((null==o?void 0:o.includes(e.id))&&o)o.length>1&&p(o.filter((t=>t!==e.id)).map((e=>{var t,n;const o=null==a?void 0:a.find((t=>t.id===e)),i=null==o?void 0:o.url,r=i&&"string"==typeof i?null===(t=(n=ra().A2.slackChannel).parseUrlToUri)||void 0===t?void 0:t.call(n,i,{baseUrl:wn().A.domainBaseUrl,publicDomainName:wn().A.publicDomainName}):void 0;return{channelId:e,channelName:(null==o?void 0:o.name)??e,channelUrl:i,channelUri:!r||r instanceof Error?void 0:r}})),!1);else{const t=[...u?[]:o??[],e.id],n=t.length===(a||[]).length&&t.length>1;p(t.map((e=>{var t,n;const o=null==a?void 0:a.find((t=>t.id===e)),i=null==o?void 0:o.url,r=i&&"string"==typeof i?null===(t=(n=ra().A2.slackChannel).parseUrlToUri)||void 0===t?void 0:t.call(n,i,{baseUrl:wn().A.domainBaseUrl,publicDomainName:wn().A.publicDomainName}):void 0;return{channelId:e,channelName:(null==o?void 0:o.name)??e,channelUrl:i,channelUri:!r||r instanceof Error?void 0:r}})),n)}}),[n,p,a,u]),v=i.useCallback((()=>{o||p([],!0)}),[o,p]),w=i.useCallback((()=>{p([],!1),c()}),[p,c]),y=(0,l().IS)((()=>({header:{margin:8}})),[]);return(0,d.jsx)(aa().pj,{currentNotificationChannels:n,isAllChannels:o,isMultiSelectMode:r,moduleId:s,onClearSelection:f?w:void 0,onClose:c,onNewSlackAccountAdded:()=>{},onNotificationChannelSelect:h,onNotificationChannelSelectAll:v,searchPlaceholder:Pa.channelSearchPlaceholder,shouldHideSlackAccountSection:!0,shouldShowFixedSearch:!0,shouldShowImChannels:!0,shouldShowSelectAllChannels:g,shouldHideSelectedChannels:u,shouldShowTooltipsOnChannelNames:!0,workflowExternalScopedConnectionPointer:t,workflowId:m,renderMenu:e=>(0,d.jsx)(W().A,{menuType:E().gu.Popup,width:300,maxHeight:"50vh",header:(0,d.jsx)("div",{style:y.header}),children:(0,d.jsx)(Ba,{sections:e})})})}function Ba({sections:e}){const t=(0,i.useRef)(null),n=(0,i.useMemo)((()=>{const t=[];return e.forEach((e=>{e.items.forEach((e=>{t.push({key:`${e.key}--workflow-slack-channel-picker`,rendered:e.render({...e,isBeforeFocused:!1,isLastInSection:!1,focused:!1,onClick:n=>e.action({event:n,index:t.length,indexLocal:{section:0,indexLocal:t.length}}),onMouseEnter:()=>{},ref:()=>{}},{onFocus:()=>{}})})}))})),t}),[e]),o=(0,Ia().Te)({count:n.length,getScrollElement:()=>t.current,estimateSize:(0,i.useCallback)((e=>"search-input-item--workflow-slack-channel-picker"===n[e].key?36:32),[n]),overscan:10}),r=o.getVirtualItems(),a=(0,i.useCallback)((()=>r.map((e=>{const{rendered:t,key:o}=n[e.index];return(0,d.jsx)(Va,{virtualItem:e,children:t},o)}))),[r,n]);return(0,d.jsx)("div",{ref:t,style:{flexGrow:1,maxHeight:350,overflowX:"hidden",overflowY:"auto"},children:(0,d.jsx)("div",{style:{height:o.getTotalSize(),width:"100%",position:"relative"},children:a()})})}function Va({children:e,virtualItem:t}){const n=(0,l().IS)((()=>({item:{position:"absolute",top:0,insetInlineStart:0,width:"100%",height:t.size,transform:`translateY(${t.start}px)`,padding:"0px 4px"}})),[t.size,t.start]);return(0,d.jsx)("div",{style:n.item,children:e})}function _a(e){const{channelIds:t,isAllChannels:n,isMultiSelectMode:i,moduleId:r,workflowDefinitionPointer:a,writeChannelIds:s,showClearOption:c=!1,moduleValue:u,workflowStore:g,shouldShowSelectAllChannels:m,shouldHideSelectedChannels:p}=e,h=(0,l().eP)(),v=(0,l().IS)((()=>({button:{width:"100%",paddingInlineStart:10,gap:8},hoveredButton:{background:f().Tj.background.secondaryTranslucent},pressedButton:{background:(0,O().yZ)({color:f().Tj.background.secondaryTranslucent,mode:h})}})),[h]);return(0,d.jsx)(Wa,{channelIds:t,isAllChannels:n,isMultiSelectMode:i,moduleId:r,workflowDefinitionPointer:a,writeChannelIds:s,showClearOption:c,moduleValue:u,workflowStore:g,shouldShowSelectAllChannels:m,shouldHideSelectedChannels:p,renderButton:e=>(0,d.jsx)(H().p,{...e,colorPalette:"gray",iconLeading:{icon:ge().plusSmallIcon,size:"sm"},style:v.button,hoveredStyle:v.hoveredButton,pressedStyle:v.pressedButton,children:(0,d.jsx)(o().sA,{...Pa.addNewButton})})})}const Fa=new Set(["*","public:*","users:*"]);function Oa(e){return"string"==typeof e&&Fa.has(e)}function za(e){const{module:t,saveModule:n,userHasEditAccess:o,workflowDefinitionPointer:r,store:a}=e,s=(0,it().v3)(),c=(0,Di().l)(t),u=(0,l().IS)((()=>({customPermissions:{marginTop:8,fontSize:$().J.UISmall.desktop,color:f().Tj.text.secondary,lineHeight:1.5}})),[]),{getSlackChannelIdentifier:g,isLoading:m}=sa({moduleValue:c}),p=(0,i.useMemo)((()=>{if(!c.permissions)return[];const e=[];for(const t of c.permissions){const n=t.actions||[];let o="none";if(n.includes("write")?o="read-write":n.includes("replyInThread")?o="reply-in-thread":n.includes("read")&&(o="read-only"),"*"===t.identifier)e.push({key:`all-channels-${o}`,channelName:"All channels",permissionLevel:o,icon:oa().k,permission:t,identifier:"*"});else if("public:*"===t.identifier)e.push({key:`all-public-channels-${o}`,channelName:"All public channels",permissionLevel:o,icon:oa().k,permission:t,identifier:"public:*"});else if("users:*"===t.identifier)"read-only"!==o&&e.push({key:`all-users-${o}`,channelName:"All users",permissionLevel:o,icon:oa().k,permission:t,identifier:"users:*"});else{const i=Array.isArray(t.identifier)?t.identifier:[t.identifier];for(const r of i){if(Oa(r))continue;const{channelData:i,identifier:a}=g(r),s=null!=i&&i.name?`${i.name}`:`${a}`,l=fa(i);let d;null!=i&&i.isArchived?d="channel-is-archived":i&&!i.isMember?d="bot-is-not-part-of-channel":m||i||(d="channel-unavailable"),e.push({key:`channel-${a}-${n.join("-")}`,error:d,channelName:s,icon:l,identifier:a,permission:t,permissionLevel:o})}}}return e}),[g,m,c]),h=(0,i.useCallback)((({oldPermission:e,identifier:t,newLevel:o})=>{const i=Ya({modulePermissions:c.permissions??[],oldPermission:e,identifier:t,newLevel:o});n({...c,permissions:i})}),[c,n]),v=(0,i.useMemo)((()=>{if(!c.permissions)return[];const e=[];for(const t of c.permissions){if("*"===t.identifier)return["*"];if("public:*"===t.identifier||"users:*"===t.identifier)continue;const n=Array.isArray(t.identifier)?t.identifier:[t.identifier];for(const t of n){if(Oa(t))continue;const n=g(t).identifier;Oa(n)||e.push(n)}}return e}),[c,g]),w=(0,D().O$)(qr().Rh),y=(0,D().K8)((()=>$r().zD.isSlackConnectorUnificationEnabled()),[]),M=(0,D().K8)((()=>y&&$r().zD.isCustomAgentsWriteAccessRestricted(w)),[w,y]),x=(0,D().K8)((()=>!y||(0,Kr().wd)().includes("slack")||(0,zr().LT)("slack").isInProgress),[y]),k=(0,i.useCallback)(((e,t)=>{const n=M?"read-only":"reply-in-thread";e.forEach((e=>{const t=e.channelUri||e.channelUrl||e.channelId,o=(0,xn().i4)(a);o&&(0,Mn().ik)({environment:s,connected_tool:"slack",resource_type:"channel",workflow_id:o}),h({identifier:t,newLevel:n})}))}),[h,s,a,M]),b=(0,i.useMemo)((()=>{if(!c.permissions)return[];const e=[];for(const t of c.permissions){const n=t.actions||[];if("*"===t.identifier&&1===n.length&&n.includes("read"))continue;if("users:*"===t.identifier)continue;if("public:*"===t.identifier&&1===n.length)continue;if((n.includes("write")||n.includes("read"))&&!n.includes("react"))continue;const o=n.join(", "),i=Array.isArray(t.identifier)?t.identifier.join(", "):t.identifier;o&&e.push(`${o}: ${i}`)}return e}),[c.permissions]),C=v.includes("*");return(0,d.jsxs)(d.Fragment,{children:[p.map((e=>{const t=Oa(e.identifier),n="users:*"===e.identifier,i="read-write"===e.permissionLevel;return x?(0,d.jsx)(Ma,{error:e.error,isWriteAccessRestricted:M,permissionLevel:e.permissionLevel,titleAndIcon:(0,d.jsx)(ja,{title:e.channelName,icon:e.icon}),rightContent:(0,d.jsx)(ha,{disabled:!o,currentLevel:e.permissionLevel,onSelect:t=>h({oldPermission:e.permission,identifier:e.identifier,newLevel:t}),isGlobalPermission:t,options:Ka({isUsersPermissionRow:n,isGlobalPermissionRow:t,isReadWriteSelected:i})})},e.key):null})),b.length>0?(0,d.jsx)("div",{style:u.customPermissions,children:b.map(((e,t)=>(0,d.jsx)("div",{children:e},t)))}):void 0,a.table!==ia().To?(0,d.jsx)(Aa,{moduleValue:c,store:a,userHasEditAccess:o,handleUpdatePermission:h}):void 0,o&&x?(0,d.jsx)("div",{style:{alignSelf:"stretch"},children:(0,d.jsx)(_a,{channelIds:C?[]:v,isAllChannels:C,isInTranscript:!1,isMultiSelectMode:!0,moduleId:c.id,workflowDefinitionPointer:r,writeChannelIds:k,moduleValue:c,shouldShowSelectAllChannels:!1,shouldHideSelectedChannels:!0})}):void 0]})}function Ka(e){const{isUsersPermissionRow:t,isGlobalPermissionRow:n,isReadWriteSelected:o}=e;return t?["read-only","none"]:n&&o?["read-only","reply-in-thread","read-write","none"]:n?["read-only","reply-in-thread","none"]:["read-only","reply-in-thread","read-write","none","remove"]}function Ya({modulePermissions:e,oldPermission:t,identifier:n,newLevel:o}){const i=(0,ra().UT)(n),r=[...e];let a=[];"read-only"===o?a=["read"]:"read-write"===o?a=["read","write"]:"reply-in-thread"===o&&(a=["read","replyInThread"]);const s=Oa(i);if(s){const e=r.findIndex((e=>e.identifier===i));return r[e]={...r[e],actions:a},r}const l=t?r.indexOf(t):-1;if(l>-1){const t=r[l];if("remove"===o&&!s)return Ha({modulePermissions:e,oldPermission:t,identifier:i});!Array.isArray(t.identifier)||Array.isArray(t.identifier)&&1===t.identifier.length?r.splice(l,1):r[l]={...t,identifier:t.identifier.map((e=>(0,ra().UT)(e))).filter((e=>e!==i))}}const d=r.findIndex((e=>q().n4(e.actions,a)&&!Oa(e.identifier)));if(d>-1){const e=r[d],t=e.identifier,n=Array.isArray(t)?t.map((e=>(0,ra().UT)(e))):[(0,ra().UT)(t)];r[d]={...e,identifier:[...n,i]}}else r.push({moduleType:"slack",type:"slack",identifier:i,actions:a});return r}function Ha({modulePermissions:e,oldPermission:t,identifier:n}){const o=(0,ra().UT)(n);let i=[...e];if(Oa(t.identifier))return i;if(Array.isArray(t.identifier)){const e=t.identifier.map((e=>(0,ra().UT)(e))).filter((e=>e!==o));if(0===e.length)i=i.filter((e=>e!==t));else{const n=i.indexOf(t);i[n]={...t,identifier:e}}}else i=i.filter((e=>e!==t));return i}function qa({emojiName:e,allEmojis:t,size:n=16,className:o}){const i=t[e];return i?i.includes("https")?(0,d.jsx)("img",{src:i,alt:e,height:n,width:n,className:o}):(0,d.jsx)("span",{className:o,children:i}):(0,d.jsx)("span",{className:o,children:`:${e}:`})}var $a=()=>n(991003),Ga=()=>n(267419);class Qa extends(()=>n(757695))().Store{getInitialState(){return{cache:new Map,loadingPromises:new Map}}getCachedEmojis(e){const t=this.state.cache.get(e);if(!t)return{emojis:null,needsUpdate:!0};const n=Date.now()-t.timestamp>3e4;return{emojis:t.emojis,needsUpdate:n}}setCachedEmojis(e,t){this.update((n=>{const o=new Map(n.cache);return o.set(e,{emojis:t,timestamp:Date.now()}),{...n,cache:o}}))}getOrSetLoadingPromise(e,t){const n=this.state.loadingPromises.get(e);if(n)return n;const o=t().finally((()=>{this.update((t=>{const n=new Map(t.loadingPromises);return n.delete(e),{...t,loadingPromises:n}}))}));return this.update((t=>{const n=new Map(t.loadingPromises);return n.set(e,o),{...t,loadingPromises:n}})),o}clearCache(){this.update((e=>({cache:new Map,loadingPromises:new Map})))}clearCacheForKey(e){this.update((t=>{const n=new Map(t.cache),o=new Map(t.loadingPromises);return n.delete(e),o.delete(e),{cache:n,loadingPromises:o}}))}}const Ja=new Qa,Za=(0,o().YK)({anyEmoji:{id:"workflowSlackEmojiPicker.anyEmoji",defaultMessage:"Any emoji"},selectEmoji:{id:"workflowSlackEmojiPicker.selectEmoji",defaultMessage:"Select emoji(s)"},searchPlaceholder:{id:"workflowSlackEmojiPicker.selectEmoji.searchInput.placeholder",defaultMessage:"Search…"},loading:{id:"workflowSlackEmojiPicker.loading",defaultMessage:"Loading"},selected:{id:"workflowSlackEmojiPicker.selected",defaultMessage:"Selected"},otherEmojis:{id:"workflowSlackEmojiPicker.otherEmojis",defaultMessage:"All emojis"}}),Xa=["thumbs up","thumbs down"];function es(e){const{workflowDefinitionPointer:t,moduleId:n,specificEmoji:o}=e,r=(0,Ga()._)(),[a,s]=(0,i.useState)(!1),l=(0,it().v3)(),{workflowId:d,spaceId:c,transcriptId:u}=(0,gt().kI)(t),[g,f]=(0,i.useState)({}),m=(0,i.useMemo)((()=>d&&c?function(e){return`${e.spaceId}-${e.workflowId}-${e.moduleId}`}({workflowId:d,spaceId:c,moduleId:n}):null),[d,c,n]),p=(0,D().K8)((()=>m?Ja.getCachedEmojis(m):null),[m]),h=(0,i.useMemo)((()=>{const e={};for(const n in r.emojiByName){const t=r.emojiByName[n];Xa.includes(n)?e[n.replaceAll(/\s/g,"")]=t:!/\s/.test(n)&&Boolean(t)&&(e[n]=t)}const t={};for(const n in g){const o=g[n];if(o.includes("alias:")){const i=o.split("alias:")[1];t[n]=g[i]||e[i]}else t[n]=o}return{...e,...t}}),[g,r.emojiByName]),v=(0,i.useMemo)((()=>!!o&&Boolean(h[o])),[h,o]);return(0,i.useEffect)((()=>{if(null!=p&&p.emojis&&(f(p.emojis),!p.needsUpdate||o&&p.emojis[o]))return;if(!m||!d||!c)return;if(v)return;(async()=>{s(!0);try{const e=await Ja.getOrSetLoadingPromise(m,(async()=>{const e=await Wn().callApi({eventName:"getViaWorkflowModuleConfigurationUtil",environment:l,data:{workflowId:d,spaceId:c,transcriptId:u,moduleId:n,moduleType:"slack",callArguments:{functionName:"getWorkspaceEmojis",functionArgs:[]}}});if("success"===e.type){if("getWorkspaceEmojis"!==e.data.functionName)throw new Error("Invalid function name");const t=e.data.functionReturn;return Ja.setCachedEmojis(m,t),t}throw new Error("Failed to load emojis")}));f(e)}finally{s(!1)}})()}),[m,p,l,n,c,u,d,v,o]),{allEmojis:h,isLoading:a}}function ts({isInTranscript:e,moduleId:t,moduleValue:n,trigger:r,workflowDefinitionPointer:a,writeReactions:s}){const c=(0,D().uB)(void 0,K().A),u=(0,Mi().j)(),g=(0,i.useCallback)((()=>c.reset()),[c]),{triggerReaction:f,triggerReactions:m}=(0,i.useMemo)((()=>{var e,t;return{triggerReaction:null===(e=r.state)||void 0===e?void 0:e.reaction,triggerReactions:null===(t=r.state)||void 0===t?void 0:t.reactions}}),[r.state]),p=(0,i.useMemo)((()=>{const e=[...m||[]];return f&&!m&&e.push(f),e}),[f,m]);if("slack"!==(null==n?void 0:n.type))throw new Error("Module in WorkflowSlackEmojiPicker is not a slack module");const{allEmojis:h,isLoading:v}=es({workflowDefinitionPointer:a,moduleId:t}),w=(0,l().IS)((()=>({tooltipContent:{alignItems:"center",display:"flex",gap:8},emoji:{fontSize:16},buttonContent:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},buttonEmoji:{marginInlineStart:1,marginInlineEnd:2},buttonEmojiImage:{transform:"translateY(2px)"}})),[]),{renderedEmojis:y,tooltipNames:M}=(0,i.useMemo)((()=>{const e=[],t=[];for(const n of p)e.push((0,d.jsx)("span",{style:w.buttonEmoji,children:(0,d.jsx)("span",{style:w.buttonEmojiImage,children:(0,d.jsx)(qa,{emojiName:n,allEmojis:h})})},n)),t.push((0,d.jsxs)("div",{style:w.tooltipContent,children:[(0,d.jsx)("span",{style:w.emoji,children:(0,d.jsx)(qa,{emojiName:n,allEmojis:h})}),(0,d.jsx)("span",{children:n})]},n));return{renderedEmojis:e,tooltipNames:t}}),[h,w,p]);return(0,d.jsx)(z().A,{alignmentToOrigin:"end",buttonPopupStore:c,disabled:!1,originGap:0,placementToOrigin:"bottom",popupType:u,renderOrigin:e=>(0,d.jsx)(_e().m,{delayThreshold:0,disableTooltip:!(M.length>1),placement:"bottom",renderTooltip:()=>M.length>1?(0,d.jsx)("div",{children:M}):null,render:t=>{const n=!(0,gt().n7)(r,"reactions");return(0,d.jsx)(Ge,{buttonPopupEvents:e,tooltipEvents:t,needsSetup:n,isLoading:v,children:v?(0,d.jsx)(o().sA,{...Za.loading}):y.length>0?y:(0,d.jsx)(o().sA,{...Za.anyEmoji})})}}),render:e=>(0,d.jsx)(os,{...e,allEmojis:h,isLoading:v,triggerEmojis:p,writeReactions:s,onClose:g})})}function ns({virtualItem:e,item:t,allEmojis:n,intl:i,loadingVisible:r,onClose:a,query:s,setQuery:c,triggerEmojis:u,writeReactions:g,messages:f}){const m=(0,l().IS)((()=>({item:{position:"absolute",top:0,insetInlineStart:0,width:"100%",height:e.size,transform:`translateY(${e.start}px)`,padding:"0px 4px"}})),[e.size,e.start]);return(0,d.jsx)("div",{style:m.item,children:"section"===t.type&&"search"===t.data?(0,d.jsx)(B().A,{title:(0,d.jsx)(o().sA,{...f.selectEmoji}),children:(0,d.jsx)(_i().Ay,{inputLeft:(0,d.jsx)(_i().Zf,{icon:Vi().magnifyingGlassSmallIcon}),inputRight:r&&(0,d.jsx)(Y().A,{style:{marginInlineEnd:2}}),showClearButton:!0,placeholder:i.formatMessage(f.searchPlaceholder),focusInitial:!0,value:s,onChange:e=>c(e.target.value)})}):"item"===t.type&&"any-emoji"===t.data?(0,d.jsx)(N().A,{desktopIconStyle:{width:8},title:i.formatMessage(f.anyEmoji),isChecked:0===u.length,focused:!1,onClick:()=>{g([]),a()}}):"header"===t.type?(0,d.jsx)(B().A,{title:"selected"===t.data?i.formatMessage(f.selected):"unselected"===t.data?i.formatMessage(f.otherEmojis):void 0}):"item"===t.type&&t.data&&"any-emoji"!==t.data?(0,d.jsx)(N().A,{icon:(0,d.jsx)(qa,{emojiName:t.data,allEmojis:n}),desktopIconStyle:{width:8},title:`:${t.data}:`,isChecked:u.includes(t.data),focused:!1,onClick:()=>{const e=t.data;e&&(u.includes(e)?u.length>1&&g(u.filter((t=>t!==e))):g([...u,e]))}}):null})}function os({allEmojis:e,isLoading:t,triggerEmojis:n,writeReactions:r,onClose:a}){const[s,c]=(0,i.useState)(""),u=(0,i.useRef)(null),g=(0,o().tz)(),f=(0,$a().A)(t,500,300),{selectedEmojis:m,unselectedEmojis:p}=(0,i.useMemo)((()=>{const t=[],o=[];for(const i of n)e[i]&&is({emojiName:i,query:s})&&t.push(i);for(const i in e)is({emojiName:i,query:s})&&!n.includes(i)&&o.push(i);return{selectedEmojis:t,unselectedEmojis:o}}),[e,s,n]),h=(0,i.useMemo)((()=>{const e=[];if(e.push({type:"section",data:"search"}),s||e.push({type:"item",data:"any-emoji"}),m.length>0){e.push({type:"header",data:"selected"});for(const t of m)e.push({type:"item",data:t})}if(p.length>0&&m.length>0&&e.push({type:"header",data:"unselected"}),p.length>0)for(const t of p)e.push({type:"item",data:t});return e}),[s,m,p]),v=(0,Ia().Te)({count:h.length,getScrollElement:()=>u.current,estimateSize:(0,i.useCallback)((e=>{const t=h[e];return"section"===t.type?80:(t.type,32)}),[h]),overscan:10});(0,i.useEffect)((()=>{s.length>0&&v.scrollToIndex(0)}),[v,s.length]);const w=v.getVirtualItems(),y=(0,l().IS)((()=>({loadingContainer:{display:"flex",justifyContent:"center",alignItems:"center",padding:12,minHeight:"100px"}})),[]),M=(0,i.useCallback)((()=>w.map((t=>{const o=h[t.index],i=`${o.type}-${o.data}`;return(0,d.jsx)(ns,{virtualItem:t,item:o,allEmojis:e,intl:g,loadingVisible:f,onClose:a,query:s,setQuery:c,triggerEmojis:n,writeReactions:r,messages:Za},i)}))),[e,g,f,a,s,c,n,w,h,r]);return t&&0===Object.keys(e).length?(0,d.jsx)(W().A,{menuType:E().gu.Popup,width:266,maxHeight:"50vh",children:(0,d.jsxs)("div",{style:{flexGrow:1},children:[(0,d.jsx)(B().A,{title:(0,d.jsx)(o().sA,{...Za.selectEmoji}),children:(0,d.jsx)(_i().Ay,{inputLeft:(0,d.jsx)(_i().Zf,{icon:Vi().magnifyingGlassSmallIcon}),inputRight:(0,d.jsx)(Y().A,{style:{marginInlineEnd:2}}),showClearButton:!0,placeholder:g.formatMessage(Za.searchPlaceholder),focusInitial:!0,value:s,onChange:e=>{c(e.target.value)}})}),(0,d.jsx)("div",{style:y.loadingContainer,children:(0,d.jsx)(Y().k,{})})]})}):(0,d.jsx)(W().A,{menuType:E().gu.Popup,width:266,maxHeight:"50vh",children:(0,d.jsx)("div",{ref:u,style:{flexGrow:1,maxHeight:350,overflowX:"hidden",overflowY:"auto"},children:(0,d.jsx)("div",{style:{height:v.getTotalSize(),width:"100%",position:"relative"},children:M()})})})}function is(e){const{emojiName:t,query:n}=e;return 0===n.length||`:${t}:`.toLocaleLowerCase().indexOf(n.trim().toLocaleLowerCase())>=0}const rs=(0,o().YK)({reactionConfigDefault:{defaultMessage:"When a reaction is added in Slack",id:"slackTrigger.reactionConfig.default"},reactionConfigDescription:{defaultMessage:"When {reactions} added in {channels}",id:"slackTrigger.reactionConfig.description"},reactionConfigAnyReaction:{defaultMessage:"any reaction is",id:"slackTrigger.reactionConfig.anyReaction"},reactionConfigAnyChannel:{defaultMessage:"any channel",id:"slackTrigger.reactionConfig.anyChannel"},messageConfigDefault:{defaultMessage:"When a message is sent in Slack",id:"slackTrigger.messageConfig.default"},messageConfigDescription:{defaultMessage:"When a message is sent in {channels}",id:"slackTrigger.messageConfig.description"},threadConfigDefault:{defaultMessage:"When a thread is created in Slack",id:"slackTrigger.threadConfig.default"},threadConfigDescription:{defaultMessage:"When a thread is created in {channels}",id:"slackTrigger.threadConfig.description"},appMentionConfigDefault:{defaultMessage:"When the bot is mentioned in Slack",id:"slackTrigger.appMentionConfig.default"},appMentionConfigDescription:{defaultMessage:"When the bot is mentioned in {channels}",id:"slackTrigger.appMentionConfig.description"}});var as=()=>n(975366);const ss=(0,o().YK)({newSlackMessage:{defaultMessage:"New Slack message",id:"slackTrigger.newSlackMessage"},userMessage:{defaultMessage:"@{user}: {message}",id:"slackTrigger.userMessage"},reactionAdded:{defaultMessage:"@{user} reacted with {emoji}",id:"slackTrigger.reactionAdded"},reactionOnMessage:{defaultMessage:"@{user} reacted with {emoji} on {message}",id:"slackTrigger.reactionOnMessage"},followUpMessage:{defaultMessage:"@{user} followed up: {message}",id:"slackTrigger.followUpMessage"},followUpMessageGeneric:{defaultMessage:"Follow-up message",id:"slackTrigger.followUpMessageGeneric"},reactedBy:{defaultMessage:"Reacted by @{user}",id:"slackTrigger.reactedBy"},by:{defaultMessage:"by @{user}",id:"slackTrigger.by"},newSlackThread:{defaultMessage:"New Slack thread",id:"slackTrigger.newSlackThread"},threadInChannelWithMessage:{defaultMessage:"In #{channel}: {message}",id:"slackTrigger.threadInChannelWithMessage"},botMentionedInSlack:{defaultMessage:"Bot mentioned in Slack",id:"slackTrigger.botMentionedInSlack"},botMentionedWithMessage:{defaultMessage:"Bot mentioned in #{channel}: {message}",id:"slackTrigger.botMentionedWithMessage"},fromUser:{defaultMessage:"from @{user}",id:"slackTrigger.fromUser"},inChannel:{defaultMessage:"in #{channel}",id:"slackTrigger.inChannel"},viewInSlack:{defaultMessage:"View in Slack",id:"slackTrigger.viewInSlack"}});function ls(e){const{messageText:t,userName:n,channelName:i,messageUrl:r,isReaction:a=!1,isFollowUp:s=!1}=e;if(!t&&!n)return null;const l=[n?(0,d.jsx)("span",{children:a&&!s?(0,d.jsx)(o().sA,{...ss.reactedBy,values:{user:n}}):s?(0,d.jsx)(o().sA,{...ss.by,values:{user:n}}):(0,d.jsx)(o().sA,{...ss.fromUser,values:{user:n}})},"user"):null,i?(0,d.jsx)("span",{children:(0,d.jsx)(o().sA,{...ss.inChannel,values:{channel:i}})},"channel"):null,r?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{children:"·"}),(0,d.jsx)("span",{children:(0,d.jsx)(Zo,{href:r,children:(0,d.jsx)(o().sA,{...ss.viewInSlack})})},"link")]}):null].filter(Boolean);return(0,d.jsx)(Jo,{text:t?(0,d.jsx)(as().h,{markdown:t.trim()}):void 0,metadata:l.length>0?l:void 0})}function ds(e){var t,n;const{data:o}=e;if(!o)return null;const i="message"in o?o.message:null===(t=o.thread)||void 0===t?void 0:t[0];if(!i)return null;const r=i.message,a=i.url,s=i.channel,l="user"===(null===(n=i.from)||void 0===n?void 0:n.type)?i.from.handle:null,c="message"in o&&"isFollowUpMessage"in o&&Boolean(o.isFollowUpMessage);return(0,d.jsx)(ls,{messageText:r,userName:l,channelName:s,messageUrl:a,isReaction:!1,isFollowUp:c})}const cs=(0,o().YK)({slackMessage:{defaultMessage:"Message posted to Slack channel",id:"aiWorkflow.trigger.title.slack.message"},slackReactionAdded:{defaultMessage:"Emoji reaction added to a message",id:"aiWorkflow.trigger.title.slack.reaction"},slackAppMention:{defaultMessage:"Bot mentioned in message",id:"aiWorkflow.trigger.title.slack.app.mention"},slackChannelTranscriptDescription:{defaultMessage:"Pick a slack channel for {triggerName}",id:"aiWorkflow.trigger.title.slack.transcript.channel"},createThreadInChannelLoading:{defaultMessage:"Creating a new thread in a Slack channel",id:"workflow.run.effect.slack.createThreadInChannel.loading"},createThreadInDirectMessageLoading:{defaultMessage:"Creating a new thread in a Slack direct message",id:"workflow.run.effect.slack.createThreadInDirectMessage.loading"},replyInThreadLoading:{defaultMessage:"Replying to a Slack thread",id:"workflow.run.effect.slack.replyInThread.loading"},updateMessageLoading:{defaultMessage:"Updating a Slack message",id:"workflow.run.effect.slack.updateMessage.loading"},addReactionToMessageLoading:{defaultMessage:"Adding a reaction to a Slack message",id:"workflow.run.effect.slack.addReactionToMessage.loading"},removeReactionFromMessageLoading:{defaultMessage:"Removing a reaction from a Slack message",id:"workflow.run.effect.slack.removeReactionFromMessage.loading"},getThreadsInChannelSinceLoading:{defaultMessage:"Retrieving Slack threads from a channel",id:"workflow.run.effect.slack.getThreadsInChannelSince.loading"},queryChannelsLoading:{defaultMessage:"Querying Slack channels",id:"workflow.run.effect.slack.queryChannels.loading"},getUserLoading:{defaultMessage:"Retrieving a Slack user’s information",id:"workflow.run.effect.slack.getUser.loading"},findUserByEmailLoading:{defaultMessage:"Finding a Slack user by their email address",id:"workflow.run.effect.slack.findUserByEmail.loading"},parseSlackUriOrUrlLoading:{defaultMessage:"Parsing a Slack message URI or URL",id:"workflow.run.effect.slack.parseSlackUriOrUrl.loading"},loadMessageLoading:{defaultMessage:"Loading a Slack message",id:"workflow.run.effect.slack.loadMessage.loading"},viewFileUrlLoading:{defaultMessage:"Viewing a Slack file",id:"workflow.run.effect.slack.viewFileUrl.loading"},searchLoading:{defaultMessage:"Searching Slack",id:"workflow.run.effect.slack.search.loading"},createThreadInChannel:{defaultMessage:"Created a new thread in a Slack channel",id:"workflow.run.effect.slack.createThreadInChannel.description"},createThreadInDirectMessage:{defaultMessage:"Created a new thread in a Slack direct message",id:"workflow.run.effect.slack.createThreadInDirectMessage.description"},replyInThread:{defaultMessage:"Replied to a Slack thread",id:"workflow.run.effect.slack.replyInThread.description"},updateMessage:{defaultMessage:"Updated a Slack message",id:"workflow.run.effect.slack.updateMessage.description"},addReactionToMessage:{defaultMessage:"Added a reaction to a Slack message",id:"workflow.run.effect.slack.addReactionToMessage.description"},removeReactionFromMessage:{defaultMessage:"Removed a reaction from a Slack message",id:"workflow.run.effect.slack.removeReactionFromMessage.description"},getThreadsInChannelSince:{defaultMessage:"Retrieved Slack threads from a channel",id:"workflow.run.effect.slack.getThreadsInChannelSince.description"},queryChannels:{defaultMessage:"Queried Slack channels",id:"workflow.run.effect.slack.queryChannels.description"},getUser:{defaultMessage:"Retrieved a Slack user’s information",id:"workflow.run.effect.slack.getUser.description"},findUserByEmail:{defaultMessage:"Found a Slack user by their email address",id:"workflow.run.effect.slack.findUserByEmail.description"},parseSlackUriOrUrl:{defaultMessage:"Parsed a Slack message URI or URL to a parsed agent entity",id:"workflow.run.effect.slack.parseSlackUriOrUrl.description"},loadMessage:{defaultMessage:"Loaded a Slack message",id:"workflow.run.effect.slack.loadMessage.description"},viewFileUrl:{defaultMessage:"Viewed a Slack file",id:"workflow.run.effect.slack.viewFileUrl.description"},search:{defaultMessage:"Searched Slack",id:"workflow.run.effect.slack.search.description"},installAiConnector:{id:"addConnectionModal.installAiConnector",defaultMessage:"Install AI Connector"},noAiConnectorError:{id:"slack.error.noAiConnector",defaultMessage:"You must connect Slack as an AI connector in AI Settings before using it here."},gridAiConnectorError:{id:"slack.error.gridAiConnector",defaultMessage:"Slack Grid is not yet supported in custom agents."},workspaceMismatchError:{id:"slack.error.workspaceMismatch",defaultMessage:"You attempted to connect a Slack workspace ({workflowsTeamName}) that doesn’t match your AI connector ({aiConnectorTeamName})."}});function us(e){const{trigger:t,workflowDefinitionPointer:n,workflowValue:o,saveTrigger:r,isInTranscript:a,workflowStore:s}=e,l=(0,Di().l)(t),{state:c}=l,u=(0,i.useMemo)((()=>(o.modules??[]).find((e=>e.id===l.moduleId))),[l.moduleId,o.modules]),g=(0,Di().l)(u),f=(0,i.useCallback)(((e,t)=>{if(!c)return;const n={...l,state:{...c,allChannels:t,channelIds:e.map((e=>e.channelUri||e.channelUrl||e.channelId))}};r(n)}),[l,r,c]),m=(0,i.useCallback)((()=>{c&&"slack.app.mention"===c.type&&r({...l,state:{...c,shouldSubscribeToThread:!c.shouldSubscribeToThread}})}),[l,r,c]),p=(0,i.useCallback)((()=>{c&&r({...l,state:{...c,type:"slack.message"===c.type?"slack.thread.created":"slack.message"}})}),[l,r,c]);if(!c)throw new Error("Slack trigger state is required");if(!l.moduleId)throw new Error("Slack trigger moduleId is required");return(0,d.jsxs)(Ke,{children:[(0,d.jsx)(Ye,{label:"Channel",children:(0,d.jsx)(Na,{channelIds:c.channelIds,connectButtonVariant:"tint",isAllChannels:Boolean(c.allChannels),isInTranscript:a,isMultiSelectMode:!0,moduleId:l.moduleId,moduleValue:g,showLoginPromptIfNoConnection:!0,workflowDefinitionPointer:n,workflowStore:(0,Yr().N)(s),writeChannelIds:f,trigger:l})}),"slack.message"===c.type||"slack.thread.created"===c.type?(0,d.jsx)(Ye,{label:"Include messages in threads",children:(0,d.jsx)(je().A,{on:"slack.message"===c.type,onClick:p})}):null,"slack.app.mention"===c.type?(0,d.jsx)(Ye,{label:"Follow subsequent messages in thread",children:(0,d.jsx)(je().A,{on:c.shouldSubscribeToThread??!1,onClick:m})}):null]})}function gs(e,t){return e.formatMessage(cs.slackChannelTranscriptDescription,{triggerName:t.name})}const fs={triggers:{"slack.message":{icon:Fr().slackIcon,configuration:"minimal",description:cs.slackMessage,transcriptDescription:gs,ConfigurationComponent:us,TriggerOrRunTitle:function(e){var t;const{data:n}=e,i=null==n?void 0:n.message,r=null==i?void 0:i.channel,a="user"===(null==i||null===(t=i.from)||void 0===t?void 0:t.type)?i.from.handle:null,s=(null==i?void 0:i.message)??"",c=(0,l().IS)((()=>({container:{display:"flex",alignItems:"center",gap:3,minWidth:0},primary:{flexGrow:1,flexShrink:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},secondary:{color:f().Tj.text.secondary,flexShrink:0}})),[]),u=s&&a?(0,d.jsx)(o().sA,{...ss.userMessage,values:{user:a,message:s}}):(0,d.jsx)(o().sA,{...ss.newSlackMessage});return r?(0,d.jsxs)("span",{style:c.container,children:[(0,d.jsx)("span",{style:c.primary,children:u}),(0,d.jsxs)("span",{style:c.secondary,children:["#",r]})]}):u},TriggerContent:ds,SpecificTriggerDescription:function(e){const{trigger:t,moduleId:n,workflowDefinitionPointer:i,moduleValue:r}=e,{state:a}=t;if(!a||!r)return(0,d.jsx)(o().sA,{...rs.messageConfigDefault});let s;return s=a.allChannels||!a.channelIds||0===a.channelIds.length?(0,d.jsx)(o().sA,{...rs.reactionConfigAnyChannel}):(0,d.jsx)(qt,{separator:"or",limit:3,children:a.channelIds.map((e=>(0,d.jsx)(Ea,{channelId:e,moduleId:n,workflowDefinitionPointer:i,moduleValue:r},e)))}),(0,d.jsx)(o().sA,{...rs.messageConfigDescription,values:{channels:s}})}},"slack.reaction.added":{icon:Fr().slackIcon,description:cs.slackReactionAdded,configuration:"full",FullConfiguration:function(e){const{trigger:t,workflowDefinitionPointer:n,workflowValue:o,saveTrigger:r,isInTranscript:a,workflowStore:s}=e,{state:l}=t,c=(0,Di().l)(t),u=(0,i.useMemo)((()=>(o.modules??[]).find((e=>e.id===c.moduleId))),[c.moduleId,o.modules]),g=(0,Di().l)(u),f=(0,i.useCallback)((e=>{if(!l)return;let n=l;if("reaction"in l){const{reaction:e,...t}=l;n=t}r({...t,state:{...n,reactions:e}})}),[t,l,r]),m=(0,i.useCallback)(((e,n)=>{l&&r({...t,state:{...l,channelIds:e.map((e=>e.channelUrl||e.channelId)),allChannels:n}})}),[t,l,r]),p=(0,i.useCallback)((()=>{l&&r({...t,state:{...l,shouldSubscribeToThread:!l.shouldSubscribeToThread}})}),[t,l,r]);return l&&t.moduleId?(0,d.jsxs)(Ke,{children:[(0,d.jsx)(Ye,{label:"Reaction emoji",children:(0,d.jsx)(ts,{isInTranscript:a,moduleId:t.moduleId,moduleValue:g,trigger:t,workflowDefinitionPointer:n,workflowValue:o,writeReactions:f})}),(0,d.jsx)(Ye,{label:"In channel",children:(0,d.jsx)(Na,{channelIds:l.channelIds,connectButtonVariant:"tint",isAllChannels:Boolean(l.allChannels),isInTranscript:a,isMultiSelectMode:!0,moduleId:t.moduleId,moduleValue:u,showLoginPromptIfNoConnection:!0,workflowDefinitionPointer:n,workflowStore:(0,Yr().N)(s),writeChannelIds:m,trigger:c})}),(0,d.jsx)(Ye,{label:"Follow subsequent messages in thread",children:(0,d.jsx)(je().A,{on:l.shouldSubscribeToThread??!1,onClick:p})})]}):null},TriggerOrRunTitle:function(e){var t;const{data:n,moduleId:i,workflowDefinitionPointer:r}=e,a=null==n?void 0:n.message,s="user"===(null==n||null===(t=n.reactor)||void 0===t?void 0:t.type)?n.reactor.handle:"bot",c=null==n?void 0:n.reaction,u=null==a?void 0:a.channel,g=(null==a?void 0:a.message)??"",{allEmojis:m,isLoading:p}=es({workflowDefinitionPointer:r,moduleId:i,specificEmoji:c}),h=(0,l().IS)((()=>({container:{display:"flex",alignItems:"center",gap:6,minWidth:0},primary:{flexGrow:1,flexShrink:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},emoji:{marginInlineEnd:4,verticalAlign:"middle"},spinner:{display:"inline-block",marginInlineEnd:4,verticalAlign:"middle"},secondary:{color:f().Tj.text.secondary,flexShrink:0}})),[]),v=!c||Boolean(null==n?void 0:n.isFollowUpMessage),w=c?p?(0,d.jsx)("span",{style:h.spinner,children:(0,d.jsx)(Y().A,{size:"sm"})}):(0,d.jsx)("span",{style:h.emoji,children:(0,d.jsx)(qa,{emojiName:c,allEmojis:m,size:16})}):null;if(v){var y;const e="user"===(null==a||null===(y=a.from)||void 0===y?void 0:y.type)?a.from.handle:"bot",t=u&&g?(0,d.jsx)(o().sA,{...ss.followUpMessage,values:{channel:u,message:g,user:e}}):(0,d.jsx)(o().sA,{...ss.followUpMessageGeneric});return u?(0,d.jsxs)("span",{style:h.container,children:[(0,d.jsx)("span",{style:h.primary,children:t}),(0,d.jsxs)("span",{style:h.secondary,children:["#",u]})]}):t}const M=u&&g?(0,d.jsx)(o().sA,{...ss.reactionOnMessage,values:{channel:u,message:g,emoji:w,user:s}}):(0,d.jsx)(o().sA,{...ss.reactionAdded,values:{emoji:w,user:s}});return u?(0,d.jsxs)("span",{style:h.container,children:[(0,d.jsx)("span",{style:h.primary,children:M}),(0,d.jsxs)("span",{style:h.secondary,children:["#",u]})]}):M},TriggerContent:function(e){var t,n;const{data:o}=e;if(!o)return null;const i=o.message;if(!i)return null;const r=!o.reaction||Boolean(o.isFollowUpMessage),a=i.message,s=i.url,l=i.channel;let c=null;return r||"user"!==(null===(t=o.reactor)||void 0===t?void 0:t.type)?"user"===(null===(n=i.from)||void 0===n?void 0:n.type)&&(c=i.from.handle):c=o.reactor.handle,(0,d.jsx)(ls,{messageText:a,userName:c,channelName:l,messageUrl:s,isReaction:!0,isFollowUp:r})},SpecificTriggerDescription:function(e){const{trigger:t,moduleId:n,workflowDefinitionPointer:i,moduleValue:r}=e,{state:a}=t,{allEmojis:s,isLoading:l}=es({workflowDefinitionPointer:i,moduleId:n});if(!a||l)return(0,d.jsx)(o().sA,{...rs.reactionConfigDefault});let c,u;if(a.reactions&&0!==a.reactions.length){const e=(0,d.jsx)(qt,{separator:"or",limit:3,children:a.reactions.map((e=>(0,d.jsx)("span",{style:{marginInline:4},children:(0,d.jsx)(qa,{emojiName:e,allEmojis:s,size:16})},e)))}),t=1===a.reactions.length?" is":" are";c=(0,d.jsxs)(d.Fragment,{children:[e,t]})}else c=(0,d.jsx)(o().sA,{...rs.reactionConfigAnyReaction});return u=a.allChannels||!a.channelIds||0===a.channelIds.length?a?(0,d.jsx)(o().sA,{...rs.reactionConfigAnyChannel}):void 0:(0,d.jsx)(qt,{separator:"or",limit:3,children:a.channelIds.map((e=>(0,d.jsx)(Ea,{channelId:e,moduleId:n,workflowDefinitionPointer:i,moduleValue:r},e)))}),(0,d.jsx)(o().sA,{...rs.reactionConfigDescription,values:{reactions:c,channels:u,threadFollowing:a.shouldSubscribeToThread?"true":"false"}})}},"slack.thread.created":{icon:Fr().slackIcon,configuration:"minimal",description:cs.slackMessage,transcriptDescription:gs,ConfigurationComponent:us,TriggerOrRunTitle:function(e){var t;const{data:n}=e,i=null==n||null===(t=n.thread)||void 0===t?void 0:t[0],r=null==i?void 0:i.channel,a=(null==i?void 0:i.message)??"";return a&&r?(0,d.jsx)(o().sA,{...ss.threadInChannelWithMessage,values:{channel:r,message:a}}):(0,d.jsx)(o().sA,{...ss.newSlackThread})},TriggerContent:ds,SpecificTriggerDescription:function(e){const{trigger:t,moduleId:n,workflowDefinitionPointer:i,moduleValue:r}=e,{state:a}=t;if(!a)return(0,d.jsx)(o().sA,{...rs.threadConfigDefault});let s;return s=a.allChannels||!a.channelIds||0===a.channelIds.length?(0,d.jsx)(o().sA,{...rs.reactionConfigAnyChannel}):(0,d.jsx)(qt,{separator:"or",limit:3,children:a.channelIds.map((e=>(0,d.jsx)(Ea,{channelId:e,moduleId:n,workflowDefinitionPointer:i,moduleValue:r},e)))}),(0,d.jsx)(o().sA,{...rs.threadConfigDescription,values:{channels:s}})}},"slack.app.mention":{icon:Fr().slackIcon,configuration:"minimal",description:cs.slackAppMention,transcriptDescription:gs,ConfigurationComponent:us,TriggerOrRunTitle:function(e){const{data:t}=e,n=null==t?void 0:t.message,i=null==n?void 0:n.channel,r=(null==n?void 0:n.message)??"",a=Boolean(null==t?void 0:t.isFollowUpMessage),s=(0,l().IS)((()=>({container:{display:"flex",alignItems:"center",gap:6,minWidth:0},primary:{flexGrow:1,flexShrink:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},secondary:{color:f().Tj.text.secondary,flexShrink:0}})),[]);if(a){var c;const e="user"===(null==n||null===(c=n.from)||void 0===c?void 0:c.type)?n.from.handle:"bot",t=i&&r?(0,d.jsx)(o().sA,{...ss.followUpMessage,values:{channel:i,message:r,user:e}}):(0,d.jsx)(o().sA,{...ss.followUpMessageGeneric});return i?(0,d.jsxs)("span",{style:s.container,children:[(0,d.jsx)("span",{style:s.primary,children:t}),(0,d.jsxs)("span",{style:s.secondary,children:["#",i]})]}):t}return r&&i?(0,d.jsx)(o().sA,{...ss.botMentionedWithMessage,values:{message:r,channel:i}}):(0,d.jsx)(o().sA,{...ss.botMentionedInSlack})},TriggerContent:ds,SpecificTriggerDescription:function(e){const{trigger:t,moduleId:n,workflowDefinitionPointer:i,moduleValue:r}=e,{state:a}=t;if(!a)return(0,d.jsx)(o().sA,{...rs.appMentionConfigDefault});let s;return s=a.allChannels||!a.channelIds||0===a.channelIds.length?(0,d.jsx)(o().sA,{...rs.reactionConfigAnyChannel}):(0,d.jsx)(qt,{separator:"or",limit:3,children:a.channelIds.map((e=>(0,d.jsx)(Ea,{channelId:e,moduleId:n,workflowDefinitionPointer:i,moduleValue:r},e)))}),(0,d.jsx)(o().sA,{...rs.appMentionConfigDescription,values:{channels:s}})}}},effect:{"slack.createThreadInChannel":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?cs.createThreadInChannelLoading:cs.createThreadInChannel)},"slack.createThreadInDirectMessage":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?cs.createThreadInDirectMessageLoading:cs.createThreadInDirectMessage)},"slack.replyInThread":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?cs.replyInThreadLoading:cs.replyInThread)},"slack.updateMessage":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?cs.updateMessageLoading:cs.updateMessage)},"slack.addReactionToMessage":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?cs.addReactionToMessageLoading:cs.addReactionToMessage)},"slack.removeReactionFromMessage":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?cs.removeReactionFromMessageLoading:cs.removeReactionFromMessage)},"slack.getThreadsInChannelSince":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?cs.getThreadsInChannelSinceLoading:cs.getThreadsInChannelSince)},"slack.queryChannels":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?cs.queryChannelsLoading:cs.queryChannels)},"slack.getUser":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?cs.getUserLoading:cs.getUser)},"slack.findUserByEmail":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?cs.findUserByEmailLoading:cs.findUserByEmail)},"slack.parseSlackUriOrUrl":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?cs.parseSlackUriOrUrlLoading:cs.parseSlackUriOrUrl)},"slack.loadMessage":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?cs.loadMessageLoading:cs.loadMessage)},"slack.viewFileUrl":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?cs.viewFileUrlLoading:cs.viewFileUrl)},"slack.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?cs.searchLoading:cs.search)}},getSecondaryLabel:e=>(0,d.jsx)(Zr,{module:e}),needsCustomConnect:()=>{const e=(0,Kr().wd)().includes("slack"),t=(0,zr().LT)("slack").isInProgress;if(!e&&!t)return{connectHandler:()=>{Or().Ow({currentTab:"ai"})},connectMessage:(0,d.jsx)(o().sA,{...cs.installAiConnector})}},getErrorMessage:e=>{if("slack"===e.type&&e.state&&"error"in e.state){const t=e.state.error;if("no_slack_ai_connector"===(null==t?void 0:t.type))return(0,d.jsx)(o().sA,{...cs.noAiConnectorError});if("grid_ai_connector"===(null==t?void 0:t.type))return(0,d.jsx)(o().sA,{...cs.gridAiConnectorError});if("slack_workspace_mismatch"===(null==t?void 0:t.type))return(0,d.jsx)(o().sA,{...cs.workspaceMismatchError,values:{workflowsTeamName:t.workflowsTeamName,aiConnectorTeamName:t.aiConnectorTeamName}})}},getWorkspaceRestrictionInfo:()=>({restricted:!0,workspaceName:(0,zr().UK)("slack")}),ModuleConfiguration:function(e){const{isInTranscript:t,module:n,onUndoClick:o,saveModule:i,userHasEditAccess:r,workflowDefinitionPointer:s,workflowModuleStore:l,onAuthComplete:c,store:u}=e;return(0,d.jsx)(a().Y1,{align:"center",direction:"vertical",gap:4,children:t?(0,d.jsx)(na,{moduleValue:n,onUndoClick:o,saveModule:i,workflowDefinitionPointer:s,workflowModuleStore:l,onAuthComplete:c}):(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(za,{module:n,saveModule:i,userHasEditAccess:r,workflowDefinitionPointer:s,store:u})})})},configVariables:{slackChannel:{ConfigurationComponent:function(e){var t;const{isInTranscript:n,moduleId:o,setVariable:i,variable:r,workflowDefinitionPointer:a,workflowValue:s}=e;return(0,d.jsx)(Na,{channelIds:null!=r&&r.channelId?[r.channelId]:void 0,isAllChannels:!1,isInTranscript:n,isMultiSelectMode:!1,moduleId:o,workflowDefinitionPointer:a,moduleValue:null===(t=s.modules)||void 0===t?void 0:t.find((e=>e.id===o)),shouldShowSelectAllChannels:!1,shouldHideSelectedChannels:!0,writeChannelIds:e=>{if(e.length>0){const t=e.find((e=>e.channelId!==(null==r?void 0:r.channelId)))??e[0];i({channelId:t.channelId,channelName:t.channelName})}else i(void 0)}})}},multipleOrAllSlackChannel:{ConfigurationComponent:function(e){var t,n;const{variable:o,setVariable:i,workflowValue:r,workflowDefinitionPointer:a,moduleId:s,isInTranscript:l}=e,c=null!=o&&o.allChannels||null==o||null===(t=o.channels)||void 0===t?void 0:t.map((e=>e.channelId)).filter(Boolean);return(0,d.jsx)(Na,{channelIds:c,isAllChannels:(null==o?void 0:o.allChannels)??!1,isInTranscript:l,isMultiSelectMode:!0,moduleId:s,shouldShowSelectAllChannels:!1,shouldHideSelectedChannels:!0,workflowDefinitionPointer:a,moduleValue:null===(n=r.modules)||void 0===n?void 0:n.find((e=>e.id===s)),writeChannelIds:(e,t)=>{i(t?{allChannels:!0}:{allChannels:!1,channels:e.map((e=>({channelId:e.channelId,channelName:e.channelName})))})}})}}}},ms=(0,o().YK)({getState:{defaultMessage:"Returned test module state and permissions",id:"workflow.run.effect.test.getState.description"},getStateLoading:{defaultMessage:"Returning test module state and permissions",id:"workflow.run.effect.test.getState.loading"}}),ps={triggers:{},effect:{"test.getState":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?ms.getStateLoading:ms.getState)}}},hs=(0,o().YK)({search:{defaultMessage:"Searched the web",id:"workflow.run.effect.web.search.description"},searchLoading:{defaultMessage:"Searching the web",id:"workflow.run.effect.web.search.loading"},loadPage:{defaultMessage:"Loaded web page",id:"workflow.run.effect.web.loadPage.description"},loadPageLoading:{defaultMessage:"Loading web page",id:"workflow.run.effect.web.loadPage.loading"}}),vs={triggers:{},effect:{"web.search":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?hs.searchLoading:hs.search)},"web.loadPage":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>e.formatMessage(t?hs.loadPageLoading:hs.loadPage)}}};var ws=()=>n(481721);const ys=(0,o().YK)({listTools:{defaultMessage:"Listed worker tools",id:"workflow.run.effect.worker.listTools.description"},listToolsWhileRunning:{defaultMessage:"Listing worker tools",id:"workflow.run.effect.worker.listTools.descriptionWhileRunning"},runTool:{defaultMessage:"Ran worker tool",id:"workflow.run.effect.workers.runTool.description"},runToolWhileRunning:{defaultMessage:"Running worker tool",id:"workflow.run.effect.workers.runTool.descriptionWhileRunning"},runToolSpecific:{defaultMessage:"{workerName} ran {toolName}",id:"workflow.run.effect.workers.runToolSpecific.description"},runToolSpecificWhileRunning:{defaultMessage:"{workerName} running {toolName}",id:"workflow.run.effect.workers.runToolSpecificWhileRunning.descriptionWhileRunning"}}),Ms={triggers:{},effect:{"worker.listTools":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>t?e.formatMessage(ys.listToolsWhileRunning):e.formatMessage(ys.listTools)},"worker.runTool":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t,toolResultStep:n})=>{var o;const i=null==n||null===(o=n.moduleInfo)||void 0===o?void 0:o.name,r=null==n?void 0:n.toolTitle;return i&&r?t?e.formatMessage(ys.runToolSpecificWhileRunning,{workerName:i,toolName:r}):e.formatMessage(ys.runToolSpecific,{workerName:i,toolName:r}):t?e.formatMessage(ys.runToolWhileRunning):e.formatMessage(ys.runTool)}}},ModuleConfiguration:({module:e})=>{var t,n;const r=(0,o().tz)(),a=(0,it().v3)(),s=(0,D().O$)(Ko().AppStoreSidebarSpaceViewStore),l=null===(t=e.state)||void 0===t?void 0:t.workerId,c=null===(n=e.state)||void 0===n?void 0:n.workerName,[u,g]=(0,i.useState)(c);return(0,i.useEffect)((()=>{if(!l||!s)return;const e=s.getSpaceId();e&&(async()=>{try{const t=await Wn().callApi({environment:a,eventName:"getWorkers",data:{spaceId:e}});if("success"===t.type){const e=t.data.workers.find((e=>e.workerId===l));e&&g(e.name)}}catch{g(c)}})()}),[l,s,a,c]),l?(0,d.jsx)("div",{children:r.formatMessage({id:"workflows.modules.workers.configuration.workerName",defaultMessage:"{workerName}"},{workerName:u??e.name})}):null},getSecondaryLabel:e=>(0,d.jsx)(xs,{module:e}),getIcon:()=>ws().codeIcon};function xs(e){var t;const{module:n}=e,r=(0,it().v3)(),a=(0,D().O$)(Ko().AppStoreSidebarSpaceViewStore),s=null===(t=n.state)||void 0===t?void 0:t.workerId,[l,c]=(0,i.useState)(void 0);return(0,i.useEffect)((()=>{if(!s||!a)return;const e=a.getSpaceId();e&&(async()=>{try{const t=await Wn().callApi({environment:r,eventName:"getWorkers",data:{spaceId:e}});if("success"===t.type){const e=t.data.workers.find((e=>e.workerId===s));c(!e)}}catch{c(!1)}})()}),[s,a,r]),!0!==l?null:(0,d.jsx)(Ve().E,{color:"red",content:(0,d.jsx)(o().sA,{id:"workflows.modules.workers.deleted",defaultMessage:"Deleted"})})}const ks=(0,o().YK)({list:{defaultMessage:"Listed workspace workers",id:"workflow.run.effect.workers.list.description"},listWhileRunning:{defaultMessage:"Listing workspace workers",id:"workflow.run.effect.workers.list.descriptionWhileRunning"}}),bs={asana:C,box:j,calendar:nt,computer:vt,cursor:bt,discord:St,files:At,fs:Tt,github:Rt,gmail:Et,googleCalendar:Nt,googleDrive:Bt,images:_t,jira:Ot,linear:Kt,mail:co,mcpServer:No,microsoftTeams:Bo,modules:_o,notion:Rr,outlook:Er,salesforce:Nr,search:Br,sharepoint:_r,slack:fs,test:ps,web:vs,worker:Ms,workers:{triggers:{},effect:{"workers.list":{runDefinitionType:"minimal",getDescription:({intl:e,isLoading:t})=>t?e.formatMessage(ks.listWhileRunning):e.formatMessage(ks.list)}},ModuleConfiguration:()=>null,getSecondaryLabel:()=>null,getIcon:()=>ws().codeIcon}}},430840:(e,t,n)=>{n.d(t,{V:()=>p,b:()=>h});n(16280);var o=n(296540),i=()=>n(933922),r=()=>n(401497),a=()=>n(107975),s=()=>n(807449),l=()=>n(340498),d=()=>n(69708),c=()=>n(100622),u=()=>n(284371),g=()=>n(398208),f=n(474848);const m=(0,d().YK)({authAriaLabel:{id:"workflows.authDetails.popup.ariaLabel",defaultMessage:"Authenticate modal"},connectTitle:{id:"workflows.authDetails.title",defaultMessage:"Connect to {integrationName}"},cursorApiTokenLabel:{id:"workflows.authDetails.cursor.apiTokenLabel",defaultMessage:"Cursor API Token"},connecting:{id:"workflows.authDetails.connecting",defaultMessage:"Connecting..."},connect:{id:"workflows.authDetails.connect",defaultMessage:"Connect"}});const p={cursor:{VendorSpecificAuthDetails:function(e){const{workflowDefinitionPointer:t,moduleId:i,onDismiss:a,workflowModuleStore:g}=e,[p,h]=(0,o.useState)(""),[v,w]=(0,o.useState)(!1),[y,M]=(0,o.useState)(),x=(0,n(484714).v3)(),k=(0,r().IS)((()=>({logosContainer:{display:"flex",justifyContent:"center",alignItems:"center",gap:16,marginTop:20,marginBottom:24},logoIcon:{display:"flex",alignItems:"center",justifyContent:"center"},arrowIcon:{display:"flex",alignItems:"center",color:c().Tj.icon.secondary},title:{fontSize:20,margin:"0 50px 24px",textAlign:"center",fontWeight:u().Wy.medium},inputContainer:{display:"flex",flexDirection:"column",paddingInline:20,gap:16},row:{justifyContent:"center",marginTop:32,marginBottom:20},errorMessage:{color:c().Tj.red.text.accentPrimary,marginBottom:10},label:{fontSize:14,fontWeight:u().Wy.medium,marginBottom:8}})),[]),b=(0,o.useCallback)((e=>{h(n(201980).xV3(e.target.value)),M(void 0)}),[]),C=(0,o.useCallback)((async()=>{w(!0),M(void 0);try{const e=t.spaceId,o=g&&t.table===n(234459).To;if("success"!==(await n(769864).callApi({eventName:"postWorkflowsCursorConnect",environment:x,data:o?{type:"agent",integrationId:g.id,transcriptId:t.id,spaceId:e,apiToken:p}:{type:"workflow",workflowId:t.id,moduleId:i,spaceId:e,apiToken:p}})).type)throw new Error("Failed to save connection");w(!1),a()}catch(e){w(!1),M(e instanceof Error?e.message:"Failed to connect to Cursor. Please try again.")}}),[x,t,i,p,g,a]),S=(0,o.useCallback)((e=>{"Enter"===e.key&&C()}),[C]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{style:k.logosContainer,children:[(0,f.jsx)("div",{style:k.logoIcon,children:(0,f.jsx)(s().I,{icon:n(558687).notionIcon,size:l().Ev.xl})}),(0,f.jsx)("div",{style:k.arrowIcon,children:(0,f.jsx)(s().I,{icon:n(377114).arrowLeftRightIcon,size:l().Ev.default})}),(0,f.jsx)("div",{style:k.logoIcon,children:(0,f.jsx)(s().I,{icon:n(738508).cursorIcon,size:l().Ev.xl})})]}),(0,f.jsx)("div",{style:k.title,children:(0,f.jsx)(d().sA,{...m.connectTitle,values:{integrationName:"Cursor"}})}),(0,f.jsxs)("div",{style:k.inputContainer,children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:k.label,children:(0,f.jsx)(d().sA,{...m.cursorApiTokenLabel})}),(0,f.jsx)(n(31511).A,{value:p,onChange:b,onKeyDown:S,placeholder:"key_...",type:"password"})]}),y?(0,f.jsx)("div",{style:k.errorMessage,children:y}):void 0,(0,f.jsx)(n(249046).Ye,{style:k.row,children:(0,f.jsx)(n(160432).A,{colorPalette:"blue",onClick:C,disabled:!p||v,isLoading:v,children:v?(0,f.jsx)(d().sA,{...m.connecting}):(0,f.jsx)(d().sA,{...m.connect})})})]})]})}}};function h(e){const{onDismiss:t,isOpen:n,moduleType:o,moduleId:s,workflowDefinitionPointer:l,navigateWithModuleSpecificAuth:c,workflowModuleStore:u}=e,{VendorSpecificAuthDetails:h}=p[o]??{},v=(0,r().IS)((()=>({container:{padding:16,display:"flex",flexDirection:"column",gap:8,minWidth:460,maxWidth:460,maxHeight:565,position:"relative"},closeButton:{position:"absolute",insetInlineEnd:16,top:16,zIndex:1}})),[]),w=(0,d().tz)();return h?(0,f.jsx)(a().a,{ariaLabel:w.formatMessage(m.authAriaLabel),innerStyle:v.container,onDismiss:t,open:n,preventHideChildrenWhileOpening:!0,render:()=>(0,f.jsx)(i().A,{capture:!0,render:e=>(0,f.jsxs)("div",{...e,children:[(0,f.jsx)(h,{navigateWithModuleSpecificAuth:c,onDismiss:t,moduleId:s,workflowDefinitionPointer:l,workflowModuleStore:u}),(0,f.jsx)(g().A,{onClose:t,style:v.closeButton})]})})}):null}},449851:(e,t,n)=>{n.d(t,{d:()=>r});var o=()=>n(394593),i=()=>n(966249);const r={getName:(e,t)=>{const n=i().Nh[e.type];return n?n.getName(t,e):e.type},getDescription:(e,t)=>{const n=i().Nh[e.type];return n?n.getDescription(t):`Unknown module: ${e.type}`},getIcon:e=>{const t=i().Nh[e.type];return t?t.getIcon():o().z},getDefaultIcon:e=>{const t=i().Nh[e];return t?t.getIcon():o().z},isValidAndConnected:(e,t)=>{const n=i().Nh[e.type];if(!n)return!1;return"ready"===n.getModuleConfigurationStatus(e,t)},getMessageIfNotValid:(e,t,n)=>{var o,r;return null===(o=i().Nh[e.type])||void 0===o||null===(r=o.getMessageIfNotValid)||void 0===r?void 0:r.call(o,t,n)},getModuleConfigSection:e=>{var t,n;return(null===(t=i().Nh[e.type])||void 0===t||null===(n=t.getModuleConfigSection)||void 0===n?void 0:n.call(t))??"system"}}},451557:(e,t,n)=>{n.r(t),n.d(t,{createAgentAndStartThread:()=>V,createBlankAgentAndNavigate:()=>_,ensureNotionMailAccountOrTriggerOnboarding:()=>K,preloadNotionMailUserStatus:()=>z,showCreationModal:()=>F});var o=()=>n(907258),i=()=>n(242422),r=()=>n(726637),a=()=>n(81986),s=()=>n(868840),l=()=>n(179034),d=()=>n(798880),c=()=>n(743246),u=()=>n(201980),g=()=>n(530199),f=()=>n(536504);n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(581454);const m=["Mystical","Brilliant","Swift","Clever","Cosmic","Luminous","Nimble","Radiant","Ethereal","Mighty","Serene","Vibrant","Graceful","Bold","Wise","Fierce","Noble","Elegant","Majestic","Spirited","Enigmatic","Dazzling","Steadfast","Curious","Valiant","Whimsical","Poised","Dynamic","Refined","Legendary","Stellar","Astute","Zealous","Tranquil","Vivacious","Harmonious","Resilient","Enchanting","Formidable","Inspiring","Magnificent","Resourceful","Adventurous","Charming","Fearless","Sublime","Versatile","Extraordinary"],p=["Oracle","Scribe","Navigator","Guardian","Sage","Phoenix","Mentor","Beacon","Voyager","Keeper","Herald","Scholar","Pioneer","Virtuoso","Wanderer","Architect","Explorer","Luminary","Curator","Pathfinder","Emissary","Chronicler","Steward","Guide","Alchemist","Mystic","Ranger","Conductor","Falcon","Weaver","Champion","Seeker","Maverick","Nomad","Forager","Hunter","Collector","Strategist","Diplomat","Historian","Philosopher","Astronomer","Cartographer"];function h(e){const t=e?new Set(e.map((e=>e.toLowerCase()))):new Set;for(let n=0;n<100;n++){const e=`${m[Math.floor(Math.random()*m.length)]} ${p[Math.floor(Math.random()*p.length)]}`,o=0===n?e:`${e} ${n+1}`;if(!t.has(o.toLowerCase()))return o}return`${m[0]} ${p[0]} ${Date.now().toString().slice(-4)}`}var v=()=>n(496703),w=()=>n(915671),y=()=>n(498212),M=()=>n(563615),x=()=>n(769864),k=()=>n(44729),b=()=>n(257216),C=()=>n(384944),S=()=>n(243331),j=()=>n(36951),A=()=>n(555102),I=()=>n(703748),T=()=>n(594794),D=()=>n(246766),P=()=>n(712505),R=()=>n(547149),L=()=>n(844317),E=()=>n(147440),W=()=>n(418054),N=()=>n(687879),U=()=>n(22673);function B(e){const{environment:t,spaceStore:n,overrides:o,source:a,analytics:s,instructionsPageTitle:g}=e,m=t.currentUser.id,p=null==n?void 0:n.id;if(!m||!p)return;const v=(0,T().Z1)({environment:t,table:c().C0,spaceId:p});(0,U().qt)({environment:t,action:"create_new",workflowId:v,from:a,flowId:s.flowId,origin:s.origin});const y=i().default.checkGate({gateName:"custom_agent_page_instructions"}),{performResult:M,serverCommitResult:x}=R().createAndCommit({environment:t,userAction:"agentActions.createBlankAgent",canUndo:!0,perform:e=>{const i={...(0,w().bZ)(),name:h(),icon:(0,f().vl)(r().A.domainBaseUrl||""),...o},a=C().vt({environment:t,table:c().C0,args:{id:v,parentPointer:n.pointer,space_id:p,data:i,createdByPointer:{table:d().oo,id:m},permissions:[{type:"user_permission",role:"editor",user_id:m}]},inMemoryRecordCache:n.inMemoryRecordCache,transaction:e});if(y){const o=(0,T().Z1)({environment:t,table:l().ev,spaceId:p}),i=C().Wv({environment:t,id:o,type:"page",properties:{title:(0,u().x9d)(g??"Instructions")},spaceId:p,transaction:e,inMemoryRecordCache:n.inMemoryRecordCache,createdByTable:d().oo,createdById:m}),r=(0,T().Z1)({environment:t,table:l().ev,spaceId:p}),s=C().Wv({environment:t,id:r,type:"text",spaceId:p,transaction:e,inMemoryRecordCache:n.inMemoryRecordCache,createdByTable:d().oo,createdById:m});k().NI({parentStore:i.getContentStore(),childStore:s,transaction:e}),b().bn({transaction:e,childStore:i,parentStore:a,alive:!0}),R().applyOperation({store:a,operation:{pointer:a.pointer,command:"set",path:["data","instructions"],args:{table:l().ev,id:o,spaceId:p}},transaction:e})}return a}});return W().addSidebarWorkflow({environment:t,workflowId:v}),{workflowStore:M,serverCommitResult:x}}async function V(e){const{environment:t,spaceStore:n,submitArgs:r,analytics:l}=e,{prompt:d,prebuiltPrompt:c}=r,u=o().default.state.currentUserStore,f=o().default.state.sidebarSpaceViewStore;if(!u||!f)return;const m=B({environment:t,spaceStore:n,source:"prompt",analytics:l,instructionsPageTitle:e.instructionsPageTitle});if(!m)return;const{workflowStore:p,serverCommitResult:h}=m;await h;const v=(0,a().MI)((0,a().VD)("agent_thread_tools"),(e=>Boolean(i().default.checkGate({gateName:e})))),w=i().default.checkGate({gateName:"custom_agent_setup_mode_tool"}),M=i().default.checkGate({gateName:"custom_agent_flippy_layout"}),x=("create_custom_agent_from_modal"===(null==c?void 0:c.type)||"create_custom_agent"===(null==c?void 0:c.type))&&M&&(v||w),k=(0,L().getWorkflowAgentConfig)({environment:t,spaceId:n.id,isCustomAgent:x,workflowId:x?p.id:void 0,useCustomAgentDraft:x}),b="create_custom_agent_from_modal"===(null==c?void 0:c.type)||"create_custom_agent"===(null==c?void 0:c.type)?{type:c.type,enableAgentThreadTools:v,enableSetupModeTool:w,isCustomAgent:k.isCustomAgent,enableAgentTodos:k.enableAgentTodos,enableQueryMail:k.enableQueryMail,enableQueryCalendar:k.enableQueryCalendar}:null==c?void 0:c.args,C=c?(0,A().Jv)({environment:t,spaceStore:n,userStore:u,promptType:c.type,value:d??c.displayText,locale:c.locale,args:b}):(0,A().Kf)({environment:t,spaceStore:n,userStore:u,value:d}),S={userStore:u,spaceStore:n,spaceViewStore:f,blockStore:void 0,peekStore:void 0,workflowStore:p},T=(0,A().Xd)({environment:t,inferenceContext:S,config:k,addSteps:[C],surface:"workflows"}),R=(0,N().addTranscriptToNewThreadAndRun)({environment:t,spaceStore:n,transcript:T,workflowId:p.id,createdSource:"workflows",parentPointer:x?p.pointer:void 0});if(x){const e=(0,P().getUrlParamFromPeekMode)(s().A),o=(0,j().NC)({environment:t,threadId:R.id,spaceId:n.id,additionalQueryParams:{wfv:"settings",[g().ZI]:(0,y().Xw)(p.id),...e?{[g().fT]:e}:void 0}});(0,D().navigate)({environment:t,url:o})}else(0,I().openChatPanel)({environment:t,store:p,chatPanelState:{isOpen:!0,threadId:R.id}})}async function _(e){const{environment:t,spaceStore:n,analytics:r}=e,a=B({environment:t,spaceStore:n,source:"blank",analytics:r,instructionsPageTitle:e.instructionsPageTitle});if(!a)return;const{workflowStore:l,serverCommitResult:d}=a;await d;const c=o().default.state.currentUserStore,f=o().default.state.sidebarSpaceViewStore;if(!c||!f)return;const m=i().default.checkGate({gateName:"custom_agent_flippy_layout"});if(!m)return void(0,D().navigate)({environment:t,url:(0,v().L)({workflowId:l.id,params:{workflowViewType:"settings"}})});const p=(0,A().uP)({environment:t,spaceStore:n,userStore:c,actualMessage:(0,u().x9d)("Help the user set up their new custom agent. Ask what they want it to do and how it should be configured. Be concise and also creative on what the user might want. Do not test or offer testing until setup is complete; if the user asks to test early, explain setup is not finished, point out any missing integrations/triggers (for example, Slack), and continue the setup questions."),displayMessage:void 0}),h=(0,A().Xd)({environment:t,inferenceContext:{userStore:c,spaceStore:n,spaceViewStore:f,blockStore:void 0,peekStore:void 0,workflowStore:l},config:(0,L().getWorkflowAgentConfig)({environment:t,spaceId:n.id,isCustomAgent:m,workflowId:m?l.id:void 0,useCustomAgentDraft:m}),addSteps:m?[p]:[],surface:"workflows"}),w=(0,N().addTranscriptToNewThreadAndRun)({environment:t,spaceStore:n,transcript:h,workflowId:l.id,createdSource:"workflows",parentPointer:m?l.pointer:void 0}),M=(0,P().getUrlParamFromPeekMode)(s().A),x=(0,j().NC)({environment:t,threadId:w.id,spaceId:n.id,additionalQueryParams:{wfv:"settings",[g().ZI]:(0,y().Xw)(l.id),...M?{[g().fT]:M}:void 0}});(0,D().navigate)({environment:t,url:x})}async function F({analytics:e}){const t=await M().WorkflowDeps.NewAgentModal.load();await t.showNewAgentModal({analytics:e})}let O;function z(e){const{environment:t}=e;S().Lf.state.isLoaded||O||(O=x().callApi({eventName:"getIsMailUser",environment:t,data:{}}).then((e=>{const t="success"===e.type&&e.data.isMailUser;return S().Lf.setState({...S().Lf.state,isBackendConnected:t,isLoaded:!0}),t})).finally((()=>{O=void 0})))}async function K(e){const{environment:t,onConfirm:n}=e;let o;if(S().Lf.state.isLoaded)o=S().Lf.state.isBackendConnected;else if(O)o=await O;else{const e=await x().callApi({eventName:"getIsMailUser",environment:t,data:{}});o="success"===e.type&&e.data.isMailUser,S().Lf.setState({...S().Lf.state,isBackendConnected:o,isLoaded:!0})}return!!o||(E().b.open((()=>{S().Lf.setState({...S().Lf.state,isBackendConnected:!0,isLoaded:!0}),null==n||n()})),!1)}},475714:(e,t,n)=>{n.d(t,{A:()=>g});var o=n(296540),i=()=>n(221844),r=()=>n(484714),a=()=>n(590526),s=()=>n(743246),l=()=>n(384944),d=()=>n(547149),c=()=>n(638666);function u(e){const{workflowOrArtifactStore:t}=e;return t.table,s().C0,t.getDataStore().getKeyStore("triggers")}function g(e){const{workflowOrArtifactStore:t,triggerIdFromParent:n}=e,s=(0,r().v3)(),g=n,f=(0,o.useMemo)((()=>{const e=new(i().A)({name:"TriggerConfigModal",isTemporaryData:!0});return e.addCacheFallback(s.defaultRecordCache.inMemoryRecordCache),e}),[s.defaultRecordCache.inMemoryRecordCache]),m=(0,a().K8)((()=>function(e){const{workflowOrArtifactStore:t,triggerId:n}=e;if(!n)return;const o=u({workflowOrArtifactStore:t}),i=(o.getValue()??[]).findIndex((e=>e.id===n));return-1!==i?o.getKeyStore(i):void 0}({workflowOrArtifactStore:t,triggerId:g})),[g,t]),[p,h]=(0,o.useState)(void 0);return(0,o.useEffect)((()=>{var e;const n=(0,c().N)(t);if(!n)return;if(m)return;if(!n.getSpaceId())return;const o=u({workflowOrArtifactStore:t}),i=(null===(e=o.getValue())||void 0===e?void 0:e.length)??0,r=o.getKeyStore(i).clone(f);d().createAndCommit({userAction:"WorkflowActions.saveTrigger",environment:s,canUndo:!1,perform:e=>{l().KY({store:r,value:{id:g,name:void 0,enabled:!0,moduleId:void 0,state:void 0},transaction:e})}}),h(r)}),[m,f,t,s,g]),(0,o.useMemo)((()=>({persistedOrDraftTriggerStore:m??p,persistedTriggerStore:m})),[m,p])}},524490:(e,t,n)=>{n.d(t,{C:()=>P,w:()=>R});var o=n(296540),i=()=>n(726637),r=()=>n(590526),a=()=>n(401497),s=()=>n(250910),l=()=>n(118307),d=()=>n(807449),c=()=>n(406094),u=()=>n(324254),g=()=>n(69708),f=()=>n(534177),m=()=>n(971495),p=()=>n(423493),h=()=>n(430840),v=(n(944114),n(898992),n(354520),n(581454),()=>n(395361)),w=()=>n(546926),y=()=>n(890492),M=()=>n(81068),x=()=>n(449279),k=()=>n(663639),b=()=>n(736847),C=()=>n(236262),S=()=>n(100622),j=()=>n(778078),A=()=>n(419357),I=n(474848);function T(e){const{connectionId:t,connections:n,hideConnectAnotherWorkspace:r,onMenuItemClick:s,onMenuItemConnectClick:l,showDisconnect:c,showSearch:u}=e,[f,m]=(0,o.useState)(""),p=u&&f.length>0,h=(0,o.useCallback)((e=>{m(e.target.value)}),[m]),T=(0,v().Y)(h,100),D=(0,a().IS)((()=>({connectItem:{color:S().Tj.text.secondary}})),[]),P=(0,o.useMemo)((()=>({key:"search",items:[{action:()=>{},key:"search-input",render:e=>(0,I.jsx)(A().Ay,{...e,autoFocus:!i().A.isMobile,onChange:T,showClearButton:!0,value:f})}],render:e=>(0,I.jsx)(b().A,{...e,isInput:!0})})),[T,f]),R=(0,o.useMemo)((()=>{const e=n.sections.filter((e=>e.items.length>0));return p?{sections:e.map((e=>({...e,items:(0,j().Ay)(f,e.items,(e=>e.searchTitle))})))}:{sections:e}}),[n,p,f]),L=(0,o.useMemo)((()=>[...r?[]:[{key:"install-new-connection",action:l,render:e=>(0,I.jsx)(M().A,{...e,style:D.connectItem,title:(0,I.jsx)(g().sA,{defaultMessage:"Connect another account",id:"workflow.module.slack.connectionPickerMenu.connectAnotherAccountButtonTitle"})})}],...c?[{key:"disconnect-connection",action:()=>s(void 0),render:e=>(0,I.jsx)(M().A,{...e,icon:(0,I.jsx)(d().I,{icon:C().trashIcon,size:"sm"}),title:(0,I.jsx)(g().sA,{defaultMessage:"Disconnect",id:"workflow.module.slack.connectionPickerMenu.disconnectButtonTitle"})})}]:[]]),[r,s,l,c,D]),E=(0,o.useMemo)((()=>{const e=[];for(let n=0;n<R.sections.length;n++){const o=R.sections[n],i=e.length>0;0===o.items.length?e.push({key:`${n}-no-results`,items:[{key:`${n}-item-no-results`,action:()=>{},render:e=>(0,I.jsx)(x().u,{...e,title:(0,I.jsx)(g().sA,{defaultMessage:"No connections found",id:"workflow.module.slack.connectionPickerMenu.noPersonalConnectionsResults"})})},...L],render:e=>(0,I.jsx)(b().A,{...e,title:o.title,topBorder:i})}):e.push({key:`${n}-no-results`,items:[...o.items.map(((e,o)=>({action:async()=>{let t;t="onClick"in e?await e.onClick():e.pointer,s({pointer:t,name:e.title})},key:`${n}-${o}`,render:n=>{const o="onClick"in e?void 0:e.pointer;return(0,I.jsx)(M().A,{...n,icon:e.icon?e.icon({height:16,width:16}):void 0,title:e.title,isChecked:(null==o?void 0:o.id)===t})}}))),...L],render:e=>(0,I.jsx)(b().A,{...e,topBorder:i})})}return e}),[R.sections,L,s,t]),W=(0,o.useMemo)((()=>[...u?[P]:[],...E]),[E,P,u]);return(0,I.jsx)(y().A,{maxWidth:265,menuType:i().A.isMobile?w().gu.Modal:w().gu.Popup,children:(0,I.jsx)(k().A,{initialFocus:0,sections:W,type:k().O.Vertical})})}const D=(0,g().YK)({loading:{defaultMessage:"Loading workspaces…",id:"workflow.module.slack.connectionPicker.loading"},select:{defaultMessage:"Select a workspace",id:"workflow.module.slack.connectionPicker.select"},error:{defaultMessage:"Error loading workspaces",id:"workflow.module.slack.connectionPicker.error"}});function P(e){const{asyncConnections:t,hideConnectAnotherWorkspace:n,moduleValue:p,onMenuItemClick:v,selectedScopedExternalConnectionStore:w,selectedExternalConnection:y,workflowDefinitionPointer:M,workflowModuleStore:x,onAuthComplete:k}=e,b=(0,r().uB)(void 0,l().A),{handleConnect:C,authDetailModalArgs:S}=(0,m().U)({moduleValue:p,workflowDefinitionPointer:M,workflowModuleStore:x,onAuthComplete:k}),j=(0,a().IS)((()=>({button:{gap:6}})),[]),A=(0,r().K8)((()=>null==w?void 0:w.getName()),[w]),P=(0,o.useMemo)((()=>A??(null==y?void 0:y.name)),[A,y]),R=(0,r().K8)((()=>null==w?void 0:w.getKeyValue("id")),[w]),L=(0,o.useMemo)((()=>R??(null==y?void 0:y.id)),[R,y]),E=(0,o.useCallback)((()=>{C(),b.reset()}),[C,b]),W=(0,o.useCallback)((e=>{v(e),b.reset()}),[v,b]);let N,U,B=!0;return"idle"===t.status||"pending"===t.status?N=e=>(0,I.jsx)(c().A,{...e,disabled:!0,disabledFeedback:!0,isLoading:!0,style:j.button,children:(0,I.jsx)("span",{children:(0,I.jsx)(g().sA,{...D.loading})})}):"resolved"===t.status?(N=e=>(0,I.jsxs)(c().A,{...e,style:j.button,children:[(0,I.jsx)("span",{children:(0,f().O9)(P)?P:(0,I.jsx)(g().sA,{...D.select})}),(0,I.jsx)(d().I,{icon:u().arrowChevronSingleDownSmallIcon,size:"sm",fitToViewBox:"horizontal"})]}),B=!1,U=t.value):"rejected"===t.status?N=e=>(0,I.jsxs)(c().A,{...e,style:j.button,children:[(0,I.jsx)("span",{children:(0,I.jsx)(g().sA,{...D.error})}),(0,I.jsx)(d().I,{icon:u().arrowChevronSingleDownSmallIcon,size:"sm",fitToViewBox:"horizontal"})]}):(0,f().HB)(t),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(s().A,{alignmentToOrigin:"end",buttonPopupStore:b,disablePopup:B,originGap:4,popupType:i().A.isMobile?s().z.BottomSheet:s().z.Popup,render:e=>U?(0,I.jsx)(T,{connectionId:L,connections:U,hideConnectAnotherWorkspace:n,onMenuItemConnectClick:E,onMenuItemClick:W}):null,renderOrigin:N}),(0,I.jsx)(h().b,{...S})]})}function R(e){const{asyncConnections:t,moduleValue:n,onAuthComplete:i,onMenuItemClick:a,onConnectClick:s=(()=>{}),selectedScopedExternalConnectionStore:l,selectedExternalConnection:d,workflowDefinitionPointer:c,workflowModuleStore:u}=e,v=(0,g().tz)(),w=p().y[n.type],y=(0,r().K8)((()=>{var e;return(null==w||null===(e=w.getWorkspaceRestrictionInfo)||void 0===e||null===(e=e.call(w))||void 0===e?void 0:e.restricted)??!1}),[w]),{handleConnect:M,authDetailModalArgs:x}=(0,m().U)({moduleValue:n,workflowDefinitionPointer:c,workflowModuleStore:u,onAuthComplete:i}),k=(0,r().K8)((()=>null==l?void 0:l.getName()),[l]),b=(0,o.useMemo)((()=>k??(null==d?void 0:d.name)),[k,d]),C=(0,r().K8)((()=>null==l?void 0:l.getKeyValue("id")),[l]),S=(0,o.useMemo)((()=>C??(null==d?void 0:d.id)),[C,d]),j=(0,o.useCallback)((()=>{M(),s()}),[M,s]),A=(0,o.useCallback)((e=>{a(e)}),[a]);let P,R;return"idle"===t.status||"pending"===t.status?R=v.formatMessage(D.loading):"resolved"===t.status?(R=(0,f().O9)(b)?b:v.formatMessage(D.select),P=t.value):"rejected"===t.status?R=v.formatMessage(D.error):(0,f().HB)(t),{label:R,connectionsMenu:P?(0,I.jsx)(T,{connectionId:S,connections:P,hideConnectAnotherWorkspace:y,onMenuItemConnectClick:j,onMenuItemClick:A}):null,authModal:(0,I.jsx)(h().b,{...x})}}},552559:(e,t,n)=>{n.d(t,{Z:()=>De,D:()=>Te});var o=n(296540),i=()=>n(484714),r=()=>n(590526),a=()=>n(394888),s=()=>n(699143),l=()=>n(406094),d=()=>n(160432),c=()=>n(493552),u=()=>n(340498),g=()=>n(69708),f=()=>n(110443),m=()=>n(498212),p=()=>n(22673),h=()=>n(774879),v=()=>n(30757),w=()=>n(133532),y=(n(898992),n(354520),n(581454),n(964979),()=>n(119081)),M=()=>n(696706),x=()=>n(978234),k=()=>n(112968),b=()=>n(319625),C=()=>n(534177),S=()=>n(61958),j=()=>n(594794),A=()=>n(547149),I=()=>n(945109),T=()=>n(836095),D=()=>n(726637),P=()=>n(427704),R=()=>n(939768),L=()=>n(843801);const E=3*n(615234).Xb;function W(){L().j.reset()}async function N(e){return await async function(e){const{authorizationUrl:t}=e;L().j.initiate();const n=(0,R().Gm)({url:`${D().A.domainBaseUrl}${P().JZ.initiateExternalAuthenticationFromDesktop}`,query:{redirectUri:encodeURIComponent(t)}});await(0,T().P)(n)}({authorizationUrl:e.authorizationUrl}),async function(e){const t=(null==e?void 0:e.timeout)??E;try{await L().j.waitUntil((()=>{var e;return"initiated"!==(null===(e=L().j.state.mcpDesktopOAuthState)||void 0===e?void 0:e.status)}),{timeout:t})}catch{return W(),{success:!1,error:"timeout"}}const{mcpDesktopOAuthState:n}=L().j.state;return W(),"completed"===(null==n?void 0:n.status)?{success:!0,connectionId:n.connectionId}:{success:!1,error:"failed"}}({timeout:e.timeout})}const U=300,B=600,V=100,_=(0,g().YK)({oauthPopupTitle:{id:"ConnectMcpServerModal.oauthPopupTitle",defaultMessage:"Connect to MCP Server"},oauthFailed:{id:"ConnectMcpServerModal.oauthFailed",defaultMessage:"OAuth authentication failed."},oauthProcessingError:{id:"ConnectMcpServerModal.oauthProcessingError",defaultMessage:"Failed to process OAuth response."},oauthTimeout:{id:"ConnectMcpServerModal.oauthTimeout",defaultMessage:"Authentication timed out after 3 minutes. Please try again."},oauthInitFailed:{id:"ConnectMcpServerModal.oauthInitFailed",defaultMessage:"Failed to start authentication. Please try again."},oauthSecurityWarningFallback:{id:"ConnectMcpServerModal.oauthSecurityWarningFallback",defaultMessage:"This server’s OAuth configuration could not be automatically verified. Proceed with caution and use header-based authentication if required by this provider."},oauthSecurityWarningNoPKCE:{id:"ConnectMcpServerModal.oauthSecurityWarningNoPKCE",defaultMessage:"This server may have reduced security. Only connect if you trust this provider."},authSaveError:{id:"ConnectMcpServerModal.authSaveError",defaultMessage:"Integration created but authentication setup failed. You may need to reconfigure it."},createError:{id:"ConnectMcpServerModal.createError",defaultMessage:"Failed to create integration. Please try again."},scopesError:{id:"ConnectMcpServerModal.scopesError",defaultMessage:"At least one scope is required."},validationError:{id:"ConnectMcpServerModal.validationError",defaultMessage:"Failed to validate connection."},serverUnavailable:{id:"ConnectMcpServerModal.serverUnavailable",defaultMessage:"For security or quality reasons, this connection is not available at this time."},customAuthenticationHeadersError:{id:"ConnectMcpServerModal.customAuthenticationHeadersError",defaultMessage:"Failed to build authentication headers."}});async function F({store:e,environment:t,intl:n,spaceViewStore:o,existingModuleId:i,workflowId:r}){e.setIsInitializingAuthentication(!0);let a,s=!0;if(r&&i){const e=await async function({workflowId:e,moduleId:t,spaceViewStore:n,environment:o}){try{const i=await o.api.callApi({eventName:"getMcpOAuthStatus",environment:o,data:{workflowId:e,moduleId:t,spaceId:n.getSpaceId()}});return"success"===i.type?i.data:{connectionAuthType:"none"}}catch(i){return{connectionAuthType:"none"}}}({workflowId:r,moduleId:i,spaceViewStore:o,environment:t});s="nonOAuth"!==e.connectionAuthType,a=e.grantedScopes}const l=await async function({store:e,environment:t,intl:n}){try{const i=await t.api.callApi({eventName:"checkMcpOAuthSupport",environment:t,data:{serverUrl:e.state.serverUrl}});if("success"===i.type&&i.data.oauthSupported&&i.data.requiresDynamicRegistration){var o;const t=i.data.securityWarnings.map((e=>e.includes("fallback")?n.formatMessage(_.oauthSecurityWarningFallback):e.includes("PKCE")?n.formatMessage(_.oauthSecurityWarningNoPKCE):void 0)).filter(C().O9);return e.setOauthSecurityWarnings(t),null!==(o=i.data.metadata)&&void 0!==o&&o.scopes_supported&&i.data.metadata.scopes_supported.length>0&&(e.setScopes(i.data.metadata.scopes_supported),e.setSelectedScopes(i.data.metadata.scopes_supported)),!0}return!1}catch(i){return!1}}({store:e,environment:t,intl:n});if(l&&(e.addAvailableAuthenticationMethod("OAuth"),s&&(e.setSelectedAuthenticationMethod("OAuth"),a))){const t=e.state.scopes;e.setSelectedScopes(t&&t.length>0?a.filter((e=>t.includes(e))):a)}e.setIsInitializingAuthentication(!1)}async function O({store:e,spaceViewStore:t,existingModuleId:n,workflowId:o,environment:i,intl:r,currentUserPointer:a,flowId:s}){const l=Date.now(),d=e.state.serverUrl,c="OAuth"===e.state.selectedAuthenticationMethod?"oauth":"custom";let u,g,m,h;if(e.setAuthErrorMessage(void 0),e.setIsLoadingConnection(!0),!(0,f().hy)(e.state.serverUrl))if("OAuth"===e.state.selectedAuthenticationMethod){if(u=await async function({store:e,spaceViewStore:t,existingModuleId:n,environment:o,intl:i}){e.setIsOAuthProcessing(!0),localStorage.removeItem("mcpOAuthResponse");try{const r=(0,j().Z1)({environment:o,table:x().yM,spaceId:t.getSpaceId()}),a=await o.api.callApi({eventName:"initiateMcpOAuth",environment:o,data:{serverUrl:e.state.serverUrl,spaceId:t.getSpaceId(),integrationId:r,selectedScopes:e.state.selectedScopes&&e.state.selectedScopes.length>0?e.state.selectedScopes:void 0,initiationContext:n?"reconnect":"connect",callbackType:o.device.isElectron?"nativeredirect":"popup",debugMode:e.state.debugMode}});if("success"===a.type){const{authorizationUrl:n}=a.data;if(o.device.isElectron){const t=await N({authorizationUrl:n});return t.success?(e.setIsOAuthProcessing(!1),t.connectionId):(e.setAuthErrorMessage(i.formatMessage(_.oauthFailed)),void e.setIsOAuthProcessing(!1))}const r=Date.now(),s=new Promise((n=>{let a=0;const s=async()=>{a++;const l=localStorage.getItem("mcpOAuthResponse");if(l){if(Date.now()-r<V)return void setTimeout(s,U);try{const r=JSON.parse(l),a=await o.api.callApi({eventName:"getMcpOAuthCallback",environment:o,data:{code:r.code,state:r.state,error:r.error,error_description:r.error_description,error_uri:r.error_uri,spaceId:t.getSpaceId()}});if("success"===a.type&&a.data.success)e.setIsOAuthProcessing(!1),n(a.data.connectionId);else if("failed"===a.type){var d;e.setAuthErrorMessage((null===(d=a.error)||void 0===d?void 0:d.message)||i.formatMessage(_.oauthFailed)),e.setIsOAuthProcessing(!1),n(void 0)}else e.setAuthErrorMessage(a.data.error||i.formatMessage(_.oauthProcessingError)),e.setIsOAuthProcessing(!1),n(void 0)}catch(c){e.setAuthErrorMessage(i.formatMessage(_.oauthProcessingError)),e.setIsOAuthProcessing(!1),n(void 0)}finally{localStorage.removeItem("mcpOAuthResponse")}}else a>=B?(e.setAuthErrorMessage(i.formatMessage(_.oauthTimeout)),e.setIsOAuthProcessing(!1),n(void 0)):setTimeout(s,U)};s()}));return S().P(o,{url:n,width:600,height:700,titleMessage:_.oauthPopupTitle}).catch((e=>{})),await s}{const t=(a.body&&"debugMessage"in a.body&&"string"==typeof a.body.debugMessage?a.body.debugMessage:void 0)===f().wk;return void e.setAuthErrorMessage(i.formatMessage(t?_.serverUnavailable:_.oauthInitFailed))}}catch(r){return void e.setAuthErrorMessage((0,b().A)(r).message)}finally{e.setIsOAuthProcessing(!1)}}({store:e,spaceViewStore:t,existingModuleId:n,environment:i,intl:r}),!u)return h="oauth_failed",e.setIsLoadingConnection(!1),void(0,p().Pf)({environment:i,server_url:d,auth_method:c,error_type:h,workflow_id:o,flow_id:s,duration_ms:Date.now()-l})}else{if(g=function({store:e,intl:t}){if("Bearer Token"===e.state.selectedAuthenticationMethod&&e.state.bearerToken)return[{name:"Authorization",value:`Bearer ${e.state.bearerToken}`}];if("Basic"===e.state.selectedAuthenticationMethod&&e.state.basicUsername&&e.state.basicPassword)try{return[{name:"Authorization",value:`Basic ${btoa(`${e.state.basicUsername}:${e.state.basicPassword}`)}`}]}catch(n){return e.setAuthErrorMessage((0,b().A)(n).message),[]}return"API Key"===e.state.selectedAuthenticationMethod&&e.state.apiKeyName&&e.state.apiKeyValue?[{name:e.state.apiKeyName,value:e.state.apiKeyValue}]:(e.setAuthErrorMessage(t.formatMessage(_.customAuthenticationHeadersError)),[])}({store:e,intl:r}),0===g.length)return h="invalid_auth_headers",e.setIsLoadingConnection(!1),void(0,p().Pf)({environment:i,server_url:d,auth_method:c,error_type:h,workflow_id:o,flow_id:s,duration_ms:Date.now()-l});if(m=await async function({store:e,authHeaders:t,oAuthConnectionId:n,spaceViewStore:o,environment:i,intl:r}){try{const a=await i.api.callApi({eventName:"validateMcpConnection",environment:i,data:{serverUrl:e.state.serverUrl,spaceId:o.getSpaceId(),authHeaders:t,connectionId:n}});if("success"===a.type){if(a.data.success)return a.data.tools;{const t=a.data.error.message===f().wk;return void e.setAuthErrorMessage(t?r.formatMessage(_.serverUnavailable):a.data.error.message||r.formatMessage(_.validationError))}}if("failed"===a.type){const t=(a.body&&"debugMessage"in a.body&&"string"==typeof a.body.debugMessage?a.body.debugMessage:void 0)===f().wk;return void e.setAuthErrorMessage(r.formatMessage(t?_.serverUnavailable:_.validationError))}(0,C().HB)(a)}catch(a){return void e.setAuthErrorMessage((0,b().A)(a).message)}}({store:e,authHeaders:g,spaceViewStore:t,environment:i,intl:r}),!m)return h="validation_failed",e.setIsLoadingConnection(!1),void(0,p().Pf)({environment:i,server_url:d,auth_method:c,error_type:h,workflow_id:o,flow_id:s,duration_ms:Date.now()-l})}const v=await async function({store:e,oAuthConnectionId:t,authHeaders:n,validatedTools:o,spaceViewStore:i,existingModuleId:r,workflowId:a,environment:s,intl:l,currentUserPointer:d}){try{let g;if(r){if(g=M().L3.fromPointerLike({table:x().yM,id:r,spaceId:i.getSpaceId()}),!a){const t=y().P.createChildStore(i,g);await A().createAndCommit({canUndo:!1,environment:s,perform:n=>{const i=t.getData()||{};A().applyOperation({store:t.getDataStore(),transaction:n,operation:{pointer:g,command:"update",path:["data"],args:{...i,name:e.state.name,serverUrl:e.state.serverUrl,...o&&o.length>0?{tools:o}:{}}}})},userAction:"ConnectMcpServerModal.updateExistingModule"}).serverCommitResult}}else g=M().L3.fromPointerLike({table:x().yM,id:(0,j().Z1)({environment:s,table:x().yM,spaceId:i.getSpaceId()}),spaceId:i.getSpaceId()}),await(0,I().eg)({environment:s,currentUserPointer:d,workflowModule:{pointer:g,icon:"🤖",name:e.state.name,serverUrl:e.state.serverUrl,serverIconUrl:void 0,tools:o,...(0,k().Ws)(o)},workflowPointer:a?M().L3.fromPointerLike({table:"workflow",id:a,spaceId:i.getSpaceId()}):void 0}),(0,I().hP)({environment:s,spaceViewStore:i,workflowModulePointer:g});if(t||(0,f().hy)(e.state.serverUrl)||n&&n.length>0)try{var c;const o=await s.api.callApi({eventName:"postWorkflowsMcpServerConnect",environment:s,data:{workflowId:a,integrationId:null===(c=g)||void 0===c?void 0:c.id,spaceId:i.getSpaceId(),authHeaders:t?[{name:"__oauth_connection_id",value:t}]:n||[],initiationContext:r?"reconnect":"connect"}});if("success"!==o.type)return void e.setAuthErrorMessage(o.error.message||l.formatMessage(_.authSaveError));{const{serverIconUrl:e,tools:t,resources:n}=o.data;if(e||t&&t.length>0||n&&n.length>0){const o=y().P.createChildStore(i,g);await A().createAndCommit({canUndo:!1,environment:s,perform:i=>{const r={...o.getData()||{}};e&&(r.serverIconUrl=e),t&&t.length>0&&(r.tools=t),n&&n.length>0&&(r.resources=n),A().applyOperation({store:o.getDataStore(),transaction:i,operation:{pointer:g,command:"update",path:["data"],args:r}})},userAction:"ConnectMcpServerModal.updateServerMetadata"}).serverCommitResult}}}catch(u){return void e.setAuthErrorMessage(l.formatMessage(_.authSaveError))}return g.id}catch(u){return void e.setAuthErrorMessage(l.formatMessage(_.createError))}}({oAuthConnectionId:u,authHeaders:g,validatedTools:m,store:e,spaceViewStore:t,existingModuleId:n,workflowId:o,environment:i,intl:r,currentUserPointer:a});e.setIsLoadingConnection(!1);const w=Date.now()-l;var T;v?(0,p().Z)({environment:i,server_url:d,auth_method:c,workflow_id:o,module_id:v,flow_id:s,duration_ms:w,num_tools_discovered:(null===(T=m)||void 0===T?void 0:T.length)??0}):(0,p().Pf)({environment:i,server_url:d,auth_method:c,error_type:h||"complete_auth_failed",workflow_id:o,flow_id:s,duration_ms:w});return v}var z=()=>n(401497),K=()=>n(98126),Y=()=>n(81068),H=()=>n(736847),q=()=>n(942715),$=()=>n(100622),G=()=>n(284371);const Q=["Bearer Token","Basic","API Key"];class J extends(()=>n(757695))().Store{getInitialState(){return{serverUrl:"",serverIconUrl:void 0,name:"",isPrepopulatedServer:!1,serverUrlInputStatus:"none",availableAuthenticationMethods:[...Q],selectedAuthenticationMethod:Q[0],isInitializingAuthentication:!1,isOAuthProcessing:!1,isLoadingConnection:!1,debugMode:!1}}canConnect(){return Boolean(this.state.serverUrl)&&"valid"===this.state.serverUrlInputStatus&&Boolean(this.state.name)&&!this.state.nameErrorMessage&&!this.state.isOAuthProcessing&&(()=>{if((0,f().hy)(this.state.serverUrl))return!0;const e=this.state.selectedAuthenticationMethod;return"OAuth"===e?!this.state.selectedScopes||this.state.selectedScopes.length>0:"Bearer Token"===e?Boolean(this.state.bearerToken):"Basic"===e?Boolean(this.state.basicUsername)&&Boolean(this.state.basicPassword):"API Key"===e?Boolean(this.state.apiKeyName)&&Boolean(this.state.apiKeyValue):void(0,C().HB)(e)})()}setServerUrl(e){this.setState({...this.state,serverUrl:e})}setName(e){this.setState({...this.state,name:e})}setServerIconUrl(e){this.setState({...this.state,serverIconUrl:e})}setIsPrepopulatedServer(e){this.setState({...this.state,isPrepopulatedServer:e})}setServerUrlInputStatus(e){this.setState({...this.state,serverUrlInputStatus:e})}setServerUrlErrorMessage(e){this.setState({...this.state,serverUrlErrorMessage:e})}setNameErrorMessage(e){this.setState({...this.state,nameErrorMessage:e})}setAuthErrorMessage(e){this.setState({...this.state,authErrorMessage:e})}setIsInitializingAuthentication(e){this.setState({...this.state,isInitializingAuthentication:e})}setOauthSecurityWarnings(e){this.setState({...this.state,oauthSecurityWarnings:e})}setScopes(e){this.setState({...this.state,scopes:e})}setSelectedScopes(e){this.setState({...this.state,selectedScopes:e})}setIsOAuthProcessing(e){this.setState({...this.state,isOAuthProcessing:e})}setSelectedAuthenticationMethod(e){this.setState({...this.state,selectedAuthenticationMethod:e})}addAvailableAuthenticationMethod(e){const t=this.state.availableAuthenticationMethods;t.includes(e)||this.setState({...this.state,availableAuthenticationMethods:[e,...t]})}setIsLoadingConnection(e){this.setState({...this.state,isLoadingConnection:e})}setBearerToken(e){this.setState({...this.state,bearerToken:e})}setBasicUsername(e){this.setState({...this.state,basicUsername:e})}setBasicPassword(e){this.setState({...this.state,basicPassword:e})}setApiKeyName(e){this.setState({...this.state,apiKeyName:e})}setApiKeyValue(e){this.setState({...this.state,apiKeyValue:e})}setDebugMode(e){this.setState({...this.state,debugMode:e})}}const Z=new J;var X=()=>n(31511),ee=n(474848);function te({label:e,value:t,onChange:n,isSecret:o=!0,disabled:i=!1}){const r=(0,z().IS)((()=>({input:{width:"180px"}})),[]);return(0,ee.jsxs)(s().Y1,{direction:"horizontal",gap:"auto",padding:"8px 0 0 0",align:"center",children:[(0,ee.jsx)(c().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:e}),(0,ee.jsx)(X().A,{value:t,onChange:e=>n(e.target.value),style:r.input,type:o?"password":"text",disabled:i})]})}var ne=()=>n(807449),oe=()=>n(532940),ie=()=>n(148974);const re=(0,g().YK)({customMcpWarningTitle:{id:"ConnectMcpServerModal.customMcpWarningTitle",defaultMessage:"You are connecting a custom MCP server that Notion has not reviewed"},customMcpWarningDescription:{id:"ConnectMcpServerModal.customMcpWarningDescription",defaultMessage:"Once connected, this MCP server can access content shared with your agent, permanently modify content, and share data externally. Only connect MCP servers you trust. "}});function ae(){const e=(0,z().IS)((()=>({container:{overflow:"hidden"},titleContainer:{background:$().Tj.orange.background.primary,borderTop:`1px solid ${$().Tj.orange.border.secondary}`,borderInlineStart:`1px solid ${$().Tj.orange.border.secondary}`,borderInlineEnd:`1px solid ${$().Tj.orange.border.secondary}`,borderStartStartRadius:ie().Vq.large,borderStartEndRadius:ie().Vq.large},descriptionContainer:{borderBottom:`1px solid ${$().Tj.gray.border.primary}`,borderInlineStart:`1px solid ${$().Tj.gray.border.primary}`,borderInlineEnd:`1px solid ${$().Tj.gray.border.primary}`,borderEndStartRadius:ie().Vq.large,borderEndEndRadius:ie().Vq.large}})),[]);return(0,ee.jsxs)(s().Y1,{direction:"vertical",style:e.container,children:[(0,ee.jsxs)(s().Y1,{direction:"horizontal",gap:8,padding:12,style:e.titleContainer,children:[(0,ee.jsx)(ne().I,{icon:oe().exclamationMarkTriangleIcon,colorPalette:"orange",colorVariant:"secondary"}),(0,ee.jsx)(c().D,{styleKey:"bodySmMedium",colorPalette:"orange",colorVariant:"secondary",children:(0,ee.jsx)(g().sA,{...re.customMcpWarningTitle})})]}),(0,ee.jsx)(s().Y1,{padding:12,style:e.descriptionContainer,children:(0,ee.jsx)(c().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,ee.jsx)(g().sA,{...re.customMcpWarningDescription})})})]})}var se=()=>n(420802);const le=(0,g().YK)({oAuthMessage:{id:"ConnectMcpServerModal.oAuthMessage",defaultMessage:"You will be redirected to the third party website to complete authentication when you connect."},scopesDescription:{id:"ConnectMcpServerModal.scopesDescription",defaultMessage:"Review what scopes this MCP server has when using tools or answering questions."},scopesLabel:{id:"ConnectMcpServerModal.scopesLabel",defaultMessage:"Scopes"},scopeLabel:{id:"ConnectMcpServerModal.scopeLabel",defaultMessage:"Scope"},allLabel:{id:"ConnectMcpServerModal.allLabel",defaultMessage:"All"},customLabel:{id:"ConnectMcpServerModal.customLabel",defaultMessage:"Custom"}});function de(){const e=(0,g().tz)(),[t,n,o]=(0,r().K8)((()=>[Z.state.scopes,Z.state.selectedScopes,Z.state.isLoadingConnection]),[]);return(0,ee.jsxs)(s().Y1,{direction:"vertical",gap:16,children:[(0,ee.jsx)(c().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:e.formatMessage(le.oAuthMessage)}),t&&n?t.length>1?(0,ee.jsx)(ce,{scopes:t,selectedScopes:n,disabled:o}):(0,ee.jsx)(ge,{scope:t[0]}):void 0]})}function ce({scopes:e,selectedScopes:t,disabled:n=!1}){const o=(0,g().tz)(),i=(0,z().IS)((()=>({selectButtonLabel:{color:$().Tj.text.primary,fontWeight:G().Wy.medium}})),[]);return(0,ee.jsxs)(s().Y1,{direction:"vertical",children:[(0,ee.jsx)(q().A,{label:o.formatMessage(le.scopesLabel),labelStyle:i.selectButtonLabel,selectedTitle:e.length===t.length?o.formatMessage(le.allLabel):o.formatMessage(le.customLabel),disabled:n,renderMenuSections:o=>[{key:"scopes",render:e=>(0,ee.jsx)(H().A,{...e}),items:e.map(((e,o)=>({key:`${e}-${o}`,action:()=>{},render:o=>(0,ee.jsx)(ue,{scope:e,selectedScopes:t,disabled:n})})))}]}),(0,ee.jsx)(c().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:o.formatMessage(le.scopesDescription)})]})}function ue({scope:e,selectedScopes:t,disabled:n=!1}){const i=(0,g().tz)(),r=o.useCallback((()=>{n||function({store:e,scope:t,intl:n}){var o,i;e.setSelectedScopes(null!==(o=e.state.selectedScopes)&&void 0!==o&&o.includes(t)?e.state.selectedScopes.filter((e=>e!==t)):[...e.state.selectedScopes||[],t]),0===(null===(i=e.state.selectedScopes)||void 0===i?void 0:i.length)?e.setAuthErrorMessage(n.formatMessage(_.scopesError)):e.setAuthErrorMessage(void 0)}({store:Z,scope:e,intl:i})}),[n,i,e]);return(0,ee.jsxs)(s().Y1,{direction:"horizontal",gap:6,align:"center-left",padding:4,children:[(0,ee.jsx)(se().S,{checked:t.includes(e),size:14,onClick:r,disabled:n}),(0,ee.jsx)(c().D,{styleKey:"bodySmRegular",onClick:r,style:{cursor:n?"default":"pointer"},children:e})]})}function ge({scope:e}){const t=(0,g().tz)();return(0,ee.jsxs)(s().Y1,{direction:"horizontal",align:"center",gap:"auto",height:32,children:[(0,ee.jsx)(c().D,{styleKey:"bodyMedium",children:t.formatMessage(le.scopeLabel)}),(0,ee.jsx)(c().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:e})]})}const fe=(0,g().YK)({authenticationLabel:{id:"ConnectMcpServerModal.authenticationLabel",defaultMessage:"Authentication"},customAuthenticationMessage:{id:"ConnectMcpServerModal.customAuthenticationMessage",defaultMessage:"The authorization header will be automatically generated."}});function me(e,t){switch(e){case"OAuth":return[];case"Bearer Token":return[{label:"Token",value:t.bearerToken,onChange:e=>Z.setBearerToken(e),isSecret:!0}];case"Basic":return[{label:"Username",value:t.basicUsername,onChange:e=>Z.setBasicUsername(e),isSecret:!1},{label:"Password",value:t.basicPassword,onChange:e=>Z.setBasicPassword(e),isSecret:!0}];case"API Key":return[{label:"Key",value:t.apiKeyName,onChange:e=>Z.setApiKeyName(e),isSecret:!1},{label:"Value",value:t.apiKeyValue,onChange:e=>Z.setApiKeyValue(e),isSecret:!0}]}}function pe({spaceViewStore:e,existingModuleId:t,workflowId:n}){const o=(0,g().tz)(),[i,a,l,d,u,f,m,p]=(0,r().K8)((()=>[Z.state.isInitializingAuthentication,Z.state.selectedAuthenticationMethod,Z.state.availableAuthenticationMethods,Z.state.authErrorMessage,me(Z.state.selectedAuthenticationMethod,{bearerToken:Z.state.bearerToken,basicUsername:Z.state.basicUsername,basicPassword:Z.state.basicPassword,apiKeyName:Z.state.apiKeyName,apiKeyValue:Z.state.apiKeyValue}),Z.state.isLoadingConnection,Z.state.isPrepopulatedServer,Z.state.isPrepopulatedServer&&"OAuth"===Z.state.selectedAuthenticationMethod]),[]),h=(0,z().IS)((()=>({selectButtonLabel:{color:$().Tj.text.primary,fontWeight:G().Wy.medium}})),[]);return i?(0,ee.jsx)(s().Y1,{direction:"horizontal",align:"center",width:"fill",children:(0,ee.jsx)(K().k,{})}):(0,ee.jsxs)(s().Y1,{direction:"vertical",children:[p?(0,ee.jsx)(he,{}):(0,ee.jsx)(q().A,{label:o.formatMessage(fe.authenticationLabel),labelStyle:h.selectButtonLabel,selectedTitle:a,disabled:f,renderMenuSections:e=>[{key:"authentication-methods",render:e=>(0,ee.jsx)(H().A,{...e}),items:l.map((t=>({key:t,action:()=>{e.close(),Z.setSelectedAuthenticationMethod(t)},render:e=>(0,ee.jsx)(Y().A,{...e,title:t})})))}]}),"OAuth"===a?(0,ee.jsx)(de,{}):void 0,u.map((e=>(0,ee.jsx)(te,{...e,disabled:f},e.label))),Q.includes(a)?(0,ee.jsx)(s().Y1,{padding:"12px 0 0 0",children:(0,ee.jsx)(c().D,{styleKey:"captionRegular",colorVariant:"secondary",children:o.formatMessage(fe.customAuthenticationMessage)})}):void 0,m?void 0:(0,ee.jsx)(s().Y1,{padding:"16px 0 0 0",children:(0,ee.jsx)(ae,{})}),d?(0,ee.jsx)(s().Y1,{padding:"16px 0 0 0",children:(0,ee.jsx)(c().D,{styleKey:"captionRegular",colorPalette:"red",colorVariant:"accentPrimary",children:d})}):void 0]})}function he(){const e=(0,g().tz)();return(0,ee.jsxs)(s().Y1,{direction:"horizontal",align:"center",gap:"auto",height:32,children:[(0,ee.jsx)(c().D,{styleKey:"bodyMedium",children:e.formatMessage(fe.authenticationLabel)}),(0,ee.jsxs)(c().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:["OAuth"," "]})]})}(0,g().YK)({debugModeLabel:{id:"ConnectMcpServerModal.debugModeLabel",defaultMessage:"Debug mode (1-minute token TTL)"}});function ve({serverUrl:e}){const[t]=(0,r().K8)((()=>[Z.state.debugMode]),[]);return null}var we=()=>n(591779);const ye=(0,g().YK)({nameInputLabel:{id:"ConnectMcpServerModal.nameInputLabel",defaultMessage:"Name"},duplicateNameWarning:{id:"ConnectMcpServerModal.duplicateNameWarning",defaultMessage:"Another MCP server in your workspace is using this name. Choose another name to continue."},namePlaceholder:{id:"ConnectMcpServerModal.namePlaceholder",defaultMessage:"Example MCP Server"}});function Me({existingModuleId:e,existingAgentMcpData:t}){const n=(0,g().tz)(),[i,a,l]=(0,r().K8)((()=>[Z.state.name,Z.state.nameErrorMessage,Z.state.isLoadingConnection]),[]);(0,o.useEffect)((()=>{Z.setNameErrorMessage(void 0)}),[i]);const d=(0,we().lW)(i,Te,Object.is);return(0,o.useEffect)((()=>{if(e||!d.trim())return void Z.setNameErrorMessage(void 0);const o=d.toLowerCase().trim();t.names.has(o)?Z.setNameErrorMessage(n.formatMessage(ye.duplicateNameWarning)):Z.setNameErrorMessage(void 0)}),[d,t,e,n]),(0,ee.jsxs)(s().Y1,{direction:"vertical",gap:6,children:[(0,ee.jsx)(c().D,{styleKey:"captionMedium",colorVariant:"secondary",children:n.formatMessage(ye.nameInputLabel)}),(0,ee.jsx)(X().A,{placeholder:n.formatMessage(ye.namePlaceholder),value:i,onChange:e=>Z.setName(e.target.value),disabled:l}),a?(0,ee.jsx)(c().D,{styleKey:"captionRegular",colorPalette:"red",colorVariant:"accentPrimary",children:a}):void 0]})}const xe=(0,g().YK)({oauthProcessing:{id:"ConnectMcpServerModal.oauthProcessing",defaultMessage:"Processing authentication..."},oauthProcessingHelper:{id:"ConnectMcpServerModal.oauthProcessingHelper",defaultMessage:"Please complete the authentication in the popup window. Once you authorize, this will update automatically."}});function ke(){const e=(0,g().tz)();return(0,ee.jsxs)(s().Y1,{direction:"vertical",gap:16,align:"center",padding:"16px 0px",children:[(0,ee.jsx)(K().k,{}),(0,ee.jsxs)(s().Y1,{direction:"vertical",gap:6,align:"center",children:[(0,ee.jsx)(c().D,{styleKey:"bodyRegular",children:e.formatMessage(xe.oauthProcessing)}),(0,ee.jsx)(c().D,{styleKey:"captionRegular",colorVariant:"secondary",style:{textAlign:"center"},children:e.formatMessage(xe.oauthProcessingHelper)})]})]})}var be=()=>n(209969),Ce=()=>n(637433),Se=()=>n(402137);const je=(0,g().YK)({serverUrlInputLabel:{id:"ConnectMcpServerModal.serverUrlInputLabel",defaultMessage:"MCP Server URL"},invalidUrl:{id:"ConnectMcpServerModal.invalidUrl",defaultMessage:"Please enter a valid URL"},httpsRequired:{id:"ConnectMcpServerModal.httpsRequired",defaultMessage:"MCP server URL must use HTTPS"},duplicateUrl:{id:"ConnectMcpServerModal.duplicateUrl",defaultMessage:"This MCP server has already been added to your workspace."},notionMcpNotAllowed:{id:"ConnectMcpServerModal.notionMcpNotAllowed",defaultMessage:"Cannot add Notion MCP server"}});function Ae({existingModuleId:e,existingAgentMcpData:t,readOnly:n}){const i=(0,g().tz)(),[a,l,d]=(0,r().K8)((()=>[Z.state.serverUrl,Z.state.serverUrlErrorMessage,Z.state.isLoadingConnection]),[]);(0,o.useEffect)((()=>{a.trim()?Z.setServerUrlInputStatus("loading"):Z.setServerUrlInputStatus("none"),Z.setServerUrlErrorMessage(void 0)}),[a]);const u=(0,we().lW)(a,Te,Object.is);(0,o.useEffect)((()=>{if(!u.trim())return Z.setServerUrlInputStatus("none"),void Z.setServerUrlErrorMessage(void 0);if(!(0,Se().w)(u))return Z.setServerUrlInputStatus("invalid"),void Z.setServerUrlErrorMessage(i.formatMessage(je.invalidUrl));const n=(0,R().bk)(u);if(!n)return Z.setServerUrlInputStatus("invalid"),void Z.setServerUrlErrorMessage(i.formatMessage(je.invalidUrl));if("https:"!==n.protocol)return Z.setServerUrlInputStatus("invalid"),void Z.setServerUrlErrorMessage(i.formatMessage(je.httpsRequired));if("mcp.notion.com"===n.hostname)return Z.setServerUrlInputStatus("invalid"),void Z.setServerUrlErrorMessage(i.formatMessage(je.notionMcpNotAllowed));if(!e){const e=(0,f().Yl)(u);if(t.urls.has(e))return Z.setServerUrlInputStatus("invalid"),void Z.setServerUrlErrorMessage(i.formatMessage(je.duplicateUrl))}Z.setServerUrlInputStatus("valid"),Z.setServerUrlErrorMessage(void 0)}),[u,t.urls,e,i]);const m=(0,r().K8)((()=>{switch(Z.state.serverUrlInputStatus){case"valid":return(0,ee.jsx)(ne().I,{icon:be().checkmarkCircleFillIcon,colorPalette:"blue",colorVariant:"accentPrimary"});case"invalid":return(0,ee.jsx)(ne().I,{icon:Ce().xMarkCircleFillIcon,colorPalette:"red",colorVariant:"accentPrimary"});case"loading":return(0,ee.jsx)("div",{style:{width:16,height:16},children:(0,ee.jsx)(K().k,{})})}}),[]);return(0,ee.jsxs)(s().Y1,{direction:"vertical",gap:6,children:[(0,ee.jsx)(c().D,{styleKey:"captionMedium",colorVariant:"secondary",children:i.formatMessage(je.serverUrlInputLabel)}),(0,ee.jsx)(X().A,{placeholder:"https://example.com/mcp",value:a,onChange:e=>Z.setServerUrl(e.target.value),focusInitial:!a&&!n,right:m,disabled:d,readOnly:n}),l?(0,ee.jsx)(c().D,{styleKey:"captionRegular",colorPalette:"red",colorVariant:"accentPrimary",children:l}):void 0]})}n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);const Ie=(0,g().YK)({title:{id:"ConnectMcpServerModal.title",defaultMessage:"Custom MCP Server"},description:{id:"ConnectMcpServerModal.description",defaultMessage:"Connect to an MCP server to create advanced workflows across any of your team’s apps."},connect:{id:"ConnectMcpServerModal.continue",defaultMessage:"Connect"},cancel:{id:"ConnectMcpServerModal.cancel",defaultMessage:"Cancel"},notionAutoAuthMessage:{id:"ConnectMcpServerModal.notionAutoAuthMessage",defaultMessage:"Authentication will be handled automatically using your Notion account."}}),Te=400;function De({isOpen:e,onClose:t,spaceViewStore:n,currentUserPointer:l,existingModuleId:d,workflowId:u,initialName:h,initialUrl:v,onSuccess:w,existingAgentModules:k=[]}){const b=(0,i().v3)(),C=(0,g().tz)(),S=(0,o.useMemo)((()=>(0,m().lZ)()),[]),j=function({existingAgentModules:e}){return(0,o.useMemo)((()=>{const t=new Set,n=new Set;for(const o of e)o.serverUrl&&t.add((0,f().Yl)(o.serverUrl)),o.name&&n.add(o.name.toLowerCase().trim());return{urls:t,names:n}}),[e])}({existingAgentModules:k}),A=(0,o.useRef)(!1);(0,o.useEffect)((()=>{e&&!A.current&&(0,p().K0)({environment:b,workflowId:u,origin:d?"reconnect":"add_connection",flowId:S,hasExistingModule:Boolean(d)}),A.current=e}),[e,b,u,S,d]),function({existingModuleId:e,spaceViewStore:t,initialName:n,initialUrl:i,isOpen:a}){const s=(0,r().K8)((()=>{if(!e)return;const n=M().L3.fromPointerLike({table:x().yM,id:e,spaceId:t.getSpaceId()}),o=y().P.createChildStore(t,n);if(!o.isDefined())return;const i=o.getData();return i?{name:i.name,serverUrl:i.serverUrl,serverIconUrl:i.serverIconUrl}:void 0}),[e,t]);(0,o.useEffect)((()=>{if(!a)return;const e=(null==s?void 0:s.name)??n,t=(null==s?void 0:s.serverUrl)??i,o=null==s?void 0:s.serverIconUrl;e&&!Z.state.name&&Z.setName(e),t&&!Z.state.serverUrl&&Z.setServerUrl(t),e&&t&&Z.setIsPrepopulatedServer(!0),o&&!Z.state.serverIconUrl&&Z.setServerIconUrl(o)}),[s,n,i,a])}({existingModuleId:d,spaceViewStore:n,initialName:h,initialUrl:v,isOpen:e});const[I,T,D]=(0,r().K8)((()=>[Z.state.serverUrlInputStatus,Z.state.isOAuthProcessing,Z.state.serverUrl]),[]),P=(0,o.useCallback)((()=>{Z.reset(),t()}),[t]),[R,L]=(0,r().K8)((()=>[Z.canConnect(),Z.state.isPrepopulatedServer]),[]),E=(0,o.useCallback)((async()=>{if(!R||!D)return;const e="OAuth"===Z.state.selectedAuthenticationMethod?"oauth":"custom";(0,p().nt)({server_url:D,auth_method:e,workflow_id:u,module_id:d,flow_id:S,environment:b});const t=await O({store:Z,spaceViewStore:n,existingModuleId:d,workflowId:u,environment:b,intl:C,currentUserPointer:l,flowId:S});t&&(null==w||w(t),P())}),[R,D,n,b,d,u,C,l,P,w,S]),W=(0,o.useCallback)((e=>{e.preventDefault(),E()}),[E]),N=(0,o.useCallback)((()=>{E()}),[E]);return(0,o.useEffect)((()=>{e&&"valid"===I&&D&&F({store:Z,environment:b,intl:C,spaceViewStore:n,existingModuleId:d,workflowId:u})}),[b,C,d,u,n,D,I,e]),(0,ee.jsx)(a().s,{isOpen:e,onDismiss:P,areaConstraint:{width:{type:"fixed",length:480},height:{type:"unlimited",scroll:"allow"}},render:()=>(0,ee.jsxs)("form",{onSubmit:W,children:[(0,ee.jsx)("button",{type:"submit",style:{display:"none"},tabIndex:-1}),(0,ee.jsxs)(s().Y1,{padding:12,gap:16,children:[T?(0,ee.jsx)(ke,{}):(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(Pe,{}),(0,ee.jsxs)(s().Y1,{padding:"0 8px",gap:16,children:[(0,ee.jsx)(Ae,{existingModuleId:d,existingAgentMcpData:j,readOnly:Boolean(v)}),"valid"===I?(0,ee.jsxs)(ee.Fragment,{children:[L?void 0:(0,ee.jsx)(Me,{existingModuleId:d,existingAgentMcpData:j}),(0,f().hy)(D)?(0,ee.jsx)(c().D,{styleKey:"captionRegular",colorVariant:"secondary",children:(0,ee.jsx)(g().sA,{...Ie.notionAutoAuthMessage})}):(0,ee.jsx)(pe,{spaceViewStore:n,existingModuleId:d,workflowId:u},D),(0,ee.jsx)(ve,{serverUrl:D})]}):void 0]})]}),(0,ee.jsx)(Re,{connectButtonEnabled:R,handleClose:P,handleSubmit:N})]})]})})}function Pe(){const[e,t,n,o]=(0,r().K8)((()=>[Z.state.isPrepopulatedServer,Z.state.serverIconUrl,Z.state.serverUrl,Z.state.name]),[]);return(0,ee.jsx)("div",{tabIndex:0,style:{outline:"none"},children:(0,ee.jsxs)(s().Y1,{gap:4,padding:"8px 8px 0px",children:[e?(0,ee.jsxs)(s().Y1,{direction:"horizontal",gap:8,align:"center-left",children:[(0,ee.jsx)(w().X,{iconUrl:t,serverUrl:n,serverName:o,size:u().Ev.lg}),(0,ee.jsx)(c().D,{styleKey:"bodyLgSemibold",children:o}),(0,ee.jsx)(v().W,{serverUrl:n}),(0,ee.jsx)(h().O,{})]}):(0,ee.jsxs)(s().Y1,{direction:"horizontal",gap:8,align:"center-left",children:[(0,ee.jsx)(c().D,{styleKey:"bodyLgSemibold",children:(0,ee.jsx)(g().sA,{...Ie.title})}),(0,ee.jsx)(h().O,{})]}),e?void 0:(0,ee.jsx)(c().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,ee.jsx)(g().sA,{...Ie.description})})]})})}function Re({connectButtonEnabled:e,handleClose:t,handleSubmit:n}){const[o,i]=(0,r().K8)((()=>[Z.state.isLoadingConnection,Z.state.isOAuthProcessing]),[]);return(0,ee.jsxs)(s().Y1,{direction:"horizontal",align:"center-right",gap:4,children:[(0,ee.jsx)(l().A,{onClick:t,size:"lg",children:(0,ee.jsx)(g().sA,{...Ie.cancel})}),(0,ee.jsx)(d().A,{onClick:n,colorPalette:"blue",disabled:!e,size:"lg",isLoading:o&&!i,children:(0,ee.jsx)(g().sA,{...Ie.connect})})]})}},566531:(e,t,n)=>{n.d(t,{w:()=>i});n(296540);const o={viewBox:"0 0 16 16",fittedViewBox:"2.12 2.57 11.75 11.7",svg:(0,n(474848).jsx)("path",{d:"M4 2.575c-1.036 0-1.875.84-1.875 1.875v5.5c0 1.036.84 1.875 1.875 1.875h.466v1.822a.625.625 0 0 0 1.019.485l2.84-2.307H12c1.036 0 1.875-.84 1.875-1.875v-5.5c0-1.035-.84-1.875-1.875-1.875zM3.375 4.45c0-.345.28-.625.625-.625h8c.345 0 .625.28.625.625v5.5c0 .345-.28.625-.625.625H8.102a.63.63 0 0 0-.394.14l-1.992 1.619V11.2a.625.625 0 0 0-.625-.625H4a.625.625 0 0 1-.625-.625z"})},i=(0,n(340498).wt)("commentSmall",o,"small")},568721:(e,t,n)=>{n.d(t,{b:()=>v});n(581454);var o=()=>n(203066),i=()=>n(153321),r=n(296540),a=()=>n(401497),s=()=>n(718827),l=()=>n(606712),d=()=>n(249046),c=()=>n(807449),u=()=>n(302501),g=()=>n(222334),f=()=>n(340498),m=()=>n(100622),p=()=>n(284371),h=n(474848);function v(e){const{sections:t,expandAllWhenSectionsChange:n=!1,chevronPosition:o="end",styleOverrides:i,borderedStyle:s=!1,compactMode:d=!1,buttonPadding:c}=e,u=function(e,t,n,o){const i=(0,a().eP)();return(0,a().IS)((()=>{const r=(null==e?void 0:e.sectionBackground)??m().Tj.background.secondary,a=(null==e?void 0:e.sectionButtonBackground)??m().Tj.background.secondary;return{container:{display:"grid",gap:8,...n?{maxWidth:"100%",boxSizing:"border-box",overflow:"hidden"}:{}},sectionWrapper:t?{background:"transparent",borderRadius:8,border:`1px solid ${m().Tj.border.secondary}`,...n?{boxSizing:"border-box",overflow:"hidden"}:{}}:{background:r,borderRadius:8,...n?{boxSizing:"border-box",overflow:"hidden"}:{}},sectionButton:{background:t?"transparent":a,borderRadius:8,padding:o??(n?"6px 10px":"8px 12px"),...n?{width:"100%",boxSizing:"border-box"}:{}},sectionButtonWithDividerExpanded:{background:t?"transparent":a,borderBottom:`1px solid ${t?m().Tj.border.secondary:m().Tj.border.primary}`,padding:n?"6px 10px":"8px 12px",borderStartStartRadius:8,borderStartEndRadius:8,borderEndStartRadius:0,borderEndEndRadius:0,...n?{width:"100%",boxSizing:"border-box"}:{}},sectionButtonWithDividerCollapsed:{background:t?"transparent":a,borderBottom:t?void 0:`1px solid ${m().Tj.border.primary}`,padding:o??(n?"6px 10px":"8px 12px"),borderRadius:8,...n?{width:"100%",boxSizing:"border-box"}:{}},sectionButtonHovered:{background:m().Tj.background.secondaryTranslucent},sectionButtonPressed:{background:(0,l().y)({color:m().Tj.background.secondaryTranslucent,mode:i,adjustmentFactor:1})},sectionButtonLabel:{justifyContent:"space-between",display:"flex",alignItems:"center"},sectionTitle:{fontWeight:p().Wy.medium,padding:0},sectionButtonIconArea:{alignItems:"center"},sectionIcon:{flexShrink:0,width:16,height:16,display:"flex",alignItems:"center",justifyContent:"center",marginInlineEnd:8},titleWrapper:n?{flex:1,minWidth:0,overflow:"hidden",display:"flex",alignItems:"center"}:{display:"flex",alignItems:"center"},chevronIcon:{width:f().Ev.xs,height:f().Ev.xs,marginInlineStart:12,transition:"transform 200ms ease-out"},sectionContent:{padding:n?10:12,...n?{maxWidth:"100%",boxSizing:"border-box",overflow:"hidden"}:{}}}}),[null==e?void 0:e.sectionBackground,null==e?void 0:e.sectionButtonBackground,n,t,o,i])}(i,s,d,c),[g,v]=(0,r.useState)((()=>{const e={};for(const n of t)!n.hidden&&n.initialExpanded&&(e[n.key]=!0);return e})),y=(0,r.useCallback)((e=>{v((t=>({...t,[e]:!t[e]})))}),[]);return(0,r.useEffect)((()=>{if(n){const e={};for(const n of t)n.hidden||(e[n.key]=!0);v(e)}}),[t,n]),(0,h.jsx)("div",{style:u.container,children:t.map((e=>{if(e.hidden)return null;const t=Boolean(g[e.key]),n=!1!==e.collapsible;return(0,h.jsx)(w,{section:e,isExpanded:t,isCollapsible:n,chevronPosition:o,onToggle:y,styles:u,borderedStyle:s},e.key)}))})}function w(e){const{section:t,isExpanded:n,isCollapsible:o,chevronPosition:i,onToggle:r,styles:a,borderedStyle:l}=e,d=t.headerDivider?n?a.sectionButtonWithDividerExpanded:a.sectionButtonWithDividerCollapsed:a.sectionButton,c=(0,h.jsx)(y,{section:t,isExpanded:n,isCollapsible:o,chevronPosition:i,styles:a});return(0,h.jsxs)("div",{style:a.sectionWrapper,children:[(0,h.jsx)("div",{children:o?(0,h.jsx)(s().Ay,{onClick:()=>r(t.key),style:d,hoveredStyle:a.sectionButtonHovered,children:c}):(0,h.jsx)("div",{style:d,children:c})}),t.content?(0,h.jsx)(M,{content:t.content,isExpanded:n,contentStyle:t.sectionContentStyleOverride??a.sectionContent,borderedStyle:l}):void 0]})}function y(e){const{section:t,isExpanded:n,isCollapsible:o,chevronPosition:i,styles:r}=e,a=o?(0,h.jsx)(c().I,{icon:g().arrowChevronSingleRightIcon,style:{...r.chevronIcon,transform:`rotateZ(${n?90:0}deg)`}}):void 0,s=t.disableUILabelWrap?t.title:(0,h.jsx)(u().A,{style:r.sectionTitle,children:t.title}),l=t.secondaryLabel?t.disableUILabelWrap?t.secondaryLabel:(0,h.jsx)(u().A,{isSecondaryColor:!0,children:t.secondaryLabel}):void 0;return"start"===i&&o?(0,h.jsxs)(d().Ye,{style:r.sectionButtonLabel,children:[(0,h.jsxs)(d().Ye,{style:r.titleWrapper,children:[(0,h.jsx)(c().I,{icon:g().arrowChevronSingleRightIcon,style:{...r.chevronIcon,marginInlineStart:0,marginInlineEnd:8,transform:`rotateZ(${n?90:0}deg)`}}),t.icon?(0,h.jsx)("div",{style:r.sectionIcon,children:t.icon}):void 0,s]}),(0,h.jsx)(d().Ye,{style:r.sectionButtonIconArea,children:l})]}):(0,h.jsxs)(d().Ye,{style:r.sectionButtonLabel,children:[(0,h.jsxs)(d().Ye,{style:r.titleWrapper,children:[t.icon?(0,h.jsx)("div",{style:r.sectionIcon,children:t.icon}):void 0,s]}),(0,h.jsxs)(d().Ye,{style:r.sectionButtonIconArea,children:[l,a]})]})}function M({content:e,isExpanded:t,contentStyle:n,borderedStyle:r}){return(0,h.jsx)(o().N,{initial:!1,children:t?(0,h.jsx)(i().P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.25,ease:"easeInOut"},style:{overflow:"hidden",background:r?void 0:m().Tj.background.primary},children:(0,h.jsx)("div",{style:n,children:e})}):void 0})}},621859:(e,t,n)=>{n.d(t,{m:()=>b});var o=n(296540),i=()=>n(484714),r=()=>n(590526),a=()=>n(401497),s=()=>n(250910),l=()=>n(118307),d=()=>n(631524),c=()=>n(493552),u=()=>n(373009),g=()=>n(966249),f=()=>n(69708),m=()=>n(284371),p=()=>n(687879),h=()=>n(94522),v=()=>n(976710),w=()=>n(942580),y=()=>n(3431),M=()=>n(524490),x=n(474848);const k=(0,f().YK)({connect:{defaultMessage:"Connect",id:"WorkflowModuleConnectButton.connect"},connectSpecific:{defaultMessage:"Connect {moduleName}",id:"WorkflowModuleConnectButton.connectSpecific"}});function b(e){const{module:t,workflowStore:n,buttonVariant:a="primary",size:d,forceReconnect:c}=e,u=(0,r().uB)(void 0,l().A),f=(0,i().v3)(),m=(0,i().WS)(),k=n.pointer,b=(0,r().K8)((()=>(0,h().Cq)({workflowPointer:k})),[k]),[S,j]=(0,v().j)({moduleValue:t,workflowDefinitionPointer:b,workflowModuleStore:void 0}),{handleConnect:A,authModal:I}=(0,y().K)({moduleValue:t,workflowDefinitionPointer:b,workflowModuleStore:void 0}),T=(0,o.useCallback)((e=>{p().saveModule({environment:f,workflowStore:n,module:e})}),[f,n]),D=(0,o.useCallback)((e=>{var n;const o=g().Nh[t.type],i=(null==o||null===(n=o.getDefaultPermissions)||void 0===n?void 0:n.call(o))??[],r={...t.state,connectionPointer:null==e?void 0:e.pointer};"error"in r&&(r.error=void 0),T({...t,state:r,permissions:[...i]})}),[t,T]),{scopedExternalConnectionStore:P,externalConnection:R}=(0,w().q)({moduleValue:t}),{authModal:L,connectionsMenu:E}=(0,M().w)({asyncConnections:S,moduleValue:t,onConnectClick:()=>u.reset(),onMenuItemClick:D,selectedScopedExternalConnectionStore:P,selectedExternalConnection:R,workflowDefinitionPointer:b,workflowModuleStore:void 0}),W=(0,o.useMemo)((()=>"resolved"===S.status&&S.value.sections.length>0),[S]);return(0,x.jsxs)(x.Fragment,{children:[W&&!c?(0,x.jsx)(s().A,{popupType:m?s().z.BottomSheet:s().z.Popup,alignmentToOrigin:"end",originGap:4,renderOrigin:e=>(0,x.jsx)(C,{events:e,buttonVariant:a,moduleName:t.type,size:d}),render:()=>E,buttonPopupStore:u}):(0,x.jsx)(C,{buttonVariant:a,handleOnClick:A,moduleName:t.type,size:d}),I,L]})}function C(e){const{buttonVariant:t,handleOnClick:n=(()=>{}),events:o={},moduleName:i,size:r}=e,s=(0,a().IS)((()=>({tintButton:{textTransform:"capitalize"},plainButton:{fontSize:12,fontWeight:m().Wy.medium}})),[]);return"tint"===t?(0,x.jsx)(u().E,{style:s.tintButton,onClick:n,colorPalette:"blue",size:r,...o,children:(0,x.jsx)(c().D,{textOverflow:"ellipsis",children:(0,x.jsx)(f().sA,{...k.connectSpecific,values:{moduleName:i}})})}):(0,x.jsx)(d().p,{size:r??"sm",colorPalette:"blue",onClick:n,style:s.plainButton,...o,children:(0,x.jsx)(f().sA,{...k.connect})})}},638666:(e,t,n)=>{n.d(t,{N:()=>he,B:()=>ce});n(16280),n(944114),n(898992),n(354520),n(672577),n(581454),n(737550);var o=n(296540),i=()=>n(242422),r=()=>n(484714),a=()=>n(590526),s=()=>n(401497),l=()=>n(792057),d=()=>n(394888),c=()=>n(350013),u=()=>n(699143),g=()=>n(577914),f=()=>n(250910),m=()=>n(807449),p=()=>n(546926),h=()=>n(631524),v=()=>n(160432),w=()=>n(493552),y=()=>n(890492),M=()=>n(81068),x=()=>n(663639),k=()=>n(736847),b=()=>n(452004),C=()=>n(324254),S=()=>n(481975),j=()=>n(477336),A=()=>n(340498),I=()=>n(68263),T=()=>n(743246),D=()=>n(760342),P=()=>n(958467),R=()=>n(563452),L=()=>n(905470),E=()=>n(966249),W=()=>n(724639),N=()=>n(142918),U=()=>n(69708),B=()=>n(100622),V=()=>n(496603),_=()=>n(498212),F=()=>n(534177),O=()=>n(656134),z=()=>n(49210),K=()=>n(547149),Y=()=>n(451557),H=()=>n(687879),q=()=>n(22673),$=()=>n(94522),G=()=>n(343489);var Q=()=>n(912749),J=()=>n(759113),Z=()=>n(746400),X=()=>n(266563),ee=()=>n(266685),te=()=>n(476195),ne=()=>n(384944),oe=()=>n(622936),ie=n(474848);function re(e){const{workflowStore:t,triggerStore:n,trigger:i,scripts:a,scriptsEnabled:l,workflowIcon:d,disabled:c=!1}=e,u=t.table===T().C0&&!c,g=(0,r().v3)(),v=(0,s().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:10,paddingInline:10,paddingBlockStart:12},optionRow:{display:"flex",alignItems:"center",gap:10},labelWrapper:{display:"flex",alignItems:"center",gap:8,cursor:u?"pointer":"default"},scriptSelectButton:{paddingInline:10,paddingBlock:6,borderRadius:8,border:`1px solid ${B().Tj.border.secondary}`,gap:6,minWidth:140,justifyContent:"space-between"},scriptSelectDisabled:{borderColor:B().Tj.border.secondary,color:B().Tj.text.secondary,opacity:.6},header:{color:B().Tj.text.secondary}})),[u]),b=null!=i&&i.scriptId?"script":"agent",S=(0,o.useMemo)((()=>a.find((e=>e.id===(null==i?void 0:i.scriptId)))),[a,null==i?void 0:i.scriptId]),j=(0,o.useMemo)((()=>{const e=a.findIndex((e=>e.id===(null==i?void 0:i.scriptId)));return e>=0?e:void 0}),[a,null==i?void 0:i.scriptId]),A=(0,o.useCallback)((e=>{n&&i&&K().createAndCommit({userAction:"TriggerConfigModal.updateScriptId",environment:g,canUndo:!0,perform:t=>{ne().zv({store:n,data:{scriptId:e},transaction:t})}})}),[g,i,n]),I=(0,o.useCallback)((()=>{u&&A(void 0)}),[A,u]),D=(0,o.useMemo)((()=>`trigger-action-${(null==i?void 0:i.id)??"new"}-agent`),[null==i?void 0:i.id]),P=(0,o.useMemo)((()=>`trigger-action-${(null==i?void 0:i.id)??"new"}-script`),[null==i?void 0:i.id]),R=(0,o.useCallback)((()=>{if(!u||0===a.length)return;const e=S??a[0];A(null==e?void 0:e.id)}),[A,u,a,S]);return l?(0,ie.jsxs)("div",{style:v.container,children:[(0,ie.jsx)(w().D,{styleKey:"captionRegular",style:v.header,children:(0,ie.jsx)(U().sA,{id:"workflow.agent.triggers.doHeader",defaultMessage:"Do"})}),(0,ie.jsxs)("div",{style:v.optionRow,children:[(0,ie.jsx)(ee().a,{checked:"agent"===b,onChange:I,disabled:!u,name:`trigger-action-${(null==i?void 0:i.id)??"new"}`,value:"agent",selectorSize:"small",id:D}),(0,ie.jsxs)("label",{htmlFor:D,style:v.labelWrapper,children:[(0,ie.jsx)(oe().AgentIcon,{agentIcon:d,workflowStore:t,size:20}),(0,ie.jsx)(w().D,{styleKey:"bodyMedium",children:(0,ie.jsx)(U().sA,{id:"workflow.agent.triggers.do.runAgent",defaultMessage:"Run agent"})})]})]}),(0,ie.jsxs)("div",{style:v.optionRow,children:[(0,ie.jsx)(ee().a,{checked:"script"===b,onChange:R,disabled:!u||0===a.length,name:`trigger-action-${(null==i?void 0:i.id)??"new"}`,value:"script",selectorSize:"small",id:P}),(0,ie.jsxs)("label",{htmlFor:P,style:v.labelWrapper,children:[(0,ie.jsx)(m().I,{icon:te().codeSmallIcon,size:"sm"}),(0,ie.jsx)(w().D,{styleKey:"bodyMedium",children:(0,ie.jsx)(U().sA,{id:"workflow.agent.triggers.do.runScript",defaultMessage:"Run script"})})]}),(0,ie.jsx)(f().A,{disabled:!u||0===a.length,popupType:f().z.Popup,alignmentToOrigin:"start",placementToOrigin:"bottom",originGap:4,renderOrigin:e=>(0,ie.jsxs)(h().p,{...e,style:{...v.scriptSelectButton,...0!==a.length&&u?void 0:v.scriptSelectDisabled},children:[(0,ie.jsx)("span",{children:S?S.name:(0,ie.jsx)(U().sA,{id:"workflow.agent.triggers.do.selectScript",defaultMessage:"Select script"})}),(0,ie.jsx)(m().I,{icon:C().arrowChevronSingleDownSmallIcon,size:"sm"})]}),render:({close:e})=>{const t=0===a.length?[{key:"no-scripts",render:e=>(0,ie.jsx)(k().A,{...e}),items:[{key:"no-scripts-item",render:e=>(0,ie.jsx)(M().A,{...e,title:(0,ie.jsx)(U().sA,{id:"workflow.agent.triggers.do.noScripts",defaultMessage:"No scripts available"}),disabled:!0,ignoreLocalHoverState:!0}),action:()=>e()}]}]:[{key:"scripts",render:e=>(0,ie.jsx)(k().A,{...e}),items:a.map((t=>({key:t.id,render:(e,n)=>(0,ie.jsx)(M().A,{...e,onFocus:n.onFocus,title:t.name,isChecked:t.id===(null==S?void 0:S.id)}),action:()=>{A(t.id),e()}})))}];return(0,ie.jsx)(y().A,{menuType:p().gu.Popup,minWidth:220,children:(0,ie.jsx)(x().A,{type:x().O.Vertical,initialFocus:j,sections:t})})}})]})]}):null}function ae(e){const{moduleType:t,triggerType:n,intl:o}=e,i=(0,J().getTriggerDefinitionByType)({moduleType:t,triggerType:n});return null!=i&&i.description?o.formatMessage(i.description):o.formatMessage({id:"workflow.agent.trigger.defaultName",defaultMessage:"New trigger"})}var se=()=>n(475714);const le=(0,U().YK)({recurringSection:{id:"TriggerConfigModal.AddTriggerButton.recurringSection",defaultMessage:"Recurring"},recurringMenuLabel:{id:"TriggerConfigModal.AddTriggerButton.recurringMenuLabel",defaultMessage:"Every..."},recurringEvery:{id:"TriggerConfigModal.AddTriggerButton.recurringEvery",defaultMessage:"Recurring every"},appTriggersSection:{id:"TriggerConfigModal.AddTriggerButton.appTriggersSection",defaultMessage:"App triggers"},day:{id:"TriggerConfigModal.AddTriggerButton.day",defaultMessage:"Day"},hour:{id:"TriggerConfigModal.AddTriggerButton.hour",defaultMessage:"Hour"},week:{id:"TriggerConfigModal.AddTriggerButton.week",defaultMessage:"Week"},month:{id:"TriggerConfigModal.AddTriggerButton.month",defaultMessage:"Month"},year:{id:"TriggerConfigModal.AddTriggerButton.year",defaultMessage:"Year"},exitConfirmMessage:{id:"workflow.trigger.navigation.confirmation.message",defaultMessage:"Exit before trigger complete?"},exitConfirmOk:{id:"workflow.trigger.navigation.confirmation.ok",defaultMessage:"OK"},exitConfirmCancel:{id:"workflow.trigger.navigation.confirmation.cancel",defaultMessage:"Cancel"}}),de={day:le.day,hour:le.hour,week:le.week,month:le.month,year:le.year};async function ce(e){const{workflowOrArtifactStore:t,triggerId:n,appearance:o}=e;return await z().T.showAsyncModal((e=>{const{isOpen:i,onDismiss:r,onClosed:a}=e;return(0,ie.jsx)(ue,{isOpen:i,onDismiss:r,onClosed:a,workflowOrArtifactStore:t,triggerId:n,appearance:o})}))}function ue(e){const{workflowOrArtifactStore:t,onDismiss:n,onClosed:i,triggerId:s,appearance:c,isOpen:f}=e,m=(0,U().tz)(),p=(0,r().v3)(),{workflowValue:h,threadStore:v}=(0,Q().N)(t,!0),w=he(t),y=(0,a().K8)((()=>{const e=t.pointer;if(e||null!=v&&v.pointer)return(0,$().Cq)({workflowPointer:e,threadPointer:null==v?void 0:v.pointer})}),[t.pointer,v]),{persistedOrDraftTriggerStore:M,persistedTriggerStore:x}=(0,se().A)({workflowOrArtifactStore:t,triggerIdFromParent:s}),k=(0,a().K8)((()=>null==M?void 0:M.getValue()),[M]),b=(0,o.useRef)(void 0);void 0===b.current&&(b.current=k);const[C,S]=(0,o.useState)(!1),j=(0,o.useCallback)((()=>{const e=b.current,o=null==M?void 0:M.getValue();if(o&&!(0,V().n4)(e,o)){var i;const e=null===(i=o.state)||void 0===i?void 0:i.type,n=!!e&&(0,P().e1)(e);(0,q().Cx)({environment:p,workflowId:t.id,triggerId:o.id,type:e,mailFilterTypes:n?(0,P().Rv)(o):void 0,emailAccountId:n?(0,P().AS)(o):void 0,isDatabaseAgent:(0,L().uP)(h)})}n()}),[p,M,n,t.id,h]),A=(0,J().useTriggerWithDefinition)({workflowValue:h,trigger:k}),{triggerDefinition:T,specificTrigger:D,specificModuleValue:B}=A,F=(0,o.useCallback)((e=>{if(!w)return;const{triggerType:t,moduleValue:n,moduleType:o,initialState:i}=e,r=(0,E().jK)(o);if(!r)return;const a=r.triggers[t];if(!a)return;const{performResult:s}=K().createAndCommit({userAction:"WorkflowActions.saveTrigger",environment:p,canUndo:!0,perform:e=>{let s=n;if(!n){const t=(0,E().r4)({type:o,definition:r,intl:m});K().applyOperation({store:w,operation:(0,N().xb)({pointer:w.pointer,module:t}),transaction:e}),s=t}if(!s)throw new Error("No module created");const l=function(e){var t,n;const{currentTrigger:o,newModuleType:i,newTriggerType:r,workflowData:a,intl:s}=e;if(null==o||!o.name||null===(t=o.state)||void 0===t||!t.type)return ae({moduleType:i,triggerType:r,intl:s});const l=null==a||null===(n=a.modules)||void 0===n?void 0:n.find((e=>e.id===o.moduleId&&void 0!==o.moduleId));if(!l)return o.name;const d=ae({moduleType:l.type,triggerType:o.state.type,intl:s});return o.name===d?ae({moduleType:i,triggerType:r,intl:s}):o.name}({currentTrigger:k,newModuleType:o,newTriggerType:t,workflowData:h,intl:m}),d=(null==k?void 0:k.id)??(0,_().Ay)(),c={id:d,state:i??a.createDefaultState(),enabled:(null==k?void 0:k.enabled)??!0,name:l,moduleId:s.id};return K().applyOperation({store:w,operation:(0,N().NW)({pointer:w.pointer,trigger:c}),transaction:e}),d}});(0,q().aA)({environment:p,triggerId:s,type:t,workflowId:w.id,isDatabaseAgent:(0,L().uP)(h)})}),[w,k,p,m,h]),O=(0,o.useCallback)((e=>{var t;if(!w)return;const n=null===(t=e.state)||void 0===t?void 0:t.type,o=!!n&&(0,P().e1)(n);(0,q().BJ)({environment:p,workflowId:w.id,triggerId:e.id,type:n,mailFilterTypes:o?(0,P().Rv)(e):void 0,emailAccountId:o?(0,P().AS)(e):void 0,isDatabaseAgent:(0,L().uP)(h)}),(0,H().saveTrigger)({workflowStore:w,trigger:e,environment:p,threadStore:v})}),[w,p,v,h]),z=(0,o.useRef)(O),Y=(0,o.useRef)(k);Y.current=k,z.current=O,(0,o.useEffect)((()=>()=>{var e;if(!w)return;const t=Y.current;if(!t)return;if(!((null===(e=w.getDraftData())||void 0===e||null===(e=e.triggers)||void 0===e?void 0:e.some((e=>e.id===t.id)))??!1))return;const n=function(e){var t;if("mail.email.received"!==(null===(t=e.state)||void 0===t?void 0:t.type))return e;const n=e.state.filters;if(!n)return e;const o=n.filter((e=>!function(e){var t,n;if("is_empty"===(n=e.operator)||"is_not_empty"===n)return!1;const o=null===(t=e.value)||void 0===t?void 0:t.value;return void 0===o||0===o.trim().length}(e)));if(o.length===n.length)return e;const i=o.length>0?{...e.state,filters:o}:{...e.state,filters:void 0};return{...e,state:i}}(t);n!==t&&z.current(n)}),[w]);const Z=(0,o.useCallback)((async()=>{if(!w||!x)return;const e=x.getValue();if(e){(await l().Gh({message:m.formatMessage({id:"TriggerConfigModal.deleteTrigger.confirmationMessage",defaultMessage:"Delete this trigger?"}),acceptLabel:m.formatMessage({id:"TriggerConfigModal.deleteTrigger.confirmButtonLabel",defaultMessage:"Delete"})})).accept&&((0,H().deleteTrigger)({workflowStore:w,trigger:e,environment:p}),n())}}),[w,x,p,n,m]),X=(0,a().K8)((()=>!!k&&(0,W().VB)(k)),[k]),ee=function({module:e,store:t}){const n=(0,a().K8)((()=>t.canEdit()),[t]),o=e??{id:"no-module",type:"notion",name:"notion",version:"1.0.0"},i=(0,G().i)({module:o,store:t});return e?i:n?"read_and_write":"reader"}({module:B?(0,R().yC)(B):void 0,store:t}),te=(0,I().p2)(ee),ne=(0,o.useCallback)((()=>{S(!1)}),[]),oe=(0,o.useCallback)((()=>{S(!1),n()}),[n]),re=(0,o.useCallback)((()=>{l().ui({message:m.formatMessage(le.exitConfirmMessage),showCancel:!1,keepFocus:!0,onDismiss:ne,items:[{label:m.formatMessage(le.exitConfirmOk),color:void 0,buttonType:"solid",onAccept:oe},{label:m.formatMessage(le.exitConfirmCancel),color:void 0,buttonType:"outline",onAccept:ne}]})}),[ne,oe,m]),de=(0,o.useCallback)((()=>{w?k&&(0,W().VB)(k)?j():C||(S(!0),re()):j()}),[w,k,C,re,j]);return(0,ie.jsx)(d().s,{ariaLabel:m.formatMessage({id:"workflow.agent.triggers.modal.ariaLabel",defaultMessage:"Trigger configuration"}),isOpen:f,onDismiss:de,onClosed:i,areaConstraint:{width:{type:"fixed",length:440},height:{type:"min",length:440}},render:({sizeRange:e})=>(0,ie.jsxs)(u().Y1,{width:"fill",height:"fill",padding:20,gap:24,style:e,children:[(0,ie.jsx)(ge,{appearance:c,persistedTriggerStore:x,persistedOrDraftTriggerStore:M,unknownTrigger:k,workflowData:h,workflowId:t.id}),(0,ie.jsx)(fe,{triggerDefinition:T,workflowData:h,workflowDefinitionPointer:y,editableWorkflowStore:w,specificTrigger:D,workflowOrArtifactStore:t,handleAddTrigger:F,handleSaveTrigger:O,persistedOrDraftTriggerStore:M,canEditTrigger:te}),(0,ie.jsx)(me,{showDelete:void 0!==x,onDelete:Z,onDismiss:de,doneDisabled:void 0===x||!X}),(0,ie.jsx)(g().R,{})]}),startClosingOnDismiss:!1})}function ge(e){const{appearance:t,persistedTriggerStore:n,persistedOrDraftTriggerStore:o,unknownTrigger:i,workflowData:r,workflowId:a}=e,l=(0,s().IS)((()=>({verticalDivider:{alignSelf:"center",width:1,height:14,background:B().Tj.border.primary}})),[]);return(0,ie.jsxs)(u().Y1,{direction:"vertical",gap:10,children:[(0,ie.jsx)(w().D,{styleKey:"titleSemibold",children:"editTrigger"===t?(0,ie.jsx)(U().sA,{id:"TriggerConfigModal.editTriggerTitle",defaultMessage:"Edit trigger"}):(0,ie.jsx)(U().sA,{id:"TriggerConfigModal.newTriggerTitle",defaultMessage:"New trigger"})}),n?(0,ie.jsxs)(u().Y1,{direction:"horizontal",gap:12,align:"center-left",children:[(0,ie.jsx)(Z().b,{triggerStore:o,trigger:i,disabled:!1,workflowId:a,isDatabaseAgent:(0,L().uP)(r)}),(0,ie.jsx)("div",{style:l.verticalDivider}),(0,ie.jsx)(w().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:(null==i?void 0:i.enabled)??1?(0,ie.jsx)(U().sA,{id:"TriggerConfigModal.activeFor",defaultMessage:"Active for {agentName, select, undefined {this agent} other {{agentName}}}",values:{agentName:null==r?void 0:r.name}}):(0,ie.jsx)(U().sA,{id:"TriggerConfigModal.disabledFor",defaultMessage:"Disabled for {agentName, select, undefined {this agent} other {{agentName}}}",values:{agentName:null==r?void 0:r.name}})})]}):void 0]})}function fe(e){const{triggerDefinition:t,workflowData:n,workflowDefinitionPointer:i,editableWorkflowStore:r,specificTrigger:s,workflowOrArtifactStore:l,handleAddTrigger:d,handleSaveTrigger:g,persistedOrDraftTriggerStore:f,canEditTrigger:m}=e,p=(0,a().K8)((()=>{if(l instanceof c().N){const e=l.getPublishedArtifactStore();return null==e?void 0:e.getData()}}),[l]),h=(0,o.useMemo)((()=>(0,D().Z0)({workflowData:n,publishedWorkflowData:p})),[n,p]),v=(0,D().yD)(h);return(0,ie.jsxs)(u().Y1,{height:"fill",direction:"vertical",gap:0,style:{overflowY:"scroll"},children:[(0,ie.jsx)(pe,{}),t&&n&&i&&s?(0,ie.jsxs)(u().Y1,{direction:"vertical",gap:6,children:[(0,ie.jsx)(u().Y1,{direction:"horizontal",align:"center-left",padding:4,children:r&&m?(0,ie.jsx)(we,{workflowStore:r,triggerDefinition:t,currentTrigger:s,onAddTrigger:d}):(0,ie.jsx)(w().D,{styleKey:"bodyMedium",children:(0,ie.jsx)(U().sA,{...t.description})})}),(0,ie.jsx)(J().WorkflowTriggerConfiguration,{workflowStore:l,workflowValue:n,workflowDefinitionPointer:i,trigger:s,saveTrigger:g,isInTranscript:!1,disabled:!m}),(0,ie.jsx)(re,{workflowStore:l,triggerStore:f,trigger:s,scripts:n.scripts??[],scriptsEnabled:v,workflowIcon:n.icon,disabled:!r||!m})]}):r?(0,ie.jsx)(X().s,{workflowStore:r,onAddTrigger:d}):void 0]})}function me(e){const{showDelete:t,onDelete:n,onDismiss:o,doneDisabled:i}=e;return(0,ie.jsxs)(u().Y1,{direction:"horizontal",gap:"auto",align:"start",children:[(0,ie.jsx)(u().Y1,{direction:"horizontal",gap:4,align:"center-left",children:t?(0,ie.jsx)(h().p,{colorPalette:"red",onClick:n,children:(0,ie.jsx)(U().sA,{id:"TriggerConfigModal.delete",defaultMessage:"Delete"})}):void 0}),(0,ie.jsx)(u().Y1,{direction:"horizontal",gap:4,align:"center-right",children:(0,ie.jsx)(v().A,{colorPalette:"blue",onClick:o,disabled:i,children:(0,ie.jsx)(U().sA,{id:"TriggerConfigModal.done",defaultMessage:"Done"})})})]})}function pe(){return(0,ie.jsx)(u().Y1,{width:"fill",height:28,padding:"0 6px",align:"center-left",children:(0,ie.jsx)(w().D,{styleKey:"captionMedium",colorVariant:"secondary",children:(0,ie.jsx)(U().sA,{defaultMessage:"When",id:"workflow.agent.AddTriggerModal.when"})})})}function he(e){return e.table===T().C0?e:void 0}function ve(e){const{title:t}=e;return(0,ie.jsxs)(u().Y1,{direction:"horizontal",gap:2,align:"center-left",children:[(0,ie.jsx)(m().I,{icon:S().s,size:"xs",colorVariant:"secondary"}),(0,ie.jsx)(w().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:t})]})}function we(e){const{workflowStore:t,triggerDefinition:n,currentTrigger:l,onAddTrigger:d}=e,c=(0,r().v3)(),g=(0,O().j)(),v=(0,U().tz)(),{workflowValue:S}=(0,Q().N)(t,!0),I=(0,X().R)({workflowStore:t,workflowValue:S}),T=(0,o.useMemo)((()=>{var e;return null==S||null===(e=S.modules)||void 0===e?void 0:e.find((e=>"notion"===e.type))}),[S]),D=(0,o.useMemo)((()=>{if(!l)return;const e=(0,J().findModuleForTrigger)(S,l);return null==e?void 0:e.type}),[l,S]),P=(0,o.useMemo)((()=>{return"recurrence"===(null==(e=l)||null===(t=e.state)||void 0===t?void 0:t.type);var e,t}),[l]),R=(0,a().K8)((()=>i().default.getConfig({configName:"custom_agent_sub_features"}).hourly_recurrence_triggers??!1),[]),[W,N]=(0,o.useState)(D||P?"triggers":"modules"),[B,V]=(0,o.useState)(P?"recurrence":D),_=(0,o.useRef)(null),z=(0,o.useRef)(!1),K=(0,o.useCallback)((e=>{T&&(z.current=!0,d({triggerType:"recurrence",moduleType:"notion",moduleValue:T,initialState:e}))}),[T,d]),H=(0,o.useMemo)((()=>{if("triggers"===W&&B){const n=[];if("recurrence"===B){var e;const t=R||"recurrence"===(null==l||null===(e=l.state)||void 0===e?void 0:e.type)&&"frequency"in l.state&&"hour"===l.state.frequency;n.push({key:"triggers",render:e=>(0,ie.jsx)(k().A,{...e,topBorder:!1}),items:[{key:"back",render:(e,t)=>(0,ie.jsx)(M().A,{...e,onFocus:t.onFocus,title:(0,ie.jsx)(ve,{title:v.formatMessage(le.recurringEvery)})}),action:()=>{N("modules")}},...L().eC.filter((e=>"hour"!==e.key||t)).map((e=>{var t;const n="recurrence"===(null==l||null===(t=l.state)||void 0===t?void 0:t.type)&&"frequency"in l.state&&l.state.frequency===e.trigger.frequency;return{key:e.key,render:(t,o)=>(0,ie.jsx)(M().A,{...t,onFocus:o.onFocus,title:v.formatMessage(de[e.key]),isChecked:n}),action:()=>{var t;K(e.trigger),null===(t=_.current)||void 0===t||t.call(_)}}}))]})}else{var t;const e="notion"===B?"Notion":(null===(t=(0,E().jK)(B))||void 0===t?void 0:t.getName(v))??B,o=I.get(e)??[];n.push({key:"triggers",render:e=>(0,ie.jsx)(k().A,{...e,topBorder:!1}),items:[{key:"back",render:(t,n)=>(0,ie.jsx)(M().A,{...t,onFocus:n.onFocus,title:(0,ie.jsx)(ve,{title:e})}),action:()=>{N("modules")}},...o.map((e=>{var t;const n=(null==l||null===(t=l.state)||void 0===t?void 0:t.type)===e.type&&D===e.moduleType;return{key:`${e.moduleType}-${e.type}`,render:(t,o)=>(0,ie.jsx)(M().A,{...t,onFocus:o.onFocus,title:e.name,isChecked:n}),action:()=>{const t=()=>{var t,n;const o=null==S||null===(t=S.modules)||void 0===t?void 0:t.find((t=>t.type===e.moduleType));z.current=!0,d({triggerType:e.type,moduleType:e.moduleType,moduleValue:o}),null===(n=_.current)||void 0===n||n.call(_)};"mail"===e.moduleType?(0,Y().ensureNotionMailAccountOrTriggerOnboarding)({environment:c,onConfirm:t}).then((e=>{var n;e?t():null===(n=_.current)||void 0===n||n.call(_)})):t()}}}))]})}return n}{const e=[];return e.push({key:"recurring",render:e=>(0,ie.jsx)(k().A,{...e,title:v.formatMessage(le.recurringSection),topBorder:!1}),items:[{key:"recurring",render:(e,t)=>(0,ie.jsx)(M().A,{...e,onFocus:t.onFocus,title:v.formatMessage(le.recurringMenuLabel),icon:(0,ie.jsx)(m().I,{icon:j().l,size:"sm"})}),action:()=>{V("recurrence"),N("triggers")}}]}),e.push({key:"integrations",render:e=>(0,ie.jsx)(k().A,{...e,title:v.formatMessage(le.appTriggersSection)}),items:Array.from(I.entries()).map((([e,t])=>{const n=t[0];if(n)return{key:e,render:(t,i)=>(0,ie.jsx)(M().A,{...t,onFocus:i.onFocus,title:e,icon:o.createElement(n.icon,{width:A().Ev.sm,height:A().Ev.sm})}),action:()=>{"mail"===n.moduleType&&(0,Y().preloadNotionMailUserStatus)({environment:c}),V(n.moduleType),N("triggers")}}})).filter(F().O9)}),e}}),[W,B,v,I,R,l,D,K,null==S?void 0:S.modules,d,c]),q=(0,a().uB)(void 0,b().$),$=(0,o.useMemo)((()=>{if("triggers"===W&&B){let i=1;if("recurrence"===B){var e;const n=R||"recurrence"===(null==l||null===(e=l.state)||void 0===e?void 0:e.type)&&"frequency"in l.state&&"hour"===l.state.frequency;for(const e of L().eC.filter((e=>"hour"!==e.key||n))){var t;if("recurrence"===(null==l||null===(t=l.state)||void 0===t?void 0:t.type)&&"frequency"in l.state&&l.state.frequency===e.trigger.frequency)return i;i++}}else{var n;const e="notion"===B?"Notion":(null===(n=(0,E().jK)(B))||void 0===n?void 0:n.getName(v))??B,t=I.get(e)??[];for(const n of t){var o;if((null==l||null===(o=l.state)||void 0===o?void 0:o.type)===n.type&&D===n.moduleType)return i;i++}}}return 0}),[W,B,l,D,R,I,v]),G=(0,s().IS)((()=>({button:{paddingTop:4,paddingInlineEnd:6,paddingBottom:4,paddingInlineStart:4}})),[]);return n?(0,ie.jsx)(f().A,{alignmentToOrigin:"start",placementToOrigin:"bottom",popupType:g,originGap:4,onClosed:()=>{z.current||(P?(V("recurrence"),N("triggers")):D?(V(D),N("triggers")):(N("modules"),V(void 0))),z.current=!1},render:e=>(_.current=e.close,(0,ie.jsx)(y().A,{menuType:p().gu.Popup,minWidth:220,children:(0,ie.jsx)(x().A,{type:x().O.Vertical,initialFocus:$,sections:H,store:q})})),renderOrigin:e=>(0,ie.jsx)(h().p,{...e,style:G.button,children:(0,ie.jsxs)(u().Y1,{direction:"horizontal",gap:6,align:"center-left",children:[(0,ie.jsx)(u().Y1,{width:20,height:20,align:"center",children:(0,ie.jsx)(m().I,{icon:n.icon,size:"sm"})}),(0,ie.jsxs)(u().Y1,{direction:"horizontal",gap:2,align:"center-left",children:[(0,ie.jsx)(w().D,{styleKey:"bodyMedium",children:(0,ie.jsx)(U().sA,{...n.description})}),(0,ie.jsx)(m().I,{icon:C().arrowChevronSingleDownSmallIcon,size:"xs",colorVariant:"secondary"})]})]})})}):null}},746400:(e,t,n)=>{n.d(t,{b:()=>u});var o=n(296540),i=()=>n(484714),r=()=>n(287188),a=()=>n(958467),s=()=>n(384944),l=()=>n(547149),d=()=>n(22673),c=n(474848);function u(e){const{triggerStore:t,trigger:n,disabled:u,isDatabaseAgent:g}=e,f=(0,i().v3)(),m=(0,o.useCallback)((()=>{var e;if(!t||!n)return;const o=!((null==n?void 0:n.enabled)??!0),i=null===(e=n.state)||void 0===e?void 0:e.type,r=!!i&&(0,a().e1)(i);(o?d().nX:d().SQ)({environment:f,workflowId:t.id,triggerId:n.id,type:i,mailFilterTypes:r?(0,a().Rv)(n):void 0,emailAccountId:r?(0,a().AS)(n):void 0,isDatabaseAgent:g}),l().createAndCommit({userAction:"TriggerSwitchButton.toggle",environment:f,canUndo:!0,perform:e=>{s().zv({store:t,data:{enabled:o},transaction:e})}})}),[f,t,n,g]);return n?(0,c.jsx)(r().A,{disabled:u,on:(null==n?void 0:n.enabled)??!0,onClick:m}):null}},746791:(e,t,n)=>{n.d(t,{N:()=>m});var o=n(296540),i=()=>n(920198),r=()=>n(484714),a=()=>n(590526),s=()=>n(621594),l=()=>n(69708),d=()=>n(615234),c=()=>n(812182),u=()=>n(645200),g=()=>n(488776);const f=(0,l().YK)({connectCalendarSuccessTitle:{id:"workflows.hooks.useNotionCalendarConnection.connectCalendarSuccessTitle",defaultMessage:"Calendar connected"},connectCalendarError:{id:"workflows.hooks.useNotionCalendarConnection.connectCalendarError",defaultMessage:"Something went wrong while connecting Notion Calendar. Please try again."}});function m(e){const{from:t,errorTimeoutMs:n=5*d().Xb,connectionSuccessMessage:m,onConnectionSuccess:p,onTimeout:h}=e,v=(0,l().tz)(),w=(0,r().v3)(),y=(0,i().L)(),[M,x]=(0,o.useState)(!1),k=(0,o.useRef)(void 0),b=(0,a().K8)((()=>(0,g().Y)().getCalendarProviderAccounts()),[]),C=(0,o.useCallback)((()=>{k.current&&(clearTimeout(k.current),k.current=void 0)}),[]);(0,o.useEffect)((()=>{M&&b.length>0&&(x(!1),C(),c().Iz({variant:"default",presentationType:"transient",title:v.formatMessage(f.connectCalendarSuccessTitle),message:m}),null==p||p())}),[v,M,b.length,m,C,p]),(0,o.useEffect)((()=>()=>C()),[C]);const S=(0,o.useCallback)((()=>{x(!0),k.current=setTimeout((()=>{null==h||h(),x(!1),c().Iz({variant:"error",presentationType:"transient",icon:s().exclamationMarkCircleSmallIcon,message:v.formatMessage(f.connectCalendarError)})}),n),(0,u().Op)({environment:w,spaceStore:y,collectionViewStore:void 0,from:t})}),[v,w,y,t,n,h]);return{isWaitingForCalendarConnection:M,calendarAccounts:b,handleConnectCalendar:S,clearCalendarConnectionTimeout:C}}},759113:(e,t,n)=>{n.r(t),n.d(t,{WorkflowTriggerConfiguration:()=>k,findModuleForTrigger:()=>p,getSpecificWorkflowTrigger:()=>x,getSyntheticNotionModuleValue:()=>h,getTriggerDefinitionBySpecificTrigger:()=>M,getTriggerDefinitionByType:()=>w,getTriggerWithDefinition:()=>y,useTriggerWithDefinition:()=>v});n(898992),n(672577);var o=n(296540),i=()=>n(401497),r=()=>n(493552),a=()=>n(758256),s=()=>n(640182),l=()=>n(905470),d=()=>n(69708),c=()=>n(100622),u=()=>n(284371),g=()=>n(423493),f=n(474848);const m=(0,d().YK)({configurationHidden:{id:"WorkflowTriggerConfiguration.configurationHidden",defaultMessage:"Only the user who connected this integration can view or edit trigger settings"}});function p(e,t){var n,o;const i=null==e||null===(n=e.modules)||void 0===n?void 0:n.find((e=>e.id===t.moduleId&&void 0!==t.moduleId));if(i)return i;return Object.keys(l().IN.triggers).includes((null===(o=t.state)||void 0===o?void 0:o.type)??"")?{id:"notion",name:"notion",type:"notion",version:"1.0.0"}:void 0}function h(){return{id:"notion",name:"notion",type:"notion",version:"1.0.0"}}function v(e){const{workflowValue:t,trigger:n}=e;return(0,o.useMemo)((()=>{var e;if(!n)return{specificTrigger:void 0,triggerDefinition:void 0,specificModuleValue:void 0};const o=p(t,n);if(!o||null===(e=n.state)||void 0===e||!e.type)return{specificTrigger:void 0,triggerDefinition:void 0,specificModuleValue:void 0};const i=w({moduleType:o.type,triggerType:n.state.type});return i?{specificTrigger:n,triggerDefinition:i,specificModuleValue:o}:{specificTrigger:void 0,triggerDefinition:void 0,specificModuleValue:void 0}}),[t,n])}function w(e){const{moduleType:t,triggerType:n}=e,o=g().y[t];if(!o)return;const i=o.triggers[n];return i||void 0}function y(e){var t;const{moduleType:n,trigger:o}=e,i=null===(t=o.state)||void 0===t?void 0:t.type;if(!i)return{specificTrigger:void 0,triggerDefinition:void 0};const r=g().y[n].triggers[i];return r?{specificTrigger:o,triggerDefinition:r}:{specificTrigger:void 0,triggerDefinition:void 0}}function M(e){if(!e||!e.state)return;const t=e.state.type;if(t)for(const n of s().zP){const e=g().y[n];if(!e||!e.triggers)continue;const o=e.triggers;for(const[n,i]of Object.entries(o))if(n===t&&i){return i}}}function x(e){const{workflowData:t,triggerId:n}=e;if(null==t||!t.triggers)return;const o=t.triggers.find((e=>e.id===n));return o||void 0}function k(e){const{workflowStore:t,workflowValue:n,trigger:o,isInTranscript:s,workflowDefinitionPointer:l,saveTrigger:g,disabled:p=!1}=e,h=(0,i().IS)((()=>({container:{display:"flex",gap:12,flexDirection:"column",overflow:"hidden"},triggerContainer:{display:"flex",gap:4,width:"100%"},title:s?{color:c().Tj.text.tertiary,fontWeight:u().Wy.medium,fontSize:14}:{fontWeight:500}})),[s]),{specificTrigger:w,triggerDefinition:y}=v({workflowValue:n,trigger:o}),M=(0,d().tz)();if(!(w&&w.state&&y&&l))return null;return(0,f.jsx)("div",{style:h.container,children:(0,f.jsx)("div",{style:h.triggerContainer,children:(()=>{const e=t.table!==a().U6;if(p)return(0,f.jsx)(r().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,f.jsx)(d().sA,{...m.configurationHidden})});if("full"===y.configuration){const{FullConfiguration:o}=y;return e?(0,f.jsx)(o,{workflowStore:t,workflowValue:n,trigger:w,isInTranscript:s,workflowDefinitionPointer:l,saveTrigger:g}):void 0}return(0,f.jsxs)(f.Fragment,{children:[s&&y.transcriptDescription?(0,f.jsx)("div",{style:h.title,children:y.transcriptDescription(M,w)}):void 0,y.ConfigurationComponent&&e?(0,f.jsx)(y.ConfigurationComponent,{workflowStore:t,workflowValue:n,trigger:w,isInTranscript:s,workflowDefinitionPointer:l,saveTrigger:g}):void 0]})})()})})}},774879:(e,t,n)=>{n.d(t,{O:()=>a});n(296540);var o=()=>n(658460),i=n(474848);const r="https://notion.notion.site/Alpha-Overview-MCP-Connections-for-Custom-Agents-2c5efdeead0580f2b7b6ffeb601f4cb7";function a(){return(0,i.jsx)(o().m,{href:r,type:"alpha"})}},812109:(e,t,n)=>{function o(e){return"string"==typeof e?e:"calendarId"in e?`${e.accountId}:${e.calendarId}`:`${e.accountId}:${e.id}`}function i({id:e,accountId:t,calendarId:n}){return`${t}:${n}:${e}`}n.d(t,{N:()=>o,z:()=>i})},814207:(e,t,n)=>{n.d(t,{c:()=>r,f:()=>a});var o=()=>n(449851),i=()=>n(423493);function r(e){const t=i().y[e.type];return null!=t&&t.getIcon?t.getIcon(e):o().d.getIcon(e)}function a(e){const t=i().y[e.type];if(null!=t&&t.getSecondaryLabel)return t.getSecondaryLabel(e)}},821979:(e,t,n)=>{n.d(t,{y:()=>r});var o=n(296540),i=()=>n(942580);function r(e){const{externalConnection:t}=(0,i().q)({moduleValue:e}),n=(0,o.useMemo)((()=>{if(!e.state||!("connectionPointer"in e.state))return;return e.state.connectionPointer?t&&t.data&&"object"==typeof t.data&&"authenticated"in t.data&&!1===t.data.authenticated?{status:"needs_reauth",color:"yellow"}:{status:"connected",color:"green"}:void 0}),[t,e.state]);return n||{status:"needs_setup",color:"gray"}}},843801:(e,t,n)=>{n.d(t,{H:()=>r,j:()=>i});class o extends(()=>n(757695))().Store{constructor(...e){super(...e),this.initiate=()=>{this.setState({mcpDesktopOAuthState:{status:"initiated"}})},this.complete=e=>{this.setState({mcpDesktopOAuthState:{status:"completed",...e}})},this.fail=()=>{this.setState({mcpDesktopOAuthState:{status:"failed"}})},this.reset=()=>{this.setState({mcpDesktopOAuthState:void 0})}}getInitialState(){return{}}}const i=new o;function r(e){var t;if("initiated"!==(null===(t=i.state.mcpDesktopOAuthState)||void 0===t?void 0:t.status))return{didHandle:!1};const{connectionId:n,spaceId:o,error:r}=e;return!r&&n&&o?(i.complete({connectionId:n,spaceId:o}),{didHandle:!0}):(i.fail(),{didHandle:!0})}(0,n(852832).exposeDebugValue)("mcpOAuthStore",i)},908268:(e,t,n)=>{n.d(t,{n:()=>j});n(296540);var o=()=>n(484714),i=()=>n(590526),r=()=>n(401497),a=()=>n(732810),s=()=>n(849255),l=()=>n(350013),d=()=>n(699143),c=()=>n(996332),u=()=>n(970236),g=()=>n(493552),f=()=>n(584262),m=()=>n(496703),p=()=>n(69708),h=()=>n(100622),v=()=>n(284371),w=()=>n(770160),y=()=>n(16006),M=()=>n(994006),x=()=>n(492414),k=()=>n(912749),b=()=>n(827368),C=()=>n(181251),S=n(474848);function j(e){const{title:t,subtitle:n,hasUndoneOperations:o,titleSuffixStore:i,isTitleSuffixStoreReady:a,titleSuffix:c,state:f,aiChatFeatureController:m}=e,{bodyStyleKey:w}=(0,b().yq)(),y=(0,r().IS)((()=>({titleContainer:{display:"flex",flexDirection:"row",overflow:"hidden",minWidth:0,gap:2,alignItems:"center"},recordLink:{flex:"1 100 0",minWidth:0,overflow:"hidden"},recordTitleLink:{fontWeight:v().Wy.medium},user:{color:h().Tj.text.primary,paddingInlineStart:2}})),[]);let x=(0,S.jsxs)("div",{style:y.titleContainer,children:[(0,S.jsx)(g().D,{styleKey:w,children:t}),i&&a&&!o?(0,S.jsx)("div",{style:y.recordLink,children:i instanceof s().L?(0,S.jsx)(M().A,{userStore:i,style:y.user,hasPersonHoverCard:!1}):i instanceof l().N?(0,S.jsx)(I,{store:i,style:y.recordTitleLink}):(0,S.jsx)(A,{store:i,aiChatFeatureController:m})}):void 0,c?(0,S.jsx)("div",{style:y.recordLink,children:c}):void 0]});return n&&(x=(0,S.jsxs)(d().Y1,{direction:"vertical",gap:4,style:{overflow:"hidden",minWidth:0},children:[x,n]})),(0,S.jsxs)(d().Y1,{direction:"horizontal",gap:2,children:[x,"confirmation:rejected"===f?(0,S.jsx)(u().E,{content:(0,S.jsx)(p().sA,{id:"AgentToolUseFull.canceled",defaultMessage:"Canceled"})}):o?(0,S.jsx)(u().E,{content:(0,S.jsx)(p().sA,{id:"AgentToolUseFull.reverted",defaultMessage:"Reverted"})}):void 0]})}function A({store:e,aiChatFeatureController:t}){const n=(0,p().tz)(),r=(0,o().Y0)(),s=(0,w().useThreadStoreFromCurrentRoute)(),{bodyStyleKey:l}=(0,b().yq)(),{shouldUseSidePeek:d,buildSidePeekUrl:u}=(0,C().H)({aiChatFeatureController:t}),m=(0,i().K8)((()=>{if(!e)return;const t=function(e){if(e instanceof a().m)return e.getParentCollectionViewBlockStore();return e}(e);if(!t)return;const o=function(e,t){switch(e){case"file":return t.formatMessage({id:"agent.tool_use_part.title.file",defaultMessage:"File"});case"image":return t.formatMessage({id:"agent.tool_use_part.title.image",defaultMessage:"Image"});case"video":return t.formatMessage({id:"agent.tool_use_part.title.video",defaultMessage:"Video"});case"audio":return t.formatMessage({id:"agent.tool_use_part.title.audio",defaultMessage:"Audio"});case"pdf":return t.formatMessage({id:"agent.tool_use_part.title.pdf",defaultMessage:"PDF"})}}(t.getType(),n);if(o)return{type:"text",text:o,colorVariant:"secondary"};if(d){const e=u(t.id);if(e)return{type:"link",url:e,colorVariant:"primary"}}return{type:"link",url:(0,x().Ay)({store:t,pageVisitSource:f().y8.AIChat,chatThreadId:null==s?void 0:s.id,fullyQualified:!r.isElectron}),colorVariant:"primary"}}),[e,s,n,r.isElectron,d,u]);return(0,S.jsx)(g().D,{styleKey:l,colorVariant:null==m?void 0:m.colorVariant,style:{overflow:"hidden"},children:"link"===(null==m?void 0:m.type)?(0,S.jsx)(c().Q,{style:{paddingInline:4,borderRadius:4},href:m.url,metaHref:m.url,onClick:e=>{e.stopPropagation()},children:(0,S.jsx)(y().A,{store:e,underline:!1,maxLength:35,maxLines:1,style:{display:"block",fontWeight:v().Wy.medium}})}):null==m?void 0:m.text})}function I({store:e,style:t}){var n;const o=(0,w().useThreadStoreFromCurrentRoute)(),r=(0,k().N)(e,!0),{bodyStyleKey:a}=(0,b().yq)(),s=(0,i().K8)((()=>(0,m().L)({workflowId:e.id,params:{workflowViewType:"agent",chatThreadId:null==o?void 0:o.id}})),[e,o]);return(0,S.jsx)(g().D,{styleKey:a,colorVariant:"primary",textOverflow:"ellipsis",children:(0,S.jsx)(c().Q,{style:{paddingInline:4,borderRadius:4},href:s,onClick:e=>{e.stopPropagation()},children:(0,S.jsx)("span",{style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",...t},children:(null===(n=r.workflowValue)||void 0===n?void 0:n.name)||(0,S.jsx)(p().sA,{defaultMessage:"Untitled Agent",id:"agent.untitled_agent"})})})})}},925255:(e,t,n)=>{n.d(t,{W:()=>a});n(296540);var o=()=>n(381571),i=()=>n(556958),r=n(474848);function a({backgroundColor:e,children:t,...n}){const a=(0,o().B)(e);return(0,r.jsx)("div",{style:a.wrapper,children:(0,r.jsx)(i().r,{...n,direction:"horizontal",children:t})})}},942580:(e,t,n)=>{n.d(t,{q:()=>h});var o=n(296540),i=()=>n(907258),r=()=>n(590526),a=()=>n(192),s=()=>n(383616),l=()=>n(183541),d=()=>n(978234),c=()=>n(966249),u=()=>n(484714),g=()=>n(187174);const f=new Map;function m(e,t){const n=(0,u().v3)(),[{status:o,value:i},r]=(0,g().Yb)((async()=>{if(e&&t)return async function(e,t,n){const o=`${(i={connectionId:t,spaceId:n}).connectionId}:${i.spaceId}`;var i;const r=f.get(o);if(r)return r;const a=(async()=>{const o=await e.api.callCellCompatibleApi({eventName:"getExternalConnection",environment:e,data:{connectionId:t,spaceId:n},cellNavigation:{spaceId:n}});if("success"===o.type)return o.data.connection})();return f.set(o,a),a.finally((()=>f.delete(o))),a}(n,e,t)}),[n,e,t]);return{loading:"pending"===o,connection:i,refetch:r}}var p=()=>n(330704);function h(e){const{moduleValue:t}=e,n=null==t?void 0:t.state,u=(0,r().O$)(i().AppStoreSidebarSpaceStore),g=(0,r().K8)((()=>null==u?void 0:u.pointer),[u]),f=(0,p().E)(),h=n&&"connectionPointer"in n?n.connectionPointer:void 0,v=(0,r().K8)((()=>{if(u&&h&&h.table===l().tE&&h.spaceId===(null==g?void 0:g.id))return a().s.createChildStore(u,h)}),[u,h,g]),w=(null==h?void 0:h.table)===s().Kl?h.id:void 0,{connection:y}=m(w,null==g?void 0:g.id),M=(0,r().K8)((()=>null==v?void 0:v.getScopes()),[v]),x=(0,r().K8)((()=>null==v?void 0:v.isPersonalPermission()),[v]),[k,b]=(0,o.useMemo)((()=>{const e=null==t?void 0:t.type,n="mail"===e||"calendar"===e||"mcpServer"===e,o=["read","write"];if((null==h?void 0:h.table)===s().Kl){const e=(null==y?void 0:y.scopes)??[],t=e.length>0,i=(null==y?void 0:y.parent_table)===d().yM;return!t&&n?[i,o]:[i,e]}const i=e?(0,c().jK)(e):void 0;return null==i||!i.createsConnectionForCurrentUser||M&&0!==M.length?[x,M??[]]:[x,o]}),[h,y,x,M,null==t?void 0:t.type]);return{allowedScopes:b,externalConnection:y,isScopedConnectionPersonal:k,isWorkspaceAdmin:f,scopedExternalConnectionStore:v,spacePointer:g}}},945109:(e,t,n)=>{n.d(t,{TF:()=>v,Tn:()=>p,eg:()=>h,hP:()=>m,i5:()=>f,lT:()=>w});n(898992),n(354520);var o=()=>n(388821),i=()=>n(696706),r=()=>n(728272),a=()=>n(978234),s=()=>n(563452),l=()=>n(384944),d=()=>n(72234),c=()=>n(547149),u=()=>n(555102),g=()=>n(140992);function f({environment:e,threadStore:t,title:n}){c().createAndCommit({userAction:"agentPersistenceActions.updateThreadTitle",environment:e,canUndo:!0,perform:e=>{l().zv({store:t.getDataStore(),transaction:e,data:{title:n}})}})}function m({environment:e,spaceViewStore:t,workflowModulePointer:n}){var o;const i=(null===(o=t.getSettings())||void 0===o?void 0:o.agent_chat_modules)??[];c().createAndCommit({canUndo:!1,environment:e,perform:e=>{d().AG(t,e,{agent_chat_modules:[...i,{pointer:n,defaultEnabled:!1}]})},userAction:"agentPersistenceHelpers.addAgentChatModule"})}function p({environment:e,spaceStore:t,spaceViewStore:n,threadStore:o,userStore:r,workflowModuleStore:a}){w({environment:e,spaceStore:t,threadStore:o,userStore:r,workflowModuleModels:[a.getModel()]}),c().createAndCommit({canUndo:!1,environment:e,perform:e=>{var t;const o=(null===(t=n.getSettings())||void 0===t?void 0:t.agent_chat_modules)??[];d().AG(n,e,{agent_chat_modules:o.filter((e=>!i().L3.isEqual(e.pointer,a.pointer)))}),l().zv({data:{alive:!1},store:a,transaction:e})},userAction:"agentPersistenceHelpers.deleteAgentChatModule"})}function h({currentUserPointer:e,environment:t,workflowModule:n,workflowPointer:o}){const{icon:i,name:r,pointer:s,tools:d,...u}=n;return c().createAndCommit({canUndo:!1,environment:t,perform:n=>{l().vt({environment:t,table:a().yM,args:{createdByPointer:e,id:s.id,module_type:"mcpServer",parentPointer:o||e,space_id:s.spaceId,alive:!0,data:{...u,...d&&d.length>0?{tools:d}:{},icon:i,id:s.id,name:r}},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:n})},userAction:"agentPersistenceHelpers.createAgentChatModule"}).serverCommitResult}function v(e){const{environment:t,spaceStore:n,threadStore:i,userStore:a,workflowModuleModels:l}=e;if(0===l.length||i.inMemoryRecordCache.isTemporaryData)return;const d=i.getTranscript(),{activeIntegrationPointers:f,inactiveIntegrationPointers:m}=(0,s().It)(d),p=f.slice(0),h=m.slice(0),v=new(r().d)(p),w=new(r().d)(h),y=o().RecordMap.create();for(const o of l)w.has(o.pointer)&&w.delete(o.pointer),v.add(o.pointer),y.addModel(o);const M=Array.from(v),x=Array.from(w);c().createAndCommit({userAction:"agentPersistenceHelpers.addAgentChatModuleStep",environment:t,canUndo:!1,perform:e=>{(0,g().Vn)({addSteps:[(0,u().yQ)({environment:t,activeRecordPointers:M,inactiveRecordPointers:x,recordMap:y,spaceStore:n})],environment:t,spaceStore:n,threadStore:i,transaction:e,userStore:a})}})}function w(e){const{environment:t,spaceStore:n,threadStore:i,userStore:a,workflowModuleModels:l}=e;if(0===l.length||i.inMemoryRecordCache.isTemporaryData)return;const d=i.getTranscript(),{activeIntegrationPointers:f,inactiveIntegrationPointers:m}=(0,s().It)(d),p=f.slice(0),h=m.slice(0),v=new(r().d)(p),w=new(r().d)(h),y=o().RecordMap.create();for(const o of l)v.has(o.pointer)&&v.delete(o.pointer),w.add(o.pointer),y.addModel(o);const M=Array.from(v),x=Array.from(w);c().createAndCommit({userAction:"agentPersistenceHelpers.deleteAgentChatModuleStep",environment:t,canUndo:!1,perform:e=>{(0,g().Vn)({addSteps:[(0,u().yQ)({environment:t,activeRecordPointers:M,inactiveRecordPointers:x,recordMap:y,spaceStore:n})],environment:t,spaceStore:n,threadStore:i,transaction:e,userStore:a})}})}},958467:(e,t,n)=>{n.d(t,{AS:()=>d,Rv:()=>l,WI:()=>c,e1:()=>r,t8:()=>s});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(737550);var o=()=>n(534177);const i=["mail.email.received","mail.label.applied"];function r(e){return!!(0,o().Xk)(i,e)}function a(e){return"mail.email.received"===(null==e?void 0:e.type)||"mail.label.applied"===(null==e?void 0:e.type)}function s(e){return!!e&&e.some((e=>{var t;return(null===(t=e.state)||void 0===t?void 0:t.type)&&r(e.state.type)}))}function l(e){const t=e.state;if(!a(t))return[];if("mail.email.received"!==t.type)return[];const n=t.filters;if(!n||0===n.length)return[];const o=new Set;for(const i of n)o.add(i.field);return Array.from(o)}function d(e){const t=e.state;if(!a(t))return;const n=t.emailAccountIds;return n&&0!==n.length?n[0]:void 0}function c(e){if(!e)return;const t=new Set;for(const o of e){var n;const e=null===(n=o.state)||void 0===n?void 0:n.type;e&&r(e)&&t.add(e)}return 0!==t.size?Array.from(t):void 0}},964484:(e,t,n)=>{n.d(t,{x:()=>h});var o=n(296540),i=()=>n(664594),r=()=>n(59226),a=()=>n(590526),s=()=>n(869190),l=()=>n(187174),d=()=>n(402390),c=()=>n(68263),u=()=>n(798880),g=()=>n(966249),f=()=>n(69708),m=()=>n(6208),p=()=>n(942580);function h({module:e,workflowStore:t}){const{scopedExternalConnectionStore:n,externalConnection:h}=(0,p().q)({moduleValue:e}),v=(0,f().tz)(),w=(0,d().H)(v),y=(0,i().T)(),M=(0,m().L)(),x=e&&e.state&&"connectionPointer"in e.state?e.state.connectionPointer:void 0,k=e?(0,g().jK)(e.type):void 0,b=(null==k?void 0:k.createsConnectionForCurrentUser)&&!x,C=(0,r().X)("workflow_module_ownership_validation"),S=(0,a().K8)((()=>{const e=null==n?void 0:n.getCreatedByPointer();return{createdById:(null==e?void 0:e.table)===u().oo?e.id:void 0,createdTime:null==n?void 0:n.getCreatedTime()}}),[n]),j=(0,a().K8)((()=>null==t?void 0:t.getRole()),[t]),{createdById:A,createdTime:I}=(0,o.useMemo)((()=>{const e=(null==h?void 0:h.created_by_table)===u().oo?h.created_by_id:void 0;return{createdById:S.createdById??e,createdTime:S.createdTime??(null==h?void 0:h.created_time)}}),[h,S]),T=(0,l().Yb)((async()=>{if(A&&t){const e=await t.loadRecordModel({table:u().oo,id:A});return null==e?void 0:e.getDisplayName(v)}return b&&M?M:v.formatMessage({defaultMessage:"Unknown user",id:"workflow.connectedModuleOwner.unknownName"})}),[A,M,v,b,t]),D=(0,o.useMemo)((()=>{if(I&&0!==I)return(0,s().W_)(I,"medium_with_time",w)}),[I,w]),P=(0,o.useMemo)((()=>!C||A===y||!A),[A,y,C]),R=(0,o.useMemo)((()=>A===y||void 0!==j&&(0,c().p2)(j)),[A,y,j]);return{createdByUser:T[0].value,createdDateString:D,canCurrentUserUpdateConnection:P,canCurrentUserRemoveModule:R}}},971495:(e,t,n)=>{n.d(t,{U:()=>p});n(16280);var o=n(296540),i=()=>n(106702),r=()=>n(836095),a=()=>n(726637),s=()=>n(484714),l=()=>n(427704),d=()=>n(724639),c=()=>n(939768),u=()=>n(61958),g=()=>n(725951),f=()=>n(430840);const m=(0,n(69708).YK)({titleMessage:{id:"workflows.hooks.useModuleAuthDetails.title",defaultMessage:"Authenticate"}});function p(e){var t;const{moduleValue:n,workflowDefinitionPointer:p,workflowModuleStore:h,onAuthComplete:v}=e,[w,y]=(0,o.useState)(!1),M=(0,s().v3)(),{isElectron:x}=(0,s().Y0)(),k=null===(t=(0,i().$)())||void 0===t?void 0:t.id,b=(0,o.useCallback)((e=>{if(!k)return;const{callbackType:t,redirectToAuth:o}=(0,g().LX)(M);let i;if(h){if(!h.isDefined())throw new Error("Workflow module store has not loaded");const{transcriptId:n}=(0,d().kI)(p);if(!n)throw new Error("Transcript ID is required");i=(0,d().nh)({callbackType:t,integrationId:h.id,moduleSpecific:e,redirectToAuth:o?"true":void 0,spaceId:h.getSpaceId(),transcriptId:n,type:"agent",userId:k},a().A.domainBaseUrl)}else{const{spaceId:r,workflowId:s,transcriptId:l}=(0,d().kI)(p);i=(0,d().nh)({callbackType:t,moduleId:n.id,moduleSpecific:e,redirectToAuth:o?"true":void 0,spaceId:r,type:"workflow",workflowId:s,transcriptId:l,userId:k},a().A.domainBaseUrl)}x&&(i=(0,c().Gm)({url:`${a().A.domainBaseUrl}${l().JZ.initiateExternalAuthenticationFromDesktop}`,query:{redirectUri:encodeURIComponent(i)}})),x?(0,r().P)(i):u().P(M,{height:700,titleMessage:m.titleMessage,url:i,width:610,onClose:e=>{e&&v&&v()}})}),[k,M,h,x,p,n.id,v]),C=(0,o.useCallback)((()=>{var e;e=n.type,void 0!==f().V[e]?y(!0):b()}),[n.type,b]),S=(0,o.useCallback)((()=>{y(!1)}),[]);return{authDetailModalArgs:{isOpen:w,moduleId:n.id,moduleType:n.type,navigateWithModuleSpecificAuth:b,onDismiss:S,workflowDefinitionPointer:p,workflowModuleStore:h},handleConnect:C}}},976710:(e,t,n)=>{n.d(t,{j:()=>s});n(16280),n(944114),n(581454);var o=()=>n(484714),i=()=>n(187174),r=()=>n(696706);const a={asana:l,box:l,calendar:async function(e){return Promise.resolve({sections:[]})},cursor:async function(e){return Promise.resolve({sections:[]})},discord:l,files:void 0,fs:void 0,images:void 0,googleDrive:l,gmail:l,googleCalendar:l,github:async function(e){return Promise.resolve({sections:[]})},jira:l,linear:l,mail:async function(e){return Promise.resolve({sections:[]})},microsoftTeams:l,outlook:l,mcpServer:async function(e){return Promise.resolve({sections:[]})},notion:void 0,computer:void 0,salesforce:l,sharepoint:l,slack:async function(e){const{environment:t,moduleValue:o,workflowDefinitionPointer:i,workflowModuleStore:a}=e,{spaceId:s,transcriptId:l,workflowId:d}=(0,n(724639).kI)(i),c=await n(769864).callApi({eventName:"getViaWorkflowModuleConfigurationUtil",environment:t,data:{moduleId:o.id,spaceId:s,transcriptId:l,workflowId:d,workflowModuleId:null==a?void 0:a.id,moduleType:o.type,callArguments:{functionName:"getSlackConnections",functionArgs:[]}}});if("success"===c.type){if("getSlackConnections"!==c.data.functionName)throw new Error(`Invalid function name: ${c.data.functionName} from response for moduleId: ${o.id}`);const e=[];return c.data.functionReturn.personal.length>0&&e.push({icon:void 0,items:c.data.functionReturn.personal.map((e=>({icon:void 0,pointer:r().L3.fromPointerLike({id:e.id,table:e.table,spaceId:i.spaceId}),searchTitle:e.name,title:e.name}))),title:"Personal"}),c.data.functionReturn.space.length>0&&e.push({icon:void 0,items:c.data.functionReturn.space.map((e=>({icon:void 0,pointer:r().L3.fromPointerLike({id:e.id,table:e.table,spaceId:i.spaceId}),searchTitle:e.name,title:e.name}))),title:"Space"}),{sections:e}}return{sections:[]}},modules:void 0,search:void 0,web:void 0,test:void 0,worker:void 0,workers:void 0};function s(e){const{moduleValue:t,workflowDefinitionPointer:n,workflowModuleStore:r}=e,s=(0,o().v3)(),[l,d]=(0,i().Yb)((async()=>{const e=null==a?void 0:a[t.type];if(e)return await e({environment:s,moduleValue:t,workflowDefinitionPointer:n,workflowModuleStore:r});throw new Error(`No API call found for module type: ${t.type}`)}),[s,t,n,r]);return[l,d]}async function l(e){return Promise.resolve({sections:[]})}}}]);