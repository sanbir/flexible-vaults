"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[72252],{114282:(e,t,o)=>{o.d(t,{mD:()=>we,n3:()=>ve,Od:()=>Te,U7:()=>he,lD:()=>ge,ZB:()=>Se,lF:()=>Ae,MW:()=>ye,un:()=>fe,DZ:()=>me,BA:()=>Ie});o(16280),o(944114),o(898992),o(354520),o(803949),o(581454),o(737550);var r=()=>o(564884),a=()=>o(69708);const i=(0,a().YK)({upload_file_size_exceeded:{id:"confluenceImportErrors.uploadFileSizeExceeded.message",defaultMessage:"Import file cannot exceed {maxSize}."},failed_to_extract_zip:{id:"confluenceImportErrors.failedToExtractZip.message",defaultMessage:"Unable to extract ZIP file. ZIP is not in Confluence export format. Please re-export and try again."},no_index_html_file:{id:"confluenceImportErrors.noIndexHtmlFile.message",defaultMessage:"This file doesn’t appear to be a valid Confluence HTML export. When exporting from Confluence, make sure to select HTML format, then try again."},index_html_missing_available_pages:{id:"confluenceImportErrors.indexHtmlMissingAvailablePages.message",defaultMessage:"Your import failed because the index page doesn’t list any available pages. Please check your file and retry."},no_confluence_id_in_page_link:{id:"confluenceImportErrors.noConfluenceIdInPageLink.message",defaultMessage:"Your import failed because we couldn’t find a Confluence ID on the index page. Please check your file and retry."},failed_to_find_element:{id:"confluenceImportErrors.failedToFindElement.message",defaultMessage:"Failed to parse upload."},found_element_is_incorrect_type:{id:"confluenceImportErrors.foundElementIsIncorrectType.message",defaultMessage:"Failed to parse upload."},buffer_upload_failed:{id:"confluenceImportErrors.bufferUploadFailed.message",defaultMessage:"Failed to upload attachment from buffer."},attachment_not_found:{id:"confluenceImportErrors.attachmentNotFound.message",defaultMessage:"Failed to find attachment in ZIP file."},attachment_upload_failed:{id:"confluenceImportErrors.attachmentUploadFailed.message",defaultMessage:"Failed to upload attachment from file."},failed_to_build_page:{id:"confluenceImportErrors.failedToBuildPage.message",defaultMessage:"Failed to import page."},macro_processing_failed:{id:"confluenceImportErrors.macroProcessingFailed.message",defaultMessage:"Failed to process macro."},page_size_exceeded:{id:"confluenceImportErrors.pageSizeExceeded.message",defaultMessage:"Page skipped due to size limit."},api_error:{id:"confluenceImportErrors.apiError.message",defaultMessage:"Failed to fetch data from api."},invalid_site_url_format:{id:"confluenceImportErrors.invalidSiteUrlFormat.message",defaultMessage:"Please enter a valid site URL. Example: https://example.com"},invalid_file_extension:{id:"confluenceImportErrors.invalidFileExtension.message",defaultMessage:"Your import failed because the file doesn’t have a .html extension. Please use an .html file and try again."},incorrect_file_type:{id:"confluenceImportErrors.incorrectFileType.message",defaultMessage:"Invalid file type. Please upload the zip exported from Confluence."},confluence_import_concurrency_limit:{id:"confluenceImportErrors.confluenceImportConcurrencyLimit.message",defaultMessage:"A Confluence import is already in progress for this workspace. Please wait for it to complete before starting a new import."}});var n=()=>o(971752);const s=(0,a().YK)({file_size_exceeded:{id:"importActions.fileImportFailedError.customSizeTooLarge.message",defaultMessage:"File is too large. Please upload a file smaller than {maxSize}"},row_limit_exceeded:{id:"row_limit_exceeded",defaultMessage:"Row limit cannot exceed {maxRows}"},column_limit_exceeded:{id:"column_limit_exceeded",defaultMessage:"Column limit cannot exceed {maxColumns}"}});var l=()=>o(846944),p=()=>o(242422),c=()=>o(259136),m=()=>o(675133),d=()=>o(609679),u=()=>o(792057),f=()=>o(295633),g=()=>o(723085),I=()=>o(584262),v=()=>o(700500),S=()=>o(869190),w=()=>o(165358),y=()=>o(416504),h=()=>o(416845),T=()=>o(206267),A=()=>o(490884),_=()=>o(72135),M=()=>o(161479),F=()=>o(42466),C=()=>o(319625),b=()=>o(496603),x=()=>o(229833),k=()=>o(763824),P=()=>o(578194),E=()=>o(609316),V=()=>o(583835);const R=(0,V().Dv)("importGoogleDoc"),L=(0,V().Dv)("importTrello");var U=()=>o(290913);const N=(0,V().Dv)("parallelImportConfluenceExport"),D=(0,V().Dv)("parallelImportConfluenceViaApi"),z=(0,V().Dv)("parallelImportConfluenceViaApiMigrations"),O=(0,V().Dv)("partitionedUniversalImport");var B=()=>o(453644),W=()=>o(559926),Z=()=>o(769864),K=()=>o(357625),G=()=>o(722101),j=()=>o(496414),$=()=>o(384944),X=()=>o(185544),Y=()=>o(955930),H=()=>o(892632),J=()=>o(492414),q=()=>o(495463),Q=()=>o(981265),ee=()=>o(171598),te=()=>o(712505),oe=()=>o(404141),re=()=>o(547149),ae=()=>o(989133),ie=()=>o(352442);const ne=1073741824;var se=()=>o(270858),le=()=>o(773248),pe=()=>o(247402),ce=()=>o(892232);const me=(0,a().YK)({uploadingOneFile:{id:"importActions.uploadingOneFile.loadingMessage",defaultMessage:"Uploading… ({percentComplete}%)"},uploadingMultipleFilesNotStarted:{id:"importActions.uploadingMultipleFilesNotStarted.loadingMessage",defaultMessage:"Uploaded 0 of {totalNumberOfFiles}"},uploadingMultipleFilesInProgress:{id:"importActions.uploadingMultipleFilesInProgress.loadingMessage",defaultMessage:"Uploaded {numberOfUploadedFiles} of {totalNumberOfFiles}"},uploadingMultipleFilesComplete:{id:"importActions.uploadingMultipleFilesComplete.loadingMessage",defaultMessage:"Uploaded {totalNumberOfFiles} of {totalNumberOfFiles}"},importingOneFile:{id:"importActions.importingOneFile.loadingMessage",defaultMessage:"Importing…"},importingMultipleFilesNotStarted:{id:"importActions.importingMultipleFilesNotStarted.loadingMessage",defaultMessage:"Imported 0 of {totalNumberOfFiles}"},importingMultipleFilesInProgress:{id:"importActions.importingMultipleFilesInProgress.loadingMessage",defaultMessage:"Imported {numberOfImportedFiles} of {totalNumberOfFiles}"},importingMultipleFilesComplete:{id:"importActions.importingMultipleFilesComplete.loadingMessage",defaultMessage:"Imported {totalNumberOfFiles} of {totalNumberOfFiles}"},importingFromTrelloMessage:{id:"importActions.importingFromTrello.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} board from Trello} other {Importing {importingCount} boards from Trello}}"},importingFromAsanaMessage:{id:"importActions.importingFromAsana.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} project from Asana} other {Importing {importingCount} projects from Asana}}"},importingFromEvernoteMessage:{id:"importActions.importingFromEvernote.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} notebook from Evernote} other {Importing {importingCount} notebooks from Evernote}}"},importingFromConfluenceViaAPIMessage:{id:"importActions.importingFromConfluenceViaAPI.loadingMessage",defaultMessage:"Importing confluence space: {confluenceSpaceKey}."},importFailed:{id:"importActions.importFailedError.message",defaultMessage:"Import failed"},importFailedWithError:{id:"importActions.importFailedWithError.message",defaultMessage:"Import failed: {error}"},fileImportFailedSizeTooLarge:{id:"importActions.fileImportFailedError.sizeTooLarge.message",defaultMessage:"Import failed: file exceeds 5MB."},fileImportFailedCustomSizeTooLarge:{id:"importActions.fileImportFailedError.customSizeTooLarge.message",defaultMessage:"File is too large. Please upload a file smaller than {maxSize}"},trelloImportFailed:{id:"importActions.trelloImportFailedError.message",defaultMessage:"Trello import failed."},asanaImportFailed:{id:"importActions.asanaImportFailedError.message",defaultMessage:"Asana import failed."},evernoteImportFailed:{id:"importActions.evernoteImportFailedError.message",defaultMessage:"Evernote import failed."},confluenceImportViaAPIFailed:{id:"importActions.confluenceImportViaAPIFailedError.message",defaultMessage:"Confluence space import failed."},confluenceImportAlreadyRunning:{id:"importActions.confluenceImportAlreadyRunning.message",defaultMessage:"A Confluence import is already in progress for this workspace. Please wait for it to complete before starting a new import."},confluenceMultiSpaceImportRunning:{id:"importActions.confluenceMultiSpaceImportRunning.message",defaultMessage:"A multi-space Confluence import is already in progress. Please wait for it to complete."},confluenceCannotStartMultiSpaceWhileOthersRunning:{id:"importActions.confluenceCannotStartMultiSpaceWhileOthersRunning.message",defaultMessage:"Cannot start a multi-space import while other Confluence imports are running. Please wait for them to complete."},confluenceMaxConcurrentImportsReached:{id:"importActions.confluenceMaxConcurrentImportsReached.message",defaultMessage:"Maximum of 3 concurrent Confluence imports allowed per workspace. Please wait for one to complete."},importTitle:{id:"importActions.importTitle",defaultMessage:"Import {date}"},importTitleWithImportName:{id:"importActions.importTitleWithImportName",defaultMessage:"{name}"},importTitleForGenericFileImporter:{id:"importActions.importTitleForGenericFileImporter",defaultMessage:"{fileName} Import {date}"},importTitleForMondayV2:{id:"importActions.importTitleForMondayV2",defaultMessage:"Import from Monday - {date}"},onlyDocxExtensionSupported:{id:"importErrors.onlyDocxExtensionSupported.message",defaultMessage:"Import failed: file type not supported."},csvImportFailedColumnsTooLarge:{id:"importActions.csvImportFailedColumnsTooLargeError.message",defaultMessage:"Import failed: CSV file has too many columns."},csvImportFailedRowsTooLarge:{id:"importActions.csvImportFailedRowsTooLargeError.message",defaultMessage:"Your file has too many rows. The maximum allowed is 100000"},xlsxImportFailedColumnsTooLarge:{id:"importActions.xlsxImportFailedColumnsTooLargeError.message",defaultMessage:"Import failed: XLSX file has too many columns."},xlsxImportFailedRowsTooLarge:{id:"importActions.xlsxImportFailedRowsTooLargeError.message",defaultMessage:"Import failed: XLSX file has too many rows."}}),de=1073741824;async function ue(e,t,o){const r=await Z().callApi({eventName:"getActiveImportTasks",environment:e,data:{spaceId:t}});if("success"!==r.type)return{canStart:!0};const a=r.data.filter((e=>"confluence"===e.source));return a.some((e=>"multiSpaceConfluenceImportViaApi"===e.eventName))?{canStart:!1,reason:"multiSpaceImportRunning"}:o&&a.length>0?{canStart:!1,reason:"cannotStartMultiSpaceWhileOthersRunning"}:!o&&a.length>=3?{canStart:!1,reason:"maxConcurrentImportsReached"}:{canStart:!0}}async function fe(e){const{uploadType:t,allowMultiple:o}=e;return ge(e,await H().dA({environment:e.environment,supportsMobileNativeFileUpload:!1,multiple:o??!0,accept:A().k2[t].join(",")}))}async function ge(e,t){const{environment:o,pageStore:r,spaceStore:a,isTeamPage:d,spaceViewStore:g,uploadType:v,flowId:S,analyticsFrom:A}=e;let M;try{if(0===t.length)return;const i=1===t.length,n=performance.now(),s={};if("confluence"===v){const r=(Number((0,ae().xc)(o))||15)*de;if(!i)throw new(h().yI4)("Multiple files not supported",{clientData:{type:"multiple_files_not_supported"}});if(t[0].size>r)throw W()._$(e.environment,{import_source:"confluence",data:{import_type:"file",status:"failure",error:"Maximum upload size exceeded",fileSize:t[0].size},flowId:S}),new(h().ico)("Maximum upload size exceeded",{clientData:{type:"upload_file_size_exceeded",messageValues:{maxSize:_().z3(r,{decimals:1})}}})}else if("genericImporter"===v){const r=(0,ie().qr)(o)||15,a=r*de;if(!i)throw new(h().yI4)("Multiple files not supported",{clientData:{type:"multiple_files_not_supported"}});if(t[0].size>a)throw W()._$(e.environment,{import_source:"file",data:{import_type:"file",status:"failure",error:"Maximum upload size exceeded",fileSize:t[0].size},flowId:S}),new(h().yI4)("Maximum upload size exceeded",{clientData:{type:"upload_file_size_exceeded",messageValues:{maxSize:`${r} GB`}}})}else if("pdf"===v){const o=Number(p().default.getEligibleGroup({experimentId:"special_case_pdf_file_size",defaultGroup:ne.toString()})),r=o;for(const a of t)if(a.size>r)throw W()._$(e.environment,{import_source:"file",data:{import_type:"file",status:"failure",error:"Maximum upload size exceeded",fileSize:a.size},flowId:S}),new(h().yI4)("Maximum upload size exceeded",{clientData:{type:"upload_file_size_exceeded",messageValues:{maxSize:`${o} GB`}}})}const l=await new Promise(((e,r)=>{H().Zn({environment:o,uploadType:v,files:t,bucket:"temporary",bypassFreeFileUploadLimitCheck:!0,flowId:S,spaceId:a.id,onBatchStart:()=>{j().m({message:i?me.uploadingOneFile:me.uploadingMultipleFilesNotStarted,interpolatedValues:{totalNumberOfFiles:t.length,percentComplete:0}})},onBatchProgress:({uploadedFiles:e,progressPercent:o})=>{j().m({message:i?me.uploadingOneFile:me.uploadingMultipleFilesInProgress,interpolatedValues:{numberOfUploadedFiles:e,totalNumberOfFiles:t.length,percentComplete:o}})},onBatchCompleteWithToken:o=>{j().m({message:i?me.uploadingOneFile:me.uploadingMultipleFilesComplete,interpolatedValues:{totalNumberOfFiles:t.length,percentComplete:100}}),e(o)},onBatchError:r})})),c=performance.now();s.uploadTimeTaken=c-n;const m="slash_command"===A&&!["googleDocs","confluence","genericImporter"].includes(v),u=await ve({environment:o,spaceStore:a,spaceViewStore:g,uploadType:v,fileCount:(null==t?void 0:t.length)??0,fileName:null==t?void 0:t[0].name,pageStore:r,isTeamPage:d,importAsSubPage:m});M=u.createdPage;const w=u.importType,C=u.pageId,b=l.map(((e,o)=>({fileURL:e.fileUrl,fileName:t[o].name,signedToken:e.signedToken}))),x=p().default.checkGate({gateName:"csvimport_faster_navigate_to_page_enabled"});let k=0;j().m({message:i?me.importingOneFile:me.importingMultipleFilesInProgress,interpolatedValues:{numberOfImportedFiles:k,totalNumberOfFiles:t.length}});const P=(0,y().P)();if(x&&("ReplaceBlock"===w||"AppendToBlock"===w)&&"csv"===v){const e=f().B.createChildStore(a,{table:F().evP,id:C}),t=(0,J().Ay)({store:e,preferPublicLink:!1,pageVisitSource:I().y8.Import});(0,ee().navigateOnBaseUrl)({environment:o,url:t})}const V=se().R.getOrCreateImportId();for(const{fileURL:e,fileName:r,signedToken:d}of b){const n=T().JW();if("confluence"===v){W()._$(o,{import_source:"confluence",data:{import_type:"file",status:"success",fileSize:t[0].size},flowId:S});const i=we({environment:o,spaceStore:a,spaceViewStore:g});await i.deferred.promise;const n=i.pageId;W().Pd(o,{import_source:"confluence",import_type:"file",flowId:S});const s=K().UT(o,N,{fileURL:e,fileName:r,page:{id:C,spaceId:a.id},loggerPageId:n,flowId:S||T().JW(),importId:V,signedToken:d},{spaceIds:[a.id]});for await(const e of s){if(e.error)throw e.error;e.value.isComplete||j().m(e.value.status)}}else if("AppendToBlock"===w){const t={fileURL:e,fileName:r,importType:w,block:{id:C,spaceId:u.spaceId},spaceId:u.spaceId,flowId:S,userTimeZone:P,signedToken:d,importEntryPoint:A,importId:V,importInstanceId:n};W().mM(o,{import_source:"genericImporter"===v?"universal":v,data:t,flowId:S});const i=p().default.checkGate({gateName:"partitioned_universal_importer"}),l=p().default.checkGate({gateName:"zip_importer_v2_enabled"}),m={fileURL:e,fileName:r,importType:"ReplaceBlock",spaceId:u.spaceId,rootId:C,userTimeZone:P,signedToken:d,importId:V,importInstanceId:n};let f;if(l&&"genericImporter"===v){const e=we({environment:o,spaceStore:a,spaceViewStore:g});await e.deferred.promise,f=e.pageId}const I={fileURL:e,fileName:r,spaceId:u.spaceId,rootPageId:C,rootTableId:F().evP,loggerPageId:f,signedToken:d,importId:V,flowId:S,userTimeZone:P,importEntryPoint:A};W().Pd(o,{import_source:"genericImporter"===v?"universal":v,flowId:S,import_instance_id:n});const y=l&&"genericImporter"===v?K().UT(o,B().Z,I,{spaceIds:[u.spaceId]}):"genericImporter"===v&&i?K().UT(o,O,m,{spaceIds:[u.spaceId]}):K().UT(o,E().V,t,{spaceIds:[u.spaceId]});let h=!1;for await(const e of y){if(e.error)throw e.error;l&&"genericImporter"===v&&"isComplete"in e.value&&!e.value.isComplete&&j().m(e.value.status),x&&"csv"===v&&"status"in e.value&&"created_collection"===e.value.status.message&&!h&&(h=!0,j().V(),oe().Ay.reset(),s.importingSpinnerSpan||=performance.now()-c)}}else if("ReplaceBlock"===w){const t={fileURL:e,fileName:r,importType:w,block:{id:C,spaceId:u.spaceId},flowId:S,importId:V,spaceId:u.spaceId,userTimeZone:P,signedToken:d,importEntryPoint:A,importInstanceId:n};W().mM(o,{import_source:"genericImporter"===v?"universal":v,data:t,flowId:S}),W().Pd(o,{import_source:"genericImporter"===v?"universal":v,flowId:S,import_instance_id:n});const i=p().default.checkGate({gateName:"partitioned_universal_importer"}),l=p().default.checkGate({gateName:"zip_importer_v2_enabled"});let m;if(l&&"genericImporter"===v){const e=we({environment:o,spaceStore:a,spaceViewStore:g});await e.deferred.promise,m=e.pageId}const f={fileURL:e,fileName:r,importType:"ReplaceBlock",spaceId:u.spaceId,rootId:C,userTimeZone:P,signedToken:d,importId:V,importInstanceId:n},I={fileURL:e,fileName:r,spaceId:u.spaceId,rootPageId:C,rootTableId:F().evP,signedToken:d,importId:V,flowId:S,userTimeZone:P,importEntryPoint:A,loggerPageId:m},y=l&&"genericImporter"===v?K().UT(o,B().Z,I,{spaceIds:[u.spaceId]}):"genericImporter"===v&&i?K().UT(o,O,f,{spaceIds:[u.spaceId]}):K().UT(o,E().V,t,{spaceIds:[u.spaceId]});let h=!1;for await(const e of y){if(e.error)throw e.error;l&&"genericImporter"===v&&"isComplete"in e.value&&!e.value.isComplete&&j().m(e.value.status),x&&"csv"===v&&"status"in e.value&&"created_collection"===e.value.status.message&&(h||(h=!0,j().V(),oe().Ay.reset(),s.importingSpinnerSpan||=performance.now()-c))}}k++,x&&"csv"===v||j().m({message:i?me.importingOneFile:me.importingMultipleFilesInProgress,interpolatedValues:{numberOfImportedFiles:k,totalNumberOfFiles:t.length}})}return j().V(),s.overallTimeTaken=performance.now()-n,Ie(o,{uploadType:v,importType:w,importLatencies:s,fileNames:t.map((e=>e.name))}),f().B.createChildStore(a,{table:F().evP,id:C})}catch(P){var b,k;let e;w().log({level:"error",from:"importFiles",type:"importFilesFailure",error:(0,x().convertErrorToLog)(P),data:{spaceId:a.id}}),j().V(),re().createAndCommit({userAction:"importActions.importFiles",environment:o,canUndo:!0,perform:e=>{M&&G().TF({parentStore:a.getPagesStore(),childToRemoveStore:M,transaction:e})}});let t=null,r=null;if(P instanceof h().mvP&&P.clientData?(t=P.clientData,s[P.clientData.type]&&"ImportFileSizeTooLargeError"===(0,C().A)(P).message?r=s[P.clientData.type]:n().m[P.clientData.type]&&"CsvImportError"===(0,C().A)(P).message?r=n().m[P.clientData.type]:i[P.clientData.type]?r=i[P.clientData.type]:l()._[P.clientData.type]&&(r=l()._[P.clientData.type])):P instanceof h().ico&&"upload_file_size_exceeded"===(null===(b=P.body)||void 0===b||null===(b=b.clientData)||void 0===b?void 0:b.type)&&i[P.body.clientData.type]?(t=P.body.clientData,r=i[t.type]):P instanceof c().C?(t={messageValues:{error:"You've reached the maximum number of file uploads for a 12-hour period. We suggest uploading a ZIP file that includes all your files."}},r=me.importFailedWithError):P instanceof h().yI4&&"upload_file_size_exceeded"===(null===(k=P.body)||void 0===k||null===(k=k.clientData)||void 0===k?void 0:k.type)&&(t=P.body.clientData,r=l()._[P.body.clientData.type]),t&&r){const o="messageValues"in t?t.messageValues:void 0;e=m().A.formatMessage(r,o)}else e=t&&"code"in t&&("fileImportError"===t.code||"confluenceImportError"===t.code)?m().A.formatMessage(me.importFailedWithError,{error:(0,C().A)(P).message}):"ImportFileSizeTooLargeError"===(0,C().A)(P).message?m().A.formatMessage(me.fileImportFailedSizeTooLarge):"ImportcsvTooManyColumns"===(0,C().A)(P).message?m().A.formatMessage(me.csvImportFailedColumnsTooLarge):"ImportcsvTooManyRows"===(0,C().A)(P).message?m().A.formatMessage(me.csvImportFailedRowsTooLarge):"ImportxlsxTooManyColumns"===(0,C().A)(P).message?m().A.formatMessage(me.xlsxImportFailedColumnsTooLarge):"ImportxlsxTooManyRows"===(0,C().A)(P).message?m().A.formatMessage(me.xlsxImportFailedRowsTooLarge):m().A.formatMessage(me.importFailed);throw u().f1(e),P}}function Ie(e,t){const{uploadType:o,importType:a,importLatencies:i,fileNames:n}=t;if(("ReplaceBlock"===a||"AppendToBlock"===a)&&"csv"===o){const e=i.uploadTimeTaken,t=i.importingSpinnerSpan,o=t&&e?t+e:i.overallTimeTaken;i.firstTimeNavigateToCollection=o}w().log({level:"info",from:"importActions",type:"importFiles",data:{miscDataToConvertToString:{fileNames:n,importLatencies:i,uploadType:o,importType:a},message:"Finished importing file"}});for(const[s,l]of Object.entries(i))(0,r().u)({environment:e,event:{eventName:"import_file_finished",eventProperties:{importUploadType:o,importType:a,importLatency:l,importSource:"file",importLatencyType:s,importFileCount:n.length}}})}async function ve(e){var t;const{environment:o,spaceStore:r,spaceViewStore:a,uploadType:i,fileCount:n,fileName:s,pageStore:l,isTeamPage:p,importAsSubPage:c,importLocation:u}=e;let f,I,v,w=r.id;if(te().default.isSidePeekOpen()&&te().default.peekTargetStore.state&&c)I=te().default.peekTargetStore.state.id,v="AppendToBlock";else if(te().default.isSidePeekOpen()&&null!==(t=te().default.peekTargetStore.state)&&void 0!==t&&t.isEmptyPage())I=te().default.peekTargetStore.state.id,v="ReplaceBlock";else if(l&&(l.isEmptyPage()||c))n>1||l.isInsideCollection()||c?(I=l.id,v="AppendToBlock"):(I=l.id,v="ReplaceBlock");else{let e,t,l;u?"privatePage"===u.type?(e="private",t=!0):"block"===u.type?(e=u.pointer,t=!0):(e="none",t=!1,l=new(g().h)(o,{table:F().yKj,id:u.teamId,spaceId:r.id})):(e=p?"none":"private",t=!p);const c={date:(0,S().W_)(Date.now(),"medium",d().locale)};"genericImporter"===i&&(c.fileName=s?s.replace(".zip",""):"Universal File");const{performResult:y}=re().createAndCommit({userAction:"importActions.result",environment:o,canUndo:!0,perform:s=>{const p=m().A.formatMessage("genericImporter"===i?me.importTitleForGenericFileImporter:me.importTitle,c),d=X().IT({environment:o,spaceStore:r,spaceViewStore:a,parent:e,prepend:t,title:p,transaction:s});l&&Y().sP({teamStore:l,store:d,transaction:s,location:{type:t?"prepend":"append"}});const u=n>1?"AppendToBlock":"ReplaceBlock",f=k().yX();return s.postSubmitCallbacks.push((e=>{e?f.reject(e):f.resolve(void 0)})),{deferred:f,createdPage:d,pageId:d.id,importType:u,spaceId:d.getSpaceId()}}});f=y.createdPage,I=y.pageId,v=y.importType,w=y.spaceId,await y.deferred.promise}return{createdPage:f,pageId:I,importType:v,spaceId:w}}async function Se(e){const{environment:t,fileId:o,token:r,spaceStore:a,spaceViewStore:i,pageStore:n,analyticsFrom:s,flowId:l}=e;let p;try{j().m({message:me.importingOneFile});const e="link_paste"===s||"slash_command"===s,c=await ve({environment:t,spaceStore:a,spaceViewStore:i,uploadType:"googleDocs",fileCount:1,fileName:void 0,pageStore:n,isTeamPage:!1,importAsSubPage:e});p=c.createdPage;const m=c.importType,d=c.pageId,u={fileId:o,tokenId:r.id,importType:m,block:{id:d,spaceId:a.id},flowId:l,importId:se().R.getOrCreateImportId()};W().mM(t,{import_source:"googleDocs",data:u,flowId:l}),W().Pd(t,{import_source:"googleDocs",flowId:l});const{value:g}=await K().UT(t,R,u,{spaceIds:[]}).next();if(g.error)throw g.error;return j().V(),f().B.createChildStore(a,{table:F().evP,id:d})}catch(c){re().createAndCommit({userAction:"importActions.importFiles",environment:t,canUndo:!0,perform:e=>{p&&G().TF({parentStore:a.getPagesStore(),childToRemoveStore:p,transaction:e})}});let e=m().A.formatMessage(me.importFailed);throw c instanceof h().mvP&&c.clientData&&("only_docx_extension_supported"===c.clientData.type?e=m().A.formatMessage(me.onlyDocxExtensionSupported):"file_size_exceeded"===c.clientData.type&&(e=m().A.formatMessage(me.fileImportFailedCustomSizeTooLarge,{maxSize:c.clientData.messageValues.maxSize}))),u().f1(e),j().V(),new Error((0,C().A)(c).message)}}function we(e){const{environment:t,spaceStore:o,spaceViewStore:r,append:a,mondayV2:i}=e,{performResult:n}=re().createAndCommit({userAction:"importActions.result",environment:t,canUndo:!0,perform:e=>{const n=i?m().A.formatMessage(me.importTitleForMondayV2,{date:(0,S().W_)(Date.now(),"medium",d().locale)}):m().A.formatMessage(me.importTitle,{date:(0,S().W_)(Date.now(),"medium",d().locale)}),s=X().IT({environment:t,spaceStore:o,spaceViewStore:r,parent:"private",prepend:!a,title:i?n:`${n} Logs`,transaction:e}),l=k().yX();return e.postSubmitCallbacks.push((e=>{e?l.reject(e):l.resolve(void 0)})),{deferred:l,pageId:s.id}}});return n}async function ye(e){const{environment:t,boards:o,spaceStore:r,spaceViewStore:a,flowId:i}=e;j().m({message:me.importingFromTrelloMessage,interpolatedValues:{importingCount:o.length}}),ce().A.setState({open:!1});const{performResult:{deferred:n,pages:s}}=re().createAndCommit({userAction:"importActions.importTrello",environment:t,canUndo:!0,perform:e=>{const i=o.map((o=>X().IT({environment:t,spaceStore:r,spaceViewStore:a,parent:"private",prepend:!0,loading:!0,title:o.name,transaction:e}))),n=k().yX();return e.postSubmitCallbacks.push((e=>{e?n.reject(e):n.resolve(void 0)})),{deferred:n,pages:i}}});await n.promise;try{return await Promise.all(s.map((async(e,r)=>{const a=o[r],{value:n}=await K().UT(t,L,{boardId:a.id,block:{id:e.id,spaceId:(0,M().e)(e.pointer.spaceId)},importId:se().R.getOrCreateImportId(),flowId:i},{spaceIds:e.pointer.spaceId?[e.pointer.spaceId]:[]}).next();if(n.error)throw n.error}))),j().V(),s[0]}catch(l){re().createAndCommit({userAction:"importActions.importTrello",environment:t,canUndo:!0,perform:e=>{for(const t of s)G().TF({parentStore:r.getPagesStore(),childToRemoveStore:t,transaction:e})}});let e=m().A.formatMessage(me.trelloImportFailed);const o=l instanceof h().lV7?l.body.clientData:void 0;throw o&&"code"in o&&"trelloImportError"===o.code&&(e=m().A.formatMessage(me.importFailedWithError,{error:(0,C().A)(l).message})),u().f1(e),j().V(),new Error((0,C().A)(l).message)}}async function he(e){const{environment:t,spaceStore:o,spaceViewStore:r,notebooks:a,userSettingsStore:i,flowId:n}=e;if(0===a.length)throw new Error("Expected at least one notebook");j().m({message:me.importingFromEvernoteMessage,interpolatedValues:{importingCount:a.length}}),pe().A.setState({open:!1});const s=await async function(e){const{environment:t,spaceStore:o,spaceViewStore:r,notebooks:a}=e,{serverCommitResult:i,performResult:{blockStores:n}}=re().createAndCommit({userAction:"importActions.createStacks",environment:t,canUndo:!0,perform:e=>{const i=b().sb(b().oE(a.map((e=>e.stack)))).sort().reverse(),n={};let s=e=>!0;return a.length>1&&i.length>0&&(i.forEach((i=>{const s=X().IT({environment:t,spaceStore:o,spaceViewStore:r,parent:"private",prepend:!0,loading:!1,title:i,transaction:e}),l=s.getContentStore();a.filter((e=>e.stack===i)).forEach((o=>{const r=$().Wv({environment:t,type:v().xd.copyIndicator,inMemoryRecordCache:s.inMemoryRecordCache,transaction:e,spaceId:l.pointer.spaceId});G().BC({parentStore:l,appendStore:r,transaction:e}),n[o.guid]=r}))})),s=e=>!Boolean(e.stack)),a.filter(s).reverse().forEach((a=>{const i=X().IT({environment:t,spaceStore:o,spaceViewStore:r,parent:"private",prepend:!0,loading:!0,title:a.title,transaction:e});n[a.guid]=i})),{blockStores:n}}});return await i,n}({environment:t,spaceStore:o,spaceViewStore:r,notebooks:a}),l=s[a[0].guid];try{return await async function(e){const{environment:t,spaceStore:o,spaceViewStore:r,notebooks:a,waitForNotebookStore:i,notebookMapping:n,userSettingsStore:s,flowId:l}=e;let p;if(k().vA(a,_e,(async e=>{await Promise.all(e.map((async e=>{const o=n[e.guid];if(!o)throw new Error(`Missing notebook page ${e.guid}`);const r=k().yX();o===i&&(p=r),await async function(e){const{environment:t,notebookStore:o,notebook:r,firstCompleted:a,flowId:i}=e,n=K().UT(t,P().r,{notebookId:r.guid,block:{id:o.id,spaceId:(0,M().e)(o.pointer.spaceId)},timestamp:Date.now(),parentTable:F().evP,importId:se().R.getOrCreateImportId(),flowId:i},{spaceIds:[o.getSpaceId()]}),{value:s}=await n.next();if(s.error){console.error(s.error),re().createAndCommit({userAction:"importActions.importEvernoteNotebook",environment:t,canUndo:!0,perform:e=>{const t=o.getParentBlockStore();if(t){const r=t.getContentStore();G().TF({parentStore:r,childToRemoveStore:o,transaction:e})}}});let e=m().A.formatMessage(me.evernoteImportFailed);const r=s.error instanceof h().DfQ?s.error.body.clientData:void 0;r&&"code"in r&&"evernoteImportError"===r.code&&(e=m().A.formatMessage(me.importFailedWithError,{error:(0,C().A)(s.error).message})),u().f1(e),a.resolve(void 0)}a.resolve(void 0)}({environment:t,notebookStore:o,notebook:e,firstCompleted:r,flowId:l})})))})),!p)throw new Error("waitForNotebookFirstCompleted not defined.");const c=s.getSettings();if(null==c||!c.created_evernote_getting_started){const e=(0,Q().nH)("evernote");await(0,q().U)({environment:t,spaceStore:o,spaceViewStore:r,userSettingsStore:s,template:e})}await p.promise}({environment:t,waitForNotebookStore:l,notebookMapping:s,notebooks:a,spaceStore:o,spaceViewStore:r,userSettingsStore:i,flowId:n}),j().V(),l}catch(p){throw j().V(),u().f1(m().A.formatMessage(me.evernoteImportFailed)),p}}async function Te(e){const{environment:t,spaceStore:o,spaceViewStore:r,space:a,flowId:i}=e;if(!t.currentUser.id)throw new Error("User does not exist.");const n=await ue(t,o.id,!1);if(!n.canStart)throw new(h().yI4)("Confluence import blocked",{clientData:{type:"confluence_import_concurrency_limit",reasonKey:n.reason??"maxConcurrentImportsReached"}});j().m({message:me.importingFromConfluenceViaAPIMessage,interpolatedValues:{confluenceSpaceKey:a.name}}),le().A.setState({open:!1});const s=we({environment:t,spaceStore:o,spaceViewStore:r});await s.deferred.promise;const l=s.pageId;let p;if((0,ae().vY)(t)){const e=await Z().callApi({eventName:"createTeam",environment:t,data:{spaceId:o.id,name:a.name,accessLevel:"closed"}});if("failed"===e.type)throw new Error("Cannot create teamspace");p=e.data.teamId}const{performResult:c}=re().createAndCommit({userAction:"importActions.importConfluenceViaApi",environment:t,canUndo:!0,perform:e=>{const i=m().A.formatMessage(me.importTitleWithImportName,{name:a.name}),n=X().IT({environment:t,spaceStore:o,spaceViewStore:r,parent:"private",prepend:!0,title:i,transaction:e}),s=k().yX();return e.postSubmitCallbacks.push((e=>{e?s.reject(e):s.resolve(void 0)})),{deferred:s,createdPage:n,pageId:n.id}}});await c.deferred.promise;const d=c.createdPage;try{if(!d)throw new Error("No root page");W().Pd(t,{import_source:"confluence",import_type:"api",flowId:i});const e=(0,ae().u4)(t,o)?z:D,r=K().UT(t,e,{userId:t.currentUser.id,spaceId:o.id,confluenceSpaceKey:a.key,confluenceSpaceId:a.id,confluenceSpaceName:a.name,page:{id:c.pageId,spaceId:o.id},loggerPageId:l,flowId:i,teamId:p,importId:se().R.getOrCreateImportId()},{spaceIds:[o.id]});for await(const t of r){if(t.error)throw t.error;t.value.isComplete||j().m(t.value.status)}return j().V(),d}catch(f){w().log({level:"error",from:"importConfluenceViaAPI",type:"importConfluenceViaAPIFailure",error:(0,x().convertErrorToLog)(f),data:{spaceId:o.id}}),re().createAndCommit({userAction:"importActions.importConfluenceViaApi",environment:t,canUndo:!0,perform:e=>{d&&G().TF({parentStore:o.getPagesStore(),childToRemoveStore:d,transaction:e})}});let e=m().A.formatMessage(me.confluenceImportViaAPIFailed);const r=f instanceof h().ico||f instanceof h().yI4?f.body.clientData:void 0;if(r&&"type"in r&&"confluence_import_concurrency_limit"===r.type)if("reasonKey"in r){const t=r.reasonKey;e="multiSpaceImportRunning"===t?m().A.formatMessage(me.confluenceMultiSpaceImportRunning):"cannotStartMultiSpaceWhileOthersRunning"===t?m().A.formatMessage(me.confluenceCannotStartMultiSpaceWhileOthersRunning):"maxConcurrentImportsReached"===t?m().A.formatMessage(me.confluenceMaxConcurrentImportsReached):m().A.formatMessage(me.confluenceImportAlreadyRunning)}else e=m().A.formatMessage(me.confluenceImportAlreadyRunning);else r&&"code"in r&&"confluenceImportError"===r.code&&(e=m().A.formatMessage(me.importFailedWithError,{error:(0,C().A)(f).message}));throw u().f1(e),j().V(),new Error((0,C().A)(f).message)}}async function Ae(e){const{environment:t,spaceStore:o,spaceViewStore:r,spaces:a,flowId:i}=e;if(!t.currentUser.id)throw new Error("User does not exist.");const n=await ue(t,o.id,!0);if(!n.canStart)throw new(h().yI4)("Confluence import blocked",{clientData:{type:"confluence_import_concurrency_limit",reasonKey:n.reason??"maxConcurrentImportsReached"}});j().m({message:me.importingFromConfluenceViaAPIMessage,interpolatedValues:{confluenceSpaceKey:`${a.length} spaces`}}),le().A.setState({open:!1});const{performResult:s}=re().createAndCommit({userAction:"importActions.importMultiSpaceConfluenceViaAPI",environment:t,canUndo:!0,perform:e=>{const a=`Confluence Spaces Import Log - ${(0,S().W_)(Date.now(),"medium",d().locale)}`,i=X().IT({environment:t,spaceStore:o,spaceViewStore:r,parent:"private",prepend:!0,title:a,transaction:e}),n=k().yX();return e.postSubmitCallbacks.push((e=>{e?n.reject(e):n.resolve(void 0)})),{deferred:n,createdPage:i,pageId:i.id}}});await s.deferred.promise;const l=s.createdPage;try{W().Pd(t,{import_source:"confluence",import_type:"api",import_sub_type:"multispace",flowId:i});const e=a.map((e=>({confluenceSpaceId:e.id,confluenceSpaceKey:e.key,confluenceSpaceName:e.name,targetTeamSpaceId:e.targetTeamSpaceId}))),r=K().UT(t,U().k,{userId:t.currentUser.id,spaceId:o.id,spaceConfigs:e,page:{id:void 0,spaceId:o.id},loggerPageId:s.pageId,flowId:i,importId:se().R.getOrCreateImportId()},{spaceIds:[o.id]});for await(const t of r){if(t.error)throw t.error;t.value.isComplete||j().m(t.value.status)}return j().V(),l}catch(p){re().createAndCommit({userAction:"importActions.importMultiSpaceConfluenceViaAPI",environment:t,canUndo:!0,perform:e=>{l&&G().TF({parentStore:o.getPagesStore(),childToRemoveStore:l,transaction:e})}}),w().log({type:"error",level:"error",from:"importMultiSpaceConfluenceViaAPI",error:(0,x().convertErrorToLog)(p)});let e=m().A.formatMessage(me.importFailed);const r=p instanceof h().yI4?p.body.clientData:void 0;if(r&&"type"in r&&"confluence_import_concurrency_limit"===r.type)if("reasonKey"in r){const t=r.reasonKey;e="multiSpaceImportRunning"===t?m().A.formatMessage(me.confluenceMultiSpaceImportRunning):"cannotStartMultiSpaceWhileOthersRunning"===t?m().A.formatMessage(me.confluenceCannotStartMultiSpaceWhileOthersRunning):"maxConcurrentImportsReached"===t?m().A.formatMessage(me.confluenceMaxConcurrentImportsReached):m().A.formatMessage(me.confluenceImportAlreadyRunning)}else e=m().A.formatMessage(me.confluenceImportAlreadyRunning);else"object"==typeof p&&null!==p&&"message"in p&&(e=m().A.formatMessage(me.importFailedWithError,{error:(0,C().A)(p).message}));throw u().rG({message:e}),j().V(),new Error((0,C().A)(p).message)}}const _e=2},172252:(e,t,o)=>{o.d(t,{m:()=>C,y:()=>F});var r=()=>o(846944),a=()=>o(242422),i=()=>o(675133),n=()=>o(295633),s=()=>o(584262),l=()=>o(416504),p=()=>o(416845),c=()=>o(206267),m=()=>o(42466),d=()=>o(319625),u=()=>o(534177),f=()=>o(609316),g=()=>o(453644),I=()=>o(559926),v=()=>o(357625),S=()=>o(37450),w=()=>o(492414),y=()=>o(171598),h=()=>o(404141),T=()=>o(832651),A=()=>o(270858),_=()=>o(191227),M=()=>o(114282);function F(e){const{fileType:t,spaceId:o,analyticsFrom:r,importLocation:a}=e;T().e.setState({open:!0,currentStep:"uploadFile",fileType:t,fileName:"",fileUrl:"",fileSize:0,isLoading:!1,error:void 0,uploadProgress:0,importLocation:a??{type:"privatePage"},spaceId:o,analyticsFrom:r||"modal"})}async function C(e){const{environment:t,fileUrl:o,signedToken:F,fileName:C,fileType:b,spaceStore:x,spaceViewStore:k,importLocation:P,analyticsFrom:E}=e,V=performance.now();try{T().e.setLoading(!0),T().e.setStep("importing");const e=_().A.getOrCreateFlowId(),r=A().R.getOrCreateImportId(),i=(0,c().JW)();I().fJ(t,{import_source:b,from:E||"modal",import_type:"file",flowId:e,userId:t.currentUser.id,spaceId:x.id});const p=await M().n3({environment:t,spaceStore:x,spaceViewStore:k,uploadType:b,fileCount:1,fileName:C,importLocation:P}),d=(0,l().P)(),u="genericImporter"===b?"file":b;I().Pd(t,{import_source:u,flowId:e,import_instance_id:i});const R="genericImporter"===b&&a().default.checkGate({gateName:"zip_importer_v2_enabled"})?async function*(){const a={fileURL:o,fileName:C,spaceId:p.spaceId,rootPageId:p.pageId,rootTableId:m().evP,signedToken:F,importId:r,flowId:e,userTimeZone:d,importEntryPoint:E||"modal"};I().mM(t,{import_source:u,flowId:e,data:a}),yield*v().UT(t,g().Z,a,{spaceIds:[p.spaceId]})}():(()=>{const a={importType:p.importType,fileURL:o,fileName:C,block:{id:p.pageId,spaceId:p.spaceId},spaceId:p.spaceId,flowId:e,userTimeZone:d,signedToken:F,importEntryPoint:E||"modal",importId:r,importInstanceId:i};return I().mM(t,{import_source:u,flowId:e,data:a}),v().UT(t,f().V,a,{spaceIds:[p.spaceId]})})();for await(const t of R)if(t.error)throw t.error;(0,M().BA)(t,{uploadType:b,importType:p.importType,importLatencies:{overallTimeTaken:performance.now()-V},fileNames:[C]});const L=n().B.createChildStore(x,{table:m().evP,id:p.pageId});S().vH(t,{from:"import",type:"page",new_page_id:L.id,creating_block_id:L.id,parent_collection_id:L.getParentCollectionIdUpToTwoLevels()});const U=(0,w().Ay)({store:L,preferPublicLink:!1,pageVisitSource:s().y8.Import});return(0,y().navigateOnBaseUrl)({environment:t,url:U}),T().e.setStep("completed"),T().e.close({type:"imported"}),h().Ay.reset(),{success:!0,pageId:p.pageId}}catch(R){let e;return e=R instanceof p().mvP&&R.clientData&&"type"in R.clientData&&(0,u().O)(r()._,R.clientData.type)?i().A.formatMessage(r()._[R.clientData.type]):(0,d().A)(R).message,T().e.setError(e),T().e.setLoading(!1),T().e.setStep("uploadFile"),{success:!1,error:e}}}},247402:(e,t,o)=>{o.d(t,{A:()=>r});const r=new(o(118307).A)},290913:(e,t,o)=>{o.d(t,{k:()=>a,w:()=>r});const r=10,a=(0,o(583835).Dv)("multiSpaceConfluenceImportViaApi")},453644:(e,t,o)=>{o.d(t,{Z:()=>r});const r=(0,o(583835).Dv)("zipImporterParent")},490884:(e,t,o)=>{o.d(t,{Hi:()=>p,Sb:()=>l,fF:()=>s,k2:()=>n});o(581454);const r=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12",".docx",".dotx",".docm",".dotm"],a=["text/plain","text/markdown","text/x-markdown",".md",".mdown",".markdown",".mkdn",".mkd",".Rmd",".md.txt",".txt"],i=["text/html",".html",".htm"],n={markdown:a,csv:["text/plain",".csv"],html:i,docx:r,googleDocs:r,dropbox:r,quip:[...i,...a],workflowy:["text/plain"],confluence:["application/zip",".zip"],genericImporter:["application/zip",".zip"],pdf:["application/pdf",".pdf"]},s=Object.keys(n);function l(e){return"markdown"===e||"csv"===e||"html"===e||"docx"===e||"googleDocs"===e||"dropbox"===e||"quip"===e||"workflowy"===e||"confluence"===e||"genericImporter"===e||"pdf"===e}function p(e,t){if(!l(t))return e.toLowerCase()===t.toLowerCase();const o=n[t].flat().map((e=>e.toLowerCase())),r=`.${e.toLowerCase()}`;return o.includes(r)||o.includes(e)}},609316:(e,t,o)=>{o.d(t,{V:()=>r});const r=(0,o(583835).Dv)("importFile")},773248:(e,t,o)=>{o.d(t,{A:()=>r});const r=new(o(118307).A)},832651:(e,t,o)=>{o.d(t,{e:()=>a});class r extends(()=>o(757695))().Store{getInitialState(){return{open:!1}}setFileMetadata(e,t,o,r){this.state.open&&this.setState({...this.state,fileName:e,fileUrl:t,fileSize:o,signedToken:r})}setFile(e){this.state.open&&this.setState({...this.state,file:e})}setLoading(e){this.state.open&&this.setState({...this.state,isLoading:e})}setUploadProgress(e){if(!this.state.open)return;const t=Number.isFinite(e)?Math.min(100,Math.max(0,e)):0,o=0===t?0:this.state.isLoading&&this.state.uploadProgress>0?Math.max(this.state.uploadProgress,t):t;this.setState({...this.state,uploadProgress:o})}setError(e){this.state.open&&this.setState({...this.state,error:e})}setStep(e){this.state.open&&this.setState({...this.state,currentStep:e})}setImportLocation(e){this.state.open&&this.setState({...this.state,importLocation:e})}setSpaceId(e){this.state.open&&this.setState({...this.state,spaceId:e})}close(e){this.setState({...this.getInitialState()})}}const a=new r;(0,o(852832).exposeDebugValue)("fileImporterStore",a)},892232:(e,t,o)=>{o.d(t,{A:()=>r});const r=new(o(118307).A)},971752:(e,t,o)=>{o.d(t,{m:()=>r});const r=(0,o(69708).YK)({csv_import_inconsistent_columns:{id:"csvImportErrors.inconsistentColumns.message",defaultMessage:"Inconsistent number of columns in CSV file, {numBadRows} rows had problems. Header row had {numTitleColumns} columns. Row {firstBadRowIndex} was first inconsistent row with {firstBadRowLength} columns. Parsed row {firstBadRowIndex}: {firstBadRow}"}})}}]);