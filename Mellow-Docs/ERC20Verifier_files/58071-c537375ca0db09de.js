"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[58071],{62246:(e,t,o)=>{o.d(t,{Ju:()=>W,en:()=>G,p6:()=>H});o(898992),o(672577),o(814603),o(147566),o(198721);var n=()=>o(242422),i=()=>o(726637),r=()=>o(908006),a=()=>o(489295),c=()=>o(295633),s=()=>o(732810),d=()=>o(569797),l=()=>o(350013),p=()=>o(683021),m=()=>o(86159),u=()=>o(700500),g=()=>o(304740),v=()=>o(522419),b=()=>o(651784),k=()=>o(179034),f=()=>o(824862),C=()=>o(519831),y=()=>o(869558),I=()=>o(743246),S=()=>o(201980),A=()=>o(496603),M=()=>o(292167),h=()=>o(437219),T=()=>o(769864),w=()=>o(541372),x=()=>o(443120),B=()=>o(896628),_=()=>o(222299),R=()=>o(384944),U=()=>o(391214),L=()=>o(62287),P=()=>o(689355),E=()=>o(97270),F=()=>o(18387),V=()=>o(673477),N=()=>o(129522),D=()=>o(206051),z=()=>o(295304),Z=()=>o(547149),j=()=>o(975728);function G(e){const t=(0,a().zH)(e);return t instanceof c().B&&void 0!==t.getAssociatedCollectionStore()}function H(e){const{environment:t,textStore:o,url:r,oldTextValue:a,urlSelection:c}=e;if(p().Ay.state.open||E().A.state.open||V().Ay.state.open||P().A.state.open||G(o)&&g().Vp({url:r,baseUrl:i().A.domainBaseUrl,publicDomainName:i().A.publicDomainName}))return;const s=m().get();if(!s)return;const d=m().getRect(s);if(!d)return;const l=()=>{P().A.setState({open:!0,willOpen:!1,loading:!1,textStore:o,url:r,oldTextValue:a,urlSelection:c,selectionRect:d}),h().wQ(t,{url:r})},u=n().default.checkGate({gateName:"mobile_embed_menu_cursor_fix"});!t.device.isTablet&&u?(P().A.setState({open:!1,willOpen:!0,loading:!1}),setTimeout(l,0)):l()}async function W(e){const{environment:t,spaceId:o}=e,n=P().A.state;if(n.open){const{url:p,textStore:m,oldTextValue:g}=n,E=D().default.state.stores,V=E[0];if(!V)return;const G=(0,v().Zv)(p)||(0,v().ku)(p,i().A.secureFileConfig.hostname),H=G?(0,v().xm)(G):p,W=(0,b().parseRoute)({url:H,baseUrl:i().A.domainBaseUrl,publicDomainName:i().A.publicDomainName,isMobile:i().A.isMobile,protocol:i().A.protocol,currentUrl:window.location.href});if("agent"===W.name){if("mention-page"===e.type){const e=V.getSpaceStore();if(!e)return;const o=l().N.createChildStore(e,{table:I().C0,id:W.workflowId,spaceId:e.id});await o.load();const i=o.getData(),r=null==i?void 0:i.runtime_actor_pointer;if(r&&r.table===f().GP){const e=r.id;await Z().createAndCommitAsync({environment:t,userAction:"embedMenuActions.mentionAgent",waitForServerCommit:!1,perform:o=>(z().Gf({environment:t,editorMode:"default",store:m,selection:n.urlSelection,annotation:S().Vb6(e),transaction:o,analyticsFrom:"block"}),Promise.resolve())})}return}return void(e.type===u().xd.workflow&&await Z().createAndCommitAsync({environment:t,userAction:"embedMenuActions.embedWorkflowChatInputBlock",waitForServerCommit:!1,perform:e=>{var o;z().R9({environment:t,store:m,value:g,transaction:e});const n=R().Wv({environment:t,type:u().xd.workflow,inMemoryRecordCache:V.inMemoryRecordCache,transaction:e,spaceId:0!==E.length?E[E.length-1].pointer.spaceId:null===(o=(0,F().Z)())||void 0===o?void 0:o.pointer.spaceId,format:{workflow_id:W.workflowId,workflow_block_display:"chat_input"}});return U().LE({environment:t,blocksToInsert:[n],target:E,transaction:e,replaceEmptyTextBlock:!0}),r().default.afterNextFlush((()=>{Z().createAndCommit({userAction:"embedMenuActions.accept",environment:t,canUndo:!0,perform:e=>{U().um({blocks:E,transaction:e})}})})),Promise.resolve()}}))}if((0,b().Jx)(W))await Z().createAndCommitAsync({environment:t,userAction:"embedMenuActions.embedPageAlias",waitForServerCommit:!1,perform:async o=>{let i;if(z().R9({environment:t,store:m,value:g,transaction:o}),W.peekViewBlockId){const e=c().B.createChildStore(m,{table:k().ev,id:W.peekViewBlockId});await e.load(),e.isPageBlock()&&(i=e)}if(!i&&"page"===W.name&&W.blockId&&(i=c().B.createChildStore(m,{table:k().ev,id:W.blockId})),i){const c="page"===W.name?W.scrollToBlockId:void 0,s="page"===W.name?W.collectionViewId:void 0;if("mention-page"===e.type){const e=i.getRecordModel({id:i.id,table:k().ev});z().Gf({environment:t,editorMode:"default",store:m,selection:{startIndex:n.urlSelection.startIndex,endIndex:n.urlSelection.startIndex},annotation:S().ld4(c??i.id,null==e?void 0:e.space_id),transaction:o,analyticsFrom:"block"})}else if("create-transclusion"===e.type){if(!c)return;w().Ce({environment:t,blocks:D().default.state.stores,copiedBlockIds:[c]})}else if(i.isCollectionView()){var a;const e=s?d().p.createChildStore(i,{table:y().Gy,id:s}):void 0;await Promise.all([i.load(),e?e.load():void 0]);const n=e?e.getCollectionStore():null===(a=i.getCollectionViewStores())||void 0===a||null===(a=a[0])||void 0===a?void 0:a.getCollectionStore();n&&(await n.load(),_().oT({environment:t,store:V,collectionStore:n,collectionViewStore:e,transaction:o}))}else{const n=V.getParentBlockStore();if(n){const r=M().s({environment:t,parentBlockStore:n,targetStore:i,transaction:o});U().LE({environment:t,blocksToInsert:[r],target:E,transaction:o,replaceEmptyTextBlock:!0}),"form"===e.type&&(D().default.reset(),h().ol(t,{url:p,type:e.type,form_id:i.id,block_id:r.id}))}}r().default.afterNextFlush((()=>{Z().createAndCommit({userAction:"embedMenuActions.accept",environment:t,canUndo:!0,perform:e=>{U().um({blocks:E,transaction:e})}})}))}}});else if("collection"===W.name){if("mention-page"===e.type)Z().createAndCommit({environment:t,canUndo:!0,userAction:"embedMenuActions.embedCollectionMention",perform:e=>{z().R9({environment:t,store:m,value:g,transaction:e});const o=W.space&&"id"in W.space?W.space.id:void 0;z().Gf({environment:t,editorMode:"default",store:m,selection:{startIndex:n.urlSelection.startIndex,endIndex:n.urlSelection.startIndex},annotation:S().ETy({collectionId:W.collectionId,spaceId:o,parentCvbId:W.parentBlockId}),transaction:e,analyticsFrom:"collection"})}});else if(e.type===u().xd.collectionView){const e=W.space&&"id"in W.space?W.space.id:V.getSpaceId(),o=s().m.createChildStore(m,{table:C().Vl,id:W.collectionId,spaceId:e});await o.load(),o.isDefined()&&Z().createAndCommit({environment:t,canUndo:!0,userAction:"embedMenuActions.embedCollectionLinkedView",perform:e=>{z().R9({environment:t,store:m,value:g,transaction:e}),_().oT({environment:t,store:V,collectionStore:o,collectionViewStore:void 0,transaction:e})}})}}else if(e.type===u().xd.bookmark||"teamsInvite"===W.name){const{performResult:e}=Z().createAndCommit({userAction:"embedMenuActions.insertedBlocks",environment:t,canUndo:!0,perform:e=>{var o;z().R9({environment:t,store:m,value:g,transaction:e});const n=R().Wv({environment:t,type:u().xd.bookmark,inMemoryRecordCache:V.inMemoryRecordCache,transaction:e,spaceId:0!==E.length?E[E.length-1].pointer.spaceId:null===(o=(0,F().Z)())||void 0===o?void 0:o.pointer.spaceId}),i=U().LE({environment:t,blocksToInsert:[n],target:E,transaction:e,replaceEmptyTextBlock:!0});return B().zA({stores:[n],transaction:e,update:{bookmark_loading_ttl:Date.now()}}),i}});r().default.afterNextFlush((()=>{Z().createAndCommit({userAction:"embedMenuActions.accept",environment:t,canUndo:!0,perform:e=>{U().um({blocks:E,transaction:e})}})}));const o=e[0];"teamsInvite"===W.name?await x().Ht({environment:t,store:o,url:p,teamId:W.teamId}):await x().Ht({environment:t,store:o,url:p})}else if(e.type===u().xd.drive){const{performResult:e}=Z().createAndCommit({userAction:"embedMenuActions.insertedBlocks",environment:t,canUndo:!0,perform:e=>{var o;z().R9({environment:t,store:m,value:g,transaction:e});const n=R().Wv({environment:t,type:u().xd.drive,inMemoryRecordCache:V.inMemoryRecordCache,transaction:e,spaceId:0!==E.length?E[E.length-1].pointer.spaceId:null===(o=(0,F().Z)())||void 0===o?void 0:o.pointer.spaceId});return U().LE({environment:t,blocksToInsert:[n],target:E,transaction:e,replaceEmptyTextBlock:!0})}});r().default.afterNextFlush((()=>{Z().createAndCommit({userAction:"embedMenuActions.accept",environment:t,canUndo:!0,perform:e=>{U().um({blocks:E,transaction:e})}})}));const o=e[0];r().default.afterNextFlush((()=>{const e=N().K.find((e=>e.getBlockStore()===o));e&&e.initializeGoogleDriveBlockFromUrl(p)}))}else if("link-mention"===e.type){P().A.setState({open:!1,willOpen:!1,loading:!0});const e=await T().callApi({eventName:"getDataForLinkMention",environment:t,data:{url:H,spaceId:o,source:"link_mention_activate"}});if("success"===e.type){const o=e.data;if("error"in o){const e=S().wmz(S().gru({href:p,title:p.includes("mailto:")?p:new URL(p).hostname}));Z().createAndCommit({environment:t,userAction:"embedMenuActions.mention",canUndo:!0,perform:o=>{z().jQ({environment:t,store:m,selection:{startIndex:n.urlSelection.startIndex,endIndex:n.urlSelection.endIndex},transaction:o}),z().yr({environment:t,store:m,tokens:[e],index:n.urlSelection.startIndex,transaction:o})}}),h().vt(t,{domain:p.includes("mailto:")?p:new URL(p).hostname})}else{var a;const{title:e,description:i,author_name:r,provider_name:c,images:s,favicon_url:d,iframe:l,height:u,padding:g,padding_top:v}=o,b=S().wmz(S().gru({href:p,title:e||(c||new URL(p).hostname),description:i,link_author:r,link_provider:c,thumbnail_url:s&&s.length>0?null===(a=s[0])||void 0===a?void 0:a.url:void 0,icon_url:d,iframe_url:p.includes("nytimes.com")?void 0:l,height:u,padding:g,padding_top:v}));Z().createAndCommit({environment:t,userAction:"embedMenuActions.mention",canUndo:!0,perform:e=>{z().jQ({environment:t,store:m,selection:{startIndex:n.urlSelection.startIndex,endIndex:n.urlSelection.endIndex},transaction:e}),z().yr({environment:t,store:m,tokens:[b],index:n.urlSelection.startIndex,transaction:e})}})}}else{const e=S().wmz(S().gru({href:p,title:p.includes("mailto:")?p:new URL(p).hostname}));Z().createAndCommit({environment:t,userAction:"embedMenuActions.mention",canUndo:!0,perform:o=>{z().jQ({environment:t,store:m,selection:{startIndex:n.urlSelection.startIndex,endIndex:n.urlSelection.endIndex},transaction:o}),z().yr({environment:t,store:m,tokens:[e],index:n.urlSelection.startIndex,transaction:o})}}),h().vt(t,{domain:p.includes("mailto:")?p:new URL(p).hostname})}}else{const{performResult:o}=Z().createAndCommit({userAction:"embedMenuActions.insertedBlocks",environment:t,canUndo:!0,perform:e=>{var o;z().R9({environment:t,store:m,value:g,transaction:e});const n=R().Wv({environment:t,type:u().xd.copyIndicator,inMemoryRecordCache:V.inMemoryRecordCache,transaction:e,spaceId:0!==E.length?E[E.length-1].pointer.spaceId:null===(o=(0,F().Z)())||void 0===o?void 0:o.pointer.spaceId});return U().LE({environment:t,blocksToInsert:[n],target:E,transaction:e,replaceEmptyTextBlock:!0})}});r().default.afterNextFlush((()=>{Z().createAndCommit({userAction:"embedMenuActions.accept",environment:t,canUndo:!0,perform:e=>{U().um({blocks:E,transaction:e})}})}));const n=o[0],i=o=>{Z().createAndCommit({environment:t,userAction:"embedMenuActions.accept.insertExtractedData",canUndo:!0,perform:t=>{let i;e.type&&"mention-page"!==e.type&&"create-transclusion"!==e.type&&"link-mention"!==e.type&&"jira-sync"!==e.type?i=e.type:(i=u().xd.embed,null!=o&&o.media&&("photo"===o.media.type?i=u().xd.image:"video"===o.media.type&&(i=u().xd.video))),L().pd({environment:e.environment,block:n,blockType:i,transaction:t})}}),r().default.afterNextFlush((()=>{const e=N().K.find((e=>e.getBlockStore()===n&&A().Tn(e.embed)));e&&e.embed({originUrl:H,pastedSecureFile:G})}))};j().DB(H).then(i)}}(0,P().V)()}},84349:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){return{open:!1}}}const i=new n},121946:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){return{active:!1,stringValue:"",manualCopyMessage:void 0,manualCopyMessageValues:void 0}}}const i=new n},486547:(e,t,o)=>{o.r(t),o.d(t,{clipboardMessages:()=>n});const n=(0,o(69708).YK)({copiedQnAMessageToClipboard:{id:"action.copiedQnAMessageToClipboard",defaultMessage:"Copied response to clipboard"},copiedHumanMessageToClipboard:{id:"action.copiedHumanMessageToClipboard",defaultMessage:"Copied your message to clipboard"},copiedEmailToClipboard:{id:"action.copiedEmailToClipboard.snackBarMessage",defaultMessage:"Copied email to clipboard"},copiedUserIdToClipboard:{id:"action.copiedUserIdToClipboard.snackBarMessage",defaultMessage:"Copied user ID to clipboard"},copiedLinkToClipboard:{id:"action.copiedLinkToClipboard.snackBarMessage",defaultMessage:"Copied link to clipboard"},copiedPageLinkToClipboard:{id:"action.copiedPageLinkToClipboard.snackBarMessage",defaultMessage:"Copied page link to clipboard"},copiedPageLinkToClipboardAndShare:{id:"action.copiedPageLinkToClipboardAndShare.snackBarMessage",defaultMessage:"Copied! This page is now public and ready to share"},copiedPageContentsToClipboard:{id:"action.copiedPageContentsToClipboard.snackBarMessage",defaultMessage:"Copied page contents"},copiedFormLinkToClipboard:{id:"action.copiedFormLinkToClipboard.snackBarMessage",defaultMessage:"Copied form link to clipboard"},copiedTeamHomeLinkToClipboard:{id:"action.copiedTeamHomeLinkToClipboard.snackBarMessage",defaultMessage:"Copied page link to clipboard"},copiedBlockLinkToClipboard:{id:"action.copiedBlockLinkToClipboard.snackBarMessage",defaultMessage:"Copied block link to clipboard"},copiedLinksToClipboard:{id:"action.copiedLinksToClipboard.snackBarMessage",defaultMessage:"Copied links to clipboard"},copiedPropertyToClipboard:{id:"action.copiedPropertyToClipboard.snackBarMessage",defaultMessage:"Copied property to clipboard"},copiedCodeToClipboard:{id:"action.copiedCodeToClipboard.snackBarMessage",defaultMessage:"Copied code to clipboard"},copiedTokenToClipboard:{id:"action.copiedTokenToClipboard.snackBarMessage",defaultMessage:"Copied token to clipboard"},copiedToClipboard:{id:"action.copiedToClipboard.snackBarMessage",defaultMessage:"Copied to clipboard"},copiedApiObjectToClipboard:{id:"action.copiedApiObjectToClipboard.snackBarMessage",defaultMessage:"Copied API object to clipboard"},copiedImageToClipboard:{id:"action.copiedImageToClipboard.snackBarMessage",defaultMessage:"Copied image to clipboard"},copyingImage:{id:"action.copyingImage.snackBarMessage",defaultMessage:"Copying..."},copyImageError:{id:"action.copyImageError.snackBarMessage",defaultMessage:"Failed to copy image to clipboard"},copiedPageToClipboard:{id:"action.copiedPageToClipboard.snackBarMessage",defaultMessage:"Copied page to clipboard"},clipboardAccessDenied:{id:"action.clipboardAccessDenied.snackBarMessage",defaultMessage:"Clipboard access denied. Please check your browser permissions."},copyPageContentsError:{id:"action.copyPageContentsError.snackBarMessage",defaultMessage:"Could not copy page contents."}})},541372:(e,t,o)=>{o.d(t,{Ce:()=>N,GV:()=>V,T_:()=>_,Tw:()=>B,VN:()=>R,Xw:()=>F,ei:()=>L,gi:()=>w,h8:()=>P});o(16280),o(18107),o(967357),o(898992),o(823215),o(581454),o(737550);var n=()=>o(564884),i=()=>o(726637),r=()=>o(295633),a=()=>o(584262),c=()=>o(700500),s=()=>o(921940),d=()=>o(696706),l=()=>o(179034),p=()=>o(201980),m=()=>o(496603),u=()=>o(534177),g=()=>o(383070),v=()=>o(18387),b=()=>o(989616),k=()=>o(747674),f=()=>o(836724),C=()=>o(84349),y=()=>o(77246),I=()=>o(295304),S=()=>o(547149),A=()=>o(292167),M=()=>o(44729),h=()=>o(384944),T=()=>o(391214);function w(e){const{environment:t,blocks:o,copiedStores:i,pageSource:r}=e,a=o.at(-1);if(!a)return;const c=f().T.getRectFromStore(a);c&&(C().A.setState({open:!0,type:"blocks",blocks:o,rect:c,copiedStores:i,pageSource:r}),(0,n().u)({environment:t,event:{eventName:"block_paste_menu_opened",eventProperties:{type:"blocks"}}}))}const x=250;function B(e){if(!g().zD.areAiActionsOnPasteEnabled())return!1;const{blocks:t,environment:o}=e;if(o.device.isMobileNative)return!1;if(!t.some((e=>e.isAiFollowupEligibleBlock())))return!1;if((0,b().R)(t,!0).length<x)return!1;const i=t.at(0);if(!i)return!1;const r=f().T.getRectFromStore(i);return!!r&&(C().A.setState({open:!0,type:"ai_actions",blocks:t,rect:r}),(0,n().u)({environment:o,event:{eventName:"block_paste_menu_opened",eventProperties:{type:"ai_actions"}}}),!0)}function _(e){const{environment:t,blocks:o,copiedLinks:i,rootStore:r}=e;if(o.length!==i.length)return!1;if(!o.every(U))return!1;if(i.some((e=>e.blockId===r.id)))return!1;const a=o.at(-1);if(!a)return!1;const c=f().T.getRectFromStore(a);return!!c&&(C().A.setState({open:!0,type:"links",blocks:o,rect:c,copiedLinks:i}),(0,n().u)({environment:t,event:{eventName:"block_paste_menu_opened",eventProperties:{type:"links"}}}),!0)}function R(e){C().A.state.open&&(0,n().u)({environment:e,event:{eventName:"block_paste_menu_closed",eventProperties:{type:C().A.state.type}}}),C().A.setState({open:!1})}function U(e){return!(e.isType(c().xd.copyIndicator)||e.isTransclusionType()||e.isInsideCollection())}function L(e){const{blocks:t,pageSource:o,wasContiguousSelection:n,action:i,rootStore:r,copiedStores:a}=e,s=y().Uv.getMode(t[0]);return"copy"===i&&n&&!(0,d().Z2)(o,r.pointer)&&(P(e)||V({currentSpaceId:r.getSpaceId(),...e}))&&t.every(U)&&!a.every((e=>e.getType()===c().xd.externalObjectInstance))&&"suggest"!==s}function P(e){const{blocks:t}=e;return 1===t.length}function E(e){const{transaction:t,blockUrl:o,spaceId:n,environment:i}=e,r=h().Wv({environment:i,type:c().xd.text,inMemoryRecordCache:i.defaultRecordCache.inMemoryRecordCache,transaction:t,spaceId:n}),a=(0,p().xV3)(o),s=[(0,p().Ey_)(a,[(0,p().Sez)(a)],{skipSanitization:!0})];return I().R9({environment:i,store:r.getBlockTitleStore(),value:s,transaction:t}),r}async function F(e){const{environment:t,blocks:o,source:n}=e,c=o[0];if(!c)return;const d=c.getParentBlockStore();if(!d)return;const p=c.getContentStore();let g;await S().createAndCommitAsync({environment:t,userAction:"blockPasteMenuActions.acceptLinkToPage",waitForServerCommit:!0,perform:async e=>{if("blocks"===n.type){const{copiedStores:o,pageSource:m}=n,u=c,v=o[0];if(!u||!v)return;const b=r().B.createChildStore(p,{table:l().ev,id:v.id});if(b.isNavigableBlock())await b.load(),g=[A().s({environment:t,parentBlockStore:d,targetStore:b,transaction:e})];else{const o=(0,s().A)({pageId:m.id,scrollToBlockId:b.id,baseUrl:i().A.domainBaseUrl,pageVisitSource:a().y8.LinkInPage});g=[E({blockUrl:o,spaceId:c.getSpaceId(),environment:t,transaction:e})]}}else if("links"===n.type){const{copiedLinks:u}=n;if(u.length!==o.length)return;g=(0,m().oE)(await Promise.all(u.map((async o=>{const n=o.scrollToBlockId||o.peekViewBlockId||o.blockId;if(n){const m=r().B.createChildStore(p,{table:l().ev,id:n});if(await m.load(),m.isNavigableBlock())return A().s({environment:t,parentBlockStore:d,targetStore:m,transaction:e});{const n=o.peekViewBlockId||o.blockId;if(n){const o=r().B.createChildStore(p,{table:l().ev,id:n});await o.load();return E({blockUrl:(0,s().A)({pageId:n,pageModel:o.getModel(),scrollToBlockId:m.id,baseUrl:i().A.domainBaseUrl,pageVisitSource:a().y8.LinkInPage}),spaceId:c.getSpaceId(),environment:t,transaction:e})}}}}))))}else(0,u().HB)(n);const v=T().LE({environment:t,blocksToInsert:g,target:o,replaceEmptyTextBlock:!0,transaction:e});T().ZL({environment:t,blocks:o,transaction:e}),(0,k().t)({environment:t,stores:v}),R(t)}})}function V(e){const{currentSpaceId:t,blocks:o,copiedStores:n}=e;return o.length>0&&!n.some((e=>e.isInsideCollection()))&&n.every((e=>e.canEdit()))&&n.every((e=>e.getSpaceId()===t))}async function N(e){const{environment:t,blocks:o,copiedBlockIds:n,removeBlocks:i}=e,a=await Promise.all(n.map((async e=>{const t=r().B.createChildStore(o[0],{table:l().ev,id:e});await t.load();const n=t.getParentBlockStore();if(!n)throw new Error("Block has no parent.");await n.load();const i=n.getContentStore();return{store:r().B.createChildStore(i,{table:l().ev,id:e}),parentStore:n,parentContentStore:i}}))),s=a[0];if(!s)return;const d=(0,v().Z)();if(!d)return;const{serverCommitResult:p}=S().createAndCommit({userAction:"blockPasteMenuActions.acceptCreateTransclusion",environment:t,canUndo:!0,perform:e=>{let n;if(s.store.getType()===c().xd.transclusionContainer)n=s.store;else if(s.store.getType()===c().xd.transclusionReference){const e=s.store.getTransclusionReferenceTargetStore();if(!e)throw new Error("Could not find transclusion reference target");n=e}else if(s.parentStore.getType()===c().xd.transclusionContainer)n=s.parentStore;else{n=h().Wv({environment:t,type:c().xd.transclusionContainer,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:e,spaceId:s.store.pointer.spaceId});const o=n.getContentStore();M().Br({parentStore:s.parentContentStore,oldChildStore:s.store,newChildStore:n,transaction:e});for(const{store:t}of a)M().NI({parentStore:o,childStore:t,transaction:e})}const r=h().Wv({environment:t,type:c().xd.transclusionReference,format:{transclusion_reference_pointer:n.pointer},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:e,spaceId:0!==o.length?o[o.length-1].pointer.spaceId:d.pointer.spaceId}),l=T().LE({environment:t,blocksToInsert:[r],target:o,transaction:e,replaceEmptyTextBlock:!0});(0,k().t)({environment:t,stores:l}),i&&T().ZL({environment:t,blocks:o,transaction:e}),R(t)}});await p}}}]);