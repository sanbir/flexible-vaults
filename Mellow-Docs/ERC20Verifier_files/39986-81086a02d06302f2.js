"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[39986],{44738:(e,t,n)=>{n.d(t,{y:()=>ue,_:()=>ie});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(430670),n(581454),n(737550);var r=()=>n(763824),o=()=>n(534177),a=()=>n(898244),s=()=>n(696706),i=()=>n(179034),u=()=>n(519831),p=()=>n(797809),l=()=>n(247331),d=()=>n(349835),c=()=>n(239381);class y{constructor(e,t){this.root=void 0,this._nodeCount=void 0;const r=t??this.countNodes(e);if(r>100){const t=this.simplifyNode(e),o=this.countNodes(t);o>100?(n(165358).log({level:"info",from:"ExistenceGuarantees",type:"formulaTypecheckComplexityBailout",data:{miscDataToConvertToString:{nodeCount:r,simplifiedNodeCount:o,maxNodeCount:100}}}),this.root={type:"assumeAllExist"},this._nodeCount=1):(this.root=t,this._nodeCount=o)}else this.root=e,this._nodeCount=r}static empty(){return new y({type:"empty"},1)}static impossible(){return new y({type:"impossible"},1)}static fromProperty(e,t){return new y({type:"leaf",propertyId:e,value:t},1)}static fromMap(e){if(!e||0===e.size)return y.empty();const t=Array.from(e.entries());let n={type:"leaf",propertyId:t[0][0],value:t[0][1]};for(let o=1;o<t.length;o++)n={type:"and",left:n,right:{type:"leaf",propertyId:t[o][0],value:t[o][1]}};const r=2*t.length-1;return new y(n,r)}get(e){return this.getFromNode(this.root,e)}and(e){if(this.isEmpty())return e;if(e.isEmpty())return this;const t=1+this._nodeCount+e._nodeCount;return new y({type:"and",left:this.root,right:e.root},t)}or(e){if(this.isEmpty())return e;if(e.isEmpty())return this;const t=1+this._nodeCount+e._nodeCount;return new y({type:"or",left:this.root,right:e.root},t)}not(){const e=1+this._nodeCount;return new y({type:"not",child:this.root},e)}isEmpty(){return"empty"===this.root.type}isImpossible(){return"impossible"===this.root.type}toMap(){const e=new Map;if(this.extractConjunctionToMap(this.root,e))return e.size>0?e:void 0}*entries(){const e=new Set;yield*this.collectLeafEntries(this.root,e)}*collectLeafEntries(e,t){switch(e.type){case"empty":case"impossible":break;case"leaf":t.has(e.propertyId)||(t.add(e.propertyId),yield[e.propertyId,e.value]);break;case"and":yield*this.collectLeafEntries(e.left,t),yield*this.collectLeafEntries(e.right,t);break;case"or":{const n=new Map,r=new Map;for(const[t,o]of this.collectLeafEntries(e.left,new Set))n.set(t,o);for(const[t,o]of this.collectLeafEntries(e.right,new Set))r.set(t,o);for(const[e,o]of n){if(t.has(e))continue;const n=r.get(e);void 0!==n&&n===o&&(t.add(e),yield[e,o])}}break;case"not":if("and"===e.child.type)break;if("or"===e.child.type){for(const[n,r]of this.collectLeafEntries(e.child.left,new Set))t.has(n)||(t.add(n),"boolean"==typeof r?yield[n,!r]:yield[n,r]);for(const[n,r]of this.collectLeafEntries(e.child.right,new Set))t.has(n)||(t.add(n),"boolean"==typeof r?yield[n,!r]:yield[n,r])}else for(const[n,r]of this.collectLeafEntries(e.child,new Set))t.has(n)||(t.add(n),"boolean"==typeof r?yield[n,!r]:yield[n,r])}}toString(){return this.nodeToString(this.root)}getFromNode(e,t){switch(e.type){case"empty":case"impossible":return;case"assumeAllExist":return!0;case"leaf":return e.propertyId===t?e.value:void 0;case"and":{if(this.hasContradictionInAnd(e))return;const n=this.getFromNode(e.left,t),r=this.getFromNode(e.right,t);return void 0!==n&&void 0!==r?n===r?n:void 0:n??r}case"or":{const n=this.getFromNode(e.left,t),r=this.getFromNode(e.right,t);return void 0!==n&&void 0!==r&&n===r?n:void 0}case"not":{const n=e.child;if("and"===n.type)return;if("or"===n.type){const e=this.getFromNode(n.left,t),r=this.getFromNode(n.right,t);return void 0!==e&&void 0!==r&&"boolean"==typeof e&&"boolean"==typeof r?e===r?!e:void 0:void 0!==e&&"boolean"==typeof e?!e:void 0!==r&&"boolean"==typeof r?!r:void 0}if("not"===n.type)return this.getFromNode(n.child,t);const r=this.getFromNode(n,t);if(void 0===r)return;return"boolean"==typeof r?!r:"unknown"}}}simplifyNode(e){switch(e.type){case"empty":case"impossible":case"leaf":case"assumeAllExist":return e;case"and":{const t=this.simplifyNode(e.left),n=this.simplifyNode(e.right);if("impossible"===t.type||"impossible"===n.type)return{type:"impossible"};if("empty"===t.type)return n;if("empty"===n.type)return t;if(this.nodesEqual(t,n))return t;const r={type:"and",left:t,right:n};return this.hasContradictionInAnd(r)?{type:"impossible"}:r}case"or":{const t=this.simplifyNode(e.left),n=this.simplifyNode(e.right);return"impossible"===t.type?n:"impossible"===n.type?t:"empty"===t.type?n:"empty"===n.type?t:this.areContradictory(t,n)?{type:"empty"}:this.nodesEqual(t,n)?t:{type:"or",left:t,right:n}}case"not":{const t=this.simplifyNode(e.child);switch(t.type){case"empty":return{type:"impossible"};case"impossible":return{type:"empty"};case"leaf":return"boolean"==typeof t.value?{type:"leaf",propertyId:t.propertyId,value:!t.value}:t;case"and":return this.simplifyNode({type:"or",left:{type:"not",child:t.left},right:{type:"not",child:t.right}});case"or":return this.simplifyNode({type:"and",left:{type:"not",child:t.left},right:{type:"not",child:t.right}});case"not":return t.child;case"assumeAllExist":return t}}}}hasContradictionInAnd(e){const t=[];this.collectAndLeaves(e,t);for(let n=0;n<t.length;n++)for(let e=n+1;e<t.length;e++)if(t[n].propertyId===t[e].propertyId&&"boolean"==typeof t[n].value&&"boolean"==typeof t[e].value&&t[n].value!==t[e].value)return!0;return!1}collectAndLeaves(e,t){switch(e.type){case"leaf":t.push({propertyId:e.propertyId,value:e.value});break;case"and":this.collectAndLeaves(e.left,t),this.collectAndLeaves(e.right,t)}}areContradictory(e,t){return!("not"!==t.type||!this.nodesEqual(e,t.child))||(!("not"!==e.type||!this.nodesEqual(e.child,t))||"leaf"===e.type&&"leaf"===t.type&&e.propertyId===t.propertyId&&"boolean"==typeof e.value&&"boolean"==typeof t.value&&e.value!==t.value)}nodesEqual(e,t){if(e.type!==t.type)return!1;switch(e.type){case"empty":case"impossible":case"assumeAllExist":return!0;case"leaf":return"leaf"===t.type&&e.propertyId===t.propertyId&&e.value===t.value;case"and":case"or":return("and"===t.type||"or"===t.type)&&(this.nodesEqual(e.left,t.left)&&this.nodesEqual(e.right,t.right)||this.nodesEqual(e.left,t.right)&&this.nodesEqual(e.right,t.left));case"not":return"not"===t.type&&this.nodesEqual(e.child,t.child)}}extractConjunctionToMap(e,t){switch(e.type){case"empty":return!0;case"impossible":case"assumeAllExist":case"or":case"not":return!1;case"leaf":const n=t.get(e.propertyId);return(void 0===n||n===e.value)&&(t.set(e.propertyId,e.value),!0);case"and":return this.extractConjunctionToMap(e.left,t)&&this.extractConjunctionToMap(e.right,t)}}nodeToString(e){switch(e.type){case"empty":return"⊤";case"impossible":return"⊥";case"assumeAllExist":return"∀∃";case"leaf":{const t=!1===e.value?"!":"",n="unknown"===e.value?"?":"";return`${t}${e.propertyId}${n}`}case"and":{const t=this.nodeToString(e.left),n=this.nodeToString(e.right);return`${"or"===e.left.type||"not"===e.left.type?`(${t})`:t} ∧ ${"or"===e.right.type||"not"===e.right.type?`(${n})`:n}`}case"or":{const t=this.nodeToString(e.left),n=this.nodeToString(e.right);return`${"and"===e.left.type?`(${t})`:t} ∨ ${"and"===e.right.type?`(${n})`:n}`}case"not":{const t=this.nodeToString(e.child);return`¬${"and"===e.child.type||"or"===e.child.type||"not"===e.child.type?`(${t})`:t}`}}}countNodes(e){switch(e.type){case"empty":case"impossible":case"leaf":case"assumeAllExist":return 1;case"not":return 1+this.countNodes(e.child);case"and":case"or":return 1+this.countNodes(e.left)+this.countNodes(e.right)}}}function m(e){if(e)return e instanceof Map?y.fromMap(e):e}function f(e,t){return e.kind===d().NM.NotionToken&&e.token.type===l().FormulaTokenType.ContextValue?`${e.token.valueId}:${t}`:e.kind===d().NM.Identifier?`let_var_${e.text}:${t}`:void 0}function h(e,t){if(!e&&!t)return;if(!e)return t;if(!t)return e;const n=e.or(t);return n.isEmpty()||n.isImpossible()?void 0:n}function v(e,t){if(!e&&!t)return;if(!e)return t;if(!t)return e;const n=e.and(t);return n.isEmpty()?void 0:n}function x(e){if(!e)return;const t=e.not();return t.isEmpty()?void 0:t}const g="relation:",b="let_var_current:";function k(e,t){return`${g}${e}:${t}`}function T(e,t){if(!e||e.isEmpty())return;const n=`${g}${t}:`;let r;for(const[o,a]of e.entries())if(o.startsWith(n)){const e=o.slice(n.length),t=y.fromProperty(e,a);r=r?r.and(t):t}return r}function w(e){if(e.kind===d().NM.NotionToken){const t=e.token;let n;if(t.type===l().FormulaTokenType.ContextValue?n=t.valueId:t.type===l().FormulaTokenType.BlockProperty&&(n=t.property),n)return y.fromProperty(n,!0)}else if(e.kind===d().NM.MemberBlockProperty){const t=e.propertyToken.property,n=f(e.expression,t);if(n)return y.fromProperty(n,!0)}else if(e.kind===d().NM.Unary){let t=e,n=0;for(;t.kind===d().NM.Unary&&("!"===t.op||"not"===t.op);)n++,t=t.expression;const r=w(t);if(r)return n%2==0?r:r.not()}else if(e.kind===d().NM.Call){const t=e.expression;if(t.kind===d().NM.Identifier&&"not"===t.text&&1===e.arguments.length){const t=w(e.arguments[0]);if(t)return t.not()}else if(t.kind===d().NM.UnifiedFunctionProperty&&"not"===t.name){const e=w(t.expression);if(e)return e.not()}}}const M=new Set(["filter","map","flatMap","find","findIndex","some","every","sort"]),N=new Set(["filter","find","findIndex"]);function E(e){const{node:t,expressionNode:n,context:r,addExistenceGuaranteesToFormulaASTTypes:o,expressionGuarantees:a}=e,s="function"===n.type.type?n.type.libraryFunction:void 0;if(null==s||!s.name||!M.has(s.name))return;const i=function(e){const t="function"===e.type.type?e.type.boundTargetType:void 0;if("array"===(null==t?void 0:t.type))return t.sourceRelationPropertyId}(n);if(!i)return;const u=t.arguments[0];if(!u)return;const p=m(r.existenceGuarantees),l=a?p?p.and(a):a:p,d=function(e,t){if(!e||e.isEmpty())return e;const n=`${g}${t}:`;let r=e;for(const[o,a]of e.entries())if(o.startsWith(n)){const e=o.slice(n.length),t=`${b}${e}`;r=r.and(y.fromProperty(t,a))}return r}(l,i),c=o(u,{...r,existenceGuarantees:d}),f=[],h=[...c.errors];for(let y=1;y<t.arguments.length;y++){const e=o(t.arguments[y],r);f.push(e.node),h.push(...e.errors)}let x;if(N.has(s.name)){const e=v(w(c.node),c.existenceGuarantees);e&&(x=function(e,t,n){if(!t||t.isEmpty())return;let r;for(const[o,a]of t.entries())if(o.startsWith(b)){const t=null==e?void 0:e.get(o);if(void 0===t||t!==a){const e=k(n,o.slice(b.length)),t=y.fromProperty(e,a);r=r?r.and(t):t}}return r}(d,e,i))}const T=v(l,x);return{node:{...t,expression:n,arguments:[c.node,...f],exists:!0},errors:h,existenceGuarantees:T}}n(16280);function I(e){if(e.kind!==d().NM.Identifier)throw new Error("Expected identifier node");return`let_var_${e.text}`}function C(e,t){var n;if(e.kind!==d().NM.Identifier)return;const r=I(e);return null===(n=t.variableConditionalGuarantees)||void 0===n?void 0:n.get(r)}function R(e,t,n){return t.existenceGuarantees?n?t.existenceGuarantees:x(t.existenceGuarantees):m(e)}function A(e,t){const n=m(e),r=n?n.and(t):t,o=x(t);return{trueGuarantees:r,falseGuarantees:n&&o?n.and(o):n??o??y.empty()}}function P(e,t){const n=function(e,t){var n;if(e.kind!==d().NM.Identifier)return;const r=I(e);return null===(n=t.variableConditionalGuarantees)||void 0===n?void 0:n.get(r)}(t.node,e);if(n){const{trueGuarantees:t,falseGuarantees:r}=A(e.existenceGuarantees,n);return{trueGuarantees:t,falseGuarantees:r,directPropertyGuarantees:void 0}}if(t.existenceGuarantees&&!t.existenceGuarantees.isEmpty()){if(t.node.kind!==d().NM.Identifier){const{trueGuarantees:n,falseGuarantees:r}=A(e.existenceGuarantees,t.existenceGuarantees);return{trueGuarantees:n,falseGuarantees:r,directPropertyGuarantees:void 0}}{const n=I(t.node),r=t.existenceGuarantees.toMap();if(!(void 0!==r&&1===r.size&&r.has(n))){const{trueGuarantees:n,falseGuarantees:r}=A(e.existenceGuarantees,t.existenceGuarantees);return{trueGuarantees:n,falseGuarantees:r,directPropertyGuarantees:void 0}}}}if(t.node.kind===d().NM.Identifier){const n=I(t.node),r=y.fromProperty(n,!0),{trueGuarantees:o,falseGuarantees:a}=A(e.existenceGuarantees,r);return{trueGuarantees:o,falseGuarantees:a,directPropertyGuarantees:void 0}}const r=w(t.node);let o,a;return r?(o=r,a=x(r)):(o=R(e.existenceGuarantees,t,!0),a=R(e.existenceGuarantees,t,!1)),{trueGuarantees:o,falseGuarantees:a,directPropertyGuarantees:r}}function F(e,t){return e===t?e:"unknown"}function S(e,t,n,r,o){const a=o(e,r),{trueGuarantees:s,falseGuarantees:i,directPropertyGuarantees:u}=P(r,a);return{conditionResult:a,trueBranchResult:o(t,{...r,existenceGuarantees:s}),falseBranchResult:n?o(n,{...r,existenceGuarantees:i}):{node:{...t,exists:!0},errors:[]},directPropertyGuarantees:u}}function O(e,t,n){const r=[];let o=t;for(const a of e){const e=n(a,o);r.push(e);const s=w(e.node);if(s)o={...o,existenceGuarantees:s},e.existenceGuarantees=s;else{const n=C(a,t);if(n){const t=v(m(o.existenceGuarantees),n);o={...o,existenceGuarantees:t},e.existenceGuarantees=v(e.existenceGuarantees,n)}else if(e.existenceGuarantees){const t=v(m(o.existenceGuarantees),e.existenceGuarantees);o={...o,existenceGuarantees:t}}}}return r}function L(e,t,n){const r=[];let o=t;for(const a of e){const e=n(a,o);r.push(e);const s=w(e.node);if(s){const t=x(s);o={...o,existenceGuarantees:t},e.existenceGuarantees=s}else{const n=C(a,t);if(n){const t=x(n),r=v(m(o.existenceGuarantees),t);o={...o,existenceGuarantees:r},e.existenceGuarantees=v(e.existenceGuarantees,n)}else if(e.existenceGuarantees){const t=x(e.existenceGuarantees),n=v(m(o.existenceGuarantees),t);o={...o,existenceGuarantees:n}}}}return r}function _(e){var t;let n=null===(t=e[0])||void 0===t?void 0:t.existenceGuarantees;for(let r=1;r<e.length;r++)n=v(n,e[r].existenceGuarantees);return n}function D(e){var t;let n=null===(t=e[0])||void 0===t?void 0:t.existenceGuarantees;for(let r=1;r<e.length;r++)n=h(n,e[r].existenceGuarantees);return n}function U(e,t,n){const r="function"===t.type.type?t.type.libraryFunction:void 0;if((null==r?void 0:r.name)===n)return t.kind===d().NM.UnifiedFunctionProperty?[t.expression,...e.arguments]:t.kind===d().NM.Identifier?e.arguments:void 0}function B(e,t,n,r){return t.kind===d().NM.UnifiedFunctionProperty?{node:{...e,expression:{...t,expression:n[0].node},arguments:n.slice(1).map((e=>e.node)),exists:!0},errors:n.flatMap((e=>e.errors)),existenceGuarantees:r}:{node:{...e,expression:t,arguments:n.map((e=>e.node)),exists:!0},errors:n.flatMap((e=>e.errors)),existenceGuarantees:r}}function G(e){if(e.existenceGuarantees)return e.existenceGuarantees;const t=w(e.node);return t||void 0}function q(e,t){var n;if(null!==(n=e.guaranteedPropertyIds)&&void 0!==n&&n.has(t))return!0;const r=(0,c().GH)(t);return"global"===(0,c().y5)(r).source||"unknown"}function V(e,t){var n;return Boolean((0,p().PJ)(t)||(null===(n=e.guaranteedPropertyIds)||void 0===n?void 0:n.has(t)))}const W=new Set(["empty","not","and","or","ifs","if"]),$=new Set(["at","first","last","slice","reverse","sort","unique","includes","map","filter","find","findIndex","some","every","flat","count","length","concat"]),Z=[function(e){const{node:t,expressionNode:n,context:r,addExistenceGuaranteesToFormulaASTTypes:o}=e,a="function"===n.type.type?n.type.libraryFunction:void 0;if("empty"!==(null==a?void 0:a.name))return;let s,i;if(n.kind===d().NM.UnifiedFunctionProperty?i=n.expression:n.kind===d().NM.Identifier&&(i=t.arguments[0]),i){const e=C(i,r);if(e)s=x(e);else if(i.kind===d().NM.NotionToken){if(i.token.type===l().FormulaTokenType.ContextValue)s=y.fromProperty(i.token.valueId,!1);else if(i.token.type===l().FormulaTokenType.BlockProperty){const e=i.token.property;s=y.fromProperty(e,!1)}}else if(i.kind===d().NM.MemberBlockProperty){const e=i.propertyToken.property,t=f(i.expression,e);t&&(s=y.fromProperty(t,!1))}}else s=y.impossible();const u=[];if(n.kind===d().NM.UnifiedFunctionProperty);else if(n.kind===d().NM.Identifier)for(const l of t.arguments){const e=o(l,r);u.push(e.node)}const p=void 0!==i;return{node:{...t,expression:n,arguments:u,exists:p},errors:[],existenceGuarantees:s}},function(e){const{node:t,expressionNode:n,context:r,addExistenceGuaranteesToFormulaASTTypes:o}=e,a="function"===n.type.type?n.type.libraryFunction:void 0;if("not"===(null==a?void 0:a.name)){if(n.kind===d().NM.UnifiedFunctionProperty){const e=o(n.expression,r),a=C(e.node,r);let s;return s=x(a||e.existenceGuarantees),{node:{...t,expression:{...n,expression:e.node},exists:!0},errors:e.errors,existenceGuarantees:s}}if(n.kind===d().NM.Identifier&&1===t.arguments.length){const e=o(t.arguments[0],r),a=C(e.node,r);let s;return s=x(a||e.existenceGuarantees),{node:{...t,expression:n,arguments:[e.node],exists:!0},errors:e.errors,existenceGuarantees:s}}}},function(e){const{node:t,expressionNode:n,context:r,addExistenceGuaranteesToFormulaASTTypes:o}=e,a=U(t,n,"and");if(!a)return;const s=O(a,r,o);return B(t,n,s,_(s))},function(e){const{node:t,expressionNode:n,context:r,addExistenceGuaranteesToFormulaASTTypes:o}=e,a=U(t,n,"or");if(!a)return;const s=L(a,r,o);return B(t,n,s,D(s))},function(e){const{node:t,expressionNode:n,context:r,addExistenceGuaranteesToFormulaASTTypes:o}=e,a="function"===n.type.type?n.type.libraryFunction:void 0;if("ifs"!==(null==a?void 0:a.name))return;const s=[],i=[];let u;if(n.kind===d().NM.UnifiedFunctionProperty){s.push(n.expression);for(let e=0;e<t.arguments.length;e+=2)i.push(t.arguments[e]),e+1<t.arguments.length&&(e+2<t.arguments.length?s.push(t.arguments[e+1]):u=t.arguments[e+1])}else{if(n.kind!==d().NM.Identifier)return;for(let e=0;e<t.arguments.length;e+=2)e+1<t.arguments.length?(s.push(t.arguments[e]),i.push(t.arguments[e+1])):u=t.arguments[e]}const p=[],l=[];let c,y=r.existenceGuarantees;for(let d=0;d<s.length&&d<i.length;d++){const e=o(s[d],{...r,existenceGuarantees:y});l.push(...e.errors);const{trueGuarantees:t,falseGuarantees:n}=P({...r,existenceGuarantees:y},e),a=o(i[d],{...r,existenceGuarantees:t});l.push(...a.errors),p.push({conditionResult:e,valueResult:a}),y=n}if(u&&(c=o(u,{...r,existenceGuarantees:y}),l.push(...c.errors)),n.kind===d().NM.UnifiedFunctionProperty){var m,f;const e=[];for(let t=0;t<p.length;t++)e.push(p[t].valueResult.node),t+1<p.length&&e.push(p[t+1].conditionResult.node);return c&&e.push(c.node),{node:{...t,expression:{...n,expression:(null===(m=p[0])||void 0===m?void 0:m.conditionResult.node)||n.expression},arguments:e,exists:!0},errors:l,existenceGuarantees:null===(f=p[0])||void 0===f?void 0:f.conditionResult.existenceGuarantees}}{var h;const e=[];for(let t=0;t<p.length;t++)e.push(p[t].conditionResult.node),e.push(p[t].valueResult.node);return c&&e.push(c.node),{node:{...t,expression:n,arguments:e,exists:!0},errors:l,existenceGuarantees:null===(h=p[0])||void 0===h?void 0:h.conditionResult.existenceGuarantees}}},function(e){const{node:t,expressionNode:n,context:r,addExistenceGuaranteesToFormulaASTTypes:o}=e,a=function(e,t){const n="function"===t.type.type?t.type.libraryFunction:void 0;if("if"===(null==n?void 0:n.name))return t.kind===d().NM.UnifiedFunctionProperty?{condition:t.expression,trueBranch:e.arguments[0],falseBranch:e.arguments[1],isUnifiedProperty:!0,expressionNode:t}:t.kind===d().NM.Identifier?{condition:e.arguments[0],trueBranch:e.arguments[1],falseBranch:e.arguments[2],isUnifiedProperty:!1,expressionNode:t}:void 0}(t,n);if(!a)return;const{conditionResult:s,trueBranchResult:i,falseBranchResult:u,directPropertyGuarantees:p}=S(a.condition,a.trueBranch,a.falseBranch,r,o),l=a.isUnifiedProperty?[i.node,u.node]:[s.node,i.node,u.node],c=F(i.node.exists,u.node.exists);return{node:{...t,expression:a.expressionNode,arguments:l,exists:c},errors:[...s.errors,...i.errors,...u.errors],existenceGuarantees:p??s.existenceGuarantees}},function(e){const{node:t,expressionNode:n,context:r,addExistenceGuaranteesToFormulaASTTypes:o}=e,a=function(e,t){const n="function"===t.type.type?t.type.libraryFunction:void 0;if("let"!==(null==n?void 0:n.name)&&"lets"!==(null==n?void 0:n.name))return;if(e.arguments.length<3||e.arguments.length%2==0)return;const r=[];for(let o=0;o<e.arguments.length-1;o+=2){const t=e.arguments[o],n=e.arguments[o+1];if(t.kind!==d().NM.Identifier)return;r.push({variableName:t,valueExpression:n})}return{variableBindings:r,bodyExpression:e.arguments[e.arguments.length-1],expressionNode:t}}(t,n);if(a)return function(e,t,n,r,o){const{variableBindings:a,bodyExpression:s}=n;let i=r;const u=[],p=[];for(const c of a){const{variableName:e,valueExpression:t}=c,n=o(t,i);p.push(...n.errors);const r=I(e),a=y.fromProperty(r,n.node.exists),s=m(i.existenceGuarantees),l=s?s.and(a):a,d=G(n),f=new Map(i.variableConditionalGuarantees);d&&f.set(r,d),i={...i,existenceGuarantees:l,variableConditionalGuarantees:f},u.push({variableName:e,valueResult:n})}const l=o(s,i);p.push(...l.errors);const d=[];for(const c of u)d.push({...c.variableName,exists:!0}),d.push(c.valueResult.node);return d.push(l.node),{node:{...e,expression:t,arguments:d,exists:!0},errors:p,existenceGuarantees:l.existenceGuarantees}}(t,n,a,r,o)},function(e){var t;const{node:n,expressionNode:r,context:o,addExistenceGuaranteesToFormulaASTTypes:a}=e,s=U(n,r,"concat");if(!s)return;const i=[];for(const p of s){const e=a(p,o);i.push(e)}let u=null===(t=i[0])||void 0===t?void 0:t.existenceGuarantees;for(let p=1;p<i.length;p++){const e=i[p].existenceGuarantees;if(!u||!e){u=void 0;break}u=h(u,e)}return B(n,r,i,u)}];function Y(e,t){var n;switch(e.kind){case d().NM.Number:case d().NM.String:case d().NM.Boolean:return{node:{...e,exists:!0},errors:[]};case d().NM.NotionToken:const w=e.token;switch(w.type){case l().FormulaTokenType.Checkbox:return{node:{...e,exists:!0},errors:[]};case l().FormulaTokenType.BlockProperty:const r=w.property;let a=(null===(n=t.existenceGuarantees)||void 0===n?void 0:n.get(r))??"unknown";return"unknown"===a&&(a=!!V(t,r)||(0,c().lH)(e.type)),{node:{...e,exists:a},errors:[]};case l().FormulaTokenType.ContextValue:return{node:{...e,exists:q(t,w.valueId)},errors:[]};case l().FormulaTokenType.Block:case l().FormulaTokenType.Person:case l().FormulaTokenType.Date:return{node:{...e,exists:!0},errors:[]};default:return(0,o().HB)(w)}case d().NM.Array:{const n=e.elements.map((e=>Y(e,t)));return{node:{...e,elements:n.map((e=>e.node)),exists:!0},errors:n.flatMap((e=>e.errors))}}case d().NM.Identifier:{var r,a;const n=I(e);let i=null===(r=t.existenceGuarantees)||void 0===r?void 0:r.get(n);const u=null===(a=t.variableConditionalGuarantees)||void 0===a?void 0:a.get(n);if((!(0,o().O9)(i)||"unknown"===i)&&u){const e=u.toMap();if(e)for(const[n,r]of e)if("boolean"==typeof r&&!0===r){var s;const e=null===(s=t.existenceGuarantees)||void 0===s?void 0:s.get(n);if((0,o().O9)(e)){i=e;break}}}const p=!(0,o().O9)(i)||i,l=u?t.existenceGuarantees?t.existenceGuarantees.and(u):u:t.existenceGuarantees;return{node:{...e,exists:p},errors:[],existenceGuarantees:l}}case d().NM.Conditional:return function(e,t,n){const{conditionResult:r,trueBranchResult:o,falseBranchResult:a,directPropertyGuarantees:s}=S(e.condition,e.expIfTrue,e.expIfFalse,t,n),i=F(o.node.exists,a.node.exists);return{node:{...e,condition:r.node,expIfTrue:o.node,expIfFalse:null==a?void 0:a.node,exists:i},errors:[...r.errors,...o.errors,...(null==a?void 0:a.errors)??[]],existenceGuarantees:s??r.existenceGuarantees}}(e,t,Y);case d().NM.LogicalOr:return function(e,t,n){const r=L(e.elements,t,n),o=D(r);return{node:{...e,elements:r.map((e=>e.node)),exists:!0},errors:r.flatMap((e=>e.errors)),existenceGuarantees:o}}(e,t,Y);case d().NM.LogicalAnd:return function(e,t,n){const r=O(e.elements,t,n),o=_(r);return{node:{...e,elements:r.map((e=>e.node)),exists:!0},errors:r.flatMap((e=>e.errors)),existenceGuarantees:o}}(e,t,Y);case d().NM.Equality:case d().NM.Relational:case d().NM.Additive:case d().NM.Multiplicative:case d().NM.Exponentiation:{const n=Y(e.lhs,t),r=Y(e.rhs,t);return{node:{...e,lhs:n.node,rhs:r.node,exists:!0},errors:[...n.errors,...r.errors]}}case d().NM.Unary:return function(e,t,n){const r=n(e.expression,t),o=C(e.expression,t);let a;return a=x(o||r.existenceGuarantees),{node:{...e,expression:r.node,exists:!0},errors:r.errors,existenceGuarantees:a}}(e,t,Y);case d().NM.Call:const{node:M,errors:N,existenceGuarantees:R}=Y(e.expression,t),A=[...N],P="function"===M.type.type?M.type.libraryFunction:void 0,U=E({node:e,expressionNode:M,context:t,addExistenceGuaranteesToFormulaASTTypes:Y,expressionGuarantees:R});if(U){let e=U.existenceGuarantees;if("find"===(null==P?void 0:P.name)){const t="function"===M.type.type?M.type.boundTargetType:void 0;if("array"===(null==t?void 0:t.type)){const n=t.sourceRelationPropertyId;if(n){e=v(e,T(U.existenceGuarantees,n))}}}return{...U,errors:[...N,...U.errors],existenceGuarantees:e}}const B=function(e,t,n,r){const o={node:e,expressionNode:t,context:n,addExistenceGuaranteesToFormulaASTTypes:r};for(const a of Z){const e=a(o);if(e)return e}}(e,M,t,Y);if(B)return B;const G=[];for(const n of e.arguments){const e=Y(n,t);G.push(e.node),A.push(...e.errors)}const H=(null==P?void 0:P.name)&&$.has(P.name);let z;if(null==P||!P.name||W.has(P.name)||l().TREAT_UNDEFINED_AS_ZERO_FNS.includes(P.name)||H||!0===M.exists||(z={type:d().IA.CalledFunctionOnEmptyValue,node:e,expression:M,libraryFunction:P}),null!=P&&P.name&&!z&&!W.has(P.name)&&!l().TREAT_UNDEFINED_AS_ZERO_FNS.includes(P.name)&&!H)for(const t of G)if(!0!==t.exists){z={type:d().IA.CalledFunctionOnEmptyValue,node:e,expression:t,libraryFunction:P};break}z&&A.push(z);let j=!0;if("empty"===(null==P?void 0:P.name)&&0===G.length&&(j=!1),M.kind===d().NM.UnifiedFunctionProperty&&!0===M.exists){const e=$.has(M.name),n="array"===M.expression.type.type;if(e&&n){let e=!1;if(M.expression.kind===d().NM.MemberBlockProperty){var i;const n=M.expression.propertyToken.property,r=f(M.expression.expression,n);r&&!0===(null===(i=t.existenceGuarantees)||void 0===i?void 0:i.get(r))&&(e=!0)}else if(M.expression.kind===d().NM.NotionToken&&M.expression.token.type===l().FormulaTokenType.BlockProperty){var u;const n=M.expression.token.property;!0===(null===(u=t.existenceGuarantees)||void 0===u?void 0:u.get(n))&&(e=!0)}e&&(j=M.exists)}}if(H&&["first","last"].includes(P.name)){let e=!1;if(M.kind===d().NM.MemberBlockProperty){var p;const n=M.propertyToken.property,r=f(M.expression,n);r&&!0===(null===(p=t.existenceGuarantees)||void 0===p?void 0:p.get(r))&&(e=!0)}else if(M.kind===d().NM.NotionToken&&M.token.type===l().FormulaTokenType.BlockProperty){var y;const n=M.token.property;!0===(null===(y=t.existenceGuarantees)||void 0===y?void 0:y.get(n))&&(e=!0)}e&&(j=!0)}return{node:{...e,expression:M,arguments:G,exists:j},errors:A,existenceGuarantees:R};case d().NM.UnifiedFunctionProperty:const K=Y(e.expression,t),Q=K.node,J=[...K.errors],X=$.has(e.name),ee="array"===Q.type.type,te=["first","last","at","find"].includes(e.name);let ne;if(X&&ee)if(["first","last"].includes(e.name)){let n=!1;if(Q.kind===d().NM.MemberBlockProperty){var m;const e=Q.propertyToken.property,r=f(Q.expression,e);r&&!0===(null===(m=t.existenceGuarantees)||void 0===m?void 0:m.get(r))&&(n=!0)}else if(Q.kind===d().NM.NotionToken&&Q.token.type===l().FormulaTokenType.BlockProperty){var h;const e=Q.token.property;!0===(null===(h=t.existenceGuarantees)||void 0===h?void 0:h.get(e))&&(n=!0)}ne=!!n||(0,c().lH)(e.type)}else ne=(0,c().lH)(e.type);else ne=Q.exists;let re=K.existenceGuarantees;if(te&&"array"===Q.type.type){const e=Q.type.sourceRelationPropertyId;if(e){re=v(re,T(K.existenceGuarantees,e))}}return{node:{...e,expression:Q,exists:ne},errors:J,existenceGuarantees:re};case d().NM.MemberBlockProperty:const oe=Y(e.expression,t);let ae="unknown";const se=e.propertyToken.property;if(oe.node.kind===d().NM.NotionToken&&oe.node.token.type===l().FormulaTokenType.ContextValue){var g;const e=`${oe.node.token.valueId}:${se}`;ae=(null===(g=t.existenceGuarantees)||void 0===g?void 0:g.get(e))??"unknown"}else if(oe.node.kind===d().NM.Identifier){var b;const e=`let_var_${oe.node.text}:${se}`;ae=(null===(b=t.existenceGuarantees)||void 0===b?void 0:b.get(e))??"unknown"}if("unknown"===ae){var k;!0===(null===(k=oe.existenceGuarantees)||void 0===k?void 0:k.get(se))&&(ae=!0)}return"unknown"===ae&&(ae=!0!==oe.node.exists?"unknown":!!V(t,se)||(0,c().lH)(e.type)),{node:{...e,expression:oe.node,exists:ae},errors:[...oe.errors],existenceGuarantees:oe.existenceGuarantees};case d().NM.RecoveryNode:return{node:{...e,exists:!0},errors:[]};default:return(0,o().HB)(e)}}var H=()=>n(420062),z=()=>n(563015),j=()=>n(696446),K=()=>n(106714),Q=()=>n(628048);const J=[{name:l().FORMULA_PROP_WRAPPER,error:d().IA.InvalidPropCall},{name:l().FORMULA_CONTEXT_WRAPPER,error:d().IA.InvalidContextCall},{name:l().FORMULA_VARIABLE_WRAPPER,error:d().IA.InvalidVariableCall}],X=new Set(["created_time","last_edited_time","created_by","last_edited_by","auto_increment_id"]);function ee(e,t,n){X.has(n)&&(null==e||e.add(t))}function*te(e,t){var n;const r=(yield{recordPointers:[e]}).getRecordModel(e);return r?r.getNormalizedSchema():e.id===(null===(n=t.publicPageDataCollection)||void 0===n?void 0:n.id)?null===(o=t.publicPageDataCollection)||void 0===o?void 0:o.schema:void 0;var o}function*ne(e,t){const{valueTypes:n}=t;switch(e.kind){case d().NM.Number:return{node:{...e,type:{type:"number"},valueTypes:n},errors:[]};case d().NM.String:return{node:{...e,type:{type:"text"},valueTypes:n},errors:[]};case d().NM.Boolean:return{node:{...e,type:{type:"checkbox"},valueTypes:n},errors:[]};case d().NM.NotionToken:{const s=e.token;switch(s.type){case l().FormulaTokenType.Checkbox:return{node:{...e,type:{type:"checkbox"},valueTypes:n},errors:[]};case l().FormulaTokenType.BlockProperty:{var r;if((0,c().ix)(s)){const r=n.find((e=>e.kind===l().FormulaContextValueKind.ContextValue&&e.id===(0,c().GH)(s.contextValueId)));if(void 0===r)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.MissingContextVariable,node:e,token:s}]};const o=r.type;if("block"!==o.type)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.ContextVariableNotBlockWithCollection,node:e,token:s}]};if(void 0===o.collection){const r=(0,c().Yi)(s.property);if(p().PJ(r))return{node:{...e,type:l().FormulaTokenSupportedBlockSystemPropertyToType[r],valueTypes:n},errors:[]};{var y;const o=(null===(y=t.formulaPropertyNames)||void 0===y?void 0:y.get(r))??r;return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.MissingPropertyOnContextVariable,node:e,property:o,token:s}]}}}const a=(0,c().Yi)(s.property);if(p().PJ(a))return{node:{...e,type:l().FormulaTokenSupportedBlockSystemPropertyToType[a],valueTypes:n},errors:[]};const i=yield*te(o.collection,t),u=null==i?void 0:i[a];if(void 0===u||void 0===i){var m;const r=(null===(m=t.formulaPropertyNames)||void 0===m?void 0:m.get(a))??a;return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.MissingPropertyOnContextVariable,node:e,property:r,token:s}]}}ee(t.guaranteedPropertyIds,a,u.type);const f=yield*(0,c().Df)(a,i,u);return{node:{...e,type:f??{type:"unknown"},valueTypes:n},errors:void 0===f?[{type:d().IA.BlockPropertyTypeInvalid,node:e,token:s,propertyName:u.name,propertyType:u.type}]:[]}}const o=null===(r=n.find((e=>e.kind===l().FormulaContextValueKind.ThisRow)))||void 0===r?void 0:r.type;if(void 0===o)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.ThisRowTypeNotFound,node:e}]};if("block"!==o.type||void 0===o.collection)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.ThisRowNotBlockWithCollection,node:e}]};if(void 0===s.collection)return{node:{...e,type:l().FormulaTokenSupportedBlockSystemPropertyToType[s.property],valueTypes:n},errors:[]};const i=yield*te(o.collection,t),u=(0,c().Yi)(s.property),v=null==i?void 0:i[u];var f,h;if(void 0===v||void 0===i)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.MissingPropertyOnThisRow,node:e,property:(null===(f=t.formulaPropertyNames)||void 0===f?void 0:f.get(u))??u}]};if(ee(t.guaranteedPropertyIds,u,v.type),(0,a().CH)(t.spaceId,v,i))return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.CrossSpacePropertyNotSupported,node:e,property:(null===(h=t.formulaPropertyNames)||void 0===h?void 0:h.get(u))??u}]};const x=yield*(0,c().Df)(u,i,v);return{node:{...e,type:x??{type:"unknown"},valueTypes:n},errors:void 0===x?[{type:d().IA.MemberPropertyTypeInvalid,node:e,token:s,propertyName:v.name,propertyType:v.type}]:[]}}case l().FormulaTokenType.ContextValue:{var v;const t=null===(v=n.find((e=>e.kind===l().FormulaContextValueKind.ContextValue&&e.id===(0,c().GH)(s.valueId))))||void 0===v?void 0:v.type;return void 0===t?{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.MissingContextVariable,node:e,token:s}]}:{node:{...e,type:t,valueTypes:n},errors:[]}}case l().FormulaTokenType.Block:{const t={table:i().ev,id:s.blockId,spaceId:s.spaceId},r=(yield{recordPointers:[t]}).getRecordModel(t);if(void 0===r)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.MissingBlock,node:e,token:s}]};const o=r.getParentPointer(),a=o.table===u().Vl?o:void 0;return{node:{...e,type:{type:"block",collection:a},valueTypes:n},errors:[]}}case l().FormulaTokenType.Person:return{node:{...e,type:{type:"person"},valueTypes:n},errors:[]};case l().FormulaTokenType.Date:return{node:{...e,type:{type:"date"},valueTypes:n},errors:[]};default:return(0,o().HB)(s)}}case d().NM.Array:{const r=yield*(0,j().KZ)(e.elements.map((e=>ne(e,t))));let o={type:"unknown"};if(r.length>0){o=r[0].node.type;for(let e=1;e<r.length;e++)if(!(0,c().Re)(o,r[e].node.type)){o={type:"unknown"};break}}return{node:{...e,elements:r.map((e=>e.node)),type:{type:"array",of:o},valueTypes:n},errors:r.flatMap((e=>e.errors))}}case d().NM.Identifier:{var x;const t=null===(x=n.find((t=>t.kind===l().FormulaContextValueKind.Binding&&t.id===e.text)))||void 0===x?void 0:x.type;if(void 0!==t)return{node:{...e,type:t,valueTypes:n},errors:[]};const r=Q().LP.hasOwnProperty(e.text)?Q().LP[e.text]:void 0;if(void 0===r){const t=[{type:d().IA.UndefinedIdentifier,node:e}];return H().sr.hasOwnProperty(e.text)?t.push({type:d().IA.RenamedIdentifier,node:e,identifier:e.text,renamedTo:H().sr[e.text]}):H().lg.hasOwnProperty(e.text)&&t.push({type:d().IA.RemovedFunction,node:e,functionName:e.text,alternative:H().lg[e.text]}),{node:{...e,type:{type:"unknown"},valueTypes:n},errors:t}}return{node:{...e,type:{type:"function",libraryFunction:r,calledFromUnifiedFunctionProperty:!1},valueTypes:n},errors:[]}}case d().NM.Conditional:{const r=yield*ne(e.condition,t),o=yield*ne(e.expIfTrue,t),a=void 0!==e.expIfFalse?yield*ne(e.expIfFalse,t):void 0,s=(0,c().qk)(o.node.type,null==a?void 0:a.node.type);return{node:{...e,condition:r.node,expIfTrue:o.node,expIfFalse:null==a?void 0:a.node,type:s,valueTypes:n},errors:[...r.errors,...o.errors??[],...(null==a?void 0:a.errors)??[]]}}case d().NM.LogicalOr:case d().NM.LogicalAnd:const T=yield*(0,j().KZ)(e.elements.map((e=>ne(e,t)))),w=T.flatMap((e=>e.errors));return{node:{...e,elements:T.map((e=>e.node)),type:{type:"checkbox"},valueTypes:n},errors:w};case d().NM.Equality:case d().NM.Relational:{const r=yield*ne(e.lhs,t),o=yield*ne(e.rhs,t),a=[...r.errors,...o.errors];if(e.kind===d().NM.Relational){const t=r.node.type,n=o.node.type;"unknown"===t.type||"unknown"===n.type||t.type===n.type&&["number","date","text","checkbox"].includes(t.type)||a.push({type:d().IA.CannotRelativelyCompareTypes,node:e,lhsType:t,rhsType:n})}return{node:{...e,lhs:r.node,rhs:o.node,type:{type:"checkbox"},valueTypes:n},errors:a}}case d().NM.Additive:case d().NM.Multiplicative:case d().NM.Exponentiation:{const r=yield*ne(e.lhs,t),o=yield*ne(e.rhs,t),a=[...r.errors,...o.errors];if("+"===e.op)return"number"===r.node.type.type&&"number"===o.node.type.type?{node:{...e,lhs:r.node,rhs:o.node,type:{type:"number"},valueTypes:n},errors:a}:{node:{...e,lhs:r.node,rhs:o.node,type:["unknown","number"].includes(r.node.type.type)&&["unknown","number"].includes(o.node.type.type??"unknown")?{type:"unknown"}:{type:"text"},valueTypes:n},errors:a};const s=function(e,t,n){const r=t.type,o=(null==n?void 0:n.type)??{type:"unknown"};if(!["unknown","number"].includes(r.type)||!["unknown","number"].includes(o.type))return{type:d().IA.CannotDoMathOnType,node:e,lhsType:r,rhsType:o}}(e,r.node,o.node);return void 0!==s&&a.push(s),{node:{...e,lhs:r.node,rhs:o.node,type:{type:"number"},valueTypes:n},errors:a}}case d().NM.Unary:{const r=yield*ne(e.expression,t),a=[...r.errors];let s;switch(e.op){case"-":["number","unknown"].includes(r.node.type.type)||a.push({type:d().IA.UnaryMinusOnNonNumber,node:e,expression:r.node}),s={type:"number"};break;case"!":case"not":s={type:"checkbox"};break;default:(0,o().HB)(e)}return{node:{...e,expression:r.node,type:s,valueTypes:n},errors:a}}case d().NM.Call:{const{node:r,errors:o}=yield*ne(e.expression,t),a=[...o];if(r.kind===d().NM.Identifier&&("lets"===r.text||"let"===r.text))return yield*function*(e,t,n){const r=[];let o=[...n.valueTypes];const a=[];for(let p=0;p<e.arguments.length-1;p+=2){const t=e.arguments[p],s=e.arguments[p+1];if(t.kind!==d().NM.Identifier){a.push({type:d().IA.IdentifierExpected,node:t});continue}const{node:i,errors:u}=yield*ne(s,{...n,valueTypes:o});r[p+1]=i,a.push(...u);const c=t.text;o=[{kind:l().FormulaContextValueKind.Binding,id:c,name:c,type:i.type},...o],r[p]={...t,type:i.type,valueTypes:o}}const s=e.arguments[e.arguments.length-1];if(!s)return{node:{...e,expression:t,arguments:r,type:{type:"unknown"},valueTypes:o},errors:a};const{node:i,errors:u}=yield*ne(s,{...n,valueTypes:o});return r[e.arguments.length-1]=i,a.push(...u),{node:{...e,expression:t,arguments:r,type:i.type,valueTypes:o},errors:a}}(e,r,t);["function","unknown"].includes(r.type.type)||a.push({type:d().IA.CallingNotFunction,node:e,callee:r});const s="function"===r.type.type?r.type.libraryFunction:void 0,i="function"===r.type.type?r.type.boundTargetType:void 0;if(void 0!==s){var g;null!==(g=t.featureGates)&&void 0!==g&&null!==(g=g.formulas_disabled_functions)&&void 0!==g&&g.includes(s.name)&&a.push({type:d().IA.UnifiedFunctionCannotFindFunction,node:e,name:s.name});const n=(0,c().ab)(s),o=e.arguments.length+(void 0!==i?1:0);o<n&&("function"===r.type.type&&r.type.calledFromUnifiedFunctionProperty?a.push({type:d().IA.FunctionCallTooFewArguments,node:e,libraryFunction:s,numArguments:o-1,minNumParameters:n-1}):a.push({type:d().IA.FunctionCallTooFewArguments,node:e,libraryFunction:s,numArguments:o,minNumParameters:n}))}const u=[],p=[];void 0!==i&&p.push(i);for(let m=0;m<e.arguments.length;m++){const r=e.arguments[m],o=void 0!==i?m+1:m,y=void 0!==s?(0,c().Pf)(s,o):void 0;if(void 0!==s&&void 0===y&&a.push({type:d().IA.FunctionCallUnexpectedArgument,node:e,libraryFunction:s,argument:r,parameterIndex:o}),void 0!==(null==y?void 0:y.augmentScope)){const e=u.map((e=>(null==e?void 0:e.type)??{type:"unknown"})),o=y.augmentScope(void 0!==i?[i,...e]:e),{node:s,errors:d}=yield*ne(r,{...t,valueTypes:[...Object.entries(o).map((([e,t])=>({kind:l().FormulaContextValueKind.Binding,id:e,type:t}))),...n]});u[m]=s,p.push(s.type),a.push(...d)}else{const{node:n,errors:i}=yield*ne(r,{...t});if(u[m]=n,void 0!==s&&void 0!==y)if("unknown"===n.type.type&&(0,c().nF)(y.type))p.push(n.type),t.featureGates.formula_null_check&&a.push({type:d().IA.CallingFunctionWithUnknownArgument,node:e,libraryFunction:s,expectedParameter:y,parameterIndex:o});else{const t="id"===s.name&&"block"===n.type.type||(0,c().CM)(n.type,y.type);"boolean"==typeof t?(p.push(n.type),t||a.push({type:d().IA.FunctionCallArgumentWrongType,node:e,libraryFunction:s,argument:n,expectedParameter:y})):p.push(t)}else p.push(n.type);a.push(...i)}}let y=a;for(const t of J)if(r.kind===d().NM.Identifier&&r.text===t.name&&1===e.arguments.length&&e.arguments[0].kind===d().NM.String&&e.arguments[0].text.length>0){const n=e.arguments[0].text.replace(l().FORMULA_TOKEN_REGEX,"");y=y.filter((e=>!(e.type===d().IA.UndefinedIdentifier&&e.node.kind===d().NM.Identifier&&e.node.text===t.name))),y.push({type:t.error,node:e,name:n});break}if(r.kind===d().NM.UnifiedFunctionProperty)for(const t of J)if(r.name===t.name&&1===e.arguments.length&&e.arguments[0].kind===d().NM.String&&e.arguments[0].text.length>0){const n=e.arguments[0].text.replace(l().FORMULA_TOKEN_REGEX,"");y=y.filter((e=>!(e.type===d().IA.UnifiedFunctionCannotFindFunction&&e.node.kind===d().NM.UnifiedFunctionProperty&&e.node.name===t.name))),y.push({type:t.error,node:e,name:n});break}return{node:{...e,expression:r,arguments:u,type:void 0!==s?"function"==typeof s.returnType?s.returnType(p):s.returnType:{type:"unknown"},valueTypes:n},errors:y}}case d().NM.UnifiedFunctionProperty:{const r=Q().LP.hasOwnProperty(e.name)?Q().LP[e.name]:void 0,{node:o,errors:a}=yield*ne(e.expression,t),s=[...a];let i={type:"unknown"};if(void 0===r)s.push({type:d().IA.UnifiedFunctionCannotFindFunction,node:e,name:e.name});else{const n=(0,c().Pf)(r,0);if(void 0===n)s.push({type:d().IA.UnifiedFunctionNoArguments,node:e,libraryFunction:r});else if("unknown"===o.type.type&&(0,c().nF)(n.type))t.featureGates.formula_null_check&&s.push({type:d().IA.CallingFunctionWithUnknownTarget,node:e,libraryFunction:r,expectedParameter:n});else{const t="id"===r.name&&"block"===o.type.type||(0,c().CM)(o.type,n.type);"boolean"==typeof t?(i=o.type,t||s.push({type:d().IA.UnifiedFunctionTargetWrongType,node:e,expression:o,libraryFunction:r})):i=t}}return{node:{...e,expression:o,type:void 0!==r?{type:"function",boundTargetType:i,libraryFunction:r,calledFromUnifiedFunctionProperty:!0}:{type:"unknown"},valueTypes:n},errors:s}}case d().NM.MemberBlockProperty:{const{node:r,errors:o}=yield*ne(e.expression,t),i=[...o];let u;if("block"===r.type.type)if(void 0===e.propertyToken.collection)u=l().FormulaTokenSupportedBlockSystemPropertyToType[e.propertyToken.property];else{const n=yield*te(e.propertyToken.collection,t),o=(0,c().Yi)(e.propertyToken.property),p=null==n?void 0:n[o];var b;if(p&&ee(t.guaranteedPropertyIds,o,p.type),void 0===p||void 0===n)i.push({type:d().IA.MemberPropertyMissing,node:e,property:(null===(b=t.formulaPropertyNames)||void 0===b?void 0:b[o])??o});else if(void 0!==r.type.collection){var k;if((0,a().CH)(t.spaceId,p,n))i.push({type:d().IA.CrossSpacePropertyNotSupported,node:e,property:(null===(k=t.formulaPropertyNames)||void 0===k?void 0:k.get(o))??o});if((0,s().Z2)(e.propertyToken.collection,r.type.collection)){const t=yield*(0,c().Df)(o,n,p);u=t,void 0===t&&i.push({type:d().IA.MemberPropertyTypeInvalid,node:e,token:e.propertyToken,propertyName:p.name,propertyType:p.type})}else i.push({type:d().IA.MemberPropertyMismatchCollection,node:e,token:e.propertyToken})}}else"unknown"!==r.type.type&&i.push({type:d().IA.MemberPropertyTargetNotBlock,node:e,expression:r});return{node:{...e,expression:r,type:u??{type:"unknown"},valueTypes:n},errors:i}}case d().NM.RecoveryNode:return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[]};default:(0,o().HB)(e)}}function re(e,t){return"array"!==e.type?e.type===t.type:"array"===t.type&&("array"===e.of.type?re(e.of,t):re(e.of,t.of))}function oe(e,t){return t.some((t=>re(e,t)))}function ae(e){return e.type===d().IA.CalledFunctionOnEmptyValue||e.type===d().IA.CallingFunctionWithUnknownTarget||e.type===d().IA.CallingFunctionWithUnknownArgument}function se(e){const t=[],n=[];for(const r of e)ae(r)?n.push(r):t.push(r);return{errors:t,warnings:n}}async function ie(e,t,n){const o=ne(e,t);let a=o.next();for(;!a.done;){const e=t.handleDataRequest(a.value);a=o.next((0,r().yL)(e)?await e:e)}if(t.allowedReturnTypes&&!oe(a.value.node.type,t.allowedReturnTypes)&&a.value.errors.push({allowedReturnTypes:t.allowedReturnTypes,node:a.value.node,returnType:a.value.node.type,type:d().IA.DisallowedReturnType}),t.featureGates.formula_null_check&&t.enableExistenceGuarantees&&0===a.value.errors.length){const{node:e,errors:n}=Y(a.value.node,{...t,existenceGuarantees:y.empty()});a.value.node=e,a.value.errors.push(...n)}if(!n){const{errors:e,warnings:t}=se(a.value.errors);return{node:a.value.node,errors:e,warnings:t}}const s=a.value.errors.findIndex((e=>e.type===d().IA.InvalidPropCall));-1!==s&&(a.value.errors=a.value.errors.filter(((e,t)=>t===s||e.type!==d().IA.InvalidPropCall)));const i=a.value.errors.map((e=>{const t=(0,z().zf)(e);return{...e,node:(0,K().TW)(t,n)}})),{errors:u,warnings:p}=se(i);return{node:a.value.node,errors:u,warnings:p}}function ue(e,t,n){const r=ne(e,t);let o=r.next();for(;!o.done;){const e=t.handleDataRequest(o.value);o=r.next(e)}if(t.allowedReturnTypes&&!oe(o.value.node.type,t.allowedReturnTypes)&&o.value.errors.push({allowedReturnTypes:t.allowedReturnTypes,node:o.value.node,returnType:o.value.node.type,type:d().IA.DisallowedReturnType}),t.featureGates.formula_null_check&&t.enableExistenceGuarantees&&0===o.value.errors.length){const{node:e,errors:n}=Y(o.value.node,{...t,existenceGuarantees:y.empty()});o.value.node=e,o.value.errors.push(...n)}if(!n){const{errors:e,warnings:t}=se(o.value.errors);return{node:o.value.node,errors:e,warnings:t}}const a=o.value.errors.map((e=>{const t=(0,z().zf)(e);return{...e,node:(0,K().TW)(t,n)}})),{errors:s,warnings:i}=se(a);return{node:o.value.node,errors:s,warnings:i}}},44907:(e,t,n)=>{n.d(t,{Ps:()=>m,Q7:()=>c,TM:()=>p,_M:()=>d,p8:()=>u});n(16280),n(269479);var r=()=>n(303151),o=()=>n(496603),a=()=>n(247331),s=()=>n(349835),i=()=>n(239381);const u=o().Bj((()=>function(){const e=(0,r().Ey)({name:"AdditionOperator",pattern:r().JG.NA}),t=(0,r().Ey)({name:"UnaryOperator",pattern:r().JG.NA}),o=(0,r().Ey)({name:"Plus",pattern:/\+/,categories:e}),s=(0,r().Ey)({name:"Minus",pattern:/-/,categories:[e,t]}),u=(0,r().Ey)({name:"ExclamationPoint",pattern:/!/,categories:t}),p=(0,r().Ey)({name:"MultiplicationOperator",pattern:r().JG.NA}),l=(0,r().Ey)({name:"Multi",pattern:/\*/,categories:p}),d=(0,r().Ey)({name:"Div",pattern:/\//,categories:p}),c=(0,r().Ey)({name:"Modulo",pattern:/%/,categories:p}),y=(0,r().Ey)({name:"Caret",pattern:/\^/}),m=(0,r().Ey)({name:"BooleanLiteral",pattern:r().JG.NA}),f=(0,r().Ey)({name:"True",pattern:/true/i,categories:m}),h=(0,r().Ey)({name:"False",pattern:/false/i,categories:m}),v=(0,r().Ey)({name:"And",pattern:/and(?=\s)|&&/i}),x=(0,r().Ey)({name:"Or",pattern:/or(?=\s)|\|\|/i}),g=(0,r().Ey)({name:"Not",pattern:/not(?=\s)/i,categories:t}),b=(0,r().Ey)({name:"RelationalOperator",pattern:r().JG.NA}),k=(0,r().Ey)({name:"LessThan",pattern:/<=?/,categories:b}),T=(0,r().Ey)({name:"GreaterThan",pattern:/>=?/,categories:b}),w=(0,r().Ey)({name:"EqualityOperator",pattern:r().JG.NA}),M=(0,r().Ey)({name:"Equal",pattern:/==/,categories:w}),N=(0,r().Ey)({name:"NotEqual",pattern:/!=/,categories:w}),E=(0,r().Ey)({name:"LParen",pattern:/\(/}),I=(0,r().Ey)({name:"RParen",pattern:/\)/}),C=(0,r().Ey)({name:"LBracket",pattern:/\[/}),R=(0,r().Ey)({name:"RBracket",pattern:/\]/}),A=(0,r().Ey)({name:"Comma",pattern:/,/}),P=(0,r().Ey)({name:"Dot",pattern:/\./}),F=(0,r().Ey)({name:"QuestionMark",pattern:/\?/}),S=(0,r().Ey)({name:"Colon",pattern:/:/}),O=(0,r().Ey)({name:"StringLiteral",pattern:/"(?:[^\\"]|\\.)*"/,start_chars_hint:['"']}),L=(0,r().Ey)({name:"UnclosedStringLiteral",pattern:/"(?:[^\\"]|\\.)*/,start_chars_hint:['"']}),_=(0,r().Ey)({name:"NumberLiteral",pattern:/(0|[1-9]\d*)(\.\d+)?([eE][+-]?\d+)?/}),D=(0,r().Ey)({name:"Comment",pattern:/\/\*(?:[^*]|\*(?:[^\/]))*\*\//,group:r().JG.SKIPPED,start_chars_hint:["/*"]}),U=(0,r().Ey)({name:"UnclosedComment",pattern:/\/\*(?:[^*]|\*(?:[^\/]))*/,group:r().JG.SKIPPED,start_chars_hint:["/*"]}),B=(0,r().Ey)({name:"InputToken",pattern:{exec:(e,t)=>{if(!e.startsWith(a().FORMULA_TOKEN_PREFIX,t))return null;const r=e.substring(t),o=a().tokenBlockPropertyOptionalCollectionPattern.exec(r);if(null!==o){const e=[o[0]],t=(0,i().QE)(o[1]);let r;if(void 0!==o[2])r={type:a().FormulaTokenType.BlockProperty,property:t,collection:{table:n(519831).Vl,id:o[3],spaceId:o[4]}};else{if(!a().FormulaTokenSupportedBlockSystemPropertyList.includes(t))return null;r={type:a().FormulaTokenType.BlockProperty,property:t,collection:void 0}}return e.payload=r,e}const s=a().tokenBlockPropertyContextValueIdPattern.exec(r);if(null!==s){const e=[s[0]],t=(0,i().QE)(s[1]),n=(0,i().A$)(s[2]),r=(0,i().e2)(e[3]),o={contextValueId:n,property:t,type:a().FormulaTokenType.BlockProperty,valueSnapshot:r};return e.payload=o,e}const u=a().tokenBlockPattern.exec(r);if(null!==u){const e=[u[0]],t={type:a().FormulaTokenType.Block,blockId:u[1],spaceId:void 0!==u[2]?u[2].substring(1):void 0};return e.payload=t,e}const p=a().tokenPersonPatternForUser.exec(r);if(null!==p){const e=[p[0]],t={type:a().FormulaTokenType.Person,personInfo:{personTokenType:"user",userId:p[1]}};return e.payload=t,e}const l=a().tokenPersonPatternForGroup.exec(r);if(null!==l){const e=[l[0]],t={type:a().FormulaTokenType.Person,personInfo:{personTokenType:"group",groupId:l[1],spaceId:l[2]}};return e.payload=t,e}const d=a().tokenCheckboxPattern.exec(r);if(null!==d){const e=[d[0]],t={type:a().FormulaTokenType.Checkbox,checked:"true"===d[1]};return e.payload=t,e}const c=a().tokenContextValuePattern.exec(r);if(null!==c){const e=[c[0]],t=(0,i().A$)(c[1]),n={type:a().FormulaTokenType.ContextValue,valueId:t};return e.payload=n,e}const y=a().tokenDatePattern.exec(r);if(null!==y){const e=[y[0]],t={type:a().FormulaTokenType.Date,date:(0,i().P_)(y[1])};return e.payload=t,e}return null}},line_breaks:!1,start_chars_hint:[a().FORMULA_TOKEN_PREFIX]}),G=(0,r().Ey)({name:"IdentifierName",pattern:(q=/[\p{Letter}_][\p{Number}\p{Letter}_]*/u,(e,t)=>{const n=new RegExp(q.source,`${q.flags}y`);return n.lastIndex=t,n.exec(e)}),line_breaks:!1});var q;return{WhiteSpace:(0,r().Ey)({name:"WhiteSpace",pattern:/\s+/,group:r().JG.SKIPPED}),NumberLiteral:_,StringLiteral:O,UnclosedStringLiteral:L,Comment:D,UnclosedComment:U,InputToken:B,True:f,False:h,And:v,Or:x,Not:g,IdentifierName:G,Equal:M,NotEqual:N,Plus:o,Minus:s,ExclamationPoint:u,Multi:l,Div:d,Modulo:c,Caret:y,LParen:E,RParen:I,LBracket:C,RBracket:R,AdditionOperator:e,MultiplicationOperator:p,LessThan:k,GreaterThan:T,QuestionMark:F,Colon:S,Comma:A,Dot:P,UnaryOperator:t,EqualityOperator:w,RelationalOperator:b,BooleanLiteral:m}}()));const p=o().Bj((e=>new(r().JG)(function(e){return Object.values(e)}(e))));class l extends r().cA{constructor(e){super(Object.values(e),{recoveryEnabled:!0,nodeLocationTracking:"onlyOffset"}),this.formulaTokens=void 0,this.c1=void 0,this.expression=this.RULE("expression",(()=>{this.SUBRULE(this.conditionalExpression)})),this.primaryExpression=this.RULE("primaryExpression",(()=>{this.OR(this.c1||(this.c1=[{ALT:()=>this.SUBRULE(this.parenthesisExpression)},{ALT:()=>this.SUBRULE(this.arrayExpression)},{ALT:()=>this.CONSUME(this.formulaTokens.NumberLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.StringLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.UnclosedStringLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.BooleanLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.IdentifierName)},{ALT:()=>this.CONSUME(this.formulaTokens.InputToken)}]))})),this.conditionalExpression=this.RULE("conditionalExpression",(()=>{this.SUBRULE(this.logicalOrExpression,{LABEL:"condition"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.QuestionMark),this.SUBRULE2(this.logicalOrExpression,{LABEL:"expIfTrue"}),this.CONSUME(this.formulaTokens.Colon),this.SUBRULE3(this.logicalOrExpression,{LABEL:"expIfFalse"})}))})),this.logicalOrExpression=this.RULE("logicalOrExpression",(()=>{this.SUBRULE(this.logicalAndExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.Or),this.SUBRULE2(this.logicalAndExpression,{LABEL:"rhs"})}))})),this.logicalAndExpression=this.RULE("logicalAndExpression",(()=>{this.SUBRULE(this.equalityExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.And),this.SUBRULE2(this.equalityExpression,{LABEL:"rhs"})}))})),this.equalityExpression=this.RULE("equalityExpression",(()=>{this.SUBRULE(this.relationalExpression,{LABEL:"lhs"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.EqualityOperator),this.SUBRULE2(this.relationalExpression,{LABEL:"rhs"})}))})),this.relationalExpression=this.RULE("relationalExpression",(()=>{this.SUBRULE(this.additionExpression,{LABEL:"lhs"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.RelationalOperator),this.SUBRULE2(this.additionExpression,{LABEL:"rhs"})}))})),this.additionExpression=this.RULE("additionExpression",(()=>{this.SUBRULE(this.multiplicationExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.AdditionOperator),this.SUBRULE2(this.multiplicationExpression,{LABEL:"rhs"})}))})),this.multiplicationExpression=this.RULE("multiplicationExpression",(()=>{this.SUBRULE(this.exponentiationExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.MultiplicationOperator),this.SUBRULE2(this.exponentiationExpression,{LABEL:"rhs"})}))})),this.exponentiationExpression=this.RULE("exponentiationExpression",(()=>{this.SUBRULE(this.unaryExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.Caret),this.SUBRULE2(this.unaryExpression,{LABEL:"rhs"})}))})),this.unaryExpression=this.RULE("unaryExpression",(()=>{this.OPTION((()=>{this.CONSUME(this.formulaTokens.UnaryOperator)})),this.SUBRULE(this.primaryExpression),this.MANY((()=>{this.SUBRULE2(this.memberCallSubExpression)}))})),this.memberCallSubExpression=this.RULE("memberCallSubExpression",(()=>{this.OR([{ALT:()=>this.SUBRULE(this.dotMemberExpression)},{ALT:()=>this.SUBRULE(this.callArguments)}])})),this.dotMemberExpression=this.RULE("dotMemberExpression",(()=>{this.CONSUME(this.formulaTokens.Dot),this.OR([{ALT:()=>this.CONSUME(this.formulaTokens.IdentifierName)},{GATE:()=>{var e;const t=this.LA(1);return t.tokenType===this.formulaTokens.InputToken&&(null===(e=t.payload)||void 0===e?void 0:e.type)===a().FormulaTokenType.BlockProperty},ALT:()=>this.CONSUME(this.formulaTokens.InputToken)}])})),this.callArguments=this.RULE("callArguments",(()=>{this.CONSUME(this.formulaTokens.LParen),this.OPTION((()=>{this.SUBRULE(this.expression),this.MANY((()=>{this.CONSUME(this.formulaTokens.Comma),this.SUBRULE2(this.expression)}))})),this.CONSUME(this.formulaTokens.RParen)})),this.parenthesisExpression=this.RULE("parenthesisExpression",(()=>{this.CONSUME(this.formulaTokens.LParen),this.SUBRULE(this.expression),this.CONSUME(this.formulaTokens.RParen)})),this.arrayExpression=this.RULE("arrayExpression",(()=>{this.CONSUME(this.formulaTokens.LBracket),this.OPTION((()=>{this.SUBRULE(this.expression),this.MANY((()=>{this.CONSUME(this.formulaTokens.Comma),this.SUBRULE2(this.expression)}))})),this.CONSUME(this.formulaTokens.RBracket)})),this.formulaTokens=e,this.performSelfAnalysis()}}const d=o().Bj((e=>new l(e)));function c(e){const t=/unexpected character: ->(.+)<- at offset/.exec(e.message);if(null!==t)return{type:s().M9.InvalidCharacter,character:t[1],offset:e.offset};if("unclosed string literal"===e.message)return{type:s().M9.UnclosedStringLiteral,offset:e.offset};if("unclosed comment"===e.message)return{type:s().M9.UnclosedComment,offset:e.offset};throw new Error(`Unhandled chevrotain recognition error: ${e.message}`)}const y={RParen:")",RBracket:"]",Colon:":"};function m(e){const t=e.token.tokenType===r().LT?"eof":e.token.startOffset;switch(e.name){case"MismatchedTokenException":{const n=/Expecting token of type --> (.+) <-- but found/.exec(e.message);if(null!==n){const e=n[1],r=y[e];if(void 0!==r)return{type:s().M9.TokenExpected,token:r,offset:t}}break}case"NoViableAltException":{const n=e.context.ruleStack[e.context.ruleStack.length-1];switch(n){case"primaryExpression":return{type:s().M9.ExpressionExpected,offset:t};case"dotMemberExpression":return{type:s().M9.PropertyTokenOrFunctionExpected,offset:t}}throw new Error(`Unhandled unviable alt: ${n}`)}case"NotAllInputParsedException":return{type:s().M9.EndOfInputExpected,offset:t}}return{type:s().M9.UnexpectedError,error:new Error(`Unhandled chevrotain recognition error: ${e.name}`),offset:t}}},80979:(e,t,n)=>{n.r(t),n.d(t,{FormulaParsingInstrumentation:()=>p().nM,addTypesToFormulaAST:()=>s().y,addTypesToFormulaASTAsync:()=>s()._,analyzeFormula:()=>T,analyzeFormulaSync:()=>w,cleanFormulaTypecheckerErrors:()=>x,convertCollectionFormulaToFormula2:()=>c().Jb,convertFormulaCSTToAST:()=>l().f,createFormulaDataRequestSyncHandler:()=>i().zg,evaluateCollectionFormula2:()=>y().MC,evaluateCollectionFormula2WithoutCache:()=>y().kL,evaluateFormulaASTAsync:()=>a().cZ,evaluateFormulaProperty:()=>m().L7,evaluateRawCollectionFormula2:()=>y().UJ,executeFormulaAsync:()=>k,executeFormulaSync:()=>b,findFormulaTypecheckContextValue:()=>i().IV,formulaResultAndOldFormulaValueEqual:()=>i().bW,formulaValueToCollectionFormulaValue:()=>y().Y7,fromSerializedContextValueId:()=>i().y5,getFormula2Dependencies:()=>N,getFormula2ResultCache:()=>y().wr,getFormula2Thunk:()=>y().J6,getFormulaDependencies:()=>M,hasUniformType:()=>y().dA,isUniqueFormulaEvaluatorError:()=>i().R2,mapExecuteFormulaResult:()=>y().jA,parseFormulaInputToAst:()=>p().$t,parseFormulaInputToCst:()=>p().tP,primitiveFormulaValueFromPropertySchema:()=>y().LO,processFormulaInput:()=>d().kb,propertyToFormulaValue:()=>m().ws,propertyToFormulaValueAsString:()=>m().by,setFormula2ResultCache:()=>y().wZ,setFormula2Thunk:()=>y().rV,setFormulaParsingInstrumentation:()=>p().BC,textValueToFormulaTokens:()=>i().K5,timestampToFormulaValue:()=>m().NI});var r=()=>n(498212),o=()=>n(973647),a=()=>n(906063),s=()=>n(44738),i=()=>n(239381),u=()=>n(501053),p=()=>n(373907),l=()=>n(958970),d=()=>n(106714),c=()=>n(420062),y=()=>n(342581),m=()=>n(383969),f=(n(581454),()=>n(534177)),h=()=>n(349835);const v=Symbol("CleanedFormulaTypecheckerErrorInfo");function x(e){return e.map((e=>{return(0,f().GV)((t=e).type===h().IA.ThisRowTypeNotFound||t.type===h().IA.ThisRowNotBlockWithCollection?{type:t.type}:t.type===h().IA.ContextVariableNotBlockWithCollection?{type:t.type,token:t.token}:t.type===h().IA.MissingPropertyOnThisRow?{type:t.type,property:t.property}:t.type===h().IA.MissingPropertyOnContextVariable?{type:t.type,property:t.property,token:t.token}:t.type===h().IA.MissingContextVariable||t.type===h().IA.MissingBlock?{type:t.type,token:t.token}:t.type===h().IA.CallingNotFunction?{type:t.type,calleeKind:t.callee.kind}:t.type===h().IA.FunctionCallTooFewArguments?{type:t.type,libraryFunctionName:t.libraryFunction.name,numArguments:t.numArguments,minNumParameters:t.minNumParameters}:t.type===h().IA.FunctionCallUnexpectedArgument?{type:t.type,libraryFunctionName:t.libraryFunction.name,parameterIndex:t.parameterIndex}:t.type===h().IA.FunctionCallArgumentWrongType?{type:t.type,libraryFunctionName:t.libraryFunction.name,parameterName:t.expectedParameter.name}:t.type===h().IA.MemberPropertyMismatchCollection?{type:t.type,token:t.token.collection?t.token:{property:t.token.property}}:t.type===h().IA.MemberPropertyMissing?{type:t.type,textValproperty:t.property}:t.type===h().IA.MemberPropertyTargetNotBlock?{type:t.type,expressionKind:t.expression.kind}:t.type===h().IA.MemberPropertyTypeInvalid||t.type===h().IA.BlockPropertyTypeInvalid?{type:t.type,propertyName:t.propertyName,propertyType:t.propertyType}:t.type===h().IA.UndefinedIdentifier?{type:t.type,identifier:t.node}:t.type===h().IA.UnifiedFunctionCannotFindFunction?{type:t.type,name:t.name}:t.type===h().IA.UnifiedFunctionNoArguments?{type:t.type,libraryFunctionName:t.libraryFunction.name}:t.type===h().IA.UnifiedFunctionTargetWrongType?{type:t.type,libraryFunctionName:t.libraryFunction.name,expressionKind:t.expression.kind}:t.type===h().IA.CannotRelativelyCompareTypes?{type:t.type,lhsType:t.lhsType.type,rhsType:t.rhsType.type}:t.type===h().IA.CannotDoMathOnType?{type:t.type,nodeKind:t.node.kind,lhsType:t.lhsType.type,rhsType:t.rhsType.type}:t.type===h().IA.UnaryMinusOnNonNumber?{type:t.type,nodeKind:t.node.kind}:t.type===h().IA.IdentifierExpected?{type:t.type,startOffset:t.node.startOffset}:t.type===h().IA.FunctionCallExpected?{type:t.type,startOffset:t.node.startOffset,functionName:t.functionName}:t.type===h().IA.RenamedIdentifier?{type:t.type,identifier:t.identifier,renamedTo:t.renamedTo}:t.type===h().IA.RemovedFunction?{type:t.type,functionName:t.functionName,alternative:t.alternative}:t.type===h().IA.DisallowedReturnType?{type:t.type,startOffset:t.node.startOffset,returnType:t.returnType.type,allowedReturnTypes:t.allowedReturnTypes.map((e=>e.type))}:t.type===h().IA.CrossSpacePropertyNotSupported?{type:t.type,property:t.property}:t.type===h().IA.CalledFunctionOnEmptyValue?{type:t.type,startOffset:t.node.startOffset,functionName:(null===(n=t.libraryFunction)||void 0===n?void 0:n.name)??null}:t.type===h().IA.InvalidPropCall||t.type===h().IA.InvalidContextCall||t.type===h().IA.InvalidVariableCall?{type:t.type,name:t.name}:t.type===h().IA.CallingFunctionWithUnknownArgument?{type:t.type,startOffset:t.node.startOffset,functionName:t.libraryFunction.name,parameterIndex:t.parameterIndex}:t.type===h().IA.CallingFunctionWithUnknownTarget?{type:t.type,startOffset:t.node.startOffset,functionName:t.libraryFunction.name}:void(0,f().HB)(t),v);var t,n}))}function g(e){return e.exists}function b(e,t){var n;const s=(0,p().$t)(e);if(o().Q.isFail(s))return s;const i=(0,r().Ay)(),u={...t,formulaEvaluationId:i},l=(0,a().Ox)(t),d=(0,a().PX)(l,s.value);if(o().Q.isFail(d))return d;const c=(0,a().YQ)(d.value,u);return null===(n=u.logFormulaStatsFn)||void 0===n||n.call(u,{formulaEvaluationId:i,commitPerRowStats:!0}),c}async function k(e,t){var n;const s=(0,p().$t)(e);if(o().Q.isFail(s))return s;const i=(0,r().Ay)(),u={...t,formulaEvaluationId:i},l=(0,a().Ox)(t),d=(0,a().PX)(l,s.value);if(o().Q.isFail(d))return d;const c=await(0,a().Xs)(d.value,u);return null===(n=u.logFormulaStatsFn)||void 0===n||n.call(u,{formulaEvaluationId:i,commitPerRowStats:!0}),c}async function T(e,t){const n=(0,p().$t)(e);if(o().Q.isFail(n))return{value:{parseErrors:[n.error]}};const r=await(0,s()._)(n.value,t),{node:a,errors:i,warnings:u}=r;return{value:{type:a.type,typeErrors:i,typeWarnings:u,resultExists:g(a)}}}function w(e,t){const n=(0,p().$t)(e);if(o().Q.isFail(n))return{parseErrors:[n.error]};const r=(0,s().y)(n.value,t),{node:a,errors:i,warnings:u}=r;return{type:a.type,typeErrors:i,typeWarnings:u,resultExists:g(a)}}function M(e){return"formula"!==e.type?[]:"v2"===e.version?e.formula2?N(e.formula2.code):[]:(0,u().kh)(e.formula)}function N(e){const t=(0,p().$t)(e);return o().Q.isFail(t)?[]:(0,i().Mu)(t.value)}},96033:(e,t,n)=>{n.d(t,{V:()=>o,o:()=>a});n(16280);var r=()=>n(220719);class o extends Error{constructor(e){super(`Violated invariant in the formula compiler: ${e}`)}}function a(e,t="expected value to exist"){return r().o9(e,t,void 0,o)}},264435:(e,t,n)=>{n.d(t,{o4:()=>p,u:()=>s});n(944114),n(898992),n(803949);var r=()=>n(534177);const o={LLLL:"DDDD t",llll:void 0,LLL:"DDD t",lll:"DD t",LL:"DDD",ll:"DD",L:void 0,l:void 0,LT:"t",LTS:"tt",M:"L",Mo:void 0,MM:"LL",MMM:void 0,MMMM:void 0,Q:"q",Qo:void 0,D:"d",Do:void 0,DD:"dd",DDD:"o",DDDo:void 0,DDDD:"ooo",d:void 0,do:void 0,dd:void 0,ddd:void 0,dddd:"cccc",e:void 0,E:"c",w:void 0,wo:void 0,ww:void 0,W:"W",Wo:void 0,WW:"WW",YY:"yy",YYYY:"yyyy",YYYYYY:void 0,Y:"y",gg:"kk",gggg:"kkkk",GG:"kk",GGGG:"kkkk",A:"a",a:void 0,H:"H",HH:"HH",h:"h",hh:"hh",k:void 0,kk:void 0,m:"m",mm:"mm",s:"s",ss:"ss",S:"uuu",SS:"uu",SSS:"SSS",z:void 0,zz:void 0,Z:"ZZ",ZZ:"ZZZ",X:"X",x:"x"};const a=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|LTS|LT|LL?L?L?|l{1,4}|.)/g;function s(e,t){let n=[];const s=[],l=e.locale.substring(0,2),d=t=>{if(n.length>0){const t=n.join("");s.push(e.toFormat(t)),n=[]}t&&s.push(t)},c=t.match(a);return c?(c.forEach((t=>{if(o[t])n.push(o[t]);else if((a=t)in o&&void 0===o[a])switch(t){case"llll":"en"===l?n.push("ccc, DD t"):"ja"===l?n.push("DD(ccc) t"):"ko"===l?n.push("DD cccc t"):"de"===l?n.push("ccc., DD t"):n.push("ccc DD t");break;case"L":"ko"===l?n.push("yyyy.MM.dd."):d(e.toLocaleString({day:"2-digit",month:"2-digit",year:"numeric"}));break;case"l":"ja"===l?d(e.toLocaleString({day:"2-digit",month:"2-digit",year:"numeric"})):"ko"===l?n.push("yyyy.MM.dd."):"fr"===l?n.push("d/M/y"):n.push("D");break;case"MMM":"ja"===l?d(e.toLocaleString({month:"long"})):n.push("LLL");break;case"MMMM":"ja"===l?d(e.toLocaleString({month:"long"})):n.push("LLLL");break;case"e":if("fr"===l||"de"===l){d((e.weekday-1).toString());break}case"d":case"do":const a=7===e.weekday?0:e.weekday;if("do"===t){const e=p(l,a,"c");if(e){d(e);break}}d(a.toString());break;case"dd":d(e.weekdayShort.substring(0,2));break;case"ddd":"de"===l?n.push("ccc."):n.push("ccc");break;case"ww":if("fr"===l||"de"===l){n.push("WW");break}case"w":case"wo":const s=function(e,t){if("fr"===t||"de"===t)return e.weekNumber;const n=e.set({month:1,day:1});if(u(e,n)||u(e,n.set({year:e.year+1})))return 1;return i(e)}(e,l);if("wo"===t){const e=p(l,s,"W");if(e){d(e);break}}const c="ww"===t?s.toString().padStart(2,"0"):s.toString();d(c);break;case"YYYYYY":d(`+${e.year.toString().padStart(6,"0")}`);break;case"a":d(e.toFormat("a").toLowerCase());break;case"k":0===e.hour?d("24"):n.push("H");break;case"kk":0===e.hour?d("24"):n.push("HH");break;case"Mo":case"Qo":case"Do":case"DDDo":case"Wo":const y=o[t.replace("o","")],m=function(e,t,n){const r=t.toFormat(n),o=parseInt(r);if(isNaN(o))return;return p(e,o,n)}(l,e,y);m?d(m):n.push(y);break;case"z":case"zz":const f=e.zone.offsetName(e.toMillis(),{format:"short",locale:"en-US"});d(f);break;default:(0,r().HB)(t)}else/^S{4,9}/.test(t)?n.push("SSS"):/^\[.*\]$/.test(t)?d(t.substring(1,t.length-1)):d(t.replace(/\\/g,""));var a})),d(),s.join("")):e.toFormat(t)}function i(e){if(7===e.weekday)return i(e.plus({days:1}));const t=e.set({month:1,day:1}),n=e.set({month:1,day:4});if(t.weekNumber!==n.weekNumber){if(1!==(7===t.weekday?e.set({month:1,day:2}).weekNumber:t.weekNumber))return e.weekNumber+1}return e.weekNumber}function u(e,t){const n=7===e.weekday?e.plus({days:1}):e,r=7===t.weekday?t.plus({days:1}):t;return n.hasSame(r,"week")}function p(e,t,n){switch(e){case"en":case"en-GB":return l(t);case"fr":return function(e,t){switch(t){case"d":return e+(1===e?"er":"");case"W":return e+(1===e?"re":"e");default:return e+(1===e?"er":"e")}}(t,n);case"de":case"fi":case"da":case"no":return`${t}.`;case"ja":return function(e,t){switch(t){case"y":return 1===e?"元年":`${e}年`;case"d":case"c":case"o":return`${e}日`;default:return e.toString()}}(t,n);case"ko":return function(e,t){switch(t){case"d":case"c":case"o":return`${e}일`;case"L":return`${e}월`;case"W":return`${e}주`;default:return e.toString()}}(t,n);case"ps":return`[!!!${l(t)}!!!]`;case"es":case"es-419":case"pt":return function(e,t){switch(t){case"d":case"c":case"o":return`${e}.º`;case"W":return`${e}.ª`;default:return e.toString()}}(t,n);case"nl":return`${t}e`;case"sv":return`${t}`;case"zh":case"zh-TW":return function(e,t){switch(t){case"d":case"c":case"o":return`${e} 日`;case"L":return`${e} 月`;case"W":return`${e} 周`;case"y":return 1===e?"元年":`${e} 年`;default:return e.toString()}}(t,n);case"vi-VN":return function(e,t){switch(t){case"d":case"c":case"o":case"W":case"L":return`thứ ${e}`;default:return e.toString()}}(t,n);case"id-ID":return function(e,t){switch(t){case"d":case"c":case"o":case"W":case"L":return`ke-${e}`;default:return e.toString()}}(t,n);case"th-TH":return function(e,t){switch(t){case"d":case"c":case"o":case"W":case"L":return`ที่ ${e}`;default:return e.toString()}}(t,n);default:return}}function l(e){const t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}},307663:(e,t,n)=>{n.d(t,{xK:()=>L,Fd:()=>M,x3:()=>I,P7:()=>T,SU:()=>b,KN:()=>R,R:()=>C,Py:()=>H,HH:()=>K,Y2:()=>j,pC:()=>z,hq:()=>k,_2:()=>P,iZ:()=>A,Hx:()=>W,kk:()=>O,tr:()=>Z,m8:()=>$,qs:()=>_,ZV:()=>U,fr:()=>B});n(18107),n(944114),n(967357),n(898992),n(823215),n(354520),n(672577),n(430670),n(803949),n(581454),n(737550);var r=n.n(n(794148)),o=()=>n(100622),a=()=>n(496603),s=()=>n(713998),i=()=>n(835195),u=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),()=>n(450648)),p=()=>n(201980);var l=()=>n(597777),d=()=>n(604995),c=()=>n(992437),y=()=>n(72135),m=()=>n(510916),f=()=>n(906063),h=()=>n(247331),v=()=>n(696446),x=()=>n(349835),g=()=>n(239381);function b(e,t,n){return{name:e,*eval(e,t){return{type:"number",value:n}},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:`${e}()`,output:n.toString()}]],syntax:[`${e}()`],description:t}}function k(e,t,n,o){const a=o.map((t=>({input:`${e}(${t})`,output:`${n(t)}`}))),s=o.map((t=>({input:`${t}.${e}()`,output:`${n(t)}`})));return{name:e,*eval(e,t){const[o]=e;return r()("number"===o.type),{type:"number",value:n(o.value)}},parameters:{expected:[{name:"input",type:{type:"number"}}]},returnType:{type:"number"},iconType:{type:"number"},examples:[a,s],syntax:[`${e}(number)`,`number.${e}()`],description:t}}function T(e,t,n,o){return{name:e,*eval(t,o){let[a,s]=t;if(h().TREAT_UNDEFINED_AS_ZERO_FNS.includes(e)){if("undefined"===a.type&&"undefined"===s.type)return{type:"number",value:0};"undefined"===a.type&&"number"===s.type?a={type:"number",value:0}:"undefined"===s.type&&"number"===a.type&&(s={type:"number",value:0})}return r()("number"===a.type&&"number"===s.type),{type:"number",value:n(a.value,s.value)}},parameters:{expected:[{name:"lhs",type:{type:"number"}},{name:"rhs",type:{type:"number"}}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:`${e}(5, 10)`,output:`${n(5,10)}`},{input:`5 ${o} 10`,output:`${n(5,10)}`}],[{input:`5.${e}(10)`,output:`${n(5,10)}`},{input:`5 ${o} 10`,output:`${n(5,10)}`}]],syntax:[`${e}(number, number)`,`number.${e}(number)`],description:t}}const w=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"];function*M(e,t,n){let r=yield*(0,g().o7)(e,t);if("s"!==r.at(-1)&&(r+="s"),!w.includes(r.toLowerCase()))throw new(x().x4)({type:x().v3.DateInvalidDurationUnit,invalidUnit:r,functionName:n});return r}const N=[...y().PA,"compact","bytes","bytes_binary","bytes_decimal"],E={humanize:"compact",commas:"number_with_commas",bytes:"bytes_binary"};for(const[Q,J]of Object.entries(y().bH))E[Q.toLowerCase()]=J;function*I(e,t){const n=yield*(0,g().o7)(e,t),r=n.toLowerCase(),o=E[r]||r;if(!N.includes(o))throw new(x().x4)({type:x().v3.NumberFormatInvalid,invalidFormat:n});return o}function C(e,t){return function*(n,o){const[a,s,i]=n;r()("date"===a.type&&"number"===s.type&&"text"===i.type);const u="datetime"===a.value.type||"datetimerange"===a.value.type?a.value.time_zone:o.userTimeZone,p=(0,d().AA)(a.value,u),l=yield*M(i.value,o,t),c=e(p.start,s.value,l),y="hours"===l||"minutes"===l||"seconds"===l||"milliseconds"===l;return{type:"date",value:"date"!==a.value.type&&"daterange"!==a.value.type||y?(0,d().KQ)(c,u):(0,d().p6)(c,u)}}}function R(e){return function*(t,n){const[o]=t;r()("date"===o.type);const a=(0,d().kW)(o.value,n.userTimeZone);return{type:"number",value:e((0,d().AA)((0,l().j1)(a),n.userTimeZone,n.intl.locale).start)}}}function*A(e,t){try{return yield*function*(e,t){return yield*(0,f().RE)(e.instructions,t)}(e,t)}catch(n){if(n instanceof x().I3&&n.info.type===x().uW.DepthExceeded)throw n;return{type:"undefined"}}}function P(e,t,n){return(0,v().KZ)(e.map(((e,r)=>A(t,{...n,values:[{kind:h().FormulaContextValueKind.Binding,id:h().CURRENT_VALUE_NAME,value:e},{kind:h().FormulaContextValueKind.Binding,id:h().CURRENT_INDEX_NAME,value:{type:"number",value:r}},...n.values]}))))}const F={b:["b"],i:["i"],s:["s"],u:["_"],c:["c"]},S=["b","i","s","_","c","h"];function O(e){const t=[];return e.forEach((e=>{var n;const r=null==e||null===(n=e[0])||void 0===n?void 0:n[0].toLowerCase().split(",");for(const o of r){const e=D(o);if(e)t.push(e);else{const e=F[o];e&&t.push(e)}}})),t}function L(e,t){return e.map((e=>{const n=(0,p().uPN)(e);return(0,p().Ey_)((0,p().N8A)(e),[...n,...t])}))}function _(e,t){return e.map((e=>(0,p().Ey_)((0,p().N8A)(e),(0,p().uPN)(e).filter((e=>{const n=(0,p()._XS)(e);return!S.includes(n)||void 0!==t&&!t.some((t=>n===t[0]&&(void 0===t[1]||e[1]===t[1])))})))))}function D(e){const t=o().Wr.find((t=>t===e));return t?[p().Ifu.Highlight,t]:"green"===e?[p().Ifu.Highlight,"teal"]:"green_background"===e?[p().Ifu.Highlight,"teal_background"]:"grey"===e?[p().Ifu.Highlight,"gray"]:"grey_background"===e?[p().Ifu.Highlight,"gray_background"]:void 0}function*U(e,t){if(q(e))return e.sort(((e,n)=>V({left:e,right:n,context:t})));const n=(0,a().oE)(e.flatMap((e=>(0,g().vu)(e)))),r=n.length?(yield{recordPointers:n}).getRecordModel:c().b.constant(void 0),o=e.map((e=>(0,i().R2)({result:e,getRecordModel:r,userTimeZone:t.userTimeZone,intl:t.intl,useImprovedSort:!0})));return(0,a().yU)(e,o).sort(((e,n)=>(0,i().a7)(e[1],n[1],{intl:t.intl,useIntl:Boolean(t.collectionFeatureGates.collections_text_sort_locale_collator)}))).map((([e])=>e))}function*B(e,t,n){const r=yield*P(e,t,n);if(q(r)){return(0,a().yU)(e,r).sort(((e,t)=>V({left:e[1],right:t[1],context:n}))).map((([e])=>e))}const o=(0,a().oE)(r.flatMap((e=>(0,g().vu)(e)))),s=o.length?(yield{recordPointers:o}).getRecordModel:c().b.constant(void 0),u=r.map((e=>(0,i().R2)({result:e,getRecordModel:s,userTimeZone:n.userTimeZone,intl:n.intl,useImprovedSort:!0})));return(0,a().yU)(e,u).sort(((e,t)=>(0,i().a7)(e[1],t[1],{intl:n.intl,useIntl:Boolean(n.collectionFeatureGates.collections_text_sort_locale_collator)}))).map((([e])=>e))}const G=["number","date","checkbox","undefined"];function q(e){let t;return e.every((e=>"undefined"===e.type||(void 0===t?!!G.includes(e.type)&&(t=e.type,!0):t===e.type)))}function V(e){const{left:t,right:n,context:r}=e;return"date"===t.type&&"date"===n.type?(0,g().i3)(t.value,n.value,r.userTimeZone):"number"===t.type&&"number"===n.type?t.value-n.value:"checkbox"===t.type&&"checkbox"===n.type?t.value===n.value?0:t.value?1:-1:"undefined"===t.type?"undefined"===n.type?0:1:"undefined"===n.type?-1:0}function W(e){const t=[];for(const n of e)if("array"===n.type){const e=W(n.values);t.push(...e)}else"number"===n.type&&t.push(n.value);return t}function $(e){const{timeZone:t,context:n}=e;if("text"===(null==t?void 0:t.type)){const e=(0,p().k4p)(t.value);if(e.startsWith("GMT")&&e.length>3){return`Etc/GMT${"-"===e[3]?"+":"-"}${e.slice(4)}`}return e}return n.userTimeZone}function*Z(e,t,n,r,o){const a=yield*Y(e,o,{disableAnnotationPrefix:!1}),s=yield*Y(n,o),i=Math.min(Math.floor(t),1e4),u=(0,p().AhH)(a);if(u>=t)return{type:"text",value:e};const l=(0,p().AhH)(s),d=i-u,c=l>0?Math.floor(d/l):0,y=d%l,m=[];"end"===r&&m.push(...e);for(let p=0;p<c;p++)m.push(...s);return y>0&&m.push(...(0,p().AI5)(s,0,y).tokensInsideRange),"start"===r&&m.push(...e),{type:"text",value:(0,p().__s)(m)}}function*Y(e,t,n){const r=(0,s().dg)(e);return function(e){const{textValue:t,getRecordModel:n,userTimeZone:r,intl:o,seenBlocks:a=new Set,deterministic:s=!1,disableAnnotationPrefix:i=!1,disableInsertedAnnotations:l=!1,renderDateAnnotationsAsISO:d=!1,externalIntegrations:c}=e,y=[],m=i?"":"@",f=p().RQ(t);for(const h of f){const e=p().uPN(h);if(!e.length){y.push(h);continue}const i=(0,u().t2)({token:h,getRecordModel:n,userTimeZone:r,deterministic:s,intl:o,seenBlocks:a,prefix:m,disableInsertedAnnotations:l,renderDateAnnotationsAsISO:d,externalIntegrations:c}),f=(0,u().Px)(e,l);(null!=t&&t.length||f.length)&&y.push((0,p().Ey_)(i??"",f))}return y}({textValue:e,getRecordModel:r.length?(yield{recordPointers:r}).getRecordModel:c().b.constant(void 0),userTimeZone:t.userTimeZone,deterministic:!0,intl:t.intl,disableAnnotationPrefix:!0,...n})}function H(e){return(0,p().wmz)((0,p().ESw)({collection:void 0,name:e,property:e}))}function z(e){return(0,p().wmz)((0,p().ESw)({collection:void 0,name:(0,m().i)(e),property:e}))}function j(e){return(0,p().wmz)((0,p().ESw)(e))}function K(e){return(0,p().wmz)((0,p().CA$)(e))}},342581:(e,t,n)=>{n.d(t,{J6:()=>M,LO:()=>N,MC:()=>f,UJ:()=>v,Y7:()=>b,dA:()=>k,jA:()=>g,kL:()=>h,rV:()=>w,wZ:()=>E,wr:()=>I});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(823215),n(354520),n(581454);var r=()=>n(496603),o=()=>n(973647),a=()=>n(835195),s=()=>n(632905),i=()=>n(869190),u=()=>n(236162),p=()=>n(792071),l=()=>n(247331),d=()=>n(80979),c=()=>n(349835),y=()=>n(239381),m=()=>n(383969);function f(e){const{block:t,property:n,getRecordModel:r,formula2Error:a,resultCache:s,logFormulaStatsFn:i}=e,d=performance.now(),y=I({resultCache:s,blockId:t.id,property:n});if(void 0!==y)return null==i||i({executionTimeMs:performance.now()-d,cachedCount:1}),b(y);const m=(0,u().zN)({block:t,getRecordModel:r}),f=p().Bj6.fromValue("collection",m);if(!f)return;const v=M({blockModel:t,collectionVersion:f.getVersion(),propertyId:n});if(v){"undefined"==typeof window&&(null==i||i({error:"collection_formula_evaluator_got_thunk_on_server"}));const e=v();if(e&&e!==l().FORMULA_LOADING)return o().Q.isFail(e)?(null==i||i({executionTimeMs:performance.now()-d,cachedCount:1,error:e.error.type}),void(null===(null==a?void 0:a.error)&&(0,c().Lc)(e.error)&&(a.error=new(c().I3)(e.error)))):e.value}const x=h({...e,logFormulaStatsFn:i});if(null==i||i({executionTimeMs:performance.now()-d,uncachedCount:1}),!x)return;const k=g(x);return o().Q.isFail(k)?(null==i||i({error:k.error.type}),void(null===(null==a?void 0:a.error)&&(0,c().Lc)(k.error)&&(a.error=new(c().I3)(k.error)))):k.value}function h(e){const t=x(e);if(t)return g(t)}function v(e){return x(e)}function x(e){const{block:t,formulaCode:r,property:o,getRecordModel:a,intl:s,userTimeZone:i,depth:u,visitedProperties:p,formulaTimeoutTimestampMs:c,logFormulaTimeoutFn:m,publicPageDataCollection:f,resultCache:h,regExpCache:v,formatDateCache:x,experimentService:g,collectionFeatureGates:b,spaceIdCreator:k,logFormulaStatsFn:T}=e;if(!n(80979))return;const w={values:[{kind:l().FormulaContextValueKind.ThisRow,value:{type:"block",value:t.pointer}}],handleDataRequest:(0,y().zg)(a),intl:s,userTimeZone:i,depth:u,visitedProperties:p,formulaTimeoutTimestampMs:c,logFormulaTimeoutFn:m,resultCache:h,regExpCache:v,formatDateCache:x,publicPageDataCollection:f,experimentService:g,spaceId:t.space_id,collectionFeatureGates:b,spaceIdCreator:k,logFormulaStatsFn:T},M=(0,d().executeFormulaSync)(r,w);return"value"in M&&E({resultCache:h,blockId:t.id,property:o,value:M.value}),M}function g(e){return o().Q.isFail(e)?e:{value:b(e.value)}}function b(e){if("function"===e.type)return{type:"undefined"};if("array"===e.type){var t;if(0===e.values.length)return{type:"undefined"};const n={type:"array",values:(0,y().U)(e).values.filter((e=>"undefined"!==e.type))};if(!k(n)){const e=r().oE(n.values.map((e=>{if("array"!==e.type)return{type:"text",value:(0,y().Ht)(e)}})));return{type:"array",values:e}}return"function"===(null===(t=n.values[0])||void 0===t?void 0:t.type)?{type:"undefined"}:n}return e}function k(e){return 0===e.values.length||e.values.every((t=>t.type===e.values[0].type))}const T=new WeakMap;function w(e){const{blockModel:t,collectionVersion:n,propertyId:r,thunkCallback:o}=e,a=T.get(t),s={collectionVersion:n,thunkCallback:o};void 0===a?T.set(t,{[r]:s}):a[r]=s}function M(e){const{blockModel:t,collectionVersion:n,propertyId:r}=e,o=T.get(t),a=null==o?void 0:o[r];return a?a.collectionVersion!==n?void delete o[r]:a.thunkCallback:void 0}function N({schema:e,property:t,blockModel:n,getRecordModel:r,intl:o,userTimeZone:s,depth:u,resultCache:p,regExpCache:l,formatDateCache:d,formulaTimeoutTimestampMs:c,visitedProperties:y,formula2Error:h,experimentService:v,shouldUsePersistedDates_ONLY_LEGACY_FORMULAS:x,collectionFeatureGates:g,spaceIdCreator:b,getRelationEdgeList:k}){const T=e[t];if("v2"===T.version){if(!T.formula2)return;const e=f({block:n,property:t,formulaCode:T.formula2.code,getRecordModel:r,intl:o,userTimeZone:s,depth:u,visitedProperties:y??new Set,formulaTimeoutTimestampMs:c,formula2Error:h,resultCache:p,regExpCache:l,formatDateCache:d,experimentService:v,collectionFeatureGates:g,spaceIdCreator:b});if(!e)return;return"date"===e.type?x?e.value:(0,i().ZF)({value:e.value,userTimeZone:s,intl:o,allowRelativeDates:!1}):(0,a().R2)({result:e,getRecordModel:r,userTimeZone:s,intl:o})}{const{formula:a}=T;if(a)return(0,m().L7)({schema:e,property:t,block:n,getRecordModel:r,collectionRequestContext:{userId:void 0,userTimeZone:s,depth:u,intl:o,resultCache:p,regExpCache:l,formatDateCache:d,visitedProperties:y??new Set,formulaTimeoutTimestampMs:c,experimentService:v,collectionFeatureGates:g,getRelationEdgeList:k},formula2Error:h,spaceIdCreator:b})}}function E({resultCache:e,blockId:t,property:n,value:r}){const o=e.get(t)??new Map;o.set(`${n}:${s().A.FormulaValue2}`,r),e.set(t,o)}function I({resultCache:e,blockId:t,property:n}){var r;return null===(r=e.get(t))||void 0===r?void 0:r.get(`${n}:${s().A.FormulaValue2}`)}},373907:(e,t,n)=>{n.d(t,{$t:()=>f,BC:()=>m,nM:()=>c,tP:()=>l});n(16280),n(944114),n(898992),n(354520);var r=()=>n(534177),o=()=>n(165358),a=()=>n(958970),s=()=>n(247331),i=()=>n(106714),u=()=>n(44907),p=()=>n(349835);function l(e,t){const n=(0,u().p8)(),r=(0,u().TM)(n).tokenize(e),a=[];for(const o of r.errors)a.push((0,u().Q7)(o));for(const o of r.tokens.filter((e=>e.tokenType===n.UnclosedStringLiteral||e.tokenType===n.UnclosedComment)))a.push({type:o.tokenType===n.UnclosedStringLiteral?p().M9.UnclosedStringLiteral:p().M9.UnclosedComment,offset:t?(0,i().c3)(t,o.startOffset,"left"):o.startOffset});for(const o of r.tokens.filter((e=>e.tokenType===n.StringLiteral)))s().FORMULA_TOKEN_REGEX.test(o.image)&&a.push({type:p().M9.StringLiteralContainsToken,offset:t?(0,i().c3)(t,o.startOffset,"left"):o.startOffset});try{const e=(0,u()._M)(n);e.input=r.tokens;const t=e.expression();for(const n of e.errors)a.push((0,u().Ps)(n));return[t,a]}catch(l){if(l instanceof RangeError&&"Maximum call stack size exceeded"===l.message)a.push({type:p().M9.TooDeeplyNested,offset:0});else{const e=l instanceof Error?l:new Error("Unknown parsing error");o().log({level:"error",from:"parseFormulaInputToCst",type:"formulaParserUnexpectedError",error:e}),a.push({type:p().M9.UnexpectedError,offset:0,error:e})}return[{name:"",children:{}},a]}}const d=new WeakMap;class c{constructor(){this.debug=!1}logCacheResult(e,t){this.incrMetric(t?"formulas.parsing.weak_map_cache.hit":"formulas.parsing.weak_map_cache.miss")}incrMetric(e){this.debug&&console.log(e),this.incrMetricImpl(e)}}let y;function m(e){y||(y=e())}function f(e){var t;let n=d.get(e);if(null===(t=y)||void 0===t||t.logCacheResult(e,(0,r().O9)(n)),void 0!==n)return n;const[o,s]=(0,i().kb)(e),[u,p]=l(o);return n=p.length>0?{error:p[0]}:(0,a().f)(u),(0,r().O9)(e)&&d.set(e,n),n}},383969:(e,t,n)=>{n.d(t,{L7:()=>b,NI:()=>N,by:()=>I,ws:()=>T});n(16280),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(581454);var r=()=>n(496603),o=()=>n(806080),a=()=>n(534177),s=()=>n(764880),i=()=>n(302322),u=()=>n(713998),p=()=>n(568063),l=()=>n(632905),d=()=>n(597777),c=()=>n(869190),y=()=>n(604995),m=()=>n(792071),f=()=>n(201980),h=()=>n(80979),v=()=>n(349835),x=()=>n(565775);const g=15;function b(e){const{schema:t,property:n,block:s,getRecordModel:i,collectionRequestContext:u,formula2Error:p,spaceIdCreator:c}=function(e){return"getRecordModel"in e?e:{...e,block:m().Bj6.fromBlock(e.block),getRecordModel:m().b4_.fromGetRecordValueFn(e.getRecordValue)}}(e),{depth:y,resultCache:f,visitedProperties:h,formulaTimeoutTimestampMs:x,logFormulaTimeoutFn:b}=u,T=t[n];if(!T||"formula"!==T.type||!T.formula)return;const{formula:w}=T;if(y>g)return void(null===(null==p?void 0:p.error)&&(p.error=new(v().I3)({type:v().uW.DepthExceeded})));const M=`${s.id}:${n}`;if(h.has(M))return void(null===(null==p?void 0:p.error)&&(p.error=new(v().I3)({type:v().uW.CycleDetected})));const N=function({resultCache:e,blockId:t,property:n}){var r;return null===(r=e.get(t))||void 0===r?void 0:r.get(`${n}:${l().A.FormulaValue}`)}({resultCache:f,blockId:s.id,property:n});if(void 0!==N)return N;if(x&&Date.now()>x)return b&&b(),void(null===(null==p?void 0:p.error)&&(p.error=new(v().I3)({type:v().uW.MaxEvaluationTimeExceeded})));const E=new Set(h);E.add(M);try{let e=k({formula:w,schema:t,block:s,getRecordModel:i,collectionRequestContext:{...u,visitedProperties:E},formula2Error:p,spaceIdCreator:c});if(!("date"!==w.result_type||(0,a().Gv)(e)&&(0,d().cW)(e.type)))return;if((0,o().Et)(e)){if(!r().MI(e))return;e=r().LI(e,12)}return function({resultCache:e,blockId:t,property:n,value:r}){const o=e.get(t)??new Map;o.set(`${n}:${l().A.FormulaValue}`,r),e.set(t,o)}({resultCache:f,blockId:s.id,property:n,value:e}),e}catch(I){console.error(I)}}function k(e){const{formula:t,schema:n,block:r,getRecordModel:o,collectionRequestContext:a,formula2Error:s,spaceIdCreator:i}=function(e){return"getRecordModel"in e?e:{...e,block:m().Bj6.fromBlock(e.block),getRecordModel:m().b4_.fromGetRecordValueFn(e.getRecordValue)}}(e),{userTimeZone:u,intl:p}=a;if("conditional"===t.type)return k({formula:t.condition,schema:n,block:r,getRecordModel:o,collectionRequestContext:a,formula2Error:s,spaceIdCreator:i})?k({formula:t.true,schema:n,block:r,getRecordModel:o,collectionRequestContext:a,formula2Error:s,spaceIdCreator:i}):k({formula:t.false,schema:n,block:r,getRecordModel:o,collectionRequestContext:a,formula2Error:s,spaceIdCreator:i});if("constant"===t.type){const{value:e,value_type:n}=t;return"string"===n?e:"number"===n?parseFloat(e):"boolean"===n?Boolean(JSON.parse(e)):void 0}if("function"===t.type){const{args:e}=t,l=(e||[]).map((e=>k({formula:e,schema:n,block:r,getRecordModel:o,collectionRequestContext:a,formula2Error:s,spaceIdCreator:i}))),d=x().N9(t.name),c=x().F5(t.name);return d?d.apply(l,u,p,r):c?c.apply(l,u,p,r):void 0}if("property"===t.type)return T({property:t.id,schema:n,block:r,getRecordModel:o,collectionRequestContext:a,formula2Error:s,spaceIdCreator:i});if("operator"===t.type){const{args:e,name:l}=t,d=(e||[]).map((e=>k({formula:e,schema:n,block:r,getRecordModel:o,collectionRequestContext:a,formula2Error:s,spaceIdCreator:i}))),c=x().F5(l);if(!c)return;return c.apply(d,u,p,r)}if("symbol"===t.type){const{name:e}=t;if(e in x().AA)return x().AA[e].value}}function T(e){const t=function(e){return"getRecordModel"in e?e:{...e,block:m().Bj6.fromBlock(e.block),getRecordModel:m().b4_.fromGetRecordValueFn(e.getRecordValue)}}(e),{property:n,schema:r}=t,o=r[n];if(o)return E[o.type](t)}function w(e){const{property:t,block:n}=e,r=u().yQ(n,t)||[];return f().k4p(r)}function M(e){const{property:t,block:n}=e,r=u().yQ(n,t)||[];return u().MO(r)}function N(e){const{timestampType:t,block:n,userTimeZone:r}=e;if("created_time"===t){if(n.getCreatedTime())return y().KQ(n.getCreatedTime(),r)}else if("last_edited_time"===t){if(n.getLastEditedTime())return y().KQ(n.getLastEditedTime(),r)}else(0,a().HB)(t)}const E={title:w,text:w,url:M,email:M,phone_number:M,select:({property:e,schema:t,block:n})=>{const r=u().yQ(n,e)||[],o=t[e].options||[];return u().L3(r,o)},multi_select:({property:e,schema:t,block:n})=>{const r=u().yQ(n,e)||[],o=t[e].options||[];return u().o2(r,o).join(", ")},status:({property:e,schema:t,block:n})=>{const r=u().yQ(n,e)||[],o=t[e];return u().RZ(r,o)},checkbox:({property:e,block:t})=>{const r=u().yQ(t,e)||[];return(0,n(657970).w)(r)},date:({property:e,block:t})=>{const r=u().yQ(t,e)||[];return(0,n(187696).b)(r)},person:({property:e,block:t,getRecordModel:r,schema:o,collectionRequestContext:a})=>{const{intl:i}=a,p=u().yQ(t,e)||[],l=o[e],d=m().Bj6.fromBlock(t);return(0,n(363170).e)({textValue:p,propertySchema:l,blockCreatorPointer:d.getCreatedByPointer(),convertGroupPointersToBeComposite:!0}).map((e=>{if(e.table===n(437607).n){const t=r(e);return(0,n(914462).n)({intl:i,permissionGroupModel:t})}return(0,s().lR)(i,(0,s().xC)({pointer:e,getRecordModel:r}))})).join(", ")},relation:({property:e,block:t,getRecordModel:n,schema:r})=>{const o=u().yQ(t,e)||[],a=r[e];if(!a||"relation"!==a.type)return;return u().bG({relationValue:u().n(o),propertySchema:a,getRecordModel:n,includeNoAccess:!1}).map((e=>{const t=n(e);if(!t)return;const r=u().yQ(t,"title");return r?f().k4p(r):void 0})).join(", ")},rollup:e=>{const{property:t,schema:n,block:r,getRecordModel:o,collectionRequestContext:s,spaceIdCreator:i}=e,u=n[t];if(!u||"rollup"!==u.type||!u.aggregation||"show_unique"===u.aggregation)return p().I({property:t,schema:n,block:r,getRecordModel:o,collectionRequestContext:s,formulasModule:h(),spaceIdCreator:i});{const e=p().Pm({property:t,schema:n,block:r,getRecordModel:o,collectionRequestContext:s,formulasModule:h(),spaceIdCreator:i});if(void 0===e)return;if("text"===e.type)return e.value;if("number"===e.type)return e.value;if("date"===e.type)return e.value;(0,a().HB)(e)}},number:({property:e,block:t})=>{const n=u().yQ(t,e)||[];return(0,i().M)(n)},file:({property:e,block:t})=>{const n=u().yQ(t,e)||[];return u().pJ(n).map((({url:e})=>e)).join(", ")},formula:e=>{const{intl:t,userTimeZone:r,formulaTimeoutTimestampMs:o,depth:a,visitedProperties:s,collectionFeatureGates:i}=e.collectionRequestContext;return"v2"===e.schema[e.property].version?(0,n(342581).LO)({schema:e.schema,property:e.property,blockModel:e.block,getRecordModel:e.getRecordModel,intl:t,userTimeZone:r,depth:a+1,formulaTimeoutTimestampMs:o,visitedProperties:s,formula2Error:e.formula2Error,resultCache:e.collectionRequestContext.resultCache,regExpCache:e.collectionRequestContext.regExpCache,formatDateCache:e.collectionRequestContext.formatDateCache,experimentService:e.collectionRequestContext.experimentService,shouldUsePersistedDates_ONLY_LEGACY_FORMULAS:!0,collectionFeatureGates:i,spaceIdCreator:e.spaceIdCreator}):b({...e,collectionRequestContext:{...e.collectionRequestContext,depth:e.collectionRequestContext.depth+1}})},created_time:({block:e,collectionRequestContext:t})=>{const{userTimeZone:n}=t,r=m().Bj6.fromBlock(e);if(r.getCreatedTime())return y().KQ(r.getCreatedTime(),n)},last_edited_time:({block:e,collectionRequestContext:t})=>{const{userTimeZone:n}=t,r=m().Bj6.fromBlock(e);if(r.getLastEditedTime())return y().KQ(r.getLastEditedTime(),n)},created_by:({block:e,getRecordModel:t,collectionRequestContext:n})=>{const{intl:r}=n,o=m().Bj6.fromBlock(e).getCreatedByPointer();if(o)return(0,s().lR)(r,(0,s().xC)({pointer:o,getRecordModel:t}));const a=o&&t(o);return(0,s().lR)(r,a)},last_edited_by:({block:e,getRecordModel:t,collectionRequestContext:n})=>{const{intl:r}=n,o=m().Bj6.fromBlock(e).getLastEditedByPointer();if(o)return(0,s().lR)(r,(0,s().xC)({pointer:o,getRecordModel:t}))},button:()=>"",location:()=>"",last_visited_time:()=>"",auto_increment_id:({property:e,block:t})=>{const n=u().yQ(t,e)||[];return(0,i().M)(n)},verification:()=>{},place:w};function I(e){const{schema:t,property:n,collectionRequestContext:a}=e,{userTimeZone:s,intl:i}=a,u=T(e),p=t[n];if(!p)throw new Error("Property not found");if((0,o().Et)(u)){if(!r().MI(u))return;return u.toString()}return"boolean"==typeof u?u.toString():d().kC(u)?"date"===p.type?(0,c().ZF)({value:u,userTimeZone:s,allowRelativeDates:!1,intl:i}):void 0:u}},420062:(e,t,n)=>{n.d(t,{Jb:()=>d,lg:()=>u,sr:()=>i});n(16280),n(581454);var r=()=>n(681873),o=()=>n(201980),a=()=>n(565775),s=()=>n(628048);const i={slice:"substring",start:"dateStart",end:"dateEnd"},u={unaryMinus:"-",unaryPlus:"+",larger:">",largerEq:">=",smaller:"<",smallerEq:"<="},p=["add","subtract","multiply","divide","pow","mod","equal","unequal","larger","largerEq","smaller","smallerEq"];function l(e,t,n){return r=e,o=d(e,t,n),"conditional"===r.type||"function"===r.type&&(p.includes(r.name)||["unaryPlus","unaryMinus"].includes(r.name))||"operator"===r.type&&void 0!==r.args&&r.args.length>=2?[["("],...o,[")"]]:o;var r,o}function d(e,t,n){switch(e.type){case"conditional":return[["if("],...l(e.condition,t,n),[", "],...l(e.true,t,n),[", "],...l(e.false,t,n),[")"]];case"constant":switch(e.value_type){case"number":return(0,o().x9d)(`${e.value}`);case"string":const t=e.value.replace(/\n/g,"\\n").replace(/"/g,'\\"').replace(/\t/g,"\\t");return(0,o().x9d)(`"${t}"`);case"boolean":return(0,o().x9d)(""+(e.value?"true":"false"));default:throw new Error(`unexpected constant type: ${e.value_type}`)}case"function":if(p.includes(e.name)){const r="equal"===e.name?"==":"concat"===e.name?"+":a().II[e.name].operator;return[...l(e.args[0],t,n),[` ${r} `],...l(e.args[1],t,n)]}switch(e.name){case"unaryMinus":return[["-"],...l(e.args[0],t,n)];case"unaryPlus":return[["toNumber("],...d(e.args[0],t,n),[")"]];case"month":return[["month("],...d(e.args[0],t,n),[") - 1"]];case"day":return[["day("],...d(e.args[0],t,n),[") % 7"]];case"concat":return[["("],...(0,r().G)((e.args??[]).map((e=>d(e,t,n))),(()=>[[" + "]])).flat(),[")"]];case"join":return[["join("],["["],...(0,r().G)((e.args??[]).slice(1).map((e=>d(e,t,n))),(()=>[[", "]])).flat(),["]"],[", "],...d(e.args[0],t,n),[")"]];default:if("id"===e.name)return(0,o().x9d)("id()");const a=i[e.name]??e.name;if(void 0===s().LP[a])throw new Error(`unexpected formula: ${a}`);return[[`${a}(`],...(0,r().G)((e.args??[]).map((e=>d(e,t,n))),(()=>[[", "]])).flat(),[")"]]}case"operator":var u,c;if(1===(null===(u=e.args)||void 0===u?void 0:u.length))switch(e.operator){case"not":return[["!"],...l(e.args[0],t,n)];case"+":return[["toNumber("],...d(e.args[0],t,n),[")"]];default:return[[`${e.operator}`],...l(e.args[0],t,n)]}if(2===(null===(c=e.args)||void 0===c?void 0:c.length))return[...l(e.args[0],t,n),[` ${e.operator} `],...l(e.args[1],t,n)];if("?"===e.operator)return[...l(e.args[0],t,n),[" ? "],...l(e.args[0],t,n),[" : "],...l(e.args[0],t,n)];throw new Error(`unhandled operator: ${e.operator}`);case"symbol":switch(e.name){case"pi":return(0,o().x9d)("pi()");case"e":return(0,o().x9d)("e()");case"true":return(0,o().x9d)("true");case"false":return(0,o().x9d)("false");default:throw new Error(`unexpected constant: ${e.name}`)}case"property":{const r=n[e.id];if(void 0===r)return[[e.name]];const a=(0,o().wmz)((0,o().ESw)({collection:t,property:e.id,name:r.name}));switch(r.type){case"person":case"relation":return[["join(map("],a,[', format(current)), ", ")']];case"rollup":return r.aggregation&&"show_unique"!==r.aggregation?[a]:[["join(map("],a,[', format(current)), ",")']];case"file":case"multi_select":return[["join("],a,[', ", ")']];case"auto_increment_id":return[a,[".split('-').last().toNumber()"]];default:return[a]}}case"error":throw new Error("unexpected formula error node")}}},565775:(e,t,n)=>{n.d(t,{AA:()=>l,F5:()=>g,II:()=>k,N9:()=>T});n(898992),n(581454),n(737550);var r=()=>n(498212),o=()=>n(720665),a=()=>n(597777),s=()=>n(604995);const i=(0,n(69708).YK)({e:{id:"database.formula.constant.e.description",defaultMessage:"The base of the natural logarithm."},pi:{id:"database.formula.constant.pi.description",defaultMessage:"The ratio of a circle’s circumference to its diameter."},if:{id:"database.formula.operator.if.description",defaultMessage:"Switches between two options based on another value."},add:{id:"database.formula.operator.add.description",defaultMessage:"Adds two numbers and returns their sum, or concatenates two strings."},subtract:{id:"database.formula.operator.subtract.description",defaultMessage:"Subtracts two numbers and returns their difference."},multiply:{id:"database.formula.operator.multiply.description",defaultMessage:"Multiplies two numbers and returns their product."},divide:{id:"database.formula.operator.divide.description",defaultMessage:"Divides two numbers and returns their quotient."},pow:{id:"database.formula.operator.pow.description",defaultMessage:"Returns base to the exponent power, that is, baseexponent."},mod:{id:"database.formula.operator.mod.description",defaultMessage:"Divides two numbers and returns their remainder."},unaryMinus:{id:"database.formula.operator.unaryMinus.description",defaultMessage:"Negates a number."},unaryPlus:{id:"database.formula.operator.unaryPlus.description",defaultMessage:"Converts its argument into a number."},not:{id:"database.formula.operator.not.description",defaultMessage:"Returns the logical NOT of its argument."},and:{id:"database.formula.operator.and.description",defaultMessage:"Returns the logical AND of its two arguments."},or:{id:"database.formula.operator.or.description",defaultMessage:"Returns the logical OR of its two arguments."},equal:{id:"database.formula.operator.equal.description",defaultMessage:"Returns true if its arguments are equal, and false otherwise."},unequal:{id:"database.formula.operator.unequal.description",defaultMessage:"Returns false if its arguments are equal, and true otherwise."},larger:{id:"database.formula.operator.larger.description",defaultMessage:"Returns true if the first argument is larger than the second."},largerEq:{id:"database.formula.operator.largerEq.description",defaultMessage:"Returns true if the first argument is larger than or equal to than the second."},smaller:{id:"database.formula.operator.smaller.description",defaultMessage:"Returns true if the first argument is smaller than the second."},smallerEq:{id:"database.formula.operator.smallerEq.description",defaultMessage:"Returns true if the first argument is smaller than or equal to than the second."},concat:{id:"database.formula.function.concat.description",defaultMessage:"Concatenates its arguments and returns the result."},join:{id:"database.formula.function.join.description",defaultMessage:"Inserts the first argument between the rest and returns their concatenation."},slice:{id:"database.formula.function.slice.description",defaultMessage:"Extracts a substring from a string from the start index (inclusively) to the end index (optional and exclusively)."},length:{id:"database.formula.function.length.description",defaultMessage:"Returns the length of a string."},format:{id:"database.formula.function.format.description",defaultMessage:"Formats its argument as a string."},toNumber:{id:"database.formula.function.toNumber.description",defaultMessage:"Parses a number from text."},contains:{id:"database.formula.function.contains.description",defaultMessage:"Returns true if the second argument is found in the first."},replace:{id:"database.formula.function.replace.description",defaultMessage:"Replaces the first match of a regular expression with a new value."},replaceAll:{id:"database.formula.function.replaceAll.description",defaultMessage:"Replaces all matches of a regular expression with a new value."},test:{id:"database.formula.function.test.description",defaultMessage:"Tests if a string matches a regular expression."},empty:{id:"database.formula.function.empty.description",defaultMessage:"Tests if a value is empty."},abs:{id:"database.formula.function.abs.description",defaultMessage:"Returns the absolute value of a number."},cbrt:{id:"database.formula.function.cbrt.description",defaultMessage:"Returns the cube root of a number."},ceil:{id:"database.formula.function.ceil.description",defaultMessage:"Returns the smallest integer greater than or equal to a number."},exp:{id:"database.formula.function.exp.description",defaultMessage:"Returns E^x, where x is the argument, and E is Euler’s constant (2.718…), the base of the natural logarithm."},floor:{id:"database.formula.function.floor.description",defaultMessage:"Returns the largest integer less than or equal to a number."},ln:{id:"database.formula.function.ln.description",defaultMessage:"Returns the natural logarithm of a number."},log10:{id:"database.formula.function.log10.description",defaultMessage:"Returns the base 10 logarithm of a number."},log2:{id:"database.formula.function.log2.description",defaultMessage:"Returns the base 2 logarithm of a number."},max:{id:"database.formula.function.max.description",defaultMessage:"Returns the largest of zero or more numbers."},min:{id:"database.formula.function.min.description",defaultMessage:"Returns the smallest of zero or more numbers."},round:{id:"database.formula.function.round.description",defaultMessage:"Returns the value of a number rounded to the nearest integer."},sign:{id:"database.formula.function.sign.description",defaultMessage:"Returns the sign of the x, indicating whether x is positive, negative or zero."},sqrt:{id:"database.formula.function.sqrt.description",defaultMessage:"Returns the positive square root of a number."},start:{id:"database.formula.function.start.description",defaultMessage:"Returns the start of a date range."},end:{id:"database.formula.function.end.description",defaultMessage:"Returns the end of a date range."},now:{id:"database.formula.function.now.description",defaultMessage:"Returns the current date and time."},timestamp:{id:"database.formula.function.timestamp.description",defaultMessage:"Returns an integer number from a Unix millisecond timestamp, corresponding to the number of milliseconds since January 1, 1970."},fromTimestamp:{id:"database.formula.function.fromTimestamp.description",defaultMessage:"Returns a date constructed from a Unix millisecond timestamp, corresponding to the number of milliseconds since January 1, 1970."},dateAdd:{id:"database.formula.function.dateAdd.description",defaultMessage:"Add to a date. The last argument, unit, can be one of: “years”, “quarters”, “months”, “weeks”, “days”, “hours”, “minutes”, “seconds”, or “milliseconds”."},dateSubtract:{id:"database.formula.function.dateSubtract.description",defaultMessage:"Subtract from a date. The last argument, unit, can be one of: “years”, “quarters”, “months”, “weeks”, “days”, “hours”, “minutes”, “seconds”, or “milliseconds”."},dateBetween:{id:"database.formula.function.dateBetween.description",defaultMessage:"Returns the time between two dates. The last argument, unit, can be one of: “years”, “quarters”, “months”, “weeks”, “days”, “hours”, “minutes”, “seconds”, or “milliseconds”."},formatDate:{id:"database.formula.function.formatDate.description",defaultMessage:"Format a date using the Moment standard time format string."},minute:{id:"database.formula.function.minute.description",defaultMessage:"Returns an integer number, between 0 and 59, corresponding to minutes in the given date."},hour:{id:"database.formula.function.hour.description",defaultMessage:"Returns an integer number, between 0 and 23, corresponding to hour for the given date."},day:{id:"database.formula.function.day.description",defaultMessage:"Returns an integer number corresponding to the day of the week for the given date: 0 for Sunday, 1 for Monday, 2 for Tuesday, and so on."},date:{id:"database.formula.function.date.description",defaultMessage:"Returns an integer number, between 1 and 31, corresponding to day of the month for the given."},month:{id:"database.formula.function.month.description",defaultMessage:"Returns an integer number, between 0 and 11, corresponding to month in the given date according to local time. 0 corresponds to January, 1 to February, and so on."},year:{id:"database.formula.function.year.description",defaultMessage:"Returns a number corresponding to the year of the given date."},id:{id:"database.formula.function.id.description",defaultMessage:"Returns a unique string id for each entry."},properties:{id:"database.formula.category.properties",defaultMessage:"Properties"},constants:{id:"database.formula.category.constants",defaultMessage:"Constants"},operators:{id:"database.formula.category.operators",defaultMessage:"Operators"},functions:{id:"database.formula.category.functions",defaultMessage:"Functions"}});let u=function(e){return e[e.property=0]="property",e[e.constant=1]="constant",e[e.operator=2]="operator",e[e.function=3]="function",e}({});const p=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],l={e:{name:"e",value:Math.E,category:u.constant,descriptionMessage:i.e,resultType:"number",examples:["e == 2.718281828459045"]},pi:{name:"pi",value:Math.PI,category:u.constant,descriptionMessage:i.pi,resultType:"number",examples:["2 * pi == 6.283185307179586"]},true:{name:"true",value:!0,category:u.constant,descriptionMessage:void 0,resultType:"checkbox",examples:['true ? "yes" : "no" == "yes"']},false:{name:"false",value:!1,category:u.constant,descriptionMessage:void 0,resultType:"checkbox",examples:['false ? "yes" : "no" == "no"']}};function d(e){return{resultType:e,arity:[e,e]}}function c(e){return{resultType:e,arity:[e]}}const y=d("number"),m=d("checkbox"),f=c("number"),h=c("date"),v={resultType:"number",arity:["date"]},x=[{resultType:"checkbox",arity:["text","text"]},{resultType:"checkbox",arity:["checkbox","checkbox"]},{resultType:"checkbox",arity:["date","date"]},{resultType:"checkbox",arity:["number","number"]}];function g(e){if(k.hasOwnProperty(e))return k[e]}function b(e){return e.some((e=>"string"==typeof e))?e.map((e=>e||"")):e.map((e=>e||0))}const k={if:{name:"if",apply:e=>e[0]?e[1]:e[2],operator:"?",category:u.operator,descriptionMessage:i.if,signatures:[{resultType:"text",arity:["checkbox","text","text"]},{resultType:"number",arity:["checkbox","number","number"]},{resultType:"checkbox",arity:["checkbox","checkbox","checkbox"]},{resultType:"date",arity:["checkbox","date","date"]}],examples:["true ? 1 : -1 == 1",'if(false, "yes", "no") == "no"']},add:{name:"add",apply:e=>{const t=b(e);return t[0]+t[1]},operator:"+",category:u.operator,descriptionMessage:i.add,signatures:[y,{resultType:"text",arity:["text","text"]}],examples:["3 + 4 = 7","add(1, 3) == 4",'"add" + "text" == "addtext"']},subtract:{name:"subtract",apply:e=>{const t=b(e);return t[0]-t[1]},operator:"-",category:u.operator,descriptionMessage:i.subtract,signatures:[y],examples:["3 - 1 == 2","subtract(4, 5) == -1"]},multiply:{name:"multiply",apply:e=>{const t=b(e);return t[0]*t[1]},operator:"*",category:u.operator,descriptionMessage:i.multiply,signatures:[y],examples:["6 * 9 == 54","multiply(2, 10) == 20"]},divide:{name:"divide",apply:e=>{const t=b(e);return t[0]/t[1]},operator:"/",category:u.operator,descriptionMessage:i.divide,signatures:[y],examples:["12 / 4 == 3","divide(12, 3) == 4"]},pow:{name:"pow",apply:e=>{const t=b(e);return Math.pow(t[0],t[1])},operator:"^",category:u.operator,descriptionMessage:i.pow,signatures:[y],examples:["5 ^ 3 == 125","pow(2, 6) == 64"]},mod:{name:"mod",apply:e=>{const t=b(e);return t[0]%t[1]},operator:"%",category:u.operator,descriptionMessage:i.mod,signatures:[y],examples:["7 % 5 == 2","mod(3, 3) == 0"]},unaryMinus:{name:"unaryMinus",apply:e=>-b(e)[0],operator:"-",category:u.operator,descriptionMessage:i.unaryMinus,signatures:[f],examples:["-1 + 2 == 1","unaryMinus(42) == -42"]},unaryPlus:{name:"unaryPlus",apply:e=>{const t=b(e);return Number(t[0])},operator:"+",category:u.operator,descriptionMessage:i.unaryPlus,signatures:[f,{resultType:"number",arity:["text"]},{resultType:"number",arity:["checkbox"]}],examples:['+ "42" == 42',"unaryPlus(true) == 1"]},not:{name:"not",apply:e=>!e[0],operator:"not",category:u.operator,descriptionMessage:i.not,signatures:[{resultType:"checkbox",arity:["checkbox"]}],examples:["not true == false","not(false) == true"]},and:{name:"and",apply:e=>e[0]&&e[1],operator:"and",category:u.operator,descriptionMessage:i.and,signatures:[m],examples:["true and false == false","and(true, true) == true"]},or:{name:"or",apply:e=>e[0]||e[1],operator:"or",category:u.operator,descriptionMessage:i.or,signatures:[m],examples:["false or true == true","or(false, false) == false"]},equal:{name:"equal",apply:(e,t)=>{const[n,r]=e;return a().kC(n)&&a().kC(r)?s().AA(n,t).start.valueOf()===s().AA(r,t).start.valueOf():n===r},operator:"==",category:u.operator,descriptionMessage:i.equal,signatures:x,examples:["(3 * 5 == 15) == true","equal(false, not true) == true"]},unequal:{name:"unequal",apply:(e,t)=>{const[n,r]=e;return a().kC(n)&&a().kC(r)?s().AA(n,t).start.valueOf()!==s().AA(r,t).start.valueOf():n!==r},operator:"!=",category:u.operator,descriptionMessage:i.unequal,signatures:x,examples:["(6 * 9 != 42) == false","(true != not false) == false"]},larger:{name:"larger",apply:(e,t)=>{const[n,r]=e;return a().kC(n)&&a().kC(r)?s().AA(n,t).start.valueOf()>s().AA(r,t).start.valueOf():n>r},operator:">",category:u.operator,descriptionMessage:i.larger,signatures:x,examples:["5 > 3 == true"]},largerEq:{name:"largerEq",apply:(e,t)=>{const[n,r]=e;return a().kC(n)&&a().kC(r)?s().AA(n,t).start.valueOf()>=s().AA(r,t).start.valueOf():n>=r},operator:">=",category:u.operator,descriptionMessage:i.largerEq,signatures:x,examples:["5 >= 3 == true","4 >= 4 == true"]},smaller:{name:"smaller",apply:(e,t)=>{const[n,r]=e;return a().kC(n)&&a().kC(r)?s().AA(n,t).start.valueOf()<s().AA(r,t).start.valueOf():n<r},operator:"<",category:u.operator,descriptionMessage:i.smaller,signatures:x,examples:["10 < 8 == false"]},smallerEq:{name:"smallerEq",apply:(e,t)=>{const[n,r]=e;return a().kC(n)&&a().kC(r)?s().AA(n,t).start.valueOf()<=s().AA(r,t).start.valueOf():n<=r},operator:"<=",category:u.operator,descriptionMessage:i.smallerEq,signatures:x,examples:["10 <= 8 == false","8 <= 8 == true"]}};function T(e){if(w.hasOwnProperty(e))return w[e]}const w={concat:{name:"concat",apply:e=>e?e.join(""):void 0,category:u.function,descriptionMessage:i.concat,signatures:[{resultType:"text",variadic:"text"}],examples:['"dog" +"go" == "doggo"','concat("dog", "go") == "doggo"']},join:{name:"join",apply:e=>e?e.slice(1).join(e[0]):void 0,category:u.function,descriptionMessage:i.join,signatures:[{resultType:"text",variadic:"text"}],examples:['join("-", "a", "b", "c") == "a-b-c"']},slice:{name:"slice",apply:e=>e&&e[0]?e[0].slice(e[1],e[2]):void 0,category:u.function,descriptionMessage:i.slice,signatures:[{resultType:"text",arity:["text","number"]},{resultType:"text",arity:["text","number","number"]}],examples:['slice("Hello world", 1, 5) == "ello"','slice("notion", 3) == "ion"']},length:{name:"length",apply:e=>e[0]?e[0].length:0,category:u.function,descriptionMessage:i.length,signatures:[{resultType:"number",arity:["text"]}],examples:['length("Hello world") == 11']},format:{name:"format",apply:(e,t,r)=>{const o=e[0];return a().kC(o)?(0,n(869190).ZF)({value:o,userTimeZone:t,allowRelativeDates:!1,intl:r}):void 0!==o?o.toString():void 0},category:u.function,descriptionMessage:i.format,signatures:[{resultType:"text",arity:["number"]},{resultType:"text",arity:["checkbox"]},{resultType:"text",arity:["date"]},{resultType:"text",arity:["text"]}],examples:['format(42) == "42"','format(true) == "true"','format(now()) == "December 31, 1969 16:00 (PST)"']},toNumber:{name:"toNumber",apply:(e,t)=>{const n=e[0];if(a().kC(n))return s().AA(n,t).start.valueOf();if("boolean"==typeof n)return n?1:0;if("string"==typeof n){const e=parseFloat(n);return o().Et(e)?e:void 0}return o().Et(n)?n:void 0},category:u.function,descriptionMessage:i.toNumber,signatures:[{resultType:"number",arity:["text"]},{resultType:"number",arity:["number"]},{resultType:"number",arity:["checkbox"]},{resultType:"number",arity:["date"]}],examples:['toNumber("42") == 42',"toNumber(false) == 0"]},contains:{name:"contains",apply:e=>Boolean(e[0]&&e[0].includes(e[1])),category:u.function,descriptionMessage:i.contains,signatures:[{resultType:"checkbox",arity:["text","text"]}],examples:['contains("notion", "ion") == true']},replace:{name:"replace",apply:e=>{try{const t=e[0]?e[0].toString():"";return e[1]?t.replace(new RegExp(e[1]),e[2]||""):""}catch(t){return}},category:u.function,descriptionMessage:i.replace,signatures:[{resultType:"text",arity:["number","text","text"]},{resultType:"text",arity:["text","text","text"]},{resultType:"text",arity:["checkbox","text","text"]}],examples:['replace("1-2-3", "-", "!") == "1!2-3"']},replaceAll:{name:"replaceAll",apply:e=>{try{const t=e[0]?e[0].toString():"";return e[1]?t.replace(new RegExp(e[1],"g"),e[2]||""):""}catch(t){return}},category:u.function,descriptionMessage:i.replaceAll,signatures:[{resultType:"text",arity:["number","text","text"]},{resultType:"text",arity:["text","text","text"]},{resultType:"text",arity:["checkbox","text","text"]}],examples:['replaceAll("1-2-3", "-", "!") == "1!2!3"']},test:{name:"test",apply:e=>{try{const t=e[0]?e[0].toString():"";return new RegExp(e[1]).test(t)}catch(t){return}},category:u.function,descriptionMessage:i.test,signatures:[{resultType:"checkbox",arity:["number","text"]},{resultType:"checkbox",arity:["text","text"]},{resultType:"checkbox",arity:["checkbox","text"]}],examples:['test("1-2-3", "-") == true']},empty:{name:"empty",apply:e=>!Boolean(e[0]),category:u.function,descriptionMessage:i.empty,signatures:[{resultType:"checkbox",arity:["number"]},{resultType:"checkbox",arity:["text"]},{resultType:"checkbox",arity:["checkbox"]},{resultType:"checkbox",arity:["date"]}],examples:['empty("") == true']},abs:{name:"abs",apply:e=>Math.abs(e[0]),category:u.function,descriptionMessage:i.abs,signatures:[f],examples:["abs(-3) == 3"]},cbrt:{name:"cbrt",apply:e=>Math.cbrt(e[0]),category:u.function,descriptionMessage:i.cbrt,signatures:[f],examples:["cbrt(8) == 2"]},ceil:{name:"ceil",apply:e=>Math.ceil(e[0]),category:u.function,descriptionMessage:i.ceil,signatures:[f],examples:["ceil(4.2) == 5"]},exp:{name:"exp",apply:e=>Math.exp(e[0]),category:u.function,descriptionMessage:i.exp,signatures:[f],examples:["exp(1) == 2.718281828459045"]},floor:{name:"floor",apply:e=>Math.floor(e[0]),category:u.function,descriptionMessage:i.floor,signatures:[f],examples:["floor(2.8) == 2"]},ln:{name:"ln",apply:e=>Math.log(e[0]),category:u.function,descriptionMessage:i.ln,signatures:[f],examples:["ln(e) == 1"]},log10:{name:"log10",apply:e=>Math.log10(e[0]),category:u.function,descriptionMessage:i.log10,signatures:[f],examples:["log10(1000) == 3"]},log2:{name:"log2",apply:e=>Math.log2(e[0]),category:u.function,descriptionMessage:i.log2,signatures:[f],examples:["log2(64) == 6"]},max:{name:"max",apply:e=>Math.max.apply(void 0,e),category:u.function,descriptionMessage:i.max,signatures:[{resultType:"number",variadic:"number"}],examples:["max(5, 2, 9, 3) == 9"]},min:{name:"min",apply:e=>Math.min.apply(void 0,e),category:u.function,descriptionMessage:i.min,signatures:[{resultType:"number",variadic:"number"}],examples:["min(4, 1, 5, 3) == 1"]},round:{name:"round",apply:e=>Math.round(e[0]),category:u.function,descriptionMessage:i.round,signatures:[f],examples:["round(4.4) == 4","round(4.5) == 5"]},sign:{name:"sign",apply:e=>Math.sign(e[0]),category:u.function,descriptionMessage:i.sign,signatures:[f],examples:["sign(4) == 1","sign(-9) == -1","sign(0) == 0"]},sqrt:{name:"sqrt",apply:e=>Math.sqrt(e[0]),category:u.function,descriptionMessage:i.sqrt,signatures:[f],examples:["sqrt(144) == 12"]},start:{name:"start",apply:e=>{const t=e[0];if(a().kC(t)){if("daterange"===t.type){return{type:"date",start_date:t.start_date}}if("datetimerange"===t.type){return{type:"datetime",start_date:t.start_date,start_time:t.start_time,time_zone:t.time_zone}}return t}},category:u.function,descriptionMessage:i.start,signatures:[h],examples:['start(prop("Date")) == Feb 2, 1996']},end:{name:"end",apply:e=>{const t=e[0];if(a().kC(t)){if("daterange"===t.type){return{type:"date",start_date:t.end_date}}if("datetimerange"===t.type){return{type:"datetime",start_date:t.end_date,start_time:t.end_time,time_zone:t.time_zone,reminder:t.reminder}}return t}},category:u.function,descriptionMessage:i.end,signatures:[h],examples:['end(prop("Date")) == Feb 2, 1996']},now:{name:"now",apply:(e,t)=>s().T_(t),category:u.function,descriptionMessage:i.now,signatures:[{resultType:"date",arity:[]}],examples:["now() == Feb 2, 1996"]},timestamp:{name:"timestamp",apply:(e,t)=>{const n=e[0];if(a().kC(n))return s().AA(n,t).start.valueOf()},category:u.function,descriptionMessage:i.timestamp,signatures:[v],examples:["timestamp(now()) == 1512593154718"]},fromTimestamp:{name:"fromTimestamp",apply:(e,t)=>o().Et(e[0])?s().KQ(e[0],t):void 0,category:u.function,descriptionMessage:i.fromTimestamp,signatures:[{resultType:"date",arity:["number"]}],examples:["fromTimestamp(2000000000000) == Tue May 17 2033"]},dateAdd:{name:"dateAdd",apply:(e,t)=>{const[n,r,a]=e;if(!n||!o().Et(r)||p.indexOf(a)<0)return;const i=s().AA(n,t).start.plus({[a]:r}).valueOf();return"datetime"===n.type||"datetimerange"===n.type?s().KQ(i,n.time_zone):s().p6(i,t)},category:u.function,descriptionMessage:i.dateAdd,signatures:[{resultType:"date",arity:["date","number","text"]}],examples:p.map((e=>`dateAdd(date, amount, "${e}")`))},dateSubtract:{name:"dateSubtract",apply:(e,t)=>{const[n,r,a]=e;if(!n||!o().Et(r)||p.indexOf(a)<0)return;const i=s().AA(n,t).start.minus({[a]:r}).valueOf();return"datetime"===n.type||"datetimerange"===n.type?s().KQ(i,n.time_zone):s().p6(i,t)},category:u.function,descriptionMessage:i.dateSubtract,signatures:[{resultType:"date",arity:["date","number","text"]}],examples:p.map((e=>`dateSubtract(date, amount, "${e}")`))},dateBetween:{name:"dateBetween",apply:(e,t)=>{const[n,r,o]=e;if(!n||!r||p.indexOf(o)<0)return;const a=s().AA(n,t).start,i=s().AA(r,t).start;return Math.trunc(a.diff(i,o).get(o))},category:u.function,descriptionMessage:i.dateBetween,signatures:[{resultType:"number",arity:["date","date","text"]}],examples:p.map((e=>`dateBetween(date, date2, "${e}")`))},formatDate:{name:"formatDate",apply:(e,t,r)=>{const[o,a]=e;if(o&&a){const e=s().AA(o,t,r.locale).start;return(0,n(264435).u)(e,a)}},category:u.function,descriptionMessage:i.formatDate,signatures:[{resultType:"text",arity:["date","text"]}],examples:['formatDate(now(), "MMMM D YYYY, HH:mm") == March 30 2010, 12:00','formatDate(now(), "YYYY/MM/DD, HH:mm") == 2010/03/30, 12:00','formatDate(now(), "MM/DD/YYYY, HH:mm") == 03/30/2010, 12:00','formatDate(now(), "HH:mm A") == 12:00 PM','formatDate(now(), "M/D/YY") == 3/30/10']},minute:{name:"minute",apply:(e,t)=>{const n=e[0];if(a().kC(n))return s().AA(n,t).start.minute},category:u.function,descriptionMessage:i.minute,signatures:[v],examples:["minute(now()) == 45"]},hour:{name:"hour",apply:(e,t)=>{const n=e[0];if(a().kC(n))return s().AA(n,t).start.hour},category:u.function,descriptionMessage:i.hour,signatures:[v],examples:["hour(now()) == 17"]},day:{name:"day",apply:(e,t)=>{const n=e[0];if(a().kC(n))return s().bO(s().AA(n,t).start)},category:u.function,descriptionMessage:i.day,signatures:[v],examples:["day(now()) == 3"]},date:{name:"date",apply:(e,t)=>{const n=e[0];if(a().kC(n))return s().AA(n,t).start.day},category:u.function,descriptionMessage:i.date,signatures:[v],examples:["date(now()) == 13"]},month:{name:"month",apply:(e,t)=>{const n=e[0];if(a().kC(n))return s().AA(n,t).start.month-1},category:u.function,descriptionMessage:i.month,signatures:[v],examples:["month(now()) == 11"]},year:{name:"year",apply:(e,t)=>{const n=e[0];if(a().kC(n))return s().AA(n,t).start.year},category:u.function,descriptionMessage:i.year,signatures:[v],examples:["year(now()) == 1984"]},id:{name:"id",apply:(e,t,n,o)=>(0,r().Xw)(o.id),category:u.function,descriptionMessage:i.id,signatures:[{resultType:"text",arity:[]}],examples:[`id() == "${(0,r().Xw)(n(206267).JW())}"`]}}},628048:(e,t,n)=>{n.d(t,{u_:()=>O,LP:()=>R,bq:()=>P,Qi:()=>A,Ux:()=>E,MB:()=>I});n(16280),n(18107),n(944114),n(269479),n(967357),n(898992),n(823215),n(354520),n(672577),n(430670),n(803949),n(581454),n(908872),n(737550);var r=()=>n(598629),o=()=>n(906745),a=()=>n(498212),s=()=>n(534177),i=()=>n(764880),u=()=>n(597777),p=()=>n(604995),l=()=>n(498140),d=()=>n(264435),c=()=>n(416504),y=()=>n(437607),m=()=>n(201980),f=()=>n(96033),h=()=>n(247331),v=()=>n(696446),x=()=>n(145076),g=()=>n(349835),b=()=>n(239381),k=()=>n(307663);const T=(0,n(69708).YK)({if:{id:"database.formula2.operator.if.description",defaultMessage:"Returns the first value if the condition is true; otherwise, returns the second value."},ifs:{id:"database.formula2.operator.ifs.description",defaultMessage:"Returns the value that corresponds to the first true condition. This can be used as an alternative to multiple nested if() statements."},e:{id:"database.formula2.constant.e.description",defaultMessage:"Returns the base of the natural logarithm."},pi:{id:"database.formula2.constant.pi.description",defaultMessage:"Returns the ratio of a circle’s circumference to its diameter."},add:{id:"database.formula2.operator.add.description",defaultMessage:"Returns the sum of two numbers."},at:{id:"database.formula2.operator.at.description",defaultMessage:"Returns the value at the specified index in a list."},every:{id:"database.formula2.operator.every.description",defaultMessage:"Returns true if every item in the list satisfies the given condition, and false otherwise."},filter:{id:"database.formula2.operator.filter.description",defaultMessage:"Returns the values in the list for which the condition is true."},find:{id:"database.formula2.operator.find.description",defaultMessage:"Returns the first element in the list for which the condition returns true."},first:{id:"database.formula2.operator.first.description",defaultMessage:"Returns the first item in the list."},flat:{id:"database.formula2.operator.flat.description",defaultMessage:"Flattens a list of lists into a single list."},includes:{id:"database.formula2.operator.includes.description",defaultMessage:"Returns true if the list contains the specified value, and false otherwise."},last:{id:"database.formula2.operator.last.description",defaultMessage:"Returns the last item in the list."},map:{id:"database.formula2.operator.map.description",defaultMessage:"Returns the list populated with the results of calling the expression on every item in the input list."},reverse:{id:"database.formula2.operator.reverse.description",defaultMessage:"Returns the reversed list."},slice:{id:"database.formula2.operator.slice.description",defaultMessage:"Returns the items of the list from the provided start index (inclusive) to the end index (optional and exclusive)."},splice:{id:"database.formula2.operator.splice.description",defaultMessage:"Removes a specified number of elements from a list at the startIndex and optionally inserts new elements at that position. If deleteCount is not provided, it defaults to 0."},findIndex:{id:"database.formula2.operator.findIndex.description",defaultMessage:"Returns the index of the first item in the list for which the condition evaluates to true."},unique:{id:"database.formula2.operator.unique.description",defaultMessage:"Returns the list of unique values in the input list."},toPlainText:{id:"database.formula2.operator.toPlainText.description",defaultMessage:"Returns the plain text representation of the input text."},toText:{id:"database.formula2.operator.toText.description",defaultMessage:"Returns the text representation of the input value."},sort:{id:"database.formula2.operator.sort.description",defaultMessage:"Returns the list in sorted order. Optionally, a provided expression can be used to determine the sorting order."},some:{id:"database.formula2.operator.some.description",defaultMessage:"Returns true if any item in the list satisfies the given condition, and false otherwise."},let:{id:"database.formula2.operator.let.description",defaultMessage:"Assigns a value to a variable and evaluates the expression using that variable."},lets:{id:"database.formula2.operator.lets.description",defaultMessage:"Assigns values to multiple variables and evaluates the expression using those variables."},sum:{id:"database.formula2.operator.sum.description",defaultMessage:"Returns the sum of its arguments."},subtract:{id:"database.formula2.operator.subtract.description",defaultMessage:"Returns the difference of two numbers."},multiply:{id:"database.formula2.operator.multiply.description",defaultMessage:"Returns the product of two numbers."},divide:{id:"database.formula2.operator.divide.description",defaultMessage:"Returns the quotient of two numbers."},pow:{id:"database.formula2.operator.pow.description",defaultMessage:"Returns the result of a base number raised to an exponent power."},mod:{id:"database.formula2.operator.mod.description",defaultMessage:"Returns the first number modulo the second number."},equal:{id:"database.formula2.operator.equal.description",defaultMessage:"Returns true if both values are equal and false otherwise."},unequal:{id:"database.formula2.operator.unequal.description",defaultMessage:"Returns false if both values are equal and true otherwise."},concat:{id:"database.formula2.function.concat.description",defaultMessage:"Returns the concatenation of multiple lists."},join:{id:"database.formula2.function.join.description",defaultMessage:"Returns the values of the list with the joiner placed between each of the values."},split:{id:"database.formula2.function.split.description",defaultMessage:"Returns the list of values created by splitting a text by a separator."},substring:{id:"database.formula2.function.slice.description",defaultMessage:"Returns the substring of the text from the start index (inclusive) to the end index (optional and exclusive)."},length:{id:"database.formula2.function.length.description",defaultMessage:"Returns the length of the text or list value."},format:{id:"database.formula2.function.format.description",defaultMessage:"Returns the value formatted as text."},formatNumber:{id:"database.formula2.function.formatNumber.description",defaultMessage:"Returns the number value formatted as text.{br}{br}The format argument can be one of “commas” (the default), “percent”, “humanize”, “bytes_binary”, “bytes_decimal”, or a currency code (see below).{br}{br}Optionally specify how many decimal places to show (0-12) via the precision argument.{br}{br}Supported currency codes: “usd”, “aud”, “cad”, “sgd”, “eur”, “gbp”, “jpy”, “rub”, “inr”, “krw”, “cny”, “brl”, “try”, “idr”, “chf”, “hkd”, “nzd”, “sek”, “nok”, “mxn”, “zar”, “twd”, “dkk”, “pln”, “thb”, “huf”, “czk”, “ils”, “clp”, “php”, “aed”, “cop”, “sar”, “myr”, “ron”, “ars”, “uyu”, “pen”."},style:{id:"database.formula2.function.style.description",defaultMessage:"Adds styles and colors to the text. Valid formatting styles: “b” (bold), “u” (underline), “i” (italics), “c” (code), or “s” (strikethrough). Valid colors: “gray”, “brown”, “orange”, “yellow”, “green”, “blue”, “purple”, “pink”, and “red”. Add “_background” to colors to set background colors."},unstyle:{id:"database.formula2.function.unstyle.description",defaultMessage:"Removes formatting styles from the text. If no styles are specified, all styles are removed."},link:{id:"database.formula2.function.link.description",defaultMessage:"Creates a hyperlink from the label text and the URL."},toNumber:{id:"database.formula2.function.toNumber.description",defaultMessage:"Parses a number from text."},contains:{id:"database.formula2.function.contains.description",defaultMessage:"Returns true if the search string is present in the value."},replace:{id:"database.formula2.function.replace.description",defaultMessage:"Replaces the first match of the regular expression with the replacement value."},replaceAll:{id:"database.formula2.function.replaceAll.description",defaultMessage:"Replaces all matches of the regular expression with the replacement value."},test:{id:"database.formula2.function.test.description",defaultMessage:"Returns true if the value matches the regular expression and false otherwise."},match:{id:"database.formula2.function.match.description",defaultMessage:"Returns all matches of the regular expression as a list."},empty:{id:"database.formula2.function.empty.description",defaultMessage:"Returns true if the value you provide is empty. If you don’t provide an argument, it returns an empty value. Empty values include 0, ””, false, [], and blank properties."},abs:{id:"database.formula2.function.abs.description",defaultMessage:"Returns the absolute value of the number."},cbrt:{id:"database.formula2.function.cbrt.description",defaultMessage:"Returns the cube root of the number."},ceil:{id:"database.formula2.function.ceil.description",defaultMessage:"Returns the smallest integer greater than or equal to the number."},exp:{id:"database.formula2.function.exp.description",defaultMessage:"Returns e^x, where x is the argument, and e is Euler’s number (2.718…), the base of the natural logarithm."},floor:{id:"database.formula2.function.floor.description",defaultMessage:"Returns the largest integer less than or equal to the number."},ln:{id:"database.formula2.function.ln.description",defaultMessage:"Returns the natural logarithm of the number."},log10:{id:"database.formula2.function.log10.description",defaultMessage:"Returns the base 10 logarithm of the number."},log2:{id:"database.formula2.function.log2.description",defaultMessage:"Returns the base 2 logarithm of the number."},max:{id:"database.formula2.function.max.description",defaultMessage:"Returns the largest number of the arguments."},min:{id:"database.formula2.function.min.description",defaultMessage:"Returns the smallest number of the arguments."},mean:{id:"database.formula2.function.mean.description",defaultMessage:"Returns the arithmetic average of its arguments."},median:{id:"database.formula2.function.median.description",defaultMessage:"Returns the middle value of its arguments."},mode:{id:"database.formula2.function.mode.description",defaultMessage:"Returns the most commonly occurring value of its arguments."},round:{id:"database.formula2.function.round.description",defaultMessage:"Returns the value of a number rounded to the nearest integer."},sign:{id:"database.formula2.function.sign.description",defaultMessage:"Returns 1 if the number is positive, -1 if it is negative, and 0 if it is zero."},sqrt:{id:"database.formula2.function.sqrt.description",defaultMessage:"Returns the positive square root of the number."},start:{id:"database.formula2.function.start.description",defaultMessage:"Returns the start of the date range."},end:{id:"database.formula2.function.end.description",defaultMessage:"Returns the end of the date range."},now:{id:"database.formula2.function.now.description",defaultMessage:"Returns the current date and time."},today:{id:"database.formula2.function.today.description",defaultMessage:"Returns the current date without the time."},timestamp:{id:"database.formula2.function.timestamp.description",defaultMessage:"Returns the current Unix timestamp, representing the number of milliseconds that have elapsed since January 1, 1970."},fromTimestamp:{id:"database.formula2.function.fromTimestamp.description",defaultMessage:"Returns the date from the given Unix timestamp. The timestamp represents the number of milliseconds that have elapsed since January 1, 1970. Note: the returned date will not retain the seconds & milliseconds."},dateAdd:{id:"database.formula2.function.dateAdd.description",defaultMessage:"Adds time to the date. The unit argument can be one of: “years”, “quarters”, “months”, “weeks”, “days”, “hours”, or “minutes”."},dateSubtract:{id:"database.formula2.function.dateSubtract.description",defaultMessage:"Subtracts time from the date. The unit argument can be one of: “years”, “quarters”, “months”, “weeks”, “days”, “hours”, or “minutes”."},dateBetween:{id:"database.formula2.function.dateBetween.description",defaultMessage:"Returns the difference between two dates. The unit argument can be one of: “years”, “quarters”, “months”, “weeks”, “days”, “hours”, or “minutes”."},formatDate:{id:"database.formula2.function.formatDate.description",defaultMessage:"Formats the date using a custom format string and optional timezone. The format string can contain the following text to represent parts of the date: “YYYY” for year, “MM” for month, “DD” for day, “HH” for hour, “mm” for minute."},date:{id:"database.formula2.function.date.description",defaultMessage:"Returns the day of the month from the date (1-31)."},day:{id:"database.formula2.function.day.description",defaultMessage:"Returns the day of the week of the date, between 1 (Monday) and 7 (Sunday)."},month:{id:"database.formula2.function.month.description",defaultMessage:"Returns the month of the date (1-12)."},week:{id:"database.formula2.function.week.description",defaultMessage:"Returns the ISO week of the year of the date (1-53)."},year:{id:"database.formula2.function.year.description",defaultMessage:"Returns the year of the date."},hour:{id:"database.formula2.function.hour.description",defaultMessage:"Returns the hour of the date (0-23)."},minute:{id:"database.formula2.function.minute.description",defaultMessage:"Returns the minute of the date (0-59)."},parseDate:{id:"database.formula2.function.parseDate.description",defaultMessage:"Returns the date parsed according to the ISO 8601 standard."},dateRange:{id:"database.formula2.function.dateRange.description",defaultMessage:"Returns a date range constructed from the start and end dates."},dateStart:{id:"database.formula2.function.dateStart.description",defaultMessage:"Returns the start of the date range."},dateEnd:{id:"database.formula2.function.dateEnd.description",defaultMessage:"Returns the end of the date range."},id:{id:"database.formula2.function.id.description",defaultMessage:"Returns the id of the page or person. If no page or person is provided, returns the id of the page the formula is on."},name:{id:"database.formula2.function.name.description",defaultMessage:"Returns the name of a person."},email:{id:"database.formula2.function.email.description",defaultMessage:"Returns the email address of a person."},lower:{id:"database.formula2.function.lower.description",defaultMessage:"Converts the text to lowercase."},upper:{id:"database.formula2.function.upper.description",defaultMessage:"Converts the text to uppercase."},trim:{id:"database.formula2.function.trim.description",defaultMessage:"Removes whitespace from the beginning and end of the text."},repeat:{id:"database.formula2.function.repeat.description",defaultMessage:"Repeats the text a given number of times."},padStart:{id:"database.formula2.function.padStart.description",defaultMessage:"Returns the text padded with the provided padding string at the start until the target length is reached."},padEnd:{id:"database.formula2.function.padEnd.description",defaultMessage:"Returns the text padded with the provided padding string at the end until the target length is reached."},_wait:{id:"database.formula2.function._wait.description",defaultMessage:"Waits for the specified amount of time, then returns the result."},_unsafeCastArray:{id:"database.formula2.function.unsafeCastArray.description",defaultMessage:"Casts an array of unknown type to the type of the second array parameter"},count:{id:"database.formula2.function.count.description",defaultMessage:"Returns the number of elements in a list for which the condition is true. If no condition is provided, returns the total number of elements (equivalent to length())."}});function w(e){if(!e)throw new Error("Assertion failed in formulaLibraryFunctions")}const M={type:"undefined"},N={name:"expression",type:{type:"expression"},augmentScope:e=>{var t;const n="array"===(null===(t=e[0])||void 0===t?void 0:t.type)?e[0].of:{type:"unknown"};return{[h().CURRENT_VALUE_NAME]:n,[h().CURRENT_INDEX_NAME]:{type:"number"}}}},E={expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},N]},I={expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},{...N,optional:!0}]},C={if:{name:"if",*eval(){throw new(f().V)("if() should be compiled, not evaluated as a library function")},parameters:{expected:[{name:"condition",type:{type:"checkbox"}},{name:"ifTrue",type:{type:"expression"}},{name:"ifFalse",type:{type:"expression"}}]},returnType:([e,t,n])=>(0,b().qk)(t,n),iconType:{type:"checkbox"},examples:[[{input:"if(true, 1, 2)",output:"1"},{input:"if(false, 1, 2)",output:"2"},{input:[(0,k().Py)("Checked"),[' == true ? "Complete" : "Incomplete"']]}],[{input:"true.if(1, 2)",output:"1"},{input:"false.if(1, 2)",output:"2"}]],syntax:["if(condition, ifTrue, ifFalse)","condition.if(ifTrue, ifFalse)"],description:T.if},ifs:{name:"ifs",parameters:{expected:[{name:"condition",type:{type:"checkbox"}},{name:"ifTrue",type:{type:"expression"}}],varargs:[{name:"rest",type:{type:"expression"}}]},returnType:e=>{if(e.length<2)return{type:"unknown"};const t=e[1];let n=2;for(;n<e.length-1;n+=2)if(!(0,b().Re)(e[n+1],t))return{type:"unknown"};if(n===e.length-1){const r=e[n];if(!(0,b().Re)(r,t))return{type:"unknown"}}return t},*eval(){throw new(f().V)("ifs() should be compiled, not evaluated as a library function")},iconType:{type:"checkbox"},examples:[[{input:"ifs(true, 1, true, 2, 3)",output:"1"},{input:"ifs(false, 1, false, 2, 3)",output:"3"}],[{input:"true.ifs(1, true, 2, 3)",output:"1"},{input:"false.ifs(1, false, 2, 3)",output:"3"}]],syntax:["ifs(condition, ifTrue, condition2, ifTrue2, ..., else)","condition.ifs(ifTrue, condition2, ifTrue2, ..., else)"],description:T.ifs},and:{name:"and",*eval(e,t){return{type:"checkbox",value:e.every((e=>(0,b().CL)(e)))}},parameters:{varargs:[{name:"value",type:[{type:"unknown"}]}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"and(true, true, true)",output:"true"},{input:"and(3 > 2, 2 < 3)",output:"false"}],[{input:"true.and(true, true)",output:"true"},{input:"(3 > 2).and(2 < 3)",output:"false"}]],syntax:["and(boolean, boolean, ...)","boolean.and(boolean, ...)"],description:x().Q$.and},or:{name:"or",*eval(e,t){return{type:"checkbox",value:e.some((e=>(0,b().CL)(e)))}},parameters:{varargs:[{name:"value",type:[{type:"unknown"}]}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"or(true, false, false)",output:"true"},{input:"or(3 > 2, 2 < 3)",output:"true"}],[{input:"true.or(false, false)",output:"true"},{input:"(3 > 2).or(2 < 3)",output:"true"}]],syntax:["or(boolean, boolean, ...)","boolean.or(boolean, ...)"],description:x().Q$.or},not:{name:"not",*eval(e,t){const[n]=e;return{type:"checkbox",value:!(0,b().CL)(n)}},parameters:{varargs:[{name:"value",type:[{type:"unknown"}]}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"not(true)",output:"false"},{input:"not(2 > 3)",output:"true"}],[{input:"true.not()",output:"false"},{input:"(2 > 3).not()",output:"true"}]],syntax:["not(boolean)","boolean.not()"],description:x().Q$.not},empty:{name:"empty",*eval(e,t){if(0===e.length)return{type:"undefined"};const[n]=e;return{type:"checkbox",value:"array"===n.type?0===n.values.length:!(0,b().CL)(n)}},parameters:{expected:[{name:"input",type:{type:"unknown"},optional:!0}]},returnType:e=>0===e.length?{type:"undefined"}:{type:"checkbox"},iconType:{type:"unknown"},examples:[[{input:"empty()",output:[["empty",[["i"]]]]},{input:"empty(0)",output:"true"},{input:"empty([])",output:"true"}],[{input:"0.empty()",output:"true"},{input:"[].empty()",output:"true"}]],syntax:["empty(value?)","value.empty()"],description:T.empty},length:{name:"length",*eval(e,t){const[n]=e;return"array"===n.type?{type:"number",value:n.values.length}:(w("text"===n.type),{type:"number",value:n.value.reduce(((e,t)=>e+(0,m().WWE)(t)),0)})},parameters:{expected:[{name:"input",type:[{type:"text"},{type:"array",of:{type:"unknown"}}]}]},returnType:{type:"number"},iconType:{type:"text"},examples:[[{input:'length("hello")',output:"5"},{input:"length([1, 2, 3])",output:"3"}],[{input:'"hello".length()',output:"5"},{input:"[1, 2, 3].length()",output:"3"}]],syntax:["length(value)","value.length()"],description:T.length},substring:{name:"substring",*eval(e,t){const[n,r,o]=e;w("text"===n.type&&"number"===r.type);return{type:"text",value:[[(yield*(0,b().o7)(n.value,t)).slice(r.value,"number"===(null==o?void 0:o.type)?o.value:void 0)]]}},parameters:{expected:[{name:"target",type:{type:"text"}},{name:"startIndex",type:{type:"number"}},{name:"endIndex",optional:!0,type:{type:"number"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'substring("Notion", 0, 3)',output:'"Not"'},{input:'substring("Notion", 3)',output:'"ion"'}],[{input:'"Notion".substring(0, 3)',output:'"Not"'},{input:'"Notion".substring(3)',output:'"ion"'}]],syntax:["substring(text, startIndex, endIndex?)","text.substring(startIndex, endIndex?)"],description:T.substring},contains:{name:"contains",*eval(e,t){const[n,r]=e;w("text"===n.type&&"text"===r.type);const[o,a]=yield*(0,b().h8)([n.value,r.value],t);return{type:"checkbox",value:o.includes(a)}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"search",type:{type:"text"}}]},returnType:{type:"checkbox"},iconType:{type:"text"},examples:[[{input:'contains("Notion", "ot")',output:"true"}],[{input:'"Notion".contains("ot")',output:"true"}]],syntax:["contains(value, search)","value.contains(search)"],description:T.contains},test:{name:"test",*eval(e,t){const[n,r]=e;w("text"===n.type&&"text"===r.type);const[o,a]=yield*(0,b().h8)([r.value,n.value],t);return{type:"checkbox",value:S({context:t,pattern:o}).test(a)}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"pattern",type:{type:"text"}}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:'test("Notion", "Not")',output:"true"},{input:'test("Notion", "\\d")',output:"false"}],[{input:'"Notion.test("Not")',output:"true"},{input:'"Notion".test("\\d")',output:"false"}]],syntax:["test(text, pattern)","text.test(pattern)"],description:T.test},match:{name:"match",*eval(e,t){const[n,r]=e;w("text"===n.type&&"text"===r.type);const[o,a]=yield*(0,b().h8)([n.value,r.value],t),s=S({context:t,pattern:a,flags:"g"}),i=o.match(s);return i?{type:"array",values:i.map((e=>({type:"text",value:(0,m().x9d)(e)})))}:{type:"array",values:[]}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"pattern",type:{type:"text"}}]},returnType:{type:"array",of:{type:"text"}},iconType:{type:"text"},examples:[[{input:'match("Notion Notion", "Not")',output:'["Not", "Not"]'},{input:'match("Notion 123 Notion 456", "\\d+")',output:'["123", "456"]'}],[{input:'"Notion Notion".match("Not")',output:'["Not", "Not"]'},{input:'"Notion 123 Notion 456".match("\\d+")',output:'["123", "456"]'}]],syntax:["match(text, pattern)","text.match(pattern)"],description:T.match},replace:{name:"replace",*eval(e,t){const[n,r,o]=e;w("text"===n.type&&"text"===r.type);const[a,s,i]=yield*(0,b().h8)([n.value,r.value,"text"===(null==o?void 0:o.type)?o.value:void 0],t),u=S({context:t,pattern:s});return{type:"text",value:(0,m().x9d)(a.replace(u,i))}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"pattern",type:{type:"text"}},{name:"replacement",optional:!0,type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'replace("Notion Notion", "N", "M")',output:'"Motion Notion"'}],[{input:'"Notion Notion".replace("N", "M")',output:'"Motion Notion"'}]],syntax:["replace(text, pattern, replacement?)","text.replace(pattern, replacement?)"],description:T.replace},replaceAll:{name:"replaceAll",*eval(e,t){const[n,r,o]=e;w("text"===n.type&&"text"===r.type);const[a,s,i]=yield*(0,b().h8)([n.value,r.value,"text"===(null==o?void 0:o.type)?o.value:void 0],t),u=S({context:t,pattern:s,flags:"g"});return{type:"text",value:(0,m().x9d)(a.replace(u,i))}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"pattern",type:{type:"text"}},{name:"replacement",optional:!0,type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'replaceAll("Notion Notion", "N", "M")',output:'"Motion Motion"'},{input:'replaceAll("Notion 123", "\\d", "")',output:'"Notion"'}],[{input:'"Notion Notion".replaceAll("N", "M")',output:'"Motion Motion"'},{input:'"Notion 123".replaceAll("\\d", "")',output:'"Notion"'}]],syntax:["replaceAll(text, pattern, replacement?)","text.replaceAll(pattern, replacement?)"],description:T.replaceAll},lower:{name:"lower",*eval(e){const[t]=e;w("text"===t.type);return{type:"text",value:t.value.map((e=>{const t=(0,m().uPN)(e),n=(0,m().N8A)(e);return(0,m().Ey_)(n.toLowerCase(),t)}))}},parameters:{expected:[{name:"text",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'lower("NOTION")',output:'"notion"'}],[{input:'"NOTION".lower()',output:'"notion"'}]],syntax:["lower(text)","text.lower()"],description:T.lower},upper:{name:"upper",*eval(e){const[t]=e;w("text"===t.type);return{type:"text",value:t.value.map((e=>{const t=(0,m().uPN)(e),n=(0,m().N8A)(e);return(0,m().Ey_)(n.toUpperCase(),t)}))}},parameters:{expected:[{name:"text",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'upper("notion")',output:'"NOTION"'}],[{input:'"notion".upper()',output:'"NOTION"'}]],syntax:["upper(text)","text.upper()"],description:T.upper},trim:{name:"trim",*eval(e){const[t]=e;return w("text"===t.type),{type:"text",value:(0,m().bBR)(t.value)}},parameters:{expected:[{name:"text",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'trim("  notion  ")',output:'"notion"'}],[{input:'"  notion  ".trim()',output:'"notion"'}]],syntax:["trim(text)","text.trim()"],description:T.trim},repeat:{name:"repeat",*eval(e){const[t,n]=e;w("text"===t.type),w("number"===n.type);const r=[],o=Math.min(n.value,1e4);for(let a=0;a<o;a++)r.push(...t.value);return{type:"text",value:r}},parameters:{expected:[{name:"text",type:{type:"text"}},{name:"count",type:{type:"number"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'repeat("0", 4)',output:'"0000"'},{input:'repeat("~=", 10).style("blue")',output:[['"'],["~=~=~=~=~=~=~=~=~=~=",[["h","blue"]]],['"']]}],[{input:'"0".repeat(4)',output:'"0000"'},{input:'"~=".repeat(10).style("blue")',output:[['"'],["~=~=~=~=~=~=~=~=~=~=",[["h","blue"]]],['"']]}]],syntax:["repeat(text, count)","text.repeat(count)"],description:T.repeat},padStart:{name:"padStart",*eval(e,t){const[n,r,o]=e;return w("text"===n.type&&"number"===r.type&&"text"===o.type),yield*(0,k().tr)(n.value,r.value,o.value,"start",t)},parameters:{expected:[{name:"text",type:{type:"text"}},{name:"targetLength",type:{type:"number"}},{name:"padString",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'padStart("A", 3, ".")',output:'"..A"'},{input:"padStart(123, 5, 0)",output:'"00123"'}],[{input:'"A".padStart(3, ".")',output:'"..A"'},{input:"123.padStart(5, 0)",output:'"00123"'}]],syntax:["padStart(text, targetLength, padString)","text.padStart(targetLength, padString)"],description:T.padStart},padEnd:{name:"padEnd",*eval(e,t){const[n,r,o]=e;return w("text"===n.type&&"number"===r.type&&"text"===(null==o?void 0:o.type)),yield*(0,k().tr)(n.value,r.value,o.value,"end",t)},parameters:{expected:[{name:"text",type:{type:"text"}},{name:"targetLength",type:{type:"number"}},{name:"padString",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'padEnd("A", 3, ".")',output:'"A.."'},{input:"padEnd(123, 5, 0)",output:'"12300"'}],[{input:'"A".padEnd(3, ".")',output:'"A.."'},{input:"123.padEnd(5, 0)",output:'"12300"'}]],syntax:["padEnd(text, targetLength, padString)","text.padEnd(targetLength, padString)"],description:T.padEnd},link:{name:"link",*eval(e){const[t,n]=e;return w("text"===t.type),w("text"===n.type),{type:"text",value:(0,m().lux)(t.value,(0,m().k4p)(n.value))}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"url",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'link("Notion", "https://notion.so")',output:[['"'],["Notion",[(0,m().Sez)("https://notion.so")]],['"']]}],[{input:'"Notion".link("https://notion.so")',output:[['"'],["Notion",[(0,m().Sez)("https://notion.so")]],['"']]}]],syntax:["link(text, url)","text.link(url)"],description:T.link},style:{name:"style",*eval(e){const[t,...n]=e;w("text"===t.type),n.forEach((e=>w("text"===e.type)));const r=n.length>0?(0,k().kk)(n.map((e=>(w("text"===e.type),e.value))).filter(s().O9)):[];return{type:"text",value:(0,k().xK)(t.value,r)}},parameters:{expected:[{name:"input",type:{type:"text"}}],varargs:[{name:"styles",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'style("Notion", "b", "u")',output:[['"'],["Notion",[["b"],["_"]]],['"']]},{input:'style("Notion", "blue", "gray_background")',output:[['"'],["Notion",[["h","blue"],["h","blue_background"]]],['"']]}],[{input:'"Notion".style("b", "u")',output:[['"'],["Notion",[["b"],["_"]]],['"']]},{input:'"Notion".style("blue", "blue_background")',output:[['"'],["Notion",[["h","blue"],["h","blue_background"]]],['"']]}]],syntax:["style(value, styles)","value.style(styles)"],description:T.style},unstyle:{name:"unstyle",*eval(e){const[t,...n]=e;w("text"===t.type);const r=n.length>0?(0,k().kk)(n.map((e=>(w("text"===e.type),e.value))).filter(s().O9)):void 0;return{type:"text",value:(0,k().qs)(t.value,r)}},parameters:{expected:[{name:"input",type:{type:"text"}}],varargs:[{name:"styles",optional:!0,type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:[['unstyle("'],["Text",[["b"],["c"]]],['")']],output:[['"Text"']]},{input:[['unstyle("'],["Text",[["h","blue"],["b"]]],['", "blue")']],output:[['"'],["Text",[["b"]]],['"']]}],[{input:[['"'],["Text",[["b"],["c"]]],['".unstyle()']],output:[['"Text"']]},{input:[['"'],["Text",[["h","blue"],["b"]]],['".unstyle("blue")']],output:[['"'],["Text",[["b"]]],['"']]}]],syntax:["unstyle(value, styles?)","value.unstyle(styles?)"],description:T.unstyle},format:{name:"format",*eval(e,t){const[n]=e,r=(0,b().Ht)(n);return{type:"text",value:(0,m().x9d)(yield*(0,b().o7)(r,t))}},parameters:{expected:[{name:"input",type:{type:"unknown"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:"format(1234)",output:'"1234"'},{input:"format(now())",output:[['"'],[(0,d().u)(o().DateTime.now(),"MMMM D, Y HH:mm")],['"']]}],[{input:"1234.format()",output:'"1234"'},{input:"now().format()",output:[['"'],[(0,d().u)(o().DateTime.now(),"MMMM D, Y HH:mm")],['"']]}]],syntax:["format(value)","value.format()"],description:T.format},formatNumber:{name:"formatNumber",*eval(e,t){const[r,o,a]=e;w("number"===r.type),w(void 0===o||"text"===(null==o?void 0:o.type));const s=void 0===o?"number_with_commas":yield*(0,k().x3)(o.value,t);w(void 0===a||"number"===(null==a?void 0:a.type));const i=(0,n(72135).ZV)(r.value,s,t.intl,void 0,null==a?void 0:a.value);return{type:"text",value:(0,m().x9d)(i)}},parameters:{expected:[{name:"input",type:{type:"number"}},{name:"format",type:{type:"text"},optional:!0},{name:"precision",type:{type:"number"},optional:!0}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'formatNumber(12.345, "usd")',output:'"$12.35"'},{input:'formatNumber(12.345, "usd", 0)',output:'"$12"'},{input:'formatNumber(1234567890, "commas")',output:'"1,234,567,890"'},{input:'formatNumber(1234567890, "humanize")',output:'"1.2B"'}],[{input:'12.345.formatNumber("usd")',output:'"$12.35"'},{input:'12.345.formatNumber("usd", 0)',output:'"$12"'},{input:'1234567890.formatNumber("commas")',output:'"1,234,567,890"'},{input:'1234567890.formatNumber("humanize")',output:'"1.2B"'}]],syntax:["formatNumber(value, format?, precision?)","value.formatNumber(format?, precision?)"],description:T.formatNumber},add:(0,k().P7)("add",T.add,((e,t)=>Number.isInteger(e)&&Number.isInteger(t)?e+t:new(r().Big)(e).plus(t).toNumber()),"+"),subtract:(0,k().P7)("subtract",T.subtract,((e,t)=>Number.isInteger(e)&&Number.isInteger(t)?e-t:new(r().Big)(e).minus(t).toNumber()),"-"),multiply:(0,k().P7)("multiply",T.multiply,((e,t)=>Number.isInteger(e)&&Number.isInteger(t)?e*t:new(r().Big)(e).mul(t).toNumber()),"*"),mod:(0,k().P7)("mod",T.mod,((e,t)=>Number.isInteger(t)?e%t:new(r().Big)(e).mod(t).toNumber()),"%"),pow:(0,k().P7)("pow",T.pow,((e,t)=>!Number.isInteger(e)&&Number.isInteger(t)?new(r().Big)(e).pow(t).toNumber():e**t),"^"),divide:{name:"divide",description:T.divide,*eval(e,t){const[n,o]=e;return w("number"===n.type&&"number"===o.type),0===o.value?M:{type:"number",value:new(r().Big)(n.value).div(o.value).toNumber()}},returnType:{type:"number"},iconType:{type:"number"},syntax:["divide(number, number)","number.divide(number)"],parameters:{expected:[{name:"lhs",type:{type:"number"}},{name:"rhs",type:{type:"number"}}]},examples:[[{input:"divide(5, 10)",output:"0.5"},{input:"5 / 10",output:"0.5"}],[{input:"5.divide(10)",output:"0.5"},{input:"5 / 10",output:"0.5"}]]},min:{name:"min",*eval(e,t){const n=e,r=(0,b().U)({type:"array",values:n});if(0===r.values.length)return M;if(r.values.every((e=>"date"===e.type))){const e=r.values.map((e=>{if("date"===e.type)return(0,p().ln)(e.value,t.userTimeZone)})).filter(s().O9);if(0===e.length)return M;const n=e.indexOf(Math.min(...e));return r.values[n]}{const e=r.values.map((e=>"number"===e.type?e.value:void 0)).filter(s().O9);if(0===e.length)return M;return{type:"number",value:Math.min(...e)}}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"min(1, 2, 3)",output:"1"},{input:"min([1, 2, 3])",output:"1"}],[{input:"[1, 2, 3].min()",output:"1"}]],syntax:["min(list)","list.min()"],description:T.min},max:{name:"max",*eval(e,t){const n=e,r=(0,b().U)({type:"array",values:n});if(0===r.values.length)return M;if(r.values.every((e=>"date"===e.type))){const e=r.values.map((e=>{if("date"===e.type)return(0,p().ln)(e.value,t.userTimeZone)})).filter(s().O9);if(0===e.length)return M;const n=e.indexOf(Math.max(...e));return r.values[n]}{const e=r.values.map((e=>"number"===e.type?e.value:void 0)).filter(s().O9);if(0===e.length)return M;return{type:"number",value:Math.max(...e)}}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"max(1, 2, 3)",output:"3"},{input:"max([1, 2, 3])",output:"3"}],[{input:"[1, 2, 3].max()",output:"3"}]],syntax:["max(list)","list.max()"],description:T.max},sum:{name:"sum",*eval(e,t){const n=e;return{type:"number",value:(0,k().Hx)(n).reduce(((e,t)=>e.plus(t)),new(r().Big)(0)).toNumber()}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"sum(1, 2, 3)",output:"6"},{input:"sum([1, 2, 3], 4, 5)",output:"15"}],[{input:"[1, 2, 3].sum()",output:"6"},{input:"[1, 2, 3].sum(4, 5)",output:"15"}]],syntax:["sum(list)","list.sum()"],description:T.sum},median:{name:"median",*eval(e,t){const n=e,o=(0,k().Hx)(n).sort(((e,t)=>e-t));if(0===o.length)return M;if(o.length%2==0){const e=o[o.length/2-1],t=o[o.length/2];return{type:"number",value:new(r().Big)(e).plus(t).div(2).toNumber()}}return{type:"number",value:o[Math.floor(o.length/2)]}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"median(1, 2, 4)",output:"2"},{input:"median([1, 2, 3], 4)",output:"2.5"}],[{input:"[1, 2, 4].median()",output:"2"},{input:"[1, 2, 3].median(4)",output:"2.5"}]],syntax:["median(list)","list.median()"],description:T.median},mean:{name:"mean",*eval(e,t){const n=e,o=(0,k().Hx)(n);if(0===o.length)return M;return{type:"number",value:o.reduce(((e,t)=>e.plus(t)),new(r().Big)(0)).div(o.length).toNumber()}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"mean(1, 2, 3)",output:"2"},{input:"mean([1, 2, 3], 4, 5)",output:"3"}],[{input:"[1, 2, 3].mean()",output:"2"},{input:"[1, 2, 3].mean(4, 5)",output:"3"}]],syntax:["mean(list)","list.mean()"],description:T.mean},abs:(0,k().hq)("abs",T.abs,Math.abs,[10,-10]),round:{name:"round",*eval(e,t){const[n,r]=e;if(w("number"===n.type),void 0===r)return{type:"number",value:Math.round(n.value)};if(w("number"===r.type),0===r.value)return{type:"number",value:Math.round(n.value)};if(!Number.isInteger(r.value))throw new(g().x4)({type:g().v3.CannotRoundToNonInteger,precision:r.value});if(Math.abs(r.value)>12)throw new(g().x4)({type:g().v3.CannotRoundToTooManyDecimalPlaces,precision:r.value});const o=Math.pow(10,r.value);return{type:"number",value:Math.round(n.value*o)/o}},parameters:{varargs:[{name:"value",type:{type:"number"}},{name:"precision",type:{type:"number"}}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"round(1.2345)",output:"1"}],[{input:"round(1.2345, 2)",output:"1.23"}]],syntax:["round(value, precision)","value.round(precision)"],description:T.round},ceil:(0,k().hq)("ceil",T.ceil,Math.ceil,[.4,-.6]),floor:(0,k().hq)("floor",T.floor,Math.floor,[.4,-.6]),sqrt:(0,k().hq)("sqrt",T.sqrt,Math.sqrt,[4,7]),cbrt:(0,k().hq)("cbrt",T.cbrt,Math.cbrt,[9,64]),exp:(0,k().hq)("exp",T.exp,Math.exp,[1,-1]),ln:(0,k().hq)("ln",T.ln,Math.log,[Math.E,10]),log10:(0,k().hq)("log10",T.log10,Math.log10,[10,1e5]),log2:(0,k().hq)("log2",T.log2,Math.log2,[4,1024]),sign:(0,k().hq)("sign",T.sign,Math.sign,[-10,10]),pi:(0,k().SU)("pi",T.pi,Math.PI),e:(0,k().SU)("e",T.e,Math.E),toNumber:{name:"toNumber",*eval(e,t){const[r]=e;switch(r.type){case"number":return r;case"checkbox":return{type:"number",value:r.value?1:0};case"text":{const e=yield*(0,b().o7)(r.value,t),o=/^0[xbo]/.test(e)?Number(e):parseFloat(e);return(0,n(720665).Et)(o)?{type:"number",value:o}:M}case"date":return{type:"number",value:(0,p().AA)(r.value,t.userTimeZone).start.valueOf()};case"array":throw new(g().x4)({type:g().v3.CannotUseToNumberOnList});default:return M}},parameters:{expected:[{name:"input",type:{type:"unknown"}}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:'toNumber("2")',output:"2"},{input:"toNumber(now())",output:(0,p().ln)((0,p().T_)((0,c().P)()),(0,c().P)()).toString()},{input:"toNumber(true)",output:"1"}],[{input:'"2".toNumber()',output:"2"},{input:"now().toNumber()",output:(0,p().ln)((0,p().T_)((0,c().P)()),(0,c().P)()).toString()},{input:"true.toNumber()",output:"1"}]],syntax:["toNumber(value)","value.toNumber()"],description:T.toNumber},now:{name:"now",*eval(e,t){return{type:"date",value:(0,p().T_)(t.userTimeZone)}},parameters:{},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:"now()",output:[(0,m().wmz)((0,m().Ww9)((0,p().T_)((0,c().P)())))]}]],syntax:["now()"],description:T.now},today:{name:"today",*eval(e,t){return{type:"date",value:(0,p().lN)((0,p().ah)(t.userTimeZone))}},parameters:{},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:"today()",output:[(0,m().wmz)((0,m().Ww9)((0,p().lN)((0,p().ah)((0,c().P)()))))]}]],syntax:["today()"],description:T.today},minute:{name:"minute",eval:(0,k().KN)((e=>e.minute)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'minute(parseDate("2023-07-10T17:35Z"))',output:"35"}],[{input:'parseDate("2023-07-10T17:35Z").minute()',output:"35"}]],syntax:["minute(date)","date.minute()"],description:T.minute},hour:{name:"hour",eval:(0,k().KN)((e=>e.hour)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'hour(parseDate("2023-07-10T17:35Z"))',output:"17"}],[{input:'parseDate("2023-07-10T17:35Z").hour()',output:"17"}]],syntax:["hour(date)","date.hour()"],description:T.hour},day:{name:"day",eval:(0,k().KN)((e=>e.weekday)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'day(parseDate("2023-07-10T17:35Z"))',output:"1"}],[{input:'parseDate("2023-07-10T17:35Z").day()',output:"1"}]],syntax:["day(date)","date.day()"],description:T.day},date:{name:"date",eval:(0,k().KN)((e=>e.day)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'date(parseDate("2023-07-10T17:35Z"))',output:"10"}],[{input:'parseDate("2023-07-10T17:35Z").date()',output:"10"}]],syntax:["date(date)","date.date()"],description:T.date},week:{name:"week",eval:(0,k().KN)((e=>e.weekNumber)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'week(parseDate("2023-01-02"))',output:"1"}],[{input:'parseDate("2023-01-02").week()',output:"1"}]],syntax:["week(date)","date.week()"],description:T.week},month:{name:"month",eval:(0,k().KN)((e=>e.month)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'month(parseDate("2023-07-10T17:35Z"))',output:"7"}],[{input:'parseDate("2023-07-10T17:35Z").month()',output:"7"}]],syntax:["month(date)","date.month()"],description:T.month},year:{name:"year",eval:(0,k().KN)((e=>e.year)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:"year(now())",output:o().DateTime.now().year.toString()}],[{input:"now().year()",output:o().DateTime.now().year.toString()}]],syntax:["year(date)","date.year()"],description:T.year},dateAdd:{name:"dateAdd",eval:(0,k().R)(((e,t,n)=>e.plus({[n]:t}).valueOf()),"dateAdd"),parameters:{expected:[{name:"input",type:{type:"date"}},{name:"num",type:{type:"number"}},{name:"unit",type:{type:"text"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:'dateAdd(now(), 1, "days")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.now().plus({days:1}))))]},{input:'dateAdd(now(), 2, "months")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.now().plus({months:2}))))]},{input:'dateAdd(now(), 3, "years")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.now().plus({years:3}))))]}],[{input:'now().dateAdd(1, "days")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.now().plus({days:1}))))]},{input:'now().dateAdd(2, "months")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.now().minus({months:2}))))]},{input:'now().dateAdd(3, "years")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.now().plus({years:3}))))]}]],syntax:["dateAdd(date, num, unit)","date.dateAdd(num, unit)"],description:T.dateAdd},dateSubtract:{name:"dateSubtract",eval:(0,k().R)(((e,t,n)=>e.minus({[n]:t}).valueOf()),"dateSubtract"),parameters:{expected:[{name:"input",type:{type:"date"}},{name:"num",type:{type:"number"}},{name:"unit",type:{type:"text"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:'dateSubtract(now(), 1, "days")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.now().minus({days:1}))))]},{input:'dateSubtract(now(), 2, "months")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.now().minus({months:2}))))]},{input:'dateSubtract(now(), 3, "years")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.now().minus({years:3}))))]}],[{input:'now().dateSubtract(1, "days")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.now().minus({days:1}))))]},{input:'now().dateSubtract(2, "months")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.now().minus({months:2}))))]},{input:'now().dateSubtract(3, "years")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.now().minus({years:3}))))]}]],syntax:["dateSubtract(date, num, unit)","date.dateSubtract(num, unit)"],description:T.dateSubtract},dateBetween:{name:"dateBetween",*eval(e,t){const[n,r,o]=e;w("date"===n.type&&"date"===r.type&&"text"===o.type);const a=(0,p().AA)(n.value,t.userTimeZone).start,s=(0,p().AA)(r.value,t.userTimeZone).start,i=yield*(0,k().Fd)(o.value,t,"dateBetween");return{type:"number",value:Math.trunc(a.diff(s,i).get(i))}},parameters:{expected:[{name:"left",type:{type:"date"}},{name:"right",type:{type:"date"}},{name:"unit",type:{type:"text"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'dateBetween(now(), parseDate("2022-09-07"), "days")',output:Math.trunc(o().DateTime.now().diff(o().DateTime.fromISO("2022-09-07"),"days").days).toString()},{input:'dateBetween(parseDate("2030-01-01"), now(), "years")',output:Math.trunc(o().DateTime.fromISO("2030-01-01").diffNow("years").years).toString()}],[{input:'now().dateBetween(parseDate("2022-09-07"), "days")',output:Math.trunc(o().DateTime.now().diff(o().DateTime.fromISO("2022-09-07"),"days").days).toString()},{input:'parseDate("2030-01-01").dateBetween(now(), "years")',output:Math.trunc(o().DateTime.fromISO("2030-01-01").diffNow("years").years).toString()}]],syntax:["dateBetween(date, date, unit)","date.dateBetween(date, unit)"],description:T.dateBetween},dateRange:{name:"dateRange",*eval(e,t){const[n,r]=e;return w("date"===n.type&&"date"===r.type),"start_time"in n.value||"start_time"in r.value?{type:"date",value:{type:"datetimerange",start_date:n.value.start_date,start_time:"start_time"in n.value?n.value.start_time:"00:00",end_date:"end_date"in r.value?r.value.end_date:r.value.start_date,end_time:"end_time"in r.value?r.value.end_time:"start_time"in r.value?r.value.start_time:"23:59",time_zone:"time_zone"in n.value&&n.value.time_zone||"time_zone"in r.value&&r.value.time_zone||t.userTimeZone}}:{type:"date",value:{type:"daterange",start_date:n.value.start_date,end_date:"end_date"in r.value?r.value.end_date:r.value.start_date}}},parameters:{expected:[{name:"start",type:{type:"date"}},{name:"end",type:{type:"date"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:[["dateRange("],(0,k().Py)("Start Date"),[", "],(0,k().Py)("End Date"),[")"]],output:[(0,m().wmz)((0,m().Ww9)({type:"daterange",start_date:"2022-09-07",end_date:"2023-09-07"}))]}],[{input:[(0,k().Py)("Start Date"),[".dateRange("],(0,k().Py)("End Date"),[")"]],output:[(0,m().wmz)((0,m().Ww9)({type:"daterange",start_date:"2022-09-07",end_date:"2023-09-07"}))]}]],syntax:["dateRange(start, end)"],description:T.dateRange},dateStart:{name:"dateStart",*eval(e,t){const[n]=e;return w("date"===n.type),{type:"date",value:(0,u().j1)(n.value)}},parameters:{expected:[{name:"input",type:{type:"date"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:[["dateStart("],(0,k().Py)("Date Range"),[")"]],output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.fromISO("2022-09-07"))))]},{input:[["dateBetween(dateStart("],(0,k().Py)("Date Range"),["), dateEnd("],(0,k().Py)("Date Range"),['), "days")']],output:[["-365"]]}],[{input:[(0,k().Py)("Date Range"),[".dateStart()"]],output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.fromISO("2022-09-07"))))]},{input:[(0,k().Py)("Date Range"),[".dateStart().dateBetween("],(0,k().Py)("Date Range"),['.dateEnd(), "days")']],output:[["-365"]]}]],syntax:["dateStart(dateRange)","dateRange.dateStart()"],description:T.dateStart},dateEnd:{name:"dateEnd",*eval(e,t){const[n]=e;return w("date"===n.type),{type:"date",value:(0,u().mO)(n.value)}},parameters:{expected:[{name:"input",type:{type:"date"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:[["dateEnd("],(0,k().Py)("Date range"),[")"]],output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.fromISO("2023-09-07"))))]},{input:[["dateBetween(dateEnd("],(0,k().Py)("Date Range"),["), dateStart("],(0,k().Py)("Date Range"),['), "days")']],output:"365"}],[{input:[(0,k().Py)("Date Range"),[".dateEnd()"]],output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.fromISO("2023-09-07"))))]},{input:[(0,k().Py)("Date Range"),[".dateEnd().dateBetween("],(0,k().Py)("Date Range"),['.dateStart(), "days")']],output:"365"}]],syntax:["dateEnd(dateRange)","dataRange.dateEnd()"],description:T.dateEnd},timestamp:{name:"timestamp",*eval(e,t){const[n]=e;return w("date"===n.type),{type:"number",value:(0,p().ln)(n.value,t.userTimeZone)}},parameters:{expected:[{name:"input",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:"timestamp(now())",output:(0,p().ln)((0,p().T_)((0,c().P)()),(0,c().P)()).toString()}],[{input:"now().timestamp()",output:(0,p().ln)((0,p().T_)((0,c().P)()),(0,c().P)()).toString()}]],syntax:["timestamp(date)","date.timestamp()"],description:T.timestamp},fromTimestamp:{name:"fromTimestamp",*eval(e,t){const[n]=e;return w("number"===n.type),{type:"date",value:(0,p().KQ)(n.value,t.userTimeZone)}},parameters:{expected:[{name:"input",type:{type:"number"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:"fromTimestamp(1689024900000)",output:[(0,m().wmz)((0,m().Ww9)((0,p().KQ)(16890249e5,(0,c().P)())))]}],[{input:"1689024900000.fromTimestamp()",output:[(0,m().wmz)((0,m().Ww9)((0,p().KQ)(16890249e5,(0,c().P)())))]}]],syntax:["fromTimestamp(timestamp)","timestamp.fromTimestamp()"],description:T.fromTimestamp},formatDate:{name:"formatDate",*eval(e,t){const[n,r,o]=e;w("date"===(null==n?void 0:n.type)&&"text"===(null==r?void 0:r.type)),w(void 0===o||"text"===(null==o?void 0:o.type));const a=(0,k().m8)({timeZone:o,context:t});let s=(0,p().AA)((0,u().j1)(n.value),a,t.intl.locale).start;"datetime"!==n.value.type&&"datetimerange"!==n.value.type||(s=s.setZone(a));const i=yield*(0,b().o7)(r.value,t),l=`${Number(s)}:${a}:${t.intl.locale}:${i}`;let c=t.formatDateCache.get(l);return c||(c=(0,d().u)(s,i),t.formatDateCache.set(l,c)),{type:"text",value:(0,m().x9d)(c)}},parameters:{expected:[{name:"date",type:{type:"date"}},{name:"format",type:{type:"text"}},{name:"timezone",type:{type:"text"},optional:!0}]},returnType:{type:"text"},iconType:{type:"date"},examples:[[{input:'formatDate(now(), "MMMM D, Y")',output:[['"'],[(0,d().u)(o().DateTime.now(),"MMMM D, Y")],['"']]},{input:'formatDate(now(), "YYYY-MM-DD HH:mm")',output:[['"'],[(0,d().u)(o().DateTime.now(),"YYYY-MM-DD HH:mm")],['"']]},{input:'formatDate(now(), "h:mm A", "UTC+1")',output:[['"'],[(0,d().u)(o().DateTime.now().setZone("UTC+1"),"h:mm A")],['"']]}],[{input:'now().formatDate("MMMM D, Y")',output:[['"'],[(0,d().u)(o().DateTime.now(),"MMMM D, Y")],['"']]},{input:'now().formatDate("YYYY-MM-DD HH:mm")',output:[['"'],[(0,d().u)(o().DateTime.now(),"YYYY-MM-DD HH:mm")],['"']]},{input:'now().formatDate("h:mm A", "UTC+1")',output:[['"'],[(0,d().u)(o().DateTime.now().setZone("UTC+1"),"h:mm A")],['"']]}]],syntax:["formatDate(date, format, timezone?)","date.formatDate(format, timezone?)"],description:T.formatDate},parseDate:{name:"parseDate",*eval(e,t){const[n]=e;w("text"===n.type);const r=yield*(0,b().o7)(n.value,t),o=t.collectionFeatureGates.formulas_pass_timezone_when_parsing_date?(0,l().zA)(r,t.intl):(0,l().zA)(r);return o?{type:"date",value:(0,l().pT)(o)}:M},parameters:{expected:[{name:"dateString",type:{type:"text"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:'parseDate("2022-01-01")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.fromISO("2022-01-01"))))]},{input:'parseDate("2022-01-01T00:00Z")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.fromISO("2022-01-01T00:00Z"))))]}],[{input:'"2022-01-01".parseDate()',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.fromISO("2022-01-01"))))]},{input:'"2022-01-01T00:00Z".parseDate()',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(o().DateTime.fromISO("2022-01-01T00:00Z"))))]}]],syntax:["parseDate(dateText)","dateText.parseDate()"],description:T.parseDate},name:{name:"name",*eval(e,t){const[n]=e;if(w("person"===n.type),(0,y().I6)(n.value)){const e=(0,y().S4)({spacePermissionGroupId:n.value.id,spaceId:n.value.spaceId}),r=(yield{recordPointers:[e]}).getRecordModel(e);if(!r)throw new(g().x4)({type:g().v3.UserNotFound});return{type:"text",value:(0,m().x9d)(r.getDisplayName(t.intl))}}if((0,i().Pu)(n.value)){const e=(yield{recordPointers:[n.value]}).getRecordModel(n.value);if(!e)throw new(g().x4)({type:g().v3.UserNotFound});return{type:"text",value:(0,m().x9d)(e.getDisplayName(t.intl))}}(0,s().HB)(n.value)},parameters:{expected:[{name:"person",type:{type:"person"}}]},returnType:{type:"text"},iconType:{type:"person"},examples:[[{input:[["name("],(0,k().pC)(h().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[")"]],isCopyable:!0},{input:[(0,k().Py)("Pioneers"),['.map(name(current)).join(", ")']],output:'"Grace Hopper, Ada Lovelace"'}],[{input:[(0,k().pC)(h().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[".name()"]],isCopyable:!0},{input:[(0,k().Py)("Pioneers"),['.map(current.name()).join(", ")']],output:'"Grace Hopper, Ada Lovelace"'}]],syntax:["name(person)","person.name()"],description:T.name},email:{name:"email",*eval(e,t){const[n]=e;if(w("person"===n.type),(0,y().I6)(n.value))return{type:"text",value:(0,m().x9d)("")};if((0,i().Pu)(n.value)){const e=(yield{recordPointers:[n.value]}).getRecordModel(n.value);if(!e)throw new(g().x4)({type:g().v3.UserNotFound});return e.isUser()?{type:"text",value:(0,m().x9d)(e.getEmail())}:M}(0,s().HB)(n.value)},parameters:{expected:[{name:"person",type:{type:"person"}}]},returnType:{type:"text"},iconType:{type:"person"},examples:[[{input:[["email("],(0,k().pC)(h().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[")"]],isCopyable:!0},{input:[(0,k().Py)("People"),['.map(email(current)).join(", ")']]}],[{input:[(0,k().pC)(h().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[".email()"]],isCopyable:!0},{input:[(0,k().Py)("People"),['.map(current.email()).join(", ")']]}]],syntax:["email(person)","person.email()"],description:T.email},at:{name:"at",*eval(e,t){const[n,r]=e;w("array"===n.type&&"number"===r.type);const o=n.values.at(r.value);return void 0!==o?o:M},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},{name:"index",type:{type:"number"}}]},returnType:([e])=>"array"===(null==e?void 0:e.type)?e.of:{type:"unknown"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"at([1, 2, 3], 1)",output:"2"}],[{input:"[1, 2, 3].at(1)",output:"2"}]],syntax:["at(list, index)","list.at(index)"],description:T.at},first:{name:"first",*eval(e,t){const[n]=e;return w("array"===n.type),n.values.length>0?n.values[0]:M},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:([e])=>"array"===(null==e?void 0:e.type)?e.of:{type:"unknown"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"first([1, 2, 3])",output:"1"}],[{input:"[1, 2, 3].first()",output:"1"},{input:"[].first()",output:[["empty",[["i"]]]]}]],syntax:["first(list)","list.first()"],description:T.first},last:{name:"last",*eval(e,t){const[n]=e;return w("array"===n.type),n.values.length>0?n.values[n.values.length-1]:M},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:([e])=>"array"===(null==e?void 0:e.type)?e.of:{type:"unknown"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"last([1, 2, 3])",output:"3"}],[{input:"[1, 2, 3].last()",output:"3"}]],syntax:["last(list)","list.last()"],description:T.last},slice:{name:"slice",*eval(e,t){const[n,r,o]=e;return w("array"===n.type&&"number"===r.type),{type:"array",values:n.values.slice(r.value,"number"===(null==o?void 0:o.type)?o.value:void 0)}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},{name:"startIndex",type:{type:"number"}},{name:"endIndex",optional:!0,type:{type:"number"}}]},returnType:([e])=>"array"===(null==e?void 0:e.type)?e:{type:"array",of:{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"slice([1, 2, 3], 1, 2)",output:"[2]"},{input:'slice(["a", "b", "c"], 1)',output:'["b", "c"]'}],[{input:"[1, 2, 3].slice(1, 2)",output:"[2]"},{input:'["a", "b", "c"].slice(1)',output:'["b", "c"]'}]],syntax:["slice(list, startIndex, endIndex?)","list.slice(startIndex, endIndex?)"],description:T.slice},splice:{name:"splice",*eval(e,t){const[n,r,o,...a]=e;w("array"===n.type&&"number"===r.type);const i=a.length>0?a.filter(s().O9):[],u=[...n.values];return u.splice(r.value,"number"===(null==o?void 0:o.type)?o.value:0,...i),{type:"array",values:u}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},{name:"startIndex",type:{type:"number"}},{name:"deleteCount",optional:!0,type:{type:"number"}}],varargs:[{name:"items",type:{type:"unknown"}}]},returnType:([e])=>"array"===(null==e?void 0:e.type)?e:{type:"array",of:{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"splice([1, 2, 3], 1, 1)",output:"[1, 3]"},{input:'splice(["a", "b", "c"], 0, 1, "d")',output:'["d", "b", "c"]'}],[{input:"[1, 2, 3].splice(1, 1)",output:"[1, 3]"},{input:'["a", "b", "c"].splice(0, 1, "d")',output:'["d", "b", "c"]'}]],syntax:["splice(list, startIndex, deleteCount?, ...)","list.splice(startIndex, deleteCount?, ...)"],description:T.splice},concat:{name:"concat",*eval(e){return{type:"array",values:e.flatMap((e=>(w("array"===e.type),e.values.filter((e=>"undefined"!==e.type)))))}},parameters:{varargs:[{name:"arg",type:{type:"array",of:{type:"unknown"}}}]},returnType:e=>{const t=null==e?void 0:e[0];if(void 0===t)return{type:"array",of:{type:"unknown"}};for(let n=1;n<e.length;n++)if(void 0!==e[n]&&!(0,b().Re)(e[n],t))return{type:"array",of:{type:"unknown"}};return t},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"concat([1, 2], [3, 4])",output:"[1, 2, 3, 4]"},{input:'concat(["a", "b"], ["c", "d"])',output:'["a", "b", "c", "d"]'}],[{input:"[1, 2].concat([3, 4])",output:"[1, 2, 3, 4]"},{input:'["a", "b"].concat(["c", "d"])',output:'["a", "b", "c", "d"]'}]],syntax:["concat(list, list2, ...)","list.concat(list2, ...)"],description:T.concat},sort:{name:"sort",*eval(e,t){const[n,r]=e;w("array"===n.type);const o=n.values.filter((e=>"undefined"!==e.type));return{type:"array",values:void 0!==r?yield*(0,k().fr)(o,r,t):yield*(0,k().ZV)(o,t)}},parameters:I,returnType:([e])=>"array"===(null==e?void 0:e.type)?e:{type:"array",of:{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"sort([3, 1, 2])",output:"[1, 2, 3]"},{input:"sort([1, 2, 3]).reverse()",output:"[3, 2, 1]"},{input:'sort(["Yash", "Stephen", "Paul", "Simon", "Ryo"])',output:'["Paul", "Ryo", "Simon", "Stephen", "Yash"]'},{input:[["sort("],(0,k().Py)("Task"),[", current."],(0,k().Py)("Date"),[")"]],isCopyable:!1}],[{input:"[3, 1, 2].sort()",output:"[1, 2, 3]"},{input:"[1, 2, 3].sort().reverse()",output:"[3, 2, 1]"},{input:'["Yash", "Stephen", "Paul", "Simon", "Ryo"].sort()',output:'["Paul", "Ryo", "Simon", "Stephen", "Yash"]'},{input:[(0,k().Py)("Task"),[".sort(current."],(0,k().Py)("Date"),[")"]],isCopyable:!1}]],syntax:["sort(list, expression?)","list.sort(expression?)"],description:T.sort},reverse:{name:"reverse",*eval(e,t){const[n]=e;w("array"===n.type);return{type:"array",values:[...n.values].reverse()}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:([e])=>"array"===(null==e?void 0:e.type)?e:{type:"array",of:{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:'reverse(["green", "eggs", "ham"])',output:'["ham", "eggs", "green"]'}],[{input:'["green", "eggs", "ham"].reverse()',output:'["ham", "eggs", "green"]'}]],syntax:["reverse(list)","list.reverse()"],description:T.reverse},join:{name:"join",*eval(e,t){const[r,o]=e;w("array"===r.type&&"text"===o.type);const a=r.values.map((e=>(0,b().Ht)(e)));return{type:"text",value:(0,m().__s)((0,n(681873).G)(a,(()=>o.value)).flat())}},parameters:{expected:[{name:"input",type:{type:"array",of:{type:"unknown"}}},{name:"joiner",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:'join(["a", "b", "c"], ", ")',output:'"a, b, c"'},{input:'join(["dog", "go"], "")',output:'"doggo"'}],[{input:'["a", "b", "c"].join(", ")',output:'"a, b, c"'},{input:'["dog", "go"].join("")',output:'"doggo"'}]],syntax:["join(list, joiner)","list.join(joiner)"],description:T.join},split:{name:"split",*eval(e,t){const[n,r]=e;w("text"===n.type),w(void 0===r||"text"===r.type);const[o,a]=yield*(0,b().h8)([n.value,null==r?void 0:r.value],t);if(""===o)return{type:"array",values:[]};const s=" "===a||void 0===r,i=s?/\s+/:a;return{type:"array",values:o.split(i).filter((e=>!s||e.length>0)).map((e=>({type:"text",value:(0,m().x9d)(e)})))}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"separator",optional:!0,type:{type:"text"}}]},returnType:{type:"array",of:{type:"text"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:'split("apple,pear,orange", ",")',output:'["apple", "pear", "orange"]'}],[{input:'"apple,pear,orange".split(",")',output:'["apple", "pear", "orange"]'}]],syntax:["split(text, separator)","text.split(separator)"],description:T.split},unique:{name:"unique",*eval(e,t){const[n]=e;w("array"===n.type);const r=[];for(const o of n.values){(yield*(0,v().KZ)(r.map((e=>(0,b().zV)(e,o,t))))).some((e=>e))||r.push(o)}return{type:"array",values:r}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:([e])=>"array"===(null==e?void 0:e.type)?e:{type:"array",of:{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"unique([1, 1, 2])",output:"[1, 2]"}],[{input:"[1, 1, 2].unique()",output:"[1, 2]"}]],syntax:["unique(list)","list.unique()"],description:T.unique},includes:{name:"includes",*eval(e,t){const[n,r]=e;w("array"===n.type);for(const o of n.values){if(yield*(0,b().zV)(o,r,t))return{type:"checkbox",value:!0}}return{type:"checkbox",value:!1}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},{name:"needle",type:{type:"unknown"}}]},returnType:{type:"checkbox"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:'includes(["a", "b", "c"], "b")',output:"true"},{input:"includes([1, 2, 3], 4)",output:"false"}],[{input:'["a", "b", "c"].includes("b")',output:"true"},{input:"[1, 2, 3].includes(4)",output:"false"}]],syntax:["includes(list, search)","list.includes(search)"],description:T.includes},find:{name:"find",*eval(e,t){const[n,r]=e;let o,a;w("array"===n.type);for(let s=0;s<n.values.length;s++)if(o=n.values[s],a=yield*(0,k().iZ)(r,{...t,values:[...F(o,s),...t.values]}),(0,b().CL)(a))return o;return{type:"undefined"}},parameters:E,returnType:([e,t])=>"array"===(null==e?void 0:e.type)?e.of:{type:"unknown"},iconType:{type:"text"},examples:[[{input:'find(["a", "b", "c"], current == "b")',output:'"b"'},{input:"find([1, 2, 3], current > 100)",output:[["empty",[["i"]]]]}],[{input:'["a", "b", "c"].find(current == "b")',output:'"b"'},{input:"[1, 2, 3].find(current > 100)",output:[["empty",[["i"]]]]}]],syntax:["find(list, condition)","list.find(condition)"],description:T.find},findIndex:{name:"findIndex",*eval(e,t){const[n,r]=e;let o,a;w("array"===n.type);for(let s=0;s<n.values.length;s++)if(o=n.values[s],a=yield*(0,k().iZ)(r,{...t,values:[...F(o,s),...t.values]}),(0,b().CL)(a))return{type:"number",value:s};return{type:"number",value:-1}},parameters:E,returnType:{type:"number"},iconType:{type:"text"},examples:[[{input:'findIndex(["a", "b", "c"], current == "b")',output:"1"},{input:"findIndex([1, 2, 3], current > 100)",output:"-1"}],[{input:'["a", "b", "c"].findIndex(current == "b")',output:"1"},{input:"[1, 2, 3].findIndex(current > 100)",output:"-1"}]],syntax:["findIndex(list, condition)","list.findIndex(condition)"],description:T.findIndex},filter:{name:"filter",*eval(e,t){const[n,r]=e;w("array"===n.type);const o=yield*(0,k()._2)(n.values,r,t);return{type:"array",values:n.values.filter(((e,t)=>(0,b().CL)(o[t])))}},parameters:E,returnType:([e,t])=>"array"===(null==e?void 0:e.type)?e:{type:"unknown"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"filter([1, 2, 3], current > 1)",output:"[2, 3]"},{input:'filter(["a", "b", "c"], current == "a")',output:'["a"]'}],[{input:"[1, 2, 3].filter(current > 1)",output:"[2, 3]"},{input:'["a", "b", "c"].filter(current == "a")',output:'["a"]'}]],syntax:["filter(list, condition)","list.filter(condition)"],description:T.filter},some:{name:"some",*eval(e,t){const[n,r]=e;let o,a;w("array"===n.type);for(let s=0;s<n.values.length;s++)if(o=n.values[s],a=yield*(0,k().iZ)(r,{...t,values:[...F(o,s),...t.values]}),(0,b().CL)(a))return{type:"checkbox",value:!0};return{type:"checkbox",value:!1}},parameters:E,returnType:{type:"checkbox"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"some([1, 2, 3], current == 2)",output:"true"},{input:'some(["a", "b", "c"], current.length > 2)',output:"false"}],[{input:"[1, 2, 3].some(current == 2)",output:"true"},{input:'["a", "b", "c"].some(current.length > 2)',output:"false"}]],syntax:["some(list, expression)","list.some(expression)"],description:T.some},every:{name:"every",*eval(e,t){const[n,r]=e;let o,a;w("array"===n.type);for(let s=0;s<n.values.length;s++)if(o=n.values[s],a=yield*(0,k().iZ)(r,{...t,values:[...F(o,s),...t.values]}),!(0,b().CL)(a))return{type:"checkbox",value:!1};return{type:"checkbox",value:!0}},parameters:E,returnType:{type:"checkbox"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"every([1, 2, 3], current > 0)",output:"true"},{input:'every(["a", "b", "c"], current == "b")',output:"false"}],[{input:"[1, 2, 3].every(current > 0)",output:"true"},{input:'["a", "b", "c"].every(current == "b")',output:"false"}]],syntax:["every(list, condition)","list.every(condition)"],description:T.every},map:{name:"map",*eval(e,t){const[n,r]=e;return w("array"===n.type),{type:"array",values:yield*(0,k()._2)(n.values,r,t)}},parameters:E,returnType:([e,t])=>{const n="array"===(null==e?void 0:e.type)?e.sourceRelationPropertyId:void 0;return{type:"array",of:t??{type:"unknown"},...void 0!==n&&{sourceRelationPropertyId:n}}},iconType:{type:"array",of:{type:"text"}},examples:[[{input:"map([1, 2, 3], current + 1)",output:"[2, 3, 4]"},{input:"map([1, 2, 3], current + index)",output:"[1, 3, 5]"}],[{input:"[1, 2, 3].map(current + 1)",output:"[2, 3, 4]"},{input:"[1, 2, 3].map(current + index)",output:"[1, 3, 5]"}]],syntax:["map(list, expression)","list.map(expression)"],description:T.map},flat:{name:"flat",*eval(e,t){const[n]=e;w("array"===n.type);const r=[];for(const o of n.values)"array"===o.type?r.push(...o.values):r.push(o);return{type:"array",values:r}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:([e])=>{let t,n={type:"unknown"};return"array"===(null==e?void 0:e.type)&&("array"===e.of.type?(n=e.of.of,t=e.of.sourceRelationPropertyId):(n=e.of,t=e.sourceRelationPropertyId)),{type:"array",of:n,...void 0!==t&&{sourceRelationPropertyId:t}}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"flat([1, 2, 3])",output:"[1, 2, 3]"},{input:"flat([[1, 2], [3, 4]])",output:"[1, 2, 3, 4]"}],[{input:"[1, 2, 3].flat()",output:"[1, 2, 3]"},{input:"[[1, 2], [3, 4]].flat()",output:"[1, 2, 3, 4]"}]],syntax:["flat(list, list2?, ...)","list.flat(list2?, ...)"],description:T.flat},id:{name:"id",*eval(e,t){const[n]=e;if(!n){var r;const e=null===(r=t.values.find((e=>e.kind===h().FormulaContextValueKind.ThisRow)))||void 0===r?void 0:r.value;if("block"!==(null==e?void 0:e.type))throw new(g().x4)({type:g().v3.TryingToGetIdWithoutThisRow});return{type:"text",value:(0,m().x9d)((0,a().Xw)(e.value.id))}}return w("block"===n.type||"person"===n.type),{type:"text",value:(0,m().x9d)((0,a().Xw)(n.value.id))}},parameters:{expected:[{name:"value",type:[{type:"person"},{type:"block"}],optional:!0}]},returnType:{type:"text"},iconType:{type:"text"},syntax:["id(value?)","value.id()"],examples:[[{input:"id()"},{input:[["id("],(0,k().Py)("Relation"),[".first())"]]},{input:[["id("],(0,k().Py)("Person"),[".first())"]]}],[{input:[(0,k().Py)("Relation"),[".first().id()"]]},{input:[(0,k().Py)("Person"),[".first().id()"]]}]],description:T.id},equal:{name:"equal",*eval(e,t){const[n,r]=e;return{type:"checkbox",value:yield*(0,b().zV)(n,r,t)}},parameters:{expected:[{name:"lhs",type:{type:"unknown"}},{name:"rhs",type:{type:"unknown"}}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"equal(1, 1)",output:"true"},{input:'"a" == "b"',output:"false"}],[{input:"1.equal(1)",output:"true"},{input:'"a" == "b"',output:"false"}]],syntax:["equal(value, value)","value.equal(value)"],description:T.equal},unequal:{name:"unequal",*eval(e,t){const[n,r]=e;return{type:"checkbox",value:!(yield*(0,b().zV)(n,r,t))}},parameters:{expected:[{name:"lhs",type:{type:"unknown"}},{name:"rhs",type:{type:"unknown"}}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"unequal(1, 2)",output:"true"},{input:'"a" != "a"',output:"false"}],[{input:"1.unequal(2)",output:"true"},{input:'"a" != "a"',output:"false"}]],syntax:["unequal(value, value)","value.unequal(value)"],description:T.unequal},let:{name:"let",*eval(){throw new(f().V)("let() should be compiled, not evaluated as a library function")},parameters:{varargs:[{name:"args",type:{type:"expression"}}]},returnType:([e,t,n])=>n??{type:"unknown"},iconType:{type:"text"},examples:[[{input:'let(name, "Doug Engelbart", "Hello, " + name + "!")',output:'"Hello, Doug Engelbart!"'},{input:"let(radius, 4, round(pi() * radius ^ 2))",output:"50"}],[{input:'name.let("Alan Kay", "Hello, " + name + "!")',output:'"Hello, Alan Kay!"'},{input:"radius.let(4, round(pi() * radius ^ 2)",output:"50"}]],syntax:["let(variable, value, expression)","variable.let(value, expression)"],description:T.let},lets:{name:"lets",*eval(){throw new(f().V)("lets() should be compiled, not evaluated as a library function")},parameters:{varargs:[{name:"args",type:{type:"expression"}}]},returnType:e=>e[e.length-1]??{type:"unknown"},iconType:{type:"text"},examples:[[{input:'lets(a, "Hello", b, "world", a + " " + b)',output:'"Hello world"'},{input:"lets(base, 3, height, 8, base * height / 2)",output:"12"}],[]],syntax:["lets(variable, value, variable2, value2, ..., expression)","variable.lets(value, variable2, value2, ..., expression)"],description:T.lets},_unsafeCastArray:{name:"_unsafeCastArray",description:T._unsafeCastArray,*eval(e,t){const[n,r]=e;return w("array"===n.type),w("array"===r.type),n},parameters:{expected:[{name:"arrayToConvert",type:{type:"array",of:{type:"unknown"}}},{name:"typeTemplate",type:{type:"array",of:{type:"unknown"}}}]},returnType:([e,t])=>t??{type:"unknown"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"_unsafeCastArray([1, 2, 3], [true, false])",output:"[1, 2, 3]"}]],syntax:["_unsafeCastArray(arrayToConvert, typeTemplate)"]},count:{name:"count",description:T.count,*eval(e,t){const[n,r]=e;if(w("array"===n.type),!(0,s().O9)(r))return{type:"number",value:n.values.length};let o=0;return yield*(0,v().KZ)(n.values.map((function*(e,n){const a=yield*(0,k().iZ)(r,{...t,values:[{kind:h().FormulaContextValueKind.Binding,id:h().CURRENT_VALUE_NAME,value:e},{kind:h().FormulaContextValueKind.Binding,id:h().CURRENT_INDEX_NAME,value:{type:"number",value:n}},...t.values]});(0,b().CL)(a)&&(o+=1)}))),{type:"number",value:o}},parameters:I,returnType:([e])=>"array"===(null==e?void 0:e.type)?{type:"number"}:{type:"unknown"},iconType:{type:"number"},examples:[[{input:"count([1, 2, 3, 4], current % 2 == 0)",output:"2"},{input:'count(["a", "b", "c"], current == "d")',output:"0"}],[{input:"[1, 2, 3, 4].count(current % 2 == 0)",output:"2"},{input:'["a", "b", "c"].count(current == "d")',output:"0"}]],syntax:["count(list, condition)","list.count(condition)"]}},R=(T._wait,C),A=["block","array","person"],P=["let","lets"];function F(e,t){return[{kind:h().FormulaContextValueKind.Binding,id:h().CURRENT_VALUE_NAME,value:e},{kind:h().FormulaContextValueKind.Binding,id:h().CURRENT_INDEX_NAME,value:{type:"number",value:t}}]}function S({context:e,pattern:t,flags:n}){const r=`${t}|${n}`,o=e.regExpCache.get(r);if(o)return o.lastIndex=0,o;let a;if("[^T]*$"===t)try{a=new RegExp("(?<=^|T)[^T]*$",n)}catch(s){a=new RegExp(t,n)}else a=new RegExp(t,n);return e.regExpCache.set(r,a),a}const O={if:"generic",ifs:"generic",let:"generic",lets:"generic",and:"generic",or:"generic",not:"generic",equal:"generic",unequal:"generic",empty:"generic",length:"generic",format:"generic",concat:"text",join:"text",split:"text",substring:"text",contains:"text",lower:"text",upper:"text",trim:"text",replace:"text",replaceAll:"text",test:"text",match:"text",link:"text",style:"text",unstyle:"text",padStart:"text",padEnd:"text",repeat:"text",add:"number",subtract:"number",multiply:"number",divide:"number",mod:"number",pow:"number",sum:"number",max:"number",min:"number",mean:"number",median:"number",abs:"number",round:"number",ceil:"number",floor:"number",sqrt:"number",cbrt:"number",exp:"number",ln:"number",log10:"number",log2:"number",sign:"number",pi:"number",e:"number",toNumber:"number",formatNumber:"number",now:"date",today:"date",minute:"date",hour:"date",day:"date",date:"date",month:"date",year:"date",week:"date",dateAdd:"date",dateSubtract:"date",dateBetween:"date",formatDate:"date",fromTimestamp:"date",timestamp:"date",dateStart:"date",dateEnd:"date",dateRange:"date",parseDate:"date",name:"people",email:"people",at:"list",first:"list",last:"list",slice:"list",splice:"list",reverse:"list",sort:"list",unique:"list",includes:"list",map:"list",filter:"list",find:"list",findIndex:"list",some:"list",every:"list",flat:"list",count:"list",id:"special",_unsafeCastArray:"internal",_wait:"internal"}},906063:(e,t,n)=>{n.d(t,{PX:()=>oe,cZ:()=>me,Ox:()=>ue,RE:()=>le,Xs:()=>ce,YQ:()=>de});n(18107),n(944114),n(967357),n(898992),n(823215),n(672577),n(581454),n(737550);var r=()=>n(763824),o=()=>n(973647),a=()=>n(534177),s=()=>n(696706),i=()=>n(179034),u=()=>n(437607),p=()=>n(798880),l=()=>n(349835);function d(e){if(e.kind===l().NM.Boolean||e.kind===l().NM.LogicalAnd||e.kind===l().NM.LogicalOr||e.kind===l().NM.Relational||e.kind===l().NM.Equality)return"checkbox";if(e.kind===l().NM.Number||e.kind===l().NM.Additive||e.kind===l().NM.Exponentiation||e.kind===l().NM.Multiplicative)return"number";if(e.kind===l().NM.String)return"text";if(e.kind===l().NM.Array)return"array";if(e.kind===l().NM.Unary){if("-"===e.op)return"number";if("!"===e.op||"not"===e.op)return"checkbox";(0,a().HB)(e.op)}else{if(e.kind===l().NM.Call||e.kind===l().NM.Conditional||e.kind===l().NM.Identifier||e.kind===l().NM.MemberBlockProperty||e.kind===l().NM.NotionToken||e.kind===l().NM.UnifiedFunctionProperty||e.kind===l().NM.RecoveryNode)return"undefined";(0,a().HB)(e)}}var c=()=>n(96033),y=()=>n(247331);function m(e,t){return"array"!==e.type?"undefined"===e.type||e.type===t.type:"array"===t.type&&e.values.every((e=>"array"===e.type?m(e,t):m(e,t.of)))}function f(e,t){return"undefined"===e.type||t.some((t=>m(e,t)))}n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(354520),n(430670);var h=n.n(n(598629)),v=()=>n(319625),x=()=>n(496603),g=()=>n(764880),b=()=>n(657970),k=()=>n(187696),T=()=>n(302322),w=()=>n(363170),M=()=>n(716016),N=()=>n(713998),E=()=>n(568063),I=()=>n(835195),C=()=>n(715913),R=()=>n(792071),A=()=>n(519831),P=()=>n(797809),F=()=>n(201980),S=()=>n(342581),O=()=>n(696446),L=()=>n(106714),_=()=>n(80979),D=()=>n(239381),U=()=>n(383969),B=()=>n(373907),G=()=>n(628048);const q=3e5;function*V(e,t){var n;const r=yield*(0,O().Xq)(e);if(r)return{collectionPointer:r.pointer,schema:r.getNormalizedSchema()};const o=e.getParentPointer();return o.table===A().Vl&&o.id===(null===(n=t.publicPageDataCollection)||void 0===n?void 0:n.id)?{collectionPointer:o,schema:t.publicPageDataCollection.schema}:{collectionPointer:void 0,schema:void 0}}function*W(e){const{block:t,property:n,parentCollectionPointer:r,schema:s,propertySchema:u,oldContext:p,evaluateAST:d}=e;if("rollup"===u.type){const e=`${t.id}:${n}`;if(p.visitedProperties.has(e))throw new(l().I3)({type:l().uW.CycleDetected,errorSource:{blockId:t.id,collectionId:r.id,propertyId:n}});const o=new Set(p.visitedProperties);o.add(e);const i=(0,S().wr)({resultCache:p.resultCache,blockId:t.id,property:n});if(void 0!==i)return i;const f={...p,visitedProperties:o,depth:p.depth+1};if(u.aggregation&&"show_unique"!==u.aggregation){var c;const e=yield*(0,O().OH)(n,s),{relation_property:o}=u;if(null==e||!e.targetCollectionPointer||!o)return{type:"undefined"};const a=(0,N().n)(null===(c=t.getProperties())||void 0===c?void 0:c[o]);if(void 0===a)return{type:"undefined"};a.push(e.targetCollectionPointer),a.push(t.pointer);const{getRecordModel:i}=yield{recordPointers:a,collectionBlockProperties:[{blockPointers:[t.pointer],collectionPointer:r,schema:s,property:n}]},d={error:null},y=(0,E().Pm)({property:n,schema:s,block:t,getRecordModel:i,collectionRequestContext:{...f,userId:void 0,getRelationEdgeList:f.getRelationEdgeList},formula2Error:d,formulasModule:_(),spaceIdCreator:p.spaceIdCreator});if(null!==d.error){if(!d.error.info.errorSource)throw new(l().I3)({...d.error.info,errorSource:{blockId:t.id,collectionId:r.id,propertyId:n}});throw d.error}if(void 0===y)return{type:"undefined"};const m=function(e){if(void 0===e.value)return{type:"undefined"};switch(e.type){case"text":return{type:"text",value:(0,F().x9d)(e.value)};case"number":return{type:"number",value:e.value};case"date":return{type:"date",value:e.value}}}(y);return(0,S().wZ)({resultCache:f.resultCache,blockId:t.id,property:n,value:m}),m}{var m;const e=yield*(0,O().OH)(n,s),{relation_property:r}=u;if(void 0===e||void 0===r)return{type:"undefined"};if("person"===e.rollupType)return{type:"undefined"};const{relationPropertySchema:o,targetCollectionSchema:i,targetCollectionModel:l,targetProperty:c}=e,h=(0,N().n)(null===(m=t.getProperties())||void 0===m?void 0:m[r]),v=yield*(0,O().Sp)(h,o);if(0===v.length){const e={type:"array",values:[]};return(0,S().wZ)({resultCache:f.resultCache,blockId:t.id,property:n,value:e}),e}const g=yield*(0,O().KZ)(v.flatMap((e=>{const t=i[c];if(void 0===t)return[];const n={kind:y().FormulaContextValueKind.ThisRow,value:{type:"block",value:e.pointer}};return f.values=[n],[W({block:e,property:c,parentCollectionPointer:l.pointer,schema:i,propertySchema:t,oldContext:f,evaluateAST:d})]}))),b=(0,D().U)({type:"array",values:g});if(b.values.length&&"show_unique"===u.aggregation){const e=(0,S().wr)({resultCache:p.resultCache,blockId:t.id,property:n});if(void 0!==e)return e;h.push(t.pointer);const r=b.values.map((e=>"block"===e.type?e.value:void 0)).filter(a().O9);h.push(...r);const{getRecordModel:o}=yield{recordPointers:h},{getRecordModel:s}=yield{recordPointers:r.map((e=>o(e))).filter(a().O9).flatMap((e=>(0,N().dg)(e.getProperty("title"))))},i=R().b4_.tryUntilFound(o,s),u=x().hS(b.values,(e=>(0,I().R2)({result:e,getRecordModel:i,userTimeZone:f.userTimeZone,intl:f.intl}))),l={type:"array",values:u};return(0,S().wZ)({resultCache:f.resultCache,blockId:t.id,property:n,value:l}),l}const k={type:"array",values:b.values};return(0,S().wZ)({resultCache:f.resultCache,blockId:t.id,property:n,value:k}),k}}if("formula"===u.type){const e=`${t.id}:${n}`;if(p.visitedProperties.has(e))throw new(l().I3)({type:l().uW.CycleDetected,errorSource:{blockId:t.id,collectionId:r.id,propertyId:n}});const a=new Set(p.visitedProperties);if("v2"===u.version){a.add(e);const r=(0,S().wr)({resultCache:p.resultCache,blockId:t.id,property:n});if(void 0!==r)return r}const i={...p,visitedProperties:a,depth:p.depth+1};if(void 0===u.version){const{getRecordModel:e}=yield{collectionBlockProperties:[{blockPointers:[t.pointer],collectionPointer:r,schema:s,property:n}]},o={error:null},a=(0,U().L7)({schema:s,property:n,block:t,getRecordModel:e,collectionRequestContext:{userId:void 0,userTimeZone:i.userTimeZone,intl:i.intl,depth:i.depth,resultCache:i.resultCache,regExpCache:i.regExpCache,formatDateCache:i.formatDateCache,logFormulaTimeoutFn:i.logFormulaTimeoutFn,visitedProperties:i.visitedProperties,experimentService:i.experimentService,collectionFeatureGates:i.collectionFeatureGates,getRelationEdgeList:i.getRelationEdgeList},formula2Error:o,spaceIdCreator:p.spaceIdCreator});if(null!==o.error){if(!o.error.info.errorSource)throw new(l().I3)({...o.error.info,errorSource:{blockId:t.id,collectionId:r.id,propertyId:n}});throw o.error}switch(typeof a){case"string":return{type:"text",value:(0,F().x9d)(a)};case"number":return{type:"number",value:a};case"boolean":return{type:"checkbox",value:a};case"object":return{type:"date",value:a};default:return{type:"undefined"}}}else{var f;const e=null===(f=u.formula2)||void 0===f?void 0:f.code;if(!e)return{type:"undefined"};const a=(0,S().wr)({resultCache:i.resultCache,blockId:t.id,property:n});if(void 0!==a)return a;const s=(0,B().$t)(e);if(o().Q.isFail(s)){if(i.throwOnDownstreamParseFailures)throw new(l().I3)({type:l().uW.DownstreamParseFailure,parserError:s.error,collectionId:r.id,property:n,errorSource:{blockId:t.id,collectionId:r.id,propertyId:n}});return{type:"undefined"}}const p={kind:y().FormulaContextValueKind.ThisRow,value:{type:"block",value:t.pointer}};i.values=[p];try{const e=yield*d(s.value,i);return(0,S().wZ)({resultCache:i.resultCache,blockId:t.id,property:n,value:e}),e}catch(G){if(G instanceof l().I3&&!G.info.errorSource)throw new(l().I3)({...G.info,errorSource:{blockId:t.id,collectionId:r.id,propertyId:n}});throw G}}}else if((0,a().Xk)(y().FormulaTokenSupportedBlockSystemPropertyList,u.type))return(0,D().ve)(t,u.type);const h=(0,N().xr)(t,n,s),v=yield{recordPointers:[r,...null!=h&&h.eoipPointer?[h.eoipPointer]:[]]},P=(0,N().yQ)(t,n,v.getRecordModel);if("status"===u.type){const e=(0,N().RZ)(P,u);return void 0===e?{type:"undefined"}:{type:"text",value:(0,F().x9d)(e)}}if("checkbox"===u.type&&void 0===P)return{type:"checkbox",value:!1};if(("relation"===u.type||"multi_select"===u.type)&&void 0===P)return{type:"array",values:[]};if("person"===u.type&&void 0===P){const e=t.getCreatedByPointer();return"created_by"===u.default&&void 0!==e&&(0,g().Pu)(e)?{type:"array",values:[{type:"person",value:e}]}:{type:"array",values:[]}}if(void 0===P)return{type:"undefined"};switch(u.type){case"title":case"text":case"url":case"email":case"place":return{type:"text",value:P};case"phone_number":return{type:"text",value:(0,F().x9d)((0,F().k4p)(P))};case"select":{const e=(0,N().L3)(P,u.options??[]);return void 0===e?{type:"undefined"}:{type:"text",value:(0,F().x9d)(e)}}case"multi_select":return{type:"array",values:(0,N().o2)(P,u.options??[]).map((e=>({type:"text",value:(0,F().x9d)(e)})))};case"checkbox":return{type:"checkbox",value:(0,b().w)(P)};case"date":{const e=(0,k().b)(P);return void 0===e?{type:"undefined"}:{type:"date",value:e}}case"person":return{type:"array",values:(0,w().e)({textValue:P,propertySchema:u,blockCreatorPointer:void 0}).map((e=>({type:"person",value:e})))};case"relation":return{type:"array",values:(yield*(0,O().Sp)((0,N().n)(P),u)).map((e=>({type:"block",value:{table:i().ev,id:e.id,spaceId:e.getSpaceId()}})))};case"number":const e=(0,T().M)(P);return"number"==typeof e?{type:"number",value:e}:{type:"undefined"};case"auto_increment_id":{var L;const e=yield*(0,O().Xq)(t);if(!e)return{type:"undefined"};const n=(0,C().a)({spaceId:t.getSpaceId(),parentTable:A().Vl,parentId:e.id}),{getRecordModel:r}=yield{recordPointers:[n]},o=null===(L=r(n))||void 0===L?void 0:L.getRecordKey(),a=(0,T().M)(P),s=(0,M().H4)(o,a);return void 0!==s?{type:"text",value:[[s]]}:{type:"undefined"}}case"file":return{type:"array",values:(0,N().pJ)(P).map((({url:e})=>({type:"text",value:(0,F().x9d)(e)})))};case"created_time":case"last_edited_time":case"created_by":case"last_edited_by":case"last_visited_time":case"button":case"location":case"verification":return{type:"undefined"};default:(0,a().HB)(u)}}function $(e){if("number"===e.type)return{type:"number",value:(0,x().LI)(e.value,12)};if("array"===e.type){return{type:"array",values:e.values.map((e=>"number"===e.type?{type:"number",value:(0,x().LI)(e.value,12)}:e))}}return e}function Z(e,t,n){if("number"!==t.type&&"undefined"!==t.type)throw new(l().I3)({type:l().uW.CannotDoMathOnType,op:n,operand:e,valueType:t.type})}function Y(e,t,n){if("undefined"===t.type&&"undefined"===n.type)return{type:"number",value:0};switch("undefined"===t.type&&"number"===n.type?t={type:"number",value:0}:"undefined"===n.type&&"number"===t.type&&(n={type:"number",value:0}),e.op){case"+":return"number"===t.type&&"number"===n.type?Number.isInteger(t.value)&&Number.isInteger(n.value)?{type:"number",value:t.value+n.value}:{type:"number",value:new(h())(t.value).add(n.value).toNumber()}:{type:"text",value:(0,F().__s)((0,D().Ht)(t).concat((0,D().Ht)(n)))};case"-":if(Z(e.lhs,t,e.op),Z(e.rhs,n,e.op),"number"===t.type&&"number"===n.type)return Number.isInteger(t.value)&&Number.isInteger(n.value)?{type:"number",value:t.value-n.value}:{type:"number",value:new(h())(t.value).minus(n.value).toNumber()}}return{type:"undefined"}}function H(e,t,n){if(Z(e.lhs,t,e.op),Z(e.rhs,n,e.op),"undefined"===t.type&&"undefined"===n.type)return{type:"number",value:0};switch("undefined"===t.type&&"number"===n.type?t={type:"number",value:0}:"undefined"===n.type&&"number"===t.type&&(n={type:"number",value:0}),e.op){case"*":if("number"===t.type&&"number"===n.type)return Number.isInteger(t.value)&&Number.isInteger(n.value)?{type:"number",value:t.value*n.value}:{type:"number",value:new(h())(t.value).mul(n.value).toNumber()};break;case"/":if("number"===t.type&&"number"===n.type)return 0===n.value?{type:"undefined"}:{type:"number",value:new(h())(t.value).div(n.value).toNumber()};break;case"%":if("number"===t.type&&"number"===n.type)return 0===n.value?{type:"undefined"}:Number.isInteger(n.value)?{type:"number",value:t.value%n.value}:{type:"number",value:new(h())(t.value).mod(n.value).toNumber()}}return{type:"undefined"}}function*z(e,t,n,r){if("undefined"===t.type||"undefined"===n.type)return{type:"checkbox",value:!1};if("date"===t.type&&"date"===n.type){const o=(0,D().i3)(t.value,n.value,r.userTimeZone);switch(e.op){case"<":return{type:"checkbox",value:o<0};case"<=":return{type:"checkbox",value:o<=0};case">":return{type:"checkbox",value:o>0};case">=":return{type:"checkbox",value:o>=0}}}if("text"===t.type&&"text"===n.type){const[o,a]=yield*(0,D().h8)([t.value,n.value],r);switch(e.op){case"<":return{type:"checkbox",value:o<a};case"<=":return{type:"checkbox",value:o<=a};case">":return{type:"checkbox",value:o>a};case">=":return{type:"checkbox",value:o>=a}}}if("number"===t.type&&"number"===n.type||"checkbox"===t.type&&"checkbox"===n.type)switch(e.op){case"<":return{type:"checkbox",value:t.value<n.value};case"<=":return{type:"checkbox",value:t.value<=n.value};case">":return{type:"checkbox",value:t.value>n.value};case">=":return{type:"checkbox",value:t.value>=n.value}}throw new(l().I3)({type:l().uW.CannotRelativelyCompareTypes,lhs:e.lhs,rhs:e.rhs,lhsType:t.type,rhsType:n.type})}function j(e,t,n){if(Z(e.lhs,t,e.op),Z(e.rhs,n,e.op),"^"===e.op)if("number"===t.type&&"number"===n.type)return!Number.isInteger(t.value)&&Number.isInteger(n.value)?{type:"number",value:new(h())(t.value).pow(n.value).toNumber()}:{type:"number",value:t.value**n.value};return{type:"undefined"}}function K(e,t){const n=e.op;switch(n){case"-":if("number"!==t.type)throw new(l().I3)({type:l().uW.UnaryMinusOnNonNumber,node:e.expression,expressionType:t.type});return{type:"number",value:-t.value};case"!":case"not":return{type:"checkbox",value:!(0,D().CL)(t)};default:return(0,a().HB)(n)}}function*Q(e){const{node:t,token:n,context:r,evaluateAST:o}=e;if((0,D().ix)(n))return yield*function*(e){const{node:t,token:n,context:r,evaluateAST:o}=e,a=r.values.find((e=>e.kind===y().FormulaContextValueKind.ContextValue&&e.id===(0,D().GH)(n.contextValueId)));if(void 0===a)throw new(l().I3)({type:l().uW.MissingContextVariable,node:t,valueId:n.contextValueId});if("block"!==a.value.type)throw new(l().I3)({type:l().uW.ContextVariableWrongType,node:t,valueId:n.contextValueId,expectedType:"block",resultType:a.value.type});const s=a.value.value,i=(yield{recordPointers:[s]}).getRecordModel(s);if(void 0===i)throw new(l().I3)({type:l().uW.MissingDataDependencyBlock,node:t,blockPointer:s});const u=(0,D().Yi)(n.property),{collectionPointer:p,schema:d}=yield*V(i,r);if(!p){if(P().PJ(u))return(0,D().ve)(i,u);throw new(l().I3)({type:l().uW.MissingDataDependencyBlock,node:t,blockPointer:i.pointer})}if(P().PJ(u))return(0,D().ve)(i,u);const c=null==d?void 0:d[u];if(void 0===c||void 0===d)throw new(l().I3)({type:l().uW.MissingSchemaPropertyOnCollection,node:t,collectionId:i.getParentId(),property:u});return yield*W({block:i,parentCollectionPointer:p,property:u,schema:d,propertySchema:c,oldContext:r,evaluateAST:o})}({...e,token:n});const a=r.values.find((e=>e.kind===y().FormulaContextValueKind.ThisRow));if("block"!==(null==a?void 0:a.value.type))throw new(l().I3)({type:l().uW.MissingThisRow,node:t});const i=a.value.value,u=(yield{recordPointers:[i]}).getRecordModel(i);if(void 0===u)throw new(l().I3)({type:l().uW.MissingThisRow,node:t});if(void 0===n.collection)return(0,D().ve)(u,n.property);const{collectionPointer:p,schema:d}=yield*V(u,r);if(!p)throw new(l().I3)({type:l().uW.MissingDataDependencyBlock,node:t,blockPointer:u.pointer});if(!(0,s().Z2)(n.collection,p))throw new(l().I3)({type:l().uW.ThisRowBlockPropertyMismatchCollection,node:t,thisRowCollection:p});const c=(0,D().Yi)(n.property),m=null==d?void 0:d[c];if(void 0===m||void 0===d)throw new(l().I3)({type:l().uW.MissingSchemaPropertyOnThisRow,node:t,collectionId:u.getParentId(),property:c});return yield*W({block:u,parentCollectionPointer:p,property:c,schema:d,propertySchema:m,oldContext:r,evaluateAST:o})}function J(e){var t;const{node:n,token:r,context:o}=e,a=null===(t=o.values.find((e=>e.kind===y().FormulaContextValueKind.ContextValue&&e.id===(0,D().GH)(r.valueId))))||void 0===t?void 0:t.value;if(void 0===a)throw new(l().I3)({type:l().uW.MissingContextVariable,node:n,valueId:r.valueId});return a}function X(e){const{value:t,callNode:n,argumentNode:r,parameterIndex:o,libraryFunction:a,expectedParameter:s}=e;if(!(0,D().Hz)(t,s.type)){if(Array.isArray(s.type)?s.type.some((e=>"checkbox"===e.type)):"checkbox"===s.type.type)return{type:"checkbox",value:(0,D().CL)(t)};if(Array.isArray(s.type)?s.type.some((e=>"text"===e.type)):"expression"!==s.type.type&&"text"===(0,D().JK)(s.type).type)return"array"===t.type&&(Array.isArray(s.type)?s.type.some((e=>"array"===e.type)):"array"===s.type.type)?{type:"array",values:t.values.map((e=>({type:"text",value:(0,D().Ht)(e)})))}:"array"===t.type&&0===t.values.length?{type:"text",value:[[""]]}:{type:"text",value:(0,D().Ht)(t)};if(!y().TREAT_UNDEFINED_AS_ZERO_FNS.includes(a.name)&&!y().FLATTENS_NUMBER_ARRAY_FNS.includes(a.name))throw new(l().I3)({type:l().uW.FunctionCallArgumentWrongType,node:n,argument:r,libraryFunction:a,parameterIndex:o,argumentType:t.type})}return t}function ee(e,t){try{return{value:t()}}catch(n){return{error:te(e,n)}}}function te(e,t){if(t instanceof l().I3){const n=t.info;return e&&(0,D().li)(n)?{...n,node:(0,L().TW)(n.node,e)}:n}return{type:l().uW.UnexpectedError,error:(0,v().A)(t)}}const ne=new WeakMap;function re(e,t){const n=ne.get(t);if(n)return n;const r=ae(e,t);return ne.set(t,r),r}function oe(e,t){return ee(void 0,(()=>re(e,t)))}function ae(e,t){switch(t.kind){case l().NM.Number:return[{type:"loadConstant",node:t,value:{type:"number",value:parseFloat(t.text)}}];case l().NM.String:return[{type:"loadConstant",node:t,value:{type:"text",value:[[t.text]]}}];case l().NM.Boolean:return[{type:"loadConstant",node:t,value:{type:"checkbox",value:"true"===t.text.toLowerCase()}}];case l().NM.NotionToken:{const e=t.token;switch(e.type){case y().FormulaTokenType.Checkbox:return[{type:"loadConstant",node:t,value:{type:"checkbox",value:e.checked}}];case y().FormulaTokenType.BlockProperty:return[{type:"loadToken",node:t,token:e}];case y().FormulaTokenType.Block:return[{type:"loadConstant",node:t,value:{type:"block",value:{table:i().ev,id:e.blockId,spaceId:e.spaceId}}}];case y().FormulaTokenType.ContextValue:return[{type:"loadToken",node:t,token:e}];case y().FormulaTokenType.Date:return[{type:"loadConstant",node:t,value:{type:"date",value:e.date}}];case y().FormulaTokenType.Person:{const n=e.personInfo;return"user"===n.personTokenType?[{type:"loadConstant",node:t,value:{type:"person",value:{table:p().oo,id:n.userId}}}]:"group"===n.personTokenType?[{type:"loadConstant",node:t,value:{type:"person",value:{table:u().n,id:n.groupId,spaceId:n.spaceId}}}]:(0,a().HB)(n)}default:return(0,a().HB)(e)}}case l().NM.Additive:return[...ae(e,t.rhs),...ae(e,t.lhs),{type:"add",node:t}];case l().NM.Multiplicative:return[...ae(e,t.rhs),...ae(e,t.lhs),{type:"multiply",node:t}];case l().NM.Equality:return[...ae(e,t.rhs),...ae(e,t.lhs),{type:"equality",node:t}];case l().NM.Relational:return[...ae(e,t.rhs),...ae(e,t.lhs),{type:"relational",node:t}];case l().NM.Exponentiation:return[...ae(e,t.rhs),...ae(e,t.lhs),{type:"exponentiation",node:t}];case l().NM.Unary:return[...ae(e,t.expression),{type:"unary",node:t}];case l().NM.Array:{const n=[];for(const r of t.elements.slice().reverse())n.push(...ae(e,r));return n.push({type:"makeArray",node:t,numberOfElements:t.elements.length}),n}case l().NM.LogicalAnd:{const n=[];for(const r of t.elements.slice().reverse())n.push(...ae(e,r));return n.push({type:"logicalAnd",node:t,numberOfArguments:t.elements.length}),n}case l().NM.LogicalOr:{const n=[];for(const r of t.elements.slice().reverse())n.push(...ae(e,r));return n.push({type:"logicalOr",node:t,numberOfArguments:t.elements.length}),n}case l().NM.Call:return function(e,t){const n=[];let r,o;if(t.expression.kind===l().NM.Identifier){if(!G().LP.hasOwnProperty(t.expression.text))throw new(l().I3)({type:l().uW.IdentifierNotFound,node:t.expression});r=t.expression.text,o=t.arguments}else{if(t.expression.kind!==l().NM.UnifiedFunctionProperty)throw new(l().I3)({type:l().uW.CannotCallNonFunction,node:t,calleeType:d(t.expression)});if(!G().LP.hasOwnProperty(t.expression.name))throw new(l().I3)({type:l().uW.UnifiedFunctionPropertyNotFound,node:t.expression});r=t.expression.name,o=[t.expression.expression,...t.arguments]}if("let"===r||"lets"===r)return function(e,t,n,r){if(r.length<3||r.length%2!=1)throw new(l().x4)({type:l().v3.NotEnoughArguments}).toFormulaEvaluatorError(n,G().LP[t]);for(let i=0;i<(r.length-1)/2;i++){const e=r[2*i];if(e.kind!==l().NM.Identifier)throw new(l().x4)({type:l().v3.LetBindingNameNotIdentifier,node:e}).toFormulaEvaluatorError(n,G().LP[t])}const o=[];for(let i=0;i<(r.length-1)/2;i++){const a=r[2*i],u=r[2*i+1];if(a.kind!==l().NM.Identifier)throw new(l().x4)({type:l().v3.LetBindingNameNotIdentifier,node:a}).toFormulaEvaluatorError(n,G().LP[t]);let p;try{p=ae(e,u)}catch(s){ye(s),p=[{type:"loadConstant",node:u,value:{type:"undefined"}}]}o.push([a.text,p])}const a=ae(e,r.at(-1));return[{type:"runLets",node:n,body:a,bindings:o}]}(e,r,t,o);if("if"===r||"ifs"===r)return se(e,r,t,o);if(e.disabledFunctions.includes(r))throw t.expression.kind===l().NM.Identifier?new(l().I3)({type:l().uW.IdentifierNotFound,node:t.expression}):new(l().I3)({type:l().uW.UnifiedFunctionPropertyNotFound,node:t.expression});const a=G().LP[r],s=(0,D().ab)(a);if(o.length<s)throw new(l().I3)({type:l().uW.FunctionCallTooFewArguments,node:t,libraryFunction:a,numArguments:o.length});const i=o.map(((n,r)=>{const o=(0,D().Pf)(a,r);if(void 0===o)throw new(l().I3)({type:l().uW.FunctionCallUnexpectedArgument,node:t,argument:n,libraryFunction:a,parameterIndex:r});return Array.isArray(o.type)||"expression"!==o.type.type?ae(e,n):[{type:"loadConstant",node:n,value:{type:"compiledCode",instructions:ae(e,n)}}]}));return n.push(...i.reverse().flat()),n.push({type:"callLibraryFunction",node:t,libraryFunction:a,numberOfArguments:o.length,argumentNodes:o}),n}(e,t);case l().NM.Identifier:return[{type:"loadName",node:t,name:t.text}];case l().NM.Conditional:return se(e,"if",t,[t.condition,t.expIfTrue,(0,c().o)(t.expIfFalse)]);case l().NM.UnifiedFunctionProperty:throw new(c().V)("UnifiedFunctionProperty node should be wrapped in a Call node.");case l().NM.RecoveryNode:throw new(l().I3)({type:l().uW.UnexpectedRecoveryNode,recovery:t});case l().NM.MemberBlockProperty:return[...ae(e,t.expression),{type:"loadMemberBlockProperty",node:t,propertyToken:t.propertyToken}];default:(0,a().HB)(t)}}function se(e,t,n,r){const o="if"===t?3:2;if(r.length<o)throw new(l().I3)({type:l().uW.FunctionCallTooFewArguments,node:n,libraryFunction:G().LP[t],numArguments:r.length});if("if"===t&&3!==r.length){const e=r.at(-1);throw new(l().I3)({type:l().uW.FunctionCallUnexpectedArgument,node:n,argument:e,libraryFunction:G().LP[t],parameterIndex:r.length-1})}return function t(r){r=[...r];const o=[];o.push(...ae(e,(0,c().o)(r.shift())));const a=ae(e,(0,c().o)(r.shift()));let s;return s=1===r.length?ae(e,(0,c().o)(r.shift())):0===r.length?[{node:n,type:"loadConstant",value:{type:"undefined"}}]:t(r),o.push({node:n,type:"relativeJumpIfTrue",offset:s.length+1}),o.push(...s),o.push({node:n,type:"relativeJump",offset:a.length}),o.push(...a),o}(r)}class ie{constructor(){this.underlying=[]}push(e){this.underlying.push(e)}popValueOrCode(){return(0,c().o)(this.underlying.pop())}popValue(){return function(e){if("compiledCode"===e.type)throw new(c().V)("unexpected compiled code");return e}(this.popValueOrCode())}}function ue(e){var t;return{disabledFunctions:(null===(t=e.collectionFeatureGates)||void 0===t?void 0:t.formulas_disabled_functions)??[]}}function pe(e,t){return le(re(ue(t),e),t)}function*le(e,t){const n=new ie;let r=0;for(;r<e.length;){const u=e[r];if(r++,"loadConstant"===u.type)n.push(u.value);else if("add"===u.type){const{node:e}=u,t=n.popValue(),r=n.popValue();n.push(Y(e,t,r))}else if("multiply"===u.type){const{node:e}=u,t=n.popValue(),r=n.popValue();n.push(H(e,t,r))}else if("equality"===u.type){const{node:e}=u,r=n.popValue(),o=n.popValue(),s=yield*(0,D().zV)(r,o,t),i=e.op;"=="===i?n.push({type:"checkbox",value:s}):"!="===i?n.push({type:"checkbox",value:!s}):(0,a().HB)(i)}else if("logicalAnd"===u.type){const e=[];for(let r=0;r<u.numberOfArguments;r++)e.push(n.popValue());const t=e.map(D().CL);n.push({type:"checkbox",value:t.every((e=>e))})}else if("logicalOr"===u.type){const e=[];for(let r=0;r<u.numberOfArguments;r++)e.push(n.popValue());const t=e.map(D().CL);n.push({type:"checkbox",value:t.some((e=>e))})}else if("makeArray"===u.type){const e=[];for(let t=0;t<u.numberOfElements;t++)e.push(n.popValue());n.push({type:"array",values:e})}else if("relational"===u.type){const{node:e}=u,r=n.popValue(),o=n.popValue();n.push(yield*z(e,r,o,t))}else if("exponentiation"===u.type){const{node:e}=u,t=n.popValue(),r=n.popValue();n.push(j(e,t,r))}else if("unary"===u.type){const{node:e}=u,t=n.popValue();n.push(K(e,t))}else if("callLibraryFunction"===u.type){const{libraryFunction:e}=u,r=[];for(let t=0;t<u.numberOfArguments;t++){let o=n.popValueOrCode();if("compiledCode"!==o.type){const n=(0,D().Pf)(e,t);(0,a().O9)(n)&&(o=X({value:o,callNode:u.node,argumentNode:u.argumentNodes[t],parameterIndex:t,libraryFunction:e,expectedParameter:n}))}r.push(o)}try{n.push(yield*e.eval(r,t))}catch(i){if(i instanceof l().I3)throw i;throw new(l().I3)({type:l().uW.LibraryFunctionExecutionError,node:u.node,libraryFunction:e,error:i})}}else if("loadToken"===u.type){const{node:e,token:r}=u;r.type===y().FormulaTokenType.BlockProperty?n.push(yield*Q({node:e,token:r,context:t,evaluateAST:pe})):r.type===y().FormulaTokenType.ContextValue?n.push(J({node:e,token:r,context:t})):(0,a().HB)(r)}else if("runLets"===u.type){const e={...t};for(const[t,n]of u.bindings){let r;try{r=yield*le(n,e)}catch(i){ye(i),r={type:"undefined"}}e.values=[{kind:y().FormulaContextValueKind.Binding,id:t,value:r},...e.values]}n.push(yield*le(u.body,e))}else if("relativeJump"===u.type)r+=u.offset;else if("relativeJumpIfTrue"===u.type){const e=n.popValue();(0,D().CL)(e)&&(r+=u.offset)}else if("loadName"===u.type){var o;const{name:e,node:r}=u,a=null===(o=t.values.find((t=>t.kind===y().FormulaContextValueKind.Binding&&t.id===e)))||void 0===o?void 0:o.value;if(void 0!==a)n.push(a);else{if(!G().LP.hasOwnProperty(e))throw new(l().I3)({type:l().uW.IdentifierNotFound,node:r});n.push({type:"function",function:G().LP[e]})}}else if("loadMemberBlockProperty"===u.type){const{node:e,propertyToken:r}=u,o=n.popValue();if("undefined"===o.type)n.push({type:"undefined"});else{if("block"!==o.type)throw new(l().I3)({type:l().uW.AccessingPropertyOnNonBlock,node:e,expressionValue:o});{const a=(yield{recordPointers:[o.value]}).getRecordModel(o.value);if(void 0===a)throw new(l().I3)({type:l().uW.MissingDataDependencyBlock,node:e,blockPointer:o.value});if(void 0===r.collection)n.push((0,D().ve)(a,r.property));else{const{collectionPointer:o,schema:i}=yield*V(a,t);if(!o)throw new(l().I3)({type:l().uW.MissingDataDependencyBlock,node:e,blockPointer:a.pointer});if(!(0,s().Z2)(r.collection,o))throw new(l().I3)({type:l().uW.MemberPropertyMismatchCollection,node:e,blockCollection:o});const u=(0,D().Yi)(r.property),p=null==i?void 0:i[u];if(void 0===p||void 0===i)throw new(l().I3)({type:l().uW.MissingPropertyOnSchemaForMemberProperty,node:e});n.push(yield*W({block:a,property:u,parentCollectionPointer:o,schema:i,propertySchema:p,oldContext:t,evaluateAST:pe}))}}}}else(0,a().HB)(u);if(t.depth>y().FORMULA_MAX_DEPTH)throw new(l().I3)({type:l().uW.DepthExceeded});if(t.formulaTimeoutTimestampMs&&Date.now()>t.formulaTimeoutTimestampMs)throw t.logFormulaTimeoutFn&&t.logFormulaTimeoutFn(),new(l().I3)({type:l().uW.MaxEvaluationTimeExceeded})}return n.popValue()}function de(e,t,n){return ee(n,(()=>{t.formulaTimeoutTimestampMs=t.formulaTimeoutTimestampMs??Date.now()+q;const n=le(e,t);let r=n.next();for(;!r.done;){const e={...r.value,formulaEvaluationId:t.formulaEvaluationId},o=t.handleDataRequest(e);r=n.next(o)}if(t.allowedValueTypes&&!f(r.value,t.allowedValueTypes))throw new(l().I3)({allowedValueTypes:t.allowedValueTypes,expressionValue:r.value,type:l().uW.DisallowedValueType});return $(r.value)}))}async function ce(e,t,n){return async function(e,t){try{return await t()}catch(n){if(n instanceof l().FormulaDependencyLimitError)throw"per_formula"===n.limitType?new(l().I3)({type:l().uW.PerFormulaDependencyLimitExceeded,perFormulaLoaded:n.loaded,limit:n.limit}):new(l().I3)({type:l().uW.TotalDependencyLimitExceeded,totalLoaded:n.loaded,limit:n.limit});return{error:te(e,n)}}}(n,(async()=>{t.formulaTimeoutTimestampMs=t.formulaTimeoutTimestampMs??Date.now()+q;const n=performance.now();let o=0;const a=le(e,t);let s=a.next();for(;!s.done;){const e={...s.value,formulaEvaluationId:t.formulaEvaluationId},n=t.handleDataRequest(e);let i;if((0,r().yL)(n)){const e=performance.now();i=await n,o+=performance.now()-e}else i=n;s=a.next(i)}if(t.allowedValueTypes&&!f(s.value,t.allowedValueTypes))throw new(l().I3)({allowedValueTypes:t.allowedValueTypes,expressionValue:s.value,type:l().uW.DisallowedValueType});const i=performance.now()-n-o;return{value:$(s.value),formulaEvaluationStats:{syncEvaluationTimeMs:i}}}))}function ye(e){if(e instanceof l().I3&&e.info.type===l().uW.DepthExceeded)throw e}async function me(e,t,n){const r=oe(ue(t),e);return o().Q.isFail(r)?r:ce(r.value,t,n)}},958970:(e,t,n)=>{n.d(t,{f:()=>l});n(16280),n(898992),n(672577),n(581454);var r=()=>n(319625),o=()=>n(247331),a=()=>n(44907),s=()=>n(349835),i=()=>n(239381);const u=new RegExp(/\\([\\nt"])/g);function p(e){return e.find((e=>void 0!==e&&!isNaN(e)))}function l(e){const t=function(){const e=(0,a().p8)(),t=(0,a()._M)(e).getBaseCstVisitorConstructor();return new class extends t{constructor(){super(),this.validateVisitor()}expression(e){return this.visit(e.conditionalExpression)}primaryExpression(e){if(void 0!==e.parenthesisExpression)return this.visit(e.parenthesisExpression);if(void 0!==e.arrayExpression)return this.visit(e.arrayExpression);if(void 0!==e.NumberLiteral)return{kind:s().NM.Number,text:e.NumberLiteral[0].image,startOffset:e.NumberLiteral[0].startOffset,endOffset:e.NumberLiteral[0].endOffset};if(void 0!==e.StringLiteral){const t=e.StringLiteral[0].image.slice(1,-1).replace(u,((e,t)=>{switch(t){case"n":return"\n";case"t":return"\t";default:return t}}));return{kind:s().NM.String,text:t,startOffset:e.StringLiteral[0].startOffset,endOffset:e.StringLiteral[0].endOffset}}return void 0!==e.UnclosedStringLiteral?{kind:s().NM.String,text:e.UnclosedStringLiteral[0].image.substring(1,e.UnclosedStringLiteral[0].image.length),startOffset:e.UnclosedStringLiteral[0].startOffset,endOffset:e.UnclosedStringLiteral[0].endOffset}:void 0!==e.BooleanLiteral?{kind:s().NM.Boolean,text:e.BooleanLiteral[0].image,startOffset:e.BooleanLiteral[0].startOffset,endOffset:e.BooleanLiteral[0].endOffset}:void 0!==e.InputToken?{kind:s().NM.NotionToken,token:e.InputToken[0].payload,startOffset:e.InputToken[0].startOffset,endOffset:e.InputToken[0].endOffset}:void 0!==e.IdentifierName?{kind:s().NM.Identifier,text:e.IdentifierName[0].image,startOffset:e.IdentifierName[0].startOffset,endOffset:e.IdentifierName[0].endOffset}:{kind:s().NM.RecoveryNode,startOffset:-1,endOffset:-1}}conditionalExpression(e){const t=this.visit(e.condition[0]);var n,r,o,a;return void 0!==e.QuestionMark?{kind:s().NM.Conditional,condition:t,expIfTrue:this.visit(e.expIfTrue[0]),expIfFalse:void 0!==(null===(n=e.expIfFalse)||void 0===n?void 0:n[0])?this.visit(e.expIfFalse[0]):void 0,startOffset:e.condition[0].location.startOffset,endOffset:p([null===(r=e.expIfFalse)||void 0===r||null===(r=r[0].location)||void 0===r?void 0:r.endOffset,null===(o=e.Colon)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.endOffset,null===(a=e.expIfTrue[0].location)||void 0===a?void 0:a.endOffset,e.QuestionMark[0].endOffset])}:t}logicalOrExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.Or){var n,r;const o=(null===(n=e.rhs)||void 0===n?void 0:n.map((e=>this.visit(e))))??[];return{kind:s().NM.LogicalOr,elements:[t,...o],startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(r=e.rhs)||void 0===r||null===(r=r[e.rhs.length-1])||void 0===r||null===(r=r.location)||void 0===r?void 0:r.endOffset,e.Or[0].endOffset])}}return t}logicalAndExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.And){var n,r;const o=(null===(n=e.rhs)||void 0===n?void 0:n.map((e=>this.visit(e))))??[];return{kind:s().NM.LogicalAnd,elements:[t,...o],startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(r=e.rhs)||void 0===r||null===(r=r[e.rhs.length-1])||void 0===r||null===(r=r.location)||void 0===r?void 0:r.endOffset,e.And[0].endOffset])}}return t}equalityExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.EqualityOperator){var n;const r=e.rhs[0];return{kind:s().NM.Equality,op:e.EqualityOperator[0].image,lhs:t,rhs:this.visit(r),startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(n=r.location)||void 0===n?void 0:n.endOffset,e.EqualityOperator[0].endOffset])}}return t}relationalExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.RelationalOperator){var n;const r=e.rhs[0];return{kind:s().NM.Relational,op:e.RelationalOperator[0].image,lhs:t,rhs:this.visit(r),startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(n=r.location)||void 0===n?void 0:n.endOffset,e.RelationalOperator[0].endOffset])}}return t}additionExpression(e){let t=this.visit(e.lhs[0]);if(void 0!==e.AdditionOperator)for(let r=0;r<e.AdditionOperator.length;r++){var n;const o=e.rhs[r];t={kind:s().NM.Additive,op:e.AdditionOperator[r].image,lhs:t,rhs:this.visit(o),startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(n=o.location)||void 0===n?void 0:n.endOffset,e.AdditionOperator[r].endOffset])}}return t}multiplicationExpression(e){let t=this.visit(e.lhs[0]);if(void 0!==e.MultiplicationOperator)for(let r=0;r<e.MultiplicationOperator.length;r++){var n;const o=e.rhs[r];t={kind:s().NM.Multiplicative,op:e.MultiplicationOperator[r].image,lhs:t,rhs:this.visit(o),startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(n=o.location)||void 0===n?void 0:n.endOffset,e.MultiplicationOperator[r].endOffset])}}return t}exponentiationExpression(e){let t;const n=this.visit(e.lhs[0]);if(void 0!==e.Caret){var r;const o=e.Caret.length-1;let a,i=null===(r=e.rhs[o].location)||void 0===r?void 0:r.endOffset;(void 0===i||isNaN(i))&&(i=e.Caret[o].endOffset);for(let n=e.Caret.length-1;n>=0;n--){const r=e.rhs[n];t=void 0===a?this.visit(r):{kind:s().NM.Exponentiation,op:a,lhs:this.visit(r),rhs:t,startOffset:r.location.startOffset,endOffset:i},a=e.Caret[n].image}return{kind:s().NM.Exponentiation,op:a,lhs:n,rhs:t,startOffset:e.lhs[0].location.startOffset,endOffset:i}}return n}unaryExpression(e){let t=this.visit(e.primaryExpression[0]),n=e.primaryExpression[0].location.startOffset;const r=void 0!==e.UnaryOperator&&"-"===e.UnaryOperator[0].image&&t.kind===s().NM.Number;var a;if(r&&(t={kind:s().NM.Unary,op:e.UnaryOperator[0].image.toLowerCase(),expression:t,startOffset:e.UnaryOperator[0].startOffset,endOffset:t.endOffset}),isNaN(n)&&(n=null===(a=e.memberCallSubExpression)||void 0===a?void 0:a[0].location.startOffset),void 0!==e.memberCallSubExpression)for(const d of e.memberCallSubExpression){const e=d.location.endOffset;if(void 0!==d.children.callArguments){var u,p,l;const r=d.children.callArguments[0].children;t={kind:s().NM.Call,expression:t,arguments:(null===(u=d.children.callArguments[0])||void 0===u||null===(u=u.children.expression)||void 0===u?void 0:u.map((e=>this.visit(e))))??[],lParenOffset:r.LParen[0].startOffset,rParenOffset:null===(p=r.RParen)||void 0===p?void 0:p[0].startOffset,commaOffsets:(null===(l=r.Comma)||void 0===l?void 0:l.map((e=>e.startOffset)))??[],startOffset:n,endOffset:e}}else if(void 0!==d.children.dotMemberExpression){const r=d.children.dotMemberExpression[0].children;if(void 0!==r.IdentifierName){const o=r.IdentifierName[0];t={kind:s().NM.UnifiedFunctionProperty,expression:t,name:o.image,nameStartOffset:o.startOffset,nameEndOffset:o.endOffset,startOffset:n,endOffset:e}}else if(void 0!==r.InputToken){const a=r.InputToken[0],u=a.payload;if(u.type===o().FormulaTokenType.BlockProperty){if((0,i().ix)(u))throw new Error("unexpected block property context value in unaryExpression");t={kind:s().NM.MemberBlockProperty,expression:t,propertyToken:void 0===u.collection?{property:u.property,collection:void 0}:{property:u.property,collection:u.collection},propertyStartOffset:a.startOffset,propertyEndOffset:a.endOffset,startOffset:n,endOffset:e}}}}}return void 0===e.UnaryOperator||r?t:{kind:s().NM.Unary,op:e.UnaryOperator[0].image.toLowerCase().trimEnd(),expression:t,startOffset:e.UnaryOperator[0].startOffset,endOffset:t.endOffset}}parenthesisExpression(e){return this.visit(e.expression[0])}arrayExpression(e){var t,n,r,o,a;return{kind:s().NM.Array,elements:(null===(t=e.expression)||void 0===t?void 0:t.map((e=>this.visit(e))))??[],lBracketOffset:e.LBracket[0].startOffset,rBracketOffset:null===(n=e.RBracket)||void 0===n?void 0:n[0].startOffset,commaOffsets:(null===(r=e.Comma)||void 0===r?void 0:r.map((e=>e.startOffset)))??[],startOffset:e.LBracket[0].startOffset,endOffset:p([null===(o=e.RBracket)||void 0===o?void 0:o[0].endOffset,null===(a=e.expression)||void 0===a||null===(a=a[e.expression.length-1])||void 0===a||null===(a=a.location)||void 0===a?void 0:a.endOffset,e.LBracket[0].endOffset])}}memberCallSubExpression(e){throw new Error("unexpected memberCallSubExpression")}dotMemberExpression(e){throw new Error("unexpected dotMemberExpression")}callArguments(e){throw new Error("unexpected callArguments")}}}();try{return{value:t.visit(e)}}catch(n){return{error:{type:s().M9.UnexpectedError,error:(0,r().A)(n),offset:0}}}}}}]);