"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[37342,88455],{74831:(e,t,n)=>{n.d(t,{Gi:()=>i,yB:()=>r});n(898992),n(354520),n(803949);var a=()=>n(242422),o=()=>n(590526);function s(){return a().default.getConfigKey("agent_max_attachments","value")}function r(){return(0,o().K8)((()=>s()),[])}class i extends(()=>n(757695))().Store{getInitialState(){return{originalFileUrlToSuccessfullyUploadedFiles:new Map,inProgressUploadFileIdsToProgress:new Map}}setValueForUploadedFile(e,t){this.setState({...this.state,originalFileUrlToSuccessfullyUploadedFiles:new Map(this.state.originalFileUrlToSuccessfullyUploadedFiles).set(e,t)})}markUploadedFilesAsSafe(e){const t=new Map(this.state.originalFileUrlToSuccessfullyUploadedFiles);e.forEach((e=>{var n;const a=t.get(e);a&&t.set(e,{...a,metadata:{...a.metadata,guardrail:{...null===(n=a.metadata)||void 0===n?void 0:n.guardrail,attachmentRisk:"confirmed_safe_by_user"}}})})),this.setState({...this.state,originalFileUrlToSuccessfullyUploadedFiles:t})}setValueForUploadingFile(e,t){const n=new Map(this.state.inProgressUploadFileIdsToProgress),a=n.get(e);n.set(e,{...t,timeUploaded:(null==a?void 0:a.timeUploaded)??Date.now()}),this.setState({...this.state,inProgressUploadFileIdsToProgress:n})}getTimeUploadedForUploadingFile(e){const t=new Map(this.state.inProgressUploadFileIdsToProgress).get(e);return(null==t?void 0:t.timeUploaded)??Date.now()}getTimeUploadedForUploadedFile(e){const t=new Map(this.state.originalFileUrlToSuccessfullyUploadedFiles).get(e);return(null==t?void 0:t.timeUploaded)??Date.now()}deleteValueForUploadingFile(e){const t=new Map(this.state.inProgressUploadFileIdsToProgress);t.delete(e),this.setState({...this.state,inProgressUploadFileIdsToProgress:t})}deleteValueForUploadedFile(e){const t=new Map(this.state.originalFileUrlToSuccessfullyUploadedFiles);t.delete(e),this.setState({...this.state,originalFileUrlToSuccessfullyUploadedFiles:t})}onFileUploadPercentageChanged(e){const{fileId:t,fileName:n,percentage:a,contentType:o}=e;this.setValueForUploadingFile(t,{type:"uploading",fileName:n,progress:a,contentType:o})}onFileUploadFailed(e){const{error:t}=e,{files:n}=t;n.forEach((({fileId:e,fileName:n})=>{this.setValueForUploadingFile(e,{type:"error",error:t,fileName:n})}))}onFileUploadCompleted(e,t){const n=this.getTimeUploadedForUploadingFile(e);this.deleteValueForUploadingFile(e),this.setValueForUploadedFile(t.originalFileUrl,{...t,timeUploaded:n})}setCompletedFileForRetry(e){const t=this.getTimeUploadedForUploadedFile(e.originalFileUrl);this.setValueForUploadedFile(e.originalFileUrl,{...e,timeUploaded:t})}onDeleteFileUpload(e){this.deleteValueForUploadedFile(e)}isUploadInProgress(){return Array.from(this.state.inProgressUploadFileIdsToProgress.values()).filter((e=>"error"!==e.type)).length>0}hasTooManyAttachments(){return this.isUploadInProgress()||this.state.originalFileUrlToSuccessfullyUploadedFiles.size>s()}}},166442:(e,t,n)=>{n.r(t),n.d(t,{ClientAIChatStore:()=>c,UserChatPreferenceLocalStorageStore:()=>i,defaultClientAIChatStore:()=>d,defaultLegacyThreadConfig:()=>l});var a=()=>n(757695),o=(n(898992),n(354520),()=>n(498212));const s={acceptedInferenceKeys:[],inferenceKeysToAnnotations:{},inferenceKeysToMemories:{},tags:[],abortController:void 0,stopInferencePromise:void 0,temporarySteps:[],inferences:[],traceId:void 0,draftTraceId:void 0,wasForceStoppedByUser:!1,requestInfo:void 0,loading:!1,currentUserInitiatedRunningInference:!1,stagedData:{},agentSearchResultsByToolResultStepId:{},pendingStop:!1};class r extends a().Store{getInitialState(){return s}resetState(){var e;null===(e=this.state.abortController)||void 0===e||e.abort(),this.setState(s)}getOrCreateTraceId(){const e=this.state.traceId??(0,o().Ay)();return this.state.traceId||this.setState({...this.state,traceId:e}),e}clearTraceId(){this.setState({...this.state,traceId:void 0})}getOrCreateDraftTraceId(){const e=this.state.draftTraceId??(0,o().Ay)();return this.state.draftTraceId||this.setState({...this.state,draftTraceId:e}),e}setAgentSearchResultsForTool(e){const{agentStepId:t,toolCallId:n,toolResultStepId:a,results:o}=e;this.setState({...this.state,agentSearchResultsByToolResultStepId:{...this.state.agentSearchResultsByToolResultStepId,[a]:{agentStepId:t,toolCallId:n,results:o}}})}getTemporaryAttachmentStagedDataOrInstantiate(){const e=this.state.stagedData;if(null!=e&&e.attachmentStagedData)return e.attachmentStagedData;const t={stagedAttachmentUploadStore:new(n(74831).Gi),stagedClientSteps:[],stagedEngineSteps:[],stagedInferenceTranscriptSteps:[]};return this.setState({...this.state,stagedData:{...this.state.stagedData,attachmentStagedData:t}}),t}getStagedAttachmentUploadStoreIfExists(){var e;const t=this.state.stagedData;return null==t||null===(e=t.attachmentStagedData)||void 0===e?void 0:e.stagedAttachmentUploadStore}stageAttachmentInferenceTranscriptStep(e){const{step:t}=e,n=this.getTemporaryAttachmentStagedDataOrInstantiate(),a={...n,stagedInferenceTranscriptSteps:[...n.stagedInferenceTranscriptSteps,t]};this.setState({...this.state,stagedData:{...this.state.stagedData,attachmentStagedData:a}})}unstageAttachmentInferenceTranscriptStep(e){var t;const{fileId:n}=e,a=null===(t=this.state.stagedData)||void 0===t?void 0:t.attachmentStagedData;if(!a)return;const o=a.stagedInferenceTranscriptSteps.filter((e=>"attachment"!==e.type||e.fileUrl!==n));this.setState({...this.state,stagedData:{...this.state.stagedData,attachmentStagedData:{...a,stagedInferenceTranscriptSteps:o}}})}getAndClearStagedAssistantAttachmentSteps(){var e;const t=null===(e=this.state.stagedData)||void 0===e?void 0:e.attachmentStagedData;if(!t)return;const{stagedInferenceTranscriptSteps:n}=t;return this.setState({...this.state,stagedData:{...this.state.stagedData,attachmentStagedData:void 0}}),n}getStagedMentionPointers(){const{mentionStagedData:e}=this.state.stagedData;return e?[...e]:[]}updateMentionedStagedData(e){this.setState({...this.state,stagedData:{...this.state.stagedData,mentionStagedData:new(n(728272).d)(e)}})}}const i=new(n(29923).R)({key:"spacedScopedUserChatPreference",namespace:n(553737).Bq,important:!0,trackingType:"preference"}),l={type:"search",scopeForNextSearch:{type:"everything"}};class c extends a().Store{getInitialState(){const e=n(17022).e.withListenerIgnored((()=>n(242422).default.checkGate({gateName:"workflows_inference_replay"})));return{showHistory:!1,showDebug:!1,loading:!1,configForNewTranscripts:l,userSelectedConfig:void 0,model:void 0,debugOverrides:{usePromptCache:e?"s3":void 0,emitAgentSearchExtractedResults:!0},threadRegistry:{},isAIChatTranscriptSidePanelVisible:!1,threadToStagedData:{},primeInput:void 0}}getOrCreateClientAIChatThreadStore(e){if(!this.state.threadRegistry[e]){const t=new r;return this.setState({...this.state,threadRegistry:{...this.state.threadRegistry,[e]:t}}),t}return this.state.threadRegistry[e]}getExistingClientAIChatThreadStore(e){return this.state.threadRegistry[e]}removeClientAIChatThreadStore(e){const{threadRegistry:t}=this.state,n={...t};delete n[e],this.setState({...this.state,threadRegistry:n})}}const d=new c;(0,n(852832).exposeDebugValue)("clientAiChatStore",d)},258035:(e,t,n)=>{n.d(t,{CO:()=>te,HL:()=>A,L5:()=>D,Pl:()=>oe,ph:()=>F});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(823215),n(354520),n(672577),n(430670),n(803949),n(581454),n(908872),n(737550);var a=()=>n(496603),o=()=>n(534177),s=()=>n(720665),r=()=>n(700500),i=()=>n(356246),l=()=>n(898244),c=()=>n(713998),d=()=>n(175482),p=()=>n(498140),u=()=>n(651124),m=()=>n(165358),f=()=>n(384813),g=()=>n(416845),h=()=>n(997769),y=()=>n(792071),I=()=>n(72135),v=()=>n(134025),S=()=>n(179034),b=()=>n(519831),_=()=>n(869558),C=()=>n(201980);const T="PartialMatch",w="FullMatch",x="ColumnCategory",k=(0,n(69708).YK)({titleColumnName:{id:"database.titleColumn.name",defaultMessage:"Title"},genericColumnName:{id:"database.genericColumn.name",defaultMessage:"Column {columnNumber}"}});function F(e){const{table:t,deps:{intl:n,randomShortID:o,isPhoneNumber:s},options:{useCsvAdaptiveSchema:i,addHeadersToCollectionEnabled:c}}=e,p=function(e,t,n,o,s=!1,r,i,l){var c;e=e.filter((e=>e.some((e=>Boolean((e.text||"").trim())))));const d=e.length>0?e[0].length:0,p=e.map(((e,t)=>({row:e,rowIndex:t}))).filter((({row:e})=>e.length!==d));if(p.length>0){const e=p[0];throw new(g().yI4)("CsvImportError",{data:{},clientData:{type:"csv_import_inconsistent_columns",messageValues:{numTitleColumns:d,numBadRows:p.length,firstBadRowIndex:e.rowIndex+1,firstBadRow:JSON.stringify(e.row.map((e=>e.text))),firstBadRowLength:e.row.length}}})}const u=null===(c=e[0])||void 0===c?void 0:c.length;null==r||r.set(x,function(e){return e<50?"lessthan50":e<100?"lessthan100":e<500?"lessthan500":e<1e3?"lessthan1000":e<5e3?"lessthan5000":"greaterthan5000"}(u));const m=null==i?void 0:i.columnHeaders,f=void 0!==m&&m.length>0;let h=[];f?(h=m.flatMap((e=>e.doNotImport?[]:[e.headerName])),null!=i&&i.useFirstRowAsHeaders&&e.shift()):1===e.length||l?h=e[0].map(((e,n)=>t.formatMessage(k.genericColumnName,{columnNumber:n+1}))):e.length>1&&(h=e[0].map((e=>e.text)),e.shift());const y=e,{types:I,schema:v,pages:S}=f&&m?function(e){const{body:t,intl:n,randomShortID:o,headerTitles:s,headersMetadata:r,isPreTypedCSV:i,csvEvalContext:l}=e,c=performance.now(),{types:d,notToImportColumnIndex:p}=function(e){const{intl:t,columns:n,randomShortID:o}=e,s=[],r=n.flatMap(((e,n)=>{if(e.doNotImport)return s.push(n),[];let r=a().D_;"checkbox"===e.propertyType?r=e=>E(e):"number"===e.propertyType?r=e=>O(e):"date"===e.propertyType&&"format"in e?r=n=>Z(n,t,e.format):"date"===e.propertyType&&(r=e=>Z(e,t));return[{id:"title"===e.propertyType?"title":o(),schema:{name:e.headerName,type:e.propertyType},coerce:r}]}));return{types:r,notToImportColumnIndex:s}}({intl:n,columns:r,randomShortID:o}),u=performance.now()-c;null==l||l.set("columnTypeInferenceTimeTakenMS",u);const{pages:m,selectPropertyOptions:f}=M({body:t,types:d,isPreTypedCSV:i,notToImportColumnIndex:p});if(f)for(const a of d)!f[a.id]||"select"!==a.schema.type&&"multi_select"!==a.schema.type||(a.schema.options=P({randomShortID:o,optionValues:f[a.id],propertyType:a.schema.type}));const{schema:g}=U({body:t,intl:n,randomShortID:o,headers:s,types:d,isPreTypedCSV:i});return{types:d,schema:g,pages:m}}({body:y,intl:t,randomShortID:n,headerTitles:h,headersMetadata:m,isPreTypedCSV:f,csvEvalContext:r}):function(e){const{body:t,intl:n,randomShortID:a,isPhoneNumber:o,useCsvAdaptiveSchema:s,headers:r,isPreTypedCSV:i,csvEvalContext:l}=e,c=performance.now(),{types:d}=A({body:t,intl:n,randomShortID:a,isPhoneNumber:o,useCsvAdaptiveSchema:s,csvEvalContext:l}),p=performance.now()-c;null==l||l.set("columnTypeInferenceTimeTakenMS",p);const{schema:u}=U({body:t,intl:n,randomShortID:a,headers:r,types:d,isPreTypedCSV:i}),{pages:m}=M({body:t,types:d,isPreTypedCSV:i});return{types:d,schema:u,pages:m}}({body:y,intl:t,randomShortID:n,isPhoneNumber:o,useCsvAdaptiveSchema:s,headers:h,isPreTypedCSV:f,csvEvalContext:r});return{schema:v,types:I,pages:S}}(t,n,o,s,i,e.csvEvalContext,e.metadata,c);return function(e){const{actor:t,blockType:n,root:o,parent:s,name:i,format:c,deps:{randomID:p,spaceIdCreator:m,addFileIdsToBlock:g,createCollectionAsyncWithStatusLabel:h},options:{ignoreBlockCount:I,legacyNonCrdt:T},pages:w,schema:x,columnIds:k}=e,F=e.collectionId??(null==m?void 0:m.idInSavedSpace(b().Vl))??p(),D=e.collectionViewId??(null==m?void 0:m.idInSavedSpace(_().Gy))??p(),A=[],U=[],M=[],{operations:P}=y().WBy.create({id:F,parent:o.existing?o.record.pointer:{id:o.id,table:S().ev,spaceId:s.spaceId},space_id:s.spaceId,name:C().x9d(i),schema:x,format:{collection_page_properties:a().oE(k.map((e=>{if(e)return{visible:!0,property:e}}))),...h&&{sync_state:{syncing:!0,last_synced_at:Date.now()},static_import_collection_type:u().IE.CsvImport}},createdBy:t});A.push(...P);const V={id:o.existing?o.record.id:o.id,type:n,collection_id:F,format:{collection_pointer:{table:b().Vl,id:F,spaceId:s.spaceId}},view_ids:[D],createdBy:t,parentPointer:s,space_id:s.spaceId},{createOrUpdateBlockOperations:B}=d().Rf({blockModelArgs:V,existingBlock:o.existing?o.record:void 0,legacyNonCrdt:T});if(A.push(...B),h){const{operations:e}=y().lqf.create({id:D,type:"table",name:"Show All",parent:o.existing?o.record.pointer:{id:o.id,table:S().ev,spaceId:s.spaceId},space_id:s.spaceId,format:{collection_pointer:(0,l().Z8)({collectionId:F,spaceId:s.spaceId}),table_properties:a().oE(k.map((e=>{if(e)return{visible:!0,property:e}}))),...c},createdBy:t});A.push(...e)}const N=function(e){const{actor:t,collectionId:n,spaceId:a,pages:o,randomID:s,spaceIdCreator:i,options:l}=e;return o.map((o=>{const c=(null==i?void 0:i.idInSavedSpace(S().ev))??s(),{model:d,operations:p}=y().zgg.create({id:c,parentPointer:{id:n,table:b().Vl,spaceId:a},space_id:a,type:r().xd.page,createdBy:t,properties:o,...l.ignoreBlockCount?{ignore_block_count:!0}:void 0}),u=[...p];if(e.addFileIdsToBlock){const e=(0,f().c)(d,"","").fileIds;e.length>0&&u.push(v().op.update({pointer:d.pointer,path:[],args:{file_ids:e.map((e=>e.id))}}))}return{id:c,operations:u}}))}({actor:t,collectionId:F,addFileIdsToBlock:g,spaceId:s.spaceId,pages:w,randomID:p,spaceIdCreator:m,options:{ignoreBlockCount:I}});for(const{operations:a}of N)U.push(...a);const{operations:R}=y().lqf.create({id:D,type:"table",name:"Show All",parent:o.existing?o.record.pointer:{id:o.id,table:S().ev,spaceId:s.spaceId},space_id:s.spaceId,format:{collection_pointer:(0,l().Z8)({collectionId:F,spaceId:s.spaceId}),table_properties:a().oE(k.map((e=>{if(e)return{visible:!0,property:e}}))),...c},page_sort:N.map((e=>e.id)).slice(0,l().WF),createdBy:t});if(U.push(...R),h){const e={table:b().Vl,id:F,spaceId:s.spaceId},t=v().op.update({pointer:e,path:["format","sync_state"],args:{syncing:!1,last_synced_at:Date.now()}});return M.push(t),{operations:U,createCollectionOperations:A,collectionFinishedOperations:M}}return{operations:[...A,...U]}}({...p,columnIds:p.types.map((e=>e.id)),...e})}function D(e){const{table:t,actor:n,parent:a,tableId:s,deps:{randomID:i,spaceIdCreator:l,randomShortID:c},options:{legacyNonCrdt:d,ignoreBlockCount:p,hasHeaderRow:u,hasHeaderColumn:m}}=e,f=[],g=t.length?t[0].map((e=>c())):[],h=t.map((e=>(null==l?void 0:l.idInSavedSpace(S().ev))??i()));f.push(...y().zgg.create({id:s,type:r().xd.table,content:h,format:{table_block_column_order:g,...u?{table_block_column_header:!0}:{},...m?{table_block_row_header:!0}:{}},properties:{},parentPointer:a,space_id:a.spaceId,createdBy:n,ignore_block_count:!!p||void 0,legacyNonCrdt:d}).operations);const I=h.flatMap(((e,i)=>{const l=(0,o().MU)(g.flatMap(((e,n)=>{var a;const o=null===(a=t[i])||void 0===a||null===(a=a[n])||void 0===a?void 0:a.textValue;return o?[[e,o]]:[]})));return y().zgg.create({id:e,type:r().xd.tableRow,parentPointer:{id:s,table:S().ev,spaceId:a.spaceId},space_id:a.spaceId,properties:l,createdBy:n,legacyNonCrdt:d}).operations}));return f.push(...I),{operations:f}}function A(e){const{body:t,intl:n,randomShortID:o,isPhoneNumber:r,useCsvAdaptiveSchema:i,csvEvalContext:l}=e,c=function(e){return[{test:J.bind(null,e),sampledSchemaIsComplete:!0},{test:$,sampledSchemaIsComplete:!0},{test:K,sampledSchemaIsComplete:!0},{test:G,sampledSchemaIsComplete:!0},{test:j,sampledSchemaIsComplete:!0},{test:L,sampledSchemaIsComplete:!1},{test:Q,sampledSchemaIsComplete:!1},{test:Y,sampledSchemaIsComplete:!1},{test:ee,sampledSchemaIsComplete:!0}]}(r),d=a().oE(a().$1(t).map((e=>e.length&&e[0].columnType?e[0].columnType:function(e,t,n,o,r,i){const l=t.filter((e=>Boolean(e)));if(0===l.length)return ee(e,l);if(r){const a=l.length>1e3?function(e,t){const n=e.length,a=[];for(let o=0;o<t;o++){const t=Math.floor(Math.random()*n);a.push(e[t])}return a}(l,1e3):l;for(const r of o){const o=r.test(e,a,n);if(o){let n=o;if(!1===o.isFullMatch){m().log({level:"info",from:"csvHelper",type:"csvColumnTypes",data:{message:"Partial column type match detected, setting data type as string",columnType:o.schema.type,matchType:"Partial"}}),n=ee(e,t);const a=(null==i?void 0:i.get(T))||0;(0,s().Et)(a)&&(null==i||i.set(T,a+1))}else m().log({level:"info",from:"csvHelper",type:"csvColumnTypes",data:{message:"Complete column type match detected",columnType:o.schema.type,matchType:"Full"}});const a=(null==i?void 0:i.get(w))||0;return(0,s().Et)(a)&&(null==i||i.set(w,a+1)),n}}}else{const t=l.filter((e=>!a().Im(e))).slice(0,100);for(const a of o){const o=a.test(e,t,n);if(o){const r=a.sampledSchemaIsComplete||t.length===l.length?o:a.test(e,l,n);if(r){if(!1===r.isFullMatch){m().log({level:"info",from:"csvHelper",type:"csvColumnTypes",data:{message:"Partial column type match detected, Potential data loss due to parsing failures",columnType:r.schema.type,matchType:"Partial"}});const e=(null==i?void 0:i.get(T))||0;(0,s().Et)(e)&&(null==i||i.set(T,e+1))}else{const e=(null==i?void 0:i.get(w))||0;(0,s().Et)(e)&&(null==i||i.set(w,e+1))}return r}}}}return ee(e,[])}(n,e.map((e=>null==e?void 0:e.text)),o,c,i,l))));return{types:d}}function U(e){const{body:t,intl:n,randomShortID:a,headers:o,types:s,isPreTypedCSV:r}=e,i=o.map((()=>!1));if(!r)for(let d=0;d<o.length;d++)if("text"===s[d].schema.type)for(let e=0;e<t.length;e++){const n=t[e][d].textValue;if(n)for(const a of n)if(C().BEe(a)){i[d]=!0,e=t.length;break}}let l=!0;const c={title:{type:"title",name:n.formatMessage(k.titleColumnName)}};return o.forEach(((e,t)=>{const n=s[t];if(n)if("text"!==n.schema.type||!l||i[t]||r)if(r&&"title"===n.schema.type){const t=c.title;t&&(t.name=e)}else{const t=n.id??a();n.id||(n.id=t),c[t]={...n.schema,name:e}}else{l=!1,n.id="title",n.schema={type:"title",name:e};const t=c.title;t&&(t.name=e)}})),{schema:c}}function M(e){const{body:t,types:n,isPreTypedCSV:a,notToImportColumnIndex:o}=e,s={};return{pages:t.map((e=>{null!=o&&o.length&&(e=e.filter(((e,t)=>!o.includes(t))));const t={};return n.forEach(((n,o)=>{if(n){const{id:r,schema:i,coerce:l}=n,{type:d}=i;if(r){const n=e[o]||"";if("url"===d)t[r]=c().jw(n.text);else if("date"===d)t[r]=c().m5(l(n.text));else if("text"===d)t[r]=n.textValue||C().x9d(l(n.text));else if("file"===d)t[r]=n.textValue||[];else if("select"===d||"multi_select"===d){let e=[];if("multi_select"===d){e=n.text.split(",").map((e=>e.trim())).filter((e=>e.length>0)).filter(((e,t,n)=>n.findIndex((t=>t.toLowerCase()===e.toLowerCase()))===t))}else e=n.text.trim()?[n.text.trim()]:[];if(a)for(const t of e){if(!t||!t.trim())continue;const e=t.trim();s[r]||(s[r]=[]);s[r].find((t=>t.toLowerCase()===e.toLowerCase()))||s[r].push(e)}t[r]=C().x9d(l(n.text))}else t[r]=C().x9d(l(n.text))}}})),t})),selectPropertyOptions:a?s:void 0}}function P(e){const{randomShortID:t,optionValues:n,propertyType:a}=e;return("multi_select"===a?n.flatMap((e=>e.split(",").map((e=>e.trim())).filter((e=>e.length>0)))):n.map((e=>e.trim())).filter((e=>e.length>0))).filter(((e,t,n)=>n.findIndex((t=>t.toLowerCase()===e.toLowerCase()))===t)).map((e=>({id:t(),value:e,color:(0,l().Zd)([])})))}const V=["yes","Yes","true","True","checked"],B=["no","No","false","False","unchecked"];function N(e){return V.some((t=>e===t))||B.some((t=>e===t))}function R(e,t){return e.length===t.length}function E(e){return V.some((t=>e===t))?i().I1:i().oP}function L(e,t){if(t.every(N))return{schema:{type:"checkbox"},validate:N,coerce:e=>E(e)}}function O(e){const t=I().sA(e);return`${t?t.value:void 0}`}function $(e,t){const n=t.map(I().sA),a=n[0];if(a&&n.every((e=>Boolean(e&&e.format===a.format))))return{schema:{type:"number",number_format:a.format},validate(e){const t=I().sA(e);return!s().pN(t)&&t.format===a.format},coerce:e=>O(e)}}function z(e,t){if(parseInt(t)&&t.length<=6)return!1;const n=p().JC(t,e);return Boolean(n)}function Z(e,t,n){const a=e.includes("→")?void 0:n;return p().JC(e,t,a)}function j(e,t){const n=t.filter((t=>z(e,t)));if(n.length>=t.length/2)return{schema:{type:"date"},validate:t=>z(e,t),coerce:t=>Z(t,e),isFullMatch:R(t,n)}}function H(e){return e.length<320&&e.includes("@")&&h().t6(e,"email")}function K(e,t){const n=t.filter(H);if(n.length>=t.length/2)return{schema:{type:"email"},validate:H,coerce:a().D_,isFullMatch:R(t,n)}}function q(e){return e.length<320&&h().t6(e,"url")}function G(e,t){const n=t.filter(q);if(n.length>=t.length/2)return{schema:{type:"url"},validate:q,coerce:a().D_,isFullMatch:R(t,n)}}function W(e,t){return!String(t).match(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/)&&e(String(t))}function J(e,t,n){const o=W.bind(null,e),s=n.filter(o);if(s.length>=n.length/2)return{schema:{type:"phone_number"},validate:o,coerce:a().D_,isFullMatch:R(n,s)}}function Q(e,t,n){const o=[];t.forEach((e=>e.split(",").forEach((e=>o.push(e.trim())))));const s=c().ki(o),r=new Set(s);if(i=s.length,d=o.length,p=t.length,d>p&&X(i,d)){return{schema:{type:"multi_select",options:s.map(((e,t)=>({id:n(),value:e,color:(0,l().Zd)([])})))},validate:e=>r.has(e),coerce:a().D_}}var i,d,p}function X(e,t){return e>0&&e**2<t}function Y(e,t,n){const o=c().ki(t),s=new Set(o);if(X(o.length,t.length)){return{schema:{type:"select",options:o.map(((e,t)=>({id:n(),value:e,color:(0,l().Zd)([])})))},validate:e=>s.has(e),coerce:a().D_}}}function ee(e,t){return{schema:{type:"text"},validate:a().vF,coerce:a().D_}}function te(e,t){t||(t=function(e,t){let n=",",a=0;const o=e.split(/\r?\n/).slice(0,10).join("\n");for(const s of t){const e=ae(o,s);if(e.length<=1)continue;const t=e.map((e=>e.length)),r=ne(t),i=t.filter((e=>e===r)).length/t.length;if(r<=1||i<(r>=6?.6:.7))continue;const l=r,c=100*i+10*l-50*(e.flat().filter((e=>e.includes(s))).length/(e.length*l));c>a&&(a=c,n=s)}return n}(e,[",",";","\t","|"]));const n=[];let a=[],o="",s=!1;for(let r=0;r<e.length;r++){const i=e[r],l=e[r+1];if('"'===i)s&&'"'===l?(o+='"',r++):s=!s;else if(i!==t||s)if("\n"!==i&&("\r"!==i||"\n"===l)||s){if("\r"===i&&"\n"===l&&!s)continue;o+=i}else a.push(o),n.push(a),a=[],o="";else a.push(o),o=""}return(o||a.length>0)&&(a.push(o),n.push(a)),n}function ne(e){var t;const n=e.reduce(((e,t)=>(e[t]=(e[t]||0)+1,e)),{});return Number((null===(t=Object.entries(n).sort(((e,t)=>t[1]-e[1]))[0])||void 0===t?void 0:t[0])||0)}function ae(e,t){const n=[];let a=[],o="",s=!1;for(let r=0;r<e.length;r++){const i=e[r],l=e[r+1];'"'===i?s&&'"'===l?(o+='"',r++):s=!s:i!==t||s?"\n"!==i&&"\r"!==i||s?o+=i:(a.push(o),a.length>0&&n.push(a),a=[],o="","\r"===i&&"\n"===l&&r++):(a.push(o),o="")}return(o||a.length>0)&&(a.push(o),n.push(a)),n.filter((e=>e.length>0&&e.some((e=>e.trim()))))}const oe=[{type:"title",name:"Title"},{type:"text",name:"Text"},{type:"number",name:"Number"},{type:"select",name:"Select"},{type:"multi_select",name:"Multi-select"},{type:"status",name:"Status"},{type:"date",name:"Date"},{type:"checkbox",name:"Checkbox"},{type:"url",name:"URL"},{type:"email",name:"Email"},{type:"phone_number",name:"Phone Number"},{type:"person",name:"Person"},{type:"dont_import",name:"Don't import"}]},282834:(e,t,n)=>{n.d(t,{Bu:()=>f,I8:()=>m,qw:()=>u});n(898992),n(354520),n(803949);var a=()=>n(496603);const o=/[\u4E00-\u9FA5]/g,s=/[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\uff00-\uff9f\u4e00-\u9faf\u3400-\u4dbf]/g,r=/[\u3041-\u3096\u30A0-\u30FF\u31F0-\u31FF\u3220-\u3243\u3280-\u337F]/g,i=/[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,l=/[-./\\()"'''""，。、·～；,;<>~!@#$%^&*|+=[\]{}`~?:\s]/u;function c(e){return Boolean(e.match(o))}function d(e){return Boolean(e.match(i))}function p(e){return Boolean(e.match(s))}function u(e){return(0,a().oE)(e.split(l))}function m(e){return"none"===f(e)?u(e).length:e.length}function f(e,t){const n=d(e);return c(e)||p(e)||n?n?"ko":function(e){return Boolean(e.match(r))}(e)||"ja-JP"===t?"ja":"zh":"none"}},484127:(e,t,n)=>{n.d(t,{Mi:()=>l,VJ:()=>m,W6:()=>p,ut:()=>d,y5:()=>i,ye:()=>u});n(410838),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(581454),n(908872),n(737550);var a=()=>n(832443),o=()=>n(252050),s=()=>n(412412);function r(e){const t=[],n=e.matchAll(/\[(step-[^\[\]]*?),(artifact|claim),(\d+)\]/g);for(const a of n){const[,e,n,o]=a;"claim"!==n&&"artifact"!==n||t.push({planKey:e,citationType:n,resourceId:o})}return t}function i(e){let t=1;return e.replace(/\[(step-[^\[\]]*?),(artifact|claim),(\d+)\]/g,((e,n,a,o)=>{const s=encodeURIComponent(n),r=encodeURIComponent(a),i=encodeURIComponent(o),l=encodeURIComponent(",");return`[**[${t++}]**](#citation:${s}${l}${r}${l}${i})`}))}function l(e,t){const n={stepCitations:{...e.stepCitations}};for(const[a,o]of Object.entries(t.stepCitations)){if(!n.stepCitations[a]){n.stepCitations[a]={claims:[...o.claims],artifacts:[...o.artifacts]};continue}const e=new Set(n.stepCitations[a].claims.map((e=>e.id)));for(const s of o.claims)e.has(s.id)||n.stepCitations[a].claims.push(s);const t=new Set(n.stepCitations[a].artifacts.map((e=>e.id)));for(const s of o.artifacts)t.has(s.id)||n.stepCitations[a].artifacts.push(s)}return n}const c={"slack-result":"slack","google-drive-result":"google-drive","helpdoc-result":"helpdoc","github-result":"github","webpage-result":"webpage","jira-result":"jira","microsoft-teams-result":"microsoft-teams","sharepoint-result":"sharepoint"};function d(e,t){const n=[],r=(0,s().BD)(e.value,!1,{parseNoneClosedTags:!0})[0];if("element"!==r.type)return n;for(const l of r.children){if("element"!==l.type)continue;let e;const r=t.mapCounterToKey((0,o().VB)(l.attributes.id));if("element"!==l.type||"page"!==l.tagName&&"block"!==l.tagName){if("element"===l.type&&("slack-result"===l.tagName||"github-result"===l.tagName||"google-drive-result"===l.tagName||"jira-result"===l.tagName||"sharepoint-result"===l.tagName||"microsoft-teams-result"===l.tagName||"webpage"===l.tagName||"helpdoc"===l.tagName)){var i;const t=a().tD.parseAssistantHref(r.key),n="text"===(null===(i=l.children[0])||void 0===i?void 0:i.type)?l.children[0].value:"",o="slack-result"===l.tagName||"microsoft-teams-result"===l.tagName?l.attributes.channel:l.attributes.title;e={citationType:"universal_search",target:c[l.tagName],href:r.key,title:o,text:n,number:Number(l.attributes.id),...t}}}else{const n=t.mapCounterToKey((0,o().VB)(null==l?void 0:l.attributes.id));e={citationType:"notion",pageId:n.key,blockId:"block"===l.tagName?r.key:n.key,number:Number(l.attributes.id)}}n.push({id:l.attributes.id,artifactType:"text",content:(0,s()._o)(l),citationInfo:e})}return n}function p(e){try{const t=[];for(const o in e.stepCitations){const n=e.stepCitations[o];for(const e of n.artifacts||[])e.citationInfo&&t.push(e.citationInfo)}const n=t.length,a={};for(const e of t){if(!e)continue;let t="unknown";"notion"===e.citationType?t="notion":"universal_search"===e.citationType&&(t=e.target||"unknown"),a[t]=(a[t]||0)+1}return{allArtifacts:t,resultsBySource:a,numSearchResults:n}}catch(t){return{allArtifacts:[],resultsBySource:{},numSearchResults:0}}}function u(e,t){try{const c=r(e),d={},p=new Set;for(const e of c){const{planKey:r,citationType:c,resourceId:u}=e;try{var n;if(!r||!c||!u)continue;const e=t.stepCitations[r];if(!e)continue;let l;if("claim"===c){var a,o;const t=null===(a=e.claims)||void 0===a?void 0:a.find((e=>e.id===u));var s;if(null!=t&&null!==(o=t.supportingArtifactIds)&&void 0!==o&&o[0])l=null===(s=e.artifacts)||void 0===s?void 0:s.find((e=>e.id===t.supportingArtifactIds[0]))}else if("artifact"===c){var i;l=null===(i=e.artifacts)||void 0===i?void 0:i.find((e=>e.id===u))}if(null!==(n=l)&&void 0!==n&&n.citationInfo){let e="unknown";"notion"===l.citationInfo.citationType?(e="notion",p.add(l.citationInfo.pageId)):"universal_search"===l.citationInfo.citationType&&(e=l.citationInfo.target||"unknown"),d[e]=(d[e]||0)+1}}catch(l){continue}}return{citationsBySource:d,numCitationsShown:Object.values(d).reduce(((e,t)=>e+t),0),citationPageIds:Array.from(p)}}catch(l){return{citationsBySource:{},numCitationsShown:0,citationPageIds:[]}}}function m(e){const t=e.findLast((e=>"researcher-report"===e.type));return{citationInfo:t&&t.citationInfo?t.citationInfo:{stepCitations:{}},reportContent:(null==t?void 0:t.value)||""}}},555102:(e,t,n)=>{n.d(t,{BX:()=>x,Jv:()=>T,Kf:()=>b,WM:()=>v,Xd:()=>F,Xw:()=>D,bX:()=>y,uP:()=>_,yQ:()=>k});n(944114),n(898992),n(354520),n(803949),n(581454);var a=()=>n(906745),o=()=>n(242422),s=()=>n(158489),r=()=>n(416504),i=()=>n(179034),l=()=>n(155792),c=()=>n(201980),d=()=>n(534177),p=()=>n(799832),u=()=>n(594794),m=()=>n(460957),f=()=>n(968172),g=()=>n(712505),h=()=>n(718957);const y=new(n(140934).ComputedStore)((()=>{const{sidebarSpaceStore:e,currentUserStore:t,sidebarSpaceViewStore:a,mainEditorCurrentBlockStore:o}=n(907258).default.state;if(e&&t&&a)return{spaceStore:e,userStore:t,spaceViewStore:a,blockStore:o,peekStore:g().default.state.open?g().default.state.targetStore:void 0,workflowStore:(0,n(207214).k)(e.environment)}}),{debugName:"defaultInferenceContextStore"});function I(e){const t={};if(e.isCollectionView()){const n=(0,p().U)(e),a=null==n?void 0:n.collectionViewStore();a&&(t[e.id]=a.id)}else e.getContentStores().forEach((e=>{if(e.isCollectionView()){const n=(0,p().U)(e),a=null==n?void 0:n.collectionViewStore();a&&(t[e.id]=a.id)}}));return t}function v(e){const{environment:t,surface:n,inferenceContext:s,config:i,invokedFromBlockId:c,checklistId:d,checklistStepId:p}=e,{userStore:m,spaceStore:g,spaceViewStore:h,blockStore:y,peekStore:v,workflowStore:S}=s,b=(0,u().Z1)({environment:t,table:l().mS,spaceId:g.id}),_={...y&&y.isCollectionView()?{collectionViewBlockId:y.id,visibleCollectionViewIds:I(y)}:void 0,...y&&!y.isCollectionView()&&"personal_home_page"!==y.getType()&&"daily_brief_reminder"!==n?{blockId:y.id,visibleCollectionViewIds:I(y)}:void 0,...v?{peekBlockId:v.id,visibleCollectionViewIds:I(v)}:void 0,...S?{workflowId:S.id}:void 0},C={};if("workflow"!==i.type||!i.isCustomAgent){const e=h.getSettings(),t=null==e?void 0:e.agent_personalization_settings;var T;if(t)t.name&&(C.agentName=t.name),null!==(T=t.customization_items)&&void 0!==T&&T[0]&&(C.agentAccessory=t.customization_items[0]),t.context_page_id&&(C.context_page_id=t.context_page_id)}if(o().default.checkGate({gateName:"workflows_inference_replay"}))return{id:b,type:"context",value:{timezone:"America/Los_Angeles",userName:"Test User",userEmail:"test@example.com",userId:"test-user-id",spaceName:"Test Space",spaceId:g.id,spaceViewId:h.id,currentDatetime:"2024-01-01T00:00:00.000Z",surface:n,..._,invokedFromBlockId:c,..."onboarding_checklist"===n&&d&&p?{checklistId:d,checklistStepId:p}:{},...C}};const w=o().default.checkGate({gateName:"agent_user_session_context"})?function(e){const{spaceId:t,limit:n=10}=e,a=f().A.getWithoutSubscribing(t);return a.map((({pageId:e,visitedAt:t})=>({pageId:e,visitedAt:t}))).slice(0,n)}({spaceId:g.id}):void 0;return{id:b,type:"context",value:{timezone:(0,r().P)(),userName:m.getName(),userId:m.id,userEmail:m.getEmail(),spaceName:g.getName(),spaceId:g.id,spaceViewId:h.id,currentDatetime:a().DateTime.now().toISO(),surface:n,..._,invokedFromBlockId:c,..."onboarding_checklist"===n&&d&&p?{checklistId:d,checklistStepId:p}:{},...C,recentPageVisits:w}}}function S(e){const{environment:t,spaceStore:n,config:a}=e;return{id:(0,u().Z1)({environment:t,table:l().mS,spaceId:n.id}),type:"config",value:a}}function b(e){const{environment:t,spaceStore:n,value:o,userStore:s}=e,r=C(o);return{id:(0,u().Z1)({environment:t,table:l().mS,spaceId:n.id}),type:"user",value:r,userId:s.id,createdAt:a().DateTime.now().toISO()}}function _(e){const{environment:t,spaceStore:n,actualMessage:o,displayMessage:s,userStore:r}=e,i=C(o)??[],c=C(s);return{id:(0,u().Z1)({environment:t,table:l().mS,spaceId:n.id}),type:"user-injected",actualMessage:i,displayMessage:c,userId:r.id,createdAt:a().DateTime.now().toISO()}}function C(e){if(e)return(0,c().bBR)((0,c().ooo)(e))}function T({environment:e,spaceStore:t,userStore:n,promptType:a,value:o,locale:s,args:r}){return{id:(0,u().Z1)({environment:e,table:l().mS,spaceId:t.id}),type:"agent-prebuilt-prompt",promptType:a,userId:n.id,createdAt:Date.now(),value:o,locale:s,isEdited:!1,args:r}}const w=1200;function x(e){const{environment:t,spaceId:n,pointers:a,selectedBlockStores:o,textSelection:s,blockSelectionContext:r,textSelectionContext:c}=e;let d,p;if(r)d=r;else if(o&&o.length>0){const e=(0,h().BO)(o);e&&(d={type:"blocks",value:o.map((e=>e.pointer)),text:(0,m().E)({mode:"editing",multiSelection:e,forceExtendAnnotations:{}}).slice(0,w)})}if(c?p=c:s&&s.start.store.pointer.table===i().ev&&s.end.store.pointer.table===i().ev&&(p={type:"text",value:{start:{pointer:s.start.store.pointer,index:s.start.index},end:{pointer:s.end.store.pointer,index:s.end.index}},text:(0,m().E)({mode:"editing",multiSelection:s,forceExtendAnnotations:{}}).slice(0,w)}),0!==a.length||d||p)return{id:(0,u().Z1)({environment:t,table:l().mS,spaceId:n}),type:"user-specified-context",value:{pointers:a,blockSelection:d,textSelection:p}}}function k(e){const{activeRecordPointers:t,inactiveRecordPointers:n,environment:a,recordMap:o,spaceStore:r}=e;return{activeRecordPointers:t,inactiveRecordPointers:n,id:(0,u().Z1)({environment:a,spaceId:r.id,table:l().mS}),threadRecordMap:o&&o.getSize()>0?(0,s().he)(o):void 0,type:"agent-integration"}}function F(e){const{environment:t,inferenceContext:n,config:a,addSteps:o,surface:s,invokedFromBlockId:r,checklistId:i,checklistStepId:l}=e,c=[S({environment:t,spaceStore:n.spaceStore,config:a}),v({environment:t,inferenceContext:n,surface:s,config:a,invokedFromBlockId:r,checklistId:i,checklistStepId:l})];return o&&c.push(...o),c.filter(d().O9)}function D(e){const{environment:t,spaceId:n,message:a,notificationType:o="info",metadata:s}=e;return{id:(0,u().Z1)({environment:t,table:l().mS,spaceId:n}),type:"system-notification",message:a,notificationType:o,metadata:s}}},844317:(e,t,n)=>{n.d(t,{getWorkflowAgentConfig:()=>p});var a=()=>n(242422),o=()=>n(81986),s=()=>n(915671);const r=new(n(29923).R)({key:"agent_memory_database_page",namespace:n(553737).Bq,important:!0,trackingType:"preference"});var i=()=>n(604018),l=()=>n(383070),c=()=>n(962753);const d="anthropic-sonnet-alt-no-thinking";function p(e={}){const{searchScopes:t,searchSessionId:n,useWebSearch:p,useReadOnlyMode:m,model:f,isCustomAgent:g,isCustomAgentBuilder:h,workflowId:y,modelFromUser:I,writerMode:v,researchMode:S,environment:b,spaceId:_,useCustomAgentDraft:C,useDraftActorPointer:T}=e,w=void 0===p||p,x=l().zD.isZeroRetentionEnabled(),k=(0,o().MI)((0,o().VD)("custom_agents"),u),F=(0,o().MI)((0,o().VD)("agent_automations"),u),D=(0,o().MI)((0,o().VD)("agent_integrations"),u),A=(0,o().MI)((0,o().VD)("experimental_integrations"),u),U=(0,o().MI)((0,o().VD)("database_agents"),u),M=(0,o().MI)((0,o().VD)("agent_script_agent_advanced"),u),P=(0,o().MI)((0,o().VD)("agent_script_agent"),u),V=(0,o().MI)((0,o().VD)("agent_user_session_context"),u),B=(0,o().MI)((0,o().VD)("agent_thread_tools"),u),N=u("custom_agent_setup_mode_tool"),R=(0,o().MI)((0,o().VD)("agent_create_dashboard"),u),E=(0,o().MI)((0,o().VD)("agent_card_customization"),u),L=(0,o().MI)((0,o().VD)("agent_system_prompt_as_page"),u),O=(0,o().MI)((0,o().VD)("agent_view_notifications_tool_enabled"),u),$=u("agent_revert_tool_enabled"),z=u("sams_specials"),Z=u("agent_generate_image")&&!z,j=(0,o().MI)((0,o().VD)("agent_diffs"),u),H=(0,o().MI)((0,o().VD)("agent_create_db_template"),u),K=u("agent_update_page_v2"),q=u("agent_update_page_autofixer"),G=u("use_update_agent_v2_tools"),W=u("agent_markdown_tree"),J=u("agent_update_page_tree_diff"),Q=u("agent_update_page_tree_diff_metrics"),X=u("agent_update_page_order_updates"),Y=u("agent_support_property_reorder"),ee=r.getState(),te=null==ee?void 0:ee.pageId,ne=void 0!==b&&(0,c().P$)(b,_);let ae;ae=!y&&(!!ne&&(void 0!==m&&m));const oe=!v&&(!x&&w);return{type:"workflow",enableAgentAutomations:F,enableAgentIntegrations:D,enableCustomAgents:k,enableExperimentalIntegrations:A,enableAgentViewNotificationsTool:O,enableAgentRevertTool:$,enableAgentDiffs:j,enableAgentCreateDbTemplate:H,enableCsvAttachmentSupport:!0,enableDatabaseAgents:U,enableAgentThreadTools:B,enableRunAgentTool:B,enableSetupModeTool:N,enableAgentDashboards:R,enableAgentCardCustomization:E,enableSystemPromptAsPage:L,enableUserSessionContext:V,enableScriptAgentAdvanced:!v&&M,enableScriptAgent:!v&&P,...g?{}:{enableAgentGenerateImage:Z},agentFollowupVariation:Boolean(v)||Boolean(g)?void 0:(0,c().VA)(),enableAgentTodos:"on"===a().default.getEligibleGroup({experimentId:"ai_product_retention_agent_todos_v2",defaultGroup:"control"}),enableSpeculativeSearch:(0,c().EH)(),enableQueryCalendar:u("agent_query_calendar_tool"),enableQueryMail:u("agent_query_mail_tool"),enableAgentVerification:(0,o().g1)(u),memoryDatabasePageId:te,workflowId:y,availableConnectors:(0,i().wd)(),searchScopes:v?[]:t??s().R2,useWebSearch:oe,useReadOnlyMode:ae,writerMode:Boolean(v),model:v?d:f,searchSessionId:n,modelFromUser:!v&&(I??void 0!==f),isCustomAgent:Boolean(g),isCustomAgentBuilder:Boolean(h),useCustomAgentDraft:Boolean(C),use_draft_actor_pointer:Boolean(T),enableUpdatePageV2Tool:K,enableUpdatePageAutofixer:q,enableUpdateAgentV2Tools:G,enableUpdatePageMarkdownTree:W,enableUpdatePageTreeDiff:J,enableUpdatePageOrderUpdates:X,enableUpdatePageTreeDiffMetrics:Q,enableAgentSupportPropertyReorder:Y,researchMode:Boolean(S)}}function u(e){return a().default.checkGate({gateName:e})}},878456:(e,t,n)=>{n.d(t,{Mt:()=>u,RM:()=>d,dC:()=>i,f_:()=>m,ie:()=>c,q1:()=>r,sQ:()=>f,uF:()=>p});n(410838),n(813451),n(944114),n(898992),n(354520),n(737550);var a=()=>n(534177),o=()=>n(724639),s=()=>n(484127);function r(e){return e.some((e=>"config"===e.type&&"workflow"===e.value.type))}function i(e){return e.some((e=>"config"===e.type&&"researcher"===e.value.type))}const l=/<lang\s+.*?>\s*/g;function c(e){if("string"==typeof e.value)return{...e,value:(t=e.value,t.replace(l,""))};if(Array.isArray(e.value)){const t=e.value.findIndex((e=>"text"===e.type));if(-1===t)return e;let n="";for(const r of e.value.slice(t)){if("text"!==r.type)break;n+=r.content}if(!l.exec(n))return e;let a="",o=t;for(;o<e.value.length;o++){const t=e.value[o];if("text"!==t.type)break;a+=t.content}const s=[...e.value.slice(0,t),{type:"text",content:a.replace(l,"")},...e.value.slice(o)];return"text"===s[0].type&&0===s[0].content.length&&s.shift(),{...e,value:s}}var t;return e}function d(e,t){const n={};for(const a of e)"registered-tool-grouping"===a.type&&(n[a.toolCallId]=a);let r=[...e];if("user"===t.type||"user-injected"===t.type||"error"===t.type||"premium-feature-unavailable"===t.type||"context"===t.type||"title"===t.type||"retry"===t.type||"autocorrect"===t.type||"autocomplete"===t.type||"search-observation"===t.type||"researcher-text-observation"===t.type||"debug-inference"===t.type||"wait"===t.type||"agent-search-query-generation"===t.type||"fast-researcher-plan"===t.type||"fast-researcher-search-results"===t.type||"memory-agent"===t.type||"summarize-transcript"===t.type||"summarize-transcript-record-map"===t.type||"summarize-transcript-error"===t.type||"record-pointers-updated"===t.type||(0,o().P0)(t)||"researcher-agent-group"===t.type||"agent-debug-error"===t.type||"eval-result"===t.type||"attachment"===t.type||"agent-transcript-summary"===t.type||"agent-records-updated"===t.type||"agent-turn-start"===t.type||"agent-record-map"===t.type||"user-specified-context"===t.type||"mention"===t.type||"agent-integration"===t.type||"aiBlockResponse"===t.type||"system-notification"===t.type||"agent-trigger"===t.type||"agent-prebuilt-prompt"===t.type||"agent-route-trigger"===t.type||"workflow-effect-calling"===t.type||"workflow-effect-called"===t.type||"workflow-effect-error"===t.type)r.push({...t});else if("agent-turn-full-record-map"===t.type){const e=r.findLastIndex((e=>e.id===t.id));if(-1!==e&&"agent-turn-full-record-map"===r[e].type){const n=r[e];r[e]={...n,agentRecordMap:t.agentRecordMap,threadRecordMap:t.threadRecordMap,recordVersions:t.recordVersions}}else r.push({...t})}else if("search"===t.type)r=[...r.filter((e=>e.id!==t.id)),{...t}];else if("agent-inference"===t.type||"agent-tool-result"===t.type||"config"===t.type){const e=r.findLastIndex((e=>e.id===t.id));-1!==e?r[e]=t:r.push({...t})}else if("markdown-chat"===t.type){const e=r.findLastIndex((e=>e.id===t.id));if(-1!==e&&"markdown-chat"===r[e].type){const n=r[e];r[e]={...n,value:`${n.value}${t.value}`}}else r.push({...t})}else if("search-chat"===t.type){const e=r.findLastIndex((e=>e.id===t.id));if(-1!==e&&"search-chat"===r[e].type){const n=r[e];r[e]={...n,value:`${n.value}${t.value}`}}else r.push({...t})}else if("fast-researcher-chat"===t.type){const e=r.findLastIndex((e=>e.id===t.id));if(-1!==e&&"fast-researcher-chat"===r[e].type){const n=r[e];r[e]={...n,value:`${n.value}${t.value}`}}else r.push({...t})}else if("setup"===t.type){const e=r.findLastIndex((e=>e.id===t.id));-1!==e&&"setup"===r[e].type?r[e]=t:r.push({...t})}else if("researcher-report"===t.type){const e=r.findLastIndex((e=>e.id===t.id));if(-1!==e&&"researcher-report"===r[e].type){const n=r[e];r[e]={...n,value:`${n.value}${t.value}`,citationInfo:(0,s().Mi)(n.citationInfo,t.citationInfo)}}else r.push({...t})}else if("researcher-agent"===t.type){const e=r.findIndex((e=>e.id===t.id));-1!==e&&"researcher-agent"===r[e].type?r[e]={...r[e],value:Object.assign(r[e].value,t.value),updatedAt:t.updatedAt}:r.push({...t})}else if("researcher-next-steps"===t.type){const e=r.findIndex((e=>e.id===t.id));-1!==e?r[e]={...t}:r.push({...t})}else if("registered-tool-call"===t.type||"registered-tool-output"===t.type||"registered-tool-error"===t.type){let e=n[t.toolCallId];e||(e={id:t.toolCallId,type:"registered-tool-grouping",toolName:t.toolName,toolCallId:t.toolCallId,steps:[]},n[t.toolCallId]=e,r.push(e));const a={...t};e.steps.push(a)}else if("registered-tool-grouping"===t.type)n[t.toolCallId]||(n[t.toolCallId]=t,r.push({...t}));else if("setup-operations"===t.type){const e=r.findLastIndex((e=>e.id===t.id)),n=r[e];(null==n?void 0:n.type)===t.type?r[e]={...n,operations:[...n.operations,...t.operations]}:r.push({...t})}else if("generate-formula"===t.type){const e=r.findLastIndex((e=>e.id===t.id));-1!==e&&"generate-formula"===r[e].type?r[e]={...r[e],value:t.value}:r.push({...t})}else"database-agent-setup"===t.type||"agent-message"===t.type?r.push({...t}):(0,a().HB)(t);return r}const p="inferenceTranscript";function u(e){return"object"==typeof e&&null!==e&&"transcript"in e}function m(e){const t=e.findLast((e=>"config"===e.type));return null==t?void 0:t.value}function f(e){if(e)return"search"===e.type||"workflow"===e.type?e.searchSessionId:void 0}}}]);