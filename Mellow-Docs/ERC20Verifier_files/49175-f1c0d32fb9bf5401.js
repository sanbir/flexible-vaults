"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[49175],{37546:(e,t,a)=>{a.d(t,{l:()=>je});var n=()=>a(222926),i=a(296540),o=()=>a(300474),r=()=>a(755531),s=()=>a(726637),l=()=>a(484714),d=()=>a(590526),c=()=>a(401497),u=()=>a(493552),p=()=>a(187174),m=()=>a(69708),y=()=>a(498212),g=()=>a(465039),f=()=>a(462842),h=()=>a(345737),v=()=>a(907258),A=()=>a(314709),x=()=>a(59226),C=()=>a(242422),k=()=>a(792057),b=()=>a(295633),S=()=>a(634604),I=()=>a(888626),T=()=>a(251111),M=()=>a(165358),w=()=>a(278238),P=()=>a(538550),j=()=>a(402390),_=()=>a(179034),D=()=>a(529745),L=()=>a(100622),B=()=>a(496603),K=()=>a(769864),R=()=>a(219348),q=()=>a(370441),E=()=>a(127581),V=()=>a(71268),N=()=>a(935774),W=()=>a(570882),U=()=>a(146423),z=()=>a(78219),F=()=>a(42905),O=()=>a(212782),H=(a(581454),()=>a(395361)),$=()=>a(202106),G=()=>a(31511),Y=a(474848);const Z="marketplace-checkout-email";function X(){const e=(0,c().IS)((()=>({inputLabel:{position:"absolute",marginTop:"7px",marginInlineStart:"9px"},inputStyle:{paddingTop:"17px",cursor:"not-allowed",color:L().Tj.text.tertiary}})),[]),t=(0,d().K8)((()=>{var e;return(null===(e=v().default.state.currentUserStore)||void 0===e?void 0:e.getEmail())||""}),[]);return(0,Y.jsxs)("div",{children:[(0,Y.jsx)(u().D,{as:"label",id:Z,styleKey:"captionSmSemibold",style:e.inputLabel,children:(0,Y.jsx)(m().sA,{id:"inApp.marketplace.checkout.email",defaultMessage:"Email"})}),(0,Y.jsx)(G().A,{disabled:!0,value:t,inputStyle:e.inputStyle,"aria-labelledby":Z})]})}const J=(0,m().YK)({paymentDetails:{id:"inApp.marketplace.checkout.payment.secondaryText",defaultMessage:"Payment details"},billedTo:{id:"inApp.marketplace.checkout.payment.billedTo",defaultMessage:"Billed to"}});function Q(e){const{onAddressChange:t,contacts:a,setIsPaymentElementComplete:i,isPaying:o}=e,r=(0,c().IS)((()=>({formContainer:{minWidth:s().A.isMobile?"100%":390,display:"flex",flexDirection:"column",gap:24},filler:{width:"100%",display:"flex",flexDirection:"column",gap:8},isolation:{isolation:"auto"},addressContainer:{zIndex:1}})),[]),l=(0,n().useStripe)(),d=(0,n().useElements)(),p=(0,m().tz)(),y={mode:"billing",contacts:a.length>0?a.map((e=>({name:e.name,address:e.address}))):void 0},g=(0,H().Y)(t,1e3),f={business:{name:"Notion Labs, Inc"},readOnly:o};return(0,Y.jsxs)("div",{style:r.formContainer,children:[(0,Y.jsxs)("div",{style:{...r.filler,...r.isolation},children:[(0,Y.jsx)(u().D,{styleKey:"captionSemibold",colorVariant:"secondary",children:p.formatMessage(J.billedTo)}),(0,Y.jsx)("div",{style:r.addressContainer,children:(0,Y.jsx)(n().AddressElement,{options:y,onChange:g})}),(0,Y.jsx)(X,{})]}),(0,Y.jsxs)("div",{style:r.filler,children:[(0,Y.jsx)(u().D,{styleKey:"captionSemibold",colorVariant:"secondary",children:p.formatMessage(J.paymentDetails)}),(0,Y.jsx)(n().PaymentElement,{options:f,onChange:e=>{l&&d&&(e.value.type&&(0,$().t6)(e.value.type)&&U().A.setState({...U().A.state,paymentType:e.value.type}),e.complete&&i(!0))}})]})]})}var ee=()=>a(738471),te=()=>a(453697);function ae(e){const{productInformation:t}=e,{name:a,imageSource:n,mobileImageSource:i,creatorIconImage:o,creatorName:r}=t,l=(0,c().IS)((()=>({container:{display:"flex",gap:20,alignItems:"center",justifyContent:"space-between",padding:s().A.isMobile?"16px 16px 0px 16px":"16px",borderRadius:6,border:`1px solid ${L().Tj.border.primary}`,maxHeight:s().A.isMobile?"120px":"initial",overflow:s().A.isMobile?"hidden":"initial"},mobileProductImage:{width:"87px",minHeight:"100px",height:"auto",border:s().A.isMobile?"none":`1px solid ${L().Tj.border.primary}`,boxShadow:s().A.isMobile?"rgba(0, 0, 0, 0.02) -10px 12px 32px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px":"unset",borderRadius:6},productImageContainer:{alignSelf:s().A.isMobile?"start":"initial"},productImage:{width:118,height:74,borderRadius:6,border:`1px solid ${L().Tj.border.primary}`},productNameAndCreator:{display:"flex",flexDirection:"column",gap:10,paddingBottom:s().A.isMobile?16:0},productCreator:{display:"flex",alignItems:"center",gap:6},productName:{display:"flex",flexWrap:"wrap",maxWidth:181}})),[]);return(0,Y.jsxs)("div",{style:l.container,children:[(0,Y.jsxs)("div",{style:l.productNameAndCreator,children:[(0,Y.jsx)(u().D,{styleKey:"titleSmSemibold",colorVariant:"primary",style:l.productName,children:a}),(0,Y.jsxs)("div",{style:l.productCreator,children:[(0,Y.jsx)(te().A,{size:20,avatar:{name:r,avatarUrl:o}}),(0,Y.jsx)(u().D,{styleKey:"captionMedium",colorVariant:"secondary",children:r})]})]}),(0,Y.jsx)("div",{style:l.productImageContainer,children:(0,Y.jsx)(ee().A,{src:s().A.isMobile?i:n,alt:a,style:s().A.isMobile?l.mobileProductImage:l.productImage})})]})}var ne=()=>a(388926),ie=()=>a(98126),oe=()=>a(160432),re=()=>a(292119),se=()=>a(564884);function le({children:e,source:t,styles:a={}}){const n=(0,l().v3)(),i=(0,c().IS)((()=>({link:{cursor:"pointer"}})),[]),o=(0,d().K8)((()=>C().default.getConfigKey("mwn_refund_policy_link","link")),[]);return o?(0,Y.jsx)("a",{style:{...i.link,...a},href:o,target:"_blank",onClick:()=>{(0,se().u)({environment:n,event:{eventName:"marketplace_refund_policy_click",eventProperties:{source:t}}})},children:e}):(0,Y.jsx)(Y.Fragment,{children:e})}var de=()=>a(718827);function ce(e){const{couponCode:t,onApplyClick:a,onCouponChange:n,isApplyingCoupon:i,isCouponApplied:o,onRemoveClick:r,invalidCouponReason:s,disabled:l}=e,d=(0,m().tz)(),p=l||i||""===t,y=function(e){const{disabled:t,applyButtonDisabled:a}=e;return(0,c().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:8,position:"relative"},inputOuter:{height:34,paddingTop:10,paddingInlineEnd:6,paddingBottom:10,paddingInlineStart:10,display:"flex",alignItems:"center",borderRadius:6,border:L().Tj.border.primary,background:L().Tj.background.secondary},input:{position:"relative"},inputInner:{cursor:t?"not-allowed":void 0},button:{background:"transparent",height:28,paddingTop:0,paddingInlineEnd:8,paddingBottom:0,paddingInlineStart:8,display:"flex",justifyContent:"center",alignItems:"center",borderRadius:6,isolation:"auto",cursor:a?"not-allowed":void 0,width:"max-content"},buttonContainer:{cursor:"pointer"},buttonHovered:{background:t?void 0:L().Tj.buttonHoveredBackground},buttonPressed:{background:t?void 0:L().Tj.buttonPressedBackground},invalidBoxShadow:{position:"absolute",pointerEvents:"none",isolation:"auto",borderRadius:6,inset:0,zIndex:1,boxShadow:"0px 0px 0px 1px #D44C47 inset, 0px 0px 0px 2px rgba(225, 111, 100, 0.35)"}})),[t,a])}({disabled:l||i,applyButtonDisabled:p}),g=Boolean(s);return(0,Y.jsxs)("div",{style:y.container,children:[(0,Y.jsx)(u().D,{styleKey:"captionMedium",colorVariant:"secondary",children:(0,Y.jsx)("label",{htmlFor:"couponInput",children:(0,Y.jsx)(m().sA,{id:"inApp.marketplace.checkout.coupon.label",defaultMessage:"Coupon"})})}),(0,Y.jsxs)("div",{style:y.input,children:[(0,Y.jsx)(G().A,{id:"couponInput",ignoreKeyboardMode:!0,value:t,disabled:l||i,onChange:n,placeholder:d.formatMessage({id:"inApp.marketplace.checkout.coupon.input.placeholder",defaultMessage:"Code"}),style:y.inputOuter,inputStyle:y.inputInner,rightStyle:y.buttonContainer,right:i?(0,Y.jsx)(ie().k,{}):o?(0,Y.jsx)(de().Ay,{style:y.button,onClick:()=>{r()},hoveredStyle:y.buttonHovered,pressedStyle:y.buttonPressed,disabled:l,children:(0,Y.jsx)(u().D,{styleKey:"bodyRegular",colorVariant:"primary",children:(0,Y.jsx)(m().sA,{id:"inApp.marketplace.checkout.coupon.remove",defaultMessage:"Remove"})})}):(0,Y.jsx)(de().Ay,{style:y.button,onClick:async()=>{await a(t)},hoveredStyle:y.buttonHovered,pressedStyle:y.buttonPressed,disabled:p,children:(0,Y.jsx)(u().D,{styleKey:"bodyRegular",colorVariant:p?"secondary":"primary",children:(0,Y.jsx)(m().sA,{id:"inApp.marketplace.checkout.coupon.apply",defaultMessage:"Apply"})})})}),g?(0,Y.jsx)("div",{style:y.invalidBoxShadow}):void 0]}),g?(0,Y.jsx)(u().D,{styleKey:"captionRegular",colorPalette:"red",colorVariant:"accentPrimary","aria-invalid":"true","aria-errormessage":d.formatMessage({id:"inApp.marketplace.checkout.coupon.invalid.label",defaultMessage:"Invalid coupon code"}),children:s}):void 0]})}var ue=()=>a(420802);function pe(e){const{checkboxProps:t,label:a,error:n,containerStyles:i={}}=e,o=(0,c().IS)((()=>({container:{display:"flex",gap:8},checkbox:{marginTop:"1px"},text:{display:"flex",flexDirection:"column",gap:2}})),[]);return(0,Y.jsxs)("label",{style:{...o.container,...i},children:[(0,Y.jsx)(ue().S,{size:14,...t,style:{...t.style,...o.checkbox}}),(0,Y.jsxs)("div",{style:o.text,children:[(0,Y.jsx)(u().D,{styleKey:"captionRegular",colorVariant:"primary",children:a}),n?(0,Y.jsx)(u().D,{styleKey:"captionRegular",colorPalette:"red",colorVariant:"accentPrimary",children:n}):void 0]})]})}function me({displayInformation:{emailRequirement:e}}){const t=(0,c().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:"8px"}})),[]),{isChecked:a,isError:n}=(0,d().K8)((()=>({isChecked:U().A.state.allowCreatorToAddToMailingList,isError:U().A.state.allowCreatorToAddToMailingListError})),[]);(0,i.useEffect)((()=>{a&&n&&U().A.setState({...U().A.state,allowCreatorToAddToMailingListError:!1})}),[a,n]);const o="required"===e;return o||"optional"===e?(0,Y.jsx)("div",{style:t.container,children:(0,Y.jsx)(pe,{label:(0,Y.jsx)(m().sA,{id:"inApp.marketplace.checkout.saveEmail",defaultMessage:"Allow the creator to add me to their mailing list for updates, promotions, and helpful tips."}),checkboxProps:{onClick:()=>{U().A.setState({...U().A.state,allowCreatorToAddToMailingList:!U().A.state.allowCreatorToAddToMailingList})},checked:a,"aria-required":o},error:o&&n&&(0,Y.jsx)(m().sA,{id:"inApp.marketplace.checkout.emailRequired",defaultMessage:"You must opt-in to emails to continue"})})}):null}function ye(e){const{price:t,taxAmount:a,discount:n,isCalculatingNewPrice:i,discountedPrice:o,taxAmountWithDiscount:r}=e,s=(0,$().$D)({price:t,taxAmount:a,currencyCode:"USD"}),l=(0,m().tz)(),d=(0,c().IS)((()=>({orderSummaryContainer:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},priceSummaryContainer:{display:"flex",gap:4,alignItems:"center"},fullPriceStrikethrough:{textDecoration:"line-through",color:L().Tj.text.tertiary}})),[]);return(0,Y.jsxs)("div",{style:d.orderSummaryContainer,children:[(0,Y.jsxs)("div",{style:d.priceSummaryContainer,children:[(0,Y.jsx)(u().D,{styleKey:"titleXlBold",colorVariant:"primary",children:void 0!==n&&void 0!==o?(0,Y.jsx)(m().sA,{id:"inApp.marketplace.checkout.totalPrice.withDiscount",defaultMessage:"<strikethrough><fullPriceMoney></fullPriceMoney></strikethrough> <priceWithDiscountMoney></priceWithDiscountMoney>",values:{strikethrough:e=>(0,Y.jsx)("span",{style:d.fullPriceStrikethrough,children:e}),fullPriceMoney:()=>(0,Y.jsx)(re().v,{cost:{amount:s.amount,currencyCode:"USD"},intl:l,trailingZeroDisplay:"auto"}),priceWithDiscountMoney:()=>{const e=(0,$().$D)({price:o,taxAmount:r,currencyCode:"USD"});return(0,Y.jsx)(re().v,{cost:{amount:e.amount,currencyCode:"USD"},intl:l,trailingZeroDisplay:"auto"})}}}):(0,Y.jsx)(re().v,{cost:{amount:s.amount,currencyCode:"USD"},intl:l,trailingZeroDisplay:"auto"})}),(0,Y.jsx)(u().D,{styleKey:"captionRegular",colorVariant:"secondary",children:(0,Y.jsx)(m().sA,{id:"inApp.marketplace.checkout.taxIfApplicable",defaultMessage:"(includes tax if applicable)"})})]}),i?(0,Y.jsx)(ie().k,{}):void 0]})}function ge(e){const{listingId:t}=e,a=(0,d().K8)((()=>C().default.getConfigKey("marketplace_transactional_email_config","listingIds")),[]),n=(0,d().K8)((()=>U().A.state.agreedToTermsAndConditions),[]),i=(0,d().K8)((()=>U().A.state.showTermsAndConditionsError),[]),o=(0,m().tz)(),r=(0,c().IS)((()=>({termsAndConditionsContainer:{display:"flex",flexDirection:"column",gap:2},link:{cursor:"pointer",color:L().Tj.text.primary}})),[]);return(0,Y.jsx)("div",{style:r.termsAndConditionsContainer,children:(0,Y.jsx)(pe,{checkboxProps:{onClick:()=>{U().A.setState({...U().A.state,agreedToTermsAndConditions:!n,showTermsAndConditionsError:!1})},"aria-required":!0,checked:n},label:o.formatMessage(a.includes(t)?fe.termsAndConditionsTransactionalEmail:fe.termsAndConditions,{a:e=>(0,Y.jsx)("a",{style:r.link,href:"https://www.notion.so/notion/Terms-and-Privacy-28ffdd083dc3473e9c2da6ec011b58ac",target:"_blank",children:e}),refundLink:e=>(0,Y.jsx)(le,{source:"checkout_modal",styles:r.link,children:e})}),error:i?o.formatMessage(fe.termsAndConditionsError):void 0})})}const fe=(0,m().YK)({termsAndConditionsTransactionalEmail:{id:"inApp.marketplace.payment.termsAndConditions.transactionalEmail",defaultMessage:"I agree to <a>Notion’s terms & conditions</a> and the Marketplace’s <refundLink>14-day refund policy</refundLink>. I also agree that the above email address may be shared with the template creator for transactional purposes"},termsAndConditions:{id:"inApp.marketplace.payment.termsAndConditions",defaultMessage:"I agree to <a>Notion’s terms & conditions</a> and the Marketplace’s <refundLink>14-day refund policy</refundLink>"},termsAndConditionsError:{id:"inApp.marketplace.payment.termsAndConditions.error",defaultMessage:"You must accept the Marketplace terms to continue"}});async function he({setIsApplyingCoupon:e,environment:t,coupon:a,productListingId:n,address:i,elements:o,acquisitionId:r}){const s=a.trim().toUpperCase();if(0===s.length)return;e(!0);const l=await f().Ks({environment:t,coupon:s,productListingId:n});if(l){let e=0;if((0,T().Z)(i)){const n=await K().callApi({eventName:"calculateMarketplaceTax",environment:t,data:{address:i,acquisitionId:r,couponCode:a}});if("success"===n.type&&n.data.valid){e=n.data.taxAmountWithCoupon??0;const t=n.data.totalAmountWithCoupon;o&&0!==t&&o.update({amount:t})}}U().A.setState({...U().A.state,discount:l.discount,discountedPrice:l.discountedPrice,isCouponApplied:!0,taxAmountWithDiscount:e}),f().H4({environment:t,coupon:a})}e(!1)}function ve(e){const{displayInformation:t,price:a,isPaying:n,onSubmit:i,productListingId:o,acquisitionId:r,isTCCheckboxEnabled:s}=e,l=be();return(0,Y.jsxs)("div",{style:l.sidebarContainer,children:[(0,Y.jsxs)("div",{style:l.productCardContainer,children:[(0,Y.jsx)(u().D,{styleKey:"captionMedium",colorVariant:"secondary",children:(0,Y.jsx)(m().sA,{id:"inApp.marketplace.checkout.product.label",defaultMessage:"Notion template"})}),(0,Y.jsx)(ae,{productInformation:t})]}),(0,Y.jsxs)("div",{style:l.priceAndPaymentContainer,children:[(0,Y.jsx)(Ae,{productListingId:o,acquisitionId:r,price:a,isPaying:n}),(0,Y.jsx)("div",{style:l.requiredCheckboxesContainer,children:(0,Y.jsx)(xe,{listingId:o,displayInformation:t,isTCCheckboxEnabled:s})}),(0,Y.jsx)(ne().A,{size:1}),(0,Y.jsx)(ke,{onSubmit:i,price:a,isPaying:n}),s?null:(0,Y.jsx)(Ce,{listingId:o})]})]})}function Ae(e){const{productListingId:t,acquisitionId:a,price:o,isPaying:r}=e,s=(0,l().v3)(),c=(0,W().I)(),u=(0,n().useElements)(),p=(0,i.useRef)(!1),[m,y]=(0,i.useState)(!1),g=(0,d().K8)((()=>U().A.state.coupon),[]),f=(0,d().K8)((()=>U().A.state.isCouponApplied),[]),h=(0,d().K8)((()=>U().A.state.invalidCouponReason),[]),v=(0,d().K8)((()=>U().A.state.taxAmount),[]),A=(0,d().K8)((()=>U().A.state.address),[]),x=(0,i.useCallback)((async e=>{await he({environment:s,productListingId:t,acquisitionId:a,address:A,elements:u,setIsApplyingCoupon:y,coupon:e})}),[s,t,a,A,u]);(0,i.useEffect)((()=>{(async()=>{if(!c.coupon||!t||!a||!u||p.current)return;const e=c.coupon.trim().toUpperCase();U().A.setState({...U().A.state,coupon:e}),await he({environment:s,productListingId:t,acquisitionId:a,address:A,elements:u,setIsApplyingCoupon:y,coupon:e}),p.current=!0})()}),[c.coupon,s,t,a,A,u]);return(0,Y.jsx)(ce,{couponCode:g,onCouponChange:e=>{const t=e.target.value.trim().toUpperCase();e.target.value=t,U().A.setState({...U().A.state,coupon:t})},onApplyClick:x,onRemoveClick:()=>{U().A.setState({...U().A.state,coupon:"",discount:void 0,isCouponApplied:!1,discountedPrice:void 0}),u&&u.update({amount:v+o})},isCouponApplied:f,isApplyingCoupon:m,invalidCouponReason:h,disabled:r})}function xe(e){const{displayInformation:t,listingId:a,isTCCheckboxEnabled:n}=e;return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(me,{displayInformation:t}),n?(0,Y.jsx)(ge,{listingId:a}):void 0]})}function Ce(e){const{listingId:t}=e,a=(0,d().K8)((()=>C().default.getConfigKey("marketplace_transactional_email_config","listingIds")),[]),n=(0,c().IS)((()=>({link:{color:L().Tj.text.secondary}})),[]);return(0,Y.jsx)(u().D,{styleKey:"captionRegular",colorVariant:"secondary",children:a.includes(t)?(0,Y.jsx)(m().sA,{id:"inApp.marketplace.payment.termsAndConditionsBuyLabel.transactionalEmail",defaultMessage:"By purchasing this template, I agree to <a>Notion’s terms & conditions</a> and the Marketplace’s <refundLink>14-day refund policy</refundLink>. I also agree that the above email address may be shared with the template creator for transactional purposes",values:{a:e=>(0,Y.jsx)("a",{style:n.link,href:"https://www.notion.so/notion/Terms-and-Privacy-28ffdd083dc3473e9c2da6ec011b58ac",target:"_blank",children:e}),refundLink:e=>(0,Y.jsx)(le,{source:"checkout_modal",styles:n.link,children:e})}}):(0,Y.jsx)(m().sA,{id:"inApp.marketplace.payment.termsAndConditionsBuyLabel",defaultMessage:"By purchasing this template, I agree to <a>Notion’s terms & conditions</a> and the Marketplace’s <refundLink>14-day refund policy</refundLink>",values:{a:e=>(0,Y.jsx)("a",{style:n.link,href:"https://www.notion.so/notion/Terms-and-Privacy-28ffdd083dc3473e9c2da6ec011b58ac",target:"_blank",children:e}),refundLink:e=>(0,Y.jsx)(le,{source:"checkout_modal",styles:n.link,children:e})}})})}function ke(e){const{onSubmit:t,price:a,isPaying:n}=e,i=be(),o=(0,m().tz)(),r=(0,d().K8)((()=>U().A.state.discountedPrice),[]),s=(0,d().K8)((()=>U().A.state.taxAmount),[]),l=(0,d().K8)((()=>U().A.state.discount),[]),c=(0,d().K8)((()=>U().A.state.isCalculatingTax),[]),u=(0,d().K8)((()=>U().A.state.taxAmountWithDiscount),[]),p=(0,$().$D)({taxAmount:void 0!==r?u:s,price:void 0!==r?r:a,currencyCode:"USD"});return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(ye,{price:a,discountedPrice:r,taxAmount:s,taxAmountWithDiscount:u,discount:l,isCalculatingNewPrice:c}),(0,Y.jsx)(oe().A,{colorPalette:"blue",onClick:t,style:i.singleButton,disabled:n,children:n?(0,Y.jsx)(ie().k,{}):(0,Y.jsx)("div",{style:i.buyButtonText,children:0===p.amount?o.formatMessage(Se.purchaseFreeTemplate):o.formatMessage(Se.purchaseTemplate,{money:()=>(0,Y.jsx)(re().v,{cost:{amount:p.amount,currencyCode:"USD"},intl:o,trailingZeroDisplay:"auto"})})})})]})}function be(){return(0,c().IS)((()=>({sidebarContainer:{display:"flex",flexDirection:"column",gap:30},priceAndPaymentContainer:{display:"flex",flexDirection:"column",gap:20},productCardContainer:{display:"flex",flexDirection:"column",gap:8},doubleButton:{width:"250px"},alreadyOwnedCtas:{display:"flex",alignItems:"center",gap:20},requiredCheckboxesContainer:{display:"flex",flexDirection:"column",gap:16},singleButton:{width:"100%",height:36,borderRadius:8},buyButtonText:{fontSize:16,color:L().Tj.text.inversePrimary,fontWeight:590}})),[])}const Se=(0,m().YK)({purchaseTemplate:{id:"inApp.marketplace.checkout.payment.buy",defaultMessage:"Buy for <money></money>"},purchaseFreeTemplate:{id:"inApp.marketplace.checkout.payment.buy.free",defaultMessage:"Add"}}),Ie=(0,m().YK)({paymentError:{id:"marketplace.payment.error",defaultMessage:"An error occurred while processing your payment. {error}"},duplicationError:{id:"marketplace.payment.error.duplicationError",defaultMessage:"A error occurred duplication the template after your payment. Please refresh the page."}});function Te(e){const t=(0,l().v3)(),{displayInformation:a,alreadyOwned:r,price:c,acquisitionId:u,listingId:p,contacts:y}=e,g=(0,d().K8)((()=>"on"!==C().default.getEligibleGroup({experimentId:"marketplace_checkout_move_tc_checkbox",defaultGroup:"off"})),[]),P=(0,x().X)("enable_ai_personalization_marketplace"),L=(0,d().K8)((()=>{var e;const{sidebarSpaceViewStore:t}=v().default.state;return null==t||null===(e=t.getSettings())||void 0===e?void 0:e.agent_personalization_settings}),[]),H=(0,d().K8)((()=>C().default.getConfigKey("marketplace_redirect_url_after_purchase_config",p)),[p]),$=(0,d().K8)((()=>U().A.state.address),[]),G=(0,d().K8)((()=>U().A.state.discountedPrice),[]),Z=(0,d().K8)((()=>U().A.state.coupon),[]),X=(0,d().K8)((()=>U().A.state.allowCreatorToAddToMailingList),[]),J=(0,d().K8)((()=>U().A.state.agreedToTermsAndConditions),[]),ee=(0,d().K8)((()=>U().A.state.isTaxValid),[]),te=(0,d().K8)((()=>U().A.state.isCalculatingTax),[]),ae=(0,d().K8)((()=>h().A.state.teamStore),[]),ne=(0,d().K8)((()=>U().A.state.paymentType),[]),ie=(0,n().useStripe)(),oe=(0,n().useElements)(),re=(0,m().tz)(),[se,le]=(0,i.useState)(!1),[de,ce]=(0,i.useState)(!1),[ue,pe]=(0,i.useState)(!1),me=Me(),ye=(0,o().r)(),ge=(0,W().I)(),fe=(0,d().K8)((()=>{if(!u)return;return new(S().y)(t,{table:D().Ht,id:u}).getStatus()}),[u,t]),he=(0,d().K8)((()=>{const e=ge.slug;if(!e)return{isValid:!1};if(void 0!==O().K.state[e])return O().K.state[e];const a=(0,V().kz)({environment:t,sidebarSpaceId:ye,slug:ge.slug,intl:re});return O().K.setState({...O().K.state,[e]:a}),a}),[ge.slug,t,re,ye]);(0,i.useEffect)((()=>{se&&"succeeded"===fe&&(async()=>{if(!ge.slug)return k().f1(re.formatMessage(Ie.duplicationError)),void le(!1);H&&window.open(H,"_blank");const e=await V().xL({environment:t,slug:ge.slug,locale:(0,j().H)(re),acquisitionDestinationId:ye,sidebarSpaceId:ye,includeCategories:!0});if(e&&e.block_id){const r=new(b().B)(t,{table:_().ev,id:e.block_id}),l=h().A.state.from;if(f().zi(t),h().A.setState({...h().A.state,hasSuccessfullyPurchasedProduct:!0}),z().A.setState({...z().A.state,duplicationStatus:"duplicating"}),s().A.isMobile)return(0,V().uy)({environment:t,template:e,templateBlockStore:r,teamStore:ae,from:l,isMobile:!0}).then((()=>{z().A.setState({...z().A.state,duplicationStatus:"success"})})),void(E().A.state.open&&E().A.setState({...E().A.state,isCheckout:!1,item:{...E().A.state.item,marketplaceTemplateMetadata:{...E().A.state.item.marketplaceTemplateMetadata,userHasAcquiredTemplate:!0}}}));const d=(0,N().VT)(e)&&P;d&&F().L.setState({...F().L.state,isDuplicating:!0});const c=await(0,V().uy)({environment:t,template:e,templateBlockStore:r,teamStore:ae,from:l,isValidated:de,duplicationStartedToastProps:Pe(re),...d?{showDuplicationFinishedToast:!1,showDuplicationStartedToast:!1,duplicationStartedToastProps:{},durationMsBeforeShowingFinishedToast:2e3}:{}});if(z().A.setState({...z().A.state,duplicationStatus:"success"}),d&&c){var a;R().Mu({environment:t,newPageIdToAdd:c.id,contextPageId:c.id,agentName:null==L?void 0:L.name,customizationItems:null==L?void 0:L.customization_items});let r="";var n,i,o;null!==(a=e.attributes)&&void 0!==a&&a.icon&&(r=(0,w().T8)(null===(n=e.attributes)||void 0===n?void 0:n.icon)?null===(i=e.attributes)||void 0===i?void 0:i.icon:(null===(o=e.attributes)||void 0===o?void 0:o.emoji)??""),F().L.setState({...F().L.state,templateName:e.name,templateIcon:r,isDuplicating:!1,isDuplicatingFinished:!0,newPageBlockStore:c})}}le(!1)})()}),[fe,se,ge.slug,ae,ye,re,t,H,P,L,de]);const Ae=(0,i.useMemo)((()=>!se&&ee&&ue&&!te),[se,ee,ue,te]),xe=(0,i.useCallback)((async e=>{var n;let i;e.preventDefault();const o=!J&&g,s="required"===a.emailRequirement&&!X,l={listingId:p,acquisitionId:u,sidebarSpaceId:ye};if(o||s)return M().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Terms and conditions or mailing list error",data:{miscDataToConvertToString:{...l,showTermsAndConditionsError:o,allowCreatorToAddToMailingListError:s}}}),void U().A.setState({...U().A.state,showTermsAndConditionsError:o,allowCreatorToAddToMailingListError:s});if(!oe)return void M().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"No Stripe elements found.",data:{miscDataToConvertToString:{...l}}});if(!ie)return void M().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"No stripe instance found.",data:{miscDataToConvertToString:{...l}}});if(!ye)return void M().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"No spaceId found.",data:{miscDataToConvertToString:{...l}}});if(!$)return void M().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"No Stripe address found or invalid input.",data:{miscDataToConvertToString:{...l}}});if(r)return void M().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Customer already owns this product for the workspace.",data:{miscDataToConvertToString:{...l}}});if(!Ae&&0!==G)return void M().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Attempted payment without enabled payment.",data:{miscDataToConvertToString:{...l,isTaxValid:ee,isPaymentElementComplete:ue,isCalculatingTax:te,isPaying:se}}});if("card"!==ne){const e=oe.getElement("address");if(e){const t=await e.getValue();if(!t.complete)return void M().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Google/Apply Pay attempt with incomplete address",data:{miscDataToConvertToString:{...l,addressValue:t}}})}}if("card"===ne){const e=0!==G?await oe.submit():{};if(e.error)return void M().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Element submit error",data:{miscDataToConvertToString:{...l,elementSubmitResponse:e}}})}U().A.setState({...U().A.state,showTermsAndConditionsError:!1}),le(!0);try{if(!(await he).isValid)return le(!1),M().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Template content validation failed",data:{miscDataToConvertToString:{...l}}}),void k().f1(re.formatMessage({id:"marketplace.payment.error.templateValidationFailed",defaultMessage:"Unable to purchase template."}))}catch(i){return le(!1),M().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Template content validation error",data:{miscDataToConvertToString:{...l}}}),void k().f1(re.formatMessage({id:"marketplace.payment.error.templateValidationFailed",defaultMessage:"Unable to purchase template."}))}ce(!0),f().mM({environment:t,emailRequirement:a.emailRequirement});const d=await K().callApi({eventName:"confirmProductPurchase",environment:t,data:{productId:p,listingId:p,address:$,spaceId:ye,allowCreatorToAddToMailingList:X,couponCode:Z}});if("failed"===d.type)return le(!1),M().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Confirm product purchase failed.",data:{miscDataToConvertToString:{...l,address:$,coupon:Z,result:d}}}),void k().f1((0,A().H)(re,d));let c,m;if(d.data.intentClientSecret){if(await oe.submit(),c=await ie.confirmPayment({elements:oe,clientSecret:d.data.intentClientSecret,confirmParams:{return_url:window.location.href,expand:["amount"]},redirect:"if_required"}),void 0!==c.error)i=c.error,m="Stripe confirm payment error";else if("requires_action"===c.paymentIntent.status){const e=await ie.handleNextAction({clientSecret:c.paymentIntent.client_secret??""});void 0!==e.error&&(i=e.error,m="Stripe handle next action error")}void 0!==i&&void 0!==m&&(M().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:m,data:{miscDataToConvertToString:{...l,error:i}}}),(0,I().c)(t,{error:i.code,stripe_decline_code:i.decline_code}),k().f1(re.formatMessage(Ie.paymentError,{error:(0,q().translateStripeError)(re,i)})),le(!1))}f().Il({environment:t,success:void 0===i,emailRequirement:a.emailRequirement,transactionValue:null===(n=c)||void 0===n||null===(n=n.paymentIntent)||void 0===n?void 0:n.amount,error:i})}),[ie,oe,r,$,ye,G,a.emailRequirement,X,t,p,Ae,J,re,Z,ne,g,u,te,se,ue,ee,he]),Ce=(0,i.useMemo)((()=>(0,B().sg)(xe,2e3,{leading:!0,trailing:!1})),[xe]),ke=async e=>{if(!oe||r)return;const a=function(e){return{zipCode:e.postal_code??"",country:e.country??"",addressLine1:e.line1??"",city:e.city??"",state:e.state??""}}(e.value.address);B().n4(a,$)||((0,T().Z)(a)&&c?await f().wx({environment:t,acquisitionId:u,address:a,elements:oe}):U().A.setState({...U().A.state,address:a,isTaxValid:!1,isCalculatingTax:!1}))};return s().A.isMobile?(0,Y.jsx)(we,{displayInformation:a,alreadyOwned:r,onAddressChange:ke,contacts:y??[],setIsPaymentElementComplete:pe,isPaying:se,listingId:p,acquisitionId:u,price:c??0,onSubmit:Ce,isTCCheckboxEnabled:g}):(0,Y.jsxs)("div",{style:me.contentContainer,children:[r?null:(0,Y.jsx)(Q,{onAddressChange:ke,contacts:y??[],setIsPaymentElementComplete:pe,isPaying:se}),(0,Y.jsx)(ve,{acquisitionId:u,displayInformation:a,alreadyOwned:r,price:c??0,isPaying:se,onSubmit:Ce,productListingId:p,isTCCheckboxEnabled:g})]})}function Me(){const{isMobileWidth:e,isTabletWidth:t,isLowResolutionTabletWidth:a}=(0,g().LS)(),n=s().A.isMobile?e||t:e||a;return(0,c().IS)((()=>({contentContainer:{display:"flex",gap:32,flexDirection:n?"column":"row"},mobileContentContainer:{position:"sticky",bottom:-40,display:"flex",flexDirection:"column",gap:8,background:L().Tj.popoverBackground,borderTop:"1px solid lightgray",paddingTop:16,minHeight:124}})),[n])}function we(e){const{displayInformation:t,alreadyOwned:a,onAddressChange:n,contacts:i,setIsPaymentElementComplete:o,isPaying:r,listingId:s,acquisitionId:l,price:d,onSubmit:c,isTCCheckboxEnabled:u}=e,p=Me();return(0,Y.jsxs)("div",{style:p.contentContainer,children:[(0,Y.jsx)(ae,{productInformation:t}),a?null:(0,Y.jsx)(Q,{onAddressChange:n,contacts:i??[],setIsPaymentElementComplete:o,isPaying:r}),(0,Y.jsx)(Ae,{productListingId:s,acquisitionId:l,price:d??0,isPaying:r}),(0,Y.jsx)(xe,{displayInformation:t,listingId:s,isTCCheckboxEnabled:u}),(0,Y.jsx)("div",{style:p.mobileContentContainer,children:(0,Y.jsx)(ke,{onSubmit:c,price:d??0,isPaying:r})})]})}function Pe(e){return{iconGroup:P().z,iconGroupColorPalette:"green",iconGroupColorVariant:"accentPrimary",iconGroupVariant:"default",title:e.formatMessage({id:"inApp.marketplace.checkout.payment.success.duplication.started.title",defaultMessage:"Purchase successful"}),message:e.formatMessage({id:"inApp.marketplace.checkout.payment.success.duplication.started.message",defaultMessage:"The template is being added to your workspace. We will let you know when it’s ready to use."})}}function je(){const e=(0,l().v3)(),t=(0,m().tz)(),a=(0,c().IS)((()=>({modalContentContainer:{minHeight:400,maxHeight:850,display:"flex",padding:"32px",flexDirection:"column",gap:24,borderRadius:12,position:"relative",overflow:"auto"},headingContainer:{display:"flex",flexDirection:"column",gap:2}})),[]),i=(0,n().useElements)(),v=(0,d().K8)((()=>{var e;return null===(e=(0,r().S)())||void 0===e?void 0:e.getName()}),[]),A=(0,o().r)(),x=(0,d().K8)((()=>h().A.state.marketplaceListingId),[]),[C]=(0,p().Yb)((async()=>{if(!A||!i)return;if(!x||!(0,y().uj)(x))return;const a=await f().y$({environment:e,listingId:x,spaceId:A,intl:t});if(a&&(h().A.setState({...h().A.state,creatorId:a.creatorId,customerId:a.customerId}),f().Ix({environment:e,emailRequirement:a.displayInformation.emailRequirement})),a&&!a.alreadyOwned&&0!==a.contacts.length&&a.acquisitionId){const t=a.contacts[0],n={zipCode:t.address.postal_code??"",country:t.address.country??"",addressLine1:t.address.line1??"",city:t.address.city??"",state:t.address.state??""};await f().wx({environment:e,elements:i,address:n,acquisitionId:a.acquisitionId})}return a}),[A,e,x,t,i]),k=C.value;if(!x||!(0,y().uj)(x))return null;if(!k)return null;const{displayInformation:b,alreadyOwned:S,acquisitionId:I}=k,T=k.alreadyOwned?void 0:k.price,M=k.alreadyOwned?void 0:k.contacts;return(0,Y.jsxs)("div",{style:a.modalContentContainer,children:[(0,Y.jsxs)("div",{style:a.headingContainer,children:[(0,Y.jsx)(u().D,{styleKey:"titleXlBold",colorVariant:"primary",children:(0,Y.jsx)(m().sA,{id:"inApp.marketplace.checkout.modal.header",defaultMessage:"Checkout"})}),void 0!==v?(0,Y.jsx)(u().D,{styleKey:"titleSmRegular",colorVariant:"secondary",children:s().A.isMobile?(0,Y.jsx)(m().sA,{id:"inApp.marketplace.checkout.modal.mobile.subheader",defaultMessage:"This template will be added to your Private space within {spaceName}",values:{spaceName:v}}):(0,Y.jsx)(m().sA,{id:"inApp.marketplace.checkout.modal.subheader",defaultMessage:"This template is being added to {spaceName}",values:{spaceName:v}})}):void 0]}),(0,Y.jsx)(g().KF,{throttle:100,lowResolutionTabletUpperBound:760,children:(0,Y.jsx)(Te,{listingId:x,displayInformation:b,acquisitionId:I,alreadyOwned:S,price:T,contacts:M})})]})}},42905:(e,t,a)=>{a.d(t,{L:()=>i});class n extends(()=>a(757695))().Store{getInitialState(){return{templateName:"",templateIcon:"",newPageBlockStore:void 0,isDuplicating:!1,isDuplicatingFinished:!1}}clearState(){this.setState({...this.getInitialState()})}}const i=new n},78219:(e,t,a)=>{a.d(t,{A:()=>i});class n extends(()=>a(757695))().Store{getInitialState(){return{duplicationStatus:null}}}const i=new n},146423:(e,t,a)=>{a.d(t,{A:()=>i});class n extends(()=>a(757695))().Store{getInitialState(){return{address:{addressLine1:"",city:"",state:"",country:"",zipCode:""},allowCreatorToAddToMailingList:!1,allowCreatorToAddToMailingListError:!1,taxAmount:0,taxAmountWithDiscount:0,discountedPrice:void 0,discount:void 0,coupon:"",agreedToTermsAndConditions:!1,showTermsAndConditionsError:!1,isCouponInvalid:!1,isCouponApplied:!1,isCalculatingTax:!1,isTaxValid:!1,invalidCouponReason:"",paymentType:"card"}}}const i=new n},202106:(e,t,a)=>{a.d(t,{$D:()=>o,IT:()=>r,t6:()=>s});var n=()=>a(643819),i=()=>a(370441);function o(e){const{taxAmount:t,price:a,currencyCode:i}=e,o=new(n().W)(i,t);return new(n().W)(i,a).plus(o)}function r(e,t){return{appearance:(0,i().getLegacyStripeAppearance)(e),mode:"payment",currency:"usd",amount:1e3,paymentMethodTypes:["card"],setupFutureUsage:"on_session",locale:(0,i().stripeElementLocaleGivenNotionLocale)(t)}}function s(e){return"card"===e||"google_pay"===e||"apple_pay"===e}},212782:(e,t,a)=>{a.d(t,{K:()=>i});class n extends(()=>a(757695))().Store{getInitialState(){return{}}clearState(){this.setState({})}}const i=new n},345737:(e,t,a)=>{a.d(t,{A:()=>i});class n extends(()=>a(757695))().Store{getInitialState(){return{isModalOpen:!1,marketplaceListingId:"",teamStore:void 0,hasSuccessfullyPurchasedProduct:!1,templateId:"",creatorId:"",customerId:""}}}const i=new n},387292:(e,t,a)=>{a.d(t,{Sf:()=>r,UY:()=>d,ft:()=>s,mm:()=>o,vU:()=>c,wg:()=>l});var n=()=>a(675133);const i=(0,a(69708).YK)({selectPriceFilterAll:{id:"inApp.marketplace.template.filter.price.all",defaultMessage:"Free + Paid"},selectPriceFilterPaid:{defaultMessage:"Paid",id:"inApp.marketplace.template.filter.price.paid"},selectPriceFilterFree:{defaultMessage:"Free",id:"inApp.marketplace.template.filter.price.free"},selectMadeByAll:{id:"inApp.marketplace.template.filter.madeBy.all",defaultMessage:"Notion + Creators"},selectMadeByNotion:{id:"inApp.marketplace.template.filter.madeBy.notion",defaultMessage:"Notion"},selectMadeByCreators:{id:"inApp.marketplace.template.filter.madeBy.creators",defaultMessage:"Creators"},selectSortValueRecent:{defaultMessage:"Most Recent",id:"inApp.marketplace.template.sort.recent"},selectSortValueDuplication:{defaultMessage:"Duplications",id:"inApp.marketplace.template.sort.duplication"},selectSortValuePopular:{defaultMessage:"Popular",id:"inApp.marketplace.template.sort.popular"},qualificationValueAllCreators:{defaultMessage:"All creators",id:"inApp.marketplace.creator.qualification.allCreators"},qualificationValueNotionRecommended:{defaultMessage:"Notion recommended",id:"inApp.marketplace.creator.qualification.notionRecommended"},qualificationValueCertifiedConsultants:{defaultMessage:"Certified consultants",id:"inApp.marketplace.creator.qualification.certifiedConsultants"},creatorSelectSortValueMostDuplicated:{defaultMessage:"Most duplicated",id:"inApp.marketplace.creator.sort.mostDuplicated"},creatorSelectSortValueMostTemplates:{defaultMessage:"Most templates",id:"inApp.marketplace.creator.sort.mostTemplates"},creatorSelectSortValueAlphabetical:{defaultMessage:"Alphabetical",id:"inApp.marketplace.creator.sort.alphabetical"},selectAllLocales:{defaultMessage:"English + {userLocale}",id:"inApp.marketplace.template.filter.locale.all"},selectUserLocale:{defaultMessage:"{userLocale}",id:"inApp.marketplace.template.filter.locale.user"}}),o=[{value:n().A.formatMessage(i.selectPriceFilterAll),key:"all"},{value:n().A.formatMessage(i.selectPriceFilterPaid),key:"paid"},{value:n().A.formatMessage(i.selectPriceFilterFree),key:"free"}],r=[{value:n().A.formatMessage(i.selectMadeByAll),key:"all"},{value:n().A.formatMessage(i.selectMadeByNotion),key:"notion"},{value:n().A.formatMessage(i.selectMadeByCreators),key:"community"}],s=[{value:n().A.formatMessage(i.selectSortValuePopular),key:"popular"},{value:n().A.formatMessage(i.selectSortValueRecent),key:"recent"},{value:i.selectSortValueDuplication.defaultMessage,key:"duplications"}],l=[{value:n().A.formatMessage(i.qualificationValueAllCreators),key:"all"},{value:n().A.formatMessage(i.qualificationValueNotionRecommended),key:"notion_recommended"},{value:n().A.formatMessage(i.qualificationValueCertifiedConsultants),key:"certified"}],d=[{value:n().A.formatMessage(i.creatorSelectSortValueMostDuplicated),key:"number_of_duplicates"},{value:n().A.formatMessage(i.creatorSelectSortValueMostTemplates),key:"number_of_templates"},{value:n().A.formatMessage(i.creatorSelectSortValueAlphabetical),key:"alphabetical"}];function c(e){return[{value:n().A.formatMessage(i.selectAllLocales,{userLocale:e}),key:"english_and_user_locale"},{value:n().A.formatMessage(i.selectUserLocale,{userLocale:e}),key:"user_locale"}]}},396990:(e,t,a)=>{a.d(t,{A:()=>i});class n extends(()=>a(757695))().Store{getInitialState(){return{isOpen:!1}}open(e){this.setState({isOpen:!0,...e})}submit(){var e,t;null===(e=(t=this.state).onSubmit)||void 0===e||e.call(t,!0),this.setState({isOpen:!1})}skip(){var e,t;null===(e=(t=this.state).onSubmit)||void 0===e||e.call(t,!1),this.setState({isOpen:!1})}cancel(){this.setState({isOpen:!1})}}const i=new n},462842:(e,t,a)=>{a.d(t,{H4:()=>v,Il:()=>x,Ix:()=>h,Ks:()=>g,Rv:()=>m,mM:()=>A,wx:()=>f,y$:()=>y,zi:()=>p});a(814603),a(147566),a(198721);var n=()=>a(564884),i=()=>a(314709),o=()=>a(675133),r=()=>a(792057),s=()=>a(165358),l=()=>a(769864),d=()=>a(246766),c=()=>a(146423),u=()=>a(345737);function p(e){u().A.setState({...u().A.state,isModalOpen:!1,marketplaceListingId:void 0,from:void 0});const t=new URL(window.location.href);t.searchParams.delete("checkout"),t.searchParams.delete("coupon"),t.searchParams.delete("from"),(0,d().navigate)({environment:e,url:t.toString()})}function m(e){const t=new URL(window.location.href);t.searchParams.append("checkout","true"),(0,d().navigate)({environment:e,url:t.toString()})}async function y(e){const{environment:t,listingId:a,spaceId:n,intl:o}=e,s=await l().callApi({eventName:"initiateProductPurchase",environment:t,data:{productId:a,listingId:a,spaceId:n}});if("success"===s.type)return s.data;p(t),r().f1((0,i().H)(o,s))}async function g(e){const{coupon:t,productListingId:a,environment:n}=e,r=o().A.getIntl();try{c().A.setState({...c().A.state,invalidCouponReason:""});const e=await l().callApi({eventName:"calculatePriceWithMarketplaceCoupon",environment:n,data:{productListingId:a,couponCode:t}});if("success"===e.type)return{discount:e.data.discount,discountedPrice:e.data.discountedPrice};{const t=(0,i().H)(r,e);c().A.setState({...c().A.state,invalidCouponReason:t})}}catch(s){c().A.setState({...c().A.state,invalidCouponReason:r.formatMessage({id:"inApp.marketplace.checkout.coupon.invalid",defaultMessage:"Something went wrong, please try again."})})}}async function f(e){const{address:t,acquisitionId:a,elements:n,environment:i}=e,o=c().A.state.discountedPrice,r=c().A.state.coupon;let s=0,d=0;c().A.setState({...c().A.state,isTaxValid:!1,isCalculatingTax:!0});const u=await l().callApi({eventName:"calculateMarketplaceTax",environment:i,data:{address:t,acquisitionId:a,couponCode:r}});if("success"===u.type&&u.data.valid){s=u.data.taxAmount,d=u.data.taxAmountWithCoupon??0;0!==(void 0!==o?u.data.totalAmountWithCoupon:u.data.totalAmount)&&n.update({amount:void 0!==o?u.data.totalAmountWithCoupon:u.data.totalAmount}),c().A.setState({...c().A.state,address:t,taxAmount:s,taxAmountWithDiscount:d,isTaxValid:!0,isCalculatingTax:!1})}}function h(e){const{environment:t,emailRequirement:a}=e,i=u().A.state;if(i.creatorId&&i.customerId&&i.marketplaceListingId&&i.templateId){const e={creator_id:i.creatorId,template_id:i.templateId,listing_id:i.marketplaceListingId,customer_id:i.customerId,email_requirement:a};(0,n().u)({environment:t,event:{eventName:"marketplace_checkout_open",eventProperties:e}})}}function v(e){const{environment:t,coupon:a}=e,i=u().A.state;if(i.creatorId&&i.customerId&&i.marketplaceListingId&&i.templateId){const e={creator_id:i.creatorId,template_id:i.templateId,listing_id:i.marketplaceListingId,customer_id:i.customerId,coupon:a};(0,n().u)({environment:t,event:{eventName:"marketplace_coupon_apply",eventProperties:e}})}}function A(e){const{environment:t,emailRequirement:a}=e,i=u().A.state,o=c().A.state;if(i.creatorId&&i.customerId&&i.marketplaceListingId&&i.templateId&&o.paymentType){const e={creator_id:i.creatorId,template_id:i.templateId,listing_id:i.marketplaceListingId,customer_id:i.customerId,payment_method:o.paymentType,email_requirement:a};(0,n().u)({environment:t,event:{eventName:"marketplace_payment_initiated",eventProperties:e}}),s().log({level:"info",from:"marketplaceCheckoutActions",type:"marketplacePaymentInitiated",data:{miscDataToConvertToString:{...e}}})}}function x(e){const{environment:t,success:a,emailRequirement:i,transactionValue:o,error:r}=e,l=u().A.state,d=c().A.state;if(l.creatorId&&l.customerId&&l.marketplaceListingId&&l.templateId&&d.paymentType){const e={creator_id:l.creatorId,template_id:l.templateId,listing_id:l.marketplaceListingId,customer_id:l.customerId,payment_method:d.paymentType,email_requirement:i,transaction_value:o,success:a};(0,n().u)({environment:t,event:{eventName:"marketplace_payment_completed",eventProperties:e}})}a?s().log({level:"info",from:"marketplaceCheckoutActions",type:"marketplacePaymentCompletedSuccess",data:{miscDataToConvertToString:{creator_id:l.creatorId,template_id:l.templateId,listing_id:l.marketplaceListingId,customer_id:l.customerId,payment_method:d.paymentType,email_requirement:i,success:a}}}):s().log({level:"error",from:"marketplaceCheckoutActions",type:"marketplacePaymentCompletedFailure",data:{miscDataToConvertToString:{error:r,creator_id:l.creatorId,template_id:l.templateId,listing_id:l.marketplaceListingId,customer_id:l.customerId,payment_method:d.paymentType,email_requirement:i,success:a}}})}},465039:(e,t,a)=>{a.d(t,{KF:()=>d,LS:()=>l});a(16280);var n=a(296540),i=()=>a(401497),o=()=>a(981305),r=a(474848);const s=(0,n.createContext)({screenWidthType:"desktop",isMobileWidth:!1,isLowResolutionTabletWidth:!1,isDesktopWidth:!1,isTabletWidth:!1});function l(){const e=(0,n.useContext)(s);if(!e)throw new Error("ScreenWidthContext not found. Please make sure this is used within a ScreenWidthContext.Provider.");return e}function d(e){const{children:t,mobileUpperBound:a=550,lowResolutionTabletUpperBound:l=720,tabletUpperBound:d=1024,throttle:c=0}=e,u=(0,n.useRef)(null),p=(0,i().IS)((()=>({sizeObserverContainer:{width:"100%",height:0,position:"absolute"}})),[]),[m,y]=(0,n.useState)("desktop"),g=(0,n.useCallback)((e=>{e.state.width<=a?y("mobile"):e.state.width>a&&e.state.width<=l?y("lowResolutionTablet"):e.state.width>l&&e.state.width<=d?y("tablet"):y("desktop")}),[a,l,d]);(0,o().B)(u,g,c);const f="mobile"===m,h="desktop"===m,v="tablet"===m,A="lowResolutionTablet"===m,x=n.useMemo((()=>({screenWidthType:m,isMobileWidth:f,isLowResolutionTabletWidth:A,isDesktopWidth:h,isTabletWidth:v})),[m,f,A,h,v]);return(0,r.jsxs)(s.Provider,{value:x,children:[(0,r.jsx)("div",{ref:u,style:p.sizeObserverContainer}),t]})}s.displayName="ScreenWidthContext"},538550:(e,t,a)=>{a.d(t,{z:()=>n});const n=(0,a(340498).xh)("checkStack",{default:{loader:()=>a.e(92905).then(a.bind(a,166292))},small:{loader:()=>a.e(92905).then(a.bind(a,560722))},fill:{loader:()=>a.e(92905).then(a.bind(a,412558))},fillSmall:{loader:()=>a.e(92905).then(a.bind(a,274621))}},["Cards","tasks","completed","pile","stack"])},570882:(e,t,a)=>{a.d(t,{I:()=>o});var n=()=>a(484714),i=()=>a(590526);function o(){const e=(0,n().v3)();return(0,i().K8)((()=>{const{RouterStore:t}=e;return t.state.route}),[e])}},935774:(e,t,a)=>{a.d(t,{$H:()=>u,BZ:()=>x,Bf:()=>p,CX:()=>b,FN:()=>C,H6:()=>S,P9:()=>m,TM:()=>y,VT:()=>I,dc:()=>d,zG:()=>k,zn:()=>c});a(944114),a(517642),a(658004),a(733853),a(845876),a(432475),a(515024),a(731698),a(898992),a(354520),a(581454),a(737550),a(814603),a(147566),a(198721);var n=()=>a(726637),i=()=>a(427704),o=()=>a(679927),r=()=>a(496603),s=()=>a(534177),l=()=>a(387292);const d={madeBy:["notion","community"],paid:["paid","free"],orderBy:"popular",locales:"english_and_user_locale"};function c(e){const{madeBy:t,paid:a,orderBy:n,locales:i}=e;return{madeBy:A("madeBy",t)?[t]:["notion","community"],paid:A("paid",a)?[a]:["paid","free"],orderBy:A("orderBy",n)?n:"popular",locales:A("locales",i)?i:"english_and_user_locale"}}function u(e){const{madeBy:t,paid:a,orderBy:n,locales:i}=e;return{madeBy:(null==t?void 0:t.split("+"))??[],paid:(null==a?void 0:a.split("+"))??[],orderBy:A("orderBy",n)?n:"popular",locales:A("locales",i)?i:"english_and_user_locale"}}function p(e){return(null==e?void 0:e.split(","))??[]}function m(e){return(null==e?void 0:e.split(","))??[]}function y(e){const{slug:t,filters:a,allowMultiple:o}=e,r=new URL(`${n().A.domainBaseUrl}${i().JZ.marketplace}/categories/${encodeURIComponent(t)}`);if(a){const{selectedCategorySlugs:e,templateCategoryFilters:t,selectedGroupedCategorySlugs:n}=a;0!==e.length&&r.searchParams.append("tags",e.toString()),0!==n.length&&r.searchParams.append("groupedTags",n.toString()),"popular"!==t.orderBy&&r.searchParams.append("orderBy",encodeURIComponent(t.orderBy)),"english_and_user_locale"!==t.locales&&r.searchParams.append("locales",encodeURIComponent(t.locales)),o?(t.madeBy.length>0&&r.searchParams.append("madeBy",encodeURIComponent(t.madeBy.join("+").toString())),t.paid.length>0&&r.searchParams.append("paid",encodeURIComponent(t.paid.join("+").toString()))):(1===t.madeBy.length&&r.searchParams.append("madeBy",encodeURIComponent(t.madeBy[0].toString())),1===t.paid.length&&r.searchParams.append("paid",encodeURIComponent(t.paid[0].toString())))}return r.toString()}const g=["notion","community"],f=["paid","free"],h=["duplications","recent"],v=["english_and_user_locale","user_locale"];function A(e,t){if(void 0===t)return!1;switch(e){case"madeBy":return"all"!==t&&g.includes(t);case"orderBy":return h.includes(t);case"paid":return"all"!==t&&f.includes(t);case"locales":return v.includes(t);default:(0,s().HB)(e)}}function x(e,t,a){const n=r().qI(t.map((e=>e.categories))).map((e=>e.slug)),i=e.filter((e=>!n.includes(e.slug))),o=new Set,s=e=>{const t=[];for(const n of e)if(!o.has(n.slug))if(o.add(n.slug),a.includes(n.slug)){const e=i.filter((e=>{var t;return null===(t=n.subcategory_contentful_ids_v2)||void 0===t?void 0:t.includes(e.contentful_id)}));t.push({...n,subcategories:s(e)})}else t.push(n);return t};return s(i)}Date.now(),Date.now(),Date.now();const C="white";function k(e){if(e){for(const t of e)if(t.attributes.color)return t.attributes.color;return C}}const b=l().mm.filter((e=>"all"!==e.key)),S=l().Sf.filter((e=>"all"!==e.key));function I(e){var t;return Boolean(null===(t=e.categories)||void 0===t?void 0:t.some((e=>e.contentful_id===o().pm)))}}}]);