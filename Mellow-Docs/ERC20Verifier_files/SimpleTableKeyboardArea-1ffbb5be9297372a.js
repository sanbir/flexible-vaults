"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[38707],{448801:(e,t,n)=>{n.d(t,{i:()=>r});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);var o=()=>n(371562);o();function r(e,t){const n=o().create({arrays:{detectMove:!1,includeValueOnMove:!0}}).diff(e,t);if(!n)return{beforeOps:{},removeOps:new Set};let r=[],i=[];for(const o in n)"_t"!==o&&("_"===o[0]?r.push(parseInt(o.slice(1),10)):1===n[o].length&&i.push({index:parseInt(o,10),value:n[o][0]}));const l={},a=new Set,c=[...e];r=r.sort(((e,t)=>e-t));for(let o=r.length-1;o>=0;o--){const e=r[o],t=c.splice(e,1)[0];a.add(t)}i=i.sort(((e,t)=>e.index-t.index));for(let o=0;o<i.length;o++){const e=i[o];l[e.value]=c[e.index],c.splice(e.index,0,e.value)}return{beforeOps:l,removeOps:a}}},482871:(e,t,n)=>{n.d(t,{z:()=>d});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(430670),n(581454);var o=()=>n(770063),r=()=>n(898244),i=()=>n(448801),l=()=>n(179034),a=()=>n(722101),c=(n(354520),()=>n(496603));function s(e){const{collectionContextStore:t,collectionViewStore:n,transaction:i}=e,s=n.getPageSortStore(),d=s.getValue(),u=t.groupsStore.getAllGroupStates(),m=function(e){const{pageSort:t,currentResults:n}=e;if(!t||t.length<=r().WF)return[];const o=t.filter((e=>!n.has(e)));return c().sb([...o.reverse(),...c().o8(t).reverse()]).slice(0,t.length-r().WF)}({pageSort:d,currentResults:new Set(u.flatMap((e=>e.resultsStore.state.map((e=>e.id)))))});for(const r of m)a().TF({parentStore:s,childToRemoveStore:(0,o().v3)(s,{table:l().ev,id:r}),transaction:i})}function d(e){const{resultIds:t,collectionViewStore:n,collectionContextStore:c,transaction:d}=e,u=n.getPageSortStore(),m=u.getValue()||[],{beforeOps:p}=(0,i().i)(m,t.slice(0,r().WF));for(const[r,i]of Object.entries(p))if(i){const e=(0,o().v3)(n,{table:l().ev,id:i});a().nc({parentStore:u,insertStore:(0,o().v3)(n,{table:l().ev,id:r}),beforeStore:e,transaction:d})}else{const e=t.findIndex((e=>e===r)),i=t[e-1],c=i?(0,o().v3)(n,{table:l().ev,id:i}):void 0;a().WH({parentStore:u,insertStore:(0,o().v3)(n,{table:l().ev,id:r}),afterStore:c,transaction:d})}s({collectionContextStore:c,collectionViewStore:n,transaction:d})}},491848:(e,t,n)=>{n.d(t,{w:()=>r});n(898992),n(672577);var o=()=>n(541199);function r({collectionContextStore:e,transaction:t}){const n="collectionTypedView"===e.contextTypeFromStoreState,r=e.databaseTypeFromStoreState,i=e.collectionStoresStore.state,l=i.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly()))||i[0];!n&&l&&(0,o().e)({transaction:t,databaseType:r,collectionId:l.id,spaceId:l.getSpaceId()})}},766854:(e,t,n)=>{n.d(t,{H:()=>h,Q:()=>T});n(898992),n(672577);var o=()=>n(230711),r=()=>n(907258),i=()=>n(135168),l=()=>n(242422),a=()=>n(929219),c=()=>n(711339),s=()=>n(295633),d=()=>n(700500),u=()=>n(179034),m=()=>n(201980),p=()=>n(384944),f=()=>n(649813),v=()=>n(390650),S=()=>n(381678),b=()=>n(622811),C=()=>n(491848),g=()=>n(482871);function y(e,t,n){const r=(0,S()._)(e),i=null==r?void 0:r.id;if(!i||!n)return;if(!l().default.checkGate({gateName:"full_access_for_created_collection_pages"}))return;if(t.canAdmin())return;const a=t.getSpaceStore();return a&&(0,o().dp)(a,i).isMember()?[{role:"editor",type:"user_permission",user_id:i}]:void 0}function T(e){const{collectionContextStore:t,transaction:n}=e;return(0,C().w)({collectionContextStore:t,transaction:n}),h(e)}function h(e){var t,n,o;const{environment:S,collectionContextStore:C,groupsPointer:T,insertAtIndex:h,shouldCoerce:x,templateStore:A,transaction:k,from:w,tracker:_,inMemoryRecordCache:O,isKeyboard:E,title:D}=e,I=c().default.DO_NOT_USE_markLegacy("collections.add_item_lag");c().default.DO_NOT_USE_measureAfterNextFlushLegacy(I,{environment:S,getData:()=>({...v().kz(C),from:w.createBlock})});const R="collectionTypedView"===C.contextTypeFromStoreState,P=C.databaseTypeFromStoreState,U=C.collectionStoresStore.state,M=U.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly()))||U[0],F=null===(t=(0,i().f)(M))||void 0===t?void 0:t.id,K=r().default.state.currentUserSettingsStore,V=R&&P&&F&&K&&[...K.getAllPreferredCollections(F),...K.getPreferredCollectionsOfType(F,P)]||[];let G;const B=T[0];if("group_header"===w.createBlock&&"location"===B.value.type){const e=B.value.value;if(e){G=U.find((t=>t.id===e.id&&(t.canEdit()||t.canEditCollection()||t.canEditContentOnly())))}}else G=function(e,t){for(const n of e){const e=t.find((e=>e.id===n&&(e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));if(e)return e}}(V,U);const J=G??M,N=null==J?void 0:J.getSpaceId(),W=C.collectionViewStore(),$=C.getViewType(),j=p().Wv({environment:S,type:d().xd.page,inMemoryRecordCache:O,transaction:k,spaceId:N,tracker:_,permissions:y(S,J,N),properties:{title:(0,m().x9d)(D)}});if(!J||!W||!$)return{coercionSucceeded:!0,newStore:j};const L=null===(n=C.groupsStore.getGroupState(T))||void 0===n?void 0:n.groupUiParentStore;if(!L)return{coercionSucceeded:!0,newStore:j};const z=s().B.createChildStore(L,{table:u().ev,id:j.id});A&&a().A.state.online&&f().TB({title:"template",environment:S,store:j,templateStore:A,isKeyboard:E??!1,isCreateIn:!1,transaction:k,from:w.initCollection??"collection_group_actions"});const H=(0,b().j)({environment:S,store:j,collectionStore:J,collectionContextStore:C,groupsPointer:T,shouldCoerce:x,transaction:k}),Q=(null===(o=C.groupsStore.getGroupState(T))||void 0===o||null===(o=o.reducerResultStore.state)||void 0===o?void 0:o.blockIds)||[],Y=void 0!==h?h:Q.length,Z=C.permissionScopesStore.state;if((l().default.checkGate({gateName:"can_create_pages_in_collection_permission"})?Z.canCreatePagesInCollection:Z.canEditContent)||R){const e=[...Q.slice(0,Y),z.id,...Q.slice(Y)];(0,g().z)({resultIds:e,collectionViewStore:W,collectionContextStore:C,transaction:k})}return{coercionSucceeded:H,newStore:z}}},837841:(e,t,n)=>{n.r(t),n.d(t,{SimpleTableKeyboardArea:()=>O});var o=n(296540),r=()=>n(782482),i=()=>n(484714),l=()=>n(79926),a=()=>n(380745),c=()=>n(755125),s=()=>n(884107),d=()=>n(450510),u=()=>n(388723),m=()=>n(770703),p=()=>n(261534),f=()=>n(659602),v=()=>n(335722),S=()=>n(862292),b=()=>n(747674),C=()=>n(77272),g=()=>n(547149),y=()=>n(919878),T=()=>n(875827),h=(n(16280),()=>n(586481)),x=()=>n(404715),A=()=>n(709219);var k=()=>n(857048),w=()=>n(980914),_=n(474848);function O(e){const{store:t,children:n,selection:O,disabled:E,canEdit:D}=e,I=(0,i().v3)(),{value:R}=(0,l().fJ)(S().T.formulas),P=(0,o.useCallback)((e=>{e.preventDefault&&e.preventDefault(),y().$G({environment:I,direction:"left",bypassExistingTextSelection:!1,expandSelection:e.shiftKey})}),[I]),U=(0,o.useCallback)((e=>{e.preventDefault&&e.preventDefault(),y().$G({environment:I,direction:"right",bypassExistingTextSelection:!1,expandSelection:e.shiftKey})}),[I]),M=(0,o.useCallback)((e=>{e.preventDefault&&e.preventDefault(),y().b9({environment:I,direction:"up",bypassExistingTextSelection:!1,expandSelection:e.shiftKey})}),[I]),F=(0,o.useCallback)((e=>{e.preventDefault&&e.preventDefault(),y().b9({environment:I,direction:"down",bypassExistingTextSelection:!1,expandSelection:e.shiftKey})}),[I]),K=(0,o.useCallback)((e=>{e.preventDefault&&e.preventDefault();const t=A().A.state;if(t.isActive){const{selection:e,simpleTableStore:n}=t;w().kP(e)&&k().as({environment:I,rowIndex:e.start.row,columnIndex:e.start.col,simpleTableStore:n})}}),[I]),V=(0,o.useCallback)((e=>{var t;null===(t=e.preventDefault)||void 0===t||t.call(e);const n=A().A.state;if(!n.isActive)return;const{selection:o,simpleTableStore:r}=n;w().kP(o)&&o.end.row===x().yv(r)-1&&g().createAndCommit({userAction:"SimpleTableSelectionOverlay.handleShiftEnter",environment:I,canUndo:!0,perform:e=>{const t=o.end.row+1;y().Il({environment:I,transaction:e,index:t,simpleTableStore:r}),k().as({environment:I,rowIndex:t,columnIndex:o.start.col,simpleTableStore:r})}})}),[I]),G=(0,o.useCallback)((e=>{e.preventDefault&&e.preventDefault();const n=A().A.state;if(!n.isActive)return;const{selection:o,simpleTableStore:r}=n;k().wg()?(0,c().clear)({environment:I}):w().kP(o)?k().tb({environment:I,index:o.start.row,simpleTableStore:r}):(k().wr(),(0,b().t)({environment:I,stores:[t]}))}),[I,t]),B=(0,o.useCallback)((e=>{!E&&D&&g().createAndCommit({userAction:"SimpleTableSelectionOverlay.handleDelete",environment:I,canUndo:!0,perform:e=>{y()._Y({environment:I,transaction:e})}})}),[I,E,D]),J=(0,o.useCallback)((e=>{!E&&D&&(!e.key||e.metaKey||e.ctrlKey||(a().A.setKeyboardMode(!0),g().createAndCommit({userAction:"SimpleTableSelectionOverlay.handleKeypress",environment:I,canUndo:!0,perform:t=>{y().jJ({environment:I,editorMode:"default",transaction:t,key:e.key})}})))}),[I,E,D]),{value:N}=(0,l().fJ)(p().s),W=(0,o.useCallback)((e=>{const t=A().A.state;if(!t.isActive)return;const{selection:n,simpleTableStore:o}=t,r=x().$O(o);r&&m().A_({environment:I,simpleTableStore:o,selection:n,currentRows:o.getContentStores(),columnOrder:r,event:e,exportJsxRenderer:N,formulasModule:R})}),[I,N,R]),$=(0,o.useCallback)((e=>{!E&&D&&(W(e),g().createAndCommit({userAction:"SimpleTableSelectionOverlay.handleCut",environment:I,canUndo:!0,perform:e=>{T()._({environment:I,transaction:e})}}))}),[I,E,D,W]),{value:j}=(0,l().fJ)(f().g),{value:L}=(0,l().fJ)(v().S),{value:z}=(0,l().fJ)(s().R.clipboardActions),H=(0,o.useCallback)((e=>{if(E||!D||!z)return;const t=A().A.state;if(!t.isActive)return;const{selection:n,simpleTableStore:o}=t,r=x().$O(o);r&&g().createAndCommit({userAction:"SimpleTableSelectionOverlay.handlePaste",environment:I,canUndo:!0,perform:t=>{(0,u().G)({environment:I,simpleTableStore:o,selection:n,currentRows:o.getContentStores(),columnOrder:r,event:e,transaction:t,markdownLinkifyIt:j,tinyMceMicrosoftWordPasteFilter:L,clipboardActions:z})}})}),[I,E,D,j,L,z]),Q=(0,o.useCallback)((e=>{e.preventDefault();const t=A().A.state;t.isActive&&("cell"!==t.selection.type?y().kZ({environment:I}):g().createAndCommit({userAction:"SimpleTableSelectionOverlay.fillCellsDown",environment:I,canUndo:!0,perform:e=>{!function(e){const{environment:t,transaction:n}=e,o=A().A.state;if(!o.isActive)return;const{selection:r,simpleTableStore:i}=o,l=(0,x().$O)(i);if(!l)throw new Error("Missing simple table column order");const a=(0,d().hn)(r);if(a.maxRow-a.minRow+1<2)return;const c=i.getContentStores(),s=c[a.minRow];if(!s)return;const u={};for(let d=a.minCol;d<=a.maxCol;d++){const e=l[d];if(e){const t=s.getPropertyValue(e);u[e]=t}}for(let d=a.minRow+1;d<=a.maxRow;d++){const e=c[d];e&&h().C({environment:t,store:e,properties:u,transaction:n})}}({environment:I,transaction:e})}}))}),[I]),Y=(0,o.useCallback)((e=>{var t;const n=A().A.state;if(!n.isActive)return;const{selection:o}=n;if("cell"!==o.type)return;const r=(0,d().hn)(o);r.maxCol-r.minCol+1<2||(null===(t=e.preventDefault)||void 0===t||t.call(e),g().createAndCommit({userAction:"SimpleTableSelectionOverlay.handleFillRight",environment:I,canUndo:!0,perform:e=>{!function(e){const{environment:t,transaction:n}=e,o=A().A.state;if(!o.isActive)return;const{selection:r,simpleTableStore:i}=o,l=(0,x().$O)(i);if(!l)throw new Error("Missing simple table column order");const a=(0,d().hn)(r);if(a.maxCol-a.minCol+1<2)return;const c=l[a.minCol];if(!c)return;const s=i.getContentStores();for(let d=a.minRow;d<=a.maxRow;d++){const e=s[d];if(!e)continue;const o=e.getPropertyValue(c),r={};for(let t=a.minCol+1;t<=a.maxCol;t++){const e=l[t];e&&(r[e]=o)}h().C({environment:t,store:e,properties:r,transaction:n})}}({environment:I,transaction:e})}}))}),[I]),Z=(0,o.useCallback)(((e,n)=>{!E&&D&&(n.preventDefault(),g().createAndCommit({userAction:"SimpleTableSelectionOverlay.handleAnnotation",environment:I,canUndo:!0,perform:n=>{y().F8({environment:I,editorMode:"default",simpleTableStore:t,annotation:e,transaction:n})}}))}),[I,E,D,t]),q=(0,o.useCallback)((e=>Z(["h",C().A.getMostRecentlyUsedColor()],e)),[Z]),X=(0,o.useCallback)((e=>Z(["b"],e)),[Z]),ee=(0,o.useCallback)((e=>Z(["i"],e)),[Z]),te=(0,o.useCallback)((e=>Z(["s"],e)),[Z]),ne=(0,o.useCallback)((e=>Z(["_"],e)),[Z]),oe=(0,o.useCallback)((e=>Z(["c"],e)),[Z]);return(0,_.jsx)(r().N,{debugName:"SimpleTableKeyboardArea",capture:Boolean(O)&&!E,onLeft:P,onRight:U,onUntab:P,onTab:U,onUp:M,onDown:F,onEnter:K,onShiftEnter:V,onEsc:G,onDelete:B,onBackspace:B,onKeypress:J,onCut:$,onCopy:W,onPaste:H,onDuplicate:Q,onFillRight:Y,onToggleHighlight:q,onToggleBold:X,onToggleItalics:ee,onToggleStrike:te,onToggleUnderline:ne,onToggleCode:oe,children:n})}}}]);