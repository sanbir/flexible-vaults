"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[7049,33893,60718],{36951:(e,t,n)=>{n.d(t,{Iu:()=>P,NC:()=>O,VK:()=>b,YM:()=>N,createAndNavigateToInferenceTranscriptWithConfig:()=>U,createDefaultNewThreadConfigFromUserPreference:()=>W,eS:()=>x});n(16280),n(898992),n(354520),n(737550);var o=()=>n(907258),r=()=>n(242422),i=()=>n(365646),a=()=>n(101734),s=()=>n(427704),c=()=>n(530199),d=()=>n(498212),l=()=>n(534177),p=()=>n(939768),u=()=>n(354785),f=()=>n(770160),m=()=>n(981475),g=()=>n(619553),w=()=>n(236341),h=()=>n(246766),v=()=>n(321874),k=()=>n(122058),S=()=>n(687879),M=()=>n(844317),I=()=>n(46986),A=()=>n(555102),_=()=>n(676953),T=()=>n(626001),C=()=>n(166442),y=()=>n(140992);function b(e){var t;const{environment:n,oldThreadStore:r,newThreadStore:i,openUsingQuickSearchHandler:a,openInNewTab:s,createdSource:c,resetLocalThreadStore:d,isAgent:l,initialAgentActions:p}=e,S=(null==i?void 0:i.id)||(l?f().NEW_CHAT_THREAD_ID:void 0),M=null==i?void 0:i.getConfig();if("search"===(null==M?void 0:M.type)?(0,k().By)({sessionId:void 0,searchSessionId:M.searchSessionId,threadId:S,environment:n,createdSource:c,isAgent:!1}):"workflow"===(null==M?void 0:M.type)&&null!=p&&p.includes("injectSearchTool")&&(0,k().By)({sessionId:void 0,searchSessionId:void 0,threadId:S,environment:n,createdSource:c,isAgent:!0}),S&&"researcher"===(null==M?void 0:M.type)){((null==i?void 0:i.getTranscript())||[]).some((e=>"researcher-report"===e.type))&&u().MU({environment:n,researchModeThreadId:S,source:"chat_history"})}const I=n.device.isElectron,A=O({environment:n,threadId:S,spaceId:null===(t=o().default.state)||void 0===t||null===(t=t.sidebarSpaceStore)||void 0===t?void 0:t.id,config:null==r?void 0:r.getConfig()}),_=n.RouterStore.state.route;if("chat"!==_.name&&"ai"!==_.name&&m().globalChatPanelRuntimeStore.setState({...m().globalChatPanelRuntimeStore.state,fullPageChatSourceUrl:window.location.href}),I&&(null==d||d()),!a||!I)return s&&I?((0,g().B)({makeTabActive:!0,url:A,position:"end",openInNew:"tab",environment:n}),void v().st({environment:n,reset:!1})):void(0,h().navigate)({environment:n,url:A,...s?{openInNew:"tab",makeTabActive:!1}:{}});(0,w().N)(A)}function P(e){const{environment:t,query:n,clientStore:r,config:i,additionalSteps:a=[],openInNewTab:s,openUsingQuickSearchHandler:c,surface:d,suggestedPrompt:l,initialAgentActions:p}=e,u=A().bX.state;if(!u)throw new Error("No inference context");const{spaceStore:f,userStore:m}=u;(0,y().Wq)({clientStore:r,environment:t});const k=i.type;if(s&&("search"===k||"workflow"===k))return void function(e){var t;const{environment:n,config:r,query:i,openUsingQuickSearchHandler:a,initialAgentActions:s}=e,c=n.device.isElectron,d=!0,l=O({environment:n,threadId:void 0,spaceId:null===(t=o().default.state)||void 0===t||null===(t=t.sidebarSpaceStore)||void 0===t?void 0:t.id,config:r,query:i,forceRouteToChat:d,initialAgentActions:s});if(a&&c)return void(0,w().N)(l);if(c)return(0,g().B)({makeTabActive:!0,url:l,position:"end",openInNew:"tab",environment:n}),void v().st({environment:n,reset:!1});(0,h().navigate)({environment:n,url:l,openInNew:"tab",makeTabActive:!1})}({environment:t,config:i,query:n,openUsingQuickSearchHandler:c,initialAgentActions:p});const M=(0,A().Kf)({environment:t,spaceStore:f,userStore:m,value:n}),_=(0,I().re)();if("workflow"!==i.type||_){const e=(0,A().Xd)({environment:t,config:i,inferenceContext:u,addSteps:[...a,M],surface:d}),n=(0,S().addTranscriptToNewThreadOnClientAndRun)({environment:t,spaceStore:f,clientStore:r,userStore:m,transcript:e,initialAgentActions:p,analyticsArgs:{suggestedPrompt:l}});return b({environment:t,oldThreadStore:void 0,newThreadStore:n,openInNewTab:s,openUsingQuickSearchHandler:c,initialAgentActions:p}),n}(0,S().createEmptyWorkflowContainerAndBuild)({environment:t,parentStore:f,userStep:M})}function N(e){return(0,I().re)()?W(e):{type:"search",scopeForNextSearch:{type:"everything"}}}function W(e){var t;const{spaceId:n,searchScopes:o,environment:a}=e,s=n?(null===(t=C().UserChatPreferenceLocalStorageStore.getState())||void 0===t?void 0:t[n])??{}:{},{webEnabled:c,model:d,readOnlyModeEnabled:p}=s;let u=d&&(0,l().Xk)(i().AGENT_MODEL_TYPES,d)?d:void 0;if(n&&u){if(!r().default.checkGate({gateName:"agent_model_picker"})){const e=(0,_().getAvailableWorkflowAgentModels)(a,n);e.size>0&&!e.has(u)&&((0,T().Oq)(n,{model:void 0}),u=void 0)}}return(0,M().getWorkflowAgentConfig)({searchScopes:o,...void 0!==c&&{useWebSearch:c},...void 0!==p&&{useReadOnlyMode:p},model:u,environment:a,spaceId:n})}function O(e){const{environment:t,threadId:n,spaceId:o,config:r,query:i,forceRouteToChat:l,initialAgentActions:u,additionalQueryParams:m}=e,g=t.device.isElectron,w={};n&&(w[c().P5]=(0,d().Xw)(n)),g&&o&&(w.spaceId=o),i&&(w[c().ah]=encodeURIComponent(JSON.stringify(i))),u&&u.length>0&&(w[c().U]=u.join(","));const h=n&&n!==f().NEW_CHAT_THREAD_ID;if(!h){let e=N({spaceId:o});r&&(0,a().bD)(r.type)&&(e=r),w[c().q8]=encodeURIComponent(JSON.stringify(e))}if(h||l){if(m)for(const[e,t]of Object.entries(m))void 0!==t&&(w[e]=t);return(0,p().Gm)({url:s().JZ.chat,query:w})}return(0,p().Gm)({url:s().JZ.ai,query:w})}function U(e){const{environment:t,config:n,query:o,surface:r="search_modal",initialAgentActions:i}=e,a=A().bX.state;if(!a)throw new Error("No inference context");const{spaceStore:s,userStore:c}=a,d=(0,A().Kf)({environment:t,spaceStore:s,userStore:c,value:o}),l=(0,A().Xd)({environment:t,inferenceContext:a,config:n,addSteps:[d],surface:r});b({environment:t,newThreadStore:(0,S().addTranscriptToNewThreadOnClientAndRun)({environment:t,spaceStore:s,clientStore:C().defaultClientAIChatStore,userStore:c,transcript:l,initialAgentActions:i}),oldThreadStore:void 0})}const R=["workflow","researcher","markdown-chat"];function x(e){const{config:t,agentEnabled:n}=e;return!t||(!n||(o=t.type,(0,l().Xk)(R,o)));var o}},83293:(e,t,n)=>{n.d(t,{B9:()=>i,EG:()=>a,TY:()=>r});var o=()=>n(69708);const r=(0,o().YK)({"openai-gpt-4.1":{id:"aiInferenceTranscript.clientModelMessages.openai-gpt-4.1",defaultMessage:"GPT-4.1"},"openai-gpt-5-mini":{id:"aiInferenceTranscript.clientModelMessages.openai-gpt-5-mini",defaultMessage:"GPT-5 Mini"},"openai-gpt-5-nano":{id:"aiInferenceTranscript.clientModelMessages.openai-gpt-5-nano",defaultMessage:"GPT-5 Nano"},"anthropic-sonnet-3.7":{id:"aiInferenceTranscript.clientModelMessages.anthropic-sonnet-3.7",defaultMessage:"Claude 3.7 Sonnet"},"anthropic-opus-4":{id:"aiInferenceTranscript.clientModelMessages.anthropic-opus-4",defaultMessage:"Claude Opus 4"},"anthropic-opus-4.1":{id:"aiInferenceTranscript.clientModelMessages.anthropic-opus-4.1",defaultMessage:"Claude Opus 4.1"},"anthropic-sonnet-4":{id:"aiInferenceTranscript.clientModelMessages.anthropic-sonnet-4",defaultMessage:"Claude Sonnet 4"},"anthropic-sonnet-alt":{id:"aiInferenceTranscript.clientModelMessages.anthropic-sonnet-alt",defaultMessage:"Claude Sonnet (dev only)"},"anthropic-haiku-4.5":{id:"aiInferenceTranscript.clientModelMessages.anthropic-haiku-4.5",defaultMessage:"Claude Haiku 4.5"},"apple-danish":{id:"aiInferenceTranscript.clientModelMessages.apple-danish",defaultMessage:"Claude Opus 4.5"},"orange-tart":{id:"aiInferenceTranscript.clientModelMessages.orange-tart",defaultMessage:"Orange Tart"},"gateau-roule":{id:"aiInferenceTranscript.clientModelMessages.gateau-roule",defaultMessage:"Gemini 3 Pro"},"gateau-roule-low-thinking":{id:"aiInferenceTranscript.clientModelMessages.gateau-roule-low-thinking",defaultMessage:"Gemini 3 Pro (Low Thinking)"},"oatmeal-cookie":{id:"aiInferenceTranscript.clientModelMessages.oatmeal-cookie",defaultMessage:"Oatmeal Cookie"},"oatmeal-cake":{id:"aiInferenceTranscript.clientModelMessages.oatmeal-cake",defaultMessage:"Oatmeal Cake"},gingerbread:{id:"aiInferenceTranscript.clientModelMessages.gingerbread",defaultMessage:"Gingerbread"}}),i=(0,o().YK)({"anthropic-sonnet-3.7":{id:"AIChatInput.placeholder.anthropicSonnet3Point7",defaultMessage:"Ask Claude 3.7 Sonnet…"},"openai-gpt-4.1":{id:"AIChatInput.placeholder.openaiGpt4Point1",defaultMessage:"Ask GPT-4.1…"},"openai-gpt-5-mini":{id:"AIChatInput.placeholder.openaiGpt5Mini",defaultMessage:"Ask GPT-5 Mini…"},"openai-gpt-5-nano":{id:"AIChatInput.placeholder.openaiGpt5Nano",defaultMessage:"Ask GPT-5 Nano…"},"anthropic-opus-4":{id:"AIChatInput.placeholder.anthropicOpus4",defaultMessage:"Ask Claude Opus 4…"},"anthropic-opus-4.1":{id:"AIChatInput.placeholder.anthropicOpus4Point1",defaultMessage:"Ask Claude Opus 4.1…"},"anthropic-sonnet-4":{id:"AIChatInput.placeholder.anthropicSonnet4",defaultMessage:"Ask Claude Sonnet 4…"},defaultAskMessage:{id:"AIChatInput.placeholder.defaultAsk",defaultMessage:"Ask {modelName}…"},"anthropic-sonnet-alt":{id:"AIChatInput.placeholder.anthropicSonnetAlt",defaultMessage:"Ask Claude Sonnet (dev only)…"}}),a=(0,o().YK)({chatWithModel:{id:"aiInferenceTranscript.contextStep.chatWithModel",defaultMessage:"{modelName}"},chatWithoutModel:{id:"aiInferenceTranscript.contextStep.chatWithoutModel",defaultMessage:"Chat"},search:{id:"aiInferenceTranscript.contextStep.search",defaultMessage:"Notion AI"},researcher:{id:"aiInferenceTranscript.contextStep.researcher",defaultMessage:"Research"}})},272136:(e,t,n)=>{n.d(t,{h:()=>c});var o=()=>n(242422),r=()=>n(274023);var i=()=>n(534177),a=()=>n(383070);const s="ai_model_picker_config_override";function c(){const e=o().default.getConfig({configName:s}),t=a().zD.isZeroRetentionEnabled(),n=e[t?"zeroRetentionModels":"nonZeroRetentionModels"]??{};if(t){const e={};for(const t of(0,i().uv)(n)){if(c=t,(0,r().wo)(c)){const o=n[t];e[t]=o}}return e}var c;return n}},274023:(e,t,n)=>{n.d(t,{PK:()=>r,wo:()=>i});n(16280);var o=()=>n(706119);function r(e){const t=function(e){return"default"===e?"openai-gpt-4o":e}(e),n=o().U_.get(t);if(!n)throw new Error(`Model not found in registry: ${e}`);return n}function i(e){return r(e).isHipaaCompliant}},418054:(e,t,n)=>{n.r(t),n.d(t,{addSidebarWorkflow:()=>a,moveSidebarWorkflow:()=>c,removeSidebarWorkflow:()=>s});n(898992),n(354520);var o=()=>n(907258),r=()=>n(72234),i=()=>n(547149);function a({environment:e,workflowId:t}){var n;const a=o().default.state.sidebarSpaceViewStore;if(!a)return;const s=(null===(n=a.getSettings())||void 0===n?void 0:n.sidebar_workflow_ids)||[];s.includes(t)||i().createAndCommit({userAction:"sidebarWorkflowsActions.addSidebarWorkflow",environment:e,canUndo:!0,cellTarget:"main",perform:e=>{const n=[t,...s];r().AG(a,e,{...a.getSettings(),sidebar_workflow_ids:n})}})}function s({environment:e,workflowId:t}){var n;const a=o().default.state.sidebarSpaceViewStore;if(!a)return;const s=(null===(n=a.getSettings())||void 0===n?void 0:n.sidebar_workflow_ids)||[],c=s.filter((e=>e!==t));c.length!==s.length&&i().createAndCommit({userAction:"sidebarWorkflowsActions.removeSidebarWorkflow",environment:e,canUndo:!0,cellTarget:"main",perform:e=>{r().AG(a,e,{...a.getSettings(),sidebar_workflow_ids:c})}})}function c({environment:e,workflowId:t,afterWorkflowId:n}){var a;const s=o().default.state.sidebarSpaceViewStore;if(!s)return;const c=(null===(a=s.getSettings())||void 0===a?void 0:a.sidebar_workflow_ids)||[];c.includes(t)&&i().createAndCommit({userAction:"sidebarWorkflowsActions.moveSidebarWorkflow",environment:e,canUndo:!0,cellTarget:"main",perform:e=>{const o=c.filter((e=>e!==t));let i;if(n){const e=o.indexOf(n);i=-1===e?[...o,t]:[...o.slice(0,e+1),t,...o.slice(e+1)]}else i=[t,...o];r().AG(s,e,{...s.getSettings(),sidebar_workflow_ids:i})}})}},676953:(e,t,n)=>{n.d(t,{_y:()=>k,getAvailableWorkflowAgentModels:()=>S,hg:()=>f,BU:()=>w});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(803949),n(581454);var o=()=>n(365646),r=()=>n(534177);(0,r().qb)()(["openai-gpt-4o","openai-gpt-4o-mini","openai-turbo","openai-chatgpt-4o-latest","openai-o1","openai-o1-mini","openai-o3-mini","openai-gpt-4.1","openai-gpt-4.1-mini","openai-gpt-4.1-nano","openai-gpt-5-mini","openai-gpt-5-nano","openai-o3","openai-o4-mini","openai-turbo-thinking","openai-turbo-minimal-thinking","openai-turbo-10","openai-turbo-8","orange-tart","orange-tart-minimal-thinking"]),(0,r().qb)()(["anthropic-sonnet-4","anthropic-sonnet-3.7","anthropic-sonnet-3.7-thinking","anthropic-opus","anthropic-sonnet-4-thinking","anthropic-opus-4","anthropic-opus-4-thinking","anthropic-opus-4.1","anthropic-opus-4.1-thinking","anthropic-sonnet-alt","anthropic-sonnet-alt-no-thinking","anthropic-sonnet-alt-thinking","anthropic-haiku-4.5","anthropic-haiku-4.5-thinking","apple-danish"]),(0,r().qb)()(["vertex-gemini-1.5-pro","vertex-gemini-1.5-flash","vertex-gemini-2.0-flash","vertex-gemini-2.5-pro","vertex-gemini-2.5-flash","gemini-pro","gemini-flash","gateau-roule","gateau-roule-low-thinking"]),(0,r().qb)()(["fireworks-llama3-70b","fireworks-deepseek-r1","fireworks-llama3.1-405b","fireworks-llama3.1-70b","fireworks-llama3.3-70b","fireworks-llama3.3-70b-dedicated","fireworks-llama3.1-8b","fireworks-mixtral-22b","fireworks-mixtral-7b","fireworks-ft-router-101","fireworks-ft-router-102","fireworks-deepseek-v3","fireworks-deepseek-r1-0528","fireworks-kimi-k2","fireworks-gpt-oss-20b","fireworks-gpt-oss-120b","fireworks-gpt-oss-safeguard-120b","fireworks-llama-8b-finetune-v07-p50-cru6bgc4"]),(0,r().qb)()(["groq-gemma2-9b-it","groq-gemma-7b-it","groq-llama-70b","groq-llama-8b","groq-mixtral"]),(0,r().qb)()(["bedrock-nova-pro","bedrock-nova-lite","bedrock-nova-micro"]),(0,r().qb)()(["bedrock-anthropic-sonnet-3.7"]),(0,r().qb)()(["cerebras-llama3.1-8b","cerebras-llama3.3-70b","cerebras-deepseek-r1-distill-llama-70b"]),(0,r().qb)()(["anyscale-gpt-oss-safeguard-20b"]),(0,r().qb)()(["oatmeal-cookie","oatmeal-cake","oreo-cheesecake","old-fashioned-donut","gingerbread"]);const i=(0,r().qb)()(["openai-gpt-4.1","anthropic-sonnet-4","anthropic-opus-4","anthropic-opus-4.1","anthropic-sonnet-3.7","anthropic-sonnet-alt","anthropic-haiku-4.5","apple-danish","orange-tart","gateau-roule","gateau-roule-low-thinking","oatmeal-cookie","oatmeal-cake","gingerbread"]);var a=()=>n(69708),s=()=>n(383070),c=()=>n(916275),d=()=>n(83293),l=()=>n(865698),p=()=>n(272136);const u=(0,a().YK)({model:{id:"aiInferenceTranscript.model",defaultMessage:"{modelName}"}});function f(e){const{model:t,intl:n}=e;if(!t)return;const o=(0,p().h)();if(o[t])return o[t].modelMessage;if(function(e){return!!(0,r().Xk)(i,e)}(t)){const e=d().TY[t];return n.formatMessage(d().EG.chatWithModel,{modelName:n.formatMessage(e)})}}const m=(0,a().YK)({search:{id:"AIModePicker.askMode.search",defaultMessage:"Notion AI"},defaultModel:{id:"AIModePicker.askMode.defaultModel",defaultMessage:"Auto"},includesContextTitle:{id:"AIModePicker.askMode.includesContextTitle",defaultMessage:"Get answers about your workspace"},excludesContextTitle:{id:"AIModePicker.askMode.excludesContextTitle",defaultMessage:"Chat directly with models"}});function g(e,t,n,o){return e.map(((e,t)=>({item:e,originalIndex:t}))).sort(((e,n)=>{if(null!=o&&o(e.item)||null!=o&&o(n.item))return 0;const r=t(e.item),i=t(n.item),a=(0,l().DL)(r),s=(0,l().DL)(i);if(a!==s){if(void 0===a&&void 0!==s)return 1;if(void 0===s&&void 0!==a)return-1;if(void 0!==a&&void 0!==s)return a.localeCompare(s)}return e.originalIndex-n.originalIndex})).map((({item:e})=>e))}function w(e){return g(e,(e=>e))}function h(e){return g(e,(e=>"default"===e.askMode?void 0:e.askMode),0,(e=>"default"===e.askMode))}function v(e,t){return t?{askMode:"default",title:e.formatMessage(m.defaultModel),config:{type:"workflow"}}:{askMode:"default",title:e.formatMessage(m.search),config:{type:"search",scopeForNextSearch:{type:"everything"}}}}function k(e){const{intl:t,isAgentEnabled:n,environment:o,spaceId:r,hideWorkspaceSectionTitle:i=!1}=e,a=[],s=[],c=n?"workflow":"search",d=M(o,r);return void 0===d?[{id:"workspace-context",sectionTitle:m.includesContextTitle,items:[v(t,n)],configType:c,isLoading:!0},{id:"workspace-context-excludes",sectionTitle:m.excludesContextTitle,items:[],configType:"markdown-chat"}]:(d.forEach((e=>{const{clientModel:n,modelMessage:o,markdownChat:r,workflow:i}=e;r&&s.push({askMode:n,title:t.formatMessage(u.model,{modelName:o}),config:{type:"markdown-chat",model:n},beta:r.beta}),"workflow"===c&&void 0!==i&&a.push({askMode:i.finalModelName,title:t.formatMessage(u.model,{modelName:o}),config:{type:"workflow",model:i.finalModelName,modelFromUser:!0},beta:i.beta})})),[{id:"workspace-context",sectionTitle:i?void 0:m.includesContextTitle,items:[v(t,n),...h(a)],configType:c},{id:"workspace-context-excludes",sectionTitle:m.excludesContextTitle,items:h(s),configType:"markdown-chat"}])}function S(e,t){const n=M(e,t);return void 0===n?new Set:new Set(n.map((e=>{var t;return null===(t=e.workflow)||void 0===t?void 0:t.finalModelName})).filter(r().O9))}function M(e,t){return s().zD.shouldUseServerAuthoritativeModels()?e&&t?function(e,t){const n=c().P.getData(e,{spaceId:t});if(!n)return;const i=[];return n.forEach((e=>{const{model:t,modelMessage:n,markdownChat:a,workflow:s}=e;if(!a&&!s)return;const c={clientModel:t,modelMessage:n};if(a&&(c.markdownChat={beta:a.beta}),s){const e=s.finalModelName;(0,r().Xk)(o().AGENT_MODEL_TYPES,e)&&(c.workflow={finalModelName:e,beta:s.beta})}i.push(c)})),i}(e,t):[]:function(){const e=(0,p().h)(),t=s().zD.showAnthropicModelPicker(),n=s().zD.showGeminiModelPicker(),i=[];return(0,r().uv)(e).forEach((a=>{const s=e[a];if(!s)return;const{modes:c,modelFamily:d,modelMessage:l}=s;if(void 0===(null==c?void 0:c["markdown-chat"])&&void 0===(null==c?void 0:c.workflow))return;if(!t&&("anthropic"===d||a.includes("anthropic")||a.includes("claude")))return;if(!n&&("gemini"===d||a.includes("gemini")||a.includes("vertex")))return;const p={clientModel:a,modelMessage:l};void 0!==(null==c?void 0:c["markdown-chat"])&&(p.markdownChat={beta:"beta"===c["markdown-chat"]}),void 0!==(null==c?void 0:c.workflow)&&(0,r().Xk)(o().AGENT_MODEL_TYPES,a)&&(p.workflow={finalModelName:a,beta:"beta"===c.workflow}),(p.markdownChat||p.workflow)&&i.push(p)})),i}()}},687879:(e,t,n)=>{n.r(t),n.d(t,{addStepsToExistingThreadAndRun:()=>ke,addTranscriptToNewThreadAndRun:()=>me,addTranscriptToNewThreadOnClientAndRun:()=>ge,applyWorkflowSetupUpdate:()=>ze,createEmptyWorkflowContainerAndBuild:()=>He,deleteModule:()=>je,deleteScript:()=>ye,deleteTrigger:()=>Ce,duplicateAgentFromTemplate:()=>Le,duplicateTemplateAndOpenChat:()=>nt,duplicateWorkflow:()=>Ve,ensureInstructionsPage:()=>Re,getWorkflowRunQueueInfo:()=>he,overrideWorkflowData:()=>Qe,publishWorkflow:()=>Ke,reRunWorkflowFromThread:()=>ve,reenqueuePausedRun:()=>et,removeModule:()=>Ge,requestWorkflowLimitIncrease:()=>$e,resetWorkflowToPublished:()=>Ze,resolveNotionWorkflowDependency:()=>Be,resolveWorkflowDependency:()=>Ie,restoreWorkflowVersion:()=>Je,saveConfigVariable:()=>Me,saveConversationStarters:()=>xe,saveCover:()=>Ne,saveCoverPosition:()=>We,saveDescription:()=>Oe,saveIcon:()=>Pe,saveIsTemplate:()=>Ue,saveModel:()=>De,saveModule:()=>Se,saveName:()=>be,savePermissionMode:()=>Ee,saveScript:()=>Te,saveTrigger:()=>_e,saveTriggers:()=>Ae,setScriptAgentAdvancedOverride:()=>fe,setScriptAgentOverride:()=>ue,softDeleteWorkflow:()=>Ye,triggerWorkflowAutomation:()=>we});n(16280),n(898992),n(354520),n(672577),n(581454),n(737550);var o=()=>n(907258),r=()=>n(755531),i=()=>n(242422),a=()=>n(770063),s=()=>n(295633),c=()=>n(463086),d=()=>n(350013),l=()=>n(81986),p=()=>n(365646),u=()=>n(755956),f=()=>n(878456),m=()=>n(158489),g=()=>n(700500),w=()=>n(110192),h=()=>n(165358),v=()=>n(402390),k=()=>n(868840),S=()=>n(388821),M=()=>n(179034),I=()=>n(96689),A=()=>n(234459),_=()=>n(798880),T=()=>n(743246),C=()=>n(201980),y=()=>n(439180),b=()=>n(530199),P=()=>n(496703);n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);const N={INTEGRATION_TRIGGER_NOT_OWNED:"Only the user who connected this integration can view or edit trigger settings",INTEGRATION_MODULE_NOT_OWNED:"Only the user who connected this integration can edit its settings"};var W=()=>n(724639),O=()=>n(711517),U=()=>n(142918),R=()=>n(915671),x=()=>n(496603),E=()=>n(763824),D=()=>n(498212),G=()=>n(973647),q=()=>n(534177);const L=(0,n(583835).Dv)("duplicateAgent");var F=()=>n(769864),V=()=>n(357625),B=()=>n(896628),X=()=>n(44729),H=()=>n(257216),Q=()=>n(384944),j=()=>n(666144),z=()=>n(140992),K=()=>n(36951),Y=()=>n(555102),Z=()=>n(166442),J=()=>n(703748),$=()=>n(594794),ee=()=>n(246766),te=()=>n(712505),ne=()=>n(547149),oe=()=>n(253141);n(944114);function re(e){const t=[],n=function(e){const t=[];let n=[];for(const o of C().RQ(e)){if(C().qXl(o)){n.push(o);continue}const e=C().N8A(o),r=C().uPN(o),i=e.split("\n");for(const[o,a]of i.entries())o>0&&(t.push(n),n=[]),a.length>0&&n.push(C().Ey_(a,r))}n.length>0&&t.push(n);return t}(e);for(const o of n){if(0===o.length)continue;const e=C().RQ(o)[0];if(!e)continue;const n=C().N8A(e),r=n.match(/^([-*+•–—])\s+/);if(r){const e=ie({textValue:o,prefixLength:r[0].length});t.push({type:g().xd.bulletedList,text:e});continue}const i=n.match(/^(\d+\.)\s+/);if(i){const e=ie({textValue:o,prefixLength:i[0].length});t.push({type:g().xd.numberedList,text:e})}else t.push({type:g().xd.text,text:o})}return t}function ie(e){const{textValue:t,prefixLength:n}=e;if(0===n)return t;const o=[];let r=n;for(const i of C().RQ(t)){if(C().qXl(i)){o.push(i);continue}const e=C().N8A(i),t=C().uPN(i);if(0===r)o.push(i);else if(r>=e.length)r-=e.length;else{const n=e.slice(r);o.push(C().Ey_(n,t)),r=0}}return o}var ae=()=>n(844317);var se=()=>n(670),ce=()=>n(418054),de=()=>n(22673);function le(e,t,n){void 0!==n?e[t]=n:delete e[t]}function pe(e){const{environment:t,workflowStore:n,patch:o}=e,r=function(e){var t,n;return(null===(t=e.getDraftData())||void 0===t?void 0:t.config_overrides)??(null===(n=e.getData())||void 0===n?void 0:n.config_overrides)}(n),i=function(e,t){const n={...e??{}};for(const o of(0,q().uv)(t))le(n,o,t[o]);return n}(r,o),a=(0,q().uv)(i).length>0?i:void 0;(0,x().n4)(r,a)||ne().createAndCommit({userAction:"WorkflowActions.setConfigOverrides",environment:t,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().wI({pointer:n.pointer,configOverrides:a}),transaction:e})}})}function ue(e){const{environment:t,workflowStore:n,enabled:o}=e;pe({environment:t,workflowStore:n,patch:{enableScriptAgent:o}})}function fe(e){const{environment:t,workflowStore:n,enabled:o}=e;pe({environment:t,workflowStore:n,patch:{enableScriptAgentAdvanced:o}})}function me(e){const{environment:t,spaceStore:n,transcript:o,parentPointer:r,threadId:i,workflowId:a,createdSource:s}=e,d=i??(0,$().Z1)({environment:t,table:A().To,spaceId:n.id});return(0,z().WE)({environment:t,clientStore:Z().defaultClientAIChatStore,threadStore:void 0,createThreadArgs:{id:d,transcript:o,workflowId:a,parentPointer:r||{table:I().NX,id:n.id,spaceId:n.id},createdSource:s},sendPatchResponse:!1}),c().E.createChildStore(n,{id:d,spaceId:n.id,table:A().To})}function ge(e){const{environment:t,spaceStore:n,clientStore:o,userStore:r,transcript:i,threadId:a,initialAgentActions:s,analyticsArgs:c}=e,d=(0,f().f_)(i),{serverCommitResult:l,performResult:p}=ne().createAndCommit({userAction:"WorkflowActions.addTranscriptToNewThreadAndRun",environment:t,canUndo:!0,perform:e=>(0,z().aP)({environment:t,spaceStore:n,userStore:r,transaction:e,transcript:i,threadId:a,threadType:(null==d?void 0:d.type)??"workflow"})});return(0,z().WE)({environment:t,clientStore:o,threadStore:p,waitBeforeSending:l,analyticsArgs:c,sendPatchResponse:!1,initialAgentActions:s}),p}async function we(e){const{environment:t,spaceStore:n,workflowStore:o,triggerId:r,triggerData:i}=e,a=await F().callApi({eventName:"triggerWorkflowAutomation",environment:t,data:{workflowId:o.id,spaceId:n.id,triggerId:r,triggerData:JSON.stringify(i??{})}});if("failed"===a.type)throw a.error;return a.data}async function he(e){const{environment:t,runId:n,spaceId:o}=e,r=await F().callApi({eventName:"getWorkflowRunQueueInfo",environment:t,data:{runId:n,spaceId:o}});if("failed"===r.type)throw r.error;return r.data.queueInfo}async function ve(e){const{environment:t,spaceStore:n,workflowStore:o,threadId:r}=e,i=(c().E.createChildStore(n,{table:A().To,id:r,spaceId:n.id}).getTranscript()||[]).find(p().CK);if(!i)return{newThreadId:void 0};const{threadId:a}=await we({environment:t,spaceStore:n,workflowStore:o,triggerId:i.triggerId,triggerData:i.data??{}});if(a){const e=(0,P().L)({workflowId:o.id,params:{agentChatThreadId:a,workflowViewType:"activity"}});(0,ee().navigate)({environment:t,url:e})}return{newThreadId:a}}function ke(e){const{environment:t,clientStore:n,userStore:o,spaceStore:r,threadStore:i,addSteps:a,waitForServerCommit:s,sendPartialTranscript:c,sendPatchResponse:d,analyticsArgs:l}=e;let p=i;const{serverCommitResult:u}=ne().createAndCommit({userAction:"WorkflowActions.addStepsToExistingThreadAndRun",environment:t,canUndo:!0,perform:e=>{p=function(e){const{threadStore:t,environment:n,spaceStore:o,userStore:r,transaction:i}=e;if(t.isDefined())return t;return h().log({level:"info",from:"workflowActions",type:"ensureThreadStoreIsMaterialized",data:{threadId:t.id,spaceId:o.id,miscDataToConvertToString:{threadType:t.getType()}},error:{stack:new Error("ThreadStore not defined before append").stack}}),(0,z().aP)({environment:n,spaceStore:o,userStore:r,transaction:i,threadId:t.id,threadType:t.getType()})}({threadStore:p,environment:t,spaceStore:r,userStore:o,transaction:e}),(0,z().Vn)({threadStore:p,environment:t,spaceStore:r,userStore:o,addSteps:a,transaction:e})}});return(0,z().WE)({environment:t,clientStore:n,threadStore:p,waitBeforeSending:s?u:void 0,stepIdsToInclude:Boolean(c)?a.map((e=>e.id)):void 0,sendPatchResponse:d,analyticsArgs:l}),p}function Se(e){const{workflowStore:t,module:n,environment:o}=e;ne().createAndCommit({userAction:"WorkflowActions.saveModule",environment:o,canUndo:!0,perform:e=>{ne().applyOperation({store:t,operation:U().xb({pointer:t.pointer,module:n}),transaction:e})}})}function Me(e){const{value:t,workflowStore:n}=e;ne().createAndCommit({userAction:"WorkflowActions.saveConfigVariable",environment:e.environment,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().bE({pointer:n.pointer,configVariable:t}),transaction:e})}})}function Ie(e){const{workflowStore:t,environment:n,dependencyId:o,resolution:r}=e,i=t.getDraftData(),a=null==i?void 0:i.dependencies;if(!a||0===a.length)return;const s=a.findIndex((e=>e.dependencyId===o));if(-1===s)return;const c=a[s];if((0,x().n4)(c.resolution,r))return;const d=[...a];d[s]={...c,resolution:r},ne().createAndCommit({userAction:"WorkflowActions.resolveDependency",environment:n,canUndo:!0,perform:e=>{ne().applyOperation({store:t,operation:U().xH({pointer:t.pointer,dependencies:d}),transaction:e})}})}function Ae(e){const{triggers:t,workflowStore:n}=e;ne().createAndCommit({userAction:"WorkflowActions.saveTriggers",environment:e.environment,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().IA({pointer:n.pointer,triggers:t}),transaction:e})}})}function _e(e){const{trigger:t,workflowStore:n}=e;ne().createAndCommit({userAction:"WorkflowActions.saveTrigger",environment:e.environment,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().NW({pointer:n.pointer,trigger:t}),transaction:e})}})}function Te(e){const{workflowStore:t,script:n,environment:o}=e;ne().createAndCommit({userAction:"WorkflowActions.saveScript",environment:o,canUndo:!0,perform:e=>{ne().applyOperation({store:t,operation:U()._C({pointer:t.pointer,script:n}),transaction:e})}})}function Ce(e){const{trigger:t,workflowStore:n}=e;ne().createAndCommit({userAction:"WorkflowActions.deleteTrigger",environment:e.environment,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().LI({pointer:n.pointer,trigger:t}),transaction:e})}})}function ye(e){var t;const{workflowStore:n,script:o,environment:r}=e,i=(null===(t=n.getDraftData())||void 0===t?void 0:t.triggers)||[],a=i.some((e=>e.scriptId===o.id)),s=a?i.map((e=>e.scriptId===o.id?{...e,scriptId:void 0}:e)):i;ne().createAndCommit({userAction:"WorkflowActions.deleteScript",environment:r,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().Wb({pointer:n.pointer,script:o}),transaction:e}),a&&ne().applyOperation({store:n,operation:U().IA({pointer:n.pointer,triggers:s}),transaction:e})}})}function be(e){const{name:t,workflowStore:n}=e;ne().createAndCommit({userAction:"WorkflowActions.saveName",environment:e.environment,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().i({pointer:n.pointer,name:t}),transaction:e})}})}function Pe(e){const{icon:t,workflowStore:n}=e;ne().createAndCommit({userAction:"WorkflowActions.saveIcon",environment:e.environment,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().yD({pointer:n.pointer,icon:t}),transaction:e})}})}function Ne(e){const{cover:t,workflowStore:n}=e;ne().createAndCommit({userAction:"WorkflowActions.saveCover",environment:e.environment,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().KF({pointer:n.pointer,cover:t}),transaction:e})}})}function We(e){const{coverPosition:t,workflowStore:n}=e;ne().createAndCommit({userAction:"WorkflowActions.saveCoverPosition",environment:e.environment,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().Bw({pointer:n.pointer,coverPosition:t}),transaction:e})}})}function Oe(e){const{description:t,workflowStore:n}=e;ne().createAndCommit({userAction:"WorkflowActions.saveDescription",environment:e.environment,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().Xo({pointer:n.pointer,description:t}),transaction:e})}})}function Ue(e){const{isTemplate:t,workflowStore:n,environment:o}=e;ne().createAndCommit({userAction:"WorkflowActions.saveIsTemplate",environment:o,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().nR({pointer:n.pointer,isTemplate:t}),transaction:e})}})}async function Re(e){var t;const{workflowStore:n,environment:o,title:r,draftInstructions:i}=e,a=i??(null===(t=n.getData())||void 0===t?void 0:t.instructions);if((0,O().ap)(a))return s().B.createChildStore(n,a);const c=n.getSpaceId();if(!c)throw new Error("Workflow store is missing space id for instructions page");const d=(0,O().Zv)(a)?(0,O().rr)(a):[],{performResult:l,serverCommitResult:p}=ne().createAndCommit({userAction:"WorkflowActions.ensureInstructionsPage",environment:o,canUndo:!0,perform:e=>{const t=Q().Wv({environment:o,type:g().xd.page,properties:{title:(0,C().x9d)(r)},inMemoryRecordCache:n.inMemoryRecordCache,transaction:e,spaceId:c});if(H().bn({childStore:t,parentStore:n,alive:!0,transaction:e}),d&&d.length>0){const r=re(d);for(const i of r){const r=Q().Wv({environment:o,type:i.type,properties:{title:i.text},inMemoryRecordCache:n.inMemoryRecordCache,transaction:e,spaceId:c});X().NI({parentStore:t,childStore:r,transaction:e})}}return ne().applyOperation({store:n,operation:U().WV({pointer:n.pointer,instructions:t.pointer}),transaction:e}),t}});return await p,l}function xe(e){const{conversationStarters:t,workflowStore:n,environment:o}=e;ne().createAndCommit({userAction:"WorkflowActions.saveConversationStarters",environment:o,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().g9({pointer:n.pointer,conversationStarters:t}),transaction:e})}})}function Ee(e){const{workflowStore:t,permissionMode:n,environment:o}=e;t.table===T().C0&&ne().createAndCommit({userAction:"WorkflowActions.savePermissionMode",environment:o,canUndo:!0,perform:e=>{ne().applyOperation({store:t,operation:U().Jl({pointer:t.pointer,permissionMode:n}),transaction:e})}})}function De(e){const{model:t,workflowStore:n}=e;ne().createAndCommit({userAction:"WorkflowActions.saveModel",environment:e.environment,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().iS({pointer:n.pointer,model:t}),transaction:e})}})}function Ge(e){const{module:t,workflowStore:n}=e;ne().createAndCommit({userAction:"WorkflowActions.removeModule",environment:e.environment,canUndo:!0,perform:e=>{ne().applyOperation({store:n,operation:U().$h({pointer:n.pointer,module:t}),transaction:e})}})}function qe(e){const{environment:t,spaceStore:n,workflowName:o,workflowIcon:r,sourceWorkflowPointer:a}=e,s=t.currentUser.id,c=null==n?void 0:n.id;if(!s||!c)return;const d=(0,$().Z1)({environment:t,table:T().C0,spaceId:c}),l=i().default.checkGate({gateName:"custom_agent_page_instructions"}),{performResult:p,serverCommitResult:u}=ne().createAndCommit({environment:t,userAction:"duplicateWorkflow.createPlaceholder",canUndo:!0,perform:e=>{const i={...(0,R().bZ)(),name:o,icon:r,duplication_status:{type:"duplicating",source_workflow_pointer:a,started_at:Date.now(),user_id:s}},p=Q().vt({environment:t,table:T().C0,args:{id:d,parentPointer:n.pointer,space_id:c,data:i,createdByPointer:{table:_().oo,id:s},permissions:[{type:"user_permission",role:"editor",user_id:s}]},inMemoryRecordCache:n.inMemoryRecordCache,transaction:e});if(l){const o=(0,$().Z1)({environment:t,table:M().ev,spaceId:c}),r=Q().Wv({environment:t,id:o,type:"page",spaceId:c,transaction:e,inMemoryRecordCache:n.inMemoryRecordCache,createdByTable:_().oo,createdById:s}),i=(0,$().Z1)({environment:t,table:M().ev,spaceId:c}),a=Q().Wv({environment:t,id:i,type:"text",spaceId:c,transaction:e,inMemoryRecordCache:n.inMemoryRecordCache,createdByTable:_().oo,createdById:s});X().NI({parentStore:r.getContentStore(),childStore:a,transaction:e}),H().bn({transaction:e,childStore:r,parentStore:p,alive:!0}),ne().applyOperation({store:p,operation:{pointer:p.pointer,command:"set",path:["data","instructions"],args:{table:M().ev,id:o,spaceId:c}},transaction:e})}return p}});return{workflowStore:p,serverCommitResult:u}}async function Le(e){const{environment:t,spaceStore:n,templateWorkflowPointer:o,templateId:r,templateTitle:i,templateIconUrl:a,addToFavorites:s}=e,c=function(e){const{environment:t,spaceStore:n,templateTitle:o,templateIconUrl:r,templateWorkflowPointer:i}=e;return qe({environment:t,spaceStore:n,workflowName:o,workflowIcon:r,sourceWorkflowPointer:i})}({environment:t,spaceStore:n,templateTitle:i,templateIconUrl:a,templateWorkflowPointer:o});if(!c)return;await c.serverCommitResult,s&&ce().addSidebarWorkflow({environment:t,workflowId:c.workflowStore.id});const d=E().yX(),l=performance.now();return Fe({environment:t,sourceWorkflowPointer:o,targetWorkflowId:c.workflowStore.id,spaceId:n.id,deferred:d}),d.promise.then((()=>{(0,de().He)({environment:t,time:Math.round(performance.now()-l),success:!0,workflow_id:c.workflowStore.id,template_id:r})})).catch((()=>{(0,de().He)({environment:t,time:Math.round(performance.now()-l),success:!1,workflow_id:c.workflowStore.id,template_id:r})})),{workflowStore:c.workflowStore,onComplete:d.promise}}async function Fe(e){const{environment:t,sourceWorkflowPointer:n,targetWorkflowId:o,spaceId:r,deferred:i}=e;(0,se().Ur)(o);try{const e=(0,V().UT)(t,L,{workflowPointer:n,targetSpaceId:r,targetWorkflowId:o,addToFavorites:!1},{spaceIds:[n.spaceId,r]});for await(const t of e){if(G().Q.isFail(t)){const e=t.error??new Error("Failed to duplicate agent");return h().log({level:"warning",from:"duplicateAgentInBackground",type:"optimisticDuplicationFailed",data:{workflowId:o,miscDataToConvertToString:{error:e instanceof Error?e.message:String(e)}}}),void i.reject(e)}if("success"===t.value.status)return void i.resolve();if("failure"===t.value.status){const e=new Error(t.value.error??"Failed to duplicate agent");return h().log({level:"warning",from:"duplicateAgentInBackground",type:"optimisticDuplicationFailed",data:{workflowId:o,miscDataToConvertToString:{error:e.message}}}),void i.reject(e)}}const a=new Error("Task completed without success status");i.reject(a)}finally{(0,se().Lr)(o)}}async function Ve(e){const{environment:t,workflowPointer:n,spaceStore:o,addToFavorites:r=!0}=e,i=function(e){const{environment:t,spaceStore:n,sourceWorkflowPointer:o}=e,r=d().N.createChildStore(n,o).getData(),i=(null==r?void 0:r.name)??"Untitled Agent",a=null==r?void 0:r.icon;return qe({environment:t,spaceStore:n,workflowName:(0,w().Q)(i),workflowIcon:a,sourceWorkflowPointer:o})}({environment:t,spaceStore:o,sourceWorkflowPointer:n});if(!i)throw new Error("Failed to create placeholder workflow");await i.serverCommitResult,r&&ce().addSidebarWorkflow({environment:t,workflowId:i.workflowStore.id});const a=E().yX();return Fe({environment:t,sourceWorkflowPointer:n,targetWorkflowId:i.workflowStore.id,spaceId:o.id,deferred:a}),{workflowStore:i.workflowStore,onComplete:a.promise}}async function Be(e){const{environment:t,workflowStore:n,dependencyId:o,targetBlockId:r}=e,i=n.getSpaceStore();if(!i)throw new Error("Workflow store is missing space context");const a=await F().callCellCompatibleApi({eventName:"resolveAgentDependency",environment:t,data:{workflowId:n.id,spaceId:i.id,dependencyId:o,targetBlockId:r},cellNavigation:{spaceId:i.id}});if("failed"===a.type)throw a.error??new Error("Failed to resolve dependency")}function Xe(e){const{environment:t,transaction:n,parentStore:r}=e,{sidebarSpaceStore:i,sidebarSpaceViewStore:a}=o().default.state;if(!i||!a)throw new Error("No current space");const s=Q().Wv({environment:t,type:"collection_view_page",transaction:n,inMemoryRecordCache:i.inMemoryRecordCache});(0,oe().Ls)({environment:t,parentStore:r??i,collectionViewBlockStore:s,transaction:n,appendOrPrepend:"append",spaceViewStore:a});const c=function(e){const{environment:t,store:n,transaction:o}=e,r={modules:[]};return function(e){const{environment:t,store:n,transaction:o,workflowData:r}=e,i=Q().vt({environment:t,table:T().C0,args:{id:(0,$().Z1)({environment:t,table:T().C0,spaceId:n.getSpaceId()}),data:r,parentPointer:{table:M().ev,id:n.id},space_id:n.getSpaceId()},inMemoryRecordCache:n.inMemoryRecordCache,transaction:o});return B().zA({stores:[n],update:{workflow_id:i.id},transaction:o}),i}({environment:t,transaction:o,store:n,workflowData:r})}({environment:t,store:s,transaction:n});return{workflowStore:c,collectionViewBlockStore:s}}async function He(e){const{environment:t,parentStore:n,userStep:o,onThreadChange:r}=e,i=Y().bX.state;if(!i)throw new Error("No inference context");const{spaceStore:a}=i,{performResult:s,serverCommitResult:c}=ne().createAndCommit({userAction:"SetupGenerator.handlePromptSubmit",environment:t,canUndo:!0,perform:e=>Xe({environment:t,transaction:e,parentStore:n})});await c;const{collectionViewBlockStore:d}=s,l=function(e){const{environment:t,inferenceContext:n,addSteps:o=[],config:r}=e;return(0,Y().Xd)({environment:t,inferenceContext:n,config:r&&"workflow"!==r.type?r:(0,ae().getWorkflowAgentConfig)(r),addSteps:o,surface:"workflows"})}({environment:t,inferenceContext:i,store:d,addSteps:[o]}),p=me({environment:t,spaceStore:a,transcript:l});null==r||r(p)}function Qe(e){const{workflowStore:t,transaction:n,workflow:o}=e;Q().KY({store:t.getDataStore(),value:o,transaction:n})}function je(e){const{workflowStore:t,moduleId:n,environment:o}=e;ne().createAndCommit({userAction:"WorkflowActions.deleteModule",environment:o,canUndo:!0,perform:e=>{var o;const r=t.getDraftData();if(!r)return;const i=null===(o=r.modules)||void 0===o?void 0:o.filter((e=>e.id!==n));let a={...r,modules:i};a=function(e){if(!e.triggers||0===e.triggers.length)return e;const t=new Set((e.modules||[]).map((e=>e.id))),n=new Set((e.scripts||[]).map((e=>e.id))),o=e.triggers.filter((e=>!e.moduleId||t.has(e.moduleId))).map((e=>e.scriptId?n.has(e.scriptId)?e:{...e,scriptId:void 0}:e)),r=o.some(((t,n)=>{var o;return t.scriptId!==(null===(o=e.triggers)||void 0===o||null===(o=o[n])||void 0===o?void 0:o.scriptId)}));return o.length!==e.triggers.length||r?{...e,triggers:o}:e}(a),Qe({workflowStore:t,workflow:a,transaction:e})}})}function ze(e){const{environment:t,threadStore:n,operations:i,transaction:c}=e,d=o().default.state.currentUserStore;if(!d)throw new Error("No current user");const l=(0,r().S)();if(!l)throw new Error("No current space");const p=S().RecordMap.create();for(const o of i)if((0,y().ph)(o)){const e=s().B.createChildStore(n,o.pointer);ne().applyCrdtTextOperation({store:e,operation:o,transaction:c,invertedOperation:void 0});const t=e.getModel();t&&p.addModel(t)}else{const e=(0,a().v3)(n,o.pointer);ne().applyOperation({transaction:c,store:e,operation:o});const t=e.getRecordModel(o.pointer);t&&p.addModel(t)}(0,z().Vn)({threadStore:n,environment:t,spaceStore:l,userStore:d,addSteps:[{id:(0,D().Ay)(),type:"agent-record-map",threadRecordMap:(0,m().he)(p)}],transaction:c})}async function Ke(e){const{environment:t,workflowStore:n}=e,o=n.getSpaceId();if(!o)throw new Error("Cannot publish workflow without space ID");const r=n.getDraftData();if(!r)throw new Error("Workflow has no data");const i=(0,W().Cu)(r);return G().Q.isFail(i)?i:(await F().callApi({eventName:"publishCustomAgentVersion",environment:t,data:{workflowId:n.id,spaceId:o}}),await j().sy({environment:t,inMemoryRecordCache:n.inMemoryRecordCache,pointer:n.pointer,userId:void 0}),G().Q.success(void 0))}async function Ye(e){const{environment:t,workflowStore:n}=e,{serverCommitResult:o}=ne().createAndCommit({environment:t,userAction:"workflowActions.softDeleteWorkflow",perform:e=>{ne().applyOperation({store:n,transaction:e,operation:{pointer:n.pointer,command:"set",path:["alive"],args:!1}});const t=n.getData(),o=(null==t?void 0:t.triggers)||[];if(o.length>0){const t=o.map((e=>({...e,enabled:!1})));ne().applyOperation({store:n,operation:U().IA({pointer:n.pointer,triggers:t}),transaction:e})}},canUndo:!0});ce().removeSidebarWorkflow({environment:t,workflowId:n.id}),await o}async function Ze(e){const{environment:t,workflowStore:n}=e,o=n.getPublishedArtifactStore();if(o)return Je({environment:t,workflowStore:n,workflowArtifactStore:o,publish:!1})}async function Je(e){const{environment:t,workflowStore:n,workflowArtifactStore:o,publish:r=!0}=e;if(!o.getData())throw new(W().nc)("Cannot restore workflow version without artifact data",[]);const i=o.getSpaceId();if(!i)throw new Error("Cannot restore workflow version without space ID");const a=await F().callApi({eventName:"restoreCustomAgentVersion",environment:t,data:{workflowId:n.id,spaceId:i,workflowArtifactId:o.id,publish:r}});if("failed"===a.type){const e=a.body&&"object"==typeof a.body&&"debugMessage"in a.body?a.body.debugMessage:void 0;if(e===N.INTEGRATION_TRIGGER_NOT_OWNED||e===N.INTEGRATION_MODULE_NOT_OWNED||(null==e?void 0:e.includes("Unsaved transactions:"))&&(e.includes(N.INTEGRATION_TRIGGER_NOT_OWNED)||e.includes(N.INTEGRATION_MODULE_NOT_OWNED)))throw new(W().nc)("Integration not owned by user",[{type:"integration_not_owned_by_user"}]);throw new(W().nc)("Failed to restore workflow version",[])}await j().sy({environment:t,inMemoryRecordCache:n.inMemoryRecordCache,pointer:n.pointer,userId:void 0});const{restoredInstructionsPointer:s,workflowArtifactId:c}=a.data;if(r&&!c)throw new(W().nc)("Failed to publish restored version",[]);return s}async function $e(e){const{environment:t,workflowStore:n,amount:o,reason:r}=e,a=n.getDraftData(),s=null==a?void 0:a.usage_limit,c=null==a?void 0:a.paused_reason,d=i().default.getConfig({configName:"custom_agent_sub_features"}),l=(null==d?void 0:d.default_run_limit)??100,p="runLimit"===(null==s?void 0:s.type)?s.maximum:l,u=p+o;(0,de().rQ)({environment:t,workflowId:n.id,amountRequested:o,reason:r,currentLimit:p,newLimit:u});const f=ne().createAndCommit({environment:t,userAction:"WorkflowLimitIncreaseRequest",canUndo:!1,perform:e=>{const t={pointer:n.pointer,command:"set",path:["data","usage_limit"],args:{type:"runLimit",maximum:u}};if(ne().applyOperation({store:n,operation:t,transaction:e}),"runLimit"===(null==c?void 0:c.reason)){const t={pointer:n.pointer,command:"set",path:["data","paused_reason"],args:void 0};ne().applyOperation({store:n,operation:t,transaction:e});const o={pointer:n.pointer,command:"set",path:["data","status"],args:"runnable"};ne().applyOperation({store:n,operation:o,transaction:e})}}});await f.serverCommitResult}async function et(e){const{environment:t,runId:n,spaceId:o}=e;try{const e=await t.api.callCellCompatibleApi({eventName:"reenqueueWorkflowAutomation",environment:t,data:{runIds:[n],spaceId:o},cellNavigation:{spaceId:o}});return"success"===e.type?{success:!0}:{success:!1,error:(null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to re-enqueue run"};var r}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to re-enqueue run"}}}const tt=(0,n(69708).YK)({createAgentPrompt:{id:"workflow.agent.newAgentModal.createAgentPrompt",defaultMessage:"Create agent using {templateName} template"}});async function nt(e){const{environment:t,spaceStore:n,inferenceContext:o,template:r,intl:a,analytics:s,preferFlippyNewAgentFlow:c,onRequestClose:d}=e,p=await Le({environment:t,spaceStore:n,templateWorkflowPointer:r.workflowPointer,templateId:r.id,templateTitle:r.title,templateIconUrl:r.iconUrl,addToFavorites:!0});if(!p)return;const{workflowStore:f,onComplete:m}=p;return(0,de().qt)({environment:t,action:"create_new",workflowId:f.id,from:`template:${r.title}`,flowId:s.flowId,origin:s.origin}),null==d||d(),(0,ee().navigate)({environment:t,url:(0,P().L)({workflowId:f.id,params:{workflowViewType:"settings"}})}),m.then((()=>{if(o&&o.userStore&&o.spaceViewStore){const e={userStore:o.userStore,spaceStore:n,spaceViewStore:o.spaceViewStore,blockStore:o.blockStore,peekStore:o.peekStore,workflowStore:f},s=i().default.checkGate({gateName:"custom_agent_flippy_layout"}),d=e=>i().default.checkGate({gateName:e}),p=(0,l().MI)((0,l().VD)("agent_thread_tools"),d),m=d("custom_agent_setup_mode_tool"),g=s&&(p||m),w=(0,v().H)(a),h=(0,u().e)(r.id),S=["update_agent_from_template","update_agent_template_for_slack_task_triager","update_agent_template_for_weekly_project_update"],M=(0,q().Xk)(S,h)?{type:h,isCustomAgent:g,enableSetupModeTool:m}:void 0,I=(0,Y().Jv)({environment:t,spaceStore:n,userStore:o.userStore,promptType:h,value:(0,C().x9d)(a.formatMessage(tt.createAgentPrompt,{templateName:r.title})),locale:w,args:M}),A=(0,Y().Xd)({environment:t,inferenceContext:e,config:(0,ae().getWorkflowAgentConfig)({environment:t,spaceId:n.id,isCustomAgent:g,workflowId:g?f.id:void 0}),addSteps:[I],surface:"workflows"}),_=me({environment:t,spaceStore:n,transcript:A,workflowId:f.id,createdSource:"workflows",parentPointer:g?f.pointer:void 0});if(Boolean(c)&&s){const e=(0,te().getUrlParamFromPeekMode)(k().A),o=(0,K().NC)({environment:t,threadId:_.id,spaceId:n.id,additionalQueryParams:{wfv:"settings",[b().ZI]:(0,D().Xw)(f.id),...e?{[b().fT]:e}:void 0}});return void(0,ee().navigate)({environment:t,url:o})}(0,J().openChatPanel)({environment:t,store:f,chatPanelState:{isOpen:!0,threadId:_.id}})}})),f}},755956:(e,t,n)=>{n.d(t,{R:()=>a,e:()=>i});var o=()=>n(534177);const r=["search","summarize_current_projects","draft_project_plan","plan_a_trip","summarize","translate","add_action_items","brainstorm_ideas","make_more_concise","create_task_tracker","write_meeting_agenda","analyze_page_for_insights","summarize_discussions","analyze_database_for_insights","visualize_with_a_chart","filter_and_sort_data","help_me_set_up_this_database","generate_sample_rows","whats_new_in_agent","create_custom_agent_from_modal","add_emoji_trigger_to_slack","schedule_recurring_report","help_me_update_instructions","create_custom_agent","create_database_agent","help_create_database_agent_with_ai","translate_database_agent","summarize_database_agent","update_custom_agent_with_memories","test_custom_agent","update_agent_from_template","update_agent_template_for_slack_task_triager","update_agent_template_for_weekly_project_update","improve_writing","fix_spelling_grammar","explain_this","continue_writing","make_shorter","add_summary","reformat","generate_image_prompt","ask_ai"];function i(e){switch(e){case"slack-task-triager":return"update_agent_template_for_slack_task_triager";case"weekly-project-update":return"update_agent_template_for_weekly_project_update";default:return"update_agent_from_template"}}function a(e){return!!(0,o().Xk)(r,e)}},865698:(e,t,n)=>{n.d(t,{At:()=>d,DL:()=>u,G2:()=>f,T3:()=>c,VX:()=>h,Wg:()=>m,oT:()=>l,tv:()=>v,xM:()=>p});n(898992),n(354520),n(581454);var o=()=>n(365646),r=()=>n(974731),i=()=>n(69708),a=()=>n(534177),s=()=>n(272136);const c=o().di.filter((e=>"fast"===e.displayGroup)).map((e=>e.notionName)),d=o().di.filter((e=>"intelligent"===e.displayGroup)).map((e=>e.notionName)),l=[...c,...d],p=["openai-gpt-4.1","openai-gpt-4.1-mini","openai-turbo"];function u(e){var t;if(!e)return;const n=null===(t=(0,s().h)()[e])||void 0===t?void 0:t.modelFamily;return n&&r().my.includes(n)?n:void 0}function f(e){switch(e){case"openai":return{buttonColor:"gray",textColor:"gray"};case"anthropic":return{buttonColor:"orange",textColor:"orange"};default:return}}const m=(0,i().YK)({default:{id:"UnifiedModelPicker.default",defaultMessage:"Auto"},"anthropic-sonnet-4":{id:"UnifiedModelPicker.anthropic-sonnet-4",defaultMessage:"Claude 4 Sonnet"},"anthropic-sonnet-4-thinking":{id:"UnifiedModelPicker.anthropic-sonnet-4-thinking",defaultMessage:"Claude 4 Sonnet with thinking"},"anthropic-sonnet-3.7":{id:"UnifiedModelPicker.anthropic-sonnet-3.7",defaultMessage:"Claude 3.7 Sonnet"},"anthropic-sonnet-3.7-thinking":{id:"UnifiedModelPicker.anthropic-sonnet-3.7-thinking",defaultMessage:"Claude 3.7 Sonnet with thinking"},"anthropic-opus-4":{id:"UnifiedModelPicker.anthropic-opus-4",defaultMessage:"Claude 4 Opus"},"anthropic-opus-4-thinking":{id:"UnifiedModelPicker.anthropic-opus-4-thinking",defaultMessage:"Claude 4 Opus with thinking"},"anthropic-opus-4.1":{id:"UnifiedModelPicker.anthropic-opus-4.1",defaultMessage:"Claude 4.1 Opus"},"anthropic-opus-4.1-thinking":{id:"UnifiedModelPicker.anthropic-opus-4.1-thinking",defaultMessage:"Claude 4.1 Opus with thinking"},"anthropic-sonnet-alt":{id:"UnifiedModelPicker.anthropicSonnetAlt",defaultMessage:"Claude Sonnet 4.5"},"anthropic-sonnet-alt-no-thinking":{id:"UnifiedModelPicker.anthropicSonnetAltNoThinking",defaultMessage:"Claude Sonnet 4.5"},"anthropic-sonnet-alt-thinking":{id:"UnifiedModelPicker.anthropicSonnetAltThinking",defaultMessage:"Claude Sonnet (dev only) with thinking"},"openai-gpt-4.1":{id:"UnifiedModelPicker.openai",defaultMessage:"OpenAI GPT-4.1"},"openai-gpt-4.1-mini":{id:"UnifiedModelPicker.openaiMini",defaultMessage:"OpenAI GPT-4.1 Mini"},"openai-gpt-5-mini":{id:"UnifiedModelPicker.openaiGpt5Mini",defaultMessage:"OpenAI GPT-5 Mini"},"openai-gpt-5-nano":{id:"UnifiedModelPicker.openaiGpt5Nano",defaultMessage:"OpenAI GPT-5 Nano"},"openai-o4-mini":{id:"UnifiedModelPicker.openaiO4Mini",defaultMessage:"OpenAI o4-mini"},"gemini-pro":{id:"UnifiedModelPicker.geminiPro",defaultMessage:"Gemini 2.5 Pro"},"gemini-flash":{id:"UnifiedModelPicker.geminiFlash",defaultMessage:"Gemini 2.5 Flash"},"openai-turbo":{id:"UnifiedModelPicker.openaiTurbo",defaultMessage:"OpenAI GPT-5"},"openai-turbo-thinking":{id:"UnifiedModelPicker.openaiTurboThinking",defaultMessage:"OpenAI GPT-5 with thinking"},"openai-turbo-minimal-thinking":{id:"UnifiedModelPicker.openaiTurboMinimalThinking",defaultMessage:"OpenAI GPT-5 + minimal CoT"},"openai-turbo-10":{id:"UnifiedModelPicker.openaiTurbo10",defaultMessage:"OpenAI GPT-5 + juice@10"},"openai-turbo-8":{id:"UnifiedModelPicker.openaiTurbo8",defaultMessage:"OpenAI GPT-5 + juice@8"},"anthropic-haiku-4.5":{id:"UnifiedModelPicker.anthropicHaiku4Point5",defaultMessage:"Claude Haiku 4.5"},"anthropic-haiku-4.5-thinking":{id:"UnifiedModelPicker.anthropicHaiku4Point5Thinking",defaultMessage:"Claude Haiku 4.5 with thinking"},"apple-danish":{id:"UnifiedModelPicker.appleDanish",defaultMessage:"Claude Opus 4.5"},"orange-tart":{id:"UnifiedModelPicker.openaiOrangeTart",defaultMessage:"OpenAI GPT-5.1"},"orange-tart-minimal-thinking":{id:"UnifiedModelPicker.openaiOrangeTartMinimalThinking",defaultMessage:"OpenAI GPT-5.1 + minimal CoT"},"gateau-roule":{id:"UnifiedModelPicker.gateauRoule",defaultMessage:"Gemini 3 Pro"},"gateau-roule-low-thinking":{id:"UnifiedModelPicker.gateauRouleLowThinking",defaultMessage:"Gemini 3 Pro (Low Thinking)"},gingerbread:{id:"UnifiedModelPicker.gingerbread",defaultMessage:"Gingerbread"},"oatmeal-cookie":{id:"UnifiedModelPicker.oatmealCookie",defaultMessage:"Oatmeal Cookie"},"oatmeal-cake":{id:"UnifiedModelPicker.oatmealCake",defaultMessage:"Oatmeal Cake"},fastSection:{id:"UnifiedModelPicker.fastSection",defaultMessage:"Fast (Workspace context, dev only)"},agentModelSection:{id:"UnifiedModelPicker.agentModelSection",defaultMessage:"Choose a model"},intelligentSection:{id:"UnifiedModelPicker.intelligentSection",defaultMessage:"Intelligent (Workspace context, dev only)"},agentIntelligentSection:{id:"UnifiedModelPicker.agentIntelligentSection",defaultMessage:"Intelligent models"}}),g=["anthropic-sonnet-alt","anthropic-sonnet-alt-no-thinking","anthropic-sonnet-alt-thinking","apple-danish","gateau-roule","gateau-roule-low-thinking"],w=(0,i().YK)({"anthropic-sonnet-alt":{id:"UnifiedModelPicker.anthropicSonnetAltShort",defaultMessage:"Sonnet 4.5"},"anthropic-sonnet-alt-no-thinking":{id:"UnifiedModelPicker.anthropicSonnetAltNoThinkingShort",defaultMessage:"Sonnet 4.5"},"anthropic-sonnet-alt-thinking":{id:"UnifiedModelPicker.anthropicSonnetAltThinkingShort",defaultMessage:"Sonnet 4.5"},"apple-danish":{id:"UnifiedModelPicker.appleDanishShort",defaultMessage:"Opus 4.5"},"gateau-roule":{id:"UnifiedModelPicker.gateauRouleShort",defaultMessage:"Gemini 3"},"gateau-roule-low-thinking":{id:"UnifiedModelPicker.gateauRouleLowThinkingShort",defaultMessage:"Gemini 3 (Low)"}});function h(e,t){if((0,a().Xk)(g,e))return t.formatMessage(w[e])}function v(e,t,n){return null!=n&&n.modelMessage?n.modelMessage:e in m?t.formatMessage(m[e]):"string"==typeof e?e:"Unknown Model"}}}]);