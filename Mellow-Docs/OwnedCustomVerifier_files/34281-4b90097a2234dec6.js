"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[34281],{84671:(e,t,o)=>{o.d(t,{u:()=>n});const n="return-to-writer-button"},102586:(e,t,o)=>{o.d(t,{US:()=>i});const n={brainstormIdeas:!0,blogPost:!0,outline:!0,socialMediaPost:!0,pressRelease:!0,creativeStory:!0,essay:!0,poem:!0,todoList:!0,meetingAgenda:!0,prosConsList:!0,jobDescription:!0,salesEmail:!0,recruitingEmail:!0};function i(e){return n[e]}},159495:(e,t,o)=>{o.d(t,{$S:()=>s,I4:()=>r,IQ:()=>a});o(898992),o(354520);var n=()=>o(680977);function i(e,t){return e.id===t.id}function r(e,t,o){const r=a(t).slice(),s=r.findIndex((t=>i(e,t)));-1===s?r.unshift(e):r.splice(s,1,e),(0,n().m)({userSettingsStore:t,transaction:o,data:{favorite_ai_actions:r}})}function a(e){var t;return(null===(t=e.getModel())||void 0===t||null===(t=t.getSettings())||void 0===t?void 0:t.favorite_ai_actions)??[]}function s(e,t,o){const r=a(t).filter((t=>!i(t,e)));(0,n().m)({userSettingsStore:t,transaction:o,data:{favorite_ai_actions:r}})}},171333:(e,t,o)=>{o.d(t,{Uj:()=>E,X_:()=>W,ht:()=>H,jS:()=>D,lB:()=>J,x0:()=>T});o(16280),o(18107),o(967357);var n=o(296540),i=()=>o(717137),r=()=>o(484714),a=()=>o(590526),s=()=>o(401497),l=()=>o(79926),c=()=>o(779315),u=()=>o(295633),d=()=>o(680474),p=()=>o(807449),f=()=>o(459683),m=()=>o(378815),g=()=>o(892936),v=()=>o(100622),h=()=>o(209199),P=()=>o(496603),b=()=>o(534177),w=()=>o(783793),y=()=>o(383070),I=()=>o(591197),S=()=>o(109488),A=()=>o(495159),M=()=>o(552871),x=()=>o(525569),k=()=>o(472090),C=()=>o(84671),R=()=>o(286088),F=o(474848);function j(e){return new DOMRect(e.left,e.top,e.width,e.height)}const V=300;function T(e){const{scrollerStore:t,openState:o,children:l,freezePosition:c=!1}=e,d=(0,n.useRef)(null),p=(0,n.useRef)(null),[m,g]=(0,n.useState)(void 0),v=(0,n.useRef)(void 0),{scrollerRef:P,scrollerClientRect:w}=(0,a().K8)((()=>({scrollerRef:t.state.elementRef,scrollerClientRect:t.state.clientRect})),[t]),M=(0,n.useRef)(void 0),C=(0,n.useRef)(void 0),T=(0,n.useRef)(t),B=(0,n.useRef)(!1);T.current!==t&&(v.current=void 0,C.current=void 0,M.current=void 0,B.current=!0,T.current=t);const W=(0,a().K8)((()=>"agentCompletionPopup"===o.type&&o.didTransitionFromPeekToFullPage),[o]);(0,n.useEffect)((()=>{if(W){const e=setTimeout((()=>{x().default.setDidTransitionFromPeekToFullPage(!1),B.current=!0}),V);return()=>clearTimeout(e)}}),[W]);const E=(0,a().K8)((()=>{if(c&&v.current&&!B.current)return v.current;B.current=!1;const e="agentCompletionPopup"===o.type;if(W&&e&&P.current){const e=o.context.origin;if(e instanceof u().B){const t=P.current.querySelector(`[data-block-id="${e.id}"]`);if(t){const e=t.getBoundingClientRect(),o=P.current.getBoundingClientRect(),n=P.current.scrollTop,i={top:e.bottom-o.top+n+8,left:e.left-o.left,width:Math.min(Math.max(e.width,L),O)};return v.current=i,i}}return v.current}const{originRect:t,correspondingOpenState:n}=(()=>{const e=(0,R().Q9)(o);let t=e?(0,A().LB)(e):void 0;if(!t&&M.current){const e=(0,R().Q9)(M.current);let t=e?(0,A().LB)(e):void 0;return t||(t=C.current?j(C.current):void 0),{originRect:t,correspondingOpenState:M.current}}if(!t&&C.current&&(t=j(C.current)),!t&&P.current){const e=o.context.origin;if(e instanceof u().B){const o=P.current.querySelector(`[data-block-id="${e.id}"]`);o&&(t=o.getBoundingClientRect())}}return t&&(C.current=j(t)),{originRect:t,correspondingOpenState:o}})();if(!t||!w||!P.current)return v.current;M.current||(M.current=n);(e=>{const{origin:t,type:o}=e.context;switch(o){case"cursor":return t instanceof u().B&&t.isEmptyEditableBlock();case"blockSelection":case"textSelection":return!1;default:(0,b().HB)(o)}})(n)&&(t.height=0);const i=function(e){const{originRect:t,scrollerRect:o,scrollerScrollTop:n,popupRect:i}=e,r=(null==i?void 0:i.width)??0,a=Math.min(Math.max(t.width,L),O),s=t.bottom-o.top+n+D.top;let l;l=r+D.left+D.right>o.width?D.left:t.left+r>o.right?o.width-r-D.right:(0,h().A1)()?o.right-t.left-r:t.left-o.left;return{top:s,left:l,width:a}}({originRect:t,scrollerRect:P.current.getBoundingClientRect(),scrollerScrollTop:P.current.scrollTop,popupRect:m});return v.current=i,i}),[w,P,m,o,c,W]),N=H(t),J=(0,b().O9)(E);(0,n.useEffect)((()=>{if(N&&J&&d.current)switch(N){case"Page":{const e=new IntersectionObserver((e=>{const[t]=e;t.isIntersecting?I().ZJ.setState({...I().ZJ.state,popupRenderedInPage:!0}):I().ZJ.setState({...I().ZJ.state,popupRenderedInPage:{direction:t.boundingClientRect.top<0?"above":"below",writerRef:d}})}),{root:P.current,threshold:0});return e.observe(d.current),()=>{e.disconnect(),I().ZJ.setState({...I().ZJ.state,popupRenderedInPage:!1})}}case"PeekView":{const e=new IntersectionObserver((e=>{const[t]=e;t.isIntersecting?I().ZJ.setState({...I().ZJ.state,popupRenderedInPeekView:!0}):I().ZJ.setState({...I().ZJ.state,popupRenderedInPeekView:{direction:t.boundingClientRect.top<0?"above":"below",writerRef:d}})}),{root:P.current,threshold:0});return e.observe(d.current),()=>{e.disconnect(),I().ZJ.setState({...I().ZJ.state,popupRenderedInPeekView:!1})}}}}),[N,J,P]),(0,n.useEffect)((()=>{if(!d.current)throw new Error("ref.current is null");const e=new(k().E);let t;return e.rect.addListener((e=>{(0,b().O9)(t)&&cancelAnimationFrame(t),t=requestAnimationFrame((()=>g(e.state)))})),e.observe(d.current),()=>{(0,b().O9)(t)&&cancelAnimationFrame(t),e.destroy()}}),[]);const K=(0,n.useMemo)((()=>"assistantCompletionPopup"===o.type?"results"===o.stage&&o.loading:"agentCompletionPopup"===o.type?"executing"===o.stage:void(0,b().HB)(o)),[o]),{isPhone:Z}=(0,r().Y0)(),U=(0,r().v3)(),z=(0,a().K8)((()=>!Z&&y().zD.disableWriterAutoFollow()),[Z]),G=(0,R().B2)({scrollerRef:P,areWeLoading:K,unpauseAfterMs:5e3});(0,n.useEffect)((()=>{null!=E&&E.top&&!K&&d.current&&!z&&_(d.current,U,{behavior:"smooth",block:"nearest"})}),[null==E?void 0:E.top,K,z,U]),(0,n.useEffect)((()=>{if(!p.current||!P.current||!K||G||z)return;const e=new IntersectionObserver((e=>{var t;!Boolean(null===(t=e.at(0))||void 0===t?void 0:t.isIntersecting)&&d.current&&(0,f().R)({element:d.current,environment:U,options:{behavior:"smooth",block:"end"}})}),{root:P.current,threshold:1});return e.observe(p.current),()=>{e.disconnect()}}),[P,K,G,z,U]);const $=(0,n.useMemo)((()=>"assistantCompletionPopup"===o.type?"results"===o.stage&&!o.loading:"agentCompletionPopup"===o.type?"results"===o.stage:void(0,b().HB)(o)),[o]);(0,n.useEffect)((()=>{if($&&!z){_.cancel();const e=setTimeout((()=>{d.current&&(0,f().R)({element:d.current,environment:U,options:{behavior:"smooth",block:d.current.getBoundingClientRect().height>window.innerHeight?"end":"nearest"}})}),150);return()=>clearTimeout(e)}}),[$,z,U]),(0,n.useEffect)((()=>{G&&_.cancel()}),[G]);const Q=(0,s().IS)((()=>({wrap:{position:"absolute",width:null==E?void 0:E.width,zIndex:113,top:0,insetInlineStart:0,transform:`translate(${((0,h().A1)()?-1:1)*((null==E?void 0:E.left)??0)}px, ${(null==E?void 0:E.top)??0}px)`,transition:"transform 0.1s",scrollMarginTop:K&&!z?.33*window.innerHeight:50,scrollMarginBottom:K?.33*window.innerHeight:50}})),[E,K,z]);return(0,F.jsx)(S().A,{capture:!0,render:e=>(0,F.jsx)(i().A,{debugName:"PopupPositioner",capture:!0,allowMenuList:!0,allowEsc:!0,children:(0,F.jsxs)("div",{style:Q.wrap,ref:d,...e,children:[E?l:void 0,(0,F.jsx)("div",{ref:p,style:{visibility:"hidden"}})]})})})}function B(e){const{returnToWriterDetails:t}=e,o=(0,M().L)(),i=(0,r().v3)(),a=(0,n.useCallback)((e=>{t.writerRef.current&&(e.stopPropagation(),e.preventDefault(),N(t.writerRef.current,i,{behavior:"smooth",block:"nearest"}))}),[t.writerRef,i]),c=(0,n.useCallback)((e=>{e.stopPropagation(),e.preventDefault()}),[]),u=(0,s().IS)((()=>({container:{position:"absolute",display:"grid",placeItems:"center",insetInlineStart:"50%",transform:"translateX(-50%)",zIndex:1e6,bottom:o},button:{cursor:"pointer",backgroundColor:"black",background:v().Tj.background.accentPrimary,color:v().Tj.text.inversePrimary,borderRadius:36,height:36,padding:4,paddingInlineEnd:10,boxShadow:v().Tj.shadowLG,fontSize:14,display:"flex",alignItems:"center",gap:6}})),[o]),f=(0,n.useMemo)((()=>{switch(t.direction){case"above":return(0,F.jsx)(p().I,{icon:g().arrowStraightUpFillIcon});case"below":return(0,F.jsx)(p().I,{icon:m().arrowStraightDownFillIcon});default:(0,b().HB)(t.direction)}}),[t.direction]),h=(0,n.useMemo)((()=>{switch(t.direction){case"above":case"below":return{transition:{duration:.2,ease:"easeOut"},animate:{opacity:1},exit:{opacity:0},initial:{opacity:0}};default:(0,b().HB)(t.direction)}}),[t.direction]),{value:P}=(0,l().fJ)(d().fM);if(!P)return null;const{motion:y}=P;return(0,F.jsx)("div",{style:u.container,children:(0,F.jsxs)(y.div,{className:C().u,"aria-live":"polite",style:u.button,onClick:a,onMouseDown:c,...h,children:[(0,F.jsx)(w().x,{variant:"small"}),f]})})}function W(e){const{scrollerKey:t}=e,{isPhone:o}=(0,r().Y0)(),n=(0,a().K8)((()=>!o&&y().zD.disableWriterAutoFollow()),[o]),i=(0,a().K8)((()=>{if(!n||!t)return!1;const e=x().default.state;if("agentCompletionPopup"===e.type&&e.didTransitionFromPeekToFullPage)return!1;switch(t){case"Page":return I().ZJ.state.popupRenderedInPage;case"PeekView":return I().ZJ.state.popupRenderedInPeekView;default:(0,b().HB)(t)}}),[t,n]),{value:s}=(0,l().fJ)(d().fM);if(!s)return null;const{AnimatePresence:c}=s;return(0,F.jsx)(c,{children:"object"==typeof i?(0,F.jsx)(B,{returnToWriterDetails:i}):null})}const E=P().sg(((e,t,n)=>{var i;((0,o(490969).H)({element:t,environment:n,options:{top:e,left:0,behavior:"smooth"}}),c().A.MenuScroller)&&(null===(i=c().A.MenuScroller.getNode())||void 0===i||i.scrollTo({top:0}))}),60),_=P().nF(((e,t,o)=>{(0,f().R)({element:e,environment:t,options:o})}),200,{leading:!1}),N=P().sg(((e,t,o)=>{(0,f().R)({element:e,environment:t,options:o})}),100),D={top:4,bottom:6,left:6,right:16},L=500,O=730;function J(e){var t,o;return e===(null===(t=c().A.PageScroller)||void 0===t?void 0:t.getStore())?c().A.PageScroller:e===(null===(o=c().A.PeekViewScroller)||void 0===o?void 0:o.getStore())?c().A.PeekViewScroller:void 0}function H(e){var t,o;return e===(null===(t=c().A.PageScroller)||void 0===t?void 0:t.getStore())?"Page":e===(null===(o=c().A.PeekViewScroller)||void 0===o?void 0:o.getStore())?"PeekView":void 0}},177163:(e,t,o)=>{o.r(t),o.d(t,{closeInitialPromptAndEndSession:()=>C,openHelpMeWriteGenericPopup:()=>F,toggleInitialPrompt:()=>R});var n=()=>o(135168),i=()=>o(242422),r=()=>o(908006),a=()=>o(587031),s=()=>o(755125),l=()=>o(547033),c=()=>o(86159),u=()=>o(925193),d=()=>o(206267),p=()=>o(201980),f=()=>o(534177),m=()=>o(769864),g=()=>o(675133),v=()=>o(102586);function h(e,t=g().A.getIntl()){if("helpMeEdit"===e.key||"helpMeDraft"===e.key||"helpMeWrite"===e.key){var o;const n=null===(o=e.steps)||void 0===o?void 0:o[0],i="text"===(null==n?void 0:n.type)&&n.prefilledValue;return i?t.formatMessage({id:"completionPopup.prefilledValue",defaultMessage:"Write about {prefilledValue} "},{prefilledValue:i}):""}if(!(0,v().US)(e.key))return"";switch(e.key){case"brainstormIdeas":return t.formatMessage({id:"completionPopup.brainStorm.prefilledValue",defaultMessage:"Brainstorm ideas on "});case"blogPost":return t.formatMessage({id:"completionPopup.blogPost.prefilledValue",defaultMessage:"Write a blog post about "});case"outline":return t.formatMessage({id:"completionPopup.outline.prefilledValue",defaultMessage:"Write an outline about "});case"socialMediaPost":return t.formatMessage({id:"completionPopup.socialMediaPost.prefilledValue",defaultMessage:"Write a social media post about "});case"pressRelease":return t.formatMessage({id:"completionPopup.pressRelease.prefilledValue",defaultMessage:"Write a press release about "});case"creativeStory":return t.formatMessage({id:"completionPopup.creativeStory.prefilledValue",defaultMessage:"Write a creative story about "});case"essay":return t.formatMessage({id:"completionPopup.essay.prefilledValue",defaultMessage:"Write an essay about "});case"poem":return t.formatMessage({id:"completionPopup.poem.prefilledValue",defaultMessage:"Write a poem about "});case"todoList":return t.formatMessage({id:"completionPopup.todoList.prefilledValue",defaultMessage:"Write a todo list about "});case"meetingAgenda":return t.formatMessage({id:"completionPopup.meetingAgenda.prefilledValue",defaultMessage:"Write a meeting agenda about "});case"prosConsList":return t.formatMessage({id:"completionPopup.prosConsList.prefilledValue",defaultMessage:"Write a pros and cons list about "});case"jobDescription":return t.formatMessage({id:"completionPopup.jobDescription.prefilledValue",defaultMessage:"Write a job description about "});case"salesEmail":return t.formatMessage({id:"completionPopup.salesEmail.prefilledValue",defaultMessage:"Write a sales email about "});case"recruitingEmail":return t.formatMessage({id:"completionPopup.recruitingEmail.prefilledValue",defaultMessage:"Write a recruiting email about "});default:(0,f().HB)(e.key)}}var P=()=>o(483730),b=()=>o(37450),w=()=>o(29554),y=()=>o(401040),I=()=>o(68465),S=()=>o(301421),A=()=>o(525569),M=()=>o(272200),x=()=>o(286088);function k(e,t){if((0,x().Ku)(e),!("assistantCompletionPopup"!==t.type&&"agentCompletionPopup"!==t.type||"results"!==t.stage&&"initialPrompt"!==t.stage||"textSelection"!==t.context.type&&"cursor"!==t.context.type)){const o=t.context.textSelection;r().default.afterNextFlush((()=>{(0,l().setMultiSelection)({multiSelection:o}),function(e){const{multiSelection:t,environment:o}=e;if(void 0===t.start||void 0===t.end)return;if(!Number.isFinite(t.start.index)||!Number.isFinite(t.end.index))return;const n=S().n.findNodeFromStore(t.start.store),i=S().n.findNodeFromStore(t.end.store);if(!n||!i)return;const r=(0,w().vA)(n,t.start.index),a=(0,w().vA)(i,t.end.index),s=document.createRange();s.setStart(r.container,r.offset),s.setEnd(a.container,a.offset),c().set(s,o.device)}({multiSelection:o,environment:e})}))}}function C(e,t=!0){t&&k(e,A().default.state),A().default.setState({type:"closed"})}async function R(e){const{environment:t,from:r}=e;let{context:l,prefilledValue:c,sessionId:d}=e;const{assistantDependency:f}=await Promise.resolve().then(o.bind(o,650829)),g=await f.load();if(!(await g.assistantMenuActions.closeAssistantRightHandSideMenu({environment:t})))return;let v={type:"closed"};if("closed"===A().default.state.type&&(l||(l=(0,y().G)()),l)){if(i().default.checkGate({gateName:"agent_writer"})){let t;c||(t=(0,p().x9d)("")),v={type:"agentCompletionPopup",stage:"initialPrompt",context:l,from:r,prefilledValue:t,pendingSkill:e.agentPrebuiltPromptType}}else{var h;c||(c=""),d||(d=(0,u().gC)()),v={type:"assistantCompletionPopup",stage:"initialPrompt",context:l,from:r,prefilledValue:c,sessionId:d,loading:!1,hasErrored:!1};const e=(0,n().f)(null===(h=l)||void 0===h?void 0:h.currentPage);e&&m().callApi({eventName:"publishAiSession",environment:t,data:{inference_type:"writer",spaceId:e.id,id:d,metadata:{from:r}}})}}A().default.setState(v),function(e){const{environment:t,promptForAnalytics:o}=e,{state:n}=A().default;if("assistantCompletionPopup"===n.type&&"results"!==n.stage){i().default.checkGate({gateName:"mobile_assistant_prevent_clear_selection"})||(0,s().clear)({environment:t});const e=n.sessionId,r=P().default.getSessionContext(e);M().trackAICompletionPopupOpen(t,{session_id:n.sessionId,prompt_key:(null==o?void 0:o.key)??"unknown",from:n.from,sessionContext:r}),(0,a().V)({dismissed:!1,environment:t,trackCreateBlock:b().vH})}}(e)}function F(e){const{title:t,environment:o,prefilledValue:n,from:i}=e,r=(0,y().g)();if(!r)return;let a;if((0,f().O9)(t)){const e=t?(0,I().gB)({customPrompt:n??t,isPageEmpty:!0}):I().am;a={promptForAnalytics:e,prefilledValue:h(e)}}else a={prefilledValue:n,promptForAnalytics:void 0};R({environment:o,from:i??"page_menu",sessionId:d().JW(),context:r,...a})}},680474:(e,t,o)=>{o.d(t,{Wx:()=>r,fM:()=>n,sM:()=>i});const n=new(o(79926).O2)("framer-motion",(async()=>await Promise.all([o.e(44711),o.e(53321),o.e(37043)]).then(o.bind(o,301716))));function i(e){return e.useAnimation()}function r(e,...t){return e.useInView(...t)}},834281:(e,t,o)=>{o.r(t),o.d(t,{CompletionPopup:()=>ne,GtmFavoriteButtons:()=>ue,PopupPositionerLocater:()=>te().X_,aiAnalyticsActions:()=>m(),aiQnaActions:()=>N(),cascadeActions:()=>i,completionActions:()=>a(),completionInitialPromptActions:()=>s(),favoriteImportActions:()=>n,propertyCompletionsActions:()=>r()});var n={};o.r(n),o.d(n,{importGtmFavorite:()=>_});var i={};o.r(i),o.d(i,{getFirstCascadeInferenceOutput:()=>L});var r=()=>o(706654),a=()=>o(108184),s=()=>o(177163),l=o(296540),c=()=>o(907258),u=()=>o(792057),d=()=>o(128933),p=()=>o(69708),f=()=>o(547149),m=()=>o(272200),g=()=>o(159495),v=()=>o(401497),h=()=>o(100622),P=o(474848);function b(e){const{favorite:t,isReplacingFavorite:o}=e,n=(0,v().IS)((()=>({title:{fontWeight:700,marginBottom:"1em"},prompt:{color:h().Tj.text.tertiary,maxHeight:"5em",overflowX:"hidden",overflowY:"scroll",whiteSpace:"pre-wrap"}})),[]),i=o?(0,P.jsx)(p().sA,{defaultMessage:"Overwrite “{favoriteName}” AI action?",id:"ai.favoriteActions.importFavorite.overwriteMessage",values:{favoriteName:t.name}}):(0,P.jsx)(p().sA,{defaultMessage:"Add “{favoriteName}” AI action?",id:"ai.favoriteActions.importFavorite.addMessage",values:{favoriteName:t.name}}),r=(0,P.jsx)(p().sA,{defaultMessage:"“{favoritePrompt}”",id:"ai.favoriteActions.importFavorite.prompt",values:{favoritePrompt:t.action.prompt}});return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{style:n.title,children:i}),(0,P.jsx)("div",{style:n.prompt,children:r})]})}var w=()=>o(242422),y=()=>o(726637),I=()=>o(206267),S=()=>o(785728),A=()=>o(388821),M=()=>o(201980),x=()=>o(769864);let k=function(e){return e[e.NoConfig=100]="NoConfig",e[e.LoadPageChunkFailed=101]="LoadPageChunkFailed",e[e.MissingPageRecord=103]="MissingPageRecord",e[e.InvalidPageParent=104]="InvalidPageParent",e[e.MissingTitle=105]="MissingTitle",e[e.MissingPromptText=106]="MissingPromptText",e[e.MissingCollectionSchema=107]="MissingCollectionSchema",e[e.MissingPromptType=108]="MissingPromptType",e[e.InvalidPromptType=109]="InvalidPromptType",e[e.FavoritesDisabled=110]="FavoritesDisabled",e}({});const C="Prompt type",R="Prompt text",F="Run immediately",j="Help me write",V="Help me edit";function T(){{const e=w().default.getConfigKey("gtm_ai_favorites","space_id"),t=w().default.getConfigKey("gtm_ai_favorites","collection_id");if(e&&t)return{spaceId:e,collectionId:t}}}function B(e,t,o){const n=function(e,t,o){for(const i in e){const r=e[i];var n;if(r&&r.name===o)return null===(n=t.properties)||void 0===n?void 0:n[i]}}(e,t,o);if(n)return(0,M().k4p)(n)}function W(e){return{type:"error",code:e}}async function E(e){var t;const{environment:o,blockId:n}=e;await w().default.waitUntilStatsigReady();const i=T();if(!i)return W(k.NoConfig);const{spaceId:r,collectionId:a}=i,s={eventName:"loadCachedPageChunkV2",environment:o,data:{page:{spaceId:r,id:n},cursor:{stack:[]},verticalColumns:!1},headers:(0,S().WS)({spaceId:r,recordId:n}),throwOnError:!1},l=await x().callApi(s);if("success"!==l.type)return W(k.LoadPageChunkFailed);const c=A().RecordMapWithRole.create(l.data.recordMap),u=c.getValue({table:"block",id:n,spaceId:r});if(!u)return W(k.MissingPageRecord);if(u.parent_id!==a)return W(k.InvalidPageParent);const d=(0,M().k4p)(null===(t=u.properties)||void 0===t?void 0:t.title);if(!d)return W(k.MissingTitle);const p=await async function(e){const{environment:t,recordMap:o,blockId:n,spaceId:i,collectionId:r}=e,a=o.getValue({table:"collection",id:r,spaceId:i});if(null!=a&&a.schema)return a.schema;const s=await x().callCellCompatibleApi({eventName:"getPublicPageData",environment:t,data:{type:"block-space",blockId:n,spaceId:i},cellNavigation:{spaceId:i,recordId:n,verifyShortSpaceIdVersion:!0}});return"failed"!==s.type?s.data.collectionSchema:void 0}({environment:o,recordMap:c,blockId:n,spaceId:r,collectionId:a});if(!p)return W(k.MissingCollectionSchema);const f=B(p,u,R);if(!f)return W(k.MissingPromptText);const m=B(p,u,C);if(!m)return W(k.MissingPromptType);const g=(v=m)===V?"helpMeEdit":v===j?"helpMeWrite":void 0;var v;if(!g)return W(k.InvalidPromptType);const h=function(e,t,o){return"Yes"===B(e,t,o)}(p,u,F);return{type:"success",favorite:{id:I().JW(),name:d,executeImmediately:h,gtmFavoriteId:n,action:{type:g,prompt:f,promptTitle:void 0}}}}async function _(e){const{environment:t}=e,o=await E({environment:t,blockId:e.importArgs.blockId});"error"!==o.type?await async function(e){const{environment:t,newFavorite:o}=e,{currentUserSettingsStore:n}=c().default.state;if(!n)return;const i=(0,g().IQ)(n);let r=(0,P.jsx)(p().sA,{defaultMessage:"Add AI action",id:"ai.favoriteActions.importFavorite.addAction"}),a=(0,P.jsx)(p().sA,{defaultMessage:"Cancel",id:"ai.favoriteActions.importFavorite.cancelAction"}),s=(0,P.jsx)(p().sA,{defaultMessage:"“{favoriteName}” AI action added to your Favorites.",id:"ai.favoriteActions.importFavorite.favoriteAdded",values:{favoriteName:o.name}}),l=!1;for(const c of i)if(c.name===o.name){if(c.action.type===o.action.type&&c.action.prompt===o.action.prompt)return void d().D6({label:(0,P.jsx)(p().sA,{defaultMessage:"“{favoriteName}” AI action is already in your Favorites.",id:"ai.favoriteActions.importFavorite.alreadyInFavorites",values:{favoriteName:o.name}})});o.id=c.id,l=!0,r=(0,P.jsx)(p().sA,{defaultMessage:"Overwrite existing AI action",id:"ai.favoriteActions.importFavorite.overwriteAction"}),a=(0,P.jsx)(p().sA,{defaultMessage:"Keep existing AI action",id:"ai.favoriteActions.importFavorite.keepExistingAction"}),s=(0,P.jsx)(p().sA,{defaultMessage:"“{favoriteName}” AI action updated in your Favorites.",id:"ai.favoriteActions.importFavorite.favoriteUpdated",values:{favoriteName:o.name}});break}const{accept:v}=await u().Gh({message:(0,P.jsx)(b,{favorite:o,isReplacingFavorite:l}),acceptLabel:r,cancelLabel:a});if(!v)return;f().createAndCommit({userAction:"favoriteActions.handleFavoriteImport",environment:t,canUndo:!0,perform(e){(0,g().I4)(o,n,e)}}),d().D6({label:s}),m().trackAIFavoriteAction(t,{type:"create_from_url",session_id:void 0,gtm_favorite_id:o.gtmFavoriteId})}({environment:t,newFavorite:o.favorite}):d().D6({label:(0,P.jsx)(p().sA,{defaultMessage:"An error occurred when loading the AI action. ({errorCode})",id:"ai.favoriteActions.importFavorite.favoriteFailedToLoad",values:{errorCode:o.code}})})}var N=()=>o(576590),D=()=>o(532659);async function L({environment:e,type:t,spaceId:o,inputs:n}){for await(const i of async function*({environment:e,type:t,inputs:o,spaceId:n}){if(!n)return;const i=await x().callStreamApi({eventName:"streamCascadeInference",environment:e,data:{type:t,inputs:o,spaceId:n,aiSessionId:I().JW()}});if("success"===i.type&&D().hS.is(i.data))for await(const r of i.data){if("error"===r.type)return;yield r.output}}({environment:e,type:t,inputs:n,spaceId:o}))return i}var O=()=>o(484714),J=()=>o(590526),H=()=>o(534177),K=()=>o(79926);const Z=new(K().O2)("agentWriter",(()=>Promise.all([o.e(75134),o.e(9773),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(92845),o.e(44854),o.e(87017),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(44584),o.e(24587),o.e(67494),o.e(3651),o.e(38293),o.e(40992),o.e(88455),o.e(64556),o.e(33893),o.e(91793),o.e(55162),o.e(71003),o.e(32370),o.e(26264),o.e(36437),o.e(50363),o.e(42660),o.e(44590),o.e(55113),o.e(85071),o.e(7914),o.e(25588),o.e(68637),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(52871),o.e(29351),o.e(18825),o.e(71853),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(34281),o.e(48376),o.e(35279),o.e(80229),o.e(77754),o.e(71309),o.e(74562),o.e(39986),o.e(47431),o.e(47160),o.e(76677),o.e(68609),o.e(15553),o.e(77345),o.e(67720),o.e(37759),o.e(41423),o.e(21627),o.e(57924),o.e(77777),o.e(23493),o.e(42810),o.e(20741),o.e(539)]).then(o.bind(o,721181)))),U=(0,K()._h)(Z,(e=>e.AgentWriterPopup)),z=new(K().O2)("assistantWriter",(()=>Promise.all([o.e(75134),o.e(9773),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(92845),o.e(44854),o.e(87017),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(44584),o.e(24587),o.e(67494),o.e(3651),o.e(38293),o.e(40992),o.e(88455),o.e(64556),o.e(33893),o.e(91793),o.e(55162),o.e(71003),o.e(32370),o.e(26264),o.e(36437),o.e(50363),o.e(42660),o.e(44590),o.e(55113),o.e(85071),o.e(7914),o.e(25588),o.e(68637),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(52871),o.e(29351),o.e(18825),o.e(71853),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(34281),o.e(48376),o.e(35279),o.e(80229),o.e(77754),o.e(71309),o.e(47431),o.e(78984)]).then(o.bind(o,911339)))),G=(0,K()._h)(z,(e=>e.AssistantWriterPopup));var $=()=>o(525569),Q=()=>o(286088),X=(o(16280),()=>o(591779)),Y=()=>o(495159),q=()=>o(111043),ee=()=>o(472090),te=()=>o(171333);function oe(e){const{children:t,scrollerStore:o,openState:n,flushWithBottom:i}=e,[r,a]=(0,l.useState)(Date.now()),s=(0,l.useRef)(null),[c,u]=(0,l.useState)(void 0),d=(0,l.useCallback)((()=>a(Date.now())),[]);(0,l.useEffect)((()=>{const e=new(ee().E),t=s.current;if(!t)throw new Error("ref.current is null");e.observe(t);let o=t.getBoundingClientRect().top;e.rect.addListener((e=>{o=e.state.top,u(e.state)}));const n=setInterval((()=>{const n=t.getBoundingClientRect().top;n!==o&&(o=n,e.recompute())}),50);return()=>{e.destroy(),clearInterval(n)}}),[]);const p="results"===n.stage&&!n.loading,f=("results"===n.stage||"initialPrompt"===n.stage)&&"cursor"===n.context.type,m=(0,J().K8)((()=>{const e=(0,Q().Q9)(n);if(!e)return;const t=(0,Y().LB)(e);if(!t)return;if(!c)return;const o=t.bottom-c.top;return o>0?o:void 0}),[n,c]),g=(0,O().v3)();(0,l.useEffect)((()=>{if(Date.now()-r>500)return;if(!m)return;const e=(0,te().lB)(o);e&&(0,te().Uj)(m,e.getNode(),g)}),[m,o,r,g]),(0,l.useEffect)((()=>{p&&f&&d()}),[p,f,d]);const v="results"===n.stage&&n.loading,h=(0,X().ZC)(v),[b,w]=(0,l.useState)();(0,l.useEffect)((()=>{h&&!v&&w(Date.now())}),[v,h]),(0,l.useEffect)((()=>{const e=!!b&&Date.now()-b<1e3;(v||e)&&f&&m&&d()}),[f,v,d,m,b]);const y=(0,q().o)();return(0,P.jsx)("div",{ref:s,style:{position:"absolute",bottom:y+(i?0:te().jS.bottom),insetInlineStart:i?0:te().jS.left,insetInlineEnd:i?0:te().jS.left,zIndex:99},children:t})}function ne(e){const{scrollerStore:t}=e,o=(0,J().O$)($().default),n=(0,l.useMemo)((()=>(0,Q().SB)(o)),[o]),i=(0,J().K8)((()=>n&&(0,Q().Q9)(n)),[n]),r=(0,O().WS)();return n?t!==(null==i?void 0:i.scrollerStore)?null:"assistantCompletionPopup"===n.type?r?(0,P.jsx)(oe,{scrollerStore:t,openState:n,flushWithBottom:!0,children:(0,P.jsx)(G,{completionState:n})}):(0,P.jsx)(te().x0,{scrollerStore:t,openState:n,children:(0,P.jsx)(G,{completionState:n})}):"agentCompletionPopup"===n.type?(0,P.jsx)(te().x0,{scrollerStore:t,openState:n,freezePosition:"executing"===n.stage,children:(0,P.jsx)(U,{completionState:n})}):void(0,H().HB)(n):null}var ie=()=>o(212497),re=()=>o(406094),ae=()=>o(820579),se=()=>o(742852),le=()=>o(498212);const ce=(0,p().YK)({linkCopied:{defaultMessage:"Link copied. Share it with others who may find this useful.",id:"ai.gtmFavoriteActions.linkCopied"},share:{defaultMessage:"Share as AI favorite",id:"ai.gtmFavoriteActions.share"},add:{defaultMessage:"Add to AI favorites",id:"ai.gtmFavoriteActions.add"}});function ue(e){const{blockId:t,collectionStore:o}=e,n=(0,O().v3)(),i=(0,p().tz)(),r=function(e){const t=(0,J().K8)((()=>{const t=T();return!!t&&t.spaceId===e.getSpaceId()&&t.collectionId===e.id}),[e]);return t}(o),a=(0,l.useCallback)((()=>{_({environment:n,importArgs:{name:"aiGtmFavoriteImport",blockId:t}})}),[t,n]),s=(0,l.useCallback)((async()=>{const e=`${y().A.domainBaseUrl}/ai-gtm/${(0,le().Xw)(t)}`;(await(0,ie().jd)())({environment:n,stringValue:e,copiedMessage:ce.linkCopied})}),[t,n]);return r?(0,P.jsxs)("div",{style:{marginTop:12,marginBottom:12},children:[(0,P.jsx)(re().A,{size:"lg",onClick:s,iconLeading:se().linkIcon,children:i.formatMessage(ce.share)}),n.currentUser.isLoggedIn()?(0,P.jsx)(re().A,{size:"lg",onClick:a,style:{marginInlineStart:12},iconLeading:ae().arrowLineDownIcon,children:i.formatMessage(ce.add)}):void 0]}):null}},892936:(e,t,o)=>{o.r(t),o.d(t,{arrowStraightUpFillIcon:()=>i,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.72 2.12 12.56 15.76",svg:(0,o(474848).jsx)("path",{d:"M10.619 2.381a.875.875 0 0 0-1.238 0l-5.4 5.4A.875.875 0 1 0 5.22 9.02l3.906-3.907V17.05c0 .456.392.826.875.826s.875-.37.875-.826V5.112l3.906 3.907A.875.875 0 1 0 16.02 7.78z"})},i=(0,o(340498).wt)("arrowStraightUpFill",n,"fill")}}]);