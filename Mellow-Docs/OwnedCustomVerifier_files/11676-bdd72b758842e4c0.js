"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[11676],{911676:(e,t,o)=>{o.d(t,{N$:()=>H,aH:()=>Me,lc:()=>j,Hw:()=>He,HZ:()=>qe});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(823215),o(354520),o(672577),o(430670),o(803949),o(581454),o(737550),o(814603),o(147566),o(198721);var n=()=>o(188835),r=o.n(o(43371)),a=()=>o(906745),i=()=>o(319625),s=()=>o(496603),d=()=>o(498212),l=()=>o(534177),c=()=>o(700500),p=()=>o(356246),u=()=>o(713998),m=()=>o(604995),g=()=>o(304740),f=()=>o(634201),h=()=>o(617871),C=()=>o(522419),I=()=>o(165358),b=()=>o(258035),N=()=>o(179034);var w=()=>o(513416),y=()=>o(792071),v=()=>o(134025),x=()=>o(979004),E=()=>o(519831),k=()=>o(343666),_=()=>o(197959),A=()=>o(798880),S=()=>o(201980);const L={CommentAuthor:"cma",CommentDiscussionId:"cmm"},D={a:!0,strong:!0,em:!0,code:!0,del:!0,s:!0,span:!0,time:!0},O={meta:!0,style:!0,script:!0,head:!0,title:!0},B="sourceCode",T=700,P=400,M=1e5,H="#maybeCitation:",q=new RegExp(`^${H}<(.*)>$`);function F(e){if(!e)return;const t=parseInt(e);return isNaN(t)?void 0:t}const j={[S().Ifu.Page]:"data-notion-page-id",[S().Ifu.Collection]:"data-notion-collection-id",spaceId:"data-notion-space-id",[S().Ifu.Highlight]:"data-notion-highlight",[S().Ifu.User]:"data-notion-user-id",[S().Ifu.Discussion]:"data-notion-block-discussion-id",[S().Ifu.Equation]:"data-notion-inline-equation",[S().Ifu.Comment]:"data-notion-block-comment-id",[L.CommentAuthor]:"data-notion-block-comment-author-id",[L.CommentDiscussionId]:"data-notion-block-comment-discussion-id",[c().xd.code]:"data-notion-code-syntax",[c().xd.callout]:"data-notion-callout",calloutIcon:"data-notion-callout-icon",calloutBackground:"data-notion-callout-background",[c().xd.tableOfContents]:"data-notion-toc",[c().xd.file]:"data-notion-file",fileAlias:"data-notion-file-alias",[c().xd.columnList]:"data-notion-column-list",[c().xd.column]:"data-notion-column-ratio",[c().xd.video]:"data-notion-video",[c().xd.audio]:"data-notion-audio",[c().xd.pdf]:"data-notion-pdf",[c().xd.equation]:"data-notion-equation",dateFormat:"data-notion-date-format",[c().xd.externalObjectInstance]:"data-notion-link-preview",[c().xd.embed]:"data-notion-embed"},U="Lucidchart",W="Jira",$="JiraDC";h().me,h().Fv,h().me,h().Fv,h().me,h().Fv;function z(e,t){return t&&t.nodeType===e.Node.ELEMENT_NODE}function R(e,t){return e.nodeType===t.Node.TEXT_NODE||e instanceof t.Element&&D[e.tagName.toLowerCase()]}function V(e,t,o,n=[]){var r;if(t&&1===e.nodeType&&e.hasAttribute(j[S().Ifu.Comment]))return n;if(o&&"pre"===(null===(r=e.tagName)||void 0===r?void 0:r.toLowerCase()))return n;n.push(e);for(const a of f().PE(e.childNodes))V(a,t,o,n);return n}function Q(e){const t=[];if(!e.parentNode)return t;let o=e.parentNode;for(;o;)t.push(o),o=o.parentNode||void 0;return t}function G(e,t){const o=Q(e).filter((e=>e instanceof t.Element&&("ul"===e.tagName.toLowerCase()||"ol"===e.tagName.toLowerCase()))).length;return o}const J=["•","◦","▪"],Y=["h1","h2","h3","h4","h5","h6"].map((e=>`${e}:not(:first-child)`)).join(", ");function K(e){const{node:t,window:o,stripText:n,stripSurroundingWhitespace:r,timeZone:i,ignoreComments:s,deps:l,ignoreCodeBlock:p,preserveLineBreaksInTableCellsEnabled:u}=e;if(!n){for(const e of Array.from(t.querySelectorAll("p:not(:first-child)")))e.prepend("\n");for(const e of Array.from(t.querySelectorAll(Y)))e.prepend("\n");for(const e of Array.from(t.querySelectorAll("ul > li"))){const t=G(e,o)-1,n=t%J.length,r=J[n],a="    ".repeat(t);e.prepend(`\n${a}${r} `)}for(const e of Array.from(t.querySelectorAll("ol"))){const t=G(e,o),n="    ".repeat(t);for(let o=0;o<e.children.length;o+=1){e.children[o].prepend(`\n${n}${o+1}. `)}}for(const e of Array.from(t.querySelectorAll("pre")))e.parentNode&&e.parentNode.insertBefore(o.document.createTextNode("\n\n"),e)}const g=[],f=[],h=V(t,s,p);let C=!1;const I=h.filter((e=>e.nodeType!==o.Node.TEXT_NODE?!!(u&&e instanceof o.Element&&"br"===e.tagName.toLowerCase())&&(e.data="\n",C=!0,!0):!n||!/^( |\t)*(\n)+( |\t)*$/.test(e.data)));let b=!0;I.forEach(((e,s)=>{let p=e.data;n&&(p=p.replace(/\[ \] /g,""),p=p.replace(/\[x\] /g,""),p=p.replace(/^[\-\*\•]\s?/g,""),p=p.replace(/(\s)+/g,"$1")),!t.hasAttribute("confluenceTabSpaces")&&0===s&&r&&(p=p.trimStart()),p=S().xV3(p),s===I.length-1&&b&&r&&(p=p.trimEnd());const u=[],h=Q(e);let C;!n&&h.some((e=>e instanceof o.Element&&("h1"===e.tagName.toLowerCase()||"h2"===e.tagName.toLowerCase()||"h3"===e.tagName.toLowerCase()||"h4"===e.tagName.toLowerCase()||"h5"===e.tagName.toLowerCase()||"h6"===e.tagName.toLowerCase())))&&u.push([S().Ifu.Bold]),h.some((e=>e instanceof o.Element&&"strong"===e.tagName.toLowerCase()))&&u.push([S().Ifu.Bold]),h.some((e=>e instanceof o.Element&&"em"===e.tagName.toLowerCase()))&&u.push([S().Ifu.Italic]),h.some((e=>e instanceof o.Element&&"u"===e.tagName.toLowerCase()))&&u.push([S().Ifu.Underline]),h.some((e=>e instanceof o.Element&&("code"===e.tagName.toLowerCase()||"pre"===e.tagName.toLowerCase())))&&u.push([S().Ifu.Code]),h.some((e=>e instanceof o.Element&&("del"===e.tagName.toLowerCase()||"strike"===e.tagName.toLowerCase()||"s"===e.tagName.toLowerCase())))&&u.push([S().Ifu.Strike]);const w=h.find((e=>{var t;return e instanceof o.Element&&(e.hasAttribute(j[S().Ifu.Highlight])||(null===(t=e.parentElement)||void 0===t?void 0:t.hasAttribute(j[S().Ifu.Highlight])))}));if(w&&w instanceof o.Element){var y;const e=w.getAttribute(j[S().Ifu.Highlight]),t=null===(y=w.parentElement)||void 0===y?void 0:y.getAttribute(j[S().Ifu.Highlight]),o=Ue(e&&"undefined"!==e?e||"":t||"");o&&u.push([S().Ifu.Highlight,o])}const v=h.find((e=>e instanceof o.Element&&"a"===e.tagName.toLowerCase()));if(v){const e=v.getAttribute(j[S().Ifu.Page]),t=v.getAttribute("notionUserId")||v.getAttribute(j[S().Ifu.User]),o=v.getAttribute(j.spaceId),n=v.getAttribute(j[S().Ifu.Comment]),r=v.getAttribute(j[S().Ifu.Collection]);if("string"==typeof e&&(0,d().uj)(e)&&"string"==typeof o&&(0,d().uj)(o))C=S().ld4(e,o);else if("string"==typeof r&&(0,d().uj)(r)&&"string"==typeof o&&(0,d().uj)(o))C=S().ETy({collectionId:r,spaceId:o,parentCvbId:void 0});else if(v.href){const e=q.exec(decodeURIComponent(v.hash));e?u.push(S().Sez(decodeURIComponent(e[1]))):u.push(S().Sez(v.href))}else"string"==typeof t&&(0,d().uj)(t)?(C=S().P4h(t),v.getAttribute("notionUserId")&&s===I.length-2&&(b=!1)):n&&o&&(0,d().uj)(n)&&(0,d().uj)(o)&&(C=S().hiQ(n,o))}const x=h.find((e=>!!(e instanceof o.Element&&e.getAttribute(j[S().Ifu.Discussion])))),E=t.classList.contains("page-comment");if(x&&!E){const e=x.getAttribute(j[S().Ifu.Discussion]);if(e){e.split(",").forEach((e=>u.push(S().aQj(e))))}}const k=h.find((e=>e instanceof o.Element&&"sub"===e.tagName.toLowerCase()));let _;"true"===(null==k?void 0:k.getAttribute("confluenceProcessableEquation"))&&(_=`_{${k.textContent}}`);const A=h.find((e=>e instanceof o.Element&&"sup"===e.tagName.toLowerCase()));let L;"true"===(null==A?void 0:A.getAttribute("confluenceProcessableEquation"))&&(L=`^{${A.textContent}}`);const D=h.find((e=>e instanceof o.Element&&e.hasAttribute(j[S().Ifu.Equation])));let O;null!=D&&D.textContent&&(O=D.textContent);const B=h.find((e=>e instanceof o.Element&&"time"===e.tagName.toLowerCase()));if(B){const e=B.getAttribute("datetime");if(e){const t=function(e,t){const o=a().DateTime.fromISO(e),n=o.toMillis();return n===o.startOf("day").toMillis()?m().C6.toPersistedDate(n,t):m().C6.toPersistedDateTime(n,t)}(e,i),o={...t};"relative"===B.getAttribute(j.dateFormat)&&(o.date_format="relative"),C=S().Ww9(o)}}const T=h.find((e=>!!(e instanceof o.Element&&e instanceof o.HTMLSpanElement&&e.getAttribute(j[c().xd.externalObjectInstance]))));if(C)g.push(S().wmz(C,u));else if(_)g.push(S().G0H(_,u));else if(L)g.push(S().G0H(L,u));else if(O)g.push(S().G0H(O,u));else if(T&&null!=l&&l.randomID){var P;const e=(null==l||null===(P=l.spaceIdCreator)||void 0===P?void 0:P.idInSavedSpace(N().ev))??l.randomID();g.push(S().wmz(S().bMp(e),u)),f.push(e)}else g.push(S().Ey_(p,u))}));const w=S().JG8(g,M),y=S().__s(w);if(C){const e=S().Ey_("",[[S().Ifu.Link,""]]);y.push(e)}return{titleTokens:y,linkMentionBlockIds:f}}function X(e,t){const o=["img[src]","a[download]",`a[${j[c().xd.file]}]`,`audio[${j[c().xd.audio]}]`,`video[${j[c().xd.video]}]`,"li"];t&&o.push("pre");const n=e.querySelectorAll(o.join(","));return f().PE(n)}function Z(e){const{actor:t,parent:o,node:n,allOperations:r,deps:{importFileMap:a,window:i,intl:s,randomID:d,spaceIdCreator:l,randomShortID:c,isPhoneNumber:p},options:{legacyNonCrdt:u,ignoreBlockCount:m,considerCodeBlockAsNonTextItem:g,ignoreImages:f}}=e;return xe({actor:t,parent:o,nodes:X(n,g),allOperations:r,deps:{importFileMap:a,window:i,intl:s,randomID:d,spaceIdCreator:l,randomShortID:c,isPhoneNumber:p},options:{legacyNonCrdt:u,ignoreBlockCount:m,ignoreImages:f}})}function ee(e){const{actor:t,parent:o,node:n,type:r,allOperations:a,options:{legacyNonCrdt:i,ignoreBlockCount:s,stripText:d,stripSurroundingWhitespace:l,ignoreCodeBlock:p},deps:{window:u,randomID:m,spaceIdCreator:g}}=e,f=(null==g?void 0:g.idInSavedSpace(N().ev))??m(),{titleTokens:h,linkMentionBlockIds:C}=K({node:n,window:u,stripText:d,stripSurroundingWhitespace:l,ignoreComments:!0,ignoreCodeBlock:p,deps:{randomID:m,spaceIdCreator:g}}),{operations:I}=y().zgg.create({id:f,type:r,properties:{title:h},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!s||void 0,legacyNonCrdt:i});if(a.push(...I),C.length){const e=n.querySelectorAll(`span[${j[c().xd.externalObjectInstance]}]`);for(const[n,r]of Array.from(e).entries())C[n]&&de({actor:t,parent:o,node:r,allOperations:a,deps:{randomID:m,spaceIdCreator:g},options:{legacyNonCrdt:i,ignoreBlockCount:s},blockId:C[n]})}return ye({node:n,spaceId:o.spaceId,window:u,blockId:f,actor:t,allOperations:a}),f}function te(e){const{actor:t,parent:o,allOperations:n,deps:{randomID:r,spaceIdCreator:a},options:{legacyNonCrdt:i,ignoreBlockCount:s}}=e,d=(null==a?void 0:a.idInSavedSpace(N().ev))??r(),{operations:l}=y().zgg.create({id:d,type:c().xd.divider,parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!s||void 0,legacyNonCrdt:i});return n.push(...l),d}function oe(e){const{actor:t,parent:o,source:n,allOperations:r,deps:{randomID:a,spaceIdCreator:i},options:{legacyNonCrdt:s,ignoreBlockCount:d,fallbackWidth:l},node:p}=e;let u;"image"===n.type&&n.width?u=Math.min(n.width,T):l&&(u=Math.min(l,T));const m=(null==i?void 0:i.idInSavedSpace(N().ev))??a(),g=p.getAttribute("alt"),f={source:S().x9d(n.secureS3UrlOrAlias)};g&&(f.alt_text=S().x9d(g));const h=p.getAttribute("data-caption");h&&(f.caption=S().x9d(h));const{model:C,operations:I}=y().zgg.create({id:m,type:c().xd.image,properties:f,format:{block_width:u},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!d||void 0,legacyNonCrdt:s});return r.push(...I,C.DEPRECATED_DONT_CALL_WILL_BE_REMOVED_IN_Q2_2025___getSecureFilesUpdate("","")),m}function ne(e){const{actor:t,parent:o,node:n,sourceUrl:r,allOperations:a,deps:{randomID:i,spaceIdCreator:s},options:{legacyNonCrdt:d,ignoreBlockCount:l}}=e,c=F(n.getAttribute("height")),p=F(n.getAttribute("width")),u=(null==s?void 0:s.idInSavedSpace(N().ev))??i();let m;try{m=new URL(r)}catch(C){m=r}const f=g().WT({url:r,baseUrl:m instanceof URL?m.origin:m,publicDomainName:""}),{operations:h}=y().zgg.create({id:u,type:f,properties:{source:S().x9d(r)},format:{block_width:p,block_height:c,block_full_width:!1,block_page_width:!(p||c),block_preserve_scale:!0},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!l||void 0,legacyNonCrdt:d});return a.push(...h),u}function re(e){const{actor:t,parent:o,source:n,allOperations:r,deps:{randomID:a,spaceIdCreator:i},options:{legacyNonCrdt:s,ignoreBlockCount:d}}=e,l=(null==i?void 0:i.idInSavedSpace(N().ev))??a(),c=g().WT({url:n.secureS3UrlOrAlias,baseUrl:n.secureS3UrlOrAlias,publicDomainName:""}),p="embed"===c?"file":c,{model:u,operations:m}=y().zgg.create({id:l,type:p,properties:{title:S().x9d((0,C().Jt)(n.secureS3UrlOrAlias)),source:[S().Ey_(n.secureS3UrlOrAlias,[S().Sez(n.secureS3UrlOrAlias)])]},format:{block_width:"image"===n.type&&n.width?Math.min(n.width,T):void 0,block_height:n.height?Math.min(n.height,P):void 0},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!d||void 0,legacyNonCrdt:s});return r.push(...m,u.DEPRECATED_DONT_CALL_WILL_BE_REMOVED_IN_Q2_2025___getSecureFilesUpdate("","")),l}function ae(e){if("#text"===e.nodeName)return e.textContent?e.textContent:"";return Array.from(e.childNodes).map((e=>{const t=e.nodeName.toLowerCase();return"br"===t?"\n":"div"===t?`${ae(e)}\n`:ae(e)})).join("").split("\n").map((e=>e.trimRight())).join("\n")}function ie(e){const{actor:t,parent:o,node:n,allOperations:a,htmlParserErrors:i,deps:{importFileMap:s,window:d,intl:l,randomID:p,spaceIdCreator:u,randomShortID:m,isPhoneNumber:g},options:{legacyNonCrdt:h,ignoreBlockCount:C}}=e,I=(null==u?void 0:u.idInSavedSpace(N().ev))??p(),b=n.getAttribute(j.calloutBackground),w=b?Ue(b):void 0,v=n.getAttribute(j.calloutIcon),x=v&&v.match(r()())?v:void 0,{title:E,children:k}=function(e){const{node:t,window:o}=e,n=f().PE(t.childNodes),[r,...a]=n;if(!r)return{title:[]};if(function(e){return t=>!!(z(e,t)&&t instanceof e.HTMLParagraphElement)}(o)(r)){const{titleTokens:e}=K({node:r,window:o,stripText:!1,stripSurroundingWhitespace:!0,ignoreComments:!0});return{title:e,children:a}}if(R(r,o)){const{titleTokens:e}=K({node:t,window:o,stripText:!1,stripSurroundingWhitespace:!0,ignoreComments:!0});return{title:e,children:void 0}}return{title:[],children:n}}({node:n,window:d}),_=Array.isArray(k)?xe({actor:t,parent:{table:N().ev,id:I,spaceId:o.spaceId},nodes:k,allOperations:a,htmlParserErrors:i,deps:{importFileMap:s,window:d,intl:l,randomID:p,spaceIdCreator:u,randomShortID:m,isPhoneNumber:g},options:{legacyNonCrdt:h,ignoreBlockCount:C}}):[],{operations:A}=y().zgg.create({id:I,type:c().xd.callout,content:_,properties:{title:E},format:{block_color:w,page_icon:x},parentPointer:{id:o.id,table:o.table,spaceId:o.spaceId},space_id:o.spaceId,createdBy:t,ignore_block_count:!!C||void 0,legacyNonCrdt:h});return a.push(...A),ye({node:n,spaceId:o.spaceId,window:d,blockId:I,actor:t,allOperations:a}),I}function se(e){const{actor:t,parent:o,node:n,allOperations:r,deps:{importFileMap:a,randomID:i,spaceIdCreator:s},options:{legacyNonCrdt:d,ignoreBlockCount:l}}=e,p=n.getAttribute(j[c().xd.file])||"",u=a[p]?a[p].secureS3UrlOrAlias:p;let m=n.getAttribute(j.fileAlias)||"";!m&&u.lastIndexOf("/")>=0&&(m=u.substring(u.lastIndexOf("/")+1));const g=(null==s?void 0:s.idInSavedSpace(N().ev))??i(),{model:f,operations:h}=y().zgg.create({createdBy:t,id:g,parentPointer:{id:o.id,table:o.table,spaceId:o.spaceId},space_id:o.spaceId,properties:{source:S().x9d(u),title:S().x9d(m)},type:c().xd.file,ignore_block_count:!!l||void 0,legacyNonCrdt:d});return r.push(...h,f.DEPRECATED_DONT_CALL_WILL_BE_REMOVED_IN_Q2_2025___getSecureFilesUpdate("","")),g}function de(e){const{actor:t,parent:o,node:r,allOperations:a,deps:{randomID:i,spaceIdCreator:s},options:{legacyNonCrdt:d,ignoreBlockCount:l}}=e,p=e.blockId?e.blockId:(null==s?void 0:s.idInSavedSpace(N().ev))??i();let u;const m="true"===r.getAttribute("bot-connected"),g=r.getAttribute("href"),f=r.getAttribute(j[c().xd.externalObjectInstance]);if(I().log({level:"info",from:"htmlHelpers",type:"linkPreviewStatus",data:{miscDataToConvertToString:{linkPreviewUrl:g,linkPreviewIntegration:f,isBotConnected:m,unfurlMetadataStr:r.getAttribute("metadata"),domainName:g?n().parse(g).hostname:void 0}}}),!g||!f)return;const h=n().parse(g).hostname;if(!h)return;if(m){const e=r.getAttribute("metadata");if(e){let t;try{t=JSON.parse(e)}catch(b){}u=t&&t.uri&&t.external_object_id&&t.bot_id&&t.attributes?{original_url:t.uri,domain:h,external_object_id:t.external_object_id,bot_id:t.bot_id,uri:t.uri,attributes:t.attributes}:{original_url:g,domain:h,error:{status_code:w().xB.BAD_REQUEST}}}else u={original_url:g,domain:h,error:{status_code:w().xB.BAD_REQUEST}}}else u={original_url:g,domain:h};if(!u)return;const{operations:C}=y().zgg.create({createdBy:t,id:p,parentPointer:{id:o.id,table:"block",spaceId:o.spaceId},type:c().xd.externalObjectInstance,space_id:o.spaceId,format:u,ignore_block_count:!!l||void 0,legacyNonCrdt:d});return a.push(...C),p}const le=/language-(\w+)/;function ce(e){let t=null;return null==e||e.forEach(((e,o,n)=>{if(t)return;if(x().fileExtensionToCodeLanguageMap.hasOwnProperty(e))return void(t=e);const r=e.match(le);r&&r.length>1&&x().fileExtensionToCodeLanguageMap.hasOwnProperty(r[1])&&(t=r[1])})),t}function pe(e){const{actor:t,parent:o,node:n,allOperations:r,deps:{randomID:a,spaceIdCreator:i,window:s},options:{legacyNonCrdt:d,ignoreBlockCount:p,codePreviewFormat:u}}=e,m=(null==i?void 0:i.idInSavedSpace(N().ev))??a();let g=n.getAttribute(j[c().xd.code]);if(!g){var f;g=ce(null===(f=n.querySelector("code"))||void 0===f||null===(f=f.parentElement)||void 0===f?void 0:f.classList)}if(!g){var h;g=ce(null===(h=n.querySelector("code"))||void 0===h?void 0:h.classList)}const C=g&&(0,l().O)(x().fileExtensionToCodeLanguageMap,g)?x().fileExtensionToCodeLanguageMap[g]:"Plain Text",{operations:I}=y().zgg.create({id:m,type:c().xd.code,properties:{title:S().x9d(ae(n)),language:[[C]]},format:{code_wrap:!0,code_preview_format:u},parentPointer:{id:o.id,table:o.table,spaceId:o.spaceId},space_id:o.spaceId,createdBy:t,ignore_block_count:!!p||void 0,legacyNonCrdt:d});return r.push(...I),ye({node:n,spaceId:o.spaceId,window:s,blockId:m,actor:t,allOperations:r}),m}function ue(e){const{actor:t,parent:o,node:n,allOperations:r,deps:{randomID:a,spaceIdCreator:i},options:{legacyNonCrdt:s,ignoreBlockCount:d}}=e,l=(null==i?void 0:i.idInSavedSpace(N().ev))??a(),{operations:p}=y().zgg.create({id:l,type:c().xd.equation,properties:{title:S().x9d(ae(n))},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!d||void 0,legacyNonCrdt:s});return r.push(...p),l}function me(e){const{actor:t,parent:o,allOperations:n,deps:{randomID:r,spaceIdCreator:a},options:{legacyNonCrdt:i,ignoreBlockCount:s}}=e,d=(null==a?void 0:a.idInSavedSpace(N().ev))??r(),{operations:l}=y().zgg.create({id:d,type:c().xd.tableOfContents,format:{block_color:"gray"},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!s||void 0,legacyNonCrdt:i});return n.push(...l),d}function ge(e){const{actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:d,randomID:l,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{legacyNonCrdt:g,ignoreBlockCount:h}}=e,C=(null==p?void 0:p.idInSavedSpace(N().ev))??l(),[I,...b]=f().PE(n.childNodes),w=xe({actor:t,parent:{id:C,table:N().ev,spaceId:o.spaceId},nodes:b,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:d,randomID:l,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{legacyNonCrdt:g,ignoreBlockCount:h}}),{operations:v}=y().zgg.create({id:C,type:c().xd.quote,properties:{title:S().x9d(null!=I&&I.textContent?I.textContent.trim():"")},content:w,parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!h||void 0,legacyNonCrdt:g});return r.push(...v),ye({node:n,spaceId:o.spaceId,blockId:C,actor:t,allOperations:r,window:s}),C}function fe(e){const{actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:d,randomID:l,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{legacyNonCrdt:g,ignoreBlockCount:h}}=e,C=(null==p?void 0:p.idInSavedSpace(N().ev))??l(),I=n.querySelector("summary"),b=f().PE(n.childNodes).filter((e=>e!==I)),w=I&&I.textContent&&(()=>{const{titleTokens:e}=K({node:I,window:s,stripText:!1,stripSurroundingWhitespace:!0,ignoreComments:!0,deps:{randomID:l,spaceIdCreator:p}});return e})(),v=xe({actor:t,parent:{id:C,table:N().ev,spaceId:o.spaceId},nodes:b,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:d,randomID:l,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{legacyNonCrdt:g,ignoreBlockCount:h}}),{operations:x}=y().zgg.create({id:C,type:c().xd.toggle,content:v,properties:{title:w||S().x9d("")},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!h||void 0,legacyNonCrdt:g});return r.push(...x),C}function he(e){const{actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:d,randomID:l,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{legacyNonCrdt:g,ignoreBlockCount:h}}=e,C=(null==p?void 0:p.idInSavedSpace(N().ev))??l(),I=f().PE(n.children).filter((e=>e.hasAttribute(j[c().xd.column]))).slice(0,8).map((e=>function(e){const{actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:d,randomID:l,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{legacyNonCrdt:g,ignoreBlockCount:h}}=e,C=(null==p?void 0:p.idInSavedSpace(N().ev))??l(),I=n.getAttribute(j[c().xd.column]);let b;if(null!==I){const e=parseFloat(I);!Number.isNaN(e)&&e>0&&e<=1&&(b=e)}const w=xe({actor:t,parent:{id:C,table:N().ev,spaceId:o.spaceId},nodes:f().PE(n.children),allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:d,randomID:l,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{legacyNonCrdt:g,ignoreBlockCount:h}}),{operations:v}=y().zgg.create({id:C,type:c().xd.column,format:{column_ratio:b},content:w,parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!h||void 0,legacyNonCrdt:g});return r.push(...v),C}({actor:t,parent:{id:C,table:N().ev,spaceId:o.spaceId},node:e,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:d,randomID:l,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{legacyNonCrdt:g,ignoreBlockCount:h}}))),{operations:b}=y().zgg.create({id:C,type:c().xd.columnList,content:I,parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!h||void 0,legacyNonCrdt:g});return r.push(...b),C}const Ce=/^\[x\].*/,Ie=/^\[ \].*/,be=/^[-\*\•].*/;function Ne(e){const{actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:d,randomID:l,spaceIdCreator:u,randomShortID:m,isPhoneNumber:g},options:{legacyNonCrdt:h,ignoreBlockCount:C}}=e,I=(null==u?void 0:u.idInSavedSpace(N().ev))??l(),b=s.document.createElement("span"),w=[];f().PE(n.childNodes).forEach(((e,t)=>{(function(e,t){return e instanceof t.Element&&"a"===e.tagName.toLowerCase()&&e.hasAttribute("data-confluence-web-image")})(e,s)||0===t&&function(e,t){return e instanceof t.Element&&"a"===e.tagName.toLowerCase()&&e.hasAttribute(j[c().xd.file])}(e,s)?w.push(e):0===t&&!(function(e,t){return e instanceof t.Element&&"img"===e.tagName.toLowerCase()}(e,s)||function(e,t){return e instanceof t.Element&&"video"===e.tagName.toLowerCase()}(e,s)||function(e,t){return e instanceof t.Element&&"audio"===e.tagName.toLowerCase()}(e,s))||R(e,s)?(b.appendChild(e),e instanceof s.Element&&X(e).forEach((e=>w.push(e)))):w.push(e)}));const v=xe({actor:t,parent:{id:I,table:N().ev,spaceId:o.spaceId},nodes:w,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:d,randomID:l,spaceIdCreator:u,randomShortID:m,isPhoneNumber:g},options:{legacyNonCrdt:h,ignoreBlockCount:C}}),x=Ce.test(b.textContent||""),E=Ie.test(b.textContent||"");let k;k=x||E?c().xd.toDo:n.parentNode instanceof s.Element&&"ol"===n.parentNode.tagName.toLowerCase()?c().xd.numberedList:c().xd.bulletedList;let _=!1;k===c().xd.toDo&&x&&(_=!0);const{titleTokens:A}=K({node:b,window:s,stripText:!0,stripSurroundingWhitespace:!0,ignoreComments:!0,deps:{randomID:l,spaceIdCreator:u}}),{operations:L}=y().zgg.create({id:I,type:k,content:v,properties:{title:A,checked:_?S().x9d(p().I1):void 0},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!C||void 0,legacyNonCrdt:h});return r.push(...L),ye({node:b,spaceId:o.spaceId,blockId:I,actor:t,allOperations:r,window:s}),I}function we(e){const{node:t,spaceId:o,window:n,actor:r,discussionId:a,allOperations:i,deps:s,options:d}=e,l=Array.from(t.querySelectorAll(`span[${j[L.CommentDiscussionId]}="${a}"]`)),c=Date.now(),p=[];for(const u of l){if(null===u.textContent||0===u.textContent.trim().length)continue;const e=u.getAttribute(j[S().Ifu.Comment]);if(!e)continue;const{titleTokens:l}=K({node:u,window:n,stripText:!0,stripSurroundingWhitespace:!0,ignoreComments:!1}),m=u.getAttribute(j[L.CommentAuthor]);p.push(e);const g=s&&d&&Z({actor:r,parent:{table:k().SN,id:e,spaceId:o},node:t,allOperations:i,deps:s,options:d}),f={id:e,parent_id:a,parent_table:_().$Y,space_id:o,version:1,created_time:c,last_edited_time:c,text:l,created_by_table:A().oo,created_by_id:m||r.id,alive:!0,...g&&{content:g}};i.push(v().op.set({pointer:{table:k().SN,id:e,spaceId:o},path:[],args:f}))}return p}function ye(e){const{node:t,spaceId:o,blockId:n,actor:r,allOperations:a,window:i}=e,s=Array.from(t.querySelectorAll(`span[${j[S().Ifu.Discussion]}]`)),d=new Map;for(const l of s){const e=l.getAttribute(j[S().Ifu.Discussion]);if(!e)continue;e.split(",").forEach((e=>{if(d.has(e)){var t;null===(t=d.get(e))||void 0===t||null===(t=t.context)||void 0===t||t.push([l.textContent??"",[[S().Ifu.Discussion,e]]])}else{const t={id:e,type:"default",parent_id:n,parent_table:N().ev,resolved:!1,context:[[l.textContent??"",[[S().Ifu.Discussion,e]]]],space_id:o,version:0};d.set(e,t)}}))}ve({node:t,spaceId:o,window:i,blockId:n,actor:r,discussionToTextMap:d,allOperations:a})}function ve(e){const{node:t,spaceId:o,window:n,blockId:r,actor:a,discussionToTextMap:i,allOperations:s,deps:d,options:l}=e;for(const[c,p]of i.entries()){const e=we({node:t,spaceId:o,window:n,discussionId:c,actor:a,allOperations:s,deps:d,options:l});p.comments=e,s.push(v().op.set({pointer:{table:_().$Y,id:c,spaceId:o},path:[],args:p}),{pointer:{table:N().ev,id:r,spaceId:o},command:"listAfter",path:["discussions"],args:{id:c}})}}function xe(e){const{actor:t,parent:o,nodes:n,allOperations:r,deps:a,htmlParserErrors:i,options:d}=e;return s().KC(...n.map((e=>Ee({actor:t,parent:o,node:e,allOperations:r,deps:a,htmlParserErrors:i,options:d}))))}function Ee(e){const{actor:t,parent:o,node:n,allOperations:r,deps:a,htmlParserErrors:d,options:l}=e,{importFileMap:p,window:m,intl:h,randomID:C,spaceIdCreator:I,blockContentMaxSize:w}=a,{legacyNonCrdt:y,ignoreBlockCount:v,treatNestedCodeAsCodeBlocks:x,skipTableToCollectionConversion:A,preserveLineBreaksInTableCellsEnabled:L,addHeadersToCollectionEnabled:D,codePreviewFormat:O,ignoreImages:T}=l;if(n&&n instanceof m.Element){const e=n.tagName.toLowerCase();if("div"===e&&"page-comments"===n.getAttribute("class")){const e=function(e){var t;const{node:o,parent:n,actor:r,window:a,allOperations:i,deps:s,options:d}=e,l=o.getAttribute(j[S().Ifu.Discussion])||((null===(t=s.spaceIdCreator)||void 0===t?void 0:t.idInSavedSpace(_().$Y))??s.randomID()),c=new Map;return c.set(l,{type:"default",id:l,parent_id:n.id,parent_table:N().ev,resolved:!1,space_id:n.spaceId,version:1}),ve({node:o,spaceId:n.spaceId,window:a,blockId:n.id,discussionToTextMap:c,allOperations:i,actor:r,deps:s,options:d}),l}({node:n,window:m,actor:t,allOperations:r,parent:o,deps:a,options:l});return[e]}if("h1"===e)return[ee({actor:t,parent:o,node:n,type:c().xd.header,allOperations:r,deps:{window:m,randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v,stripText:!0,stripSurroundingWhitespace:!0}}),...Z({actor:t,parent:o,node:n,allOperations:r,deps:a,options:{legacyNonCrdt:y,ignoreBlockCount:v}})];if("h2"===e)return[ee({actor:t,parent:o,node:n,type:c().xd.subHeader,allOperations:r,deps:{window:m,randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v,stripText:!0,stripSurroundingWhitespace:!0}}),...Z({actor:t,parent:o,node:n,allOperations:r,deps:a,options:{legacyNonCrdt:y,ignoreBlockCount:v}})];if("hr"===e)return[te({actor:t,parent:o,allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v}})];if("h"===e[0])return[ee({actor:t,parent:o,node:n,type:c().xd.subSubHeader,allOperations:r,deps:{window:m,randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v,stripText:!0,stripSurroundingWhitespace:!0}}),...Z({actor:t,parent:o,node:n,allOperations:r,deps:a,options:{legacyNonCrdt:y,ignoreBlockCount:v}})];if("pre"===e||"code"===e||"div"===e&&n.className===B)return n.innerHTML.length&&w&&w>0&&n.innerHTML.length>w?[]:[pe({actor:t,parent:o,node:n,allOperations:r,deps:{randomID:C,spaceIdCreator:I,window:m},options:{legacyNonCrdt:y,ignoreBlockCount:v,codePreviewFormat:O}}),...Z({actor:t,parent:o,node:n,allOperations:r,deps:a,options:{legacyNonCrdt:y,ignoreBlockCount:v}})];if(n.hasAttribute(j[c().xd.callout]))return[ie({actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:d,deps:a,options:{legacyNonCrdt:y,ignoreBlockCount:v}})];if("blockquote"===e)return[ge({actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:d,deps:a,options:{legacyNonCrdt:y,ignoreBlockCount:v}})];if("details"===e)return[fe({actor:t,parent:o,node:n,allOperations:r,deps:a,htmlParserErrors:d,options:{legacyNonCrdt:y,ignoreBlockCount:v}})];if("table"===e){const{tableData:l,tableFiles:g,hasHeaderRow:f,hasHeaderColumn:C}=function(e){const{node:t,window:o,importFileMap:n,intl:r,preserveLineBreaksInTableCellsEnabled:a}=e,i=[],d=[],l=Array.from(t.querySelectorAll("tr")).filter((e=>e.closest("table")===t));let p=!1,m=!1;if(l.length>0){const e=l[0].querySelectorAll("td, th"),t=l[0].querySelectorAll("th");if(p=e.length>0&&t.length===e.length,m=l.every((e=>{const t=e.querySelector("td, th");return t&&"th"===t.tagName.toLowerCase()}))&&l.length>0,p&&m){const e=l[0].querySelector("td, th");if(!(e&&"th"===e.tagName.toLowerCase())){t.length>=l.filter((e=>{const t=e.querySelector("td, th");return t&&"th"===t.tagName.toLowerCase()})).length?m=!1:p=!1}}}for(const g of l){const e=[],t=[],l=Array.from(g.querySelectorAll("td, th")).filter((e=>e.closest("tr")===g));for(const r of l){const i=(r.textContent||"").trim(),d=ke(r.getAttribute("rowspan"),1),{titleTokens:l}=K({node:r,window:o,stripText:!1,stripSurroundingWhitespace:!0,ignoreComments:!0,preserveLineBreaksInTableCellsEnabled:a});e.push({text:i,textValue:l,rowSpan:d});const p=ke(r.getAttribute("colspan"),1);for(let t=1;t<p;t++)e.push({text:"",rowSpan:d});const u=X(r);if(u.length){const e=s().oE(u.flatMap((e=>{var t;const o=e.getAttribute("src")||e.getAttribute(j[c().xd.file])||e.getAttribute(j[c().xd.audio])||e.getAttribute(j[c().xd.video]),r=e.getAttribute(j.fileAlias);return o?{name:r||o,url:(null===(t=n[o])||void 0===t?void 0:t.secureS3UrlOrAlias)||o}:void 0})));t.push(...e)}}e.length&&d.push(e);const p=u().eQ(t);i.push({text:r.formatMessage({id:"htmlHelpers.table.fileColumnName",defaultMessage:"Files"}),textValue:p})}for(let s=0;s<d.length;s++){const e=d[s];for(let t=0;t<e.length;t++){const o=e[t].rowSpan;if(o>1)for(let e=1;e<o&&!(s+e>=d.length);e++){d[s+e].splice(t,0,{text:"",rowSpan:1})}}}return{tableData:d,tableFiles:i,hasHeaderRow:p,hasHeaderColumn:m}}({node:n,window:m,importFileMap:p,intl:h,preserveLineBreaksInTableCellsEnabled:L});if(!A&&g.some((e=>{var t;return null===(t=e.textValue)||void 0===t?void 0:t.length})))for(let e=0;e<l.length;e++)l[e].push({text:g[e].text,textValue:g[e].textValue,columnType:{schema:{type:"file"},validate:s().vF,coerce:s().D_}});let I="table";if((n.hasAttribute("data-import-as-database")||!A&&g.some((e=>{var t;return null===(t=e.textValue)||void 0===t?void 0:t.length})))&&(I="collection"),0===s().rG(l).length)return[];if(o.table===E().Vl||o.table===k().SN)return[];const w={...o,table:o.table};try{const e=function(e){const{actor:t,parent:o,node:n,tableData:r,allOperations:a,deps:{intl:i,randomID:s,spaceIdCreator:d,randomShortID:l,isPhoneNumber:c,addFileIdsToBlock:p},options:{legacyNonCrdt:u,ignoreBlockCount:m,tableType:g,addHeadersToCollectionEnabled:f,hasHeaderRow:h,hasHeaderColumn:C}}=e,I=(null==d?void 0:d.idInSavedSpace(N().ev))??s();if("table"===g){const{operations:e}=(0,b().L5)({actor:t,tableId:I,parent:o,table:r,deps:{randomID:s,spaceIdCreator:d,randomShortID:l},options:{legacyNonCrdt:u,ignoreBlockCount:m,hasHeaderRow:h,hasHeaderColumn:C}});a.push(...e)}else if("collection"===g){const e=n.getAttribute("data-database-title")??"",{operations:g}=(0,b().ph)({actor:t,blockType:"collection_view",root:{existing:!1,id:I},parent:o,name:e,format:{table_wrap:!0},table:r,deps:{intl:i,randomID:s,spaceIdCreator:d,randomShortID:l,isPhoneNumber:c,addFileIdsToBlock:p??!1},options:{legacyNonCrdt:u,ignoreBlockCount:m,useCsvAdaptiveSchema:!0,addHeadersToCollectionEnabled:f}});a.push(...g)}return I}({actor:t,parent:w,node:n,tableData:l,allOperations:r,deps:a,options:{legacyNonCrdt:y,ignoreBlockCount:v,tableType:I,addHeadersToCollectionEnabled:D,hasHeaderRow:f,hasHeaderColumn:C}});return[e]}catch(P){const t=(0,i().A)(P);if(!d||"CsvImportError"!==t.message)throw P;const o=d.get(e)||0;return d.set(e,o+1),[]}}if("div"===e&&n.hasAttribute(j[c().xd.columnList]))return[he({actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:d,deps:a,options:{legacyNonCrdt:y,ignoreBlockCount:v}})];if("nav"===e&&n.hasAttribute(j[c().xd.tableOfContents]))return[me({actor:t,parent:o,allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v}}),...Z({actor:t,parent:o,node:n,allOperations:r,deps:a,options:{legacyNonCrdt:y,ignoreBlockCount:v}})];if("ul"===e||"ol"===e)return s().KC(...Array.from(n.children).map((e=>Ee({actor:t,parent:o,node:e,allOperations:r,deps:a,options:{legacyNonCrdt:y,ignoreBlockCount:v}}))));if("li"===e||Ce.test(n.textContent||"")||Ie.test(n.textContent||"")||be.test(n.textContent||""))return[Ne({actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:d,deps:a,options:{legacyNonCrdt:y,ignoreBlockCount:v}})];if("img"===e){const e=n.getAttribute("src");if(e&&!T)return[oe({actor:t,parent:o,source:p[e]||{type:"unknown",secureS3UrlOrAlias:e},allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v,fallbackWidth:n instanceof m.HTMLImageElement?n.width:void 0},node:n})]}if("a"===e&&n.getAttribute(j[c().xd.externalObjectInstance])){const e=de({actor:t,parent:o,node:n,allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v}});return e?[e]:[]}if("a"===e&&n.getAttribute(j[c().xd.embed])){const e=n.getAttribute("href");if(e)return[re({actor:t,parent:o,source:{type:"unknown",secureS3UrlOrAlias:e,height:400},allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v}})]}if("a"===e&&n.getAttribute(j[c().xd.file]))return[se({actor:t,parent:o,node:n,allOperations:r,deps:{importFileMap:p,randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v}})];if("a"===e&&0===f().PE(n.childNodes).length){const e=n.getAttribute("href");if(n.hasAttribute("download")&&e)return[re({actor:t,parent:o,source:p[e]||{type:"unknown",secureS3UrlOrAlias:e},allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v}})]}if("video"===e){const e=n.querySelector("source");if(e){const n=e.getAttribute("src");if(n&&g().L_({url:n}))return[re({actor:t,parent:o,source:{type:"unknown",secureS3UrlOrAlias:n},allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v}})]}}if("audio"===e){const e=n.querySelector("source");if(e){const n=e.getAttribute("src");if(n&&g().ck({url:n}))return[re({actor:t,parent:o,source:{type:"unknown",secureS3UrlOrAlias:n},allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v}})]}}if("iframe"===e){const e=n.getAttribute("src");if(e)return[ne({actor:t,parent:o,node:n,sourceUrl:e,allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v}})]}return"p"===e&&n.getAttribute("confluenceNewLine")?[ee({actor:t,parent:o,node:n,type:c().xd.text,allOperations:r,deps:{window:m,randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v,stripText:!0,stripSurroundingWhitespace:!0}})]:n.hasAttribute(j[c().xd.equation])?[ue({actor:t,parent:o,node:n,allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v}})]:[.../^\s*$/g.test(n.textContent||"")?[]:[ee({actor:t,parent:o,node:n,type:c().xd.text,allOperations:r,deps:{window:m,randomID:C,spaceIdCreator:I},options:{legacyNonCrdt:y,ignoreBlockCount:v,stripText:!1,stripSurroundingWhitespace:!0,ignoreCodeBlock:x}})],...Z({actor:t,parent:o,node:n,allOperations:r,deps:a,options:{legacyNonCrdt:y,ignoreBlockCount:v,considerCodeBlockAsNonTextItem:x,ignoreImages:T}})]}return[]}function ke(e,t){const o=null!==e?parseInt(e,10):t;return isFinite(o)?o:t}function _e(e,t,o){const n=o.document.createElement(t);for(;e.firstChild;)n.appendChild(e.firstChild);for(let r=e.attributes.length-1;r>=0;--r){const t=e.attributes[r];n.setAttribute(t.name,t.value)}return e.parentNode&&e.parentNode.replaceChild(n,e),n}function Ae(e,t,o){const n=o.document.createElement(t);for(;e.firstChild;)n.appendChild(e.firstChild);e.appendChild(n)}function Se(e){const t=[];let o=e;for(;e.firstChild;){const n=e.firstChild;t.push(n),e.parentNode&&e.parentNode.insertBefore(n,o.nextSibling),o=n}const n=e.parentNode;return n&&(n.removeChild(e),n.normalize()),t}const Le=1e4;function De(e,t){!function(e,t){const o=Array.from(e.querySelectorAll("p"));for(const n of o){let e=n.firstChild,o=0;for(;e&&o<Le;){let r=!1;if(e instanceof t.Element&&null!==e.textContent&&!e.textContent.trim()){const t=Array.from(e.querySelectorAll("br"));if(t.length>0){for(const o of t)n.insertBefore(o,e);r=!0}}const a=e.nextSibling;r&&n.removeChild(e),e=a,o+=1}}}(e,t);const o=Array.from(e.querySelectorAll("p"));for(let n=0;n<Le;n++){const e=o.shift();if(!e||!e.parentNode)return;const n=e.querySelector("br");if(!n)continue;if(n.parentElement!==e)continue;const r=t.document.createElement("p");e.parentNode.insertBefore(r,e.nextSibling);let a=n.nextSibling;for(;a;){const e=a.nextSibling;r.appendChild(a),a=e}e.removeChild(n),o.unshift(r)}}function Oe(e){const{window:t,nodes:o}=e;let n=e.node;if(n instanceof t.Element&&n.parentNode&&"google-sheets-html-origin"===n.tagName.toLowerCase()){const e=f().PE(n.childNodes);for(const t of e)n.parentNode.insertBefore(t,n);return o.unshift(...e),void n.remove()}if(n&&n.parentNode&&3===n.nodeType&&/^( |\t)*(\n)+( |\t)*$/.test(n.data))n.parentNode.removeChild(n);else if(n&&n instanceof t.Element&&n.parentNode&&O[n.tagName.toLowerCase()])n.parentNode.removeChild(n);else{if(n instanceof t.HTMLElement){const e=(r=n.style.fontSize||void 0)&&-1!==r.indexOf("px")||r&&-1!==r.indexOf("pt")?parseInt(r):void 0,o=function(e){if(e&&-1!==e.indexOf("em"))return parseInt(e)}(n.style.fontSize||void 0);(e&&e>=24||o&&o>2)&&(n=_e(n,"h1",t))}var r;if(n instanceof t.HTMLElement&&("line-through"===n.style.textDecoration&&Ae(n,"del",t),"italic"===n.style.fontStyle&&Ae(n,"em",t),("bold"===n.style.fontWeight||n.style.fontWeight&&parseInt(n.style.fontWeight)>=500)&&Ae(n,"strong",t)),n instanceof t.HTMLImageElement){const e=function(e){const t=e.match(/^([0-9]+)px$/i);if(t)return parseInt(t[1])}(n.style.width);!n.width&&e&&(n.width=e)}if(n instanceof t.HTMLElement&&("b"===n.tagName.toLowerCase()?n=_e(n,"strong",t):"i"===n.tagName.toLowerCase()&&(n=_e(n,"em",t))),n instanceof t.HTMLElement&&"strong"===n.tagName.toLowerCase()&&"normal"===n.style.fontWeight&&(n=_e(n,"span",t)),n instanceof t.HTMLElement&&("section"===n.tagName.toLowerCase()||"article"===n.tagName.toLowerCase())&&(n=_e(n,"div",t)),n instanceof t.HTMLElement&&"div"===n.tagName.toLowerCase()&&"inline"===n.style.display&&(n=_e(n,"span",t)),n instanceof t.HTMLInputElement&&"input"===n.tagName.toLowerCase()&&"checkbox"===n.type){const e=n.checked,r=n.parentNode,a=t.document.createElement("span");return a.textContent=`[${e?"x":" "}] `,r&&(r.insertBefore(a,n),r.removeChild(n)),void o.push(a)}if(n instanceof t.HTMLElement&&"table"===n.tagName.toLowerCase()&&!n.classList.contains("simple-table")){const e=Array.from(n.querySelectorAll("tr")).map((e=>e.querySelectorAll("td, th")));if(e.every((e=>1===e.length))){const r=t.document.createDocumentFragment();for(const n of e){const e=n[0],a=e.childNodes.length;for(let t=0;t<a;t+=1){const n=e.childNodes[t];n&&(r.appendChild(n.cloneNode(!0)),o.push(n))}r.appendChild(t.document.createElement("hr"))}n.parentNode&&n.parentNode.replaceChild(r,n)}}if(n instanceof t.HTMLElement&&("ul"===n.tagName.toLowerCase()||"ol"===n.tagName.toLowerCase())&&n.parentNode instanceof t.HTMLElement&&("ul"===n.parentNode.tagName.toLowerCase()||"ol"===n.parentNode.tagName.toLowerCase())&&n.previousSibling instanceof t.HTMLElement&&"li"===n.previousSibling.tagName.toLowerCase()&&n.previousSibling.appendChild(n),n instanceof t.Element&&(n.removeAttribute("style"),n.removeAttribute("dir")),n instanceof t.Element&&"span"===n.tagName.toLowerCase()){var a;if("page-comment"===n.getAttribute("class")||null!==(a=n.getAttribute("class"))&&void 0!==a&&a.split(" ").includes("retain-span"))return;(n.hasAttribute(j[S().Ifu.Highlight])||n.hasAttribute(j[S().Ifu.Discussion])||n.hasAttribute(j[S().Ifu.Comment])||n.hasAttribute(j[S().Ifu.Equation])?Array.from(n.children):Se(n)).forEach((e=>o.push(e)))}else{if(n instanceof t.Element&&("pre"===n.tagName.toLowerCase()||"code"===n.tagName.toLowerCase()))return;if(n){f().PE(n.childNodes).forEach((e=>o.push(e)))}}}}function Be(e){const{window:t,nodes:o}=e,n=e.node;if(Pe(n,t)&&s().Si(n.childNodes,(e=>e instanceof t.Element&&"h1"===e.tagName.toLowerCase()))){const e=t.document.createElement("h1");s().__(n.childNodes,(t=>{s().__(t.childNodes,(t=>{const o=t.cloneNode(!0);o&&e.appendChild(o)}))}));const r=n.parentNode;if(r){if("td"===n.tagName.toLowerCase()||"th"===n.tagName.toLowerCase()){const o=t.document.createElement(n.tagName.toLowerCase());o.appendChild(e),r.insertBefore(o,n)}else r.insertBefore(e,n);r.removeChild(n)}o.push(e)}else if(Pe(n,t)&&s().Si(n.childNodes,(e=>e instanceof t.Element&&"h2"===e.tagName.toLowerCase()))){const e=t.document.createElement("h2");s().__(n.childNodes,(t=>{s().__(t.childNodes,(t=>{const o=t.cloneNode(!0);o&&e.appendChild(o)}))}));const r=n.parentNode;if(r){if("td"===n.tagName.toLowerCase()||"th"===n.tagName.toLowerCase()){const o=t.document.createElement(n.tagName.toLowerCase());o.appendChild(e),r.insertBefore(o,n)}else r.insertBefore(e,n);r.removeChild(n)}o.push(e)}else if(n instanceof t.HTMLElement&&("div"===n.tagName.toLowerCase()||"span"===n.tagName.toLowerCase())&&n.parentNode&&0===n.childNodes.length)n.parentNode.removeChild(n);else if(!Pe(n,t)||"p"!==n.tagName.toLowerCase()&&"div"!==n.tagName.toLowerCase()&&"figure"!==n.tagName.toLowerCase()||!f().PE(n.childNodes).some((e=>e instanceof t.Element&&("p"===e.tagName.toLowerCase()||"div"===e.tagName.toLowerCase()||"img"===e.tagName.toLowerCase()||"ul"===e.tagName.toLowerCase()||"ol"===e.tagName.toLowerCase()||"table"===e.tagName.toLowerCase()||"hr"===e.tagName.toLowerCase()||"video"===e.tagName.toLowerCase()||"iframe"===e.tagName.toLowerCase())))){if(n&&n.childNodes){f().PE(n.childNodes).forEach((e=>o.push(e)))}}else{Se(n).forEach((e=>o.push(e)))}}function Te(e){const{rootNode:t,window:o,isInlineContent:n,emojiData:r}=e;!function(e){const{rootNode:t,window:o,emojiData:{emojiByName:n}}=e,r=Array.from(t.querySelectorAll("img[data-stringify-emoji]"));for(const a of r){const e=a.getAttribute("data-stringify-emoji")||"",t=e.match(/^:(.+):$/);if(!t||!a.parentNode)continue;const r=n[t[1]]||e;a.parentNode.replaceChild(o.document.createTextNode(r),a)}}({rootNode:t,window:o,emojiData:r}),t.normalize(),De(t,o);const a=f().PE(t.childNodes);for(;a.length>0;){const e=a.shift();e&&Oe({window:o,nodes:a,node:e})}for(f().PE(t.childNodes).forEach((e=>a.push(e)));a.length>0;){const e=a.shift();e&&Be({node:e,window:o,nodes:a})}t.normalize(),n||f().PE(t.childNodes).forEach((e=>{if(3===e.nodeType){const n=o.document.createElement("p");t.insertBefore(n,e),n.appendChild(e)}}))}function Pe(e,t){return e instanceof t.Element&&(0!==e.childNodes.length&&!(e.hasAttribute(j[c().xd.columnList])||e.hasAttribute(j[c().xd.column])||e.hasAttribute(j[c().xd.callout])))}function Me(e){const{actor:t,parent:o,rootNode:n,deps:r,htmlParserErrors:a,options:i}=e;Te({rootNode:n,window:r.window,isInlineContent:!1,emojiData:r.emojiData});const s=[];return{allOperations:s,rootContentIds:xe({actor:t,parent:o,nodes:f().PE(n.children),allOperations:s,deps:r,htmlParserErrors:a,options:i})}}function He(e){const{node:t,window:o,stripText:n,stripSurroundingWhitespace:r,emojiData:a}=e;Te({rootNode:t,window:o,isInlineContent:!0,emojiData:a});const{titleTokens:i}=K({node:t,window:o,stripText:n,stripSurroundingWhitespace:r,ignoreComments:!0});return i}function qe(e){const{node:t,window:o,emojiData:n}=e;return Te({rootNode:t,window:o,isInlineContent:!1,emojiData:n}),je(t,o)}const Fe=new Set(["span","div","p"]);function je(e,t){const o=e.tagName.toLowerCase();if(!Fe.has(o))return!0;if("div"===o&&(e.className===B||e.hasAttribute(j[c().xd.columnList])))return!0;for(const n of Array.from(e.childNodes))if(z(t,n)&&je(n,t))return!0;return!1}function Ue(e){if("default"===e||"gray"===e||"brown"===e||"orange"===e||"yellow"===e||"teal"===e||"blue"===e||"purple"===e||"pink"===e||"red"===e||"gray_background"===e||"brown_background"===e||"orange_background"===e||"yellow_background"===e||"teal_background"===e||"blue_background"===e||"purple_background"===e||"pink_background"===e||"red_background"===e)return e}}}]);