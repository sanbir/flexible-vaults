"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[86341],{43371:e=>{e.exports=function(){return/\uD83C\uDFF4\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74|\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67)\uDB40\uDC7F|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|\uD83D\uDC68(?:\uD83C\uDFFF\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFE])|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFE\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFC\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFB\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFC-\uDFFF])|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D)?\uD83D\uDC68|(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D[\uDC66\uDC67])|[\u2695\u2696\u2708]\uFE0F|\uD83D[\uDC66\uDC67]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|(?:\uD83C\uDFFF\u200D[\u2695\u2696\u2708]|\uD83C\uDFFE\u200D[\u2695\u2696\u2708]|\uD83C\uDFFD\u200D[\u2695\u2696\u2708]|\uD83C\uDFFC\u200D[\u2695\u2696\u2708]|\uD83C\uDFFB\u200D[\u2695\u2696\u2708])\uFE0F|\uD83C[\uDFFB-\uDFFF])|\uD83E\uDDD1(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83E\uDD1D\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\u200D(?:\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD]))|\uD83D\uDC69(?:\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D[\uDC68\uDC69])|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFF\u200D(?:\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFE\u200D(?:\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFC\u200D(?:\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFB\u200D(?:\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD]))|\uD83D\uDC69\uD83C\uDFFF\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFE])|\uD83D\uDC69\uD83C\uDFFE\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83D\uDC69\uD83C\uDFFD\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83D\uDC69\uD83C\uDFFC\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83D\uDC69\uD83C\uDFFB\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFC-\uDFFF])|\uD83D\uDC69\u200D\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83D\uDC69(?:\uD83C\uDFFF\u200D[\u2695\u2696\u2708]|\uD83C\uDFFE\u200D[\u2695\u2696\u2708]|\uD83C\uDFFD\u200D[\u2695\u2696\u2708]|\uD83C\uDFFC\u200D[\u2695\u2696\u2708]|\uD83C\uDFFB\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|\uD83C\uDFF3\uFE0F\u200D\u26A7|\uD83E\uDDD1(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|\uD83D\uDC3B\u200D\u2744|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uFE0F\u200D[\u2640\u2642]|(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642])|\uD83C\uDFF4\u200D\u2620|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E-\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD35\uDD37-\uDD39\uDD3C-\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD6-\uDDDF])\u200D[\u2640\u2642])\uFE0F|\uD83D\uDC69\u200D\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C\uDFF3\uFE0F\u200D\uD83C\uDF08|\uD83D\uDC69\u200D\uD83D\uDC67|\uD83D\uDC69\u200D\uD83D\uDC66|\uD83D\uDC15\u200D\uD83E\uDDBA|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF6\uD83C\uDDE6|\uD83C\uDDF4\uD83C\uDDF2|\uD83D\uDC08\u200D\u2B1B|\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|[#\*0-9]\uFE0F\u20E3|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD0C\uDD0F\uDD18-\uDD1C\uDD1E\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDED5-\uDED7\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6])\uFE0F|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDC8F\uDC91\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD0C\uDD0F\uDD18-\uDD1F\uDD26\uDD30-\uDD39\uDD3C-\uDD3E\uDD77\uDDB5\uDDB6\uDDB8\uDDB9\uDDBB\uDDCD-\uDDCF\uDDD1-\uDDDD])/g}},74e3:(e,t,n)=>{n.d(t,{$:()=>a,u:()=>r});var o=()=>n(242422),i=()=>n(805952);function r(){const e=o().default.checkGate({gateName:"show_beta_dictation_languages"}),t=(0,i().k9)(e);return Object.entries(t)}function a(e){var t;return(null===(t=(0,i().k9)(!0)[e])||void 0===t?void 0:t[1])??"en"}},80777:(e,t,n)=>{n.d(t,{B:()=>i});var o=()=>n(44551);function i(e){var t;null===o().electronApi||void 0===o().electronApi||null===(t=o().electronApi.closeMeetingNotification)||void 0===t||t.call(o().electronApi,e)}},82050:(e,t,n)=>{n.d(t,{HT:()=>b,xw:()=>k,u:()=>T,MZ:()=>B});n(16280);var o=()=>n(564884),i=()=>n(836095),r=()=>n(726637),a=()=>n(75435),s=()=>n(44551);function u(e){var t;null===s().electronApi||void 0===s().electronApi||null===(t=s().electronApi.openSystemSettings)||void 0===t||t.call(s().electronApi,e)}var c=()=>n(112799),d=()=>n(246766),D=()=>n(549721),l=()=>n(891360),m=()=>n(914649),p=()=>n(704242),v=()=>n(165358),f=()=>n(229833),g=()=>n(673903),C=()=>n(541389);async function S(){if(!window.isSecureContext)return m().wv;try{const e=(0,g().E)(),t={audio:!0,systemAudio:"include"};return function(e){for(const t of e.getTracks())t.stop()}(await e.getDisplayMedia(t)),m().a3}catch(e){return v().log({level:"error",from:"checkScreenRecordingPermissionsByTesting",error:(0,f().convertErrorToLog)(e),type:"checkScreenRecordingPermissionsByTestingUnableToCaptureSystemAudio"}),m().JC}}async function A(){const e=await(0,C().C)();return void 0!==e?e:await S()}var F=()=>n(927648);const h=(0,n(69708).YK)({latestVersionStepTitle:{id:"transcriptionSetupSteps.latestVersionStepTitle",defaultMessage:"Update the Notion app"},latestVersionStepDescription:{id:"transcriptionSetupSteps.latestVersionStepDescription",defaultMessage:"Update to the latest version of the Notion app to use AI Meeting Notes."},latestVersionStepActionText:{id:"transcriptionSetupSteps.latestVersionStepActionText",defaultMessage:"Update my Notion app"},microphoneStepTitle:{id:"transcriptionSetupSteps.microphoneStepTitle",defaultMessage:"Enable microphone access"},microphoneStepDescription:{id:"transcriptionSetupSteps.microphoneStepDescription",defaultMessage:"This allows Notion AI to transcribe what you say."},microphoneStepActionText:{id:"transcriptionSetupSteps.microphoneStepActionText",defaultMessage:"Enable microphone access"},systemAudioStepTitle:{id:"transcriptionSetupSteps.systemAudioStepTitle",defaultMessage:"Enable screen & system audio access"},systemAudioStepDescription:{id:"transcriptionSetupSteps.systemAudioStepDescription",defaultMessage:"This allows Notion AI to transcribe what everyone else is saying (even on headphones)."},systemAudioStepActionText:{id:"transcriptionSetupSteps.systemAudioStepActionText",defaultMessage:"Enable access"},restartAppStepTitle:{id:"transcriptionSetupSteps.restartAppStepTitle",defaultMessage:"Restart Notion"},restartAppStepDescription:{id:"transcriptionSetupSteps.restartAppStepDescription",defaultMessage:"Final step! Restart your Notion app to apply the permissions."},restartAppStepActionText:{id:"transcriptionSetupSteps.restartAppStepActionText",defaultMessage:"Restart Notion app"}}),E=n(242422).default.checkGate({gateName:"ai_meeting_notes_native_permissions"}),y=[{id:"desktop-app-version",title:h.latestVersionStepTitle,description:h.latestVersionStepDescription,hasCompleted:e=>Promise.resolve(T(e.environment)),actionText:h.latestVersionStepActionText,action:async e=>{const t=await(0,c().a)(e.environment.device);t?await(0,i().P)(r().A.domainBaseUrl+t):await(0,i().P)("https://www.notion.so/desktop")}},{id:"microphone",title:h.microphoneStepTitle,description:h.microphoneStepDescription,hasCompleted:async e=>{if(e.environment.device.isElectronWindows)return!0;if(e.environment.device.isElectron){if(E){if(await(0,p()._J)()===m().a3)return!0}else{if("granted"===await async function(e){var t;return null===s().electronApi||void 0===s().electronApi||null===(t=s().electronApi.getMediaAccessStatus)||void 0===t?void 0:t.call(s().electronApi,e)}("microphone"))return!0}if(e.isConfirmation){if(E){return await(0,p().IY)()===m().a3}try{return await(0,p().Ck)(),!0}catch{return!1}}}return!1},actionText:h.microphoneStepActionText,action:async e=>{if(E){await(0,p().IY)()===m().JS&&u("microphone")}else try{await(0,p().Ck)()}catch(t){t instanceof Error&&t.name===m().nY&&u("microphone")}}},{id:"system-audio",title:h.systemAudioStepTitle,description:h.systemAudioStepDescription,hasCompleted:async e=>{if(e.environment.device.isElectronWindows)return!0;if(e.environment.device.isElectron){if(E){if(await async function(){const e=await(0,C().u)();return void 0!==e?e:await S()}()===m().a3)return!0}else{if(F().Ay.getHasAttemptedScreenRecordingPermissions()===m().a3)return!0}if(e.isConfirmation){if(E){return await A()===m().a3}return await _()===m().a3}}return!1},actionText:h.systemAudioStepActionText,action:async e=>{if(E){const e=await A();F().Ay.setHasAttemptedScreenRecordingPermissions(e),e===m().JS&&u("screen-recording")}else{const e=await _();F().Ay.setHasAttemptedScreenRecordingPermissions(e?m().a3:m().JS),e&&e===m().a3||u("screen-recording")}}},{id:"restart-app",title:h.restartAppStepTitle,description:h.restartAppStepDescription,hasCompleted:async e=>{if(e.environment.device.isElectron&&e.isConfirmation){if("allowed"===await _())return!0}return Promise.resolve(!1)},actionText:h.restartAppStepActionText,action:async()=>{var e;return null===s().electronApi||void 0===s().electronApi||null===(e=s().electronApi.relaunch)||void 0===e||e.call(s().electronApi),Promise.resolve()}}];function k(){return y}async function b(e){if(r().A.isMobile)return"startDictation";if(e.device.isBrowser)return"startDictation";if(e.device.isElectron&&e.device.isMac&&void 0!==e.device.osVersion[0]&&e.device.osVersion[0]>10&&e.device.osVersion[0]<=12)return"requiresMacOS13";const t=await async function(e,t){var n;const o="available"===(null===(n=l().W.state)||void 0===n?void 0:n.type)?l().W.state.usage:0;for(const i of t)if(!(await i.hasCompleted({environment:e,isConfirmation:o>0})))return i}(e,k());return"desktop-app-version"===(null==t?void 0:t.id)||"microphone"===(null==t?void 0:t.id)?"showSetupModal":"startDictation"}async function _(){try{const e=await(0,n(763824).nQ)(5e3,(0,F().Kj)());return e.timeout?m().JS:e.result}catch{return m().JS}}async function B(e){const{environment:t,registered:n,source:i,url:r}=e;if(n)return(0,o().u)({environment:t,event:{eventName:"open_transcription_block_in_desktop_app_clicked",eventProperties:{source:i}}}),void(await(0,D().e)({environment:t,url:r}));await async function(e,t){const n=await(0,c().a)(e.device);if(!n)return;(0,o().u)({environment:e,event:{eventName:"download_app_for_transcription_clicked",eventProperties:{source:t}}}),(0,d().navigate)({environment:e,url:n,openInNew:"tab"})}(t,i)}function T(e){const t=a().A.state.transcriptionSupportLevel;return Boolean(t)}},99874:(e,t,n)=>{n.r(t),n.d(t,{createClient:()=>u,generateNewClientSessionId:()=>a,getCurrentClientSessionId:()=>s});n(814603),n(147566),n(198721);var o=()=>n(726637),i=()=>n(206267);let r=i().JW();function a(){r=i().JW()}function s(){return r}function u(e){let t=o().A.audioProcessor.url;const{maxReconnectDelayMs:i,minReconnectDelayMs:a,jwtToken:s,isReauth:u}=e,c=new URLSearchParams({sessionId:r});s&&c.set("token",s),u&&c.set("isReauth","true");const d=`${t}?${c.toString()}`;return new(n(471136))(d,{reconnect:{max:i,min:a,"reconnect timeout":2500,retries:1e20},timeout:2500,credentials:!0,transport:{withCredentials:!0},transportOverrides:{transports:["websocket"]}})}},111119:(e,t,n)=>{n.d(t,{l:()=>i});var o=()=>n(44551);async function i(){var e;return null===o().electronApi||void 0===o().electronApi||null===(e=o().electronApi.getDeviceVolume)||void 0===e?void 0:e.call(o().electronApi)}},112799:(e,t,n)=>{n.d(t,{a:()=>u,E:()=>s});n(16280);var o=n(296540),i=()=>n(484714),r=(n(898992),n(672577),()=>n(427704));r().Ju.downloadMac,r().Ju.downloadMacUniversal,r().Ju.downloadMacIntel,r().Ju.downloadMacAppleSilicon,r().Ju.downloadWindows,r().Ju.downloadWindowsArm;const a=[{route:r().Ju.downloadMac,architecture:"universal",operatingSystem:"mac",target:"macUniversal"},{route:r().Ju.downloadMacIntel,architecture:"x86",operatingSystem:"mac",target:"mac"},{route:r().Ju.downloadMacUniversal,architecture:"universal",operatingSystem:"mac",target:"macUniversal"},{route:r().Ju.downloadMacAppleSilicon,architecture:"arm",operatingSystem:"mac",target:"macArm64"},{route:r().Ju.downloadWindows,architecture:"x86",operatingSystem:"windows",target:"windows"},{route:r().Ju.downloadWindowsArm,architecture:"arm",operatingSystem:"windows",target:"windowsArm64"}];function s(){const e=(0,o.useRef)(null),t=(0,i().Y0)();return(0,o.useEffect)((()=>{u(t).then((t=>{e.current=t??null})).catch((e=>{throw new Error(e)}))}),[t]),e}async function u(e){var t;if(!("userAgentData"in navigator))return e.isMac?r().Ju.downloadMacUniversal:r().Ju.downloadWindows;const n=navigator.userAgentData,o=await(null==n||null===(t=n.getHighEntropyValues)||void 0===t?void 0:t.call(n,["architecture"])),i=function(e,t){const n=function(e=""){const t=e.toLowerCase();return t.startsWith("arm")?"arm":t.startsWith("x86")||"intel"===t?"x86":null}(e);if(!n||"mac"!==t&&"windows"!==t)return null;const o=a.find((e=>e.architecture===n&&e.operatingSystem===t));return(null==o?void 0:o.route)||null}(null==o?void 0:o.architecture,e.os);return i||null}},116730:(e,t,n)=>{n.r(t),n.d(t,{checkCanStartTranscription:()=>Z,ensureTranscriptionIsInActive:()=>oe,insertEmptyText:()=>me,pauseTranscription:()=>ie,retrySummarization:()=>ne,retryTranscriptionFileUpload:()=>De,runSummarization:()=>ae,setTranscriptionStateAndTrack:()=>ce,startTranscription:()=>ee,stopTranscription:()=>te,updatePreferredSummarizationFormat:()=>se,updateTranscriptionModel:()=>le,updateTranscriptionSummaryTemplateSelection:()=>ue});var o=()=>n(564884),i=()=>n(907258),r=()=>n(242422),a=()=>n(675133),s=()=>n(128933),u=()=>n(301809),c=()=>n(584262),d=()=>n(700500),D=()=>n(165358),l=()=>n(416845),m=()=>n(388821),p=()=>n(179034),v=()=>n(155792),f=()=>n(798880),g=()=>n(534177),C=()=>n(896628),S=()=>n(722101),A=()=>n(384944),F=()=>n(666144),h=()=>n(812182),E=()=>n(140992),y=()=>n(348869),k=(n(944114),()=>n(792057)),b=()=>n(785728),_=()=>n(532659);var B=()=>n(595345),T=()=>n(807700),w=()=>n(492414),I=()=>n(594794),M=()=>n(300789),N=()=>n(999544),R=()=>n(518489),P=()=>n(547149),x=()=>n(914649),L=()=>n(909557),U=()=>n(74e3),q=()=>n(899926),z=()=>n(52447),O=()=>n(541389),W=()=>n(192359),V=()=>n(964345),J=()=>n(748197),Y=()=>n(920329),$=()=>n(723545),j=()=>n(654069),H=()=>n(386760),K=()=>n(82050);const G=(0,n(69708).YK)({genericError:{id:"transcriptionBlockActions.genericError",defaultMessage:"Something went wrong while summarizing your transcript."},failedToStartDictation:{id:"transcriptionBlockActions.failedToStartDictation",defaultMessage:"Unable to start transcription"},systemAudioMacHardwareError:{id:"transcriptionBlockActions.systemAudioMacHardwareError",defaultMessage:"AI Meeting Notes failed to start. You may need to update to the latest version of macOS."},systemAudioMacHardwareErrorRequiresMacOS13:{id:"transcriptionBlockActions.systemAudioMacHardwareErrorRequiresMacOS13",defaultMessage:"Transcribing on AI Meeting Notes requires macOS 13 or later."},systemAudioWindowsHardwareError:{id:"transcriptionBlockActions.systemAudioWindowsHardwareError",defaultMessage:"AI Meeting Notes failed to start. You may need to update to the latest version of Windows."},mobileOriginError:{id:"transcriptionBlockActions.mobileOriginError",defaultMessage:"This meeting was started on mobile. Please use the mobile app to continue."}});async function Z(e){var t;const{environment:n,blockStore:r}=e;if(!(null===(t=i().default.state.currentUserStore)||void 0===t?void 0:t.id))return!1;if((0,T().l)(r))return!1;await r.load(),h().UW("transcription_error_notification");const u=t=>{P().createAndCommit({userAction:"transcriptionBlockActions.failedToStartDictation",environment:n,canUndo:!1,perform:t=>{ce({...e,transaction:t,state:{state:"paused"}})}}),t&&s().D6({label:a().A.formatMessage(t),helpUrl:(0,W().zv)()})},c=await(0,K().HT)(n);switch(c){case"requiresMacOS13":return u(G.systemAudioMacHardwareErrorRequiresMacOS13),!1;case"showSetupModal":return u(),J().c.openTranscriptionSetupModal(),(0,o().u)({environment:n,event:{eventName:"transcription_block_setup_modal_opened",eventProperties:{}}}),!1;case"startDictation":return!0;default:(0,g().HB)(c)}}function Q(){h().Iz({id:"mobile_origin_error",message:a().A.formatMessage(G.mobileOriginError),presentationType:"transient"})}const X=200;async function ee(e){var t,n;const{environment:r,blockStore:u,audioConsentEnabled:c}=e,d=null===(t=i().default.state.currentUserStore)||void 0===t?void 0:t.id;if(!d)return;J().c.setLoadingState(u.id,!0),await u.load(),h().UW("transcription_error_notification");if(!(await Z(e)))return void J().c.setLoadingState(u.id,!1);const D=t=>{P().createAndCommit({userAction:"transcriptionBlockActions.failedToStartDictation",environment:r,canUndo:!1,perform:t=>{ce({...e,transaction:t,state:{state:"paused"}})}}),t&&s().D6({label:a().A.formatMessage(t),helpUrl:(0,W().zv)()}),J().c.setLoadingState(u.id,!1)};if(J().c.setSettingsOpenForBlockId(void 0),h().UW("transcription_idle_notification"),(0,z().dZ)(r,u))return void Q();if((0,z().Jm)(r))return de({...e,state:"transcribing"}),setTimeout((()=>{J().c.setLoadingState(u.id,!1)}),5e3),void(0,j().D)({environment:r,transcriptionBlockStore:u,tabType:"transcript",withTextBlock:!1});try{await Y().DictationManager.startDictation({environment:r,blockStore:u,from:"transcription_block",transcriptionStartedFrom:e.from,includeSystemAudio:(0,K().u)(r),audioConsentEnabled:c})}catch(g){if(g instanceof L().Tn&&Y().DictationManager.stopDictation({environment:r,from:"start_transcription_timed_out",error:g}),(0,l().USz)(g)&&("DictationSystemAudioFailedError"===g.name||"DictationStartTimeoutError"===g.name)&&r.device.isElectronMac){await(0,O().u)()===x().a3?((0,o().u)({environment:r,event:{eventName:"transcription_system_audio_failed_with_permissions_granted",eventProperties:{error_name:g.name}}}),D(G.failedToStartDictation)):(D(),J().c.openTranscriptionSetupModal())}else(0,l().USz)(g)&&"DictationSystemAudioHardwareError"===g.name&&r.device.isElectron?D(r.device.isElectronMac?G.systemAudioMacHardwareError:G.systemAudioWindowsHardwareError):D(G.failedToStartDictation);return}finally{J().c.setLoadingState(u.id,!1)}const m=null===(n=V().Ay.state.audioRecorder)||void 0===n?void 0:n.isStoringLocalAudio,p={state:"transcribing",transcriber_id:d,transcriber_table:f().oo,session_id:(0,B().qY)(),is_recording:m};if(P().createAndCommit({userAction:"transcriptionBlockActions.initializeTitleAndStartTranscription",environment:r,canUndo:!1,perform:t=>{ce({...e,transaction:t,state:p})}}),V().Ay.setState({...V().Ay.state,audioRecorderShouldAutoStopOnTranscriptionStateChanges:!0}),c){const e=i().AppStoreSidebarSpaceViewStore.getState();if(e){var v;Boolean((null===(v=e.getSettings())||void 0===v?void 0:v.audio_consent_nux_dismissed_v2)??!1)?setTimeout((()=>{(0,H().YW)({blockId:u.id,userId:d,language:(0,q().F)(d),showtime:!0,environment:r,store:u})}),X):J().c.openAudioConsentPopup(u.id)}}}async function te(e){if(!(0,z().dZ)(e.environment,e.blockStore))return(0,z().Jm)(e.environment)&&(0,z().kc)(e.environment,e.blockStore)?(J().c.setLoadingState(e.blockStore.id,!0),de({...e,state:"summarizing"}),void setTimeout((()=>{J().c.setLoadingState(e.blockStore.id,!1)}),5e3)):void(await re({...e,shouldStopDictation:!0}));Q()}async function ne(e){await re({...e,shouldStopDictation:!0})}async function oe(e){var t;const{environment:n,blockStore:o,from:i}=e,r=null===(t=o.getFormat())||void 0===t?void 0:t.transcription_state;return r&&"transcribing"!==r.state&&"recorded_audio_transcribing"!==r.state&&"recorded_audio_file_uploading"!==r.state?("initial"===r.state||"idle"===r.state||"paused"===r.state||r.state,!1):(await ie({environment:n,blockStore:o,shouldStopDictation:!1,from:i}),!0)}async function ie(e){return(0,z().dZ)(e.environment,e.blockStore)?((0,D().log)({level:"error",from:"transcriptionBlockActions",type:"pauseTranscription",data:{message:"Attempted to pause external mobile recording - button should have been disabled",blockId:e.blockStore.id}}),void Q()):(0,z().Jm)(e.environment)&&(0,z().kc)(e.environment,e.blockStore)?(J().c.setLoadingState(e.blockStore.id,!0),de({...e,state:"paused"}),void setTimeout((()=>{J().c.setLoadingState(e.blockStore.id,!1)}),5e3)):void(await re({...e,disableSummarization:!0,state:{state:"paused"}}))}async function re(e){const{environment:t,blockStore:o,state:i,disableSummarization:r,shouldStopDictation:a,from:s}=e;if(J().c.setSettingsOpenForBlockId(void 0),h().UW("transcription_idle_notification"),i&&ce({environment:t,blockStore:o,state:i,from:s}),a&&Y().DictationManager.stopDictation({environment:t,from:"transcription_block"}),!r){if(t.device.isMobileNative){const{clear:e}=await Promise.resolve().then(n.bind(n,755125));e({environment:t})}await ae({environment:t,blockStore:o,from:s})}}async function ae(e){const{environment:t,blockStore:n,from:o}=e,i=n.pointer.spaceId;if(!i)return;const u=r().default.checkGate({gateName:"ai_meeting_notes_custom_prompt_template_enabled"});ce({environment:t,blockStore:n,state:{state:"summarizing",step:"thinking",thinkingSteps:[],reasoningSteps:[]},from:o});const c={...n.pointer,spaceId:i},d=J().c.getSummarizationAbortController(n.id);null==d||d.abort();const D=J().c.createSummarizationAbortController(n.id),l=u?(0,W().Ao)(n):void 0;try{let e=!1;const u=o=>{if("summarize-transcript-error"===o.type)return void s().D6({label:a().A.formatMessage(G.genericError)});if("summarize-transcript-record-map"===o.type){const e=o.recordMap;F()._O({environment:t,recordMap:m().RecordMapWithRole.create(e),inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,debugSource:"transcriptionBlockActions.runSummarization"})}const i=J().c.getTabState(n.id),r=(0,W().y1)(n,"summary");r&&i!==(null==r?void 0:r.id)&&!e&&(e=!0,J().c.setTabState(n.id,r.id))},d=r().default.checkGate({gateName:"ai_meeting_notes_agent"}),C=(0,I().Z1)({environment:t,table:p().ev,spaceId:i});var f,g;if(d)await async function(e){const{environment:t,onResponse:n,data:o,abortSignal:i}=e,r=await t.api.callStreamApi({eventName:"runMeetingNotesAgent",environment:t,data:o,abortSignal:i,headers:(0,b().WS)({spaceId:o.spaceId})});if("success"!==r.type)return null!=i&&i.aborted?{error:{message:"Aborted",code:0}}:(k().Qg(r),{error:{message:r.error.message,code:r.status}});const a=[];if(_().hS.is(r.data))for await(const s of r.data){if("error"===s.type)return{error:{message:s.message,code:s.errorCode}};null==n||n(s),a.push(s)}return{value:a}}({environment:t,onResponse:u,data:{transcriptionBlockId:n.id,spaceId:i,language:(0,q().F)(t.currentUser.id),summaryTabId:C,transcriptionModel:(0,W().RW)(null===(f=n.getFormat())||void 0===f?void 0:f.transcription_model)??"unknown",from:o},abortSignal:D.signal});else await(0,y().g)({environment:t,onResponse:u,data:{transcript:[{id:(0,I().Z1)({environment:t,table:v().mS,spaceId:i}),type:"config",value:{type:"summarize-transcript",transcriptPointer:c,language:(0,q().F)(t.currentUser.id),summaryTabId:C,transcriptionModel:(0,W().RW)(null===(g=n.getFormat())||void 0===g?void 0:g.transcription_model)??"unknown",summaryTemplateSelection:l,from:o}},{id:(0,I().Z1)({environment:t,table:v().mS,spaceId:i}),type:"summarize-transcript"}],traceId:n.id,spaceId:i,generateTitle:!1},abortSignal:D.signal});t.device.isBrowser&&!(0,N().Xh)("ai_meeting_notes_browser_summary_app_download")&&(0,M().HH)(t,"ai_meeting_notes_browser_summary_app_download")}catch(C){if((0,E().zf)(D,C))return;ce({environment:t,blockStore:n,state:{state:"idle"},from:"summary_error"})}finally{J().c.clearSummarizationAbortController(n.id)}}async function se(e){var t;const{environment:n,blockStore:o,format:i}=e;if((null===(t=o.getFormat())||void 0===t?void 0:t.transcription_summarization_format_type)===i)return;P().createAndCommit({userAction:"transcriptionBlockActions.updatePreferredSummarizationFormat",environment:n,canUndo:!0,perform:e=>{C().zA({stores:[o],update:{transcription_summarization_format_type:i},transaction:e})}});"idle"!==(0,W().by)(o).state||(0,T().l)(o)||await ae({environment:n,blockStore:o,from:"format_updated"})}async function ue(e){const{environment:t,blockStore:n,selection:o}=e;P().createAndCommit({userAction:"transcriptionBlockActions.updateTranscriptionSummaryTemplateSelection",environment:t,canUndo:!0,perform:e=>{C().zA({stores:[n],update:{transcription_summary_template_selection:o},transaction:e})}});"idle"!==(0,W().by)(n).state||(0,T().l)(n)||await ae({environment:t,blockStore:n,from:"summary_template_updated"})}function ce(e){const{environment:t,blockStore:n,state:i,transaction:r,from:a}=e;(0,$().K)({environment:t,blockStore:n,state:i,transaction:r,from:a}),(0,o().u)({environment:t,event:{eventName:"transcription_state_updated",eventProperties:{from:a,block_id:n.id,space_id:n.pointer.spaceId,new_state:i.state}}})}function de(e){const{environment:t,blockStore:n,state:o}=e,i=(0,w().J8)({store:n,scrollToBlockId:n.id,fullyQualified:!0,pageVisitSource:c().y8.MobileMeetingNotesNotification});J().c.setSettingsOpenForBlockId(void 0),h().UW("transcription_idle_notification");const r=n.pointer.spaceId,a=t.currentUser.id,s=(0,U().$)((0,q().F)(a));var u;r&&a&&(null===(u=t.mobileNative)||void 0===u||u.setTranscriptionState(n.id,a,r,i,o,s))}function De(e){const{environment:t,blockStore:n}=e,o=(0,w().J8)({store:n,scrollToBlockId:n.id,fullyQualified:!0,pageVisitSource:c().y8.MobileMeetingNotesNotification}),i=n.pointer.spaceId,r=t.currentUser.id,a=(0,U().$)((0,q().F)(r));var s;i&&r&&(null===(s=t.mobileNative)||void 0===s||s.retryTranscriptionFileUpload(n.id,r,i,o,a))}function le(e){var t;const{environment:n,blockStore:o,transcriptionModel:i}=e,r=(0,W().f1)(i);(null===(t=o.getFormat())||void 0===t?void 0:t.transcription_model)!==r&&P().createAndCommit({userAction:"transcriptionBlockActions.updateTranscriptionModel",environment:n,canUndo:!1,perform:e=>{C().zA({stores:[o],update:{transcription_model:r},transaction:e})}})}function me(e){const{environment:t,store:n,transaction:o}=e,i=A().Wv({environment:t,type:d().xd.text,inMemoryRecordCache:n.inMemoryRecordCache,transaction:o,spaceId:n.pointer.spaceId});S().BC({parentStore:n.getContentStore(),appendStore:i,transaction:o});const r=n.getContentStores()[0];(0,R().h)({environment:t,store:r});const a=r.getBlockTitleStore();(0,u().e)({store:a})}},148555:(e,t,n)=>{n.d(t,{B:()=>r});var o=()=>n(44551),i=()=>n(757747);function r(e,t){if(o().electronApi){var n;null===o().electronApi||void 0===o().electronApi||null===(n=o().electronApi.pushToastInMainTab)||void 0===n||n.call(o().electronApi,t)}else{const n=i().v[t.toastId];n&&n(e,t)}}},170350:(e,t,n)=>{n.r(t),n.d(t,{filterIcon:()=>i,iconDefinition:()=>o});n(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.87 15.25 10.25",svg:(0,n(474848).jsx)("path",{d:"M3 4.875a.625.625 0 1 0 0 1.25h14a.625.625 0 1 0 0-1.25zm2.125 5.742h9.75a.625.625 0 1 0 0-1.25h-9.75a.625.625 0 1 0 0 1.25m1.5 3.883c0-.345.28-.625.625-.625h5.5a.625.625 0 1 1 0 1.25h-5.5a.625.625 0 0 1-.625-.625"})},i=(0,n(340498).wt)("filter",o,"default")},241314:(e,t,n)=>{n.d(t,{ys:()=>x,zz:()=>M,YE:()=>P,ZQ:()=>N,bH:()=>I,YA:()=>L,Ux:()=>T,gA:()=>R,L6:()=>w,$I:()=>q,Ep:()=>Ce,UJ:()=>Q,aT:()=>ue,$g:()=>De,rJ:()=>le,sN:()=>me,A7:()=>oe,bT:()=>ce});n(16280),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);var o=()=>n(907258),i=()=>n(726637),r=()=>n(165358),a=()=>n(206267),s=()=>n(220719),u=()=>n(999752),c=()=>n(229833),d=()=>n(745875),D=()=>n(763824),l=()=>n(720665),m=()=>n(671593),p=()=>n(184136),v=()=>n(909557),f=()=>n(165121),g=()=>n(416845),C=()=>n(532313),S=()=>n(769864),A=()=>n(99874);const F=!1;var h=()=>n(314529),E=()=>n(242422),y=()=>n(908006);function k(e,t){y().default.afterNextFlush((()=>{E().default.checkGate({gateName:"audio_processor_client_send_request_metric_enabled"})&&(0,h().DO_NOT_USE_trackLegacy)(e,"audio_processor.client.send_request",t)}))}var b=()=>n(638681);const _=b().union([b().object({required:{audioDuration:b().number(),id:b().string(),status:b().literal("complete"),text:b().string()},optional:{}}),b().object({required:{audioDuration:b().number(),id:b().string(),reason:b().string(),status:b().literal("error")},optional:{}}),b().object({required:{audioDuration:b().number(),id:b().string(),status:b().literal("ignore")},optional:{}}),b().object({required:{audioDuration:b().number(),id:b().string(),status:b().literal("pending")},optional:{}})]),B=b().union([b().object({required:{settings:b().object({required:{max_block_char_size:b().number(),transcription_model:b().literals("baseten_diarization","fireworks_diarization","no_diarization","openai_diarization")},optional:{}}),type:b().literal("audio_writer_settings")},optional:{}}),b().object({required:{message:b().string(),name:b().literal("ForbiddenError"),status:b().literal(403),type:b().literal("forbidden")},optional:{}}),b().object({required:{currentS:b().number(),limitS:b().number(),type:b().literal("free_trial_limit_update")},optional:{}}),b().object({required:{message:b().string(),type:b().literal("openai_error")},optional:{status:b().number()}}),b().object({required:{requestId:b().string(),result:b().unknown(),status:b().literals("error","ok"),type:b().literal("response")},optional:{}}),b().object({required:{state:b().literals("healthy","temporarily_unavailable"),type:b().literal("service_status_update")},optional:{}}),b().object({required:{audioSessionId:b().string(),isAudioSessionComplete:b().boolean(),isSegmentComplete:b().boolean(),segmentId:b().string(),transcription:b().lazy((()=>_)),type:b().literal("transcription")},optional:{segmentSortkey:b().number(),speakerName:b().string()}}),b().object({required:{message:b().string(),name:b().literal("UpgradeRequiredError"),status:b().literal(403),type:b().literal("upgrade_required")},optional:{}}),b().object({required:{message:b().string(),name:b().literal("UserRateLimitResponse"),retryAfterSec:b().undefinable(b().number()),status:b().literal(429),type:b().literal("rate_limited")},optional:{}}),b().object({required:{talking:b().boolean(),type:b().literal("vad")},optional:{}})]),T="transcription",w="vad",I="rate_limited",M="forbidden",N="openai_error",R="upgrade_required",P="free_trial_info",x="audio_writer_settings",L="service_status_update",U={OPENING:1,CLOSED:2,OPEN:3},q=(0,n(827380).A)(),z={primusV8:async()=>Promise.all([n.e(71136),n.e(36733)]).then(n.bind(n,99874))},O=!1,W=new(u().O)(20),V=new Map,J="audioProcessorInternals";let Y,$=n(882362).u,j="uninitialized";const H=new Set;let K,G,Z=new(u().O)(1);function Q(){return"open"===j}function X(e,t="info",n){r().log({level:t,from:J,team:"editor",type:`primusClient${e}`,data:{miscDataToConvertToString:{sessionId:(0,A().getCurrentClientSessionId)(),...n}}})}function ee(){Y=function(e){var t;const n=null==e||null===(t=e.socket)||void 0===t||null===(t=t.transport)||void 0===t||null===(t=t.query)||void 0===t?void 0:t.transport;if("websocket"===n||"polling"===n)return n}(this),function(...e){O&&console.info("audioProcessorInternals:",...e)}(`Incoming primus ping received from server via ${Y}.`)}function te(e){switch(e){case"end":j="closed";break;case"open":j="open";break;case"opening":j="opening"}}async function ne(e){return Z.enqueue((async()=>async function(e){if(K)if(K&&!ie({connectionState:j,primusClient:K}))K.removeAllListeners("end"),K.destroy(),K=void 0;else if(K)return K;try{const t=await async function(e){if(F)throw new Error("AudioProcessor is disabled");j="creating";const{createClient:t}=await z.primusV8();let n;try{n=await async function(e,t){return await C().L5({fn:async()=>{const t=await S().callApi({eventName:"getAudioProcessorAuthToken",environment:e,data:{}});if("success"===t.type)return t.data.accessToken;throw t.error},handleError:(e,n,o)=>(o>0&&r().log({level:"info",from:t,team:"editor",type:"audioProcessorAuthTokenRetry",data:{miscDataToConvertToString:{retryCount:o,isLastAttempt:n,sessionId:(0,A().getCurrentClientSessionId)(),errorMessage:e instanceof Error?e.message:"Unknown error"}}}),(0,g().USz)(e)&&!e.retryable||n?{status:"throw",error:e}:{status:"retry"}),retryAttemptsMS:[500,1e3,2e3],retryAttemptRandomOffsetMS:200,initialInput:void 0})}(e,J)}catch(m){throw r().log({level:"error",from:J,team:"editor",type:"failedToGetAudioProcessorToken",error:(0,c().convertErrorToLog)(m),data:{miscDataToConvertToString:{sessionId:(0,A().getCurrentClientSessionId)()}}}),new Error(`Failed to get audio processor auth token after retries: ${m instanceof Error?m.message:"Unknown error"}`)}const o=(0,A().getCurrentClientSessionId)(),i=H.has(o),a=t({minReconnectDelayMs:.5*l().TD,maxReconnectDelayMs:2*l().TD,jwtToken:n,isReauth:i});a.on("data",ve);const s=new Promise(((e,t)=>{let n=!1;a.on("open",(()=>{n||(n=!0,f().A.setState("connected"),X("Open"),$.setTimeout((()=>{re(a),e(a)}),0))})),a.on("error",(e=>{if(!n){let o;n=!0,f().A.setState("disconnected"),o="TransportError"===e.type?{level:"info",from:J,team:"no-team-specified",type:"primusTransportError",error:(0,c().convertErrorToLog)(e)}:{level:"error",from:J,team:"no-team-specified",type:"unknownPrimusError",error:(0,c().convertErrorToLog)(e)};(0,d().rQ)(1)&&r().log(o),t(new Error(`Primus connection error: ${e.message||e}`))}})),a.on("timeout",(()=>{n||(n=!0,f().A.setState("disconnected"),X("Timeout"),t(new Error("Primus connection timeout")))}))}));a.on("reconnected",(e=>{j="open",f().A.setState("connected"),re(a),X("Reconnected","info",{reconnectDuration:null==e?void 0:e.duration})})),a.on("reconnect",(()=>{f().A.setState("disconnected"),X("Reconnect"),de()})),a.on("reconnect scheduled",(e=>{(void 0===(null==e?void 0:e.attempt)||void 0===(null==e?void 0:e.duration)||e.attempt>2||e.duration>5e3||void 0===f().A.state)&&f().A.setState("disconnected"),X("ReconnectScheduled")})),a.on("reconnect timeout",(()=>{f().A.setState("disconnected"),X("ReconnectTimeout")})),a.on("reconnect failed",(()=>{j="closed",f().A.setState("disconnected"),X("ReconnectFailed")})),a.on("destroy",(()=>{j="closed",X("Destroy")})),a.on("close",(()=>{j="closed",f().A.setState("disconnected"),X("Close")})),a.on("online",(()=>{X("Online")})),a.on("offline",(()=>{j="closed",f().A.setState("disconnected"),X("Offline")})),a.on("incoming::ping",ee),a.on("readyStateChange",te),a.on("end",(()=>{j="closed",f().A.setState("disconnected"),a.off("readyStateChange",te),de(),ge(a,e),r().log({level:"info",from:J,team:"editor",type:"connectionEnded",data:{miscDataToConvertToString:{sessionId:(0,A().getCurrentClientSessionId)()}}})})),window.__primusClient_audioProcessor=a;const u=1e4;return D().V1(s,u,{customError:()=>new Se(u)}).catch((e=>{throw e instanceof Se&&s.then((e=>{e.end()})).catch((e=>{})),e}))}(e);return void 0!==K&&(K.removeAllListeners("end"),K.destroy()),K=t,K}catch(t){throw K=void 0,j="failed_to_create",r().log({level:"error",from:J,team:"editor",type:"primusClientCreationFailed",error:(0,c().convertErrorToLog)(t),data:{miscDataToConvertToString:{sessionId:(0,A().getCurrentClientSessionId)()}}}),t}}(e)))}async function oe(e){return K&&Ce(e),ne(e)}function ie(e){const{connectionState:t,primusClient:n}=e;return("open"!==t||n.readyState!==U.CLOSED)&&"failed_to_create"!==t||(X("NotHealthy","info",{connectionState:t,clientReadyState:n.readyState}),!1)}function re(e){var t;se=0,H.add((0,A().getCurrentClientSessionId)()),null===(t=ae)||void 0===t||t(e)}let ae,se=0;function ue(e){if(ae)throw new Error("Having more than one onConnectionOpenCallback is not currently supported");ae=e}function ce(){ae=void 0}function de(){!function(){for(const e of V.values())e.reject(new Error("Cancelled pending requests"));V.clear()}()}async function De(e){var t;const{base64Audio:n,environment:i,language:r,onRequestSent:a,spaceId:s,blockId:u}=e,c=null===(t=o().default.state.currentUserStore)||void 0===t?void 0:t.id;var d;if(c&&s)return null===(d=pe({method:"audioData",request:{base64Audio:n,language:r,userId:c,spaceId:s,blockId:u},environment:i,onRequestSent:a}))||void 0===d?void 0:d.response;{const e=c||s?c?"Space":"User":"Both";throw(await p().i.load()).stopDictation({environment:i,error:new(v().eY)(e),from:"missing_user_or_space"}),new Error("missing_user_or_space")}}function le(e){const{environment:t,rootBlockId:n,spaceId:o,connection:i}=e;return pe({method:"transcriptionInfo",request:{rootBlockId:n,spaceId:(0,s().o9)(o)},environment:t,connection:i})}function me(e){const{environment:t,setting_type:n,model:o,rootBlockId:i,disableToast:r,connection:a}=e}function pe(e){if(F)return;const{method:t,request:n,environment:o,connection:s}=e;k(o,{status:"enqueued",endpoint:t});const u=W.enqueue((()=>{const u=a().JW();!function(e,t){y().default.afterNextFlush((()=>{E().default.checkGate({gateName:"audio_processor_client_send_request_metric_enabled"})&&((0,h().DO_NOT_USE_trackLegacy)(e,"audio_processor.client.send_request.queue_running_size",{value:t.running}),(0,h().DO_NOT_USE_trackLegacy)(e,"audio_processor.client.send_request.queue_backup_size",{value:t.queue}))}))}(o,W.getStats());const d=D().yX();V.set(u,{resolve:d.resolve,reject:d.reject});const l={type:`${i().A.audioProcessor.api}/${t}`,requestId:u,...n};"open"!==j&&r().rateLimitedLog({level:"warning",from:J,team:"editor",type:"attemptedToWriteToWebsocketWhenNotOpen",data:{miscDataToConvertToString:{requestId:u,userId:o.currentUser.id,connectionState:j,sessionId:(0,A().getCurrentClientSessionId)()}}}),async function(e){const{message:t,environment:n,onRequestSent:o,connection:i}=e,a=i??await async function(e){if(K)return ie({connectionState:j,primusClient:K})?K:ne(e)}(n);a?(a.write(t),null==o||o()):("open"===j?ne(n).catch((e=>{})):"closed"!==j&&"failed_to_create"!==j||G||(ne(n).catch((e=>{})),r().rateLimitedLog({level:"warning",from:J,team:"editor",type:"clientClosedWhenWriteToSocket",data:{miscDataToConvertToString:{connectionState:j,sessionId:(0,A().getCurrentClientSessionId)(),scheduledToReconnect:Boolean(G)}}})),r().rateLimitedLog({level:"warning",from:J,team:"editor",type:"noClientWhenWriteToSocket",data:{miscDataToConvertToString:{connectionState:j,sessionId:(0,A().getCurrentClientSessionId)(),scheduledToReconnect:Boolean(G)}}}))}({message:l,environment:o,onRequestSent:e.onRequestSent,connection:s}).catch((e=>{r().log({level:"error",from:J,team:"editor",type:"failedToWriteToSocket",error:(0,c().convertErrorToLog)(e),data:{miscDataToConvertToString:{sessionId:(0,A().getCurrentClientSessionId)()}}})})),d.promise.then((e=>{k(o,{status:"success",endpoint:t})})).catch((e=>{const n=W.getStats();k(o,{status:"failure",endpoint:t,queue_running_size:n.running,queue_backup_size:n.queue})}));return D().nQ(1e3,d.promise).then((({timeout:e,result:n})=>{if(e){const e=W.getStats();return k(o,{status:"failure",endpoint:t,queue_running_size:e.running,queue_backup_size:e.queue,queue_timeout:!0}),r().rateLimitedLog({level:"error",from:"audioProcessorInternals",team:"editor",type:"requestTimeout",error:(0,c().convertErrorToLog)(new Error("Request timed out")),data:{miscDataToConvertToString:{requestId:u,method:t,sessionId:(0,A().getCurrentClientSessionId)()}}}),{result:"timeout"}}return n}))}));return{response:u.catch((e=>{})),asyncQueuePromise:u}}function ve(e){const t=(0,m().tf)(B,e);if(t)return void r().log({level:"warning",team:"editor",from:J,type:"ValidationError",data:{miscDataToConvertToString:{...e,sessionId:(0,A().getCurrentClientSessionId)()}},error:(0,c().convertErrorToLog)(t)});const n=e;switch(n.type){case"response":{const{requestId:e,status:t,result:o}=n,i=V.get(e);if(V.delete(e),!i)return;"ok"===t&&i.resolve(o);break}case"transcription":q.emit(T,n);break;case"vad":q.emit(w,n);break;case"rate_limited":q.emit(I,n);break;case"forbidden":q.emit(M,n);break;case"upgrade_required":q.emit(R,n);break;case"free_trial_limit_update":q.emit(P,n);break;case"openai_error":q.emit(N,n);break;case"audio_writer_settings":q.emit(x,n);break;case"service_status_update":q.emit(L,n)}}function fe(e){void 0!==G&&clearTimeout(G),se++;const t=2*l().TD+3*Math.random()*l().TD;se%10==0&&r().log({level:"info",from:J,team:"editor",type:"reconnectAttemptCount",data:{miscDataToConvertToString:{reconnectAttemptCount:se,sessionId:(0,A().getCurrentClientSessionId)()}}}),G=$.setTimeout((()=>{G=void 0,ne(e).then((e=>{var n;r().log({level:"info",from:J,team:"editor",type:"recreatePrimusClientSuccess",data:{miscDataToConvertToString:{socketReconnect:`SocketId: ${null==e||null===(n=e.socket)||void 0===n?void 0:n.id}`,reconnectAttemptCount:se,delayMs:t,sessionId:(0,A().getCurrentClientSessionId)()}}}),se=0})).catch((n=>{r().log({level:"error",from:J,team:"editor",type:"recreatePrimusClientFailure",error:n,data:{miscDataToConvertToString:{reconnectAttemptCount:se,delayMs:t,sessionId:(0,A().getCurrentClientSessionId)()}}}),fe(e)}))}),t)}function ge(e,t,n=!0){var o;r().log({level:"info",from:J,team:"editor",type:"audioProcessorEnd",data:{miscDataToConvertToString:{socketReconnect:`SocketId: ${null==e||null===(o=e.socket)||void 0===o?void 0:o.id}`,createNewConnection:n,sessionId:(0,A().getCurrentClientSessionId)()}}}),$.setTimeout((()=>{void 0!==e&&e.destroy()}),0),K=void 0,n&&fe(t)}function Ce(e){if(void 0!==G&&(clearTimeout(G),G=void 0),K){const t={type:`${i().A.audioProcessor.api}/destroySession`,requestId:a().JW()};K.write(t),K.removeAllListeners("end"),ge(K,e,!1),(0,A().generateNewClientSessionId)()}}class Se extends Error{constructor(e){super(`Primus connection timeout after ${e}ms`),this.name="PrimusConnectionTimeoutError"}}},299903:(e,t,n)=>{n.r(t),n.d(t,{sendEventNotification:()=>M,sendNotificationForDictationInterrupted:()=>w,sendNotificationForRunningAudioProcess:()=>T});var o=()=>n(906745),i=()=>n(564884),r=()=>n(907258),a=()=>n(242422),s=()=>n(726637),u=()=>n(675133),c=()=>n(609679),d=()=>n(416504),D=()=>n(69708),l=()=>n(989946),m=()=>n(966509),p=()=>n(424641),v=()=>n(488776),f=()=>n(743444),g=()=>n(135428),C=()=>n(666976),S=()=>n(362075),A=()=>n(116730),F=()=>n(402170),h=()=>n(632176);const E=(0,D().YK)({zoom:{id:"audioProcessDetectionActions.zoom",defaultMessage:"In a Zoom meeting?"},safari:{id:"audioProcessDetectionHelpers.audioProcess.safari",defaultMessage:"In a meeting?"},chrome:{id:"audioProcessDetectionHelpers.audioProcess.chrome",defaultMessage:"In a meeting?"},teams:{id:"audioProcessDetectionHelpers.audioProcess.teams",defaultMessage:"In a Teams meeting?"},edge:{id:"audioProcessDetectionHelpers.audioProcess.edge",defaultMessage:"In a meeting?"},brave:{id:"audioProcessDetectionHelpers.audioProcess.brave",defaultMessage:"In a meeting?"},arc:{id:"audioProcessDetectionHelpers.audioProcess.arc",defaultMessage:"In a meeting?"},firefox:{id:"audioProcessDetectionHelpers.audioProcess.firefox",defaultMessage:"In a meeting?"},slack:{id:"audioProcessDetectionHelpers.audioProcess.slack",defaultMessage:"In a meeting?"},webex:{id:"audioProcessDetectionHelpers.audioProcess.webex",defaultMessage:"In a meeting?"},atlas:{id:"audioProcessDetectionHelpers.audioProcess.atlas",defaultMessage:"In a meeting?"},comet:{id:"audioProcessDetectionHelpers.audioProcess.comet",defaultMessage:"In a meeting?"}}),y=(0,D().YK)({body:{id:"audioProcessDetectionActions.notification.body",defaultMessage:"Start AI Meeting Notes for this meeting"}}),k=(0,D().YK)({defaultEventTitle:{id:"calendarMeetingNoteNotification.defaultEventTitle",defaultMessage:"Meeting"},allDayTimeLabel:{id:"calendarMeetingNoteNotification.allDayTimeLabel",defaultMessage:"All-day"},takeNotes:{id:"calendarMeetingNoteNotification.takeNotesBody",defaultMessage:"{startTime}  Start AI Meeting Notes"}}),b=(0,D().YK)({zoom:{id:"audioProcessDisplayNames.zoom",defaultMessage:"Zoom"},safari:{id:"audioProcessDisplayNames.safari",defaultMessage:"Safari"},chrome:{id:"audioProcessDisplayNames.chrome",defaultMessage:"Chrome"},teams:{id:"audioProcessDisplayNames.teams",defaultMessage:"Teams"},edge:{id:"audioProcessDisplayNames.edge",defaultMessage:"Edge"},brave:{id:"audioProcessDisplayNames.brave",defaultMessage:"Brave"},arc:{id:"audioProcessDisplayNames.arc",defaultMessage:"Arc"},firefox:{id:"audioProcessDisplayNames.firefox",defaultMessage:"Firefox"},slack:{id:"audioProcessDisplayNames.slack",defaultMessage:"Slack"},webex:{id:"audioProcessDisplayNames.webex",defaultMessage:"Webex"},atlas:{id:"audioProcessDisplayNames.atlas",defaultMessage:"Atlas"},comet:{id:"audioProcessDisplayNames.comet",defaultMessage:"Comet"}}),_=(0,D().YK)({meeting:{id:"customNotificationTitleMessages.meeting",defaultMessage:"Meeting detected"},startAiMeetingNote:{id:"customNotificationTitleMessages.startAiMeetingNote",defaultMessage:"Start AI Meeting Note"}}),B=(0,D().YK)({startAiMeetingNote:{id:"customNotificationBodyMessages.startAiMeetingNote",defaultMessage:"Transcribing opens Notion"}});function T(e,t){var n,D,S;if(s().A.isMobile||!a().default.checkGate({gateName:"meeting_notes_audio_process_notification"}))return;if(!((null===(n=r().AppStoreSidebarSpaceViewStore.getState())||void 0===n?void 0:n.isAiMeetingNotesAudioProcessDetectionMonitoringEnabled())??!0))return;if(!((null===(D=r().AppStoreSidebarSpaceViewStore.getState())||void 0===D?void 0:D.isAiMeetingNotesAudioProcessDetectionNotificationEnabled())??!0))return;if((0,h().isInJoinAndTranscribeCooldown)())return;const A=(0,C().A)(e),F=null===(S=(0,v().Y)().getHomeCalendarStateForSpaceView())||void 0===S?void 0:S.botId,T=(0,v().Y)().getEvents(),w=(0,v().Y)().getCurrentAccounts(),I=(0,p()._X)(T,w),M=function(e){const{processName:t,event:n,isCustomNotification:o}=e;if("control"!==a().default.getEligibleGroup({experimentId:"ai_meeting_notes_umn_intents",defaultGroup:"control",disableExposureLogging:!0}))return u().A.formatMessage(_.startAiMeetingNote);if(n)return n.summary||u().A.formatMessage(k.defaultEventTitle);if(o)return u().A.formatMessage(_.meeting);return u().A.formatMessage(E[t])}({processName:t,event:I,isCustomNotification:A}),N=function(e){const{event:t,processName:n,isCustomNotification:i}=e;if("control"!==a().default.getEligibleGroup({experimentId:"ai_meeting_notes_umn_intents",defaultGroup:"control",disableExposureLogging:!0}))return u().A.formatMessage(B.startAiMeetingNote);if(i)return t?t.isAllDay?u().A.formatMessage(k.allDayTimeLabel):(0,g().Vj)({start:t.start.dateTime,end:t.end.dateTime,locale:c().locale,timeZone:(0,d().P)()}):u().A.formatMessage(b[n]);if(t){const e=t.isAllDay?u().A.formatMessage(k.allDayTimeLabel):(0,g().ax)({time:o().DateTime.fromISO(t.start.dateTime),showAmPm:!0,locale:c().locale,timeZone:(0,d().P)()});return u().A.formatMessage(k.takeNotes,{startTime:e})}return u().A.formatMessage(y.body)}({processName:t,event:I,isCustomNotification:A}),R=Notification.permission;if((0,i().u)({environment:e,event:{eventName:"audio_process_notification_sent",eventProperties:{type:A?"custom":"system",permission:A?"granted":R,calendar_bot_id:F,has_calendar_event:Boolean(I),process:t}}}),F&&(0,m().R)({environment:e,data:{type:"track",payload:{event:"notionNotificationShown",method:"audioDetectionNotification"}},botId:F}),A)(0,l().w)({id:(null==I?void 0:I.uid)??"audioProcess",title:M,body:N,event:I?(0,f().ft)(I):void 0,intent:"startTranscription",autoStart:!0,method:"audioDetectionNotification"});else{const t=new Notification(M,{body:N,silent:!0});t.addEventListener("click",(()=>{h().meetingNotificationClicked({environment:e,notification:{...t,autoStart:!1,method:"audioDetectionNotification"}})}))}}function w(e){const{environment:t,blockStore:n,title:o,message:i,canRestart:r,tabId:a}=e;if(s().A.isMobile)return;const u=(0,S().yz)(),c=new Notification(o,{body:i,silent:!1,requireInteraction:!0}),d=()=>{(0,F().N)({environment:t,blockStore:n,tabId:a})},D=r?()=>{d(),(0,A().startTranscription)({environment:t,blockStore:n,from:"resume_from_click_error_notification",audioConsentEnabled:u})}:d;c.addEventListener("click",D)}const I=(0,D().YK)({defaultEventTitle:{id:"calendarMeetingNoteNotification.defaultEventTitle",defaultMessage:"Meeting"}});function M(e){const{event:t,intent:n,autoStart:o,method:i}=e,r=function(e){const{event:t,intent:n}=e;if("startTranscription"===n)return u().A.formatMessage(_.startAiMeetingNote);return t.summary?t.summary:u().A.formatMessage(I.defaultEventTitle)}({event:t,intent:n}),a=function(e){const{event:t,intent:n}=e;if("startTranscription"===n)return u().A.formatMessage(B.startAiMeetingNote);return(0,g().Vj)({start:t.start.dateTime,end:t.end.dateTime,locale:c().locale,timeZone:(0,d().P)()})}({event:t,intent:n});(0,l().w)({id:t.uid,title:r,body:a,event:(0,f().ft)(t),intent:n,autoStart:o??!1,method:i})}},383567:(e,t,n)=>{n.d(t,{F:()=>r});n(296540);var o=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"3.26 1.98 16.32 17.52",svg:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("path",{d:"M15.825 12a3.75 3.75 0 1 1-.001 7.501 3.75 3.75 0 0 1 0-7.501m0 1.325a.55.55 0 0 0-.55.55V15.2H13.95a.55.55 0 0 0-.001 1.1h1.326v1.325a.55.55 0 0 0 1.1 0V16.3h1.324a.55.55 0 0 0 0-1.1h-1.325v-1.325a.55.55 0 0 0-.55-.55M9.702 5.022a3.918 3.918 0 0 1 6.742.036.626.626 0 0 1-1.08.63 2.667 2.667 0 0 0-4.59-.023L5.376 14.68l4.19.678a.626.626 0 0 1-.2 1.235l-5.1-.827a.625.625 0 0 1-.437-.938z"}),(0,o.jsx)("path",{d:"M10.912 8.094a1.178 1.178 0 1 1 2.326.377 1.178 1.178 0 0 1-2.326-.377M4.7 7.087a1.178 1.178 0 1 1 2.327.377A1.178 1.178 0 0 1 4.7 7.087M3.488 2.985a3.92 3.92 0 0 1 5.572.357.625.625 0 0 1-.944.818 2.67 2.67 0 0 0-3.796-.243.625.625 0 1 1-.832-.932"})]})},r=(0,n(340498).wt)("aiFacePlus",i,"default")},386760:(e,t,n)=>{n.d(t,{Vu:()=>T,se:()=>_,YL:()=>I,YW:()=>N,S$:()=>B,yo:()=>w});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);var o=()=>n(564884),i=()=>n(907258),r=()=>n(135168),a=()=>n(675133),s=()=>n(128933),u=()=>n(94484),c=()=>n(165358),d=()=>n(763884),D=()=>n(319625),l=()=>n(111119);var m=()=>n(695237),p=()=>n(863163),v=()=>n(840385),f=()=>n(899926),g=()=>n(619019),C=()=>n(809328),S=()=>n(362075),A=()=>n(921246);const F="transcriptionConsentMessageV2",h="transcriptionConsentMessageVoice",E=25,y=(0,n(69708).YK)({copiedConsentToast:{defaultMessage:"Consent message copied to clipboard",id:"transcription.consentActions.copyToast.success"},copyConsentErrorToast:{defaultMessage:"Failed to copy consent message to clipboard",id:"transcription.consentActions.copyToast.failure"},playAudioMutedToast:{defaultMessage:"Your volume is muted",id:"transcription.consentActions.playAudioToast.testing.muted"},playAudioMutedWithInstructionsToast:{defaultMessage:"Your volume is muted. Turn it up so that all participants can hear the message.",id:"transcription.consentActions.playAudioToast.muted"},playAudioLowToast:{defaultMessage:"Your volume is low. Turn it up so that all participants can hear the message.",id:"transcription.consentActions.playAudioToast.lowVolume"}});function k(e){return d().K.get({userId:e,key:F})}function b(e){return d().K.get({userId:e,key:h})}function _(e,t,n,o,i){if(i){const e=o?p().f.autoplayAudioConsentMessageWithLocalRecordings:p().f.autoplayAudioConsentMessage;return a().A.getIntl().formatMessage(e)}if(!n){const n=k(e);if(null!=n&&n[t])return n[t]}const r=o?p().f.defaultConsentMessageWithLocalRecordings:p().f.defaultConsentMessage,s=(0,v().v)(t);return s?(0,m().J)(s,r):a().A.getIntl().formatMessage(r)}const B=(0,n(496603).sg)(((e,t,n)=>{const o=k(e);d().K.set({userId:e,key:F,value:{...o,[t]:n}})}),1e3);async function T(e){const{userId:t,language:n,willSaveLocalRecordings:i,audioConsentEnabled:r,environment:u,blockId:c}=e;try{await navigator.clipboard.writeText(_(t,n,!1,i,r)),s().D6({label:a().A.getIntl().formatMessage(y.copiedConsentToast)})}catch{s().D6({label:a().A.getIntl().formatMessage(y.copyConsentErrorToast)})}finally{(0,o().u)({environment:u,event:{eventName:"ai_meeting_notes_copy_consent_message",eventProperties:{block_id:c}}})}}function w(e,t,n){const o=b(e);d().K.set({userId:e,key:h,value:{...o,[t]:n}})}function I(e,t){const n=(0,g().w)();if(0===n.length)return;const o=function(e,t){const n=b(e);if(n)return n[t]}(e,t),i=new Set((0,v().b)(t));let r;const a=[],s=[];for(const u of n){if(void 0!==o&&u.name===o&&(0,C().t)(u))return u;u.default&&(r=u),i.has(u.lang)&&(a.push(u),(0,C().t)(u)&&s.push(u))}if(r&&(0,C().t)(r)&&i.has(r.lang))return r;if(s.length>0){if(void 0!==r)for(const e of s)if(e.lang===r.lang)return e;return s[0]}return a.length>0?a[0]:n[0]}let M=!1;async function N(e){const{blockId:t,userId:n,language:o,showtime:c,voice:d,environment:m,store:p}=e,v=await(0,l().l)();if("number"==typeof v&&-1!==v)if(0===v){s().D6({label:c?a().A.getIntl().formatMessage(y.playAudioMutedWithInstructionsToast):a().A.getIntl().formatMessage(y.playAudioMutedToast),durationMs:u().LX});const e=await async function(e){const{intervalMs:t,timeoutMs:n,minVolume:o=0}=e,i=Date.now();return new Promise((e=>{const r=setInterval((async()=>{const a=await(0,l().l)();"number"==typeof a&&a>o&&(clearInterval(r),e(!0)),Date.now()+t-i>n&&(clearInterval(r),e(!1))}),t)}))}({intervalMs:500,timeoutMs:1e4});if(!e)return}else c&&v<=E&&s().D6({label:a().A.getIntl().formatMessage(y.playAudioLowToast),durationMs:u().LX});try{(0,S().yz)()?await async function(e){var t;const{blockId:n,environment:o,spaceStore:r}=e;if(!(null===(t=i().AppStoreSidebarSpaceViewStore.state)||void 0===t||null===(t=t.getSettingsStore())||void 0===t||null===(t=t.getKeyStore("audio_consent_nux_dismissed_v2"))||void 0===t?void 0:t.getValue()))return;const a=await(0,A().r)(o,r),s=new Audio(a?P:R);s.onended=()=>{},s.onerror=e=>{x({blockId:n,level:"error",subType:"audioPlaybackError",error:(0,D().A)(e)})},await s.play().catch((e=>{x({blockId:n,level:"error",subType:"audioPlayError",error:(0,D().A)(e)})}))}({blockId:t,environment:m,spaceStore:(0,r().f)(p)}):await async function(e){const{userId:t,language:n,voice:o,environment:i,spaceStore:r}=e;M&&speechSynthesis.cancel();M=!0;const a=await(0,A().r)(i,r),s=(c=_(t,n,!1,a,!1),c.replace(/AI/g,"A.I.").replace(/IA/g,"I.A.")),u=new SpeechSynthesisUtterance(s);var c;if(o)u.voice=o;else{const e=I(t,(0,f().F)(t));e&&(u.voice=e)}u.onstart=()=>M=!0,u.onend=()=>M=!1,u.onerror=()=>M=!1,speechSynthesis.speak(u)}({blockId:t,userId:n,language:o,voice:d,environment:m,spaceStore:(0,r().f)(p)})}catch(g){x({blockId:t,level:"error",subType:"speechSynthesisError",error:(0,D().A)(g)})}finally{M=!1}}const R="https://s3.us-west-2.amazonaws.com/public.notion-static.com/consent-audio/consent-transcribe-en.mp3",P="https://s3.us-west-2.amazonaws.com/public.notion-static.com/consent-audio/consent-rec-transcribe-en.mp3";function x(e){const{blockId:t,level:n,subType:o,error:i}=e;c().log({level:n,from:"transcriptionConsentActions",type:`playAudioConsentMessage:${o}`,error:i,data:{miscDataToConvertToString:{blockId:t}}})}},402170:(e,t,n)=>{n.d(t,{K:()=>p,N:()=>v});n(898992),n(672577),n(737550);var o=()=>n(907258),i=()=>n(92697),r=()=>n(453607),a=()=>n(584262),s=()=>n(857783),u=()=>n(44551);function c(e){var t;null===u().electronApi||void 0===u().electronApi||null===(t=u().electronApi.navigateToBlockInTab)||void 0===t||t.call(u().electronApi,e)}var d=()=>n(747100),D=()=>n(836724),l=()=>n(964345);function m(e,t){const n=D().T.findScrollToSelectablesFromIds([t.id]);if(0===n.length)return!1;const i=function(e){const t=e.getRecordStoreUIRoot(),n=o().AppStoreMainEditorCurrentBlockStore.state,i=(null==n?void 0:n.id)===e.id,r=(0,d().cq)(t);return r||i}(t);return!!i&&((0,r().p)({environment:e,handle:n[0],vertical:{reveal:"top"},horizontal:void 0,animate:!0}),!0)}function p(e){const{environment:t,blockStore:n}=e;if(m(t,n))return;const o=function(){const e=l().ei.state;if(null!=e&&e.isTranscriptionBlock())return e}();if((null==o?void 0:o.id)===n.id)return void s().uK({environment:t,store:n,pageVisitSource:a().y8.TranscriptionBlockPopup});const r=i().A.state.tabs.find((e=>{var t;return null===(t=e.activeBlocks)||void 0===t?void 0:t.some((e=>e.pointer.id===n.id))}));r&&c({tabId:r.id,pointer:n.pointer,source:a().y8.TranscriptionBlockPopup})}function v(e){const{environment:t,blockStore:n,tabId:o}=e;m(t,n)||(o&&o!==i().A.state.currentTab.id?c({tabId:o,pointer:n.pointer,source:a().y8.TranscriptionBlockPopup}):s().uK({environment:t,store:n,pageVisitSource:a().y8.TranscriptionBlockPopup}))}},484705:(e,t,n)=>{n.d(t,{k:()=>D});var o=n(296540),i=()=>n(564884),r=()=>n(312788),a=()=>n(484714),s=()=>n(203913),u=()=>n(69708),c=()=>n(192359),d=n(474848);function D({blockId:e,isDemo:t=!1}){const{navigate:n}=(0,o.useContext)(r().E),D=(0,a().v3)(),l=(0,o.useCallback)((()=>{(0,i().u)({environment:D,event:{eventName:"transcription_permission_error_help_clicked",eventProperties:{is_demo:t,block_id:e}}}),n({environment:D,url:(0,c().zv)()})}),[D,t,e,n]);return(0,d.jsx)(s().Ag,{onClick:l,children:(0,d.jsx)(u().sA,{defaultMessage:"Get help",id:"dictation.permission.snackbar.getHelpButton.title"})})}},533336:(e,t,n)=>{n.r(t),n.d(t,{appendTranscriptionBlockToPage:()=>z,createAndNavigateToTranscriptionBlock:()=>W,createMeetingNoteAndGetUrl:()=>J,createMeetingNoteAndGetUrlWhenReady:()=>Y,createTranscriptionBlock:()=>V,navigateToTranscriptionBlock:()=>O});n(944114),n(898992),n(354520);var o=()=>n(906745),i=()=>n(907258),r=()=>n(755531),a=()=>n(675133),s=()=>n(295633),u=()=>n(732810),c=()=>n(342641),d=()=>n(584262),D=()=>n(700500),l=()=>n(597777),m=()=>n(604995),p=()=>n(165358),v=()=>n(416504),f=()=>n(61844),g=()=>n(201980),C=()=>n(534177),S=()=>n(669548),A=()=>n(209660),F=()=>n(44729),h=()=>n(579627),E=()=>n(857783),y=()=>n(281948),k=()=>n(185544),b=()=>n(812182),_=()=>n(680977),B=()=>n(649813),T=()=>n(87017),w=()=>n(471083),I=(n(672577),()=>n(424641)),M=()=>n(488776);var N=()=>n(211716),R=()=>n(492414),P=()=>n(404141),x=()=>n(295304),L=()=>n(547149),U=()=>n(711207);const q=(0,n(69708).YK)({newPage:{id:"transcriptionCreateActions.newPage.title",defaultMessage:"Try AI Meeting Notes "},defaultLocationToastTitle:{id:"transcriptionCreateActions.defaultLocationToast.title",defaultMessage:"Keep your meeting notes organized"},defaultLocationToastMessage:{id:"transcriptionCreateActions.defaultLocationToast.message",defaultMessage:"Choose a default database so new notes are saved there automatically."},defaultLocationToastCta:{id:"transcriptionCreateActions.defaultLocationToast.cta",defaultMessage:"Set default database"}});function z(e){const{environment:t,from:n}=e;L().createAndCommit({userAction:"transcriptionCreateActions.appendTranscriptionBlock",environment:t,canUndo:!0,perform:e=>{(0,T().insertBlockAndEdit)({environment:t,createBlockItem:w().ry[D().xd.transcription],analyticsFrom:n??"quick_templates",selection:[],transaction:e})}})}function O(e){const{environment:t,origin:n,peekMode:o,blockStore:i,pageVisitSource:r,callback:a}=e,s=i.getNavigableBlockStore()??i;o?y().VU({environment:t,openInNew:void 0,store:s,peekMode:o,pageVisitSource:r,resultsStore:void 0,collectionContextStore:void 0}):E().uK({environment:t,store:s,visitType:N().ig.Link,pageVisitSource:r,origin:n,callback:a})}function W(e){const{environment:t,from:n,title:o,origin:i,parent:r,calendarEvent:a,peekMode:s,sharedNote:u,pageVisitSource:c=d().y8.Create,callback:D}=e;let l;if(l=V(u?{environment:t,from:n,title:o,parent:r,calendarEvent:a,sharedNote:u}:{environment:t,from:n,title:o,parent:r,calendarEvent:a}),l)return O({environment:t,blockStore:l.pageStore,pageVisitSource:c,origin:i,peekMode:s,callback:D}),l.transcriptionBlockStore}function V(e){var t,n;const{environment:d,from:p,title:E,parent:y,calendarEvent:T,sharedNote:N}=e,R=(0,r().S)(),z=i().default.state.sidebarSpaceViewStore;if(!R||!z)return;const{performResult:O}=L().createAndCommit({userAction:"transcriptionCreateActions.createTranscriptionBlock",environment:d,canUndo:!1,perform:e=>{var t;const n=null===(t=i().default.state.sidebarSpaceViewStore)||void 0===t||null===(t=t.getSettings())||void 0===t||null===(t=t.default_meeting_notes_location)||void 0===t?void 0:t.collection,r=function(e){const{spaceStore:t,collection:n}=e;if(!n)return;const o=u().m.createChildStore(t,n);return o.isDefined()?o.getAlive()?o.pathIsDead()?{valid:!1,reason:"invalid"}:o.canEdit()?{valid:!0,collection:n}:{valid:!1,reason:"invalid"}:{valid:!1,reason:"invalid"}:{valid:!1,reason:"not_loaded"}}({spaceStore:R,collection:n}),c=!0===(null==r?void 0:r.valid)?r.collection:void 0,f="private"===y||"none"===y||"collection"===(null==y?void 0:y.table)||!y,A=f?k().IT({environment:d,spaceStore:R,spaceViewStore:z,parent:y??c??"private",transaction:e,from:p}):s().B.createChildStore(z,y);if(!A.isType(D().xd.page))return;if(N){const t=[];for(const e of T.attendees??[])e.notionUserId&&t.push({type:"user_permission",role:"editor",user_id:e.notionUserId});t.length&&h().zP({environment:d,store:A,permissionItems:t,transaction:e})}if(f){const t=function(e,t){var n,i,r;let s,u;switch(e){case"title_with_event":let e;if(t){const{startTime:n}=U().Wm(t);e={summary:t.summary,startDateTime:n}}else e=function(){const e=(0,M().Y)().getEvents(),t=(0,M().Y)().getCurrentAccounts();if(!e||0===e.length)return;const n=e.filter((e=>!e.isAllDay&&o().DateTime.fromISO(e.start.dateTime,{zone:e.start.timeZone}).toISODate()===o().DateTime.now().toISODate())),i=(0,I().y6)({events:n,accounts:t,thresholds:void 0,filters:void 0}).find((e=>{const t=e.attendees??[];return!(e.isAllDay||"accepted"!==e.responseStatus||!e.summary||t.length<1)}));if(null!=i&&i.summary&&!i.isAllDay){const e=o().DateTime.fromISO(i.start.dateTime,{zone:i.start.timeZone});return{summary:i.summary,startDateTime:e}}}();s=null!==(n=e)&&void 0!==n&&n.summary?[`${e.summary} `]:void 0,u=null===(i=e)||void 0===i?void 0:i.startDateTime;break;case"new_page":s=[a().A.getIntl().formatMessage(q.newPage)];break;default:s=void 0,u=void 0}const c=(0,v().P)();u=(null===(r=u)||void 0===r?void 0:r.setZone(c))??o().DateTime.now();const d=[s,g().wmz(g().Ww9({type:"datetime",start_date:u.toFormat(m().tr),start_time:u.toFormat(l().GE),time_zone:c,date_format:"relative"}),[[g().BQP.Bold]])].filter(C().O9);return d}(E,T),n=A.getBlockTitleStore();x().yr({environment:d,store:n,tokens:t,transaction:e,index:0})}else if(c){const t=u().m.createChildStore(R,c);if(t){const n=t.getDefaultTemplatePageStore();n&&B().TB({title:"template",environment:d,store:A,templateStore:n,isKeyboard:!1,isCreateIn:!1,transaction:e,from:p})}}const b=w().ry.transcription,_=S().w({environment:d,transaction:e,inMemoryRecordCache:R.inMemoryRecordCache,from:p,selection:[],spaceId:R.id,createBlockItem:b});return T&&(U().Ud({blockStore:_,event:T,transaction:e,environment:d}),U().bk({blockStore:_,event:T,transaction:e,environment:d})),F().Ti({childStore:_,parentStore:A,transaction:e}),{createdTranscriptionBlock:_,createdPage:A,shouldResetDefaultMeetingNotesLocation:!1===(null==r?void 0:r.valid)&&"invalid"===r.reason}}});if(!O)return;O.shouldResetDefaultMeetingNotesLocation&&function(e){const{environment:t,spaceViewStore:n}=e;L().createAndCommit({userAction:"transcriptionCreateActions.resetDefaultMeetingNotesLocation",environment:t,canUndo:!1,perform:e=>{L().applyOperation({store:n,operation:{pointer:n.pointer,path:["settings","default_meeting_notes_location"],command:"set",args:void 0},transaction:e})}})}({environment:d,spaceViewStore:z});const W=i().default.state.currentUserSettingsStore,V=null==W||null===(t=W.getSettings())||void 0===t?void 0:t.seen_default_meeting_notes_location_toast,J=null===(n=z.getSettings())||void 0===n?void 0:n.default_meeting_notes_location,Y=c().default.getData(d,{spaceId:z.getSpaceId()}),$=(0,f().Jd)(Y??[]),j="trial"===(null==$?void 0:$.offer.type)&&(0,f().w5)($.offer.campaign);if(!V&&!J&&!j&&W){const e=a().A.getIntl();b().Iz({id:"default-meeting-notes-location-toast",title:e.formatMessage(q.defaultLocationToastTitle),message:e.formatMessage(q.defaultLocationToastMessage),presentationType:"transient",actions:{primary:{title:e.formatMessage(q.defaultLocationToastCta),onAction:()=>{b().UW("default-meeting-notes-location-toast"),A().Ow({currentTab:"ai",highlightedSetting:P().rF.DefaultMeetingNotesLocation,openedFrom:"default_meeting_notes_location_toast"})}}}}),L().createAndCommit({userAction:"transcriptionCreateActions.markDefaultLocationToastAsSeen",environment:d,canUndo:!1,perform:e=>{(0,_().m)({userSettingsStore:W,transaction:e,data:{seen_default_meeting_notes_location_toast:!0}})}})}return(0,M().Y)().update((e=>{const t=O.createdTranscriptionBlock.pointer;return e&&T?(e.events.push({...T,blockAttachments:[t,...T.blockAttachments??[]]}),e):e})),{transcriptionBlockStore:O.createdTranscriptionBlock,pageStore:O.createdPage}}function J(e){const t=V({environment:e.environment,from:e.from,title:e.title??"new_page",parent:void 0});if(!t)return;return{pageId:t.pageStore.id,blockId:t.transcriptionBlockStore.id,spaceId:t.pageStore.getSpaceId(),blockUrl:(0,R().J8)({store:t.transcriptionBlockStore,scrollToBlockId:t.transcriptionBlockStore.id,fullyQualified:!0,pageVisitSource:e.pageVisitSource})}}async function Y(e){return await async function(){await Promise.all([i().default.waitUntil((()=>{var e;return Boolean(null===(e=(0,r().S)())||void 0===e?void 0:e.isReady())})),i().default.waitUntil((()=>{var e;return Boolean(null===(e=i().default.state.sidebarSpaceViewStore)||void 0===e?void 0:e.isReady())}))]);const e=(0,r().S)(),t=i().default.state.sidebarSpaceViewStore;e&&t||p().log({level:"error",from:"transcriptionCreateActions",type:"waitForTranscriptionStoresUnexpectedUndefined"})}(),J(e)}},541389:(e,t,n)=>{n.d(t,{C:()=>r,u:()=>a});var o=()=>n(44551),i=()=>n(914649);async function r(){try{if(null===o().electronApi||void 0===o().electronApi||!o().electronApi.requestScreenCaptureAccess)return;return await o().electronApi.requestScreenCaptureAccess()?i().a3:i().JS}catch(e){return i().JS}}async function a(){if(null===o().electronApi||void 0===o().electronApi||!o().electronApi.checkScreenCaptureAccess)return;return await o().electronApi.checkScreenCaptureAccess()?i().a3:i().JS}},595345:(e,t,n)=>{n.d(t,{$g:()=>o().$g,UJ:()=>o().UJ,qY:()=>i().getCurrentClientSessionId,sN:()=>o().sN});var o=()=>n(241314),i=()=>n(99874)},619019:(e,t,n)=>{n.d(t,{w:()=>i});var o=()=>n(496603);function i(){return(0,o().hS)(speechSynthesis.getVoices(),(e=>e.voiceURI))}},632176:(e,t,n)=>{n.r(t),n.d(t,{isExplainableTranscriptionStopReason:()=>B,isInJoinAndTranscribeCooldown:()=>k,meetingNotificationClicked:()=>T,showTranscriptionRecordingStoppedToast:()=>b});var o=()=>n(564884),i=()=>n(907258),r=()=>n(675133),a=()=>n(295633),s=()=>n(584262),u=()=>n(252688),c=()=>n(615234),d=()=>n(857783),D=()=>n(812182),l=()=>n(80777),m=()=>n(989946),p=()=>n(402528),v=()=>n(966509),f=()=>n(488776),g=()=>n(752860),C=()=>n(404141),S=()=>n(192359),A=()=>n(932166),F=()=>n(116730),h=()=>n(402170),E=()=>n(533336);let y;function k(){return void 0!==y&&Date.now()-y<30*c().TD}function b(e,t){const{pointer:n,from:o}=t,c=i().AppStoreSidebarSpaceStore.state;if(!c)return;const l=a().B.createChildStore(c,n);if(null==l||!l.isTranscriptionBlock()||"transcribing"===(0,S().by)(l).state)return;if(!B(o))return;const m=l.pathIsAccessibleAndAlive(),p=_[o];D().Iz({id:"transcription_recording_stopped",icon:u().h,iconColorPalette:"gray",iconColorVariant:"inversePrimary",presentationType:"persistent",title:r().A.getIntl().formatMessage({id:"transcriptionRecordingStopped.toast.title",defaultMessage:"Your meeting has stopped recording"}),message:r().A.getIntl().formatMessage(p),actions:m?{primary:{title:r().A.getIntl().formatMessage({id:"transcriptionRecordingStopped.toast.action.goToMeetingNote",defaultMessage:"Go to meeting note"}),onAction:()=>{D().UW("transcription_recording_stopped"),d().uK({environment:e,store:l,pageVisitSource:s().y8.TranscriptionRecordingStoppedNotification})}}}:void 0})}const _=(0,n(69708).YK)({block_not_available:{id:"transcriptionRecordingStopped.toast.subtitle.blockNotAvailable",defaultMessage:"You no longer have access to this meeting note."},block_not_dictatable:{id:"transcriptionRecordingStopped.toast.subtitle.blockNotDictatable",defaultMessage:"The meeting note was deleted or is no longer accessible."},space_switch:{id:"transcriptionRecordingStopped.toast.subtitle.spaceSwitch",defaultMessage:"The meeting note is in another workspace."},missing_user_or_space:{id:"transcriptionRecordingStopped.toast.subtitle.missingUserOrSpace",defaultMessage:"Something went wrong with your account."},audio_recorder_stopped:{id:"transcriptionRecordingStopped.toast.subtitle.audioRecorderStopped",defaultMessage:"Something went wrong while recording your audio."},transcription_block_stopped:{id:"transcriptionRecordingStopped.toast.subtitle.transcriptionBlockStopped",defaultMessage:"The meeting note was stopped."}});function B(e){return"button"!==e&&"mobile_bar_button"!==e&&"rate_limit"!==e&&"upgrade_required"!==e&&"transcription_error"!==e&&"shortcut"!==e&&"block_action"!==e&&"topbar_menu"!==e&&"native_action"!==e&&"template_picker"!==e&&"horizontal_template_picker"!==e&&"quick_add"!==e&&"new_page_and_dictate_shortcut"!==e&&"new_page_and_dictate_action"!==e&&"transcription_block"!==e&&"forbidden"!==e&&"start_transcription_error"!==e&&"start_transcription_timed_out"!==e&&"block_not_visible"!==e}function T(e){var t;const{environment:n,notification:r}=e;r.navigateToSettingsTab?function(e){const{environment:t,tab:n,notification:i}=e;(0,o().u)({environment:t,event:{eventName:"ai_meeting_notes_notification_dropdown_item_clicked",eventProperties:{action:"manage_notifications",method:i.method,intent:i.intent}}}),C().Ay.setState({...C().Ay.state,currentTab:n,defaultSubtab:void 0,open:!0,openedFrom:"meeting_notification"})}({environment:n,tab:r.navigateToSettingsTab,notification:r}):r.restartState?function(e){const{notifications:t}=e;(0,l().B)();for(const n of t)(0,m().w)(n)}(r.restartState):null!==(t=r.transcriptionState)&&void 0!==t&&t.state?function(e){var t,n;const{environment:o,notification:r}=e,s=i().AppStoreSidebarSpaceStore.state,u=null===(t=r.transcriptionState)||void 0===t?void 0:t.state,c=null===(n=r.transcriptionState)||void 0===n?void 0:n.blockId;if(!s||!u||!c)return;const d=a().B.createChildStore(s,{id:c,table:"block",spaceId:s.id});(0,h().K)({environment:o,blockStore:d}),r.stopTranscription&&(0,F().stopTranscription)({environment:o,blockStore:d,from:"desktop_listening_pill"})}({environment:n,notification:r}):function(e){var t,n;const{environment:o,notification:i}=e,r=i.event?(0,f().Y)().getEvent(i.event):void 0,a=i.intent??"startTranscription";"joinMeeting"!==a&&"joinAndStartTranscription"!==a||null==r||null===(t=r.conferencing)||void 0===t||!t.url||((0,v().R)({environment:o,data:{type:"track",payload:{event:"joinMeeting",eventId:r.id,calendarId:r.calendarId,conferencingProvider:r.conferencing.providerName,method:i.method}}}),(0,g().L)({environment:o,url:r.conferencing.url}));const u="joinMeeting"===a&&!(null!==(n=i.event)&&void 0!==n&&n.conferencing);("startTranscription"===a||"joinAndStartTranscription"===a||u)&&(r&&!r.isAllDay?(0,p().kO)({environment:o,event:r,from:"calendar_event_notification",autoStart:i.autoStart,method:i.method}):(0,E().createAndNavigateToTranscriptionBlock)({environment:o,from:"audio_process_detection",title:"none",pageVisitSource:s().y8.TranscriptionBlockNotification,callback:()=>{i.autoStart&&(0,A().startTranscribingBlockOnPageFromTrustedSource)({environment:o,from:"audio_process_detection"})}}));"joinAndStartTranscription"===a&&(y=Date.now())}({environment:n,notification:r})}},704242:(e,t,n)=>{n.d(t,{_J:()=>s,Ck:()=>c,IY:()=>a});n(16280);var o=()=>n(914649),i=()=>n(673903),r=()=>n(44551);async function a(){const e=await async function(){try{if(null===r().electronApi||void 0===r().electronApi||!r().electronApi.requestMicrophoneAccess)return;return await r().electronApi.requestMicrophoneAccess()?o().a3:o().JS}catch(e){return o().JS}}();return void 0!==e?e:await u()}async function s(){const e=await async function(){if(null===r().electronApi||void 0===r().electronApi||!r().electronApi.getMicrophoneAuthorizationStatus)return;const e=await r().electronApi.getMicrophoneAuthorizationStatus();if(!e)return o().JC;switch(e){case"Authorized":return o().a3;case"Denied":case"Restricted":return o().JS;case"NotDetermined":return o().wg;default:return o().JC}}();return void 0!==e?e:await u()}async function u(){try{return await c(),o().a3}catch(e){if(e instanceof Error)switch(e.name){case o().nY:return o().JS;case o().V9:case o().mL:return o().rP}return o().JC}}async function c(){const e=(0,i().E)();!function(e){for(const t of e.getTracks())t.stop()}(await e.getUserMedia({video:!1,audio:!0}))}},711207:(e,t,n)=>{n.d(t,{FP:()=>C,Mh:()=>E,Ud:()=>F,Wm:()=>S,_p:()=>y,bk:()=>A,uJ:()=>h});n(944114),n(898992),n(354520),n(672577),n(581454);var o=()=>n(906745),i=()=>n(564884),r=()=>n(755531),a=()=>n(278729),s=()=>n(755125),u=()=>n(848538),c=()=>n(534177),d=()=>n(769864),D=()=>n(896628),l=()=>n(579627),m=()=>n(402528),p=()=>n(966509),v=()=>n(488776),f=()=>n(295304),g=()=>n(547149);function C(e){var t;const{environment:n,store:o}=e,i=null===(t=o.getFormat())||void 0===t?void 0:t.transcription_calendar_event;i&&g().createAndCommit({userAction:"transcriptionCalendarActions.dismissCalendarSharingSuggestion",environment:n,canUndo:!0,perform:e=>{D().zA({stores:[o],update:{transcription_calendar_event:{...i,has_dismissed_sharing:!0}},transaction:e})}})}function S(e){return{startTime:e.isAllDay?o().DateTime.fromISO(e.start.date):o().DateTime.fromISO(e.start.dateTime,{zone:e.start.timeZone}),endTime:e.isAllDay?o().DateTime.fromISO(e.end.date):o().DateTime.fromISO(e.end.dateTime,{zone:e.end.timeZone})}}function A(e){const{blockStore:t,event:n,transaction:o,environment:i}=e,r=t.getTitleStore();r&&(f().jQ({environment:i,store:r,transaction:o,selection:{startIndex:0,endIndex:1/0},updateSelection:!1}),n.summary&&f().yr({environment:i,store:r,index:0,tokens:[[n.summary]],transaction:o}))}function F(e){var t;const{blockStore:n,event:o,attendeeIds:i,transaction:r,environment:a}=e,{startTime:s,endTime:u}=S(o),d=i??(null===(t=o.attendees)||void 0===t?void 0:t.map((e=>e.notionUserId)).filter(c().O9))??[],l=a.currentUser.id;l&&!d.includes(l)&&d.push(l),D().zA({stores:[n],update:{transcription_calendar_event:{uid:o.uid,startTime:s.toISO(),endTime:u.toISO(),attendeeIds:d}},transaction:r})}async function h(e){const{environment:t,blockStore:n,event:c,source:d,shareWithParticipants:f}=e,C=c.isAllDay?o().DateTime.fromISO(c.start.date):o().DateTime.fromISO(c.start.dateTime,{zone:c.start.timeZone}),S=c.isAllDay?o().DateTime.fromISO(c.end.date):o().DateTime.fromISO(c.end.dateTime,{zone:c.end.timeZone}),h=y({environment:t,event:c});g().createAndCommit({userAction:"transcriptionCalendarActions.addCalendarEventToTranscriptionBlock",environment:t,canUndo:!0,perform:e=>{D().zA({stores:[n],update:{transcription_calendar_event:{uid:c.uid,startTime:C.toISO(),endTime:S.toISO(),attendeeIds:[],has_dismissed_sharing:!f}},transaction:e}),A({blockStore:n,event:c,transaction:e,environment:t})}}),(0,s().clear)({environment:t});const E=await h;if(g().createAndCommit({userAction:"transcriptionCalendarActions.addCalendarAttendeesToTranscriptionBlock",environment:t,canUndo:!0,perform:e=>{F({blockStore:n,event:c,attendeeIds:E.map((e=>e.id)),transaction:e,environment:t})}}),f){const e=n.getNavigableBlockStore();if(e){const o=E.filter((e=>e.id!==t.currentUser.id)).map((e=>({type:"existingUser",value:e})));o.length>0&&(l().eP({environment:t,store:e,inviteTargets:o,inviteRole:"editor",isOnboarding:!1,invite:{inviteOrigin:"transcription_block"}}),(0,m()._)({environment:t,transcriptionBlockStore:n}))}}(0,p().R)({environment:t,data:{type:"track",payload:{event:"transcriptionBlockCalendarEventAdded",eventId:c.uid,source:d,notionBlockId:n.id}}}),(0,i().u)({environment:t,event:{eventName:"transcription_block_calendar_event_linked",eventProperties:{block_id:n.id,calendar_event_id:c.uid,from:d,total_attendees:E.length,attendees_in_workspace:(()=>{const e=(0,r().S)();return e?E.filter((t=>a().V.createChildStore(e,(0,u().i1)({userId:t.id,spaceId:e.id})).isMember())).length:0})(),has_conferencing:Boolean(c.conferencing)}}}),(0,v().Y)().update((e=>{if(!e)return e;const t=e.events.find((e=>e.accountId===c.accountId&&e.calendarId===c.calendarId&&e.id===c.id));return t?(t.blockAttachments=[n.pointer,...t.blockAttachments??[]],e):e}))}function E(e){const{environment:t,blockStore:n}=e;g().createAndCommit({userAction:"transcriptionCalendarActions.removeCalendarEventFromTranscriptionBlock",environment:t,canUndo:!0,perform:e=>{const o=n.getTitleStore();o&&f().jQ({environment:t,store:o,transaction:e,selection:{startIndex:0,endIndex:1/0}}),D().zA({stores:[n],update:{transcription_calendar_event:void 0},transaction:e})}}),(0,s().clear)({environment:t})}async function y(e){var t;const{environment:n,event:o}=e,i=(null===(t=o.attendees)||void 0===t?void 0:t.map((e=>e.email)).filter(c().O9))??[];if(0===i.length)return[];const r=await d().callMainCellApi({eventName:"findUsers",environment:n,data:{emails:i}});return"success"!==r.type?[]:r.data.values.map((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.value})).filter(c().O9)}},809328:(e,t,n)=>{n.d(t,{H:()=>s,t:()=>u});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(430670);var o=()=>n(74e3),i=()=>n(906065);function r(e){const t=["Aaron","Arthur","Catherine","Daniel","Gordon","Karen","Martha","Moira","Nicky","Rishi","Samantha","Tessa","Zarvox"];switch(e){case"Simplified_Chinese":case"Traditional_Chinese":return["Li-Mu","Meijia","Sinji","Tingting","Yu-shu"];case"Danish":return["Sara"];case"Dutch":return["Ellen","Xander"];case"English":default:return t;case"Finnish":return["Satu"];case"French":return["Amlie","Jacques","Marie","Thomas"];case"German":return["Anna","Helena","Martin"];case"Japanese":return["Hattori","Kyoko","O-Ren"];case"Korean":return["Yuna"];case"Norwegian":return["Nora"];case"Russian":return["Milena"];case"Portuguese":return["Joanna","Luciana"];case"Spanish":return["Mnica","Paulina"];case"Swedish":return["Alva"];case"Thai":return["Kanya"];case"Vietnamese":return["Linh"];case"Italian":return["Isabella","Giuseppe","Federica","Luca"]}}function a(e){return e.name.startsWith("Google ")||e.name.startsWith("Microsoft ")}function s(e,t){if(a(e))return!0;const n=(0,i().U)(e);return r(t).includes(n)}function u(e){if(a(e))return!0;const t=(0,i().U)(e);return new Set((0,o().u)().flatMap((([e])=>r(e)))).has(t)}},872903:(e,t,n)=>{n.r(t),n.d(t,{displayDictationGenericErrorSnackbar:()=>S,displayDictationPermissionSnackbar:()=>g,displayDictationUsageErrorSnackbar:()=>C,showTranscriptionErrorToast:()=>A});n(296540);var o=()=>n(564884),i=()=>n(907258),r=()=>n(128933),a=()=>n(295633),s=()=>n(175882),u=()=>n(69708),c=()=>n(534177),d=()=>n(812182),D=()=>n(484705),l=()=>n(914649),m=()=>n(362075),p=()=>n(116730),v=()=>n(402170),f=n(474848);l().JS,l().rP,l().JC;function g(e){var t;r().D6({label:(t=e,t===l().JS?(0,f.jsx)(u().sA,{defaultMessage:"No microphone permission. Allow access to your microphone in system settings",id:"dictation.permission.microphone.snackbar.error"}):t===l().rP?(0,f.jsx)(u().sA,{defaultMessage:"No microphone available. Connect your microphone in system settings",id:"dictation.unavailable.microphone.snackbar.error"}):t===l().JC?(0,f.jsx)(u().sA,{defaultMessage:"An unknown error occurred when trying to access the microphone.",id:"dictation.permission.unknown.snackbar.error"}):void(0,c().HB)(t)),right:(0,f.jsx)(D().k,{})})}function C(){r().D6({label:(0,f.jsx)(u().sA,{defaultMessage:"Audio usage limit reached. Try again later.",id:"dictation.usage.snackbar.error"})})}function S(){r().D6({label:(0,f.jsx)(u().sA,{defaultMessage:"Dictation failed. Please try again.",id:"dictation.generic.snackbar.error"})})}function A(e,t){const{pointer:n,tabId:r,title:c,message:D,name:l,canRestart:g}=t,C=i().AppStoreSidebarSpaceStore.state;if(!C)return;const S=a().B.createChildStore(C,n);if(!S.isTranscriptionBlock())return;const A=(0,m().yz)(),F={title:(0,f.jsx)(u().sA,{defaultMessage:"Go to meeting note",id:"dictation.error.toast.action.goToBlock"}),onAction:()=>{d().UW("transcription_error_notification"),(0,v().N)({environment:e,blockStore:S,tabId:r}),(0,o().u)({environment:e,event:{eventName:"error_transcription_toast_navigation_button_clicked",eventProperties:{block_id:S.id,error_name:l}}})}};d().HK({id:"transcription_error_notification",icon:s().exclamationMarkTriangleSmallIcon,presentationType:"persistent",variant:"error",title:c,message:D,onDismiss:()=>{(0,o().u)({environment:e,event:{eventName:"error_transcription_toast_dismissed",eventProperties:{block_id:S.id,error_name:l}}})},actions:{primary:g?{title:(0,f.jsx)(u().sA,{defaultMessage:"Resume",id:"dictation.error.toast.action.resume"}),onAction:()=>{d().UW("transcription_error_notification"),(0,v().N)({environment:e,blockStore:S,tabId:r}),(0,p().startTranscription)({environment:e,blockStore:S,from:"transcription_error_toast",audioConsentEnabled:A}),(0,o().u)({environment:e,event:{eventName:"error_transcription_toast_resume_button_clicked",eventProperties:{block_id:S.id,error_name:l}}})}}:F,secondary:g?F:void 0}})}},906065:(e,t,n)=>{function o(e){if(e.name.startsWith("Google "))return e.name.trim();const t=e.name.startsWith("Microsoft ")?1:0;return e.name.split(" ")[t]}n.d(t,{U:()=>o})},920329:(e,t,n)=>{n.r(t),n.d(t,{AudioSessionBlockWriter:()=>te,DictationManager:()=>ue,StreamingDictationManager:()=>me,startDictation:()=>ce,stopDictation:()=>de,updateActiveBlocks:()=>De});n(16280),n(18107),n(944114),n(816573),n(878100),n(177936),n(967357),n(748140),n(821903),n(491134),n(128845),n(237467),n(444732),n(979577),n(898992),n(823215),n(354520),n(672577),n(803949),n(581454);var o=()=>n(135168),i=()=>n(755531),r=()=>n(726637),a=()=>n(675133),s=()=>n(295633),u=()=>n(231940),c=()=>n(700500),d=()=>n(165358),D=()=>n(201980),l=()=>n(220719),m=()=>n(999752),p=()=>n(319625),v=()=>n(229833),f=()=>n(534177),g=()=>n(44729),C=()=>n(384944),S=()=>n(595345),A=()=>n(241314),F=()=>n(148555),h=()=>n(87017),E=()=>n(471083),y=()=>n(891360),k=()=>n(295304),b=()=>n(260850),_=()=>n(547149),B=()=>n(233124);n(410838);class T{constructor({id:e,isCompleteReceived:t,sortKey:n}){this.id=void 0,this.lastUpdated=void 0,this.text=void 0,this.isCompleteReceived=void 0,this.sortKey=void 0,this.transcriptions=void 0,this.id=e,this.lastUpdated=Date.now(),this.isCompleteReceived=Boolean(t),this.transcriptions=new Map,this.sortKey=n}updateText(){const e=Array.from(this.transcriptions.values()).findLast((e=>"complete"===e.status));this.text=e?e.text:void 0}setTranscription(e,t){this.transcriptions.set(e,t),this.updateText(),this.lastUpdated=Date.now()}setIsCompleteReceived(e){!this.isCompleteReceived&&e&&(this.isCompleteReceived=!0)}getId(){return this.id}getText(){return this.text}getSortKey(){return this.sortKey??0}getMsSinceLastUpdate(){return Date.now()-this.lastUpdated}isSettled(){return Date.now()-this.lastUpdated>n(615234).Xb||this.isCompleteReceived&&this.transcriptions.values().every((({status:e})=>"pending"!==e))}}var w=()=>n(914649),I=()=>n(909557),M=()=>n(28834);function N(e){let t;const n=[];for(const i of e.segments){var o;const r=i.getText();if(!r)continue;const a=i.isSettled()||e.forceSettled||!1;(null===(o=t)||void 0===o?void 0:o.settled)!==a?(t&&n.push(t),t={text:r,settled:a,segmentId:i.getId()}):t.text=`${t.text} ${r}`}return t&&n.push(t),n.length>0&&e.indent&&(n[0].text=` ${n[0].text}`),n}n(737550);function R(e){return!!(0,D().BEe)(e)&&e[1].some(D().Si1)}var P=()=>n(74e3),x=()=>n(899926);const L=/([\?\!\.])\s/;function U(e){const t=e.split(L);for(let n=1;n<t.length;n++){const e=t[n];[".","?","!"].includes(e)&&(t[n-1]+=e,t[n]="")}return t.filter((function(e){return void 0!==e&&""!==e}))}var q=()=>n(192359),z=()=>n(927648),O=()=>n(165121),W=()=>n(964345),V=()=>n(328194),J=()=>n(872903),Y=()=>n(242422),$=()=>n(44551);const j=[],H=(0,n(496603).nF)((()=>{const e=[...j];j.length=0,async function(e){var t;null===$().electronApi||void 0===$().electronApi||null===(t=$().electronApi.writeSessionLogs)||void 0===t||t.call($().electronApi,e)}(e)}),1e3);function K({messages:e,...t}){j.push({...t,timestamp:new Date,args:Array.isArray(e)?e:[e]}),H()}function G(e,t){Y().default.checkGate({gateName:"enable_transcription_session_logging"})&&function(e,t,...n){K({level:"info",messages:n,processName:e,sessionId:t})}("transcriptions",e,t)}function Z(e,t,n){Y().default.checkGate({gateName:"enable_transcription_session_logging"})&&function(e,t,...n){K({level:"error",messages:n,processName:e,sessionId:t})}("transcriptions",e,{...n,error:(0,p().A)(t)})}var Q;let X=250;class ee{constructor(){this.segments=void 0,this.segments=new Map}setSegment(e){this.segments.set(e.getId(),e)}getSegment(e){return this.segments.get(e)}getSortedSegments(){return[...this.segments.values()].sort(((e,t)=>e.getSortKey()-t.getSortKey()))}deleteSegment(e){this.segments.delete(e)}isSettled(){return this.getSortedSegments().every((e=>e.isSettled()))}}class te{constructor(e){this.id=void 0,this.env=void 0,this.rootBlockId=void 0,this.isCompleteReceived=void 0,this.blockStore=void 0,this.onUpdateBlock=void 0,this.segmentManager=void 0,this.speakerName=void 0;const{id:t,env:n,rootBlockId:o,blockStore:i,onUpdateBlock:r}=e;this.id=t,this.env=n,this.isCompleteReceived=!1,this.rootBlockId=o,this.blockStore=i,this.onUpdateBlock=r,this.segmentManager=new ee}getOrCreateSegment(e,t){const n=this.segmentManager.getSegment(e);if(n)return n;const o=new T({id:e,sortKey:null==t?void 0:t.sortKey});return this.segmentManager.setSegment(o),o}getBlockStore(){return this.blockStore}setBlockStore(e){var t;this.blockStore=e,null===(t=this.onUpdateBlock)||void 0===t||t.call(this,e)}logInsert({final:e,...t}){G(this.rootBlockId,{...t,type:"insert:"+(e?"final":"temp"),sessionId:this.id,blockId:this.blockStore.id})}logDelete(e){G(this.rootBlockId,{...e,type:"delete",sessionId:this.id,blockId:this.blockStore.id})}isStreamingModel(){var e;const t=new(s().B)(this.env,{table:n(179034).ev,id:this.rootBlockId});if(!t.isTranscriptionBlock())return!1;const o=(0,q().RW)(null===(e=t.getFormat())||void 0===e?void 0:e.transcription_model);return"baseten_diarization"===o||"fireworks_diarization"===o||"openai_diarization"===o||"no_diarization"!==o&&void 0!==o&&void(0,f().HB)(o)}setIsCompleteReceived(e){!this.isCompleteReceived&&e&&(this.isCompleteReceived=!0)}getId(){return this.id}isSettled(){return this.isCompleteReceived&&this.segmentManager.isSettled()}setSpeakerName(e){this.speakerName=e}writeToBlock(e=!1){const t=this.blockStore.getParentBlockStore();if(!this.blockStore.isDictatableBlock()||!t)return;let n=!1;const o=[],i=[];for(const s of[...this.segmentManager.getSortedSegments()])n||!e&&!s.isSettled()?(n=!0,i.push(s)):(o.push(s),this.segmentManager.deleteSegment(s.getId()));const{serverCommitResult:r,transactionId:a}=_().createAndCommit({userAction:"dictationActions.writeToBlock",environment:this.env,canUndo:!1,perform:n=>{let r,a=0;const s=this.blockStore.getBlockTitleStore(),u=(0,D().ooo)(s.getValue());for(let e=0;e<u.length;e++){if(R(u[e])){r=e;break}a+=(0,D().WWE)(u[e])}if(void 0!==r){if(0===o.length){const t=function(e){const{tokens:t,...n}=e,o=N(n);return o.length===t.length&&o.every((({text:e,settled:n},o)=>{const i=t[o];return!(R(i)?n:!n)&&e===(0,D().N8A)(i)}))}({segments:i,tokens:u.slice(r),forceSettled:e,indent:a>0});if(t)return}this.logDelete({transactionId:n.id,index:a}),k().jQ({environment:this.env,store:s,selection:{startIndex:a,endIndex:1/0},transaction:n,updateSelection:!1})}const c=function(e){const{text:t,maxLength:n=1/0,initialLength:o=0}=e;if(0===n)throw new Error("Max length must be >0");let i=o,r="";const a=[];for(const s of t)r=""===r?s:`${r} ${s}`,i=r.length,i>=n&&(a.push(r),r="",i=0);return r&&a.push(r),a}({text:U(re([...o.values()])),initialLength:a,maxLength:X});for(const e of c){const o=this.isStreamingModel();if(!o){const t=a>0?` ${e}`:e;this.logInsert({transactionId:n.id,text:t,index:a,settled:!0,final:!0}),ie({environment:this.env,audioSessionId:this.id,blockStore:this.blockStore,index:a,transcriptions:[{text:t,settled:!0}],transaction:n,speakerName:this.speakerName}),a+=t.length}if(a>X){const e=oe({environment:this.env,parentBlockStore:t,siblingBlockStore:this.blockStore,transaction:n});this.setBlockStore(e),a=0}if(o){const t=a>0?` ${e}`:e;this.logInsert({transactionId:n.id,text:t,index:a,settled:!0,final:!0}),ie({environment:this.env,audioSessionId:this.id,blockStore:this.blockStore,index:a,transcriptions:[{text:t,settled:!0}],transaction:n,speakerName:this.speakerName}),a+=t.length}}const d=N({segments:i,forceSettled:e,indent:a>0});0!==d.length&&(d.forEach((({text:e,settled:t})=>{this.logInsert({transactionId:n.id,text:e,index:a,settled:t,final:!1})})),ie({environment:this.env,audioSessionId:this.id,blockStore:this.blockStore,index:a,transcriptions:d,transaction:n,speakerName:this.speakerName}))}});r.catch((e=>{Z(this.rootBlockId,e,{type:"transactionError",transactionId:a})}))}}function ne(e){return _().createAndCommit({userAction:"dictationActions.createDictationBlock",environment:e.environment,canUndo:!1,perform:t=>oe({...e,transaction:t})})}function oe(e){var t,n;const{environment:o,parentBlockStore:i,siblingBlockStore:a,transaction:u}=e,d=(null==a?void 0:a.getDictationRoleModel())??c().xd.text,D=null===(t=W().ei.state)||void 0===t?void 0:t.isTranscriptionBlock();if(r().A.isMobile&&!D&&!i.isTranscriptionBlock()){const e=h().insertBlockBelow({environment:o,selection:a?[a]:[],createBlockItem:E().ry[d],transaction:u,analyticsFrom:"dictation",preventSetSelection:!0});return(0,b().z)({store:e.getBlockTitleStore()}),e}const l=i.isTranscriptionBlock()?null===(n=i.getContentStores().find((e=>{const t=i.getFormat().transcription_transcript_id;return e.id===t})))||void 0===n?void 0:n.getContentStore():i.getContentStore();if(!l)throw new Error("No parent dictation content store found");const m=C().Wv({environment:o,type:d,inMemoryRecordCache:i.inMemoryRecordCache,transaction:u});return g().NI({parentStore:l,childStore:s().B.createChildStore(l,m.pointer),after:null==a?void 0:a.id,transaction:u}),m}function ie(e){var t,o;const{environment:i,audioSessionId:a,blockStore:s,index:u,transcriptions:c,transaction:d,speakerName:l}=e;if(!s.isDictatableBlock())return;const m=[],p=c.filter((e=>Boolean(e.text)));for(const[n,r]of p.entries()){const{text:e,settled:t}=r,o=n===p.length-1?e:`${e} `,i=t?(0,D().Ey_)(o):(0,D().Ey_)(o,[(0,D().lf7)(w().h5,a,r.segmentId)]);m.push(i)}k().yr({environment:i,index:u,store:s.getBlockTitleStore(),tokens:m,transaction:d,updateSelection:!1}),l&&(null===(t=s.getFormat().transcript_metadata)||void 0===t?void 0:t.speaker_name)!==l&&n(896628).zA({stores:[s],update:{transcript_metadata:{...s.getFormat().transcript_metadata,speaker_name:l}},transaction:d});const v=null===(o=W().ei.state)||void 0===o?void 0:o.isTranscriptionBlock();r().A.isMobile&&!v&&(0,b().z)({store:s.getBlockTitleStore()})}function re(e){return e.map((e=>e.getText())).filter((e=>Boolean(e))).join(" ").trim()}function ae(e){return new Promise(((t,n)=>{try{const o=new Blob(e),i=new FileReader;i.readAsDataURL(o),i.onloadend=()=>{var e;const o=null===(e=i.result)||void 0===e?void 0:e.toString().split(",")[1];o?t(o):n(new Error("No base64Audio"))}}catch(o){n(o)}}))}function se(e,t,o){if((0,f().O9)(o)&&!o.pathIsDead()&&o.id!==t.id){const i=(0,u().N)(t),r=(0,u().N)(o);if((0,f().O9)(i)&&(0,f().O9)(r)&&i.id===r.id){const i=(0,n(330361).g)(o);if((()=>{for(const e of i)if(e instanceof s().B){if(e.id===t.id)return!0;if(e.id===r.id)return!1}return!1})()){const t=o.getParentBlockStore();if(o.isEmptyDictatableBlock()&&[...W().Ay.state.audioSessionBlockWriters.values()].every((e=>e.getBlockStore().id!==o.id)))return o;if(t)return ne({environment:e,parentBlockStore:t,siblingBlockStore:o}).performResult}}}return ne({environment:e,parentBlockStore:t}).performResult}class ue{static async getAllProcessableFramesAsBase64(e){const t=16*Math.max(1,e),n=Math.floor(this.audioBuffer.length/t);if(n>0){const e=n*t,o=this.audioBuffer.slice(0,e);return this.audioBuffer=this.audioBuffer.slice(e),this.audioEncoderQueue.enqueue((()=>ae([new Float32Array(o)])))}return!1}static getDictationAudioRecorder(e){const{environment:t,includeSystemAudio:n,blockStore:o,saveLocalRecordings:i=!1,onDataReceived:r=(e=>{})}=e,a=W().Ay.state.audioRecorder;a&&a.destroy();const s=i&&o.isTranscriptionBlock()?{blockStore:o}:void 0;return new(M().Nr)({environment:t,onDataReceived:r,onStop:e=>{e&&d().log({level:"error",from:"dictationActions",type:"audioRecorderStopped",error:(0,v().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:o.id}}}),de({environment:t,error:e,from:"audio_recorder_stopped"})},includeSystemAudio:n,saveAudioFileMetadata:s})}static generateOnDataReceivedForEnvironmentAndBlockStore(e){const{environment:t,blockStore:n}=e;return e=>{W().gZ.state&&(this.audioBuffer.push(...e),this.getAllProcessableFramesAsBase64(96).then((e=>{if(e){var i;const r=(0,P().$)((0,x().F)(t.currentUser.id));(0,S().$g)({base64Audio:e,environment:t,language:r,spaceId:null===(i=(0,o().f)(n))||void 0===i?void 0:i.getSpaceId(),blockId:n.id,onRequestSent:()=>{W().Ay.setState({...W().Ay.state,transcriptionLastSentAt:Date.now()})}}).catch((e=>{d().log({level:"error",from:"dictationActions",type:"sendAudioDataFailed",error:(0,v().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:n.id}}})}));const a=W().ei.state;if(a&&a.isTranscriptionBlock()&&W().Ay.state.audioRecorderShouldAutoStopOnTranscriptionStateChanges){"transcribing"!==(0,q().by)(a).state&&de({environment:t,from:"transcription_block_stopped"})}}})).catch((e=>{d().log({level:"error",from:"dictationActions",type:"audioRecorderFailed",error:(0,v().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:n.id}}})})))}}static async startDictation(e){const{environment:t,blockStore:i,from:r}=e,a=i,s=a.isTranscriptionBlock();try{this.stopDictation({environment:t,from:r}),this.startController=new AbortController;const i=this.startController.signal;let m;if(W().Ay.setState({...W().Ay.state,environment:t,tabId:t.device.isElectron?n(92697).A.state.currentTab.id:void 0,loading:!0}),e.preCreateDictationBlock&&a){const{performResult:e}=ne({environment:t,parentBlockStore:a});m=e,await n(908006).default.afterNextFlush((()=>{(0,n(301809).e)({store:e.getBlockTitleStore()})}))}const f=(0,S().qY)();(0,B().uB)(t,{dictation_session_id:f,from:r});if(!s||!(0,n(789370).x)())throw new Error("Target is not dictatable.");const g=await(0,q().Y2)({environment:t,spaceStore:(0,o().f)(a)}),C=this.getDictationAudioRecorder({...e,blockStore:a,saveLocalRecordings:g});le.start(a.id);const F={};try{var u;const r=performance.now(),c=await(0,n(111119).l)();F.getDeviceVolumeTiming=performance.now()-r;const D=performance.now();await C.start(),F.audioRecorderStartTiming=performance.now()-D,z().Ay.setState({...z().Ay.state,audio:w().a3});const p=performance.now(),v=e=>{var i;(0,A().rJ)({environment:t,rootBlockId:(0,l().o9)(a.id),spaceId:(null===(i=(0,o().f)(a))||void 0===i?void 0:i.getSpaceId())??"",connection:e});const r=n(748197).c.getModelOverride(a.id);(0,S().sN)({environment:t,setting_type:"model_override",model:r,rootBlockId:a.id,disableToast:"none"===r,connection:e})};if((0,A().aT)(v),await(0,A().A7)(t),F.startNewPrimusClientTiming=performance.now()-p,i.aborted)throw new Error("start dictation aborted");const g=s?null===(u=(0,n(654069).D)({environment:t,transcriptionBlockStore:a,tabType:"transcript",withTextBlock:!0}))||void 0===u?void 0:u.getContentStores().at(-1):n(206051).default.state.stores.slice(-1).pop();W().Ay.setState({...W().Ay.state,audioRecorder:C,enabled:!0,talking:!1,rootBlock:a,block:m??se(t,a,g),lastReceivedTranscriptionAt:Date.now(),transcriptionLastSentAt:Date.now()}),C.setOnDataReceived(this.generateOnDataReceivedForEnvironmentAndBlockStore({environment:t,blockStore:a})),(0,B().D_)(t,{dictation_session_id:f,block_id:a.id,transcription_started_from:e.transcriptionStartedFrom,has_audio_consent:e.audioConsentEnabled,device_volume:c}),d().log({level:"info",from:"dictationActions",type:"startDictationTiming",data:{miscDataToConvertToString:{dictationSessionId:f,rootBlockId:a.id,...F}}})}catch(c){if(!i.aborted)try{const{audio:n}=await z().Ay.checkPermissions(e.includeSystemAudio);(0,B().rP)(t,{type:"mic_permissions",dictation_session_id:f,reason:n})}catch(c){d().log({level:"error",from:"dictationActions",type:"checkPermissionsFailed",error:(0,v().convertErrorToLog)(c),data:{miscDataToConvertToString:{dictationSessionId:f,rootBlockId:a.id}}})}C.destroy((0,p().A)(c));try{(0,A().Ep)(t)}catch(D){d().log({level:"error",from:"dictationActions",type:"startDictationClosePrimusClientFailed",error:(0,v().convertErrorToLog)(D)})}if(s){const{audio:t,screenRecording:n}=await z().Ay.checkPermissions(e.includeSystemAudio);throw d().log({level:"error",from:"dictationActions",type:"dictationFailedToStart",error:(0,v().convertErrorToLog)(c),data:{miscDataToConvertToString:{dictation_session_id:f,transcription_id:a.id,audioPermissions:t,screenRecordingPermissions:n,...F}}}),Z(a.id,c,{type:"dictationStartError",from:r}),c}}}catch(c){if(this.stopDictation({environment:t,from:"start_transcription_error",error:(0,p().A)(c)}),s)throw c}finally{W().Ay.setState({...W().Ay.state,loading:!1})}}static stopDictation(e){const t=W().Ay.state.rootBlock;if((0,A().bT)(),this.startController&&!this.startController.signal.aborted){this.startController.abort();const{environment:i,error:r,from:s}=e,u=(0,S().qY)();if((0,B().E_)(i,{dictation_session_id:u,from:s}),(0,n(632176).isExplainableTranscriptionStopReason)(s)&&!r){const p=W().Ay.state.rootBlock;p&&(0,F().B)(i,{toastId:"transcription_recording_stopped",pointer:p.pointer,from:s})}const c=W().Ay.state.tabId;function D(e){const{canRestart:o,name:r,title:a,message:s,notificationBody:u}=e;null!=t&&t.isTranscriptionBlock()&&((0,F().B)(i,{toastId:"transcription_error",pointer:t.pointer,tabId:c,title:a,message:s,name:r,canRestart:o}),(0,n(299903).sendNotificationForDictationInterrupted)({environment:i,blockStore:t,title:a,message:u||s,canRestart:o&&(null==t?void 0:t.isTranscriptionBlock()),tabId:c}))}const l=W().Ay.state.audioRecorder,m=W().Ay.state.enabled;W().Ay.setState({...W().Ay.state,audioRecorder:void 0,audioRecorderShouldAutoStopOnTranscriptionStateChanges:!1,enabled:!1,loading:!1,rootBlock:void 0,block:void 0,tabId:void 0,lastReceivedTranscriptionAt:void 0,transcriptionLastSentAt:void 0}),null==l||l.destroy(r),r&&(d().log({level:"error",from:"dictationActions",type:"dictationError",error:(0,v().convertErrorToLog)(r),data:{miscDataToConvertToString:{dictation_session_id:u,block_id:(null==t?void 0:t.id)??""}}}),t&&Z(t.id,r,{type:"dictationError",from:s}),r instanceof I().XG?((0,B().rP)(i,{type:"throttle",dictation_session_id:u}),(0,J().displayDictationUsageErrorSnackbar)()):r instanceof I().eY?((0,B().rP)(i,{type:"missing_user_or_space",dictation_session_id:u,reason:r.message}),(0,J().displayDictationGenericErrorSnackbar)()):r instanceof I().d1?((0,B().rP)(i,{type:"mic_permissions",dictation_session_id:u,reason:z().Ay.state.audio}),(0,J().displayDictationPermissionSnackbar)(w().JS)):r instanceof I().Rv?((0,B().rP)(i,{type:"forbidden",dictation_session_id:u}),D({canRestart:!1,name:r.name,title:a().A.intl.formatMessage({id:"dictationActions.stopDictation.error.forbidden.title",defaultMessage:"Unable to transcribe"}),message:a().A.intl.formatMessage({id:"dictationActions.stopDictation.error.forbidden.message",defaultMessage:"You do not have permission to run transcription."})})):r instanceof I().Dg?((0,B().rP)(i,{type:"upgrade_required",dictation_session_id:u}),D({canRestart:!1,name:r.name,title:a().A.intl.formatMessage({id:"dictationActions.stopDictation.error.upgradeRequired.title",defaultMessage:"You have used all of your free AI Meeting Notes minutes"}),message:a().A.intl.formatMessage({id:"dictationActions.stopDictation.error.upgradeRequired.message",defaultMessage:"Upgrade your workspace for full access to AI Meeting Notes."})})):r instanceof I().E6?D({canRestart:!0,name:r.name,title:a().A.intl.formatMessage({id:"dictationActions.stopDictation.error.openAI.title",defaultMessage:"Transcription paused"}),message:a().A.intl.formatMessage({id:"dictationActions.stopDictation.error.openAI.message",defaultMessage:"We are experiencing high demand. Please wait and try again."}),notificationBody:a().A.intl.formatMessage({id:"dictationActions.stopDictation.error.openAI.notification",defaultMessage:"We are experiencing high demand. Please wait and click to resume."})}):r instanceof Error&&D({canRestart:!0,name:r.name,title:a().A.intl.formatMessage({id:"dictationActions.stopDictation.error.general.title",defaultMessage:"Transcription paused"}),message:a().A.intl.formatMessage({id:"dictationActions.stopDictation.error.general.message",defaultMessage:"Something went wrong. Please try again."}),notificationBody:a().A.intl.formatMessage({id:"dictationActions.stopDictation.error.general.notification",defaultMessage:"Something went wrong. Please click to resume."})}));try{(0,A().Ep)(i)}catch(o){d().log({level:"error",from:"dictationActions",type:"stopDictationClosePrimusClientFailed",error:(0,v().convertErrorToLog)(o)})}finally{le.stop(null==t?void 0:t.id);const f=W().Ay.state.audioSessionBlockWriters;let g=!1;for(const C of f.values())C.writeToBlock(!0),f.delete(C.getId()),g=!0;g&&W().Ay.emit(),m&&(0,B().Im)(i,{dictation_session_id:u,block_id:(null==t?void 0:t.id)??""}),null!=t&&t.isTranscriptionBlock()&&e.environment&&V().w.load().then((n=>n.ensureTranscriptionIsInActive({environment:e.environment,blockStore:t,from:e.from})))}}}}async function ce(e){return ue.startDictation(e)}function de(e){const{environment:t,error:n,from:o}=e;ue.stopDictation({environment:t,error:n,from:o})}async function De(e){const t=(0,i().S)();if(!t)return;const n={};for(const i of e){var o;const e=i.pointer,r=s().B.createChildStore(t,e);if(await r.load(),!r.isTranscriptionBlock()||r.id===(null===(o=W().Ay.state.rootBlock)||void 0===o?void 0:o.id))continue;const a=(0,q().y1)(r,"transcript");if(!a)continue;await a.load();const u=a.getContentStores().at(-1);u&&(await u.load(),n[e.id]={rootBlockStore:r,dictatingBlockStore:u})}W().Ay.setState({...W().Ay.state,passiveBlockMap:{...W().Ay.state.passiveBlockMap,...n}})}ue.startController=void 0,ue.audioBuffer=[],ue.audioEncoderQueue=new(m().O)(1);class le{constructor(){if(le.instance)return le.instance;le.instance=this}static start(e){G(e,{type:"start"}),this.listening||(this.listening=!0,A().$I.on(A().Ux,le.processTranscriptionResult),A().$I.on(A().L6,le.processVadEvent),A().$I.on(A().bH,le.processRateLimitEvent),A().$I.on(A().zz,le.processForbiddenEvent),A().$I.on(A().gA,le.processUpgradeRequiredEvent),A().$I.on(A().YE,le.processFreeTrialLimitEvent),A().$I.on(A().ZQ,le.processOpenAIErrorEvent),A().$I.on(A().ys,le.processAudioWriterSettingsEvent),A().$I.on(A().YA,le.processServiceStatusUpdateEvent))}static stop(e){e&&G(e,{type:"stop"}),this.listening&&(this.listening=!1,A().$I.off(A().Ux,le.processTranscriptionResult),A().$I.off(A().L6,le.processVadEvent),A().$I.off(A().bH,le.processRateLimitEvent),A().$I.off(A().zz,le.processForbiddenEvent),A().$I.off(A().gA,le.processUpgradeRequiredEvent),A().$I.off(A().YE,le.processFreeTrialLimitEvent),A().$I.off(A().ZQ,le.processOpenAIErrorEvent),A().$I.off(A().ys,le.processAudioWriterSettingsEvent),A().$I.off(A().YA,le.processServiceStatusUpdateEvent))}static processOpenAIErrorEvent(e){if(429===e.status||503===e.status){var t;const{environment:n}=W().Ay.state;n&&de({environment:n,error:new(I().E6)(e.message,e.status),from:"transcription_error"}),d().log({level:"error",from:"dictationActions",type:"openAIError",error:(0,v().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=W().Ay.state.rootBlock)||void 0===t?void 0:t.id,dictationConnectionState:(0,S().qY)()}}})}}static processForbiddenEvent(e){var t;const{environment:n}=W().Ay.state;n&&de({environment:n,error:new(I().Rv)("Not eligible for dictation"),from:"forbidden"}),d().log({level:"error",from:"dictationActions",type:"forbidden",error:(0,v().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=W().Ay.state.rootBlock)||void 0===t?void 0:t.id,dictationConnectionState:(0,S().qY)()}}})}static processServiceStatusUpdateEvent(e){var t;"temporarily_unavailable"===e.state?(O().A.setState("transcription_service_unavailable"),d().log({level:"error",from:"dictationActions",type:"SocketTemporarilyUnavailable",data:{miscDataToConvertToString:{state:e.state,rootBlockId:null===(t=W().Ay.state.rootBlock)||void 0===t?void 0:t.id,dictationConnectionState:(0,S().qY)()}}})):"healthy"===e.state&&O().A.setState("connected")}static processFreeTrialLimitEvent(e){y().W.setState({type:"available",usage:e.currentS,limit:e.limitS})}static processAudioWriterSettingsEvent(e){X=e.settings.max_block_char_size;const t=e.settings.transcription_model,n=W().Ay.state.rootBlock,o=W().Ay.state.environment;t&&n&&o&&V().w.load().then((e=>e.updateTranscriptionModel({environment:o,blockStore:n,transcriptionModel:t})))}static processUpgradeRequiredEvent(e){var t,i,r;const{environment:a}=W().Ay.state;y().W.setState({type:"unavailable"}),a&&de({environment:a,error:new(I().Dg)("Free usage used up, workspace upgrade is required"),from:"upgrade_required"}),d().log({level:"info",from:"dictationActions",type:"upgrade_required",error:(0,v().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=W().Ay.state.rootBlock)||void 0===t?void 0:t.id,userId:null===(i=n(907258).default.state.currentUserStore)||void 0===i?void 0:i.id,spaceId:null===(r=(0,o().f)(W().Ay.state.rootBlock))||void 0===r?void 0:r.id}}})}static processRateLimitEvent(e){var t;const{environment:n}=W().Ay.state;y().W.setState({type:"rateLimited",retryAfterSec:e.retryAfterSec}),n&&de({environment:n,error:new(I().XG)("Audio usage limit reached"),from:"rate_limit"}),d().log({level:"error",from:"dictationActions",type:"rateLimit",error:(0,v().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=W().Ay.state.rootBlock)||void 0===t?void 0:t.id}}})}static processVadEvent(e){W().Ay.setState({...W().Ay.state,talking:e.talking})}static updateDictationBlock(e){W().Ay.setState({...W().Ay.state,block:e})}static processTranscriptionResult(e){const{audioSessionId:t,segmentId:o,isSegmentComplete:i,segmentSortkey:r,isAudioSessionComplete:a,transcription:s,speakerName:u}=e,{enabled:c,rootBlock:d,audioSessionBlockWriters:D,environment:l,block:m}=W().Ay.state;"disconnected"===O().A.state&&O().A.setState("connected"),"complete"===s.status&&null!=d&&d.isTranscriptionBlock()&&l&&((0,n(564884).u)({environment:l,event:{eventName:"meeting_note_transcription_received",eventProperties:{block_id:d.id,audio_duration:s.audioDuration,text_length:s.text.length}}}),G(d.id,{type:"transcription",status:s.status,sessionId:t,isSessionComplete:a,segmentId:o,isSegmentComplete:i,transcriptionId:s.id,text:s.text}));let p=!1;if(!D.has(t)&&l&&c)if(d){const e=se(l,d,m),n=new te({id:t,env:l,rootBlockId:d.id,blockStore:e,onUpdateBlock:e=>{t===W().Ay.state.latestSessionId&&le.updateDictationBlock(e)}});D.set(t,n),p=!0,W().Ay.setState({...W().Ay.state,block:e,latestSessionId:t})}else de({environment:l,from:"block_not_available"});const v=D.get(t);if(v){v.setIsCompleteReceived(a);const e=v.getOrCreateSegment(o,{sortKey:r});e.setIsCompleteReceived(i),e.setTranscription(s.id,s),u&&v.setSpeakerName(u)}for(const n of D.values())n.writeToBlock();for(const n of[...D.values()].filter((e=>e.isSettled())))D.delete(n.getId()),p=!0,c&&l&&d&&W().Ay.state.latestSessionId===n.getId()&&W().Ay.setState({...W().Ay.state,block:se(l,d,W().Ay.state.block)});c&&W().Ay.setState({...W().Ay.state,lastReceivedTranscriptionAt:Date.now()}),p&&W().Ay.emit()}}le.instance=void 0,le.listening=!1;class me{static getAllProcessableFramesAsBase64(e){const t=16*Math.max(1,e),n=Math.floor(this.audioBuffer.length/t);if(n>0){const e=n*t,o=this.audioBuffer.slice(0,e);return this.audioBuffer=this.audioBuffer.slice(e),this.audioEncoderQueue.enqueue((()=>ae([o])))}return Promise.resolve(!1)}static async start(e){try{this.stop(),this.startController=new AbortController,this.env=e.environment,this.isActive=!0,this.currentTranscript="",this.segments.clear(),this.transcriptionListener=e.onTranscription,this.onErrorListener=e.onError,this.streamingSessionId=(0,S().qY)(),await(0,A().A7)(e.environment),this.audioRecorder=new(M().Nr)({environment:e.environment,onDataReceived:t=>{this.audioBuffer=new Float32Array([...this.audioBuffer,...t]),this.getAllProcessableFramesAsBase64(96).then((t=>{if(t){const n=(0,P().$)((0,x().F)(e.environment.currentUser.id));(0,S().$g)({base64Audio:t,environment:e.environment,language:n,spaceId:e.spaceId,blockId:""}).catch((()=>{}))}})).catch((()=>{}))},onStop:()=>{me.stop()},includeSystemAudio:!1}),await this.audioRecorder.start(),A().$I.on(A().Ux,this.handleTranscriptionEvent)}catch(t){this.onErrorListener&&t instanceof Error&&this.onErrorListener(t),this.stop()}}static stop(){var e;this.isActive&&(this.isActive=!1,this.startController&&!this.startController.signal.aborted&&this.startController.abort(),A().$I.off(A().Ux,this.handleTranscriptionEvent),null===(e=this.audioRecorder)||void 0===e||e.destroy(),(0,A().Ep)((0,l().o9)(this.env)),this.audioRecorder=void 0,this.streamingSessionId=void 0,this.env=void 0)}}Q=me,me.startController=void 0,me.env=void 0,me.audioBuffer=new Float32Array,me.audioEncoderQueue=new(m().O)(1),me.audioRecorder=void 0,me.streamingSessionId=void 0,me.isActive=!1,me.transcriptionListener=void 0,me.onErrorListener=void 0,me.segments=new Map,me.currentTranscript="",me.handleTranscriptionEvent=e=>{var t;const n=e.segmentId;let o=Q.segments.get(n);o||(o=new T({id:n,sortKey:e.segmentSortkey}),Q.segments.set(n,o)),o.setIsCompleteReceived(e.isSegmentComplete),o.setTranscription(e.transcription.id,e.transcription);const i=re(Array.from(Q.segments.values()));Q.currentTranscript=i,null===(t=Q.transcriptionListener)||void 0===t||t.call(Q,Q.currentTranscript)}},932166:(e,t,n)=>{n.r(t),n.d(t,{startTranscribingBlockOnPageFromTrustedSource:()=>u,startTranscribingBlockOnPageFromUntrustedSource:()=>c});var o=()=>n(44551);var i=()=>n(486674),r=()=>n(192359),a=()=>n(362075),s=()=>n(116730);async function u(e){const{environment:t,from:n}=e,o=(0,i().a)();if(!o)return;const u=(0,r().Ql)(o);u.sort(((e,t)=>t.getCreatedTime()-e.getCreatedTime()));const c=u[0];if(c){const e=(0,a().yz)();await(0,s().startTranscription)({environment:t,blockStore:c,from:n,audioConsentEnabled:e})}}async function c(e){const{environment:t,from:n,nonce:i}=e;if(await async function(){return null!==o().electronApi&&void 0!==o().electronApi&&o().electronApi.getMeetingNotificationNonce?await o().electronApi.getMeetingNotificationNonce():""}()===i)return u({environment:t,from:n})}}}]);