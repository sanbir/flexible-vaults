"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[63717],{260513:(e,t,s)=>{s.r(t),s.d(t,{collectMentionUserIds:()=>g,fetchExtendedUserProfile:()=>h,prefetchExtendedUserProfiles:()=>I,prefetchMentionedUserProfiles:()=>b});s(944114),s(517642),s(658004),s(733853),s(845876),s(432475),s(515024),s(731698),s(898992),s(354520),s(672577);var n=()=>s(230711),o=()=>s(929219),i=()=>s(351776),r=()=>s(848538),c=()=>s(798880),a=()=>s(201980),d=()=>s(496603),u=()=>s(498212);class f{constructor(e,t,s,n){this.pendingInvocations=new Map,this.fn=e,this.coalesce=t,this.waitMs=s,this.options=n}enqueue(e){for(const[s,n]of this.pendingInvocations){const t=this.coalesce(s,e);if(t)return this.pendingInvocations.delete(s),this.pendingInvocations.set(t,n),void n.dequeueDebounced(t)}const t=(0,d().sg)(this.dequeue.bind(this),this.waitMs,this.options);this.pendingInvocations.set(e,{dequeueDebounced:t}),t(e)}dequeue(e){this.pendingInvocations.delete(e),this.fn.apply(null,e)}}var p=()=>s(683e3);const l=10;async function h(e){const{viewedUserId:t,actorUserId:s,spaceStore:o,store:r,environment:c}=e;if(!r.isRefetchThrottleReady())return;const a=(0,n().dp)(o,t),u=(0,n().dp)(o,s);if(!(0,i().$)(a.getMembershipType())||!(0,i().n)(u.getMembershipType()))return;const f=await c.api.callCellCompatibleApi({eventName:"getExtendedUserProfiles",environment:c,data:{userIds:[t],spaceId:o.id,includePermissionGroupMemberCounts:!1},cellNavigation:{spaceId:o.id}});if("failed"===f.type)throw f.error;f.type;const l=(0,p().ed)(f.data).find((e=>e.userId===t));l&&((0,d().n4)(l,r.state)||r.setState(l))}const I=function(e,t,s,n){const o=new f(e,t,s,n);return(...e)=>o.enqueue(e)}((async function(e,t){const{spaceStore:n,actorUserId:o}=e,c=n.id,a=e.viewedUserIds.filter((e=>!(0,p().Of)({spaceId:c,actorUserId:o,viewedUserId:e})));if(0===a.length)return;const u=s(76549).VF.createChildStore(n,{id:(0,r().i1)({userId:o,spaceId:c}).id,table:r().aJ,spaceId:c});if(!(0,i().n)(u.getMembershipType()))return;const f=await t.api.callCellCompatibleApi({environment:t,eventName:"getExtendedUserProfiles",data:{spaceId:c,userIds:a,includePermissionGroupMemberCounts:!1},cellNavigation:{spaceId:c}});if("failed"===f.type)return;for(const s of(0,p().ed)(f.data)){const e=(0,p().e9)({spaceId:c,actorUserId:o,viewedUserId:s.userId});(0,d().n4)(s,e.state)||e.setState(s)}}),(([e,t],[n,o])=>{if(e.spaceStore.id!==n.spaceStore.id||e.actorUserId!==n.actorUserId||!Object.is(t,o))return!1;return[{...e,viewedUserIds:(0,s(806080).sb)([...e.viewedUserIds,...n.viewedUserIds]).slice(0,s(571595).sD)},o]}),1e3,{maxWait:3e3});function g(e,t){const s=new Set,n=[e];function o(e){u().w7.includes(e)||s.add(e)}function i(e){e.table===c().oo&&o(e.id)}let r=0;e:for(;n.length>0&&s.size<t&&r<100;){r+=1;const c=n.pop();if(!c.isDefined())continue;for(const e of(0,a().Fbh)(c.getTitleValue()))if(o(e),s.size>=t)break e;if(c===e){const e=c.getCreatedByPointer();if(e&&i(e),s.size>=t)break e;const n=c.getLastEditedByPointer();if(n&&i(n),s.size>=t)break e}const d=c.getProperties();for(const e of Object.keys(d)){const n=d[e];if(n)for(const e of(0,a().Fbh)(n))if(o(e),s.size>=t)break e}for(const e of c.getDiscussionStores())for(const n of e.getCommentStores()){const e=n.getCreatedByPointer();if(e&&i(e),s.size>=t)break e;for(const i of(0,a().Fbh)(n.getText()))if(o(i),s.size>=t)break e}const u=c.getRenderableContentStores();for(let e=u.length-1;e>=0;e--){const t=u[e];t.isNavigableBlock()||n.push(t)}}return Array.from(s)}function b(e,t){if(!o().e.state)return;const s=e.getSpaceStore();if(!s||!s.id||!s.userId)return;const n=g(e,l);0!==n.length&&I({spaceStore:s,actorUserId:s.userId,viewedUserIds:n},t)}},683e3:(e,t,s)=>{s.d(t,{Of:()=>d,e9:()=>u,ed:()=>f});s(944114);var n=()=>s(759303);const o=100;class i extends(()=>s(757695))().Store{constructor(...e){super(...e),this.lastFetchTimestamp=void 0}getInitialState(){}isRefetchThrottleReady(){const e=Date.now();return!(void 0!==this.lastFetchTimestamp&&e-this.lastFetchTimestamp<1e4)&&(this.lastFetchTimestamp=e,!0)}}let r;function c(){return r??=new(n().q)({max:o})}function a(e){return`${e.spaceId}:${e.actorUserId}:${e.viewedUserId}`}function d(e){const t=c().peek(a(e));return Boolean(t&&void 0!==t.state)}function u(e){const t=c(),s=a(e),n=t.get(s);if(n)return n;const o=new i;return t.set(s,o),o}function f(e){const t=e.profiles,s=[];for(const n of Object.keys(t)){const e=t[n];s.push({userId:n,timeZone:e.timeZone,permissionGroups:e.permissionGroups})}return s}(0,s(852832).exposeDebugGetter)("extendedUserProfileCache",c)}}]);