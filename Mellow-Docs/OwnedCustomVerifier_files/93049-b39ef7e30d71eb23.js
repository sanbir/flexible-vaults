"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[72181,93049],{53436:(e,t,o)=>{o.d(t,{E:()=>c});o(296540);var n=()=>o(59226),i=()=>o(401497),r=()=>o(100622),a=()=>o(209199),l=()=>o(993949),s=o(474848);function c(e){const{children:t,size:o="sm",...c}=e,d=(0,n().X)("editor_basic_rtl"),u=(0,i().IS)((()=>({wrapper:{display:"flex",alignItems:"center",gap:"lg"===o?2:void 0,background:r().Tj.background.elevated,boxShadow:r().Tj.shadowSM,borderRadius:6,width:"fit-content",padding:2}})),[o]);return(0,s.jsx)("div",{...c,dir:d&&(0,a().A1)()?"rtl":"ltr",style:u.wrapper,children:(0,s.jsx)(l().J.Provider,{value:{size:o},children:t})})}},65824:(e,t,o)=>{o.d(t,{V:()=>s});var n=()=>o(564884),i=()=>o(384944),r=()=>o(547149),a=()=>o(94522),l=()=>o(791256);function s(e){const{environment:t,threadStore:o,stepId:s,showResults:c,traceId:d,from:u}=e,p=o.getStepStoreById(s);if(!p||"search"!==p.getKeyValue("type"))return;const f=(0,l().L2)(o);(0,n().u)({environment:t,event:{eventName:"ai_search_step_toggle_results",eventProperties:{search_session_id:f&&"search"===f.type?f.searchSessionId:void 0,thread_id:o.id,show_results:c,trace_id:d,from:u,workflow_id:(0,a().i4)(o)}}}),r().createAndCommit({userAction:"AIChatTranscript.SearchStep.toggleVisibleResults",environment:t,canUndo:!0,perform:e=>{i().zv({store:p,data:{showResults:c},transaction:e})}})}},272200:(e,t,o)=>{o.r(t),o.d(t,{trackAIAction:()=>a,trackAIAssistantEngineError:()=>f,trackAICompletionPopupClose:()=>p,trackAICompletionPopupOpen:()=>u,trackAIFavoriteAction:()=>s,trackAiAutofillAction:()=>c,trackAiAutofillSettingsAction:()=>d,trackUserFlow:()=>l});var n=()=>o(314529),i=()=>o(650829),r=()=>o(383070);function a(e,t){const{user_comment:o,...i}=t;(0,n().DO_NOT_USE_trackLegacy)(e,"ai_action",i)}function l(e,t,o){const i={site:"client",...o};(0,n().DO_NOT_USE_trackLegacy)(e,t,i)}function s(e,t){(0,n().DO_NOT_USE_trackLegacy)(e,"ai_favorite_action",t)}function c(e,t){(0,n().DO_NOT_USE_trackLegacy)(e,"ai_autofill_action",t)}function d(e,t){(0,n().DO_NOT_USE_trackLegacy)(e,"ai_autofill_settings_action",t)}function u(e,t){if(r().zD.isXMLAssistantEnabled()){var o;const n=(null===(o=t.sessionContext)||void 0===o?void 0:o.evaluatorFromStoreState.getTranscript())??[];i().assistantDependency.load().then((({assistantAnalyticsActions:o})=>{o.trackAssistantOpened(e,{from:t.from,sessionId:t.session_id,isReminder:!1,reminderType:void 0,startTimestamp:Date.now(),transcript:n,hasQuery:!1,searchSessionId:void 0})}))}else(0,n().DO_NOT_USE_trackLegacy)(e,"ai_completion_popup_open",{session_id:t.session_id,prompt_key:t.prompt_key,from:t.from})}function p(e,t){(0,n().DO_NOT_USE_trackLegacy)(e,"ai_completion_popup_close",t)}function f(e,t){(0,n().DO_NOT_USE_trackLegacy)(e,"ai_assistant_error",t)}},298182:(e,t,o)=>{o.d(t,{B5:()=>c,CJ:()=>a,CO:()=>r,Sf:()=>u,md:()=>l,wb:()=>s});o(814603),o(147566),o(198721);var n=()=>o(939768);const i={dateRangeFilter:{everything:!0},excludeCreatedByFilter:{everything:!0},createdByFilter:{everything:!1,notion:!0},titleOnlyFilter:{everything:!1,notion:!0},ancestorsFilter:{everything:!1,notion:!0},teamspacesFilter:{everything:!1,notion:!0}};function r(e,t){const o=function(e){switch(e){case"notion":case"workspace":case"teamspace":case"page":case"collection":case"site":return"notion";case"slack":return"slack";case"google-drive":return"google-drive";case"github":return"github";case"jira":return"jira";case"helpdocs":return"helpdoc";case"web":return"webpage";default:return"all"}}(e);return i[t][o]||i[t].everything}function a(e,t){return!!e&&Boolean(i[t][e]||i[t].everything)}const l=(0,o(756005).xS)({page:!0,collection:!1,createPage:!1,user:!0,inviteUserToWorkspace:!1,inviteUserToPage:!1,date:!0,reminder:!1,bot:!1,group:!1,team:!0,heading:!1,templateVariable:!1,formulaContextVariable:!1,slackSpecialMention:!1,property:!1});function s(e){switch(e){case"pull-request":return"Pull Request";case"issue":return"Issue";case"code":return"Code";default:return null}}function c(e){if(!e)return e;let t=e;return t=t.replace(/<gzkNfoUU>/g,"§§HIGHLIGHT_START§§"),t=t.replace(/<\/gzkNfoUU>/g,"§§HIGHLIGHT_END§§"),t=t.replace(/<(.*?)\|([^>]*)>/g,((e,t,o)=>{try{return new URL(o),d(o)}catch{return o.length>0?o:t}})),t=t.replace(/<(\S+(?:\s+\S+)*)>/g,((e,t)=>{try{return new URL(t),d(t)}catch{return t}})),t=u(t),t=t.replace(/§§HIGHLIGHT_START§§/g,"<gzkNfoUU>"),t=t.replace(/§§HIGHLIGHT_END§§/g,"</gzkNfoUU>"),t=function(e){return e.replace(/&amp;/g,"&")}(t),t}function d(e){if(!e||""===e.trim()||e.trim().includes(" "))return e;const t=e.trim();let o=n().qg(t),i=o.host;if(o.protocol&&i||(o=n().qg(`http://${t}`),i=o.host),!i)return e;i=i.replace(/^www./i,"");const r=o.pathname||"",a=o.hash||"";if(r.length+a.length<=20)return`${i}${r}${a}`;const l=r+a;return`(${i}${l.slice(0,3)}…${l.slice(-3)})`}function u(e){let t=e;return t=t.replace(/(&gt;)/g,">"),t=t.replace(/(&lt;)/g,"<"),t}},326496:(e,t,o)=>{o.d(t,{e:()=>r});var n=o(296540),i=o(474848);const r=(0,n.forwardRef)((function(e,t){const{children:r,relative:a,tooltip:l,tooltipPlacement:s="top",iconLeading:c,iconTrailing:d,...u}=e,{size:p}=(0,o(993949).M)(),f=(0,n.useMemo)((()=>c&&"sm"!==p?{size:"default",icon:c}:c),[c,p]),g=(0,n.useMemo)((()=>d&&"sm"!==p?{size:"default",icon:d}:d),[d,p]),m=(0,o(401497).IS)((()=>({button:{borderRadius:o(150161).VJ.xs,position:a?"relative":void 0}})),[a]),A=e=>(0,i.jsx)(o(631524).p,{ref:t,colorPalette:"gray",size:"sm",iconLeading:f,iconTrailing:g,external:!0,style:m.button,...(0,o(383036).A)(u,e),children:r?(0,i.jsx)(o(493552).D,{styleKey:"captionRegular",children:r}):void 0});return l?(0,i.jsx)(o(26697).m,{renderTooltip:()=>l,placement:s,alignment:"center",render:A}):A()}))},449268:(e,t,o)=>{o.d(t,{C:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"0.12 2.37 19.76 15.26",svg:(0,o(474848).jsx)("path",{d:"m3.625 8.849 1.187 1.187a.625.625 0 1 0 .884-.884L3.442 6.898a.625.625 0 0 0-.884 0L.304 9.152a.625.625 0 0 0 .884.884l1.187-1.187V10a7.625 7.625 0 0 0 12.813 5.588.625.625 0 1 0-.85-.916A6.375 6.375 0 0 1 3.625 10zm14 2.302 1.187-1.187a.625.625 0 0 1 .884.884l-2.254 2.254a.625.625 0 0 1-.884 0l-2.254-2.254a.625.625 0 1 1 .884-.884l1.187 1.187V10A6.375 6.375 0 0 0 5.662 5.328a.625.625 0 1 1-.85-.916A7.625 7.625 0 0 1 17.625 10z"})},i=(0,o(340498).wt)("arrowCircleLoopForward",n,"default")},495159:(e,t,o)=>{o.d(t,{LB:()=>c,VT:()=>l,vr:()=>s});var n=()=>o(686131),i=()=>o(295633),r=()=>o(116089),a=()=>o(836724);const l=(0,o(69708).YK)({askAI:{defaultMessage:"Ask AI",id:"id.completions.askAI"},genericHelpMeWrite:{defaultMessage:"{filter}",id:"id.completions.genericHelpMeWrite"},summarize:{defaultMessage:"Summarize",id:"id.completions.summarize"},findActionItems:{defaultMessage:"Find action items",id:"id.completions.findActionItems"},autofillSummary:{defaultMessage:"Summary",id:"id.completions.autofillSummary"},autofillTranslate:{defaultMessage:"Translate",id:"id.completions.autofillTranslate"},autofillExtract:{defaultMessage:"Key info",id:"id.completions.autofillExtract"},autofillCustom:{defaultMessage:"Custom autofill",id:"id.completions.autofillCustom"}}),s={text:{summarize:{name:l.autofillSummary,svg:o(37719).P},translate:{name:l.autofillTranslate,svg:o(877235).textTranslateIcon},extract:{name:l.autofillExtract,svg:o(202017).n},custom:{name:l.autofillCustom,svg:r().x}},select:{select:{name:l.autofillCustom,svg:r().x}},multi_select:{select:{name:l.autofillCustom,svg:r().x}}};function c(e){const{origin:t}=e;return t instanceof i().B?function(e){let t=a().T.findNodeFromStore(e);if(t){if("table"===e.getType()){const e=t.querySelector(`.${n().rb}.notion-table-block`);t=e??t}return t.getBoundingClientRect()}}(t):t instanceof HTMLElement?t.getBoundingClientRect():t}},582684:(e,t,o)=>{o.r(t),o.d(t,{arrowUpDownIcon:()=>i,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.24 3.26 15.53 13.47",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M14.075 3.45a.625.625 0 0 0-.884 0l-3.497 3.5a.625.625 0 0 0 .883.884l2.431-2.431v10.705a.625.625 0 0 0 1.25 0V5.402l2.431 2.43a.625.625 0 1 0 .884-.883zM2.427 12.167a.625.625 0 0 1 .884 0l2.43 2.431V3.893a.625.625 0 0 1 1.25 0v10.705l2.431-2.43a.625.625 0 0 1 .884.883L6.81 16.55a.625.625 0 0 1-.884 0l-3.498-3.498a.625.625 0 0 1 0-.884"})},i=(0,o(340498).wt)("arrowUpDown",n,"default")},583289:(e,t,o)=>{o.d(t,{U:()=>i});var n=()=>o(388182);async function i(e){return new Promise((t=>{n().A.setState({open:!0,onClose:()=>{n().A.setState({open:!1}),t(!1)},onConfirm:()=>{n().A.setState({open:!1}),t(!0)},...e})}))}},706654:(e,t,o)=>{o.r(t),o.d(t,{autofillPropertyForBlocks:()=>Z,autofillPropertyForCollection:()=>ee,fillAllPagesMessages:()=>H,getDefaultAiInference:()=>ae,saveOrRemovePropertyAiInference:()=>re,triggerAiAutofillUpsell:()=>J});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(803949),o(581454);var n=o(296540),i=()=>o(564884),r=()=>o(907258),a=()=>o(135168),l=()=>o(242422),s=()=>o(221844),c=()=>o(675133),d=()=>o(792057),u=()=>o(128933),p=()=>o(94484),f=()=>o(770063),g=()=>o(898244),m=()=>o(713998),A=()=>o(206267),y=()=>o(134025),h=()=>o(706021),v=()=>o(69708),_=()=>o(532659),S=()=>o(973647),I=()=>o(534177);const k=(0,o(583835).Dv)("fillAutofillPropertiesInViewTask");var C=()=>o(299709),M=()=>o(769864),T=()=>o(884107),w=()=>o(583289),x=()=>o(357625),P=()=>o(203913),b=()=>o(396896),R=()=>o(272200),O=()=>o(224682),U=o(474848);const L=function({environment:e,inferenceIds:t,aiInference:i}){const r=(0,o(590526).K8)((()=>{const{state:e}=O().m;return"uninitialized"===e.type?null:{numBlocksToAutofill:e.numBlocksToAutofill,numBlocksAutofilled:e.numBlocksAutofilled,propertySchema:e.propertySchema,collectionId:e.collectionId,sessionId:e.sessionId,haveAllBlocksCompletedAutofill:e.haveAllBlocksCompletedAutofill}}),[]),a=(0,n.useCallback)((()=>{r&&(t.forEach((t=>{R().trackAiAutofillAction(e,{ai_inference_type:i.type,type:"undo_from_snackbar",inference_id:t,collection_id:r.collectionId,session_id:r.sessionId})})),o(495262).tN({environment:e,preventSelectText:!0}),u().N2(),O().m.setState({type:"filling",...r,didInterruptStreaming:!0}))}),[r,e,i,t]);if(!r)return null;const{numBlocksToAutofill:l,numBlocksAutofilled:s,propertySchema:{name:c}}=r;return s===l?(0,U.jsxs)(b().fI,{gap:4,alignItems:"center",children:[(0,U.jsx)(o(807449).I,{icon:o(29037).checkmarkIcon}),(0,U.jsx)(v().sA,{defaultMessage:"AI updated “{propertyName}” on {numPages, plural, one {1 page} other {# pages}}",id:"snackbar.aiAutofill.autofillInProgress",values:{propertyName:c,numPages:l}}),(0,U.jsx)(P().Ag,{onClick:a,children:(0,U.jsx)(v().sA,{defaultMessage:"Undo",id:"snackbar.aiAutofill.undo"})}),(0,U.jsx)(P().Ag,{onClick:()=>{u().N2()},children:(0,U.jsx)(v().sA,{defaultMessage:"Close",id:"snackbar.aiAutofill.close"})})]}):(0,U.jsxs)(b().fI,{gap:4,alignItems:"center",children:[(0,U.jsx)(o(98126).k,{}),0===s?(0,U.jsx)(v().sA,{defaultMessage:"AI updating “{propertyName}” on {numPages, plural, one {1 page} other {# pages}}",id:"snackbar.aiAutofill.autofillStarting",values:{propertyName:c,numPages:l}}):(0,U.jsx)(v().sA,{defaultMessage:"AI updated “{propertyName}” on {numFilledPages} of {numTotalPages} pages",id:"snackbar.aiAutofill.completedAutofill",values:{propertyName:c,numFilledPages:s,numTotalPages:l}}),(0,U.jsx)(P().Ag,{onClick:a,children:(0,U.jsx)(v().sA,{defaultMessage:"Stop & undo",id:"snackbar.aiAutofill.undoAndStop"})})]})};var F=()=>o(831566),E=()=>o(659602),N=()=>o(335722),j=()=>o(71304),W=()=>o(991249),B=()=>o(390366),D=()=>o(295304),z=()=>o(547149),V=()=>o(108184);const H=(0,v().YK)({fillAllPagesTooltip:{defaultMessage:"Autofill all pages in this view",id:"aiAutofill.fillAllPages.buttonTooltip"},fillAllPagesAddOnMessage:{defaultMessage:"Only with Notion AI add-on",id:"aiAutofill.fillAllPages.onlyWithAiAddOnMessageInTooltip"},fillAllPagesAddAiMessage:{defaultMessage:"Only with upgraded Notion AI",id:"aiAutofill.fillAllPages.onlyWithAiBusinessMessageInTooltip"}});function q(e){const{environment:t,propertyId:o,propertySchema:n,storesWithCompletions:i,useTemporaryStore:r,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:l,clipboardActions:s,doneStreaming:c,aiInferenceOverride:d}=e;z().createAndCommit({userAction:"BlockPropertyValue.handleActionButtonClick.aiAutofill",environment:t,canUndo:!Boolean(r),undoCheckpoint:!0,perform:e=>{K({environment:t,propertyId:o,propertySchema:n,storesWithCompletions:i,useTemporaryStore:r,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:l,clipboardActions:s,doneStreaming:c,aiInferenceOverride:d,transaction:e})}})}function K(e){var t;const{environment:o,propertyId:n,propertySchema:i,storesWithCompletions:r,useTemporaryStore:a,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:s,clipboardActions:c,doneStreaming:d,aiInferenceOverride:u,transaction:p}=e;for(const{store:f,temporaryStore:A,completion:y}of r){const e=a?A:f;let r;switch(i.type){case"text":r=c.getInlineTitleValueFromClipboardTextHtml({text:y.trim(),stripText:!1,stripSurroundingWhitespace:!0,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:s});break;case"multi_select":case"select":const e=a?null===(t=f.getAssociatedCollectionStore())||void 0===t?void 0:t.clone(A.inMemoryRecordCache):f.getAssociatedCollectionStore(),o=(null==e?void 0:e.getSchema()[n])||i,h=u??i.select_ai_inference;let v=y.trim().split(",").map((e=>e.trim()));if(d||(v=v.slice(0,-1)),v.length>0&&"select"===i.type&&(v=v.slice(0,1)),e&&null!=h&&h.add_options){const t=(0,g().nP)({newTokenValues:[v],property:n,propertySchema:o,collectionId:e.id});if(t)for(const o of t)z().applyOperation({store:e,operation:o,transaction:p})}null!=h&&h.add_options||(v=v.filter((e=>{var t;return null===(t=i.options)||void 0===t?void 0:t.find((t=>t.value===e))}))),r=(0,m().rK)(v);break;default:(0,I().HB)(i)}D().R9({environment:o,store:e.getPropertyStore(n),value:r,transaction:p})}}const G=(0,v().YK)({FAILED_TO_AUTOFILL:{defaultMessage:"Something went wrong. Please try again later",id:"propertyCompletionActions.propertyCompletionActions.error.unableToAutofill"},INVALID_PROPERTY_FOR_AUTOFILL:{defaultMessage:"Invalid property configuration for AI autofill",id:"propertyCompletionActions.propertyCompletionActions.error.invalidPropertyForAutofill"},NO_BLOCKS_TO_AUTOFILL:{defaultMessage:"Nothing to update with AI",id:"propertyCompletionActions.propertyCompletionActions.error.noBlocksToAutofill"}}),Q=(0,v().YK)({featureUnavailable:{id:"completionActions.featureNotEnabledError",defaultMessage:"This feature is not currently enabled"}});function $({autofillPropertyResult:e}){const t=c().A.formatMessage(G[e]);u().N2(),d().c1(t)}const Y={ai_limit_property_autofill:(0,U.jsx)(v().sA,{defaultMessage:"This workspace has used all of its free AI responses. Contact your workspace owner to upgrade Notion AI.",id:"aiAutofill.outOfAiBusinessUpsellDialogMessage"}),ai_autofill_try_on_view:(0,U.jsx)(v().sA,{defaultMessage:"This workspace has used all of its free AI responses. Contact your workspace owner to upgrade Notion AI.",id:"aiAutofill.outOfAiUpgradedUpsellDialogMessage"}),ai_autofill_on_page_edit:(0,U.jsx)(v().sA,{defaultMessage:"Auto-update requires upgraded Notion AI. Contact your workspace owner to upgrade Notion AI.",id:"aiAutofill.autoUpdateOnPageEditAiUpgradedUpsellDialogMessage"}),ai_autofill_fill_all_pages:(0,U.jsx)(v().sA,{defaultMessage:"Updating all pages requires upgraded Notion AI. Contact your workspace owner to upgrade Notion AI.",id:"aiAutofill.fillAllPagesAiUpgradedUpsellDialogMessage"}),ai_autofill_bulk_fill:(0,U.jsx)(v().sA,{defaultMessage:"Filling more pages at once requires upgraded Notion AI. Contact your workspace owner to upgrade Notion AI.",id:"aiAutofill.bulkFillAiUpgradedUpsellDialogMessage"})};function J({environment:e,from:t,upsell:o,store:n}){const i=(0,a().f)(n);null!=i&&i.canAdmin()||d().c1(Y[t]),W().K(e,{from:t,upsell:o,spaceStore:i})}function X({errorCode:e,environment:t,autofillAvailability:o,collectionStore:n}){return 405===e?u().D6({label:c().A.formatMessage(Q.featureUnavailable)}):(402===e&&o.upsell&&(u().N2(),J({environment:t,from:"ai_limit_property_autofill",upsell:o.upsell,store:n})),V().showCompletionErrorWithCode(e))}async function Z({environment:e,stores:t,property:o,propertySchema:n,userEventForAnalytics:i,sessionIdForAnalytics:l,collectionContextStore:c,from:d,isBulkAction:f,aiInferenceOverride:m,transaction:y}){var h,v;const S=l||A().JW(),k=o,w=t.map((e=>({spaceId:e.getSpaceId(),...e.pointer,propertyId:k,inferenceId:A().JW()}))),x=t[0].getAssociatedCollectionId()??(null==c||null===(h=c.collectionStore())||void 0===h?void 0:h.id)??(null===(v=t[0].getCollectionStoreIfSingleSource())||void 0===v?void 0:v.id),P=new(s().A)({name:"propertyCompletionActions.autofillPropertyForBlocks"});if(O().m.setIsWriting({stores:t,propertySchema:n,sessionIdForAnalytics:l,collectionId:x}),"uninitialized"!==O().m.state.type&&(0,g().$M)(n)&&x){u().D6({label:(0,U.jsx)(L,{environment:e,inferenceIds:w.map((e=>e.inferenceId)),aiInference:(0,g().om)(n)}),durationMs:p().LX});try{var b;if(e.defaultRecordCache.inMemoryRecordCache.addCacheOverride(P),!(0,I().EI)(w))return $({autofillPropertyResult:"NO_BLOCKS_TO_AUTOFILL"});const o=m||(0,g().om)(n);if(!o)return $({autofillPropertyResult:"INVALID_PROPERTY_FOR_AUTOFILL"});w.forEach((t=>{R().trackAiAutofillAction(e,{type:i,inference_id:t.inferenceId,ai_inference_type:o.type,collection_id:x,session_id:S})}));const l=(0,a().f)(null==c?void 0:c.collectionStore());l&&M().callApi({eventName:"publishAiSession",environment:e,data:{inference_type:"autofill",id:S,spaceId:l.id,metadata:{blockPropertyPointers:w,aiInference:o,collection_id:x}}});const s=await(0,B().B)(e,{name:"collection_property_autofill",spaceId:null==l?void 0:l.id,userId:null===(b=r().default.state.currentUserStore)||void 0===b?void 0:b.id,amount:"unknown"}),u=await M().callStreamApi({eventName:"getCompletionForProperty",environment:e,data:{blockPropertyPointers:w,aiInference:o,aiSessionId:S,model:"default"}});if("success"!==u.type)return $({autofillPropertyResult:"FAILED_TO_AUTOFILL"});c&&(0,C().E)({block_id:t[0].pointer.id,property:k,property_type:n.type,from:d,environment:e,collectionContextStore:c,isFromBulkActionsToolbar:f});const p=Object.fromEntries(t.map((e=>[e.pointer.id,{store:e,temporaryStore:e.clone(P),completion:""}]))),A=new Set,[h,v,U]=await Promise.all([E().g.load(),N().S.load(),T().R.clipboardActions.load()]);if(_().hS.is(u.data)){for await(const t of u.data){if("error"===t.type)return O().m.setState({...O().m.state,didInterruptStreaming:!0}),X({errorCode:t.errorCode,environment:e,autofillAvailability:s,collectionStore:null==c?void 0:c.collectionStore()});if(O().m.state.didInterruptStreaming)return;const o=p[t.blockPropertyPointer.id],i=o.completion+t.completion;p[t.blockPropertyPointer.id]={...o,completion:i},A.add(t.blockPropertyPointer.id),y?K({environment:e,propertyId:k,propertySchema:n,storesWithCompletions:Object.values(p),useTemporaryStore:!0,markdownLinkifyIt:h,tinyMceMicrosoftWordPasteFilter:v,clipboardActions:U,doneStreaming:!0,aiInferenceOverride:m,transaction:y}):q({environment:e,propertyId:k,propertySchema:n,storesWithCompletions:Object.values(p),useTemporaryStore:!0,markdownLinkifyIt:h,tinyMceMicrosoftWordPasteFilter:v,clipboardActions:U,aiInferenceOverride:m}),O().m.setState({...O().m.state,numBlocksAutofilled:A.size})}O().m.setState({...O().m.state,haveAllBlocksCompletedAutofill:!0})}e.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(P),y?K({environment:e,propertyId:k,propertySchema:n,storesWithCompletions:Object.values(p),useTemporaryStore:!1,markdownLinkifyIt:h,tinyMceMicrosoftWordPasteFilter:v,clipboardActions:U,doneStreaming:!0,aiInferenceOverride:m,transaction:y}):q({environment:e,propertyId:k,propertySchema:n,storesWithCompletions:Object.values(p),useTemporaryStore:!1,markdownLinkifyIt:h,tinyMceMicrosoftWordPasteFilter:v,clipboardActions:U,doneStreaming:!0,aiInferenceOverride:m})}finally{e.defaultRecordCache.inMemoryRecordCache.hasCacheOverride(P)&&e.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(P)}}}async function ee(e){const t=l().default.checkGate({gateName:"autofill_all_pages_use_new_endpoint"})?ne:ie;return await t(e)}const te=(0,v().YK)({invalidCollectionSource:{id:"propertyCompletionActions.error.invalidCollectionSource",defaultMessage:"There was a problem with the database."},noMemcachedRecord:{id:"propertyCompletionActions.error.noMemcachedRecord",defaultMessage:"Something went wrong. Please try again."},lockAlreadyTaken:{id:"propertyCompletionActions.error.lockAlreadyTaken",defaultMessage:"A fill is already in progress"},invalidUser:{id:"propertyCompletionActions.error.invalidUser",defaultMessage:"The provided user information is not valid."},invalidCollectionView:{id:"propertyCompletionActions.error.invalidCollectionView",defaultMessage:"We encountered an issue accessing the collection view."},invalidCollection:{id:"propertyCompletionActions.error.invalidCollection",defaultMessage:"The collection you are trying to access is not valid."},noLoadedUser:{id:"propertyCompletionActions.error.noLoadedUser",defaultMessage:"User information is missing."},noUserTimeZone:{id:"propertyCompletionActions.error.noUserTimeZone",defaultMessage:"User time zone information is not available."},unauthorizedCollectionAccess:{id:"propertyCompletionActions.error.unauthorizedCollectionAccess",defaultMessage:"Insufficient permissions"},unableToQueryCollection:{id:"propertyCompletionActions.error.unableToQueryCollection",defaultMessage:"We couldn’t retrieve the collection details at this time."},invalidPropertyForAutofill:{id:"propertyCompletionActions.error.invalidPropertyForAutofill",defaultMessage:"The property provided for autofill is not valid."},NoResults:{id:"propertyCompletionActions.error.noResults",defaultMessage:"No results were found. Please try again."},somethingWentWrong:{id:"propertyCompletionActions.error.somethingWentWrong",defaultMessage:"Something went wrong. Please try again later."}});function oe(e){switch(e){case"invalidCollectionSource":return(0,U.jsx)(v().sA,{...te.invalidCollectionSource});case"noMemcachedRecord":return(0,U.jsx)(v().sA,{...te.noMemcachedRecord});case"lockAlreadyTaken":return(0,U.jsx)(v().sA,{...te.lockAlreadyTaken});case"invalidUser":return(0,U.jsx)(v().sA,{...te.invalidUser});case"invalidCollectionView":return(0,U.jsx)(v().sA,{...te.invalidCollectionView});case"invalidCollection":return(0,U.jsx)(v().sA,{...te.invalidCollection});case"noLoadedUser":return(0,U.jsx)(v().sA,{...te.noLoadedUser});case"noUserTimeZone":return(0,U.jsx)(v().sA,{...te.noUserTimeZone});case"unauthorizedCollectionAccess":return(0,U.jsx)(v().sA,{...te.unauthorizedCollectionAccess});case"unableToQueryCollection":return(0,U.jsx)(v().sA,{...te.unableToQueryCollection});case"invalidPropertyForAutofill":return(0,U.jsx)(v().sA,{...te.invalidPropertyForAutofill});case"NoResults":return(0,U.jsx)(v().sA,{...te.NoResults});case"somethingWentWrong":return(0,U.jsx)(v().sA,{...te.somethingWentWrong});default:return(0,U.jsx)(v().sA,{defaultMessage:"An unexpected error occurred. Please try again.",id:"propertyCompletionActions.error.unknown"})}}async function ne(e){var t,o;const{environment:n,collectionStore:l,propertySchema:s,property:d,collectionViewStore:p}=e;if(!(0,g().$M)(s))return;const f=(0,g().om)(s);if(!l||!s||!f)return;const m=null===(t=(0,a().f)(l))||void 0===t?void 0:t.id;if(!m)return;if(!(null===(o=r().default.state.currentUserStore)||void 0===o?void 0:o.id))return;const A=c().A.getIntl(),y=(0,j().tS)({environment:n,intl:A,store:l});if(!(await w().U({sourceAction:"fill_all_pages",propertyName:s.name,collectionName:y})))return;(0,i().u)({environment:n,event:{eventName:"generate_from_fill_all_pages_in_view",eventProperties:{collection_id:l.id,ai_inference_type:f.type}}});const h=(0,x().UT)(n,k,{spaceId:m,collectionSource:{id:l.id,type:"collection",spaceId:m},collectionViewPointer:p.pointer,propertyId:d},{spaceIds:[]});for await(const i of h){var v;if(S().Q.isFail(i)||"failure"===i.taskStatus)return void u().D6({label:oe("somethingWentWrong")});if("error"===(null===(v=i.value)||void 0===v?void 0:v.status)){const e=i.value.errorType;return void u().D6({label:oe(e)})}}}async function ie({environment:e,collectionStore:t,propertySchema:o,property:n,sessionIdForAnalytics:i}){var a;if(!(0,g().$M)(o))return;const l=(0,g().om)(o);if(!t||!o||!l)return;const s=await(0,B().B)(e,{name:"collection_property_autofill",spaceId:t.getSpaceId(),userId:null===(a=r().default.state.currentUserStore)||void 0===a?void 0:a.id,amount:"unknown"});if(!(0,h().e2)(s))return void J({environment:e,from:"ai_autofill_fill_all_pages",upsell:s.upsell,store:t});const d=c().A.getIntl(),u=(0,j().tS)({environment:e,intl:d,store:t});if(!(await w().U({sourceAction:"fill_all_pages",propertyName:o.name,collectionName:u})))return;R().trackAiAutofillAction(e,{type:"generate_from_fill_all_pages",inference_id:A().JW(),ai_inference_type:l.type,collection_id:t.id,session_id:i??A().JW()});const p=[];p.push(y().op.update({pointer:t.pointer,path:["format","update_ai_inferences_status"],args:{[n]:{type:"requested",created_time:Date.now()}}})),(0,F().p)({environment:e,collectionStore:t,performTransaction:e=>{for(const o of p)z().applyOperation({store:(0,f().v3)(t,o.pointer),operation:o,transaction:e})}})}function re(e){const{environment:t,propertySchema:o,collectionStore:n,property:i,draftAiInference:r}=e;let a="";switch(o.type){case"text":a="ai_inference";break;case"select":case"multi_select":a="select_ai_inference";break;default:return}const l=[];if(l.push({pointer:n.pointer,command:"set",path:["schema",i,a],args:r}),r)R().trackAiAutofillSettingsAction(t,{type:"set_ai_inference",ai_inference_type:r.type,collection_id:n.id});else{const e=(0,g().om)(o);R().trackAiAutofillSettingsAction(t,{type:"remove_ai_inference",ai_inference_type:null==e?void 0:e.type,collection_id:n.id})}(0,F().p)({environment:t,collectionStore:n,performTransaction:e=>{for(const t of l)z().applyOperation({store:(0,f().v3)(n,t.pointer),operation:t,transaction:e})}})}function ae(e,t){if(!(0,g().$M)(e))return;const o=(0,g().om)(e);return!o&&(0,g().lx)(e)?{type:e.type,auto_update_on_edit:t,add_options:!1}:o}},774952:(e,t,o)=>{o.d(t,{U:()=>m,c:()=>A});o(296540);var n=()=>o(401497),i=()=>o(758304),r=()=>o(69708),a=()=>o(100622),l=()=>o(284371),s=()=>o(135221),c=()=>o(115512),d=()=>o(827368),u=()=>o(781317),p=o(474848);const f=(0,r().YK)({brewing:{id:"AgentThinkingStep.brewing",defaultMessage:"Brewing"},pondering:{id:"AgentThinkingStep.pondering",defaultMessage:"Pondering"},crafting:{id:"AgentThinkingStep.crafting",defaultMessage:"Crafting"},processing:{id:"AgentThinkingStep.processing",defaultMessage:"Processing"},computing:{id:"AgentThinkingStep.computing",defaultMessage:"Computing"},generating:{id:"AgentThinkingStep.generating",defaultMessage:"Generating"},working:{id:"AgentThinkingStep.working",defaultMessage:"Working"},exploring:{id:"AgentThinkingStep.exploring",defaultMessage:"Exploring"},organizing:{id:"AgentThinkingStep.organizing",defaultMessage:"Organizing"},preparing:{id:"AgentThinkingStep.preparing",defaultMessage:"Preparing"},focusing:{id:"AgentThinkingStep.focusing",defaultMessage:"Focusing"},discovering:{id:"AgentThinkingStep.discovering",defaultMessage:"Discovering"},noodling:{id:"AgentThinkingStep.noodling",defaultMessage:"Noodling"},vibing:{id:"AgentThinkingStep.vibing",defaultMessage:"Vibing"},cooking:{id:"AgentThinkingStep.cooking",defaultMessage:"Cooking"}}),g=(0,o(534177).uv)(f);function m(e){if(void 0===e)return f.crafting;const t=function(e){let t=0;for(let o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t&=t;return Math.abs(t)}(String(e)),o=t%g.length;return f[g[o]]}function A(e){const{styleKey:t,message:o=f.crafting,animationType:g="loading-dots",children:m}=e,{bodyStyleKey:A}=(0,d().yq)(),y=(0,d().Cd)(A),h=(0,n().IS)((()=>({messageContent:{...y,fontWeight:l().Wy.medium,color:a().Tj.text.secondary,display:"flex",alignItems:"center",gap:8,minWidth:0},messageWrapInner:{display:"flex",whiteSpace:"pre",alignItems:"center",gap:4,minWidth:0},loadingDotsContainer:{width:24,height:24},scrollingSquiggleContainer:{opacity:.3}})),[y]);return(0,p.jsxs)("div",{style:h.messageContent,children:[(0,p.jsx)("div",{role:"status","aria-live":"polite",style:c().Qg,children:"string"==typeof o?o:(0,p.jsx)(r().sA,{...o})}),function(){switch(g){case"scrolling-squiggle":return(0,p.jsx)("div",{style:h.scrollingSquiggleContainer,children:(0,p.jsx)(u().ScrollingSquiggle,{})});case"loading-dots":return(0,p.jsx)(s().A,{isTriColored:!0,styleParentContainer:h.loadingDotsContainer});case"none":return null}}(),(0,p.jsxs)("div",{style:h.messageWrapInner,children:[(0,p.jsx)(i().N,{styleKey:t||A,animate:!0,colorVariant:"secondary",text:"string"==typeof o?o:(0,p.jsx)(r().sA,{...o})}),m]})]})}},781317:(e,t,o)=>{o.r(t),o.d(t,{SCROLLING_SQUIGGLE_DEFAULTS:()=>l,ScrollingSquiggle:()=>s});var n=o(296540),i=()=>o(401497),r=()=>o(100622),a=o(474848);const l={width:24,height:16,tempo:18,minLoopSize:24,maxLoopSize:32,acceleration:.3,tailLength:72,strokeWidth:1.5,loopSpacing:1.3,modulationSpeed:.4,modulationPhaseOffset:2,tempoModulation:10,accelerationModulation:.12};function s(e){const{style:t,width:o=l.width,height:s=l.height,tempo:c=l.tempo,minLoopSize:d=l.minLoopSize,maxLoopSize:u=l.maxLoopSize,acceleration:p=l.acceleration,tailLength:f=l.tailLength,strokeWidth:g=l.strokeWidth,strokeColor:m,loopSpacing:A=l.loopSpacing,modulationSpeed:y=l.modulationSpeed,modulationPhaseOffset:h=l.modulationPhaseOffset,tempoModulation:v=l.tempoModulation,accelerationModulation:_=l.accelerationModulation}=e,S=(0,n.useRef)(null),I=(0,n.useRef)(),k=(0,n.useRef)(!0),C=(0,i().eP)(),M=(0,r().O4)({theme:C}),T=(0,n.useMemo)((()=>{const e=o,t=s,n=t/2,i=c,r=e/200*8*A,a=p,l=Math.min(d/100*t,.45*t),g=Math.min(u/100*t,.45*t);return{W:e,H:t,BASE_Y:n,FRAMES_PER_RAD:i,SUB_STEPS:3,DX_PER_RAD:r,ACC_FACTOR:a,MIN_R:l,MAX_R:g,R_BASE:(l+g)/2,R_VAR:(g-l)/2,R_FREQ1:.2,R_FREQ2:.1,TAIL_RADS:Math.max(3,f*Math.min(1,e/200)),PURGE_PAD_R:5,START_OFFSET:.95*e-g,D_THETA_PER_SECOND:Math.PI/i*60}}),[o,s,c,d,u,p,f,A]),w=(0,n.useMemo)((()=>({modulationSpeed:y,modulationPhaseOffset:h,tempoModulation:v,accelerationModulation:_})),[y,h,v,_]);return(0,n.useEffect)((()=>{const e=()=>{k.current=!document.hidden};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[]),(0,n.useEffect)((()=>{const e=S.current;if(!e)return;const t=e.getContext("2d",{willReadFrequently:!1,alpha:!0,desynchronized:!0});if(!t)return;e.width=2*o,e.height=2*s,t.scale(2,2),t.imageSmoothingEnabled=!1;const{W:n,H:i,BASE_Y:r,SUB_STEPS:a,DX_PER_RAD:l,ACC_FACTOR:d,MIN_R:u,R_BASE:p,R_VAR:f,R_FREQ1:A,R_FREQ2:y,TAIL_RADS:h,PURGE_PAD_R:v,START_OFFSET:_}=T;t.lineCap="round",t.lineJoin="round",t.strokeStyle=m||M.text.primary,t.lineWidth=g;let C=0,x=performance.now();const P=performance.now(),b=1e3,R=new Array(b);let O=0,U=0,L=0,F=0;let E=0;function N(e){const t=function(e){const t=.6*Math.sin(A*e)+.4*Math.sin(y*e+1.1);return Math.max(u,p+f*t)}(e);return{x:e*l+t*Math.cos(e),y:r-t*Math.sin(e),t:e}}function j(e){const t=performance.now(),o=Math.min((t-x)/1e3,.1);x=t;const r=(t-P)/1e3,s=Math.sin(2*Math.PI*w.modulationSpeed*r+w.modulationPhaseOffset),u=c+w.tempoModulation*s,p=d+w.accelerationModulation*s,f=Math.PI/Math.max(1,u)*60,g=F>5?Math.max(1,Math.floor(a/2)):a,m=f*o*(1+p*-Math.sin(C))/g;for(let n=0;n<g;n++)C+=m,R[U]=N(C),U=(U+1)%b,L<b?L++:O=(O+1)%b;const A=C-h;for(;L>0&&R[O].t<A-v;)O=(O+1)%b,L--;const y=C*l-_,S=y-E;E=y,Math.abs(S)<n?(S>0?e.clearRect(0,0,Math.ceil(S)+10,i):S<0&&e.clearRect(n+Math.floor(S)-10,0,10-S,i),e.clearRect(0,0,n,i)):e.clearRect(0,0,n,i),e.save(),e.translate(-y,0);let M,T=O,W=0;for(;W<L&&R[T].t<A;)T=(T+1)%b,W++;if(0===W||0===L)M=R[O];else if(W<L){const e=R[(T-1+b)%b],t=R[T],o=(A-e.t)/(t.t-e.t);M={x:e.x+(t.x-e.x)*o,y:e.y+(t.y-e.y)*o}}if(M&&L>0){e.beginPath(),e.moveTo(M.x,M.y);let t=T;for(let o=W;o<L;o++)e.lineTo(R[t].x,R[t].y),t=(t+1)%b;e.stroke()}e.restore();performance.now()-t>16?F++:F>0&&(F=Math.max(0,F-.1)),k.current?I.current=requestAnimationFrame((()=>j(e))):setTimeout((()=>{k.current&&(I.current=requestAnimationFrame((()=>j(e))))}),100)}return I.current=requestAnimationFrame((()=>j(t))),()=>{I.current&&cancelAnimationFrame(I.current)}}),[T,w,o,s,g,m,M.text.primary,c]),(0,a.jsx)("canvas",{ref:S,style:{width:o,height:s,display:"block",...t}})}},827368:(e,t,o)=>{o.d(t,{Cd:()=>d,Wd:()=>p,yq:()=>f});var n=o(296540),i=()=>o(59226),r=()=>o(829098),a=()=>o(631611),l=o(474848);const s="bodyRegular",c="bodyLgRegular";function d(e){const{fontSize:t,lineHeight:o}=r().U[e];return{fontSize:t,lineHeight:o}}const u=(0,n.createContext)(void 0);function p({children:e,isFullPage:t}){const o=(0,i().X)("agent_larger_font"),r=(0,a().jw)(),d=(0,n.useMemo)((()=>{const e=t??r.isType("fullPage","inferenceTranscriptChatView");return{bodyStyleKey:o&&e?c:s,isLargerFontEnabled:o}}),[o,r,t]);return(0,l.jsx)(u.Provider,{value:d,children:e})}function f(){const e=(0,n.useContext)(u);return e||{bodyStyleKey:s,isLargerFontEnabled:!1}}u.displayName="AgentFontContext"},831566:(e,t,o)=>{o.d(t,{p:()=>r});var n=()=>o(547149),i=()=>o(724456);function r(e){const{environment:t,collectionStore:o,performTransaction:r}=e;return n().createAndCommit({userAction:"collectionViewActions.createSchemaUpdateTransaction",environment:t,canUndo:!0,perform:e=>{const n=o.getSchema(),a=r(e),l=o.getSchema();return(0,i().H)({environment:t,collectionStore:o,oldSchema:n,newSchema:l,transaction:e}),a}}).performResult}},993949:(e,t,o)=>{o.d(t,{J:()=>i,M:()=>r});o(16280);var n=o(296540);const i=n.createContext(null);function r(){const e=(0,n.useContext)(i);if(!e)throw new Error("ActionBarContext must be used inside ActionBar");return e}i.displayName="ActionBarContext"}}]);