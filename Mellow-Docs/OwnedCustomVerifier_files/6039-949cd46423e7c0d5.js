"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[6039],{28834:(e,t,r)=>{r.d(t,{Nr:()=>h,Q:()=>l});r(16280),r(944114),r(816573),r(878100),r(177936),r(748140),r(821903),r(491134),r(128845),r(237467),r(444732),r(979577),r(898992),r(823215),r(672577),r(430670),r(803949),r(581454);var i=()=>r(564884);class n{constructor(e,t){this._inputSampleRate=void 0,this._outputSampleRate=void 0,this._inputSampleRate=e,this._outputSampleRate=t}downsample(e){return this.downSampleAudioFrame(e,this._inputSampleRate,this._outputSampleRate)}downSampleAudioFrame(e,t,r){if(r===t||r>t)return e;const i=t/r,n=Math.round(e.length/i),a=new Float32Array(n);let o=0,s=0;for(;s<n;){const t=Math.round((s+1)*i);let r=0,n=0;for(;o<t&&o<e.length;)r+=e[o++],n++;a[s++]=r/n}return a}}var a=()=>r(165358),o=()=>r(229833),s=()=>r(909557),c=()=>r(673903),d=()=>r(426175),u=()=>r(524007);r(814603),r(147566),r(198721);const l="ms_change";class h{constructor(e){this._mediaStreams=void 0,this._emitter=void 0,this.recorder=void 0,this.onDataReceived=void 0,this.onStop=void 0,this.environment=void 0,this.startController=void 0,this.audioBuffer=[],this.currentStreamId=null,this.sampleRate=void 0,this.includeSystemAudio=void 0,this.saveAudioFileMetadata=void 0,this.handleDeviceChange=async()=>{var e;const t=null===(e=this.mediaStreams)||void 0===e||null===(e=e.flatMap((e=>e.getAudioTracks())))||void 0===e||null===(e=e.map((e=>e.getSettings())))||void 0===e?void 0:e.find((e=>void 0!==e)),i=this.getPreferredOrDefaultDevice();if(!t||i&&(i.deviceId!==t.deviceId||i.groupId!==t.groupId)){this.stop({triggerOnStop:!1,triggerFlushToOPFS:!0});try{await this.start()}catch(n){this.destroy((0,r(319625).A)(n))}}},this._emitter=(0,r(827380).A)(),this.recorder=new m,this.onDataReceived=e.onDataReceived,this.onStop=e.onStop,this.includeSystemAudio=e.includeSystemAudio,this.environment=e.environment,this.sampleRate=e.sampleRate??16e3,this.saveAudioFileMetadata=e.saveAudioFileMetadata}setOnDataReceived(e){this.onDataReceived=e}get emitter(){return this._emitter}get isStoringLocalAudio(){return void 0!==this.saveAudioFileMetadata&&void 0!==h.meetingNotesCache}set mediaStreams(e){if(this._mediaStreams)for(const r of this._mediaStreams)for(const e of r.getTracks())e.stop();for(const i of e??[])for(const e of i.getTracks())e.addEventListener("ended",(async()=>{if(i.getTracks().every((e=>"ended"===e.readyState))){"denied"===(await r(927648).Ay.checkPermissions(this.includeSystemAudio)).audio&&this.stop({triggerOnStop:!0,error:new(s().d1)("Audio permission denied")})}}));for(const i of e??[]){var t;const e=null==i||null===(t=i.getAudioTracks()[0])||void 0===t?void 0:t.getSettings();r(964576).A.setState(d().X8.state.find((t=>t.deviceId===(null==e?void 0:e.deviceId))))}this._mediaStreams=e,this._emitter.emit(l)}get mediaStreams(){return this._mediaStreams}getPreferredOrDefaultDevice(){var e;return(null===(e=d().X8.state)||void 0===e?void 0:e.find((e=>{var t;return e.deviceId===(null===(t=u().d.state)||void 0===t?void 0:t.deviceId)})))??d().X8.state[0]}async start(){if(void 0===this.startController||this.startController.signal.aborted){this.startController=new AbortController;const t=this.startController.signal;if(null===this.currentStreamId){this.currentStreamId=(0,r(206267).JW)().slice(-4);try{h.meetingNotesCache&&void 0!==this.saveAudioFileMetadata&&await h.meetingNotesCache.trimCache(9)}catch(e){a().log({level:"error",from:"audioRecorderHelpers",type:"trimCacheError",error:(0,o().convertErrorToLog)(e)})}}this.audioBuffer=[];const n=this.getPreferredOrDefaultDevice(),l=(0,c().E)();let m;this.environment.device.isBrowser&&(0,i().u)({environment:this.environment,event:{eventName:"ai_meeting_notes_permission_requested",eventProperties:{permission_type:"microphone"}}});const f=Date.now();try{m=await l.getUserMedia({audio:{deviceId:n?{exact:n.deviceId}:void 0,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,channelCount:1}});const e=Date.now()-f;this.environment.device.isBrowser&&(0,i().u)({environment:this.environment,event:{eventName:"ai_meeting_notes_permission_result",eventProperties:{permission_type:"microphone",result:"granted",elapsed_ms_since_request:e,likely_user_was_prompted:e>=600}}})}catch(e){if(e instanceof Error&&this.environment.device.isBrowser){const t=Date.now()-f,r="NotAllowedError"===e.name?"denied":"NotFoundError"===e.name||"OverconstrainedError"===e.name?"no_devices":"unknown_error";(0,i().u)({environment:this.environment,event:{eventName:"ai_meeting_notes_permission_result",eventProperties:{permission_type:"microphone",result:r,elapsed_ms_since_request:t,likely_user_was_prompted:t>=300}}})}throw e}if(await d().Ay.updateMediaDevices(),this.includeSystemAudio){a().log({level:"info",from:"audioRecorderHelpers",type:"getDisplayMediaAttempt",data:{miscDataToConvertToString:{includeSystemAudio:this.includeSystemAudio}}});const e=await(0,r(532313).L5)({fn:async(e,t)=>{const i=l.getDisplayMedia({audio:!0,systemAudio:this.includeSystemAudio?"include":void 0}),n=performance.now(),o=await(0,r(763824).nQ)(5e3,i);if(o.timeout)throw i.then((e=>{const r=performance.now()-n;a().log({level:"info",from:"audioRecorderHelpers",type:"getDisplayMediaSuccessAfterTimeout",data:{miscDataToConvertToString:{attempt:t+1,elapsedMs:r}}});for(const t of e.getTracks())t.stop()})),a().log({level:"warning",from:"audioRecorderHelpers",type:"getDisplayMediaTimeout",data:{miscDataToConvertToString:{attempt:t+1}}}),new(s().Tn);const c=performance.now()-n;return a().log({level:"info",from:"audioRecorderHelpers",type:"getDisplayMediaSuccess",data:{miscDataToConvertToString:{elapsedMs:c,attempt:t+1}}}),o.result},handleError:(e,t,r)=>e instanceof s().Tn?t?{status:"throw",error:e}:{status:"retry"}:(a().log({level:"error",from:"audioRecorderHelpers",type:"getDisplayMediaFailed",error:(0,o().convertErrorToLog)(e),data:{miscDataToConvertToString:{includeSystemAudio:this.includeSystemAudio,attempt:r+1}}}),e instanceof Error&&"NotReadableError"===e.name?{status:"throw",error:new(s().$W)}:{status:"throw",error:new(s().Yh)}),retryAttemptsMS:[1e3,1e3],retryAttemptRandomOffsetMS:200,initialInput:void 0});for(const t of e.getVideoTracks())e.removeTrack(t),t.stop();this.mediaStreams=[m,e]}else this.mediaStreams=[m];if(t.aborted){for(const e of this.mediaStreams??[])for(const t of e.getTracks())t.stop();return}if(await this.recorder.record(this.mediaStreams??[],(e=>{t.aborted||(void 0!==this.saveAudioFileMetadata&&(this.audioBuffer.push(...e),this.maybeWriteAudioBufferToOPFS({forceWrite:!1})),this.onDataReceived(e))}),this.sampleRate),t.aborted)return this.recorder.releaseMediaResources(),void(this.mediaStreams=void 0);u().d.addListener(this.handleDeviceChange),d().X8.addListener(this.handleDeviceChange)}}maybeWriteAudioBufferToOPFS(e){const t=10*this.sampleRate;if(void 0!==this.saveAudioFileMetadata&&(e.forceWrite||this.audioBuffer.length>t)&&h.meetingNotesCache&&this.environment.currentUser.id&&this.currentStreamId){var i;const{blockStore:e}=this.saveAudioFileMetadata,t=e.id,n=null===(i=(0,r(192359).y1)(e,"transcript"))||void 0===i?void 0:i.id;if(void 0===n)return;h.meetingNotesCache.write((0,r(631616).G9)({userId:this.environment.currentUser.id,blockId:t,transcriptTabId:n,recordingId:this.currentStreamId,fileType:"PCM_F32_16000_MONO"}),new Float32Array(this.audioBuffer).buffer).catch((e=>{a().log({level:"error",from:"audioRecorderHelpers",type:"writeToOPFSFailed",error:(0,o().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:t}}})})),this.audioBuffer=[]}}stop(e){const{error:t,triggerOnStop:r=!0,triggerFlushToOPFS:i=!1}=e||{};if(void 0!==this.startController&&!this.startController.signal.aborted){var n;if(this.startController.abort(),this.recorder.releaseMediaResources(),this.mediaStreams=void 0,(r||i)&&this.maybeWriteAudioBufferToOPFS({forceWrite:!0}),r)this.currentStreamId=null,null===(n=this.onStop)||void 0===n||n.call(this,t);u().d.removeListener(this.handleDeviceChange),d().X8.removeListener(this.handleDeviceChange)}}destroy(e){u().d.removeListener(this.handleDeviceChange),d().X8.removeListener(this.handleDeviceChange),this.stop({triggerOnStop:!0,error:e})}}h.meetingNotesCache=(0,r(870991).bB)();class m{constructor(){this._audioWorkletNode=void 0,this._sourceNodes=void 0,this._audioContext=void 0}set sourceNodes(e){this._sourceNodes&&this._sourceNodes.forEach((e=>e.disconnect())),this._sourceNodes=e}set audioWorkletNode(e){this._audioWorkletNode&&this._audioWorkletNode.disconnect(),this._audioWorkletNode=e}set audioContext(e){this._audioContext&&this._audioContext.close(),this._audioContext=e}get audioContext(){return this._audioContext}async record(e,t,i){if(this.releaseMediaResources(),this.audioContext=(0,c().G)(i),Boolean(this.audioContext.audioWorklet))try{const a=new n(this.audioContext.sampleRate,i),o=this.audioContext,s=e.map((e=>o.createMediaStreamSource(e)));await this.audioContext.audioWorklet.addModule(new URL(r(986850),r.b));const c=new AudioWorkletNode(this.audioContext,"pcm-processor");c.port.onmessage=e=>{if(e.data){const r=e.data,i=a.downsample(r);t(i)}},s.forEach((e=>e.connect(c))),this._audioWorkletNode=c,this._sourceNodes=s}catch{console.info("unable to create worklet"),this.releaseMediaResources()}else this.releaseMediaResources()}releaseMediaResources(){this.sourceNodes=void 0,this.audioWorkletNode=void 0,this.audioContext=void 0}}},405689:(e,t,r)=>{r.d(t,{t:()=>b});r(944114),r(816573),r(878100),r(177936),r(748140),r(821903),r(491134),r(128845),r(237467),r(444732),r(979577),r(898992),r(803949),r(581454),r(908872);var i=r(296540),n=()=>r(242422),a=()=>r(726637),o=()=>r(484714),s=()=>r(943101),c=()=>r(590526),d=()=>r(401497),u=()=>r(100622),l=()=>r(534177),h=()=>r(28834);var m=()=>r(964576),f=()=>r(964345);class p extends(()=>r(769985))().u{constructor(){super({getInitialState:()=>{},effect:()=>(this.setState((0,r(673903).G)(24e3)),()=>{this.setState(void 0)}),debugName:"SharedAudioContextStore"})}getInitialState(){}setState(e){this.instanceState&&this.instanceState.close(),super.setState(e)}}const v=new p;var g=r(474848);const S=50,y=7e3,w=50,A=14e3,M=3,C=3.9;function b(e){const{fillWidth:t=!1,forceRender:r=!1,fakeSoundwave:p=!1,rootBlockId:b,barColor:k}=e,{isIOS:R,isMac:x}=(0,o().Y0)(),_=(0,c().K8)((()=>{if(!a().A.isMobile)return;const e=n().default.getConfigKey("mobile_dictation_visualizer","lowshelf_filter_gain");if(R){var t;const r=null===(t=m().A.state)||void 0===t?void 0:t.label;if((0,l().O9)(r)&&"iPhone Microphone"!==r)return;return e+6}return e}),[R]),T=a().A.isMobile?w:S,F=a().A.isMobile?A:y,D=(0,i.useMemo)((()=>function(e=S,t=y){const r=(e+t)/2;return{frequencyRangeMin:e,frequencyRangeMax:t,frequencyLowerQuarter:(e+r)/2,frequencyUpperQuarter:(r+t)/2}}(T,F)),[T,F]),E=(0,c().K8)((()=>f().Ay.state.rootBlock&&f().Ay.state.rootBlock.id===b),[b]),I=(0,c().K8)((()=>f().Ay.state.audioRecorder),[]),B=(0,c().O$)(v),W=(0,i.useRef)(null),N=(0,i.useRef)(void 0),[P,q]=(0,i.useState)(void 0),[O,L]=(0,i.useState)(8),[j,H]=(0,i.useState)([]),X=M,U=C;!function(e){const{isEnabled:t,numBars:r,barHeights:n,setBarHeights:a}=e,o=(0,i.useRef)(null);(0,i.useEffect)((()=>{if(o.current&&cancelAnimationFrame(o.current),!t)return;n.length!==r&&a(new Array(r).fill(3));const e={lastFrameTime:Date.now(),isSpeaking:!0,speakingBlendFactor:1,nextStateChangeTime:Date.now()+3e3+3e3*Math.random(),lastStateChangeTime:Date.now(),activityLevel:.8+.4*Math.random(),currentHeights:Array(r).fill(3)},i=Array(r).fill(0).map((()=>Math.random()*Math.PI*2)),s=Array(r).fill(0).map((()=>.85+.3*Math.random())),c=Array(r).fill(0).map((()=>.8+.4*Math.random())),d=.6+.15*Math.random(),u=.9+.2*Math.random(),l=2.8+1.2*Math.random(),h=()=>{const t=Date.now(),n=Math.min(.05,(t-e.lastFrameTime)/1e3);if(e.lastFrameTime=t,t>e.nextStateChangeTime){e.isSpeaking?e.isSpeaking=Math.random()>.85:e.isSpeaking=!0,e.lastStateChangeTime=t;const r=e.isSpeaking?1400:200,i=e.isSpeaking?3800:500,n=r+Math.random()*(i-r);e.nextStateChangeTime=t+n,e.isSpeaking&&(e.activityLevel=.9+.6*Math.random())}const m=e.isSpeaking?e.speakingBlendFactor:Math.max(.35,.45*e.speakingBlendFactor),f=e.isSpeaking?1:.4,p=e.isSpeaking?5:4.5;Math.abs(e.speakingBlendFactor-f)>.01?e.speakingBlendFactor<f?e.speakingBlendFactor=Math.min(f,e.speakingBlendFactor+n*p):e.speakingBlendFactor=Math.max(f,e.speakingBlendFactor-n*p):e.speakingBlendFactor=f;const v=.25*Math.sin(6e-4*t)+.85,g=e.activityLevel*v,S=Math.max(0,.7*Math.sin(.001*t)+.3),y=S>.55&&m>.5,w=y?1+.8*(S-.55):1,A=Array(r).fill(0).map(((a,o)=>{const h=o/(r-1),f=1-2*Math.abs(h-.5),p=Math.pow(f,.5),v=.006*t,S=Math.sin(v*s[o]+i[o])*c[o]+.5*Math.sin(2.2*v*s[(o+3)%r]+i[(o+2)%r])+.3*Math.sin(v*l*s[(o+1)%r]+i[(o+5)%r]),A=.7+.45*Math.sin(v*d+.1*o)+.35*Math.sin(v*u+i[o]),M=3+(S+1.2)*(y?6:5.5)*p*A*(m*g*w),C=M>e.currentHeights[o],b=Math.min(1,n*(C?25:16));return e.currentHeights[o]=e.currentHeights[o]*(1-b)+M*b,Math.max(3,Math.min(15,e.currentHeights[o]))}));a(A),o.current=requestAnimationFrame(h)};return o.current=requestAnimationFrame(h),()=>{o.current&&cancelAnimationFrame(o.current)}}),[t,r,n.length,a])}({isEnabled:p,numBars:O,barHeights:j,setBarHeights:H});const $=(0,i.useCallback)((()=>{if(t&&(I||r||p)&&W.current){const e=W.current.clientWidth,t=X+U,r=Math.max(1,Math.floor(e/t));L(r),H((e=>e.length===r?e:new Array(r).fill(3)))}}),[t,I,r,p,X,U]);(0,s().tK)(W,(e=>{void 0!==N.current&&cancelAnimationFrame(N.current),N.current=requestAnimationFrame((()=>{N.current=void 0,q(e.width)}))})),(0,i.useEffect)((()=>()=>{void 0!==N.current&&cancelAnimationFrame(N.current)}),[]),(0,i.useEffect)((()=>{void 0!==P&&$()}),[P,$]),(0,i.useEffect)((()=>{if(r&&!p||!E&&I)H(new Array(O).fill(3));else if(I&&B&&!p){const e=new AbortController,t=e.signal,r=()=>{const{mediaStreams:e}=I;if(e&&e.length>0){const r=B.createChannelMerger(e.length),i=B.createAnalyser();i.fftSize=2048;const n=e.map((t=>{const i=[],n=B.createMediaStreamSource(t);if(i.push(n),(0,l().O9)(_)){const t=B.createGain();t.gain.setValueAtTime(_/e.length,B.currentTime),i.push(t)}else{var a;const e=null===(a=t.getAudioTracks().pop())||void 0===a?void 0:a.label;if(x&&e&&e.includes("Built-in")){const e=B.createGain();e.gain.setValueAtTime(6,B.currentTime),i.push(e)}}const o=B.createBiquadFilter();o.type="highpass",o.frequency.setValueAtTime(D.frequencyLowerQuarter,B.currentTime),i.push(o);const s=B.createBiquadFilter();return s.type="lowpass",s.frequency.setValueAtTime(D.frequencyUpperQuarter,B.currentTime),i.push(s),i.push(r),i}));r.connect(i),n.forEach((e=>{for(let t=0;t<e.length-1;t++)e[t].connect(e[t+1])}));const a=()=>{n.forEach((e=>{e.forEach((e=>e.disconnect()))})),r.disconnect(),i.disconnect()};B.resume();const o=new Uint8Array(i.frequencyBinCount),s=()=>{if(t.aborted)return void a();i.getByteFrequencyData(o);const e=B.sampleRate/2/i.frequencyBinCount,r=Math.round(D.frequencyRangeMin/e),n=Math.round(D.frequencyRangeMax/e),c=o.slice(r,n+1),d=Math.floor(c.length/O),u=[];for(let t=0;t<O;t++){const e=c.slice(t*d,t<O-1?(t+1)*d:c.length+1),r=e.reduce(((e,t)=>e+t),0)/e.length,i=Math.max(3,Math.min(12,r/3));u.push(i)}H(u),requestAnimationFrame(s)},c=requestAnimationFrame(s);return()=>{cancelAnimationFrame(c),a()}}};let i=r();const n=()=>{"function"==typeof i&&i(),i=r()};return I.emitter.on(h().Q,n),()=>{I.emitter.off(h().Q,n),"function"==typeof i&&i(),e.abort()}}}),[I,O,B,r,_,D,p,E,x]);const G=(0,d().IS)((()=>({barStyle:{flexShrink:0,bottom:"0",width:`${X}px`,backgroundColor:k??u().Tj.icon.tertiary,borderRadius:t?"4px":"1px"}})),[X,t,k]);return(0,g.jsx)("div",{ref:W,style:{height:"20px",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",gap:U,flex:t?1:void 0},children:j.map(((e,t)=>(0,g.jsx)("div",{style:{...G.barStyle,height:`${e}px`}},t)))})}},426175:(e,t,r)=>{r.d(t,{Ay:()=>d,X8:()=>s,dc:()=>c});r(944114),r(898992),r(354520),r(672577),r(908872);var i=()=>r(140934),n=()=>r(673903);class a extends(()=>r(757695))().Store{async updateMediaDevices(){try{const e=await async function(){const e=(0,n().E)();return(await e.enumerateDevices()).reduce(((e,t)=>{if(t.kind&&t.label&&t.deviceId&&t.groupId)switch(t.kind){case"videoinput":e.videoInput.push(t);break;case"audioinput":e.audioInput.push(t);break;case"audiooutput":e.audioOutput.push(t)}return e}),{videoInput:[],audioInput:[],audioOutput:[]})}();this.setState(e)}catch{}}constructor(){super();try{(0,n().E)().addEventListener("devicechange",(()=>{this.updateMediaDevices()}))}catch{}r(927648).Ay.addListener((()=>{this.updateMediaDevices()}))}getInitialState(){return{videoInput:[],audioInput:[],audioOutput:[]}}}const o=new a,s=new(i().ComputedStore)((()=>{var e,t;return(null===(e=o.state)||void 0===e||null===(e=e.audioInput)||void 0===e||null===(t=e.filter)||void 0===t?void 0:t.call(e,(e=>null==e?void 0:e.label)))??[]}),{debugName:"AudioInputDevicesStore"}),c=new(i().ComputedStore)((()=>{var e;const t=r(964576).A.state,i=null===(e=r(524007).d.state)||void 0===e?void 0:e.label,n=s.state.find((e=>e.label===i));return t||(n||s.state[0])}),{debugName:"SelectedAudioInputDeviceStore"}),d=o},470687:(e,t,r)=>{r.d(t,{_:()=>d});var i=r(296540),n=()=>r(726637),a=()=>r(401497),o=()=>r(718827),s=()=>r(100622),c=r(474848);function d(e){const{children:t,cycleLimit:r=1/0,delayCycleMs:d=0,delayInitialMs:u=350,gap:l=20,isPaused:h,showFadeout:m,speed:f=50,fadeoutColorVariant:p="primary"}=e,v=(0,i.useRef)(null),g=(0,i.useRef)(null),S=(0,i.useRef)(null),y=(0,i.useRef)(),w=(0,i.useRef)(),A=(0,i.useRef)(0),M=(0,i.useRef)(u),C=(0,i.useRef)(!1),b=(0,i.useRef)(0),k=(0,i.useRef)(0),R=(0,i.useRef)(0),x=(0,i.useRef)(null),_=(0,i.useRef)(null),T=(0,i.useRef)(0),[F,D]=(0,i.useState)(!1),[E,I]=(0,i.useState)(!1),B=m?Math.max(l,20):l,W=(0,a().IS)((()=>({container:{overflow:"hidden",position:"relative"},clonesContainer:{whiteSpace:"nowrap",display:"inline-flex",alignItems:"center",gap:B},measureContainer:{position:"absolute",visibility:"hidden",whiteSpace:"nowrap",pointerEvents:"none"},fadeContainer:{position:"relative",overflow:"hidden"},fade:{position:"absolute",insetBlockStart:0,insetBlockEnd:0,width:Math.min(B,40),pointerEvents:"none"},fadeLeft:{insetInlineStart:0,background:`linear-gradient(to left, transparent, ${s().Tj.background[p]})`,opacity:0,transition:"opacity 0.3s ease-in-out"},fadeRight:{insetInlineEnd:0,background:`linear-gradient(to right, transparent, ${s().Tj.background[p]})`,opacity:F&&m?1:0}})),[B,F,m,p]),N=(0,i.useCallback)((e=>{S.current&&(S.current.style.transform=`translateX(${e}px)`)}),[]),P=(0,i.useCallback)((e=>{T.current!==e&&(T.current=e,_.current&&(_.current.style.opacity=m?`${e}`:"0"))}),[m]),q=(0,i.useCallback)((()=>{R.current=0,I(!1)}),[I]);(0,i.useEffect)((()=>{q()}),[r,q]);const O=(0,i.useCallback)((()=>{N(0),P(0)}),[N,P]),L=(0,i.useCallback)((()=>{A.current=0,k.current=0,b.current=0,w.current=void 0}),[]),j=(0,i.useCallback)((()=>{L(),O()}),[L,O]),H=(0,i.useCallback)((()=>{x.current=setTimeout((()=>{E&&(C.current=!0),q(),x.current=null}),800)}),[E,q]),X=(0,i.useCallback)((()=>{x.current&&(clearTimeout(x.current),x.current=null)}),[]),U=(0,i.useCallback)((()=>{E&&(C.current=!0),q()}),[E,q]);(0,i.useEffect)((()=>{var e;const t=null===(e=v.current)||void 0===e?void 0:e.parentElement;if(!t)return;const r=new ResizeObserver((()=>{var e;const t=null===(e=v.current)||void 0===e?void 0:e.parentElement,r=g.current;t&&r&&D(r.offsetWidth>t.offsetWidth)}));return r.observe(t),()=>{r.disconnect()}}),[]),(0,i.useEffect)((()=>{F&&j()}),[F,j]),(0,i.useEffect)((()=>{if(!F)return y.current&&cancelAnimationFrame(y.current),void O();if(h||E)return void(y.current&&cancelAnimationFrame(y.current));const e=t=>{var i;w.current||(w.current=t,C.current?(C.current=!1,M.current=0):M.current=u);const n=t-w.current;w.current=t;const a=((null===(i=g.current)||void 0===i?void 0:i.offsetWidth)??0)+B;if(M.current>0){M.current-=n;const t=A.current*f/1e3;return N(-t%a),void(y.current=requestAnimationFrame(e))}if(b.current>0&&d>0)return b.current-=n,O(),void(y.current=requestAnimationFrame(e));A.current+=n;const o=A.current*f/1e3%a;if(o<k.current){if(R.current+=1,R.current>=r)return I(!0),void j();b.current=d}else N(-o),P(o>a-B?0:1);k.current=o,y.current=requestAnimationFrame(e)};return w.current=void 0,y.current=requestAnimationFrame(e),()=>{y.current&&cancelAnimationFrame(y.current)}}),[r,d,u,E,F,h,B,L,O,j,f,P,N]);const $=(0,i.useMemo)((()=>F?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{children:t}),(0,c.jsx)("span",{children:t})]}):t),[t,F]),G=(0,i.useMemo)((()=>(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{ref:g,style:W.measureContainer,"aria-hidden":"true",children:t}),(0,c.jsx)("div",{ref:v,style:W.container,children:(0,c.jsx)("div",{ref:S,style:W.clonesContainer,children:$})}),(0,c.jsx)("div",{ref:_,style:{...W.fade,...W.fadeLeft},"aria-hidden":"true"}),(0,c.jsx)("div",{style:{...W.fade,...W.fadeRight},"aria-hidden":"true"})]})),[t,$,W]);return n().A.isMobile?(0,c.jsx)(o().Ay,{style:W.fadeContainer,onTouchStart:U,children:G}):(0,c.jsx)("div",{style:W.fadeContainer,onMouseEnter:H,onMouseLeave:X,children:G})}},524007:(e,t,r)=>{r.d(t,{d:()=>i});const i=new(r(29923).R)({key:"preferred_audio_input_device",namespace:r(553737).cd,important:!0,trackingType:"preference"})},673903:(e,t,r)=>{r.d(t,{E:()=>i,G:()=>n});r(16280);function i(){const e=navigator.mediaDevices;if(e instanceof MediaDevices)return e;throw new Error("Media devices unavailable in current context.")}function n(e){const t=window.AudioContext||window.webkitAudioContext||!1;var r;if(Boolean(t))return new t({...(null===(r=navigator)||void 0===r||null===(r=r.mediaDevices)||void 0===r?void 0:r.getSupportedConstraints().sampleRate)&&{sampleRate:e}});throw new Error("Browser does not support Web Audio API (AudioContext is not available).")}},909557:(e,t,r)=>{r.d(t,{$W:()=>o,Dg:()=>u,E6:()=>l,Rv:()=>d,Tn:()=>s,XG:()=>c,Yh:()=>a,d1:()=>n,eY:()=>h});var i=()=>r(416845);class n extends i().WXf{constructor(e){super({level:"error",status:500,name:"DictationAudioRecorderFailedError",message:e||"Audio recorder failed",retryable:!1})}}class a extends i().WXf{constructor(){super({level:"error",status:500,name:"DictationSystemAudioFailedError",message:"System audio failed",retryable:!1})}}class o extends i().WXf{constructor(){super({level:"error",status:500,name:"DictationSystemAudioHardwareError",message:"System audio hardware error",retryable:!1})}}class s extends i().WXf{constructor(){super({level:"error",status:500,name:"DictationStartTimeoutError",message:"Dictation start timeout",retryable:!0})}}class c extends i().WXf{constructor(e){super({level:"error",status:429,name:"DictationRateLimitError",message:e||"Rate limit exceeded",retryable:!1})}}class d extends i().WXf{constructor(e){super({level:"error",status:403,name:"DictationForbiddenError",message:e||"Access forbidden",retryable:!1})}}class u extends i().WXf{constructor(e){super({level:"error",status:403,name:"DictationUpgradeRequiredError",message:e||"Workspace upgrade required",retryable:!1})}}class l extends i().WXf{constructor(e,t){super({level:"error",status:t&&(0,r(513416).Mh)(t)?t:500,name:"DictationOpenAIError",message:e,retryable:!0})}}class h extends i().WXf{constructor(e){super({level:"error",status:400,name:"DictationMissingUserOrSpaceError",message:e||"Missing user or space information",retryable:!1})}}},927648:(e,t,r)=>{r.d(t,{Ay:()=>m,Kj:()=>u});r(16280);var i=()=>r(165358),n=()=>r(496603),a=()=>r(229833),o=()=>r(914649),s=()=>r(673903);function c(e){for(const t of e.getTracks())t.stop()}const d=(0,n().nF)((async function(){if(!window.isSecureContext)return o().wv;try{const e=(0,s().E)();return c(await e.getUserMedia({video:!1,audio:!0})),o().a3}catch(e){const{displayDictationPermissionSnackbar:t}=await Promise.all([r.e(35530),r.e(9773),r.e(55373),r.e(36192),r.e(27992),r.e(63452),r.e(66249),r.e(92845),r.e(87249),r.e(79022),r.e(44854),r.e(87017),r.e(34877),r.e(11676),r.e(61165),r.e(94522),r.e(44584),r.e(40992),r.e(88455),r.e(49021),r.e(71136),r.e(86341),r.e(13131),r.e(4902)]).then(r.bind(r,872903));if(e instanceof Error)switch(e.name){case o().nY:return t(o().JS),o().JS;case o().V9:case o().mL:return t(o().rP),o().rP}return t(o().JC),o().JC}}),1e3);async function u(){if(!window.isSecureContext)return o().wv;try{const e=(0,s().E)();return c(await e.getDisplayMedia({audio:!0,systemAudio:"include"})),o().a3}catch(e){return i().log({level:"error",from:"checkScreenRecordingPermissionsByTesting",error:(0,a().convertErrorToLog)(e),type:"checkScreenRecordingPermissionsByTestingUnableToCaptureSystemAudio"}),o().JC}}const l=(0,n().nF)(u,1e3);class h extends(()=>r(757695))().Store{async checkPermissions(e){const t=await d(),r=e?await l():o().wg;return this.setState({...this.state,audio:t,screenRecording:r}),{audio:t,screenRecording:r}}getHasAttemptedScreenRecordingPermissions(){return this.state.hasAttemptedScreenRecordingPermissions}setHasAttemptedScreenRecordingPermissions(e){this.setState({...this.state,hasAttemptedScreenRecordingPermissions:e})}getInitialState(){const e=window.isSecureContext?o().wg:o().wv;return{audio:e,screenRecording:e,hasAttemptedScreenRecordingPermissions:void 0}}}const m=new h},964576:(e,t,r)=>{r.d(t,{A:()=>n});class i extends(()=>r(757695))().Store{constructor(){super()}getInitialState(){}}const n=new i},986850:(e,t,r)=>{e.exports=r.p+"dbc10b469ee58d20.js"}}]);