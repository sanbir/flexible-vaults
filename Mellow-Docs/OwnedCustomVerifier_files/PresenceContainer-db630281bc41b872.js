"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[86625],{91765:(e,t,r)=>{r.d(t,{oK:()=>d,qg:()=>v,sB:()=>S});r(898992),r(823215);var n=()=>r(907258),o=()=>r(76549),i=()=>r(804666),s=()=>r(848538),a=()=>r(534177),c=()=>r(799832),l=()=>r(396301),u=()=>r(51967),p=()=>r(292664);function d(e){var t;if(!e.isInLibraryBlock())return;const r=e.getRecordStoreUIRoot();if(!(r instanceof o().Bv))return;const n=null===(t=(0,c().U)(r))||void 0===t||null===(t=t.collectionViewStore())||void 0===t||null===(t=t.getCollectionSource())||void 0===t?void 0:t.type;return n&&(0,i().a0)(n)?n:void 0}function S({environment:e,selectedItems:t}){if(0===t.length)return;const{currentUserSettingsStore:r,sidebarSpaceViewStore:i,sidebarSpaceStore:c}=n().default.state,l=e.currentUser.id,S=d(t[0]);if(!(r&&i&&l&&c&&S&&function(e,t,r,n){switch(e){case"recents":case"teamspaceDirectory":case"libraryExternalPages":case"myMeetings":return!1;case"favorites":return!0;case"private":return t.every((e=>(0,p().K)(e)));case"shared":return t.every((e=>(0,u().B)({store:e,spaceStore:n,userId:r})));default:return(0,a().HB)(e),!1}}(S,t,l,c)))return;const v=o().VF.createChildStore(i,(0,s().i1)({userId:l,spaceId:i.id}));return v?{environment:e,selectedItems:t,userSettingsStore:r,spaceViewStore:i,spaceUserStore:v,libraryViewName:S}:void 0}function v(e){const{currentUserSettingsStore:t}=n().default.state,{sortOption:r}=(0,l().RQ)({type:"private",spaceViewStore:e,userSettingsStore:t}),{sortOption:o}=(0,l().RQ)({type:"shared",spaceViewStore:e,userSettingsStore:t});return{private:r,shared:o}}},281060:(e,t,r)=>{r.r(t),r.d(t,{PresenceContainer:()=>R});r(944114),r(898992),r(354520),r(672577),r(581454);var n=r(296540),o=()=>r(756117),i=()=>r(726637),s=()=>r(484714),a=()=>r(590526),c=()=>r(401497),l=()=>r(295633),u=()=>r(849255),p=()=>r(641007),d=()=>r(187174),S=()=>r(798880),v=()=>r(100622),f=()=>r(488923),g=()=>r(863484),h=()=>r(64790),y=()=>r(129522),m=()=>r(836724),I=()=>r(691809),b=()=>r(93263),C=()=>r(453697),w=r(474848);const x={position:"absolute",top:0,insetInlineStart:0,zIndex:89},A=16,B=22;function R(e){const{pageVisitStore:t,presenceStore:r}=e,i=(0,s().v3)(),[{status:c,value:u}]=(0,d().Yb)((async()=>(0,f().$g)()),[]),p=(0,n.useRef)(null),S=(0,a().K8)((()=>function(e){const{pageVisitStore:t,presenceStore:r,environment:n,containerEl:o,coEditingPresenceStore:i}=e,{rootStore:s}=r.state;if(!s||!(0,h().xm)(r))return[];if(!o)return[];const a=n.currentUser.id,c=(0,h().PZ)({pageVisitStore:t,presenceStore:r}).filter((e=>e.userId!==a&&(0,h().dp)(n,e))),u=null==i?void 0:i.getPresencesForBlock(s.id);u&&c.push(...u);if(!c.length)return[];const p={},d=m().T.getMembersByDOMOrder({filter:()=>!0}),S=o.getBoundingClientRect(),v=[];for(const m of c){const e=(0,h().EV)(m),t=null==m?void 0:m.blockPath;let r;if(t&&(null==t?void 0:t.length)>0?r=E(d,t,s):e&&(r=U(d,e,s)),!r)continue;const o=r.props.store.id;p.hasOwnProperty(o)||(p[o]=0),p[o]++;const i=r.getNode();if(!(i&&i instanceof Element))continue;const a=i.getBoundingClientRect();if(!a)continue;let c,u;if(r.props.store.isFirstBlockInCalloutV2Block()){var f;const e=null===(f=r.props.store.getRecordStoreUIParent())||void 0===f?void 0:f.findRecordStoreUIAncestor((e=>e instanceof l().B)).ancestor;e instanceof l().B&&(c=e,u=c?y().K.getRect(c):void 0)}const I=(0,g().ac)({marginItemType:"presence_avatars",nodeRect:u??a,containerRect:S,avatarCount:p[o],store:c??r.props.store,environment:n}),b=(0,g().qg)({marginItemType:"presence_avatars",nodeRect:u??a,containerRect:S,environment:n,store:c??r.props.store,selectable:r});v.push({type:"presence",userId:m.userId,left:b,top:I,blockType:r.props.store.getType()})}return v}({pageVisitStore:t,presenceStore:r,environment:i,containerEl:p.current,coEditingPresenceStore:"resolved"===c?u:void 0})),[t,r,i,c,u],{debugName:"presenceAvatars",useDeepEqual:!0});return(0,w.jsx)("div",{className:"notion-presence-container",style:x,ref:p,children:(0,w.jsx)(b().A,{render:()=>S.map((t=>{const{left:r,top:n}=t,i={avatarWrapperAnimation:{translateX:r,translateY:n,scale:1,opacity:1},avatarEnterExitAnimation:{scale:.7,opacity:0}},s={...i.avatarWrapperAnimation,...i.avatarEnterExitAnimation};return(0,w.jsx)(o().A,{initial:s,exit:s,animate:i.avatarWrapperAnimation,children:(0,w.jsx)(V,{avatar:t,presenceStore:e.presenceStore})},t.userId)}))})})}function U(e,t,r){return e.find((e=>{const n=e.props.store;return Boolean(n&&n.id===t&&r.uiContains(n)&&e.props.shouldShowHalo)}))}function V(e){const{avatar:t}=e,r=i().A.isMobile?A:B,n=(0,c().DP)(),o=(0,c().IS)((()=>{const e={width:r,height:r,borderRadius:r};return{uiUserAvatarStyles:{...e},avatarInnerOutline:{...e,outlineStyle:"solid",outlineColor:v().Tj.UIUserAvatarInnerOutline,outlineWidth:.5,outlineOffset:-.5},avatarBorder:"presence"===t.type?{...e,outlineStyle:"solid",outlineColor:(0,h().$L)({userId:t.userId,theme:n}),outlineWidth:1.5,outlineOffset:-.5}:{},avatarWrapper:{...e,position:"absolute",top:0,insetInlineStart:i().A.isMobile?2:0,outlineStyle:"solid",outlineWidth:.5,outlineOffset:1,outlineColor:v().Tj.background.primary},initialColor:"presence"===t.type?{color:(0,h().$L)({userId:t.userId,theme:n})}:{}}}),[r,t,n]),s=(0,a().K8)((()=>{const{rootStore:r}=e.presenceStore.state;if(r){if((0,S().MF)(t.userId))return{type:"presence",userStore:p().px};const e=u().L.createChildStore(r,{table:S().oo,id:t.userId});return e.isDefined()?{type:"presence",userStore:e}:null}return null}),[t,e.presenceStore]);return s?(0,I().A)((e=>(0,w.jsx)("div",{style:o.avatarWrapper,...e,children:(0,w.jsx)("div",{style:o.avatarBorder,children:(0,w.jsx)(C().A,{iconStyle:o.avatarInnerOutline,hasTooltip:!0,userStore:s.userStore,style:o.uiUserAvatarStyles,size:r,avatarShouldShowShadow:!0,initialOverrideStyle:o.initialColor})})}))):null}function E(e,t,r){const n=new Map(t.map(((e,t)=>[e,t])));let o,i;for(const s of e){const e=s.props.store,t=n.get(e.id);if(void 0!==t&&((void 0===i||t<i)&&r.uiContains(e)&&s.props.shouldShowHalo&&(o=s,i=t),0===i))return o}return o}}}]);