"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[38402],{485961:(e,t,i)=>{i.r(t),i.d(t,{useReactiveMessageEventListener:()=>h});var s=i(296540),n=()=>i(484714),o=(i(16280),i(898992),i(354520),i(581454),()=>i(63636)),r=()=>i(131448),a=()=>i(263265);const c=new class{constructor(){this.initialized=!1,this.environment=void 0,this.lastProcessedEventTimestamp=0,this.debounceTimeout=void 0,this.storeListener=void 0}initialize(e){this.environment=e,this.initialized||(this.lastProcessedEventTimestamp=Date.now(),this.storeListener=()=>{this.handleStoreChange()},a().a.addListener(this.storeListener,{listenerName:"ReactiveMessageEventListener",listenerType:"component"}),this.initialized=!0)}handleStoreChange(){this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout((()=>{this.processNewEvents()}),300)}async processNewEvents(){if(this.environment&&this.initialized)try{const e=a().a.getRecentEvents().filter((e=>e.timestamp>this.lastProcessedEventTimestamp));if(0===e.length)return;const t=Array.from(r().default.state.pendingDynamicMessages.values());if(0===t.length)return;const s=await(0,o().Gn)(this.environment);if(!s)return;for(const a of t){if(r().default.isVisible(a.key))continue;if(!(a&&"reactiveShowConditions"in a&&Array.isArray(a.reactiveShowConditions)&&a.reactiveShowConditions.length>0))continue;(0,o().Tc)({messageConfig:a,environment:this.environment,inAppMessageEligibilityContext:s})&&await(0,i(300789).iy)({environment:this.environment,messageKey:a.key})}const n=Math.max(...e.map((e=>e.timestamp)));this.lastProcessedEventTimestamp=n}catch(e){i(165358).log({level:"error",from:"inAppMessages",type:"reactiveMessageEventListenerError",error:{message:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}})}}dispose(){this.debounceTimeout&&(clearTimeout(this.debounceTimeout),this.debounceTimeout=void 0),this.storeListener&&(a().a.removeListener(this.storeListener,"ReactiveMessageEventListener"),this.storeListener=void 0),this.initialized=!1,this.environment=void 0,this.lastProcessedEventTimestamp=0}};function h(){const e=(0,n().v3)();return(0,s.useEffect)((()=>(c.initialize(e),()=>{c.dispose()})),[e]),c}}}]);