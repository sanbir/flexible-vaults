"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[54215],{20051:(e,t,i)=>{i.d(t,{Bl:()=>c,IH:()=>g,Lh:()=>q,Mh:()=>T,RY:()=>I,VP:()=>y,_A:()=>h,n$:()=>f});var n=()=>i(534177),r=()=>i(130382),o=()=>i(416845),s=()=>i(266442),a=()=>i(452665);const d=15;function c(e){if(!s().Vu.includes(e))throw new(o().rTV)("Rating must be an integer between 1 and 5.",{type:"marketplace_listing_review_invalid_rating"});return!0}const u=3,l=100;function g(e){const t=e.trim();if(t.length<u)throw new(o().rTV)("Title too short",{type:"marketplace_listing_review_title_too_short"});if(t.length>l)throw new(o().rTV)("Title too long",{type:"marketplace_listing_review_title_too_long"})}const v=50,m=1500;function h(e){const t=e.trim();if(t.length<v)throw new(o().rTV)("Description too short",{type:"marketplace_listing_review_description_too_short"});if(t.length>m)throw new(o().rTV)("Title too long",{type:"marketplace_listing_review_description_too_long"})}const w=40;function I(e){const t=e.trim();if(0===t.length)throw new(o().rTV)("Name is required",{type:"marketplace_listing_review_name_too_short"});if(t.length>w)throw new(o().rTV)("Name too long",{type:"marketplace_listing_review_name_too_long"})}const _=5,p=1500;function f(e){const t=e.trim();if(t.length<_)throw new(o().rTV)("Creator response too short",{type:"marketplace_listing_review_creator_response_too_short"});if(t.length>p)throw new(o().rTV)("Creator response too long",{type:"marketplace_listing_review_creator_response_too_long"})}function T(e){return void 0!==e.getTitle()&&void 0!==e.getSerializedContent()}function y(e,t){return t!==a().J6&&(0,r().YH)(e)<d}function q(e){switch(e){case"mostRecent":return{columnName:"updated_time",direction:"descending"};case"highestRating":return{columnName:"rating",direction:"descending"};case"lowestRating":return{columnName:"rating",direction:"ascending"};default:(0,n().HB)(e)}}},348069:(e,t,i)=>{i.r(t),i.d(t,{MaybeMarketplaceReviewNudge:()=>y});var n=i(296540),r=()=>i(907258),o=()=>i(484714),s=()=>i(590526),a=()=>i(634604),d=()=>i(765979),c=()=>i(547567),u=()=>i(187174),l=()=>i(20051),g=()=>i(959577),v=()=>i(769864),m=()=>i(743071),h=()=>i(672753),w=()=>i(998765),I=i(474848);const _=15,p=10,f=10,T=1;function y({blockStore:e}){const t=(0,o().v3)(),{installationPointer:i,version:y,lastEditedById:q,lastEditedTime:C,createdTime:S}=function(e){return(0,s().K8)((()=>{var t;if(!e.isDefined())return{};const i=e.getModel();return{installationPointer:i.getIsImprintableBlock()?null===(t=i.getFormat().installation_imprint)||void 0===t?void 0:t.pointer:void 0,lastEditedById:e.getLastEditedById(),lastEditedTime:e.getLastEditedTime(),createdTime:e.getCreatedTime(),version:i.getVersion()}}),[e])}(e),{acquisitionPointer:k}=function(e){const t=(0,o().v3)();return(0,s().K8)((()=>{if(!e)return{};const i=new(c().f)(t,e);return{acquisitionPointer:null==i?void 0:i.getAcquisitionPointer()}}),[t,e])}(i),{customerPointer:R,acquisitionStatus:V,listingId:b,acquisitionId:P,succeededTime:E}=function(e){const t=(0,o().v3)();return(0,s().K8)((()=>{var i,n;if(!e)return{};const r=new(a().y)(t,e);return{acquisitionStatus:null==r?void 0:r.getStatus(),succeededTime:(null===(i=r.getAttributes())||void 0===i?void 0:i.succeeded_time)??r.getCreatedTime(),customerPointer:null==r?void 0:r.getCustomerPointer(),listingId:null==r?void 0:r.getListingId(),acquisitionId:null==r||null===(n=r.getModel())||void 0===n?void 0:n.id}}),[t,e])}(k),{acquirerId:M,customerId:B}=function({customerPointer:e,acquisitionStatus:t,succeededTime:i,listingId:n}){const a=(0,o().v3)();return(0,s().K8)((()=>{var o,s;if(!e||"succeeded"!==t||!n||!i||(0,l().VP)(i,g().XX))return{};const{currentUserSettingsStore:c}=r().default.state;if(null==c||!c.isDefined())return{};const u=c.getSettingsStore().getKeyStore("marketplace_review_nudge").getValue();if(Object.keys(u||{}).length>=f||(null===(o=(u||{})[n])||void 0===o?void 0:o.length)>=T)return{};const v=new(d().z)(a,e);return{acquirerId:null==v?void 0:v.getAcquirerId(),customerId:null==v||null===(s=v.getModel())||void 0===s?void 0:s.id}}),[a,e,t,n,i])}({customerPointer:R,acquisitionStatus:V,succeededTime:E,listingId:b}),N=function({currentUserId:e,listingId:t,customerId:i,acquirerId:r,version:o,lastEditedById:s,lastEditedTime:a,createdTime:d}){const c=(0,n.useRef)(Date.now());return(()=>{if(!(i&&r&&t&&o&&s&&a&&d))return!1;if(a<c.current)return!1;if(r!==e||s!==e)return!1;return!((a-d)/6e4<_)&&!(o<p)})()}({currentUserId:t.currentUser.id,listingId:b,customerId:B,acquirerId:M,version:y,lastEditedById:q,lastEditedTime:C,createdTime:S}),{reviewId:A,isReady:K}=function({acquisitionId:e,listingId:t,customerId:i,shouldDisplayNudge:r}){const s=(0,o().v3)(),[a,d]=(0,n.useState)(),[c,l]=(0,u().V$)((async()=>{if(t&&i&&e){const n=await v().callApi({eventName:"getMarketplaceListingReviewForCustomer",environment:s,data:{listingId:t,customerId:i}});if("success"===n.type&&n.data.success){const{reviewId:t}=n.data;m().A.setReviewId(e,t),d(t)}}}),[s,t,i,e]),g=Boolean(r&&t&&i&&e);return(0,n.useEffect)((()=>{g&&l()}),[g,l]),{reviewId:a,isReady:"resolved"===c.status}}({acquisitionId:P,listingId:b,customerId:B,shouldDisplayNudge:N}),{isReady:D,isComplete:L,rating:U}=(0,h().Z)(A);return N&&K&&D&&!L&&!U&&P&&b?(0,I.jsx)(w().lK,{acquisitionId:P,listingId:b}):null}},672753:(e,t,i)=>{i.d(t,{L:()=>c,Z:()=>u});var n=()=>i(484714),r=()=>i(590526),o=()=>i(33857),s=()=>i(20051),a=()=>i(266442),d=()=>i(743071);function c(e){return u((0,r().K8)((()=>d().A.getReviewId(e)),[e]))}function u(e){const t=(0,n().v3)();return(0,r().K8)((()=>{if(e){const i=new(o().J)(t,{table:a().UN,id:e}),n=i.isReady(),r=i.getModel();return{isReady:n,isComplete:Boolean(r&&(0,s().Mh)(r)),rating:i.getRating()}}return{isComplete:!1,isReady:!0}}),[t,e])}},743071:(e,t,i)=>{i.d(t,{A:()=>o});const n={reviewIdCache:{},isOpen:!1,acquisitionId:"",productType:void 0,stage:"rating",rating:0,source:void 0};class r extends(()=>i(757695))().Store{getInitialState(){return{...n}}setReviewId(e,t){this.setState({...this.state,reviewIdCache:{...this.state.reviewIdCache,[e]:t}})}getReviewId(e){return this.state.reviewIdCache[e]}openModal({stage:e,productType:t,acquisitionId:i,rating:r,source:o}){this.setState({...n,reviewIdCache:this.state.reviewIdCache,isOpen:!0,productType:t,acquisitionId:i,stage:e,rating:r||0,source:o})}closeModal(){this.setState({...n,reviewIdCache:this.state.reviewIdCache})}updateState(e){this.setState({...this.state,...e})}}const o=new r}}]);