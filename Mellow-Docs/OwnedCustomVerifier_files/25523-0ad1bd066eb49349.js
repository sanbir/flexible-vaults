"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[25523,93139],{15986:(e,t,o)=>{o.d(t,{E:()=>u});o(581454);var n=o(296540),r=(o(944114),o(898992),o(354520),()=>o(496603)),i=()=>o(534177);function a(e){return"trigger_created"===e.type||"trigger_updated"===e.type||"trigger_deleted"===e.type||"trigger_enabled_changed"===e.type}function s(e){return"module_created"===e.type||"module_updated"===e.type||"module_deleted"===e.type||"module_permission_added"===e.type||"module_permission_removed"===e.type||"module_permission_updated"===e.type}function l(e){return"script_created"===e.type||"script_updated"===e.type||"script_deleted"===e.type}var d=()=>o(69708),c=o(474848);const u=n.memo((function({edits:e}){const t=(0,o(401497).IS)((()=>({label:{cursor:"default"}})),[]),u=(0,n.useMemo)((()=>(0,c.jsx)(o(493552).D,{styleKey:"bodyRegular",colorPalette:"gray",colorVariant:"secondary",children:(0,c.jsx)(d().sA,{defaultMessage:"{count, plural, one {# unsaved edit} other {# unsaved edits}}",id:"agent.unsavedEdits.label",values:{count:e.length}})})),[e.length]),p=(0,n.useMemo)((()=>{const t=function(e){const t={trigger:e.filter(a),module:e.filter(s),script:e.filter(l)},o=e.filter((e=>!a(e)&&!s(e)&&!l(e))),n=[];for(const[r,a]of(0,i().WP)(t)){let e;a.length>1&&(e={type:r,edits:a}),1===a.length&&(e={type:"single",edit:a[0]}),n.push(e)}for(const r of o)n.push({type:"single",edit:r});return(0,r().oE)(n)}(e),o=t.map(((e,t)=>{const o=function(e){const t=e=>(0,c.jsx)(d().sA,{...e,values:{faded:(...e)=>(0,c.jsx)("span",{style:{opacity:.5},children:e})}});if("single"!==e.type)switch(e.type){case"trigger":return t(g.multipleTriggersUpdated);case"module":return t(g.multipleModulesUpdated);case"script":return t(g.multipleScriptsUpdated);default:(0,i().HB)(e)}const{edit:o}=e;switch(o.type){case"instructions_updated":return t(g.instructionsUpdated);case"model_updated":return t(g.modelUpdated);case"trigger_created":return t(g.triggerCreated);case"trigger_updated":return t(g.triggerUpdated);case"trigger_deleted":return t(g.triggerDeleted);case"trigger_enabled_changed":return o.enabled?t(g.triggerEnabled):t(g.triggerDisabled);case"module_created":return t(g.moduleCreated);case"module_updated":return t(g.moduleUpdated);case"module_deleted":return t(g.moduleDeleted);case"module_permission_added":return t(g.modulePermissionAdded);case"module_permission_removed":return t(g.modulePermissionRemoved);case"module_permission_updated":return t(g.modulePermissionUpdated);case"script_created":return t(g.scriptCreated);case"script_updated":return t(g.scriptUpdated);case"script_deleted":return t(g.scriptDeleted);default:return}}(e);if(o)return(0,c.jsx)("div",{children:o},`${e.type}-${t}`)}));return(0,r().oE)(o)}),[e]);return 0===p.length?u:(0,c.jsx)(o(26697).m,{render:e=>(0,c.jsx)("div",{...e,style:t.label,children:u}),renderTooltip:()=>(0,c.jsx)(c.Fragment,{children:p.map(((e,t)=>(0,c.jsx)("div",{children:e},`${e}-${t}`)))}),placement:"bottom",alignment:"center"})}));const g=(0,d().YK)({instructionsUpdated:{id:"agent.unsavedEdits.instructionsUpdated",defaultMessage:"<faded>Edited</faded> instructions page"},modelUpdated:{id:"agent.unsavedEdits.modelUpdated",defaultMessage:"<faded>Updated</faded> model"},triggerCreated:{id:"agent.unsavedEdits.triggerCreated",defaultMessage:"<faded>Added</faded> new trigger"},triggerUpdated:{id:"agent.unsavedEdits.triggerUpdated",defaultMessage:"<faded>Updated</faded> trigger"},triggerDeleted:{id:"agent.unsavedEdits.triggerDeleted",defaultMessage:"<faded>Removed</faded> trigger"},triggerEnabled:{id:"agent.unsavedEdits.triggerEnabled",defaultMessage:"<faded>Enabled</faded> trigger"},triggerDisabled:{id:"agent.unsavedEdits.triggerDisabled",defaultMessage:"<faded>Disabled</faded> trigger"},multipleTriggersUpdated:{id:"agent.unsavedEdits.multipleTriggersUpdated",defaultMessage:"<faded>Updated</faded> triggers"},moduleCreated:{id:"agent.unsavedEdits.moduleCreated",defaultMessage:"<faded>Added</faded> new tool"},moduleUpdated:{id:"agent.unsavedEdits.moduleUpdated",defaultMessage:"<faded>Updated</faded> tool"},moduleDeleted:{id:"agent.unsavedEdits.moduleDeleted",defaultMessage:"<faded>Removed</faded> tool"},modulePermissionAdded:{id:"agent.unsavedEdits.modulePermissionAdded",defaultMessage:"<faded>Added</faded> tool permission"},modulePermissionRemoved:{id:"agent.unsavedEdits.modulePermissionRemoved",defaultMessage:"<faded>Removed</faded> tool permission"},modulePermissionUpdated:{id:"agent.unsavedEdits.modulePermissionUpdated",defaultMessage:"<faded>Updated</faded> tool permission"},multipleModulesUpdated:{id:"agent.unsavedEdits.multipleModulesUpdated",defaultMessage:"<faded>Updated</faded> tools and access"},scriptCreated:{id:"agent.unsavedEdits.scriptCreated",defaultMessage:"<faded>Added</faded> new script"},scriptUpdated:{id:"agent.unsavedEdits.scriptUpdated",defaultMessage:"<faded>Updated</faded> script"},scriptDeleted:{id:"agent.unsavedEdits.scriptDeleted",defaultMessage:"<faded>Removed</faded> script"},multipleScriptsUpdated:{id:"agent.unsavedEdits.multipleScriptsUpdated",defaultMessage:"<faded>Updated</faded> scripts"}})},26440:(e,t,o)=>{o.d(t,{w:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"0.12 2.37 17.51 15.26",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M3.442 13.102a.625.625 0 0 1-.884 0L.304 10.848a.625.625 0 0 1 .884-.884l1.187 1.187V10a7.625 7.625 0 1 1 2.303 5.46.625.625 0 1 1 .872-.895A6.375 6.375 0 1 0 3.625 10v1.151l1.187-1.187a.625.625 0 1 1 .884.884z"}),(0,n.jsx)("path",{d:"M9.375 5.725a.625.625 0 0 1 1.25 0v3.65H13.6a.625.625 0 0 1 0 1.25H10A.625.625 0 0 1 9.375 10z"})]})},i=(0,o(340498).wt)("clockArrowBack",r,"default")},55967:(e,t,o)=>{o.d(t,{w:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"2.57 0.97 10.86 13.25",svg:(0,o(474848).jsx)("path",{d:"M8.715 1.077a.626.626 0 0 0-.863.868l.08.098L9.27 3.375H8A5.425 5.425 0 1 0 13.425 8.8a.625.625 0 0 0-1.25 0A4.175 4.175 0 1 1 8 4.625h1.27L7.942 5.96l-.08.097a.626.626 0 0 0 .966.784l2.395-2.406.077-.095a.624.624 0 0 0-.08-.788L8.813 1.157z"})},r=(0,o(340498).wt)("arrowCircleSpinClockwiseSmall",n,"small")},64035:(e,t,o)=>{o.d(t,{C:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.5 1.37 13 13.25",svg:(0,o(474848).jsx)("path",{d:"M9.385 1.375a.625.625 0 1 0 0 1.25h.769c.76 0 1.375.616 1.375 1.375v1.223c0 1.085.49 2.097 1.298 2.777a3.63 3.63 0 0 0-1.298 2.777V12c0 .76-.616 1.375-1.375 1.375h-.77a.625.625 0 1 0 0 1.25h.77A2.625 2.625 0 0 0 12.779 12v-1.223c0-.897.514-1.725 1.32-2.128a.726.726 0 0 0 0-1.298 2.39 2.39 0 0 1-1.32-2.128V4a2.625 2.625 0 0 0-2.625-2.625zm-2.77 0h-.769A2.625 2.625 0 0 0 3.221 4v1.223c0 .897-.514 1.725-1.32 2.128a.726.726 0 0 0 0 1.298 2.39 2.39 0 0 1 1.32 2.128V12a2.625 2.625 0 0 0 2.625 2.625h.77a.625.625 0 1 0 0-1.25h-.77c-.76 0-1.375-.616-1.375-1.375v-1.223c0-1.085-.49-2.097-1.298-2.777a3.63 3.63 0 0 0 1.298-2.777V4c0-.76.616-1.375 1.375-1.375h.77a.625.625 0 1 0 0-1.25"})},r=(0,o(340498).wt)("curlyBracesSmall",n,"small")},89849:(e,t,o)=>{o.r(t),o.d(t,{eyeIcon:()=>i,iconDefinition:()=>r});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"0.96 4.19 18.07 11.62",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10.17 6.694a3.307 3.307 0 0 1 3.135 3.303l-.005.17a3.305 3.305 0 0 1-3.3 3.137l-.17-.004a3.307 3.307 0 0 1-3.132-3.133l-.004-.17A3.307 3.307 0 0 1 10 6.69zm-.17 2.2a1.104 1.104 0 0 0 0 2.207 1.103 1.103 0 0 0 0-2.207"}),(0,n.jsx)("path",{d:"M10 4.194c3.878 0 7.26 2.075 8.862 5.127l.073.163c.126.333.126.7 0 1.033l-.073.163c-1.602 3.052-4.984 5.126-8.862 5.126-3.757 0-7.049-1.946-8.707-4.843l-.156-.283a1.46 1.46 0 0 1 0-1.359l.156-.283C2.95 6.141 6.243 4.194 10 4.194m0 1.251c-3.33 0-6.196 1.724-7.622 4.214l-.134.243a.21.21 0 0 0 0 .197l.134.243c1.426 2.49 4.292 4.214 7.622 4.214 3.437 0 6.38-1.837 7.756-4.457l.018-.048a.2.2 0 0 0 0-.1l-.018-.049C16.38 7.282 13.437 5.445 10 5.445"})]})},i=(0,o(340498).wt)("eye",r,"default")},103674:(e,t,o)=>{o.d(t,{A:()=>r});class n extends(()=>o(757695))().Store{getInitialState(){return{permissionsInviteStore:(0,o(406999)._P)(),contextualInviteStore:new(o(159026).Ay)}}get stageFromStoreState(){return this.state.contextualInviteStore.state.inviteStage}}const r=n},133220:(e,t,o)=>{o.d(t,{z:()=>E});var n=o(296540),r=()=>o(920198),i=()=>o(242422),a=()=>o(484714),s=()=>o(590526),l=()=>o(401497),d=()=>o(394888),c=()=>o(807449),u=()=>o(695115),g=()=>o(89849),p=()=>o(599813),f=()=>o(743246),m=()=>o(201980),w=()=>o(760342),v=()=>o(905470),h=()=>o(69708),y=()=>o(100622),k=()=>o(277942),x=()=>o(324009),S=()=>o(600434),b=()=>o(555102),M=()=>o(353755),j=()=>o(166442),C=()=>o(965454),I=()=>o(770160),A=()=>o(631611),T=()=>o(687879),D=()=>o(622936),P=()=>o(905921),_=o(474848);const B=(0,h().YK)({previewingAgent:{id:"workflows.agentPreviewModal.previewingAgent",defaultMessage:"Previewing {agentName}"}});function E(e){const{workflowStore:t,isOpen:o,onClose:r,initialThreadStore:i,customTitle:a}=e,c=(0,h().tz)(),u=(0,s().uB)(void 0,j().ClientAIChatStore),[g,p]=(0,n.useState)(i),[f,m]=(0,n.useState)(0),w=(0,s().K8)((()=>u.state.showDebug),[u]),v=(0,n.useMemo)((()=>w?1200:800),[w]),k=(0,s().K8)((()=>t.getDraftData()),[t]),x=(null==k?void 0:k.name)||c.formatMessage({defaultMessage:"Agent",id:"workflows.agentPreviewModal.defaultAgentName"}),S=null==k?void 0:k.icon,b=null==k?void 0:k.description,M=null==k?void 0:k.conversationStarters,I=(0,n.useMemo)((()=>new(C().rz)),[]);(0,n.useEffect)((()=>{i&&p(i)}),[i]);const A=(0,n.useCallback)((({newThreadStore:e})=>{e?p(e):(I.reset(),p(void 0),m((e=>e+1)))}),[I]),T=(0,l().IS)((()=>({modalContent:{height:"100%",display:"flex",flexDirection:"column",backgroundColor:y().Tj.background.primary},header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 20px",borderBottom:`1px solid ${y().Tj.border.secondary}`,flexShrink:0},headerLeft:{display:"flex",alignItems:"center",gap:8},headerTitle:{fontSize:16,fontWeight:600,color:y().Tj.text.primary,display:"flex",alignItems:"center",gap:8},headerActions:{display:"flex",alignItems:"center",gap:8},closeButton:{width:32,height:32},contentWrapper:{flexGrow:1,overflow:"hidden",display:"flex",flexDirection:"row",position:"relative",minHeight:0,height:"100%"}})),[]);return(0,_.jsx)(d().s,{isOpen:o,onDismiss:r,allowDismissByEscape:!0,showCloseIcon:!1,areaConstraint:{width:{type:"fixed",length:v},height:{type:"fixed",length:800}},render:()=>(0,_.jsx)(C().XN.Provider,{value:I,children:(0,_.jsxs)("div",{style:T.modalContent,children:[(0,_.jsx)(U,{agentName:x,styles:T,onClose:r,tempAiThreadManager:I,threadStore:g,clientStore:u,onThreadChange:A,customTitle:a}),(0,_.jsx)("div",{style:T.contentWrapper,children:(0,_.jsx)(L,{clientStore:u,workflowStore:t,agentIcon:S,agentName:x,agentDescription:b,conversationStarters:M,tempAiThreadManager:I,onThreadChange:A,threadStore:g},f)})]})})})}function U(e){const{agentName:t,styles:o,onClose:n,threadStore:r,clientStore:i,onThreadChange:a,customTitle:s}=e,l=(0,h().tz)(),d=(0,S().K7)("custom_agent");return(0,_.jsxs)("div",{style:o.header,children:[(0,_.jsx)("div",{style:o.headerLeft,children:(0,_.jsxs)("div",{style:o.headerTitle,children:[(0,_.jsx)(c().I,{icon:g().eyeIcon,size:"sm",colorVariant:"secondary"}),s||(0,_.jsx)(h().sA,{...B.previewingAgent,values:{agentName:t}})]})}),(0,_.jsxs)("div",{style:o.headerActions,children:[(0,_.jsx)(k().ps,{aiChatFeatureController:d,threadStore:r,clientStore:i,onThreadChange:a,showOnHover:!1,features:{showInviteButton:!1,showNewChatButton:!1,showNewChatButtonIcon:!1}}),(0,_.jsx)(u().A,{icon:p().xMarkIcon,onClick:n,ariaLabel:l.formatMessage({defaultMessage:"Close preview",id:"workflows.agentPreviewModal.close"}),style:o.closeButton})]})]})}function L(e){const{workflowStore:t,agentIcon:o,agentName:i,agentDescription:a,conversationStarters:s,onThreadChange:d,threadStore:c,clientStore:u}=e,g=(0,r().L)(),[p,f]=(0,n.useState)(null==c?void 0:c.id),[m,w]=(0,n.useState)(Boolean(c)),v=(0,S().K7)("custom_agent");(0,n.useEffect)((()=>{null!=c&&c.id?(f(c.id),w(!0)):(f(void 0),w(!1))}),[null==c?void 0:c.id]);const h=(0,l().IS)((()=>({wrapper:{flex:1,height:"100%",overflow:"hidden",display:"flex",flexDirection:"column",minHeight:0}})),[]);return g?(0,_.jsx)("div",{style:h.wrapper,children:(0,_.jsx)(A().hP,{surface:A().wy.inferenceTranscriptChatView,children:m&&p?(0,_.jsx)(R,{clientStore:u,spaceStore:g,threadId:p,aiChatFeatureController:v,onThreadChange:d}):(0,_.jsx)(N,{agentName:i,agentDescription:a,conversationStarters:s,workflowStore:t,onThreadChange:d,clientStore:u,aiChatFeatureController:v,agentIcon:o})})}):null}function N(e){const{agentName:t,agentDescription:o,conversationStarters:d,onThreadChange:c,workflowStore:u,clientStore:g,aiChatFeatureController:p,agentIcon:h}=e,S=(0,r().L)(),M=(0,a().v3)(),j=(0,l().IS)((()=>({container:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},emptyStateWrapper:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,padding:"32px 48px",width:"100%",boxSizing:"border-box"},agentName:{fontSize:20,fontWeight:600,color:y().Tj.text.primary},inputWrapper:{width:"100%",maxWidth:600},agentDescription:{fontSize:14,color:y().Tj.text.secondary,textAlign:"center"}})),[]),C=(0,s().K8)((()=>{var e;const t=u.getDraftData()??u.getData(),o=null===(e=u.getPublishedArtifactStore())||void 0===e?void 0:e.getData();return(0,w().Z0)({workflowData:t,publishedWorkflowData:o})}),[u]),I=(0,s().K8)((()=>{var e;const t=null===(e=u.getPublishedArtifactStore())||void 0===e?void 0:e.getData();return(0,v().uP)(t)}),[u]),A=(0,s().K8)((()=>{const e=i().default.checkGate({gateName:"agent_update_page_tree_diff"}),t=i().default.checkGate({gateName:"custom_agent_setup_mode_tool"});return{...(0,w().ve)(u.id,{configOverrides:C,isDatabaseAgent:I,enableUpdatePageTreeDiff:e,enableSetupModeTool:t}),useCustomAgentDraft:!0}}),[u,C,I]),{nextConfig:B,setNextConfig:E}=(0,x().I)({threadStore:void 0,spaceId:null==S?void 0:S.id,defaultConfig:A}),U=(0,n.useMemo)((()=>S?{table:f().C0,id:u.id,spaceId:S.id}:void 0),[u,S]),L=(0,n.useCallback)((e=>{if(!S)return;const t=b().bX.state;if(!t||!t.userStore)return;const o=(0,b().Kf)({environment:M,spaceStore:S,userStore:t.userStore,value:(0,m().x9d)(e)}),n=(0,b().Xd)({environment:M,inferenceContext:t,addSteps:[o],surface:"workflows",config:B}),r=(0,T().addTranscriptToNewThreadAndRun)({environment:M,spaceStore:S,transcript:n,workflowId:u.id,createdSource:"workflows",parentPointer:U});c({newThreadStore:r})}),[S,M,B,u,U,c]);return(0,_.jsx)("div",{style:j.container,children:(0,_.jsxs)("div",{style:j.emptyStateWrapper,children:[(0,_.jsx)(D().AgentIcon,{agentIcon:h,workflowStore:u,size:48,animated:!0}),(0,_.jsx)("div",{style:j.agentName,children:t}),o?(0,_.jsx)("div",{style:j.agentDescription,children:o}):void 0,(0,_.jsx)("div",{style:j.inputWrapper,children:(0,_.jsx)(k().n_,{aiChatFeatureController:p,clientStore:g,onThreadChange:c,nextConfig:B,setNextConfig:E,parentPointer:U,threadStore:void 0,disabled:!1})}),d&&d.length>0?(0,_.jsx)(P().k,{starters:d,onStarterClick:L,disabled:!1}):void 0]})})}function R(e){const{onThreadChange:t,...o}=e,r=(0,n.useRef)(null),i=(0,n.useRef)(!0),{clientStore:a,spaceStore:s,threadId:d}=o,c=!d||d===I().NEW_CHAT_THREAD_ID,{transcript:u}=(0,M().j)({clientStore:a,spaceStore:s,chatPanelState:{isOpen:!0,isNewThread:c,threadId:c?I().NEW_CHAT_THREAD_ID:d}}),g=(0,n.useCallback)((()=>{if(r.current){const{scrollTop:e,scrollHeight:t,clientHeight:o}=r.current;i.current=Math.abs(t-o-e)<50}}),[]);(0,n.useEffect)((()=>{i.current&&r.current&&requestAnimationFrame((()=>{r.current&&i.current&&(r.current.scrollTop=r.current.scrollHeight)}))}),[u]);const p=(0,n.useCallback)((()=>{g()}),[g]);(0,n.useEffect)((()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)}),[]);const f=(0,l().IS)((()=>({chatWrapper:{height:"100%",width:"100%",padding:"24px 32px",overflow:"auto",boxSizing:"border-box",display:"flex"}})),[]);return(0,_.jsx)("div",{ref:r,style:f.chatWrapper,onScroll:p,children:(0,_.jsx)(K,{...o,onThreadChange:t})})}function K(e){const{clientStore:t,spaceStore:o,threadId:r,onThreadChange:i}=e,a=!r||r===I().NEW_CHAT_THREAD_ID,{state:l,threadStore:d,transcript:c}=(0,M().j)({clientStore:t,spaceStore:o,chatPanelState:{isOpen:!0,isNewThread:a,threadId:a?I().NEW_CHAT_THREAD_ID:r}});(0,n.useEffect)((()=>{i({newThreadStore:d})}),[d,i]);const u=(0,s().K8)((()=>null==d?void 0:d.getCurrentInferenceId()),[d]);return(0,n.useEffect)((()=>{d&&i({newThreadStore:d})}),[u,d,i]),c?(0,_.jsx)(k().NV,{aiChatFeature:"custom_agent_preview",threadStore:d,transcript:c,onThreadChange:i,clientStore:t,parentStore:o,threadStoreState:l,hideThreadPicker:!0,hideActions:!0}):null}},134747:(e,t,o)=>{o.d(t,{_:()=>H});o(814603),o(147566),o(198721);var n=o(296540),r=()=>o(692031),i=()=>o(212497),a=()=>o(242422),s=()=>o(726637),l=()=>o(312788),d=()=>o(484714),c=()=>o(590526),u=()=>o(401497),g=()=>o(792057),p=()=>o(245720),f=()=>o(807449),m=()=>o(546926),w=()=>o(890492),v=()=>o(81068),h=()=>o(663639),y=()=>o(736847),k=()=>o(26440),x=()=>o(764781),S=()=>o(742852),b=()=>o(735790),M=()=>o(877788),j=()=>o(523773),C=()=>o(236262),I=()=>o(496703),A=()=>o(69708),T=()=>o(100622),D=()=>o(575143),P=()=>o(35392),_=()=>o(418054),B=()=>o(687879),E=()=>o(222800),U=()=>o(207214),L=()=>o(483257),N=()=>o(609679),R=()=>o(730240),K=()=>o(302501),z=()=>o(424400),V=()=>o(764880),W=()=>o(869190),F=o(474848);function O(e){const{store:t}=e,o=(0,A().tz)(),n=(0,c().K8)((()=>t.canRead()),[t]),r=(0,c().K8)((()=>t.getLastEditedByPointer()),[t]),i=(0,c().K8)((()=>t.getLastEditedTime()),[t]),a=(0,c().K8)((()=>r?(0,R().vt)({parentStore:t,pointer:r}):void 0),[t,r]),s=(0,c().K8)((()=>i?(0,W().jE)(i,N().locale,o):""),[i,o]),l=(0,c().K8)((()=>null!=a&&a.asActor?(0,V().lR)(o,a):void 0),[a,o]),d=(0,u().IS)((()=>({menuItem:{paddingBlock:8,paddingInline:12},authorName:{marginBottom:4},lastEditedTime:{marginBottom:0}})),[]);return n&&l&&s?(0,F.jsx)(y().A,{topBorder:!0,children:(0,F.jsx)(z().Ay,{shouldWrapTitle:!0,title:(0,F.jsxs)("div",{children:[(0,F.jsx)(K().A,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:d.authorName,children:(0,F.jsx)(A().sA,{id:"workflowMetadataMenuItem.lastEditedBy",defaultMessage:"Last edited by {author}",values:{author:l}})}),(0,F.jsx)(K().A,{isSmall:!0,isSecondaryColor:!0,style:d.lastEditedTime,children:s})]}),style:d.menuItem})}):null}function H(e){const{navigate:t}=(0,n.useContext)(l().E),{workflowStore:o,context:N,onShowVersionHistory:R,dismiss:K}=e,z=(0,d().v3)(),V=(0,A().tz)(),W=(0,U().L)(z),H=(null==W?void 0:W.id)===o.id,q=(0,u().IS)((()=>({keyboardShortcut:{color:T().Tj.text.tertiary,fontSize:12,whiteSpace:"nowrap"}})),[]),Y=(0,c().K8)((()=>o.getName()),[o]),$=(0,L().U)().includes(o.id),G=(0,c().K8)((()=>o.canEdit()),[o]),{canCreate:X}=(0,E().V)(),Q=(0,c().K8)((()=>a().default.getConfig({configName:"custom_agent_sub_features"}).duplicate_agents),[]),Z=(0,n.useCallback)((async()=>{const e=(0,I().L)({workflowId:o.id,params:{}}),t=new URL(e,window.location.origin).href,[n,a]=await Promise.all([(0,r().r)(),(0,i().jd)()]);await a({environment:z,stringValue:t,copiedMessage:n.copiedLinkToClipboard})}),[z,o.id]),J=(0,n.useCallback)((()=>{_().addSidebarWorkflow({environment:z,workflowId:o.id})}),[z,o.id]),ee=(0,n.useCallback)((()=>{_().removeSidebarWorkflow({environment:z,workflowId:o.id})}),[z,o.id]),te=(0,n.useCallback)((async()=>{try{const e=o.getSpaceStore();if(!e)return;const{workflowStore:n,onComplete:r}=await(0,B().duplicateWorkflow)({environment:z,workflowPointer:o.pointer,spaceStore:e});t({environment:z,url:(0,I().L)({workflowId:n.id,params:{workflowViewType:"settings"}})}),r.catch((()=>{g().f1(V.formatMessage({defaultMessage:"Failed to duplicate agent. Please try again.",id:"workflows.agentTopbar.duplicateError"}))}))}catch(e){g().f1(V.formatMessage({defaultMessage:"Failed to duplicate agent. Please try again.",id:"workflows.agentTopbar.duplicateError"}))}}),[z,o,t,V]),oe=(0,n.useCallback)((async()=>{const{accept:e}=await g().Gh({message:V.formatMessage({defaultMessage:"Are you sure you want to delete {agentName, select, undefined {this agent} other {{agentName}}}?",id:"workflows.agentTopbar.deleteConfirmMessage"},{agentName:Boolean(null==Y?void 0:Y.trim())?Y:void 0}),acceptLabel:V.formatMessage({defaultMessage:"Delete",id:"workflows.agentTopbar.deleteAcceptLabel"})});if(e)try{await(0,B().softDeleteWorkflow)({environment:z,workflowStore:o}),H&&t({environment:z,url:"/ai",skipWorkflowCheck:!0})}catch(n){g().f1(V.formatMessage({defaultMessage:"Failed to delete agent. Please try again.",id:"workflows.agentTopbar.deleteError"}))}}),[V,z,o,H,Y,t]),ne=(0,n.useCallback)((()=>{t({environment:z,url:(0,I().L)({workflowId:o.id,params:{workflowViewType:"agent"}})})}),[z,o,t]),re=[{key:0,render:e=>(0,F.jsx)(y().A,{...e,topBorder:!1}),items:(0,c().K8)((()=>{const e={key:"copy-link-electron",render:e=>(0,F.jsx)(v().A,{icon:(0,F.jsx)(f().I,{icon:S().linkIcon}),title:(0,F.jsx)(A().sA,{defaultMessage:"Copy link",id:"workflows.agentTopbar.copyLink"}),right:s().A.isMobile?void 0:(0,F.jsx)(P().A,{name:"copyLinkToCurrentPage",onlyShowFirst:!0,style:q.keyboardShortcut}),...e}),action:Z},t={key:"copy-link-web",render:e=>(0,F.jsx)(v().A,{icon:(0,F.jsx)(f().I,{icon:S().linkIcon}),title:(0,F.jsx)(A().sA,{defaultMessage:"Copy link",id:"workflows.agentTopbar.copyLink"}),right:s().A.isMobile?void 0:(0,F.jsx)(P().A,{name:"copyCurrentPageLinkifiedBlockTitle",onlyShowFirst:!0,style:q.keyboardShortcut}),...e}),action:Z},o={key:"remove-favorite",render:e=>(0,F.jsx)(v().A,{icon:(0,F.jsx)(f().I,{icon:j().d}),title:(0,F.jsx)(A().sA,{defaultMessage:"Remove from favorites",id:"sidebar.agents.removeFromFavorites"}),...e}),action:ee},n={key:"favorite",render:e=>(0,F.jsx)(v().A,{icon:(0,F.jsx)(f().I,{icon:$?j().d:M().w}),title:$?V.formatMessage({id:"agents.AgentSidebarItem.unstar",defaultMessage:"Remove from favorites"}):V.formatMessage({id:"agents.AgentSidebarItem.star",defaultMessage:"Add to favorites"}),...e}),action:()=>{$?ee():J()}},r={key:"view-settings",render:e=>(0,F.jsx)(v().A,{icon:(0,F.jsx)(f().I,{icon:b().M}),title:(0,F.jsx)(A().sA,{defaultMessage:"View settings",id:"sidebar.agents.viewSettings"}),...e}),action:ne},i={key:"version-history",render:e=>(0,F.jsx)(v().A,{icon:(0,F.jsx)(f().I,{icon:k().w}),title:(0,F.jsx)(A().sA,{defaultMessage:"Version history",id:"workflows.agentTopbar.versionHistory"}),...e}),action:()=>{null==R||R()}},a={key:"duplicate",render:e=>(0,F.jsx)(v().A,{icon:(0,F.jsx)(f().I,{icon:x().V}),title:(0,F.jsx)(A().sA,{defaultMessage:"Duplicate",id:"workflows.agentTopbar.duplicateAgent"}),...e}),action:te},l={key:"delete",render:e=>(0,F.jsx)(D().A,{isRed:!0,svg:e=>(0,F.jsx)(f().I,{icon:C().trashIcon,style:e}),title:(0,F.jsx)(A().sA,{defaultMessage:"Delete agent",id:"workflows.agentTopbar.deleteAgent"}),...e}),action:oe};return[...N.startsWith("sidebar")?"sidebar-draggable"===N?[o]:[n]:[],...N.startsWith("sidebar")&&G?[r]:[],...z.device.isElectron?[e]:[t],..."topbar"===N&&R&&G?[i]:[],...X&&Q?[a]:[],...G?[l]:[]]}),[Z,ee,ne,te,oe,X,Q,N,G,z.device.isElectron,R,q.keyboardShortcut,$,V,J])}],ie={menuType:s().A.isMobile?m().gu.Modal:m().gu.Popup,right:s().A.isMobile&&"sidebar-static"===N?(0,F.jsx)(A().sA,{...p().W.done}):void 0,..."topbar"===N&&{width:256}};return(0,F.jsxs)(w().A,{...ie,children:[(0,F.jsx)(h().A,{type:h().O.Vertical,onAccept:K,initialFocus:void 0,sections:re}),(0,F.jsx)(O,{store:o})]})}},137070:(e,t,o)=>{o.d(t,{t:()=>n});class n extends(()=>o(757695))().Store{constructor(e){super("AgentThreadListStore"),this.setState(e)}getInitialState(){return{status:"idle",value:void 0,refetch:()=>Promise.resolve(void 0)}}updateThreadHistory(e){this.setState(e)}async refreshThreads(){const e=this.state.refetch;await e()}}},159026:(e,t,o)=>{o.d(t,{Ay:()=>a,NJ:()=>n,d5:()=>r});o(898992),o(354520),o(581454),o(737550);let n=function(e){return e.unselected="unselected",e.workspace_member="workspace_member",e.request_workspace_member="request_workspace_member",e.page_guest="page_guest",e.closed="closed",e}({}),r=function(e){return e[e.closed=0]="closed",e[e.share_page=1]="share_page",e[e.share_workspace=2]="share_workspace",e[e.request_workspace=3]="request_workspace",e}({});class i extends(()=>o(757695))().Store{getInitialState(){return{inviteStage:r.closed,selection:n.workspace_member,order:[n.workspace_member,n.page_guest],invitedUsers:[],invitedEmailToUserIdMap:{},flowId:o(206267).JW()}}startWorkspaceInvite(){this.setState({...this.state,inviteStage:r.share_workspace,order:[n.workspace_member,n.page_guest],selection:n.workspace_member})}startRequestMembership(){this.setState({...this.state,inviteStage:r.request_workspace,order:[n.request_workspace_member,n.page_guest],selection:n.request_workspace_member})}hasGuests(){return this.state.invitedUsers.some((e=>e.isGuest))}getGuestEmails(){return this.state.invitedUsers.filter((e=>e.isGuest)).map((e=>e.email))}}const a=i},299797:(e,t,o)=>{o.d(t,{A:()=>s});o(296540);var n=()=>o(493552),r=()=>o(340498),i=()=>o(100622),a=o(474848);const s=function({icon:e,title:t,description:s,cta:l,bodyWidth:d,iconSize:c=r().Ev.lg}){const u=(0,o(401497).IS)((()=>({container:{display:"flex",flexDirection:"column",alignItems:"center",gap:16},icon:{width:c,height:c,color:i().Tj.icon.secondary},body:{display:"flex",flexDirection:"column",textAlign:"center",maxWidth:d??300,gap:8},description:{textWrap:"balance",color:i().Tj.text.secondary}})),[d,c]);return(0,a.jsxs)("div",{style:u.container,children:[e?e(u.icon):void 0,(0,a.jsxs)("div",{style:u.body,children:[(0,a.jsx)(n().D,{colorVariant:"primary",styleKey:"titleSmSemibold",children:t}),(0,a.jsx)(n().D,{styleKey:"bodyRegular",style:u.description,children:s})]}),l?(0,a.jsx)("div",{children:l}):void 0]})}},308023:(e,t,o)=>{o.d(t,{W:()=>se});o(898992),o(354520),o(581454);var n=o(296540),r=()=>o(664594),i=()=>o(920198),a=()=>o(59226),s=()=>o(242422),l=()=>o(312788),d=()=>o(484714),c=()=>o(590526),u=()=>o(401497),g=()=>o(463086),p=()=>o(744947),f=()=>o(249046),m=()=>o(98126),w=()=>o(631524),v=()=>o(804059),h=()=>o(868840),y=()=>o(234459),k=()=>o(145820),x=()=>o(706021),S=()=>o(496703),b=()=>o(69708),M=()=>o(100622),j=()=>o(496603),C=()=>o(791256),I=()=>o(712505),A=()=>o(528093),T=()=>o(704658),D=()=>o(310818),P=()=>o(406094),_=()=>o(55967),B=()=>o(299797),E=o(474848);function U({onRefreshClick:e}){const t=(0,u().IS)((()=>({container:{display:"flex",justifyContent:"center",alignItems:"flex-start",paddingBlockStart:96,height:"100%"}})),[]);return(0,E.jsx)("div",{style:t.container,children:(0,E.jsx)(B().A,{title:(0,E.jsx)(b().sA,{defaultMessage:"No activity yet",id:"workflowThreads.noThreadsYet"}),description:(0,E.jsx)(b().sA,{defaultMessage:"Activity will appear here",id:"workflowThreads.noThreadsYetDescription"}),cta:(0,E.jsx)(P().A,{iconLeading:{icon:_().w,size:"sm"},size:"lg",onClick:e,children:(0,E.jsx)(b().sA,{defaultMessage:"Refresh",id:"workflowRuns.refreshButton"})})})})}function L(){const e=(0,u().IS)((()=>({container:{display:"flex",justifyContent:"center",alignItems:"flex-start",paddingBlockStart:96,height:"100%"}})),[]);return(0,E.jsx)("div",{style:e.container,children:(0,E.jsx)(B().A,{description:"",title:"",icon:()=>(0,E.jsx)(m().A,{size:"lg"})})})}o(672577),o(737550);var N=()=>o(807449),R=()=>o(26697),K=()=>o(477336),z=()=>o(181088),V=()=>o(297173),W=()=>o(75318),F=()=>o(449242),O=()=>o(759113),H=(o(944114),()=>o(979330)),q=()=>o(184820),Y=()=>o(781317),$=()=>o(240959),G=()=>o(687879),X=()=>o(46986);function Q(e){const{spaceId:t,runId:o,runStore:r,workflowStore:i,clientStore:a,threadStore:l,waitingUntil:g}=e,p=(0,d().v3)(),f=(0,u().IS)((()=>({icon:{width:20,height:20,flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",padding:2},tooltip:{width:"max-content"},tooltipList:{padding:0,margin:0,listStyle:"none"}})),[]),w=(0,c().K8)((()=>(0,X().Ke)()),[]),[v,h]=(0,n.useState)(null),[y,k]=(0,n.useState)(!1),x=(0,c().K8)((()=>null==r?void 0:r.getStatus()),[r]),S=(0,c().K8)((()=>(0,C().Ft)({clientStore:a,threadStore:l})),[a,l]),b=(0,c().K8)((()=>{if(!l)return!1;const e=s().default.getConfig({configName:"custom_agent_sub_features"}).stuck_run_threshold_seconds??300;return"running"===x&&(0,C()._P)(l,e)}),[x,l]),M=(0,c().K8)((()=>{var e;if(!r||!r.isDefined())return;const t=r.getTriggerId(),o=null===(e=r.getData())||void 0===e?void 0:e.trigger_data;if(!t||!o)return;const n=(0,O().getSpecificWorkflowTrigger)({workflowData:i.getData(),triggerId:t}),a=(0,O().getTriggerDefinitionBySpecificTrigger)(n);return n&&a?a.icon:void 0}),[r,i]),j=(0,n.useMemo)((()=>g?(0,E.jsx)(N().I,{icon:q().$,size:"sm"}):"pending"===x?(0,E.jsx)(m().k,{size:"sm"}):b?(0,E.jsx)(N().I,{icon:V().exclamationMarkCircleFillSmallIcon,size:"sm",colorPalette:"red",colorVariant:"accentPrimary"}):"running"===x||S?(0,E.jsx)(Y().ScrollingSquiggle,{width:18,height:12}):M?(0,E.jsx)(N().I,{icon:M,size:"sm"}):(0,E.jsx)(N().I,{icon:H().n,size:"sm"})),[g,x,b,S,M]);(0,n.useEffect)((()=>{if(!(o&&x&&t&&y&&w))return;const e=async()=>{try{const e=await(0,G().getWorkflowRunQueueInfo)({environment:p,runId:o,spaceId:t});h(e)}catch(e){h(null)}};e();const n="pending"===x?setInterval((()=>{e()}),1e4):void 0;return()=>{n&&clearInterval(n)}}),[p,o,x,t,y,w]);const I=(0,n.useMemo)((()=>{if(!v)return;const e=[];if(void 0!==v.waitTimeMs&&"dead"!==v.taskState&&e.push(`Wait: ${(0,$().a)(v.waitTimeMs)}`),void 0!==v.queuePosition&&e.push(`Position: ${v.queuePosition}`),void 0!==v.totalInQueue&&"dead"!==v.taskState&&e.push(`Total: ${v.totalInQueue}`),v.queueType){let t="";switch(v.queueType){case"fairTaskQueue":t="Fair Task Queue";break;case"standardTaskQueue":t="Standard Task Queue";break;case"multiSqs":t="Multi SQS";break;case"sqs":t="SQS";break;default:t="Unknown Queue Type"}e.push(`Queue Type: ${t}`)}return v.taskState&&e.push(`State: ${v.taskState}`),v.taskId&&e.push(`Task ID: ${v.taskId}`),!v.taskId&&v.runId&&e.push("Queue: SQS"),v.status&&e.push(`Status: ${v.status}`),e.length>0?e:void 0}),[v]),A=(0,n.useCallback)((e=>(0,E.jsx)("div",{...e,style:f.icon,children:j})),[j,f.icon]),T=(0,n.useCallback)(((e,t)=>(t!==y&&k(t),A(e))),[A,y]);return w?(0,E.jsx)(R().m,{style:f.tooltip,textWrap:!0,delayThreshold:0,placement:"top",renderTooltip:e=>(0,E.jsx)("ul",{style:f.tooltipList,...e,children:null==I?void 0:I.map(((e,t)=>(0,E.jsx)("li",{children:e},t)))}),render:T}):A()}var Z=()=>o(695115),J=()=>o(833243);function ee(e){const{runStore:t,workflowStore:o,onSuccess:r}=e,i=(0,d().v3)(),a=(0,b().tz)(),[s,l]=(0,n.useState)(!1),[u,g]=(0,n.useState)(void 0),p=(0,c().K8)((()=>{var e;const n=t.getData(),r=null==n?void 0:n.paused_reason,i=o.getDraftData();return(null==i||null===(e=i.paused_reason)||void 0===e?void 0:e.reason)===r}),[t,o]),f=async e=>{e.stopPropagation(),g(void 0);const o=t.getSpaceId();if(!o)return void g("Unable to determine space");const n=await(0,G().reenqueuePausedRun)({environment:i,runId:t.id,spaceId:o});n.success?(l(!0),null==r||r(),setTimeout((()=>{l(!1)}),2e3)):g(n.error||"Failed to resume run")};return s?(0,E.jsx)(R().m,{placement:"top",renderTooltip:()=>a.formatMessage({id:"workflow.reenqueueRun.success",defaultMessage:"Run resumed successfully"}),render:e=>(0,E.jsx)(Z().A,{...e,icon:J().checkmarkCircleSmallIcon,colorPalette:"green",size:"sm",disabled:!0,ariaLabel:a.formatMessage({id:"workflow.reenqueueRun.successAriaLabel",defaultMessage:"Run successfully resumed"})})}):(0,E.jsx)(R().m,{placement:"top",renderTooltip:()=>u||(p?a.formatMessage({id:"workflow.reenqueueRun.disabledTooltip",defaultMessage:"Request an increase to resume this run"}):a.formatMessage({id:"workflow.reenqueueRun.tooltip",defaultMessage:"Resume this run"})),render:e=>(0,E.jsx)(Z().A,{...e,icon:K().l,colorPalette:u?"red":"gray",size:"sm",onClick:f,disabled:p,ariaLabel:a.formatMessage({id:"workflow.reenqueueRun.ariaLabel",defaultMessage:"Resume paused run"})})})}function te(e){const t=Date.now()-e,o=Math.floor(t/1e3),n=Math.floor(o/60),r=Math.floor(n/60),i=Math.floor(r/24);return i>0?`${i}d`:r>0?`${r}h`:n>0?`${n}m`:"now"}function oe(e){const{thread:t,workflowStore:o,runStore:n}=e,r=(0,b().tz)(),i=(0,u().IS)((()=>({container:{display:"flex",alignItems:"center",gap:8,minWidth:0},primary:{flexGrow:1,flexShrink:2,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},secondary:{color:M().Tj.text.secondary,flexGrow:0,flexShrink:0,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}})),[]),a=(0,c().K8)((()=>{var e;if(!n||!n.isDefined())return;const t=n.getTriggerId(),r=null===(e=n.getData())||void 0===e?void 0:e.trigger_data;if(!t||!r)return;let i;try{i=JSON.parse(r)}catch{return}const a=i,s=(0,O().getSpecificWorkflowTrigger)({workflowData:o.getData(),triggerId:t}),l=(0,O().getTriggerDefinitionBySpecificTrigger)(s);return s&&l?{trigger:s,triggerData:a,triggerDefinition:l,moduleId:s.moduleId??"notion",workflowDefinitionPointer:o.pointer}:void 0}),[n,o]);return a?(0,E.jsx)(a.triggerDefinition.TriggerOrRunTitle,{trigger:a.trigger,data:a.triggerData,moduleId:a.moduleId,workflowDefinitionPointer:a.workflowDefinitionPointer,titleContext:"run"}):!t.trigger_id&&t.created_by_display_name?(0,E.jsxs)("span",{style:i.container,children:[(0,E.jsx)("span",{style:i.primary,children:t.title||r.formatMessage({id:"workflowThreads.untitledChat",defaultMessage:"Untitled chat"})}),(0,E.jsx)("span",{style:i.secondary,children:t.created_by_display_name})]}):(0,E.jsx)("span",{children:t.title||r.formatMessage({id:"workflowThreads.untitledChat",defaultMessage:"Untitled chat"})})}function ne(e){const{waitingUntil:t,threadStore:o,runStore:n,workflowStore:r}=e,i=(0,b().tz)(),a=(0,c().K8)((()=>null==o?void 0:o.getCreatedTime()),[o]),s=(0,c().K8)((()=>null==n?void 0:n.getStatus()),[n]),l=(0,u().IS)((()=>({statusContainer:{display:"flex",alignItems:"center",gap:4,fontSize:12,lineHeight:"16px",flexShrink:0,whiteSpace:"nowrap",color:M().Tj.text.tertiary}})),[]),d=(0,c().K8)((()=>{var e;return null==n||null===(e=n.getData())||void 0===e?void 0:e.paused_reason}),[n]),g=(0,c().K8)((()=>!!n&&(0,F().QF)({runStatus:s,runPausedReason:d})),[n,s,d]),p=(0,c().K8)((()=>{const e=null==o?void 0:o.getTranscript();if(!e)return!1;return e.some((e=>"agent-tool-result"===e.type&&("confirmation:requested"===e.state||"requested"===e.userConfirmation)))}),[o]),f=(0,c().K8)((()=>{const e=null==o?void 0:o.getTranscript();if(!e)return!1;const t=e.find((e=>"agent-route-trigger"===e.type));return!1===(null==t?void 0:t.passed)}),[o]);return t?(0,E.jsxs)("div",{style:l.statusContainer,children:[(0,E.jsx)(R().m,{delayThreshold:0,placement:"top",renderTooltip:()=>i.formatMessage({id:"workflow.waiting.tooltip",defaultMessage:"This run is waiting before it can resume. Waiting until {time}."},{time:new Date(t).toLocaleTimeString()}),render:e=>(0,E.jsx)("div",{...e,children:i.formatMessage({id:"workflow.waiting.badge",defaultMessage:"Waiting"})})}),a?te(a):void 0]}):p||"paused"===s&&"needsReview"===d?(0,E.jsxs)("div",{style:{...l.statusContainer,color:M().Tj.orange.text.accentPrimary},children:[(0,E.jsx)(N().I,{icon:z().clockSmallIcon,size:"sm"}),(0,E.jsx)("span",{children:(0,F().R6)("needsReview",i)}),a?te(a):void 0]}):"paused"===s&&d?(0,E.jsxs)("div",{style:l.statusContainer,children:[g&&n?(0,E.jsx)(ee,{runStore:n,workflowStore:r}):void 0,(0,E.jsx)(R().m,{delayThreshold:0,placement:"top",renderTooltip:()=>(0,F().of)(d,i),render:e=>(0,E.jsx)("span",{...e,children:(0,F().R6)(d,i)})}),a?te(a):void 0]}):"failure"===s?(0,E.jsxs)("div",{style:{...l.statusContainer,color:M().Tj.red.text.accentPrimary},children:[(0,E.jsx)(N().I,{icon:V().exclamationMarkCircleFillSmallIcon,size:"sm"}),(0,E.jsx)("span",{children:i.formatMessage({id:"workflowThreads.status.failed",defaultMessage:"Failed"})}),a?te(a):void 0]}):"insufficientPermissions"===s?(0,E.jsxs)("div",{style:{...l.statusContainer,color:M().Tj.red.text.accentPrimary},children:[(0,E.jsx)(N().I,{icon:V().exclamationMarkCircleFillSmallIcon,colorPalette:"red",size:"sm"}),(0,E.jsx)("span",{children:i.formatMessage({id:"workflowThreads.status.insufficientPermissions",defaultMessage:"Blocked"})}),a?te(a):void 0]}):"retryableFailure"===s?(0,E.jsxs)("div",{style:{...l.statusContainer,color:M().Tj.orange.text.accentPrimary},children:[(0,E.jsx)(N().I,{icon:K().l,size:"sm"}),(0,E.jsx)("span",{children:i.formatMessage({id:"workflowThreads.status.retrying",defaultMessage:"Retrying"})}),a?te(a):void 0]}):f?(0,E.jsxs)("div",{style:l.statusContainer,children:[(0,E.jsx)(N().I,{icon:W().j,size:"sm"}),(0,E.jsx)("span",{children:i.formatMessage({id:"workflowThreads.status.skipped",defaultMessage:"Skipped"})}),a?te(a):void 0]}):(0,E.jsx)("div",{style:l.statusContainer,children:a?te(a):void 0})}function re(e){const{workflowStore:t,clientStore:o,thread:r,isClickable:a=!1,isHighlighted:s=!1,onThreadClick:l}=e,[d,f]=(0,n.useState)(!1),m=(0,c().K8)((()=>t.getSpaceId()),[t]),v=(0,c().K8)((()=>{const e=t.getSpaceId();if(r.run_id&&e)return p().t.createChildStore(t,{table:k().QR,id:r.run_id,spaceId:e})}),[r.run_id,t]),h=(0,c().K8)((()=>{if(!v)return;const e=v.getDequeueAfter();return"pending"===v.getStatus()&&e&&e>Date.now()?e:void 0}),[v]),x=(0,i().L)(),S=(0,c().K8)((()=>{if(x&&r.id)return g().E.createChildStore(x,{table:y().To,id:r.id,spaceId:x.id})}),[x,r.id]),b=(0,u().IS)((()=>({threadItem:{width:"100%",position:"relative",borderRadius:6,paddingInline:12,height:36,display:"flex",alignItems:"center",gap:6,cursor:"pointer",background:s?M().Tj.background.tertiaryTranslucent:d?M().Tj.background.secondaryTranslucent:"transparent"},messageSection:{flex:1,minWidth:0,display:"flex",alignItems:"center",gap:6,paddingInlineEnd:6},primaryMessage:{fontSize:14,lineHeight:"20px",color:M().Tj.text.primary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:"0 1 auto"}})),[d,s]),j=(0,n.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),a&&l&&l()}),[a,l]);return(0,E.jsxs)(w().p,{style:b.threadItem,onClick:j,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:[(0,E.jsx)(Q,{spaceId:m,runId:r.run_id,runStore:v,workflowStore:t,clientStore:o,threadStore:S,waitingUntil:h}),(0,E.jsx)("div",{style:b.messageSection,children:(0,E.jsx)("span",{style:b.primaryMessage,children:(0,E.jsx)(oe,{thread:r,workflowStore:t,runStore:v})})}),(0,E.jsx)(ne,{waitingUntil:h,threadStore:S,runStore:v,workflowStore:t})]})}var ie=()=>o(724833),ae=()=>o(463620);function se(e){const{workflowStore:t,clientStore:o,workflowViewType:r,activityFilter:i,activeThreadId:x}=e,{navigate:A}=(0,n.useContext)(l().E),T=(0,d().v3)(),P=(0,b().tz)(),_=(0,a().X)("custom_agent_flippy_layout"),B=(0,u().IS)((()=>({threadList:{display:"flex",flexDirection:"column"},moreButtonContent:{display:"flex",alignItems:"center",gap:6,paddingInlineStart:6},moreButton:{color:M().Tj.text.secondary,fontSize:14,paddingInline:12,paddingBlock:8,width:"100%",height:36}})),[]),N=(0,D().Sn)(),R=(0,c().O$)(N),{status:K="idle",value:z,loadMore:V,hasMore:W,isLoadingMore:F}=R??{status:"idle",value:void 0,loadMore:void 0,hasMore:!1,isLoadingMore:!1},[O,H]=(0,n.useState)(void 0),q=n.useMemo((()=>i?"trigger"===i.type?`trigger:${i.triggerId}`:i.type:"all"),[i]),Y=n.useRef(void 0);(0,n.useEffect)((()=>{if(Y.current!==q)return H(void 0),void(Y.current=q);"resolved"===K&&z&&H((e=>Y.current!==q?(0,j().hS)([...z],"id"):(0,j().hS)([...z,...e??[]],"id")))}),[z,H,K,q]);const $=(0,n.useCallback)((()=>{null==N||N.refreshThreads()}),[N]),G=(0,n.useCallback)((e=>{if(_&&"activity"===r){const o=(0,S().Y)({workflowId:t.id,workflowViewType:"activity",peekModeParam:(0,I().getUrlParamFromPeekMode)(h().A),threadId:e});return void A({environment:T,url:o,redirect:!1})}const o=(0,S().L)({workflowId:t.id,params:{agentChatThreadId:e,workflowViewType:r}});A({environment:T,url:o,redirect:!1})}),[t.id,_,T,r,A]),X=(0,c().K8)((()=>{var e;const o=null===(e=t.getDraftData())||void 0===e?void 0:e.paused_reason;return Boolean(null==o?void 0:o.reason)}),[t]),[Q,Z]=(0,n.useState)(!1),J=(0,n.useCallback)((()=>{Z(!0)}),[]),ee=(0,c().K8)((()=>s().default.getConfig({configName:"custom_agent_sub_features"}).stuck_run_threshold_seconds),[]),te=(0,c().K8)((()=>{if(O){if("trigger"===(null==i?void 0:i.type))return O.filter((e=>e.trigger_id===i.triggerId));if("chat"===(null==i?void 0:i.type))return O.filter((e=>!e.trigger_id));if("failed"===(null==i?void 0:i.type)){const e=t.getSpaceId();return O.filter((o=>{if(o.run_id&&e){const n=p().t.createChildStore(t,{table:k().QR,id:o.run_id,spaceId:e}).getStatus();if("failure"===n)return!0;if("running"===n){const n=g().E.createChildStore(t,{table:y().To,id:o.id,spaceId:e});if((0,C()._P)(n,ee))return!0}return!1}return!1}))}if("success"===(null==i?void 0:i.type)){const e=t.getSpaceId();return O.filter((o=>{if(!o.run_id)return!0;if(o.run_id&&e){return"success"===p().t.createChildStore(t,{table:k().QR,id:o.run_id,spaceId:e}).getStatus()}return!0}))}if("paused"===(null==i?void 0:i.type)){const e=t.getSpaceId();return O.filter((o=>{if(o.run_id&&e){return"paused"===p().t.createChildStore(t,{table:k().QR,id:o.run_id,spaceId:e}).getStatus()}return!1}))}return O}}),[O,i,t,ee]),oe="pending"===K&&(void 0===O||0===O.length);return void 0===te||oe?(0,E.jsx)(L,{}):"rejected"===K||0===te.length?(0,E.jsx)(U,{onRefreshClick:$}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(f().wt,{gap:16,children:[(0,E.jsx)(le,{}),X?(0,E.jsx)(ae().u,{workflowStore:t,onRequestIncrease:J}):void 0,(0,E.jsxs)("div",{style:B.threadList,children:[te.map((e=>(0,E.jsx)(re,{workflowStore:t,clientStore:o,thread:e,isClickable:!0,isHighlighted:e.id===x,onThreadClick:()=>G(e.id)},e.id))),W?(0,E.jsx)(w().p,{colorPalette:"gray",onClick:()=>V&&V(),disabled:F,style:B.moreButton,iconLeading:{icon:v().ellipsisFillIcon,size:"xs",style:{marginInlineStart:2}},children:F?(0,E.jsx)(m().A,{}):(0,E.jsx)("span",{style:B.moreButtonContent,children:P.formatMessage({id:"agentActivity.loadMore",defaultMessage:"More"})})}):null]})]}),Q?(0,E.jsx)(ie().h,{workflowStore:t,isOpen:Q,onClose:()=>Z(!1)}):void 0]})}function le(){const e=(0,r().T)(),t=(0,i().L)(),o=(0,A()._)({name:"custom_agents",spaceId:null==t?void 0:t.id,userId:e}),n=(0,u().IS)((()=>({container:{border:`1.5px solid ${M().Tj.border.secondary}`,borderRadius:8,padding:14}})),[]);return!o||(0,x().e2)(o)?null:(0,E.jsx)("div",{style:n.container,children:(0,E.jsx)(T().UpgradeButton,{display:"text",source:"custom_agent",upsell:o.upsell,spaceStore:t,customMessages:{eligible_to_purchase:{id:"upgrade.eligible_to_purchase",defaultMessage:"<highlight>Upgrade</highlight> to {productName} to resume runs for this agent"},eligible_for_trial:{id:"upgrade.eligible_for_trial",defaultMessage:"<highlight>Upgrade</highlight> to {productName} to resume runs for this agent"},eligible_to_request:{id:"upgrade.eligible_to_request",defaultMessage:"<highlight>Request upgrade</highlight> to resume runs for this agent"},request_pending:{id:"upgrade.request_pending",defaultMessage:"<highlight>Upgrade requested</highlight>"}}})})}},311247:(e,t,o)=>{o.d(t,{H:()=>g});var n=()=>o(664594),r=()=>o(920198),i=()=>o(484714),a=()=>o(590526),s=()=>o(295633),l=()=>o(732810),d=()=>o(350013),c=()=>o(534177),u=()=>o(939622);function g(e){const t=(0,i().v3)(),o=(0,n().T)(),g=(0,r().L)();return(0,a().K8)((()=>{if(null!=g&&g.canAdmin()&&(0,u().z)(t,{name:"configurable_deletion_and_retention_settings",spaceId:null==g?void 0:g.id,userId:o}))return!0;if(e instanceof l().m){if(!e.canEditCollection())return!1;const t=e.getParentStore();return!!t&&t.canEdit()}if(e instanceof s().B){if(!e.canEdit())return!1;if(!e.isNavigableBlock())return!1;const t=e.getParentStore();return!t||!(e.isTemplate()&&t instanceof l().m&&!t.canEditCollection())&&t.canEdit()}if(e instanceof d().N)return e.canEdit();(0,c().HB)(e)}),[g,t,e,o])}},353755:(e,t,o)=>{o.d(t,{j:()=>u});var n=o(296540),r=()=>o(106702),i=()=>o(484714),a=()=>o(590526),s=()=>o(791256),l=()=>o(965454),d=()=>o(770160),c=()=>o(680514);function u({clientStore:e,chatPanelState:t,spaceStore:o}){const{threadStore:u,isNewThread:g}=function({clientStore:e,chatPanelState:t,spaceStore:o}){const n=(0,i().v3)(),s=(0,r().$)(),u=(0,l().AD)(),g=(0,a().K8)((()=>{if(!o||!t||!s)return;const e=(0,d().getChatPanelState)(n)??t;if(!("isNewThread"in e)||!e.isNewThread){const t=(0,d().threadStoreGivenRouteData)({spaceStore:o,chatPanelState:e});return(0,c().dr)(null==t?void 0:t.id)??t}o&&u.getOrCreateThreadId({environment:n,spaceId:o.id,maybeThreadStore:void 0})}),[o,t,s,u,n]);return{threadStore:g,isNewThread:"isNewThread"in t&&t.isNewThread}}({clientStore:e,chatPanelState:t,spaceStore:o}),{steps:p,allReady:f}=(0,a().K8)((()=>u?(0,s().A3)({clientStore:e,threadStore:u}):{steps:[],allReady:!1}),[e,u]),[m,w]=(0,n.useState)(f),[v,h]=(0,n.useState)(void 0);if((v!==u||f&&!m)&&(h(u),w(f)),g)return{state:"new",threadStore:u,transcript:p};return(f||m)&&u?{state:"ready",threadStore:u,transcript:p}:{state:"loading",threadStore:void 0,transcript:void 0}}},383245:(e,t,o)=>{o.r(t),o.d(t,{WorkflowModuleConfiguration:()=>d});o(16280),o(296540);var n=()=>o(401497),r=()=>o(68263),i=()=>o(563452),a=()=>o(343489),s=()=>o(423493),l=o(474848);function d(e){const{isInTranscript:t,module:o,removeModule:d,saveConfigVariable:c,saveModule:u,store:g,workflowDefinitionPointer:p,workflowModuleStore:f,workflow:m,onAuthComplete:w}=e,v=(0,a().i)({module:(0,i().yC)(o),store:g}),h=(0,r().p2)(v),y=function(e){return(0,n().IS)((()=>({container:{display:"flex",gap:2,flexDirection:"column",marginInlineStart:e?0:24,marginBlockEnd:e?8:0}})),[e])}(t),k=s().y[o.type],x=u,S=d;if(!k)throw new Error(`Module definition not found for module ${o.type}`);if(k.ModuleConfiguration){const{ModuleConfiguration:e}=k;return(0,l.jsx)("div",{style:y.container,children:(0,l.jsx)(e,{isInTranscript:t,module:o,removeModule:S,saveConfigVariable:c,saveModule:x,store:g,userHasEditAccess:h,workflowDefinitionPointer:p,workflowModuleStore:f,workflow:m,onAuthComplete:w})})}return null}},412754:(e,t,o)=>{o.d(t,{P:()=>q});var n=o(296540),r=()=>o(726637),i=()=>o(484714),a=()=>o(590526),s=()=>o(401497),l=()=>o(250910),d=()=>o(118307),c=()=>o(807449),u=()=>o(695115),g=()=>o(631524),p=()=>o(26697),f=()=>o(69708),m=()=>o(100622),w=()=>o(863059),v=()=>o(418054),h=()=>o(717137),y=()=>o(59226),k=()=>o(792057),x=()=>o(128933),S=()=>o(94484),b=()=>o(31511),M=()=>o(160432),j=()=>o(493552),C=()=>o(995847),I=()=>o(769864),A=o(474848);function T(e){const{customAgentUrl:t,feedbackSource:o,onClose:a,spaceId:l}=e,d=(0,f().tz)(),c=(0,i().v3)(),[g,p]=(0,n.useState)(""),[m,w]=(0,n.useState)(!1),v=(0,s().IS)((()=>({container:{width:274,padding:6},title:{paddingTop:4,paddingInlineStart:4},header:{display:"flex",justifyContent:"space-between",paddingBottom:6},content:{display:"flex",flexDirection:"column",gap:10,padding:4},textInput:{padding:6,borderRadius:6},submitButton:{width:"100%"}})),[]),T=(0,n.useCallback)((e=>{p(e.target.value)}),[]),D=(0,n.useCallback)((async()=>{if(g.trim()&&!m&&c.currentUser.id&&l){w(!0);try{await I().callApiOrThrow({eventName:"reportCustomAgentsFeedback",environment:c,data:{customAgentUrl:t,deviceType:c.device.deviceType,feedback:g.trim(),feedbackSource:o,notionVersion:r().A.version,spaceId:l,userId:c.currentUser.id},cellNavigation:{spaceId:l}}),x().D6({label:d.formatMessage({id:"customAgentsFeedback.submitMessage.success",defaultMessage:"Thanks for your feedback!"}),durationMs:S().LX}),a()}catch(e){k().f1((0,A.jsx)(f().sA,{id:"customAgentsFeedback.submitMessage.error",defaultMessage:"Something went wrong. Please try again."}))}finally{w(!1)}}}),[t,c,o,g,d,m,a,l]),P=d.formatMessage({id:"customAgentsFeedback.input.placeholder",defaultMessage:"What's working well and what could be better about custom agents?"});return(0,y().X)("custom_agents_general_feedback_form")?(0,A.jsx)(h().A,{debugName:"CustomAgentsFeedbackPopup",capture:!0,allowEsc:!0,children:(0,A.jsxs)("div",{style:v.container,children:[(0,A.jsxs)("div",{style:v.header,children:[(0,A.jsx)("div",{style:v.title,children:(0,A.jsx)(j().D,{styleKey:"captionMedium",colorVariant:"primary",children:(0,A.jsx)(f().sA,{id:"customAgentsFeedback.title",defaultMessage:"Custom agents feedback"})})}),(0,A.jsx)(u().A,{icon:C().xMarkSmallIcon,onClick:a,ariaLabel:d.formatMessage({id:"customAgentsFeedback.closeButton.ariaLabel",defaultMessage:"Close feedback popup"})})]}),(0,A.jsxs)("div",{style:v.content,children:[(0,A.jsx)(b().A,{placeholder:P,value:g,onChange:T,textarea:!0,maxlength:2e3,style:v.textInput,focusInitial:!0,autosize:!0,autosizeMinHeight:112,autosizeMaxHeight:112}),(0,A.jsx)(M().A,{colorPalette:"blue",onClick:D,style:v.submitButton,disabled:m||!g.trim(),isLoading:m,children:(0,A.jsx)(f().sA,{id:"customAgentsFeedback.submitButton",defaultMessage:"Submit"})})]})]})}):null}var D=()=>o(383036),P=()=>o(929219),_=()=>o(882722),B=()=>o(864896),E=()=>o(35392),U=()=>o(978578),L=()=>o(321172),N=()=>o(623275),R=()=>o(437487);const K=(0,f().YK)({share:{defaultMessage:"Share",id:"topbar.share"}});function z({store:e,buttonPopupStore:t}){const d=(0,i().v3)(),c=(0,a().K8)((()=>d.device.isTablet),[d]),u=(0,a().uB)(void 0,o(103674).A),g=(0,a().uB)(void 0,o(114871).Ay),p=(0,a().uB)(void 0,o(454354).A),f=(0,a().K8)((()=>e.canAdmin()),[e]),w=(0,a().O$)(o(907258).AppStoreSidebarSpaceStore),v=(0,a().K8)((()=>function(e,t){if(t.shouldUserHaveAccessToPrivateWorkflow&&t.shouldUserHaveAccessToPrivateWorkflow()&&t.state.changePermissionsEnabled&&t.state.privateWorkflowStore&&t.state.privateWorkflowStore.id===e.id)return t.state.privateWorkflowStore;return e}(e,p)),[e,p]),h=(0,a().K8)((()=>!r().A.isMobile&&function(e,t){const{permissionsInviteStore:o}=e.state;return o.state.inviteTargets.length>0||t.state.inviteTargets.length>0}(u,g)),[g,u]),y=(0,a().K8)((()=>t.state.open),[t]),k=(0,a().K8)((()=>e.isDefined()&&e.canRead()),[e]);(0,n.useEffect)((()=>{y&&!k&&(F({buttonPopupStore:t,universalMemberInviteStore:u,inviteTargetsStore:g}),L().XP({environment:d,store:e}))}),[y,k,t,u,g,d,e]),(0,n.useEffect)((()=>{R().Ay.setState({...R().Ay.state,isInitialized:!0})})),(0,n.useEffect)((()=>{f||o(904671).YL({environment:d,sudoModeStore:p,workflowId:e.id,sidebarSpaceStore:w})}),[f,d,e,p,w]);const x=(0,n.useCallback)((()=>{t.reset()}),[t]),S=(0,n.useCallback)((()=>{F({buttonPopupStore:t,universalMemberInviteStore:u,inviteTargetsStore:g}),(0,o(440024).I)({environment:d}),L().Tk({environment:d,store:v}),o(224701).x(d)}),[t,u,g,d,v]),b=(0,n.useCallback)((e=>(0,A.jsx)(V,{buttonPopupEvents:e})),[]),M=(0,n.useCallback)((async()=>{if(g.state.inviteTargets.length>0){return void(await L().T({environment:d,inviteTargetsStore:g})&&(L().XP({environment:d,store:e}),F({buttonPopupStore:t,universalMemberInviteStore:u,inviteTargetsStore:g})))}const{permissionsInviteStore:n}=u.state;"invitee"===n.state.inputFocus&&n.setState({...n.state,inputFocus:"none"});await(0,o(743260).iQ)({environment:d,permissionsInviteStoreState:n.state,from:"share_menu",spaceStore:w})||(L().XP({environment:d,store:e}),F({buttonPopupStore:t,universalMemberInviteStore:u,inviteTargetsStore:g}))}),[t,w,d,g,u,e]),j=(0,s().eP)(),C=(0,s().IS)((()=>({buttonPopup:{...r().A.isMobile?{width:"100%"}:c?{width:460}:{width:N().$D,overflow:"hidden",borderRadius:N().Sg,boxShadow:m().Tj.shadowMD,..."dark"===j&&{border:`1px solid ${m().Tj.border.primaryTranslucent}`}}}})),[c,j]);return(0,A.jsx)(l().A,{popupType:r().A.isMobile?l().z.BottomSheet:l().z.Popup,forceInitialInbound:!0,alignmentToOrigin:"end",buttonPopupStore:t,renderOrigin:b,originGap:r().A.isMobile?void 0:8,style:C.buttonPopup,onClick:S,render:()=>(0,A.jsx)(o(482707).k,{buttonPopupStore:t,sudoModeStore:p,store:v,inviteTargetsStore:g,universalMemberInviteStore:u,onUpgradeButtonClick:x,location:r().A.isMobile?"topbar_mobile":"topbar_share_button",onClose:M}),persistOnClose:h,onDismiss:M,onClose:M})}function V({buttonPopupEvents:e}){const t=!(0,a().O$)(P().e),o=(0,s().IS)((()=>({shortcut:{color:m().Tj.text.inverseSecondary}})),[]),i=(0,n.useCallback)((()=>t?(0,A.jsx)(f().sA,{defaultMessage:"Unavailable while offline",id:"topbar.shareButton.offlineTooltip"}):(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("div",{children:(0,A.jsx)(f().sA,{defaultMessage:"Share custom agent",id:"workflows.topbar.shareButton.tooltip"})}),(0,A.jsx)(E().A,{style:o.shortcut,name:"openShareMenu"})]})),[t,o.shortcut]);return(0,A.jsx)(p().m,{disableTooltip:r().A.isMobile,renderTooltip:i,placement:"bottom",delayThreshold:400,render:o=>(0,A.jsx)(W,{events:(0,D().A)(o,e),disabled:t})})}function W({events:e,disabled:t}){const o=(0,f().tz)(),n=(0,s().IS)((()=>{const e=(0,U().aD)();return{mobileIconStyle:e.iconStyle,shareButton:{...r().A.isMobile?e.iconContainer:{},marginInlineEnd:2}}}),[]);const i=r().A.isMobile?(0,A.jsx)(c().I,{icon:B().Y,style:n.mobileIconStyle}):(0,A.jsx)(f().sA,{defaultMessage:"Share",id:"topbar.shareButton.title"});return(0,A.jsx)(g().p,{id:void 0,className:_().voG,...e,style:n.shareButton,"aria-label":o.formatMessage(K.share),disabled:t,disabledFeedback:t,children:i})}function F({buttonPopupStore:e,universalMemberInviteStore:t,inviteTargetsStore:o}){e.reset(),t.reset(),o.reset()}const O=n.memo(z);const H=(0,f().YK)({favoriteAriaLabel:{id:"workflows.agentTopbar.favoriteAriaLabel",defaultMessage:"Favorite"},favoritedAriaLabel:{id:"workflows.agentTopbar.favoritedAriaLabel",defaultMessage:"Favorited"},favoriteTooltip:{id:"workflows.agentTopbar.favoriteTooltip",defaultMessage:"Add to your favorites"},favoritedTooltip:{id:"workflows.agentTopbar.favoritedTooltip",defaultMessage:"Remove from your favorites"}}),q=n.memo((function(e){const{workflowStore:t,shouldShowFeedbackButton:r,flippyLayoutEnabled:l,activeSidePeek:c,onSidePeekChange:g,hasEditPermission:h,disabled:y,onShowVersionHistory:k,sudoModeStore:x}=e,S=(0,i().v3)(),b=(0,f().tz)(),M=(0,a().K8)((()=>new(d().A)),[]),j=(0,o(483257).U)(),C=(0,w().gQ)(),I=(0,a().K8)((()=>t.canRead()),[t]),T=(0,a().K8)((()=>(0,o(905470).uP)(t.getData())),[t]),D=(0,a().K8)((()=>Boolean(x.shouldUserHaveAccessToPrivateWorkflow&&x.shouldUserHaveAccessToPrivateWorkflow())),[x]),P=(0,a().K8)((()=>j.includes(t.id)),[j,t]),_=(0,s().IS)((()=>({container:{display:"flex",alignItems:"center",pointerEvents:"auto"},favoriteIcon:{...C.icon,...P?{fill:m().Tj.topbarFavorite}:void 0},favoriteButton:{...C.iconButton},flippyButtonGroup:{display:"flex",alignItems:"center",gap:4,paddingInline:8},flippyButton:{...C.iconButton},flippyIcon:{...C.icon,height:16,width:16},flippySeparator:{width:1,height:16,backgroundColor:m().Tj.border.secondary,marginInline:4}})),[C.icon,C.iconButton,P]),B=(0,n.useMemo)((()=>P?()=>v().removeSidebarWorkflow({environment:S,workflowId:t.id}):()=>v().addSidebarWorkflow({environment:S,workflowId:t.id})),[S,t.id,P]),E=(0,n.useCallback)((()=>{g("activity"===c?void 0:"activity")}),[c,g]),U=(0,n.useCallback)((()=>{g("settings"===c?void 0:"settings")}),[c,g]);return(0,A.jsxs)("div",{style:_.container,children:[r?(0,A.jsx)($,{workflowStore:t}):void 0,l?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)("div",{style:_.flippyButtonGroup,children:[h?(0,A.jsx)(u().A,{icon:o(105870).j,style:_.flippyButton,iconStyle:_.flippyIcon,hovered:"activity"===c,onClick:E,ariaLabel:b.formatMessage({defaultMessage:"Activity",id:"agentTopbar.flippy.activity.ariaLabel"})}):void 0,(0,A.jsx)(u().A,{icon:o(508700).T,style:_.flippyButton,iconStyle:_.flippyIcon,hovered:"settings"===c,onClick:U,ariaLabel:b.formatMessage({defaultMessage:"Settings",id:"agentTopbar.flippy.settings.ariaLabel"})})]}),(0,A.jsx)("div",{style:_.flippySeparator})]}):void 0,!I&&!D||y||T?void 0:(0,A.jsx)(O,{store:t,buttonPopupStore:M}),(0,A.jsx)(p().m,{placement:"bottom",originGap:S.device.isElectronWindows?10:void 0,renderTooltip:()=>(0,A.jsx)(f().sA,{...P?H.favoritedTooltip:H.favoriteTooltip}),render:e=>(0,A.jsx)(u().A,{...e,icon:P?o(773126).F:o(877788).w,style:_.favoriteButton,iconStyle:_.favoriteIcon,onClick:B,ariaLabel:b.formatMessage(P?H.favoritedAriaLabel:H.favoriteAriaLabel)})}),(0,A.jsx)(Y,{workflowStore:t,onShowVersionHistory:k})]})}));function Y(e){const{workflowStore:t,onShowVersionHistory:n}=e,u=(0,i().v3)(),g=(0,f().tz)(),v=(0,a().K8)((()=>new(d().A)),[]),h=(0,s().IS)((()=>({button:{...(0,w().Hh)().iconButton,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:6,marginInlineEnd:0},mobilePopupStyle:{borderRadius:12,backgroundColor:m().Tj.background.secondary},menuPropIcon:{color:m().Tj.icon.primary}})),[]),y=g.formatMessage({defaultMessage:"More",id:"agentTopbar.moreButton.tooltip"});return(0,A.jsx)(l().A,{popupType:r().A.isMobile?l().z.BottomSheet:l().z.Popup,alignmentToOrigin:"end",buttonPopupStore:v,renderOrigin:e=>(0,A.jsx)(p().m,{renderTooltip:()=>y,placement:"bottom",originGap:u.device.isElectronWindows?10:void 0,delayThreshold:400,render:t=>(0,A.jsx)(o(718827).Ay,{style:h.button,ariaLabel:y,...e,...t,children:(0,A.jsx)(c().I,{icon:o(589407).ellipsisIcon,size:"lg",style:{fill:h.menuPropIcon.color}})})}),render:e=>(0,A.jsx)(o(134747)._,{workflowStore:t,context:"topbar",onShowVersionHistory:n,dismiss:e.close}),originGap:u.device.isElectronWindows?12:8,forceInitialInbound:!0,style:r().A.isMobile?h.mobilePopupStyle:{width:256,maxHeight:"80vh"}})}function $({workflowStore:e}){const t=(0,o(300474).r)(),n=(0,a().K8)((()=>{if(!t)return;return`${r().A.domainBaseUrl}/agent/${(0,o(498212).Xw)(e.id)}`}),[t,e]),i=(0,s().IS)((()=>({button:{...(0,w().Hh)().iconButton,width:"auto",paddingInline:8,borderRadius:6}})),[]);return t&&n?(0,A.jsx)(l().A,{popupType:l().z.Popup,renderOrigin:e=>(0,A.jsx)(g().p,{...e,iconLeading:o(626922).e,style:i.button,children:(0,A.jsx)(f().sA,{id:"agents.topbar.feedback",defaultMessage:"Feedback"})}),render:({close:e})=>(0,A.jsx)(T,{feedbackSource:"agentPageTopbar",spaceId:t,customAgentUrl:n,onClose:e}),placementToOrigin:"bottom",alignmentToOrigin:"start",originGap:6}):null}},483257:(e,t,o)=>{o.d(t,{U:()=>i});var n=()=>o(907258),r=()=>o(590526);function i(){return(0,r().K8)((()=>{var e;const t=n().default.state.sidebarSpaceViewStore;return t?(null===(e=t.getSettings())||void 0===e?void 0:e.sidebar_workflow_ids)??[]:[]}),[])}},499790:(e,t,o)=>{o.d(t,{g:()=>h});var n=o(296540),r=()=>o(484714),i=()=>o(590526),a=()=>o(546926),s=()=>o(42466),l=()=>o(905470),d=()=>o(65474),c=()=>o(600434),u=()=>o(975445),g=()=>o(403008),p=()=>o(166442),f=()=>o(687879),m=()=>o(22673),w=()=>o(912749),v=o(474848);function h(e){const{workflowStore:t,buttonPopupParent:o}=e,h=(0,r().v3)(),y=(0,w().N)(t,!0),{threadStore:k,workflowValue:x}=y,S=(0,i().K8)((()=>t.getSpaceStore()),[t]),b=(0,u().N)({threadStore:k,spaceId:null==S?void 0:S.id}),M=(0,n.useMemo)((()=>{var e;return{type:"workflow",model:null===(e=x.model)||void 0===e?void 0:e.type,modelFromUser:void 0!==x.model}}),[x.model]),j=(0,i().uB)(void 0,p().ClientAIChatStore),C=(0,c().K7)("custom_agent"),I=(0,n.useCallback)((e=>{if(o.close(),"reset"===e||t.table===s().U6v)return;const n=e,r="workflow"===n.type&&n.model?{type:n.model}:void 0;(0,m().FY)({environment:h,model:(null==r?void 0:r.type)??"auto",workflowId:t.id,isDatabaseAgent:(0,l().uP)(x)}),f().saveModel({environment:h,workflowStore:t,threadStore:k,model:r})}),[o,h,k,t,x]),A=(0,g().w)({aiChatFeatureController:C,buttonPopupParent:o,clientStore:j,config:M,environment:h,inputMode:"ready",threadMode:"existingThread",onChangeNextConfig:I,spaceStore:S,inferenceInfo:b,isSimplifiedInputEnabled:!1});return(0,v.jsx)(d().J,{buttonPopupParent:o,extensionPopupButtonEvents:{},sections:A,menuType:a().gu.Popup})}},523773:(e,t,o)=>{o.d(t,{d:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.4 2.39 15.2 15.86",svg:(0,o(474848).jsx)("path",{d:"m4.897 3.085-.122-.142a.625.625 0 0 0-.95.814l3.18 3.71h-3.98a.625.625 0 0 0-.367 1.13L6.6 11.462l-1.506 4.636a.625.625 0 0 0 .962.699L10 13.932l3.943 2.865a.625.625 0 0 0 .903-.183l1.215 1.418a.625.625 0 1 0 .95-.814l-.495-.576a.6.6 0 0 1-.127-.113l-11.4-13.3a.6.6 0 0 1-.093-.144m.051 5.632h3.129l5.018 5.853.027.085-2.755-2.001a.625.625 0 0 0-.734 0l-2.755 2 1.052-3.237a.625.625 0 0 0-.227-.7zm8.633 2.613 3.762-2.733a.625.625 0 0 0-.367-1.13H12.1L10.594 2.83a.625.625 0 0 0-1.188 0L8.55 5.463l.953 1.112L10 5.046l1.052 3.239a.625.625 0 0 0 .595.432h3.404l-2.287 1.662z"})},r=(0,o(340498).wt)("starSlash",n,"default")},534842:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,sparklesFillSmallIcon:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.25 1.61 13.5 12.78",svg:(0,o(474848).jsx)("path",{d:"M5.201 2.236a.625.625 0 1 0-1.25 0c0 .389-.249.914-.705 1.37s-.981.705-1.37.705a.625.625 0 0 0 0 1.25c.389 0 .914.25 1.37.706s.705.98.705 1.37a.625.625 0 0 0 1.25 0c0-.39.25-.915.706-1.37s.981-.706 1.37-.706a.625.625 0 1 0 0-1.25c-.389 0-.914-.249-1.37-.705S5.2 2.625 5.2 2.236m5.495 3.42a.625.625 0 0 0-1.25 0c0 .854-.403 1.715-1.058 2.37-.656.656-1.517 1.059-2.37 1.059a.625.625 0 1 0 0 1.25c.853 0 1.714.402 2.37 1.058.655.656 1.058 1.517 1.058 2.37a.625.625 0 0 0 1.25 0c0-.853.402-1.714 1.058-2.37s1.517-1.058 2.37-1.058a.625.625 0 0 0 0-1.25c-.853 0-1.714-.403-2.37-1.058-.656-.656-1.058-1.517-1.058-2.37"})},r=(0,o(340498).wt)("sparklesFillSmall",n,"fillSmall")},628174:(e,t,o)=>{o.d(t,{v:()=>S,x:()=>b});o(898992),o(737550);var n=o(296540),r=()=>o(312788),i=()=>o(484714),a=()=>o(590526),s=()=>o(401497),l=()=>o(929219),d=()=>o(807449),c=()=>o(26697),u=()=>o(989184),g=()=>o(259476),p=()=>o(68263),f=()=>o(743246),m=()=>o(69708),w=()=>o(100622),v=()=>o(723039),h=()=>o(682539),y=()=>o(311247),k=()=>o(803532),x=o(474848);const S=44;function b(e){const{navigate:t}=(0,n.useContext)(r().E),{workflowStore:o}=e,b=(0,i().v3)(),M=(0,s().IS)((()=>({banner:{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:w().oZ.red,color:w().oZ.white,padding:"8px 16px",gap:12,minHeight:S,zIndex:3},message:{fontSize:14,fontWeight:500,color:w().oZ.white}})),[]),j=(0,a().K8)((()=>{const e=o.getPermissionItems();return(null==e?void 0:e.some(p().Ny))??!1}),[o]),C=(0,y().H)(o),I=!(0,a().O$)(l().e),A=(0,n.useCallback)((()=>{(0,k().U)({environment:b,workflowStore:o})}),[b,o]),T=(0,n.useCallback)((()=>{v().E({environment:b,stores:[o],table:f().C0,from:"trash_banner",handleSuccess:()=>{t({environment:b,url:"/ai"})}})}),[b,o,t]);return j?(0,x.jsx)("div",{style:M.banner,children:(0,x.jsx)("span",{style:M.message,children:(0,x.jsx)(m().sA,{id:"workflows.deletedAgentBanner.permanentlyDeleted",defaultMessage:"This agent was PERMANENTLY deleted."})})}):(0,x.jsxs)("div",{style:M.banner,children:[(0,x.jsx)("span",{style:M.message,children:(0,x.jsx)(m().sA,{id:"workflows.deletedAgentBanner.message",defaultMessage:"This agent has been deleted."})}),C?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(c().m,{disableTooltip:!I,placement:"bottom",renderTooltip:()=>(0,x.jsx)(m().sA,{defaultMessage:"Go online to restore this agent",id:"workflows.deletedAgentBanner.restoreButton.offlineTooltip"}),render:e=>(0,x.jsx)("div",{...e,children:(0,x.jsx)(h().A,{disabled:I,onClick:A,icon:(0,x.jsx)(d().I,{icon:u().Z,size:"xs"}),children:(0,x.jsx)(m().sA,{id:"workflows.deletedAgentBanner.restoreButton",defaultMessage:"Restore agent"})})})}),(0,x.jsx)(c().m,{disableTooltip:!I,placement:"bottom",renderTooltip:()=>(0,x.jsx)(m().sA,{defaultMessage:"Go online to delete from Trash",id:"workflows.deletedAgentBanner.deleteButton.offlineTooltip"}),render:e=>(0,x.jsx)("div",{...e,children:(0,x.jsx)(h().A,{disabled:I,onClick:T,icon:(0,x.jsx)(d().I,{icon:g().trashSmallIcon,size:"xs"}),children:(0,x.jsx)(m().sA,{defaultMessage:"Delete from Trash",id:"workflows.deletedAgentBanner.deleteButton"})})})})]}):void 0]})}},644521:(e,t,o)=>{o.d(t,{b:()=>hn});o(898992),o(354520),o(672577),o(581454);var n=o(296540),r=()=>o(920198),i=()=>o(907258),a=()=>o(59226),s=()=>o(242422),l=()=>o(484714),d=()=>o(590526),c=()=>o(401497),u=()=>o(699143),g=()=>o(718827),p=()=>o(250910),f=()=>o(118307),m=()=>o(388926),w=()=>o(807449),v=()=>o(695115),h=()=>o(631524),y=()=>o(493552),k=()=>o(287188),x=()=>o(373009),S=()=>o(26697),b=()=>o(803960),M=()=>o(101163),j=()=>o(395546),C=()=>o(863330),I=()=>o(743246),A=()=>o(42466),T=()=>o(201980),D=()=>o(905470),P=()=>o(7331);const _={botActor:{triggers:"enabled",integrations:"enabled",requireLookupTriggerActor:!1},strictMode:{triggers:"enabled",integrations:"enabled",requireLookupTriggerActor:!0},ownerActor:{triggers:"enabled",integrations:"hidden",requireLookupTriggerActor:!0},endUserActor:{triggers:"hidden",integrations:"hidden",requireLookupTriggerActor:!1}};var B=()=>o(69708),E=()=>o(100622),U=()=>o(284371),L=()=>o(652011),N=()=>o(555102),R=()=>o(716469),K=(o(16280),()=>o(966249)),z=()=>o(142918),V=()=>o(498212),W=()=>o(769864),F=()=>o(547149),O=()=>o(696706);async function H(e){const{environment:t,moduleId:o,spaceId:n,workflowId:r}=e;try{const e=await t.api.callApi({eventName:"getViaWorkflowModuleConfigurationUtil",environment:t,data:{moduleId:o,moduleType:"slack",spaceId:n,workflowId:r,callArguments:{functionName:"getSlackConnections",functionArgs:[]}}});if("success"!==e.type||"getSlackConnections"!==e.data.functionName)return;const i=[...e.data.functionReturn.personal,...e.data.functionReturn.space].filter((e=>e.authenticated));if(1!==i.length)return;const[a]=i;return O().L3.fromPointerLike({id:a.id,table:a.table,spaceId:n})}catch(i){return}}var q=()=>o(687879),Y=()=>o(22673),$=()=>o(724639);var G=()=>o(94522),X=()=>o(46986),Q=()=>o(11688),Z=()=>o(912749),J=()=>o(993002),ee=()=>o(757695);class te extends ee().Store{getInitialState(){return!1}}var oe=()=>o(3431),ne=()=>o(758256),re=o(474848);var ie=()=>o(340498);const ae={viewBox:"0 0 16 16",fittedViewBox:"1.37 1.25 13.26 13.5",svg:(0,re.jsx)("path",{d:"M5.846 2.75h.77a.75.75 0 1 0 0-1.5h-.77A2.75 2.75 0 0 0 3.096 4v1.223c0 .85-.487 1.634-1.252 2.016a.85.85 0 0 0 0 1.522 2.26 2.26 0 0 1 1.252 2.016V12a2.75 2.75 0 0 0 2.75 2.75h.77a.75.75 0 0 0 0-1.5h-.77c-.69 0-1.25-.56-1.25-1.25v-1.223A3.76 3.76 0 0 0 3.363 8a3.76 3.76 0 0 0 1.233-2.777V4c0-.69.56-1.25 1.25-1.25m4.308 10.5h-.77a.75.75 0 0 0 0 1.5h.77a2.75 2.75 0 0 0 2.75-2.75v-1.223c0-.85.487-1.634 1.252-2.016a.85.85 0 0 0 0-1.522 2.26 2.26 0 0 1-1.252-2.016V4a2.75 2.75 0 0 0-2.75-2.75h-.77a.75.75 0 0 0 0 1.5h.77c.69 0 1.25.56 1.25 1.25v1.223c0 1.073.462 2.076 1.233 2.777a3.76 3.76 0 0 0-1.233 2.777V12c0 .69-.56 1.25-1.25 1.25"})},se=(0,ie().wt)("curlyBracesFillSmall",ae,"fillSmall");function le(e){const{children:t}=e,[r,i]=(0,n.useState)(!1),a=(0,d().K8)((()=>(0,X().Ke)()),[]),s=(0,c().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:4}})),[]),l=(0,n.useCallback)((()=>i((e=>!e))),[]);return a?(0,re.jsxs)("div",{style:s.container,children:[(0,re.jsx)(h().p,{onClick:l,iconLeading:{icon:r?se:o(64035).C,size:"sm"},colorPalette:r?"blue":"gray",children:r?(0,re.jsx)(B().sA,{defaultMessage:"Hide debug JSON",id:"workflow.editorSettings.hideDebugJson"}):(0,re.jsx)(B().sA,{defaultMessage:"View debug JSON",id:"workflow.editorSettings.viewDebugJson"})}),r?t:void 0]}):null}function de(e){const{workflowStore:t}=e,r=(0,l().v3)(),i=(0,Z().N)(t,!0),a=(0,n.useMemo)((()=>function(e){return JSON.stringify(e,null,2)}(i.workflowValue)),[i.workflowValue]),s=(0,n.useCallback)((e=>{if(t.table===ne().U6)return;const o=e?JSON.parse(e):void 0;F().createAndCommit({userAction:"WorkflowPageBlock.WorkflowDebugPopupContent.handleSave",environment:r,canUndo:!0,perform:e=>{(0,q().overrideWorkflowData)({workflowStore:t,workflow:o,transaction:e})}})}),[r,t]);return(0,re.jsx)(o(571376).X,{value:a,onSave:s,language:"json"})}var ce=()=>o(970236),ue=()=>o(475714),ge=()=>o(759113),pe=()=>o(746400);function fe(e){const{workflowStore:t,trigger:o,onClick:n,disabled:r}=e,i=(0,Z().N)(t,!0),{workflowValue:a,threadStore:s}=i,l=t.pointer,u=(0,d().K8)((()=>{if(l||null!=s&&s.pointer)return(0,G().Cq)({workflowPointer:l,threadPointer:null==s?void 0:s.pointer})}),[l,s]),{specificTrigger:p,triggerDefinition:f,specificModuleValue:m}=(0,ge().useTriggerWithDefinition)({workflowValue:a,trigger:o}),w=(0,$().VB)(o)?"complete":"needsSetup",v=!1!==o.enabled,{persistedOrDraftTriggerStore:y}=(0,ue().A)({workflowOrArtifactStore:t,triggerIdFromParent:o.id}),k=(0,c().eP)(),x=(0,c().IS)((()=>({button:{paddingInlineStart:10,paddingInlineEnd:6,gap:8},hoveredButton:{background:E().Tj.background.secondaryTranslucent},pressedButton:{background:(0,g().yZ)({color:E().Tj.background.secondaryTranslucent,mode:k})},icon:{opacity:v?1:.5},triggerDescription:{...U().RC,flexGrow:1,flexShrink:1,minWidth:0},rightButtonsContainer:{display:"flex",alignItems:"center",gap:4,flexShrink:0},runButtonContainer:{marginInlineStart:"auto",display:"flex",alignItems:"center",gap:8}})),[v,k]);return o&&a&&u?(0,re.jsxs)(h().p,{size:"lg",onClick:n,disabled:r,colorPalette:v?void 0:"gray",iconLeading:null!=f&&f.icon?{icon:f.icon,size:"sm",colorVariant:"primary",style:x.icon}:void 0,style:x.button,hoveredStyle:x.hoveredButton,pressedStyle:x.pressedButton,children:[(0,re.jsx)("span",{style:x.triggerDescription,children:f&&p?(0,re.jsx)(f.SpecificTriggerDescription,{trigger:p,moduleId:(null==m?void 0:m.id)??"notion",workflowDefinitionPointer:u,moduleValue:m}):o.name??"New trigger"}),(0,re.jsxs)("div",{style:x.rightButtonsContainer,children:[(0,re.jsx)("div",{style:x.runButtonContainer,children:v?"needsSetup"===w?(0,re.jsx)(ce().E,{color:"blue",content:(0,re.jsx)(B().sA,{id:"workflow.trigger.incompleteSetup",defaultMessage:"Finish setup"})}):null:(0,re.jsx)(ce().E,{color:"gray",content:"Disabled"})}),(0,re.jsx)(pe().b,{disabled:r,triggerStore:y,trigger:o,workflowId:t.id,isDatabaseAgent:(0,D().uP)(a)})]})]}):null}var me=()=>o(951500),we=()=>o(249046),ve=()=>o(642557),he=()=>o(68263),ye=()=>o(449851),ke=()=>o(343489),xe=()=>o(814207),Se=()=>o(383245);function be(e){const{workflowStore:t,module:o,isInTranscript:r}=e,i=(0,l().v3)(),a=(0,Z().N)(t,!0),{threadStore:s,workflowValue:c}=a,u=t.pointer,g=(0,d().K8)((()=>{if(u||null!=s&&s.pointer)return(0,G().Cq)({workflowPointer:u,threadPointer:null==s?void 0:s.pointer})}),[u,s]),p=(0,d().K8)((()=>t??s),[t,s]),f=(0,n.useCallback)((e=>{t.table!==ne().U6&&q().removeModule({environment:i,workflowStore:t,threadStore:s,module:e})}),[i,t,s]),m=(0,n.useCallback)((e=>{t.table!==ne().U6&&q().saveModule({environment:i,workflowStore:t,module:e})}),[i,t]),w=(0,n.useCallback)((e=>{t.table!==ne().U6&&q().saveConfigVariable({environment:i,workflowStore:t,threadStore:s,value:e})}),[i,t,s]);if(!g||!c||!p)return null;return ye().d.isValidAndConnected(o,c)?(0,re.jsx)(Se().WorkflowModuleConfiguration,{isInTranscript:r,module:o,removeModule:f,saveConfigVariable:w,saveModule:m,store:p,workflowDefinitionPointer:g,workflow:c}):null}o(944114);var Me=()=>o(792057),je=()=>o(546926),Ce=()=>o(890492),Ie=()=>o(81068),Ae=()=>o(663639),Te=()=>o(736847),De=()=>o(55967),Pe=()=>o(126617),_e=()=>o(714318),Be=()=>o(995847),Ee=()=>o(496603),Ue=()=>o(655600),Le=()=>o(604018),Ne=()=>o(383070),Re=()=>o(575143),Ke=()=>o(662971),ze=()=>o(691093),Ve=()=>o(976792),We=()=>o(964484),Fe=()=>o(976710),Oe=()=>o(942580),He=()=>o(423493),qe=()=>o(524490),Ye=()=>o(259476);const $e=(0,B().YK)({remove:{id:"useMailModuleMenuItems.remove",defaultMessage:"Remove"}});var Ge=()=>o(110443),Xe=()=>o(552559),Qe=()=>o(381678),Ze=()=>o(229508);const Je=(0,B().YK)({connect:{id:"useMcpServerMenuItems.connect",defaultMessage:"Connect"},reconnect:{id:"useMcpServerMenuItems.reconnect",defaultMessage:"Reconnect"}});var et=()=>o(396896),tt=()=>o(424400);const ot=(0,B().YK)({mcpServerUrl:{defaultMessage:"URL: {url}",id:"workflow.connectionInfo.mcpServerUrl"},connectedBy:{defaultMessage:"Connected by {connectedByName}",id:"workflow.connectionInfo.connectedBy"}});function nt(e){const{url:t,connectedBy:o,createdDate:n}=e,r=[];if(t&&r.push({key:"mcp-server-url",render:(0,re.jsx)(y().D,{styleKey:"bodySm",colorVariant:"secondary",children:(0,re.jsx)(B().sA,{...ot.mcpServerUrl,values:{url:t}})})}),o&&r.push({key:"connected-by",render:(0,re.jsx)(y().D,{styleKey:"bodySm",colorVariant:"secondary",children:(0,re.jsx)(B().sA,{...ot.connectedBy,values:{connectedByName:o}})})}),n&&r.push({key:"created-date",render:(0,re.jsx)(y().D,{styleKey:"bodySm",colorVariant:"secondary",children:n})}),0!==r.length)return{key:"connection-info",render:e=>(0,re.jsx)(Te().A,{...e,topBorder:!0}),items:[{key:"connection-info-detailed",action:()=>{},render:e=>(0,re.jsx)(tt().Ay,{...e,title:(0,re.jsx)(et().VP,{gap:4,paddingTop:4,paddingBottom:4,children:r.map((e=>(0,re.jsx)("div",{children:e.render},e.key)))})})}]}}var rt=()=>o(621859);const it=["slack","cursor"],at=(0,B().YK)({connectLabel:{defaultMessage:"Connect",id:"workflow.moduleSection.connectLabel"},connectToWorkspace:{defaultMessage:"Connect to {workspaceName}",id:"workflow.moduleSection.connectToWorkspace"},existingWorkspace:{defaultMessage:"Workspace",id:"workflow.moduleSection.existingWorkspace"},removeAccessModule:{defaultMessage:"Disconnect",id:"workflow.moduleSection.removeAccessModule"},reconnectModule:{defaultMessage:"Reconnect",id:"workflow.moduleSection.reconnectModule"},removeConfirmMessage:{defaultMessage:"Disconnect this connection?",id:"workflow.moduleSection.removeAccessConfirmation.message"},removeConfirmDescription:{defaultMessage:"Remove connection from this agent permanently. Youll need to authenticate again to reconnect.",id:"workflow.moduleSection.removeAccessConfirmation.description"},removeConfirmAcceptLabel:{defaultMessage:"Disconnect",id:"workflow.moduleSection.removeAccessConfirmation.acceptLabel"},moreOptions:{defaultMessage:"More...",id:"workflowConfigureModuleMoreMenu.moreOptions"}});function st(e,t){var o,n,r;if(!(e.needsConnectionPointer&&!(null!==(o=e.workspaceRestrictionInfo)&&void 0!==o&&o.restricted&&e.isModuleValidAndConnected)))return[];const i=null!==(n=e.workspaceRestrictionInfo)&&void 0!==n&&n.workspaceName?(0,re.jsx)(B().sA,{...at.connectToWorkspace,values:{workspaceName:e.workspaceRestrictionInfo.workspaceName}}):(null==t||null===(r=t.getFallbackConnectTitle)||void 0===r?void 0:r.call(t,e))??(0,re.jsx)(B().sA,{...at.connectLabel}),a={key:"workspace-auth-connection",action:()=>{e.handleConnect(),e.buttonPopupStore.setState({open:!1})},render:e=>(0,re.jsx)(Ie().A,{...e,title:i,icon:(0,re.jsx)(w().I,{icon:_e().plugSmallIcon,size:"sm"})})},s={key:"workspace-existing-connection",action:()=>null,render:(t,o)=>(0,re.jsx)(Ke().A,{...t,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,re.jsx)(Ie().A,{...t,ref:o,title:(0,re.jsx)(B().sA,{...at.existingWorkspace}),icon:(0,re.jsx)(w().I,{icon:_e().plugSmallIcon,size:"sm"}),right:e.existingConnectionLabel,rightStyle:e.styles.existingConnectionsItem,disabled:!e.canCurrentUserUpdateConnection,showExtensionArrow:e.canCurrentUserUpdateConnection}),renderExtension:t=>e.canCurrentUserUpdateConnection?(0,re.jsx)("div",{...t,children:e.connectionsMenu}):null})};return[e.hasAsyncConnections?s:a]}function lt(e,t){if(!e.canCurrentUserRemoveModule)return[];const o=[{key:"removeAccess",action:async()=>{await e.handleRemoveAccessModule(),e.buttonPopupStore.setState({open:!1})},render:e=>(0,re.jsx)(Re().A,{...e,title:(0,re.jsx)(B().sA,{...at.removeAccessModule}),svg:()=>(0,re.jsx)(w().I,{icon:Be().xMarkSmallIcon,size:"sm"}),isRed:!0})}];return null!=t&&t.includeReconnect&&e.canEditModule&&o.push({key:"reconnect",action:()=>{e.handleConnect(),e.buttonPopupStore.setState({open:!1})},render:e=>(0,re.jsx)(Re().A,{...e,title:(0,re.jsx)(B().sA,{...at.reconnectModule}),svg:()=>(0,re.jsx)(w().I,{icon:De().w,size:"sm"}),isRed:!1})}),o}function dt(e){const{module:t,workflowStore:o}=e,r=(0,d().uB)(void 0,f().A),i=(0,l().v3)(),a=(0,l().WS)(),s=(0,B().tz)(),u=(0,c().IS)((()=>({removeAccessButton:{color:E().Tj.red.text.accentPrimary,fontSize:12,padding:"4px 8px"},existingConnectionsItem:{color:E().Tj.text.secondary}})),[]),g=o.pointer,m=(0,d().K8)((()=>(0,G().Cq)({workflowPointer:g})),[g]),[h,y]=(0,Fe().j)({moduleValue:t,workflowDefinitionPointer:m,workflowModuleStore:void 0}),{workflowValue:k}=(0,Z().N)(o,!0),x=function(e){var t;const{module:o,workflowValue:n}=e;if(!n)return!0;const r=null===(t=n.modules)||void 0===t?void 0:t.find((e=>e.id===o.id));if(!r)return!1;return ye().d.isValidAndConnected(r,n)}({module:t,workflowValue:k}),{createdByUser:S,createdDateString:b,canCurrentUserUpdateConnection:M,canCurrentUserRemoveModule:j}=(0,We().x)({module:t,workflowStore:o}),C=(0,ke().i)({module:t,store:o}),I=(0,he().p2)(C),A=function(e){const{module:t,workflowStore:o,onDismissMenu:r}=e,[i,a]=(0,n.useState)(!1),s=(0,l().v3)(),c=(0,d().K8)((()=>{const e=(0,Qe()._)(s);return null==e?void 0:e.pointer}),[s]),u=(0,Ze().a)(),g="mcpServer"===t.type&&u?t.state:void 0,p=(0,d().K8)((()=>!(null==g||!g.serverUrl)&&(!!(0,Ge().eH)(g.serverUrl)||Boolean(g.connectionPointer))),[g]),f=(0,n.useCallback)((()=>{a(!0),null==r||r()}),[r]);if(!g||!u)return{menuItems:[],reconnectModal:null};const m=[];return p?m.push({key:"mcp-reconnect",render:e=>(0,re.jsx)(Ie().A,{...e,title:(0,re.jsx)(B().sA,{...Je.reconnect}),icon:(0,re.jsx)(w().I,{icon:_e().plugSmallIcon,size:"sm"})}),action:f}):m.push({key:"mcp-connect",render:e=>(0,re.jsx)(Ie().A,{...e,title:(0,re.jsx)(B().sA,{...Je.connect}),icon:(0,re.jsx)(w().I,{icon:_e().plugSmallIcon,size:"sm"})}),action:f}),{menuItems:m,reconnectModal:null!=g&&g.serverUrl&&o&&c?(0,re.jsx)(Xe().Z,{isOpen:i,onClose:()=>a(!1),workflowId:null==o?void 0:o.id,existingModuleId:t.id,initialName:t.name,initialUrl:g.serverUrl,spaceViewStore:u,currentUserPointer:c,onSuccess:()=>a(!1)}):null}}({module:t,workflowStore:o,onDismissMenu:()=>r.reset()}),{handleConnect:T,authModal:D}=(0,oe().K)({moduleValue:t,workflowDefinitionPointer:m,workflowModuleStore:void 0}),P=(0,n.useCallback)((e=>{q().saveModule({environment:i,workflowStore:o,module:e})}),[i,o]),_=(0,n.useCallback)((e=>{var o;const n=K().Nh[t.type],r=(null==n||null===(o=n.getDefaultPermissions)||void 0===o?void 0:o.call(n))??[],i={...t.state,connectionPointer:null==e?void 0:e.pointer};"error"in i&&(i.error=void 0),P({...t,state:i,permissions:[...r]})}),[t,P]),{scopedExternalConnectionStore:U,externalConnection:L}=(0,Oe().q)({moduleValue:t}),N=(0,n.useMemo)((()=>{if("slack"===(null==L?void 0:L.integration_type)&&L.scopes)return(0,Ve().YS)({module:t,connectionScopes:L.scopes})}),[L,t]),R=(0,d().K8)((()=>{const e=null==U?void 0:U.getWorkflowExternalConnectionStore(),o=null==e?void 0:e.getModel();return"slack"===(null==o?void 0:o.module_type)&&(0,Ve().YS)({module:t,connectionScopes:null==o?void 0:o.getData().scope})}),[t,U]),z=N??R,V=He().y[t.type],W=(0,d().K8)((()=>{var e;return null==V||null===(e=V.getWorkspaceRestrictionInfo)||void 0===e?void 0:e.call(V)}),[V]),{label:F,connectionsMenu:O,authModal:H}=(0,qe().w)({asyncConnections:h,moduleValue:t,onConnectClick:()=>r.reset(),onMenuItemClick:_,selectedScopedExternalConnectionStore:U,selectedExternalConnection:L,workflowDefinitionPointer:m,workflowModuleStore:void 0}),Y=(0,n.useMemo)((()=>it.includes(t.type)),[t]),$=(0,n.useMemo)((()=>"resolved"===h.status&&h.value.sections.length>0),[h]),X=(0,n.useCallback)((async()=>{if(!o)return;(await Me().Gh({message:(0,re.jsx)(B().sA,{...at.removeConfirmMessage}),description:(0,re.jsx)(B().sA,{...at.removeConfirmDescription}),acceptLabel:(0,re.jsx)(B().sA,{...at.removeConfirmAcceptLabel})})).accept&&(q().deleteModule({workflowStore:o,moduleId:t.id,environment:i}),ze().showWorkflowEditor({environment:i,workflowStore:o,navigationState:{isOpen:!0,type:"agent"}}))}),[o,t,i]),Q=function(e){const{onRemove:t,onDismissMenu:o}=e;return[{key:"mail-remove",render:e=>(0,re.jsx)(Re().A,{...e,title:(0,re.jsx)(B().sA,{...$e.remove}),svg:()=>(0,re.jsx)(w().I,{icon:Ye().trashSmallIcon,size:"sm"}),isRed:!0}),action:()=>{t(),null==o||o()}}]}({module:t,onRemove:X,onDismissMenu:()=>r.reset()}),J=[...(0,d().K8)((()=>{const e={buttonPopupStore:r,canCurrentUserRemoveModule:j,canCurrentUserUpdateConnection:M,canEditModule:I,connectionsMenu:O,existingConnectionLabel:F,handleConnect:T,handleRemoveAccessModule:X,hasAsyncConnections:$,isModuleValidAndConnected:x,mailModuleMenuItems:Q,mcpServerMenuItems:(null==A?void 0:A.menuItems)??[],module:t,needsConnectionPointer:Y,styles:u,workspaceRestrictionInfo:W};switch(t.type){case"mcpServer":return function(e){const t=st(e),o=lt(e);return[{key:"actions",render:e=>(0,re.jsx)(Te().A,{...e}),items:[...t,...e.mcpServerMenuItems,...o]}]}(e);case"cursor":return function(e){return[{key:"actions",render:e=>(0,re.jsx)(Te().A,{...e}),items:[...st(e,{getFallbackConnectTitle:e=>(0,re.jsx)(B().sA,{...e.isModuleValidAndConnected?at.reconnectModule:at.connectLabel})}),...lt(e)]}]}(e);case"mail":return function(e){return[{key:"actions",render:e=>(0,re.jsx)(Te().A,{...e}),items:[...st(e),...e.mailModuleMenuItems]}]}(e);case"calendar":return function(e){return[{key:"actions",render:e=>(0,re.jsx)(Te().A,{...e}),items:[...st(e),...lt(e)]}]}(e);case"slack":return function(e){const t=st(e),o=Ne().zD.isSlackConnectorUnificationEnabled(),n=(0,Le().wd)().includes("slack"),r=(0,Ue().LT)("slack").isInProgress;return[{key:"actions",render:e=>(0,re.jsx)(Te().A,{...e}),items:[...t,...lt(e,{includeReconnect:!o||n||r})]}]}(e);case"notion":return[];default:return function(e){return[{key:"actions",render:e=>(0,re.jsx)(Te().A,{...e}),items:[...st(e),...lt(e,{includeReconnect:!0})]}]}(e)}}),[Y,T,r,F,u,M,j,I,O,X,$,A,Q,W,x,t]),...(0,n.useMemo)((()=>{if("notion"===t.type||!x)return[];const e="mcpServer"!==t.type||!t.state||Boolean(t.state.connectionPointer),o=nt({url:"mcpServer"===t.type&&t.state?t.state.serverUrl:void 0,connectedBy:e?S:void 0,createdDate:e?b:void 0});return Ee().oE([o])}),[S,b,x,t])];return 0===J.length?null:(0,re.jsxs)(re.Fragment,{children:[Y&&(!x||z)&&I?(0,re.jsx)(rt().m,{forceReconnect:z,module:t,workflowStore:o}):void 0,(0,re.jsx)(p().A,{popupType:a?p().z.BottomSheet:p().z.Popup,alignmentToOrigin:"end",originGap:4,renderOrigin:e=>(0,re.jsx)(v().A,{icon:Pe().ellipsisSmallIcon,colorVariant:"secondary",...e,ariaLabel:s.formatMessage(at.moreOptions)}),render:()=>(0,re.jsx)(Ce().A,{menuType:a?je().gu.ActionSheet:je().gu.Popup,width:300,children:(0,re.jsx)(Ae().A,{type:Ae().O.Vertical,sections:J,initialFocus:void 0})}),buttonPopupStore:r}),D,H,null==A?void 0:A.reconnectModal]})}var ct=()=>o(158661);function ut(e){const{module:t}=e,o=(0,c().IS)((()=>({errorTooltip:{minWidth:300}})),[]),r=(0,n.useMemo)((()=>{var e;const o=He().y[t.type];return null==o||null===(e=o.getErrorMessage)||void 0===e?void 0:e.call(o,t)}),[t]);return r?(0,re.jsx)(S().m,{textWrap:!0,style:o.errorTooltip,renderTooltip:()=>r,render:e=>(0,re.jsx)("span",{...e,children:(0,re.jsx)(w().I,{icon:ct().exclamationMarkTriangleFillSmallIcon,size:"sm",colorVariant:"accentPrimary",colorPalette:"red"})})}):null}function gt(e){const{icon:t,label:o,right:n,children:r,allowOverflowX:i}=e,a=function(e){return(0,c().IS)((()=>({titleIconContainer:{width:ie().Ev.sm,height:ie().Ev.sm,display:"grid",placeItems:"center"},titleIcon:{width:ie().Ev.sm,height:ie().Ev.sm,fill:E().Tj.icon.primary},container:{margin:"0 auto",width:"100%",display:"flex",flexDirection:"column",gap:4,overflowX:e?"visible":"hidden"},leftSection:{flex:1},rightSection:{flex:0,paddingInlineEnd:12}})),[e])}(i);return(0,re.jsxs)("div",{style:a.container,children:[(0,re.jsxs)(u().Y1,{direction:"horizontal",align:"center-left",height:28,children:[(0,re.jsxs)(u().Y1,{direction:"horizontal",align:"center-left",gap:8,padding:12,style:a.leftSection,children:[t?(0,re.jsx)("span",{style:a.titleIconContainer,children:t(a.titleIcon)}):null,o?(0,re.jsx)(y().D,{styleKey:"bodyMedium",children:o}):null]}),(0,re.jsx)(u().Y1,{width:"hug",direction:"horizontal",gap:4,align:"center-right",style:a.rightSection,children:n})]}),r]})}function pt(e){var t;const{workflow:o,workflowStore:n,moduleId:r}=e,i=null===(t=o.modules)||void 0===t?void 0:t.find((e=>e.id===r)),a=(0,me().l)(i);return a?(0,re.jsx)(ft,{workflowStore:n,module:a}):null}function ft(e){const{workflowStore:t,module:o}=e,n=(0,B().tz)(),r=ye().d.getName(o,n),i=(0,xe().c)(o),a=(0,xe().f)(o),s=(0,ke().i)({module:o,store:t}),l=(0,he().p2)(s)?void 0:(0,re.jsx)(S().m,{renderTooltip:()=>(0,re.jsx)(B().sA,{defaultMessage:"You do not have edit access",id:"workflowConfigureModule.noEditAccess"}),render:e=>(0,re.jsx)("div",{...e,children:(0,re.jsx)(we().Ye,{alignItems:"center",children:(0,re.jsx)(w().I,{icon:ve().lockSmallIcon,size:"xs",colorVariant:"secondary"})})})}),d=a||l?(0,re.jsxs)(we().Ye,{alignItems:"center",gap:8,children:[(0,re.jsx)("span",{children:r}),a,l]}):r,c=t.table===ne().U6||"notion"===o.type?(0,re.jsx)(ut,{module:o}):(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(ut,{module:o}),(0,re.jsx)(dt,{workflowStore:t,module:o})]});return(0,re.jsx)(gt,{label:d,icon:i,allowOverflowX:!0,right:c,children:(0,re.jsx)(be,{workflowStore:t,module:o,isInTranscript:!1})})}function mt(e){const{workflow:t,workflowStore:o,module:n}=e;return(0,re.jsxs)(u().Y1,{width:"fill",children:[void 0,(0,re.jsx)(pt,{moduleId:n.id,workflow:t,workflowStore:o},n.id)]})}var wt=()=>o(383036);function vt(e){const{children:t,title:o,isDimmed:r,actionButton:i,errorLabel:a,style:s,hasError:l,infoTooltipMessage:d}=e,g=(0,B().tz)(),[p,f]=(0,n.useState)(!1),m=(0,n.useCallback)((()=>{f(!0)}),[]),v=(0,n.useCallback)((()=>{f(!1)}),[]),h=(0,c().eP)(),k=(0,c().IS)((()=>({header:{paddingTop:6,paddingInlineEnd:0,paddingBottom:6,paddingInlineStart:10,color:E().Tj.text.secondary,height:40,alignItems:"center"},content:{outline:l?`2px solid ${E().Tj.red.text.accentPrimary}`:"none",opacity:r?.4:1,borderWidth:1,borderStyle:"solid",borderColor:E().Tj.border.secondary,borderRadius:14,paddingInline:(null==s?void 0:s.paddingInline)??16,paddingBlock:(null==s?void 0:s.paddingBlock)??16,backgroundColor:"dark"===h?E().Tj.background.secondary:E().Tj.background.primary,boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.02)"},titleRow:{display:"flex",gap:4,alignItems:"center",height:20},infoIconWrapper:{cursor:"pointer",display:"flex",alignItems:"center"},tooltip:{minWidth:190}})),[s,l,r,h]);return(0,re.jsxs)(u().Y1,{direction:"vertical",width:"hug",children:[(0,re.jsxs)(u().Y1,{style:k.header,direction:"horizontal",gap:"auto",children:[(0,re.jsxs)("div",{style:k.titleRow,children:[(0,re.jsx)(y().D,{styleKey:"captionMedium",children:o}),d?(0,re.jsx)(S().m,{style:k.tooltip,placement:"right",alignment:"center",textWrap:!0,renderTooltip:()=>(0,re.jsx)(B().sA,{...d}),render:e=>(0,re.jsx)("div",{"aria-label":g.formatMessage(d),style:k.infoIconWrapper,tabIndex:0,...(0,wt().A)({onMouseEnter:m,onMouseLeave:v},e),children:(0,re.jsx)(w().I,{icon:j().infoCircleSmallIcon,size:"sm",colorVariant:p?"secondary":"tertiary",style:{opacity:p?1:.8}})})}):void 0]}),i]}),(0,re.jsx)("div",{style:k.content,children:t}),l?a:void 0]})}o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(430670),o(803949);var ht=()=>o(230711),yt=()=>o(107975),kt=()=>o(119081),xt=()=>o(406094),St=()=>o(274065),bt=()=>o(173614),Mt=()=>o(978234),jt=()=>o(471636),Ct=()=>o(543322),It=()=>o(112968),At=()=>o(939768),Tt=()=>o(746791),Dt=()=>o(488776),Pt=()=>o(246766),_t=()=>o(451557);const Bt={isMcpModalOpen:!1,mcpModuleIdToConnect:void 0,mcpModalInitialData:void 0};class Et extends ee().Store{getInitialState(){return{...Bt,addedConnections:new Set,pendingAdds:new Set}}openMcpModal(e){this.setState({...this.state,isMcpModalOpen:!0,mcpModuleIdToConnect:e.moduleId,mcpModalInitialData:e.initialData})}closeMcpModal(){this.setState({...this.state,isMcpModalOpen:!1,mcpModuleIdToConnect:void 0,mcpModalInitialData:void 0})}addConnection(e){const t=new Set(this.state.addedConnections);t.add(e),this.setState({...this.state,addedConnections:t})}removeConnection(e){const t=new Set(this.state.addedConnections);t.delete(e),this.setState({...this.state,addedConnections:t})}addPendingConnection(e){const t=new Set(this.state.pendingAdds);t.add(e),this.setState({...this.state,pendingAdds:t})}removePendingConnection(e){const t=new Set(this.state.pendingAdds);t.delete(e),this.setState({...this.state,pendingAdds:t})}clearAddedConnections(){this.setState({...this.state,addedConnections:new Set})}}var Ut=()=>o(13668),Lt=()=>o(133532),Nt=()=>o(349679),Rt=()=>o(301948),Kt=()=>o(115512),zt=()=>o(329366),Vt=()=>o(774879),Wt=()=>o(30757);const Ft=(0,B().YK)({workerBadge:{id:"workflow.agent.addConnectionModal.workerBadge",defaultMessage:"Worker"},connected:{id:"workflow.agent.addConnectionModal.connected",defaultMessage:"Connected"},add:{id:"workflow.agent.addConnectionModal.add",defaultMessage:"Add"},connect:{id:"workflow.agent.addConnectionModal.connect",defaultMessage:"Connect"},removeAccessModule:{id:"workflow.agent.addConnectionModal.removeAccessModule",defaultMessage:"Disconnect"},removeConfirmMessage:{id:"workflow.agent.addConnectionModal.removeConfirmMessage",defaultMessage:"Disconnect this connection?"},removeConfirmDescription:{id:"workflow.agent.addConnectionModal.removeConfirmDescription",defaultMessage:"Remove connection from this agent permanently. Youll need to authenticate again to reconnect."},removeConfirmAcceptLabel:{id:"workflow.agent.addConnectionModal.removeConfirmAcceptLabel",defaultMessage:"Disconnect"},moreOptions:{id:"workflow.agent.addConnectionModal.moreOptions",defaultMessage:"More..."}});function Ot(e){const{connection:t,isAdded:o,onAdd:r,onRemove:i,onTriggerAuth:a,onTriggerMcpAuth:s,workflowStore:u,isPendingAdd:g}=e,m=(0,B().tz)(),h=(0,l().v3)(),k=n.useMemo((()=>new(f().A)),[]),b=(0,c().IS)((()=>({connectionItem:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingInline:12,paddingBlock:8,borderRadius:6,cursor:"default"},connectionLeft:{display:"flex",alignItems:"center",gap:12,flex:1,minWidth:0},connectionIcon:{flexShrink:0},connectionInfo:{display:"flex",flexDirection:"column",gap:2,flex:1,minWidth:0,marginInlineEnd:12},connectionName:{display:"flex",alignItems:"center",gap:8},addButton:{flexShrink:0},connectedStatus:{display:"flex",alignItems:"center",gap:6,color:E().Tj.text.secondary},connectedStatusContainer:{gap:8,flexShrink:0},connectButton:{color:E().Tj.blue.text.accentPrimary,background:"transparent",border:"none",padding:0,cursor:"pointer",fontSize:14,fontWeight:U().Wy.medium},taglineDisplay:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},taglineTooltip:(0,Kt().pA)(2)})),[]),M=(0,zt().y)({moduleValue:t.moduleValue,existingModuleId:t.existingModuleId,hasExternalConnection:t.hasExternalConnection,hasDuplicateUrl:t.hasDuplicateUrl,isAdded:o}),j=t.moduleType?He().y[t.moduleType]:void 0,C=(0,d().K8)((()=>{var e;return"worker"===t.moduleType&&t.toolCount?m.formatMessage({id:"addConnectionModal.workers.toolCount",defaultMessage:"{count, plural, one {# tool} other {# tools}}"},{count:t.toolCount}):"notInWorkflow"===M?null==j||null===(e=j.getConnectionSubtitle)||void 0===e?void 0:e.call(j):void 0}),[M,j,t,m]),{createdByUser:I,createdDateString:A}=(0,We().x)({module:t.moduleValue,workflowStore:u}),T=(0,d().K8)((()=>{var e;return null==j||null===(e=j.needsCustomConnect)||void 0===e?void 0:e.call(j)}),[j]),D=(0,n.useCallback)((()=>{t.hasDuplicateUrl||("mcpServer"===t.type?t.mcpServerId?r({type:"mcpServer",mcpServerId:t.mcpServerId,existingModuleId:t.existingModuleId}):s({mcpServerId:void 0,initialData:{name:t.name,url:t.url??""}}):t.moduleType&&r({type:t.moduleType,existingModuleId:t.existingModuleId,workerId:t.workerId}))}),[t,r,s]),P=(0,n.useCallback)((()=>{if(T)T.connectHandler();else if(!t.hasDuplicateUrl||"needsAuthentication"===M)if("needsAuthentication"===M)if("mcpServer"===t.type&&t.mcpServerId){var e;const o=null!==(e=t.moduleValue)&&void 0!==e&&e.state&&"serverUrl"in t.moduleValue.state?t.moduleValue.state.serverUrl:void 0;s({mcpServerId:t.mcpServerId,initialData:{name:t.name,url:o??t.url??""}})}else t.moduleValue&&a(t.moduleValue);else D()}),[T,M,t.type,t.mcpServerId,t.moduleValue,t.hasDuplicateUrl,t.name,t.url,a,s,D]),_=(0,n.useCallback)((async()=>{if(!t.existingModuleId)return;(await Me().Gh({message:(0,re.jsx)(B().sA,{...Ft.removeConfirmMessage}),description:(0,re.jsx)(B().sA,{...Ft.removeConfirmDescription}),acceptLabel:(0,re.jsx)(B().sA,{...Ft.removeConfirmAcceptLabel})})).accept&&(q().deleteModule({workflowStore:u,moduleId:t.existingModuleId,environment:h}),i(t.id),k.reset())}),[t.existingModuleId,t.id,u,h,k,i]),L=(0,n.useMemo)((()=>{const e=[];"needsAuthentication"===M&&e.push({key:"connect",action:()=>{P(),k.reset()},render:e=>(0,re.jsx)(Re().A,{...e,title:(0,re.jsx)(B().sA,{...Ft.connect}),svg:()=>(0,re.jsx)(w().I,{icon:_e().plugSmallIcon,size:"sm"})})}),e.push({key:"removeAccess",action:async()=>{await _()},render:e=>(0,re.jsx)(Re().A,{...e,title:(0,re.jsx)(B().sA,{...Ft.removeAccessModule}),svg:()=>(0,re.jsx)(w().I,{icon:Be().xMarkSmallIcon,size:"sm"}),isRed:!0})});const o=[{key:"actions",render:e=>(0,re.jsx)(Te().A,{...e}),items:e}];if("mcpServer"===t.type){const e=nt({url:t.url,connectedBy:t.moduleValue?I:void 0,createdDate:t.moduleValue?A:void 0});e&&o.push(e)}return o}),[M,P,_,k,t.type,t.url,t.moduleValue,I,A]);return(0,re.jsxs)("div",{style:{...b.connectionItem},children:[(0,re.jsxs)("div",{style:b.connectionLeft,children:[(0,re.jsx)("div",{style:b.connectionIcon,children:t.icon}),(0,re.jsxs)("div",{style:b.connectionInfo,children:[(0,re.jsxs)("div",{style:b.connectionName,"data-connection-type":t.type,"data-connection-label":t.name,children:[(0,re.jsx)(y().D,{styleKey:"bodyMedium",children:t.name}),"mcpServer"===t.type?(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(Wt().W,{serverUrl:t.url}),(0,re.jsx)(Vt().O,{})]}):null,(N=t.moduleType,!N||"mail"!==N&&"calendar"!==N?null:(0,re.jsx)(Rt().A,{})),"worker"===t.type?(0,re.jsx)(ce().E,{color:"gray",content:(0,re.jsx)(B().sA,{...Ft.workerBadge})}):null]}),t.tagline?(0,re.jsx)(S().m,{placement:"bottom",textWrap:!0,renderTooltip:()=>(0,re.jsx)("div",{style:b.taglineTooltip,children:(0,re.jsx)(y().D,{styleKey:"bodySm",colorVariant:"inversePrimary",children:t.tagline})}),render:e=>(0,re.jsx)(y().D,{as:"div",styleKey:"bodySm",colorVariant:"secondary",style:b.taglineDisplay,...e,children:t.tagline})}):null,C?(0,re.jsx)(y().D,{styleKey:"bodySm",colorVariant:"secondary",children:C}):null]})]}),"connected"===M?(0,re.jsxs)(we().Ye,{alignItems:"center",style:b.connectedStatusContainer,children:[t.moduleValue?(0,re.jsx)(ut,{module:t.moduleValue}):null,(0,re.jsxs)("div",{style:b.connectedStatus,children:[(0,re.jsx)(w().I,{icon:Nt().checkmarkSmallIcon,size:"sm"}),(0,re.jsx)(y().D,{styleKey:"bodyMedium",children:(0,re.jsx)(B().sA,{...Ft.connected})})]}),(0,re.jsx)(p().A,{popupType:p().z.Popup,alignmentToOrigin:"end",originGap:4,renderOrigin:e=>(0,re.jsx)(v().A,{icon:Pe().ellipsisSmallIcon,colorVariant:"secondary",...e,ariaLabel:m.formatMessage(Ft.moreOptions)}),render:()=>(0,re.jsx)(Ce().A,{menuType:je().gu.Popup,width:300,children:(0,re.jsx)(Ae().A,{type:Ae().O.Vertical,sections:L,initialFocus:void 0})}),buttonPopupStore:k})]}):"needsAuthentication"===M?(0,re.jsxs)(we().Ye,{alignItems:"center",style:b.connectedStatusContainer,children:[t.moduleValue?(0,re.jsx)(ut,{module:t.moduleValue}):null,(0,re.jsx)("button",{onClick:P,style:b.connectButton,disabled:g,children:(0,re.jsx)(B().sA,{...Ft.connect})}),(0,re.jsx)(p().A,{popupType:p().z.Popup,alignmentToOrigin:"end",originGap:4,renderOrigin:e=>(0,re.jsx)(v().A,{icon:Pe().ellipsisSmallIcon,colorVariant:"secondary",...e,ariaLabel:m.formatMessage(Ft.moreOptions)}),render:()=>(0,re.jsx)(Ce().A,{menuType:je().gu.Popup,width:300,children:(0,re.jsx)(Ae().A,{type:Ae().O.Vertical,sections:L,initialFocus:void 0})}),buttonPopupStore:k})]}):(0,re.jsxs)(we().Ye,{alignItems:"center",style:b.connectedStatusContainer,children:[t.moduleValue?(0,re.jsx)(ut,{module:t.moduleValue}):null,(0,re.jsx)(x().E,{colorPalette:"blue",onClick:P,style:b.addButton,disabled:g,size:"md",children:T?T.connectMessage:(0,re.jsx)(B().sA,{...Ft.add})})]})]});var N}function Ht(e){const{availableModules:t,existingMcpServers:o,existingModules:r,currentAgentMcpUrls:i,isMcpServerModuleAvailable:a,workersById:s,availableCapabilities:l,getExistingModuleId:d,preconfiguredServers:c,preconfiguredServerUrls:u}=e,g=(0,B().tz)();return(0,n.useMemo)((()=>{const e=function(e){const{availableModules:t,existingModules:o,getExistingModuleId:n,intl:r}=e,i=[];return t.filter((e=>"mcpServer"!==e.type&&"notion"!==e.type&&"worker"!==e.type)).forEach((({type:e,sharedModule:t})=>{const a=n("module",e);let s,l=!1;if(a){const e=o.find((e=>e.id===a));s=e,null!=e&&e.state&&"connectionPointer"in e.state&&(l=Boolean(e.state.connectionPointer))}i.push({id:e,type:"module",name:t.getName(r),moduleType:e,existingModuleId:a,hasExternalConnection:l,moduleValue:s,tagline:t.getDescription(r)})})),i}({availableModules:t,existingModules:r,getExistingModuleId:d,intl:g}),n=function(e){const{availableModules:t,existingModules:o,workersById:n,availableCapabilities:r,getExistingModuleId:i}=e,a=[];return t.find((e=>"worker"===e.type))?(new Set(r.filter((e=>"tool"===e._tag)).map((e=>e.workerId))).forEach((e=>{var t;const s=(null===(t=n.get(e))||void 0===t?void 0:t.name)??e,l=r.filter((t=>"tool"===t._tag&&t.workerId===e)).length,d=i("worker",e),c=void 0!==d?o.find((e=>e.id===d)):void 0;a.push({id:e,type:"worker",name:s,moduleType:"worker",existingModuleId:null==c?void 0:c.id,hasExternalConnection:!1,moduleValue:c,workerId:e,toolCount:l})})),a):a}({availableModules:t,existingModules:r,workersById:s,availableCapabilities:l,getExistingModuleId:d,intl:g});if(!a)return{modules:e,workers:n,existingMcpServers:{items:[],addedUrls:new Set},preconfiguredMcpServers:[]};const p=new Map;if(c)for(const t of c)t.tagline&&p.set((0,Ge().Yl)(t.serverUrl),t.tagline);const f=function(e){const{existingMcpServers:t,currentAgentMcpUrls:o,preconfiguredServerUrls:n,preconfiguredServerTaglines:r,getExistingModuleId:i}=e,a=[],s=new Set;return t.forEach((e=>{const t=i("mcpServer",e.id),l=e.hasExternalConnection,d=e.serverUrl?(0,Ge().Yl)(e.serverUrl):void 0,c=Boolean(d&&o.has(d)),u=void 0!==d&&n.has(d),g=(void 0!==d?r.get(d):void 0)??e.officialName;a.push({id:e.id,name:e.name,serverUrl:e.serverUrl,serverIconUrl:e.serverIconUrl,mcpServerId:e.id,existingModuleId:t,hasExternalConnection:l,hasDuplicateUrl:c,isPreconfigured:u,tagline:g}),e.serverUrl&&s.add((0,Ge().Yl)(e.serverUrl))})),{items:a,addedUrls:s}}({existingMcpServers:o,currentAgentMcpUrls:i,preconfiguredServerUrls:u,preconfiguredServerTaglines:p,getExistingModuleId:d}),m=function(e){const{servers:t,existingServerUrls:o,currentAgentMcpUrls:n}=e,r=[];for(const i of t){const e=(0,Ge().Yl)(i.serverUrl);o.has(e)||r.push({...i,hasDuplicateUrl:n.has(e)})}return r}({servers:c??[],existingServerUrls:f.addedUrls,currentAgentMcpUrls:i});return{modules:e,workers:n,existingMcpServers:f,preconfiguredMcpServers:m}}),[t,o,r,g,d,i,a,s,l,c,u])}var qt=()=>o(977680);function Yt(e){var t,o,n,r;return{id:e.id,name:e.name,serverUrl:null===(t=e.state)||void 0===t?void 0:t.serverUrl,serverIconUrl:null===(o=e.state)||void 0===o?void 0:o.serverIconUrl,officialName:null===(n=e.state)||void 0===n?void 0:n.officialName,hasExternalConnection:Boolean(null===(r=e.state)||void 0===r?void 0:r.connectionPointer)}}const $t=24,Gt=(0,B().YK)({modalAriaLabel:{id:"workflow.agent.addConnectionModal.ariaLabel",defaultMessage:"Add connection modal"},title:{id:"workflow.agent.addConnectionModal.title",defaultMessage:"Add connection"},subtitle:{id:"workflow.agent.addConnectionModal.subtitle",defaultMessage:"Connect your teams tools to this custom agent."},subtitleWithMcp:{id:"workflow.agent.addConnectionModal.subtitleWithMcp",defaultMessage:"Connect your teams tools and MCP servers to this custom agent."},customMcp:{id:"workflow.agent.addConnectionModal.customMcp",defaultMessage:"Custom MCP server"},enableCustomMcp:{id:"workflow.agent.addConnectionModal.enableCustomMcp",defaultMessage:"Enable Custom MCP Servers"},customMcpDisabledTooltip:{id:"workflow.agent.addConnectionModal.customMcpDisabledTooltip",defaultMessage:"Your workspace admin has not enabled custom MCP servers."},cancel:{id:"workflow.agent.addConnectionModal.cancel",defaultMessage:"Cancel"},mailModuleInitializationFailed:{id:"workflow.agent.addConnectionModal.mailModuleInitializationFailed",defaultMessage:"Something went wrong while connecting Notion Mail. Please try again."}});function Xt(e,t){var o;return(null===(o=t.get(e))||void 0===o?void 0:o.name)??`Unnamed worker (ID: ${e})`}function Qt(e){const{type:t,mcpServerId:o,workerId:n}=e;return"mcpServer"===t&&o?o:"worker"===t&&n?n:t}function Zt(e,t){return e.find((e=>"worker"===e.type&&e.state&&"workerId"in e.state&&e.state.workerId===t))}function Jt(e){return"module"===e.type?"cursor"===e.moduleType?2:1:"mcpServer"===e.type?e.isPreconfigured?3:4:"worker"===e.type?5:(e.type,6)}function eo(e){var t,o;const{workflowStore:s,isOpen:u,onClose:g,onRequestAuth:p}=e,f=(0,B().tz)(),m=(0,l().v3)(),{workflowValue:v}=(0,Z().N)(s,!0),h=(0,d().O$)(i().AppStoreSidebarSpaceViewStore),k=(0,r().L)(),b=(0,ht().U2)(k),M=(0,d().K8)((()=>(null==b?void 0:b.isWorkspaceOwner())??!1),[b]),j=(0,a().X)("custom_mcp_server_workspace_toggle"),I=(0,d().K8)((()=>!j||!1===(null==k?void 0:k.getSetting("disallow_custom_mcp_servers"))),[k,j]),A=(0,a().X)("workflows_mcp_server_module_available"),T=(0,d().uB)(void 0,Et),D=(0,d().O$)(T),[P,_]=(0,n.useState)(new Map),[U,L]=(0,n.useState)([]),[N,R]=(0,n.useState)(),z=(0,a().X)("custom_agent_calendar_connection_workflow"),[W,F]=(0,n.useState)(void 0),{isWaitingForCalendarConnection:$,calendarAccounts:G,handleConnectCalendar:X,clearCalendarConnectionTimeout:J}=(0,Tt().N)({from:"notionAISignupClick",connectionSuccessMessage:f.formatMessage(Ut().DZ.connectCalendarSuccessMessage),onConnectionSuccess:()=>{W&&fe(W)},onTimeout:()=>F(void 0)}),{servers:ee,serverUrls:te}=(0,qt().z)();n.useEffect((()=>{u?(0,_t().preloadNotionMailUserStatus)({environment:m}):R(void 0)}),[u,m]),n.useEffect((()=>{const e=null==h?void 0:h.getSpaceId();e&&(async()=>{try{const[t,o]=await Promise.all([m.api.callApi({environment:m,eventName:"getWorkers",data:{spaceId:e}}),m.api.callApi({environment:m,eventName:"listCapabilities",data:{spaceId:e,capabilityKind:"tool"}})]);if("success"===t.type){const e=new Map(t.data.workers.map((e=>[e.workerId,{name:e.name}])));_(e)}"success"===o.type&&L(o.data.capabilities)}catch(t){}})()}),[h,m]);const oe=(0,c().IS)((()=>({modalContent:{width:600,display:"flex",flexDirection:"column"},header:{display:"flex",flexDirection:"column",gap:8,paddingInline:24,paddingBlockStart:24},headerIcon:{display:"flex",alignItems:"flex-start",marginBlockEnd:4,color:E().Tj.icon.secondary},connectionsList:{display:"flex",flexDirection:"column",maxHeight:500,overflowY:"auto",paddingInline:12,paddingBlockEnd:16,marginBlockStart:16},errorMessage:{marginBlockEnd:8,paddingInlineStart:12},divider:{border:"none",borderTop:`1px solid ${E().Tj.border.secondary}`,marginInlineStart:46,marginInlineEnd:12,marginBlock:8},footer:{display:"flex",justifyContent:"space-between",padding:16,borderTop:`1px solid ${E().Tj.border.secondary}`},cancelButton:{color:E().Tj.text.primary},customMcpButton:{color:E().Tj.text.primary},iconImageBox:{width:$t,height:$t,objectFit:"contain",borderRadius:4}})),[]),ne=(0,d().K8)((()=>{const e=(0,Qe()._)(m);return null==e?void 0:e.pointer}),[m]),ae=(0,Q().v)({workflowStore:s,workflowValue:v,showCurrentModules:!0,isCustomAgentContext:!0}),se=(0,d().K8)((()=>{const e=s.getDraftData()??s.getData();return(null==e?void 0:e.modules)??[]}),[s]),le=(0,n.useMemo)((()=>(se??[]).filter((e=>"mcpServer"===e.type))),[se]),de=(0,n.useMemo)((()=>new Set(le.map((e=>{var t;const o="mcpServer"===e.type?null===(t=e.state)||void 0===t?void 0:t.serverUrl:void 0;return o?(0,Ge().Yl)(o):""})).filter((e=>""!==e)))),[le]),ce=(0,n.useMemo)((()=>le.map((e=>{var t;return{name:e.name,serverUrl:"mcpServer"===e.type?null===(t=e.state)||void 0===t?void 0:t.serverUrl:void 0}}))),[le]),ue=(0,n.useCallback)((e=>{var t;const o=null===(t=e.workflowModuleStore)||void 0===t?void 0:t.getData(),n=(0,K().jK)("mcpServer");return{type:"mcpServer",id:(0,V().Ay)(),name:e.name,version:(null==n?void 0:n.latestVersion)??"1.0.0",permissions:[],state:{serverUrl:e.serverUrl,...(0,It().Ws)(null==o?void 0:o.tools),...null!=o&&o.connectionPointer?{connectionPointer:o.connectionPointer}:{},...null!=o&&o.serverIconUrl?{serverIconUrl:o.serverIconUrl}:{},...null!=o&&o.officialName?{officialName:o.officialName}:{},...null!=o&&o.tools?{tools:o.tools}:{},...null!=o&&o.resources?{resources:o.resources}:{}}}}),[]),ge=(0,n.useCallback)((e=>{g(),null==p||p(e)}),[g,p]),pe=(0,n.useCallback)((e=>{T.openMcpModal({moduleId:e.mcpServerId,initialData:e.initialData}),g()}),[g,T]),fe=(0,n.useCallback)((async e=>{const{type:t,mcpServerId:o,existingModuleId:n,workerId:r}=e;R(void 0);const i=Qt({type:t,mcpServerId:o,workerId:r});if(i&&D.pendingAdds.has(i))return;const a=(0,K().jK)(t);if(!a)return;const l="slack"===t?(0,V().Ay)():void 0;let d;const c=s.getDraftData()??s.getData(),u=(null==c?void 0:c.modules)??[];let p;if(n&&(p=u.find((e=>e.id===n))),!p&&"worker"===t&&r&&(p=Zt(u,r)),p||(p=u.find((e=>e.type===t))),!p&&"slack"===t&&l&&(d=await H({environment:m,moduleId:l,spaceId:s.pointer.spaceId,workflowId:s.id})),!p){const o=Qt({type:t,workerId:r});T.addPendingConnection(o);try{let n,i,c=Boolean(a.authentication);if("worker"===t&&r&&(n=Xt(r,P)),"slack"===t&&d&&(c=!1),"worker"===t&&r?i={workerId:r,workerName:Xt(r,P)}:c&&(i={state:{}}),"mail"===t){if(!(await(0,_t().ensureNotionMailAccountOrTriggerOnboarding)({environment:m,onConfirm:()=>{fe(e)}})))return void g();let t=!1;try{const e=await m.api.callApi({eventName:"initializeMailModuleConnection",environment:m,data:{spaceId:s.pointer.spaceId}});if("success"===e.type&&"success"===e.data.type){const t={};for(const n of e.data.emailAddresses)t[n.email]=Ct().zy;const{creatorEmail:o}=e.data,r=(0,Ct().p$)(o,e.data.emailAddresses),a=r?[r.emailAccountId]:[];i={connectionPointer:e.data.connectionPointer,creatorEmail:e.data.creatorEmail,emailAddresses:e.data.emailAddresses,scopes:["read","write"],emailPermissionSettings:t,selectedEmailAccountIds:a},n=`Mail (${e.data.creatorEmail})`}else t=!0}catch{t=!0}if(t)return void R(f.formatMessage(Gt.mailModuleInitializationFailed))}if("calendar"===t){var w;const t=null===(w=(0,Qe()._)(m))||void 0===w?void 0:w.getEmail();if(z&&0===G.length)return F(e),void X();if(t&&G.length>0){const e=(0,jt().lf)(t,G);if(e){const t=(0,Dt().Y)().getCalendarsForAccount(e.id),o=t.find((e=>e.primary))??t[0];o&&(i={defaultCalendar:{accountId:e.id,calendarId:o.id}})}}}"slack"===t&&d&&(i={...i??{},connectionPointer:d});const u=(0,K().r4)({type:t,name:n,definition:a,intl:f,id:l,state:i});(0,Y().gn)({environment:m,tool:t,workflowId:s.id}),q().saveModule({workflowStore:s,module:u,environment:m}),c?ge(u):(T.addConnection(o),g())}finally{const e=Qt({type:t,workerId:r});T.removePendingConnection(e)}}}),[f,s,m,ge,g,D.pendingAdds,T,P,z,G,X]),me=(0,n.useCallback)((e=>{T.removeConnection(e)}),[T]),we=(0,n.useCallback)((()=>{T.openMcpModal({}),g()}),[g,T]),ve=(0,n.useCallback)((()=>{const e=At().ZO(window.location.href),t=At().O$(e,{target:"aiconnectors_custom_mcp"});(0,Pt().navigate)({environment:m,url:t})}),[m]),he=(0,n.useCallback)((()=>{I?we():M&&ve()}),[ve,we,I,M]),ye=(0,n.useCallback)((()=>{T.closeMcpModal()}),[T]),ke=(0,n.useCallback)((e=>{if(!h)return;const t=O().L3.fromPointerLike({table:Mt().yM,id:e,spaceId:h.getSpaceId()}),o=kt().P.createChildStore(h,t),n=o.getData();if(!n)return;const r=Boolean(n.connectionPointer),i={id:e,...(0,Ee().Up)(n,["name","serverUrl","serverIconUrl","officialName"]),workflowModuleStore:o,hasExternalConnection:r},a=ue(i);(0,Y().gn)({environment:m,tool:"mcpServer",workflowId:s.id}),q().saveModule({workflowStore:s,module:a,environment:m}),T.addConnection(e)}),[h,s,m,ue,T]),xe=(0,n.useCallback)((()=>{T.clearAddedConnections(),J(),F(void 0),g()}),[g,T,J]),Se=(0,n.useCallback)(((e,t)=>function(e){const{existingModules:t,connectionType:o,connectionId:n}=e;var r,i;if("module"===o)return null===(r=t.find((e=>e.type===n)))||void 0===r?void 0:r.id;if("mcpServer"===o){const e=t.find((e=>"mcpServer"===e.type&&e.id===n));return null==e?void 0:e.id}return"worker"===o?null===(i=Zt(t,n))||void 0===i?void 0:i.id:void 0}({existingModules:se,connectionType:e,connectionId:t})),[se]),be=(0,n.useMemo)((()=>A?le.flatMap((e=>"mcpServer"!==e.type?[]:[Yt(e)])):[]),[le,A]),Me=Ht({availableModules:ae,existingMcpServers:be,existingModules:se,currentAgentMcpUrls:de,isMcpServerModuleAvailable:A,workersById:P,availableCapabilities:U,getExistingModuleId:Se,preconfiguredServers:ee,preconfiguredServerUrls:te}),je=(0,n.useMemo)((()=>{const e=[];return Me.modules.forEach((t=>{var o;const n=null===(o=ae.find((e=>e.type===t.moduleType)))||void 0===o?void 0:o.sharedModule;e.push({...t,icon:null==n?void 0:n.getIcon()({width:$t,height:$t})})})),e.sort(((e,t)=>e.name<t.name?-1:1)),Me.existingMcpServers.items.forEach((t=>{const o=le.find((e=>"mcpServer"===e.type&&e.id===t.id));e.push({...t,type:"mcpServer",icon:(0,re.jsx)(Lt().X,{iconUrl:t.serverIconUrl,serverUrl:t.serverUrl,serverName:t.name,size:$t}),url:t.serverUrl,tagline:t.tagline,moduleValue:o})})),Me.preconfiguredMcpServers.forEach((t=>{const o=se.find((e=>{var o;if("mcpServer"!==e.type)return!1;const n=null===(o=e.state)||void 0===o?void 0:o.serverUrl;return!!n&&(0,Ge().Yl)(n)===(0,Ge().Yl)(t.serverUrl)})),n=Boolean((null==o?void 0:o.state)&&"connectionPointer"in o.state&&o.state.connectionPointer),r=(0,re.jsx)(Lt().X,{iconUrl:t.iconUrl,serverUrl:t.serverUrl,serverName:t.name,size:$t});e.push({id:t.id,type:"mcpServer",name:t.name,icon:r,url:t.serverUrl,mcpServerId:void 0,existingModuleId:null==o?void 0:o.id,hasExternalConnection:n,hasDuplicateUrl:t.hasDuplicateUrl,isPreconfigured:!0,moduleValue:o,tagline:t.tagline})})),Me.workers.forEach((t=>{var o;const n=ae.find((e=>"worker"===e.type));e.push({...t,icon:null==n||null===(o=n.sharedModule)||void 0===o?void 0:o.getIcon()({width:$t,height:$t})})})),e.sort(((e,t)=>{const o=Jt(e),n=Jt(t);return o===n?e.name.localeCompare(t.name):o-n})),e}),[Me,ae,se,le]),Ce=(0,n.useCallback)((e=>D.addedConnections.has(e)),[D.addedConnections]);return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(yt().a,{ariaLabel:f.formatMessage(Gt.modalAriaLabel),open:u,onDismiss:xe,render:()=>(0,re.jsxs)("div",{style:oe.modalContent,children:[(0,re.jsxs)("div",{style:oe.header,children:[(0,re.jsx)("div",{style:oe.headerIcon,children:(0,re.jsx)(w().I,{icon:bt().c,size:ie().Ev.xl})}),(0,re.jsx)(y().D,{styleKey:"titleSm",children:(0,re.jsx)(B().sA,{...Gt.title})}),(0,re.jsx)(y().D,{styleKey:"bodySm",colorVariant:"secondary",children:(0,re.jsx)(B().sA,{...A?Gt.subtitleWithMcp:Gt.subtitle})})]}),(0,re.jsxs)("div",{style:oe.connectionsList,children:[N?(0,re.jsx)(y().D,{style:oe.errorMessage,styleKey:"bodySm",colorPalette:"red",colorVariant:"primary",children:N}):null,je.map(((e,t)=>{let o;e.moduleType&&(o=Qt({type:e.moduleType,mcpServerId:e.mcpServerId,workerId:e.workerId}));const r="calendar"===e.moduleType&&$||Boolean(o&&D.pendingAdds.has(o));return(0,re.jsxs)(n.Fragment,{children:[t>0?(0,re.jsx)("hr",{style:oe.divider}):null,(0,re.jsx)(Ot,{connection:e,isAdded:Ce(e.id),onAdd:fe,onRemove:me,onTriggerAuth:ge,onTriggerMcpAuth:pe,workflowStore:s,isPendingAdd:r})]},e.id)}))]}),(0,re.jsxs)("div",{style:oe.footer,children:[(0,re.jsx)(xt().A,{colorPalette:"gray",onClick:xe,style:oe.cancelButton,children:(0,re.jsx)(B().sA,{...Gt.cancel})}),A?I||M?(0,re.jsx)(x().E,{colorPalette:"gray",iconLeading:{icon:I?C().plusSmallIcon:St().gearSmallIcon,size:"sm"},onClick:he,size:"md",style:oe.customMcpButton,children:(0,re.jsx)(B().sA,{...I?Gt.customMcp:Gt.enableCustomMcp})}):(0,re.jsx)(S().m,{placement:"top",renderTooltip:()=>(0,re.jsx)(B().sA,{...Gt.customMcpDisabledTooltip}),render:e=>(0,re.jsx)("span",{...e,children:(0,re.jsx)(x().E,{colorPalette:"gray",iconLeading:{icon:C().plusSmallIcon,size:"sm"},onClick:()=>{},disabled:!0,size:"md",style:oe.customMcpButton,children:(0,re.jsx)(B().sA,{...Gt.customMcp})})})}):void 0]})]})}),D.isMcpModalOpen&&h&&ne?(0,re.jsx)(Xe().Z,{isOpen:D.isMcpModalOpen,onClose:ye,spaceViewStore:h,workflowId:s.id,currentUserPointer:ne,existingModuleId:D.mcpModuleIdToConnect,initialName:null===(t=D.mcpModalInitialData)||void 0===t?void 0:t.name,initialUrl:null===(o=D.mcpModalInitialData)||void 0===o?void 0:o.url,existingAgentModules:ce,onSuccess:ke}):void 0]})}var to=()=>o(499790);const oo=(0,B().YK)({title:{id:"workflow.agent.permissionMode.title",defaultMessage:"Permissions"},internalExperimentBadge:{id:"workflow.agent.permissionMode.internalExperimentBadge",defaultMessage:"Internal experiment"},modeBotActorLabel:{id:"workflow.agent.permissionMode.botActor.label",defaultMessage:"Agent is a user"},modeBotActorDescription:{id:"workflow.agent.permissionMode.botActor.description",defaultMessage:"The agent is its own user. It may reveal information that the user talking to it does not have access to."},modeStrictLabel:{id:"workflow.agent.permissionMode.strictMode.label",defaultMessage:"Strict mode"},modeStrictDescription:{id:"workflow.agent.permissionMode.strictMode.description",defaultMessage:"Requires that the user talking to the agent has permission to all the resources the agent can use."},modeEndUserLabel:{id:"workflow.agent.permissionMode.endUser.label",defaultMessage:"As end user"},modeEndUserDescription:{id:"workflow.agent.permissionMode.endUser.description",defaultMessage:"Runs with the user`s permissions. Has access to everything the user has access to. Disables triggers"},modeOwnerActorLabel:{id:"workflow.agent.permissionMode.ownerActor.label",defaultMessage:"As owner"},modeOwnerActorDescription:{id:"workflow.agent.permissionMode.ownerActor.description",defaultMessage:"Runs with the owners permissions. Triggers only execute for the owner."}});function no(e){const{workflowStore:t,disabled:r=!1,permissionMode:i}=e,a=(0,d().K8)((()=>s().default.getConfig({configName:"custom_agent_permissions"}).allowed_permission_modes??["botActor"]),[]),u=(0,l().v3)(),g=(0,B().tz)(),p=(0,J().n)(t,"permissionMode"),f=t.table===I().C0?t:void 0,m=!r&&Boolean(f),w=(0,n.useMemo)((()=>[{value:"botActor",label:g.formatMessage(oo.modeBotActorLabel),description:g.formatMessage(oo.modeBotActorDescription)},{value:"strictMode",label:g.formatMessage(oo.modeStrictLabel),description:g.formatMessage(oo.modeStrictDescription)},{value:"endUserActor",label:g.formatMessage(oo.modeEndUserLabel),description:g.formatMessage(oo.modeEndUserDescription)},{value:"ownerActor",label:g.formatMessage(oo.modeOwnerActorLabel),description:g.formatMessage(oo.modeOwnerActorDescription)}]),[g]),v=(0,n.useMemo)((()=>w.filter((e=>a.includes(e.value)))),[w,a]),h=(0,c().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:16,paddingInline:16,paddingTop:8,paddingBottom:8},optionRow:{display:"flex",gap:12,alignItems:"flex-start"},label:{flex:1,display:"flex",flexDirection:"column",gap:2,marginTop:-2,cursor:m?"pointer":"default"},titleRow:{display:"flex",alignItems:"center",gap:8}})),[m]),k=(0,n.useCallback)((e=>{m&&e!==i&&f&&q().savePermissionMode({workflowStore:f,permissionMode:e,environment:u})}),[f,u,m,i]),x=a.length>1,S=!a.includes(i);return x||S?(0,re.jsx)(vt,{title:(0,re.jsxs)("div",{style:h.titleRow,children:[(0,re.jsx)(B().sA,{...oo.title}),(0,re.jsx)(ce().E,{color:"blue",content:(0,re.jsx)(B().sA,{...oo.internalExperimentBadge})})]}),style:{paddingInline:0,paddingBlock:10},hasUnpublishedChanges:p,isDimmed:!m,children:(0,re.jsx)("div",{style:h.container,children:v.map((e=>(0,re.jsxs)("div",{style:h.optionRow,children:[(0,re.jsx)(o(266685).a,{id:e.value,name:e.value,value:e.value,checked:i===e.value,onChange:()=>k(e.value),disabled:!m,selectorSize:"small"}),(0,re.jsxs)("label",{htmlFor:e.value,style:h.label,children:[(0,re.jsx)(y().D,{styleKey:"bodyMedium",colorVariant:"primary",children:e.label}),(0,re.jsx)(y().D,{styleKey:"captionRegular",colorVariant:"secondary",children:e.description})]})]},e.value)))})}):null}function ro(){const e=(0,c().IS)((()=>({error:{color:E().Tj.red.text.accentPrimary,margin:10}})),[]);return(0,re.jsx)("div",{style:e.error,children:(0,re.jsx)(B().sA,{defaultMessage:"This field is required",id:"workflowAdvancedAgent.workflowConfig.requiredErrorLabel"})})}var io=()=>o(638666);const ao=(0,B().YK)({connectToService:{id:"workflow.agent.setupChecklist.connectToService",defaultMessage:"Connect to {serviceName}"},setupTrigger:{id:"workflow.agent.setupChecklist.setupTrigger",defaultMessage:"Set up {triggerName}"},moduleSlack:{id:"workflow.agent.setupChecklist.module.slack",defaultMessage:"Slack"},moduleGoogleDrive:{id:"workflow.agent.setupChecklist.module.googledrive",defaultMessage:"Google Drive"},moduleGoogleCalendar:{id:"workflow.agent.setupChecklist.module.googlecalendar",defaultMessage:"Google Calendar"},moduleGmail:{id:"workflow.agent.setupChecklist.module.gmail",defaultMessage:"Gmail"},moduleJira:{id:"workflow.agent.setupChecklist.module.jira",defaultMessage:"Jira"},moduleLinear:{id:"workflow.agent.setupChecklist.module.linear",defaultMessage:"Linear"},moduleNotion:{id:"workflow.agent.setupChecklist.module.notion",defaultMessage:"Notion"},moduleAirtable:{id:"workflow.agent.setupChecklist.module.airtable",defaultMessage:"Airtable"},moduleZapier:{id:"workflow.agent.setupChecklist.module.zapier",defaultMessage:"Zapier"},triggerNotionPageCreated:{id:"workflow.agent.setupChecklist.trigger.notion.page.created",defaultMessage:"page created trigger"},triggerNotionPageUpdated:{id:"workflow.agent.setupChecklist.trigger.notion.page.updated",defaultMessage:"page updated trigger"},triggerNotionPageDeleted:{id:"workflow.agent.setupChecklist.trigger.notion.page.deleted",defaultMessage:"page deleted trigger"},triggerNotionDatabaseAgentUpdated:{id:"workflow.agent.setupChecklist.trigger.notion.database.agent.updated",defaultMessage:"database updated trigger"},triggerNotionPageDiscussionCommentAdded:{id:"workflow.agent.setupChecklist.trigger.notion.page.discussion.comment.added",defaultMessage:"comment added trigger"},triggerNotionAgentMentioned:{id:"workflow.agent.setupChecklist.trigger.notion.agent.mentioned",defaultMessage:"agent mention trigger"},triggerRecurrence:{id:"workflow.agent.setupChecklist.trigger.recurrence",defaultMessage:"schedule trigger"},triggerSlackMessage:{id:"workflow.agent.setupChecklist.trigger.slack.message",defaultMessage:"Slack message trigger"},triggerSlackReactionAdded:{id:"workflow.agent.setupChecklist.trigger.slack.reaction.added",defaultMessage:"Slack reaction trigger"},triggerSlackThreadCreated:{id:"workflow.agent.setupChecklist.trigger.slack.thread.created",defaultMessage:"Slack thread trigger"},triggerSlackAppMention:{id:"workflow.agent.setupChecklist.trigger.slack.app.mention",defaultMessage:"Slack mention trigger"},triggerDatabase:{id:"workflow.agent.setupChecklist.trigger.database",defaultMessage:"database trigger"},triggerPage:{id:"workflow.agent.setupChecklist.trigger.page",defaultMessage:"page trigger"},triggerSchedule:{id:"workflow.agent.setupChecklist.trigger.schedule",defaultMessage:"schedule trigger"},triggerWebhook:{id:"workflow.agent.setupChecklist.trigger.webhook",defaultMessage:"webhook trigger"}});function so(e){const{workflowStore:t}=e,r=(0,B().tz)(),i=(0,Z().N)(t,!0),{workflowValue:a}=i,s=(0,d().K8)((()=>{if(!a)return[];const e=[];for(const o of a.modules??[]){const t=(0,K().jK)(o.type);if(t&&"ready"!==t.getModuleConfigurationStatus(o,a)){const t=lo(o.type,r);e.push({type:"module",displayName:r.formatMessage(ao.connectToService,{serviceName:t}),moduleType:o.type})}}for(const o of a.triggers??[])if(!(0,$().VB)(o)){var t;const n=null===(t=o.state)||void 0===t?void 0:t.type;if(n){const t=co(n,r);e.push({type:"trigger",displayName:r.formatMessage(ao.setupTrigger,{triggerName:t}),trigger:o})}}return e}),[a,r]),l=(0,n.useCallback)((async e=>{await(0,io().B)({workflowOrArtifactStore:t,triggerId:e.id,appearance:"editTrigger"})}),[t]),g=(0,n.useCallback)((()=>{const e=document.querySelector('[data-section="tools-and-access"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})}),[]),p=(0,n.useCallback)((e=>{"trigger"===e.type&&e.trigger?l(e.trigger).catch((()=>{})):"module"===e.type&&g()}),[l,g]),f=(0,c().IS)((()=>({container:{backgroundColor:E().Tj.blue.background.primary,borderRadius:12,padding:10},header:{height:32,paddingInline:10,display:"flex",alignItems:"center",gap:8,color:E().Tj.blue.text.accentPrimary},button:{justifyContent:"flex-start",paddingInline:10,fontWeight:400},hoveredButton:{background:E().Tj.blue.background.primaryTranslucent},pressedButton:{background:E().Tj.blue.background.secondaryTranslucent}})),[]);return 0===s.length?null:(0,re.jsxs)("div",{style:f.container,children:[(0,re.jsx)("div",{style:f.header,children:(0,re.jsx)(y().D,{styleKey:"bodyMedium",children:(0,re.jsx)(B().sA,{defaultMessage:"Finish Setup",id:"workflow.agent.setupChecklist.title"})})}),(0,re.jsx)(u().Y1,{direction:"vertical",gap:2,width:"hug",children:s.map(((e,t)=>(0,re.jsx)(h().p,{size:"lg",onClick:()=>p(e),iconLeading:{icon:o(216296).circleIcon,colorVariant:"secondary"},style:f.button,hoveredStyle:f.hoveredButton,pressedStyle:f.pressedButton,children:e.displayName},t)))})]})}function lo(e,t){switch(e){case"slack":return t.formatMessage(ao.moduleSlack);case"googledrive":return t.formatMessage(ao.moduleGoogleDrive);case"googlecalendar":return t.formatMessage(ao.moduleGoogleCalendar);case"gmail":return t.formatMessage(ao.moduleGmail);case"jira":return t.formatMessage(ao.moduleJira);case"linear":return t.formatMessage(ao.moduleLinear);case"notion":return t.formatMessage(ao.moduleNotion);case"airtable":return t.formatMessage(ao.moduleAirtable);case"zapier":return t.formatMessage(ao.moduleZapier);default:return e.charAt(0).toUpperCase()+e.slice(1)}}function co(e,t){switch(e){case"notion.page.created":return t.formatMessage(ao.triggerNotionPageCreated);case"notion.page.updated":return t.formatMessage(ao.triggerNotionPageUpdated);case"notion.page.deleted":return t.formatMessage(ao.triggerNotionPageDeleted);case"notion.database.agent.updated":return t.formatMessage(ao.triggerNotionDatabaseAgentUpdated);case"notion.page.discussion.comment.added":return t.formatMessage(ao.triggerNotionPageDiscussionCommentAdded);case"notion.agent.mentioned":return t.formatMessage(ao.triggerNotionAgentMentioned);case"recurrence":return t.formatMessage(ao.triggerRecurrence);case"slack.message":return t.formatMessage(ao.triggerSlackMessage);case"slack.reaction.added":return t.formatMessage(ao.triggerSlackReactionAdded);case"slack.thread.created":return t.formatMessage(ao.triggerSlackThreadCreated);case"slack.app.mention":return t.formatMessage(ao.triggerSlackAppMention);case"database":return t.formatMessage(ao.triggerDatabase);case"page":return t.formatMessage(ao.triggerPage);case"schedule":return t.formatMessage(ao.triggerSchedule);case"webhook":return t.formatMessage(ao.triggerWebhook);default:return`${e.split(".").slice(-1)[0].replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").toLowerCase()} trigger`}}const uo=(0,B().YK)({templateTitle:{id:"workflow.agent.template.title",defaultMessage:"Templates (admin only)"},templateLabel:{id:"workflow.agent.template.label",defaultMessage:"Template mode"},templateToggleAria:{id:"workflow.agent.template.toggleAria",defaultMessage:"Toggle template mode"}});function go(e){const{workflowStore:t,disabled:o=!1}=e,r=(0,l().v3)(),i=(0,B().tz)(),a=(0,d().K8)((()=>t.getIsTemplate()),[t]),s=(0,d().K8)((()=>(0,X().Ke)()),[]),u=s||a,g=(0,d().K8)((()=>t.canEdit()),[t]),p=(0,n.useCallback)((()=>{g&&s&&q().saveIsTemplate({environment:r,workflowStore:t,isTemplate:!a})}),[r,t,a,g,s]),f=(0,c().IS)((()=>({row:{display:"flex",alignItems:"center",justifyContent:"space-between",minHeight:48,paddingInline:16},rowLabel:{display:"flex",alignItems:"center",gap:8}})),[]);return u?(0,re.jsx)(vt,{title:(0,re.jsx)(B().sA,{...uo.templateTitle}),hasUnpublishedChanges:!1,isDimmed:o,style:{paddingInline:0,paddingBlock:0},children:(0,re.jsxs)("div",{style:f.row,children:[(0,re.jsx)("div",{style:f.rowLabel,children:(0,re.jsx)(y().D,{styleKey:"bodyRegular",children:(0,re.jsx)(B().sA,{...uo.templateLabel})})}),(0,re.jsx)(k().A,{on:a,onClick:p,disabled:o||!g||!s,"aria-label":i.formatMessage(uo.templateToggleAria)})]})}):null}const po={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.26 15.25",svg:(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)("path",{d:"M10 6.375c.345 0 .625.28.625.625v2.375H13a.625.625 0 1 1 0 1.25h-2.375V13a.625.625 0 1 1-1.25 0v-2.375H7a.625.625 0 1 1 0-1.25h2.375V7c0-.345.28-.625.625-.625"}),(0,re.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 1 0 0 12.75 6.375 6.375 0 0 0 0-12.75"})]})},fo=(0,ie().wt)("plusCircle",po,"default");var mo=()=>o(717137),wo=()=>o(833744),vo=()=>o(819121),ho=()=>o(93583),yo=()=>o(829098),ko=()=>o(31511);function xo(e){const{value:t,index:o,onSave:r,onRemove:i,disabled:a=!1}=e,s=(0,B().tz)(),d=(0,l().v3)(),[u,g]=(0,n.useState)(!1),[p,f]=(0,n.useState)(!1),[m,w]=(0,n.useState)(t),h=(0,n.useRef)(null),k=(0,n.useRef)(null),[x,S]=(0,vo().A)(),b=(0,ho().A)(k,x),M=yo().U.bodyRegular,j=(0,c().IS)((()=>({pill:{display:"flex",alignItems:"center",gap:6,borderRadius:100,paddingInline:"12px 6px",paddingBlock:6,position:"relative",minHeight:32,outline:"none",flexShrink:0,...p?{width:200,backgroundColor:E().Tj.background.tertiary}:{maxWidth:200,backgroundColor:u?E().Tj.background.tertiary:E().Tj.background.secondary},...d.device.isDesktop&&S&&{boxShadow:E().Tj.buttonBlueFocusRing}},pillText:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:a?"default":"text"},input:{border:"none",outline:"none",...M,flex:1,minWidth:0},actionButton:{borderRadius:100,width:20,height:20,flexShrink:0}})),[a,d.device.isDesktop,S,M,p,u]),C=(0,n.useCallback)((()=>{g(!0)}),[]),I=(0,n.useCallback)((()=>{g(!1)}),[]),A=(0,n.useCallback)((e=>{e.stopPropagation(),a||p||(f(!0),w(t),requestAnimationFrame((()=>{var e,t;null===(e=h.current)||void 0===e||e.focus(),null===(t=h.current)||void 0===t||t.select()})))}),[a,p,t]),T=(0,n.useCallback)((e=>{e.stopPropagation();const n=m.trim();n&&n!==t&&r(o,n),f(!1),g(!1)}),[m,t,o,r]),D=(0,n.useCallback)((()=>{w(t),f(!1),g(!1)}),[t]),P=(0,n.useCallback)((e=>{"Enter"===e.key&&(e.preventDefault(),T(e))}),[T]),_=(0,n.useCallback)((e=>{"Enter"!==e.key||p||a||(e.preventDefault(),A(e))}),[p,a,A]),U=(0,n.useCallback)((e=>{w(e.target.value)}),[]),L=(0,n.useCallback)((e=>{!e.currentTarget.contains(e.relatedTarget)&&p&&D()}),[D,p]),N=(0,n.useCallback)((e=>{e.stopPropagation(),i(o)}),[i,o]);return(0,wo().L)({active:p,closeHandler:D,ref:k}),(0,re.jsx)("div",{ref:b,style:j.pill,onMouseEnter:C,onMouseLeave:I,onClick:A,onKeyDown:_,onBlur:L,tabIndex:a?-1:0,role:"button","aria-label":s.formatMessage({defaultMessage:"Edit conversation starter",id:"workflow.agent.conversationStarters.editPill"}),children:p?(0,re.jsxs)(mo().A,{debugName:"ConversationStarterPill",capture:p,children:[(0,re.jsx)(ko().A,{ref:h,value:m,onChange:U,onKeyDown:P,format:"transparent",style:j.input,inputStyle:j.input,maxlength:100,autoFocus:!0}),(0,re.jsx)(v().A,{icon:Nt().checkmarkSmallIcon,onClick:T,size:"sm",colorVariant:"primary",style:j.actionButton,ariaLabel:s.formatMessage({defaultMessage:"Save",id:"workflow.agent.conversationStarters.save"})})]}):(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(y().D,{styleKey:"bodyRegular",style:j.pillText,textOverflow:"ellipsis",children:t}),(0,re.jsx)(v().A,{icon:Be().xMarkSmallIcon,onClick:N,size:"sm",colorVariant:"secondary",disabled:a,style:j.actionButton,ariaLabel:s.formatMessage({defaultMessage:"Remove",id:"workflow.agent.conversationStarters.remove"})})]})})}function So(e){const{workflowStore:t,disabled:r=!1}=e,i=(0,l().v3)(),a=(0,B().tz)(),[s,u]=(0,n.useState)(""),g=(0,J().n)(t,"conversationStarters"),p=(0,d().K8)((()=>(t.table,I().C0,t.getDataStore().getKeyStore("conversationStarters"))),[t]),f=(0,d().K8)((()=>{const e=(e=>Array.isArray(e)?e.filter((e=>"string"==typeof e)):[])(null==p?void 0:p.getValue());return e}),[p]),m=(0,c().IS)((()=>({outerContainer:{display:"flex",flexDirection:"column",gap:12},inputContainer:{display:"flex",alignItems:"center",gap:8,position:"relative",paddingInlineEnd:6},inputWrapper:{flex:1},input:{backgroundColor:"transparent",borderRadius:14,border:"none"},addButton:{flexShrink:0,borderRadius:8},pillsContainer:{display:"flex",flexWrap:"wrap",gap:12}})),[]),h=(0,n.useCallback)((e=>{t.table===I().C0&&q().saveConversationStarters({workflowStore:t,conversationStarters:e.length>0?e:void 0,environment:i})}),[i,t]),y=(0,n.useCallback)((()=>{const e=s.trim();if(e&&!f.includes(e)){const t=[...f,e];h(t),u("")}}),[s,f,h]),k=(0,n.useCallback)((e=>{const t=f.filter(((t,o)=>o!==e));h(t)}),[f,h]),x=(0,n.useCallback)(((e,t)=>{const o=[...f];o[e]=t,h(o)}),[f,h]),S=(0,n.useCallback)((e=>{"Enter"===e.key&&(e.preventDefault(),y())}),[y]),b=(0,n.useCallback)((e=>{u(e.target.value)}),[]);return(0,re.jsxs)("div",{style:m.outerContainer,children:[(0,re.jsx)(vt,{title:(0,re.jsx)(B().sA,{defaultMessage:"Conversation starters",id:"workflow.agent.conversationStarters.title"}),style:{paddingBlock:11,paddingInlineEnd:0},hasUnpublishedChanges:g,isDimmed:r,children:(0,re.jsxs)("div",{style:m.inputContainer,children:[(0,re.jsx)("div",{style:m.inputWrapper,children:(0,re.jsx)(o(323756).E,{value:s,onChange:b,onKeyDown:S,placeholder:"What should people talk to this agent about...",inputStyle:m.input,disabled:r,debugName:"ConversationStarterInput",autosizeMinHeight:22})}),(0,re.jsx)(v().A,{icon:()=>(0,re.jsx)(w().I,{icon:fo,size:"default"}),onClick:y,size:"md",disabled:r||!s.trim(),style:m.addButton,ariaLabel:a.formatMessage({defaultMessage:"Add conversation starter",id:"workflow.agent.conversationStarters.addButton"})})]})}),f.length>0?(0,re.jsx)("div",{style:m.pillsContainer,children:f.map(((e,t)=>(0,re.jsx)(xo,{value:e,index:t,onSave:x,onRemove:k,disabled:r},t)))}):null]})}o(908872);var bo=()=>o(135168);const Mo={viewBox:"0 0 16 16",fittedViewBox:"1.87 1.87 12.8 12.8",svg:(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)("path",{d:"M12.848 2.8a3.145 3.145 0 0 0-4.448 0L6.918 4.283a.625.625 0 0 0 .884.883l1.482-1.482c.74-.74 1.94-.74 2.68 0l.294.294c.74.74.74 1.94 0 2.68l-1.092 1.093.197-.012a3.9 3.9 0 0 1 1.366.16l.043.014.37-.37a3.145 3.145 0 0 0 0-4.449z"}),(0,re.jsx)("path",{d:"M10.472 5.47a.625.625 0 0 0-.884 0L5.229 9.83a.625.625 0 1 0 .884.883l4.359-4.359a.625.625 0 0 0 0-.883"}),(0,re.jsx)("path",{d:"M5.167 6.918a.625.625 0 0 0-.884 0L2.8 8.4a3.146 3.146 0 0 0 0 4.448l.294.294a3.145 3.145 0 0 0 4.449 0l.37-.37-.013-.043a3.9 3.9 0 0 1-.16-1.366l.011-.197-1.092 1.092c-.74.74-1.94.74-2.68 0l-.295-.294c-.74-.74-.74-1.94 0-2.68L5.167 7.8a.625.625 0 0 0 0-.883M11.6 8.525A3.073 3.073 0 0 0 8.525 11.6 3.075 3.075 0 1 0 11.6 8.525m-.425 1.409a.425.425 0 0 1 .85 0v1.241h1.242a.425.425 0 0 1 0 .85h-1.242v1.242a.425.425 0 1 1-.85 0v-1.242H9.934a.425.425 0 0 1 0-.85h1.241z"})]})},jo=(0,ie().wt)("linkBadgePlusSmall",Mo,"small");var Co=()=>o(179034),Io=()=>o(763824),Ao=()=>o(347160),To=()=>o(350824),Do=(o(814603),o(147566),o(198721),()=>o(402137));const Po=new(o(29923).R)({key:"custom-agent-favicon-cache",namespace:"workflows",important:!1,trackingType:"preference"});function _o(e){const{domain:t,faviconUrl:o}=e,[r,i]=(0,n.useState)(!1);(0,n.useEffect)((()=>{i(!1)}),[o]);const a={width:16,height:16,display:"block"};return r?(0,re.jsx)("span",{style:{width:16,height:16,display:"grid",placeItems:"center"},children:(0,re.jsx)(w().I,{icon:M().globeSmallIcon,style:a})}):(0,re.jsx)("span",{style:{width:16,height:16,display:"grid",placeItems:"center"},children:(0,re.jsx)("img",{src:o||`https://${t}/favicon.ico`,width:16,height:16,onError:()=>i(!0),alt:"",style:a})})}function Bo({notionModule:e,workflowStore:t,threadStore:o,disabled:r=!1}){const i=(0,l().v3)(),a=(0,B().tz)(),[s,u]=(0,n.useState)(""),[p,f]=(0,n.useState)(),[m,v]=(0,n.useState)(!1),h=(0,d().O$)(Po),[k,x]=(0,n.useState)(h??{}),S=(0,d().K8)((()=>(0,bo().f)(t)),[t]),b=(0,c().eP)(),M=(0,c().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:4,marginInlineStart:24},button:{width:"100%",paddingInlineStart:10,gap:8,display:"flex",alignItems:"center",height:28,borderRadius:6,"--pseudoHover--background":E().Tj.background.secondaryTranslucent,"--pseudoActive--background":(0,g().yZ)({color:E().Tj.background.secondaryTranslucent,mode:b})},buttonFocused:{background:E().Tj.background.secondaryTranslucent},input:{flex:1,"--c-inpBluFocRin":"none"},error:{fontSize:12,paddingInlineStart:10},permissionRow:{display:"flex",alignItems:"center",borderRadius:6,justifyContent:"space-between",height:28,paddingInlineStart:10},resourceInfo:{display:"flex",alignItems:"center",gap:8,flex:1,fontWeight:U().Wy.regular},actionsContainer:{display:"flex",alignItems:"center",gap:12},permissionRoleSelect:{fontSize:12,color:E().Tj.text.secondary,fontWeight:U().Wy.medium},enterHint:{fontSize:12,color:E().Tj.text.tertiary,fontWeight:U().Wy.medium,paddingInline:8,marginInlineEnd:-4}})),[b]),j=n.useMemo((()=>{var t;const o=null===(t=e.permissions)||void 0===t?void 0:t.find((e=>"search"===e.type&&"web"===e.identifier.type));return"search"===(null==o?void 0:o.type)&&"web"===o.identifier.type&&o.identifier.allowedDomains||[]}),[e.permissions]);(0,n.useEffect)((()=>{(async()=>{const e=j.filter((e=>!k[e]));if(0===e.length)return;const t=(await(0,Io().lX)(e,10,(async e=>{try{const t=await W().callApi({eventName:"getDataForLinkMention",environment:i,data:{url:`https://${e}`,source:"custom_agent_domain_allowlist"}});if("success"===t.type&&"favicon_url"in t.data&&t.data.favicon_url)return{domain:e,url:t.data.favicon_url}}catch(p){}return null}))).filter((e=>null!==e)).reduce(((e,t)=>(e[t.domain]=t.url,e)),{});if(Object.keys(t).length>0){const e={...k,...t};x(e),Po.setState(e)}})()}),[j,i,k]);const C=(0,n.useCallback)((o=>{if(t.table===ne().U6)return;const n=(e.permissions||[]).filter((e=>!("search"===e.type&&"web"===e.identifier.type))),r={moduleType:"notion",type:"search",identifier:{type:"web",...o.length>0?{allowedDomains:o}:{}},actions:["allow"]},a={...e,permissions:[...n,r]};q().saveModule({environment:i,workflowStore:t,module:a})}),[i,e,t]),I=(0,n.useCallback)((()=>{const e=function(e){try{const t=e.trim().startsWith("http")?e.trim():`https://${e.trim()}`;return new URL(t).hostname.toLowerCase().replace(/^www\./,"")}catch{return e.trim().toLowerCase().replace(/^www\./,"")}}(s);var t;e?(t=e,(0,Do().w)(t)?j.includes(e)?f(a.formatMessage({id:"workflow.agent.domainAllowlist.error.duplicate",defaultMessage:"Domain already added"})):(C([...j,e]),u(""),f(void 0)):f(a.formatMessage({id:"workflow.agent.domainAllowlist.error.invalid",defaultMessage:"Invalid domain format. Example: arxiv.org"}))):f(a.formatMessage({id:"workflow.agent.domainAllowlist.error.empty",defaultMessage:"Please enter a domain"}))}),[s,j,C,a]),A=(0,n.useCallback)((e=>{C(j.filter((t=>t!==e)))}),[j,C]),T=(0,n.useCallback)((e=>{"Enter"===e.key&&(e.preventDefault(),I())}),[I]);return(0,re.jsxs)("div",{style:M.container,children:[j.map((e=>(0,re.jsxs)("div",{style:M.permissionRow,children:[(0,re.jsxs)("div",{style:M.resourceInfo,children:[(0,re.jsx)(_o,{domain:e,faviconUrl:k[e]}),(0,re.jsx)(y().D,{children:e})]}),(0,re.jsx)("div",{style:M.actionsContainer,children:(0,re.jsx)(Ao().Ay,{spaceStore:S,table:Co().ev,type:"user_permission",role:"reader",availableRoleItems:To().PA,onChange:t=>{"none"===t&&A(e)},upgradeButtonName:"user_permission_item",alignmentToOrigin:"end",isNoneOverride:!0,buttonStyle:M.permissionRoleSelect})})]},e))),r?null:(0,re.jsx)(mo().A,{debugName:"DomainAllowlistInput",capture:m,allowCopyPaste:!1,children:(0,re.jsxs)("div",{className:"pseudoHover pseudoActive",style:{...M.button,...m?M.buttonFocused:{}},children:[(0,re.jsx)(ko().A,{value:s,onChange:e=>{u(e.target.value),f(void 0)},onKeyDown:T,onFocus:()=>v(!0),onBlur:()=>v(!1),format:"transparent",left:(0,re.jsx)("span",{style:{width:16,height:16,display:"grid",placeItems:"center"},children:(0,re.jsx)(w().I,{icon:jo,size:"sm",colorVariant:"secondary"})}),placeholder:a.formatMessage(0===j.length?{id:"workflow.agent.domainAllowlist.placeholder.empty",defaultMessage:"Restrict to domain, e.g. arxiv.org"}:{id:"workflow.agent.domainAllowlist.placeholder.withDomains",defaultMessage:"Add to restricted domains, e.g. arxiv.org"}),disabled:r,style:M.input}),s.trim()?(0,re.jsx)("div",{style:M.actionsContainer,children:(0,re.jsx)("span",{style:M.enterHint,children:"Enter "})}):void 0]})}),p?(0,re.jsx)("div",{style:M.error,children:(0,re.jsx)(y().D,{children:p})}):null]})}var Eo=()=>o(476195);const Uo=(0,B().YK)({experimentalFeaturesToggleShow:{id:"workflow.agent.experimentalFeatures.toggle.show",defaultMessage:"Experimental features"},experimentalFeaturesToggleHide:{id:"workflow.agent.experimentalFeatures.toggle.hide",defaultMessage:"Hide experimental features"},scriptAgentLabel:{id:"workflow.agent.experimentalFeatures.scriptAgent",defaultMessage:"Script agent"},scriptAgentToggleAria:{id:"workflow.agent.experimentalFeatures.scriptAgent.toggleAria",defaultMessage:"Toggle script agent"},scriptAgentAdvancedLabel:{id:"workflow.agent.experimentalFeatures.scriptAgentAdvanced",defaultMessage:"Script agent (advanced)"},scriptAgentAdvancedToggleAria:{id:"workflow.agent.experimentalFeatures.scriptAgentAdvanced.toggleAria",defaultMessage:"Toggle script agent advanced"}});function Lo(){if("undefined"==typeof window)return!1;const e=Reflect.get(window,"Meticulous");if(null==e)return!1;if("object"==typeof e){const t=Reflect.get(e,"isRunningAsTest");if("boolean"==typeof t)return t;if("function"==typeof t)try{const o=t.call(e);if("boolean"==typeof o)return o}catch{return!0}return!0}return"function"==typeof e}function No(e,t){const r=(0,l().v3)(),i=(0,Z().N)(e,!0),a=(0,d().K8)((()=>{var t;if(e.table!==ne().U6)return null===(t=e.getPublishedArtifactStore())||void 0===t?void 0:t.getData()}),[e]),s=(0,n.useMemo)((()=>(0,o(760342).Z0)({workflowData:i.workflowValue,publishedWorkflowData:a})),[i.workflowValue,a]),c=(null==s?void 0:s.enableScriptAgent)??!1,u=(null==s?void 0:s.enableScriptAgentAdvanced)??!1,g=(0,J().n)(e,"experimental"),p=e.table!==ne().U6,f=t||!p,m="undefined"!=typeof window?(()=>{const e=Reflect.get(window,"CONFIG");return"object"==typeof e&&null!==e?Reflect.get(e,"env"):void 0})():void 0,w="undefined"!=typeof window?window.location.hostname:void 0,v="string"==typeof w&&w.includes("meticulous"),[h,y]=(0,n.useState)((()=>"undefined"!=typeof window&&Lo()));(0,n.useEffect)((()=>{if(h||"undefined"==typeof window)return;let e=!1,t=0;const o=window.setInterval((()=>{if(Lo())return window.clearInterval(o),void(e||y(!0));t+=1,t>=20&&window.clearInterval(o)}),200);return()=>{e=!0,window.clearInterval(o)}}),[h]);var k;const x="string"==typeof(k=m)&&("local"===k||"development"===k||"staging"===k)&&!v&&!h,S=(0,n.useCallback)((()=>{e.table===I().C0&&q().setScriptAgentOverride({environment:r,workflowStore:e,enabled:!c})}),[r,e,c]),b=(0,n.useCallback)((()=>{e.table===I().C0&&q().setScriptAgentAdvancedOverride({environment:r,workflowStore:e,enabled:!u})}),[r,e,u]);return{showExperimentalFeatures:x,scriptAgentEnabled:c,scriptAgentAdvancedEnabled:u,experimentalSectionDisabled:f,hasExperimentalChanges:g,handleScriptAgentToggle:S,handleScriptAgentAdvancedToggle:b}}function Ro(e){const{workflowStore:t,experimentalContext:r}=e,i=(0,B().tz)(),a=(0,d().K8)((()=>t.canEdit()),[t]),s=(0,c().eP)(),l=(0,c().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:4,marginTop:8},panel:{borderWidth:1,borderStyle:"solid",borderColor:E().Tj.border.secondary,borderRadius:14,padding:16,backgroundColor:"dark"===s?E().Tj.background.secondary:E().Tj.background.primary,boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.02)",display:"flex",flexDirection:"column",gap:16,opacity:a?1:.4},row:{display:"flex",alignItems:"center",justifyContent:"space-between",minHeight:32,paddingInline:10},rowLabel:{display:"flex",alignItems:"center",gap:8}})),[a,s]),{showExperimentalFeatures:u,scriptAgentEnabled:g,scriptAgentAdvancedEnabled:p,experimentalSectionDisabled:f,hasExperimentalChanges:m,handleScriptAgentToggle:v,handleScriptAgentAdvancedToggle:x}=r,[S,b]=(0,n.useState)(!1),M=(0,n.useCallback)((()=>b((e=>!e))),[]);if(!u)return null;const j=S||m?"blue":"gray";return(0,re.jsxs)("div",{style:l.container,"data-section":"experimental-features",children:[(0,re.jsx)(h().p,{onClick:M,iconLeading:{icon:S?o(534842).sparklesFillSmallIcon:o(608145).sparklesSmallIcon,size:"sm"},colorPalette:j,"aria-expanded":S,children:S?(0,re.jsx)(B().sA,{...Uo.experimentalFeaturesToggleHide}):(0,re.jsx)(B().sA,{...Uo.experimentalFeaturesToggleShow})}),S?(0,re.jsxs)("div",{style:l.panel,children:[(0,re.jsxs)("div",{style:l.row,children:[(0,re.jsxs)("div",{style:l.rowLabel,children:[(0,re.jsx)(w().I,{icon:Eo().codeSmallIcon,size:"sm"}),(0,re.jsx)(y().D,{styleKey:"bodyMedium",children:(0,re.jsx)(B().sA,{...Uo.scriptAgentLabel})})]}),(0,re.jsx)(k().A,{on:g,onClick:v,disabled:f||!a,"aria-label":i.formatMessage(Uo.scriptAgentToggleAria)})]}),(0,re.jsxs)("div",{style:l.row,children:[(0,re.jsxs)("div",{style:l.rowLabel,children:[(0,re.jsx)(w().I,{icon:Eo().codeSmallIcon,size:"sm"}),(0,re.jsx)(y().D,{styleKey:"bodyMedium",children:(0,re.jsx)(B().sA,{...Uo.scriptAgentAdvancedLabel})})]}),(0,re.jsx)(k().A,{on:p,onClick:x,disabled:f||!a,"aria-label":i.formatMessage(Uo.scriptAgentAdvancedToggleAria)})]})]}):void 0]})}var Ko=()=>o(395361),zo=()=>o(295633),Vo=()=>o(711517);const Wo=500;const Fo=(0,B().YK)({tokenCount:{id:"workflow.agent.instructions.tokenCount",defaultMessage:"~{count} tokens"},tokenCountK:{id:"workflow.agent.instructions.tokenCountK",defaultMessage:"~{count}k tokens"},tokenCountUnder100:{id:"workflow.agent.instructions.tokenCountUnder100",defaultMessage:"<100 tokens"},tooltipWithMentions:{id:"workflow.agent.instructions.tokenCountTooltip.withMentions",defaultMessage:"Estimated tokens from instructions and {count, plural, one {# @mentioned page} other {# @mentioned pages}}"},tooltipNoMentions:{id:"workflow.agent.instructions.tokenCountTooltip.noMentions",defaultMessage:"Estimated tokens from instructions"},loading:{id:"workflow.agent.instructions.tokenCountLoading",defaultMessage:"Calculating..."}});function Oo(e){const{workflowStore:t}=e,o=(0,B().tz)(),{tokenCount:r,mentionedPageCount:i,hasContent:a,isLoading:s}=function(e){const t=(0,l().v3)(),{workflowValue:o}=(0,Z().N)(e,!0),[r,i]=(0,n.useState)({tokenCount:0,mentionedPageCount:0,hasContent:!1,isLoading:!0}),a=(0,n.useRef)(void 0),s=(0,d().K8)((()=>{if((0,Vo().ap)(o.instructions))return zo().B.createChildStore(e,o.instructions)}),[o.instructions,e]),c=(0,d().K8)((()=>s?s.getLastEditedTime():(0,Vo().Zv)(o.instructions)?(0,T().q4_)((0,Vo().rr)(o.instructions)).length:0),[s,o.instructions]),u=JSON.stringify(o.modules||[]),g=(0,n.useCallback)((async()=>{if(e.table===ne().U6)return void i({tokenCount:0,mentionedPageCount:0,hasContent:!1,isLoading:!1});const o=e.getSpaceId();if(o){a.current&&a.current.abort(),a.current=new AbortController;try{var n;const r=await t.api.callApi({environment:t,eventName:"estimateInstructionsTokens",data:{workflowId:e.id,spaceId:o}});null!==(n=a.current)&&void 0!==n&&n.signal.aborted||("success"===r.type?i({tokenCount:r.data.tokenCount,mentionedPageCount:r.data.mentionedPageCount,hasContent:r.data.characterCount>0,isLoading:!1}):i((e=>({...e,isLoading:!1}))))}catch{var r;null!==(r=a.current)&&void 0!==r&&r.signal.aborted||i((e=>({...e,isLoading:!1})))}}else i({tokenCount:0,mentionedPageCount:0,hasContent:!1,isLoading:!1})}),[t,e]),p=(0,Ko().Y)((()=>{g()}),Wo);return(0,n.useEffect)((()=>{i((e=>({...e,isLoading:!0}))),p()}),[c,u,p]),(0,n.useEffect)((()=>()=>{a.current&&a.current.abort(),p.cancel()}),[p]),r}(t),u=(0,c().IS)((()=>({container:{display:"flex",alignItems:"center",cursor:"default"},text:{color:E().Tj.text.tertiary}})),[]),g=(0,n.useMemo)((()=>function(e,t,o){if(e<100&&t)return o.formatMessage(Fo.tokenCountUnder100);if(e>=1e3){const t=(e/1e3).toFixed(1),n=t.endsWith(".0")?t.slice(0,-2):t;return o.formatMessage(Fo.tokenCountK,{count:n})}return o.formatMessage(Fo.tokenCount,{count:e})}(r,a,o)),[r,a,o]),p=(0,n.useMemo)((()=>i>0?o.formatMessage(Fo.tooltipWithMentions,{count:i}):o.formatMessage(Fo.tooltipNoMentions)),[i,o]);return s&&0===r?(0,re.jsx)("div",{style:u.container,children:(0,re.jsx)(y().D,{styleKey:"captionRegular",style:u.text,children:(0,re.jsx)(B().sA,{...Fo.loading})})}):(0,re.jsx)(S().m,{placement:"top",alignment:"center",renderTooltip:()=>p,render:e=>(0,re.jsx)("div",{style:u.container,...e,children:(0,re.jsx)(y().D,{styleKey:"captionRegular",style:u.text,children:g})})})}var Ho=()=>o(128933),qo=()=>o(165358),Yo=()=>o(821983),$o=()=>o(471095),Go=()=>o(753264),Xo=()=>o(155736),Qo=()=>o(430405),Zo=()=>o(243331),Jo=()=>o(946561),en=()=>o(645200),tn=()=>o(838824);var on=()=>o(147440);const nn=(0,B().YK)({failedToConnectMail:{id:"notionMailAccountRequiredModal.failedToConnect",defaultMessage:"Failed to connect your Gmail account. Please try again."}});function rn(){const e=(0,l().v3)(),t=(0,d().O$)(on().b),[o,r]=(0,n.useState)(!1),a=(0,n.useCallback)((()=>{on().b.close()}),[]),s=(0,n.useCallback)((async()=>{r(!0);const t=async function*(e){var t;const{environment:o,from:n}=e,r=i().AppStoreSidebarSpaceViewStore.state,a=null===(t=i().default.state.currentUserStore)||void 0===t?void 0:t.getEmail(),s=null==r?void 0:r.getSpaceId();if(!a||!s||!r)return qo().log({level:"error",from:"generateNotionMailSignup",type:"unableToConnectMail - missing email or spaceId",data:{miscDataToConvertToString:{email:a,spaceId:s,hasSidebarSpaceViewStore:Boolean(r),source:n}}}),"missingEmailOrSpaceId";const l=await(0,en().II)({environment:o,email:a,source:"mail"});if("dismissedDueToCleanup"===l)return"oAuthWindowClosedDueToCleanup";if(!l)return"oAuthWindowClosedByUser";yield"signupInitiated";const d=await(0,tn().N)({environment:o,code:l.code,encryptedToken:l.encryptedToken,spaceId:s,from:n});return(0,Jo().s)()?"failed"===d.type?(qo().log({level:"error",from:"generateNotionMailSignup",type:"mailSignupFailed",data:{miscDataToConvertToString:{error:d.error,source:n}}}),"signupFailure"):(yield"signupSuccess","signupCompleted"):"wentOffline"}({environment:e,from:"agentSetup"});for(;;){const{value:e,done:o}=await t.next();switch(e){case"signupInitiated":break;case"signupSuccess":Zo().Lf.setState({...Zo().Lf.state,isBackendConnected:!0,isLoaded:!0}),on().b.setScreen("success");break;case"signupCompleted":case"oAuthWindowClosedByUser":return void r(!1);case"signupFailure":case"missingEmailOrSpaceId":case"wentOffline":return qo().log({level:"error",from:"NotionMailAccountRequiredModal",type:"failedToConnectMail",data:{miscDataToConvertToString:{value:e}}}),Ho().D6({label:(0,re.jsx)(B().sA,{...nn.failedToConnectMail})}),void r(!1);case"oAuthWindowClosedDueToCleanup":return;default:return qo().log({level:"error",from:"NotionMailAccountRequiredModal",type:"unexpectedGeneratorValue",data:{miscDataToConvertToString:{value:e}}}),void r(!1)}if(o)return void r(!1)}}),[e]),c=(0,n.useMemo)((()=>[{icon:Yo().keyFillIcon,title:(0,re.jsx)(B().sA,{id:"notionMailAccountRequiredModal.permissionNoteTitle",defaultMessage:"Gmail permissions are strictly respected"})},{icon:$o().lockFillIcon,title:(0,re.jsx)(B().sA,{id:"notionMailAccountRequiredModal.noTrainingNoteTitle",defaultMessage:"Notion does not train models on your Gmail data"})}]),[]),u=(0,n.useMemo)((()=>(0,re.jsx)(B().sA,{id:"notionMailAccountRequiredModal.oauthTitle",defaultMessage:"Connect your email to Notion"})),[]);return(0,re.jsx)(Qo().A,{connectorType:"notion-mail",title:u,notes:c,open:"introduction"===t.currentScreen,onConnect:s,onDismiss:a,isLoading:o})}const an=(0,B().YK)({successNote:{id:"notionMailAccountRequiredModal.success.note",defaultMessage:"Your custom agent can be given permission to search and modify your inbox."}});function sn(){const e=(0,d().O$)(on().b),{onConfirm:t}=e,o=(0,n.useCallback)((()=>{null==t||t(),on().b.close()}),[t]),r=(0,n.useCallback)((()=>{on().b.close()}),[]),i=(0,n.useMemo)((()=>[(0,re.jsx)(Go().L,{number:1,title:an.successNote},"note-1")]),[]);return(0,re.jsx)(Xo().v,{open:"success"===e.currentScreen,connectorType:"notion-mail",notes:i,onPrimaryButtonClick:o,onDismiss:r})}function ln(){return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(rn,{}),(0,re.jsx)(sn,{})]})}var dn=()=>o(350013),cn=()=>o(394888),un=()=>o(577914),gn=()=>o(160432),pn=()=>o(489776);function fn(e){const{isOpen:t,onClose:o,onDelete:r,script:i,workflowStore:a,disabled:s=!1,appearance:d}=e,g=(0,B().tz)(),p=(0,l().v3)(),f=(0,c().IS)((()=>({fieldGroup:{display:"flex",flexDirection:"column",gap:8},fieldLabel:{color:E().Tj.text.secondary},modalContent:{display:"flex",flexDirection:"column",gap:16},footer:{display:"flex",justifyContent:"space-between",alignItems:"center"}})),[]),m=a.table===I().C0&&!s;(0,n.useEffect)((()=>{t&&!i&&o()}),[t,o,i]);const w=(0,n.useCallback)((e=>{if(!(i&&a instanceof dn().N))return;const t=e.target.value;t!==i.name&&q().saveScript({workflowStore:a,script:{...i,name:t},environment:p})}),[p,i,a]),v=(0,n.useCallback)((e=>{if(!(i&&a instanceof dn().N))return;const t=e.target.value;t!==i.key&&q().saveScript({workflowStore:a,script:{...i,key:t},environment:p})}),[p,i,a]),k=(0,n.useCallback)((e=>{i&&e!==i.value&&a instanceof dn().N&&q().saveScript({workflowStore:a,script:{...i,value:e},environment:p})}),[p,i,a]),x=(0,n.useCallback)((()=>{m&&i&&r(i)}),[m,r,i]),S=(0,n.useCallback)((()=>{o()}),[o]),b=(0,n.useMemo)((()=>i?(0,re.jsxs)("div",{style:f.modalContent,children:[(0,re.jsxs)("div",{style:f.fieldGroup,children:[(0,re.jsx)(y().D,{styleKey:"captionRegular",style:f.fieldLabel,children:(0,re.jsx)(B().sA,{id:"workflow.agent.scripts.modal.nameLabel",defaultMessage:"Name"})}),(0,re.jsx)(ko().A,{value:i.name,onChange:w,disabled:!m,format:"default",spellCheck:!1,placeholder:g.formatMessage({id:"workflow.agent.scripts.modal.namePlaceholder",defaultMessage:"Script name"})})]}),(0,re.jsxs)("div",{style:f.fieldGroup,children:[(0,re.jsx)(y().D,{styleKey:"captionRegular",style:f.fieldLabel,children:(0,re.jsx)(B().sA,{id:"workflow.agent.scripts.modal.keyLabel",defaultMessage:"Key"})}),(0,re.jsx)(ko().A,{value:i.key,onChange:v,disabled:!m,format:"default",spellCheck:!1,placeholder:g.formatMessage({id:"workflow.agent.scripts.modal.keyPlaceholder",defaultMessage:"Script key"})})]}),(0,re.jsxs)("div",{style:f.fieldGroup,children:[(0,re.jsx)(y().D,{styleKey:"captionRegular",style:f.fieldLabel,children:(0,re.jsx)(B().sA,{id:"workflow.agent.scripts.modal.codeLabel",defaultMessage:"Code"})}),(0,re.jsx)(pn().E,{value:i.value,onChange:k,disabled:!m,language:"typescript",fillHeight:!1})]})]}):null),[k,v,w,g,m,i,f.fieldGroup,f.fieldLabel,f.modalContent]);return i?(0,re.jsx)(cn().s,{isOpen:t,onDismiss:o,onClosed:o,ariaLabel:g.formatMessage({id:"workflow.agent.scripts.modal.ariaLabel",defaultMessage:"Script settings"}),areaConstraint:{width:{type:"fixed",length:800},height:{type:"min",length:480}},render:({sizeRange:e})=>(0,re.jsxs)(u().Y1,{width:"fill",height:"fill",padding:20,gap:24,style:e,children:[(0,re.jsx)(y().D,{styleKey:"titleSemibold",children:"new"===d?(0,re.jsx)(B().sA,{id:"workflow.agent.scripts.modal.newTitle",defaultMessage:"New script"}):(0,re.jsx)(B().sA,{id:"workflow.agent.scripts.modal.editTitle",defaultMessage:"Edit script"})}),b,(0,re.jsxs)("div",{style:f.footer,children:[m?(0,re.jsx)(h().p,{colorPalette:"red",onClick:x,children:(0,re.jsx)(B().sA,{id:"workflow.agent.scripts.modal.delete",defaultMessage:"Delete script"})}):(0,re.jsx)("div",{}),(0,re.jsx)(gn().A,{colorPalette:"blue",onClick:S,disabled:!i,children:(0,re.jsx)(B().sA,{id:"workflow.agent.scripts.modal.done",defaultMessage:"Done"})})]}),(0,re.jsx)(un().R,{})]})}):null}function mn(e){const{workflowStore:t,disabled:o=!1,scriptsEnabled:r}=e,i=(0,l().v3)(),a=(0,B().tz)(),s=(0,d().K8)((()=>t instanceof dn().N&&(t.table===I().C0&&t.canEdit())),[t]),g=(0,d().K8)((()=>{const e=t.table===I().C0?t.getDraftData():t.getData(),o=null==e?void 0:e.scripts;if(!Array.isArray(o))return[];const n=[];for(const t of o)t&&t.id&&"string"==typeof t.name&&"string"==typeof t.key&&"string"==typeof t.value&&n.push(t);return n}),[t]),[p,f]=(0,n.useState)(void 0),[m,v]=(0,n.useState)("edit"),k=(0,J().n)(t,"scripts"),S=(0,c().IS)((()=>({listContainer:{display:"flex",flexDirection:"column",gap:6,paddingInline:10},scriptButton:{padding:"8px 12px",borderRadius:10,gap:8,justifyContent:"flex-start",width:"100%",display:"flex",alignItems:"center"},addButton:{marginTop:10,alignSelf:"flex-start",marginInlineStart:10,paddingInline:8}})),[]),b=(0,n.useCallback)((()=>{if(!(t instanceof dn().N&&s&&r))return;const e={id:(0,V().Ay)(),name:"",key:"",value:""};q().saveScript({workflowStore:t,script:e,environment:i}),f(e.id),v("new")}),[i,s,r,t]),M=(0,n.useCallback)((e=>{f(e),v("edit")}),[]),j=(0,n.useCallback)((()=>{f(void 0),v("edit")}),[]),A=(0,n.useCallback)((async e=>{if(!(t instanceof dn().N))return;(await Me().Gh({message:a.formatMessage({id:"workflow.agent.scripts.deleteConfirm.title",defaultMessage:"Delete script?"}),description:a.formatMessage({id:"workflow.agent.scripts.deleteConfirm.message",defaultMessage:"Deleting this script will remove it from this agent. Any triggers set to run this script will instead run the agent."}),acceptLabel:a.formatMessage({id:"workflow.agent.scripts.deleteConfirm.confirm",defaultMessage:"Delete"}),acceptColor:"red"})).accept&&(q().deleteScript({workflowStore:t,script:e,environment:i}),j())}),[i,j,a,t]),T=(0,n.useMemo)((()=>g.find((e=>e.id===p))),[p,g]);if(!r&&0===g.length)return null;const D=o||!r||!s;return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(vt,{title:(0,re.jsx)(B().sA,{id:"workflow.agent.scripts.title",defaultMessage:"Scripts"}),hasUnpublishedChanges:k,style:{paddingInline:0,paddingBlock:10},isDimmed:o,children:(0,re.jsxs)(u().Y1,{direction:"vertical",gap:8,children:[(0,re.jsx)("div",{style:S.listContainer,children:g.map((e=>(0,re.jsxs)(h().p,{style:S.scriptButton,onClick:()=>M(e.id),disabled:!s||o,size:"lg",children:[(0,re.jsx)(w().I,{icon:Eo().codeSmallIcon,size:"sm"}),(0,re.jsx)(y().D,{styleKey:"bodyMedium",children:e.name})]},e.id)))}),r?null:(0,re.jsx)(y().D,{styleKey:"captionRegular",colorVariant:"secondary",style:{paddingInline:10},children:(0,re.jsx)(B().sA,{id:"workflow.agent.scripts.disabledHelperText",defaultMessage:"Enable scripts in Experimental features to add or edit scripts."})}),s?(0,re.jsx)(x().E,{iconLeading:{icon:C().plusSmallIcon,size:"sm"},colorPalette:"blue",onClick:b,disabled:D,style:S.addButton,children:(0,re.jsx)(B().sA,{id:"workflow.agent.scripts.addButton",defaultMessage:"Add script"})}):null]})}),T?(0,re.jsx)(fn,{isOpen:Boolean(T),onClose:j,onDelete:A,script:T,workflowStore:t,disabled:!s||o||!r,appearance:m}):null]})}function wn(e){const{workflowStore:t,environment:r,disabled:i}=e,s=(0,a().X)("workflows_mcp_server_module_available"),l=(0,o(300474).r)(),c=s&&t.table===I().C0&&!i&&Boolean(l),u=(0,n.useRef)(!1),g=(0,n.useRef)(!1);(0,n.useEffect)((()=>{g.current=!1}),[t.id]);const p=(0,d().K8)((()=>{if(!c)return[];const e=t.getDraftData()??t.getData();return((null==e?void 0:e.modules)??[]).filter((e=>{var t;return!("mcpServer"!==e.type||null===(t=e.state)||void 0===t||!t.serverUrl)}))}),[t,c]),f=(0,n.useCallback)((async()=>{if(!u.current&&0!==p.length&&l){u.current=!0;try{await Promise.allSettled(p.map((e=>async function(e){return W().callApi({eventName:"refreshMcpServer",environment:e.environment,data:{moduleId:e.moduleId,spaceId:e.spaceId,workflowId:e.workflowId}})}({environment:r,moduleId:e.id,spaceId:l,workflowId:t.id}))))}catch(e){}finally{u.current=!1}}}),[r,p,l,t.id]);(0,n.useEffect)((()=>{c&&!g.current&&(g.current=!0,f())}),[c,f])}const vn=(0,B().YK)({triggersTitle:{id:"workflow.agent.tabs.triggers",defaultMessage:"Triggers"},triggersTooltip:{id:"workflow.agent.tabs.triggers.tooltip",defaultMessage:"Choose when and how the agent starts working"},chatInNotionTrigger:{id:"workflow.agent.triggers.chatInNotion",defaultMessage:"New chat with {agentName, select, undefined {this agent} other {{agentName}}} in Notion"},instructionsTitle:{id:"workflow.agent.instructions.title",defaultMessage:"Instructions"},instructionsTooltip:{id:"workflow.agent.instructions.tooltip",defaultMessage:"Describe what this agent does and how it responds"},addMemoriesButton:{id:"workflow.agent.instructions.addMemories",defaultMessage:"Add memories"},addMemoriesPrompt:{id:"workflow.agent.instructions.addMemoriesPrompt",defaultMessage:"Add memories to this agent"},toolsAndAccessTitle:{id:"workflow.agent.toolsAndAccess.title",defaultMessage:"Tools and access"},toolsAndAccessTooltip:{id:"workflow.agent.toolsAndAccess.tooltip",defaultMessage:"Choose which tools and sources this agent can access"},webAccessLabel:{id:"workflows.notion.permissions.webAccess",defaultMessage:"Web access"},webAccessTooltip:{id:"workflows.notion.permissions.webAccess.tooltip",defaultMessage:"Add domains to restrict web search to approved sources"},webAccessTooltipAria:{id:"workflows.notion.permissions.webAccess.tooltip.aria",defaultMessage:"Info about web access domain filtering"},addConnection:{id:"workflow.agent.toolsAndAccess.add",defaultMessage:"Add connection"},noConnectionsAvailable:{id:"workflow.agent.toolsAndAccess.noConnections",defaultMessage:"No connections available"},modelTitle:{id:"workflow.agent.model.title",defaultMessage:"Model"},modelTooltip:{id:"workflow.agent.model.tooltip",defaultMessage:"Choose which AI model powers this agent"}}),hn=n.memo((function(e){const{workflowOrArtifactStore:t,workflowStore:n,disabled:r=!1,workflowValidationErrorStore:i,showInstructionsPeekButton:a}=e,u=(0,l().v3)(),g=(0,d().K8)((()=>s().default.getConfig({configName:"custom_agent_sub_features"}).conversation_starters),[]),p=(0,d().K8)((()=>(0,X().Xr)()),[]);wn({workflowStore:t,environment:u,disabled:r});const{workflowValue:f}=(0,Z().N)(t,!0),m=(0,o(915671).WF)(f),w=_[m];const v="hidden"!==w.triggers,h=r||"disabled"===w.triggers,y="hidden"!==w.integrations,k=(0,c().IS)((()=>({container:{display:"flex",flexDirection:"column",alignItems:"stretch",gap:24,width:"100%",marginInline:"auto"}})),[]),x=(0,d().uB)(void 0,te),S=(0,d().O$)(x),b=No(t,r),{scriptAgentEnabled:M}=b;return(0,re.jsxs)("div",{style:k.container,children:[(0,re.jsx)(jn,{}),r||S?void 0:(0,re.jsx)(so,{workflowStore:t}),(0,re.jsx)(no,{workflowStore:t,disabled:r,permissionMode:m}),v?(0,re.jsx)(yn,{workflowOrArtifactStore:t,disabled:h,suppressChecklistStore:x}):void 0,(0,re.jsx)(kn,{workflowStore:t,disabled:r,workflowValidationErrorStore:i,showInstructionsPeekButton:a}),g?(0,re.jsx)(So,{workflowStore:t,disabled:r}):void 0,y?(0,re.jsx)(Sn,{workflowStore:t,disabled:r}):void 0,(0,re.jsx)(mn,{workflowStore:t,disabled:r,scriptsEnabled:M}),(0,re.jsx)(bn,{workflowStore:t,disabled:r}),p?(0,re.jsx)(go,{workflowStore:n,disabled:r}):void 0,(0,re.jsx)(Ro,{workflowStore:t,experimentalContext:b}),(0,re.jsx)(le,{children:(0,re.jsx)(de,{workflowStore:t})}),(0,re.jsx)(ln,{})]})}));function yn(e){const{workflowOrArtifactStore:t,disabled:r,suppressChecklistStore:i}=e,a=(0,B().tz)(),s=(0,l().v3)(),c=(0,J().n)(t,"triggers"),{workflowValue:g}=(0,Z().N)(t,!0),p=(0,d().K8)((()=>((null==g?void 0:g.triggers)??[]).filter((e=>{var t;const n=null===(t=e.state)||void 0===t?void 0:t.type;return(0,o(129398).A)({triggerType:n,context:"display"})}))),[g]),f=(0,n.useCallback)((async({triggerType:e,moduleType:o,moduleValue:n,initialState:r})=>{const l=(0,io().N)(t);if(!l)return;const d=function(e){if(!e)return!1;for(const t of e.modules??[]){const o=(0,K().jK)(t.type);if(o&&"ready"!==o.getModuleConfigurationStatus(t,e))return!0}for(const t of e.triggers??[])if(!(0,$().VB)(t))return!0;return!1}(g);d||i.setState(!0);const c=await async function(e){const{workflowStore:t,environment:o,intl:n,selection:r}=e,{triggerType:i,moduleType:a,moduleValue:s,initialState:l}=r,d=(0,K().jK)(a);if(!d)return;const c=d.triggers[i];if(!c)return;const u=(0,V().Ay)();let g;const p=t.pointer.spaceId;let f,m;if("mail"===a&&"mail.email.received"===i){const e=await W().callApi({eventName:"initializeMailTriggerConnection",environment:o,data:{spaceId:t.pointer.spaceId}});if("success"!==e.type||"success"!==e.data.type)return;f={connectionPointer:e.data.connectionPointer,creatorEmail:e.data.creatorEmail,emailAddresses:e.data.emailAddresses}}if("mail"===a&&f&&!s){var w;const e=t.getDraftData();m=null==e||null===(w=e.modules)||void 0===w?void 0:w.find((e=>{var t;return"mail"===e.type&&(null===(t=e.state)||void 0===t||null===(t=t.connectionPointer)||void 0===t?void 0:t.id)===f.connectionPointer.id}))}const v=!s&&!m,h="slack"===a&&v?(0,V().Ay)():void 0;let y;return"slack"===a&&v&&h&&(y=await H({environment:o,moduleId:h,spaceId:p,workflowId:t.id})),F().createAndCommit({userAction:"WorkflowActions.saveTrigger",environment:o,canUndo:!0,perform:e=>{let o=s||m;if(!o){const r=h??(0,V().Ay)(),i="mail"===a&&f?`Mail (${f.creatorEmail})`:void 0,s="mail"===a&&f?{connectionPointer:f.connectionPointer,creatorEmail:f.creatorEmail,emailAddresses:f.emailAddresses}:void 0,l="slack"===a&&y?{...s??{},connectionPointer:y}:s,c=(0,K().r4)({type:a,definition:d,name:i,intl:n,id:r,state:l});F().applyOperation({store:t,operation:(0,z().xb)({pointer:t.pointer,module:c}),transaction:e}),o=c}if(!o)throw new Error("No module available for trigger creation");const r=l??c.createDefaultState(),i={id:u,state:r,enabled:!0,name:"",moduleId:o.id};F().applyOperation({store:t,operation:(0,z().NW)({pointer:t.pointer,trigger:i}),transaction:e}),g=i}}),g}({workflowStore:l,environment:s,intl:a,selection:{triggerType:e,moduleType:o,moduleValue:n,initialState:r}});if(c){(0,Y().aA)({environment:s,type:e,triggerId:c.id,workflowId:l.id,isDatabaseAgent:(0,D().uP)(g)});try{await(0,io().B)({workflowOrArtifactStore:t,triggerId:c.id,appearance:"newTrigger"})}finally{d||i.setState(!1)}}else d||i.setState(!1)}),[s,a,t,g,i]),m=(0,n.useCallback)((async e=>{(0,Y().qt)({action:"open_edit_trigger_modal",environment:s,workflowId:t.id}),await(0,io().B)({workflowOrArtifactStore:t,triggerId:e.id,appearance:"editTrigger"})}),[t,s]),v=g.name;return(0,re.jsx)(vt,{title:(0,re.jsx)(B().sA,{...vn.triggersTitle}),infoTooltipMessage:vn.triggersTooltip,hasUnpublishedChanges:c,style:{paddingInline:10,paddingBlock:10},isDimmed:r,children:(0,re.jsxs)(u().Y1,{direction:"vertical",width:"hug",children:[(0,re.jsxs)(u().Y1,{direction:"horizontal",gap:8,width:"fill",style:{paddingInline:10,cursor:"default"},height:32,align:"center-left",children:[(0,re.jsx)(w().I,{icon:o(979330).n,size:"sm"}),(0,re.jsx)(y().D,{styleKey:"bodyRegular",textOverflow:"ellipsis",children:(0,re.jsx)(B().sA,{...vn.chatInNotionTrigger,values:{agentName:Boolean(null==v?void 0:v.trim())?v:void 0}})})]}),p.map((e=>(0,re.jsx)(fe,{workflowStore:t,trigger:e,disabled:r,onClick:t.table===A().U6v||r?void 0:()=>m(e)},e.id))),r||t.table===A().U6v?void 0:(()=>{const e=(0,io().N)(t);return e?(0,re.jsx)(o(266563).s,{workflowStore:e,onAddTrigger:f}):void 0})()]})})}function kn(e){const{workflowStore:t,disabled:s,workflowValidationErrorStore:c,showInstructionsPeekButton:g}=e,p=(0,l().v3)(),f=(0,B().tz)(),m=(0,r().L)(),w=(0,o(106702).$)(),v=(0,J().n)(t,"instructions"),h=(0,d().K8)((()=>c.hasError("instructions")),[c]),y=(0,n.useCallback)((()=>{if(t.table!==I().C0||!m||!w)return;const e=i().default.state.sidebarSpaceViewStore;if(!e)return;const n=f.formatMessage(vn.addMemoriesPrompt),r=(0,N().Jv)({environment:p,spaceStore:m,userStore:w,promptType:"update_custom_agent_with_memories",value:(0,T().x9d)(n),locale:(0,o(402390).H)(f)}),a={userStore:w,spaceStore:m,spaceViewStore:e,blockStore:void 0,peekStore:void 0,workflowStore:t},s=(0,N().Xd)({environment:p,inferenceContext:a,config:(0,o(844317).getWorkflowAgentConfig)({environment:p,spaceId:m.id,workflowId:t.id}),addSteps:[r],surface:"workflows"}),l=(0,q().addTranscriptToNewThreadAndRun)({environment:p,spaceStore:m,transcript:s,workflowId:t.id,createdSource:"workflows",parentPointer:t.pointer});(0,o(703748).openChatPanel)({environment:p,store:t,chatPanelState:{isOpen:!0,threadId:l.id}})}),[p,f,m,w,t]),k=(0,a().X)("custom_agent_add_memories_button_enabled")&&!s&&t.table===I().C0?(0,re.jsxs)(u().Y1,{direction:"horizontal",gap:12,align:"center",children:[(0,re.jsx)(Oo,{workflowStore:t}),(0,re.jsx)(x().E,{size:"sm",onClick:y,children:(0,re.jsx)(B().sA,{...vn.addMemoriesButton})})]}):(0,re.jsx)(Oo,{workflowStore:t});return(0,re.jsx)(vt,{title:(0,re.jsx)(B().sA,{...vn.instructionsTitle}),infoTooltipMessage:vn.instructionsTooltip,hasError:h,errorLabel:(0,re.jsx)(ro,{}),hasUnpublishedChanges:v,style:{paddingInline:0,paddingBlock:0},isDimmed:s,actionButton:k,children:(0,re.jsx)(o(362452).G,{workflowStore:t,disabled:s,workflowValidationErrorStore:c,showInstructionsPeekButton:g})})}function xn(e){const{moduleValue:t,workflowStore:o}=e,r=o.pointer,i=(0,d().K8)((()=>(0,G().Cq)({workflowPointer:r})),[r]),{handleConnect:a,authModal:s}=(0,oe().K)({moduleValue:t,workflowDefinitionPointer:i||{table:"workflow",id:"",spaceId:""},workflowModuleStore:void 0});return n.useEffect((()=>{i&&a()}),[a,i]),i?s:null}function Sn(e){const{workflowStore:t,disabled:r=!1}=e,i=(0,J().n)(t,"integrations"),a=(0,B().tz)(),g=(0,l().v3)(),p=(0,Z().N)(t,!0),{workflowValue:f,threadStore:x}=p,b=null==f?void 0:f.modules,I=(0,n.useMemo)((()=>b??[]),[b]),[T,P]=n.useState(!1),[_,E]=n.useState(void 0),L=(0,n.useCallback)((e=>{E(e)}),[]),N=(0,n.useCallback)((()=>{E(void 0),P(!0),(0,Y().qt)({action:"open_add_connection_menu",environment:g,workflowId:t.id})}),[g,t.id]),R=(0,n.useCallback)((()=>{P(!1)}),[]),K=(0,o(600434).K7)("custom_agent").supportsWebSearch("workflow"),z=(0,d().K8)((()=>s().default.getConfig({configName:"custom_agent_sub_features"}).domain_allowlist),[]),V=(0,c().IS)((()=>({permissionRow:{display:"flex",alignItems:"center",justifyContent:"space-between",minHeight:32,paddingBlock:8,paddingInline:10},permissionLabel:{display:"flex",alignItems:"center",gap:8},button:{paddingInline:8,fontWeight:U().Wy.medium},itemWrapper:{paddingInline:10,marginTop:4,marginBottom:4},permissionLabelInner:{display:"flex",alignItems:"center"},tooltip:{minWidth:140},tooltipIcon:{marginInlineStart:2}})),[]),W=(0,n.useMemo)((()=>I.find((e=>"notion"===e.type))),[I]),F=(0,n.useMemo)((()=>{if(W)return(0,D().qQ)(W.permissions)}),[W]),O=(0,n.useCallback)((()=>{var e;if(!W)return;if(t.table===A().U6v)return;const o=null===(e=W.permissions)||void 0===e?void 0:e.find((e=>"search"===e.type&&"web"===e.identifier.type)),n="search"===(null==o?void 0:o.type)&&"web"===o.identifier.type?o.identifier.allowedDomains:void 0,r=[...W.permissions||[]].filter((e=>!("search"===e.type&&"web"===e.identifier.type))),i={moduleType:"notion",type:"search",identifier:{type:"web",...n&&n.length>0?{allowedDomains:n}:{}},actions:[F?"disallow":"allow"]},a={...W,permissions:[...r,i]};F||(0,Y().ik)({environment:g,connected_tool:"notion",workflow_id:t.id,resource_type:"web"}),q().saveModule({environment:g,workflowStore:t,module:a})}),[g,W,F,t]),H=0===(0,Q().v)({workflowStore:t,workflowValue:f,showCurrentModules:!1,isCustomAgentContext:!0}).length,$=(0,D().uP)(f);return(0,re.jsx)("div",{"data-section":"tools-and-access",children:(0,re.jsx)(vt,{title:(0,re.jsx)(B().sA,{...vn.toolsAndAccessTitle}),infoTooltipMessage:vn.toolsAndAccessTooltip,hasUnpublishedChanges:i,style:{paddingInline:0,paddingBlock:10},isDimmed:r,children:(0,re.jsxs)(u().Y1,{direction:"vertical",gap:0,width:"fill",children:[W&&K?(0,re.jsxs)("div",{style:V.itemWrapper,children:[(0,re.jsxs)("div",{style:V.permissionRow,children:[(0,re.jsxs)("div",{style:V.permissionLabel,children:[(0,re.jsx)(w().I,{icon:M().globeSmallIcon,size:"sm"}),(0,re.jsxs)("div",{style:V.permissionLabelInner,children:[(0,re.jsx)(y().D,{styleKey:"bodyMedium",children:(0,re.jsx)(B().sA,{...vn.webAccessLabel})}),F&&z?(0,re.jsx)(S().m,{style:V.tooltip,renderTooltip:()=>(0,re.jsx)(B().sA,{...vn.webAccessTooltip}),render:e=>(0,re.jsx)(v().A,{size:"xs",icon:j().infoCircleSmallIcon,ariaLabel:a.formatMessage(vn.webAccessTooltipAria),style:V.tooltipIcon,...e}),textWrap:!0}):null]})]}),(0,re.jsx)(k().A,{disabled:r,on:F??!1,onClick:O,"aria-label":"Toggle web search"})]}),F&&z?(0,re.jsx)(Bo,{notionModule:W,workflowStore:t,threadStore:x,disabled:r}):null]}):null,W&&K?(0,re.jsx)(m().A,{colorVariant:"secondary",size:16}):void 0,I.map(((e,o)=>(0,re.jsxs)(n.Fragment,{children:[o>0?(0,re.jsx)(m().A,{colorVariant:"secondary",size:16}):void 0,(0,re.jsx)("div",{style:V.itemWrapper,children:(0,re.jsx)(mt,{workflowStore:t,workflow:f,module:e})})]},e.id))),r||t.table===A().U6v||$?void 0:(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(m().A,{colorVariant:"secondary",size:16}),(0,re.jsxs)("div",{style:V.itemWrapper,children:[(0,re.jsx)(S().m,{disableTooltip:!H,placement:"top",alignment:"start",renderTooltip:()=>(0,re.jsx)(B().sA,{...vn.noConnectionsAvailable}),render:e=>(0,re.jsx)(h().p,{...e,iconLeading:{icon:C().plusSmallIcon,size:"sm"},colorPalette:"blue",disabled:H||r,style:V.button,onClick:N,children:(0,re.jsx)(B().sA,{...vn.addConnection})})}),(0,re.jsx)(eo,{workflowStore:t,isOpen:T,onClose:R,onRequestAuth:L}),_?(0,re.jsx)(xn,{moduleValue:_,workflowStore:t},_.id):void 0]})]})]})})})}function bn(e){const{workflowStore:t,disabled:o=!1}=e,n=(0,J().n)(t,"model");return(0,re.jsx)(vt,{title:(0,re.jsx)(B().sA,{...vn.modelTitle}),infoTooltipMessage:vn.modelTooltip,hasUnpublishedChanges:n,style:{paddingBlock:0,paddingInline:0},isDimmed:o,children:(0,re.jsx)(Mn,{workflowStore:t,disabled:o})})}function Mn(e){const{workflowStore:t,disabled:o=!1}=e,r=(0,B().tz)(),i=(0,Z().N)(t,!0),{workflowValue:a}=i,s=(0,n.useMemo)((()=>{var e;return{type:"workflow",model:null===(e=a.model)||void 0===e?void 0:e.type,modelFromUser:void 0!==a.model}}),[a.model]),l=(0,n.useMemo)((()=>(0,P().kD)(s)),[s]),u=(0,d().uB)(void 0,f().A),m=(0,n.useMemo)((()=>({close:()=>{u.setState({open:!1})}})),[u]),{modelName:v,modelFamily:y}=(0,R().R)({config:s,agentModelConfig:l,intl:r}),k=(0,c().eP)(),x=(0,c().IS)((()=>({triggerButton:{display:"flex",alignItems:"center",minWidth:0,width:"100%",borderRadius:13,height:48,paddingInline:16,gap:12},hoveredTriggerButton:{background:E().Tj.background.secondaryTranslucent},pressedTriggerButton:{background:(0,g().yZ)({color:E().Tj.background.secondaryTranslucent,mode:k})},triggerText:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",flexShrink:1,minWidth:0},buttonContent:{display:"flex",alignItems:"center",gap:4,width:"100%",justifyContent:"space-between"}})),[k]);return(0,re.jsx)(p().A,{buttonPopupStore:u,popupType:p().z.Popup,placementToOrigin:"top",alignmentToOrigin:"start",originGap:4,disabled:o,renderOrigin:e=>(0,re.jsxs)(h().p,{...e,size:"lg",style:x.triggerButton,hoveredStyle:x.hoveredTriggerButton,pressedStyle:x.pressedTriggerButton,"aria-label":v,disabled:o,children:[(0,re.jsx)(L().H,{modelFamily:y,defaultNoAiFace:!1}),(0,re.jsxs)("div",{style:x.buttonContent,children:[(0,re.jsx)("span",{style:x.triggerText,children:v}),(0,re.jsx)(w().I,{icon:b().arrowChevronSingleDownIcon,size:"default",colorVariant:"secondary"})]})]}),render:()=>(0,re.jsx)(to().g,{workflowStore:t,buttonPopupParent:m})})}function jn(){const e=(0,o(664594).T)(),t=(0,r().L)(),n=(0,o(528093)._)({name:"custom_agents",spaceId:null==t?void 0:t.id,userId:e}),i=(0,c().IS)((()=>({container:{border:`1.5px solid ${E().Tj.border.secondary}`,borderRadius:8,padding:14}})),[]);return!n||(0,o(706021).e2)(n)?null:(0,re.jsx)("div",{style:i.container,children:(0,re.jsx)(o(704658).UpgradeButton,{display:"text",source:"custom_agent",upsell:n.upsell,spaceStore:t,customMessages:{eligible_to_purchase:{id:"upgrade.eligible_to_purchase",defaultMessage:"<highlight>Upgrade</highlight> to edit this agent's settings"},eligible_for_trial:{id:"upgrade.eligible_for_trial",defaultMessage:"<highlight>Upgrade</highlight> to edit this agent's settings"},eligible_to_request:{id:"upgrade.eligible_to_request",defaultMessage:"<highlight>Request upgrade</highlight> to edit this agent's settings"},request_pending:{id:"upgrade.request_pending",defaultMessage:"<highlight>Upgrade requested</highlight>"}}})})}},682539:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=o(474848);const r=function(e){const t=(0,o(100622).O4)({theme:"dark"}),r={display:"inline-flex",alignItems:"center",whiteSpace:"nowrap",borderRadius:6,height:28,padding:"0 8px",lineHeight:1.2,fontSize:14,color:t.text.primary,border:`1px solid ${t.text.primary}`,gap:6,...e.disabled?{opacity:.4}:{}};return(0,n.jsxs)(o(718827).Ay,{disabled:e.disabled,onClick:e.onClick,style:r,children:[e.icon,e.children]})}},691093:(e,t,o)=>{o.r(t),o.d(t,{closeWorkflowEditor:()=>l,showUnpublishedAgentDialog:()=>c,showWorkflowEditor:()=>s});var n=()=>o(675133),r=()=>o(792057),i=()=>o(496703),a=()=>o(246766);function s(e){const{environment:t,workflowStore:o}=e,n=(0,i().L)({workflowId:o.id,params:{workflowViewType:"agent"}});(0,a().navigate)({environment:t,url:n,redirect:!1})}function l(e){const{environment:t,workflowStore:o}=e,n=(0,i().L)({workflowId:o.id,params:{}});(0,a().navigate)({environment:t,url:n,redirect:!1})}const d=(0,o(69708).YK)({confirmDialog:{defaultMessage:"You have unsaved changes",id:"workflow.navigation.confirmation"},leaveButton:{defaultMessage:"Leave without saving",id:"workflow.navigation.confirmation.leave"},publishButton:{defaultMessage:"Save changes",id:"workflow.navigation.confirmation.save"}});function c(){return new Promise((e=>{r().ui({message:n().A.formatMessage(d.confirmDialog),showCancel:!1,keepFocus:!0,onDismiss:()=>{e("cancel")},items:[{label:n().A.formatMessage(d.publishButton),color:void 0,buttonType:"solid",onAccept:()=>{e("publish")}},{label:n().A.formatMessage(d.leaveButton),color:void 0,buttonType:"outline",onAccept:()=>{e("leave")}}]})}))}},905921:(e,t,o)=>{o.d(t,{k:()=>s});o(581454),o(296540);var n=()=>o(401497),r=()=>o(631524),i=()=>o(100622),a=o(474848);function s(e){const{starters:t,onStarterClick:o,disabled:s}=e,l=(0,n().IS)((()=>({conversationStartersWrapper:{width:800,maxWidth:"100%",marginTop:16,display:"flex",flexWrap:"wrap",justifyContent:"start",gap:8},conversationStarter:{borderRadius:20,backgroundColor:i().Tj.background.secondary,fontSize:14,color:i().Tj.text.primary,cursor:"pointer",transition:"background-color 150ms",border:"none"},conversationStarterHover:{backgroundColor:i().Tj.background.tertiaryTranslucent}})),[]);return(0,a.jsx)("div",{style:l.conversationStartersWrapper,children:t.map(((e,t)=>(0,a.jsx)(r().p,{size:"lg",onClick:()=>o(e),style:l.conversationStarter,hoveredStyle:l.conversationStarterHover,disabled:s,children:e},t)))})}},941250:(e,t,o)=>{o.d(t,{D:()=>B});o(898992),o(581454),o(737550);var n=()=>o(906745),r=o(296540),i=()=>o(484714),a=()=>o(590526),s=()=>o(401497),l=()=>o(792057),d=()=>o(107975),c=()=>o(128933),u=()=>o(849255),g=()=>o(44111),p=()=>o(807449),f=()=>o(98126),m=()=>o(631524),w=()=>o(160432),v=()=>o(663639),h=()=>o(736847),y=()=>o(187174),k=()=>o(599813),x=()=>o(798880),S=()=>o(724639),b=()=>o(69708),M=()=>o(100622),j=()=>o(319625),C=()=>o(769864),I=()=>o(687879),A=()=>o(260917),T=()=>o(644521),D=()=>o(700226),P=o(474848);const _=(0,b().YK)({title:{id:"workflows.versionHistory.title",defaultMessage:"Version history"},restore:{id:"workflows.versionHistory.restore",defaultMessage:"Restore"},loading:{id:"workflows.versionHistory.loading",defaultMessage:"Loading..."},live:{id:"workflows.versionHistory.live",defaultMessage:"Live"},agent:{id:"workflows.versionHistory.agent",defaultMessage:"Agent"},bot:{id:"workflows.versionHistory.bot",defaultMessage:"Bot"},unknownUser:{id:"workflows.versionHistory.unknownUser",defaultMessage:"Unknown"},userWithId:{id:"workflows.versionHistory.userWithId",defaultMessage:"User {userId}"}});function B(e){const{workflowStore:t,onClose:o}=e,n=(0,b().tz)(),r=(0,a().uB)(void 0,A().K);return(0,P.jsx)(d().a,{ariaLabel:n.formatMessage(_.title),open:!0,onDismiss:o,render:()=>(0,P.jsx)(U,{workflowStore:t,onClose:o,workflowValidationErrorStore:r})})}function E(e){const{store:t,isSelected:o,onSelect:r,isLiveVersion:i}=e,l=(0,b().tz)(),d=(0,a().K8)((()=>t.getCreatedAt()),[t]),c=(0,a().K8)((()=>t.getCreatedById()),[t]),g=(0,a().K8)((()=>t.getCreatedByTable()),[t]),p=(0,a().K8)((()=>{if(g===x().oo&&c){const e=t.getSpaceId();if(!e)return;const o=u().L.createChildStore(t,{id:c,table:x().oo,spaceId:e});if(o.isDefined()&&!o.getIsDeleted())return o.getName()}}),[g,c,t]),f=(0,s().IS)((()=>({versionItem:{paddingBlock:8,paddingInline:16,cursor:"pointer",display:"flex",flexDirection:"column",gap:4,borderRadius:6},versionItemSelected:{backgroundColor:M().Tj.background.secondary},versionDate:{fontSize:14,color:M().Tj.text.primary,display:"flex",alignItems:"center",gap:8},versionUser:{fontSize:12,color:M().Tj.text.secondary},liveBadge:{backgroundColor:M().Tj.blue.background.secondary,color:M().Tj.blue.text.primary,paddingTop:2,paddingInlineEnd:8,paddingBottom:2,paddingInlineStart:6,borderRadius:12,fontSize:12,fontWeight:500,display:"inline-flex",alignItems:"center",gap:4},liveBadgeDot:{width:6,height:6,borderRadius:"50%",backgroundColor:M().Tj.blue.icon.accentPrimary}})),[]);return(0,P.jsxs)("div",{role:"button",tabIndex:0,onClick:r,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||r()},style:{...f.versionItem,...o?f.versionItemSelected:{}},children:[(0,P.jsxs)("div",{style:f.versionDate,children:[(0,P.jsx)("span",{children:d?n().DateTime.fromMillis(d).toLocaleString(n().DateTime.DATETIME_MED):l.formatMessage(_.loading)}),i?(0,P.jsxs)("span",{style:f.liveBadge,children:[(0,P.jsx)("span",{style:f.liveBadgeDot}),l.formatMessage(_.live)]}):void 0]}),(0,P.jsx)("div",{style:f.versionUser,children:p||("agent"===g?l.formatMessage(_.agent):"bot"===g?l.formatMessage(_.bot):g===x().oo&&c?l.formatMessage(_.userWithId,{userId:c.slice(0,8)}):l.formatMessage(_.unknownUser))})]})}function U(e){const{workflowStore:t,onClose:o,workflowValidationErrorStore:n}=e,d=(0,i().v3)(),u=(0,b().tz)(),[x,A]=(0,r.useState)(void 0),[B,U]=(0,r.useState)(void 0),[L,N]=(0,r.useState)(!1),R=(0,s().IS)((()=>({container:{display:"flex",height:"80vh",maxHeight:800,maxWidth:1200,width:"calc(100vw - 48px)"},workflowContainer:{paddingInline:16,paddingBlock:24},headerContainer:{paddingInline:12},leftPanel:{flex:1,borderInlineEnd:`1px solid ${M().Tj.border.secondary}`,overflow:"auto",position:"relative",paddingInline:20},rightPanel:{width:320,display:"flex",flexDirection:"column"},header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:16,borderBottom:`1px solid ${M().Tj.border.secondary}`},title:{fontSize:16,fontWeight:500},closeButton:{padding:4},versionList:{flex:1,overflow:"auto"},footer:{padding:16,borderTop:`1px solid ${M().Tj.border.secondary}`,display:"flex",justifyContent:"flex-end"},loadingContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}})),[]),K=(0,a().K8)((()=>t.id),[t]),z=(0,a().K8)((()=>t.getSpaceId()),[t]),V=(0,a().K8)((()=>{const e=t.getPublishedArtifactStore();return null==e?void 0:e.id}),[t]),[W]=(0,y().Yb)((async()=>{if(!z)return{artifactIds:[]};const e=await C().callApi({eventName:"getWorkflowVersions",environment:d,data:{workflowId:K,spaceId:z}});return"failed"===e.type?{artifactIds:[]}:e.data}),[K,z,d]),F=(0,r.useMemo)((()=>"resolved"===W.status?W.value.artifactIds:[]),[W]),O="pending"===W.status;(0,r.useEffect)((()=>{F.length>0&&!x&&A(F[0])}),[F,x]),(0,r.useEffect)((()=>{if(!x||!z)return void U(void 0);const e={table:"workflow_artifact",id:x,spaceId:z},o=g().j.createChildStore(t,e);o.isType("version")&&U(o)}),[x,z,t]);const H=(0,r.useCallback)((async()=>{if(!B||L)return;N(!0);const e=setTimeout((()=>{N(!1)}),3e4);c().D6({label:(0,P.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,P.jsx)(f().A,{size:"sm",onDarkBackground:!0}),u.formatMessage({defaultMessage:"Restoring version...",id:"workflows.versionHistory.restoringProgress"})]}),durationMs:"keep"});try{await(0,I().restoreWorkflowVersion)({environment:d,workflowStore:t,workflowArtifactStore:B}),c().D6({label:u.formatMessage({defaultMessage:"Version restored successfully",id:"workflows.versionHistory.restoreSuccess"})}),o()}catch(n){c().N2();const e=(0,j().A)(n),t=e instanceof S().nc&&e.reasons.some((e=>"integration_not_owned_by_user"===e.type))?u.formatMessage({defaultMessage:"You tried to restore a version with changes to a third-party integration you did not create. Ask the integration owner to restore this version, or restore a different version.",id:"workflows.versionHistory.restoreIntegrationPermissionError"}):u.formatMessage({defaultMessage:"Failed to restore version. Please try again.",id:"workflows.versionHistory.restoreError"});l().f1(t)}finally{clearTimeout(e),N(!1)}}),[d,t,B,o,u,L]),q=(0,r.useMemo)((()=>z?F.map((e=>{const o={table:"workflow_artifact",id:e,spaceId:z};return{id:e,store:g().j.createChildStore(t,o)}})):[]),[F,z,t]),Y=(0,r.useMemo)((()=>q.map((({id:e,store:t})=>({key:e,render:o=>(0,P.jsx)(E,{...o,store:t,isSelected:x===e,onSelect:()=>A(e),isLiveVersion:e===V}),action:()=>A(e)})))),[q,x,V]),$=[{key:0,render:e=>(0,P.jsx)(h().A,{...e}),items:Y}];return(0,P.jsxs)("div",{style:R.container,children:[(0,P.jsx)("div",{style:R.leftPanel,children:B?(0,P.jsxs)("div",{style:R.workflowContainer,children:[(0,P.jsx)("div",{style:R.headerContainer,children:(0,P.jsx)(D().yc,{workflowStore:B,disabled:!0,workflowValidationErrorStore:n})}),(0,P.jsx)(T().b,{workflowOrArtifactStore:B,workflowStore:t,disabled:!0,workflowValidationErrorStore:n,showInstructionsPeekButton:!1})]}):(0,P.jsx)("div",{style:R.loadingContainer,children:(0,P.jsx)(f().k,{})})}),(0,P.jsxs)("div",{style:R.rightPanel,children:[(0,P.jsxs)("div",{style:R.header,children:[(0,P.jsx)("div",{style:R.title,children:(0,P.jsx)(b().sA,{..._.title})}),(0,P.jsx)(m().p,{onClick:o,style:R.closeButton,"aria-label":"Close",children:(0,P.jsx)(p().I,{icon:k().xMarkIcon})})]}),(0,P.jsx)("div",{style:R.versionList,children:O?(0,P.jsx)("div",{style:R.loadingContainer,children:(0,P.jsx)(f().k,{})}):(0,P.jsx)(v().A,{type:v().O.Vertical,sections:$,initialFocus:void 0,onAccept:()=>{}})}),(0,P.jsx)("div",{style:R.footer,children:(0,P.jsx)(w().A,{onClick:H,colorPalette:"blue",disabled:!B||L,children:(0,P.jsx)(b().sA,{..._.restore})})})]})]})}},946561:(e,t,o)=>{o.d(t,{s:()=>r});var n=()=>o(929219);function r(){return n().A.state.online}},989184:(e,t,o)=>{o.d(t,{Z:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"2.85 1.57 9.98 12.06",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M7.442 1.758a.625.625 0 0 0-.884 0l-3.52 3.52a.625.625 0 1 0 .884.884l2.453-2.453V11.8c0 1.008.817 1.825 1.825 1.825h4a.625.625 0 1 0 0-1.25h-4a.575.575 0 0 1-.575-.575V3.709l2.453 2.453a.625.625 0 0 0 .884-.884z"})},r=(0,o(340498).wt)("arrowTurnLeftUpSmall",n,"small")},993002:(e,t,o)=>{o.d(t,{n:()=>d});o(898992),o(354520);var n=()=>o(590526),r=()=>o(295633),i=()=>o(743246),a=()=>o(758256),s=()=>o(366999),l=()=>o(711517);function d(e,t){return(0,n().K8)((()=>{if(!e)return!1;if(e.table===a().U6)return!1;const o=e.getDraftData(),n=e.getPublishedArtifactStore(),d=null==n?void 0:n.getData();if(!o||n&&!n.isReady())return!1;if(!d)return!1;const c=(0,l().ap)(o.instructions)?r().B.createChildStore(e,o.instructions):void 0;if((0,s().x)({oldWorkflow:d,newWorkflow:o,oldWorkflowLastEditedTime:null==d?void 0:d.publishTime,newWorkflowLastEditedTime:null==c?void 0:c.getLastEditedTime()}).edits.filter((e=>{switch(t){case"instructions":return"instructions_updated"===e.type;case"model":return"model_updated"===e.type;case"integrations":return e.type.startsWith("module_")||"module_permission_added"===e.type||"module_permission_removed"===e.type;case"triggers":return e.type.startsWith("trigger_");case"scripts":return e.type.startsWith("script_");case"name":return"name_updated"===e.type;case"description":return"description_updated"===e.type;case"conversationStarters":return"conversationStarters_updated"===e.type;case"experimental":return"config_overrides_updated"===e.type;case"permissionMode":return"permissionMode_updated"===e.type;default:return!1}})).length>0)return!0;if("instructions"===t&&e.table===i().C0&&(0,l().ap)(null==o?void 0:o.instructions)&&(0,l().ap)(null==d?void 0:d.instructions)&&null!=d&&d.publishTime){const t=o.instructions;if(!t.spaceId)return!1;const n=r().B.createChildStore(e,t);if(!n.isDefined())return!1;const i=n.getModel(),a=null==i?void 0:i.getLastEditedTime();if("number"==typeof a&&a>d.publishTime)return!0}return!1}),[e,t])}}}]);