"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[44854],{433519:(e,t,o)=>{o.d(t,{i:()=>p});o(581454);var i=o.n(o(794148)),r=()=>o(534177);var a=()=>o(192845),n=()=>o(165358),d=()=>o(792071),l=()=>o(696706),c=()=>o(912720),s=()=>o(199378);function p(e){var t,o;const{originalRecord:p,duplicateRecord:u,mapper:_,options:m,actor:f}=e,v=l().L3.fromSpaceShardRecordId({id:p.id,spaceId:p.space_id},c().yB);u.copied_from_pointer=v;const g=(null===(t=_({requested:l().L3.fromPointerLike({table:u.parent_table,id:u.parent_id,spaceId:u.space_id}),requester:v}))||void 0===t?void 0:t.id)??u.parent_id;u.parent_id=g;const b=(u.action_ids??[]).map((e=>{var t;return(null===(t=_({requested:l().L3.fromPointerLike({table:s().SC,id:e,spaceId:u.space_id}),requester:v}))||void 0===t?void 0:t.id)??e}));u.action_ids=b;const I=Date.now();u.created_time=I,u.last_edited_time=I,u.last_executed_time=void 0,u.last_failed_time=void 0,u.last_failed_reason=void 0,(0,r().O9)(null===(o=u.properties)||void 0===o?void 0:o.schedule_id)&&(u.properties.schedule_id=void 0),(0,r().O9)(f)&&(u.created_by_id=f.id,u.created_by_table=f.table,u.last_edited_by_id=f.id,u.last_edited_by_table=f.table),"recurrence"===u.trigger.type&&m.shouldDisableRecurrenceAutomation&&(u.status="disabled_duplication"),function(e){return"event"===e.trigger.type}(u)&&function(e){var t;const{duplicateRecord:o,mapper:r,originalRecord:l}=e,s=d().Bj6.fromAutomation(o);i()(s.isEventType());const p={id:l.id,spaceId:l.space_id,table:c().yB},{value:u}=(0,a().n)({automationModel:s,visitors:{visitCollectionProperty:void 0,visitRecordPointer:e=>{const t=r({requested:e,requester:p});if(t){const e=t.spaceId??o.space_id;return e!==o.space_id?{type:"replace",value:void 0}:{type:"replace",value:{...t,spaceId:e}}}return{type:"replace",value:void 0}}}});i()(u.isEventType());const _=u.getTrigger();o.trigger=_;const m={sourceAutomationParentId:l.parent_id,sourceAutomationId:l.id,sourceAutomationName:(null===(t=l.properties)||void 0===t?void 0:t.name)??""};o.trigger.event.source||(n().log({data:{miscDataToConvertToString:m},from:"duplicateHelpers.duplicateAutomationEventValueHelper",level:"info",type:"duplicateAutomationMissingTriggerSource"}),o.status="disabled")}({duplicateRecord:u,mapper:_,originalRecord:p})}},522328:(e,t,o)=>{o.d(t,{I:()=>v});o(898992),o(354520),o(581454),o(737550);var i=()=>o(534177),r=()=>o(496603),a=()=>o(239381),n=()=>o(792071),d=()=>o(696706),l=()=>o(199378),c=()=>o(179034),s=()=>o(519831),p=()=>o(192845);function u(e){const{duplicatedAction:t,mapper:o,options:u,originOptions:_,sourceSpaceId:m}=e,f=n().Bj6.fromAutomationAction(t),v=f.pointer;const g=e=>{const{visitPath:i,requested:r,requester:a}=e;return function(e,o){return Boolean("create_page"===t.type&&(null==u?void 0:u.isTemplateInstantiation)&&"config.template_page_id"===o&&e.table===c().ev&&u.sourceBlockIds.has(e.id))}(r,i)?r:o({requested:r,requester:a})};function b(e,t){const o=(0,a().y5)(e);if("action"===o.source){var r;const e=d().L3.fromSpaceShardRecordId({id:o.action_id,spaceId:f.space_id},l().SC),i=(null===(r=g({visitPath:t,requested:e,requester:v}))||void 0===r?void 0:r.id)??o.action_id;return(0,a().$y)({...o,action_id:i})}if("global"===o.source)return e;(0,i().HB)(o)}const I=f.pointer,{remappedRecordPointers:y,value:k}=(0,p().G)({automationActionModel:f,baseUrl:_.baseUrl,preventClearingConfig:!1,publicDomainName:_.publicDomainName,sourceSpaceId:m,visitors:{visitCollectionProperty:void 0,visitCollectionPropertyPointer:(e,o)=>{const i=g({visitPath:o,requested:e,requester:I});if(i){const o=i.spaceId??t.space_id;return o!==t.space_id||i.table!==s().Vl?{type:"replace",value:void 0}:{type:"replace",value:{...i,propertyId:e.propertyId,spaceId:o}}}return(e.spaceId??t.space_id)!==t.space_id?{type:"replace",value:void 0}:{type:"keep"}},visitFormulaContextValue:(e,t)=>({type:"replace",value:b(e,t)}),visitFormulaPageProperty:(e,o)=>{if("collection"in e&&e.collection){const i=g({visitPath:o,requested:e.collection,requester:v});if(i&&i.table===s().Vl){const o=i.spaceId??t.space_id;return o!==t.space_id?{type:"replace",value:void 0}:{type:"replace",value:{...e,collection:{...i,spaceId:o}}}}}else if("contextValueId"in e&&e.contextValueId)return{type:"replace",value:{...e,contextValueId:b(e.contextValueId)}};return{type:"keep"}},visitRecordPointer:(e,o)=>{const i=g({visitPath:o,requested:e,requester:I});if(i){const e=i.spaceId??t.space_id;return e!==t.space_id?{type:"replace",value:void 0}:{type:"replace",value:{...i,spaceId:e}}}return(e.spaceId??t.space_id)!==t.space_id?{type:"replace",value:void 0}:{type:"keep"}}}}),q=k.getConfig();if(t.config=q,!(0,r().Im)(q))return y}var _=()=>o(537012),m=()=>o(273900),f=()=>o(813690);function v(e){const{originalRecord:t,duplicateRecord:o,mapper:r,getRecordRole:a,options:n,originOptions:s,duplicateBlocks:p=!0}=e,v=t.space_id!==o.space_id,g={table:l().SC,id:t.id,spaceId:t.space_id},b=r({requested:d().L3.fromPointerLike({table:o.parent_table,id:o.parent_id,spaceId:o.space_id}),requester:g}),I=u({duplicatedAction:o,mapper:r,options:n.resolveAutomationConfig,originOptions:s,sourceSpaceId:t.space_id});let y=a;I&&(y=f().Oj.tryUntilFound(...Array.from(I).map((e=>f().Oj.constantForPointer(e,"editor"))),y));const k=(null==b?void 0:b.id)??o.parent_id;if(o.parent_id=k,v&&"http_request"===o.type&&o.config){o.config.url=void 0;for(const e of o.config.customHeaders??[])e.value=""}const q=(0,_().Mn)(o);if(q){q.some((e=>{const t=y(e.pointer);return!t||!(0,m().q_)(t,e.minimumRequiredRole)}))&&(o.config={})}const B=(o.blocks??[]).map((e=>{var t;return null===(t=r({requested:d().L3.fromPointerLike({table:c().ev,id:e,spaceId:o.space_id}),requester:g}))||void 0===t?void 0:t.id})).filter(i().O9);o.blocks=B.length>0?B:void 0,p||(o.blocks=void 0)}},644854:(e,t,o)=>{o.d(t,{initializeTemplate:()=>Ce});o(944114),o(898992),o(908872);var i=()=>o(726637),r=()=>o(770063),a=()=>o(295633),n=()=>o(175482),d=(o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(803949),o(581454),o(737550),()=>o(496603)),l=()=>o(534177),c=()=>o(700500),s=()=>o(898244),p=()=>o(641007),u=()=>o(206267),_=()=>o(792071),m=()=>o(134025),f=()=>o(912720),v=()=>o(199378),g=()=>o(179034),b=()=>o(201980);function I(e){var t;const{blockValue:o,factoryButtonDeprecationContext:i,source:r}=e,a=function(e){return _().Bj6.fromValue(g().ev,e).getCreatedByPointer()??{id:p().rb.id,table:p().rb.table}}(o),n=o.space_id,d=u().JW(),l=u().JW(),c=i.isRootBlockFactoryBlock&&i.isCurrentBlockRootBlock?i.rootTextContainerId:u().JW(),s=function(e){const{automationActionId:t,textContainerBlockId:o,creatorPointer:i,originalBlockValue:r,spaceId:a,blockContent:n}=e;return{table:g().ev,value:{id:o,space_id:a,alive:!0,parent_table:v().SC,parent_id:t,type:"text",version:0,content:n,created_time:r.created_time,created_by_table:i.table,created_by_id:i.id}}}({automationActionId:l,textContainerBlockId:c,creatorPointer:a,originalBlockValue:o,blockContent:"duplication"===r?null===(t=o.content)||void 0===t?void 0:t.map((t=>e.pointerMapper({id:t,table:g().ev}).id)):o.content,spaceId:n}),m=function(e){const{automationId:t,automationActionId:o,spaceId:i,textContainerBlockId:r}=e;return{table:v().SC,value:{id:o,space_id:i,alive:!0,parent_table:f().yB,parent_id:t,type:"duplicate_blocks",blocks:[r],version:0,config:void 0}}}({automationActionId:l,automationId:d,creatorPointer:a,originalBlockValue:o,spaceId:n,textContainerBlockId:c}),I=function(e){var t;const{creatorPointer:o,automationActionId:i,originalBlockValue:r,spaceId:a,automationId:n}=e,d=u().JW(),l=Date.now();return{table:f().yB,value:{id:n,space_id:a,alive:!0,trigger:{id:d,type:"button"},parent_id:r.id,parent_table:g().ev,action_ids:[i],status:"active",properties:{name:(0,b().q4_)(null===(t=r.properties)||void 0===t?void 0:t.title)},created_by_id:o.id,created_by_table:o.table,created_time:r.created_time??l,last_edited_time:r.last_edited_time??l,version:0,last_edited_by_id:r.last_edited_by_id??o.id,last_edited_by_table:r.last_edited_by_table??o.table}}}({automationActionId:l,automationId:d,creatorPointer:a,originalBlockValue:o,spaceId:n});return{textContainerBlock:s,automation:I,automationAction:m}}o(354520);class y{constructor(e,t,i){this.childToParentMap=new Map,this.unmappedContentIds=new Set,this.extraTranscludedChildren=new(o(99895).G)((()=>new Set)),this.logWarning=t,this.createCopyIndicator=i;for(const{model:o}of e)if(o instanceof _().zgg)for(const t of o.getContentPointers()){e.getModel(t)?this.childToParentMap.has(t.id)?this.extraTranscludedChildren.get(t.id).add(o.id):this.childToParentMap.set(t.id,o.pointer.id):this.unmappedContentIds.add(t.id)}!this.createCopyIndicator&&this.logWarning&&this.logWarning({type:"multiReferencedContentIds",contentIds:Array.from(this.extraTranscludedChildren.keys())})}remapDuplicateBlockParent(e){const{originalBlockPointer:t,duplicateMapper:o}=e,i=this.childToParentMap.get(t.id);if(!i)return;const r=o({requested:{table:g().ev,id:i},requester:t});return r&&r.table===g().ev?r:void 0}createCopyIndicatorBlockValue(e){const{type:t,targetSpaceId:o,sourceBlockId:i,duplicateParentId:r,createdBy:a,createOptions:n,additionalRecordsToMutate:d}=e,{model:l}=_().zgg.create({id:(0,u().JW)(),type:c().xd.copyIndicator,space_id:o,parentPointer:{id:r,table:g().ev,spaceId:o},createdBy:a}),s=l.__IM_SORRY__getValue();return n.onCreate({type:t,duplicateBlockId:s.id,sourceBlockId:i,duplicateParentId:r}),d.push({table:g().ev,value:s}),s.id}remapDuplicateBlockContent(e){const{originalBlockPointer:t,duplicateMapper:o,originalBlockContent:i,originalCreatedBy:r,duplicateBlockId:a,targetSpaceId:n}=e,d=[];return{content:i.map((e=>{if(this.createCopyIndicator&&this.extraTranscludedChildren.has(e)&&this.extraTranscludedChildren.get(e).has(t.id))return this.createCopyIndicatorBlockValue({type:"multi-transcluded-content",targetSpaceId:n,sourceBlockId:e,duplicateParentId:a,createdBy:r,createOptions:this.createCopyIndicator,additionalRecordsToMutate:d});const i=o({requested:{table:g().ev,id:e},requester:t});return i?i.id:this.isUnmappedContentId(e)?this.createCopyIndicator?this.createCopyIndicatorBlockValue({type:"unmapped-content",targetSpaceId:n,sourceBlockId:e,duplicateParentId:a,createdBy:r,createOptions:this.createCopyIndicator,additionalRecordsToMutate:d}):void(null===(l=this.logWarning)||void 0===l||l.call(this,{type:"unmappedContentId",block:t,contentId:e})):e;var l})).filter(l().O9),additionalRecords:d}}isUnmappedContentId(e){return this.unmappedContentIds.has(e)}}var k=()=>o(728396);function q(e,t,o){if((0,k().A8)(e)||(0,k().Jc)(e))return[];const i=[];return o&&i.push(...o),null!=t&&t.previousViewsMainCollectionViewBlockPointer&&i.push(t.previousViewsMainCollectionViewBlockPointer.id),i}var B=()=>o(142748),h=()=>o(813690),C=()=>o(388821),w=()=>o(696706),R=()=>o(519831),P=()=>o(869558),T=()=>o(37165),x=()=>o(144081),S=()=>o(161479),M=()=>o(123382),V=()=>o(743246);o(16280);function O(e){const{mapper:t,requested:o,requester:i,table:r}=e,a=L({mapper:t,requested:o,requester:i});if(!(0,w().Yt)(a,r))throw new Error(`Expected mapped duplicate for ${o.table} ${o.id} to be a ${r}, but it is a ${a.table} (while duplicating ${i.table} ${i.id})`);return a}function L(e){const{mapper:t,requested:o,requester:i}=e,r=t({requested:o,requester:i});if(!r)throw new Error(`Unable to find mapped duplicate for ${o.table} ${o.id} while duplicating ${i.table} ${i.id}`);return r}var D=()=>o(522328),A=()=>o(433519),U=()=>o(498212),j=()=>o(973647),F=()=>o(189141),W=()=>o(612740),E=()=>o(31503);const N="415fc269-e68f-4da0-b3e3-b1273b741a7f";var G=()=>o(651124),z=()=>o(68263),$=()=>o(651784),J=()=>o(824862),Y=()=>o(665344);var Q=()=>o(931075);function H(e){return e.type!==c().xd.collectionViewPage&&(!e.content||0===e.content.length)}var K=()=>o(457671),Z=()=>o(142406);function X({originalSpaceId:e,duplicateSpaceId:t,requester:o,collectionPointer:i,mapper:r}){const a=e===t,n=r({requested:i,requester:o})??(a?i:void 0);if(n){if(n.table!==R().Vl)throw new Error(`Collection pointer for duplicate collection is invalid: ${JSON.stringify(n)}`);return n}}function ee(e){var t,o,i,r,a,n,s,u,m,v,y,k,q,B,h,C,w,T,x;const{originalBlock:M,duplicateBlock:O,mapper:L,options:D,originOptions:A,rewiredUriMap:ee,typedCollectionViewBlocks:te,actor:oe,helperRecordMap:ie,getExternalRecordValue:re,factoryButtonDeprecationContext:ae,legacyTransclusionFixer:ne,installationImprint:de,shouldExcludeBlocksFromLimit:le=!1}=e,ce={table:g().ev,id:M.id,spaceId:M.space_id};if(null!==(t=M.format)&&void 0!==t&&t.app_config_uri&&null!==(o=O.format)&&void 0!==o&&o.app_config_uri)if((0,G().Sn)(M.format.app_config_uri))O.format.app_config_uri=void 0;else{if((0,c().Ef)(O.type)&&(te.push({table:g().ev,id:O.id,spaceId:O.space_id}),O.format.app_id)){const e=L({requested:{table:g().ev,id:O.format.app_id,spaceId:O.space_id},requester:ce,generateDeterministicId:!0});e&&(O.format.app_id=e.id)}ee[M.id]=O.id}if(null!==(i=M.format)&&void 0!==i&&i.app_uri_map&&null!==(r=O.format)&&void 0!==r&&r.app_uri_map)for(const[d,l]of Object.entries(M.format.app_uri_map)){const e=L({requested:{id:l,table:g().ev,spaceId:O.space_id},requester:ce});e&&(O.format.app_uri_map[d]=e.id??l,e.id&&(ee[e.id]=O.id))}const se=[];if(O.crdt_data&&delete O.crdt_data,O.crdt_format_version&&delete O.crdt_format_version,null!==(a=O.format)&&void 0!==a&&a.site_id&&delete O.format.site_id,null!==(n=O.format)&&void 0!==n&&n.marketplace_listing_id&&delete O.format.marketplace_listing_id,null!==(s=O.format)&&void 0!==s&&s.slug&&delete O.format.slug,null!==(u=O.format)&&void 0!==u&&u.trigger_id_to_schedule_id&&delete O.format.trigger_id_to_schedule_id,null!==(m=O.format)&&void 0!==m&&m.duplication_job_ids&&delete O.format.duplication_job_ids,null!==(v=O.format)&&void 0!==v&&v.workflow_instruction_artifact_pointer&&delete O.format.workflow_instruction_artifact_pointer,O.deleted_from_trash_id&&delete O.deleted_from_trash_id,O.deleted_from_trash_table&&delete O.deleted_from_trash_table,O.deleted_from_trash_time&&delete O.deleted_from_trash_time,"factory"===O.type&&ae){const{automation:e,automationAction:t,textContainerBlock:o}=I({blockValue:O,source:"duplication",pointerMapper:e=>L({requested:e,requester:ce})??e,factoryButtonDeprecationContext:ae});se.push(e,t,o),ae.factoryBlockIdToNewTextContainerIdMap.set(M.id,{id:o.value.id,table:g().ev});const i=O;i.type="button",i.content=[],i.format={...i.format,automation_id:e.value.id}}let pe;if((0,U().uj)(M.id)&&(O.format||(O.format={}),O.format.copied_from_pointer={table:g().ev,id:M.id,spaceId:M.space_id},O.copied_from=M.id),M.parent_table===g().ev&&(pe=null==ae?void 0:ae.factoryBlockIdToNewTextContainerIdMap.get(M.parent_id)),pe??=(null==ne?void 0:ne.remapDuplicateBlockParent({originalBlockPointer:ce,duplicateMapper:L}))??L({requested:{table:O.parent_table,id:O.parent_id,spaceId:O.space_id},requester:ce}),pe&&(O.parent_id=pe.id,O.parent_table!==pe.table&&(0,W().LA)(pe)&&(O.parent_table=pe.table)),null!==(y=O.format)&&void 0!==y&&y.ai_instructions_page_pointer&&(O.format.ai_instructions_page_pointer=L({requested:O.format.ai_instructions_page_pointer,requester:ce})),null!==(k=O.format)&&void 0!==k&&k.ai_skill_pointer&&(O.format.ai_skill_pointer=L({requested:O.format.ai_skill_pointer,requester:ce})),null!==(q=O.format)&&void 0!==q&&q.ai_block_configuration_menu){const e=(0,F().p8)(O.format.ai_block_configuration_menu);if(j().Q.isSuccess(e)){const t={...e.value};if("context"in t){const e=(t.context??[]).map((e=>{const t=M.space_id===O.space_id;if("slack"!==e.type||t){if("page"===e.type||"currentPage"===e.type){var o;const i=null===(o=L({requested:{table:g().ev,id:e.pageId,spaceId:O.space_id},requester:ce}))||void 0===o?void 0:o.id;if(!i)return t?e:void 0;return{type:e.type,pageId:i}}if("collection"===e.type){var i,r;const o=null===(i=L({requested:{table:g().ev,id:e.pageId,spaceId:O.space_id},requester:ce}))||void 0===i?void 0:i.id;if(!o)return t?e:void 0;const a=null===(r=L({requested:{table:R().Vl,id:e.collectionId,spaceId:O.space_id},requester:ce}))||void 0===r?void 0:r.id;return a?{type:"collection",pageId:o,collectionId:a}:t?e:void 0}return e}})).filter(l().O9);t.context=e}O.format.ai_block_configuration_menu=t}}const ue=O;ue.view_ids&&(ue.view_ids=ue.view_ids.map((e=>{var t;return(null===(t=L({requested:{table:P().Gy,id:e,spaceId:ue.space_id},requester:ce}))||void 0===t?void 0:t.id)||e})));const _e=_().Bj6.fromBlock(ue).getCollectionPointers(),me=[];for(const d of _e){var fe;const e=null==re?void 0:re({pointer:d}),t=_().Bj6.isModel(R().Vl,e)?e.getFormat().bot_id:void 0,o=null==ie?void 0:ie.getValue(d);if(!Boolean((null==o||null===(fe=o.format)||void 0===fe?void 0:fe.bot_id)??t)){const e=X({originalSpaceId:M.space_id,duplicateSpaceId:O.space_id,requester:ce,collectionPointer:d,mapper:L});if(!e)continue;me.push(e)}}me.length>0?(ue.collection_id=me[0].id,ue.format={...ue.format,collection_pointer:me[0],collection_pointers:me}):(ue.collection_id=void 0,ue.format={...ue.format,collection_pointer:void 0,collection_pointers:void 0}),null!==(B=O.format)&&void 0!==B&&B.form_layout_pointer&&(O.format.form_layout_pointer=L({requested:O.format.form_layout_pointer,requester:ce})),null!==(h=O.format)&&void 0!==h&&h.suggestions&&delete O.format.suggestions,O.discussions&&delete O.discussions,O.permissions&&(D.duplicatePermissions?O.permissions=function(e){const{block:t,targetSpaceSettings:o,targetTeamSettings:i}=e;return(t.permissions||[]).filter((e=>!((0,z().P3)(e)||(0,z().Ds)(e)||(!i&&o.disablePublicAccess||i&&i.disable_public_access)&&(0,z().FP)(e)||(!i&&o.disableGuests||i&&i.disable_guests)&&(0,z().B2)(e)&&!o.memberUserIds.includes(e.user_id))))}({block:O,targetSpaceSettings:D.duplicatePermissions.targetSpaceSettings,targetTeamSettings:D.duplicatePermissions.targetTeamSettings}):(delete O.permissions,"form"===O.type&&(O.permissions=(0,E().eb)()))),O.content_classification&&delete O.content_classification,O.moved&&delete O.moved,O.properties||(O.properties={});for(const d in O.properties)O.properties[d]=b().Uee(O.properties[d],{removeSuggestionAnnotationsAndText:!0,removeSuggestionAnnotations:!0,removeDiscussions:!0});if(le&&H(O)?O.ignore_block_count=!0:O.ignore_block_count&&delete O.ignore_block_count,O.properties){for(const e of Object.keys(O.properties)){const t=O.properties[e];t&&(O.properties[e]=(0,Z().R)({...A,text:{value:t,spaceId:(0,S().e)(O.space_id)},mapper:L,requester:ce,resolveTemplateVariables:D.resolveTemplateVariables||!1}))}if(!0!==D.preserveVerification)for(const e of[Q()._e.Verification,"verifier"])e in O.properties&&(O.properties[e]=[]);"title"in O.properties&&(O.properties.title=b().ooo(O.properties.title))}if("transclusion_reference"===O.type&&D.deepCopyTransclusionContainers){const e=O;if(e.format&&e.format.transclusion_reference_pointer){const t=e.format.transclusion_reference_pointer,o=L({requested:t,requester:ce});o&&(e.format.transclusion_reference_pointer=o)}}if((0,c().$I)(O.type)&&D.shallowCopyNavigableBlock){const e=O;e.type="text";const t=b().ld4(M.id,M.space_id),o=[b().wmz(t)];e.properties={title:o},e.content=[]}if("transclusion_container"===O.type&&!D.deepCopyTransclusionContainers){const e=O;e.type="transclusion_reference",e.content=void 0;const t=e.format||{};t.transclusion_reference_pointer=ce,e.format=t}if("alias"===O.type&&O.format&&O.format.alias_pointer){const e=O.format.alias_pointer,t=L({requested:e,requester:ce});t&&(O.format.alias_pointer=t)}if("image"===O.type){var ve;const e=null===(ve=O.format)||void 0===ve?void 0:ve.image_hyperlink;if(O.format&&e){const[t]=(0,$().Jq)({url:e,isMobile:!1,baseUrl:"",publicDomainName:"",protocol:void 0,currentUrl:void 0});if(t){const e=(0,K().D)({route:t,targetSpaceId:O.space_id,mapper:L,requester:ce});e&&(O.format.image_hyperlink=e)}}}if(ge=O,(0,c().p7)(ge.type)&&O.format)if(de)O.format.installation_imprint={pointer:de};else if(O.format.installation_imprint){const e=L({requested:O.format.installation_imprint.pointer,requester:ce});e&&(O.format.installation_imprint={pointer:{id:e.id,table:Y()._i}})}var ge,be,Ie,ye;if((O.type===c().xd.externalObjectInstancePage&&(O.type=c().xd.externalObjectInstance),O.type===c().xd.externalObjectInstance)&&(null!==(be=O.format)&&void 0!==be&&be.related_external_object_uris_to_instance_ids&&(O.format.related_external_object_uris_to_instance_ids=(0,l().MU)((0,l().WP)(O.format.related_external_object_uris_to_instance_ids).map((([e,t])=>{var o;return[e,(null===(o=L({requested:{table:g().ev,id:t,spaceId:ue.space_id},requester:ce}))||void 0===o?void 0:o.id)||t]})))),D.convertExternalObjectInstancesToPlaceholders&&(null===(Ie=O.format)||void 0===Ie||!Ie.is_placeholder)&&null!==(ye=O.format)&&void 0!==ye&&ye.bot_id)){const e={table:J().GP,id:O.format.bot_id},t=null==ie?void 0:ie.getValue(e),o=null==re?void 0:re({pointer:e}),i=_().Bj6.isModel(J().GP,o)?o.getIntegrationId():void 0,r=(null==t?void 0:t.integration_id)??i;if(r){const e={is_placeholder:!0,integration_id:r};O.format=e}}O.file_ids&&function(e){var t;const o=JSON.stringify(e.properties);e.file_ids=null==e||null===(t=e.file_ids)||void 0===t?void 0:t.filter((t=>{var i,r,a,n,d,l;return!(null===(i=e.format)||void 0===i||!i.display_source||-1===(null===(r=e.format)||void 0===r||null===(r=r.display_source)||void 0===r?void 0:r.indexOf(t)))||!(null===(a=e.format)||void 0===a||!a.page_cover||-1===(null===(n=e.format)||void 0===n||null===(n=n.page_cover)||void 0===n?void 0:n.indexOf(t)))||!(null===(d=e.format)||void 0===d||!d.page_icon||-1===(null===(l=e.format)||void 0===l||null===(l=l.page_icon)||void 0===l?void 0:l.indexOf(t)))||-1!==o.indexOf(t)}))}(O);const ke=M,qe=O;if(qe.format&&(null!==(C=ke.format)&&void 0!==C&&C.original_source||null!==(w=ke.format)&&void 0!==w&&w.image_edit_metadata)&&(qe.format.original_source=void 0,qe.format.image_edit_metadata=void 0),null!==(T=O.format)&&void 0!==T&&T.automation_id){const e=L({requested:{table:f().yB,id:O.format.automation_id,spaceId:O.space_id},requester:ce});e&&(O.format.automation_id=e.id)}var Be;null!==(x=O.format)&&void 0!==x&&x.workflow_id&&(O.format.workflow_id=null===(Be=L({requested:{table:V().C0,id:O.format.workflow_id,spaceId:O.space_id},requester:ce}))||void 0===Be?void 0:Be.id);if(O.format&&"database_agent_ids"in O.format&&O.format.database_agent_ids&&(O.format.database_agent_ids=O.format.database_agent_ids.map((e=>{var t;return null===(t=L({requested:{table:V().C0,id:e,spaceId:O.space_id},requester:ce}))||void 0===t?void 0:t.id})).filter(l().O9)),O.type===c().xd.transcription&&O.format){var he,Ce,we,Re;if(O.format.transcription_notes_id)O.format.transcription_notes_id=null===(Ce=L({requested:{table:g().ev,id:O.format.transcription_notes_id,spaceId:O.space_id},requester:ce}))||void 0===Ce?void 0:Ce.id;if(O.format.transcription_transcript_id)O.format.transcription_transcript_id=null===(we=L({requested:{table:g().ev,id:O.format.transcription_transcript_id,spaceId:O.space_id},requester:ce}))||void 0===we?void 0:we.id;if(O.format.transcription_summary_id)O.format.transcription_summary_id=null===(Re=L({requested:{table:g().ev,id:O.format.transcription_summary_id,spaceId:O.space_id},requester:ce}))||void 0===Re?void 0:Re.id;const e=null===(he=O.format.transcription_state)||void 0===he?void 0:he.state;"transcribing"!==e&&"summarizing"!==e||(O.format.transcription_state={state:"paused"})}if("collection"===M.parent_table&&M.type===c().xd.copyIndicator&&O.properties&&(0,l().uv)(O.properties).length>0&&(O.type=c().xd.page),!D.preserveSourceMetadataTimestamps){const e=Date.now();O.created_time=e,O.last_edited_time=e}oe&&(O.last_edited_by_id=oe.id,O.last_edited_by_table=oe.table,O.created_by_id=oe.id,O.created_by_table=oe.table),O.non_content_children&&(O.non_content_children=O.non_content_children.map((e=>{var t;return(null===(t=L({requested:{table:g().ev,id:e,spaceId:O.space_id},requester:ce}))||void 0===t?void 0:t.id)||e})));const Pe=O;if(Pe.content){var Te;if(ne){const e=ne.remapDuplicateBlockContent({originalBlockPointer:ce,duplicateMapper:L,originalBlockContent:Pe.content,originalCreatedBy:oe||p().TI.pointer,duplicateBlockId:Pe.id,targetSpaceId:O.space_id});Pe.content=e.content,se.push(...e.additionalRecords)}else Pe.content=Pe.content.map((e=>{var t;return null===(t=L({requested:{table:g().ev,id:e},requester:ce,fromContentArray:!0}))||void 0===t?void 0:t.id})).filter(l().O9);if(O.space_id===N&&null!==(Te=O.properties)&&void 0!==Te&&Te.title){var xe,Se,Me;const e=(0,b().RQ)(null===(xe=O.properties)||void 0===xe?void 0:xe.title);e&&e.length>0&&e[0].length>0&&null!==(Se=e[0][0])&&void 0!==Se&&null!==(Se=Se.trim())&&void 0!==Se&&Se.startsWith("ðŸŽ²")&&null!==(Me=e[0][0])&&void 0!==Me&&null!==(Me=Me.trim())&&void 0!==Me&&Me.endsWith("ðŸŽ²")&&(Pe.content=d().k4(Pe.content))}}return{duplicateRecord:O,additionalRecords:se}}var te=()=>o(713998),oe=()=>o(443881);function ie({originalCollection:e,duplicateCollection:t,mapper:o,originOptions:i,rewiredUriMap:r,isTemplateInstantiation:a,options:n,actor:d}){var c,p,u,_,m;const v={table:R().Vl,id:e.id,spaceId:e.space_id};if(function(e,t,o){var i;if(null===(i=e.format)||void 0===i||!i.compound_workflow_template_instances)return;const r={table:R().Vl,id:e.id,spaceId:e.space_id};t.format||(t.format={});t.format.compound_workflow_template_instances=e.format.compound_workflow_template_instances.map((e=>({...e,instance_pointers:e.instance_pointers.map((e=>{const i=t.space_id;if("property"===e.type)return e;const a=e.type,n=O({table:a,mapper:o,requested:{table:a,id:e.id,spaceId:i},requester:r});return{type:n.table,id:n.id}}))})))}(e,t,o),null!==(c=e.format)&&void 0!==c&&c.app_config_uri&&(r[e.id]=t.id),t.template_pages&&(t.template_pages=t.template_pages.map((e=>{var t;return(null===(t=o({requested:{table:g().ev,id:e},requester:v}))||void 0===t?void 0:t.id)||e}))),(0,U().uj)(e.id)){if(t.format||(t.format={}),t.format.copied_from_pointer={table:R().Vl,id:e.id,spaceId:e.space_id},void 0!==t.format.collection_default_template&&"empty"!==t.format.collection_default_template){var b;const e=o({requested:{table:g().ev,id:t.format.collection_default_template.template_page_id},requester:v});e&&null!==(b=t.template_pages)&&void 0!==b&&b.includes(e.id)?t.format.collection_default_template={template_page_id:e.id}:t.format.collection_default_template="empty"}if(t.format.layout_pointer){const e=o({requested:t.format.layout_pointer,requester:v});e&&(0,w().Yt)(e,x().zx)?t.format.layout_pointer=e:t.format.layout_pointer=void 0}t.copied_from=e.id}const I=o({requested:{table:t.parent_table,id:t.parent_id},requester:v});I&&(t.parent_id=I.id);const y=s().Dp(t);for(const l in y){const r=y[l];if(r&&"relation"===r.type&&s().Nv(r)){const e=o({requested:s().Nv(r),requester:v});e?(r.collection_id=e.id,r.collection_pointer={id:e.id,table:R().Vl,spaceId:(0,S().e)(e.spaceId)}):r.property&&(r.property=void 0)}var k;if(r&&"title"===r.type&&t.name&&(t.name=(0,Z().R)({...i,text:{value:t.name,spaceId:t.space_id},mapper:o,requester:v,resolveTemplateVariables:!1})),r&&"button"===r.type&&r.automation_id)r.automation_id=(null===(k=o({requested:{id:r.automation_id,spaceId:e.space_id,table:f().yB},requester:v}))||void 0===k?void 0:k.id)??r.automation_id;r&&s().DQ(r)&&r.options&&(r.options=(0,te().ki)(r.options))}if(t.description&&(t.description=(0,Z().R)({...i,text:{value:t.description,spaceId:t.space_id},mapper:o,requester:v,resolveTemplateVariables:!1})),!n.preserveSourceMetadataTimestamps){const e=Date.now();t.created_time=e,t.last_edited_time=e}d&&(t.last_edited_by_id=d.id,t.last_edited_by_table=d.table,t.created_by_id=d.id,t.created_by_table=d.table),null!==(p=t.format)&&void 0!==p&&p.metadata_copied_from&&(t.format.metadata_copied_from=void 0);for(const l in y){const e=y[l];if(!e||"formula"!==e.type||"v2"!==e.version||!e.formula2)continue;const{value:r}=(0,oe().RI)({baseUrl:i.baseUrl,formula:e.formula2.code,publicDomainName:i.publicDomainName,spaceId:t.space_id,visitors:{visitFormulaContextValue:void 0,visitFormulaPageProperty:e=>{if("collection"in e&&e.collection){const t=o({requested:e.collection,requester:v});if(t&&t.table===R().Vl)return{type:"replace",value:{...e,collection:t}}}return{type:"keep"}},visitRecordPointer:void 0}});e.formula2.code=r}if(null!==(u=t.format)&&void 0!==u&&u.collection_mode&&"page_tree"===t.format.collection_mode.type){var q;const e=t.format.collection_mode.root_page_pointer,i=(null===(q=o({requested:w().L3.fromPointerLike({table:"block",id:e.id,spaceId:t.space_id}),requester:v}))||void 0===q?void 0:q.id)||e.id;t.format.collection_mode={type:"page_tree",root_page_pointer:{id:i,table:"block",spaceId:t.space_id}}}null!==(_=t.format)&&void 0!==_&&_.related_external_object_uris_to_instance_ids&&(t.format.related_external_object_uris_to_instance_ids=(0,l().MU)((0,l().WP)(t.format.related_external_object_uris_to_instance_ids).map((([e,i])=>{var r;return[e,(null===(r=o({requested:{table:R().Vl,id:i,spaceId:t.space_id},requester:v}))||void 0===r?void 0:r.id)||i]})))),delete t.deleted_schema,null!==(m=t.format)&&void 0!==m&&m.automation_ids&&(t.format.automation_ids=t.format.automation_ids.map((e=>{var i;return null===(i=o({requested:{id:e,table:f().yB,spaceId:t.space_id},requester:v}))||void 0===i?void 0:i.id})).filter(l().O9)),e.permissions&&(t.permissions=function(e,t,o){return e.filter((e=>!!(0,z().tb)(e)&&(t||o)))}(e.permissions,a,n.duplicateOnlyCollectionSchema))}var re=()=>o(62371),ae=()=>o(300525);var ne=()=>o(691678),de=()=>o(976618);o(672577);var le=()=>o(966249);const ce={block:!0,collection:!0,collection_view:!0,automation:!0,automation_action:!0,skill:!0,layout:!0,form_question:!0,workflow:!0};function se(e){return e.table in ce}function pe(e){const{sourceBlockId:t,targetBlockPointer:o,recordMap:i,options:r,baseUrl:a,publicDomainName:n,actor:l,getRecordRole:c,mapper:s,preventLegacyTransclusions:p,createLegacyTransclusionCopyIndicator:m,logWarning:f,spaceIdCreator:v,installationImprint:b,isTemplateInstantiation:I}=e,k=[],w=e.recordPointerMap||C().RecordMapPolymorphic.create(),R={table:g().ev,id:t};for(const{pointer:d}of i){if(d.id===t){w.set(d,o);continue}let e=w.get(d);!e&&s&&(e=s({requested:d,requester:R})),e||(e={spaceId:o.spaceId,table:d.table,id:(null==v?void 0:v.idInSavedSpace(d.table))??u().Dt()}),w.set(d,e)}let P;p&&(P=new y(i,f,m??!1));const T=C().RecordMap.create(),S=({requested:e})=>w.get(e),M={},V=[],O=new Set,L=i.getModel({id:t,table:g().ev}),D=L?function(e){const t="duplication",o=new Map;let i;return"factory"===e.type?(i={type:t,isRootBlockFactoryBlock:!0,isCurrentBlockRootBlock:!1,factoryBlockIdToNewTextContainerIdMap:o,rootTextContainerId:u().JW()},i.factoryBlockIdToNewTextContainerIdMap.set(e.id,{id:i.rootTextContainerId,table:g().ev})):i={type:t,isRootBlockFactoryBlock:!1,factoryBlockIdToNewTextContainerIdMap:o},i}(L):void 0;for(const{pointer:d,model:u}of i){if(void 0===u)continue;if(!se(u))continue;const e=Boolean((null==r?void 0:r.resolveTemplateVariables)&&me({rootSourceBlockIds:[t],childSourcePointer:d,getSourceRecordValue:h().xb.fromRecordMap(i)}))?{...r,resolveTemplateVariables:!1}:r;if(u.table===x().zx){const e=q(u.getRawModules(),u.getFormat(),u.getBlocks());for(const t of e)O.add(t)}null!=D&&D.isRootBlockFactoryBlock&&(D.isCurrentBlockRootBlock=u.id===t);const{duplicateRecord:s,additionalRecords:p}=_e({table:u.table,record:u.__IM_SORRY__getValue(),mapper:S,options:e,rewiredUriMap:M,typedCollectionViewBlocks:V,originOptions:{baseUrl:a,publicDomainName:n},actor:l,getRecordRole:c,factoryButtonDeprecationContext:D,legacyTransclusionFixer:P,installationImprint:b,layoutCollectionViewBlocksToRemove:O,logWarning:f});if(void 0!==s){if(u.table===g().ev&&s.id===o.id){const e=s;delete e.parent_id,delete e.parent_table,delete e.alive}I&&u.table===g().ev&&u.autoGenerateOnTemplateDuplication()&&k.push({table:g().ev,id:s.id,spaceId:s.space_id}),ue({duplicateRecordMap:T,duplicateRecordResult:{duplicateRecord:s,additionalRecords:p,duplicateRecordTable:u.table}})}}!function(e){const{rewiredUriMap:t,typedCollectionViewBlocks:o,duplicateRecordMap:i}=e;if(d().Im(t)||0===o.length)return;const r=d().oE(o.map((e=>i.getValue(e))));r.forEach((e=>{var o;const i=null==e||null===(o=e.format)||void 0===o?void 0:o.app_uri_map;i&&Object.entries(i).forEach((([e,o])=>{i[e]=t[o]}))}));const a=r.reduce(((e,t)=>{var o;const i=null==t||null===(o=t.format)||void 0===o?void 0:o.app_id;return i&&(e[i]=e[i]?[...e[i],t]:[t]),e}),{});Object.entries(a).forEach((([e,t])=>{const o=u().JW();t.forEach((e=>{var t;null!=e&&null!==(t=e.format)&&void 0!==t&&t.app_id&&(e.format.app_id=o)}))}))}({rewiredUriMap:M,typedCollectionViewBlocks:V,duplicateRecordMap:T});const A=function(e,t,o,i){if(0===e.size)return t;const r=new Set;for(const c of e){const e=o({requested:{id:c,table:g().ev},requester:i});r.add((null==e?void 0:e.id)||c)}const a=t.clone(),n=_().b4_.fromRecordMap(a);function d(e){return(0,B().Yn)(e.pointer,n).some(((e,t)=>r.has(e.id)))}const l=[];for(const{pointer:c,model:s}of a)s&&!d(s)||l.push(c);return l.forEach((e=>a.delete(e))),a}(O,T,S,R);return{duplicateRecordMap:A,originalToDuplicate:w,aiBlocksToAutoGenerate:k}}function ue(e){const{duplicateRecordResult:t,duplicateRecordMap:o}=e,{additionalRecords:i,duplicateRecord:r,duplicateRecordTable:a}=t;o.setValue(w().L3.fromPointerLike({table:a,id:r.id,spaceId:r.space_id}),r);for(const n of i)o.setValue(w().L3.fromPointerLike({id:n.value.id,table:n.table,spaceId:n.value.space_id}),n.value)}function _e(e){const{table:t,record:o,mapper:i,options:r,originOptions:a,actor:n,helperRecordMap:c,getExternalRecordValue:s,getRecordRole:p,rewiredUriMap:u,typedCollectionViewBlocks:m,factoryButtonDeprecationContext:b,legacyTransclusionFixer:I,installationImprint:y,isTemplateInstantiation:k,shouldExcludeBlocksFromLimit:q,targetBlockIds:B,layoutCollectionViewBlocksToRemove:h,logWarning:C}=e,U=d().mg(o),j=L({mapper:i,requested:w().L3.fromPointerLike({table:t,id:o.id,spaceId:o.space_id}),requester:w().L3.fromPointerLike({table:t,id:o.id})});U.id=j.id,U.space_id=(0,S().e)(j.spaceId);const F=[];if(t===g().ev){const e=U,{additionalRecords:t}=ee({originalBlock:o,duplicateBlock:e,mapper:i,options:r??{},rewiredUriMap:u,typedCollectionViewBlocks:m,originOptions:a,actor:n,helperRecordMap:c,getExternalRecordValue:s,factoryButtonDeprecationContext:b,legacyTransclusionFixer:I,installationImprint:y,shouldExcludeBlocksFromLimit:q});F.push(...t)}else if(t===R().Vl){ie({originalCollection:o,duplicateCollection:U,mapper:i,originOptions:a,rewiredUriMap:u,isTemplateInstantiation:k,options:r??{},actor:n})}else if(t===P().Gy){!function(e,t,o,i,r,a,n,d){var l,c,s,p,u,m,f,v,b,I;const y={table:P().Gy,id:e.id,spaceId:e.space_id};if(null!==(l=e.format)&&void 0!==l&&l.app_config_uri&&null!==(c=t.format)&&void 0!==c&&c.app_config_uri&&((0,G().Sn)(e.format.app_config_uri)?t.format.app_config_uri=void 0:i[e.id]=t.id),null!==(s=e.format)&&void 0!==s&&s.app_uri_map&&null!==(p=t.format)&&void 0!==p&&p.app_uri_map)for(const[_,w]of Object.entries(e.format.app_uri_map)){const r=o({requested:{id:w,table:g().ev,spaceId:e.space_id},requester:y});r&&(t.format.app_uri_map[_]=r.id??w,r.id&&(i[r.id]=t.id))}const k=null===(u=t.format)||void 0===u?void 0:u.collection_pointer;if(k){const i=null==r?void 0:r.getModel(k),a=null==d?void 0:d({pointer:k}),n=_().Bj6.isModel(R().Vl,a)?a.getFormat().bot_id:void 0;if(!Boolean(null==i?void 0:i.isSyncedCollection())&&!Boolean(n)){const i=X({originalSpaceId:e.space_id,duplicateSpaceId:t.space_id,requester:y,collectionPointer:k,mapper:o});t.format={...t.format,collection_pointer:i}}}if(t.format){var q,B;const e=null===(q=t.format.collection_groups)||void 0===q?void 0:q.map((e=>{if("relation"===e.value.type&&(0,re().WO)(e.value.value)&&e.value.value){const t=o({requested:e.value.value,requester:y});return{...e,value:{type:"relation",value:t&&(0,w().Yt)(t,g().ev)?t:e.value.value}}}return e}));t.format.collection_groups=e;const i=null===(B=t.format.board_columns)||void 0===B?void 0:B.map((e=>{if("relation"===e.value.type&&(0,re().WO)(e.value.value)&&e.value.value){const t=o({requested:e.value.value,requester:y});return{...e,value:{type:"relation",value:t&&(0,w().Yt)(t,g().ev)?t:e.value.value}}}return e}));t.format.board_columns=i;const r=t.format.collection_view_default_template;if(void 0!==r&&"empty"!==r){const e=o({requested:{table:g().ev,id:r.template_page_id},requester:y});e&&(a&&(n?null==n?void 0:n.includes(e.id):e)||(t.format.collection_view_default_template={template_page_id:e.id}))}}const h=o({requested:{table:t.parent_table,id:t.parent_id,spaceId:t.space_id},requester:y});if(h&&(t.parent_id=h.id),t.page_sort&&(t.page_sort=t.page_sort.map((e=>{var i;return(null===(i=o({requested:{table:g().ev,id:e,spaceId:t.space_id},requester:y}))||void 0===i?void 0:i.id)||e}))),"page"===t.type&&null!==(m=t.format)&&void 0!==m&&m.page_pointer){var C;const e=t.format.page_pointer,i=(null===(C=o({requested:w().L3.fromPointerLike({table:"block",id:e.id,spaceId:t.space_id}),requester:y}))||void 0===C?void 0:C.id)||e.id;t.format.page_pointer={table:"block",id:i,spaceId:t.space_id}}if(null!==(f=t.format)&&void 0!==f&&f.property_filters){const e=t.format.property_filters;for(const t of e)t.filter&&(0,ae().w)(t.filter,(e=>{var t;return null===(t=o({requested:e,requester:y}))||void 0===t?void 0:t.id}))}if(null!==(v=t.format)&&void 0!==v&&v.filters2){const e=t.format.filters2;for(const t of e)t.filter&&(0,ae().w)(t.filter,(e=>{var t;return null===(t=o({requested:e,requester:y}))||void 0===t?void 0:t.id}))}const T=t.query2;if(T&&T.filter&&(0,ae().w)(T.filter,(e=>{var t;return null===(t=o({requested:e,requester:y}))||void 0===t?void 0:t.id})),null!==(b=t.format)&&void 0!==b&&b.form_block_pointer){var x;const e=o({requested:null===(x=t.format)||void 0===x?void 0:x.form_block_pointer,requester:y});e&&"block"===e.table&&(t.format.form_block_pointer=e)}if(null!==(I=t.format)&&void 0!==I&&I.dashboard_layout_pointer){const e=o({requested:t.format.dashboard_layout_pointer,requester:y});e&&"layout"===e.table&&(t.format.dashboard_layout_pointer=e)}}(o,U,i,u,c,k,B,s)}else t===f().yB?(0,A().i)({originalRecord:o,duplicateRecord:U,mapper:i,options:r??{},actor:n}):t===v().SC?(0,D().I)({originalRecord:o,duplicateRecord:U,mapper:i,getRecordRole:p,options:r??{},originOptions:a}):t===V().C0?function(e){const{original:t,duplicate:o,mapper:i,logWarning:r}=e,a={table:V().C0,id:t.id,spaceId:t.space_id},n=i({requested:{table:g().ev,id:t.parent_id,spaceId:t.space_id},requester:a});if(n&&(o.parent_id=n.id),o.space_id=(null==n?void 0:n.spaceId)??t.space_id,!o.data)return;o.data.runtime_actor_pointer=void 0,o.data.draft_runtime_actor_pointer=void 0,o.data.usage_limit=void 0,o.data.status="runnable",o.data.paused_reason=void 0;for(const c of(null===(d=o.data)||void 0===d?void 0:d.modules)??[]){var d;if(c.state){const e=(0,le().jK)(c.type);null!=e&&e.stateDuplicator&&(c.state=e.stateDuplicator({original:c.state,mapper:i,requester:a}))}if("notion"===c.type&&c.permissions)for(const e of c.permissions)if("notion"===e.type&&"pageOrCollectionViewBlock"===e.identifier.type){const o=i({requested:{table:g().ev,id:e.identifier.blockId,spaceId:t.space_id},requester:a});o&&(e.identifier.blockId=o.id)}}const l=[];for(const c of o.data.triggers??[]){if(!c.state){null==r||r({type:"skippedInvalidWorkflowTrigger",triggerId:c.id,reason:"missingTriggerState"});continue}const e=(o.data.modules??[]).find((e=>e.id===c.moduleId));if(!e){null==r||r({type:"skippedInvalidWorkflowTrigger",triggerId:c.id,reason:"moduleNotFound"});continue}if(!(0,le().jK)(e.type)){null==r||r({type:"skippedInvalidWorkflowTrigger",triggerId:c.id,reason:"moduleDefinitionNotFound"});continue}const t=(0,le().C7)(e.type,c.state.type);t?(c.state=t.triggerDuplicator({original:c.state,mapper:i,requester:a}),l.push(c)):null==r||r({type:"skippedInvalidWorkflowTrigger",triggerId:c.id,reason:"triggerDefinitionNotFound"})}o.data.triggers=l}({original:o,duplicate:U,mapper:i,originOptions:a,logWarning:C}):t===M().MC?function({original:e,duplicate:t,mapper:o,originOptions:i}){const r={table:M().MC,id:e.id,spaceId:e.space_id},a=o({requested:w().L3.fromPointerLike({table:t.parent_table,id:t.parent_id,spaceId:t.space_id}),requester:r});a&&(t.parent_id=a.id)}({original:o,duplicate:U,mapper:i,originOptions:a}):t===x().zx?function({original:e,duplicate:t,mapper:o,layoutCollectionViewBlocksToRemove:i}){var r,a;const n={table:x().zx,id:e.id,spaceId:e.space_id};t.parent_id=L({mapper:o,requested:w().L3.fromPointerLike({table:t.parent_table,id:t.parent_id,spaceId:t.space_id}),requester:n}).id,t.format||(t.format={}),t.format.copied_from_pointer={table:x().zx,id:e.id,spaceId:e.space_id},t.modules=(0,ne().Pe)(t.modules);const d=e=>({...e,collection_view_id:O({table:P().Gy,mapper:o,requested:{table:P().Gy,id:e.collection_view_id,spaceId:t.space_id},requester:n}).id}),l=(0,de().E)(t.modules,(e=>"views"===e.type||"viewsMain"===e.type?{type:e.type,id:e.id,collection_view_block_pointer:{...O({table:g().ev,mapper:o,requested:w().L3.fromPointerLike(e.collection_view_block_pointer),requester:n}),spaceId:t.space_id}}:"formQuestion"===e.type?{type:"formQuestion",id:e.id,formQuestionId:{...O({table:T().lo,mapper:o,requested:w().L3.fromPointerLike({table:T().lo,id:e.formQuestionId,spaceId:t.space_id}),requester:n}),spaceId:t.space_id}.id,parentModuleId:e.parentModuleId,parentConditionalGroupId:e.parentConditionalGroupId,conditionalGroups:e.conditionalGroups}:"placeholder"===e.type?{type:"placeholder",id:e.id,parentModuleId:e.parentModuleId,parentConditionalGroupId:e.parentConditionalGroupId}:"view"===e.type?d(e):"row"===e.type?{type:"row",id:e.id,modules:e.modules.map(d)}:(e.type,e))),c=Object.fromEntries(Object.entries(l.form_conditional_modules??{}).filter((e=>{const[t,o]=e;return"formQuestion"===o.type||"placeholder"===o.type})));t.modules={...l,form_conditional_modules:c},null!==(r=t.format)&&void 0!==r&&r.previousViewsMainCollectionViewBlockPointer&&null!=i&&i.has(t.format.previousViewsMainCollectionViewBlockPointer.id)&&delete t.format.previousViewsMainCollectionViewBlockPointer;const s=null===(a=e.blocks)||void 0===a?void 0:a.filter((e=>!(null!=i&&i.has(e))));s&&(t.blocks=s.map((e=>L({mapper:o,requested:{table:g().ev,id:e,spaceId:t.space_id},requester:n}).id)))}({original:o,duplicate:U,mapper:i,layoutCollectionViewBlocksToRemove:h}):t===T().lo?function(e){const{original:t,duplicate:o,mapper:i}=e,r={table:T().lo,id:t.id,spaceId:t.space_id},a=i({requested:w().L3.fromPointerLike({table:o.parent_table,id:o.parent_id,spaceId:o.space_id}),requester:r});a&&(o.parent_id=a.id)}({original:o,duplicate:U,mapper:i,originOptions:a}):(0,l().HB)(t);return{duplicateRecord:U,additionalRecords:F}}function me(e){const{rootSourceBlockIds:t,childSourcePointer:o,getSourceRecordValue:i}=e;for(const r of(0,B()._N)(o,i))if(fe({rootSourceBlockIds:t,recordWithTable:r}))return!0;return!1}function fe(e){const{recordWithTable:t,rootSourceBlockIds:o}=e;if(t.table!==g().ev)return t.table===v().SC;if(o.includes(t.value.id))return!1;if(_().Bj6.fromBlock(t.value).isTemplateVariableContainerBlock())return!0}var ve=()=>o(583835),ge=()=>o(165358),be=()=>o(416504),Ie=()=>o(416845),ye=()=>o(798880),ke=()=>o(439180),qe=()=>o(357625),Be=()=>o(384944),he=()=>o(547149);function Ce(e){const{environment:t,sourceBlockId:o,sourceBlockSubtree:r,targetBlockPointer:n,targetRecordCache:d,transaction:l,deepCopyTransclusionContainers:c,resolveTemplateVariables:s,recordPointerMap:p,preventLegacyTransclusions:u,createLegacyTransclusionCopyIndicator:_,spaceIdCreator:m,installationImprint:f,templateInstallationMetadata:v,isTemplateInstantiation:g,appendContentOnly:b,sourceBlockUpdateStrategy:I}=e,y=t.currentUser.id;let k=!1;("onboarding"===(null==v?void 0:v.source)||"team_home"===(null==v?void 0:v.source)||null!=v&&v.isFirstPartyPaidTemplate)&&(k=!0);const{duplicateRecordMap:q,originalToDuplicate:B,aiBlocksToAutoGenerate:h}=pe({sourceBlockId:o,targetBlockPointer:n,recordMap:r,recordPointerMap:p,options:{deepCopyTransclusionContainers:c,resolveTemplateVariables:!!s&&{currentUserId:y,currentTimeZone:(0,be().P)()}},baseUrl:i().A.domainBaseUrl,publicDomainName:i().A.publicDomainName,actor:y?{table:ye().oo,id:y}:void 0,getRecordRole:d.makeGetRecordRoleFn(y),preventLegacyTransclusions:u,createLegacyTransclusionCopyIndicator:_,installationImprint:f,logWarning:we,spaceIdCreator:m,isTemplateInstantiation:Boolean(g)}),C=new(a().B)(t,n,{inMemoryRecordCache:d});l.postPerformAssertions.push((function(){if(l.isLocal)return;if(!C.getParentStore())throw new(Ie().yI4)(`Initialized template was not given a parent before being committed in transaction ${l.getUserActionForAnalyticsPurposesOnly()}`)}));const w=I??(b?"append_only":void 0);for(const{model:i}of q)i&&Re({transaction:l,model:i,rootStore:C,currentUserId:y,targetBlockPointer:n,targetRecordCache:d,isTemplateInstantiation:g,shouldExcludeBlocksFromLimit:k,sourceBlockUpdateStrategy:w});h.length>0&&l.postSubmitCallbacks.push((async()=>{await async function(e){const{environment:t,aiBlockPointers:o,parentPageId:i}=e,r=(0,ve().Dv)("generateAiBlockTask");for(const a of o)for await(const e of(0,qe().UT)(t,r,{blockId:a.id,spaceId:a.spaceId,parentPageId:i},{spaceIds:[]}));}({environment:t,aiBlockPointers:h,parentPageId:C.id})}));return{targetBlockStore:C,originalToDuplicate:B,subtreeSize:q.getSize()}}function we(e){"unmappedContentId"===e.type||("multiReferencedContentIds"===e.type?ge().log({level:"warning",from:"createBlockActions",type:"multiReferencedContentIds",data:{ids:e.contentIds}}):"skippedInvalidWorkflowTrigger"===e.type?ge().log({level:"warning",from:"createBlockActions",type:"skippedInvalidWorkflowTrigger",data:{triggerId:e.triggerId,duplicateSkipReason:e.reason}}):(0,l().HB)(e))}function Re(e){const{transaction:t,model:o,rootStore:i,targetBlockPointer:d,currentUserId:c,targetRecordCache:s,isTemplateInstantiation:p,shouldExcludeBlocksFromLimit:u,sourceBlockUpdateStrategy:_}=e;if(o.table===g().ev)return void function(e){var t;const{transaction:o,model:i,rootStore:r,targetBlockPointer:d,currentUserId:c,targetRecordCache:s,isTemplateInstantiation:p,shouldExcludeBlocksFromLimit:u,sourceBlockUpdateStrategy:_}=e,f=i.__IM_SORRY__getValue(),v=a().B.createChildStore(r,i.pointer);i.id===d.id&&p&&f.is_template&&(f.is_template=!1,f.format&&delete f.format.automation_id);u&&H(f)&&(f.ignore_block_count=!0);const g=i.pointer.table===d.table&&i.pointer.id===d.id?null===(t=s.getRecord({pointer:i.pointer,userId:c}))||void 0===t?void 0:t.value:void 0;g&&(delete f.created_by_id,delete f.created_by_table,delete f.created_time);if(g&&"append_only"===_&&i.id===r.id){const e=r.getContentIds()??[],t=i.getContentIds()??[];return void he().applyOperation({store:v,operation:m().op.update({args:{content:[...e,...t]},pointer:i.pointer,path:[]}),transaction:o})}g&&"merge"===_&&i.id===r.id&&(f.properties=function(e){const{source:t,target:o}=e;return{...t,...o,title:(0,b().w9s)(null==o?void 0:o.title)?null==t?void 0:t.title:null==o?void 0:o.title}}({source:f.properties,target:g.properties}),f.format=function(e){const{source:t,target:o}=e;return{...t,...o,copied_from_pointer:null==t?void 0:t.copied_from_pointer}}({source:f.format,target:g.format}),f.file_ids=function(e){const{source:t,target:o}=e;return o&&o.length>0?o:t}({source:f.file_ids,target:g.file_ids}));const I=(null==g?void 0:g.format)??{},y=f.format??{},k=m().op.update({pointer:i.pointer,path:["format"],args:(0,l().uv)(I).reduce(((e,t)=>t in y&&void 0!==y[t]?e:{...e,[t]:null}),{})}),q=g?[k]:[],B=n().rF({block:f,existingBlock:g}).concat(q);for(const a of B)(0,ke().ph)(a)?he().applyCrdtTextOperation({store:v,operation:a,invertedOperation:void 0,transaction:o}):he().applyOperation({store:v,operation:a,transaction:o})}({transaction:t,model:o,rootStore:i,targetBlockPointer:d,currentUserId:c,targetRecordCache:s,isTemplateInstantiation:p,shouldExcludeBlocksFromLimit:u,sourceBlockUpdateStrategy:_});if(p){var I;if(o.table===f().yB&&o.parent_id===d.id)return;if(o.table===v().SC&&o.isType("create_page")&&(null===(I=o.getConfig())||void 0===I?void 0:I.template_page_id)===d.id)return}const y=(0,r().v3)(i,o.pointer),k=o.__IM_SORRY__getValue();Be().KY({store:y,value:k,transaction:t})}}}]);