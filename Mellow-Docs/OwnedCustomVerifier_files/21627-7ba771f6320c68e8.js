"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[21627],{621627:(e,t,n)=>{n.d(t,{$:()=>Ce});var r=n(296540),a=()=>n(852507),i=()=>n(590526),s=()=>n(118307),o=()=>n(390527),d=()=>n(104636),u=(n(944114),()=>n(906745)),c=()=>n(717137),l=()=>n(726637),y=()=>n(401497),m=()=>n(699143),h=()=>n(250910),f=()=>n(406094),p=()=>n(114912),g=()=>n(890492),x=()=>n(81068),b=()=>n(424400),k=()=>n(663639),w=()=>n(736847),j=()=>n(402390),M=()=>n(69708),A=()=>n(100622),v=()=>n(496603),S=()=>n(534177),R=()=>n(573710),T=()=>n(180252),C=()=>n(115512),_=()=>n(781697),O=n(474848);function z(e){const{onChange:t,currentValue:a,extraValidation:i,...s}=e,[o,d]=(0,r.useState)(!1),[u,c]=(0,r.useState)((null==a?void 0:a.toString())??""),l=e=>!(0,S().O9)(i)||i(e);return(0,O.jsx)(n(31511).A,{errorOutline:o,onKeyDown:e=>{if(("ArrowUp"===e.key||"ArrowDown"===e.key)&&(e.preventDefault(),e.stopPropagation(),(0,S().O9)(a))){const n="ArrowUp"===e.key?1:-1,r=a+n;l(r)&&(t(r),c(r.toString()))}},value:u,onChange:e=>{const n=e.currentTarget.value;if(c(n),""===n)t(void 0),d(!1);else{const n=Number(e.currentTarget.value);l(n)?(t(n),d(!1)):(t(void 0),d(!0))}},...s})}const E=(0,M().YK)({never:{id:"automations.RecurrenceEditor.endConditionMenu.never",defaultMessage:"Never"},numberOfRuns:{id:"automations.RecurrenceEditor.endConditionMenu.numberOfRuns",defaultMessage:"Number of runs"},specificDate:{id:"automations.RecurrenceEditor.endConditionMenu.specificDate",defaultMessage:"Specific date"}});function D(e){const{currentValue:t,onChange:n}=e,a=(0,_().e)({minWidth:230}),i="number"===(null==t?void 0:t.type)?t.number_of_occurrences:void 0,[s,o]=(0,r.useState)(i??1),d=[{key:"never",items:[{key:"never",action:()=>{n(void 0)},render:e=>(0,O.jsx)(x().A,{...e,title:(0,O.jsx)(M().sA,{...E.never}),isChecked:void 0===t})}],render:e=>(0,O.jsx)(w().A,{...e})},{key:"number_of_occurrences",items:[{key:"number_of_occurrences",action:()=>{n({type:"number",number_of_occurrences:s})},render:e=>(0,O.jsx)(F,{...e,currentNumber:i??s,onNumberChange:e=>{(0,S().O9)(e)&&(o(e),n({type:"number",number_of_occurrences:e}))},selected:"number"===(null==t?void 0:t.type)})}],render:e=>(0,O.jsx)(w().A,{topBorder:!0,...e})},{key:"date",items:[{key:"date",action:()=>{},render:t=>(0,O.jsx)(q,{...t,...e})}],render:e=>(0,O.jsx)(w().A,{topBorder:!0,...e})}];return(0,O.jsx)(g().A,{...a,children:(0,O.jsx)(k().A,{type:k().O.Vertical,sections:d,initialFocus:0})})}const F=(0,r.forwardRef)((function(e,t){const{currentNumber:n,onNumberChange:r,selected:a,...i}=e,s=(0,y().IS)((()=>({input:{maxWidth:60},menuItemTitle:{overflow:"visible"}})),[]);return(0,O.jsx)(x().A,{...i,itemMarginRight:4,ref:t,titleStyle:s.menuItemTitle,title:(0,O.jsxs)(m().Y1,{gap:"auto",direction:"horizontal",align:"center",children:[(0,O.jsx)("div",{children:(0,O.jsx)(M().sA,{...E.numberOfRuns})}),a?(0,O.jsx)(z,{disabled:!a,currentValue:n,onChange:r,extraValidation:o().isValidRecurrenceNumberOfRuns,style:s.input,maxlength:3}):void 0]}),isChecked:a})})),q=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:a,...s}=e,d=(0,r.useMemo)((()=>u().DateTime.now().plus({weeks:1}).toMillis()),[]),c=(0,M().tz)(),l=(0,i().O$)(T().XX),m="date"===(null==n?void 0:n.type),h=m?n.end_at:d,[f,g]=(0,r.useState)(m);(0,r.useEffect)((()=>{!m&&f&&g(!1)}),[m,f]);const x=(0,r.useMemo)((()=>"date"===(null==n?void 0:n.type)?(0,o().getFormattedEndCondition)(n,c):void 0),[n,c]),b=(0,r.useCallback)((e=>{a({type:"date",end_at:e})}),[a]),k=(0,r.useMemo)((()=>({before:new Date})),[]),w=(0,r.useCallback)((()=>{a({type:"date",end_at:d})}),[a,d]),j=(0,y().IS)((()=>({minWidth:{minWidth:"247px"},calendarContainer:{padding:"8px 0"}})),[]),A=f||m;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(p()._,{...s,title:(0,O.jsx)(M().sA,{...E.specificDate}),chevronType:A?"down":"right",right:x,onClick:w,style:j.minWidth}),A?(0,O.jsx)("div",{style:j.calendarContainer,children:(0,O.jsx)(R().A,{firstDayOfWeek:l,value:h,onChange:b,disabledDays:k})}):void 0]})}));n(581454);const B=(0,M().YK)({hour:{id:"automations.FrequencyMenu.hour",defaultMessage:"{number, plural, one {Hour} other {Hours}}"},day:{id:"automations.FrequencyMenu.day",defaultMessage:"{number, plural, one {Day} other {Days}}"},week:{id:"automations.FrequencyMenu.week",defaultMessage:"{number, plural, one {Week} other {Weeks}}"},month:{id:"automations.FrequencyMenu.month",defaultMessage:"{number, plural, one {Month} other {Months}}"},year:{id:"automations.FrequencyMenu.year",defaultMessage:"{number, plural, one {Year} other {Years}}"}}),I={hour:e=>({...B.hour,values:{number:e?2:1}}),day:e=>({...B.day,values:{number:e?2:1}}),week:e=>({...B.week,values:{number:e?2:1}}),month:e=>({...B.month,values:{number:e?2:1}}),year:e=>({...B.year,values:{number:e?2:1}})};function V(e){const{onSelect:t,currentFrequency:n,pluralLabels:r,frequencies:a}=e,i=(0,_().e)(),s=[{key:"default",items:a.map((e=>{const a=I[e];return{key:e,action:()=>{t(e)},render:t=>(0,O.jsx)(x().A,{...t,title:(0,O.jsx)(M().sA,{...a(r)}),isChecked:n===e})}})),render:e=>(0,O.jsx)(w().A,{...e})}];return(0,O.jsx)(g().A,{...i,children:(0,O.jsx)(k().A,{type:k().O.Vertical,sections:s,initialFocus:0})})}var W=()=>n(264435),N=()=>n(854705);const L=(0,M().YK)({monthRestrictionLabel:{id:"automations.MonthRestrictionMenuItem.monthRestrictionLabel",defaultMessage:"On the"},last:{id:"automations.MonthRestrictionMenuItem.last",defaultMessage:"Last"},day:{id:"automations.MonthRestrictionMenuItem.day",defaultMessage:"Day"}}),H=31,P=4,U=(0,r.forwardRef)((function(e,t){const{initialValue:n,onChange:a,startDateForFallback:i,...s}=e,o=(0,y().IS)((()=>({menuItem:{...!l().A.isMobile&&{paddingTop:6,paddingBottom:8}}})),[]),[d,c]=(h=function(e,t){const n=()=>t?{type:"day",dayNumber:u().DateTime.fromMillis(t).day}:$;return e?"monthdays"===e.type?1!==e.monthdays.length?n():{type:"day",dayNumber:e.monthdays[0]}:"weekdays_in_month"===e.type?1!==e.week_numbers.length||1!==e.weekdays.length?n():{type:"weekday",weekday:e.weekdays[0],weekNumber:-1===e.week_numbers[0]?"last":e.week_numbers[0]}:void(0,S().HB)(e):n()}(n,i),(0,r.useReducer)(((e,t)=>{if("change_day"===t.type)if("day"===t.newDay){if("day"===e.type)return e;if("weekday"===e.type)return{type:"day",dayNumber:"last"===e.weekNumber?1:Math.min(e.weekNumber,P)};(0,S().HB)(e)}else{if("weekday"===e.type)return{...e,weekday:t.newDay};if("day"===e.type)return{type:"weekday",weekday:t.newDay,weekNumber:e.dayNumber>P?"last":e.dayNumber};(0,S().HB)(e)}else if("change_number"===t.type){if("day"===e.type)return{...e,dayNumber:"last"===t.newNumber?1:t.newNumber};if("weekday"===e.type)return{...e,weekNumber:t.newNumber};(0,S().HB)(e)}else(0,S().HB)(t)}),h));var h;return function(e,t){const n=(0,r.useRef)(t);(0,r.useEffect)((()=>{n.current=t}),[t]);const a=(0,r.useRef)(!0);(0,r.useEffect)((()=>{a.current?a.current=!1:n.current(function(e){if("day"===e.type)return{type:"monthdays",monthdays:[e.dayNumber]};if("weekday"===e.type)return{type:"weekdays_in_month",weekdays:[e.weekday],week_numbers:["last"===e.weekNumber?-1:e.weekNumber]};(0,S().HB)(e)}(e))}),[e])}(d,a),(0,O.jsx)(b().Ay,{...s,ref:t,style:o.menuItem,title:(0,O.jsxs)(m().Y1,{gap:"auto",direction:"horizontal",align:"center",children:[(0,O.jsx)("div",{children:(0,O.jsx)(M().sA,{...L.monthRestrictionLabel})}),(0,O.jsx)(Y,{state:d,dispatch:c})]})})}));function Y(e){const{state:t,dispatch:n}=e,r=(0,M().tz)(),a=Z(),i=(0,y().IS)((()=>({button:{height:28,padding:"4px 8px"}})),[]),s=Q(t),o=G(t),d=l().A.isMobile?h().z.SlideUp:h().z.Popup;return(0,O.jsxs)(m().Y1,{width:"hug",direction:"horizontal",gap:6,children:[(0,O.jsx)(h().A,{popupType:d,render:e=>(0,O.jsx)(K,{state:t,onSelect:t=>{n({type:"change_number",newNumber:t}),e.close()}}),renderOrigin:e=>(0,O.jsx)(f().A,{size:"lg",...e,iconTrailing:{icon:N().arrowChevronSingleDownFillSmallIcon,size:"xs",colorVariant:"secondary"},style:i.button,children:"last"===s?(0,O.jsx)(M().sA,{...L.last}):a(s)})}),(0,O.jsx)(h().A,{popupType:d,render:e=>(0,O.jsx)(X,{state:t,onSelect:t=>{n({type:"change_day",newDay:t}),e.close()}}),renderOrigin:e=>(0,O.jsx)(f().A,{size:"lg",...e,iconTrailing:{icon:N().arrowChevronSingleDownFillSmallIcon,size:"xs",colorVariant:"secondary"},style:i.button,children:J(r,o)})})]})}function K(e){const{state:t,onSelect:n}=e,r=(0,_().e)({maxHeight:255}),a=Z(),i=Q(t),s="weekday"===t.type,o=v().oE([{key:"days",items:v().y1(1,("day"===t.type?H:"weekday"===t.type?P:(0,S().HB)(t))+1).map((e=>({key:`day_${e}`,action:()=>n(e),render:t=>(0,O.jsx)(x().A,{...t,title:a(e),isChecked:i===e})}))),render:e=>(0,O.jsx)(w().A,{...e})},s?{key:"last",items:[{key:"last",action:()=>n("last"),render:e=>(0,O.jsx)(x().A,{...e,title:(0,O.jsx)(M().sA,{...L.last}),isChecked:"last"===i})}],render:e=>(0,O.jsx)(w().A,{...e,topBorder:!0})}:void 0]);return(0,O.jsx)(g().A,{...r,children:(0,O.jsx)(k().A,{type:k().O.Vertical,sections:o,initialFocus:0})})}function X(e){const{state:t,onSelect:n}=e,r=(0,M().tz)(),a=(0,_().e)(),s=G(t),o=[{key:"day",items:[{key:"day",action:()=>n("day"),render:e=>(0,O.jsx)(x().A,{...e,title:J(r,"day"),isChecked:"day"===s})}],render:e=>(0,O.jsx)(w().A,{...e})},{key:"weekdays",items:(0,i().K8)((()=>1===T().XX.state?["MO","TU","WE","TH","FR","SA","SU"]:["SU","MO","TU","WE","TH","FR","SA"]),[]).map((e=>({key:`weekday_${e}`,action:()=>n(e),render:t=>(0,O.jsx)(x().A,{...t,title:J(r,e),isChecked:e===s})}))),render:e=>(0,O.jsx)(w().A,{...e,topBorder:!0})}];return(0,O.jsx)(g().A,{...a,children:(0,O.jsx)(k().A,{type:k().O.Vertical,sections:o,initialFocus:0})})}const $={type:"day",dayNumber:1};function Q(e){return"day"===e.type?e.dayNumber:"weekday"===e.type?e.weekNumber:void(0,S().HB)(e)}function G(e){return"day"===e.type?"day":"weekday"===e.type?e.weekday:void(0,S().HB)(e)}function Z(){const e=(0,M().tz)().locale.substring(0,2);return t=>(0,W().o4)(e,t,"d")}function J(e,t){if("day"===t)return e.formatMessage(L.day);{const n=(0,S().uv)(o().RRULE_WEEKDAYS_MAP).indexOf(t)+1;return u().DateTime.fromObject({weekday:n}).setLocale(e.locale).toLocaleString({weekday:"long"})}}n(898992),n(354520),n(430670);const ee=(0,M().YK)({aroundMidnight:{id:"automations.RecurTimeMenu.aroundMidnight",defaultMessage:"Around midnight"},aroundMidnightCaption:{id:"automations.RecurTimeMenu.aroundMidnightCaption",defaultMessage:"12â€“3AM"}});function te(e){const{currentRecurTime:t,onRecurTimeSelected:r}=e,a=(0,M().tz)(),i=(0,_().e)(),s=[{key:"default",items:[...(0,n(59226).X)("automations_dev_tools")?[ne({onRecurTimeSelected:r})]:[],...[{type:"around_midnight"},...v().y1(0,24).flatMap((e=>v().y1(0,60,15).map((t=>({type:"hour_minute",hour:e,minute:t}))))).filter((({hour:e,minute:t})=>0!==e&&1!==e&&2!==e&&!(3===e&&0===t)))].map((e=>{if("hour_minute"===e.type){const{hour:i,minute:s}=e,o=u().DateTime.utc().set({hour:i,minute:s,second:0,millisecond:0}),d=(0,j().H)(a),c=n(971404).V.includes(d)?"H:mm":"h:mm a",l=o.setLocale(d).toFormat(c),y=(null==t?void 0:t.minute)===s&&(null==t?void 0:t.hour)===i;return{key:`hour_minute-${i}-${s}`,action:()=>{r({hour:i,minute:s})},render:e=>(0,O.jsx)(x().A,{...e,title:l,isChecked:y})}}if("around_midnight"===e.type){const e=(0,o().isRunningBetweenMidnightAnd3AM)(t);return{key:"around_midnight",action:()=>{r({hour:0,minute:0})},render:t=>(0,O.jsx)(x().A,{...t,title:(0,O.jsx)(M().sA,{...ee.aroundMidnight}),caption:(0,O.jsx)(M().sA,{...ee.aroundMidnightCaption}),isChecked:e})}}(0,S().HB)(e)}))],render:e=>(0,O.jsx)(w().A,{...e,desktopStyle:{maxHeight:l().A.isMobile?"unset":250,overflow:"scroll"}})}];return(0,O.jsx)(g().A,{...i,children:(0,O.jsx)(k().A,{type:k().O.Vertical,sections:s,initialFocus:0})})}function ne(e){const{onRecurTimeSelected:t}=e;return{key:"developer",action:()=>{const e=re();t({hour:e.hour,minute:e.minute})},render:e=>(0,O.jsx)(ae,{...e})}}function re(){const e=u().DateTime.local();let t=e.set({second:0,millisecond:0}).plus({minute:1});return t.diff(e,"seconds").seconds<20&&(t=t.plus({minute:1})),t}const ae=(0,r.forwardRef)((function(e,t){const[a,i]=(0,r.useState)((()=>re()));return(0,n(866515).n)((()=>{i(re())}),1e3,!0),(0,O.jsx)(x().A,{...e,ref:t,title:`[Dev] Run at ${a.toLocaleString(u().DateTime.TIME_SIMPLE)}`})}));function ie(e){return(0,S().O9)(e.interval)}var se=()=>n(718827);const oe=(0,M().YK)({sunday:{id:"automations.WeekdaySelector.weekdayAbbreviations.sunday",defaultMessage:"Su"},monday:{id:"automations.WeekdaySelector.weekdayAbbreviations.monday",defaultMessage:"Mo"},tuesday:{id:"automations.WeekdaySelector.weekdayAbbreviations.tuesday",defaultMessage:"Tu"},wednesday:{id:"automations.WeekdaySelector.weekdayAbbreviations.wednesday",defaultMessage:"We"},thursday:{id:"automations.WeekdaySelector.weekdayAbbreviations.thursday",defaultMessage:"Th"},friday:{id:"automations.WeekdaySelector.weekdayAbbreviations.friday",defaultMessage:"Fr"},saturday:{id:"automations.WeekdaySelector.weekdayAbbreviations.saturday",defaultMessage:"Sa"}}),de={SU:oe.sunday,MO:oe.monday,TU:oe.tuesday,WE:oe.wednesday,TH:oe.thursday,FR:oe.friday,SA:oe.saturday};function ue(e){const{weekdays:t,onChange:r,style:a,disabled:i}=e,s=(0,M().tz)();return(0,O.jsx)(m().Y1,{direction:"horizontal",gap:"auto",width:"fill",style:a,children:n(856662).U.map((e=>(0,O.jsx)(ce,{isSelected:t.includes(e),onClick:()=>{const n=t.includes(e)?t.length>1?t.filter((t=>t!==e)):t:[...t,e];r(n)},disabled:i,children:s.formatMessage(de[e])},e)))})}function ce(e){const{isSelected:t,children:n,onClick:r,disabled:a}=e,i=(0,y().IS)((()=>({button:{...l().A.isMobile?{width:44,height:44,fontSize:32}:{width:28,height:28},color:t?A().oZ.white:A().Tj.darkTextColor,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:100,flexShrink:0,fontSize:C().Kw,background:t?A().oZ.blue:A().Tj.palette.gray[75]},pressed:{background:t?A().Tj.blueButtonPressedBackground:A().Tj.palette.gray[200]},hovered:{background:t?A().Tj.blueButtonHoveredBackground:A().Tj.palette.gray[100]}})),[t]);return(0,O.jsx)(se().Ay,{disabled:a,onClick:r,style:i.button,hoveredStyle:i.hovered,pressedStyle:i.pressed,children:n})}const le=(0,M().YK)({frequencyLabel:{id:"automations.RecurrenceEditor.frequencyLabel",defaultMessage:"Every"},recurTimeLabel:{id:"automations.RecurrenceEditor.recurTimeLabel",defaultMessage:"At"},startTimeLabel:{id:"automations.RecurrenceEditor.startTimeLabel",defaultMessage:"Starting"},endConditionLabel:{id:"automations.RecurrenceEditor.endConditionLabel",defaultMessage:"Ending"},deleteRecurrenceLabel:{id:"automations.RecurrenceEditor.deleteRecurrenceLabel",defaultMessage:"Stop repeating"},timezone:{id:"automations.RecurrenceEditor.timezone",defaultMessage:"Timezone"}});function ye(e){const{currentValue:t,onDelete:n,disabled:r,allowExpiredRecurrence:a,onSave:i,disallowEnd:s=!1}=e,d=(0,M().tz)(),u=(0,_().e)({minWidth:260}),l=[],m=(0,y().IS)((()=>({disabledMessage:{color:A().Tj.text.secondary,fontSize:C().Kw}})),[]);r&&l.push({key:"disabled_message",items:[{key:"disabled_message",action:()=>{},render:e=>(0,O.jsx)(b().Ay,{...e,title:(0,O.jsx)("div",{style:m.disabledMessage,children:(0,O.jsx)(M().sA,{id:"automations.RecurrenceEditor.noPermissionMessage",defaultMessage:"You do not have permission to edit this automation"})})})}],render:e=>(0,O.jsx)(w().A,{...e})}),!r&&(0,S().O9)(i)&&l.push({key:"save_section",items:[{key:"save_item",action:()=>{},render:e=>(0,O.jsx)(me,{...e,onSave:i,canSave:(0,S().O9)(t.interval)})}],render:e=>(0,O.jsx)(w().A,{...e})}),l.push({key:"main",items:(0,v().oE)([{key:"frequency",action:()=>{},render:t=>(0,O.jsx)(he,{...t,...e,hasSaveSection:(0,S().O9)(i)})},ke(e),Ae(e),"hour"===t.frequency?void 0:{key:"recur_time",action:()=>{},render:t=>(0,O.jsx)(fe,{...t,...e})}]),render:e=>(0,O.jsx)(w().A,{...e,topBorder:r})}),l.push({key:"times",items:[{key:"start_time",action:()=>{},render:t=>(0,O.jsx)(pe,{...t,...e})},...s?[]:[{key:"end_condition",action:()=>{},render:t=>(0,O.jsx)(je,{...t,...e})}],{key:"timezone",action:()=>{},render:t=>(0,O.jsx)(Me,{...t,...e})}],render:e=>(0,O.jsx)(w().A,{...e,topBorder:!0})}),n&&!r&&l.push({key:"delete",items:[{key:"delete",action:()=>{},render:t=>(0,O.jsx)(ge,{...t,...e,onClick:n})}],render:e=>(0,O.jsx)(w().A,{...e,topBorder:!0})});const h=function(e){const{recurrence:t,intl:n,allowExpiredRecurrence:r}=e;if(!ie(t))return{key:"next_recurrence",items:[{key:"invalid_recurrence_config",action:()=>{},render:e=>(0,O.jsx)(xe,{...e,children:(0,O.jsx)(M().sA,{id:"automations.RecurrenceEditor.invalidRecurrenceConfig",defaultMessage:"Missing required fields"})})}],render:e=>(0,O.jsx)(w().A,{...e,topBorder:!0})};const a=(0,o().getFormattedNextRecurrenceTime)({recurrence:t,intl:n});if(!a)return r?{key:"expired_recurrence",items:[{key:"expired_recurrence",action:()=>{},render:e=>(0,O.jsx)(xe,{mode:"info",...e,children:(0,O.jsx)(M().sA,{id:"automations.RecurrenceEditor.automationComplete",defaultMessage:"This is complete and will not run again"})})}],render:e=>(0,O.jsx)(w().A,{...e,topBorder:!0})}:{key:"next_recurrence",items:[{key:"next_recurrence",action:()=>{},render:e=>(0,O.jsx)(xe,{...e,children:(0,O.jsx)(M().sA,{id:"automations.RecurrenceEditor.automationWillNeverRun",defaultMessage:"This automation will never run"})})}],render:e=>(0,O.jsx)(w().A,{...e,topBorder:!0})};return{key:"next_recurrence",items:[{key:"next_recurrence",action:()=>{},render:e=>(0,O.jsx)(be,{...e,nextRecurrenceTime:a})}],render:e=>(0,O.jsx)(w().A,{...e,topBorder:!0})}}({recurrence:e.currentValue,intl:d,allowExpiredRecurrence:a});return h&&l.push(h),(0,O.jsx)(c().A,{debugName:"RecurrenceEditor",capture:!0,allowEsc:!0,children:(0,O.jsx)(g().A,{...u,children:(0,O.jsx)(k().A,{disallowBackspace:!0,type:k().O.Vertical,sections:l,initialFocus:0})})})}const me=(0,r.forwardRef)((function(e,t){const{onSave:r,canSave:a,...i}=e,s=(0,y().IS)((()=>({menuItem:{paddingTop:2},message:{color:A().Tj.text.secondary,fontSize:C().Kw},button:{fontSize:C().Kw}})),[]),o=!a||"disabled"===r;return(0,O.jsx)(b().Ay,{...i,ref:t,style:s.menuItem,title:(0,O.jsxs)(m().Y1,{direction:"horizontal",gap:"auto",align:"center",children:[(0,O.jsx)("div",{style:s.message,children:(0,O.jsx)(M().sA,{id:"automations.RecurrenceEditor.editCadenceTitle",defaultMessage:"Edit cadence"})}),(0,O.jsx)(n(631524).p,{colorPalette:"blue",size:"sm",style:s.button,disabled:o,disabledFeedback:!0,onClick:"disabled"===r?n(806080).lQ:r,children:(0,O.jsx)(M().sA,{id:"automations.RecurrenceEditor.saveButtonLabel",defaultMessage:"Save"})})]})})})),he=(0,r.forwardRef)((function(e,t){const{currentValue:a,onChange:i,disabled:s,hasSaveSection:d,allowedFrequencies:u,...c}=e,p=(0,y().IS)((()=>({input:{maxWidth:34,padding:"4px 8px",opacity:s?.5:1},button:{justifyContent:"flex-end",height:28,opacity:s?.5:1,padding:"4px 8px"},menuItem:{...!l().A.isMobile&&{paddingTop:d?0:8,paddingBottom:2}}})),[s,d]),g=(0,S().O9)(a.interval)&&1!==a.interval,x=(0,r.useMemo)((()=>{const e=u??["day","week","month","year"];return e.includes(a.frequency)?e:[...e,a.frequency]}),[u,a.frequency]),k=(0,r.useCallback)((e=>{a.frequency!==e&&i({...a,frequency:e,..."week"===e&&0===(a.weekdays??[]).length?{weekdays:["MO"]}:{},..."month"===e?{monthly_restriction:{type:"monthdays",monthdays:[1]}}:{}})}),[a,i]);return(0,O.jsx)(b().Ay,{...c,ref:t,title:(0,O.jsx)(M().sA,{...le.frequencyLabel}),style:p.menuItem,disabled:s,right:(0,O.jsxs)(m().Y1,{direction:"horizontal",gap:6,width:"hug",align:"center",children:[(0,O.jsx)(z,{style:p.input,currentValue:a.interval,onChange:e=>{i({...a,interval:e})},extraValidation:o().isValidRecurrenceInterval,disabled:s,maxlength:2}),(0,O.jsx)(h().A,{popupType:l().A.isMobile?h().z.SlideUp:h().z.Popup,render:e=>(0,O.jsx)(V,{currentFrequency:a.frequency,onSelect:t=>{k(t),e.close()},frequencies:x,pluralLabels:g}),renderOrigin:e=>(0,O.jsx)(f().A,{...e,size:"lg",style:p.button,disabled:s,iconTrailing:s?void 0:{icon:n(324254).arrowChevronSingleDownSmallIcon,colorVariant:"secondary",size:"xs"},children:(0,O.jsx)(M().sA,{...I[a.frequency](g)})}),disabled:s})]})})})),fe=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:r,disabled:a,...i}=e,s=(0,M().tz)();let d;return(0,S().O9)(n.hour)&&(d=(0,o().isRunningBetweenMidnightAnd3AM)(n)?s.formatMessage(ee.aroundMidnight):u().DateTime.utc().set({hour:n.hour,minute:n.minute??0,second:0,millisecond:0}).setLocale((0,j().H)(s)).toFormat((0,S().O9)(n.minute)&&0!==n.minute?"h:mm a":"h a")),(0,O.jsx)(h().A,{disabled:a,popupType:l().A.isMobile?h().z.SlideUp:h().z.Popup,render:e=>(0,O.jsx)(te,{onRecurTimeSelected:t=>{r({...n,hour:t.hour,minute:t.minute}),e.close()},currentRecurTime:{hour:n.hour,minute:n.minute}}),placementToOrigin:"right",alignmentToOrigin:"start",renderOrigin:e=>(0,O.jsx)(p()._,{...i,...e,right:d,title:(0,O.jsx)(M().sA,{...le.recurTimeLabel}),chevronType:"right",disabled:a})})})),pe=(0,r.forwardRef)((function(e,t){const{currentValue:r,onChange:a,disabled:i,disallowStart:s=!1,...o}=e,d=(0,M().tz)(),c=(0,n(869190).Yq)({date:u().DateTime.fromMillis(r.start_date),dateFormat:"relative",allowRelativeDates:!0,intl:d,shortenDate:!0});return(0,O.jsx)(h().A,{disabled:i||s,popupType:l().A.isMobile?h().z.SlideUp:h().z.Popup,render:e=>(0,O.jsx)("div",{style:{padding:"18px 14px 14px"},children:(0,O.jsx)(R().A,{firstDayOfWeek:T().XX.state,value:Math.max(r.start_date,Date.now()),onChange:t=>{a({...r,start_date:t}),e.close()},disabledDays:{before:new Date}})}),placementToOrigin:"right",alignmentToOrigin:"start",renderOrigin:e=>(0,O.jsx)(p()._,{...o,...e,right:c,title:(0,O.jsx)(M().sA,{...le.startTimeLabel}),chevronType:"right",disabled:i||s})})})),ge=(0,r.forwardRef)((function(e,t){const{currentValue:n,...r}=e,a=(0,y().IS)((()=>({menuItem:{paddingBlock:2}})),[]);return(0,O.jsx)(x().A,{...r,ref:t,title:(0,O.jsx)(M().sA,{...le.deleteRecurrenceLabel}),style:a.menuItem,isRedOnHover:!0})}));const xe=(0,r.forwardRef)((function(e,t){const{children:n,mode:r="error",...a}=e,i=(0,y().IS)((()=>({disabledMessage:{color:"error"===r?A().Tj.red.text.accentPrimary:A().Tj.text.secondary,fontSize:C().Kw}})),[r]);return(0,O.jsx)(b().Ay,{...a,ref:t,title:(0,O.jsx)("div",{style:i.disabledMessage,children:n})})})),be=(0,r.forwardRef)((function(e,t){const{nextRecurrenceTime:n,...r}=e,a=(0,y().IS)((()=>({menuItem:{paddingBlock:2},titleWrap:{display:"flex",...l().A.isMobile?{flexDirection:"row",flexWrap:"wrap",gap:4}:{flexDirection:"column"},color:A().Tj.text.secondary,fontSize:C().Kw}})),[]);return(0,O.jsx)(b().Ay,{...r,style:a.menuItem,title:(0,O.jsxs)("div",{style:a.titleWrap,children:[(0,O.jsx)("div",{children:(0,O.jsx)(M().sA,{defaultMessage:"Next occurrence:",id:"automations.RecurrenceEditor.NextRecurrenceMenuItem.nextOccurrence"})}),(0,O.jsx)("div",{children:n})]})})}));function ke(e){const{currentValue:t}=e;if("week"===t.frequency)return{key:"weekday_selector",action:()=>{},render:t=>(0,O.jsx)(we,{...t,...e})}}const we=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:r,disabled:a,...i}=e,s=(0,y().IS)((()=>({menuItem:{paddingTop:8,paddingBottom:8}})),[]);return(0,O.jsx)(b().Ay,{...i,disabled:a,style:s.menuItem,title:(0,O.jsx)(ue,{weekdays:n.weekdays??[],onChange:e=>{r({...n,weekdays:e})},disabled:a})})})),je=(0,r.forwardRef)((function(e,t){const{currentValue:n,onChange:a,disabled:i,...s}=e,d=(0,M().tz)(),u=(0,r.useMemo)((()=>n.end_condition),[n]),c=(0,r.useCallback)((e=>{a({...n,end_condition:e})}),[n,a]),y=(0,r.useMemo)((()=>(0,o().getFormattedEndCondition)(u,d)),[u,d]);return(0,O.jsx)(h().A,{disabled:i,popupType:l().A.isMobile?h().z.SlideUp:h().z.Popup,render:e=>(0,O.jsx)(D,{currentValue:u,onChange:c}),placementToOrigin:"right",alignmentToOrigin:"start",renderOrigin:e=>(0,O.jsx)(p()._,{...s,...e,right:y,title:(0,O.jsx)(M().sA,{...le.endConditionLabel}),chevronType:"right",disabled:i})})})),Me=(0,r.forwardRef)((function(e,t){const{currentValue:a,onChange:i,disabled:s,...o}=e,d=(0,r.useCallback)((e=>{i({...a,timezone:e})}),[a,i]);return(0,O.jsx)(n(891793).G,{enableRecents:!0,placementToOrigin:"right",alignmentToOrigin:"start",onSelect:d,disabled:s,currentValue:a.timezone,renderOrigin:e=>(0,O.jsx)(p()._,{...o,...e,title:(0,O.jsx)(M().sA,{...le.timezone}),chevronType:"right",right:(0,n(604995).GF)(a.timezone),disabled:s})})}));function Ae(e){const{currentValue:t,onChange:n,disabled:r}=e;if("month"===t.frequency)return{key:"month_restriction",action:()=>{},render:e=>(0,O.jsx)(U,{...e,initialValue:t.monthly_restriction,startDateForFallback:t.start_date,onChange:e=>{n({...t,monthly_restriction:e})},disabled:r})}}const ve=(0,M().YK)({day:{id:"automations.RecurrencePresetMenu.day",defaultMessage:"Day"},weekday:{id:"automations.RecurrencePresetMenu.weekday",defaultMessage:"Weekday"},week:{id:"automations.RecurrencePresetMenu.week",defaultMessage:"Week"},twoWeeks:{id:"automations.RecurrencePresetMenu.twoWeeks",defaultMessage:"2 Weeks"},month:{id:"automations.RecurrencePresetMenu.month",defaultMessage:"Month"},threeMonths:{id:"automations.RecurrencePresetMenu.threeMonths",defaultMessage:"3 Months"},sixMonths:{id:"automations.RecurrencePresetMenu.sixMonths",defaultMessage:"6 Months"},year:{id:"automations.RecurrencePresetMenu.year",defaultMessage:"Year"}}),Se={day:ve.day,weekday:ve.weekday,week:ve.week,twoWeeks:ve.twoWeeks,month:ve.month,threeMonths:ve.threeMonths,sixMonths:ve.sixMonths,year:ve.year};function Re(e){const{onSelect:t}=e,n=(0,_().e)(),r=[{key:"default",items:(0,S().WP)(Se).map((([e])=>({key:e,action:()=>{t(function(e){const t=(0,d().QA)();switch(e){case"day":return{...t,frequency:"day"};case"weekday":return{...t,frequency:"week",weekdays:["MO","TU","WE","TH","FR"]};case"week":return{...t,frequency:"week",weekdays:["MO"]};case"twoWeeks":return{...t,frequency:"week",interval:2,weekdays:["MO"]};case"month":return{...t,frequency:"month"};case"threeMonths":return{...t,frequency:"month",interval:3};case"sixMonths":return{...t,frequency:"month",interval:6};case"year":return{...t,frequency:"year"};default:(0,S().HB)(e)}}(e))},render:t=>(0,O.jsx)(x().A,{...t,title:(0,O.jsx)(M().sA,{...Se[e]})})}))),render:e=>(0,O.jsx)(w().A,{...e})}];return(0,O.jsx)(g().A,{...n,children:(0,O.jsx)(k().A,{type:k().O.Vertical,sections:r,initialFocus:0})})}const Te=150;function Ce(e){const{recurrence:t,onChange:n,disabled:u,autoFocusIfNew:c,allowedFrequencies:l,requireExplicitSaveAndAllowDelete:y,buttonPopupStore:m,disallowStart:h=!1,disallowEnd:f=!1}=e,p=(0,i().uB)(m,s().A);(0,a().l)((()=>{c&&!t&&setTimeout((()=>{p.setState({open:!0})}),Te)}));const[g,x]=(0,r.useState)(),b=(0,r.useMemo)((()=>g||(t?{...(0,o().convertToUnpersistedRecurrenceConfig)(t),hour:t.hour??0,minute:t.minute??0}:(0,d().QA)())),[g,t]),[k,w]=(0,r.useState)(!1);(0,r.useEffect)((()=>{w((e=>e||Boolean(t)))}),[t]);const j=(0,r.useCallback)((e=>{if(x(e),!y){const t=_e(e);n(t?e:void 0)}}),[n,y]),M=(0,r.useCallback)((()=>{n(void 0),w(!1),p.setState({open:!1})}),[n,p]),A=(0,r.useCallback)((e=>{x(e),y||n(e),p.setState({open:!1}),setTimeout((()=>{w(!0),p.setState({open:!0})}),Te)}),[y,p,n]),v=(0,r.useCallback)((()=>{x(void 0),w(Boolean(t))}),[t]),S=(0,r.useCallback)((()=>!(!t&&!g)&&(!t||!_e(b)||!(0,o().areRecurrenceSchedulesEqual)(b,(0,o().convertToUnpersistedRecurrenceConfig)(t)))),[b,t,g]),R=(0,r.useMemo)((()=>{if(y)return S()&&_e(b)?()=>{n(b),p.setState({open:!1})}:"disabled"}),[p,b,S,n,y]);return{render:(0,r.useCallback)((()=>k||t?(0,O.jsx)(ye,{currentValue:b,onChange:j,onDelete:y?M:void 0,onSave:R,disabled:u,allowedFrequencies:l,disallowStart:h,disallowEnd:f}):(0,O.jsx)(Re,{onSelect:A})),[k,t,b,j,y,M,R,u,l,h,f,A]),onClose:v,buttonPopupStore:p,hasUnpersistedChanges:S}}function _e(e){return ie(e)&&void 0!==(0,o().getNextDateUtc)((0,o().convertFromUnpersistedRecurrenceConfig)(e))}}}]);