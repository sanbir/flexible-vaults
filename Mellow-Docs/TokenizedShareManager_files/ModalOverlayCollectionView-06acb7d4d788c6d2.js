"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[32413],{244837:(e,t,o)=>{o.d(t,{E:()=>S});o(296540);var n=()=>o(484714),i=()=>o(590526),l=()=>o(401497),r=()=>o(631524),c=()=>o(992214),a=()=>o(69708),s=()=>o(100622),d=()=>o(857783),u=()=>o(187820),p=()=>o(16006),h=()=>o(681445),w=o(474848);function S(e){const{collectionStore:t,pageVisitSource:o,size:S}=e,f=(0,n().v3)(),v=(0,a().tz)(),m=(0,i().K8)((()=>{var e;return null==t||null===(e=t.getParentBlockStore())||void 0===e?void 0:e.getNavigableBlockStore()}),[t]),y=(0,i().K8)((()=>null==t?void 0:t.getIcon()),[t]),x=function(e){return(0,l().IS)((()=>({button:{display:"inline-flex",alignItems:"center",color:s().Tj.text.primary,paddingInlineStart:4,paddingInlineEnd:4,marginInlineEnd:2,height:24,flex:"1 1 auto",gap:4,fontSize:e}})),[e])}(S);return(0,w.jsxs)(r().p,{style:x.button,onClick:e=>{m&&(d().uK({environment:f,store:m,pageVisitSource:o}),h().Q.close(),e.stopPropagation(),e.preventDefault())},children:[(0,w.jsx)(u().B6,{disabled:!0,icon:y,iconRecordCategory:"collection",isEmptyPage:!1,size:S,useInvertedColors:!1}),t?(0,w.jsx)(p().A,{store:t}):(0,c().L)(v)]})}},507807:(e,t,o)=>{o.d(t,{S:()=>h,f:()=>w});o(944114);var n=o(296540),i=()=>o(484714),l=()=>o(590526),r=()=>o(165358),c=(o(16280),()=>o(770063)),a=()=>o(439180),s=()=>o(547149);var d=()=>o(878423),u=()=>o(733539),p=()=>o(246125);function h(e,{canUndo:t,shouldPersistOperation:o}){const h=(0,i().v3)(),w=(0,n.useRef)([]).current,S=(0,n.useCallback)((e=>{w.push(...e)}),[w]),f=(0,n.useCallback)((e=>{o&&!o(e)||S([e])}),[S,o]),v=(0,p().l)(e,{cacheFallback:h.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0,onOperationCallback:f});(0,n.useEffect)((()=>{d().A.initializeCache(e,v)}),[e,v]);const m=(0,n.useCallback)((()=>{u().default.reset(),d().A.clearCache(e)}),[e]);(0,n.useEffect)((()=>(u().default.reset(),()=>{u().default.reset(),d().A.expire(e)})),[e]);const y=(0,l().K8)((()=>u().default.state.undoStack.length>0),[]);(0,n.useEffect)((()=>{d().A.updateUnsavedCacheState(e,y)}),[e,y]);const x=(0,n.useCallback)((async e=>{if(0===w.length)return void 0;v.assertUnexpired(),function(e){for(const t of u().default.state.undoStack)for(const o of t.transactions)for(const t of o.stores)if(t.inMemoryRecordCache!==e&&!t.inMemoryRecordCache.isMockTextStore&&!t.inMemoryRecordCache.isTemporaryData){const n=o.getUserActionForAnalyticsPurposesOnly(),i=t.inMemoryRecordCache.name,l=e.name,c=`Undoable user action "${n}" was applied to cache "${i}", but only operations in the cache "${l}" should be in the undo stack!`;(0,r().log)({from:"useLocalDraft",type:"invalidStoreInRevisionStack",level:"error",data:{message:c,miscDataToConvertToString:{userAction:n,inMemoryRecordCacheName:i,expectedInMemoryRecordCacheName:l}}})}}(v);const{serverCommitResult:o}=s().createAndCommit({environment:h,userAction:e,perform(e){!function({environment:e,transaction:t,operationsWithStores:o}){for(const{operation:n,store:i}of o){if(!(i instanceof c().pm))continue;const o=i.clone(e.defaultRecordCache.inMemoryRecordCache);(0,a().ph)(n)?s().applyCrdtTextOperation({store:i,operation:n,transaction:t,invertedOperation:void 0}):s().applyOperation({transaction:t,store:o,operation:n})}}({environment:h,transaction:e,operationsWithStores:w}),e.postSubmitCallbacks.push((e=>{e||(v.expire(),u().default.reset())}))},canUndo:t});return o}),[e,t,h,w,v]);return(0,n.useMemo)((()=>({cache:v,hasChanges:y,persist:x,reset:m})),[y,x,m,v])}function w(e,t){return(0,l().K8)((()=>t.clone(e.cache)),[t,e.cache])}},523337:(e,t,o)=>{o.r(t),o.d(t,{addSquareRoundedIcon:()=>l,iconDefinition:()=>i});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.75 13.75",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10 6.375c.345 0 .625.28.625.625v2.375H13a.625.625 0 1 1 0 1.25h-2.375V13a.625.625 0 1 1-1.25 0v-2.375H7a.625.625 0 1 1 0-1.25h2.375V7c0-.345.28-.625.625-.625"}),(0,n.jsx)("path",{d:"M3.125 5.25c0-1.174.951-2.125 2.125-2.125h9.5c1.174 0 2.125.951 2.125 2.125v9.5a2.125 2.125 0 0 1-2.125 2.125h-9.5a2.125 2.125 0 0 1-2.125-2.125zm2.125-.875a.875.875 0 0 0-.875.875v9.5c0 .483.392.875.875.875h9.5a.875.875 0 0 0 .875-.875v-9.5a.875.875 0 0 0-.875-.875z"})]})},l=(0,o(340498).wt)("addSquareRounded",i,"default")},700868:(e,t,o)=>{o.r(t),o.d(t,{ModalOverlayCollectionView:()=>L});o(16280);var n=o(296540),i=()=>o(907258),l=()=>o(933922),r=()=>o(484714),c=()=>o(852507),a=()=>o(792485),s=()=>o(590526),d=()=>o(401497),u=()=>o(107975),p=()=>o(295633),h=()=>o(569797),w=()=>o(882722),S=()=>o(98126),f=()=>o(406094),v=()=>o(160432),m=()=>o(584262),y=()=>o(187174),x=()=>o(523337),C=()=>o(955363),g=()=>o(869558),V=()=>o(69708),k=()=>o(100622),b=()=>o(534177),j=()=>o(284371),I=()=>o(384944),B=()=>o(485569),M=()=>o(512039),R=()=>o(342),A=()=>o(466088),O=()=>o(507807),E=()=>o(878423),z=()=>o(547149),T=()=>o(478251),W=()=>o(252593),D=()=>o(681445),_=()=>o(244837),P=o(474848);const U=600,H=800,F={display:"flex",justifyContent:"center",alignItems:"center",height:o(236030).PN+o(825666).nh+40},K=["search","saveOrOpenOverflow","closeCollectionViewInModal","dashboardBuildMode"];function L(){const e=(0,s().O$)(D().Q);return e.isOpen?"chart_drilldown"===e.type?(0,P.jsx)(N,{collectionViewBlockStore:e.collectionViewBlockStore,collectionViewValue:e.collectionViewValue,viewsModuleContext:e.viewsModuleContext,title:e.title}):"ai_ephemeral_view"===e.type?(0,P.jsx)(q,{render:()=>(0,P.jsx)(Y,{collectionViewBlockId:e.collectionViewBlockId,collectionViewId:e.collectionViewId,type:e.type})}):null:null}function N(e){const{collectionViewBlockStore:t,collectionViewValue:o,viewsModuleContext:i,title:l}=e,[a,s]=(0,n.useState)(),d=(0,r().v3)(),u=(0,O().S)(R().oW,{canUndo:!1}),p=(0,O().f)(u,t);return(0,c().w)((()=>{const e=z().createAndCommit({environment:d,perform(e){I().zv({store:p.getFormatStore(),data:{block_locked:!0,block_locked_by:d.currentUser.id},transaction:e});return(0,T().i)({environment:d,collectionViewBlockStore:p,collectionView:o,transaction:e,disableAppendingToCollectionViewBlock:!0}).id},userAction:"CollectionChartView.onDrilldownClick",canUndo:!1});s(e.performResult)})),a?(0,P.jsx)(q,{render:()=>(0,P.jsx)(Y,{collectionViewBlockId:t.id,collectionViewId:a,type:"chart_drilldown",title:l,viewsModuleContext:i})}):null}function q(e){const{render:t}=e,{isPhone:o}=(0,r().Y0)(),i=(0,V().tz)(),c=(0,d().IS)((()=>({modalInnerStyle:{background:k().Tj.background.primary,borderRadius:12,minHeight:250,maxHeight:U,width:H},phoneModalInnerStyle:{background:k().Tj.background.primary,borderStartStartRadius:12,borderStartEndRadius:12,borderEndEndRadius:0,borderEndStartRadius:0,height:"66.66vh",width:"100%",position:"absolute",bottom:0}})),[]),a=(0,n.useCallback)((()=>D().Q.close()),[]);return(0,P.jsx)(u().a,{className:w().HA4,open:!0,preventHideChildrenWhileOpening:!0,onDismiss:a,innerStyle:o?c.phoneModalInnerStyle:c.modalInnerStyle,showCloseIcon:o,render:()=>(0,P.jsx)(l().A,{capture:!0,allowEsc:!0,render:t}),ariaLabel:i.formatMessage({defaultMessage:"Table data preview",id:"ModalOverlayCollectionView.ariaLabel"})})}function Y(e){const{collectionViewBlockId:t,collectionViewId:o,type:l,title:c,viewsModuleContext:u}=e,w=(0,r().v3)(),{isPhone:f}=(0,r().Y0)(),v=(0,s().K8)((()=>(0,A().w)(w)),[w]),m=function(e){const{collectionViewBlockId:t,collectionViewId:o}=e,n=(0,a().S)(),l=(0,s().K8)((()=>{if(null!=n&&n.spaceStore)return n.spaceStore;const e=i().default.state.mainEditorCurrentBlockStore;return null!=e&&e.getSpaceStore()?e.getSpaceStore():void 0}),[n]),[{value:r}]=(0,y().Yb)((async()=>{var e;if(!l)return{type:"loading"};let n=p().B.createChildStore(l,{table:"block",id:t});const i=null===(e=E().A.state.caches[R().oW])||void 0===e?void 0:e.inMemoryRecordCache;if(i&&(n=n.clone(i)),await n.load(),!n.isCollectionView())throw new Error("expected collection view");const r=h().p.createChildStore(n,{table:g().Gy,id:o});await r.load();const c=r.getCollectionStore();return await(null==c?void 0:c.load()),{collectionViewBlockStore:n,collectionViewStore:r,collectionStore:c}}),[t,o,l]);return r&&"loading"!==r.type&&r.collectionViewBlockStore?{type:"loaded",value:{collectionViewBlockStore:r.collectionViewBlockStore,collectionViewStore:r.collectionViewStore,collectionStore:r.collectionStore}}:{type:"loading"}}({collectionViewBlockId:t,collectionViewId:o}),x=function(e=0){const[t,o]=(0,n.useState)(!1),i=(0,n.useRef)(Date.now());return(0,n.useEffect)((()=>{let t;const n=requestAnimationFrame((()=>t=requestAnimationFrame((()=>{const t=Date.now()-i.current;t>e?o(!0):setTimeout((()=>{o(!0)}),e-t)}))));return()=>{cancelAnimationFrame(n),t&&cancelAnimationFrame(t)}}),[]),t}(150),C=(0,d().IS)((()=>({phoneContainer:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"},phoneCollectionViewBlockContainer:{overflow:"hidden"}})),[]);if(!x)return(0,P.jsx)("div",{style:F,children:(0,P.jsx)(S().k,{})});switch(m.type){case"loading":return(0,P.jsx)("div",{style:F,children:(0,P.jsx)(S().k,{})});case"loaded":{const{collectionViewBlockStore:e,collectionViewStore:t,collectionStore:n}=m.value,i=f&&n&&!v;let r;"ai_ephemeral_view"!==l&&c?"chart_drilldown"===l&&(r=(0,P.jsx)($,{title:c})):r=(0,P.jsx)(G,{collectionStore:n});const a=(0,P.jsx)(B().dN,{headerText:r,headerActionsBehavior:f?"hidden":"always_show",headerAllowedActions:f?[]:K,hideViewTabBar:!0,isUnlistedView:!0,store:e,isFullScreen:!1,productUseCase:l,disabled:!0,viewId:o,overridePaddingLeft:0,overridePaddingRight:0,additionalCollectionViewInnerHorizontalPadding:16,viewsModuleContext:u,maxHeight:f?void 0:U-72,setCollectionContextStore:o=>{o.setContext({type:"collectionView",collectionViewBlockStore:e,collectionViewStore:t,collectionStore:n,pageVisitSourceOverride:void 0}),f?o.filtersBarOpenStore.setState(!1):o.filtersBarOpenStore.setState(!0)}});return f?(0,P.jsxs)("div",{style:C.phoneContainer,children:[(0,P.jsx)("div",{style:C.phoneCollectionViewBlockContainer,children:a}),i?(0,P.jsx)(Q,{environment:w,collectionViewBlockStore:e,collectionViewStore:t,collectionStore:n,isChartDrilldown:"chart_drilldown"===l}):void 0]}):a}default:(0,b().HB)(m)}}function $(e){const{title:t}=e,{isPhone:o}=(0,r().Y0)(),n=(0,d().IS)((()=>({headerWrapper:{display:"flex",alignItems:"center",flexGrow:1,gap:6,...o?{justifyContent:"center"}:{justifyContent:"flex-start"}},textWrapper:{color:k().Tj.text.primary,fontSize:17,fontWeight:j().Wy.bold,display:"flex",alignItems:"center"}})),[o]);return(0,P.jsx)("div",{style:n.headerWrapper,children:(0,P.jsx)("div",{style:n.textWrapper,children:t})})}function G(e){const{collectionStore:t}=e,o=(0,d().IS)((()=>({textWrapper:{color:k().Tj.primaryBlack,fontSize:17,fontWeight:j().Wy.medium,display:"flex",alignItems:"center"}})),[]);return(0,P.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexGrow:1},children:(0,P.jsx)("div",{style:o.textWrapper,children:(0,P.jsx)(V().sA,{defaultMessage:"Results in {databaseName}",id:"AssistantEphemeralViewHeader.resultsIn",values:{databaseName:(0,P.jsx)(_().E,{collectionStore:t,pageVisitSource:m().y8.AIEphemeralView,size:17})}})})})}function Q(e){const{environment:t,collectionViewBlockStore:o,collectionViewStore:i,collectionStore:l,isChartDrilldown:r}=e,c=(0,V().tz)(),a=(0,n.useRef)(null),s=(0,d().IS)((()=>({container:{padding:"32px 16px 48px",display:"flex",justifyContent:"space-between",gap:10},button:{width:"100%",flexShrink:1,height:44,borderRadius:12,fontSize:17}})),[]),u=(0,n.useCallback)((()=>{W().B({environment:t,blockStore:o,pageVisitSource:r?m().y8.ChartsDrilldown:m().y8.AIEphemeralView})}),[t,o,r]),p=(0,n.useCallback)((()=>{const e=new(M().B)(t);var n;(e.setContext({type:"collectionView",collectionViewBlockStore:o,collectionViewStore:i,collectionStore:l,pageVisitSourceOverride:void 0}),r)&&W().z({collectionContextStore:e,environment:t,originRect:null===(n=a.current)||void 0===n?void 0:n.getBoundingClientRect(),intl:c})}),[o,i,l,t,r,c,a]);return(0,P.jsxs)("div",{style:s.container,children:[(0,P.jsx)(f().A,{style:s.button,iconLeading:{icon:C().arrowDiagonalUpRightIcon,size:24},onClick:u,children:(0,P.jsx)(V().sA,{defaultMessage:"Open source",id:"ModalOverlayCollectionView.phoneButtons.openSource"})}),(0,P.jsx)(v().A,{colorPalette:"blue",ref:a,style:s.button,iconLeading:{icon:x().addSquareRoundedIcon,size:24},onClick:p,children:(0,P.jsx)(V().sA,{defaultMessage:"Save view",id:"ModalOverlayCollectionView.phoneButtons.saveView"})})]})}},825666:(e,t,o)=>{o.d(t,{Lq:()=>n,WK:()=>l,nh:()=>i});const n=40,i=48,l=60}}]);