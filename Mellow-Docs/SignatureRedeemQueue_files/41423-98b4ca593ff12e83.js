"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[41423],{104636:(e,t,o)=>{o.d(t,{Is:()=>d,LS:()=>f,NH:()=>y,QA:()=>p,_b:()=>m});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698);var a=()=>o(906745),n=(o(296540),()=>o(330361)),r=()=>o(390527),i=()=>o(604995),u=()=>o(69708),l=()=>o(488887),s=()=>o(534177),c=o(474848);function d(e){const t=(0,n().g)(e)??[],o=[];for(const a of t){if(!("block"===a.table&&!0===a.isTemplate()&&a.getFormat().automation_id&&a.id!==e.id))continue;const t=a.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&o.push(t.getModel())}}return{automationStoresReady:!0,...(0,r().templateAncestorsViolateRecurrenceNesting)(o)}}function m(e){switch(e){case"hour":return(0,c.jsx)(u().sA,{defaultMessage:"Duplicate hourly",id:"database.templatePickerItem.recurrenceFrequency.hourly"});case"day":return(0,c.jsx)(u().sA,{defaultMessage:"Duplicate daily",id:"database.templatePickerItem.recurrenceFrequency.daily"});case"week":return(0,c.jsx)(u().sA,{defaultMessage:"Duplicate weekly",id:"database.templatePickerItem.recurrenceFrequency.weekly"});case"month":return(0,c.jsx)(u().sA,{defaultMessage:"Duplicate monthly",id:"database.templatePickerItem.recurrenceFrequency.monthly"});case"year":return(0,c.jsx)(u().sA,{defaultMessage:"Duplicate yearly",id:"database.templatePickerItem.recurrenceFrequency.yearly"});default:(0,s().HB)(e)}}function p(){return{start_date:a().DateTime.local().plus({days:1}).set({hour:0,minute:0,second:0,millisecond:0}).toMillis(),timezone:(0,i().dB)(),hour:0,minute:0,frequency:"day",interval:1}}function f(e){const{recurrence:t,intl:o,leadingPhrase:a}=e;return(0,r().rruleFromRecurrence)({..."month"===t.frequency?{...t,monthly_restriction:void 0}:t,weekdays:void 0,hour:0,minute:0,end_condition:void 0}).toText((e=>{switch(e){case"every":if(void 0===a)return"";if("every"===a)return o.formatMessage({id:"database.templatePickerItem.duplicateMenuLabel.every",defaultMessage:"every"});if("duplicate every"===a)return o.formatMessage({id:"database.templatePickerItem.duplicateMenuLabel.duplicateEvery",defaultMessage:"duplicate every"});(0,s().HB)(a);break;case"day":return o.formatMessage({id:"database.templatePickerItem.duplicateMenuLabel.day",defaultMessage:"day"});case"hour":return o.formatMessage({id:"database.templatePickerItem.duplicateMenuLabel.hour",defaultMessage:"hour"});case"hours":return o.formatMessage({id:"database.templatePickerItem.duplicateMenuLabel.hours",defaultMessage:"hours"});case"days":return o.formatMessage({id:"database.templatePickerItem.duplicateMenuLabel.days",defaultMessage:"days"});case"week":{const e=(null==t?void 0:t.weekdays)||[];return 5===e.length&&(0,l()._)(new Set(e),new Set(["MO","TU","WE","TH","FR"]))?o.formatMessage({id:"database.templatePickerItem.duplicateMenuLabel.weekday",defaultMessage:"weekday"}):o.formatMessage({id:"database.templatePickerItem.duplicateMenuLabel.week",defaultMessage:"week"})}case"weeks":return o.formatMessage({id:"database.templatePickerItem.duplicateMenuLabel.weeks",defaultMessage:"weeks"});case"month":return o.formatMessage({id:"database.templatePickerItem.duplicateMenuLabel.month",defaultMessage:"month"});case"months":return o.formatMessage({id:"database.templatePickerItem.duplicateMenuLabel.months",defaultMessage:"months"});case"year":return o.formatMessage({id:"database.templatePickerItem.duplicateMenuLabel.year",defaultMessage:"year"});case"years":return o.formatMessage({id:"database.templatePickerItem.duplicateMenuLabel.years",defaultMessage:"years"});default:return e.toString()}})).trim()}function y(e){const t=e.getRecurrence();return Boolean(e.isTriggerType("recurrence")&&t&&"disabled_recurrence_ended"===e.getStatus())}},241319:(e,t,o)=>{o.d(t,{y:()=>r});o(898992),o(672577);var a=()=>o(534177),n=()=>o(239381);function r(e){var t;const{actionModels:o,id:r}=e,i=(0,n().y5)(r),u="action"===i.source?o.find((e=>e.id===i.action_id)):void 0,l=(0,a().O9)(u)&&u.isType("create_page")?null===(t=u.getConfig())||void 0===t?void 0:t.collection:void 0;return{automationValueInfo:i,collectionPointer:l,actionModel:u}}},390527:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>D,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>b,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>k,MAX_RECURRENCE_INTERVAL:()=>v,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>g,RRULE_WEEKDAYS_MAP:()=>_,adjustedStartDateIfPossible:()=>R,areRecurrenceSchedulesEqual:()=>U,convertFromUnpersistedRecurrenceConfig:()=>F,convertToUnpersistedRecurrenceConfig:()=>x,getFormattedEndCondition:()=>I,getFormattedNextRecurrenceTime:()=>w,getNewEndTimestamp:()=>N,getNextDateUtc:()=>C,getRecurrenceAfter:()=>E,isRunningBetweenMidnightAnd3AM:()=>O,isValidRecurrenceInterval:()=>M,isValidRecurrenceNumberOfRuns:()=>h,rruleFromRecurrence:()=>T,templateAncestorsViolateRecurrenceNesting:()=>A});o(898992),o(354520),o(581454);var a=()=>o(906745);o(944114);function n(e,...t){if(0===t.length)return e.map((e=>[e]));const o=[];for(const a of e)o.push(...n(t[0],...t.slice(1)).map((e=>[a,...e])));return o}var r=()=>o(496603),i=()=>o(534177),u=()=>o(720665),l=()=>o(597777),s=()=>o(869190),c=()=>o(416504),d=()=>o(402390);class m extends(()=>o(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var p=()=>o(912720);const f=(0,o(69708).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),y={hour:m.HOURLY,day:m.DAILY,week:m.WEEKLY,month:m.MONTHLY,year:m.YEARLY},_={MO:m.MO,TU:m.TU,WE:m.WE,TH:m.TH,FR:m.FR,SA:m.SA,SU:m.SU},v=99,g=999;function M(e){return(0,u().Et)(e)&&Number.isInteger(e)&&e>0&&e<=v}function h(e){return(0,u().Et)(e)&&Number.isInteger(e)&&e>0&&e<=g}function T(e){const{start_date:t,frequency:o,interval:a,weekdays:r,timezone:u,hour:s,minute:c}=e,d=(0,l().eU)(t);"hour"===o&&d.setUTCHours(s??0,c??0,0,0);const p="week"===o&&r?r.map((e=>_[e])):void 0,f={};return(0,i().O9)(e.end_condition)&&("date"===e.end_condition.type?f.until=(0,l().eU)(e.end_condition.end_at):"number"===e.end_condition.type?f.count=e.end_condition.number_of_occurrences:(0,i().HB)(e.end_condition)),"month"===e.frequency&&(0,i().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?f.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?f.byweekday=n(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((([e,t])=>_[e].nth(t))):(0,i().HB)(e.monthly_restriction)),new m({freq:y[o],dtstart:d,interval:a,byweekday:p,tzid:"hour"===o?void 0:u,..."hour"===o?{}:{byhour:s??0,byminute:c??0,bysecond:0},...f})}const k=1,b=1;function A(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),a=e.length,n=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,r=a>k,i=o.length>=b;return{violatesConstraint:r||i,templateNestingExceedsMaxDepth:r,ancestorHasDailyTemplate:i,nestedDepthOfAutomationAncestors:a,immediateAncestorRecurrenceType:n}}function R(e){var t;const{recurrence:o,afterDate:n}=e;if("number"===(null===(t=o.end_condition)||void 0===t?void 0:t.type)||o.start_date>=n)return o;let r=a().DateTime.fromMillis(o.start_date,{zone:"utc"});const i=a().DateTime.fromMillis(n,{zone:"utc"});switch(o.frequency){case"hour":{const e=Math.floor(i.diff(r,"hours").hours/o.interval);r=r.plus({hours:e*o.interval});break}case"year":{const e=Math.floor(i.diff(r,"years").years/o.interval);r=r.plus({years:e*o.interval});break}case"month":{const e=Math.floor(i.diff(r,"months").months/o.interval);r=r.plus({months:e*o.interval});break}case"week":{const e=Math.floor(i.diff(r,"weeks").weeks/o.interval);r=r.plus({weeks:e*o.interval});break}case"day":{const e=Math.floor(i.diff(r,"days").days/o.interval);r=r.plus({days:e*o.interval});break}}return{...o,start_date:(0,l().DH)(r.toMillis())}}function E(e){const{recurrence:t,afterDate:o}=e;if((0,p().wt)(t)){const e=(0,l().l1)(o);return t.start_date>=e?new Date(t.start_date):void 0}{const e=T(R({recurrence:t,afterDate:o})).after((0,l().eU)(o));if(!e)return;return(0,l().h1)(e)}}function O(e){return 0===e.hour||1===e.hour||2===e.hour}function C(e){return T(e).after((0,l().eU)((0,l().Rz)()))||void 0}function w(e){const{recurrence:t,intl:o}=e,n=C(F(t));if(!n)return;const r=O(t),i=a().DateTime.fromJSDate(n).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,d().H)(o)).setZone(t.timezone),u=(0,s().Yq)({date:i,dateFormat:"relative",allowRelativeDates:!0,intl:o,shortenDate:!0});if(r)return o.formatMessage(f.dateBetweenMidnightAnd3AM,{date:u});{let e=i.toLocaleString(a().DateTime.TIME_SIMPLE);return t.timezone!==(0,c().P)()&&(e+=` ${i.toFormat("ZZZZ")}`),o.formatMessage(f.dateAtTime,{date:u,time:e})}}function I(e,t){return(0,i().O9)(e)?"number"===e.type?t.formatMessage(f.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,s().Yq)({date:a().DateTime.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,i().HB)(e):t.formatMessage(f.noEndCondition)}const D=100;function x(e){return{...e,start_date:(0,l().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,l().l1)(e.end_condition.end_at)}:(0,i().HB)(e.end_condition):void 0}}function N(e,t,o){return e.plus(o-t)}function S(e,t){const o=a().DateTime.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,l().Rz)(o.toJSDate())}}function F(e){return{...e,start_date:(0,l().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?S(e,e.end_condition):(0,i().HB)(e.end_condition):void 0}}function U(e,t){const o=r().fN(e,(e=>void 0!==e)),a=r().fN(t,(e=>void 0!==e));return r().n4(o,a)}},488887:(e,t,o)=>{function a(e,t){if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}o.d(t,{_:()=>a})},859384:(e,t,o)=>{o.d(t,{M:()=>r});o(296540);var a=o(474848);const n={viewBox:"0 0 20 20",fittedViewBox:"3.12 2.99 13.88 13.88",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"m16.774 4.341-.59.589-1.109-1.11.596-.594a.784.784 0 0 1 1.103 0c.302.302.302.8 0 1.102zM8.65 12.462l6.816-6.813-1.11-1.11-6.822 6.808a1.1 1.1 0 0 0-.236.393l-.289.932c-.052.196.131.38.315.314l.932-.288a.9.9 0 0 0 .394-.236"}),(0,a.jsx)("path",{d:"M4.375 6.25c0-1.036.84-1.875 1.875-1.875H11a.625.625 0 1 0 0-1.25H6.25A3.125 3.125 0 0 0 3.125 6.25v7.5c0 1.726 1.4 3.125 3.125 3.125h7.5c1.726 0 3.125-1.4 3.125-3.125V9a.625.625 0 1 0-1.25 0v4.75c0 1.036-.84 1.875-1.875 1.875h-7.5a1.875 1.875 0 0 1-1.875-1.875z"})]})},r=(0,o(340498).wt)("compose",n,"default")},890409:(e,t,o)=>{o.d(t,{Ah:()=>v,Dk:()=>f,Iv:()=>_,SF:()=>y,YO:()=>h,_f:()=>k,c_:()=>m,dW:()=>M,gW:()=>p,sp:()=>b,vN:()=>g});o(16280),o(944114),o(898992),o(354520),o(803949),o(581454),o(737550);var a=()=>o(496603),n=()=>o(973647),r=()=>o(534177),i=()=>o(842599),u=()=>o(239381),l=()=>o(179034),s=()=>o(798880),c=()=>o(201980),d=()=>o(241319);function m(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"add_automation_step",properties:t})}function p(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"delete_automation_step",properties:t})}function f(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_create",properties:t})}function y(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_update",properties:t})}function _(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_delete",properties:t})}function v(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_enable",properties:t})}function g(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_disable",properties:t})}function M(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_create",properties:t})}function h(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_delete",properties:t})}function T(e){const{formulaAnalyticsModule:t,formulasModule:o,formulaTypecheckContextValues:a,getRecordModel:i,spaceId:l,value:s,featureGates:c}=e;if("formula"===s.type){if(!(0,r().O9)(s.value))return;const e=n().Q.unwrapOr(o.parseFormulaInputToAst(s.value),void 0);if(e){const n=o.addTypesToFormulaAST(e,{handleDataRequest:(0,u().zg)(i),spaceId:l,valueTypes:a,featureGates:c});return{...t.getFormulaAnalytics(e,{getRecordModel:i,typecheckContextValues:a}),formula_return_type:n.node.type,redacted_formula:t.getRedactedFormulaAsStringSync(e,{getRecordModel:i,typecheckContextValues:a})}}}else{if("simple"===s.type){if(!(0,r().O9)(s.value))return;return t.getSimpleFormulaAnalytics(s.value,{getRecordModel:i,typecheckContextValues:a})}(0,r().HB)(s.type)}}function k(e){const{automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:n,formulasModule:l,formulaTypecheckContextValues:m,getRecordModel:p,featureGates:f,simpleFormulasModule:y}=e;return t.isType("complete_sprint")?{automation_action_id:t.pointer.id,type:"complete_sprint"}:t.isType("create_page")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:a,formulaTypecheckContextValues:n,getRecordModel:i,featureGates:u}=e,l=t.getConfig();let s,c=[];const d=null==l?void 0:l.collection,m=null==l?void 0:l.properties;if((0,r().O9)(d)&&(0,r().O9)(m)&&m.length>0){const e=i(d),f=null==e?void 0:e.getNormalizedSchema();(0,r().O9)(f)&&(c=m.map((e=>{var t;return(null===(t=f[e])||void 0===t?void 0:t.type)??"unknown"})));const y=null==l?void 0:l.values;if(a&&(0,r().O9)(y)){s=[];for(const e of m){var p;const r=null===(p=y[e])||void 0===p?void 0:p.value;if(!r)continue;const l=T({formulaAnalyticsModule:o,formulasModule:a,getRecordModel:i,formulaTypecheckContextValues:n,spaceId:t.spaceId,value:r,featureGates:u});l&&s.push(l)}}}return{automation_action_id:t.pointer.id,property_formula_stats:s,property_types:c,type:"create_page"}}({automationActionModel:t,formulaAnalyticsModule:n,formulasModule:l,formulaTypecheckContextValues:m,getRecordModel:p,featureGates:f}):t.isType("duplicate_blocks")?{automation_action_id:t.pointer.id,type:"duplicate_blocks"}:t.isType("modal_confirmation")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:a,formulaTypecheckContextValues:n,getRecordModel:i,featureGates:u}=e,l=t.getConfig(),s=[];if(a&&(0,r().O9)(l)&&l.text){const e=T({formulasModule:a,formulaAnalyticsModule:o,getRecordModel:i,formulaTypecheckContextValues:n,spaceId:t.spaceId,value:l.text,featureGates:u});e&&s.push(e)}return{automation_action_id:t.pointer.id,formula_stats:s,type:"modal_confirmation"}}({automationActionModel:t,formulaAnalyticsModule:n,formulasModule:l,formulaTypecheckContextValues:m,getRecordModel:p,featureGates:f}):t.isType("open_page")?{automation_action_id:t.pointer.id,type:"open_page"}:t.isType("query_collection")?{automation_action_id:t.pointer.id,type:"query_collection"}:t.isType("send_in_app_notification")?function(e){var t;const{automationActionModel:o,formulaAnalyticsModule:a,formulasModule:n,formulaTypecheckContextValues:i,getRecordModel:u,featureGates:l,simpleFormulasModule:s}=e,d={automation_action_id:o.pointer.id,messageCharacterCount:0,type:"send_in_app_notification"},m=o.getConfig();if(!(0,r().O9)(m))return d;if((0,r().O9)(m.target))if("formula"===m.target.type&&(0,r().O9)(m.target.value)){if(d.targetData={type:"formula",numUserFormulaTargets:(0,c().Fbh)(m.target.value.value).length,numFormulaContextTargets:s.getReferencedContextValueIds(m.target.value).length},n){const e=T({formulasModule:n,formulaAnalyticsModule:a,getRecordModel:u,formulaTypecheckContextValues:i,spaceId:o.spaceId,value:m.target.value,featureGates:l});e&&(d.formula_stats??=[],d.formula_stats.push(e))}}else if("property"===m.target.type&&(0,r().O9)(m.target.propertyId)&&(0,r().O9)(m.target.collectionPointer)){const e=u(m.target.collectionPointer),t=null==e?void 0:e.getSchema();var p;(0,r().O9)(t)&&(d.targetData={type:"property",propertyType:null===(p=t[m.target.propertyId])||void 0===p?void 0:p.type})}if((0,r().O9)(null===(t=m.notification_message)||void 0===t?void 0:t.value)&&(d.messageCharacterCount=(0,c().FAw)(m.notification_message.value),n)){const e=T({formulasModule:n,formulaAnalyticsModule:a,getRecordModel:u,formulaTypecheckContextValues:i,spaceId:o.spaceId,value:m.notification_message,featureGates:l});e&&(d.formula_stats??=[],d.formula_stats.push(e))}return d}({automationActionModel:t,formulaAnalyticsModule:n,formulasModule:l,formulaTypecheckContextValues:m,getRecordModel:p,featureGates:f,simpleFormulasModule:y}):t.isType("send_gmail_notification")?function(e){var t,o,n,u,l,d,m;const{automationActionModel:p,formulaAnalyticsModule:f,formulasModule:y,formulaTypecheckContextValues:_,getRecordModel:v,featureGates:g}=e,M=p.getConfig();if(!(0,r().O9)(M))return{automation_action_id:p.pointer.id,fields:{},recipient_domains:{},type:"send_gmail_notification"};const h=Object.fromEntries(Object.entries(M||{}).map((([e,t])=>{var o;return"formula"===(null==t?void 0:t.type)?[e,Boolean(null==t||null===(o=t.value)||void 0===o?void 0:o.value)]:"simple"===(null==t?void 0:t.type)?[e,Boolean(null==t?void 0:t.value)]:[e,Boolean(t)]}))),{to:k,cc:b,bcc:A}=M,R=[...(null==k||null===(t=k.value)||void 0===t?void 0:t.value)||[],...(null==b||null===(o=b.value)||void 0===o?void 0:o.value)||[],...(null==A||null===(n=A.value)||void 0===n?void 0:n.value)||[]],E=[...(0,c().Fbh)(R).map((e=>v({table:s().oo,id:e}))).map((e=>null==e?void 0:e.email)).filter(r().O9),...(0,i().C3)((0,c().k4p)(R))],O=a().Tr(E.map((e=>e.split("@")[1]))),C=[null===(u=M.to)||void 0===u?void 0:u.value,null===(l=M.cc)||void 0===l?void 0:l.value,null===(d=M.bcc)||void 0===d?void 0:d.value,null===(m=M.reply_to)||void 0===m?void 0:m.value,M.from_name,M.email_subject,M.email_body].map((e=>{if(y&&(0,r().O9)(e))return T({formulaAnalyticsModule:f,formulasModule:y,getRecordModel:v,formulaTypecheckContextValues:_,spaceId:p.spaceId,value:e,featureGates:g})})).filter(r().O9);return{automation_action_id:p.pointer.id,fields:h,formula_stats:C,recipient_domains:O,type:"send_gmail_notification"}}({automationActionModel:t,formulaAnalyticsModule:n,formulasModule:l,formulaTypecheckContextValues:m,getRecordModel:p,featureGates:f}):t.isType("slack_notification")?{automation_action_id:t.pointer.id,type:"slack_notification"}:t.isType("update_pages")?function(e){const{automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:a,formulasModule:n,formulaTypecheckContextValues:i,getRecordModel:l,featureGates:s}=e,c=t.getConfig(),m=[],p=[],f=[];if((0,r().O9)(c)&&(0,r().O9)(c.target)&&(0,r().O9)(c.properties)&&c.properties.length>0){let e;if("variable"===c.target.type){const t=(0,u().y5)(c.target.id);if("action"===t.source){const t=(0,d().y)({actionModels:o,id:c.target.id}).collectionPointer;if((0,r().O9)(t)){const o=l(t);e=null==o?void 0:o.getNormalizedSchema()}}else{if("global"!==t.source||"button_page"!==t.global)throw new Error("Failed loading property schema");{const t=(0,u().IV)(i,c.target.id);if("block"===(null==t?void 0:t.type.type)&&(0,r().O9)(t.type.collection)){const o=l(t.type.collection);e=null==o?void 0:o.getNormalizedSchema()}}}}else if("collection"===c.target.type){const t=l(c.target.collection);e=null==t?void 0:t.getNormalizedSchema()}(0,r().O9)(e)&&c.properties.forEach((o=>{const u=e[o];if((0,r().O9)(u)&&(m.push(u.type),n&&(0,r().O9)(c.values))){const e=c.values[o];if((0,r().O9)(e)&&(p.push({type:u.type,operator:e.action}),e.value)){const o=T({formulasModule:n,formulaAnalyticsModule:a,getRecordModel:l,formulaTypecheckContextValues:i,spaceId:t.spaceId,value:e.value,featureGates:s});o&&f.push(o)}}}))}return{automation_action_id:t.pointer.id,property_configs:p,property_formula_stats:f,property_types:m,type:"update_pages"}}({automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:n,formulasModule:l,formulaTypecheckContextValues:m,getRecordModel:p,featureGates:f}):t.isType("define_variables")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:a,formulaTypecheckContextValues:n,getRecordModel:i,featureGates:u}=e,l=t.getConfig(),s=[];if(a&&(0,r().O9)(l)&&l.values)for(const r of Object.values(l.values))if(r.value){const e=T({formulasModule:a,formulaAnalyticsModule:o,getRecordModel:i,formulaTypecheckContextValues:n,spaceId:t.spaceId,value:r.value,featureGates:u});e&&s.push(e)}return{automation_action_id:t.pointer.id,formula_stats:s,type:"define_variables"}}({automationActionModel:t,formulaAnalyticsModule:n,formulasModule:l,formulaTypecheckContextValues:m,getRecordModel:p,featureGates:f}):t.isType("http_request")?{automation_action_id:t.pointer.id,type:"http_request"}:t.isType("publish_site")?{automation_action_id:t.pointer.id,type:"publish_site"}:t.isType("worker")?{automation_action_id:t.pointer.id,type:"worker"}:void(0,r().HB)(t)}function b(e){const{automationModel:t,builderType:o="sidebar",formulaAnalyticsModule:a,formulasModule:n,formulaTypecheckContextValues:i,getRecordModel:u,featureGates:s,simpleFormulasModule:c,source:d}=e,m=[],p=t.getActionPointers().map((e=>u(e))).filter(r().O9);for(const l of t.getActionPointers()){const e=u(l);(0,r().O9)(e)&&m.push(k({automationActionModel:e,automationActionModels:p,formulaAnalyticsModule:a,formulasModule:n,formulaTypecheckContextValues:i,getRecordModel:u,featureGates:s,simpleFormulasModule:c}))}const f=[];let y,_,v;if(t.isEventType()){var g;const e=t.getEventConfiguration(),o=u(t.getParentPointer());y=t.getParentId();const a=t.getEventConfiguration();if("collection_view"===(null===(g=a.source)||void 0===g?void 0:g.type)){const e=u(a.source.pointer);(null==e?void 0:e.parent_table)===l().ev&&(v=null==e?void 0:e.parent_id),_=null==a?void 0:a.source.pointer.id}const n=null==o?void 0:o.getNormalizedSchema();if((0,r().O9)(n)){const{pagesAdded:t,pagePropertiesEdited:o}=e;if(t&&f.push({type:"page"}),"any"===o.type)f.push({condition:"any",type:"property"});else if("none"===o.type)f.push({condition:"none",type:"property"});else{let e=[];"some"===o.type?e=o.some??[]:"all"===o.type&&(e=o.all??[]);const t=[],a=[];e.forEach((e=>{var o;const i=null===(o=n[e.property])||void 0===o?void 0:o.type;(0,r().O9)(i)&&(t.push({type:i,operator:e.filter.operator}),a.push(i))})),f.push({condition:o.type,property_configs:t,property_types:a,type:"property"})}}}else if(t.isButtonType())f.push({type:"button"});else if(t.isRecurrenceType()){var M;f.push({type:"recurrence",frequency:null===(M=t.getTrigger().recurrence)||void 0===M?void 0:M.frequency})}else(0,r().HB)(t);return{automation_actions:m,automation_id:t.id,automation_triggers:f,collection_id:y,collection_view_id:_,collection_view_block_id:v,builder_type:o,source:d}}}}]);