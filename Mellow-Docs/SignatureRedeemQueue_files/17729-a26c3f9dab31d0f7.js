"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[17729,48486],{59110:(e,t,o)=>{o.r(t),o.d(t,{loadLocalSubtree:()=>b});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(803949);var r=()=>o(726637),n=()=>o(700500),i=()=>o(175482),a=()=>o(777447),s=()=>o(792071),c=()=>o(976618),l=()=>o(388821),d=()=>o(696706),p=()=>o(912720),u=()=>o(199378),f=()=>o(179034),v=()=>o(519831),m=()=>o(869558),_=()=>o(37165),I=()=>o(144081),y=()=>o(743246),g=()=>o(201980),h=()=>o(534177);function b(e){const{environment:t,blockId:o,inMemoryRecordCache:r,options:n}=e,i=t.currentUser.id,a=l().RecordMap.create(),s=new Set,c=[{pointer:{table:f().ev,id:o},parentId:"doesn't matter"}];for(;c.length>0;){const e=c.shift();if(!e)continue;if(s.has(e.pointer.id))continue;const t=o===e.pointer.id,l=C({pointer:e.pointer,recordMap:a,inMemoryRecordCache:r,currentUserId:i,cursors:c,cursor:e,options:n,isRootRequest:t});if(l)return l;s.add(e.pointer.id)}return{type:"success",recordMap:a}}function C(e){const{pointer:t,recordMap:o,inMemoryRecordCache:l,currentUserId:b,cursors:C,cursor:w,options:S,isRootRequest:k}=e;let M;return(0,d().Yt)(t,f().ev)?M=function(e){var t,o,c,l;const{pointer:d,recordMap:u,inMemoryRecordCache:v,currentUserId:_,cursors:I,cursor:b,options:C,isRootRequest:w}=e,S=v.getRecord({pointer:d,userId:_}),k=null==S?void 0:S.value;if(!k)return C.requireFullSubtree?{type:"error",reason:"missing_record",pointer:d}:void 0;const M=C.excludeCrdtData?i().ir(k):k;if(C.includeLegacyTransclusionBlockValues){if(!w&&M.parent_id!==b.parentId&&!b.isBlockContentChild)return}else if(!w&&M.parent_id!==b.parentId)return;if(M.type===n().xd.externalObjectInstance&&!C.allowCopyExternalObjectInstances)return{type:"error",reason:"encountered_external_object_instance",pointer:d};if(u.setValue(d,M),!C.skipNavigableChildren){const e=s().Bj6.fromBlock(M).getCollectionPointers();for(const t of e){const e=v.getRecord({pointer:t,userId:_});var R,B;if(e)(null===(R=e.value)||void 0===R?void 0:R.parent_table)===f().ev&&(null===(B=e.value)||void 0===B?void 0:B.parent_id)===M.id&&I.push({pointer:t,parentId:M.id});else if(C.requireFullSubtree)return{type:"error",reason:"missing_record",pointer:t}}if(M.view_ids)for(const t of M.view_ids)I.push({pointer:{table:m().Gy,id:t,spaceId:M.space_id},parentId:M.id})}if(!(C.skipBlockContent||C.skipTransclusionContainerChildren&&"transclusion_container"===M.type||C.skipNavigableChildren&&(0,n().$I)(M.type))){const e=s().Bj6.fromBlock(M).getRenderableContentIds();for(const t of e)I.push({pointer:{table:f().ev,id:t},parentId:M.id,isBlockContentChild:!0})}const U=s().Bj6.fromBlock(M).getNonContentChildren();for(const r of U)I.push({pointer:{table:f().ev,id:r},parentId:M.id,isBlockContentChild:!0});if(M.type===n().xd.externalObjectInstance){var V,x;const e=(null===(V=M.format)||void 0===V?void 0:V.related_external_object_uris_to_instance_ids)&&Object.values(null===(x=M.format)||void 0===x?void 0:x.related_external_object_uris_to_instance_ids)||[];for(const t of e)I.push({pointer:{table:f().ev,id:t,spaceId:M.space_id},parentId:M.id})}if(!C.skipNavigableChildren&&M.properties){const e=Object.values(M.properties).filter(h().O9);for(const t of e)for(const e of t)for(const t of g().uPN(e)){if(g().jIt(t)){const e=g().v55(t);I.push({pointer:{table:f().ev,id:e},parentId:M.id})}if(g().sh$(t)){const e=g().cQR(t),o=(0,a().lX)({url:e,baseUrl:r().A.domainBaseUrl,publicDomainName:r().A.publicDomainName});o&&I.push({pointer:{table:f().ev,id:o},parentId:M.id})}if(g().N53(t)){const e=g().T$c(t);e&&I.push({pointer:{table:f().ev,id:e,spaceId:M.space_id},parentId:M.id})}}}"form"===M.type&&null!==(t=M.format)&&void 0!==t&&t.form_layout_pointer&&I.push({pointer:M.format.form_layout_pointer,parentId:M.id});null!==(o=M.format)&&void 0!==o&&o.automation_id&&I.push({pointer:{table:p().yB,id:M.format.automation_id,spaceId:M.space_id},parentId:M.id});null!==(c=M.format)&&void 0!==c&&c.workflow_id&&I.push({pointer:{table:y().C0,id:M.format.workflow_id,spaceId:M.space_id},parentId:M.id});null!==(l=M.format)&&void 0!==l&&l.ai_instructions_page_pointer&&I.push({pointer:M.format.ai_instructions_page_pointer,parentId:M.id})}({pointer:t,recordMap:o,inMemoryRecordCache:l,currentUserId:b,cursors:C,cursor:w,options:S,isRootRequest:k}):(0,d().Yt)(t,v().Vl)?M=function(e){var t,o;const{pointer:r,recordMap:n,inMemoryRecordCache:i,currentUserId:a,cursors:s,cursor:c,options:l}=e;if(!l.allowCopyCollections)return{type:"error",reason:"encountered_collection",pointer:r};const d=i.getRecord({pointer:r,userId:a});if(null==d||!d.value)return l.requireFullSubtree?{type:"error",reason:"missing_record",pointer:r}:void 0;if(d.value.parent_id!==c.parentId)return;const u=d.value;n.setValue(r,u),i.forEachRecord(a,(({model:e})=>{e.table===f().ev&&e&&e.parent_id===r.id&&e.alive&&s.push({pointer:e.pointer,parentId:r.id})}));const v=(null===(t=u.format)||void 0===t?void 0:t.automation_ids)??[];for(const f of v)s.push({pointer:{table:p().yB,id:f,spaceId:u.space_id},parentId:u.id});u.schema&&Object.values(u.schema).forEach((e=>{e&&"button"===e.type&&e.automation_id&&s.push({pointer:{id:e.automation_id,spaceId:u.space_id,table:p().yB},parentId:u.id})}));null!==(o=u.format)&&void 0!==o&&o.layout_pointer&&s.push({pointer:u.format.layout_pointer,parentId:u.id})}({pointer:t,recordMap:o,inMemoryRecordCache:l,currentUserId:b,cursors:C,cursor:w,options:S}):(0,d().Yt)(t,m().Gy)?M=function(e){var t,o;const{pointer:r,recordMap:n,inMemoryRecordCache:i,currentUserId:a,cursors:s,cursor:c,options:l}=e,d=i.getRecord({pointer:r,userId:a});if(null==d||!d.value)return l.requireFullSubtree?{type:"error",reason:"missing_record",pointer:r}:void 0;if(d.value.parent_id!==c.parentId)return;"form_editor"===d.value.type&&null!==(t=d.value.format)&&void 0!==t&&t.form_block_pointer&&s.push({pointer:d.value.format.form_block_pointer,parentId:d.value.id});null!==(o=d.value.format)&&void 0!==o&&o.dashboard_layout_pointer&&s.push({pointer:d.value.format.dashboard_layout_pointer,parentId:d.value.id});n.setValue(r,d.value)}({pointer:t,recordMap:o,inMemoryRecordCache:l,currentUserId:b,cursors:C,cursor:w,options:S}):(0,d().Yt)(t,p().yB)?M=function(e){const{pointer:t,recordMap:o,inMemoryRecordCache:r,currentUserId:n,cursors:i,cursor:a,options:s}=e,c=r.getRecord({pointer:t,userId:n});if(null==c||!c.value)return s.requireFullSubtree?{type:"error",reason:"missing_record",pointer:t}:void 0;if(c.value.parent_id!==a.parentId)return;o.setValue(t,c.value);for(const l of c.value.action_ids??[])i.push({pointer:{table:u().SC,id:l,spaceId:c.value.space_id},parentId:c.value.id})}({pointer:t,recordMap:o,inMemoryRecordCache:l,currentUserId:b,cursors:C,cursor:w,options:S}):(0,d().Yt)(t,u().SC)?M=function(e){const{pointer:t,recordMap:o,inMemoryRecordCache:r,currentUserId:n,cursors:i,cursor:a,options:s}=e,c=r.getRecord({pointer:t,userId:n});if(null==c||!c.value)return s.requireFullSubtree?{type:"error",reason:"missing_record",pointer:a.pointer}:void 0;if(c.value.parent_id!==a.parentId)return;o.setValue(t,c.value);for(const l of c.value.blocks??[])i.push({pointer:{table:f().ev,id:l,spaceId:c.value.space_id},parentId:c.value.id})}({pointer:t,recordMap:o,inMemoryRecordCache:l,currentUserId:b,cursors:C,cursor:w,options:S}):(0,d().Yt)(t,y().C0)?M=function(e){const{pointer:t,recordMap:o,inMemoryRecordCache:r,currentUserId:n,cursor:i,options:a}=e,s=r.getRecord({pointer:t,userId:n});if(null==s||!s.value)return a.requireFullSubtree?{type:"error",reason:"missing_record",pointer:i.pointer}:void 0;if(s.value.parent_id!==i.parentId)return;o.setValue(t,s.value)}({pointer:t,recordMap:o,inMemoryRecordCache:l,currentUserId:b,cursor:w,options:S}):(0,d().Yt)(t,I().zx)?M=function(e){const{pointer:t,recordMap:o,inMemoryRecordCache:r,currentUserId:n,cursors:i,options:a}=e,l=r.getRecord({pointer:t,userId:n}),d=null==l?void 0:l.value;if(!d)return a.requireFullSubtree?{type:"error",reason:"missing_record",pointer:t}:void 0;o.setValue(t,d);const p=s().Bj6.fromValue(I().zx,d);for(const s of p.getBlockChildrenPointers())i.push({pointer:s,parentId:t.id});const u=e=>{const o={id:e.collection_view_id,table:m().Gy,spaceId:d.space_id};return i.push({pointer:o,parentId:t.id}),e};(0,c().E)(d.modules,(e=>{if("formQuestion"===e.type){const o={id:e.formQuestionId,table:_().lo,spaceId:d.space_id};i.push({pointer:o,parentId:t.id})}else if("view"===e.type)u(e);else if("row"===e.type)for(const t of e.modules)"view"===t.type&&u(t)}))}({pointer:t,recordMap:o,inMemoryRecordCache:l,currentUserId:b,cursors:C,cursor:w,options:S}):(0,d().Yt)(t,_().lo)&&(M=function(e){const{pointer:t,recordMap:o,inMemoryRecordCache:r,currentUserId:n,options:i}=e,a=r.getRecord({pointer:t,userId:n});if(null==a||!a.value)return i.requireFullSubtree?{type:"error",reason:"missing_record",pointer:t}:void 0;o.setValue(t,a.value)}({pointer:t,recordMap:o,inMemoryRecordCache:l,currentUserId:b,cursors:C,cursor:w,options:S})),M}},324009:(e,t,o)=>{o.d(t,{I:()=>h});o(410838),o(898992),o(354520),o(430670),o(581454);var r=o(296540),n=()=>o(484714),i=()=>o(590526),a=()=>o(101734),s=()=>o(68169),c=()=>o(591779),l=()=>o(69708),d=()=>o(821062),p=()=>o(671593),u=()=>o(965454),f=()=>o(844317),v=()=>o(46986),m=()=>o(36951),_=()=>o(791256),I=()=>o(9140),y=()=>o(676953),g=()=>o(166442);function h(e){const{threadStore:t,spaceId:o,defaultConfig:y}=e,h=(0,n().v3)(),C=(0,l().tz)(),w=(0,v().i7)(),S=(0,i().K8)((()=>{var e;const{steps:o}=(0,_().A3)({clientStore:g().defaultClientAIChatStore,threadStore:t});return null===(e=o.findLast((e=>"config"===e.type)))||void 0===e?void 0:e.value}),[t],{useDeepEqual:!0}),k=(0,i().K8)((()=>function(e){const{environment:t,intl:o,isAgentEnabled:r,spaceId:n}=e,i=t.RouterStore.state.route;if("page"!==i.name&&"chat"!==i.name&&"home"!==i.name&&"ai"!==i.name)return;const c=i.targetConfig;if(!c||!(0,a().bD)(c.type))return;const l=(0,s().bz)(c.type),d={...l,...c};switch(d.type){case"markdown-chat":if(b({config:(0,p().Qq)(I().zu,d),intl:o,isAgentEnabled:r,environment:t,spaceId:n}))return d;break;case"researcher":if((0,p().Xj)(I().Gy,d))return d;break;case"workflow":if((0,p().Xj)(I().zp,d)&&b({config:d,intl:o,isAgentEnabled:r,environment:t,spaceId:n}))return d}return l}({environment:h,intl:C,isAgentEnabled:w,spaceId:o})),[h,C,w,o],{useDeepEqual:!0}),M=(0,i().K8)((()=>(0,m().YM)({spaceId:o,environment:h})),[o,h],{useDeepEqual:!0}),[R,B]=(0,r.useState)(),U=(0,r.useCallback)((e=>{B("reset"===e?void 0:e)}),[]),V=(0,c().ZC)(null==t?void 0:t.id);(0,r.useEffect)((()=>{V===(null==t?void 0:t.id)||(0,u().Ci)(t)||U("reset")}),[null==t?void 0:t.id,V,U,t]);const x=Boolean(null==t?void 0:t.id),A=R??(x?void 0:y)??S??(x?void 0:k)??M;return{nextConfig:(0,i().K8)((()=>function(e,t,o){if("workflow"===e.type){const r=(0,f().getWorkflowAgentConfig)({...e,environment:t,spaceId:o});return r.writerMode?(0,f().getWorkflowAgentConfig)({...e,environment:t,spaceId:o,writerMode:!1}):r}return e}(A,h,o)),[A,h,o],{equalityFn:d().k}),setNextConfig:U}}function b(e){const{intl:t,isAgentEnabled:o,environment:r,spaceId:n,config:i}=e;if(!i)return!1;if(!i.model)return!0;return(0,y()._y)({intl:t,isAgentEnabled:o,environment:r,spaceId:n}).flatMap((e=>e.items)).filter((e=>e.config.type===i.type)).map((e=>e.askMode)).includes(i.model)}},460957:(e,t,o)=>{o.d(t,{E:()=>a});o(581454);var r=()=>o(201980),n=()=>o(718957),i=()=>o(29554);function a(e){const{multiSelection:t}=e;return(0,n().$W)(t).map((({store:e,selection:t})=>{const o=(0,r().RQ)(e.getValue()),n=(0,r().xbM)(o,t),{tokensInsideRange:a}=(0,r().AI5)(o,n.startIndex,n.endIndex);return(0,i().r4)(a,e)})).join("\n\n")}},839754:(e,t,o)=>{o.d(t,{Bi:()=>k,My:()=>S,ZM:()=>R,_M:()=>M,navigateToWorkflowTemplateOnboardingModal:()=>B});o(16280),o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(581454);var r=()=>o(907258),n=()=>o(295633),i=()=>o(584262),a=()=>o(663077),s=()=>o(179034),c=()=>o(201980),l=()=>o(749750),d=()=>o(896628),p=()=>o(384944),u=()=>o(857783),f=()=>o(730969),v=()=>o(840153),m=()=>o(339798),_=()=>o(180762),I=()=>o(799832),y=()=>o(111379),g=()=>o(295304),h=()=>o(547149),b=()=>o(373444),C=()=>o(165592),w=()=>o(204067);function S({transaction:e,collectionStore:t,propertyTemplates:o}){var r;const n=(null===(r=t.getParentBlockStore())||void 0===r?void 0:r.getCollectionViewStores().filter((e=>"table"===e.getType())))??[];if(0===n.length)return;const i=[];for(const c of o){const e=(0,w().S1)({collectionStore:t,templateId:c.templateId,instancePointerType:"property"});e&&i.push({property:e.id,visible:!(0,a().Sz)(c),...c.tablePropertyFormat})}if(0!==i.length)for(const a of n){var s;const t=(null===(s=a.getPropertyFormatsStore("table_properties"))||void 0===s?void 0:s.getValue())??[],o=new Set(t.map((e=>e.property))),r=i.filter((e=>!o.has(e.property)));0!==r.length&&d().zA({stores:[a],update:{table_properties:[...t,...r]},transaction:e})}}function k({transaction:e,collectionStore:t,propertyTemplates:o}){const r=[];for(const s of o){const e=(0,w().S1)({collectionStore:t,templateId:s.templateId,instancePointerType:"property"});e&&r.push({property:e.id,visible:!0})}const n=t.getFormat().collection_page_properties??[],i=new Set(n.map((e=>e.property))),a=r.filter((e=>!i.has(e.property)));a.length&&d().zA({stores:[t],update:{collection_page_properties:[...n,...a]},transaction:e})}function M({environment:e,newPageStore:t,result:o}){"accepted_template"!==o.type&&"accepted_empty_collection"!==o.type||h().createAndCommit({environment:e,canUndo:!1,perform:r=>{const i=t.getTitleValue();if(p().zv({store:t,transaction:r,data:{alive:!1}}),"accepted_empty_collection"===o.type&&!(0,c().w9s)(i)){const a=n().B.createChildStore(t,{table:"block",id:o.blockId}).getTitleStore();a&&g().yr({environment:e,transaction:r,tokens:i,index:0,store:a})}const a=t.getParentStore();if((null==a?void 0:a.table)===s().ev){const e=a.getContentIds();p().zv({store:a,transaction:r,data:{content:e.filter((e=>e!==t.id))}})}},userAction:"clean_up_empty_new_page"})}function R({environment:e,userAction:t,result:o,existingCollectionViewBlockStore:r,existingCollectionStore:n}){if("canceled"!==o.type){if("accepted_empty_collection"===o.type&&n){const r=n.getKeyStore("name"),i=(0,c().x9d)(o.newCollectionTitle);r&&h().createAndCommit({userAction:t,environment:e,canUndo:!0,perform:t=>g().R9({environment:e,store:r,transaction:t,value:i})})}if(r){var i;const e=null===(i=(0,I().U)(r))||void 0===i?void 0:i.settingsStore;e&&m().os({collectionSettingsStore:e})}if("accepted_template"===o.type&&null!=r&&r.isCollectionView()&&(null==r||!r.hasSingleSourceAndNoLinkedCollections())){const t=(0,I().U)(r),n=r.getCollectionViewStores().find((e=>{var t;return(null===(t=e.getCollectionStore())||void 0===t?void 0:t.id)===o.collectionId}));if(!t||!n)return;(0,_().t)({environment:e,collectionContextStore:t,collectionViewId:n.id,isFullScreen:t.isFullScreenStore.state,isRootChild:t.isRootChildStore.state,isInPeekRenderer:t.isInPeekRendererStore.state})}}}async function B({environment:e,collectionViewBlockStore:t}){const o=t.id;if(!t.isDefined()){const r=await l().$f({environment:e,blockId:o});if(!r)return;e=await v().T({environment:e,newCurrentUserId:r}),t=new(n().B)(e,{table:s().ev,id:o}),await t.load()}const a=t.getSpaceId();if(!a)throw new Error("Space ID not found for collection block");const c=(0,y().k)(a);if(!c)throw new Error(`Space view not found for space ID: ${a}`);const{sidebarSpaceStore:d}=r().default.state;(null==d?void 0:d.id)!==a&&await(0,f().y)({environment:e,spaceViewStore:c});const p=t.getFormat();if("workflow_template_placeholder"===(null==p?void 0:p.collection_view_sub_type)&&null!=p&&p.placeholder_workflow_template_id&&t.isCollectionView()){const{getCollectionTemplateFromId:o}=await C().t.load(),r=o(p.placeholder_workflow_template_id);if(!r)throw new Error(`Collection template "${p.placeholder_workflow_template_id}" not found`);const{onNavigateToPlaceholderWorkflowTemplateBlock:n}=await b().O.load();n({environment:e,collectionTemplate:r,collectionViewBlockStore:t})}else u().uK({environment:e,store:t,pageVisitSource:i().y8.WorkflowTemplatesDeeplink})}},922952:(e,t,o)=>{o.d(t,{u:()=>a});var r=()=>o(295633),n=()=>o(302996),i=()=>o(723085);function a(e){return e instanceof i().h||e instanceof n().SpaceStore||e instanceof r().B}},935432:(e,t,o)=>{o.d(t,{A:()=>a});var r=()=>o(416845),n=()=>o(357264),i=()=>o(788579);function a(e,t){if((0,r().pA8)(t)){const o=(0,i().$)(t.clientData);if(o)return"messageValues"in t.clientData?e.formatMessage(o,t.clientData.messageValues):e.formatMessage(o)}return e.formatMessage(n().k.generic_error)}}}]);