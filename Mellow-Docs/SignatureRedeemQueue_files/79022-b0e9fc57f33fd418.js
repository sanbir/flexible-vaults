(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[79022],{17217:(e,t,a)=>{"use strict";a.d(t,{CE:()=>m,CR:()=>l,F0:()=>u,Mf:()=>s,QV:()=>p,Sz:()=>d,gB:()=>i,gD:()=>r,ks:()=>o,qV:()=>n});a(16280);const r=100,o=1e3,n=1e3,i=3e4,s=20971520,l=8388608,d=["image/png","image/jpeg","image/gif","image/webp","image/heic"];const c=["application/pdf","text/csv","image/png","image/jpeg","image/gif","image/webp","image/heic"];c.join(", ");function p(e){return function(e){const{enableHeicSupport:t}=e??{};return c.filter((e=>!("image/heic"===e&&!t)))}(e).join(", ")}function u(e){return e.includes("png")?{value:{mimeType:"image/png",extension:".png"}}:e.includes("pdf")?{value:{mimeType:"application/pdf",extension:".pdf"}}:e.includes("csv")?{value:{mimeType:"text/csv",extension:".csv"}}:e.includes("jpeg")||e.includes("jpg")?{value:{mimeType:"image/jpeg",extension:".jpeg"}}:e.includes("gif")?{value:{mimeType:"image/gif",extension:".gif"}}:e.includes("webp")?{value:{mimeType:"image/webp",extension:".webp"}}:e.includes("heic")?{value:{mimeType:"image/heic",extension:".heic"}}:{error:new Error("Invalid file type")}}function m(e){switch(e){case"application/pdf":return"assistant_pdf_filesize_bytes";case"text/csv":return"assistant_csv_filesize_bytes";case"image/png":case"image/jpeg":case"image/gif":case"image/webp":case"image/heic":return"assistant_image_filesize_bytes";case"application/json":return"assistant_json_filesize_bytes";default:return e}}},24279:(e,t,a)=>{"use strict";a.d(t,{XO:()=>n,aR:()=>s,b1:()=>l,h7:()=>i,kO:()=>c,ox:()=>d,wc:()=>o,y8:()=>p});a(16280),a(898992),a(672577),a(430670);var r=()=>a(412412);function o(e){return"instructions"===e.type}function n(e){return"observation"===e.type&&"error"===e.observationType}function i(e){return"observation"===e.type&&"search"===e.observationType}function s(e){const t=new Error(e.value);return e.stack&&(t.stack=e.stack),t}function l(e){return"assistant"===e.type}function d(e){return"human"===e.type}function c(e){return"observation"===e.type&&"attachment"===e.observationType}function p(e){const t=(0,r().BD)(e.value.summary.value)[0];if(!t||"element"!==t.type)return"invalid summary node";const a=e.value.pages.flatMap((e=>(0,r().BD)(e.value))),o={...t,children:[...t.children??[],...a]};return(0,r()._o)(o)}},68169:(e,t,a)=>{"use strict";a.d(t,{iC:()=>N,cZ:()=>w,Lj:()=>n,lA:()=>T,dL:()=>f,Ke:()=>k,RD:()=>v,hx:()=>s,PM:()=>y,jx:()=>g,tX:()=>b,vW:()=>d,s8:()=>x,bz:()=>l,d7:()=>I,tT:()=>h,rL:()=>p});a(16280),a(898992),a(354520);var r=()=>a(534177),o=()=>a(17217);const n="personal-agent";const i={search:{type:"search",scopeForNextSearch:{type:"everything"},filtersForNextSearch:a(239666).NH,searchSessionId:void 0,useWebSearch:!1},researcher:{type:"researcher",searchScope:{type:"everything"},useWebSearch:!0},"setup-generator":{type:"setup-generator"},workflow:{type:"workflow"},"markdown-chat":{type:"markdown-chat",model:"openai-gpt-4.1"},"fast-researcher":{type:"fast-researcher"}},s=["search","researcher","setup-generator","workflow","markdown-chat","fast-researcher"].map((e=>i[e]));function l(e){return i[e]}const d={maxIterations:8,multiturnIterations:1,thinkingTokens:1024,filterToSpaceSharedResults:!1,sectionReportWriting:!1},c=["search","researcher","setup-generator"];function p(e){return!(!(0,r().Xk)(c,e)&&"markdown-chat"!==e&&"workflow"!==e)}const u=["workflow","setup-generator","fast-researcher"],m=["markdown-chat","search","researcher","workflow","setup-generator"];s.filter((e=>m.includes(e.type))),s.filter((e=>u.includes(e.type)));function h(e){return!!(0,r().Xk)(o().Sz,e)}function g(e){const{uploadedFileData:t,id:a}=e;if("application/pdf"===t.contentType){var o;return{id:a,type:"attachment",fileUrl:t.originalFileUrl,fileName:t.fileName,contentType:t.contentType,base64EncodedFileUrl:t.base64EncodedFileUrl,permissionRecord:t.permissionRecord,metadata:{...t.metadata??{},attachmentSource:t.attachmentSource,guardrail:(null===(o=t.metadata)||void 0===o?void 0:o.guardrail)??{attachmentRisk:"skipped"}}}}if("text/csv"===t.contentType){var n;return{id:a,type:"attachment",fileUrl:t.originalFileUrl,fileName:t.fileName,contentType:t.contentType,permissionRecord:t.permissionRecord,metadata:{...t.metadata??{},attachmentSource:t.attachmentSource,guardrail:(null===(n=t.metadata)||void 0===n?void 0:n.guardrail)??{attachmentRisk:"skipped"}}}}if(h(t.contentType)){var i;return{id:a,type:"attachment",fileUrl:t.originalFileUrl,fileName:t.fileName,contentType:t.contentType,permissionRecord:t.permissionRecord,metadata:{...t.metadata??{},attachmentSource:t.attachmentSource,guardrail:(null===(i=t.metadata)||void 0===i?void 0:i.guardrail)??{attachmentRisk:"skipped"}}}}(0,r().HB)(t.contentType)}function y(e,t){return"application/pdf"===e.contentType?{originalFileUrl:e.fileUrl,fileName:e.fileName,contentType:"application/pdf",base64EncodedFileUrl:"",assistantSessionId:t,attachmentSource:"unknown"}:"text/csv"===e.contentType?{originalFileUrl:e.fileUrl,fileName:e.fileName,contentType:"text/csv",assistantSessionId:t,attachmentSource:"unknown"}:{originalFileUrl:e.fileUrl,fileName:e.fileName,contentType:e.contentType,assistantSessionId:t,attachmentSource:"unknown"}}function b(e){const{result:t,attachmentSource:a,fileName:o,originalFileUrl:n,threadId:i}=e;return"application/pdf"===t.contentType?{fileName:o,originalFileUrl:n,base64EncodedFileUrl:"",attachmentSource:a,contentType:t.contentType,assistantSessionId:i,metadata:t.stepMetadata}:"text/csv"===t.contentType?{originalFileUrl:n,fileName:o,contentType:t.contentType,attachmentSource:a,assistantSessionId:i,metadata:t.stepMetadata}:h(t.contentType)?{originalFileUrl:n,fileName:o,attachmentSource:a,contentType:t.contentType,assistantSessionId:i,metadata:t.stepMetadata}:void(0,r().HB)(t.contentType)}a(902006).fl;const f="searchAgent",v="unifiedFindAgent",T="readingAgent",k="taskAgent",N="databaseAgent",w="databaseBulkReadContentAgent";const x={originalOutput:[],feedback:"",testTitle:"",inputSummary:"",promptFeedback:"",testInstructions:"",originalOutputPassesTest:!1,originalOutputTestResults:[],correctedOutputs:[],verified:!1,isOptional:!1},I=["Eval","Prompt"];"\n'Chat with AI':\n\nRouting Instructions:\n- If this mode is selected, the user will receive an AI response without a search being conducted.\n- Route to this mode when the user asks for general knowledge, chatting, or writing content that does not require additional information not already in the context.\n- Do NOT route to this mode when the query requires current statistics, facts, or up-to-date information.\n- Do NOT route to this mode when the query requires searching the user's workspace.\n- Do NOT route to this mode when the user wants to build a specific system or application in Notion.\n\nExamples:\n<example>\nINPUT: Tell me a bedtime story about a robot who learns to dream.\nOUTPUT: 0\n</example>\n<example>\nINPUT: What are some key ideas behind design thinking?\nOUTPUT: 0\n</example>\n<example>\nINPUT: largest mammal\nOUTPUT: 0\n</example>\n<example>\nINPUT: write a haiku about the first snowfall\nOUTPUT: 0\n</example>\n<example>\nINPUT: Who was Joan of Arc?\nOUTPUT: 0\n</example>\n<example>\nINPUT: create a plan for an 80th birthday party\nOUTPUT: 0\n</example>\n".trim(),"\n'Quick search':\n\nRouting Instructions:\n- If this mode is selected, a single search will be conducted and an AI response will be provided that takes the search results into consideration.\n- Route to this mode if you need to find information across the Notion workspace, Slack, Google Drive, Github, or Jira to handle the user's request.\n- Route to this mode when the query seeks a single, specific fact, definition, or data point, or when the user needs current or time-sensitive information.\n- Route to this mode if the user seems to be searching for a specific document in their workspace.\n- Route to this mode if the user needs support: e.g. if they are mentioning getting support, requesting help, asking for customer service, reporting a problem with the product, or requesting a feature - we may be able to find some relevant content in the Notion Help Center\n- Do NOT route to this mode when the request requires synthesizing multiple pieces of information or generating a detailed research report.\n- Do NOT route to this mode when the user wants to build a specific system or application in Notion.\n\nExamples:\n<example>\nINPUT: automated checkout PRD\nOUTPUT: 1\n</example>\n<example>\nINPUT: Who leads the podiatry dept?\nOUTPUT: 1\n</example>\n<example>\nINPUT: overnight parking policy\nOUTPUT: 1\n</example>\n<example>\nINPUT: When are we going to release our documentary about polar bears in the Arctic?\nOUTPUT: 1\n</example>\n<example>\nINPUT: Find my PR that enables dynamic builds.\nOUTPUT: 1\n</example>\n".trim(),"\n'Research Mode':\n\nRouting Instructions:\n- Route to this mode when the query explicitly requests research, analysis, or in-depth exploration.\n- Route to this mode when the query requires conducting multiple searches or synthesizing information from multiple sources or on multiple topics.\n- Do NOT route to this mode when the query can be answered with a single search.\n- Do NOT route to this mode when the user wants to build a specific system or application in Notion.\n\nExamples:\n<example>\nINPUT: Whose work is most UX focused between Amy, Paula, and Xochitl?\nOUTPUT: 2\n</example>\n<example>\nINPUT: Write profiles for 10 of our biggest north African customers.\nOUTPUT: 2\n</example>\n<example>\nINPUT: Can you put together some recommendations for how to move forward with the Lumi deal? Check our recent Slack discussions for context. Write your recommendations in a similar style to how I have written them in the past.\nOUTPUT: 2\n</example>\n<example>\nINPUT: detailed comparison of the healthcare systems of Canada, the UK, Germany, and Singapore in terms of efficiency and accessibility\nOUTPUT: 2\n</example>\n<example>\nINPUT: What are the trends and geopolitical implications of the global semiconductor supply chain?\nOUTPUT: 2\n</example>\n\n".trim(),"\n'App builder':\n\nRouting Instructions:\n- Route to this mode when the query explicitly asks to build an app or system, or when the request involves automating processes within Notion or external tools.\n- Do NOT route to this mode when the user is seeking information rather than building a system or when the request is for creative content or general conversation.\n\nExamples:\n<example>\nINPUT: Create a task management app with deadlines and team assignments.\nOUTPUT: 3\n</example>\n<example>\nINPUT: Develop a CRM that tracks client interactions and schedules follow-ups.\nOUTPUT: 3\n</example>\n<example>\nINPUT: design an invoice system that sends payment reminders\nOUTPUT: 3\n</example>\n<example>\nINPUT: could you build a knowledge base that categorizes notes by topic automatically?\nOUTPUT: 3\n</example>\n<example>\nINPUT: Set up a content calendar for social media posts\nOUTPUT: 3\n</example>\n<example>\nINPUT: Create a recruitment pipeline for interview stages.\nOUTPUT: 3\n</example>\n<example>\nINPUT: I want a dashboard for visualizing Notion database metrics\nOUTPUT: 3\n</example>\n<example>\nINPUT: a way to process and categorize customer feedback automatically\nOUTPUT: 3\n</example>\n".trim(),"\n<example>\nINPUT: Create a database to track my job applications\nOUTPUT: 3\n</example>\n<example>\nINPUT: I need a way to organize my project tasks and deadlines\nOUTPUT: 3\n</example>\n<example>\nINPUT: Help me keep track of my fitness progress over time\nOUTPUT: 3\n</example>\n<example>\nINPUT: I want to build a system for managing my inventory\nOUTPUT: 3\n</example>\n<example>\nINPUT: I need something to organize all my recipes and ingredients\nOUTPUT: 3\n</example>\n<example>\nINPUT: Can you help me set up a customer relationship management system?\nOUTPUT: 3\n</example>\n<example>\nINPUT: [pasted CSV or similar structured data]\nOUTPUT: 3\n</example>\n<example>\nINPUT: I need to organize my collection of books\nOUTPUT: 3\n</example>\n".trim()},109954:(e,t,a)=>{"use strict";a.d(t,{X:()=>o});a(16280),a(944114),a(898992),a(672577),a(581454);var r=()=>a(902006);class o extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="gmail",this.displayName="Gmail",this.requiresUserAuth=!1,this.featureGate="gmail_ai_connector",this.category="vectorless",this.parentOrganization="Google",this.fileTypes=[],this.qnaIngestionAIAppId="1724f2a1-f543-43a7-82af-8a0f85bda112",this.urlRegex=r().J0}getTitle(e){if("gmail"!==e.type)throw new Error(`Expected gmail resource, got resource.type=${e.type}`);return e.subject}getText(e){if("gmail"!==e.type)throw new Error(`Expected gmail resource, got resource.type=${e.type}`);const t=e.messages.map((e=>{const t=new Date(e.timestamp).toLocaleString();return`<mentioned-gmail-message user="${e.user.name}" timestamp="${t}">\n${e.text}\n</mentioned-gmail-message>`})).join("\n\n");return`<mentioned-gmail-thread subject="${e.subject}" thread-id="${e.threadId}">\n${t}\n</mentioned-gmail-thread>`}getSearchResultXMLTagName(){return"gmail-result"}addSearchResultToXML(e,t){if("gmail"!==e.type)throw new Error(`Expected gmail result, got result.type=${e.type}`);let a=t.find((t=>"gmail-result"===t.tagName&&t.attributes.id===e.pageId));a||(a={type:"element",tagName:"gmail-result",attributes:{id:e.pageId,title:e.title},children:[]},t.push(a)),a.children.push({type:"element",tagName:"email",attributes:{id:e.id,title:e.title,"last-edited-datetime":e.lastEdited},children:[{type:"text",value:e.text}]})}mapObservationResultNode(e){const{node:t,idMapper:a,idToCounter:o}=e;if("gmail-result"!==t.tagName)return t;const n=a.mapKeyToCounter({type:"gmail",key:(0,r().V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n},children:t.children.map((e=>{const t=a.mapKeyToCounter({type:"gmail",key:(0,r().V9)(e.attributes.id)});return o[e.attributes.id]=t,{...e,attributes:{...e.attributes,id:t}}}))}}}},147427:(e,t,a)=>{"use strict";function r(e){return"text"===e.type&&!e.value.trim()}a.d(t,{A:()=>r})},162278:(e,t,a)=>{"use strict";a.d(t,{V8:()=>N,st:()=>k,vj:()=>w,zQ:()=>b});a(18107),a(944114),a(967357),a(898992),a(823215),a(354520),a(581454),a(737550);var r=()=>a(496603),o=()=>a(973647),n=()=>a(534177),i=()=>a(251582),s=()=>a(181856),l=()=>a(252050),d=()=>a(228803),c=()=>a(525704),p=()=>a(233364),u=()=>a(491810),m=()=>a(331119);function h(e){return i().p.mapResult((0,m().U5)("table"),(t=>{const a=(0,m().ke)({inputAttributes:t.attributes,definitions:{id:{required:!1,values:!0,mappingMode:"block_counter"}},tagName:t.tagName,validateRequiredAttributes:!1,mapCounterToKey:e.mapCounterToKey});if(o().Q.isFail(a))return a;const n=f(e,t.tagName,a.value);if(o().Q.isFail(n))return n;const s=n.value,l=(0,i().$d)((0,m().nx)(t.tagName,[y(e)]),t.children??[]);if(o().Q.isFail(l))return l;const d=Math.max(...l.value.map((e=>Object.keys(e.node.properties).length))),c=l.value.map((e=>{const t=Object.keys(e.node.properties).length;return t<d?{...e.node,properties:Object.fromEntries([...Object.entries(e.node.properties),...r().y1(t,d).map((e=>{const t=(e+1).toString();return[t,{tagName:"property-text",type:"property",attributes:{name:t},children:[]}]}))])}:e.node}));return{value:{tagName:"table",type:"block",attributes:{id:s,...l.value.length>0&&l.value.every((e=>e.firstChildIsHeader))?{"header-row":"true"}:{},...l.value.length>0&&l.value[0].allChildrenAreHeaders?{"header-column":"true"}:{}},persisted:e.persisted,text:[],children:c,properties:{},schemas:{},hasUncited:!1}}}))}function g(e){return i().p.mapResult(i().p.choice([(0,m().U5)("th"),(0,m().U5)("td")]),(t=>{const a=(0,i().$d)((0,m().nx)(t.tagName,[(0,d().Et)({inlineNodesAllowed:l().qI,textAllowed:!0,parentTagName:t.tagName,mapCounterToKey:e.mapCounterToKey})]),t.children??[]);return o().Q.isFail(a)?a:{value:{text:a.value,isHeader:"th"===t.tagName}}}))}function y(e){return i().p.mapResult((0,m().U5)("tr"),(t=>{var a;const r=(0,m().ke)({inputAttributes:t.attributes,definitions:{id:{required:!1,values:!0,mappingMode:"block_counter"}},tagName:t.tagName,validateRequiredAttributes:!1,mapCounterToKey:e.mapCounterToKey});if(o().Q.isFail(r))return r;const n=f(e,t.tagName,r.value);if(o().Q.isFail(n))return n;const s=n.value,l=(0,i().$d)((0,m().nx)(t.tagName,[g(e)]),t.children??[]);if(o().Q.isFail(l))return l;return{value:{node:{tagName:"tr",type:"block",attributes:{id:s},persisted:e.persisted,text:[],children:[],properties:Object.fromEntries(l.value.map(((e,t)=>{const a=(t+1).toString();return[a,{tagName:"property-text",type:"property",attributes:{name:a},children:e.text}]}))),schemas:{},hasUncited:!1},allChildrenAreHeaders:l.value.every((e=>e.isHeader)),firstChildIsHeader:Boolean(null===(a=l.value.at(0))||void 0===a?void 0:a.isHeader)}}}))}function b(e){return"unknown-block"===e}function f(e,t,a){return e.persisted?a.id?{value:a.id}:{error:new(s().oN)}:b(t)?a.id?{value:a.id}:{error:new(s().N8)}:a.id?{error:new(s().oS)}:{value:e.allocateIdFn()}}function v(e){const t=(0,n().s8)(l().sA,((a,r)=>{const g=function(e,t,a){const r=l().sA[e],{allowMove:h,allowUncited:g,persisted:y,mapCounterToKey:b}=t;let v=(0,m().U5)(e);return"page"===e&&(v=i().p.choice([v,(0,m().U5)("instructions-page")])),i().p.mapResult(v,(v=>{const N=(0,m().ke)({inputAttributes:v.attributes,definitions:{...r.attributes,id:{required:!1,values:!0,mappingMode:"block_counter"}},tagName:e,validateRequiredAttributes:!1,mapCounterToKey:b});if(o().Q.isFail(N))return N;if("synced-block-reference"===e&&!y&&v.children&&v.children.length>0)return{error:new(s().w5)};const w=f(t,e,N.value);if(o().Q.isFail(w))return w;const x=w.value,I=[];r.title&&I.push((0,d().Et)({inlineNodesAllowed:l().qI,textAllowed:!0,parentTagName:e,mapCounterToKey:b}));const _=r.schemas.map((e=>`schema-${e}`)),C=(0,u().D)({mapCounterToKey:b});I.push(...(0,n().WP)(C).filter((([e])=>_.includes(e))).map((([,e])=>e))),I.push(h?(0,c().Y)({mapCounterToKey:b}):T),g&&I.push(k());const M=[...r.properties];I.push(...(0,n().WP)((0,p().x)({mapCounterToKey:b})).filter((([e])=>(0,n().Xk)(M,e))).map((([,e])=>e)));for(const e of r.content)I.push(a(e));const E=(0,i().$d)((0,m().nx)(e,I),v.children??[]);if(o().Q.isFail(E))return E;const $=E.value.some((e=>"uncited"===e.type)),S=E.value.filter((e=>"uncited"!==e.type)),R=(0,m().t7)([["inline or text node",function(e){return"text"===e.type||"inline"===e.type}],["property node",function(e){return"property"===e.type}],["schema node",function(e){return"schema"===e.type}],["block node",function(e){return"block"===e.type||"move"===e.type}]],S);if(o().Q.isFail(R))return{error:new(s().SX)({foundNodeType:R.error.incorrectLabel,incorrectlyAfterType:R.error.lastLabel})};const[U,O,A,q]=R.value;if("tr"===e)for(const e of O)if(!/^-?\d+$/.test(e.attributes.name))return{error:new(s().dO)};return{value:{type:"block",tagName:e,attributes:{...N.value,id:x},persisted:y,text:U,children:q,properties:Object.fromEntries(O.map((e=>[e.attributes.name,e]))),schemas:Object.fromEntries(A.map((e=>[e.attributes.name,e]))),hasUncited:$}}}))}(r,e,(e=>t[e]));return"table"===r?i().p.choice([i().p.try(g),h(e)]):"tr"===r?i().p.choice([i().p.try(g),i().p.map(y(e),(e=>e.node))]):g}));return t}const T=i().p.mapResult((0,m().U5)("move"),(()=>({error:new(s().Qv)})));function k(){return i().p.mapResult((0,m().U5)("uncited"),(e=>({value:{type:"uncited"}})))}function N(e){return i().p.choice([...Object.values(v(e)),...e.allowMove?[]:[T],i().p.fail((e=>new(s().yc)({nodeType:"block",unexpectedNode:e[0]})))])}function w(e){return i().p.choice([...Object.values(v(e)),(0,c().Y)({mapCounterToKey:e.persisted?void 0:e.mapCounterToKey}),i().p.fail((e=>new(s().yc)({nodeType:"block",unexpectedNode:e[0]})))])}},181856:(e,t,a)=>{"use strict";a.d(t,{GW:()=>l,HQ:()=>s,LN:()=>i,N8:()=>v,QT:()=>C,Qv:()=>N,RR:()=>d,S2:()=>_,SX:()=>h,TP:()=>x,Te:()=>o,Uc:()=>w,af:()=>E,dO:()=>g,gJ:()=>c,kT:()=>M,nD:()=>k,oN:()=>b,oS:()=>f,qW:()=>u,u7:()=>I,w5:()=>y,wL:()=>n,xU:()=>m,yc:()=>p,yd:()=>T});a(16280),a(581454);var r=()=>a(534177);class o extends Error{constructor(e,t,a){super(t),this.type=e,this.cause=a}getMetadata(){}}class n extends o{}class i extends n{constructor(e){let t=1===e.attributeNames.length?`Unexpected attribute for <${e.tagName}> tag: ${e.attributeNames[0]}`:`Unexpected attributes for <${e.tagName}> tag: ${e.attributeNames.join(", ")}`;e.attributeNames.includes("key")&&(t+="\n\nThe key attribute is not needed. You should omit it."),super("unexpected_attributes",t)}}class s extends n{constructor(e){super("missing_attribute",`The <${e.tagName}> tag is missing a ${e.attributeName} attribute. It should be specified as <${e.tagName} ${e.attributeName}="...">`)}}class l extends n{constructor(e){super("bad_attribute",`Attempted to set attribute ${e.attributeName} on a <${e.tagName}> tag to a value that is not allowed: ${e.receivedValue}`)}}class d extends n{constructor(e){const{tagName:t,unexpectedNode:a}=e;let r;r=a?"text"===a.type?`Plain text, whitespace, or newlines are not allowed inside a <${t}> tag. Make sure not to include any extra whitespace or newlines in your XML.`:`A <${a.tagName}> tag is not allowed inside a <${t}> tag`:`Encountered an invalid child inside a <${t}> tag.`,"set-title"===t||"set-property"===t?r+=`\nOnly inline elements and text are allowed inside <${t}>`:"insert-before"===t||"insert-after"===t||"insert-inside"===t||"chat"===t?(r+=`\nOnly block elements are allowed inside <${t}>`,"chat"===t&&(r+="\nWhen using <chat>, remember to wrap text in <text> tags.")):"create"===t&&(r+="\nWhen using <create>, remember to wrap in a <page> tag."),super("disallowed_child",r),this.tagName=void 0,this.unexpectedNode=void 0,this.tagName=t,this.unexpectedNode=a}}class c extends n{constructor(e){super("expected_tag_name",`Expected a <${e}> tag`)}}class p extends n{constructor(e){let t;(0,r().O9)(e.unexpectedNode)?"text"===e.unexpectedNode.type?t=`Text is not supported as a child for a ${e.nodeType} node`:"element"===e.unexpectedNode.type?t=`Unsupported ${e.nodeType} tag name: ${e.unexpectedNode.tagName}`:(0,r().HB)(e.unexpectedNode):t=`Unexpected value for a ${e.nodeType} node`,super("unsupported_node",t)}}class u extends n{constructor(e,t){super("unmapped_id",`Expected counter ID for attribute ${e}, instead received ${t}`)}}class m extends n{constructor(e){const{expectedIdType:t,receivedIdType:a,tagNameForErrorMessage:r,idValueForErrorMessage:o}=e;super("unexpected_id_type",r?`Expected ID ${o} in <${r}> to be of type '${t}', instead received ID of type '${a}'`:`Expected ID ${o} to be of type '${t}', instead received ID of type '${a}'`)}}class h extends n{constructor(e){super("out_of_order_node",`Encountered a ${e.foundNodeType} after a ${e.incorrectlyAfterType}. You should ensure that any ${e.foundNodeType}s come before ${e.incorrectlyAfterType}s.`)}}class g extends n{constructor(){super("table_row_property_name","Inside tr, the property-text name attribute must be a string which is an integer counter, starting from 1.")}}class y extends n{constructor(){super("synced_block_invalid_children","Cannot include content when writing a <synced-block-reference> tag")}}class b extends n{constructor(){super("must_provide_id","Block node is missing an id attribute")}}class f extends n{constructor(){super("cannot_provide_id","When creating new blocks, do not provide an id attribute.")}}class v extends n{constructor(){super("must_provide_unknown_block_id","When referencing unknown blocks, you must provide an id.")}}class T extends n{constructor(){super("cannot_append_to_multiple_properties","Cannot append to multiple properties. Use multiple calls to <insert-inside> instead.")}}class k extends n{constructor(){super("cannot_remove_from_multiple_properties","Cannot remove from multiple properties. Use multiple calls to <delete> instead.")}}class N extends n{constructor(){super("move_disallowed","A <move> tag is not allowed in this context")}}class w extends n{constructor(){super("set_attribute_without_key","<set-attribute> is missing an attribute to set")}}class x extends n{constructor(e){super("unknown_api",`Unexpected API: ${e}. Make sure to use only the supported XML APIs, and ensure you are using this API in the right context.`)}}class I extends o{constructor(e,t){super("load_page_as_xml_failed",t),this.pageId=e}getMetadata(){return{pageId:this.pageId}}}class _ extends o{constructor(e,t){super("load_database_as_xml_failed",t),this.databaseId=e}getMetadata(){return{databaseId:this.databaseId}}}class C extends _{constructor(e,t){super("load_database_as_xml_missing_block",t),this.databaseId=e}}class M extends o{constructor(){super("illegal_replace_page",'When calling <replace> on a page, you must provide a <page> tag as the single child, like this: <replace start="..." end="..."><page>...</page></replace>.')}}class E extends o{constructor(){super("out_of_order_replace","When calling <replace>, the start of the range must be AFTER the end of the range.")}}},191198:(e,t,a)=>{"use strict";a.d(t,{m:()=>r});a(16280),a(944114);class r extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="box",this.displayName="Box",this.requiresUserAuth=!1,this.featureGate="box_qna",this.category="vector",this.parentOrganization=null,this.fileTypes=["record"],this.qnaIngestionAIAppId="0115dd18-531d-4c72-8f5c-179426fbdbae",this.urlRegex=/https:\/\/app\.box\.com\/file\/(\d+)/}getTitle(e){if("box-file"!==e.type)throw new Error(`Expected box-file resource, got resource.type=${e.type}`);return e.title}getText(e){if("box-file"!==e.type)throw new Error(`Expected box-file resource, got resource.type=${e.type}`);return`<mentioned-box type="${e.type}" title="${e.title}" file-id="${e.fileId}">\n${e.blocks.join("\n")}\n</mentioned-box>`}getSearchResultXMLTagName(){return"box-result"}addSearchResultToXML(e,t){if("box"!==e.type)throw new Error(`Expected box result, got result.type=${e.type}`);t.push({type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.id,title:e.title,"last-edited-datetime":e.lastEdited,...e.fileType?{"file-type":e.fileType}:{}},children:[{type:"text",value:e.text}]})}mapObservationResultNode(e){const{node:t,idMapper:r,idToCounter:o}=e;if("box-result"!==t.tagName)return t;const n=r.mapKeyToCounter({type:"box",key:(0,a(902006).V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n}}}}},208685:(e,t,a)=>{"use strict";a.d(t,{U:()=>n,v:()=>o});const r=Object.freeze({slack:new(a(838862).d),asana:new(a(532058).v),discord:new(a(971502).Z),box:new(a(191198).m),github:new(a(515870).o),gmail:new(a(109954).X),"google-calendar":new(a(462294).O),"google-drive":new(a(872182).s),jira:new(a(602264).h),linear:new(a(973298)._),"microsoft-teams":new(a(335600).R),"notion-calendar":new(a(958062).M),"notion-mail":new(a(902824).V),salesforce:new(a(816926).Y),sharepoint:new(a(716470).u),outlook:new(a(966270).S),custom:new(a(983662).S)});function o(e){return r[e]}function n(e){for(const t of Object.values(r))if(t.getSearchResultXMLTagName()===e)return t}},228803:(e,t,a)=>{"use strict";a.d(t,{Et:()=>u});a(16280),a(944114),a(898992),a(354520);var r=()=>a(973647),o=()=>a(534177),n=()=>a(251582),i=()=>a(181856),s=()=>a(252050),l=()=>a(147427),d=(a(581454),()=>a(331119));const c=n().p.map(d().W6,(e=>({type:"text",value:e.value})));function p(e){const t=(0,o().s8)(s()._S,((t,a)=>function(e,t){const a=s()._S[e],{mapCounterToKey:o}=t;return n().p.mapResult((0,d().U5)(e),(t=>{const i=(0,d().ke)({inputAttributes:t.attributes,definitions:a.attributes,tagName:e,mapCounterToKey:o});if(r().Q.isFail(i))return i;let s=t.children??[];a.text||(s=s.filter((e=>!(0,l().A)(e))));const c=(0,n().$d)(n().p.manyTill(u({inlineNodesAllowed:a.inline,textAllowed:a.text,parentTagName:e,mapCounterToKey:o}),n().p.eof()),s);if(r().Q.isFail(c))return c;const p=c.value;return{value:{type:"inline",tagName:e,attributes:i.value,children:p}}}))}(a,e)));return t}function u(e){const{inlineNodesAllowed:t,textAllowed:a,parentTagName:r,mapCounterToKey:s}=e,l=[...t],d=[];for(const[n,i]of(0,o().WP)(p({mapCounterToKey:s})))(0,o().Xk)(l,n)&&d.push(i);return n().p.choice([...d,...a?[c]:[],n().p.fail((e=>e.length>0?new(i().RR)({tagName:r,unexpectedNode:e[0]}):new Error("No inline or text node")))])}},233364:(e,t,a)=>{"use strict";a.d(t,{Q:()=>u,x:()=>p});a(898992),a(354520);var r=()=>a(973647),o=()=>a(534177),n=()=>a(251582),i=()=>a(181856),s=()=>a(252050),l=()=>a(147427),d=()=>a(228803),c=()=>a(331119);function p(e){return(0,o().s8)(s().GU,((t,a)=>function(e,t){const a=s().GU[e],{mapCounterToKey:o}=t;return n().p.mapResult((0,c().U5)(e),(t=>{const i=(0,c().ke)({inputAttributes:t.attributes,definitions:{...a.attributes,name:{required:!0,values:!0}},tagName:e,mapCounterToKey:o});if(r().Q.isFail(i))return i;let s=t.children??[];a.text||(s=s.filter((e=>!(0,l().A)(e))));const p=(0,n().$d)(n().p.manyTill((0,d().Et)({inlineNodesAllowed:a.inline,textAllowed:a.text,parentTagName:e,mapCounterToKey:o}),n().p.eof()),s);if(r().Q.isFail(p))return p;const u=p.value;return{value:{type:"property",tagName:e,attributes:i.value,children:u}}}))}(a,e)))}function u(e){return n().p.choice([...Object.values(p(e)),n().p.fail((e=>new(i().yc)({nodeType:"property",unexpectedNode:e[0]})))])}},239666:(e,t,a)=>{"use strict";a.d(t,{NH:()=>o,Wy:()=>r});const r={type:"everything"},o={dateRangeFilter:{startDate:void 0,endDate:void 0},createdByFilter:[],excludeCreatedByFilter:[],titleOnlyFilter:!1,ancestorsFilter:[],teamspacesFilter:[]}},242634:()=>{},251582:(e,t,a)=>{"use strict";a.d(t,{$d:()=>i,AZ:()=>s,p:()=>d});a(16280),a(944114),a(581454);var r=()=>a(496603),o=()=>a(973647);class n extends Error{constructor(e){super(e)}}function i(e,t){const a=Array.isArray(t)?t:[t],[,r]=e(a);return r.status?{value:r.value}:{error:r.error}}function s(e,t){const a=i(e,t);if(o().Q.isFail(a))throw a.error;return a.value}const l=Symbol("ManyTillEndSentinel"),d={try:e=>t=>{const[a,r]=e(t);return r.status?[a,r]:[t,r]},any:()=>e=>e.length>0?[e.slice(1),{status:!0,value:e[0]}]:[[],{status:!1,error:new n("Reached end of input")}],eof:e=>t=>0===t.length?[[],{status:!0,value:void 0}]:[t,{status:!1,error:(null==e?void 0:e(t[0]))??new n("Expected end of input")}],map:(e,t)=>a=>{const[r,o]=e(a);return[r,o.status?{status:!0,value:t(o.value)}:o]},mapResult:(e,t)=>a=>{const[r,n]=d.map(e,t)(a);return n.status?o().Q.isFail(n.value)?[r,{status:!1,error:n.value.error}]:[r,{status:!0,value:n.value.value}]:[r,n]},andThen:(e,t)=>a=>{const[r,o]=e(a);return o.status?t(o.value)(r):[r,o]},sequence:function(e){return t=>{const a=[];for(const r of e){const[e,o]=r(t);if(!o.status)return[e,o];a.push(o.value),t=e}return[t,{status:!0,value:a}]}},satisfy:function(e){return d.try((t=>{const[a,r]=d.any()(t);return r.status&&!e(r.value)?[a,{status:!1,error:new n("Failed predicate")}]:[a,r]}))},filter:function(e,t){return d.try((a=>{const[r,o]=e(a);return[r,o.status?t(o.value)?o:{status:!1,error:new n("Failed predicate")}:o]}))},literal:e=>d.describe(d.satisfy((t=>r().n4(t,e))),(()=>new n(`Expected: ${JSON.stringify(e)}.`))),describe:(e,t)=>a=>{const[r,o]=e(a);return[r,o.status?o:{status:!1,error:t()}]},constant:e=>t=>[t,{status:!0,value:e}],choice:e=>0===e.length?d.fail((()=>new n("No parsers to choose from"))):t=>{let a=e[0](t);for(const o of e.slice(1)){const[e,n]=a;if(n.status||!r().n4(e,t))return a;a=o(t)}return a},fail:e=>t=>[t,{status:!1,error:e(t)}],many:e=>t=>{const a=[];for(;;){const[r,o]=d.try(e)(t);if(!o.status)return[r,{status:!0,value:a}];a.push(o.value),t=r}},manyTill:(e,t)=>a=>{const r=[];for(;;){const[o,n]=d.choice([d.map(t,(()=>l)),d.try(e)])(a);if(!n.status)return[o,n];if(n.value===l)return[o,{status:!0,value:r}];r.push(n.value),a=o}},many1:e=>d.map(d.sequence([e,d.many(e)]),(([e,t])=>[e,...t])),sepBy:(e,t)=>d.choice([d.sepBy1(e,t),d.constant([])]),sepBy1:(e,t)=>d.andThen(e,(a=>d.map(d.many(d.map(d.sequence([t,e]),(([,e])=>e))),(e=>[a,...e])))),lazy:e=>d.andThen(d.constant(void 0),e),lookAhead:e=>t=>[t,e(t)[1]]}},252050:(e,t,a)=>{"use strict";a.d(t,{BP:()=>l,Bt:()=>d,F6:()=>c,GU:()=>m,HV:()=>O,P8:()=>s,RD:()=>N,U4:()=>g,VB:()=>E,Y1:()=>S,_S:()=>u,aL:()=>R,ew:()=>C,g5:()=>A,gc:()=>U,qI:()=>p,sA:()=>I,sW:()=>_,sk:()=>f,wn:()=>M,z5:()=>$});a(581454);var r=a.n(a(625473)),o=()=>a(498212),n=()=>a(534177),i=()=>a(206267);const s={default:"default",gray:"gray",brown:"brown",orange:"orange",yellow:"yellow",teal:"green",blue:"blue",purple:"purple",pink:"pink",red:"red",default_background:"default-background",gray_background:"gray-background",brown_background:"brown-background",orange_background:"orange-background",yellow_background:"yellow-background",teal_background:"green-background",blue_background:"blue-background",purple_background:"purple-background",pink_background:"pink-background",red_background:"red-background"},l=Object.fromEntries(Object.entries(s).map((([e,t])=>[t,e]))),d=Object.values(s),c=["mention-page","mention-database","mention-person","mention-assistant","mention-date","mention-datetime","mention-date-range","mention-datetime-range","mention-link"],p=["b","i","code","s","u","a","h","e",...c],u={b:{attributes:{},inline:p,text:!0,isToken:!1},i:{attributes:{},inline:p,text:!0,isToken:!1},code:{attributes:{},inline:p,text:!0,isToken:!1},s:{attributes:{},inline:p,text:!0,isToken:!1},u:{attributes:{},inline:p,text:!0,isToken:!1},a:{attributes:{href:{required:!0,values:!0,description:"link URL. Do not link to any URLs that are not already in the current context.",mappingMode:"href_counter"},type:{required:!1,values:a(902006).PI,description:"universal source type"},"external-id":{required:!1,values:!0,description:"ID for loadable external resource",mappingMode:"external_id_counter"}},inline:p,text:!0,isToken:!1},h:{attributes:{color:{required:!0,values:d,description:"text color"}},inline:p,text:!0,isToken:!1},e:{attributes:{equation:{required:!0,values:!0,description:"LaTeX equation string"}},inline:[],text:!0,isToken:!0},"mention-page":{attributes:{"page-id":{required:!0,values:!0,description:"ID of page",mappingMode:"block_counter"}},inline:[],text:!0,isToken:!0},"mention-link":{attributes:{href:{required:!0,values:!0,description:"link URL. Do not link to any URLs that are not already in the current context."},title:{required:!1,values:!0,description:"Linked page title"},icon_url:{required:!1,values:!0,description:"Favicon. Do not edit this field."},description:{required:!1,values:!0,description:"Linked page description. Do not edit this field."}},inline:[],text:!0,isToken:!0},"mention-database":{attributes:{"database-id":{required:!0,values:!0,description:"ID of database",mappingMode:"collection_counter"}},inline:[],text:!0,isToken:!0},"mention-data-source":{attributes:{"data-source-id":{required:!0,values:!0,description:"ID of database",mappingMode:"collection_counter"}},inline:[],text:!0,isToken:!0},"mention-person":{attributes:{"person-id":{required:!0,values:!0,description:"ID of person",mappingMode:"person_counter"},"person-name":{required:!1,values:!0,description:"Name of person"}},inline:[],text:!0,isToken:!0},"find-person":{attributes:{name:{required:!0,values:!0,description:"Name of person"}},inline:[],text:!0,isToken:!0},"mention-assistant":{attributes:{},inline:[],text:!0,isToken:!0},"mention-date":{attributes:{date:{required:!0,values:!0,description:"Date in ISO 8601 (YYYY-MM-DD) format"}},inline:[],text:!1,isToken:!1},"mention-datetime":{attributes:{date:{required:!0,values:!0,description:"Date in ISO 8601 (YYYY-MM-DD) format"},time:{required:!0,values:!0,description:"Time in ISO 8601 (HH:MM) format"}},inline:[],text:!1,isToken:!1},"mention-date-range":{attributes:{"start-date":{required:!0,values:!0,description:"Start date in ISO 8601 (YYYY-MM-DD) format"},"end-date":{required:!0,values:!0,description:"End date in ISO 8601 (YYYY-MM-DD) format"}},inline:[],text:!1,isToken:!1},"mention-datetime-range":{attributes:{"start-date":{required:!0,values:!0,description:"Start date in ISO 8601 (YYYY-MM-DD) format"},"end-date":{required:!0,values:!0,description:"End date in ISO 8601 (YYYY-MM-DD) format"},"start-time":{required:!0,values:!0,description:"Start time in ISO 8601 (HH:MM) format"},"end-time":{required:!0,values:!0,description:"End time in ISO 8601 (HH:MM) format"}},inline:[],text:!1,isToken:!1},option:{attributes:{option:{values:!0,description:"Option name",required:!0}},inline:[],text:!1,isToken:!1},"option-category":{attributes:{category:{values:!0,description:"Status category",required:!0}},inline:[],text:!1,isToken:!1},"schema-option":{attributes:{option:{values:!0,description:"Option name",required:!0}},inline:[],text:!1,isToken:!1},"schema-option-category":{attributes:{category:{values:!0,description:"Status category",required:!0}},inline:["schema-option"],text:!1,isToken:!1}},m={"property-title":{text:!0,inline:c,attributes:{}},"property-text":{text:!0,inline:p,attributes:{}},"property-url":{text:!0,inline:[],attributes:{}},"property-email":{text:!0,inline:[],attributes:{}},"property-phone-number":{text:!0,inline:[],attributes:{}},"property-person":{text:!1,inline:["mention-person","find-person"],attributes:{}},"property-date":{text:!1,inline:["mention-date","mention-date-range","mention-datetime","mention-datetime-range"],attributes:{}},"property-created-time":{text:!1,inline:["mention-date","mention-datetime"],attributes:{}},"property-last-edited-time":{text:!1,inline:["mention-date","mention-datetime"],attributes:{}},"property-created-by":{text:!1,inline:["mention-person"],attributes:{}},"property-last-edited-by":{text:!1,inline:["mention-person"],attributes:{}},"property-checkbox":{text:!1,inline:[],attributes:{checked:{values:["true","false"],description:'checked state, either "true" or "false"',required:!0}}},"property-select":{text:!1,inline:["option"],attributes:{}},"property-multi-select":{text:!1,inline:["option"],attributes:{}},"property-relation":{text:!1,inline:["mention-page"],attributes:{"database-id":{values:!0,description:"The database ID the relation points to",required:!1,mappingMode:"collection_counter"}}},"property-status":{text:!1,inline:["option"],attributes:{}},"property-number":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!1}}}},h=(0,n().uv)(m),g={"schema-property-title":{propertyTagName:"property-title",inline:[],attributes:{}},"schema-property-text":{propertyTagName:"property-text",inline:[],attributes:{}},"schema-property-url":{propertyTagName:"property-url",inline:[],attributes:{}},"schema-property-email":{propertyTagName:"property-email",inline:[],attributes:{}},"schema-property-phone-number":{propertyTagName:"property-phone-number",inline:[],attributes:{}},"schema-property-person":{propertyTagName:"property-person",inline:[],attributes:{limit:{values:["1","Infinity"],description:"The number of options that can be added",required:!0}}},"schema-property-date":{propertyTagName:"property-date",inline:[],attributes:{}},"schema-property-created-time":{propertyTagName:"property-created-time",inline:[],attributes:{}},"schema-property-last-edited-time":{propertyTagName:"property-last-edited-time",inline:[],attributes:{}},"schema-property-created-by":{propertyTagName:"property-created-by",inline:[],attributes:{}},"schema-property-last-edited-by":{propertyTagName:"property-last-edited-by",inline:[],attributes:{}},"schema-property-checkbox":{propertyTagName:"property-checkbox",inline:[],attributes:{}},"schema-property-select":{propertyTagName:"property-select",inline:["schema-option"],attributes:{}},"schema-property-multi-select":{propertyTagName:"property-multi-select",inline:["schema-option"],attributes:{}},"schema-property-relation":{propertyTagName:"property-relation",inline:["mention-page"],attributes:{limit:{values:["1","Infinity"],description:"The number of options that can be added",required:!0},"database-id":{values:!0,description:"The database ID the relation points to",required:!0,mappingMode:"collection_counter"},"synced-property-name":{required:!1,values:!0,description:"The symmetric relation property name in the database this relation points to"}}},"schema-property-status":{propertyTagName:"property-status",inline:["schema-option-category"],attributes:{}},"schema-property-number":{propertyTagName:"property-number",inline:[],attributes:{format:{values:!0,description:"Number format",required:!1}}}},y=["Count all"],b=["Count values","Count unique values","Count empty","Count not empty","Percent empty","Percent not empty","Show unique values"],f={"Count all":"count","Count values":"count_values","Count unique values":"unique","Count empty":"empty","Count not empty":"not_empty","Percent empty":"percent_empty","Percent not empty":"percent_not_empty","Show unique values":"show_unique","Count checked":"checked","Count unchecked":"unchecked","Percent checked":"percent_checked","Percent unchecked":"percent_unchecked","Count per group":"count_per_group","Percent per group":"percent_per_group",Sum:"sum",Average:"average",Median:"median",Min:"min",Max:"max",Range:"range","Earliest date":"earliest_date","Latest date":"latest_date","Date range":"date_range"},v={basic:[...y,...b],date:[...y,...b,"Earliest date","Latest date","Date range"],status:[...y,...b,"Count per group","Percent per group"],number:[...y,...b,"Sum","Average","Median","Min","Max","Range"],checkbox:[...y,"Count checked","Count unchecked","Percent checked","Percent unchecked"]};function T(e){return`the name of the ${e} property being aggregated`}function k(e){return`the method of aggregation for the ${e} property`}const N={"aggregation-property-title":{attributes:{name:{required:!0,values:!0,description:T("title")},aggregation:{values:v.basic,required:!0,description:k("title")}}},"aggregation-property-text":{attributes:{name:{required:!0,values:!0,description:T("text")},aggregation:{values:v.basic,required:!0,description:k("text")}}},"aggregation-property-url":{attributes:{name:{required:!0,values:!0,description:T("url")},aggregation:{values:v.basic,required:!0,description:k("url")}}},"aggregation-property-email":{attributes:{name:{required:!0,values:!0,description:T("email")},aggregation:{values:v.basic,required:!0,description:k("email")}}},"aggregation-property-phone-number":{attributes:{name:{required:!0,values:!0,description:T("phone_number")},aggregation:{values:v.basic,required:!0,description:k("phone_number")}}},"aggregation-property-date":{attributes:{name:{values:!0,required:!0,description:T("date")},aggregation:{values:v.date,required:!0,description:k("date")}}},"aggregation-property-created-time":{attributes:{name:{values:!0,required:!0,description:T("created-time")},aggregation:{values:v.date,required:!0,description:k("created-time")}}},"aggregation-property-last-edited-time":{attributes:{name:{values:!0,required:!0,description:T("last-edited-time")},aggregation:{values:v.date,required:!0,description:k("last-edited-time")}}},"aggregation-property-person":{attributes:{name:{values:!0,required:!0,description:T("person")},aggregation:{values:v.basic,required:!0,description:k("person")}}},"aggregation-property-created-by":{attributes:{name:{values:!0,required:!0,description:T("created-by")},aggregation:{values:v.basic,required:!0,description:k("created-by")}}},"aggregation-property-last-edited-by":{attributes:{name:{values:!0,required:!0,description:T("last-edited-by")},aggregation:{values:v.basic,required:!0,description:k("last-edited-by")}}},"aggregation-property-checkbox":{attributes:{name:{values:!0,required:!0,description:T("checkbox")},aggregation:{values:v.checkbox,required:!0,description:k("checkbox")}}},"aggregation-property-select":{attributes:{name:{values:!0,required:!0,description:T("select")},aggregation:{values:v.basic,required:!0,description:k("select")}}},"aggregation-property-multi-select":{attributes:{name:{values:!0,required:!0,description:T("multi-select")},aggregation:{values:v.basic,required:!0,description:k("multi-select")}}},"aggregation-property-relation":{attributes:{name:{values:!0,required:!0,description:T("relation")},aggregation:{values:v.basic,required:!0,description:k("relation")}}},"aggregation-property-number":{attributes:{name:{values:!0,required:!0,description:T("number")},aggregation:{values:v.number,required:!0,description:k("number")}}},"aggregation-property-status":{attributes:{name:{values:!0,required:!0,description:T("status")},aggregation:{values:v.status,required:!0,description:k("status")},group:{values:!0,required:!0,description:"then name of the status group being aggregated when aggregation is 'Count per group' or 'Percent per group'. For other aggregations, just provide any group name."}}}},w=["hr","h1","h2","h3","database","math-block","code-block","child-page","link-page","child-database","link-database","database-views","text","page","synced-block","synced-block-reference","uli","oli","toggle","quote","callout","todo","columns","table","unknown-block"],x={required:!1,values:d,description:"color for the block"},I={hr:{title:!1,content:[],attributes:{},properties:[],schemas:[]},h1:{title:!0,content:[],attributes:{color:x},properties:[],schemas:[]},h2:{title:!0,content:[],attributes:{color:x},properties:[],schemas:[]},h3:{title:!0,content:[],attributes:{color:x},properties:[],schemas:[]},h4:{title:!0,content:[],attributes:{color:x},properties:[],schemas:[]},database:{title:!1,content:[],attributes:{},properties:["property-title"],schemas:h},"math-block":{title:!0,content:[],attributes:{},properties:[],schemas:[]},"code-block":{title:!0,content:[],attributes:{language:{required:!1,values:a(15440).yz,description:"language of code"}},properties:[],schemas:[]},"child-page":{title:!1,content:[],attributes:{"page-id":{required:!0,values:!0,description:"ID of page, to be used in <load>",mappingMode:"block_counter"},"database-id":{required:!1,values:!0,description:"The ID of the database this page is within, if there is one",mappingMode:"collection_counter"},"has-content":{required:!1,values:["true","false"],description:'"true" if the page has content, "false" otherwise'}},properties:h,schemas:[]},"link-page":{title:!1,content:[],attributes:{"page-id":{required:!0,values:!0,description:"ID of page, to be used in <load>",mappingMode:"block_counter"},"database-id":{required:!1,values:!0,description:"The ID of the database this page is within, if there is one",mappingMode:"collection_counter"}},properties:h,schemas:[]},"child-database":{title:!1,content:[],attributes:{"database-id":{required:!0,values:!0,description:"ID of database. Make sure to use the value of this attribute as the id in query-database.",mappingMode:"block_counter"}},properties:["property-title"],schemas:h},"database-views":{title:!1,content:[],attributes:{},properties:["property-title"],schemas:h},"link-database":{title:!1,content:[],attributes:{"database-id":{required:!0,values:!0,description:"ID of database",mappingMode:"collection_counter"}},properties:["property-title"],schemas:h},text:{title:!0,content:w,attributes:{color:x},properties:[],schemas:[]},page:{title:!1,content:w,attributes:{"database-id":{required:!1,values:!0,description:"ID of the database this page belongs to. Use this to look up the schema for the page",mappingMode:"collection_counter"},"page-font":{required:!1,values:["default","serif","mono"],description:"Font used for the page"},"page-width":{required:!1,values:["default","full-width"],description:"Width of the page"},"page-font-size":{required:!1,values:["default","small"],description:"Font size for the page"}},properties:h,schemas:[]},uli:{title:!0,content:w,attributes:{color:x},properties:[],schemas:[]},oli:{title:!0,content:w,attributes:{color:x,index:{required:!1,values:!0,description:"Specify a custom index for the list item"}},properties:[],schemas:[]},toggle:{title:!0,content:w,attributes:{color:x,size:{required:!1,values:["h1","h2","h3","h4"],description:"size of the toggle header, if the toggle is a header"}},properties:[],schemas:[]},quote:{title:!0,content:w,attributes:{color:x},properties:[],schemas:[]},todo:{title:!0,content:w,attributes:{checked:{required:!0,values:["true","false"],description:'checked state, either "true" or "false"'},color:x},properties:[],schemas:[]},callout:{title:!0,content:w,attributes:{color:x},properties:[],schemas:[]},"synced-block":{title:!1,content:w,attributes:{},properties:[],schemas:[]},"synced-block-reference":{title:!1,content:w,attributes:{"synced-block-id":{required:!0,values:!0,description:"The ID of the <synced-block> node that this references",mappingMode:"block_counter"}},properties:[],schemas:[]},columns:{title:!1,content:["column"],attributes:{},properties:[],schemas:[]},column:{title:!1,content:w,attributes:{},properties:[],schemas:[]},table:{title:!1,content:["tr"],attributes:{"header-row":{required:!1,values:["true","false"],description:'whether first <tr> is row header, either "true" or "false"'},"header-column":{required:!1,values:["true","false"],description:'whether first <td> in every <tr> is column header, either "true" or "false"'}},properties:[],schemas:["property-text"]},tr:{title:!1,content:[],attributes:{},properties:["property-text"],schemas:[]},"ai-block":{title:!0,content:w,attributes:{},properties:["property-text"],schemas:[]},transcript:{title:!0,content:w,attributes:{},properties:[],schemas:[]},"unknown-block":{title:!0,content:w,attributes:{type:{required:!1,values:Object.values(a(700500).xd),description:"the type of the unknown block"}},properties:[],schemas:[]}},_=Object.freeze((0,n().uv)({text:!0,toggle:!0,quote:!0,callout:!0,uli:!0,oli:!0,todo:!0,h1:!0,h2:!0,h3:!0,h4:!0}));function C(e){return e}function M(e){return e}function E(e){return e}function $(e){return e}function S(){return i().JW()}function R(e){return(0,o().gB)(r()(e))}function U(e){return"collectionView"===e.type}const O="search-notion-help";function A(e){return"synced-block-reference"===e||"ai-block"===e||"database-views"===e||"transcript"===e||"h4"===e}},292722:(e,t,a)=>{"use strict";a.d(t,{A0:()=>i,Ld:()=>c,Os:()=>u,SH:()=>s,ag:()=>p,c9:()=>d,rk:()=>l});a(944114),a(898992),a(354520),a(581454);var r=()=>a(534177),o=()=>a(252050),n=()=>a(706461);function i(e){return e.replace(/<think>[\s\S]*?<\/think>/g,"").trim()}function s(e){return e.replace(/<lang[\s\S]*?\/?>/g,"").trim()}function l(e){return e.replaceAll(n().uS,"").replaceAll(n().dK,"")}function d(e){const{tagName:t,inputString:a}=e,r=new RegExp(`<${t}(?:\\s+[^>]*)?>([\\s\\S]*?)</${t}>`,"g");let o;const n=[];for(;null!==(o=r.exec(a));)n.push(o[1]);return n.join("\n")}function c(e){return(0,r().Xk)(o().F6,e.tagName)}function p(e){return(0,r().Xk)(o().qI,e.tagName)}function u(e){const t=[];for(const a of e.children)"collectionView"!==a.type&&(t.push(a),t.push(...u(a)));return t}},316581:(e,t,a)=>{"use strict";a.d(t,{_A:()=>p,nt:()=>c});a(16280),a(944114),a(898992),a(354520),a(672577),a(430670),a(803949),a(581454),a(908872),a(737550);var r=a.n(a(755373)),o=()=>a(496603),n=()=>a(534177),i=()=>a(902006),s=()=>a(208685),l=()=>a(832443),d=()=>a(252050);function c(e){const{searchResults:t,state:a}=e;for(const o of t){const e=l().tD.parseAssistantHref(o.id);if("slack"===o.type)o.messages.forEach(((e,t)=>{const n=l().tD.parseAssistantHref(e.messageId);if(!n||"slack"!==n.type)throw new Error(`HREF (${e.messageId}) could not be parsed as a Slack message result`);if(0===t&&n.threadTs){const e=(0,i().V9)(`slack://?${r().stringify({base_url:n.baseUrl,channel_id:n.channelId,message_id:n.threadTs,thread_ts:n.threadTs})}`);a.setUniversalResultPayload(e,{type:"slack",href:e,threadHref:e,title:o.title,text:o.text,user:"",lastEdited:o.lastEdited,domain:n.domain,baseUrl:n.baseUrl,channelId:n.channelId,messageId:n.threadTs,threadTs:n.threadTs,threadMessages:o.messages.map((e=>e.messageId))})}a.setUniversalResultPayload((0,i().V9)(e.messageId),{type:"slack",href:e.messageId,threadHref:e.threadId,title:o.title,text:e.text,user:e.user,lastEdited:e.lastEdited,domain:n.domain,baseUrl:n.baseUrl,channelId:n.channelId,messageId:n.messageId,threadTs:n.threadTs,threadMessages:o.messages.map((e=>e.messageId))})}));else if("helpdoc"===o.type){if(!e||"helpdoc"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a helpdoc result`);const t={type:"helpdoc",href:o.id,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};a.setUniversalResultPayload((0,i().h5)(o.id),t)}else if("helpdoc-section"===o.type){if(!e||"helpdoc-section"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a helpdoc-section result`);const t={type:"helpdoc-section",href:o.id,parentPageHref:e.parentPageHref,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};a.setUniversalResultPayload(e.href,t);const r=l().tD.parseAssistantHref(e.parentPageHref);if("helpdoc"!==(null==r?void 0:r.type))throw new Error(`HREF (${o.id}) could not be parsed as a helpdoc-section result because its parent page could not be parsed as a helpdoc`);a.setUniversalResultPayload(e.parentPageHref,{...t,type:"helpdoc",href:e.parentPageHref,title:o.path,text:"",lastEdited:o.lastEdited,url:r.url})}else if("webpage"===o.type){if(!e||"webpage"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a webpage result`);const t={type:"webpage",href:o.id,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};a.setUniversalResultPayload((0,i().RW)(o.id),t)}else if("gmail"===o.type){if(!e||"gmail"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a gmail result`);const t=(0,i().V9)(`gmail://?url=${encodeURIComponent(`https://mail.google.com/mail/?authuser=${o.emailAddress}#all/${o.pageId}`)}`),r={type:"gmail",href:o.id,threadHref:t,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};a.setUniversalResultPayload(e.href,r);const n=l().tD.parseAssistantHref(t);if("gmail"!==(null==n?void 0:n.type))throw new Error(`HREF (${o.id}) could not be parsed as a gmail result because its thread URL ${t} could not be parsed as gmail href`);a.setUniversalResultPayload(t,{...r,type:"gmail",href:t,title:o.path,text:o.text,lastEdited:o.lastEdited,url:n.url,threadHref:t})}else if("notion-mail"===o.type){if(!e||"notion-mail"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a notion-mail result`);const t=(0,i().V9)(`notion-mail://?url=${encodeURIComponent(`https://notion.so/mail/${o.pageId}`)}`),r={type:"notion-mail",href:o.id,threadHref:t,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};a.setUniversalResultPayload(e.href,r);const n=l().tD.parseAssistantHref(t);if("notion-mail"!==(null==n?void 0:n.type))throw new Error(`HREF (${o.id}) could not be parsed as a gmail result because its thread URL ${t} could not be parsed as gmail href`);a.setUniversalResultPayload(t,{...r,type:"notion-mail",href:t,title:o.path,text:o.text,lastEdited:o.lastEdited,url:n.url,threadHref:t})}else if("outlook"===o.type){if(!e||"outlook"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a outlook result`);const t=(0,i().V9)(`outlook://?url=${encodeURIComponent("https://outlook.live.com/mail/0/")}`),r={type:"outlook",href:o.id,threadHref:t,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};a.setUniversalResultPayload(e.href,r);const n=l().tD.parseAssistantHref(t);if("outlook"!==(null==n?void 0:n.type))throw new Error(`HREF (${o.id}) could not be parsed as a outlook result because its thread URL ${t} could not be parsed as outlook href`);a.setUniversalResultPayload(t,{...r,type:"outlook",href:t,title:o.title,text:o.text,lastEdited:o.lastEdited,url:n.url,threadHref:t})}else if("microsoft-teams"===o.type){if(!e||"microsoft-teams"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a microsoftTeams result`);o.messages.forEach(((e,t)=>{const n=l().tD.parseAssistantHref(e.messageId);if(!n||"microsoft-teams"!==n.type)throw new Error(`HREF (${e.messageId}) could not be parsed as a Slack message result`);if(0===t&&n.threadTs){const e={url:n.url,channel_id:n.channelId,message_id:n.threadTs,thread_ts:n.threadTs,message_type:n.messageType},t=(0,i().V9)(`microsoftTeams://?${r().stringify(e)}`);a.setUniversalResultPayload(t,{type:"microsoft-teams",href:t,threadHref:t,title:o.title,text:o.text,user:"",lastEdited:o.lastEdited,url:n.url,channelId:n.channelId,messageId:n.threadTs,threadTs:n.threadTs,messageType:n.messageType,threadMessages:o.messages.map((e=>e.messageId))})}a.setUniversalResultPayload((0,i().V9)(e.messageId),{type:"microsoft-teams",href:e.messageId,threadHref:e.threadId,title:o.title,text:e.text,user:e.user,lastEdited:e.lastEdited,url:n.url,channelId:n.channelId,messageId:n.messageId,threadTs:n.threadTs,messageType:n.messageType,threadMessages:o.messages.map((e=>e.messageId))})}))}else if((0,i().SC)(o.type)){if(!e||e.type!==o.type)throw new Error(`HREF (${o.id}) could not be parsed as a ${o.type} result`);const t={type:o.type,href:(0,i().V9)(o.id),title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url,iconUrl:"iconUrl"in o?o.iconUrl:void 0};a.setUniversalResultPayload((0,i().V9)(o.id),t)}else if("page"===o.type){const e={type:"page",id:o.id,highlight:o.highlight,title:o.title,text:o.text,lastEdited:o.lastEdited};a.setUniversalResultPayload((0,d().ew)(o.id),e)}else{if("block"===o.type||"properties"===o.type)continue;(0,n().HB)(o.type)}}}function p(e){const{searchResults:t,systemMessages:a,evaluationId:r,scope:l}=e;let d=!1;const c=t.filter((e=>"block"===e.type||"properties"===e.type)),p=function(e){return e.reduce(((e,t)=>{const a=e.find((e=>e.pageId===t.pageId));return a?(a.blocks.push(t),e):[...e,{pageId:t.pageId,title:t.title,path:t.path,lastEdited:t.lastEdited,blocks:[t]}]}),[])}(c),m=p.map((e=>(e.blocks.some((e=>e.isPrivate))&&(d=!0),{type:"element",tagName:"page",attributes:{id:e.pageId,title:e.title,...e.path&&{path:e.path},"last-edited-datetime":e.lastEdited},children:u(e.blocks).map((e=>({type:"element",tagName:"block",attributes:{id:e.id},children:[{type:"text",value:e.text}]})))}))),h=t.filter((e=>!("page"!==e.type&&"helpdoc"!==e.type&&"helpdoc-section"!==e.type&&"webpage"!==e.type&&!(0,i().SC)(e.type))||"block"!==e.type&&"properties"!==e.type&&(0,n().HB)(e.type))),g=[];for(const o of h){const{id:e,title:t,text:a,lastEdited:r}=o;if(o.isPrivate&&(d=!0),"helpdoc"===o.type)g.push({type:"element",tagName:"helpdoc",attributes:{id:e,title:t,"last-edited-datetime":r},children:[{type:"element",tagName:"helpdoc-section",attributes:{id:e,title:t},children:[{type:"text",value:a}]}]});else if("helpdoc-section"===o.type){let n=g.find((e=>"helpdoc"===e.tagName&&e.attributes.id===o.pageId));n||(n={type:"element",tagName:"helpdoc",attributes:{id:o.pageId,title:o.path,"last-edited-datetime":r},children:[]},g.push(n)),n.children.push({type:"element",tagName:"helpdoc-section",attributes:{id:e,title:t},children:[{type:"text",value:a}]})}else if("google-drive"===o.type)g.push({type:"element",tagName:"google-drive-result",attributes:{id:e,title:t,"last-edited-datetime":r,...o.fileType&&{"file-type":o.fileType}},children:[{type:"text",value:a}]});else if("webpage"===o.type)g.push({type:"element",tagName:"webpage",attributes:{id:e,title:t,"updated-datetime":r},children:[{type:"text",value:a}]});else if("github"===o.type){const n=void 0===r||r.toLowerCase().includes("invalid");g.push({type:"element",tagName:"github-result",attributes:{id:e,title:t,...o.authorName&&{"author-username":o.authorName},...o.statusTag&&{status:o.statusTag},"repo-name":o.githubRepoName,...o.path&&{path:o.path},...!n&&{"last-edited-datetime":r},...o.fileType&&{"file-type":o.fileType}},children:[{type:"text",value:a}]})}else if("notion-mail"===o.type){let r=g.find((e=>"notion-mail-result"===e.tagName&&e.attributes.id===o.pageId));r||(r={type:"element",tagName:"notion-mail-result",attributes:{id:o.pageId,title:o.title},children:[]},g.push(r)),r.children.push({type:"element",tagName:"email",attributes:{id:e,title:t},children:[{type:"text",value:a}]})}else if("outlook"===o.type){let r=g.find((e=>"outlook-result"===e.tagName&&e.attributes.id===o.pageId));r||(r={type:"element",tagName:"outlook-result",attributes:{id:o.pageId,title:o.title},children:[]},g.push(r)),r.children.push({type:"element",tagName:"email",attributes:{id:e,title:t},children:[{type:"text",value:a}]})}else if("page"===o.type)g.push({type:"element",tagName:"page-result",attributes:{id:e,title:t,path:o.path,"last-edited-datetime":r,"author-name":o.authorName??""},children:[{type:"text",value:a}]});else if("notion-calendar"===o.type)g.push({type:"element",tagName:"notion-calendar-result",attributes:{id:e,title:t},children:[{type:"text",value:a}]});else{(0,s().v)(o.type).addSearchResultToXML(o,g)}}const y={},b=o().hS(t.flatMap((e=>{const{id:t,pageId:a,type:r}=e;if(t&&a&&(y[t]={deIdentifiedId:a,type:r}),"block"===e.type||"properties"===e.type){const t=m.find((t=>t.attributes.id===e.pageId));return t?[t]:[]}if("page"===e.type||"helpdoc"===e.type||"webpage"===e.type||"helpdoc-section"===e.type||(0,i().SC)(e.type)){const t=g.find((t=>t.attributes.id===e.id||t.children.some((t=>"attributes"in t&&t.attributes.id===e.id))));return t?[t]:[]}(0,n().HB)(e.type)})),"attributes.id");return{type:"observation",observationType:"search",value:{type:"element",resultType:"universal",tagName:"search-results",attributes:{"current-results":b.length.toString()},children:b},containsNonSpaceSharedResults:d,systemMessages:a,idToDeIdentifiedIds:y,evaluationId:r,scope:l}}function u(e){const t=["numbered_list","bulleted_list","text"];let a=[];return e.reduce(((r,o,i)=>{const s=o.blockType,l=[...r],d=(0,n().Xk)(t,s),c=d&&a.length>0&&o.text.length<750&&(p=a,(u=o).spanIndex-p[0].spanIndex<=5&&u.spanIndex-p[0].spanIndex>=0);var p,u;a.length>0&&(!c||a.length>10)&&(1===a.length?l.push(a[0]):l.push(m(a)),a=[]);return d&&0===a.length&&o.text.length<500||c?(a.push(o),i===e.length-1&&(l.push(m(a)),a=[])):l.push(o),l}),[])}function m(e){const t=e[0];return{type:"block",id:t.id,text:e.map((e=>e.text)).join("\n"),path:t.path,isPrivate:t.isPrivate,pageId:t.pageId,title:t.title,lastEdited:t.lastEdited,blockType:t.blockType,spanIndex:t.spanIndex}}},331119:(e,t,a)=>{"use strict";a.d(t,{RB:()=>f,U5:()=>c,W6:()=>p,ke:()=>h,nx:()=>y,t7:()=>g,x3:()=>b});a(16280),a(18107),a(944114),a(898992),a(354520),a(672577),a(581454);var r=()=>a(496603),o=()=>a(973647),n=()=>a(534177),i=()=>a(251582),s=()=>a(181856),l=()=>a(832443);const d=i().p.satisfy((e=>"element"===e.type));function c(e){return i().p.describe(i().p.filter(d,(t=>t.tagName===e)),(()=>new(s().gJ)(e)))}const p=i().p.satisfy((e=>"text"===e.type)),u=i().p.satisfy((e=>"text"===e.type&&""===e.value.trim()));function m(e){const{prefixMappingMode:t,baseHref:a}=e;return"query_database_result_counter"===t?`query_database_result_counter:/${l().tD.blockIdToHref(a)}`:"href_counter"===t?a:void(0,n().HB)(t)}function h(e){const{inputAttributes:t={},definitions:a,tagName:i,validateRequiredAttributes:d=!0,mapCounterToKey:c}=e,p=Object.keys(t),u=Object.keys(a),h=r().R9(p,u);if(h.length>0)return{error:new(s().LN)({attributeNames:h,tagName:i})};if(d)for(const[r,o]of Object.entries(a))if(o.required&&!p.includes(r))return{error:new(s().HQ)({attributeName:r,tagName:i})};const g=r().o8(t);for(const[r,y]of Object.entries(t)){const e=a[r];if((0,n().O9)(e.mappingMode)){if("href_counter"!==e.mappingMode&&!(0,l().D4)(y))return{error:new(s().qW)(r,y)};if((0,n().O9)(c)&&"href_counter"===e.mappingMode){let e;const t=["href_counter","query_database_result_counter"];for(const a of t)if(e=l().tD.mapCounterToKeyInMode({mapCounterToKey:c},y,a,i),o().Q.isSuccess(e)){g[r]=m({prefixMappingMode:a,baseHref:e.value});break}if(o().Q.isFail(e))return{error:new(s().wL)("unmapped_id",e.error.message,e.error)}}else if((0,n().O9)(c)){const t=l().tD.mapCounterToKeyInMode({mapCounterToKey:c},y,e.mappingMode,i);if(o().Q.isFail(t))return{error:new(s().wL)("unmapped_id",t.error.message,t.error)};g[r]=t.value}}if(!0!==e.values&&!e.values.includes(y))return{error:new(s().GW)({attributeName:r,receivedValue:y,tagName:i})}}return{value:g}}function g(e,t){if(0===e.length)throw new Error("Must provide at least 1 label and type guard");const a=[...e],r=[[]];for(const n of t){const[t,i]=a[0];if(!i(n)){for(;a.length>0;){a.shift();const e=a[0];if(r.push([]),e&&e[1](n))break}if(0===a.length){var o;const a=null===(o=e.find((([,e])=>e(n))))||void 0===o?void 0:o[0];if(!a)throw new Error(`Item did not match any type guards: ${JSON.stringify(n)}`);return{error:{incorrectLabel:a,lastLabel:t}}}}r.at(-1).push(n)}for(;r.length<e.length;)r.push([]);return{value:r}}function y(e,t,a){const{allowUnmatchedText:o=!1}=a??{},n=i().p.manyTill(i().p.choice([...t,...o?[i().p.map(u,(e=>{}))]:[],i().p.fail((t=>new(s().RR)({tagName:e,unexpectedNode:t[0]})))]),i().p.eof());return i().p.map(n,(e=>r().oE(e)))}function b(e){return e.children&&e.children.length>0?{error:new(s().RR)({tagName:e.tagName,unexpectedNode:e.children[0]})}:{value:void 0}}function f(e){const{tagName:t,attributeDefinitions:a,mapCounterToKey:r}=e;return i().p.mapResult(c(t),(e=>{const n=h({tagName:t,inputAttributes:e.attributes,definitions:a,mapCounterToKey:r});if(o().Q.isFail(n))return n;const i=b(e);return o().Q.isFail(i)?i:{value:{attributes:n.value}}}))}},335600:(e,t,a)=>{"use strict";a.d(t,{R:()=>o});a(16280),a(944114),a(581454);var r=()=>a(902006);class o extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="microsoft-teams",this.displayName="Microsoft Teams",this.requiresUserAuth=!1,this.featureGate="microsoft_teams_qna",this.category="vector",this.parentOrganization="Microsoft",this.fileTypes=["message"],this.qnaIngestionAIAppId="c91548d4-25d0-44a2-ab2e-19f6f0b11d96",this.urlRegex=/https:\/\/teams\.microsoft\.com\/l\/message\/(?<channelId>[^\/?&]+)\/(?<timestamp>\d+)\?[^#]*?(tenantId=(?<tenantId>[0-9a-fA-F-]{36}))?(?:\S*)?/}getTitle(e){if("microsoft-teams"!==e.type)throw new Error(`Expected microsoft-teams resource, got resource.type=${e.type}`);return e.channel}getText(e){if("microsoft-teams"!==e.type)throw new Error(`Expected microsoft-teams resource, got resource.type=${e.type}`);return`<mentioned-microsoft-teams type="${e.type}" channel="${e.channel}" timestamp="${e.timestamp}">\n${e.messages.map((e=>`<message user="${e.user.name}">${e.text}</message>`)).join("\n")}\n</mentioned-microsoft-teams>`}buildSearchResult(e){const{result:t,baseAttributes:a,mappedIdOrUrlForResultID:r}=e;if("microsoft-teams"!==t.type)return super.buildSearchResult(e);if(t.messages&&t.messages.length>0){const e=t.messages.map((e=>{const t=r({type:"microsoft-teams",id:e.messageId});return{type:"element",tagName:"message",attributes:{..."mapped_as_url"===t.status?{url:t.url}:{},..."mapped_as_int"===t.status?{id:t.id}:{},user:e.user,"last-updated":e.lastEdited},children:[{type:"text",value:e.text}]}}));return{attributes:{...a,...t.channel?{channel:t.channel}:{}},children:[{type:"element",tagName:"messages",attributes:{},children:e}]}}return{attributes:{...a,...t.channel?{channel:t.channel}:{}},children:[{type:"text",value:t.text}]}}getSearchResultXMLTagName(){return"microsoft-teams-thread"}addSearchResultToXML(e,t){if("microsoft-teams"!==e.type)throw new Error(`Expected microsoft-teams result, got result.type=${e.type}`);t.push({type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.id,channel:e.channel??"","last-edited-datetime":e.lastEdited},children:e.messages.map((e=>({type:"element",tagName:"microsoft-teams-message",attributes:{id:e.messageId,"last-edited-datetime":e.lastEdited,user:e.user},children:[{type:"text",value:e.text}]})))})}mapObservationResultNode(e){const{node:t,idMapper:a,idToCounter:o}=e;if(t.tagName!==this.getSearchResultXMLTagName())return t;const n=a.mapKeyToCounter({type:"microsoft-teams-message",key:(0,r().V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n},children:t.children.map((e=>{const t=a.mapKeyToCounter({type:"microsoft-teams-message",key:(0,r().V9)(e.attributes.id)});return o[e.attributes.id]=t,{...e,attributes:{...e.attributes,id:t}}}))}}}},353566:(e,t,a)=>{"use strict";a.d(t,{Mz:()=>h,Yf:()=>g,TE:()=>Q,fw:()=>y,W6:()=>v,vr:()=>f,vt:()=>Z,et:()=>b,AR:()=>J,N:()=>w,p$:()=>xe,Eo:()=>_,WH:()=>V,nc:()=>X,mK:()=>z,yK:()=>x,XD:()=>k,Hh:()=>F,WM:()=>D,cW:()=>P,qY:()=>M,UQ:()=>U,xR:()=>O,C1:()=>R,FO:()=>A,Dp:()=>q,b8:()=>K,wu:()=>E,_r:()=>B,iL:()=>j,TM:()=>S,uz:()=>$,Yh:()=>T,By:()=>C,ZL:()=>ue,zY:()=>I,__:()=>N,$P:()=>L,lo:()=>H,Bq:()=>Y,oq:()=>te,UO:()=>G,D6:()=>W,F1:()=>we});a(16280),a(944114),a(517642),a(658004),a(733853),a(845876),a(432475),a(515024),a(731698),a(898992),a(354520),a(430670),a(803949),a(581454);var r=()=>a(906745),o=()=>a(496603),n=()=>a(534177),i=()=>a(902006),s=()=>a(251582),l=()=>a(181856),d=()=>a(252050),c=()=>a(165358);var p=()=>a(316581),u=()=>a(292722),m=()=>a(162278);const h=16,g=20;function y(e){var t;const a=e.children??[];return{type:"block",tagName:e.tagName,parent:null===(t=e.parent)||void 0===t?void 0:t.attributes.id,attributes:{...e.attributes},children:"database-views"===e.tagName?e.children:a.map((e=>e.attributes.id)),text:e.text,properties:e.properties,schemas:e.schemas,schemaId:e.schemaId,persisted:e.persisted}}function b(e){const t=new Map;for(const[o,n]of Object.entries(e))for(const e of n.children){var a;if("string"==typeof e)t.set(e,o);else if(null!==(a=e.attributes)&&void 0!==a&&a.id){var r;t.set(null===(r=e.attributes)||void 0===r?void 0:r.id,o)}}return t}function f(e){const{node:t,getBlockById:a,alreadyConvertedBlocks:r=new Map,childIdToParentIdMap:o,assistantLoggingData:i}=e,s=r.get(t.attributes.id);if(s)return s;let l;if(t.parent&&"object"==typeof t.parent)l=t.parent;else{let e;if(e=t.parent&&"string"==typeof t.parent?t.parent:null==o?void 0:o.get(t.attributes.id),e){const n=a(e);if(!n)return void(i&&function(e,t){const{spaceId:a,userId:r,sessionId:o}=e,{parentTagType:n,parentId:i}=t;c().log({level:"debug",from:"convertAssistantBlockToBlockNode",type:"parentNotFound",data:{userId:r,spaceId:a,sessionId:o,miscDataToConvertToString:{parentTagType:n,parentId:i}}})}(i,{parentTagType:t.tagName,parentId:t.attributes.id}));l=f({node:n,getBlockById:a,alreadyConvertedBlocks:r,childIdToParentIdMap:o})}}l&&r.set(l.attributes.id,l);const d={type:t.type,tagName:t.tagName,parent:l,attributes:{...t.attributes},text:t.text,properties:t.properties,schemas:t.schemas,children:[],persisted:t.persisted,schemaId:t.schemaId};return r.set(d.attributes.id,d),d.children=t.children.map((e=>{if("string"==typeof e){const n=a(e);if(!n){if("database-views"===t.tagName)return;return void(i&&function(e,t){const{spaceId:a,userId:r,sessionId:o}=e,{parentTagType:n,parentId:i,childBlockId:s}=t;c().log({level:"debug",from:"convertAssistantBlockToBlockNode",type:"childNotFound",data:{userId:r,spaceId:a,sessionId:o,miscDataToConvertToString:{parentTagType:n,childBlockId:s,parentId:i}}})}(i,{parentTagType:t.tagName,parentId:t.attributes.id,childBlockId:e}))}return f({node:n,getBlockById:a,alreadyConvertedBlocks:r,childIdToParentIdMap:o,assistantLoggingData:i})}return e})).filter(n().O9),d}function v(e){const{node:t,blockIdMap:a,childIdToParentIdMap:r,alreadyConvertedBlocks:o,assistantLoggingData:n}=e;return f({node:t,getBlockById:e=>a instanceof Map?a.get(e):a[e],childIdToParentIdMap:r,alreadyConvertedBlocks:o,assistantLoggingData:n})}const T={"load-page":E,search:L,"search-people":async function(e){const{state:t,observationNode:a}=e,{search:r}=a.attributes,o=await t.searchPeople(r),n={type:"element",tagName:"search-people-results",attributes:{"current-results":Math.min(6,o.results.length).toString(),"total-results":o.total.toString()},children:o.results.slice(0,6).map((e=>{const{id:t,name:a,email:r}=e;return{type:"element",tagName:"person",attributes:{"person-id":t},children:[{type:"element",tagName:"property-text",attributes:{name:"Name"},children:[{type:"text",value:a}]},{type:"element",tagName:"property-email",attributes:{name:"Email"},children:[{type:"text",value:r}]}]}}))};return t.appendNewSearchPeopleResult(o.results),[{type:"observation",observationType:"searchPeople",value:n}]},"load-database":M,load:F,"search-databases":H,"load-slack":S,"load-attachment":D,"load-web-page":$,"load-google-drive":R,"load-github":U,"load-github-code":O,"load-jira":A,"load-linear":q,"load-box":P,"load-salesforce":B,"load-microsoft-teams":K,"load-sharepoint":j};function k(e){return e.tagName in T}function N(e,t){return"load-page"===e.tagName||"search"===e.tagName||"search-people"===e.tagName||"load-database"===e.tagName||"search-databases"===e.tagName||"load-slack"===e.tagName||"load-attachment"===e.tagName||"load-web-page"===e.tagName||"load-google-drive"===e.tagName||"load-github"===e.tagName||"load-github-code"===e.tagName||"load-jira"===e.tagName||"load-linear"===e.tagName||"load-box"===e.tagName||"load-salesforce"===e.tagName||"load-microsoft-teams"===e.tagName||"load-sharepoint"===e.tagName?T[e.tagName]({observationNode:e,state:t}):void(0,n().HB)(e)}const w={"insert-before":X,"insert-after":V,"insert-inside":z,delete:function(e){const{state:t,effectNode:a}=e,r=a.attributes.id;if("property"===a.deleteType){const e=t.getBlockFromBlockIdMap(r);if("child-page"!==e.tagName)throw new(l().Te)("delete_property_on_non_database_child_page","Cannot call delete on a non-database child-page.");const[o]=a.children;switch(o.tagName){case"property-relation":!function({parentBlock:e,relationPropertyName:t,relationPropertyUpdates:a,state:r}){var o;const n=new Set(Te({propertyChild:a,parentBlock:e,propertyName:t,action:"delete",state:r})),i=e.properties[t];if("property-relation"!==i.tagName)throw new(l().Te)("invalid_relation_property_child","Invalid property child when setting relation");const s=i.children.filter((e=>{const t=e.attributes["page-id"];return!n.has(t)})),d={...i,children:s};e.properties[t]=d,r.addOperation({command:"setBlockProperty",blockNode:e,parentBlockId:null===(o=e.parent)||void 0===o?void 0:o.attributes.id,property:d},void 0)}({parentBlock:e,relationPropertyName:o.attributes.name,relationPropertyUpdates:o,state:t});break;case"property-person":de({parentBlock:e,personPropertyUpdate:o,state:t,action:"delete"});break;case"property-multi-select":ce({parentBlock:e,multiSelectPropertyName:o.attributes.name,multiSelectPropertyUpdates:o,state:t,action:"delete"});break;default:(0,n().HB)(o)}}else if("block"===a.deleteType){ue({remove:[t.getBlockFromBlockIdMap(r)],state:t})}else"table-column"===a.deleteType?J({state:t,effectNode:a}):(0,n().HB)(a)},"set-title":W,"set-attribute":Y,"set-tag-name":G,"set-property":te,chat:Q,"chat-md":function(e){const{state:t,effectNode:a}=e,r=["","","","","","","","","",""];let o=a.text;const n=/\[([0-9])\]/g;let i,s=1;for(;null!==(i=n.exec(a.text));)o=o.replace(i[0],`[${r[s]}](${t.getIdMapper().mapCounterToKey(i[1]).key.replaceAll("-","")})`),s++;t.chatMd(o)},"persist-blocks":function(e){const{state:t,effectNode:a,useCrdt:r}=e,o=ne({parent:void 0,children:a.children,state:t});for(const n of o)ie({block:n,state:t,useCrdt:r})},create:Z,"related-content":()=>[]};function x(e){return e.tagName in w}function I(e,t,a){return"chat"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:void 0}):"insert-after"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:a}):"delete"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:void 0}):"insert-before"===e.tagName||"insert-inside"===e.tagName||"persist-blocks"===e.tagName||"create"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:a}):"set-attribute"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:void 0}):"set-property"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:a}):"set-tag-name"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:void 0}):"set-title"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:a}):"chat-md"===e.tagName||"related-content"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:void 0}):void(0,n().HB)(e)}const _=["load-database","load-page","load","search","search-people","chat","create","search-databases","load-slack","insert-before","insert-after","insert-inside","delete","set-title","set-attribute","set-tag-name","set-property","replace","create-page","replace"],C={search:3,"search-people":3,load:10,"load-page":10,"load-database":10,"search-databases":3};async function M(e){const{state:t,observationNode:a}=e,{attributes:{id:r}}=a,{databaseNode:n,relatedNodes:i}=await t.loadDatabase(r);t.markDatabaseAsLoaded(r),t.addCollectionToCollectionIdMap(r,n),t.setSchemaIdMapForSchema(n.schemaId,n.schemas);const s=[];for(const{node:o,shouldShowObservation:l}of i)t.markDatabaseAsLoaded(o.attributes.id),t.setSchemaIdMapForSchema(o.schemaId,o.schemas),t.addCollectionToCollectionIdMap(o.attributes.id,o),l&&s.push(o);return o().hS([n,...s],(e=>e.attributes.id)).map((e=>"block"===e.type?{type:"observation",observationType:"page",pageId:e.attributes.id,value:e}:{type:"observation",observationType:"database",databaseId:e.attributes.id,value:e}))}async function E(e){const{state:t,observationNode:a}=e,{id:r}=a.attributes,{pageBlockNode:n,relatedNodes:i,relatedDatabaseNodes:s,isNonSpaceShared:l}=await t.loadPage(r);t.markPageAsLoaded(r),ae(t,n);const d=[];for(const{node:o,shouldShowObservation:c}of i)"block"===o.type&&(ae(t,o),c&&d.push(o));for(const o of s??[]){const e=o.node;t.addCollectionToCollectionIdMap(e.attributes.id,e),t.setSchemaIdMapForSchema(e.schemaId,e.schemas)}return o().hS([n,...d],(e=>e.attributes.id)).map((e=>({type:"observation",observationType:"page",pageId:e.attributes.id,value:e,isNonSpaceShared:l})))}async function $(e){const{state:t,observationNode:a}=e,{id:r}=a.attributes,o=await t.loadWebPage(r);t.markUniversalIdAsLoaded(r);const n={type:"observation",observationType:"webpage",value:{tagName:"webpage",type:"webpage",attributes:{id:r,title:o.AssistantWebpageSearchResult.title,"updated-datetime":o.AssistantWebpageSearchResult.lastEdited},children:[{type:"text",value:o.AssistantWebpageSearchResult.text}]}};return re(t,n.value),[n]}async function S(e){const{state:t,observationNode:a}=e,{id:r}=a.attributes;try{const e=(await t.loadSlack(r)).slackMessage;t.markUniversalIdAsLoaded(r);const a={type:"slackMessages",tagName:"slack-messages",attributes:{id:r,channel:e.channel},children:e.messages.map((e=>({type:"slackMessage",tagName:"message",attributes:{user:e.user.name},value:e.text})))};return re(t,a),[{type:"observation",observationType:"slack",value:a}]}catch(o){return[{type:"observation",observationType:"slack",value:{type:"slackMessages",tagName:"slack-messages",attributes:{id:r,channel:"unable to load"},children:[]}}]}}async function R(e){const{state:t,observationNode:a}=e,{id:r}=a.attributes;try{const e=(await t.loadGoogleDrive(r)).googleDriveContent;t.markUniversalIdAsLoaded(r);const a={type:"googleDrive",tagName:"google-drive",attributes:{id:(0,i().V9)(e.fileId),fileType:e.fileType,title:e.title},children:e.blocks.map((e=>({type:"googleDriveBlock",tagName:"google-drive-block",value:e})))};return re(t,a),[{type:"observation",observationType:"googleDrive",value:a}]}catch(o){return[{type:"observation",observationType:"googleDrive",value:{type:"googleDrive",tagName:"google-drive",attributes:{id:r,title:"unable to load",fileType:"unable to load"},children:[]}}]}}async function U(e){const{state:t,observationNode:a}=e,{id:r}=a.attributes;try{const e=(await t.loadGithub(r)).githubContent;t.markUniversalIdAsLoaded(r);const a={type:"github",tagName:"github",attributes:{id:(0,i().V9)(e.prNumber),orgName:e.orgName,repoName:e.repoName,title:e.title},children:e.blocks.map((e=>({type:"githubBlock",tagName:"github-block",value:e})))};return re(t,a),[{type:"observation",observationType:"github",value:a}]}catch(o){return[{type:"observation",observationType:"github",value:{type:"github",tagName:"github",attributes:{id:r,title:"unable to load",repoName:"unable to load",orgName:"unable to load"},children:[]}}]}}async function O(e){const{state:t,observationNode:a}=e,{id:r}=a.attributes;try{const e=(await t.loadGithubCode(r)).githubCodeContent;t.markUniversalIdAsLoaded(r);const a={type:"githubCode",tagName:"github-code",attributes:{id:(0,i().V9)(e.codePath),...e}};return re(t,a),[{type:"observation",observationType:"githubCode",value:a}]}catch(o){return[{type:"observation",observationType:"github",value:{type:"github",tagName:"github",attributes:{id:r,title:"unable to load",repoName:"unable to load",orgName:"unable to load"},children:[]}}]}}async function A(e){const{state:t,observationNode:a}=e,{id:r}=a.attributes;try{const e=(await t.loadJira(r)).jiraContent;t.markUniversalIdAsLoaded(r);const a={type:"jira",tagName:"jira",attributes:{id:r,title:e.title},children:[{type:"text",value:e.text}]};return re(t,a),[{type:"observation",observationType:"jira",value:a}]}catch(o){return[{type:"observation",observationType:"jira",value:{type:"jira",tagName:"jira",attributes:{id:r,title:"unable to load"},children:[{type:"text",value:""}]}}]}}async function q(e){const{state:t,observationNode:a}=e,{id:r}=a.attributes;try{const e=(await t.loadLinear(r)).linearContent;t.markUniversalIdAsLoaded(r);const a={type:"linear",tagName:"linear",attributes:{id:r,title:e.title,name:e.title,"linear-organization-id":"",assignee:"",creator:"",project:"",cycle:"","due-date":"",team:""},children:[{type:"text",value:e.text}]};return re(t,a),[{type:"observation",observationType:"linear",value:a}]}catch(o){return[{type:"observation",observationType:"linear",value:{type:"linear",tagName:"linear",attributes:{id:r,title:"unable to load",name:"unable to load","linear-organization-id":"",assignee:"",creator:"",project:"",cycle:"","due-date":"",team:""},children:[{type:"text",value:""}]}}]}}async function P(e){const{state:t,observationNode:a}=e,{id:r}=a.attributes;try{const e=(await t.loadBox(r)).boxContent;t.markUniversalIdAsLoaded(r);const a={type:"box",tagName:"box",attributes:{id:r,title:e.title,name:e.title,"file-id":e.fileId},children:[{type:"text",value:e.blocks.join("\n")}]};return re(t,a),[{type:"observation",observationType:"box",value:a}]}catch(o){return[{type:"observation",observationType:"box",value:{type:"box",tagName:"box",attributes:{id:r,title:"unable to load",name:"unable to load","file-id":""},children:[{type:"text",value:""}]}}]}}async function B(e){const{state:t,observationNode:a}=e,{id:r}=a.attributes;try{const e=(await t.loadSalesforce(r)).salesforceContent;t.markUniversalIdAsLoaded(r);const a={type:"salesforce",tagName:"salesforce",attributes:{id:r,title:e.title,recordId:e.recordId,objectType:e.objectType},children:[{type:"text",value:e.blocks.join("\n")}]};return re(t,a),[{type:"observation",observationType:"salesforce",value:a}]}catch(o){return[{type:"observation",observationType:"salesforce",value:{type:"salesforce",tagName:"salesforce",attributes:{id:r,title:"unable to load",recordId:"unable to load",objectType:"unable to load"},children:[{type:"text",value:""}]}}]}}async function K(e){const{state:t,observationNode:a}=e,{id:r}=a.attributes;try{const e=(await t.loadMicrosoftTeams(r)).microsoftTeamsContent;t.markUniversalIdAsLoaded(r);const a={type:"microsoftTeamsMessages",tagName:"microsoft-teams-messages",attributes:{id:r,channel:e.channel},children:e.messages.map((e=>({type:"microsoftTeamsMessage",tagName:"microsoft-teams-message",attributes:{user:e.user.name},value:e.text})))};return re(t,a),[{type:"observation",observationType:"microsoft-teams",value:a}]}catch(o){return[{type:"observation",observationType:"microsoft-teams",value:{type:"microsoftTeamsMessages",tagName:"microsoft-teams-messages",attributes:{id:r,channel:"unable to load"},children:[]}}]}}async function j(e){const{state:t,observationNode:a}=e,{id:r}=a.attributes;try{const e=(await t.loadSharepoint(r)).sharepointContent;t.markUniversalIdAsLoaded(r);const a={type:"sharepoint",tagName:"sharepoint",attributes:{id:(0,i().V9)(e.driveItemId),fileType:e.fileType,title:e.title},children:e.blocks.map((e=>({type:"sharepointBlock",tagName:"sharepoint-block",value:e})))};return re(t,a),[{type:"observation",observationType:"sharepoint",value:a}]}catch(o){return[{type:"observation",observationType:"sharepoint",value:{type:"sharepoint",tagName:"sharepoint",attributes:{id:r,title:"unable to load",fileType:"unable to load"},children:[]}}]}}async function D(e){const{state:t,observationNode:a}=e,{id:r}=a.attributes;if("pdf"===a.attributes.attachmentType)return t.markAttachmentAsLoaded(r),async function(e){const{state:t,observationNode:a}=e,{id:r}=a.attributes,{pdfContent:o}=await t.loadPdf(r),n={type:"attachment",tagName:"attachment",attributes:{id:r,attachmentType:"pdf"},children:o.textContent.map((e=>({type:"attachmentContent",tagName:"attachment-content",attributes:{assistantAttachmentContentId:(0,d().Y1)()},value:e})))};return[{type:"observation",observationType:"attachment",value:n}]}({state:t,observationNode:a});(0,n().HB)(a.attributes.attachmentType)}function F(e){const{observationNode:t,state:a}=e;return"load-page"===t.tagName?E({state:a,observationNode:t}):"load-database"===t.tagName?M({state:a,observationNode:t}):"load-slack"===t.tagName?S({state:a,observationNode:t}):"load-google-drive"===t.tagName?R({state:a,observationNode:t}):"load-github"===t.tagName?U({state:a,observationNode:t}):"load-github-code"===t.tagName?O({state:a,observationNode:t}):"load-attachment"===t.tagName?D({state:a,observationNode:t}):"load-web-page"===t.tagName?$({state:a,observationNode:t}):"load-jira"===t.tagName?A({state:a,observationNode:t}):"load-microsoft-teams"===t.tagName?K({state:a,observationNode:t}):"load-sharepoint"===t.tagName?j({state:a,observationNode:t}):"load-linear"===t.tagName?q({state:a,observationNode:t}):"load-box"===t.tagName?P({state:a,observationNode:t}):"load-salesforce"===t.tagName?B({state:a,observationNode:t}):void(0,n().HB)(t)}async function L(e){const{state:t,observationNode:a}=e,{question:r,keywords:o,lookback:n}=a.attributes;return await async function(e){const{state:t,query:a}=e,r=await t.search(a);return(0,p().nt)({searchResults:r.searchResults,state:t}),[(0,p()._A)(r)]}({state:t,query:{question:r,keywords:o,lookback:n,questionIntl:a.attributes["question-intl"],database:a.attributes.database,channel:a.attributes.channel,sourcePreference:a.attributes.source,sort:a.attributes.sort,fileType:a.attributes["file-type"],contributor:a.attributes.contributor,repo:a.attributes.repo,maybeNotionHelp:"true"===a.attributes[d().HV]}})}async function H(e){const{state:t,observationNode:a}=e,{results:r,total:o}=await t.searchDatabases(a.attributes.search),n=r.map((e=>{const{id:t,title:a}=e;return{type:"collection",tagName:"database",parent:e.parentId,attributes:{id:t,title:a},persisted:!0,schemaId:e.parentId,schemas:{},properties:{}}})),i={type:"element",tagName:"search-databases-results",attributes:{"current-results":r.length.toString(),"total-results":o.toString()},children:n};return t.appendNewSearchDatabasesResult(n),[{type:"observation",observationType:"searchDatabases",value:i}]}function X(e){const{state:t,effectNode:a,useCrdt:r}=e,{id:o}=a.attributes,i=t.getBlockFromBlockIdMap(o),s=t.getIdMapper().mapKeyToCounter({type:"block",key:o});if("page"===i.tagName&&"block"===a.insertType){const e=i.children[0];return e?void X({state:t,effectNode:{type:"effect",tagName:"insert-before",insertType:"block",attributes:{id:e.attributes.id},children:a.children},useCrdt:r}):void z({state:t,effectNode:{type:"effect",tagName:"insert-inside",insertType:"block",attributes:{id:i.attributes.id},children:a.children},useCrdt:r})}if(!i.parent)throw new(l().Te)("block_has_no_parent",`Cannot <insert-before> block with id ${s} because it has no parent.`);if("block"===a.insertType){const e=i.parent,o=e.children.findIndex((e=>e.attributes.id===i.attributes.id)),n=ne({parent:e,children:a.children,state:t});if(o<0)throw new(l().Te)("block_not_found",`Cannot <insert-before> block with id ${s} as it no longer exists. Do not reference block with id ${s}.`);const{parentForOperation:d}=le({parent:e,index:o,insert:n,state:t,useCrdt:r});for(const a of n)t.addOperation({command:"insertBlockBefore",parentId:d.attributes.id,insertBlockNode:a,beforeId:i.attributes.id},void 0),"page"===a.tagName&&(t.markPageAsLoaded(a.attributes.id),t.setBlockIdMapForBlock(a.attributes.id,a))}else if("table"===a.insertType){const{name:e}=a.attributes;if("table"!==i.tagName)throw new(l().Te)("insert_before_name_not_on_table",`Cannot <insert-before> block with id ${s} with name attribute only works on tables.`);const r=Number(e);if(!Number.isInteger(r)||r<1)throw new(l().Te)("insert_before_invalid_column_index",`Invalid column index: ${r}.`);for(const t of i.children){if(!t.properties[e])throw new(l().Te)("insert_before_property_does_not_exist",`Property ${e} does not exist on table row.`)}pe({tableBlockNode:i,children:a.children,atZeroBasedIndex:r-1,state:t})}else(0,n().HB)(a)}function V(e){const{state:t,effectNode:a,useCrdt:r}=e,{id:o}=a.attributes,i=t.getIdMapper().mapKeyToCounter({type:"block",key:o}),s=t.getBlockFromBlockIdMap(o);if("page"===s.tagName&&"block"===a.insertType){const e=s.children[0];return e?void X({state:t,effectNode:{type:"effect",tagName:"insert-before",insertType:"block",attributes:{id:e.attributes.id},children:a.children},useCrdt:r}):void z({state:t,effectNode:{type:"effect",tagName:"insert-inside",insertType:"block",attributes:{id:s.attributes.id},children:a.children},useCrdt:r})}if(!s.parent)throw new(l().Te)("block_not_found",`Cannot <insert-after> block with id ${i} as it no longer exists. Do not reference block with id ${i}.`);if("block"===a.insertType){const e=s.parent,o=e.children.findIndex((e=>e.attributes.id===s.attributes.id)),n=ne({parent:e,children:a.children,state:t});if(o<0)throw new(l().Te)("block_not_found",`Cannot <insert-after> block with id ${i} as it no longer exists. Do not reference block with id ${i}.`);const{parentForOperation:d}=le({parent:e,index:o+1,insert:n,state:t,useCrdt:r}),c=[...n].reverse();for(const a of c)t.addOperation({command:"insertBlockAfter",parentId:d.attributes.id,insertBlockNode:a,afterId:s.attributes.id},void 0),"page"===a.tagName&&(t.markPageAsLoaded(a.attributes.id),t.setBlockIdMapForBlock(a.attributes.id,a))}else if("table"===a.insertType){const{name:e}=a.attributes;if("table"!==s.tagName)throw new(l().Te)("insert_after_name_not_on_table",`Cannot <insert-after> block with id ${i} using name attribute as this only works on tables.`);const r=Number(e);if(!Number.isInteger(r)||r<1)throw new(l().Te)("insert_after_invalid_column_index",`Invalid column index: ${r}.`);for(const t of s.children){if(!t.properties[e])throw new(l().Te)("insert_after_property_does_not_exist",`Property ${e} does not exist on table row.`)}pe({tableBlockNode:s,children:a.children,atZeroBasedIndex:r,state:t})}else(0,n().HB)(a)}function z(e){const{state:t,effectNode:a,useCrdt:r}=e;if("block"===a.insertType){const e=a.attributes.id,o=t.getBlockFromBlockIdMap(e),n=ne({parent:o,children:a.children,state:t}),i=o.children.length,{parentForOperation:s}=le({parent:o,index:i,insert:n,state:t,useCrdt:r});for(const a of n)t.addOperation({command:"insertBlockAfter",parentId:s.attributes.id,insertBlockNode:a},void 0),"page"===a.tagName&&(t.markPageAsLoaded(a.attributes.id),t.setBlockIdMapForBlock(a.attributes.id,a))}else if("blockIntoDatabase"===a.insertType){const e=a.attributes.id,o=t.getCollectionFromCollectionIdMap(e);if(!o)throw new Error(`No database to insert block ${a.attributes.id}`);const n=ne({parent:void 0,children:a.children,state:t,databaseSchemaId:o.schemaId});for(const a of n)ie({block:a,state:t,databaseSchemaId:o.schemaId,collectionId:o.attributes.id,useCrdt:r}),t.addOperation({command:"setBlockParent",parentId:o.schemaId,blockNode:a,collectionId:o.attributes.id},void 0),t.markPageAsLoaded(a.attributes.id),t.setBlockIdMapForBlock(a.attributes.id,a)}else if("property"===a.insertType){const e=a.attributes.id,r=t.getBlockFromBlockIdMap(e);if("child-page"!==r.tagName&&"page"!==r.tagName)throw new(l().Te)("append_properties_to_page_only","You can only append to properties on a page object.");const o=a.children[0];switch(o.tagName){case"property-relation":!function(e){var t;const{parentBlock:a,relationPropertyName:r,relationPropertyUpdates:o,state:i}=e,s=Te({propertyChild:o,parentBlock:a,propertyName:r,action:"append",state:i}),d=(0,n().O)(a.properties,r)?a.properties[r]:void 0;if("property-relation"!==(null==d?void 0:d.tagName))throw new(l().Te)("invalid_relation_property_child","Invalid property child when setting relation");for(const n of s){const e={type:"inline",tagName:"mention-page",attributes:{"page-id":n},children:[]};d.children.push(e)}i.addOperation({command:"setBlockProperty",blockNode:a,parentBlockId:null===(t=a.parent)||void 0===t?void 0:t.attributes.id,property:d},void 0)}({parentBlock:r,relationPropertyName:o.attributes.name,relationPropertyUpdates:o,state:t});break;case"property-person":de({parentBlock:r,personPropertyUpdate:o,state:t,action:"append"});break;case"property-multi-select":ce({parentBlock:r,multiSelectPropertyName:o.attributes.name,multiSelectPropertyUpdates:o,state:t,action:"append"});break;default:throw new(l().Te)("invald_child_tag_for_insert_inside","Invalid child tag for insert-inside")}}else(0,n().HB)(a)}function W(e){const{state:t,effectNode:a,useCrdt:r}=e,n=a.attributes.id,i=t.getBlockFromBlockIdMap(n),s=t.getIdMapper().mapKeyToCounter({type:"block",key:n});if(!d().sA[i.tagName].title&&"page"!==i.tagName)throw new(l().Te)("block_does_not_allow_title",`Block with id ${s} is a <${i.tagName}>, which does not allow title.`);const c=a.children;o().n4(i.text,c)||(t.addOperation({command:"setBlockText",blockNode:i,text:c},r),i.text=c)}function Y(e){const{state:t,effectNode:a}=e,{id:r,attributes:o}=a,n=t.getBlockFromBlockIdMap(r),i=Object.fromEntries(Object.entries(d().sA[n.tagName].attributes).map((([e,{values:t}])=>[e,t])));for(const{key:s,value:d}of o){const e=i[s];if(!e)throw new(l().Te)("attempted_to_set_invalid_attribute",`Attempted to set an attribute on ID ${t.getIdMapper().mapKeyToCounter({type:"block",key:r})} that is not allowed: ${s}.`);if(!0!==e&&!e.includes(d))throw new(l().Te)("attempted_to_set_invalid_attribute_value",`Attempted to set attribute on ID ${t.getIdMapper().mapKeyToCounter({type:"block",key:r})} ${s} to value that is not allowed: ${d}.`);t.addOperation({command:"setBlockAttribute",blockNode:n,attribute:s,value:d},void 0),n.attributes[s]=d}}function G(e){const{state:t,effectNode:a}=e,{id:r,newTagName:o}=a.attributes,n=t.getBlockFromBlockIdMap(r);n.tagName=o,t.addOperation({command:"setBlockTagName",blockNode:n,tagName:o},void 0)}function Q({state:e,effectNode:t}){const{actionButtons:a,children:r,uncited:o}=t,n=ne({parent:void 0,children:r,state:e}),i=n.map((e=>e.attributes.id)),s=[...n,...n.flatMap((e=>(0,u().Os)(e)))].map((e=>({command:"createBlock",blockNode:e})));e.chat({blockIds:i,operations:s,actionButtons:a,uncited:o})}function Z(e){const{state:t,effectNode:a,useCrdt:r}=e,o=ne({parent:void 0,children:a.children,state:t});if(1!==o.length)throw new(l().Te)("create_effect_no_children","<create> must have a single page block.");for(const n of o){if("page"!==n.tagName)throw new(l().Te)("create_effect_must_have_page","<create> must have a single page block.");ie({block:n,state:t,useCrdt:r}),t.addOperation({command:"addBlockToPage",blockNode:n},void 0),t.markPageAsLoaded(n.attributes.id)}}function J(e){const{state:t,effectNode:a}=e,r=a.attributes.id,o=t.getBlockFromBlockIdMap(r);if("table"!==o.tagName)throw new(l().Te)("delete_name_not_on_table","<delete> with name attribute can only be used on <table> blocks.");const n=a.attributes.name,i=Number(n);for(const s of o.children){const e=s.properties;if(1===Object.keys(e).length)throw new(l().Te)("cannot_delete_last_property",`Cannot delete property ${n} from row because it is the last property.`);if(!e[n])throw new(l().Te)("cannot_delete_nonexistent_property",`Cannot delete property ${n} from row because it does not exist.`);delete e[n];let t=i;for(;e[t+1];)e[t+1].attributes.name=t.toString(),t++}t.addOperation({command:"removeTableColumn",blockNode:o,columnIndex:i-1},void 0)}function ee(e){const{block:t,property:a}=e,r=a.attributes.name;if((0,n().O)(t.properties,r))return t.properties[r];if("property-title"===a.tagName)for(const o of(0,n().uv)(t.properties)){const e=t.properties[o];if("property-title"===e.tagName)return e}}function te(e){const{state:t,effectNode:a}=e,r=a.attributes.id,o=a.children;for(const i of o){const e=t.getBlockFromBlockIdMap(r),a=i.attributes.name;if("tr"!==e.tagName){const o=ee({block:e,property:i});if(!o){let o=`Cannot set property '${a}' on block with id=${t.getIdMapper().mapKeyToCounter({type:"block",key:r})}.`;throw Object.keys(e.properties).length>0?o+=` These are properties that can be set: ${Object.keys(e.properties).join(",")}`:o+=" When setting the property of a page inside a database, you may need to <load> first.",new(l().Te)("cannot_set_property_on_block",o)}if(o.tagName!==i.tagName)throw new(l().Te)("cannot_set_property_to_different_type",`Attempted to set a property to a different tag name: ${o.tagName} -> ${i.tagName}.`)}var n;if("property-relation"===i.tagName)oe({block:e,propertyName:a,state:t,newPropertyValue:i});else"property-select"===i.tagName||"property-multi-select"===i.tagName||"property-status"===i.tagName?ve({newPropertyValue:i,parentBlock:e,propertyName:a,state:t}):"property-number"===i.tagName?he({newPropertyValue:i}):"property-date"===i.tagName&&fe({newPropertyValue:i}),e.properties[a]=i,t.addOperation({command:"setBlockProperty",blockNode:e,parentBlockId:null===(n=e.parent)||void 0===n?void 0:n.attributes.id,property:i},void 0)}}function ae(e,t){const a=[t],r=new Set;let o;for(;o=a.pop();)r.has(o.attributes.id)||(e.setSchemaIdMapForSchemaIfNotExists(o.schemaId,o.schemas),e.setBlockIdMapForBlock(o.attributes.id,o),"database-views"!==o.tagName&&a.push(...o.children),r.add(o.attributes.id))}function re(e,t){e.setUniversalIdMapForUniversalNode(t.attributes.id,t)}function oe(e){var t;const{block:a,propertyName:r,state:o,newPropertyValue:n}=e;Te({propertyChild:n,parentBlock:a,propertyName:r,state:o,action:"overwrite"}),a.properties[r]=n,o.addOperation({command:"setBlockProperty",blockNode:a,parentBlockId:null===(t=a.parent)||void 0===t?void 0:t.attributes.id,property:n},void 0)}function ne(e){const{state:t,children:a,databaseSchemaId:r,parent:o}=e;return a.map((e=>Ne({state:t,parsedBlock:e,parent:o,databaseSchemaId:r})))}function ie(e){const{block:t,state:a,databaseSchemaId:r,collectionId:o,useCrdt:n}=e;if(!t.persisted&&"database-views"!==t.tagName){r&&o?a.addOperation({command:"createBlock",blockNode:t,databaseSchemaId:r,collectionId:o},n):a.addOperation({command:"createBlock",blockNode:t},n),t.persisted=!0;for(const e of t.children)ie({block:e,state:a,useCrdt:n})}}function se(e){const{parent:t,state:a}=e;if("synced-block-reference"===t.tagName){if(!t.attributes["synced-block-id"])throw new(l().Te)("invalid_synced_block_reference","Synced block reference missing synced-block-id!");return a.getBlockFromBlockIdMap(t.attributes["synced-block-id"])}return t}function le(e){const{parent:t,index:a,insert:r,state:o,useCrdt:n}=e,i=Array.isArray(r)?r:[r],s=se({parent:t,state:o}),c=d().sA[s.tagName].content,p=i.map((e=>e.tagName));for(const d of p)if(!c.includes(d)){if("child-page"===t.tagName)throw new(l().Te)("invalid_insert",`You attempted to insert a ${d} inside a child-page, which is invalid. You may have wanted to insert this ${d} in a database instead.`);throw new(l().Te)("invalid_insert",`You attempted to insert a ${d} inside ${t.tagName}. ${c.length>0?`${t.tagName} allows only children of type ${c.join(", ")}`:`${t.tagName} is not allowed children of any type.`}`)}for(let d=i.length-1;d>=0;d--){const e=i[d];if("block"!==e.type)throw new(l().Te)("cannot_insert_non_block_node","Cannot insert a non-block node.");e.parent=s,s.children.splice(a,0,e),ie({block:e,state:o,useCrdt:n})}return{parentForOperation:s}}function de(e){var t;const{parentBlock:a,personPropertyUpdate:r,state:i,action:s}=e,d=r.attributes.name,c=(0,n().O)(a.properties,d)?a.properties[d]:void 0;if("property-person"!==(null==c?void 0:c.tagName))throw new(l().Te)("invalid_person_property_child","Invalid property child when appending to person property");const p=function(e){const{propertyChild:t,parentBlock:a,propertyName:r,state:i,action:s}=e,d=t.children.filter((e=>"mention-person"===e.tagName)).map((e=>e.attributes["person-id"])),c=i.getSchemaFromSchemaIdMapIfExists(a.schemaId);if(!c)throw new(l().Te)("schema_not_found",`Database ${a.schemaId} was not found. You may need to use load-database to load it first.`);if(!(0,n().O)(c,r))throw new(l().Te)("cannot_update_nonexistent_property","Invalid schema for person property");const p=c[r];if("schema-property-person"!==p.tagName)throw new(l().Te)("invalid_schema_for_person_property","Invalid property schema for property person");const u=p.attributes.limit;switch(s){case"overwrite":if(d.length>1&&"1"===u)throw new(l().Te)("cannot_set_too_many_people_for_person_property","Tried to set too many people for person property with limit 1");return d;case"append":{const e=a.properties[r].children.filter((e=>"mention-person"===e.tagName)).map((e=>e.attributes["person-id"])),t=o().sb([...d,...e]);if(t.length>1&&"1"===u)throw new(l().Te)("cannot_set_too_many_people_for_person_property","Tried to set too many people for person property with limit 1");return t}case"delete":{const e=a.properties[r].children.filter((e=>"mention-person"===e.tagName)).map((e=>e.attributes["person-id"]));return o().R9(e,d)}default:(0,n().HB)(s)}}({propertyChild:r,parentBlock:a,propertyName:d,state:i,action:s}),u=[];for(const o of p){const e={type:"inline",tagName:"mention-person",attributes:{"person-id":o,"person-name":void 0},children:[]};u.push(e)}c.children=u,i.addOperation({command:"setBlockProperty",blockNode:a,parentBlockId:null===(t=a.parent)||void 0===t?void 0:t.attributes.id,property:c},void 0)}function ce({parentBlock:e,multiSelectPropertyName:t,multiSelectPropertyUpdates:a,state:r,action:s}){var d;const c=function(e){const{propertyChild:t,parentBlock:a,propertyName:r,action:i}=e,s=t.children.map((e=>e.attributes.option));switch(i){case"overwrite":return s;case"append":{if(!(0,n().O)(a.properties,r))throw new(l().Te)("cannot_append_to_nonexistent_property",`"${r}" missing from properties`);const e=a.properties[r].children.map((e=>e.attributes.option));return o().sb([...s,...e])}case"delete":{if(!(0,n().O)(a.properties,r))throw new(l().Te)("cannot_delete_from_nonexistent_property",`"${r}" missing from properties`);const e=a.properties[r].children.map((e=>e.attributes.option));return o().R9(e,s)}default:(0,n().HB)(i)}}({propertyChild:a,parentBlock:e,propertyName:t,action:s}),p=[];for(const o of c){const e={type:"inline",tagName:"option",attributes:{option:(0,i().V9)(o)},children:[]};p.push(e)}const u=(0,n().O)(e.properties,t)?e.properties[t]:void 0;if("property-multi-select"!==(null==u?void 0:u.tagName))throw new(l().Te)("invalid_multi_select_property_child","Invalid property child when updating multi-select");u.children=p,ve({state:r,propertyName:t,newPropertyValue:u,parentBlock:e}),r.addOperation({command:"setBlockProperty",blockNode:e,parentBlockId:null===(d=e.parent)||void 0===d?void 0:d.attributes.id,property:u},void 0)}function pe(e){const{tableBlockNode:t,children:a,atZeroBasedIndex:r,state:o}=e;let i=r+1;const s=[];for(const c of a){if("move"===c.type){const e=c.attributes.name;if(!e)throw new(l().Te)("move_inside_insert_requires_name_attribute","<move> inside <insert-X> with name attribute requires name attribute.");for(const a of t.children){if((0,d().gc)(a))throw new Error(`Invalid table operation for block node: ${a.tagName}`);const t=a.properties;if(!(0,n().O)(t,e))throw new(l().Te)("move_inside_insert_property_does_not_exist",`Property ${e} does not exist on table row.`)}if(s.includes(e))throw new(l().Te)("cannot_move_property_more_than_once",`Cannot move property ${e} more than once.`);s.push(e)}else if("schema"===c.type){if(c.attributes.name!==i.toString())throw new(l().Te)("insert_inside_insert_requires_properties_in_order","<insert-X> with name attribute requires properties to be in order.")}else(0,n().HB)(c);i++}for(const c of t.children){if((0,d().gc)(c))throw new Error(`Invalid table operation for block node: ${c.tagName}`);const e=Object.values(c.properties).filter((e=>!s.includes(e.attributes.name))).sort(((e,t)=>Number(e.attributes.name)-Number(t.attributes.name))),t=e.map((e=>Number(e.attributes.name))),o=t.indexOf(Math.max(...t.filter((e=>e<r+1))))+1,i=Object.fromEntries([...e.slice(0,o),...a.map((e=>{if("move"===e.type){if((0,n().O)(c.properties,e.attributes.name))return c.properties[e.attributes.name];throw new(l().Te)("property_missing_in_table_row",`"${e.attributes.name}" was missing in table row node properties`)}if("schema"===e.type){return{type:"property",tagName:"property-text",attributes:{name:e.attributes.name},children:[]}}(0,n().HB)(e)})),...e.slice(o)].map(((e,t)=>{const a=t+1;return[a,{...e,attributes:{...e.attributes,name:a.toString()}}]})));c.properties=i}o.addOperation({command:"insertOrMoveTableColumns",blockNode:t,atIndex:r,insertOrMoves:a},void 0)}function ue(e){const{remove:t,state:a}=e;for(const r of t){if(!r.parent)throw new(l().Te)("cannot_remove_block_without_parent",`Cannot remove block with id=${a.getIdMapper().mapKeyToCounter({type:"block",key:r.attributes.id})} because it has no parent.`);const e=se({parent:r.parent,state:a});if("child-page"===r.tagName&&"database-views"===r.parent.tagName)a.addOperation({command:"removeBlock",parentId:e.attributes.id,removeBlockNode:r},void 0);else{const t=e.children.findIndex((e=>e.attributes.id===r.attributes.id));if(t<0)throw new(l().Te)("cannot_remove_block_without_parent",`Cannot remove block with id=${a.getIdMapper().mapKeyToCounter({type:"block",key:r.attributes.id})} because it has no parent.`);a.addOperation({command:"removeBlock",parentId:e.attributes.id,removeBlockNode:r},void 0),r.parent.children.splice(t,1)}}}const me=/^\s*[+-]?(\d+|\d*\.\d+|\d+\.\d*)([Ee][+-]?\d+)?\s*$/;function he(e){const{newPropertyValue:t}=e;if(t.attributes.number&&!me.test(t.attributes.number))throw new(l().Te)("invalid_number_format","Invalid value for number property")}const ge=/\d{4}-\d{2}-\d{2}/,ye=/\d{2}:\d{2}/;function be(e){const{date:t,time:a}=e;if(!ge.test(t))throw new(l().Te)("invalid_date_format","Invalid date for date property: incorrect format");if(a&&!ye.test(a))throw new(l().Te)("invalid_time_format","Invalid time for date property: incorrect format");let o;const n=e.timeZone?{zone:e.timeZone}:void 0;if(o=a?r().DateTime.fromFormat(`${t}T${a}`,"yyyy-MM-dd'T'HH:mm",n):r().DateTime.fromFormat(`${t}`,"yyyy-MM-dd"),!o.isValid)throw new(l().Te)("invalid_date_format","Invalid date for date property");return o}function fe(e){const{newPropertyValue:t}=e;if(0===t.children.length)return;if(t.children.length>1)throw new(l().Te)("invalid_date_format","Invalid value for date property. Expected only 1 child.");const[a]=t.children;if("mention-date"===a.tagName)be({date:a.attributes.date});else if("mention-datetime"===a.tagName)be({date:a.attributes.date,time:a.attributes.time});else if("mention-date-range"===a.tagName){const e=be({date:a.attributes["start-date"]}),t=be({date:a.attributes["end-date"]});if(e.valueOf()>t.valueOf())throw new(l().Te)("invalid_date_range","Invalid date range: start must be before end")}else if("mention-datetime-range"===a.tagName){const e=be({date:a.attributes["start-date"],time:a.attributes["start-time"]}),t=be({date:a.attributes["end-date"],time:a.attributes["end-time"]});if(e.valueOf()>t.valueOf())throw new(l().Te)("invalid_date_range","Invalid date range: start must be before end")}else(0,n().HB)(a)}function ve(e){const{newPropertyValue:t,parentBlock:a,propertyName:r,state:o}=e,n=o.getSchemaFromSchemaIdMapIfExists(a.schemaId);if(!n)throw new(l().Te)("schema_not_found",`Database ${a.schemaId} was not found. You may need to use load-database to load it first.`);const i=n[r];if(!i||i.tagName!==`schema-${t.tagName}`)throw new(l().Te)("invalid_schema_for_property","Invalid schema for block. You may need to use load-database to load the database schema first.");const s=new Set;for(const l of i.children)if("schema-option"===l.tagName&&s.add(l.attributes.option),"schema-option-category"===l.tagName)for(const e of l.children)s.add(e.attributes.option);for(const d of t.children)if(!s.has(d.attributes.option))throw new(l().Te)("invalid_option_value",`Invalid option value: ${d.attributes.option}`);if("property-multi-select"!==t.tagName&&t.children.length>1)throw new(l().Te)("invalid_option_value","Invalid option value: limited to 1 option")}function Te(e){const{propertyChild:t,parentBlock:a,propertyName:r,state:o,action:i}=e,s=o.getSchemaFromSchemaIdMapIfExists(a.schemaId);if(!s)throw new(l().Te)("schema_not_found",`Database ${a.schemaId} was not found. You may need to use load-database to load it first.`);const d=t.children.map((e=>e.attributes["page-id"]));if("page"!==a.tagName&&"child-page"!==a.tagName)throw new(l().Te)("cannot_set_relation_property_on_non_page","Attempted to set relation property on a block that isn't a page");const c=a.properties[r];if(!c)throw new(l().Te)("cannot_set_relation_property_on_nonexistent_property",`There is no relation property named ${r}`);if("property-relation"!==c.tagName)throw new(l().Te)("cannot_set_relation_property_on_non_relation_property",`The ${r} property is not a relation`);const p=c.attributes["database-id"];if(!p)throw new(l().Te)("cannot_set_relation_property_on_nonexistent_database","Attempted to set relation property on a page that's not in a database");const u=s[r];if(!u||"schema-property-relation"!==u.tagName)throw new(l().Te)("invalid_schema_for_property","Invalid schema for block");const m=o.getCollectionFromCollectionIdMap(p);if("database"!==(null==m?void 0:m.tagName))throw new(l().Te)("ivalid_database_id_for_relation_property","Invalid database id for relation property");const h=o.getPageIdToBlockIdMap();for(const n of d){const e=h.get(n);if(!e)throw new(l().Te)("invalid_page_id_for_mention",`Invalid page id: ${n}`);if(o.getBlockFromBlockIdMap(e).schemaId!==m.schemaId)throw new(l().Te)("invalid_page_id_for_relation","Invalid page id for relation")}switch(i){case"overwrite":if("1"===u.attributes.limit&&d.length>1)throw new(l().Te)("cannot_set_too_many_pages_for_relation_property","Too many mentioned page ids for a relation field with limit 1");return d;case"append":{const e=a.properties[r];if("property-relation"!==e.tagName)throw new(l().Te)("invalid_relation_property_child","Invalid property child when setting relation");const t=new Set(e.children.map((e=>e.attributes["page-id"])));if(d.forEach(t.add,t),t.size>1&&"1"===u.attributes.limit)throw new(l().Te)("cannot_set_too_many_pages_for_relation_property",`Too many mentioned page ids for a relation field with limit ${u.attributes.limit}`);return d}case"delete":{const e=a.properties[r];if("property-relation"!==e.tagName)throw new(l().Te)("invalid_relation_property_child","Invalid property child when setting relation");const t=new Set(e.children.map((e=>e.attributes["page-id"])));for(const a of d)if(!t.has(a))throw new(l().Te)("cannot_delete_page_id_not_in_relation","Attempting to delete pageId not contained in relation.");return d}default:(0,n().HB)(i)}}function ke(e){const{parsedBlock:t,persisted:a,parent:r,databaseSchemaId:o}=e;return(0,d().g5)(t.tagName),{tagName:t.tagName,type:"block",persisted:a,attributes:t.attributes,text:t.text,properties:t.properties,schemas:t.schemas,children:[],parent:r,schemaId:o??t.attributes.id}}function Ne(e){const{state:t,parsedBlock:a,parent:r,databaseSchemaId:o}=e;if("move"===a.type){const e=t.getBlockFromBlockIdMap(a.attributes.id);if(!r)throw new(l().Te)("cannot_move_block_without_parent","Parentless move node");return function(e){const{move:t,state:a,moveToParent:r}=e;for(const o of t){const e=a.getBlockFromBlockIdMap(o.attributes.id),t=a.getIdMapper().mapKeyToCounter({type:"block",key:e.attributes.id});if(!o.parent)throw new(l().Te)("cannot_move_block_without_parent",`Cannot move block without parent on block with id=${t}.`);a.addOperation({command:"moveBlock",parentId:r.attributes.id,oldParentId:o.parent.attributes.id,blockNode:o},void 0);const n=se({parent:o.parent,state:a}).children.findIndex((e=>e.attributes.id===o.attributes.id));if(n<0)throw new(l().Te)("cannot_move_block_without_parent",`Cannot move block without parent on block with id=${t}.`);o.parent.children.splice(n,1),o.parent=r}}({move:[e],state:t,moveToParent:r}),e}if(t.doesBlockIdMapHaveBlock(a.attributes.id)&&!(0,m().zQ)(a.tagName))return t.getBlockFromBlockIdMap(a.attributes.id);const n=ke({parsedBlock:a,persisted:!1,parent:r,databaseSchemaId:o});for(const i of a.children)n.children.push(Ne({state:t,parsedBlock:i,parent:n,databaseSchemaId:o}));return t.setBlockIdMapForBlock(n.attributes.id,n),t.setSchemaIdMapForSchema(n.schemaId,n.schemas),n}function we(e){const{node:t,mapCounterToKey:a}=e;return function e(t,a){const r=ke({parsedBlock:t,parent:a,persisted:!0,databaseSchemaId:void 0});for(const o of t.children){if("move"===o.type)throw new(l().Te)("unexpected_move_node","Unexpected move node");r.children.push(e(o,r))}return r}((0,s().AZ)((0,m().V8)({allowMove:!1,allowUncited:!0,persisted:!0,mapCounterToKey:a}),t),void 0)}const xe={version:h,context:{mode:"shared","available-commands":_},selection:void 0,loadedPageIds:[],schemaIdMap:{},peopleIdMap:{},blockIdMap:{},idMapper:{keyMap:[]},collectionIdMap:{},loadedDatabaseIds:[],loadedUniversalIds:[],universalIdMap:{},universalSearchResultPayloadMap:{},loadedAttachmentIds:[]}},381414:(e,t,a)=>{"use strict";a.d(t,{QK:()=>i});a(898992),a(672577),a(430670),a(581454);var r=()=>a(534177),o=()=>a(638681);o().array(o().string());const n=["auto_increment_id","formula","location","rollup","created_by","last_edited_by","last_visited_time","button","verification"];function i(e){return!!(0,r().Xk)(n,e)}},412412:(e,t,a)=>{"use strict";a.d(t,{BD:()=>l,PJ:()=>s,UB:()=>n,_o:()=>i});a(581454);var r=()=>a(736192),o=(r(),()=>a(496603));function n(e){return"element"===e.type}function i(e,t=!1,a=0,r=!1){let n="";if(t){n+="\n";for(let e=0;e<a;e++)n+="\t"}if("text"===e.type)n+=r?o().ih(e.value):e.value;else{n+=`<${e.tagName}`;for(const[t,a]of Object.entries(e.attributes||{}))n+=` ${t}="${a}"`;if(e.children&&e.children.length>0){n+=">";for(const o of e.children)n+=i(o,t,a+1,r);if(t){n+="\n";for(let e=0;e<a;e++)n+="\t"}n+=`</${e.tagName}>`}else n+="/>"}return n}function s(e){return e.map((e=>i(e))).join("")}function l(e,t=!1,a){const n=(0,r().parse)(e,a);return o().oE(n.childNodes.map((e=>d(e,t))))}function d(e,t=!1){if(e&&"object"==typeof e&&"nodeType"in e){if(e.nodeType===r().NodeType.TEXT_NODE){if(!("textContent"in e)||"string"!=typeof e.textContent)return;return{type:"text",value:t?o().x4(e.textContent):e.textContent}}if(e.nodeType===r().NodeType.ELEMENT_NODE){if(!("tagName"in e)||"string"!=typeof e.tagName)return;const a=e.attributes,r=e.childNodes;return{type:"element",tagName:e.tagName.toLowerCase(),attributes:a||{},children:o().oE(null==r?void 0:r.map((e=>d(e,t))))||[]}}}}},462294:(e,t,a)=>{"use strict";a.d(t,{O:()=>r});a(16280),a(944114);class r extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="google-calendar",this.displayName="Google Calendar",this.requiresUserAuth=!1,this.featureGate="google_calendar_ai_connector",this.category="vectorless",this.parentOrganization="Google",this.fileTypes=[],this.qnaIngestionAIAppId="57bdd966-95fa-4586-ab89-c76454713dd0",this.urlRegex=/https:\/\/(?:www\.)?google\.com\/calendar\/event\?eid=[^&]+/}getTitle(e){throw new Error("GoogleCalendarDriver.getTitle() is not implemented")}getText(e){throw new Error("GoogleCalendarDriver.getText() is not implemented")}getSearchResultXMLTagName(){return"google-calendar-result"}addSearchResultToXML(e,t){if("google-calendar"!==e.type)throw new Error(`Expected google-calendar result, got result.type=${e.type}`);t.push({type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.id,title:e.title},children:[{type:"text",value:e.text}]})}mapObservationResultNode(e){const{node:t,idMapper:r,idToCounter:o}=e;if("google-calendar-result"!==t.tagName)return t;const n=r.mapKeyToCounter({type:"google-calendar",key:(0,a(902006).V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n,title:t.attributes.title}}}}},491810:(e,t,a)=>{"use strict";a.d(t,{D:()=>d});var r=()=>a(973647),o=()=>a(534177),n=()=>a(251582),i=()=>a(252050),s=()=>a(228803),l=()=>a(331119);function d(e){const t=(0,o().s8)(i().U4,((t,a)=>function(e,t){const a=i().U4[e],{mapCounterToKey:o}=t;return n().p.mapResult((0,l().U5)(e),(t=>{const i=(0,l().ke)({inputAttributes:t.attributes,definitions:{...a.attributes,name:{required:!0,values:!0},description:{required:!1,values:!0}},tagName:e,mapCounterToKey:o});if(r().Q.isFail(i))return i;const d=(0,n().$d)(n().p.manyTill((0,s().Et)({inlineNodesAllowed:a.inline,textAllowed:!1,parentTagName:e,mapCounterToKey:o}),n().p.eof()),t.children??[]);if(r().Q.isFail(d))return d;const c=d.value;return{value:{type:"schema",tagName:e,attributes:i.value,children:c}}}))}(a,e)));return t}},510818:(e,t,a)=>{"use strict";a.d(t,{MJ:()=>b,Mw:()=>g,Pm:()=>h,WF:()=>T,dR:()=>N,e_:()=>m,rf:()=>k,sX:()=>f,tm:()=>y,vb:()=>I});a(16280),a(18107),a(944114),a(517642),a(658004),a(733853),a(845876),a(432475),a(515024),a(731698),a(967357),a(898992),a(823215),a(354520),a(672577),a(430670),a(803949),a(581454);var r=()=>a(496603),o=()=>a(973647),n=()=>a(534177),i=()=>a(939768),s=()=>a(412412),l=()=>a(179034),d=()=>a(798880),c=()=>a(201980),p=()=>a(24279),u=()=>a(252050);function m(e){const t=[],a=/<\/?([a-zA-Z0-9_-]+)(?:\s[^>]*)?>/g;let r,o=e.replace(/<[^>]+$/,"").replace(/<[^>]+\/$/,"");for(;r=a.exec(o);){const e=r[1],a=r[0];a.startsWith("</")?t.length>0&&t[t.length-1]===e&&t.pop():a.endsWith("/>")||t.push(e)}for(;t.length;)o+=`</${t.pop()}>`;return o}function h(e,t=!1){return e.replace(/[<>]/g,(e=>{switch(e){case"<":return"&lt;";case">":return"&gt;";case'"':return t?"&quot;":e;case"'":return t?"&apos;":e;case"&":return t?"&amp;":e;default:throw new Error(`Invalid match: "${e}"`)}}))}function g(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">")}r().Bj((()=>[...a(353566).Eo,...Object.keys(u().sA),...Object.keys(u()._S),...Object.keys(u().GU),...Object.keys(u().U4),...Object.keys(u().RD)]));function y(e){return e.replace(/<(code|code-block)(?:\s([^>]*))?>([\s\S]*?)<\/\1>/g,((e,t,a,r)=>`<${t}${a?` ${a}`:""}>${r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}</${t}>`))}function b(e){const t=[],a=[...e];let r;for(;r=a.pop();){if("collection"===r.type)for(const e of Object.values(r.schemas))if("schema-property-relation"===e.tagName){const a=e.attributes["database-id"];t.push(a)}if("child-page"===r.tagName){for(const e of Object.values(r.properties))if("property-relation"===e.tagName){const a=e.attributes["database-id"];(0,n().O9)(a)&&t.push(a)}}else if("child-database"===r.tagName||"database"===r.tagName){for(const e of Object.values(r.schemas))if("schema-property-relation"===e.tagName){const a=e.attributes["database-id"];t.push(a)}}else if(r.children)for(const e of r.children)(0,u().gc)(e)||a.push(e)}return t}function f(e){const t=[],a=[e];let r;for(;r=a.pop();){if("synced-block-reference"===r.tagName){if(!r.attributes["synced-block-id"])throw new Error("Synced block reference missing synced-block-id");t.push(r.attributes["synced-block-id"])}if(r.children)for(const e of r.children)(0,u().gc)(e)||a.push(e)}return t}function v(e,t){if(t(e),"block"===e.type){if(e.text)for(const a of e.text)v(a,t);if(e.children)for(const a of e.children)v(a,t)}else if("inline"===e.type){if(e.children)for(const a of e.children)v(a,t)}else if("property"===e.type&&e.children)for(const a of e.children)v(a,t)}function T(e){const t=e.getTranscript().filter(p().h7),a=e.state.getIdMapper();return t.flatMap((e=>{const t=(0,s().BD)(e.value)[0];return"element"===(null==t?void 0:t.type)&&"search-results"===t.tagName&&t.children?r().oE(t.children.map((e=>{var t;if("element"===e.type&&"page"===e.tagName&&null!==(t=e.attributes)&&void 0!==t&&t.id)return o().Q.unwrap(a.mapCounterToKeyInMode(e.attributes.id,"block_counter"))}))):[]}))}async function k(e){const{value:t,loadRecordModel:a}=e,r=(0,c().RQ)(t);let o="";for(const n of r){const e=n[0],t=(0,c().uPN)(n);e===c().Sj||(0,c().GiG)(n)||(o+=e);for(const r of t){if((0,c().rie)(r)){const e=(0,c().NcG)(r),t=await a({table:d().oo,id:e});o+=null==t?void 0:t.getName()}if((0,c().qsB)(r))o+=(0,c().YhW)(r);else if((0,c().sh$)(r)){const e=(0,c().cQR)(r),t=i().qg(e);o+=` ${t.hostname||""}${t.pathname||""} `}else if((0,c().gir)(r))o+=(0,c().U35)(r);else if((0,c().jIt)(r)){const e=(0,c().v55)(r),t=await a({table:l().ev,id:e});o+=(0,c().k4p)(null==t?void 0:t.getProperties().title)}}}return o}function N(e){const{pageIds:t,evaluator:a,loadInlineDatabases:o}=e,n=Array.from(a.state.getLoadedDatabaseIds()),i=r().sb(t.flatMap((e=>{const t=a.state.getBlockFromBlockIdMap(e);if(t&&"database-views"===t.tagName){const e=t.children.find((e=>"database-view"===e.tagName));if(e&&e.attributes["database-id"])return[e.attributes["database-id"]]}const r=new Set,n=o?3:0;return v(t,(e=>{if(!(r.size>=n)&&"database-view"===e.tagName){const t=e.attributes["database-id"];t&&r.add(t)}})),[...r]})));return r().R9(i,n)}const w="dateRangeFilter";function x(e,t){if(!(0,n().O)(e,t))return!0;const a=e[t];if(!a)return!0;if(Array.isArray(a)&&0===a.length)return!0;if(t===w&&void 0!==e[w]){const t=e[w];return void 0===t.startDate&&void 0===t.endDate}return!1}function I(e,t){const a=new Set([...(0,n().uv)(e),...(0,n().uv)(t)]);return Array.from(a).every((a=>!(!x(e,a)||!x(t,a))||!(!(0,n().O)(e,a)||!(0,n().O)(t,a))&&r().n4(e[a],t[a])))}},515870:(e,t,a)=>{"use strict";a.d(t,{o:()=>r});a(16280),a(944114),a(898992),a(672577);class r extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="github",this.displayName="GitHub",this.requiresUserAuth=!0,this.featureGate="ai_connector_unification_github",this.category="vector",this.parentOrganization=null,this.fileTypes=["code","pull-request","issue"],this.qnaIngestionAIAppId="86ac6e3c-8ca9-4aab-9a25-fea9a0a1af57",this.urlRegex=/^github:\/\/.+/}getTitle(e){if("github"===e.type)return e.title||"";if("githubCode"===e.type)return e.codePath||"";throw new Error(`Expected github or githubCode resource, got resource.type=${e.type}`)}getText(e){var t;if("github"===e.type)return(null===(t=e.blocks)||void 0===t?void 0:t.join("\n"))||"";if("githubCode"===e.type)return e.content||"";throw new Error(`Expected github or githubCode resource, got resource.type=${e.type}`)}getTranscriptAttributes(e){if("github"!==e.type)throw new Error(`Expected github result, got result.type=${e.type}`);return{"file-type":e.fileType,author:e.authorName,status:e.statusTag,"repo-name":e.githubRepoName,path:e.path}}buildSearchResult(e){const{result:t,baseAttributes:a}=e;return"github"!==t.type?super.buildSearchResult(e):{attributes:{...a,"file-type":t.fileType??"",...t.authorName?{"author-name":t.authorName}:{},...t.path.length>0?{path:t.path}:{},...t.statusTag?{status:t.statusTag}:{},...t.githubRepoName?{"repo-name":t.githubRepoName}:{}},children:[{type:"text",value:t.text}]}}getSearchResultXMLTagName(){return"github-result"}addSearchResultToXML(e,t){if("github"!==e.type)throw new Error(`Expected github result, got result.type=${e.type}`);let a=t.find((t=>"github-result"===t.tagName&&t.attributes.id===e.pageId));a||(a={type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.pageId,title:e.title,"file-type":e.fileType,author:e.authorName,status:e.statusTag,"repo-name":e.githubRepoName},children:[]},t.push(a)),a.children.push({type:"text",value:e.text})}mapObservationResultNode(e){const{node:t,idMapper:r,idToCounter:o}=e;if("github-result"!==t.tagName)return t;const n=r.mapKeyToCounter({type:"github",key:(0,a(902006).V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n}}}}},525704:(e,t,a)=>{"use strict";a.d(t,{M:()=>i,Y:()=>n});a(581454);var r=()=>a(251582),o=()=>a(331119);function n(e){return r().p.map((0,o().RB)({tagName:"move",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"move",tagName:"move",attributes:e,children:[]})))}function i(e){return r().p.map((0,o().RB)({tagName:"move",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"block_counter"},name:{required:!0,values:!0}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"move",tagName:"move",attributes:e,children:[]})))}},532058:(e,t,a)=>{"use strict";a.d(t,{v:()=>r});a(16280),a(944114);class r extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="asana",this.displayName="Asana",this.requiresUserAuth=!0,this.featureGate="asana_qna",this.category="vector",this.parentOrganization=null,this.fileTypes=["task","project"],this.qnaIngestionAIAppId="4f25cc1a-6b2e-4e94-a67b-8e4d7f2c9abc",this.urlRegex=/https:\/\/app\.asana\.com\/\d+\/(?<workspaceId>\d+)\/project\/(?<projectId>\d+)\/task\/(?<taskId>\d+)/}getTitle(e){if("asana"!==e.type)throw new Error(`Expected asana resource, got resource.type=${e.type}`);return e.title}getText(e){if("asana"!==e.type)throw new Error(`Expected asana resource, got resource.type=${e.type}`);return`<mentioned-asana type="${e.type}" title="${e.title}">\n${e.blocks.join("\n")}\n</mentioned-asana>`}buildSearchResult(e){const{result:t,baseAttributes:a}=e;return"asana"!==t.type?super.buildSearchResult(e):{attributes:{...a,entity:t.entity,...t.taskId?{entityId:t.taskId}:{},...t.assignee?{assignee:t.assignee}:{},..."task"===t.entity?{project:t.project}:{},team:t.team,workspace:t.workspace},children:[{type:"text",value:t.text}]}}getSearchResultXMLTagName(){return"asana-result"}addSearchResultToXML(e,t){if("asana"!==e.type)throw new Error(`Expected asana result, got result.type=${e.type}`);t.push({type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.id,title:e.title,project:e.project,assignee:e.assignee,workspace:e.workspace,entity:e.entity,"last-edited-datetime":e.lastEdited,"task-id":e.taskId},children:[{type:"text",value:e.text}]})}mapObservationResultNode(e){const{node:t,idMapper:r,idToCounter:o}=e;if("asana-result"!==t.tagName)return t;const n=r.mapKeyToCounter({type:"asana",key:(0,a(902006).V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n}}}}},540192:(e,t,a)=>{"use strict";a.d(t,{o:()=>r});class r{buildSearchResult(e){const{result:t,baseAttributes:a}=e;return{attributes:a,children:[{type:"text",value:t.text}]}}buildCitationInfo(e){const{searchResult:t,searchResultUnmappedId:r,searchResultWithExtraInfo:o,number:n}=e,i=a(832443).tD.parseAssistantHref(r);if(!i)return;const s=t.text,l=t.title;return"webpage"===i.type&&(o.url=i.url),{searchResultWithExtraInfo:o,citationType:"universal_search",target:this.type,href:r,title:l,text:s,number:n,...i}}buildAgentSearchResultFromAutosearchResult(e){return"slack"===e.type?{searchSourceType:"slack",id:e.id,title:e.title,channel:e.path,text:e.snippet,lastEdited:e.lastEdited}:"gmail"===e.type?{searchSourceType:"gmail",id:e.id,title:e.title,path:e.path,lastEdited:e.lastEdited}:"salesforce"===e.type?{searchSourceType:"salesforce",id:e.id,title:e.title,path:e.path,lastEdited:e.lastEdited,objectType:""}:{searchSourceType:e.type,id:e.id,title:e.title,path:e.path,lastEdited:e.lastEdited}}}},602264:(e,t,a)=>{"use strict";a.d(t,{h:()=>o});a(16280),a(944114);var r=()=>a(902006);class o extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="jira",this.displayName="Jira",this.requiresUserAuth=!1,this.featureGate="jira_qna_ingestion_v2",this.category="vector",this.parentOrganization=null,this.fileTypes=["issue"],this.qnaIngestionAIAppId="c1f230b1-6635-4ab0-a3f5-f7eb105a87c3",this.urlRegex=r().t_}getTitle(e){if("jira-issue"!==e.type)throw new Error(`Expected jira-issue resource, got resource.type=${e.type}`);return e.title}getText(e){if("jira-issue"!==e.type)throw new Error(`Expected jira-issue resource, got resource.type=${e.type}`);return`<mentioned-jira type="${e.type}" title="${e.title}">\n${e.text}\n</mentioned-jira>`}getSearchResultXMLTagName(){return"jira-result"}addSearchResultToXML(e,t){if("jira"!==e.type)throw new Error(`Expected jira result, got result.type=${e.type}`);t.push({type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.id,title:e.title,"last-edited-datetime":e.lastEdited,project:e.path},children:[{type:"text",value:e.text}]})}mapObservationResultNode(e){const{node:t,idMapper:a,idToCounter:o}=e;if("jira-result"!==t.tagName)return t;const n=a.mapKeyToCounter({type:"jira",key:(0,r().V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n}}}}},706461:(e,t,a)=>{"use strict";a.d(t,{dK:()=>s,sD:()=>p,uS:()=>i});a(16280),a(944114),a(898992),a(430670),a(803949);var r=()=>a(496603),o=()=>a(534177),n=()=>a(252050);const i="\x3c!--<selection>--\x3e",s="\x3c!--</selection>--\x3e";function l(e){const{node:t,selection:a,path:p,onlyAllowPropertyTypes:u,namespace:m}=e;if(p.includes(t))throw new Error("Circular reference detected!");const h=[...p,t],g=[];if("text"===t.type)for(const y of t.value)g.push(y);else{let b="";b+=`<${t.tagName}`;for(const[v,T]of Object.entries(t.attributes||{}))void 0!==T&&(b+=` ${v}="${T}"`);const f=`</${t.tagName}>`;if("block"===t.type){const k="block"===t.type&&"block"===(null==a?void 0:a.type)&&a.blockIds[0]===t.attributes.id,N="block"===t.type&&"block"===(null==a?void 0:a.type)&&a.blockIds[a.blockIds.length-1]===t.attributes.id,w="block"===t.type&&"text"===(null==a?void 0:a.type)&&(a.start.blockId===t.attributes.id||a.end.blockId===t.attributes.id);k&&g.push(i);if(0===t.text.length&&0===Object.values(t.properties).length&&0===Object.values(t.schemas).length&&0===t.children.length&&!w)g.push(`${b}/>`);else{g.push(`${b}>`);const x=[];if(t.text)for(const C of t.text){const M=l({node:C,selection:a,path:h,onlyAllowPropertyTypes:u,namespace:m});for(const E of M)x.push(E)}let I,_;"text"===(null==a?void 0:a.type)&&a.start.blockId===t.attributes.id&&(I=a.start.index),"text"===(null==a?void 0:a.type)&&a.end.blockId===t.attributes.id&&(_=a.end.index);for(let $=0;$<x.length;$++){const S=x[$];let R="";(0,o().O9)(a)&&$===I&&(R+=i),(0,o().O9)(a)&&$===_&&(R+=s),R+=S,g.push(R)}if((0,o().O9)(a)&&I===x.length&&g.push(i),(0,o().O9)(a)&&_===x.length&&g.push(s),"end_to_end"!==m&&"tr"===t.tagName){r().Ul(Object.values(t.properties),(e=>Number(e.attributes.name))).forEach(((e,r)=>{const o=t.parent&&"table"===t.parent.tagName?t.parent:void 0,n=o&&o.attributes["header-row"],i=o&&"table"===o.tagName&&o.attributes["header-column"],s=o&&0===o.children.indexOf(t),d=n&&0===r||i&&s?"th":"td";g.push(`<${d}>`),g.push(...e.children.flatMap((e=>l({node:e,selection:a,path:h,onlyAllowPropertyTypes:u,namespace:m})))),g.push(`</${d}>`)}))}else{const U=function(e){const{tagName:t,properties:a}=e;if("tr"===t)return a;const r=[];for(const o of a){const e=c(o),a="page"===t;("property-title"===o.tagName||!e||a&&r.length<d)&&r.push(o)}return r}({tagName:t.tagName,properties:Object.values(t.properties)});for(const O of U)u&&!u.includes(O.tagName)||g.push(...l({node:O,selection:a,path:h,onlyAllowPropertyTypes:u,namespace:m}))}for(const A of Object.values(t.schemas))g.push(...l({node:A,selection:a,path:h,onlyAllowPropertyTypes:u,namespace:m}));if(t.children)for(const q of t.children){const P=l({node:q,selection:a,path:h,onlyAllowPropertyTypes:u,namespace:m});for(const B of P)g.push(B)}g.push(f)}(0,o().O9)(a)&&N&&g.push(s)}else if("collection"===t.type){g.push(`${b}>`);for(const K of Object.values(t.properties))u&&!u.includes(K.tagName)||g.push(...l({node:K,selection:a,path:h,onlyAllowPropertyTypes:u,namespace:m}));for(const j of Object.values(t.schemas))g.push(...l({node:j,selection:a,path:h,onlyAllowPropertyTypes:u,namespace:m}));g.push(f)}else{function D(e){return"collection"===e.type||"collectionView"===e.type}if(D(t)||0===t.children.length)g.push(`${b}/>`);else{const F=[];if(!D(t)&&t.children)for(const L of t.children){const H=l({node:L,selection:a,path:h,onlyAllowPropertyTypes:u,namespace:m});for(const X of H)F.push(X)}if(F.length<=1||(0,o().O)(n()._S,t.tagName)&&n()._S[t.tagName].isToken)g.push(`${b}>${F.join("")}${f}`);else for(let V=0;V<F.length;V++){const z=F[V];0===V?g.push(`${b}>${z}`):V===F.length-1?g.push(z+f):g.push(z)}}}}return g}const d=20;function c(e){return"property-checkbox"!==e.tagName&&("property-number"===e.tagName?!e.attributes.number:0===e.children.length)}function p(e){const{node:t,selection:a,onlyAllowPropertyTypes:r,namespace:o}=e;return l({node:t,selection:a,path:[],onlyAllowPropertyTypes:r,namespace:o}).join("")}},716470:(e,t,a)=>{"use strict";a.d(t,{u:()=>r});a(16280),a(944114);class r extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="sharepoint",this.displayName="SharePoint",this.requiresUserAuth=!1,this.featureGate="sharepoint_qna",this.category="vector",this.parentOrganization="Microsoft",this.fileTypes=["document","spreadsheets","presentation","pdf"],this.qnaIngestionAIAppId="07351274-83bb-4118-9f5b-9d75f0453999",this.urlRegex=/https:\/\/(?<site>[^.]+)\.sharepoint\.com\/(:(?<fileType>[pwx]):\/r\/)?(?:sites|personal)\/(?<driveName>[^\/]+)\/.*[?&]sourcedoc=(?:%7B|\{)(?<sourceDocId>[0-9A-Fa-f-]+)(?:%7D|\})/}getTitle(e){if("sharepoint"!==e.type)throw new Error(`Expected sharepoint resource, got resource.type=${e.type}`);return e.title}getText(e){if("sharepoint"!==e.type)throw new Error(`Expected sharepoint resource, got resource.type=${e.type}`);return`<mentioned-sharepoint type="${e.type}" title="${e.title}" timestamp="${e.timestamp}">\n${e.blocks.join("\n")}\n</mentioned-sharepoint>`}buildSearchResult(e){const{result:t,baseAttributes:a}=e;return"sharepoint"!==t.type?super.buildSearchResult(e):{attributes:{...a,...t.fileType?{"file-type":t.fileType}:{}},children:[{type:"text",value:t.text}]}}getSearchResultXMLTagName(){return"sharepoint-result"}addSearchResultToXML(e,t){if("sharepoint"!==e.type)throw new Error(`Expected sharepoint result, got result.type=${e.type}`);t.push({type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.id,title:e.title,"last-edited-datetime":e.lastEdited,...e.fileType?{"file-type":e.fileType}:{}},children:[{type:"text",value:e.text}]})}mapObservationResultNode(e){const{node:t,idMapper:r,idToCounter:o}=e;if("sharepoint-result"!==t.tagName)return t;const n=r.mapKeyToCounter({type:"sharepoint",key:(0,a(902006).V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n}}}}},762282:(e,t,a)=>{"use strict";a.d(t,{CD:()=>s,Qz:()=>i,Y7:()=>l,YV:()=>d,o0:()=>n,uI:()=>c});a(18107),a(967357),a(898992),a(354520),a(581454);var r=()=>a(534177),o=()=>a(252050);class n{constructor(){this.didModify=!1}modified(){return this.didModify}markModified(){this.didModify=!0}resetModified(){this.didModify=!1}apply(e,t){return this.resetModified(),this.applyImpl(e,t)}trimLeadingAndTrailingWhitespace(e){if(0===e.length)return e;const t=[...e],a=t[0];if("text"===a.type){const e=(r=a.value)!==r.trimStart()&&""!==r.trimStart()&&" "===r[0]?` ${r.trimStart()}`:r.trimStart();""===e?(this.markModified(),t.shift()):e!==a.value&&(this.markModified(),t[0]={type:"text",value:e})}var r;const o=t.at(-1);if("text"===(null==o?void 0:o.type)){const e=function(e){return e!==e.trimEnd()&&""!==e.trimEnd()&&" "===e[e.length-1]?`${e.trimEnd()} `:e.trimEnd()}(o.value);""===e?(this.markModified(),t.pop()):e!==o.value&&(this.markModified(),t[t.length-1]={type:"text",value:e})}return t}}function i(e){return"text"===e.type||Boolean(o()._S[e.tagName])}function s(e){return"element"===e.type&&Boolean(o().sA[e.tagName])}function l(e){if("element"!==e.type)return!1;const t=o().sA[e.tagName];return void 0!==t&&!0===t.title}function d(e){return"element"===e.type&&e.tagName in o().GU}function c(e,t){const a=t(e);return"element"===a.type?{...a,children:a.children.map((e=>c(e,t))).filter(r().O9)}:a}},816926:(e,t,a)=>{"use strict";a.d(t,{Y:()=>r});a(16280),a(944114);class r extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="salesforce",this.displayName="Salesforce",this.requiresUserAuth=!0,this.featureGate="salesforce_qna",this.category="vector",this.parentOrganization=null,this.fileTypes=["record"],this.qnaIngestionAIAppId="7115dd18-531d-4c72-8f5c-279426fbdbae",this.urlRegex=/https:\/\/(?<instanceUrl>[^/]+)\.(?:lightning\.force|my\.salesforce)\.com\/lightning\/r\/(?<objectType>[^/]+)\/(?<recordId>[a-zA-Z0-9]{15,18})\/view/}getTitle(e){if("salesforce-record"!==e.type)throw new Error(`Expected salesforce-record resource, got resource.type=${e.type}`);return`${e.objectType} | ${e.recordId}`}getText(e){if("salesforce-record"!==e.type)throw new Error(`Expected salesforce-record resource, got resource.type=${e.type}`);return`<mentioned-salesforce-record type="${e.type}" object-type="${e.objectType}" record-id="${e.recordId}" title="${e.title}">\n${e.blocks.join("\n")}\n</mentioned-salesforce-record>`}getSearchResultXMLTagName(){return"salesforce-result"}addSearchResultToXML(e,t){if("salesforce"!==e.type)throw new Error(`Expected salesforce result, got result.type=${e.type}`);t.push({type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.id,title:e.title,"last-edited-datetime":e.lastEdited,...e.objectType?{"object-type":e.objectType}:{}},children:[{type:"text",value:e.text}]})}buildAgentSearchResultFromAutosearchResult(e){return{searchSourceType:"salesforce",id:e.id,title:e.title,path:e.path,lastEdited:e.lastEdited,objectType:""}}mapObservationResultNode(e){const{node:t,idMapper:r,idToCounter:o}=e;if("salesforce-result"!==t.tagName)return t;const n=r.mapKeyToCounter({type:"salesforce",key:(0,a(902006).V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n}}}}},832443:(e,t,a)=>{"use strict";a.d(t,{D4:()=>u,V6:()=>m,tD:()=>h});a(16280),a(944114),a(581454);var r=a.n(a(625473)),o=()=>a(496603),n=()=>a(973647),i=()=>a(534177),s=()=>a(939768),l=()=>a(933528),d=()=>a(902006),c=()=>a(181856);const p=/^\d+$/;function u(e){return!!p.test(e)}class m extends Error{constructor(e){super(`Tried to use an ID that doesn't exist: ${e}`)}}class h{generateSerializedKey(e){return r()(e)}constructor(e){if(this.counter=0,this.keyToCounterMap=new Map,this.counterToKeyMap=new Map,this.mapCounterToKeyInModeOrThrow=(e,t,a)=>n().Q.unwrap(this.mapCounterToKeyInMode(e,t,a)),this.mapCounterToKeyInMode=(e,t,a)=>h.mapCounterToKeyInMode(this,e,t,a),this.utilitiesForTests={removeKey:this.removeKey.bind(this),setCounterValueForKey:this.setCounterValueForKey.bind(this)},e){const t=[];for(const{key:r,counter:o}of e.keyMap)this.keyToCounterMap.set(this.generateSerializedKey(r),o),this.counterToKeyMap.set(o,r),t.push(parseInt(o));const a=o().T9(t);this.counter="number"==typeof a?a+1:0}}serialize(){return{keyMap:Array.from(this.counterToKeyMap.entries()).map((([e,t])=>({key:o().mg(t),counter:e})))}}inheritFrom(e){for(const[t,a]of e.keyToCounterMap.entries())this.keyToCounterMap.set(t,a);for(const[t,a]of e.counterToKeyMap.entries())this.counterToKeyMap.set(t,a)}mapKeyToCounter(e){const t=this.generateSerializedKey(e);if(!this.keyToCounterMap.has(t)){const a=this.counter.toString();this.keyToCounterMap.set(t,a),this.counterToKeyMap.set(a,e),this.counter++}return this.keyToCounterMap.get(t)}mapNodeKeyToCounter(e){if("block"===e.type){const t={...e},a=this.mapNodeAttributesKeyToCounter(e.attributes);t.attributes=a;const r=e.text.map((e=>this.mapNodeKeyToCounter(e)));t.text=r;const o=e.children.map((e=>{const a=this.mapNodeKeyToCounter(e);return a.parent=t,a}));t.children=o;const n={};for(const[e,l]of Object.entries(t.properties))n[e]=this.mapNodeKeyToCounter(l);t.properties=n;const i={};for(const[e,l]of Object.entries(t.schemas))i[e]=this.mapNodeKeyToCounter(l);t.schemas=i;const s=this.mapKeyToCounter({key:e.schemaId,type:"block"});return t.schemaId=s,t}if("property"===e.type||"schema"===e.type||"inline"===e.type){const t={...e};return t.attributes=this.mapNodeAttributesKeyToCounter(t.attributes),t.children=t.children.map((e=>this.mapNodeKeyToCounter(e))),t}if("instructions"===e.type){const t={...e};return t.children=t.children.map((e=>this.mapNodeKeyToCounter(e))),t}if("text"===e.type)return{...e};if("collection"===e.type){const t={...e,schemaId:this.mapKeyToCounter({type:"block",key:e.schemaId}),attributes:{...e.attributes,id:this.mapKeyToCounter({type:"collection",key:e.attributes.id})}},a=Object.fromEntries(Object.entries(t.properties).map((([e,t])=>[e,this.mapNodeKeyToCounter(t)])));t.properties=a;const r=Object.fromEntries(Object.entries(t.schemas).map((([e,t])=>[e,this.mapNodeKeyToCounter(t)])));return t.schemas=r,t}if("collectionView"===e.type)return{...e,schemaId:this.mapKeyToCounter({type:"block",key:e.schemaId}),attributes:{...e.attributes,id:this.mapKeyToCounter({type:"collection-view",key:e.attributes.id}),"database-id":this.mapKeyToCounter({type:"collection",key:e.attributes["database-id"]})}};if("slackMessages"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"universal",key:e.attributes.id})}}}if("microsoftTeamsMessages"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"universal",key:e.attributes.id})}}}if("attachment"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"attachment",key:e.attributes.id,attachmentType:e.attributes.attachmentType})}}}throw new Error(`Unknown node type ${e}`)}mapNodeAttributesKeyToCounter(e){if(!e)return e;const t={...e};for(const[r,o]of Object.entries(h.attributesToMap)){if(!o)continue;const e=t[r];if(e)if("href"===r){let o;const n=s().qg(e),i=s().Jf({str:n.href,allowNoProtocol:!0});i&&(o=a(201980).lXo({url:i,baseUrl:n.protocol?`${n.protocol}//${n.host}`:`https://${n.host??"www.notion.so"}`,publicDomainName:n.host??"www.notion.so"})),t[r]=o?this.mapKeyToCounter({type:"block",key:o}):e}else t[r]="person-id"===r?this.mapKeyToCounter({type:"person",key:e}):"database-id"===r||"data-source-id"===r?this.mapKeyToCounter({type:"collection",key:e}):this.mapKeyToCounter({type:"block",key:e})}return t}doesIdMapperContainMappedKey(e){return this.counterToKeyMap.has(e)}doesIdMapperContainKey(e){return this.keyToCounterMap.has(this.generateSerializedKey(e))}getIdForMappedKeyIfExists(e){const t=this.counterToKeyMap.get(e);return null==t?void 0:t.key}mapCounterToKey(e){const t=this.counterToKeyMap.get(e);if(!t)throw new m(e);return t}mapAssistantContextCounterToKey(e){const{"instructions-page-id":t,"current-page-id":a,"current-person-id":r,"current-background-page-id":o,...n}=e;return{...n,...e["instructions-page-id"]?{"instructions-page-id":this.mapCounterToKeyInModeOrThrow(e["instructions-page-id"],"block_counter")}:{},...e["current-page-id"]?{"current-page-id":this.mapCounterToKeyInModeOrThrow(e["current-page-id"],"block_counter")}:{},...e["current-background-page-id"]?{"current-background-page-id":this.mapCounterToKeyInModeOrThrow(e["current-background-page-id"],"block_counter")}:{},...e["current-thread-id"]?{"current-thread-id":this.mapCounterToKeyInModeOrThrow(e["current-thread-id"],"thread_counter")}:{},...e["current-person-id"]?{"current-person-id":this.mapCounterToKeyInModeOrThrow(e["current-person-id"],"person_counter")}:{}}}mapAssistantContextKeyToCounter(e){const{"instructions-page-id":t,"current-page-id":a,"current-person-id":r,"current-background-page-id":o,...n}=e;return{...n,...e["instructions-page-id"]?{"instructions-page-id":this.mapKeyToCounter({type:"block",key:e["instructions-page-id"]})}:{},...e["current-page-id"]?{"current-page-id":this.mapKeyToCounter({type:"block",key:e["current-page-id"]})}:{},...e["current-background-page-id"]?{"current-background-page-id":this.mapKeyToCounter({type:"block",key:e["current-background-page-id"]})}:{},...e["current-thread-id"]?{"current-thread-id":this.mapKeyToCounter({type:"slack-thread",key:(0,d().V9)(e["current-thread-id"])})}:{},...e["current-person-id"]?{"current-person-id":this.mapKeyToCounter({type:"person",key:e["current-person-id"]})}:{}}}mapAssistantSelectionKeyToCounter(e){return"block"===e.type?{type:"block",blockIds:e.blockIds.map((e=>this.mapKeyToCounter({type:"block",key:e})))}:"text"===e.type?{type:"text",start:{...e.start,blockId:this.mapKeyToCounter({type:"block",key:e.start.blockId})},end:{...e.end,blockId:this.mapKeyToCounter({type:"block",key:e.end.blockId})}}:void(0,i().HB)(e)}static mapCounterToKeyInMode(e,t,a,r){if("block_counter"===a||"person_counter"===a||"thread_counter"===a||"collection_counter"===a||"collection_view_counter"===a||"query_database_result_counter"===a||"external_id_counter"===a||"attachment_id_counter"===a){const o=(0,n().j)((()=>e.mapCounterToKey(t)));if(n().Q.isFail(o))return o;const s=o.value;let l;return"block_counter"===a?l="block":"person_counter"===a?l="person":"thread_counter"===a?l="slack-thread":"collection_counter"===a?l="collection":"collection_view_counter"===a?l="collection-view":"query_database_result_counter"===a?l="query-database-result":"external_id_counter"===a?l="universal":"attachment_id_counter"===a?l="attachment":(0,i().HB)(a),s.type!==l?{error:new(c().xU)({receivedIdType:s.type,expectedIdType:l,tagNameForErrorMessage:r,idValueForErrorMessage:t})}:{value:s.key}}if("href_counter"===a){const a=h.getMappedTypeFromCounterIfExists(t,e);return"query-database-result"===a?{error:new(c().xU)({receivedIdType:a,expectedIdType:"href",tagNameForErrorMessage:r,idValueForErrorMessage:t})}:{value:h.mapHrefCounterToUrl(e,t)}}(0,i().HB)(a)}getTypeKeyFromCounter(e){return h.getMappedTypeFromCounterIfExists(e,this)}static getMappedTypeFromCounterIfExists(e,t){let a;try{a=t.mapCounterToKey(e)}catch(r){if(r instanceof m)return;throw r}return a.type}static blockKeyToHref(e){return`/${e.key.split("/")[0].replaceAll("-","")}`}static blockIdToHref(e){return`/${e.split("/")[0].replaceAll("-","")}`}static mapHrefCounterToUrl(e,t){let a;try{a=e.mapCounterToKey(t)}catch(r){if(r instanceof m)return t;throw r}if("block"===a.type)return h.blockKeyToHref(a);if("url"===a.type||"slack-message"===a.type||"slack-thread"===a.type||"webpage"===a.type||"helpdoc"===a.type||"helpdoc-section"===a.type||"microsoft-teams-message"===a.type||"microsoft-teams-thread"===a.type||"discord-message"===a.type||(0,d().SC)(a.type))return a.key;if("collection"===a.type||"collection-view"===a.type||"person"===a.type)return d().Py;if("query-database-result"===a.type||"skill"===a.type)throw new Error(`Invalid URL type: ${a.type}`);return"universal"===a.type||"attachment"===a.type?a.key:void(0,i().HB)(a.type)}removeKey(e){const t=this.generateSerializedKey(e),a=this.keyToCounterMap.get(t);if(a)return this.keyToCounterMap.delete(t),this.counterToKeyMap.delete(a),a}setCounterValueForKey(e,t){const a=this.generateSerializedKey(e);this.keyToCounterMap.set(a,t),this.counterToKeyMap.set(t,e)}}h.attributesToMap={id:!0,"page-id":!0,"database-id":!0,"data-source-id":!0,"person-id":!0,"person-name":!1,href:!0,category:!1,option:!1,format:!1,number:!1,date:!1,time:!1,"start-date":!1,"start-time":!1,"end-date":!1,"end-time":!1,"synced-property-name":!1,"synced-block-id":!0,"external-id":!0,index:!1,title:!1,icon_url:!1,description:!1,name:!1,equation:!1},h.parseAssistantHref=l().f9,h.databaseQueryHrefToDatabaseQueryResultsId=l().uP,h.blockHrefToAssistantBlockId=l().Gp},838862:(e,t,a)=>{"use strict";a.d(t,{d:()=>o});a(16280),a(944114),a(581454);var r=()=>a(902006);class o extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="slack",this.displayName="Slack",this.requiresUserAuth=!0,this.featureGate="slack_v2_ai_connector",this.category="vector",this.parentOrganization=null,this.fileTypes=["message"],this.qnaIngestionAIAppId="1031cb6c-4935-4cc1-9c08-c9a4ecaae323",this.urlRegex=/https:\/\/(?<workspace>[\w-]+(?:\.[\w-]+)?)\.slack\.com\/archives\/(?<channel>[^\/]+)(\/p(?<timestamp>\d+)(\?thread_ts=(?<thread_ts>\d+\.\d+)&cid=(?<cid>[^\/]+))?)?/}getTitle(e){if("slack"!==e.type)throw new Error(`Expected slack resource, got resource.type=${e.type}`);return e.channel}getText(e){if("slack"!==e.type)throw new Error(`Expected slack resource, got resource.type=${e.type}`);return`<mentioned-slack type="${e.type}" channel="${e.channel}" timestamp="${e.timestamp}">\n${e.messages.map((e=>`<message user="${e.user.name}">${e.text}</message>`)).join("\n")}\n</mentioned-slack>`}buildSearchResult(e){const{result:t,baseAttributes:a,mappedIdOrUrlForResultID:r}=e;if("slack"!==t.type)return super.buildSearchResult(e);if(t.messages&&t.messages.length>0){const e=t.messages.map((e=>{const t=r({type:"slack",id:e.messageId});return{type:"element",tagName:"message",attributes:{..."mapped_as_url"===t.status?{url:t.url}:{},..."mapped_as_int"===t.status?{id:t.id}:{},user:e.user,"last-updated":e.lastEdited},children:[{type:"text",value:e.text}]}}));return{attributes:{...a,...t.channel?{channel:t.channel}:{}},children:[{type:"element",tagName:"messages",attributes:{},children:e}]}}return{attributes:{...a,...t.channel?{channel:t.channel}:{}},children:[{type:"text",value:t.text}]}}buildAgentSearchResultFromAutosearchResult(e){return{searchSourceType:"slack",id:e.id,title:e.title,channel:e.path,text:e.snippet,lastEdited:e.lastEdited}}getSearchResultXMLTagName(){return"slack-thread"}addSearchResultToXML(e,t){if("slack"!==e.type)throw new Error(`Expected slack result, got result.type=${e.type}`);t.push({type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.id,channel:e.channel??"","last-edited-datetime":e.lastEdited},children:e.messages.map((e=>({type:"element",tagName:"slack-message",attributes:{id:e.messageId,"last-edited-datetime":e.lastEdited,user:e.user},children:[{type:"text",value:e.text}]})))})}mapObservationResultNode(e){const{node:t,idMapper:a,idToCounter:o}=e;if(t.tagName!==this.getSearchResultXMLTagName())return t;const n=a.mapKeyToCounter({type:"slack-message",key:(0,r().V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n},children:t.children.map((e=>{const t=a.mapKeyToCounter({type:"slack-message",key:(0,r().V9)(e.attributes.id)});return o[e.attributes.id]=t,{...e,attributes:{...e.attributes,id:t}}}))}}}},872182:(e,t,a)=>{"use strict";a.d(t,{s:()=>r});a(16280),a(944114);class r extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="google-drive",this.displayName="Google Drive",this.requiresUserAuth=!1,this.featureGate="google_drive_qna_ingestion",this.category="vectorless",this.parentOrganization="Google",this.fileTypes=[],this.qnaIngestionAIAppId="3d40fc68-9393-4aed-8c7e-5db1b8cdb71b",this.urlRegex=/^google-drive:\/\/.+/}getTitle(e){throw new Error("GoogleDriveDriver.getTitle() is not implemented")}getText(e){throw new Error("GoogleDriveDriver.getText() is not implemented")}getTranscriptAttributes(e){return{}}buildSearchResult(e){const{result:t,baseAttributes:a}=e;return"google-drive"!==t.type?super.buildSearchResult(e):{attributes:{...a,"file-type":t.fileType??""},children:[{type:"text",value:t.text}]}}getSearchResultXMLTagName(){return"google-drive-result"}addSearchResultToXML(e,t){if("google-drive"!==e.type)throw new Error(`Expected google-drive result, got result.type=${e.type}`);const a={type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.id,title:e.title,"last-edited-datetime":e.lastEdited,"file-type":e.fileType},children:[{type:"text",value:e.text}]};t.push(a)}mapObservationResultNode(e){const{node:t,idMapper:r,idToCounter:o}=e;if("google-drive-result"!==t.tagName)return t;const n=r.mapKeyToCounter({type:"google-drive",key:(0,a(902006).V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n}}}}},902824:(e,t,a)=>{"use strict";a.d(t,{V:()=>o});a(16280),a(944114),a(898992),a(672577),a(581454);var r=()=>a(902006);class o extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="notion-mail",this.displayName="Notion Mail",this.requiresUserAuth=!1,this.featureGate="notion_mail_connector",this.category="vectorless",this.parentOrganization=null,this.fileTypes=[],this.qnaIngestionAIAppId="86ac6e3c-8ca9-4aab-9a25-fea9a0a1af57",this.urlRegex=r().xx}getTitle(e){if("notion-mail"!==e.type)throw new Error(`Expected notion-mail resource, got resource.type=${e.type}`);return e.subject}getText(e){if("notion-mail"!==e.type)throw new Error(`Expected notion-mail resource, got resource.type=${e.type}`);const t=e.messages.map((e=>{const t=new Date(e.timestamp).toLocaleString();return`<mentioned-notion-mail-message user="${e.user.name}" timestamp="${t}">\n${e.text}\n</mentioned-notion-mail-message>`})).join("\n\n");return`<mentioned-notion-mail-thread subject="${e.subject}" thread-id="${e.threadId}">\n${t}\n</mentioned-notion-mail-thread>`}getTranscriptAttributes(e){return{}}getSearchResultXMLTagName(){return"notion-mail-result"}addSearchResultToXML(e,t){if("notion-mail"!==e.type)throw new Error(`Expected notion-mail result, got result.type=${e.type}`);let a=t.find((t=>"notion-mail-result"===t.tagName&&t.attributes.id===e.pageId));a||(a={type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.pageId,title:e.title},children:[]},t.push(a)),a.children.push({type:"element",tagName:"email",attributes:{id:e.id,title:e.title,"last-edited-datetime":e.lastEdited},children:[{type:"text",value:e.text}]})}mapObservationResultNode(e){const{node:t,idMapper:a,idToCounter:o}=e;if("notion-mail-result"!==t.tagName)return t;const n=a.mapKeyToCounter({type:"notion-mail",key:(0,r().V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n},children:t.children.map((e=>{const t=a.mapKeyToCounter({type:"notion-mail",key:(0,r().V9)(e.attributes.id)});return o[e.attributes.id]=t,{...e,attributes:{...e.attributes,id:t}}}))}}}},958062:(e,t,a)=>{"use strict";a.d(t,{M:()=>r});a(16280),a(944114);class r extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="notion-calendar",this.displayName="Notion Calendar",this.requiresUserAuth=!1,this.featureGate="notion_calendar_ai_connector",this.category="vectorless",this.parentOrganization=null,this.fileTypes=[],this.qnaIngestionAIAppId="471f22ca-eb03-4629-99e5-2c4b82c78bb0",this.urlRegex=/^notion-calendar:\/\/.+/}getTitle(e){throw new Error("NotionCalendarDriver.getTitle() is not implemented")}getText(e){throw new Error("NotionCalendarDriver.getText() is not implemented")}getTranscriptAttributes(e){return{}}getSearchResultXMLTagName(){return"notion-calendar-result"}addSearchResultToXML(e,t){if("notion-calendar"!==e.type)throw new Error(`Expected notion-calendar result, got result.type=${e.type}`);t.push({type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.id,title:e.title},children:[{type:"text",value:e.text}]})}mapObservationResultNode(e){const{node:t,idMapper:r,idToCounter:o}=e;if("notion-calendar-result"!==t.tagName)return t;const n=r.mapKeyToCounter({type:"notion-calendar",key:(0,a(902006).V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n}}}}},966270:(e,t,a)=>{"use strict";a.d(t,{S:()=>o});a(16280),a(944114),a(898992),a(672577),a(581454);var r=()=>a(902006);class o extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="outlook",this.displayName="Outlook",this.requiresUserAuth=!1,this.featureGate="outlook_ai_connector",this.category="vectorless",this.parentOrganization="Microsoft",this.fileTypes=[],this.qnaIngestionAIAppId="5f7ef930-12b9-452b-8eb9-a385e84b7aa6",this.urlRegex=/^outlook:\/\/.+/}getTitle(e){throw new Error("OutlookDriver.getTitle() is not implemented")}getText(e){throw new Error("OutlookDriver.getText() is not implemented")}getSearchResultXMLTagName(){return"outlook-result"}addSearchResultToXML(e,t){if("outlook"!==e.type)throw new Error(`Expected outlook result, got result.type=${e.type}`);let a=t.find((t=>"outlook-result"===t.tagName&&t.attributes.id===e.pageId));a||(a={type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.pageId,title:e.title},children:[]},t.push(a)),a.children.push({type:"element",tagName:"email",attributes:{id:e.id,title:e.title,"last-edited-datetime":e.lastEdited},children:[{type:"text",value:e.text}]})}mapObservationResultNode(e){const{node:t,idMapper:a,idToCounter:o}=e;if("outlook-result"!==t.tagName)return t;const n=a.mapKeyToCounter({type:"outlook",key:(0,r().V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n},children:t.children.map((e=>{const t=a.mapKeyToCounter({type:"outlook",key:(0,r().V9)(e.attributes.id)});return o[e.attributes.id]=t,{...e,attributes:{...e.attributes,id:t}}}))}}}},971502:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});a(16280),a(944114),a(581454);class r extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="discord",this.displayName="Discord",this.requiresUserAuth=!1,this.featureGate="discord_qna",this.category="vector",this.parentOrganization=null,this.fileTypes=["message"],this.qnaIngestionAIAppId="3be7eae2-8e47-47e0-aaa8-634e192caab2",this.urlRegex=/https:\/\/discord\.com\/channels\/(?<guildId>\d+)\/(?<channelId>\d+)\/(?<messageId>\d+)/}getTitle(e){if("discord"!==e.type)throw new Error(`Expected discord resource, got resource.type=${e.type}`);return e.channel}getText(e){if("discord"!==e.type)throw new Error(`Expected discord resource, got resource.type=${e.type}`);return`<mentioned-discord type="${e.type}" channel="${e.channel}" timestamp="${e.timestamp}">\n${e.messages.map((e=>`<message user="${e.user.name}">${e.text}</message>`)).join("\n")}\n</mentioned-discord>`}getSearchResultXMLTagName(){return"discord-result"}addSearchResultToXML(e,t){if("discord"!==e.type)throw new Error(`Expected discord result, got result.type=${e.type}`);t.push({type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.id,title:e.title,"channel-name":e.title,"last-edited-datetime":e.lastEdited,...e.messageType&&{"message-type":e.messageType}},children:[{type:"text",value:e.text}]})}mapObservationResultNode(e){const{node:t,idMapper:r,idToCounter:o}=e;if("discord-result"!==t.tagName)return t;const n=r.mapKeyToCounter({type:"discord-message",key:(0,a(902006).V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n}}}}},973298:(e,t,a)=>{"use strict";a.d(t,{_:()=>r});a(16280),a(944114);class r extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="linear",this.displayName="Linear",this.requiresUserAuth=!0,this.featureGate="linear_ai_connector",this.category="vector",this.parentOrganization=null,this.fileTypes=["issue"],this.qnaIngestionAIAppId="1fa8e9a2-3b4c-5d6e-7f8a-9b0c1d2e3f4a",this.urlRegex=/https:\/\/linear\.app\/(?<orgKey>[^/]+)\/issue\/(?<issueKey>[A-Z0-9]+-\d+).*?/}getTitle(e){if("linear-issue"!==e.type)throw new Error(`Expected linear-issue resource, got resource.type=${e.type}`);return e.title}getText(e){if("linear-issue"!==e.type)throw new Error(`Expected linear-issue resource, got resource.type=${e.type}`);return`<mentioned-linear type="${e.type}" title="${e.title}">\n${e.text}\n</mentioned-linear>`}buildSearchResult(e){const{result:t,baseAttributes:a}=e;return"linear"!==t.type?super.buildSearchResult(e):{attributes:{...a,...t.name?{name:t.name}:{}},children:[{type:"text",value:t.text}]}}getSearchResultXMLTagName(){return"linear-result"}addSearchResultToXML(e,t){if("linear"!==e.type)throw new Error(`Expected linear result, got result.type=${e.type}`);t.push({type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.id,title:e.title,name:e.name,"last-edited-datetime":e.lastEdited},children:[{type:"text",value:e.text}]})}mapObservationResultNode(e){const{node:t,idMapper:r,idToCounter:o}=e;if("linear-result"!==t.tagName)return t;const n=r.mapKeyToCounter({type:"linear",key:(0,a(902006).V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n}}}}},983662:(e,t,a)=>{"use strict";a.d(t,{S:()=>o});a(16280),a(944114),a(898992),a(672577);var r=()=>a(902006);class o extends(()=>a(540192))().o{constructor(...e){super(...e),this.type="custom",this.displayName="Custom",this.requiresUserAuth=!1,this.featureGate="custom_ai_connectors",this.category="vector",this.parentOrganization=null,this.fileTypes=[],this.qnaIngestionAIAppId=r().pL,this.urlRegex=/^custom:\/\/.+/}getTitle(e){return"Custom connector result"}getText(e){return""}getSearchResultXMLTagName(){return"custom-result"}addSearchResultToXML(e,t){if("custom"!==e.type)throw new Error(`Expected custom result, got result.type=${e.type}`);let a=t.find((t=>"custom-result"===t.tagName&&t.attributes.id===e.pageId));a||(a={type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.pageId,title:e.title,"last-edited-datetime":e.lastEdited},children:[{type:"text",value:e.text}]},t.push(a))}mapObservationResultNode(e){const{node:t,idMapper:a,idToCounter:o}=e;if("custom-result"!==t.tagName)return t;const n=a.mapKeyToCounter({type:"custom",key:(0,r().V9)(t.attributes.id)});return o[t.attributes.id]=n,{...t,attributes:{...t.attributes,id:n}}}}}}]);