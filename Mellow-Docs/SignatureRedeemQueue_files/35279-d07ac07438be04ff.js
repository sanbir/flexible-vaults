"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[4690,21697,35279,70593,77957,85873],{2151:(e,t,n)=>{n.d(t,{v:()=>a().v});var a=()=>n(621843)},10722:(e,t,n)=>{n.d(t,{I_:()=>u,Ki:()=>c,SK:()=>d});n(898992),n(672577);var a=()=>n(201980),i=()=>n(769864),s=()=>n(234637),o=()=>n(995277),r=()=>n(483730),l=()=>n(298182);async function c(e){var t;const{searchScope:n,searchFilters:i,environment:c,assistantSurface:d,query:u,searchSessionId:p}=e,g=null===(t=r().default.getActiveSession())||void 0===t?void 0:t.clientStepsFromStoreState.find((e=>"human"===e.type)),{sessionId:m}=await(0,o().p)({environment:c,deepFindRequested:!0,searchSessionId:p}),h=r().default.getSessionContext(m);if(!h)return;const f=u&&(0,a().q4_)(u).trim().length>0?u:void 0,y={...(0,l().CO)(n.type,"createdByFilter")?{}:{createdByFilter:[]},...(0,l().CO)(n.type,"dateRangeFilter")?{}:{dateRangeFilter:{startDate:void 0,endDate:void 0}},...i};h.assistantConfigurationStore.setSearchScope(n),h.assistantConfigurationStore.setSearchFilters(y);const v=f??(null==g?void 0:g.text);return v?((0,s().b)({environment:c,sessionId:m,text:v,assistantSurfaceType:d.type}),m):void 0}async function d(e){const{environment:t,feedback:n,deepFindFeedbackPayload:a}=e;await i().callApi({environment:t,eventName:"saveAssistantFeedback",data:{id:a.search_session_id,type:"deep_find_feedback",version:0,feedback:n,...a}})}async function u(e){const{environment:t,deepFindFeedbackPayload:n}=e;await i().callApi({environment:t,eventName:"saveAssistantFeedback",data:{id:n.search_session_id,type:"deep_find_feedback",version:0,feedback:"thumbsDown",...n}})}},11786:(e,t,n)=>{n.r(t),n.d(t,{createDatabaseFromTodoBlocks:()=>B,getConsecutiveTodoBlocks:()=>N,getPreviousTodoBlocks:()=>F,maybeTriggerDatabasePromoNudgeOnCreate:()=>R});n(944114),n(898992),n(803949),n(581454);var a=()=>n(242422),i=()=>n(675133),s=()=>n(295633),o=()=>n(700500),r=()=>n(657970),l=()=>n(898244),c=()=>n(713998),d=()=>n(917629),u=()=>n(179034),p=()=>n(519831),g=()=>n(869558),m=()=>n(201980),h=()=>n(615234),f=()=>n(495726),y=()=>n(44729),v=()=>n(384944),S=()=>n(812182),b=()=>n(680977),x=()=>n(134837),I=()=>n(37450),k=()=>n(191792),w=()=>n(680074),C=()=>n(594794),A=()=>n(300789),T=()=>n(51367),j=()=>n(295304),M=()=>n(547149),_=()=>n(611947),P=()=>n(782535);const D=3,E=3;async function R(e){var t;const{blockStore:n,environment:s}=e,o=n.getParentBlockStore();if(!o)return;if(F(o,n,D).length<D)return;const l=(0,w().R$)(s),c=null==l||null===(t=l.getSettings())||void 0===t||null===(t=t.adoption_entry_points)||void 0===t?void 0:t.database_nudge_on_create_todo;if(c){if(c.length>=E)return;if(Date.now()-c[c.length-1]<h().nD)return}if(!(await A().Ec(s,"database_nudge_on_create_todo")))return;if(!a().default.checkGate({gateName:"adoption_database_newbie_lifecycle_campaign"}))return;const p=N(o,n);if(o.table!==u().ev)return;const g={todoBlocks:p.map((e=>{const t=e.getBlockTitleStore().getValue()||[],n=e.getProperties(),a=!!n&&(0,r().w)(n.checked);return{id:e.id,titleValue:t,isChecked:a}})),currentBlockId:n.id,parentBlock:{id:o.id,table:o.table,spaceId:o.getSpaceId()}},m=i().A.getIntl();(0,P().trackDatabaseEntrypointCta)({environment:e.environment,feature:"create_database",action:"view",from:"database_nudge_on_create_todo"}),(0,d().P$)("database_nudge_on_create_todo")?(A().iy({environment:s,messageKey:"database_nudge_on_create_todo"}),S().Iz({message:m.formatMessage(O.databasePromoDescription),presentationType:"persistent",id:"database-promo-nudge",title:i().A.formatMessage(O.databasePromoTitle),onUserDismiss:()=>{T().Sq(s,{callout_key:"database_nudge_on_create_todo",placement_key:"Toast",dismiss_type:"toast_dismiss"}),(0,P().trackDatabaseEntrypointCta)({environment:e.environment,feature:"create_database",action:"dismiss",from:"database_nudge_on_create_todo"})},actions:{primary:{title:i().A.formatMessage(O.databasePromoPrimaryAction),onAction:()=>{T().Y5(s,{callout_key:"database_nudge_on_create_todo",placement_key:"Toast",click_type:"primary_cta"}),(0,P().trackDatabaseEntrypointCta)({environment:e.environment,feature:"create_database",action:"click",from:"database_nudge_on_create_todo"}),B({environment:e.environment,nudgeData:g}),S().UW("database-promo-nudge")}}}})):A().iy({environment:s,messageKey:"database_nudge_on_create_todo",options:{},metadata:{nudgeData:g}}),T().DL(s,{callout_key:"database_nudge_on_create_todo",placement_key:"Toast"}),(0,x().p)(s,{entryPoint:"database_nudge_on_create_todo"})}function B(e){const{environment:t,nudgeData:n}=e,a=new(s().B)(t,{table:u().ev,id:n.parentBlock.id});if(!a)return;let r,c,d="";const h=[];M().createAndCommit({environment:t,userAction:"create_database_from_todos",canUndo:!0,perform:e=>{const s=v().Wv({environment:t,type:o().xd.collectionView,inMemoryRecordCache:a.inMemoryRecordCache,transaction:e,spaceId:n.parentBlock.spaceId});r=s.id,v().zv({store:s,transaction:e,data:{parent_id:n.parentBlock.id,parent_table:n.parentBlock.table,alive:!0}}),y().NI({parentStore:a.getContentStore(),childStore:s,transaction:e,after:n.currentBlockId}),d=(0,C().Z1)({environment:t,table:p().Vl,spaceId:n.parentBlock.spaceId});const u={title:{name:"Name",type:"title"},[d]:(0,l().D)("Status",i().A.getIntl())},f=v().eC({environment:t,table:p().Vl,value:{id:(0,C().Z1)({environment:t,table:p().Vl,spaceId:n.parentBlock.spaceId}),name:m().x9d("Tasks"),schema:u,format:{collection_page_properties:[{property:d,visible:!0}]},parent_id:s.id,parent_table:"block",space_id:n.parentBlock.spaceId,alive:!0,version:0,...(0,k().$)(t)},inMemoryRecordCache:a.inMemoryRecordCache,transaction:e});c=f.id,v().zv({store:s,transaction:e,data:{collection_id:f.id,view_ids:[]}});const S=v().eC({environment:t,table:g().Gy,value:{id:(0,C().Z1)({environment:t,table:g().Gy,spaceId:n.parentBlock.spaceId}),type:"table",name:"Default view",parent_id:s.id,parent_table:"block",space_id:n.parentBlock.spaceId,alive:!0,version:0,query2:{sort:[{property:d,direction:"ascending"}]}},inMemoryRecordCache:a.inMemoryRecordCache,transaction:e});v().zv({store:s,transaction:e,data:{view_ids:[S.id]}});const x=v().eC({environment:t,table:g().Gy,value:{id:(0,C().Z1)({environment:t,table:g().Gy,spaceId:n.parentBlock.spaceId}),type:"board",name:"Board view",parent_id:s.id,parent_table:"block",space_id:n.parentBlock.spaceId,alive:!0,version:0,query2:{group_by:d},format:{board_columns_by:{type:"status",property:d,groupBy:"option",sort:{type:"ascending"},hideEmptyGroups:!1}}},inMemoryRecordCache:a.inMemoryRecordCache,transaction:e});let I;v().zv({store:s,transaction:e,data:{view_ids:[S.id,x.id]}}),n.todoBlocks.forEach((i=>{const{titleValue:s,isChecked:r}=i;if(0===s.length)return;const l=Array.isArray(s)?s:[],c=v().Wv({environment:t,type:o().xd.page,inMemoryRecordCache:a.inMemoryRecordCache,transaction:e,spaceId:n.parentBlock.spaceId});h.push(c.id),I||(I=c),l.length>0&&j().yr({environment:t,store:c.getBlockTitleStore(),tokens:l,index:0,transaction:e,updateSelection:!1}),v().zv({store:c,transaction:e,data:{parent_id:f.id,parent_table:"collection",alive:!0}}),v().zv({store:c.getPropertiesStore(),transaction:e,data:{[d]:L(r)}})}));if(!_().checkIsTutorialDone("database_onboarding")){const n=(0,w().R$)(t),a=function(e,t,n,a,i){const s={collectionId:e.id,collectionViewId:t.id,statusPropertyId:n},o=i?{databasePageId:i.id}:{};return{database_onboarding_status_property_tooltip:{stepType:"database_onboarding_status_property_tooltip",...s,...o},database_onboarding_add_property_tooltip:{stepType:"database_onboarding_add_property_tooltip",...s},database_onboarding_database_page_tooltip:{stepType:"database_onboarding_database_page_tooltip",...s,...o},database_onboarding_board_view_tooltip:{stepType:"database_onboarding_board_view_tooltip",...s,collectionBoardViewId:a.id}}}(f,S,d,x,I);var A;if(n)(0,b().m)({userSettingsStore:n,transaction:e,data:{tutorial_step_settings:{...null===(A=n.getSettings())||void 0===A?void 0:A.tutorial_step_settings,database_onboarding:a}}}),_().tutorialGoToStep(t,"database_onboarding","database_onboarding_status_property_tooltip",e)}}}),r&&c&&(I().vH(t,{type:o().xd.collectionView,from:"lifecycle_nudge",creating_block_id:r,collection_id:c,teamStore:void 0}),d&&f().Z(t,{from:"lifecycle_nudge",collection_id:c,property_type:"status"}),h.forEach((e=>{I().vH(t,{type:o().xd.page,from:"lifecycle_nudge",creating_block_id:e,collection_id:c,new_page_id:e,teamStore:void 0})})))}function F(e,t,n){const a=e.getContentStores();if(!a||0===a.length)return[];const i=a.findIndex((e=>{var n;return(null==e||null===(n=e.pointer)||void 0===n?void 0:n.id)===t.pointer.id}));if(-1===i)return[];const s=[];for(let r=i;r>=0;r--){const e=a[r];if(e){if(!e.isType(o().xd.toDo))break;if(s.unshift(e),n&&s.length>=n)break}}return s}function N(e,t){const n=e.getContentStores();if(!n||0===n.length)return[];const a=n.findIndex((e=>{var n;return(null==e||null===(n=e.pointer)||void 0===n?void 0:n.id)===t.pointer.id}));if(-1===a)return[];const i=n[a];if(!i||!i.isType(o().xd.toDo))return[];const s=[];for(let r=a;r>=0;r--){const e=n[r];if(e){if(!e.isType(o().xd.toDo))break;s.unshift(e)}}for(let r=a+1;r<n.length;r++){const e=n[r];if(e){if(!e.isType(o().xd.toDo))break;s.push(e)}}return s}function L(e){return e?(0,c().U8)("Done"):(0,c().U8)("Not started")}const O=(0,n(69708).YK)({databasePromoTitle:{id:"database.promo.title",defaultMessage:"Track tasks smarter with a database"},databasePromoDescription:{id:"database.promo.description",defaultMessage:"Sort and filter by status to stay organized. Create it with /database."},databasePromoPrimaryAction:{id:"database.promo.primaryAction",defaultMessage:"Try database"}})},12831:(e,t,n)=>{n.d(t,{U2:()=>h,rH:()=>f});var a=()=>n(907258),i=()=>n(242422),s=()=>n(416504),o=()=>n(992437),r=()=>n(450648),l=()=>n(234459),c=()=>n(140992),d=()=>n(36951),u=()=>n(166442),p=()=>n(594794),g=()=>n(844317),m=()=>n(354785);function h(e){const{environment:t,intl:n,queryTextValue:h,searchSessionId:f,entrypoint:y}=e,v=(0,r().r4)({intl:n,textValue:h,userTimeZone:(0,s().P)(),deterministic:!1,disableAnnotationPrefix:!0,disableInsertedAnnotations:!1,getRecordModel:o().b.fromGetRecordValueFn(t.defaultRecordCache.inMemoryRecordCache.makeGetRecordValueFn(t.currentUser.id))});if(0===v.trim().length)return;const{sidebarSpaceStore:S,currentUserStore:b}=a().default.state;if(!S||!b)return;(0,c().Wq)({clientStore:u().defaultClientAIChatStore,environment:t});const x=(0,p().Z1)({environment:t,table:l().To,spaceId:S.id});m().uH({environment:t,researchModeThreadId:x,queryLength:v.length,queryWords:v.split(" ").length,searchSessionId:f,qnaSessionId:void 0,source:y,sourceEventId:void 0,suggestedQuery:!1,attachmentCount:0});const I=i().default.checkGate({gateName:"ai_research_mode_use_agent"})?(0,g().getWorkflowAgentConfig)({researchMode:!0,useWebSearch:!0}):(0,c().fI)();(0,d().Iu)({environment:t,query:h,clientStore:u().defaultClientAIChatStore,config:I,surface:"full_page_chat"})}function f(e){const{environment:t,query:n,intl:a}=e;h({environment:t,intl:a,queryTextValue:n,searchSessionId:void 0,entrypoint:"welcome_page"})}},15857:(e,t,n)=>{n.d(t,{a:()=>i});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"1.56 2.35 12.87 11.76",svg:(0,n(474848).jsx)("path",{d:"M10.208 2.35a.625.625 0 0 0 0 1.25h1.175v9.25h-1.175a.625.625 0 0 0 0 1.25h3.6a.625.625 0 1 0 0-1.25h-1.175V3.6h1.175a.625.625 0 1 0 0-1.25zm-4.753.885a.92.92 0 0 0-.86.598l-2.99 8.09a.625.625 0 1 0 1.173.434l.87-2.352h3.614l.869 2.352a.625.625 0 1 0 1.172-.434l-2.99-8.09a.92.92 0 0 0-.858-.598M6.8 8.755H4.11l1.345-3.64z"})},i=(0,n(340498).wt)("textCursorIBeamSmall",a,"small")},15897:(e,t,n)=>{n.d(t,{A:()=>c});n(581454),n(296540);var a=()=>n(401497),i=()=>n(718827),s=()=>n(26697),o=()=>n(100622),r=n(474848);function l(e){const{isFirst:t,isLast:n,isSelected:l,item:c,itemStyle:d,selectedItemStyle:u,innerStyle:p,children:g,colors:m,onClick:h}=e,{isDisabled:f,tooltip:y}=c,v=(0,a().IS)((()=>{const e=(null==m?void 0:m.selectedOutline)??o().Tj.blue.border.accentPrimary,a=(null==m?void 0:m.unselectedOutline)??o().Tj.selectorBorderUnselected;return{SegmentedItem:{alignItems:"center",background:l?null==m?void 0:m.selectedBackground:void 0,borderEndStartRadius:t?3:0,borderEndEndRadius:n?3:0,borderColor:l?e:a,borderStyle:"solid",borderStartStartRadius:t?3:0,borderStartEndRadius:n?3:0,borderWidth:1,cursor:f?void 0:"pointer",display:"flex",flexBasis:"50%",marginInlineStart:t?0:-1,padding:0,userSelect:"none",zIndex:l?10:0,...d,...l?u:void 0},Inner:{borderEndStartRadius:t?2:0,borderEndEndRadius:n?2:0,borderColor:l?e:"transparent",borderStyle:"solid",borderStartStartRadius:t?2:0,borderStartEndRadius:n?2:0,borderWidth:1,display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",padding:"12px 20px",textAlign:"center",width:"100%",...p}}}),[null==m?void 0:m.selectedBackground,null==m?void 0:m.selectedOutline,null==m?void 0:m.unselectedOutline,t,n,l,f,d,u,p]),S=()=>{h&&h(c.key)};return(0,r.jsx)(s().m,{render:e=>(0,r.jsx)(i().Ay,{ariaLabel:c.ariaLabel,"aria-pressed":l,onClick:S,style:v.SegmentedItem,disabled:f,...e,children:(0,r.jsx)("div",{style:v.Inner,children:g})}),renderTooltip:()=>(0,r.jsx)("div",{children:y}),disableTooltip:l||void 0===y,placement:"bottom"})}function c(e){const{items:t=[],itemStyle:n,selectedItemStyle:i,innerStyle:s,outerStyle:c,value:d,onChange:u,colors:p}=e,g=(0,a().IS)((()=>({SegmentedButton:{background:o().Tj.background.elevated,display:"flex",width:"100%",...c}})),[c]);return 0===t.length?null:(0,r.jsx)("div",{style:g.SegmentedButton,children:t.map(((e,a)=>(0,r.jsx)(l,{isFirst:0===a,isLast:a===t.length-1,isSelected:e.key===d,item:e,itemStyle:n,selectedItemStyle:i,innerStyle:s,colors:p,onClick:u,children:e.render()},e.key)))})}},15936:(e,t,n)=>{n.r(t),n.d(t,{checkmarkShieldIcon:()=>s,iconDefinition:()=>i});n(296540);var a=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"3.07 2.17 13.85 15.65",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M12.876 7.978a.625.625 0 0 0-1.072-.643L9.25 11.59 7.815 9.916a.625.625 0 0 0-.95.814l2 2.333a.625.625 0 0 0 1.011-.085z"}),(0,a.jsx)("path",{d:"M10.28 2.241a.63.63 0 0 0-.56 0l-1.889.945a7.5 7.5 0 0 1-3.343.789H3.7a.625.625 0 0 0-.625.625v6.933a5.13 5.13 0 0 0 3.106 4.71l3.573 1.532a.63.63 0 0 0 .492 0l3.573-1.532a5.13 5.13 0 0 0 3.106-4.71V4.6a.625.625 0 0 0-.625-.625h-.788c-1.16 0-2.305-.27-3.343-.79zM8.39 4.304 10 3.499l1.61.805a8.7 8.7 0 0 0 3.902.921h.163v6.308c0 1.55-.924 2.95-2.348 3.562L10 16.52l-3.326-1.425a3.88 3.88 0 0 1-2.349-3.562V5.225h.163c1.355 0 2.69-.315 3.902-.921"})]})},s=(0,n(340498).wt)("checkmarkShield",i,"default")},17849:(e,t,n)=>{n.d(t,{c:()=>s,i:()=>i});var a=()=>n(757695);class i extends a().Store{constructor(){super()}static create(e){const t=new i;return t.setState(e),t}updateState(e){this.setState({...this.state,...e})}}const s=a().Store.createValue({name:"",temperatureOverride:void 0,nudge:""},{name:"currentLabelingTaskStore"})},26080:(e,t,n)=>{n.d(t,{TY:()=>m,dA:()=>g,hl:()=>h});n(16280),n(898992),n(354520),n(430670),n(581454);var a=()=>n(457726),i=()=>n(943290),s=()=>n(925193),o=()=>n(860251),r=()=>n(153996),l=()=>n(798880),c=()=>n(996477),d=()=>n(383070),u=()=>n(483730),p=()=>n(995277);function g(){return"end_to_end"===d().zD.getNamespace()?15:void 0}function m(e){var t;const{sessionId:n,environment:d,previousChatTranscriptStorageStepPointer:p}=e,m=u().default.getSessionContextOrThrow(n),h=null===(t=(0,c().fM)(d))||void 0===t?void 0:t.id;if(!h)throw new Error("No space ID present for conversion operation");const f=d.currentUser.id;if(!f)throw new Error("No user ID present for conversion operation");const y={table:l().oo,id:f,spaceId:h},{createdPageAssistantOperations:v}=function(e){const t=e.getAllPendingExecutableOperations()??[],n=(0,i().iL)(t),a=n.filter(i().BL).flatMap((e=>e.operationIds)),s=t.filter((e=>a.includes(e.id))).map((e=>{const{operations:t,...n}=e;return(0,r().M)({operation:n,id:e.id})}));return{createdPageAssistantOperations:s}}(m),S=null!=m&&m.previewingStateFromStoreState?m.previewingStateFromStoreState.getSerializedState():m.evaluatorFromStoreState.state.getSerializedState();if(!S)throw new Error("No serialized XML evaluator state present for conversion operation");const b=g(),x=b?{...S,version:b}:S,I=m.getCombinedSteps().map((e=>({type:"assistantClient",message:(0,a().og)({step:e})}))),k=[...m.evaluatorFromStoreState.getTranscript()??[],...m.previewingStepFromStoreState?[m.previewingStepFromStoreState]:[]];return{id:(0,s().Qr)(),sessionId:n,parentPointer:y,serializedXMLEvaluatorState:x,serializedTranscriptSteps:k,previousChatTranscriptStorageStepPointer:p,messages:I,assistantOperations:v,operations:[],invertedOperations:[],assistantFeedback:void 0,isCancelled:!1,version:o().Np}}async function h(e,t,n){const{sessionId:a}=await(0,p().p)({environment:n,chatTranscriptStorageStep:e,chatStartTimestamp:t,makeActiveSession:!0});return a}},28070:(e,t,n)=>{n.d(t,{bX:()=>D,ev:()=>P,kp:()=>E});n(944114),n(898992),n(803949),n(581454);var a=()=>n(153321),i=n(296540),s=()=>n(907258),o=()=>n(755531),r=()=>n(242422),l=()=>n(726637),c=()=>n(484714),d=()=>n(590526),u=()=>n(401497),p=()=>n(75435),g=()=>n(695115),m=()=>n(825237),h=()=>n(187174),f=()=>n(804138),y=()=>n(876544),v=()=>n(848392),S=()=>n(995847),b=()=>n(363497),x=()=>n(220719),I=()=>n(69708),k=()=>n(100622),w=()=>n(284371),C=()=>n(518646),A=()=>n(738471),T=()=>n(631611),j=()=>n(752860),M=()=>n(483730),_=n(474848);function P(e){if(!e)return;const t=[];return e.state.inProgressUploadFileIdsToProgress.forEach((e=>{"error"!==e.type&&t.push({status:"in_progress",fileName:e.fileName,uploadPercentage:e.progress,contentType:e.contentType,timeUploaded:e.timeUploaded})})),e.state.originalFileUrlToSuccessfullyUploadedFiles.forEach(((e,n)=>{var a;t.push({status:"complete",fileName:e.fileName,fileUrl:n,contentType:e.contentType,attachmentRisk:(null===(a=e.metadata)||void 0===a||null===(a=a.guardrail)||void 0===a?void 0:a.attachmentRisk)??"skipped",timeUploaded:e.timeUploaded})})),t.sort(((e,t)=>void 0===e.timeUploaded?1:void 0===t.timeUploaded?-1:e.timeUploaded-t.timeUploaded)),t}function D(e){const{containerStyle:t}=e,n=(0,T().jw)(),a=(0,d().K8)((()=>M().default.getActiveSession()),[]),s=function(e){return(0,d().K8)((()=>{if(e)return e.getStagedAttachmentUploadStoreIfExists()}),[e])}(a),o=function(e){return(0,d().K8)((()=>P(e)),[e])}(s),r=(0,i.useCallback)((e=>{s&&a&&(s.onDeleteFileUpload(e),a.unstageAttachmentClientStep(e),a.unstageAttachmentEngineStep(e))}),[s,a]),l=(0,u().IS)((()=>({filePreviewWrapper:{width:"100%",paddingTop:4,paddingBottom:4,...t}})),[t]);return n.isValidSurfaceForAttachmentUploads&&o?0===o.length?null:(0,_.jsx)("div",{style:l.filePreviewWrapper,children:o.map((e=>{const{fileName:t}=e;return(0,_.jsx)(E,{uploadProgress:e,onDeleteFile:"complete"===e.status?()=>r(e.fileUrl):void 0},t)}))}):null}function E(e){const{uploadProgress:t,onDeleteFile:n,showImagePreview:T=!1,aiChatFeatureController:P}=e,{fileName:D,contentType:E}=t,R=(0,c().v3)(),[B,F]=(0,i.useState)(!1),[N,L]=(0,i.useState)(!1),O=(0,d().K8)((()=>{var t;if(e.permissionRecordOverride)return e.permissionRecordOverride;const n=M().default.getActiveSessionId();return{table:b().TF,id:(0,x().o9)(n),spaceId:(0,x().o9)(null===(t=(0,o().S)())||void 0===t?void 0:t.id)}}),[e.permissionRecordOverride]),[{value:V}]=(0,h().Yb)((async()=>{if("in_progress"===t.status)return;var e;if(r().default.checkGate({gateName:"assistant_enable_heic_image_support"}))return(0,m().wY)({url:t.fileUrl,permissionRecord:O,baseUrl:l().A.domainBaseUrl,fullyQualified:!1,userId:null===(e=s().default.state.currentUserStore)||void 0===e?void 0:e.id,width:600});return await(0,C().k)(R,{url:t.fileUrl,download:!1,downloadName:D,permissionRecord:O},Boolean(p().A.state.isNotionProtocolBugFixed))}),[O,t,R,D]);(0,i.useEffect)((()=>{L(!1)}),[V]);const z="agent_mobile"===(null==P?void 0:P.aiChatType),W=(0,u().eP)(),U=(0,u().IS)((()=>({filePreviewWrapper:{backgroundColor:"light"===W?k().Tj.palette.gray[0]:k().Tj.palette.gray[200],borderRadius:12,padding:6,display:"flex",flexDirection:"column",maxWidth:200,position:"relative",cursor:V&&!z?"pointer":void 0,transition:"box-shadow 0.2s ease-in-out",boxShadow:B&&V&&!z?`0 0 0 1px ${k().Tj.border.primary}, 0 3px 8px rgba(0, 0, 0, 0.04)`:`0 0 0 1px ${k().Tj.border.secondary}`},fileInfoWrapper:{display:"flex",alignItems:"center",height:48},iconWrapper:{backgroundColor:k().Tj.gray.background.primary,height:32,minWidth:32,display:"flex",alignItems:"center",justifyContent:"center",width:32,borderRadius:6,marginInlineEnd:8},textWrapperStyles:{...w().RC,fontSize:12,marginInlineEnd:4,maxWidth:140,fontWeight:500,pointerEvents:"none"},closeIcon:{width:10,height:10,fill:k().Tj.text.secondary},closeIconWrapper:{position:"absolute",top:-8,insetInlineEnd:-8,borderRadius:"50%",cursor:"pointer",height:18,width:18},fileIcon:{width:20,height:20,fill:k().Tj.icon.secondary},imagePreview:{maxWidth:184,maxHeight:120,objectFit:"cover",borderRadius:6}})),[V,B,z,W]),H=(0,I().tz)(),K=(0,i.useCallback)((()=>{z||V&&(0,j().L)({environment:R,url:V,targetSelf:!1})}),[R,V,z]),q=D.toLowerCase().endsWith(".csv"),$="application/pdf"===E?y().U:"text/csv"===E||q?f().Q:v().M,G=(0,i.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),null==n||n()}),[n]),Y=(0,i.useCallback)((()=>{F(!0)}),[]),Q=(0,i.useCallback)((()=>{F(!1)}),[]),J=(0,i.useCallback)((()=>{L(!0)}),[]),X=T&&"complete"===t.status&&(e=>"image/png"===e||"image/jpeg"===e||"image/gif"===e||"image/webp"===e||"image/heic"===e)(E)&&V&&!N;return(0,_.jsxs)("div",{onClick:K,style:U.filePreviewWrapper,onMouseEnter:Y,onMouseLeave:Q,children:[X?(0,_.jsx)(A().A,{src:V,alt:D,style:U.imagePreview,onError:J}):(0,_.jsxs)("div",{style:U.fileInfoWrapper,children:[(0,_.jsx)("div",{style:U.iconWrapper,children:$(U.fileIcon)}),(0,_.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,_.jsx)("div",{style:U.textWrapperStyles,children:D}),"in_progress"===t.status?(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,_.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",children:[(0,_.jsx)(a().P.circle,{cx:"12",cy:"12",r:"10",fill:"none",stroke:"#e0e0e0",strokeWidth:"2"}),(0,_.jsx)(a().P.circle,{cx:"12",cy:"12",r:"10",fill:"none",stroke:"blue",strokeWidth:"2",strokeLinecap:"round",initial:{pathLength:0},animate:{pathLength:t.uploadPercentage/100},transition:{duration:.5,ease:"easeInOut"},style:{rotate:-90,transformOrigin:"center"}})]}),(0,_.jsx)("div",{style:{fontSize:12,paddingInlineStart:4},children:(0,_.jsx)(I().sA,{defaultMessage:"{uploadPercentage}%",values:{uploadPercentage:t.uploadPercentage},id:"AssistantRichTextInput.attachmentUpload.uploadPercentage"})})]}):void 0]})]}),n?(0,_.jsx)(g().A,{icon:S().xMarkSmallIcon,iconStyle:U.closeIcon,style:U.closeIconWrapper,hasBackground:!0,colorVariant:"primary",hovered:!1,showShadow:!0,onClick:G,ariaLabel:H.formatMessage({id:"discussionInputAttachment.removeFileButton.label",defaultMessage:"Remove file"})}):void 0]})}},30154:(e,t,n)=>{n.d(t,{At:()=>C,Pc:()=>A,RP:()=>E,RV:()=>_,Uz:()=>P,Yd:()=>T,sj:()=>D,startDailyBriefChat:()=>j,y7:()=>w});n(16280);var a=()=>n(907258),i=()=>n(755531),s=()=>n(295633),o=()=>n(463086),r=()=>n(785728),l=()=>n(388821),c=()=>n(427704),d=()=>n(679927),u=()=>n(201980),p=()=>n(530199),g=()=>n(498212),m=()=>n(939768),h=()=>n(769864),f=()=>n(72234),y=()=>n(526905),v=()=>n(555102),S=()=>n(557297),b=()=>n(547149),x=()=>n(687879),I=()=>n(46986),k=()=>n(866805);const w="2ae17954-d9c2-807e-864e-f70fa5f34f6b";function C(){var e;const t=a().default.state.sidebarSpaceViewStore,n=(0,i().S)();if(!t||!n)return{hasThreadForToday:!1};const s=t.getSettings(),r=null==s||null===(e=s.agent_personalization_settings)||void 0===e?void 0:e.daily_brief_prompt,l=null==r?void 0:r.latest_daily_brief_thread_id;if(!l)return{hasThreadForToday:!1};const c=o().E.createChildStore(n,{table:"thread",id:l,spaceId:n.id});if(!c.isDefined()||!c.getAlive())return{hasThreadForToday:!1};const d=c.getCreatedTime(),u=y().b9(Date.now()),p=y().b9(d)===u;return{hasThreadForToday:p,existingThreadId:p?l:void 0}}async function A(e){const{environment:t,showChatSidebarSource:n,navigationMethod:a,navigate:s}=e;if(!(0,I().re)())return;const{hasThreadForToday:r,existingThreadId:l}=C();if(r&&l){if("route"===a){if(!s)throw new Error("navigate function is required when navigationMethod is 'route'");s({environment:t,url:(0,m().Gm)({url:c().JZ.chat,query:{[p().P5]:(0,g().Xw)(l)}})})}else{const e=v().bX.state;if(null!=e&&e.blockStore&&e.spaceStore){const{openChatPanel:a}=await S().nO.chatSidebarActions.load();a({environment:t,store:e.blockStore,chatPanelState:{isOpen:!0,threadId:l},source:n})}}await D({environment:t,threadId:l});const e=(0,i().S)();return e?o().E.createChildStore(e,{table:"thread",id:l,spaceId:e.id}):void 0}const d="route"===a,u=await j({environment:t,showChatSidebarSource:n,skipOpeningPanel:d});if(u){if("route"===a){if(!s)throw new Error("navigate function is required when navigationMethod is 'route'");s({environment:t,url:(0,m().Gm)({url:c().JZ.chat,query:{[p().P5]:(0,g().Xw)(u.id)}})})}return d&&await D({environment:t,threadId:u.id}),u}}async function T(e){var t;const{environment:i,onPageCreated:o}=e,{sidebarSpaceViewStore:c,sidebarSpaceStore:u}=a().default.state;if(!u||!c)return;const p=c.getSettings(),g=null==p||null===(t=p.agent_personalization_settings)||void 0===t||null===(t=t.daily_brief_prompt)||void 0===t?void 0:t.page_id;if(g){const e=s().B.createChildStore(u,{table:"block",id:g,spaceId:u.id});if(e.isDefined()&&e.getAlive())return o&&o(g,u.id),g}try{const e=await h().callApi({eventName:"loadBlockSubtree",environment:i,data:{block:{id:w,spaceId:d().rQ},shallow:!1},headers:(0,r().WS)({spaceId:d().rQ})});if("failed"===e.type)return;const t=l().RecordMapWithRole.create(e.data.subtreeRecordMap),{createAndDuplicatePageInSpace:a}=await Promise.all([n.e(35530),n.e(9773),n.e(36556),n.e(40537),n.e(27992),n.e(63452),n.e(66249),n.e(92845),n.e(44854),n.e(87017),n.e(47668),n.e(48486),n.e(37045)]).then(n.bind(n,533705)),{performResult:s,serverCommitResult:p}=b().createAndCommit({environment:i,userAction:"dailyBriefActions.getOrCreateDailyBriefPage",canUndo:!0,perform:e=>{const n=a({environment:i,spaceStore:u,spaceViewStore:c,transaction:e,copyPageId:w,recordMap:t,isPrivate:!0,allowCopyExternalObjectInstances:!0}),s=c.getSettings()||{},o={...s,agent_personalization_settings:{...s.agent_personalization_settings||{},daily_brief_prompt:{page_id:n.id,last_updated_from_template:Date.now()}}};return f().AG(c,e,o),n}});return await p,null!=s&&s.id&&o&&o(s.id,u.id),null==s?void 0:s.id}catch(m){return}}async function j(e){const{environment:t,showChatSidebarSource:a,skipOpeningPanel:i}=e;if(!(0,I().re)())return;const s=v().bX.state;if(!s||!s.blockStore||!s.spaceStore)return;if(!i){const{globalChatPanelRuntimeStore:e}=await Promise.resolve().then(n.bind(n,981475)),{openChatPanel:i}=await S().nO.chatSidebarActions.load();e.setState({...e.state,isLoadingDependencies:!0}),i({environment:t,store:s.blockStore,chatPanelState:{isOpen:!0,isNewThread:!0},source:a})}let o;try{const e=await T({environment:t});if(!e)return;const n=[(0,u().Ey_)("Follow the prompt: "),(0,u().wmz)((0,u().ld4)(e,s.spaceStore.id))],r=(0,v().Kf)({environment:t,spaceStore:s.spaceStore,userStore:s.userStore,value:n}),l=await(0,k().Jl)({environment:t,spaceId:s.spaceStore.id}),c=(0,v().Xd)({environment:t,inferenceContext:s,addSteps:[r],surface:"daily_brief_reminder",config:l});if(o=(0,x().addTranscriptToNewThreadAndRun)({environment:t,spaceStore:s.spaceStore,transcript:c,createdSource:"daily_brief_reminder"}),i)await function(e){return M({environment:e.environment,userAction:"dailyBriefActions.setLatestDailyBriefThreadId",updatePromptSettings:t=>({...t||{},latest_daily_brief_thread_id:e.threadId})})}({environment:t,threadId:o.id});else{const{openChatPanel:e}=await S().nO.chatSidebarActions.load();e({environment:t,store:s.blockStore,chatPanelState:{isOpen:!0,threadId:o.id},source:a}),await D({environment:t,threadId:o.id})}}finally{if(!i){const{globalChatPanelRuntimeStore:e}=await Promise.resolve().then(n.bind(n,981475));e.setState({...e.state,isLoadingDependencies:!1})}}return o}function M(e){var t;const{environment:n,userAction:i,updatePromptSettings:s}=e,{sidebarSpaceViewStore:o}=a().default.state;if(!o)return Promise.resolve(void 0);const r=o.getSettings();if(!r)return Promise.resolve(void 0);const l={...r,agent_personalization_settings:{...r.agent_personalization_settings||{},daily_brief_prompt:s(null===(t=r.agent_personalization_settings)||void 0===t?void 0:t.daily_brief_prompt)}},{serverCommitResult:c}=b().createAndCommit({environment:n,userAction:i,canUndo:!0,perform:e=>{f().AG(o,e,l)}});return c}function _(e){return M({environment:e.environment,userAction:"dailyBriefActions.markDailyBriefNudgeDismissed",updatePromptSettings:e=>({...e||{},tooltip_dismissed_at:Date.now()})})}function P(e){return M({environment:e.environment,userAction:"dailyBriefActions.markSidebarDailyBriefDismissed",updatePromptSettings:e=>({...e||{},sidebar_daily_brief_dismissed_at:Date.now()})})}function D(e){return M({environment:e.environment,userAction:"dailyBriefActions.setLatestDailyBriefThreadIdAndClicked",updatePromptSettings:t=>({...t||{},latest_daily_brief_thread_id:e.threadId,prompt_clicked_at:Date.now()})})}function E(e){return M({environment:e.environment,userAction:"dailyBriefActions.clearLatestDailyBriefThreadId",updatePromptSettings:e=>({...e||{},latest_daily_brief_thread_id:void 0,prompt_clicked_at:void 0})})}},30757:(e,t,n)=>{n.d(t,{W:()=>d});n(296540);var a=()=>n(970236),i=()=>n(26697),s=()=>n(69708),o=()=>n(110443),r=()=>n(977680),l=n(474848);const c=(0,s().YK)({mcpBadge:{id:"mcpToolsInline.mcpBadge",defaultMessage:"MCP"},customMcpBadge:{id:"mcpProtocolBadge.customMcpBadge",defaultMessage:"Custom MCP"},customMcpBadgeTooltip:{id:"mcpProtocolBadge.customMcpBadgeTooltip",defaultMessage:"Notion has not reviewed this server"}});function d(e){const{serverUrl:t}=e,{serverUrls:n}=(0,r().z)(),d=t?(0,o().Yl)(t):void 0,u=void 0!==d&&n.has(d),p=!!t&&(0,o().oB)(t),g=Boolean(t)&&n.size>0&&!u&&!p,m=g?(0,l.jsx)(s().sA,{...c.customMcpBadge}):(0,l.jsx)(s().sA,{...c.mcpBadge}),h=(0,l.jsx)(a().E,{color:"gray",content:m});return g?(0,l.jsx)(i().m,{placement:"top",renderTooltip:()=>(0,l.jsx)(s().sA,{...c.customMcpBadgeTooltip}),render:e=>(0,l.jsx)("span",{...e,children:h})}):h}},32043:(e,t,n)=>{n.d(t,{K1:()=>B,LR:()=>F,XT:()=>D,Y4:()=>N,mI:()=>R,sj:()=>P});n(898992),n(672577),n(581454);var a=n(296540),i=()=>n(907258),s=()=>n(726637),o=()=>n(484714),r=()=>n(590526),l=()=>n(295633),c=()=>n(695115),d=()=>n(26697),u=()=>n(584262),p=()=>n(172385),g=()=>n(908521),m=()=>n(349679),h=()=>n(297813),f=()=>n(696706),y=()=>n(179034),v=()=>n(69708),S=()=>n(496603),b=()=>n(534177),x=()=>n(108066),I=()=>n(710648),k=()=>n(507463),w=()=>n(631611),C=()=>n(870310),A=()=>n(492414),T=()=>n(544303),j=()=>n(712505),M=n(474848);const _=(0,v().YK)({acceptEditsAriaLabel:{id:"assistantGroupedEditsRenderer.acceptEditsAriaLabel",defaultMessage:"Accept edits"},rejectEditsAriaLabel:{id:"assistantGroupedEditsRenderer.rejectEditsAriaLabel",defaultMessage:"Discard edits"},acceptAllEdits:{id:"assistantGroupedEditsRenderer.acceptAllEdits",defaultMessage:"Accept all edits"},rejectAllEdits:{id:"assistantGroupedEditsRenderer.rejectAllEdits",defaultMessage:"Discard all edits"},acceptSingleEdit:{id:"assistantGroupedEditsRenderer.acceptSingleEdit",defaultMessage:"Accept edit"},rejectSingleEdit:{id:"assistantGroupedEditsRenderer.rejectSingleEdit",defaultMessage:"Discard edit"}});function P(e){const{pageStore:t,property:n}=e,a=function(e){const{blockStore:t,property:n}=e,a=(0,o().v3)();return(0,r().K8)((()=>{var e,i;const s=null===(e=a.defaultRecordCache.inMemoryRecordCache.getEntry({pointer:t.pointer,userId:a.currentUser.id},{ignoreAllCaches:!0}))||void 0===e||null===(e=e.value)||void 0===e?void 0:e.value;return null==s||null===(i=s.properties)||void 0===i?void 0:i[n]}),[a,t.pointer,n])}({blockStore:t,property:n}),i=(0,r().K8)((()=>t.getAssociatedCollectionStore()),[t]),s=(0,r().K8)((()=>{const e=null==i?void 0:i.getSchema(),t=Object.entries(e||{}).find((([e])=>e===n));return null==t?void 0:t[1]}),[i,n]),l=(0,r().K8)((()=>t.getPropertyValue(n)),[t,n]),c=(0,r().K8)((()=>null==i?void 0:i.getSpaceId()),[i]);return i&&s&&c?(0,M.jsx)(I().RD,{labeled:!0,name:s.name,type:s.type,icon:s.icon,style:{marginBottom:6},children:(0,M.jsx)(C().A,{propertySchema:s,beforeValue:{value:a||[],spaceId:c},afterValue:{value:l||[],spaceId:c},rootStore:t})}):null}function D(e){const{blockIds:t,parentStore:n,spaceId:i,shouldReverse:s}=e,o=s?S().o8(t).reverse():t,c=(0,a.useMemo)((()=>o.map((e=>l().B.createChildStore(n,{table:y().ev,id:e,spaceId:i})))),[o,n,i]),d=(0,r().K8)((()=>(0,T().WN)({blockIds:o,parentStore:n})),[o,n]);return(0,M.jsx)(a.Fragment,{children:c.map(((e,t)=>(0,M.jsx)(E,{store:e,numberedLists:d},t)))})}function E(e){const{store:t,numberedLists:n}=e,i=(0,a.useRef)(),s=(0,r().K8)((()=>(0,k().B)(t)),[t]),o=(0,r().K8)((()=>t.getType()),[t]),l=(0,r().r6)((()=>({depth:0,numberedListBlockIdsMap:n.find((e=>e.has(t.id)))??new Map})),[n,t.id]);return s?(0,M.jsx)(x().I,{store:t,type:o,children:(0,M.jsx)(s,{blockRef:i,store:t,disabled:!0,isFirstItem:!1,isLastItem:!1,disableCommentMenu:!0,numberedListCounterStore:l,overrideHeaderFontSizes:g().T$})}):null}function R(e,t={}){const n=(0,o().v3)();return(0,r().K8)((()=>{const{route:a}=n.RouterStore.state;return"chat"===a.name||"quickSearch"===a.name?(0,p().EY)({isMobile:s().A.isMobile,currentRoute:a,pageId:e.id,pageVisitSource:u().y8.AIChat,scrollToBlockId:t.scrollToBlockId}):(0,A().Ay)({store:e,pageVisitSource:u().y8.AIChat,fullyQualified:!1,scrollToBlockId:t.scrollToBlockId})}),[e,n,t.scrollToBlockId])}function B(e){const t=(0,w().jw)();return(0,r().K8)((()=>{if(!t.canUseCurrentPageContext)return!1;const n={id:e,table:y().ev},{mainEditorCurrentBlockStore:a}=i().default.state;return!(!a||!f().L3.isEqualIdTable(a.pointer,n))||!(!j().default.state.open||!f().L3.isEqualIdTable(j().default.state.targetStore.pointer,n))}),[e,t])}function F(e){const{style:t,onClick:n,variant:a}=e,i=(0,v().tz)();let s;(0,b().O9)(a)?"all"===a?s=_.acceptAllEdits:"single"===a?s=_.acceptSingleEdit:(0,b().HB)(a):s=_.acceptEditsAriaLabel;const o=i.formatMessage(s);return(0,M.jsx)(d().m,{renderTooltip:()=>o,render:e=>(0,M.jsx)(c().A,{ariaLabel:o,icon:m().checkmarkSmallIcon,onClick:n,style:t,...e})},"acceptEdits")}function N(e){const{style:t,onClick:n,variant:a}=e,i=(0,v().tz)();let s;(0,b().O9)(a)?"all"===a?s=_.rejectAllEdits:"single"===a?s=_.rejectSingleEdit:(0,b().HB)(a):s=_.rejectEditsAriaLabel;const o=i.formatMessage(s);return(0,M.jsx)(d().m,{renderTooltip:()=>o,render:e=>(0,M.jsx)(c().A,{style:t,ariaLabel:o,onClick:n,icon:h().xMarkFillIcon,...e})},"rejectEdits")}},34303:(e,t,n)=>{n.d(t,{A:()=>v});var a=n(296540),i=()=>n(933922),s=()=>n(756117),o=()=>n(787470),r=()=>n(484714),l=()=>n(401497),c=()=>n(695115),d=()=>n(31511),u=()=>n(207207),p=()=>n(69708),g=()=>n(100622),m=()=>n(284371),h=()=>n(701763),f=()=>n(888643),y=n(474848);function v({handleSearchQueryChange:e,handleEnterPressed:t,handleInputCleared:n,currentTab:v,isSearchBarAlwaysOpen:S,buttonSize:b=28}){const x=(0,r().v3)(),{styles:I,isSearchOpen:k,intl:w,handleSearchButtonClick:C,handleSearchDismiss:A,searchQuery:T,setSearchQuery:j}=function({handleSearchQueryChange:e,handleInputCleared:t,currentTab:n,isSearchBarAlwaysOpen:i,buttonSize:s}){const o=(0,l().IS)((()=>({searchIcon:{width:14,height:void 0,fill:g().Tj.text.secondary},topbarIconButton:{display:"flex",alignItems:"center",fontSize:14,height:s,width:s,padding:6,color:g().Tj.text.secondary,fill:g().Tj.icon.secondary,fontWeight:m().Wy.regular,lineHeight:1,borderRadius:4},searchInput:{fontSize:14,lineHeight:1,paddingInlineEnd:4,color:g().Tj.text.primary,marginBottom:1}})),[s]),c=(0,r().v3)(),[d,u]=(0,a.useState)(!1),[f,y]=(0,a.useState)(void 0),v=(0,a.useCallback)((()=>{u(!0),n&&h().Z9(c,{current_tab:n})}),[c,n]),S=(0,a.useCallback)((()=>{u(!1),y(void 0),e(void 0),null==t||t()}),[e,t]),b=(0,p().tz)();return{styles:o,isSearchOpen:d||i,intl:b,handleSearchButtonClick:v,handleSearchDismiss:S,searchQuery:f,setSearchQuery:y}}({handleSearchQueryChange:e,handleInputCleared:n,currentTab:v,isSearchBarAlwaysOpen:S,buttonSize:b});return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(c().A,{ariaLabel:w.formatMessage({id:"searchPlaceholder",defaultMessage:"Type to search..."}),icon:u().magnifyingGlassIcon,size:"md",style:I.topbarIconButton,onClick:C,disableBackground:S}),(0,y.jsx)(s().A,{visible:k,animate:{width:150,opacity:1},initial:{width:0,opacity:0},exit:{width:0,opacity:0},skip:S,children:(0,y.jsx)(i().A,{capture:k,allowEsc:!0,render:n=>(0,y.jsx)("div",{style:{display:"flex",alignItems:"center",overflow:"hidden"},...n,children:(0,y.jsx)(d().A,{style:I.searchInput,format:"transparent",value:T,onChange:t=>{const n=t.target.value;j(n),e(n)},placeholder:w.formatMessage({id:"searchPlaceholder",defaultMessage:"Type to search..."}),focusInitial:k,showClearButton:!0,onCancel:A,onClick:f().k,onClearButtonClick:A,onKeyDown:e=>{27===e.keyCode&&A(),t&&(0,o().A)(x,e,"enter")&&t()},onBlur:()=>{!T&&A()}})})})})]})}},37142:(e,t,n)=>{n.d(t,{x:()=>i});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"3.09 2.55 9.81 10.89",svg:(0,n(474848).jsx)("path",{d:"M11.762 3.338a2.657 2.657 0 0 0-3.758 0L4.172 7.17a3.673 3.673 0 0 0 5.195 5.195l3.353-3.353a.625.625 0 0 0-.884-.884L8.484 11.48a2.423 2.423 0 1 1-3.427-3.427l3.832-3.832a1.407 1.407 0 0 1 1.99 1.99l-3.832 3.832a.391.391 0 0 1-.553-.553L8.41 7.575a.625.625 0 1 0-.884-.884L5.61 8.607a1.641 1.641 0 1 0 2.321 2.32l3.832-3.831a2.657 2.657 0 0 0 0-3.758"})},i=(0,n(340498).wt)("paperClipSmall",a,"small")},40785:(e,t,n)=>{n.r(t),n.d(t,{bubbleEllipsesIcon:()=>s,iconDefinition:()=>i});n(296540);var a=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"2.37 3.63 15.25 14.86",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M6.75 10.38a.875.875 0 1 0 0-1.75.875.875 0 0 0 0 1.75m4.125-.875a.875.875 0 1 1-1.75 0 .875.875 0 0 1 1.75 0m2.375.875a.875.875 0 1 0 0-1.75.875.875 0 0 0 0 1.75"}),(0,a.jsx)("path",{d:"M17.625 5.755A2.125 2.125 0 0 0 15.5 3.63h-11a2.125 2.125 0 0 0-2.125 2.125v7.5c0 1.173.951 2.125 2.125 2.125h1.188v2.482a.625.625 0 0 0 1.006.496l3.87-2.978H15.5a2.125 2.125 0 0 0 2.125-2.125zM15.5 4.88c.483 0 .875.392.875.875v7.5a.875.875 0 0 1-.875.875h-5.148a.63.63 0 0 0-.38.13l-3.034 2.333v-1.838a.625.625 0 0 0-.625-.625H4.5a.875.875 0 0 1-.875-.875v-7.5c0-.483.392-.875.875-.875z"})]})},s=(0,n(340498).wt)("bubbleEllipses",i,"default")},42452:(e,t,n)=>{n.d(t,{E:()=>f,t:()=>y});n(16280),n(18107),n(944114),n(967357);var a=()=>n(755531),i=()=>n(206267),s=()=>n(792071),o=()=>n(973647),r=()=>n(834281),l=()=>n(525569),c=()=>n(605804),d=()=>n(996477),u=()=>n(483730),p=()=>n(995277),g=()=>n(685453),m=()=>n(150984),h=()=>n(830010);async function f(e){const{environment:t,keepVisualSteps:n,assistantSurface:a}=e,r=e.sessionId??u().default.getActiveSessionId(),g=r?u().default.getSessionContext(r):void 0;if(!g)return{error:"No active session available to reset."};const f=g.evaluatorFromStoreState,y=f.getTranscript(),v=(0,c().Wj)({currentSteps:y,stepType:"human"});if(o().Q.isFail(v))return{error:v.error};const S=v.value.previousStep,b=v.value.newSteps;g.hasPendingOperations()&&await(0,h().rejectEdits)({environment:t,inferenceId:i().JW(),sessionContext:g,assistantSurfaceType:a.type});const x=g.getCombinedSteps(),I=(0,c().Wj)({currentSteps:x,stepType:"human"});let k;if(o().Q.isSuccess(I))k=I.value.previousStep.text;else{const e=(0,d().fM)(t);k=(0,c().ND)({step:S,evaluatorState:f.state,getRecordModel:(null==e?void 0:e.getRecordModel)??s().b4_.constant(void 0)})}const{sessionId:w}=await(0,p().p)({environment:t,...g.sessionMetadata,deepFindRequested:g.assistantConfigurationStoreState.deepFindRequested,makeActiveSession:!1,temporaryUserInputData:g.getTemporaryUserInputData()}),C=u().default.getSessionContextOrThrow(w);if(!n){const e=x.at(x.length-1),t="assistantScopeChange"===(null==e?void 0:e.type)?e:void 0;if(o().Q.isSuccess(I)){const e=I.value.newSteps;t&&e.push(t),C.setClientStepsAndClearPreviewingStep(e)}}C.assistantConfigurationStore.setSearchScope(e.searchScope??g.assistantConfigurationStoreState.searchScope);if(C.evaluatorFromStoreState.setTranscript(b),a.isWriter){const e=l().default.state;"assistantCompletionPopup"===e.type&&l().default.setState({...e,sessionId:C.sessionIdFromStoreState})}else u().default.update((e=>({...e,activeAiSessionId:C.sessionIdFromStoreState}))),(0,m().fireAndForgetUpsertStepToChatSessionHistory)({environment:t,sessionId:C.sessionIdFromStoreState,assistantSurfaceType:a.type}),(0,m().deleteAssistantChatSession)({environment:t,sessionId:g.sessionIdFromStoreState});return{value:{textValue:k,sessionId:C.sessionIdFromStoreState}}}async function y(e){var t;const{environment:n,sessionId:s,assistantSurfaceType:o}=e,l=u().default.getSessionContextOrThrow(s),c=(0,a().S)(),{assistantConfigurationStore:d}=l;if(!c)throw new Error("No space store.");l.clearPreviewingStep(),d.setState({...d.state,retrying:!0});const p=i().JW();await(0,g().H)({environment:n,inferenceId:p,sessionId:s,assistantSurfaceType:o,inferenceStartMetadata:{source:void 0,mentionsUsed:void 0,skillType:void 0},inferenceEndMetadata:{parentStore:c,skillType:void 0,wasSkillSuggested:void 0}});const m=null===(t=(0,a().S)())||void 0===t?void 0:t.id;m&&r().completionActions.maybeUpdateAiEligibility(n,m)}},44971:(e,t,n)=>{n.d(t,{A:()=>s});n(898992),n(354520),n(737550);class a extends(()=>n(757695))().Store{getInitialState(){return{spaceId:void 0,sessionInfos:[],initialFetchComplete:!1,isFetching:!1}}getSessionsForSpace(e){return e===this.state.spaceId?this.state.sessionInfos:[]}doesSpaceHaveTrackedSession(e,t){return this.getSessionsForSpace(e).some((e=>e.id===t))}setSessionInfos(e,t){this.update((n=>({...n,spaceId:e,sessionInfos:t})))}removeSession(e,t){this.update((n=>({...n,spaceId:e,sessionInfos:this.getSessionsForSpace(e).filter((e=>e.id!==t))})))}maybeAddKnownSession(e,t){const a=this.getSessionsForSpace(e);if(!a.some((e=>e.id===t))){const i={id:t,createdTime:Date.now()};return this.update((t=>({...t,spaceId:e,sessionInfos:n(496603).Ul([i,...a],(e=>-e.createdTime))}))),!0}return!1}}const i=new a;(0,n(852832).exposeDebugValue)("AssistantChatHistoryStore",i);const s=i},46124:(e,t,n)=>{n.d(t,{L:()=>i});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"2.12 3.07 15.76 14.35",svg:(0,n(474848).jsx)("path",{d:"M7.663 5.794a2.77 2.77 0 1 1-5.539 0 2.77 2.77 0 0 1 5.539 0m.697 0a.55.55 0 0 1 .55-.55h.098a.55.55 0 0 1 0 1.1h-.097a.55.55 0 0 1-.55-.55m2.053 0a.55.55 0 0 1 .55-.55h.098a.55.55 0 0 1 0 1.1h-.098a.55.55 0 0 1-.55-.55m2.952 3.026a.55.55 0 0 1 .2.752l-.049.085a.55.55 0 1 1-.952-.552l.05-.084a.55.55 0 0 1 .75-.2M6.606 8.82a.55.55 0 0 1 .752.201l.049.084a.55.55 0 0 1-.952.552l-.049-.085a.55.55 0 0 1 .2-.751m5.734 1.772a.55.55 0 0 1 .2.752l-.05.084a.55.55 0 1 1-.951-.551l.049-.085a.55.55 0 0 1 .751-.2m-4.706 0a.55.55 0 0 1 .751.2l.05.085a.55.55 0 0 1-.953.551l-.048-.084a.55.55 0 0 1 .2-.752m10.243-4.799a2.77 2.77 0 1 1-5.539 0 2.77 2.77 0 0 1 5.539 0m-5.106 8.862a2.77 2.77 0 1 1-5.54 0 2.77 2.77 0 0 1 5.54 0"})},i=(0,n(340498).wt)("integrationFill",a,"fill")},47942:(e,t,n)=>{n.d(t,{m:()=>s});n(296540);var a=()=>n(318670),i=n(474848);function s(e){const{step:t,clientStore:n,threadStore:s,runningInference:o}=e;if(!t.displayMessage)return null;const r={id:t.id,type:"user",value:t.displayMessage,userId:t.userId||"",createdAt:t.createdAt};return(0,i.jsx)(a().IT,{step:r,clientStore:n,threadStore:s,runningInference:o})}},50744:(e,t,n)=>{n.d(t,{f:()=>G});n(16280),n(18107),n(813451),n(967357),n(898992),n(354520),n(581454),n(737550);var a=()=>n(792057),i=()=>n(24279),s=()=>n(181856),o=()=>n(206267),r=()=>n(319625),l=()=>n(496603),c=()=>n(763824),d=()=>n(662453),u=()=>n(108184),p=(n(672577),n(430670),()=>n(711339)),g=()=>n(412412),m=()=>n(353566),h=()=>n(973647),f=()=>n(534177);const y=l().Bj((()=>new RegExp(`^<(${Object.keys(m().N).join("|")})`)));function v(e){const t=(0,h().j)((()=>(0,g().BD)(e.value)));if(h().Q.isFail(t))return[];const n=[...(0,f().uv)(m().Yh)];return t.value.map((e=>"element"===e.type&&(0,f().Xk)(n,e.tagName)?e.tagName:void 0)).filter(f().O9)}function S(e){const t=l().Kl(e,(e=>"human"===e.type));if(t<0)return[];return e.slice(t+1).flatMap((e=>"assistant"===e.type?v(e):[]))}function b(e){return 0===e.length?"none":e.length>2?"many":e.map((e=>l().LW(e))).sort().join("_")}function x(e){var t;const{evaluator:n,currentStep:a,currentId:i,environment:s,assistantSessionContext:o}=e,r=null===(t=o.sampledStepsFromStoreState.find((e=>e.id===i)))||void 0===t?void 0:t.value;if(r&&!y().test(r)&&y().test(a.value)){const e=S(n.getTranscript());p().default.DO_NOT_USE_measureLegacy("assistant.time_to_effect",{environment:s,data:{assistant_num_apis:e.length,assistant_apis_used:b(e)}})}}var I=()=>n(383070),k=()=>n(483730),w=()=>n(918678),C=()=>n(259091),A=(n(410838),()=>n(564884)),T=()=>n(755531),j=()=>n(563217),M=()=>n(416504),_=()=>n(785728),P=()=>n(441738),D=()=>n(532659),E=()=>n(769864),R=()=>n(539803),B=()=>n(551345),F=()=>n(29554),N=()=>n(68465),L=()=>n(122058),O=()=>n(101927),V=()=>n(263542),z=()=>n(17849),W=()=>n(412669),U=()=>n(162437),H=()=>n(808725);async function K(e){const{environment:t,sessionId:n,updater:i,source:s,inferenceId:r,assistantSurfaceType:l}=e,c=k().default.getSessionContextOrThrow(n),d=(0,C().x)(t),{evaluatorFromStoreState:p,assistantConfigurationStore:m}=c,h=m.state;i.write((()=>{c.setSampledSteps([{id:0,type:"assistant",inferenceId:r,value:""}]),m.setState({...m.state,sampling:!0})}));const f=(0,N().cJ)(),y=I().zD.getMode(),v={webSearchEnabled:I().zD.canShowWebSearchScopeForAssistant()},S=performance.now(),b=(0,B().or)({configurationState:h}),x=!I().zD.isQueryGenDisabled(),w={version:1,state:p.state.getSerializedState(),transcript:p.getTranscript(),spaceId:d.id,analytics:{sessionId:n,inferenceId:r,assistantSurface:l,openedFrom:V().P.state.from},searchScope:h.searchScope,userTimeZone:(0,M().P)(),useUncited:!0,useLangXmlTag:!0,useMarkdown:I().zD.shouldUseMarkdown(),...I().zD.canUseAssistantDebugTools()?{devOnly:{mode:"control"===y?j().Nh:y,isLabelerMode:f,nudge:f?z().c.state.nudge:void 0,temperature:f?z().c.state.temperatureOverride:void 0,labelingTaskType:f?z().c.state.name:void 0,debugOverrides:v,model:(0,O().DE)(t)}}:{},...b?{deepFind:{shouldDoQueryGen:x}}:{}},K=await E().callStreamApi({eventName:"runAssistantV2",environment:t,data:w,headers:(0,_().WS)({cellId:void 0,spaceId:d.id})}),q=performance.now();if("success"!==K.type)return a().Qg(K),{type:"error_modal_shown"};let $,G,Y,Q,J,X,Z="",ee=!1,te=!1,ne=!1,ae=!1,ie=!1;const se=async()=>{if(ee||!Z||ie)return;const e=Math.max(u().PREVIEW_STEP_DELAY,X??0);if(!(void 0!==J&&Date.now()-J<e))try{ie=!0;const e=performance.now();await(0,H().T)({environment:t,step:{id:0,type:"assistant",namespace:Y||"router",value:Z},commit:!1,isStreaming:!0,inferenceId:r,sessionId:n,updater:i}),X=performance.now()-e}finally{ie=!1,J=Date.now()}};if(D().hS.is(K.data))for await(const a of K.data){if(!i.isValid())return;if("value"in a&&(0,R().s)({environment:t,eventName:"runAssistantV2",response:a.value}),"error"===a.type){if(P().Nf(a.errorCode)){var oe;const e=null===(oe=(0,T().S)())||void 0===oe?void 0:oe.id;e&&await u().maybeUpdateAiEligibility(t,e),W().K.setState(!0),te=!0;break}(0,u().showCompletionErrorWithCode)(a.errorCode);break}if("partial_assistant_step"===a.type)void 0===$&&($=performance.now()),b&&m.state.searchSessionId&&"chat"===a.namespace&&!ae&&((0,L().S9)({assistantSessionId:c.sessionIdFromStoreState,searchSessionId:m.state.searchSessionId,timeSinceTurnStartMs:performance.now()-S,threadId:void 0,environment:t}),ae=!0),Z+=a.value,Y=a.namespace,se();else if("assistant_step"===a.type)void 0===$&&($=performance.now()),Z="",G={id:0,type:"assistant",namespace:a.namespace,value:a.value,inferenceId:r},c.setSampledSteps([G]),(0,U().$)({environment:t,inferenceId:r,type:"assistant_step",sessionId:n,source:s});else if("assistant_error"===a.type)ne=!0,i.write((()=>{c.addClientStep({type:"assistantRetry",inferenceId:o().JW()})}));else if("search"===a.type){const e=p.state;m.setState({...m.state,sampling:!1}),await e.performSearch(a.value,!1),m.setState({...m.state,sampling:!0}),c.setShowGetSupportPill(Boolean(a.value.maybeNotionHelp))}else if("search_results"===a.type){const e=p.state;if(b){if("notion"===a.value.deepFindTabType)m.state.searchSessionId&&(0,L().hp)({environment:t,assistantSessionId:c.sessionIdFromStoreState,searchSessionId:m.state.searchSessionId,threadId:void 0,traceId:void 0,showResults:!0,timeSinceTurnStartMs:performance.now()-S}),e.handleSearchResponse({response:{data:a.value,type:"success",status:200,headers:{}},shouldUseDeepFindBehavior:{shouldReplaceInsteadOfUpsert:!1}});else if(void 0===a.value.deepFindTabType){if(b&&m.state.searchSessionId){const e=c.clientStepsFromStoreState.findLast((e=>"human"===e.type)),n=(0,F().r4)(null==e?void 0:e.text,d);(0,L().uu)({assistantSessionId:c.sessionIdFromStoreState,searchSessionId:m.state.searchSessionId,results:a.value.results,queryLength:n.length,queryWords:n.split(" ").length,timeToResult:performance.now()-q,environment:t})}e.handleSearchResponse({response:{data:a.value,type:"success",status:200,headers:{}},shouldUseDeepFindBehavior:{shouldReplaceInsteadOfUpsert:!0}})}}else a.value.deepFindTabType||e.handleSearchResponse({response:{data:a.value,type:"success",status:200,headers:{}}})}else if("query_database"===a.type){const e=p.state;Q=a.value,await e.performQueryDatabase(a.value,!1)}else if("query_database_results"===a.type){if(!Q)throw new Error("No last database query");const e=p.state;await e.handleQueryDatabaseResponse(Q,a.value)}else"server_steps"===a.type?(a.state&&p.state.setState(a.state),p.setTranscript([...p.getTranscript(),...a.commitSteps]),c.commitPreviewingStep()):"final_state"===a.type||"disambiguation"===a.type||"refusal"===a.type||a.type}if($&&(0,A().u)({environment:t,event:{eventName:"run_assistant_client_timings",eventProperties:{sessionId:n,inferenceId:r,assistantSurface:l,mode:y,run_assistant_client_time_to_start_stream:q-S,run_assistant_client_time_to_first_token_from_start_stream:$-S,run_assistant_client_time_to_first_token_from_started_stream:$-q}}}),ee=!0,i.write((()=>{m.setState({...m.state,sampling:!1})})),te)return;if(!G)throw new Error("No final step");if(!i.isValid())return;await(0,H().T)({environment:t,step:G,commit:!1,isStreaming:!1,sessionId:n,inferenceId:r,updater:i});const{previewingStepFromStoreState:re,temporaryOperationsFromStoreState:le}=c,ce=re&&(0,g().BD)(re.value)[0],de="element"===(null==ce?void 0:ce.type)&&(null==ce?void 0:ce.tagName);ne||0!==c.getPreviewingStepErrorObservations().length||"replace"!==de&&"replace-in-page"!==de||0!==le.length||c.addClientStep({type:"assistantNoOperationsFromReplace",inferenceId:o().JW()})}const q=3,$=5;async function G(e){const{environment:t,inferenceId:n,sessionId:a,source:p,updater:g,assistantSurfaceType:m}=e;if("prompt_only_server"===I().zD.getNamespace())return void(await K(e));(0,C().x)(t);const h=k().default.getSessionContextOrThrow(a),{assistantConfigurationStore:f}=h,{evaluatorFromStoreState:y}=h,v=l().y1(1);g.write((()=>{h.setSampledSteps(v.map((e=>({id:e,type:"assistant",inferenceId:void 0,value:""})))),f.setState({...f.state,sampling:!0})}));const S=v[Math.floor(Math.random()*v.length)];let b=!1;const A=l().nF((async()=>{if(b)return;const e=h.sampledStepsFromStoreState.at(S);e&&await(0,H().T)({environment:t,step:e,commit:!1,isStreaming:!0,inferenceId:n,sessionId:a,updater:g})}),u().COMPLETION_THROTTLE);let T;try{await c().lX(v,5,(async e=>{const a=y.streamSampleNextStep(n);for await(const n of a){const a=n.id;if(0===e){x({evaluator:y,currentId:a,currentStep:n,environment:t,assistantSessionContext:h})}const i=h.sampledStepsFromStoreState.map(((t,a)=>a===e?n:t));g.write((()=>{h.setSampledSteps(i)})),e===S&&A()}}))}catch(L){const e=(0,r().A)(L);T=e,e instanceof s().Te&&d().aiDependency.load().then((({aiAnalyticsActions:n})=>{n.trackAIAssistantEngineError(t,{errorType:e.type})}))}if(b=!0,g.write((()=>{f.setState({...f.state,sampling:!1})})),!g.isValid())return;const j=h.sampledStepsFromStoreState[S];await(0,H().T)({environment:t,step:j,commit:!1,isStreaming:!1,sessionId:a,inferenceId:n,inferencingError:T,updater:g});const{previewingStepFromStoreState:M,previewingStepObservationsFromStoreState:_}=h;if(!M)throw new Error("No previewing step");(0,U().$)({environment:t,inferenceId:n,type:"assistant_step",sessionId:a,source:p});const P=_.some(i().XO),D=y.getTranscript(),E=D.findLastIndex((e=>"human"===e.type||"instructions"===e.type)),R=D.slice(E+1).filter((e=>"observation"===e.type&&"error"===e.observationType)),B=P&&R.length>=q,F=D.slice(E+1).filter((e=>"assistant"===e.type)),N=F.length>=$;_.length>0&&!B&&!N&&(P&&g.write((()=>{h.addClientStep({type:"assistantRetry",inferenceId:o().JW()})})),await(0,w().o)({environment:t,sessionId:a,updater:g,assistantSurfaceType:m}))}},63936:(e,t,n)=>{n.d(t,{d:()=>j,A:()=>T});var a=n(296540),i=()=>n(484714),s=()=>n(401497),o=()=>n(79926),r=()=>n(882722),l=()=>n(680474),c=()=>n(807449),d=()=>n(695115),u=()=>n(158115),p=()=>n(995847),g=()=>n(69708),m=()=>n(100622),h=()=>n(284371),f=n(474848);function y(e){return(0,f.jsxs)("svg",{width:"10",height:"10",viewBox:"0 0 10 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,f.jsx)("circle",{cx:"4.99976",cy:"5",r:"2",fill:"#D8A32F"}),(0,f.jsx)("rect",{x:"4.37476",width:"1.25",height:"2",rx:"0.625",fill:"#D8A32F"}),(0,f.jsx)("rect",{x:"4.37476",y:"8",width:"1.25",height:"2",rx:"0.625",fill:"#D8A32F"}),(0,f.jsx)("rect",{x:"8.09375",y:"1.02246",width:"1.25",height:"2",rx:"0.625",transform:"rotate(45 8.09375 1.02246)",fill:"#D8A32F"}),(0,f.jsx)("rect",{x:"2.43677",y:"6.6792",width:"1.25",height:"2",rx:"0.625",transform:"rotate(45 2.43677 6.6792)",fill:"#D8A32F"}),(0,f.jsx)("rect",{x:"10.0002",y:"4.375",width:"1.25",height:"2",rx:"0.625",transform:"rotate(90 10.0002 4.375)",fill:"#D8A32F"}),(0,f.jsx)("rect",{x:"2.00024",y:"4.375",width:"1.25",height:"2",rx:"0.625",transform:"rotate(90 2.00024 4.375)",fill:"#D8A32F"}),(0,f.jsx)("rect",{x:"8.97729",y:"8.09375",width:"1.25",height:"2",rx:"0.625",transform:"rotate(135 8.97729 8.09375)",fill:"#D8A32F"}),(0,f.jsx)("rect",{x:"3.32031",y:"2.43701",width:"1.25",height:"2",rx:"0.625",transform:"rotate(135 3.32031 2.43701)",fill:"#D8A32F"})]})}function v({style:e,...t}){const n=(0,s().IS)((()=>({iconContainer:{position:"relative",display:"flex",height:28,width:28,overflow:"hidden",borderRadius:"50%",border:`1px solid ${m().Tj.yellow.border.secondary}`,background:m().Tj.yellow.background.primary},iconMotionWrapper:{position:"absolute",top:6,insetInlineStart:6,display:"flex",alignItems:"center",justifyContent:"center"},backgroundBlob:{position:"absolute",insetInlineEnd:-16,bottom:-20,height:32,width:32,borderRadius:"50%",background:m().Tj.yellow.background.tertiary,opacity:.5}})),[]),{value:a}=(0,o().fJ)(l().fM);if(!a)return null;const{motion:i}=a;return(0,f.jsxs)("div",{style:e?{...n.iconContainer,...e}:n.iconContainer,...t,children:[(0,f.jsx)(i.div,{style:n.iconMotionWrapper,animate:{rotate:360},transition:{duration:4,repeat:1/0,ease:"linear"},children:(0,f.jsx)(y,{style:{transform:"scale(1.2)"}})}),(0,f.jsx)("div",{style:n.backgroundBlob})]})}var S=()=>n(732067),b=()=>n(45105),x=()=>n(590526),I=()=>n(665638),k=()=>n(965833),w=()=>n(180252),C=()=>n(644914);function A(e){const{rightEdgeDistance:t,environment:n,isInPeekRenderer:i,alwaysVisible:o,bottomEdgeDistance:r,overrides:l}=e,c=(0,a.useContext)(b().w),d=(0,x().K8)((()=>(0,C().zo)(n,i)-(0,C().Ql)(n)),[n,i]),u=(0,a.useMemo)((()=>t+c),[t,c]),p=(0,x().K8)((()=>(0,I().S)(n,(r??16)+c)),[r,n,c]),g=(0,x().K8)((()=>(0,w().$o)(n).state&&!o?0:1),[o,n]),{ovalButtonStyle:h}=(0,s().IS)((()=>({ovalButtonStyle:{position:"absolute",bottom:p,insetInlineEnd:u,borderRadius:100,fontSize:20,boxShadow:m().Tj.shadowSM,zIndex:111,backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",backgroundBlendMode:"overlay, normal",opacity:g,transform:`translateX(-${d}px) translateZ(0)`,transition:`\n\t\t\t\topacity ${k().L}ms,\n\t\t\t\tcolor ${k().L}ms,\n\t\t\t\ttransform 200ms\n\t\t\t`,...null==l?void 0:l()}})),[d,u,p,g,l]);return h}function T(e){const{onClick:t,children:n,onClose:y,disableShimmerAnimation:b,variant:x}=e,I=(0,i().v3)(),k=(0,g().tz)(),[w,C]=(0,a.useState)(!1),[T,M]=(0,a.useState)(!1),_=(0,a.useCallback)((()=>{C(!1),M(!1)}),[]),P=(0,a.useCallback)((()=>{_(),window.removeEventListener("mouseup",P)}),[_]),D=(0,a.useCallback)((()=>{C(!0)}),[]),E=(0,a.useCallback)((()=>{C(T),M(!1)}),[T]),R=(0,a.useCallback)((()=>{M(!0),window.addEventListener("mouseup",P)}),[P]),B=(0,a.useCallback)((()=>{M(!1)}),[]),F=function(e){const{environment:t,isHovered:n,isPressed:i,shouldDisableShimmerAnimation:o,variant:r}=e,l=A({rightEdgeDistance:j,isInPeekRenderer:!1,environment:t,alwaysVisible:!0,overrides:()=>({width:void 0,height:45,background:m().Tj.whiteButtonBackground})}),[c,d]=(0,a.useState)(!1);(0,a.useEffect)((()=>{o||setTimeout((()=>{d(!0)}),2e3)}),[o]);const u=(0,s().eP)();return(0,s().IS)((()=>({buttonStyle:{...l,cursor:"pointer",overflow:"hidden",userSelect:"none",display:"flex",alignItems:"center"},shimmerButtonStyle:{paddingInlineEnd:10,paddingTop:10,paddingBottom:10,paddingInlineStart:"dailyBrief"===r?8:void 0,display:"flex",alignItems:"center",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundImage:"dark"===u?"linear-gradient(270deg, rgba(255, 255, 255, 0.4) 13.84%, rgba(255, 255, 255, 1) 59.7%, rgba(255, 255, 255, 0.4) 93.89%)":"linear-gradient(270deg, rgba(0, 0, 0, 0.4) 13.84%, rgba(0, 0, 0, 1) 59.7%, rgba(0, 0, 0, 0.4) 93.89%)",backgroundSize:"200% 100%",backgroundRepeat:"no-repeat",...!c&&{background:void 0,backgroundImage:void 0,backgroundSize:void 0,backgroundClip:void 0,WebkitBackgroundClip:void 0,WebkitTextFillColor:void 0},...n&&{background:m().Tj.whiteButtonHoveredBackground,backgroundImage:void 0,backgroundSize:void 0,backgroundClip:void 0,WebkitBackgroundClip:void 0,WebkitTextFillColor:void 0},...i&&{background:m().Tj.whiteButtonPressedBackground,backgroundImage:void 0,backgroundSize:void 0,backgroundClip:void 0,WebkitBackgroundClip:void 0,WebkitTextFillColor:void 0}},sparklesIcon:{height:22,width:22,padding:"4px 4px"},inner:{display:"flex",alignItems:"center",flexWrap:"nowrap"},chevronIcon:{marginInlineStart:8},message:{fontSize:h().J.UIRegular.desktop,textWrap:"nowrap",fontWeight:500}})),[n,i,c,l,r,u])}({environment:I,isHovered:w,isPressed:T,shouldDisableShimmerAnimation:b,variant:x}),N=A({rightEdgeDistance:16,bottomEdgeDistance:65,isInPeekRenderer:!1,environment:I,alwaysVisible:!0,overrides:()=>({width:void 0,height:20,background:m().Tj.whiteButtonBackground})}),L=(0,s().IS)((()=>({closeButtonContainer:{...N},closeButton:{zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",width:20,height:20,padding:4},closeButtonHover:{background:m().Tj.buttonPressedBackground}})),[N]),{value:O}=(0,o().fJ)(l().fM);if(!O)return null;const{motion:V}=O;return(0,f.jsxs)(f.Fragment,{children:[y?(0,f.jsx)("div",{style:L.closeButtonContainer,children:(0,f.jsx)(d().A,{ariaLabel:k.formatMessage({id:"assistantAnimatedNudgeElement.closeButton.ariaLabel",defaultMessage:"Close"}),onClick:y,style:L.closeButton,hoveredStyle:L.closeButtonHover,icon:p().xMarkSmallIcon,colorVariant:"tertiary"})}):void 0,(0,f.jsx)(V.div,{style:F.buttonStyle,variants:{initial:{width:36},animate:{width:"auto",transition:{ease:[.87,0,.13,1],type:"spring",stiffness:90,damping:16,mass:1}}},initial:"initial",animate:"animate",onMouseMove:D,onMouseLeave:E,onMouseDown:R,onMouseUp:B,onClick:t,className:r().E4Q,children:(0,f.jsxs)(V.div,{style:F.shimmerButtonStyle,animate:{backgroundPosition:["150% 0","-50% 0"]},transition:{ease:"easeInOut",duration:1.5,repeat:1/0},children:["dailyBrief"===x?(0,f.jsx)(v,{style:{marginInlineEnd:8}}):(0,f.jsx)(S().T5,{variant:"small"}),(0,f.jsxs)("div",{style:F.inner,children:[(0,f.jsx)(V.div,{style:F.message,variants:{initial:{opacity:0},animate:{opacity:1,transition:{ease:[.16,1,.3,1],duration:.75}}},initial:"initial",animate:"animate",children:n}),(0,f.jsx)("span",{style:F.chevronIcon,children:(0,f.jsx)(c().I,{icon:u().arrowChevronSingleRightFillSmallIcon,size:"sm",colorVariant:"tertiary"})})]})]})})]})}const j=16},65590:(e,t,n)=>{n.d(t,{E:()=>T});n(944114);var a=n(296540),i=()=>n(907258),s=()=>n(484714),o=()=>n(590526),r=()=>n(401497),l=()=>n(295633),c=()=>n(699143),d=()=>n(718827),u=()=>n(970236),p=()=>n(631524),g=()=>n(493552),m=()=>n(26697),h=()=>n(584262),f=()=>n(179034),y=()=>n(69708),v=()=>n(100622),S=()=>n(534177),b=()=>n(284371),x=()=>n(857783),I=()=>n(187820),k=()=>n(16006),w=()=>n(83293),C=()=>n(676953),A=n(474848);function T({step:e,displayMode:t,config:n}){return"date"===t?(0,A.jsx)(M,{step:e}):"pageTitle"===t?(0,A.jsx)(_,{step:e}):"pageChip"===t?(0,A.jsx)(P,{step:e}):"timeAndMode"===t?(0,A.jsx)(j,{step:e,config:n}):"dateAndPageChip"===t?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(M,{step:e}),(0,A.jsx)(P,{step:e})]}):(0,S().HB)(t)}function j({step:e,config:t}){var n;const i=(0,r().IS)((()=>({wrap:{color:v().Tj.text.secondary,display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:12},betaBadge:{borderRadius:4,background:v().Tj.palette.translucentGray[75],display:"inline-block",padding:"2px 5px",marginInlineStart:6}})),[]),s=(0,y().tz)(),l=(0,a.useMemo)((()=>{if("researcher"===(null==t?void 0:t.type))return(0,A.jsx)(u().E,{style:i.betaBadge,content:(0,A.jsx)(g().D,{styleKey:"captionSmMedium",color:"secondary",children:(0,A.jsx)(y().sA,{id:"aiInferenceTranscript.contextStep.betaLabel",defaultMessage:"Beta"})})})}),[t,i]),c=(0,o().K8)((()=>{var n;const a=[];if(null!==(n=e.value)&&void 0!==n&&n.currentDatetime){const t=new Date(e.value.currentDatetime),n=t.toLocaleString(s.locale,{month:"long",day:"numeric",year:"numeric"}),i=(new Date).toLocaleString(s.locale,{month:"long",day:"numeric",year:"numeric"}),o=t.toLocaleString(s.locale,{hour:"numeric",minute:"2-digit"});n===i?a.push(o):a.push(n)}if("markdown-chat"===(null==t?void 0:t.type)){const e=(0,C().hg)({model:t.model,intl:s});e?a.push(e):a.push(s.formatMessage(w().EG.chatWithoutModel))}else"search"===(null==t?void 0:t.type)?a.push(s.formatMessage(w().EG.search)):"researcher"===(null==t?void 0:t.type)&&a.push(s.formatMessage(w().EG.researcher));return a.join("  ")}),[t,null===(n=e.value)||void 0===n?void 0:n.currentDatetime,s]);return(0,A.jsxs)("div",{style:i.wrap,children:[c,l]})}function M({step:e}){var t,n;const i=(0,r().IS)((()=>({wrap:{display:"inline-flex",alignItems:"center",justifyContent:"center",alignSelf:"center",marginTop:16,marginBottom:16,userSelect:"none"}})),[]),s=(0,y().tz)(),o=(0,a.useMemo)((()=>{var t;if(null===(t=e.value)||void 0===t||!t.currentDatetime)return null;return new Date(e.value.currentDatetime).toLocaleDateString(s.locale,{weekday:"long",month:"short",day:"numeric"})}),[s.locale,null===(t=e.value)||void 0===t?void 0:t.currentDatetime]),l=(0,a.useMemo)((()=>{var t;return null!==(t=e.value)&&void 0!==t&&t.currentDatetime?new Date(e.value.currentDatetime).toLocaleDateString(s.locale,{weekday:"long",month:"short",year:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}):null}),[s.locale,null===(n=e.value)||void 0===n?void 0:n.currentDatetime]);return(0,A.jsx)(m().m,{renderTooltip:()=>(0,A.jsx)("span",{children:l}),render:e=>(0,A.jsxs)(g().D,{...e,style:i.wrap,styleKey:"captionMedium",colorVariant:"tertiary",children:[o,"  ",(0,A.jsx)(y().sA,{id:"aiInferenceTranscript.contextStep.dateTooltip",defaultMessage:"Notion AI"})]})})}function _({step:e}){const t=(0,s().v3)(),n=(0,o().O$)(i().AppStoreSidebarSpaceStore),a=(0,o().K8)((()=>{if(!n)return;const t=e.value.blockId??e.value.collectionViewBlockId;return t?l().B.createChildStore(n,{id:t,table:f().ev,spaceId:n.id}):void 0}),[n,e.value.blockId,e.value.collectionViewBlockId]),u=(0,r().IS)((()=>({divider:{flex:"1 0 0",borderBottom:`0.5px solid ${v().Tj.border.secondary}`,minWidth:32,margin:"32px -16px"},text:{display:"flex",lineClamp:1,...b().RC},recordTitleHoveredStyle:{color:v().Tj.text.primary,background:void 0}})),[]);return a?(0,A.jsxs)(c().Y1,{direction:"horizontal",align:"center",gap:32,children:[(0,A.jsx)("div",{style:u.divider,role:"separator"}),(0,A.jsx)(g().D,{style:u.text,styleKey:"captionRegular",colorVariant:"tertiary",children:(0,A.jsx)(d().Ay,{hoveredStyle:u.recordTitleHoveredStyle,onClick:()=>{x().uK({environment:t,store:a,pageVisitSource:h().y8.AIChat})},children:(0,A.jsx)(k().A,{store:a})})}),(0,A.jsx)("div",{style:u.divider,role:"separator"})]}):null}function P({step:e}){const t=(0,s().v3)(),n=(0,o().O$)(i().AppStoreSidebarSpaceStore),a=(0,o().K8)((()=>{if(!n)return;const t=e.value.blockId??e.value.collectionViewBlockId;return t?l().B.createChildStore(n,{id:t,table:f().ev,spaceId:n.id}):void 0}),[n,e.value.blockId,e.value.collectionViewBlockId]),c=(0,o().K8)((()=>null==a?void 0:a.getIcon()),[a]),d=(0,r().IS)((()=>({container:{display:"flex",flexWrap:"wrap",justifyContent:"flex-end",width:"100%"},blockContainer:{color:v().Tj.text.secondary,display:"flex",maxWidth:"50%",alignItems:"center",gap:5,paddingTop:4,paddingInlineEnd:8,paddingBottom:4,paddingInlineStart:6,borderRadius:12},blockContainerHover:{background:v().Tj.background.tertiaryTranslucent}})),[]);return a?(0,A.jsx)("div",{style:d.container,children:(0,A.jsxs)(p().p,{onClick:()=>{x().uK({environment:t,store:a,pageVisitSource:h().y8.AIChat})},style:d.blockContainer,hoveredStyle:d.blockContainerHover,size:"sm",children:[c?(0,A.jsx)(I().B6,{disabled:!0,icon:c,isEmptyPage:!1,size:14}):(0,A.jsx)(I().B6,{disabled:!0,iconRecordCategory:"pageBlock",isEmptyPage:!1,size:14}),(0,A.jsx)(k().A,{store:a,style:{fontSize:12,lineHeight:"16px"}})]})}):null}},71805:(e,t,n)=>{n.r(t),n.d(t,{arrowInCircleUpSmallIcon:()=>s,iconDefinition:()=>i});n(296540);var a=n(474848);const i={viewBox:"0 0 16 16",fittedViewBox:"1.87 1.87 12.25 12.25",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M8 4.585a.63.63 0 0 0-.442.183l-2.08 2.08a.625.625 0 0 0 .884.884l1.013-1.013v4.07a.625.625 0 1 0 1.25 0V6.72l1.013 1.013a.625.625 0 0 0 .884-.884l-2.08-2.08A.63.63 0 0 0 8 4.585"}),(0,a.jsx)("path",{d:"M8 1.875a6.125 6.125 0 1 0 0 12.25 6.125 6.125 0 0 0 0-12.25M3.125 8a4.875 4.875 0 1 1 9.75 0 4.875 4.875 0 0 1-9.75 0"})]})},s=(0,n(340498).wt)("arrowInCircleUpSmall",i,"small")},79075:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(296540),i=()=>n(738471),s=n(474848);function o(e){const{url:t,imageNaturalHeight:n,imageNaturalWidth:o}=e,l=(0,a.useMemo)((()=>({display:"block",width:`min(${o}px, 100%)`,height:`min(${n}px, 100%)`,pointerEvents:"auto",objectFit:"cover"})),[o,n]);return(0,s.jsx)("div",{style:r,children:(0,s.jsx)(i().A,{src:t,style:l,placeholderLoadedStyle:{display:"flex",justifyContent:"center",alignItems:"center"}})})}const r={alignSelf:"center",margin:"0 auto",position:"relative",height:"100%",width:"100%",overflow:"hidden"}},83626:(e,t,n)=>{n.d(t,{Lm:()=>Da,ze:()=>$a,uQ:()=>Va,zg:()=>Ka});n(16280),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(581454);var a=()=>n(203066),i=()=>n(153321),s=n(296540),o=()=>n(564884),r=()=>n(920198),l=()=>n(907258),c=()=>n(726637),d=()=>n(484714),u=()=>n(590526),p=()=>n(401497),g=()=>n(711339),m=()=>n(560729),h=()=>n(699143),f=()=>n(807449),y=()=>n(695115),v=()=>n(631524),S=()=>n(493552),b=()=>n(26697),x=()=>n(663639),I=()=>n(452004),k=()=>n(218602),w=()=>n(878456),C=()=>n(906380),A=()=>n(175882),T=()=>n(104556),j=()=>n(340266),M=()=>n(542101),_=()=>n(557943),P=()=>n(395546),D=()=>n(870054),E=()=>n(340498),R=()=>n(155792),B=()=>n(69708),F=()=>n(100622),N=()=>n(944584),L=()=>n(367263),O=()=>n(384944),V=()=>n(791256),z=()=>n(657349),W=()=>n(147796),U=()=>n(594794),H=()=>n(547149),K=()=>n(571376),q=()=>n(562936),$=()=>n(46986),G=()=>n(140992),Y=()=>n(459129);function Q(e){const{clientStore:t}=e;t.setState({...t.state,isAIChatTranscriptSidePanelVisible:!1})}var J=()=>n(827368),X=()=>n(680369),Z=()=>n(160432),ee=n(474848);function te({style:e,...t}){const n=(0,p().IS)((()=>({button:{alignSelf:"flex-start",borderRadius:100,display:"flex",padding:"0 14px",height:32}})),[]);return(0,ee.jsx)(Z().A,{style:{...n.button,...e},...t})}var ne=()=>n(588104),ae=()=>n(59226),ie=()=>n(96563),se=()=>n(949305),oe=()=>n(330966),re=()=>n(704658);function le(e){const{config:t,step:n}=e,{featureAvailability:a}=n,i=(0,ie().bl)(t),s=(0,r().L)(),o=(0,ae().X)("upgrade_system_ai"),{upsellMessage:l}=(0,se().x)({featureAvailability:a,upsellFrom:i}),c=(0,oe().o)({featureAvailability:a,source:i,type:"text"}),{bodyStyleKey:d}=(0,J().yq)(),u=(0,J().Cd)(d),g=(0,p().IS)((()=>({container:{padding:8,marginBottom:20},wrapper:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:4,...u,padding:10}})),[u]);return(0,ee.jsx)(ne().Q,{style:g.container,children:(0,ee.jsxs)("div",{style:g.wrapper,children:[o?c?(0,ee.jsx)(re().UpgradeButton,{...c}):null:(0,ee.jsx)("div",{children:l}),(0,ee.jsx)(re().UpgradeButton,{source:i,upsell:a.upsell,display:"primary",spaceStore:s})]})})}var ce=()=>n(755531),de=()=>n(312788),ue=()=>n(79926),pe=()=>n(295633),ge=()=>n(718827),me=()=>n(584262),he=()=>n(172385),fe=()=>n(820579),ye=()=>n(764781),ve=()=>n(38679),Se=()=>n(179034),be=()=>n(201980),xe=()=>n(884107),Ie=()=>n(44729),ke=()=>n(12831),we=()=>n(857783),Ce=()=>n(843014),Ae=()=>n(460089),Te=()=>n(371621),je=()=>n(651196),Me=()=>n(631611),_e=()=>n(659602),Pe=()=>n(335722),De=()=>n(376049),Ee=()=>n(599412),Re=()=>n(295304),Be=()=>n(122058),Fe=()=>n(282148);const Ne=(0,B().YK)({researchModeButton:{id:"inferenceTranscript.AIStepFollowupAction.researchModeButton",defaultMessage:"Research Mode"},researchModeButtonTooltip:{id:"inferenceTranscript.AIStepFollowupAction.researchModeButtonTooltip",defaultMessage:"Get a thorough report for any question or topic"},copyStepTextButtonTooltip:{id:"inferenceTranscript.AIStepFollowupAction.copyStepTextButtonTooltip",defaultMessage:"Copy AI response to your clipboard"},saveAsPageTooltip:{id:"inferenceTranscript.AIStepFollowupAction.saveAsPageTooltip",defaultMessage:"Save AI response to your private pages"},saveAsPageToLocationTooltip:{id:"inferenceTranscript.AIStepFollowupAction.saveAsPageToLocationTooltip",defaultMessage:"Select a location to save the AI response"},saveAsPage:{id:"inferenceTranscript.AIStepFollowupAction.saveAsPage",defaultMessage:"Save as page"},defaultPageTitle:{id:"inferenceTranscript.AIStepFollowupAction.defaultPageTitle",defaultMessage:"AI Summary"},connectAppsTooltip:{id:"inferenceTranscript.AIStepFollowupAction.connectAppsTooltip",defaultMessage:"Connect your favorite apps to Notion AI"}});function Le(e){const{step:t,threadId:n,configStep:a,onClick:i}=e,o=(0,d().v3)(),{bodyStyleKey:r}=(0,J().yq)(),l=(0,J().Cd)(r),c=(0,p().IS)((()=>({icon:{marginInlineEnd:6},buttonContent:{display:"flex",alignItems:"center",gap:6,...l}})),[l]),u=(0,s.useCallback)((()=>{if((0,G().VG)({environment:o,step:t}),i(),"search-chat"===t.type&&"search"===(null==a?void 0:a.value.type)){const e=a.value;Be().Pw({environment:o,threadId:n,searchSessionId:e.searchSessionId,traceId:t.traceId,stepId:t.id})}}),[o,t,n,a,i]);return(0,ee.jsx)(b().m,{renderTooltip:()=>(0,ee.jsx)(B().sA,{...Ne.copyStepTextButtonTooltip}),render:e=>(0,ee.jsx)(ze,{...e,icon:()=>(0,ee.jsx)(f().I,{icon:ye().V,style:c.icon}),onClick:u,title:(0,ee.jsx)("div",{style:c.buttonContent,children:(0,ee.jsx)(B().sA,{defaultMessage:"Copy",id:"assistant.copyAISummaryButton"})}),variant:"tinted"})})}function Oe(e){const{navigate:t}=(0,s.useContext)(de().E),{threadId:n,createBlockFrom:a,markdown:i,linkAnnotationToCitationAnnotations:o,transactionName:r,threadTitle:l,step:u,configStep:p,onClick:g}=e,m=(0,d().v3)(),{value:h}=(0,ue().fJ)(xe().R.clipboardActions),f=(0,ue().fJ)(_e().g),y=(0,ue().fJ)(Pe().S),v=(0,B().tz)(),S=(0,s.useCallback)(((e,t)=>{var n;const a=(0,ce().S)();if(!h||!a)return;const s=i,r=t.inMemoryRecordCache.makeGetRecordModelFn(m.currentUser.id),c=h.markdownToBlocks({environment:m,text:s,inMemoryRecordCache:t.inMemoryRecordCache,transaction:e,markdownOptions:{},markdownLinkifyIt:f.value,tinyMceMicrosoftWordPasteFilter:y.value,parentPointer:t.getSpaceShardedPointer()});if(!c||0===c.length)return;const d=(0,Fe().N5)({linkAnnotationToCitationAnnotations:o,useExportedCitations:!0,getRecordModelFn:r});for(const i of c)(0,Fe().YA)({store:i,environment:m,transaction:e,modifyTokens:d});const u="header"===c[0].getType()?c.shift():void 0,p=null==u||null===(n=u.getTitleStore())||void 0===n?void 0:n.getValue(),g=void 0!==p?p:void 0!==l?be().x9d(l):be().x9d(v.formatMessage(Ne.defaultPageTitle));Re().R9({environment:m,store:t.getBlockTitleStore(),value:g,transaction:e});const S=t.getContentStore();for(const i of c)Ie().NI({childStore:i,parentStore:S,transaction:e})}),[m,v,l,h,i,o,f.value,y.value]),x=(0,s.useCallback)((e=>{const n=m.RouterStore.state.route;if("chat"===n.name){const a=(0,he().EY)({currentRoute:n,pageId:e.id,pageVisitSource:me().y8.AIQna,isMobile:c().A.isMobile});t({environment:m,url:a})}else we().uK({environment:m,store:e,pageVisitSource:me().y8.AIQna,openInSidePeek:!0})}),[m,t]),I=(0,s.useCallback)((async()=>{if(g(),!h)return;if(["idle","pending"].includes(f.status)||["idle","pending"].includes(y.status))return;const e=await(0,Ee().M)({environment:m,from:a,pageVisitSource:me().y8.AIQna,navigateOnCreate:!1});if(e){if(H().createAndCommit({userAction:r,environment:m,canUndo:!1,perform:t=>{S(t,e)}}),"search-chat"===u.type&&"search"===(null==p?void 0:p.value.type)){const e=p.value;Be().sS({environment:m,threadId:n,searchSessionId:e.searchSessionId,traceId:u.traceId,stepId:u.id})}x(e)}}),[x,m,h,f,y,a,S,r,n,p,u,g]),k=(0,s.useCallback)((e=>{e.stopPropagation();const t=(0,ce().S)();if(!t)return;const a=e.currentTarget.getBoundingClientRect(),i=(0,U().Z1)({environment:m,table:Se().ev,spaceId:t.id}),s=pe().B.createChildStore(t,{table:Se().ev,id:i,spaceId:t.id});De().ho({environment:m,blocks:[s],originRect:a,moveToContext:"action_menu",isAddTo:!1,disableSuccessToast:!0,forceShowPrivatePageOption:!0,dontCommitActions:!0,onAccept:({value:e})=>{(e=>{if(!h)return;if(["idle","pending"].includes(f.status)||["idle","pending"].includes(y.status))return;if(!e.addBlockToPage||"page"!==e.addBlockToPage.target)return;const{pageId:a}=e.addBlockToPage,o=new(pe().B)(m,{table:Se().ev,id:a,spaceId:t.id});if(H().createAndCommit({userAction:r,environment:m,canUndo:!1,perform:e=>{O().Wv({environment:m,id:i,type:"page",spaceId:t.id,transaction:e,inMemoryRecordCache:s.inMemoryRecordCache}),S(e,s),Ie().NI({childStore:s,parentStore:o.getContentStore(),transaction:e})}}),"search-chat"===u.type&&"search"===(null==p?void 0:p.value.type)){const e=p.value;Be().sS({environment:m,threadId:n,searchSessionId:e.searchSessionId,traceId:u.traceId,stepId:u.id})}x(s)})((0,Te()._W)(e))}})}),[m,x,h,f,y,S,r,n,p,u]);return(0,ee.jsx)(Me().hP,{surface:Me().wy.fullPage,children:(0,ee.jsx)(b().m,{renderTooltip:()=>(0,ee.jsx)(B().sA,{...Ne.saveAsPageTooltip}),render:e=>(0,ee.jsx)("div",{children:(0,ee.jsx)(b().m,{renderTooltip:()=>(0,ee.jsx)(B().sA,{...Ne.saveAsPageToLocationTooltip}),render:t=>(0,ee.jsx)(je().Es,{variant:"tinted",icon:fe().arrowLineDownIcon,fontSize:"14px",onClick:I,onDropdownClick:k,singleLineTitle:!0,title:(0,ee.jsx)(B().sA,{...Ne.saveAsPage}),tooltipEvents:e,dropdownTooltipEvents:t})})})})})}function Ve(e){const{onAdditionalClick:t}=e,{bubbleIcons:n,connectorsUpsellOrManage:a}=(0,Ae().b)({connector:"generic",analyticsFrom:"ai_chat_followup_upsell_suggestion"}),i=(0,s.useCallback)((()=>{t(),void 0!==a&&a()}),[a,t]),{bodyStyleKey:o}=(0,J().yq)(),r=(0,J().Cd)(o),l=(0,p().IS)((()=>({buttonContent:{display:"flex",alignItems:"center",gap:6,...r,marginInlineStart:2}})),[r]);return!n||c().A.isMobile?null:(0,ee.jsx)(b().m,{renderTooltip:()=>(0,ee.jsx)(B().sA,{...Ne.connectAppsTooltip}),render:e=>(0,ee.jsx)(ze,{...e,icon:()=>n,onClick:i,title:(0,ee.jsx)("div",{style:l.buttonContent,children:(0,ee.jsx)(B().sA,{...Ce().D.searchMoreApps})}),variant:"tinted"})})}const ze=s.forwardRef((function(e,t){const{style:n,hoveredStyle:a,icon:i,disabled:o,iconStyle:r,title:l,onClick:d,focused:u,variant:g,singleLineTitle:m,...h}=e,f=Boolean(l),y=(0,p().eP)(),v=(0,p().IS)((()=>({AssistantActionButton:{display:"flex",alignItems:"center",boxShadow:"none",paddingTop:6,paddingInlineEnd:12,paddingBottom:6,paddingInlineStart:12,marginBottom:6,color:F().Tj.text.primary,fontSize:12,fontWeight:500,borderRadius:24,width:"max-content",background:F().Tj.background.secondaryTranslucent,height:c().A.isMobile?36:32,...c().A.isMobile&&{flexWrap:"nowrap",textWrap:"nowrap"}},hoveredStyle:{background:(0,ge().i)({color:F().Tj.background.secondaryTranslucent,mode:y})},pressedStyle:{background:(0,ge().yZ)({color:F().Tj.background.secondaryTranslucent,mode:y})},icon:{width:c().A.isMobile?18:16,height:c().A.isMobile?18:16,fill:F().Tj.icon.tertiary,marginInlineEnd:f?6:0}})),[f,y]),S=i?Array.isArray(i)?i:[i]:void 0;return(0,ee.jsxs)(ge().Ay,{...h,ref:t,disabled:o,style:{...v.AssistantActionButton,...n},hoveredStyle:{...v.hoveredStyle,...a},pressedStyle:v.pressedStyle,onClick:d,focused:u,...e.tooltipEvents??{},children:[null==S?void 0:S.map(((e,t)=>(0,ee.jsx)(s.Fragment,{children:e({...v.icon,...r})},t))),m?(0,ee.jsx)("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l}):l]})}));function We(e){const t=(0,B().tz)(),{threadStore:n,onClick:a}=e,{bodyStyleKey:i}=(0,J().yq)(),o=(0,J().Cd)(i),r=(0,p().IS)((()=>({buttonContent:{display:"flex",alignItems:"center",gap:6,...o,marginInlineStart:2}})),[o]),l=(0,d().v3)(),c=(0,s.useCallback)((()=>{a();const e=n.getTranscript(),i=e.find((e=>"config"===e.type));if(!i||"search"!==i.value.type)return;const s=i.value,o=e.find((e=>"user"===e.type));o&&o.value&&ke().U2({environment:l,intl:t,queryTextValue:o.value,searchSessionId:s.searchSessionId,entrypoint:"uf_retry_in_research_mode"})}),[n,l,t,a]);return(0,ee.jsx)(b().m,{renderTooltip:()=>(0,ee.jsx)(B().sA,{...Ne.researchModeButtonTooltip}),render:e=>(0,ee.jsx)(ze,{...e,icon:()=>(0,ee.jsx)(f().I,{icon:ve().P,style:{marginInlineEnd:6}}),onClick:c,title:(0,ee.jsx)("div",{style:r.buttonContent,children:(0,ee.jsx)(B().sA,{defaultMessage:"Try in Research Mode",id:"assistant.retryInResearchModeButton"})}),variant:"tinted"})})}var Ue=()=>n(774952);const He={id:"aiInferenceTranscript.debug.toolResult.errorSummary",defaultMessage:"Error: {error}",description:"Summary shown for a tool result that contains an error message. {error} is the raw error string."},Ke={id:"aiInferenceTranscript.debug.toolResult.insufficientPermissions",defaultMessage:"Insufficient permissions",description:"Summary shown when the tool result indicates it lacked the required permissions."},qe={id:"aiInferenceTranscript.debug.toolResult.resultsCount",defaultMessage:"{count, plural, one {# result} other {# results}}",description:"Summary label describing how many items a tool result returned. Uses ICU pluralisation on {count}."},$e={id:"aiInferenceTranscript.debug.toolResult.previewSnippet",defaultMessage:"Preview: {snippet}",description:"Summary snippet shown when the tool result preview is derived from raw text. {snippet} contains the preview text."},Ge={pending:{id:"aiInferenceTranscript.debug.toolResult.state.pending",defaultMessage:"Pending",description:"Label describing a tool result that is pending execution."},streaming:{id:"aiInferenceTranscript.debug.toolResult.state.streaming",defaultMessage:"Streaming",description:"Label describing a tool result that is currently streaming."},"confirmation:requested":{id:"aiInferenceTranscript.debug.toolResult.state.confirmationRequested",defaultMessage:"Confirmation requested",description:"Label describing a tool result that is waiting for user confirmation."},"confirmation:rejected":{id:"aiInferenceTranscript.debug.toolResult.state.confirmationRejected",defaultMessage:"Confirmation rejected",description:"Label describing a tool result where the user rejected confirmation."},applied:{id:"aiInferenceTranscript.debug.toolResult.state.applied",defaultMessage:"Applied",description:"Label describing a tool result that applied successfully."},"applied:partial":{id:"aiInferenceTranscript.debug.toolResult.state.appliedPartial",defaultMessage:"Partially applied",description:"Label describing a tool result that only partially applied its changes."},"applied:error":{id:"aiInferenceTranscript.debug.toolResult.state.appliedError",defaultMessage:"Apply error",description:"Label describing a tool result that encountered an error while applying changes."},"confirmation:confirmed":{id:"aiInferenceTranscript.debug.toolResult.state.confirmationConfirmed",defaultMessage:"Confirmation confirmed",description:"Label describing a tool result where the confirmation was accepted."}};var Ye=()=>n(664594),Qe=()=>n(706021),Je=()=>n(528093);const Xe=4;function Ze(e){const{threadStore:t,step:n,results:a,titleStep:i}=e,r=(0,d().v3)(),g=(0,Ye().T)(),m=(0,u().O$)(l().AppStoreSidebarSpaceStore),h=(0,Je()._)({name:"ai_research_mode",spaceId:null==m?void 0:m.id,userId:g,amount:1}),f=(0,Qe().e2)(h),y=(0,s.useMemo)((()=>(0,V().Jz)(n.value)),[n.value]),v=(0,s.useMemo)((()=>{const e=n.value.match(V().HS);return e?e.length:0}),[n.value]),S=(0,u().K8)((()=>t.id),[t]),b=null==i?void 0:i.value,x=(0,u().K8)((()=>t.getTranscript().find((e=>"config"===e.type))),[t]),I=(0,u().K8)((()=>{const e=t.getTranscript(),a=e.findIndex((e=>e.id===n.id));return e.slice(0,a).filter((e=>"user"===e.type)).length>1}),[t,n]),k=(0,u().K8)((()=>{const e=t.getTranscript();return Boolean(e.find((e=>"attachment"===e.type)))}),[t]),w=(0,s.useMemo)((()=>(0,V().o6)({results:a,spaceStore:m,environment:r,traceId:n.traceId})),[a,m,r,n.traceId]),C=(0,s.useCallback)((e=>{(0,o().u)({environment:r,event:{eventName:"clicked_ai_chat_follow_up",eventProperties:{thread_id:S,trace_id:n.traceId,mode:null==x?void 0:x.value.type,action:e}}})}),[S,n.traceId,null==x?void 0:x.value.type,r]),A=(0,p().IS)((()=>({SuggestionGroup:{width:"100%"},suggestions:{display:"flex",alignItems:"center",overflowX:"auto",flexDirection:"row",flexWrap:"wrap",whiteSpace:"nowrap",gap:8,rowGap:8,padding:`${Xe}px ${Xe}px`,margin:`-${Xe}px -${Xe}px`,...c().A.isMobile&&{overflowX:"scroll",flexWrap:"nowrap",paddingBottom:8,marginBottom:-8,paddingInlineStart:16,paddingInlineEnd:16,marginInlineStart:-16,marginInlineEnd:-16}}})),[]);return(0,ee.jsx)("div",{style:A.SuggestionGroup,children:(0,ee.jsxs)("div",{style:A.suggestions,children:["search-chat"===n.type?(0,ee.jsx)(Le,{threadId:S,step:n,configStep:x,onClick:()=>C("copy")}):void 0,"search-chat"!==n.type||!f||I||k?void 0:(0,ee.jsx)(We,{threadStore:t,onClick:()=>C("try_research_mode")}),"search-chat"===n.type?(0,ee.jsx)(Oe,{threadTitle:b,threadId:S,step:n,configStep:x,createBlockFrom:"unified_find_summary",markdown:y,linkAnnotationToCitationAnnotations:w,transactionName:"SearchChatStep.createReportPage",onClick:()=>C("save_as_page")}):void 0,"search-chat"===n.type&&0===v?(0,ee.jsx)(Ve,{step:n,configStep:x,onAdditionalClick:()=>C("connect_apps")}):void 0]})})}var et=()=>n(17022),tt=()=>n(899483),nt=()=>n(143016),at=()=>n(485601),it=()=>n(43893),st=()=>n(915189),ot=()=>n(338381),rt=()=>n(902006),lt=()=>n(534177),ct=()=>n(141465);const dt=s.memo(ut);function ut(e){const{step:t,results:n}=e,a=t.traceId,i=(0,d().v3)(),o=(0,ue().fJ)(_e().g),r=(0,ue().fJ)(Pe().S),{value:c}=(0,ue().fJ)(xe().R.clipboardActions),g=(0,s.useRef)(null),m=(0,u().uB)(void 0,nt().D),h=(0,s.useMemo)((()=>(0,V().Jz)(t.value)),[t.value]),f=(0,u().O$)(l().AppStoreSidebarSpaceStore);!function(e){const{containerRef:t,citationHoverStore:n,parentStore:a}=e,i=(0,u().K8)((()=>{if(!a)return;const e=ct().A.state;if(!e||"token"!==e.type||!t.current||!ot().gR(t.current,e.token.node))return;const n=e.annotations.find(be().bZo);if(!n)return;const i=be().NpB(n);if(void 0===i.type||"query_database_result"===i.type);else{if("helpdoc"===i.type||"helpdoc-section"===i.type||"url"===i.type||"webpage"===i.type||be().E_d(i))return{type:"token",citationType:"universal_search",href:(0,rt().Ve)(i.href),node:e.token.node};if("block"===i.type){const t=n?i.scrollToBlockId||i.blockId:void 0;if(!t)return;const s=pe().B.createChildStore(a,{table:"block",id:t}).getNavigableBlockStore();if(!s)return;return{type:"token",citationType:"notion",pageId:s.id,blockId:s.id===t?void 0:t,node:e.token.node}}(0,lt().HB)(i.type)}}),[t,a]),o=(0,s.useRef)();(0,s.useEffect)((()=>(o.current&&(clearTimeout(o.current),o.current=void 0),void 0===i?o.current=setTimeout((()=>{n.setState(void 0),o.current=void 0}),50):function(e){const t=e.getBoundingClientRect();return 0===t.bottom&&0===t.left&&0===t.right&&0===t.top}(i.node)||n.setState(i),()=>{o.current&&(clearTimeout(o.current),o.current=void 0)})),[n,i])}({containerRef:g,citationHoverStore:m,parentStore:f});const y=(0,s.useRef)((0,V().o6)({results:n,spaceStore:f,environment:i,traceId:a}));(0,s.useEffect)((()=>{y.current=(0,V().o6)({results:n,spaceStore:f,environment:i,traceId:a})}),[n,f,i,a]);const v=(0,s.useMemo)((()=>{if(!h||!c)return;if(["idle","pending"].includes(o.status)||["idle","pending"].includes(r.status))return;const e=o.value,t=r.value;return e&&t?et().e.withListenerIgnored((()=>(0,Fe().eQ)({markdown:h,environment:i,markdownLinkifyIt:e,tinyMceMicrosoftWordPasteFilter:t,clipboardActions:c,linkAnnotationToCitationAnnotations:y.current,useExportedCitations:!1}))):void 0}),[h,c,o,r,i]),S=(0,p().IS)((()=>({chatWrapper:{paddingInlineStart:12}})),[]);return v&&f?(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)("div",{ref:g,style:S.chatWrapper,children:(0,ee.jsx)(at().c,{displayName:"AIChatTranscript.MarkdownChatStep",disabled:!0,children:(0,ee.jsx)(it().A,{store:v,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0})})}),(0,ee.jsx)(tt().cE,{containerRef:g,hoverStore:m,parentStore:f,isSearchChat:!0,getPayloadDataForHref:e=>(0,st().vs)(n,e)})]}):null}n(18107),n(967357),n(430670);var pt=()=>n(758304),gt=()=>n(416504),mt=()=>n(886358),ht=()=>n(107023),ft=()=>n(450648),yt=()=>n(245241),vt=()=>n(496603),St=()=>n(284371),bt=()=>n(533927),xt=()=>n(135221),It=()=>n(966509),kt=()=>n(249046),wt=()=>n(324254),Ct=()=>n(333603),At=()=>n(344417),Tt=()=>n(328729),jt=()=>n(282027),Mt=()=>n(639417);const _t=3;function Pt(e){const{toggleOpen:t,results:n}=e,a=(0,p().IS)((()=>({iconWrap:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:20,minHeight:20,width:20,height:20,borderRadius:999,boxShadow:F().Tj.shadow2XS,background:F().Tj.background.primary},container:{display:"flex"}})),[]);return n.length<_t?null:(0,ee.jsx)(i().P.div,{style:a.container,animate:{opacity:t?0:1,width:t?0:20*_t-6*(_t-1)},transition:{duration:.2},children:n.slice(0,_t).map(((e,n)=>(0,ee.jsx)(i().P.div,{style:{...a.iconWrap,zIndex:_t-n},initial:{x:-8*n},animate:{x:t?-24*n:-8*n},transition:{duration:.3},children:(0,ee.jsx)(Mt().R,{result:e,size:14,notStandaloneIcon:!0})},"notion"===e.type?e.store.id:e.href)))})}const Dt=8;function Et(e){const{isToggleHovered:t,toggledOpen:n,setToggledOpen:a,setIsToggleHovered:i,spaceStore:s,sources:o,step:r}=e,l=(0,V().Pp)(r),{bodyStyleKey:c}=(0,J().yq)(),d=(0,J().Cd)(c),g=(0,p().IS)((()=>({messageWrap:{marginInlineStart:6,...d,color:F().Tj.text.secondary,display:"flex",alignItems:"center",width:"fit-content",maxWidth:"100%",flexShrink:1,minWidth:0,gap:2,paddingInlineStart:Dt,paddingInlineEnd:Dt,height:32,borderRadius:6,...t&&{cursor:"pointer",background:F().Tj.buttonHoveredBackground},transition:"background 150ms ease"},messageContent:{display:"flex",alignItems:"center",gap:4,flex:"1 1 0%",minWidth:0},messageWrapInner:{display:"flex",alignItems:"center",flex:"1 1 auto",minWidth:0,gap:4},ellipsisText:{fontWeight:St().Wy.semibold,textTransform:"lowercase",flex:"1 1 0%",minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}})),[t,d]),{totalNumResults:m,renderableResultsForPreview:h,notionRenderablePageStores:y}=(0,u().K8)((()=>{const e=(0,V().l0)(r);if(!s||!e)return{totalNumResults:0,renderableResultsForPreview:[],notionRenderablePageStores:[]};const t=o.flatMap((e=>{var t;return(null===(t=r.results)||void 0===t?void 0:t[e])??[]})),n=t.length,a=vt().oE(t.slice(0,10).flatMap((({result:e})=>(0,st().SF)(e,s)))),i=a.filter((e=>"notion"===e.type)).map((e=>e.store));return{totalNumResults:n,renderableResultsForPreview:a,notionRenderablePageStores:i}}),[r,s,o]),S="searching"===r.status?r.queries[0]:void 0,b=(0,u().K8)((()=>"searching"===r.status?(0,ee.jsxs)(kt().Ye,{style:{alignItems:"center",gap:4},children:[(0,ee.jsx)(pt().N,{styleKey:"bodyMedium",animate:!0,colorVariant:"secondary",text:(0,ee.jsx)(B().sA,{id:"CollapsedSearchStepResults.searching",defaultMessage:"Searching"})}),(0,ee.jsxs)(kt().Ye,{style:{alignItems:"center",gap:4,flexWrap:"nowrap"},children:[(0,ee.jsx)(f().I,{icon:At().magnifyingGlassSmallIcon,size:"xxs",colorVariant:"secondary"}),(0,ee.jsx)("span",{style:g.ellipsisText,children:(null==S?void 0:S.questionIntl)??(null==S?void 0:S.keywords)})]})]}):"resultsPartial"===r.status?y.length>0?(0,ee.jsx)(Tt().w,{searchResultStores:y}):(0,ee.jsx)(pt().N,{styleKey:"bodyMedium",animate:!0,colorVariant:"secondary",text:(0,ee.jsx)(B().sA,{id:"DeepFindStep.searchingNonNotionText",defaultMessage:"Reading"})}):"resultsComplete"===r.status||"resultsBlended"===r.status?(0,ee.jsx)(B().sA,{id:"assistantCitationHelpers.numPagesFound",defaultMessage:"{count, plural, one {{count} result} other {{count} results}}",values:{count:m}}):(0,ee.jsx)(pt().N,{text:(0,ee.jsx)(B().sA,{...jt().v.thinking}),styleKey:"bodyMedium",animate:!0,colorVariant:"secondary"})),[r.status,m,S,y,g.ellipsisText]);return(0,ee.jsxs)(v().p,{style:g.messageWrap,onMouseEnter:()=>{i(!0)},onMouseLeave:()=>{i(!1)},onClick:()=>{a(!n)},"aria-expanded":n,children:[(0,ee.jsxs)("div",{style:g.messageContent,children:[(0,ee.jsx)("div",{style:g.messageWrapInner,children:b}),l?(0,ee.jsx)(Pt,{toggleOpen:n,results:h}):(0,ee.jsx)("div",{style:{marginInlineStart:4,marginInlineEnd:4},children:(0,ee.jsx)(xt().A,{isTriColored:!0})})]}),(0,ee.jsx)("span",{style:{opacity:t?1:0},children:(0,ee.jsx)(f().I,{icon:n?Ct().Y:wt().arrowChevronSingleDownSmallIcon,size:"xs",colorVariant:"tertiary"})})]})}var Rt=()=>n(883476);const Bt=["notion","notion-mail","notion-calendar","helpdocs","helpdoc-section","webpage",...n(604018).yc.filter((e=>!(0,rt().r9)(e)))];function Ft(e){const{step:t,isLastVisibleStep:r,threadStore:g,clientStore:m}=e,[h,f]=(0,s.useState)(!1),[y,v]=(0,s.useState)(!1),[S,b]=(0,s.useState)(void 0),x=S??t.showResults??!0,I=(0,d().v3)(),k=(0,u().O$)(l().AppStoreSidebarSpaceStore),{bodyStyleKey:w}=(0,J().yq)(),C=(0,J().Cd)(w),A=(0,B().tz)(),T=(0,p().IS)((()=>({wrap:{borderBottom:h&&x?`1px solid ${F().Tj.border.secondary}`:void 0,paddingBottom:h?8:void 0,fontWeight:500,fontSize:12},deepFindHeaderWrap:{padding:"1px 2px",margin:"-1px -2px",cursor:"default"},summarizingWrap:{marginTop:20,display:"flex",flexDirection:"column",gap:12,width:"100%",color:F().Tj.text.secondary,fontWeight:500,...C},content:{paddingInlineStart:12},messageContent:{display:"flex",alignItems:"center",gap:8,minWidth:0}})),[h,x,C]),j=(0,V().l0)(t),M=(0,u().K8)((()=>{const e=(0,V().L2)(g);return"search"===(null==e?void 0:e.type)?e:void 0}),[g]),{sources:_,hasNotionResults:P}=(0,s.useMemo)((()=>{const e=j?function(e){return[...Bt.filter((t=>e.includes(t)))]}((0,lt().uv)(t.results??{})):[],n=e,a=n.includes("notion")&&j;return{sources:n,hasNotionResults:a}}),[j,t]),[D,E]=(0,s.useState)("resultsComplete"===t.status||"resultsBlended"===t.status?_.at(0):void 0);(0,s.useEffect)((()=>{if(!D)if("resultsComplete"===t.status||"resultsBlended"===t.status)E(_[0]);else{"notion"===(null==M?void 0:M.scopeForNextSearch.type)||"everything"===(null==M?void 0:M.scopeForNextSearch.type)?_.includes("notion")&&E("notion"):E(_[0])}}),[_,E,t.status,null==M?void 0:M.scopeForNextSearch.type,D]);const R=(0,s.useCallback)((async e=>{const{assistantSearchScope:n,useWebSearch:a,searchFilters:i}=e;await async function(e){const{assistantSearchScope:t,filtersForNextSearch:n,threadStore:a,clientStore:i,environment:s,step:o,useWebSearch:r}=e;if((0,G().kh)({threadStore:a,config:{type:"search",scopeForNextSearch:t,useWebSearch:r,filtersForNextSearch:n},environment:s}),a.getCurrentInferenceId()||i.getOrCreateClientAIChatThreadStore(a.id).state.loading){const{serverCommitResult:e}=H().createAndCommit({userAction:"AIChatTranscript.SearchStep.cancelInferenceForNewSearch",environment:s,canUndo:!0,perform:e=>{(0,G().GS)({threadStore:a,transaction:e,clientStore:i})}});await e}(0,G().WF)({environment:s,threadStore:a,stepId:Ot({step:o,threadStore:a}).id})}({assistantSearchScope:n,filtersForNextSearch:i,threadStore:g,clientStore:m,environment:I,step:t,useWebSearch:a})}),[m,I,t,g]),N=(0,s.useCallback)((e=>{b(e),(0,n(65824).V)({environment:I,threadStore:g,stepId:t.id,traceId:t.traceId,showResults:e,from:"deep_find"})}),[I,t.id,t.traceId,g]);return k?(0,ee.jsxs)("div",{style:T.wrap,children:[(0,ee.jsxs)("div",{style:T.deepFindHeaderWrap,children:[(0,ee.jsx)(Et,{isToggleHovered:y,toggledOpen:x,setToggledOpen:N,setIsToggleHovered:v,spaceStore:k,sources:_,step:t}),(0,ee.jsx)(a().N,{children:x?(0,ee.jsx)(i().P.div,{initial:{opacity:0,height:0,overflow:"hidden"},animate:{opacity:1,height:"auto",overflow:"visible"},exit:{opacity:0,height:0,overflow:"hidden"},transition:{duration:.3},children:(0,ee.jsxs)("div",{style:T.content,children:[(0,ee.jsx)(n(364294).g,{toggled:x,step:t,setToggled:N,setIsToggleHovered:v,deepFindFeedbackPayload:void 0,sources:vt().oE(_.map((e=>(0,V().tC)(e)))),selectedDeepFindSource:D?(0,V().tC)(D):void 0,setSelectedDeepFindSource:e=>{!function(e){const{environment:t,threadStore:n,step:a,source:i,position:s}=e,r=n.id,l=(0,V().L2)(n),{traceId:c}=a;if(!l||"search"!==l.type)return;const d=l.searchSessionId;(0,o().u)({environment:t,event:{eventName:"deep_find_select_tab",eventProperties:{tab_name:i,tab_position:s,thread_id:r,search_session_id:d,trace_id:c}}}),"notion-calendar"===i&&(0,It().R)({environment:t,data:{type:"track",payload:{event:"enterpriseSearchAction",action:"tabClicked"}}})}({environment:I,threadStore:g,step:t,source:e,position:_.indexOf((0,V().ZR)(e))}),E("helpdoc"===e?"helpdocs":"all"===e?void 0:e)},assistantSearchScope:t.scope,deepFindSearchFilters:t.filters,useWebSearch:t.useWebSearch,searchAgainAndUpdateAssistantSearchScope:R}),(0,ee.jsx)(Nt,{step:t,source:D,tabPosition:D?_.indexOf(D):-1,spaceStore:k,threadStore:g,showAllResults:h,setShowAllResults:f,handleAnalyticsOnResultClick:(e,n)=>{(0,V().l0)(t)&&function(e){const{result:t,environment:n,threadStore:a,spaceStore:i,position:s,step:r,intl:l,tabPosition:d}=e,u=a.id,p=(0,V().L2)(a),g=Object.values(r.results??{}).flatMap((e=>e)).length,m=r.traceId;if(!p||"search"!==p.type)return;const h=p.searchSessionId,f=(0,V()._R)(r,a.getTranscript());if(!f)return;const y=(0,ft().r4)({textValue:f.value,getRecordModel:i.getRecordModel,userTimeZone:(0,gt().P)(),intl:l})??"";(0,o().u)({environment:n,event:{eventName:"qna_result_clicked",eventProperties:{thread_id:u,search_session_id:h,trace_id:m,clicked_page_id:t.id,position:s,result_type:t.type,source:"list"}}}),"notion-calendar"===t.type&&(0,It().R)({environment:n,data:{type:"track",payload:{event:"enterpriseSearchAction",action:"resultClicked"}}}),(0,o().u)({environment:n,event:{eventName:"select_search_item",eventProperties:{sources:["notion"===t.type?yt().Ni.NotionUnknown:yt().Ni.UniversalUnknown],localSources:void 0,context:"query_results",searchSource:"unified_find_deep_dive",searchSessionId:h??"",aiSessionId:u,traceId:m,originalPosition:s,queryText:void 0,selectedSearchResultMetadata:{blockId:t.id,blockType:void 0},selectedItemIndex:s,isMobile:c().A.isMobile,queryStringLength:(null==y?void 0:y.length)??0,totalSearchResultCount:g,isMetaClick:!1,searchSessionFlowNumber:-1,numLocalResults:0,numTotalLocalResults:0,hasFilters:!1,verificationState:{type:"none"},tabPosition:d,numKeystrokes:void 0,hadMetaClick:!1,timeToSelectMs:-1,timeFromFirstKeyStrokeToSelectMs:void 0,timeToRenderResult:void 0}}})}({result:e,step:t,environment:I,threadStore:g,spaceStore:k,position:n,intl:A,tabPosition:D?_.indexOf(D):-1})}})]})}):null})]}),r&&((0,V().Pp)(t)||P&&x)?(0,ee.jsx)("div",{style:T.content,children:(0,ee.jsx)("div",{style:T.summarizingWrap,children:(0,ee.jsxs)("div",{style:T.messageContent,children:[(0,ee.jsx)(pt().N,{styleKey:"bodyMedium",animate:!0,colorVariant:"secondary",text:(0,ee.jsx)(B().sA,{id:"DeepFindSearchStep.summarize",defaultMessage:"Summarizing"})}),(0,ee.jsx)(xt().A,{isTriColored:!0})]})})}):null]}):null}function Nt(e){const t=(0,p().IS)((()=>({container:{height:256,display:"flex",alignItems:"center",justifyContent:"center",border:`1px solid ${F().Tj.border.secondary}`,borderRadius:12,marginTop:12}})),[]),{step:n}=e,a=!e.source;return!(0,V().l0)(n)||"resultsPartial"===n.status&&a?(0,ee.jsx)("div",{style:{paddingTop:12,paddingBottom:12},children:(0,ee.jsx)(bt()._H,{numberOfRows:5})}):(0,V().Pp)(n)&&a?(0,ee.jsx)("div",{style:t.container,children:(0,ee.jsx)(S().D,{colorVariant:"tertiary",styleKey:"bodyMedium",children:(0,ee.jsx)(B().sA,{id:"DeepFindSearchStep.noResults",defaultMessage:"No results in your Notion workspace"})})}):(0,ee.jsx)(Lt,{...e,step:n})}function Lt(e){var t;const{step:n,source:a,spaceStore:i,showAllResults:r,setShowAllResults:l,handleAnalyticsOnResultClick:c,threadStore:g,tabPosition:m}=e,h=(0,p().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:1},moreButton:{fontSize:St().J.UIRegular.desktop,fontWeight:St().Wy.regular,color:F().Tj.text.secondary,marginInlineStart:-8,padding:8,width:"calc(100% + 20px)",height:"auto",justifyContent:"start"},moreButtonContainer:{display:"flex",alignItems:"center",width:"100%"},icon:{marginInlineEnd:4,padding:2,boxSizing:"content-box"}})),[]),f=(0,d().v3)(),y=(0,u().uB)(void 0,nt().D),S=(0,s.useRef)(null),b=(a?null===(t=n.results)||void 0===t?void 0:t[a]:(0,lt().WP)(n.results??{}).flatMap((([e,t])=>t??[])))??[],x=r?b:b.slice(0,5),I=b.length>5;return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsxs)("div",{style:h.container,ref:S,children:[vt().oE(x.flatMap((({result:e})=>(0,st().SF)(e,i)))).map(((e,t)=>(0,ee.jsx)(Rt().K,{result:e,position:t,onMouseEnter:t=>{"notion"===e.type?y.setState({type:"list",node:t.currentTarget,citationType:"notion",pageId:e.pageId,blockIds:[]}):y.setState({type:"list",node:t.currentTarget,citationType:"universal_search",href:(0,rt().Ve)(e.href)})},onMouseLeave:()=>{y.reset()},onClick:()=>c(e,t)},`${e.id}::${e.text}`))),I?(0,ee.jsx)("div",{style:h.moreButtonContainer,children:(0,ee.jsx)(v().p,{style:h.moreButton,iconLeading:{icon:r?ht().arrowStraightUpFillSmallIcon:mt().arrowStraightDownFillSmallIcon,size:"xs",colorVariant:"secondary",style:h.icon},onClick:()=>{!function(e){const{environment:t,threadStore:n,step:a,source:i,tabPosition:s,showMore:r}=e,l=n.id,c=(0,V().L2)(n),{traceId:d}=a;if(!c||"search"!==c.type)return;const u=c.searchSessionId;(0,o().u)({environment:t,event:{eventName:"deep_find_toggle_show_more",eventProperties:{show_more:r,tab_name:i,tab_position:s,thread_id:l,search_session_id:u,trace_id:d}}})}({environment:f,threadStore:g,step:n,source:a?(0,V().tC)(a):"all",tabPosition:m,showMore:!r}),l(!r)},children:r?(0,ee.jsx)(B().sA,{id:"assistantCitationHelpers.showLess",defaultMessage:"Show less"}):(0,ee.jsx)(B().sA,{id:"assistantCitationHelpers.showMore",defaultMessage:"Show more"})})}):void 0]}),(0,ee.jsx)(tt().cE,{containerRef:S,hoverStore:y,parentStore:i,getPayloadDataForHref:e=>(0,st().vs)(b,e)})]})}function Ot(e){const{step:t,threadStore:n}=e,a=n.getTranscript(),i=a.findIndex((e=>e.id===t.id));return i>0?a[i-1]:t}var Vt=()=>n(614818);const zt={viewBox:"0 0 16 16",fittedViewBox:"2.37 2.37 12.44 12.71",svg:(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)("path",{d:"M4.2 2.375A1.825 1.825 0 0 0 2.375 4.2v7.6c0 1.008.817 1.825 1.825 1.825H6a.075.075 0 0 0 .075-.075v-1.1A.075.075 0 0 0 6 12.375H4.2a.575.575 0 0 1-.575-.575V4.2c0-.318.257-.575.575-.575h7.6c.318 0 .575.257.575.575V6c0 .041.034.075.075.075h1.1A.075.075 0 0 0 13.625 6V4.2A1.825 1.825 0 0 0 11.8 2.375z"}),(0,ee.jsx)("path",{d:"M9.956 6.683a2.47 2.47 0 0 0-2.92.277.625.625 0 1 0 .834.932 1.224 1.224 0 0 1 1.74.111.625.625 0 0 0 .945-.818 2.5 2.5 0 0 0-.6-.502"}),(0,ee.jsx)("path",{d:"M13.864 7.316a2.473 2.473 0 0 0-3.392.851L7.176 13.67a.625.625 0 0 0 .436.938l2.864.464a.625.625 0 0 0 .2-1.233l-1.954-.317 2.822-4.713a1.223 1.223 0 0 1 2.105.01.625.625 0 0 0 1.08-.63 2.46 2.46 0 0 0-.865-.873M8.671 8.845a.736.736 0 1 0-.236 1.454.736.736 0 0 0 .236-1.454"}),(0,ee.jsx)("path",{d:"M12.157 9.41a.736.736 0 1 0-.236 1.454.736.736 0 0 0 .236-1.454"})]})},Wt=(0,E().wt)("aiBlockSmall",zt,"small"),Ut={viewBox:"0 0 16 16",fittedViewBox:"0.49 2.56 14.99 10.87",svg:(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)("path",{d:"M10.259 4.834a2.996 2.996 0 0 1 5.156.028.626.626 0 0 1-1.08.63 1.746 1.746 0 0 0-3.004-.015l-3.756 6.268 2.765.449a.625.625 0 0 1-.2 1.233l-3.673-.595a.626.626 0 0 1-.437-.938zM3.751 10.2a.55.55 0 0 1 0 1.1h-2.7a.55.55 0 1 1 0-1.1zm1.075-2.625a.55.55 0 0 1 0 1.1H1.051a.55.55 0 1 1 0-1.1z"}),(0,ee.jsx)("path",{d:"M11.156 7.115a.974.974 0 1 1 1.922.313.974.974 0 0 1-1.922-.313M6.685 6.39a.974.974 0 1 1 1.923.312.974.974 0 0 1-1.923-.312M4.15 4.95a.55.55 0 0 1 0 1.1h-3.1a.55.55 0 1 1 0-1.1zm1.667-1.623a3 3 0 0 1 4.262.272.626.626 0 0 1-.944.818A1.75 1.75 0 0 0 6.65 4.26a.625.625 0 0 1-.834-.932"})]})},Ht=(0,E().wt)("aiDescriptionSmall",Ut,"small");var Kt=()=>n(979330),qt=()=>n(547090),$t=()=>n(683886),Gt=()=>n(97059);const Yt={viewBox:"0 0 16 16",fittedViewBox:"3.17 2.19 10.47 11.62",svg:(0,ee.jsx)("path",{d:"M5.92 2.446c-1.217-.71-2.745.168-2.745 1.577v7.954c0 1.409 1.528 2.287 2.745 1.577l6.818-3.978c1.207-.704 1.207-2.448 0-3.152zM4.425 4.023c0-.444.481-.72.865-.497l6.818 3.977c.38.222.38.772 0 .994L5.29 12.474a.575.575 0 0 1-.865-.497z"})},Qt=(0,E().wt)("mediaPlaySmall",Yt,"small");const Jt={viewBox:"0 0 16 16",fittedViewBox:"1.97 1.97 12.46 12.46",svg:(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)("path",{d:"M7.613 4.436c-.12-.55-.905-.55-1.026 0l-.181.826a1.5 1.5 0 0 1-1.143 1.144l-.826.181c-.55.121-.55.905 0 1.026l.826.181a1.5 1.5 0 0 1 1.143 1.144l.181.826c.121.55.905.55 1.026 0l.181-.826a1.5 1.5 0 0 1 1.144-1.144l.826-.181c.55-.121.55-.905 0-1.026l-.826-.181a1.5 1.5 0 0 1-1.144-1.144z"}),(0,ee.jsx)("path",{d:"M7.1 1.975a5.125 5.125 0 1 0 3.155 9.164l3.107 3.107a.625.625 0 1 0 .884-.884l-3.107-3.107A5.125 5.125 0 0 0 7.1 1.975M3.225 7.1a3.875 3.875 0 1 1 7.75 0 3.875 3.875 0 0 1-7.75 0"})]})},Xt=(0,E().wt)("sparkleMagnifyingGlassSmall",Jt,"small");var Zt=()=>n(608145);const en={viewBox:"0 0 16 16",fittedViewBox:"2.38 1.92 11.23 12.05",svg:(0,ee.jsx)("path",{d:"M5.9 1.925a.575.575 0 0 0 0 1.15h4.2a.575.575 0 1 0 0-1.15zm-1.4 1.75a.575.575 0 0 0 0 1.15h7a.575.575 0 1 0 0-1.15zm-.237 1.7c-1.036 0-1.875.84-1.875 1.875v4.85c0 1.036.84 1.875 1.875 1.875h7.475c1.035 0 1.875-.84 1.875-1.875V7.25c0-1.035-.84-1.875-1.875-1.875zM3.638 7.25c0-.345.28-.625.625-.625h7.475c.345 0 .625.28.625.625v4.85c0 .345-.28.625-.625.625H4.263a.625.625 0 0 1-.625-.625z"})},tn=(0,E().wt)("stackSmall",en,"small"),nn="aiInferenceTranscript.debug.stepType.",an=["blue","green","purple","orange","pink","red","teal","yellow","brown","gray"];let sn=0;function on(e,t,n){return{id:`${nn}${e}`,defaultMessage:t,description:n}}function rn(e){const[t,n,a]=e.label,[i,s,o]=e.tooltip,r=e.colorPalette??function(){if(sn>=an.length)return an[an.length-1];const e=an[sn];return sn+=1,e}();return{icon:e.icon,label:{descriptor:on(t,n,a)},tooltip:{descriptor:on(i,s,o)},colorPalette:r}}const ln={user:rn({icon:n(856499).personSmallIcon,label:["user.label","User message","Label for transcript debug steps that capture the user's message."],tooltip:["user.tooltip","Original request and metadata provided by the user for this turn.","Tooltip describing user steps within the transcript debug view."]}),config:rn({icon:n(274065).gearSmallIcon,label:["config.label","Configuration","Label for transcript debug steps that store configuration details."],tooltip:["config.tooltip","Thread configuration such as surface, feature flags, and model settings.","Tooltip explaining what the configuration step contains in the debug panel."]}),context:rn({icon:tn,label:["context.label","System context","Label for transcript debug steps that summarise system-provided context."],tooltip:["context.tooltip","Context gathered by Notion prior to the agent executing this turn.","Tooltip describing context summary debug steps in the transcript."]}),"user-specified-context":rn({icon:tn,label:["userSpecifiedContext.label","User-provided context","Label for transcript debug steps that contain user provided context."],tooltip:["userSpecifiedContext.tooltip","Additional context the user supplied before running the agent.","Tooltip describing user supplied context debug steps in the transcript."]}),attachment:rn({icon:n(37142).x,label:["attachment.label","Attachment","Label for transcript debug steps that represent uploaded attachments."],tooltip:["attachment.tooltip","Files and media attached to this turn for the agent to reference.","Tooltip describing attachment debug steps in the transcript."]}),"agent-inference":rn({icon:Ht,label:["agentInference.label","Agent reasoning","Label for transcript debug steps that store the agent's inference output."],tooltip:["agentInference.tooltip","Model thoughts, intermediate reasoning, and streamed tool calls.","Tooltip describing agent inference debug steps in the transcript."]}),"agent-tool-result":rn({icon:Xt,label:["agentToolResult.label","Tool call result","Label for transcript debug steps that capture the output of a tool call."],tooltip:["agentToolResult.tooltip","Response data returned by tools the agent invoked while running this turn.","Tooltip explaining what tool result debug steps contain."]}),"agent-debug-error":rn({icon:A().exclamationMarkTriangleSmallIcon,label:["agentDebugError.label","Agent debug error","Label for transcript debug steps that capture internal agent errors."],tooltip:["agentDebugError.tooltip","Detailed error information captured while executing the agent.","Tooltip describing agent debug error steps in the transcript."]}),"agent-trigger":rn({icon:n(598900).f,label:["agentTrigger.label","Automation trigger","Label for transcript debug steps that initiated an agent workflow."],tooltip:["agentTrigger.tooltip","Trigger payload or workflow input that caused the agent to run.","Tooltip describing agent trigger debug steps in the transcript."]}),"agent-route-trigger":rn({icon:n(424735).arrowBranchSmallIcon,label:["agentRouteTrigger.label","Route trigger","Label for transcript debug steps that show routing decisions."],tooltip:["agentRouteTrigger.tooltip","Details about how the agent routed execution to a particular branch.","Tooltip describing agent route trigger debug steps in the transcript."]}),"eval-result":rn({icon:qt().j,label:["evalResult.label","Evaluation result","Label for transcript debug steps that contain automated evaluation results."],tooltip:["evalResult.tooltip","Scores or feedback generated by automated evals monitoring the agent.","Tooltip describing evaluation result debug steps in the transcript."]}),"premium-feature-unavailable":rn({icon:n(642557).lockSmallIcon,label:["premiumFeatureUnavailable.label","Premium feature notice","Label for transcript debug steps that show premium feature availability issues."],tooltip:["premiumFeatureUnavailable.tooltip","Indicates the agent attempted to use a premium feature that is not enabled.","Tooltip describing premium feature unavailable debug steps in the transcript."]}),"agent-transcript-summary":rn({icon:Kt().n,label:["agentTranscriptSummary.label","Transcript summary","Label for transcript debug steps that hold agent authored summaries."],tooltip:["agentTranscriptSummary.tooltip","Running summary of the conversation produced by the agent.","Tooltip describing agent transcript summary steps in the debug view."]}),"agent-records-updated":rn({icon:n(833243).checkmarkCircleSmallIcon,label:["agentRecordsUpdated.label","Records updated","Label for transcript debug steps that describe record updates."],tooltip:["agentRecordsUpdated.tooltip","Lists the records the agent modified as part of this step.","Tooltip describing agent records updated debug steps in the transcript."]}),"agent-turn-start":rn({icon:Qt,label:["agentTurnStart.label","Turn start","Label for transcript debug steps that mark the beginning of an agent turn."],tooltip:["agentTurnStart.tooltip","Marker indicating when the agent began processing this turn.","Tooltip describing agent turn start debug steps in the transcript."]}),"agent-turn-full-record-map":rn({icon:tn,label:["agentTurnFullRecordMap.label","Turn record map","Label for transcript debug steps that include the turn's full record map."],tooltip:["agentTurnFullRecordMap.tooltip","Complete record map captured for this turn, including referenced records.","Tooltip describing turn record map debug steps in the transcript."]}),"agent-record-map":rn({icon:tn,label:["agentRecordMap.label","Record map","Label for transcript debug steps that contain a partial record map."],tooltip:["agentRecordMap.tooltip","Subset of records fetched or produced during this step.","Tooltip describing agent record map debug steps in the transcript."]}),"agent-prebuilt-prompt":rn({icon:Zt().sparklesSmallIcon,label:["agentPrebuiltPrompt.label","Prebuilt prompt","Label for transcript debug steps that store a prebuilt prompt."],tooltip:["agentPrebuiltPrompt.tooltip","Prompt template injected into the agent before executing this step.","Tooltip describing agent prebuilt prompt debug steps in the transcript."]}),"agent-integration":rn({icon:n(714318).plugSmallIcon,label:["agentIntegration.label","Integration call","Label for transcript debug steps that log integration activity."],tooltip:["agentIntegration.tooltip","Metadata about calls to external integrations triggered by the agent.","Tooltip describing agent integration debug steps in the transcript."]}),"agent-search-query-generation":rn({icon:At().magnifyingGlassSmallIcon,label:["agentSearchQueryGeneration.label","Search query","Label for transcript debug steps that record generated search queries."],tooltip:["agentSearchQueryGeneration.tooltip","Query constructed for a search tool invocation within this turn.","Tooltip describing agent search query generation debug steps."]}),"debug-inference":rn({icon:Xt,label:["debugInference.label","Debug inference","Label for transcript debug steps that contain raw inference payloads."],tooltip:["debugInference.tooltip","Raw inference payload emitted for debugging purposes.","Tooltip describing debug inference steps in the transcript."]}),autocorrect:rn({icon:Gt().s,label:["autocorrect.label","Autocorrect","Label for transcript debug steps that record autocorrect adjustments."],tooltip:["autocorrect.tooltip","Automatic corrections the system applied to the user's request.","Tooltip describing autocorrect debug steps in the transcript."]}),autocomplete:rn({icon:Gt().s,label:["autocomplete.label","Autocomplete suggestion","Label for transcript debug steps that store autocomplete suggestions."],tooltip:["autocomplete.tooltip","Suggested completions generated to assist the user.","Tooltip describing autocomplete debug steps in the transcript."]}),"memory-agent":rn({icon:Zt().sparklesSmallIcon,label:["memoryAgent.label","Memory agent","Label for transcript debug steps that record memory agent activity."],tooltip:["memoryAgent.tooltip","Reads or writes performed by the memory agent during this turn.","Tooltip describing memory agent debug steps in the transcript."]}),"summarize-transcript":rn({icon:$t().J,label:["summarizeTranscript.label","Summary request","Label for transcript debug steps that initiate transcript summarisation."],tooltip:["summarizeTranscript.tooltip","Request issued to generate a summary of the transcript so far.","Tooltip describing summarize transcript debug steps in the transcript."]}),"summarize-transcript-record-map":rn({icon:tn,label:["summarizeTranscriptRecordMap.label","Summary record map","Label for transcript debug steps that store record maps for summarisation."],tooltip:["summarizeTranscriptRecordMap.tooltip","Record map gathered while preparing the transcript summary.","Tooltip describing summarize transcript record map debug steps."]}),"summarize-transcript-error":rn({icon:A().exclamationMarkTriangleSmallIcon,label:["summarizeTranscriptError.label","Summary error","Label for transcript debug steps that log summarisation errors."],tooltip:["summarizeTranscriptError.tooltip","Error information captured while attempting to summarise the transcript.","Tooltip describing summarize transcript error debug steps."]}),"record-pointers-updated":rn({icon:n(703778).linkSmallIcon,label:["recordPointersUpdated.label","Record pointers updated","Label for transcript debug steps that record pointer updates."],tooltip:["recordPointersUpdated.tooltip","References that were updated as part of this step.","Tooltip describing record pointers updated debug steps in the transcript."]}),"search-observation":rn({icon:At().magnifyingGlassSmallIcon,label:["searchObservation.label","Search observation","Label for transcript debug steps that log search observations."],tooltip:["searchObservation.tooltip","Observations captured while performing agent-driven search.","Tooltip describing search observation debug steps in the transcript."]}),"researcher-text-observation":rn({icon:$t().J,label:["researcherTextObservation.label","Text observation","Label for transcript debug steps that store researcher text observations."],tooltip:["researcherTextObservation.tooltip","Text that the researcher agent extracted while analysing sources.","Tooltip describing researcher text observation debug steps."]}),"researcher-next-steps":rn({icon:qt().j,label:["researcherNextSteps.label","Next steps","Label for transcript debug steps that list suggested next steps."],tooltip:["researcherNextSteps.tooltip","Recommendations the researcher agent provided for continuing work.","Tooltip describing researcher next steps debug entries in the transcript."]}),mention:rn({icon:Kt().n,label:["mention.label","Mention","Label for transcript debug steps that represent mentions."],tooltip:["mention.tooltip","Metadata for mentions resolved within the transcript.","Tooltip describing mention debug steps in the transcript."]}),aiBlockResponse:rn({icon:Wt,label:["aiBlockResponse.label","AI block response","Label for transcript debug steps that render responses for AI blocks."],tooltip:["aiBlockResponse.tooltip","Rendered content shown in the AI block on the page.","Tooltip describing AI block response debug steps in the transcript."]}),"system-notification":rn({icon:n(588047).k,label:["systemNotification.label","System notification","Label for transcript debug steps that surface system notifications."],tooltip:["systemNotification.tooltip","Notices and warnings shown to the user alongside the agent transcript.","Tooltip describing system notification debug steps in the transcript."]}),"generate-formula":rn({icon:Gt().s,label:["generateFormula.label","Formula generation","Label for transcript debug steps that capture formula generation output."],tooltip:["generateFormula.tooltip","Details about formulas generated by the agent during this step.","Tooltip describing generate formula debug steps in the transcript."]}),wait:rn({icon:n(181088).clockSmallIcon,label:["wait.label","Waiting","Label for transcript debug steps that represent wait periods."],tooltip:["wait.tooltip","Indicates the agent is waiting on background work before continuing.","Tooltip describing wait debug steps in the transcript."]}),error:rn({icon:A().exclamationMarkTriangleSmallIcon,label:["error.label","Error","Label for transcript debug steps that capture user-visible errors."],tooltip:["error.tooltip","User-friendly error surfaced in place of the original agent output.","Tooltip describing error debug steps in the transcript."]}),"agent-message":rn({icon:Kt().n,label:["agentMessage.label","Agent message","Label for transcript debug steps that render agent authored messages."],tooltip:["agentMessage.tooltip","Message the agent sent to the user during this turn.","Tooltip describing agent message debug steps in the transcript."]})},cn=on("fallback.label","{stepType}","Fallback label when a step type has no explicit metadata mapping."),dn=on("fallback.tooltip",'Debug data for step type "{stepType}".',"Fallback tooltip when a step type has no explicit metadata mapping.");const un=4;const pn=["results","items","records","entries","values","data"],gn=160,mn=36,hn=3;function fn(e){if("string"==typeof e.error&&e.error.trim().length>0)return{variant:"error",error:Sn(e.error,gn)};const t={variant:"data"};e.state&&(t.state=e.state),(e.insufficientPermissions||e.insufficientPermissionsDetails)&&(t.insufficientPermissions=!0);const n=yn(e.result)??yn(e.additionalResultForRender);if(n&&n.length>0){const{items:e,truncated:a}=function(e){const t=[];for(const n of e){if(t.length>=hn)break;const e=vn(n);e&&t.push(Sn(e,mn))}return{items:t,truncated:e.length>t.length}}(n);t.results={count:n.length,items:e,truncated:a||n.length>e.length}}else{const n=vn(e.result)??vn(e.threadOperations)??vn(e.input)??bn(e.result);n&&(t.rawSnippet=Sn(n,gn))}return t}function yn(e){if(Array.isArray(e))return e;if((0,lt().Gv)(e)&&!Array.isArray(e))for(const t of pn){const n=e[t];if(Array.isArray(n)&&n.length>0)return n}}function vn(e){return"string"==typeof e?e:"number"==typeof e||"boolean"==typeof e?String(e):Array.isArray(e)?e.filter(Boolean).join(", "):(0,lt().Gv)(e)?bn(e):void 0}function Sn(e,t){return e.length<=t?e:`${e.slice(0,t-1)}`}function bn(e){try{return JSON.stringify(e)}catch{return}}function xn(e){const t=(0,d().v3)(),{config:a,threadStore:i}=e,s=(0,u().K8)((()=>i.getSpaceId()),[i]),o=(0,Je()._)({name:"researcher"===a.type?"ai_research_mode":"ai_usage",spaceId:s,userId:t.currentUser.id,amount:1}),r=(0,ie().bl)(a),{upsellMessage:l,actionButtonMsg:c,actionForFeatureAvailability:g}=(0,se().x)({featureAvailability:o,upsellFrom:r}),m=(0,oe().o)({featureAvailability:o,source:r,type:"text"}),h=(0,oe().o)({featureAvailability:o,source:r,type:"primary"}),f=(0,ae().X)("upgrade_system_ai"),{bodyStyleKey:y}=(0,J().yq)(),v=(0,J().Cd)(y),S=(0,p().IS)((()=>({container:{padding:8,marginBottom:20},button:{alignSelf:"flex-start",borderRadius:100,display:"flex",marginTop:12,marginBottom:6,padding:"7px 12px",width:"fit-content"},wrapper:{...v,padding:10}})),[v]);return(0,ee.jsx)(ne().Q,{style:S.container,children:(0,ee.jsx)("div",{style:S.wrapper,children:f?m&&h?(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(re().UpgradeButton,{...m}),(0,ee.jsx)(re().UpgradeButton,{...h})]}):null:(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)("div",{children:l}),c?(0,ee.jsx)(Z().A,{colorPalette:"blue",onClick:g,iconLeading:{icon:n(71805).arrowInCircleUpSmallIcon,size:"sm"},style:S.button,children:c}):void 0]})})})}var In=()=>n(412412),kn=()=>n(975366);function wn(e){if(!(0,In().UB)(e)){const t=e.value.trim();return t?[{kind:"text",text:t}]:[]}switch(e.tagName){case"content":{const t=(0,In().PJ)(e.children??[]).trim();return t?[{kind:"markdown",markdown:t}]:[]}case"properties":{const t=(0,In().PJ)(e.children??[]).trim();if(!t)return[];const n=function(e){try{return function(e){if(!(0,lt().Gv)(e))return;const t={};for(const[n,a]of(0,lt().WP)(e))t[n]=Mn(a);return t}(JSON.parse(e))}catch{return}}(t);return n?[{kind:"properties",properties:n}]:[Cn(t)]}case"warnings":{const t=(0,In().PJ)(e.children??[]).trim();return t?[{kind:"warning",message:t}]:[]}default:{const t=(0,In()._o)(e).trim();return t?[{kind:"markdown",markdown:t}]:[]}}}function Cn(e){return{kind:"markdown",markdown:e}}function An(e){const{content:t,aiChatFeatureController:n,turnSteps:a}=e,i=(0,s.useMemo)((()=>function(e){const t=e.trim();if(!t)return[];try{const e=(0,In().BD)(t);return e.length?e.flatMap(wn):[Cn(t)]}catch{return[Cn(t)]}}(t)),[t]),o=(0,p().IS)((()=>({container:{width:"100%"},warningBox:{borderRadius:8,padding:"8px 10px",border:`1px solid ${F().Tj.border.secondary}`,backgroundColor:F().Tj.background.secondaryTranslucent},propertiesGroup:{border:`1px solid ${F().Tj.border.secondary}`,borderRadius:8,padding:8,backgroundColor:F().Tj.background.primary},propertyRow:{display:"grid",gridTemplateColumns:"160px 1fr",gap:8,alignItems:"flex-start"},propertyName:{wordBreak:"break-word"}})),[]);return 0===i.length?null:(0,ee.jsx)(h().Y1,{direction:"vertical",gap:8,children:i.map(((e,t)=>{switch(e.kind){case"text":return(0,ee.jsx)(kn().h,{markdown:e.text,aiChatFeatureController:n,turnSteps:a},`text-${t}`);case"markdown":return(0,ee.jsx)(kn().h,{markdown:e.markdown,aiChatFeatureController:n,turnSteps:a},`markdown-${t}`);case"properties":return(0,ee.jsx)("div",{style:o.propertiesGroup,children:Tn({properties:e.properties,styles:o,turnSteps:a,aiChatFeatureController:n})},`properties-${t}`);case"warning":return(0,ee.jsx)("div",{style:o.warningBox,children:(0,ee.jsx)(S().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:e.message})},`warning-${t}`);default:return null}}))})}function Tn(e){const{properties:t,styles:n,turnSteps:a,aiChatFeatureController:i}=e,s=(0,lt().WP)(t);return 0===s.length?null:(0,ee.jsx)(h().Y1,{direction:"vertical",gap:8,children:s.map((([e,t])=>(0,ee.jsxs)("div",{style:n.propertyRow,children:[(0,ee.jsx)(S().D,{styleKey:"captionMedium",colorVariant:"tertiary",style:n.propertyName,children:e}),(0,ee.jsx)("div",{style:{minWidth:0},children:(0,ee.jsx)(kn().h,{markdown:jn(t),turnSteps:a,aiChatFeatureController:i})})]},e)))})}function jn(e){return null==e?"":Array.isArray(e)?e.map((e=>jn(e))).join(", "):String(e)}function Mn(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||null==e?e:Array.isArray(e)?e.map((e=>_n(e))):_n(e)}function _n(e){if(null==e)return"";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return String(e);try{return JSON.stringify(e)}catch{return String(e)}}n(803949);var Pn=()=>n(692031),Dn=()=>n(212497),En=()=>n(993905),Rn=()=>n(933528),Bn=()=>n(241178),Fn=()=>n(484127),Nn=()=>n(188158),Ln=()=>n(483730),On=()=>n(492414),Vn=()=>n(255063);const zn=(0,B().YK)({copy:{id:"ResearchModeReportStep.copy",defaultMessage:"Copy"},reportGeneratingTooltipHeader:{id:"ResearchModeReportStep.reportGeneratingTooltipHeader",defaultMessage:"Report is being generated..."},reportGeneratingTooltipBody:{id:"ResearchModeReportStep.reportGeneratingTooltipBody",defaultMessage:"Actions will be available when the report is complete"},saveAsPageTooltip:{id:"ResearchModeReportStep.saveAsPageTooltip",defaultMessage:"Save report to your private pages"},saveAsPageToLocationTooltip:{id:"ResearchModeReportStep.saveAsPageToLocationTooltip",defaultMessage:"Select a location to save your report"},saveAsPage:{id:"ResearchModeReportStep.saveAsPage",defaultMessage:"Save as page"}});function Wn({linkAnnotation:e,citationInfo:t,environment:n}){const a=be().cQR(e);if(!a)return{annotations:[e],status:"other_link"};const i=a.indexOf("#citation:");if(-1===i)return{annotations:[e],status:"other_link"};const s=decodeURIComponent(a.slice(i+10)),[o,r,l]=s.split(","),c=t.stepCitations[o];if(!c)return{annotations:[e],status:"missing_citation"};const d=t=>{if(!t.citationInfo)return e;if("notion"===t.citationInfo.citationType)return be().X$({href:t.citationInfo.blockId?(0,On().Ay)({store:new(pe().B)(n,{table:"block",id:t.citationInfo.blockId}),fullyQualified:!1,pageVisitSource:me().y8.AIQna}):(0,On().Ay)({store:new(pe().B)(n,{table:"block",id:t.citationInfo.pageId}),fullyQualified:!1,pageVisitSource:me().y8.AIQna}),blockId:t.citationInfo.blockId||t.citationInfo.pageId,type:"block"});if("universal_search"===t.citationInfo.citationType){if("slack"===t.citationInfo.target){const e=t.citationInfo.href;return be().X$({href:(0,rt().V9)(e),threadHref:(0,rt().V9)(e),type:"slack",domain:t.citationInfo.domain||"",baseUrl:t.citationInfo.baseUrl||"",channelId:t.citationInfo.channelId||"",messageId:t.citationInfo.messageId||"",threadTs:t.citationInfo.threadTs||""})}if("google-drive"===t.citationInfo.target)return be().X$({href:(0,rt().V9)(t.citationInfo.href),type:"google-drive",messageId:t.citationInfo.messageId||"",url:t.citationInfo.url||""});if("github"===t.citationInfo.target)return be().X$({href:(0,rt().V9)(t.citationInfo.href),type:"github",messageId:t.citationInfo.messageId||"",url:t.citationInfo.url||""});if("jira"===t.citationInfo.target)return be().X$({href:(0,rt().V9)(t.citationInfo.href),type:"jira",messageId:t.citationInfo.messageId||"",url:t.citationInfo.url||""});if("webpage"===t.citationInfo.target){const e=(0,Rn().OU)(t.citationInfo.href);return be().X$({href:(0,rt().RW)(t.citationInfo.href),type:"webpage",url:(null==e?void 0:e.url)||""})}}return e};if("claim"===r){var u;const t=(c.claims||[]).find((e=>e.id===l));if(!t)return{annotations:[e],status:"missing_citation"};const n=(null===(u=c.artifacts)||void 0===u?void 0:u.filter((e=>{var n;return null===(n=t.supportingArtifactIds)||void 0===n?void 0:n.includes(e.id)})))??[];return n.length?{annotations:n.map(d),status:"citation"}:{annotations:[e],status:"missing_citation"}}if("artifact"===r){var p;const t=null===(p=c.artifacts)||void 0===p?void 0:p.find((e=>e.id===l));return t?{annotations:[d(t)],status:"citation"}:{annotations:[e],status:"missing_citation"}}return{annotations:[e],status:"missing_citation"}}function Un({processedMarkdownList:e,environment:t,clipboardActions:n,linkAnnotationToCitationAnnotations:a,useExportedCitations:i}){const o=(0,ue().fJ)(_e().g),r=(0,ue().fJ)(Pe().S);return(0,s.useMemo)((()=>{if(!e.length||!n)return;if(["idle","pending"].includes(o.status)||["idle","pending"].includes(r.status))return;const s=o.value,l=r.value;return s&&l?e.map((e=>et().e.withListenerIgnored((()=>(0,Fe().eQ)({markdown:e,environment:t,linkAnnotationToCitationAnnotations:a,useExportedCitations:i,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l,clipboardActions:n}))))):void 0}),[e,t,o,r,n,a,i])}function Hn(e){const t=(0,u().K8)((()=>Ln().default.getActiveSession()),[]);return(0,u().K8)((()=>{if(!t)return;const n=t.evaluatorFromStoreState.state;return e&&e.stepCitations&&Object.values(e.stepCitations).forEach((e=>{var t;null===(t=e.artifacts)||void 0===t||t.forEach((e=>{var t;if("universal_search"===(null===(t=e.citationInfo)||void 0===t?void 0:t.citationType))if("slack"===e.citationInfo.target){const t=(0,Rn().L1)(e.citationInfo.href);if(t){const a=e.citationInfo.title||"",i=e.citationInfo.text||"",s=e.citationInfo.messages||[],o=s.length>0?s.map((e=>(0,rt().V9)(e.messageId))):[(0,rt().V9)(e.citationInfo.href)];n.setUniversalResultPayload((0,rt().V9)(e.citationInfo.href),{href:(0,rt().V9)(e.citationInfo.href),threadHref:(0,rt().V9)(e.citationInfo.href),type:"slack",title:a,text:i,lastEdited:"",user:"",...t,threadMessages:o}),s.forEach(((e,t)=>{const s=(0,Rn().L1)(e.messageId);s&&(0===t&&s.threadTs&&n.setUniversalResultPayload((0,rt().V9)(e.threadId),{href:(0,rt().V9)(e.threadId),type:"slack",threadHref:(0,rt().V9)(e.threadId),title:a,text:i,user:"",lastEdited:e.lastEdited,domain:s.domain,baseUrl:s.baseUrl,channelId:s.channelId,messageId:s.messageId,threadTs:s.threadTs,threadMessages:o}),n.setUniversalResultPayload((0,rt().V9)(e.messageId),{href:(0,rt().V9)(e.messageId),type:"slack",threadHref:(0,rt().V9)(e.threadId),title:a,text:e.text,user:e.user,lastEdited:e.lastEdited,domain:s.domain,baseUrl:s.baseUrl,channelId:s.channelId,messageId:s.messageId,threadTs:s.threadTs,threadMessages:o}))}))}}else"google-drive"===e.citationInfo.target?n.setUniversalResultPayload((0,rt().V9)(e.citationInfo.href),{href:(0,rt().V9)(e.citationInfo.href),type:"google-drive",title:e.citationInfo.title||"",text:e.citationInfo.text||"",lastEdited:"",url:e.citationInfo.url||""}):"github"===e.citationInfo.target?n.setUniversalResultPayload((0,rt().V9)(e.citationInfo.href),{href:(0,rt().V9)(e.citationInfo.href),type:"github",title:e.citationInfo.title||"",text:e.citationInfo.text||"",lastEdited:"",url:e.citationInfo.url||""}):"jira"===e.citationInfo.target?n.setUniversalResultPayload((0,rt().V9)(e.citationInfo.href),{href:(0,rt().V9)(e.citationInfo.href),type:"jira",title:e.citationInfo.title||"",text:e.citationInfo.text||"",lastEdited:"",url:e.citationInfo.url||""}):"webpage"===e.citationInfo.target&&n.setUniversalResultPayload((0,rt().RW)(e.citationInfo.href),{href:(0,rt().RW)(e.citationInfo.href),type:"webpage",title:e.citationInfo.title||"",text:e.citationInfo.text||"",lastEdited:"",url:e.citationInfo.url||""})}))})),n}),[e,t])}function Kn(e){const{step:t,wrapInAssistantSurfaceProvider:n}=e,a=(0,r().L)();return a?n?(0,ee.jsx)(Me().hP,{surface:Me().wy.fullPage,children:(0,ee.jsx)(qn,{spaceStore:a,markdown:t.value,citationInfo:t.citationInfo||{stepCitations:{}}})}):(0,ee.jsx)(qn,{spaceStore:a,markdown:t.value,citationInfo:t.citationInfo||{stepCitations:{}}}):null}function qn(e){const{markdown:t,citationInfo:n,spaceStore:a}=e,i=(0,s.useRef)(null),o=(0,d().v3)(),r=(0,p().IS)((()=>({container:{display:"flex",flexDirection:"column",position:"relative",marginBottom:16,gap:16}})),[]),l=(0,u().uB)(void 0,nt().D),c=Hn(n);(0,Nn().c2)({containerRef:i,citationHoverStore:l,parentStore:a,evaluatorState:c});const g=(0,s.useMemo)((()=>[(0,Fn().y5)(t)]),[t]),{value:m}=(0,ue().fJ)(xe().R.clipboardActions),h=(0,s.useCallback)((e=>Wn({linkAnnotation:e,citationInfo:n,environment:o})),[n,o]),f=Un({processedMarkdownList:g,environment:o,clipboardActions:m,linkAnnotationToCitationAnnotations:h,useExportedCitations:!1}),y=null==f?void 0:f[0],v=(0,s.useMemo)((()=>{const e=[];for(const t in n.stepCitations){const a=n.stepCitations[t];for(const t of a.artifacts||[])e.push(t.citationInfo)}return e}),[n.stepCitations]);return y?(0,ee.jsxs)("div",{style:r.container,ref:i,children:[(0,ee.jsx)(at().c,{displayName:"AIChatTranscript.ResearcherReportStep",disabled:!0,children:(0,ee.jsx)(En().s,{allowSelectionWithin:!0,children:(0,ee.jsx)(it().A,{store:y,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0})})}),(0,ee.jsx)(tt().cE,{containerRef:i,hoverStore:l,parentStore:a,getPayloadDataForHref:e=>{const t=v.filter((e=>"universal_search"===(null==e?void 0:e.citationType)));return(0,Vn().Dd)(t,e)},useCompactWebPreview:!0})]}):null}function $n(e){const{step:t,wrapInAssistantSurfaceProvider:n}=e,a=(0,r().L)();return a?n?(0,ee.jsx)(Me().hP,{surface:Me().wy.fullPage,children:(0,ee.jsx)(Gn,{step:t,spaceStore:a})}):(0,ee.jsx)(Gn,{step:t,spaceStore:a}):null}function Gn(e){const{navigate:t}=(0,s.useContext)(de().E),{step:n,spaceStore:a}=e,i=n.finished,o=(0,s.useMemo)((()=>n.citationInfo||{stepCitations:{}}),[n]),r=(0,p().IS)((()=>({container:{display:"flex",gap:8}})),[]),l=(0,d().v3)(),g=(0,W().qO)(),m=(0,u().K8)((()=>l.RouterStore.state.route),[l]),h=(0,s.useMemo)((()=>[(0,Fn().y5)(n.value)]),[n.value]),{value:f}=(0,ue().fJ)(xe().R.clipboardActions),{value:y}=(0,ue().fJ)(Pn().e),{value:v}=(0,ue().fJ)(Dn().OM),S=(0,s.useCallback)((e=>Wn({linkAnnotation:e,citationInfo:o,environment:l})),[o,l]),x=Un({processedMarkdownList:h,environment:l,clipboardActions:f,linkAnnotationToCitationAnnotations:S,useExportedCitations:!1}),I=null==x?void 0:x[0],k=Boolean(I),w=(0,s.useCallback)((()=>{var e;if(!v||!y)return;const t=h[0];if(!t)return;const n=new Map;let a=1;const i=t.replace(/\[(\*\*\[\d+\]\*\*)\]\(#citation:([^)]+)\)/g,((e,t,i)=>{try{const e=decodeURIComponent(i),[t,r,c]=e.split(",");if(!t||!r||!c)return"";const d=o.stepCitations[t];if(!d)return"";let u=[];if("claim"===r){const e=d.claims.find((e=>e.id===c));null!=e&&e.supportingArtifactIds&&(u=e.supportingArtifactIds.map((e=>{var t;return null===(t=d.artifacts)||void 0===t?void 0:t.find((t=>t.id===e))})).filter(Boolean)??[])}else if("artifact"===r){var s;const e=null===(s=d.artifacts)||void 0===s?void 0:s.find((e=>e.id===c));e&&(u=[e])}if(!u.length)return"";const p=u.map((e=>function(e,t){if(null==e||!e.citationInfo)return;const n=e.citationInfo;if("notion"===n.citationType){const e=n.blockId??n.pageId;if(!e)return;return(0,On().Ay)({store:new(pe().B)(t,{table:"block",id:e}),fullyQualified:!0,pageVisitSource:me().y8.AIQna})}if("universal_search"===n.citationType){if("slack"===n.target){const{baseUrl:e,channelId:t,messageId:a,domain:i,threadTs:s}=n;return t&&a?(0,Bn().mQ)({baseUrl:e,channelId:t,messageId:a,domain:i,threadTs:s}):n.baseUrl||n.href}return n.url}}(e,l))).filter((e=>Boolean(e))).map((e=>{let t=n.get(e);return void 0===t&&(t=a++,n.set(e,t)),`[[${t}]](${e})`}));return p.join("")}catch(r){return""}}));v.copyString({environment:l,stringValue:i,copiedMessage:y.clipboardMessages.copiedToClipboard}),null===(e=g.trackResearchModeReportCopied)||void 0===e||e.call(g)}),[l,h,g,o,y,v]);(0,s.useEffect)((()=>{var e;k&&(null===(e=g.trackResearchModeReportFirstCharRendered)||void 0===e||e.call(g))}),[g,k]);const C=(0,ue().fJ)(_e().g),A=(0,ue().fJ)(Pe().S),T=(0,s.useCallback)((e=>{if("chat"===m.name){const n=(0,he().EY)({currentRoute:m,pageId:e.id,pageVisitSource:me().y8.AIQna,isMobile:c().A.isMobile});t({environment:l,url:n})}else we().uK({environment:l,store:e,pageVisitSource:me().y8.AIQna,openInSidePeek:!0})}),[l,m,t]),j=(0,s.useCallback)(((e,t,n,a)=>{if(!f)return;const i=n.inMemoryRecordCache.makeGetRecordModelFn(e.currentUser.id),s=f.markdownToBlocks({environment:e,text:a,inMemoryRecordCache:n.inMemoryRecordCache,transaction:t,markdownOptions:{},markdownLinkifyIt:C.value,tinyMceMicrosoftWordPasteFilter:A.value,parentPointer:n.getSpaceShardedPointer()});if(!s||0===s.length)return;const o=(0,Fe().N5)({linkAnnotationToCitationAnnotations:S,useExportedCitations:!0,getRecordModelFn:i});for(const d of s)(0,Fe().YA)({store:d,environment:e,transaction:t,modifyTokens:o});const r="header"===s[0].getType()?s.shift():void 0;var l;r?Re().R9({environment:e,store:n.getBlockTitleStore(),value:(null===(l=r.getTitleStore())||void 0===l?void 0:l.getValue())||be().x9d(""),transaction:t}):Re().R9({environment:e,store:n.getBlockTitleStore(),value:be().x9d("New Report"),transaction:t});const c=n.getContentStore();for(const d of s)Ie().NI({childStore:d,parentStore:c,transaction:t})}),[f,S,C.value,A.value]),M=(0,s.useCallback)((async()=>{var e;if(!f)return;if(["idle","pending"].includes(C.status)||["idle","pending"].includes(A.status))return;const t=h[0];if(!t)return;const n=await(0,Ee().M)({environment:l,from:"research_mode_report",pageVisitSource:me().y8.AIQna,navigateOnCreate:!1});n&&(H().createAndCommit({userAction:"ResearchModeReportStep.createReportPage",environment:l,canUndo:!1,perform:e=>{j(l,e,n,t)}}),null===(e=g.trackResearchModeReportSavedToPage)||void 0===e||e.call(g),T(n))}),[g,T,l,f,C,A,h,j]),_=(0,s.useCallback)((e=>{e.stopPropagation();const t=e.currentTarget.getBoundingClientRect(),n=(0,U().Z1)({environment:l,table:Se().ev,spaceId:a.id}),i=pe().B.createChildStore(a,{table:Se().ev,id:n,spaceId:a.id});De().ho({environment:l,blocks:[i],originRect:t,moveToContext:"action_menu",isAddTo:!1,disableSuccessToast:!0,forceShowPrivatePageOption:!0,dontCommitActions:!0,onAccept:({value:e})=>{(e=>{var t;if(!f)return;if(["idle","pending"].includes(C.status)||["idle","pending"].includes(A.status))return;const s=h[0];if(!s)return;if(!e.addBlockToPage||"page"!==e.addBlockToPage.target)return;const{pageId:o}=e.addBlockToPage,r=new(pe().B)(l,{table:Se().ev,id:o,spaceId:a.id});H().createAndCommit({userAction:"ResearchModeReportStep.createReportPage",environment:l,canUndo:!1,perform:e=>{O().Wv({environment:l,id:n,type:"page",spaceId:a.id,transaction:e,inMemoryRecordCache:i.inMemoryRecordCache}),j(l,e,i,s),Ie().NI({childStore:i,parentStore:r.getContentStore(),transaction:e})}}),T(i),null===(t=g.trackResearchModeReportSavedToPage)||void 0===t||t.call(g)})((0,Te()._W)(e))}})}),[l,g,T,a,f,C,A,h,j]);return(0,ee.jsxs)("div",{style:r.container,children:[(0,ee.jsx)(b().m,{renderTooltip:()=>i?(0,ee.jsx)(B().sA,{...zn.copy}):(0,ee.jsx)(Yn,{}),render:e=>(0,ee.jsx)(je().Ay,{icon:ye().V,onClick:w,title:(0,ee.jsx)(B().sA,{...zn.copy}),variant:"tinted",disabled:!i,tooltipEvents:e})}),(0,ee.jsx)(b().m,{renderTooltip:()=>i?(0,ee.jsx)(B().sA,{...zn.saveAsPageTooltip}):(0,ee.jsx)(Yn,{}),render:e=>(0,ee.jsx)(b().m,{renderTooltip:()=>i?(0,ee.jsx)(B().sA,{...zn.saveAsPageToLocationTooltip}):(0,ee.jsx)(Yn,{}),render:t=>(0,ee.jsx)(je().Es,{variant:"tinted",icon:fe().arrowLineDownIcon,onClick:M,onDropdownClick:_,disabled:!i,singleLineTitle:!0,title:(0,ee.jsx)(B().sA,{...zn.saveAsPage}),tooltipEvents:e,dropdownTooltipEvents:t})})})]})}function Yn(){const e=(0,p().IS)((()=>({tooltipBody:{color:F().Tj.text.secondary}})),[]);return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(B().sA,{...zn.reportGeneratingTooltipHeader}),(0,ee.jsx)("div",{style:e.tooltipBody,children:(0,ee.jsx)(B().sA,{...zn.reportGeneratingTooltipBody})})]})}n(814603),n(147566),n(198721);var Qn=()=>n(874832),Jn=()=>n(127833),Xn=()=>n(98126),Zn=()=>n(68169),ea=()=>n(209969),ta=()=>n(428390),na=()=>n(300474),aa=()=>n(996332),ia=()=>n(252050),sa=()=>n(995847),oa=()=>n(16006),ra=()=>n(617711);function la(e){switch(e.target){case"slack":return{...e,href:(0,rt().V9)(e.href),domain:e.domain||"",baseUrl:e.baseUrl||"",channelId:e.channelId||"",messageId:e.messageId||"",threadTs:e.threadTs||"",type:"slack"};case"webpage":return{...e,href:(0,rt().RW)(e.href),url:e.url||"",type:"webpage"};case"microsoft-teams":return{...e,href:(0,rt().V9)(e.href),url:e.url||"",type:"microsoft-teams",channelId:e.channelId||"",messageId:e.messageId||"",threadTs:e.threadTs||"",messageType:e.messageType||"channel"};case"helpdoc":return{...e,href:(0,rt().h5)(e.href),url:e.url||"",type:"helpdoc"};case"githubCode":return{...e,href:(0,rt().V9)(e.href),url:e.url||"",type:"github"};case"discord":return{...e,href:(0,rt().V9)(e.href),url:e.url||"",messageId:e.messageId||"",channelId:e.channelId||"",guildId:e.guildId||"",type:"discord"};default:if((0,rt().SC)(e.target))return{...e,href:(0,rt().V9)(e.href),url:e.url||"",type:e.target};(0,lt().HB)(e.target)}}function ca(e){var t,n,a;const{artifact:i,researchModeCitationInfo:s,onClose:o}=e,r=(0,d().v3)(),l=(0,p().IS)((()=>({artifactContent:{display:"flex",alignItems:"center",marginBottom:8,fontSize:12,color:F().Tj.text.primary},iconWrap:{position:"relative",marginInlineEnd:12},icon:{position:"absolute",insetInlineStart:0,top:0},titleElement:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},wrapper:{padding:"12px 16px",borderRadius:4,backgroundColor:F().Tj.background.elevated,position:"relative"},closeButton:{position:"absolute",insetInlineEnd:8,top:8,cursor:"pointer",color:F().Tj.text.secondary}})),[]),c=(0,na().r)(),g=(0,u().K8)((()=>{var e,t,n;return"notion"===(null===(e=i.citationInfo)||void 0===e?void 0:e.citationType)&&null!==(t=i.citationInfo)&&void 0!==t&&t.pageId?new(pe().B)(r,{table:"block",id:null===(n=i.citationInfo)||void 0===n?void 0:n.pageId}):void 0}),[r,i.citationInfo]),m=(0,u().K8)((()=>{var e,t,n;return"notion"===(null===(e=i.citationInfo)||void 0===e?void 0:e.citationType)&&null!==(t=i.citationInfo)&&void 0!==t&&t.blockId?new(pe().B)(r,{table:"block",id:null===(n=i.citationInfo)||void 0===n?void 0:n.blockId}):void 0}),[r,i.citationInfo]),{metaHref:h,href:y}=(0,u().K8)((()=>{var e,t,n,a,s,o;if("claim"===(null===(e=i.citationInfo)||void 0===e?void 0:e.citationType))return{metaHref:void 0,href:void 0};if("notion"===(null===(t=i.citationInfo)||void 0===t?void 0:t.citationType)){if(!g)return{metaHref:void 0,href:void 0};const e=(0,On().Ay)({store:m||g,fullyQualified:!1,pageVisitSource:me().y8.AIQna});return{metaHref:e,href:e}}if("user"===(null===(n=i.citationInfo)||void 0===n?void 0:n.citationType)){var l;const e=void 0!==c?(0,ra().o4)({userId:null===(l=i.citationInfo)||void 0===l?void 0:l.userId,spaceIdCreator:r.idCreator.getSpaceIdCreatorSync(c),pageVisitSource:me().y8.AIChat}):void 0;return{metaHref:e,href:e}}if("slack"===(null===(a=i.citationInfo)||void 0===a?void 0:a.target)){var d,u;const e=(0,Bn().mQ)({...i.citationInfo,channelId:(null===(d=i.citationInfo)||void 0===d?void 0:d.channelId)||"",messageId:(null===(u=i.citationInfo)||void 0===u?void 0:u.messageId)||""});return{metaHref:e,href:e}}return{metaHref:null===(s=i.citationInfo)||void 0===s?void 0:s.url,href:null===(o=i.citationInfo)||void 0===o?void 0:o.url}}),[g,m,i.citationInfo,c,r.idCreator]);let v;var S,b,x,I,k,w;if("claim"===(null===(t=i.citationInfo)||void 0===t?void 0:t.citationType))v=(0,ee.jsxs)("div",{style:l.artifactContent,children:[(0,ee.jsx)("div",{style:l.iconWrap,children:(0,ee.jsx)(f().I,{icon:ea().checkmarkCircleFillIcon,colorPalette:"green",colorVariant:"accentPrimary"})}),(0,ee.jsx)(da,{stepKey:null===(S=i.citationInfo)||void 0===S?void 0:S.stepKey,claimId:null===(b=i.citationInfo)||void 0===b?void 0:b.claimId,claims:(null===(x=s.stepCitations[null===(I=i.citationInfo)||void 0===I?void 0:I.stepKey])||void 0===x?void 0:x.claims)||[],artifacts:(null===(k=s.stepCitations[null===(w=i.citationInfo)||void 0===w?void 0:w.stepKey])||void 0===k?void 0:k.artifacts)||[],researchModeCitationInfo:s})]},i.id);else if("notion"===(null===(n=i.citationInfo)||void 0===n?void 0:n.citationType)){var C,A,T,j;const e=null!==(C=i.citationInfo)&&void 0!==C&&C.blockId?[null===(A=i.citationInfo)||void 0===A?void 0:A.blockId]:[];v=(0,ee.jsx)(aa().Q,{href:y,metaHref:h,external:!0,children:(0,ee.jsxs)("div",{style:l.artifactContent,children:[(0,ee.jsx)("div",{style:l.iconWrap,children:g?(0,ee.jsx)(tt().ts,{citation:{id:(0,ia().ew)(null===(T=i.citationInfo)||void 0===T?void 0:T.pageId),pointer:{table:"block",id:null===(j=i.citationInfo)||void 0===j?void 0:j.pageId},type:i.citationInfo.citationType,store:g,inlineCitedBlockIds:e,...i.citationInfo},size:14,style:l.icon}):void 0}),g&&0===e.length?(0,ee.jsxs)("div",{style:{width:"100%"},children:[(0,ee.jsx)(oa().A,{store:g,style:{fontSize:14}}),(0,ee.jsx)(tt().M9,{citationText:i.content})]}):void 0,g&&e.length>0?(0,ee.jsx)(tt().ln,{inlineCitedBlockIds:e,store:g}):void 0]},i.id)})}else if("universal_search"===(null===(a=i.citationInfo)||void 0===a?void 0:a.citationType)){var M,_,P;let e;if("slack"===(null===(M=i.citationInfo)||void 0===M?void 0:M.target)){var D,E;const t=null===(D=i.citationInfo)||void 0===D||null===(D=D.text)||void 0===D||null===(D=D.split(":"))||void 0===D?void 0:D[0];e=(0,ee.jsx)(B().sA,{id:"ResearcherPlanStep.SlackCitationTitle.title",defaultMessage:"{author} in #{title}",values:{title:null===(E=i.citationInfo)||void 0===E?void 0:E.title,author:t}})}else{var R;e=(0,ee.jsx)("span",{style:l.titleElement,children:null===(R=i.citationInfo)||void 0===R?void 0:R.title})}v=(0,ee.jsx)(aa().Q,{href:y,metaHref:h,external:!0,children:(0,ee.jsxs)("div",{style:l.artifactContent,children:[null!==(_=i.citationInfo)&&void 0!==_&&_.target?(0,ee.jsx)("div",{style:l.iconWrap,children:(0,ee.jsx)(tt().ts,{citation:la(i.citationInfo),size:14,style:l.icon})}):void 0,(0,ee.jsx)(tt().d4,{citationText:null===(P=i.citationInfo)||void 0===P?void 0:P.text,titleElement:e})]},i.id)})}else v=(0,ee.jsx)("div",{style:l.artifactContent,children:i.content},i.id);return(0,ee.jsxs)("div",{style:o?l.wrapper:{},children:[o?(0,ee.jsx)("div",{onClick:o,role:"button",tabIndex:0,style:l.closeButton,children:(0,ee.jsx)(f().I,{icon:sa().xMarkSmallIcon,size:"sm"})}):void 0,v]})}function da({claimId:e,claims:t,artifacts:n,onClose:a,researchModeCitationInfo:i,stepKey:s}){const o=(0,p().IS)((()=>({wrapper:{padding:"12px 16px",borderRadius:4,backgroundColor:F().Tj.background.elevated,position:"relative"},closeButton:{position:"absolute",insetInlineEnd:8,top:8,cursor:"pointer",color:F().Tj.text.secondary},title:{fontSize:12,fontWeight:500,color:F().Tj.text.primary,marginBottom:8},subtitle:{fontSize:12,fontWeight:500,color:F().Tj.text.primary,marginTop:12,marginBottom:8},summary:{fontSize:14,color:F().Tj.darkTextColor,whiteSpace:"pre-wrap"}})),[]),r=t.find((t=>t.id===e)),l=n.filter((e=>{var t;return null==r||null===(t=r.supportingArtifactIds)||void 0===t?void 0:t.includes(e.id)}));return r?(0,ee.jsxs)("div",{style:o.wrapper,children:[a?(0,ee.jsx)("div",{onClick:a,role:"button",tabIndex:0,style:o.closeButton,children:(0,ee.jsx)(f().I,{icon:sa().xMarkSmallIcon,size:"sm"})}):void 0,(0,ee.jsxs)("div",{style:o.title,children:["Claim",s?` (${s})`:""]}),(0,ee.jsxs)("div",{style:o.summary,children:[(0,ee.jsx)("div",{style:{marginBottom:12},children:r.content}),l.length>0?(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)("div",{style:o.subtitle,children:"Supporting Evidence"}),l.map((e=>(0,ee.jsx)(ca,{artifact:e,researchModeCitationInfo:i},e.id)))]}):void 0]})]}):null}const ua=20;function pa(e){if(0===e)return"0s";const t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return`${n?`${n}m `:""}${a?`${a}s`:""}`}const ga=s.memo((function(e){const t=(0,r().L)();return t?e.wrapInAssistantSurfaceProvider?(0,ee.jsx)(Me().hP,{surface:Me().wy.fullPage,children:(0,ee.jsx)(ma,{...e,spaceStore:t})}):(0,ee.jsx)(ma,{...e,spaceStore:t}):null})),ma=s.memo((function({step:e,researchModeCitationInfo:t,debug:n=!1,onExpandChange:a,isExpanded:i,spaceStore:o}){var r;const[l,c]=(0,s.useState)(!1),g=i??l,[m,h]=(0,s.useState)(null),f=(0,s.useRef)(new Map),y=(0,s.useRef)(null),v=(0,d().v3)(),{value:S}=(0,ue().fJ)(xe().R.clipboardActions),b=(0,u().uB)(void 0,nt().D),x=(0,s.useMemo)((()=>{var n,a;return t||{stepCitations:{[e.value.key]:{claims:(null===(n=e.value.output)||void 0===n?void 0:n.claims)||[],artifacts:(null===(a=e.value.output)||void 0===a?void 0:a.artifacts)||[]}}}}),[t,e]),I=Hn(x);(0,Nn().c2)({containerRef:y,citationHoverStore:b,parentStore:o,evaluatorState:I});const k=(0,p().IS)((()=>({stepWrap:{padding:"6px 6px 0",display:"flex",flexDirection:"column"},step:{display:"flex",alignItems:"flex-start",gap:16,color:F().Tj.text.primary,padding:10,fontSize:14,fontWeight:500,cursor:"pointer",height:"unset"},additionalContext:{fontSize:12,color:F().Tj.text.secondary},status:{fontSize:12,padding:"2px 6px",borderRadius:4,backgroundColor:"rgba(0,0,0,0.05)"},statusDone:{backgroundColor:F().Tj.blue.background.accentPrimary,color:"#FFFFFF"},statusInProgress:{backgroundColor:F().Tj.blue.background.accentPrimary,color:"#FFFFFF"},statusNeedsMoreInfo:{backgroundColor:F().Tj.palette.purple[400],color:"#FFFFFF"},statusWarning:{backgroundColor:F().Tj.palette.orange[400],color:"#FFFFFF"},statusFailed:{backgroundColor:F().Tj.palette.red[400],color:"#FFFFFF"},statusCancelled:{backgroundColor:F().Tj.palette.gray[400],color:"#FFFFFF"},details:{marginTop:4},summary:{cursor:"pointer",userSelect:"none",color:F().Tj.text.secondary,fontSize:12,fontWeight:500,display:"flex",alignItems:"center",gap:4,padding:"4px 0"},content:{fontSize:12,color:F().Tj.text.secondary,padding:"4px 0",whiteSpace:"pre-wrap"},question:{fontWeight:500,marginBottom:8},claims:{display:"flex",flexDirection:"column",gap:16},expandIcon:{width:ua,height:ua,display:"flex",alignItems:"center",transform:g?"rotate(0deg)":"rotate(calc(var(--direction, 1) * -90deg))",transition:"transform 200ms ease-out",flexShrink:0,marginInlineStart:"auto"},expandedContent:{display:"flex",flexDirection:"column",gap:8,marginTop:8,paddingInlineEnd:24,paddingInlineStart:10,color:F().Tj.darkTextColor},claimRow:{display:"flex",alignItems:"flex-start",gap:10},claimBullet:{marginTop:6,fontWeight:500,fontSize:"20px",height:ua,width:ua,minWidth:ua,minHeight:ua,display:"flex",alignItems:"center",justifyContent:"center",userSelect:"none",color:F().Tj.text.tertiary},loadingSpinnerContainer:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20},title:{textWrap:"balance",lineHeight:"1.5"},nonExpandableStep:{display:"flex",alignItems:"flex-start",gap:16,color:F().Tj.text.primary,padding:10,fontSize:14,fontWeight:500,height:"unset"}})),[g]),w=(0,s.useMemo)((()=>{var t;return null!==(t=e.value.output)&&void 0!==t&&t.claims&&0!==e.value.output.claims.length?e.value.output.claims.map(((t,n)=>{const a=`#citation:${encodeURIComponent(`${e.value.key},claim,${t.id}`)}`;return`${t.content} [**[${n+1}]**](${a})`})):["No relevant findings."]}),[null===(r=e.value.output)||void 0===r?void 0:r.claims,e.value.key]),C=(0,s.useCallback)((e=>Wn({linkAnnotation:e,citationInfo:x,environment:v})),[x,v]),A=Un({processedMarkdownList:w,environment:v,clipboardActions:S,linkAnnotationToCitationAnnotations:C,useExportedCitations:!1});return(0,ee.jsxs)("div",{style:k.stepWrap,children:[(()=>{switch(e.value.agent){case Zn().dL:return(0,ee.jsx)(ha,{step:e,isExpanded:g,onExpandChange:e=>{a&&a(e),c(e)},debug:n,styles:k,researchModeCitationInfo:x,temporaryListStores:A,chatWrapperRef:y});case Zn().lA:return(0,ee.jsx)(ya,{step:e,debug:n,styles:k});case Zn().Ke:return(0,ee.jsx)(va,{step:e,debug:n,styles:k});default:return null}})(),(0,ee.jsx)(tt().cE,{containerRef:y,hoverStore:b,parentStore:o}),m&&f.current.get(m)?(0,ee.jsx)(Jn().zD,{open:Boolean(m),onClosed:()=>h(null),onDismiss:()=>h(null),originRect:f.current.get(m).getBoundingClientRect(),popupType:Jn().nl.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",originGap:16,style:{minWidth:300,maxWidth:400,maxHeight:400,overflow:"auto"},preventScaleTransition:!1,render:()=>{var t,n;return(0,ee.jsx)(da,{claimId:m,claims:(null===(t=e.value.output)||void 0===t?void 0:t.claims)||[],artifacts:(null===(n=e.value.output)||void 0===n?void 0:n.artifacts)||[],onClose:()=>h(null),researchModeCitationInfo:x})}}):void 0]},e.value.key)})),ha=s.memo((function({step:e,isExpanded:t,onExpandChange:a,debug:s,styles:o,researchModeCitationInfo:r,temporaryListStores:l,chatWrapperRef:c}){var d;return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsxs)(v().p,{style:o.step,onClick:()=>a(!t),children:[(0,ee.jsxs)("span",{style:{display:"flex",alignItems:"start",gap:12},children:[((e,t)=>{switch(e){case"done":return s&&1===t?(0,ee.jsx)(f().I,{icon:n(765974).exclamationMarkTriangleFillIcon,size:ua,style:{fill:o.statusWarning.backgroundColor}}):s&&0===t?(0,ee.jsx)(f().I,{icon:ta().exclamationMarkCircleFillIcon,size:ua,style:{fill:o.statusFailed.backgroundColor}}):(0,ee.jsx)(f().I,{icon:ea().checkmarkCircleFillIcon,size:ua,style:{fill:o.statusDone.backgroundColor}});case"in-progress":return(0,ee.jsx)("div",{style:o.loadingSpinnerContainer,children:(0,ee.jsx)(Xn().A,{size:"md"})});case"failed":return(0,ee.jsx)(f().I,{icon:ta().exclamationMarkCircleFillIcon,size:ua,style:{fill:o.statusFailed.backgroundColor}});default:return null}})(e.value.status,null===(d=e.value.eval)||void 0===d?void 0:d.completeness),(0,ee.jsx)("span",{style:o.title,children:e.value.input.question}),s&&e.value.timestampEndMs&&e.value.timestampStartMs?(0,ee.jsx)("span",{style:{color:"#666",fontSize:"0.9em"},children:pa(e.value.timestampEndMs-e.value.timestampStartMs)}):void 0]}),(0,ee.jsx)(f().I,{icon:n(803960).arrowChevronSingleDownIcon,colorVariant:"tertiary",style:o.expandIcon})]}),(0,ee.jsx)(i().P.div,{initial:{height:0},animate:{height:t?"auto":0},exit:{height:0},style:{overflow:"hidden"},children:(0,ee.jsxs)("div",{style:o.expandedContent,ref:c,children:["in-progress"===e.value.status?(0,ee.jsx)(Sa,{}):l&&l.map((e=>e&&(0,ee.jsxs)("div",{style:o.claimRow,children:[(0,ee.jsx)("span",{style:o.claimBullet,children:""}),(0,ee.jsx)(at().c,{displayName:"ResearchModeSinglePlanStep.Claims",disabled:!0,children:(0,ee.jsx)(En().s,{allowSelectionWithin:!0,children:(0,ee.jsx)(it().A,{store:e,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0})})},e.key)]},e.key))),s?(0,ee.jsx)(fa,{step:e,styles:o,researchModeCitationInfo:r}):void 0]})},e.value.key)]})})),fa=s.memo((function({step:e,styles:t,researchModeCitationInfo:n}){var a,i,s,o;return e.value.agent!==Zn().dL?null:(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)("div",{style:t.question,children:`(${e.value.agent}) "${e.value.input.question}"`}),null!==(a=e.value.output)&&void 0!==a&&a.workLog?(0,ee.jsxs)("details",{style:t.details,children:[(0,ee.jsx)("summary",{style:t.summary,children:"Work log "}),(0,ee.jsx)("div",{style:t.content,children:(0,ee.jsx)("div",{children:e.value.output.workLog.join("\n")},"workLog")})]}):void 0,null!==(i=e.value.output)&&void 0!==i&&i.artifacts?(0,ee.jsxs)("details",{style:t.details,children:[(0,ee.jsxs)("summary",{style:t.summary,children:["Supporting evidence (",null===(s=e.value.output)||void 0===s?void 0:s.artifacts.length,") "]}),(0,ee.jsx)("div",{style:t.content,children:null===(o=e.value.output)||void 0===o?void 0:o.artifacts.map((e=>(0,ee.jsx)(ca,{artifact:e,researchModeCitationInfo:n},e.id)))})]}):void 0,e.value.eval?(0,ee.jsxs)("details",{style:t.details,children:[(0,ee.jsx)("summary",{style:t.summary,children:"Eval "}),(0,ee.jsxs)("div",{style:t.content,children:[(0,ee.jsxs)("div",{children:["Completeness: ",e.value.eval.completeness]},"completeness"),(0,ee.jsxs)("div",{children:["Faithfulness: ",e.value.eval.faithfulness]},"faithfulness")]})]}):void 0]})})),ya=s.memo((function({step:e,debug:t,styles:n}){const a=(0,p().IS)((()=>({container:{...n.nonExpandableStep,padding:"6px 10px",fontSize:"13px",lineHeight:"1.4",fontWeight:400,color:F().Tj.text.secondary,backgroundColor:F().Tj.codeBlockBackground,borderRadius:"6px",marginBottom:"4px"},contentWrapper:{display:"flex",alignItems:"center",gap:12},title:{...n.title,flex:1,fontWeight:400,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},durationText:{fontSize:"0.85em",opacity:.7,fontWeight:400,marginInlineStart:"auto",padding:"2px 6px",borderRadius:"4px"},iconWrapper:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}})),[n]);if(e.value.agent!==Zn().lA)return null;const i=e.value.input;if(i.agent!==Zn().lA)return null;return(0,ee.jsx)("div",{style:a.container,children:(0,ee.jsxs)("span",{style:a.contentWrapper,children:[(0,ee.jsx)("span",{style:a.iconWrapper,children:(e=>{switch(e){case"done":return(0,ee.jsx)(f().I,{icon:ea().checkmarkCircleFillIcon,size:ua,style:{fill:n.statusDone.backgroundColor}});case"in-progress":return(0,ee.jsx)("div",{style:n.loadingSpinnerContainer,children:(0,ee.jsx)(Xn().A,{size:"md"})});case"failed":return(0,ee.jsx)(f().I,{icon:ta().exclamationMarkCircleFillIcon,size:ua,style:{fill:n.statusFailed.backgroundColor}});default:return null}})(e.value.status)}),(0,ee.jsx)("span",{style:a.title,children:(()=>{const{artifact:e}=i;if("notion"===e.citationType)return"Reading Notion Page";if("universal_search"===e.citationType&&"webpage"===e.target&&e.url){const t=new URL(e.url),n=`${t.hostname}${t.pathname}`;return`Read Webpage: ${n.length>30?`${n.substring(0,30)}...`:n}`}return"Read Content"})()}),t&&e.value.timestampEndMs&&e.value.timestampStartMs?(0,ee.jsx)("span",{style:a.durationText,children:pa(e.value.timestampEndMs-e.value.timestampStartMs)}):void 0]})})})),va=s.memo((function({step:e,debug:t,styles:n}){const a=(0,p().IS)((()=>({container:{...n.nonExpandableStep,padding:"6px 10px",fontSize:"13px",lineHeight:"1.4",fontWeight:400,color:F().Tj.text.secondary,backgroundColor:F().Tj.codeBlockBackground,borderRadius:"6px",marginBottom:"4px"},contentWrapper:{display:"flex",alignItems:"center",gap:12},title:{...n.title,flex:1,fontWeight:400,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},durationText:{fontSize:"0.85em",opacity:.7,fontWeight:400,marginInlineStart:"auto",padding:"2px 6px",borderRadius:"4px"},iconWrapper:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}})),[n]);if(e.value.agent!==Zn().Ke)return null;const i=e.value.input;if(i.agent!==Zn().Ke)return null;return(0,ee.jsx)("div",{style:a.container,children:(0,ee.jsxs)("span",{style:a.contentWrapper,children:[(0,ee.jsx)("span",{style:a.iconWrapper,children:(e=>{switch(e){case"done":return(0,ee.jsx)(f().I,{icon:ea().checkmarkCircleFillIcon,size:ua,style:{fill:n.statusDone.backgroundColor}});case"in-progress":return(0,ee.jsx)("div",{style:n.loadingSpinnerContainer,children:(0,ee.jsx)(Xn().A,{size:"md"})});case"failed":return(0,ee.jsx)(f().I,{icon:ta().exclamationMarkCircleFillIcon,size:ua,style:{fill:n.statusFailed.backgroundColor}});default:return null}})(e.value.status)}),(0,ee.jsx)("span",{style:a.title,children:(()=>{const{taskType:e}=i;return`${e.replace(/-/g," ").replace(/\b\w/g,(e=>e.toUpperCase()))}`})()}),t&&e.value.timestampEndMs&&e.value.timestampStartMs?(0,ee.jsx)("span",{style:a.durationText,children:pa(e.value.timestampEndMs-e.value.timestampStartMs)}):void 0]})})})),Sa=s.memo((function(){const e=(0,p().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:16},claimRow:{marginInlineStart:42,display:"flex",alignItems:"flex-start",gap:14},claim:{flex:1}})),[]);return(0,ee.jsx)("div",{style:e.container,children:[1,2,3].map(((t,n)=>(0,ee.jsx)("div",{style:e.claimRow,children:(0,ee.jsxs)("div",{style:e.claim,children:[(0,ee.jsx)(Qn().P,{style:{height:14,width:"85%"}}),(0,ee.jsx)(Qn().P,{style:{height:14,width:"65%",marginTop:8}})]})},n)))})}));function ba(e){const{step:t}=e,n=t.operations.filter((e=>void 0===e.databaseName)),a=(0,vt().$z)(t.operations.filter((e=>void 0!==e.databaseName)),(e=>e.databaseName));return(0,ee.jsxs)(h().Y1,{direction:"vertical",gap:30,children:[(0,ee.jsx)(wa,{categoryName:"",name:"Databases",operations:n}),Object.entries(a).map((([e,t])=>(0,ee.jsx)(xa,{databaseName:e,operations:t},e)))]})}function xa(e){const{databaseName:t,operations:n}=e,a=n.filter((e=>e.databaseName===t&&void 0===e.propertyName&&void 0===e.viewName)),i=(0,vt().$z)(n.filter((e=>void 0!==e.propertyName&&void 0===e.viewName)),(e=>e.propertyName)),s=(0,vt().$z)(n.filter((e=>void 0!==e.viewName)),(e=>e.viewName)),o=Object.keys(i).sort(),r=Object.keys(s).sort();return(0,ee.jsxs)(h().Y1,{direction:"vertical",gap:30,children:[(0,ee.jsx)(wa,{categoryName:"database",name:t,operations:a,excludeKeys:["databaseName"]}),Object.entries(i).map((([e,t])=>(0,ee.jsx)(Ia,{propertyName:e,operations:t},e))),Object.entries(s).map((([e,t])=>(0,ee.jsx)(ka,{viewName:e,operations:t},e))),(0,ee.jsx)(S().D,{styleKey:"bodySemibold",children:`Defined ${o.length} properties`}),(0,ee.jsx)("ul",{children:o.map((e=>(0,ee.jsx)("li",{children:e},e)))}),(0,ee.jsx)(S().D,{styleKey:"bodySemibold",children:`Defined ${r.length} views`}),(0,ee.jsx)("ul",{children:r.map((e=>(0,ee.jsx)("li",{children:e},e)))})]})}function Ia(e){const{propertyName:t,operations:n}=e;return(0,ee.jsx)(wa,{categoryName:"property",name:t,operations:n,excludeKeys:["databaseName","propertyName"]})}function ka(e){const{viewName:t,operations:n}=e;return(0,ee.jsx)(wa,{categoryName:"view",name:t,operations:n,excludeKeys:["databaseName","viewName"]})}function wa(e){const{name:t,categoryName:n,operations:a,excludeKeys:i=[]}=e,s=Aa();return(0,ee.jsxs)(h().Y1,{direction:"vertical",gap:10,children:[(0,ee.jsxs)(h().Y1,{direction:"horizontal",align:"center-left",gap:4,children:[(0,ee.jsx)(S().D,{styleKey:"bodySemibold",children:t}),(0,ee.jsx)(S().D,{styleKey:"bodyRegular",colorVariant:"tertiary",children:n})]}),(0,ee.jsx)(h().Y1,{gap:4,children:a.map(((e,t)=>{const{type:n,...a}=e;return(0,ee.jsxs)(h().Y1,{direction:"horizontal",gap:10,style:s.operationRow,children:[(0,ee.jsx)(h().Y1,{width:250,style:s.operationType,padding:15,children:(0,ee.jsx)(S().D,{styleKey:"bodySmSemibold",colorVariant:"secondary",children:n})}),(0,ee.jsx)(h().Y1,{direction:"vertical",gap:10,padding:15,children:Object.entries(a).map((([e,t])=>i.includes(e)?null:(0,ee.jsxs)(h().Y1,{direction:"horizontal",gap:4,children:[(0,ee.jsx)(h().Y1,{width:150,style:s.propertyKey,children:(0,ee.jsx)(S().D,{styleKey:"captionRegular",colorVariant:"secondary",children:e})}),(0,ee.jsx)(Ca,{value:t})]},e)))})]},t)}))})]})}function Ca(e){const{value:t}=e,n=Aa();return"string"==typeof t?(0,ee.jsx)("div",{style:n.monospace,children:t}):(0,ee.jsx)("div",{style:n.monospace,children:JSON.stringify(t,null,2)})}function Aa(){return(0,p().IS)((()=>({operationRow:{background:F().Tj.background.secondary},operationType:{background:F().Tj.gray.background.secondaryTranslucent,flexShrink:0},propertyKey:{flexShrink:0},monospace:{fontFamily:"monospace",fontSize:12,whiteSpace:"pre-wrap",lineHeight:1.3}})),[])}function Ta(e){const{step:t}=e,a=(0,B().tz)(),i=(0,p().IS)((()=>({monospace:{fontFamily:"monospace",fontSize:12,whiteSpace:"pre-wrap",lineHeight:1.3}})),[]),[o,r]=(0,s.useState)(!1),l=t.setup.allTemplates.length,c=t.setup.allTemplates.filter((e=>"collection"===e.type)).length,d=t.setup.allTemplates.filter((e=>"property"===e.type)).length,u=t.setup.allTemplates.filter((e=>"collection_view"===e.type)).length;return(0,ee.jsxs)(h().Y1,{align:"top-left",direction:"horizontal",gap:4,children:[(0,ee.jsx)(n(606273).f,{isSidebar:!1,open:o,onClick:()=>r(!o),fill:!1,ariaLabel:a.formatMessage(o?{id:"setupStep.toggleButton.collapse",defaultMessage:"Collapse setup details"}:{id:"setupStep.toggleButton.expand",defaultMessage:"Expand setup details"})}),o?(0,ee.jsx)(h().Y1,{padding:"6px 2px",style:i.monospace,children:JSON.stringify(t,null,2)}):(0,ee.jsx)(h().Y1,{align:"center-left",height:24,children:(0,ee.jsx)(S().D,{styleKey:"bodySemibold",children:`Generated ${l} templates (${c} collections, ${d} properties, ${u} views)`})})]})}var ja=()=>n(240959);function Ma(e){return null}const _a=8,Pa="linear-gradient(180deg, rgba(0, 0, 0, 1) 70%, rgba(0, 0, 0, 0) 100%)";function Da(e){const{clientStore:t,threadStore:n,shouldSkipStep:a,preprocessTranscript:i,transcriptContainerStyle:o,showDebugOverride:r,aiChatFeatureController:c}=e,m=(0,d().v3)(),h=(0,u().O$)(l().AppStoreSidebarSpaceStore),f=(0,u().K8)((()=>(0,V().Ft)({threadStore:n,clientStore:t})),[n,t]),y=(0,u().K8)((()=>{let s=[];if(e.transcript)s=e.transcript;else{const{steps:e}=(0,V().A3)({clientStore:t,threadStore:n});s=e}return i&&(s=i({transcript:s,threadId:null==n?void 0:n.id,runningInference:f})),a&&(s=s.filter((e=>!a(e)))),s}),[t,n,i,e.transcript,a,f]),v=(0,u().K8)((()=>{const n=y.find((e=>"config"===e.type));return n?n.value:e.config||t.state.configForNewTranscripts}),[t,e.config,y]),S=(0,s.useMemo)((()=>"search"===v.type||"researcher"===v.type||"markdown-chat"===v.type?16:14),[v.type]),b=(0,s.useMemo)((()=>"search"===v.type?12:"researcher"===v.type?24:_a),[v.type]),x=(0,p().IS)((()=>{return{transcript:{display:"flex",flexDirection:"column",fontSize:S,marginBottom:(e=c,e.isAgentChat?12:36),gap:b,...o??{}}};var e}),[c,o,b,S]),I=(0,u().K8)((()=>m.RouterStore.state.route),[m]),k=(0,s.useRef)(!1),C=(0,u().K8)((()=>t.state.userInputToTranscriptRenderMetric),[t]);(0,s.useEffect)((()=>{if(k.current||!C||null==n||!n.id)return;const{metric:e,surface:t}=C;g().default.measure(e,{environment:m,data:{thread_id:null==n?void 0:n.id,ai_config_type:v.type,ai_transcript_created_source:t}}),k.current=!0}),[v.type,m,null==n?void 0:n.id,C]),(0,s.useEffect)((()=>{const{sidebarSpaceStore:e,currentUserStore:a}=l().default.state;if(!n||!e||!a)return;const i=setInterval((async()=>{const i=await(0,L().e)(m,{pointer:n.pointer,userId:m.currentUser.id,version:-1});if(null==i||!i.value)return;const s=i.value.current_inference_lease_expiration;if(!s||Date.now()<=s)return;const{serverCommitResult:o}=H().createAndCommit({userAction:"AIChatTranscript.leaseExpired",environment:m,canUndo:!0,perform:i=>{(0,G().GS)({threadStore:n,transaction:i,clientStore:t}),(0,G().Vn)({threadStore:n,environment:m,spaceStore:e,userStore:a,addSteps:[{id:(0,U().Z1)({environment:m,table:R().mS,spaceId:e.id}),type:"error",message:"Inference timed out"}],transaction:i})}}),r=t.getOrCreateClientAIChatThreadStore(n.id);r.setState({...r.state,stopInferencePromise:o})}),1e4);return()=>clearInterval(i)}),[m,n,t]),(0,s.useEffect)((()=>()=>{Q({clientStore:t})}),[t]),(0,s.useEffect)((()=>{"chat"===I.name&&I.peekViewBlockId&&Q({clientStore:t})}),[I,t]);const A=(0,u().K8)((()=>(t.state.showDebug||r)??!1),[t,r]),T=(0,s.useMemo)((()=>y.map(((e,t)=>({step:e,indexInTranscript:t}))).filter((({step:e})=>function(e,t){if("title"===e.type)return!1;if(t)return!0;return"user"===e.type||"user-injected"===e.type||"agent-message"===e.type||"error"===e.type||"premium-feature-unavailable"===e.type||"markdown-chat"===e.type||"search"===e.type||"search-chat"===e.type||"fast-researcher-plan"===e.type||"fast-researcher-search-results"===e.type||"fast-researcher-chat"===e.type||"setup-operations"===e.type||"setup"===e.type||"researcher-agent"===e.type||"researcher-agent-group"===e.type||"researcher-report"===e.type||"registered-tool-grouping"===e.type||"attachment"===e.type||"user-specified-context"===e.type||"database-agent-setup"===e.type||("context"===e.type?"value"in e:("config"===e.type||"registered-tool-call"===e.type||"registered-tool-output"===e.type||"registered-tool-error"===e.type||"retry"===e.type||"debug-inference"===e.type||"agent-search-query-generation"===e.type||"autocorrect"===e.type||"autocomplete"===e.type||"memory-agent"===e.type||"summarize-transcript"===e.type||"summarize-transcript-record-map"===e.type||"summarize-transcript-error"===e.type||"record-pointers-updated"===e.type||"search-observation"===e.type||"researcher-text-observation"===e.type||"researcher-next-steps"===e.type||"agent-inference"===e.type||"agent-tool-result"===e.type||"agent-debug-error"===e.type||"eval-result"===e.type||"agent-transcript-summary"===e.type||"agent-records-updated"===e.type||"agent-turn-start"===e.type||"agent-turn-full-record-map"===e.type||"agent-record-map"===e.type||"agent-prebuilt-prompt"===e.type||"mention"===e.type||"agent-integration"===e.type||"aiBlockResponse"===e.type||"workflow-operation"===e.type||"generate-formula"===e.type||"system-notification"===e.type||"agent-trigger"===e.type||"agent-route-trigger"===e.type||"workflow-effect-calling"===e.type||"workflow-effect-called"===e.type||"workflow-effect-error"===e.type||e.type,!1))}(e,A)))),[y,A]),j=(0,s.useMemo)((()=>y.filter((e=>"search"===e.type&&(0,V().l0)(e)))),[y]),M=(0,s.useMemo)((()=>{const e=new Set,t=[];for(let n=j.length-1;n>=0;n--){const a=j[n],i=Object.values(a.results??{}).flat();for(let n=0;n<i.length;n++){const a=i[n];e.has(a.key)||(e.add(a.key),t.push(a))}}return t}),[j]);if(!h||!n||0===T.length)return null;const _=(0,w().dC)(y),P=(0,ee.jsx)("div",{style:x.transcript,children:T.map((({step:e},a)=>(0,ee.jsx)(Ea,{config:v,step:e,threadStore:n,clientStore:t,runningInference:f,isLastVisibleStep:a===T.length-1,showDebugOverride:r,searchStepResults:M},e.id)))});return _&&n?(0,ee.jsx)(W().ng,{threadId:n.id,children:P}):c.isAgentChat?(0,ee.jsx)(J().Wd,{children:P}):P}const Ea=s.memo(Ra);function Ra(e){const{config:t,step:n,threadStore:a,clientStore:i,runningInference:r,isLastVisibleStep:l,showDebugOverride:c,searchStepResults:g}=e,m=(0,d().v3)(),h=(0,u().K8)((()=>(i.state.showDebug||c)??!1),[i,c]),[f,y]=(0,s.useState)(!1),v=(0,s.useCallback)((()=>{y(!0)}),[]),S=(0,s.useCallback)((()=>{y(!1)}),[]),b=r?f&&!l:f||l,x="user"===n.type||"search"===n.type,I=(0,p().IS)((()=>({wrap:{display:"flex",flexDirection:"column",gap:12},actions:{display:x?"none":"flex",gap:8,opacity:b?1:0,transition:"opacity 100ms ease"}})),[b,x]),k="user"===n.type?"right":"left",w=(0,s.useCallback)((e=>{(0,o().u)({environment:m,event:{eventName:"clicked_ai_chat_follow_up",eventProperties:{thread_id:a.id,trace_id:"traceId"in n?n.traceId:void 0,mode:t.type,action:e}}})}),[m,t,n,a.id]),C=(0,s.useRef)(void 0);return(0,s.useEffect)((()=>{C.current!==n.id&&(C.current=n.id,(0,o().u)({environment:m,event:{eventName:"agent_chat_step_displayed",eventProperties:{step_id:n.id,thread_id:a.id}}}))}),[n,m,a.id]),(0,ee.jsx)(Va,{step:n,threadStore:a,clientStore:i,children:(0,ee.jsxs)("div",{style:I.wrap,onMouseEnter:v,onMouseLeave:S,className:"inference-transcript-chat-step",children:[(0,ee.jsx)(Fa,{config:t,step:n,threadStore:a,clientStore:i,runningInference:r,isLastVisibleStep:l,showDebug:h,searchStepResults:g}),(0,ee.jsxs)("div",{style:I.actions,children:[(0,ee.jsx)(Na,{step:n,threadStore:a,runningInference:r,showDebug:h,alignment:k,trackFollowupAction:w,searchStepResults:g}),(0,ee.jsx)(Oa,{step:n,threadStore:a,alignment:k,configType:t.type,showDebug:h})]})]})})}function Ba(e){return"markdown-chat"===e||"search"===e}const Fa=s.memo((function(e){const{step:t,config:a,threadStore:i,clientStore:o,runningInference:l,isLastVisibleStep:c,showDebug:d,searchStepResults:u}=e,g=(0,r().L)(),m=(0,p().IS)((()=>({thinkingStep:{display:"flex",alignItems:"center",height:32,paddingInlineStart:12}})),[]),h=(0,s.useMemo)((()=>"researcher"===a.type||"search"===a.type||"markdown-chat"===a.type||"workflow"===a.type||"setup-generator"===a.type),[a.type]);if("config"===t.type)return(0,ee.jsx)(za,{step:t});if("user"===t.type)return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(n(318670).IT,{step:t,clientStore:o,threadStore:i,runningInference:l}),l&&c?Ba(a.type)?(0,ee.jsx)("div",{style:m.thinkingStep,children:(0,ee.jsx)(Ue().c,{})}):(0,ee.jsx)(ja().P,{steps:[],renderStep:()=>(0,ee.jsx)("div",{}),done:!1}):void 0]});if("user-injected"===t.type)return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(n(47942).m,{step:t,clientStore:o,threadStore:i,runningInference:l}),l&&c?Ba(a.type)?(0,ee.jsx)("div",{style:m.thinkingStep,children:(0,ee.jsx)(Ue().c,{})}):(0,ee.jsx)(ja().P,{steps:[],renderStep:()=>(0,ee.jsx)("div",{}),done:!1}):void 0]});if("agent-message"===t.type)return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(n(156747).Z,{step:t,threadStore:i}),l&&c?Ba(a.type)?(0,ee.jsx)("div",{style:m.thinkingStep,children:(0,ee.jsx)(Ue().c,{})}):(0,ee.jsx)(ja().P,{steps:[],renderStep:()=>(0,ee.jsx)("div",{}),done:!1}):void 0]});if("premium-feature-unavailable"===t.type)return(0,ee.jsx)(le,{config:a,threadStore:i,step:t});if("error"===t.type&&t.errorCode===n(416845)._D_)return(0,ee.jsx)(xn,{config:a,threadStore:i});if("attachment"===t.type){const e=-_a;return(0,ee.jsxs)("div",{style:{display:"flex",marginBottom:e},children:[(0,ee.jsx)("div",{style:{flexGrow:1}}),(0,ee.jsx)(n(28070).kp,{uploadProgress:{status:"complete",fileUrl:t.fileUrl,fileName:t.fileName,contentType:t.contentType},permissionRecordOverride:{table:n(234459).To,id:i.id,spaceId:i.getSpaceId()}})]})}return"error"===t.type?h&&"error"===t.type&&!d?(0,ee.jsx)(n(807253).P,{errorStep:t,configType:a.type}):(0,ee.jsx)($a,{step:t}):"markdown-chat"===t.type?(0,ee.jsx)(Vt().c,{step:t}):"search"===t.type?(0,ee.jsx)(Ft,{threadStore:i,clientStore:o,step:t,isLastVisibleStep:c}):"search-chat"===t.type?(0,ee.jsx)(dt,{results:u,step:t},t.id):"fast-researcher-plan"===t.type||"fast-researcher-search-results"===t.type?(0,ee.jsx)(Ga,{step:t}):"fast-researcher-chat"===t.type?(0,ee.jsx)(Vt().c,{step:{id:t.id,type:"markdown-chat",value:t.value,traceId:t.traceId}}):"setup-operations"===t.type?(0,ee.jsx)(ba,{step:t}):"setup"===t.type?(0,ee.jsx)(Ta,{step:t}):"database-agent-setup"===t.type?(0,ee.jsx)(B().sA,{defaultMessage:"Unsupported step type",id:"aiChatTranscript.unsupportedDBAgentStepType"}):"researcher-agent"===t.type?(0,ee.jsx)(ga,{step:t,debug:d,wrapInAssistantSurfaceProvider:!0},t.value.key):"researcher-agent-group"===t.type?(0,ee.jsx)(n(579819).O,{stepGroup:t}):"researcher-report"===t.type?(0,ee.jsx)(Kn,{step:t,wrapInAssistantSurfaceProvider:!0}):"context"===t.type?(0,ee.jsx)(n(65590).E,{step:t,displayMode:(f=a.type,"markdown-chat"===f||"search"===f||"researcher"===f?"timeAndMode":"date"),config:a}):"registered-tool-grouping"===t.type?(0,ee.jsx)(Ma,{groupStep:t}):"user-specified-context"===t.type&&g?(0,ee.jsx)(n(639162).H,{spaceStore:g,context:t}):"title"===t.type||"registered-tool-call"===t.type||"registered-tool-output"===t.type||"registered-tool-error"===t.type||"retry"===t.type||"debug-inference"===t.type||"eval-result"===t.type||"autocorrect"===t.type||"autocomplete"===t.type||"memory-agent"===t.type||"summarize-transcript"===t.type||"summarize-transcript-record-map"===t.type||"summarize-transcript-error"===t.type||"record-pointers-updated"===t.type||"search-observation"===t.type||"researcher-text-observation"===t.type||"researcher-next-steps"===t.type||"agent-inference"===t.type||"agent-tool-result"===t.type||"agent-debug-error"===t.type||"agent-search-query-generation"===t.type||"agent-transcript-summary"===t.type||"agent-records-updated"===t.type||"agent-turn-start"===t.type||"agent-turn-full-record-map"===t.type||"agent-record-map"===t.type||"agent-prebuilt-prompt"===t.type||"user-specified-context"===t.type||"mention"===t.type||"agent-integration"===t.type||"aiBlockResponse"===t.type||"workflow-operation"===t.type||"generate-formula"===t.type||"system-notification"===t.type||"agent-trigger"===t.type||"agent-route-trigger"===t.type||"workflow-effect-calling"===t.type||"workflow-effect-called"===t.type||"workflow-effect-error"===t.type||"wait"===t.type?(0,ee.jsx)(Wa,{step:t}):null;var f}));function Na(e){const{step:t,threadStore:n,runningInference:a,showDebug:i,alignment:s,trackFollowupAction:o,searchStepResults:r}=e,l=(0,p().IS)((()=>({stepActions:{display:"flex",alignItems:"center",gap:4,marginTop:4},reportActionsRow:{display:"flex",gap:8}})),[]),c=(0,u().K8)((()=>{const e=n.getTranscript().find((e=>"title"===e.type));return e}),[n]),d=(0,u().K8)((()=>n.id),[n]),g=(0,u().K8)((()=>n.getTranscript().find((e=>"config"===e.type))),[n]);let m;return m="config"===t.type||"error"===t.type||"title"===t.type||"context"===t.type||"setup"===t.type||"setup-operations"===t.type||"retry"===t.type||"memory-agent"===t.type||"registered-tool-call"===t.type||"registered-tool-output"===t.type||"registered-tool-error"===t.type||"registered-tool-grouping"===t.type||"debug-inference"===t.type||"autocorrect"===t.type||"search"===t.type||"fast-researcher-search-results"===t.type||"fast-researcher-plan"===t.type||"summarize-transcript"===t.type||"summarize-transcript-record-map"===t.type||"summarize-transcript-error"===t.type||"user"===t.type||"database-agent-setup"===t.type?void 0:"fast-researcher-chat"===t.type?(0,ee.jsx)(Le,{threadId:d,step:t,configStep:void 0,onClick:()=>{o("copy")}}):"markdown-chat"===t.type?(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(Le,{threadId:d,step:t,configStep:void 0,onClick:()=>{o("copy")}}),(0,ee.jsx)(Oe,{threadTitle:null==c?void 0:c.value,threadId:d,step:t,configStep:g,createBlockFrom:"markdown_chat_response",markdown:t.value,linkAnnotationToCitationAnnotations:e=>({annotations:[e],status:"missing_citation"}),transactionName:"MarkdownChatStep.saveAsPage",onClick:()=>o("save_as_page")})]}):"search-chat"===t.type?(0,ee.jsx)(Ze,{threadStore:n,step:t,titleStep:c,results:r}):"researcher-agent"===t.type?i?(0,ee.jsx)(Ua,{step:t,threadStore:n,label:"Retry",disabled:a}):null:"researcher-next-steps"===t.type||"search-observation"===t.type||"researcher-text-observation"===t.type||"researcher-agent-group"===t.type?void 0:"researcher-report"===t.type?(0,ee.jsx)("div",{style:l.reportActionsRow,children:(0,ee.jsx)($n,{step:t,wrapInAssistantSurfaceProvider:!0})}):void 0,void 0===m?null:(0,ee.jsxs)("div",{style:l.stepActions,children:["right"===s?(0,ee.jsx)("div",{style:{flexGrow:1}}):void 0,m,"left"===s?(0,ee.jsx)("div",{style:{flexGrow:1}}):void 0]})}const La={"fast-researcher-chat":!0,"researcher-report":!0,"search-chat":!0,"markdown-chat":!0};function Oa(e){const{step:t,threadStore:n,alignment:a,configType:i,showDebug:s}=e,o=(0,p().IS)((()=>({feedbackActions:{display:"flex",alignItems:"flex-start",gap:4,marginTop:8}})),[]),r=function(e,t){const n=(0,u().K8)((()=>{var n;return null===(n=t.getMessageStoreById(e))||void 0===n||null===(n=n.getData())||void 0===n?void 0:n.inference_id}),[t,e]);return n}(t.id,n);return r&&La[t.type]?(0,ee.jsxs)("div",{style:o.feedbackActions,children:["right"===a?(0,ee.jsx)("div",{style:{flexGrow:1}}):void 0,(0,ee.jsx)(Ka,{step:t,traceId:r,feedbackType:"thumbs_up",threadStore:n,mode:"feedback-positive"}),(0,ee.jsx)(Ka,{step:t,traceId:r,feedbackType:"thumbs_down",threadStore:n}),s?(0,ee.jsx)(qa,{traceId:r,threadConfigType:i}):void 0,"left"===a?(0,ee.jsx)("div",{style:{flexGrow:1}}):void 0]}):null}function Va(e){const{step:t,threadStore:n,clientStore:o,children:l}=e,c=(0,B().tz)(),g=(0,d().v3)(),m=(0,r().L)(),[y,k]=(0,s.useState)(!1),w=(0,s.useCallback)((()=>{k((e=>!e))}),[]),A=(0,s.useMemo)((()=>function(e){const t=ln[e];return t?{...t,isFallback:!1}:{icon:P().infoCircleSmallIcon,label:{descriptor:cn,values:{stepType:e}},tooltip:{descriptor:dn,values:{stepType:e}},isFallback:!0,colorPalette:"gray"}}(t.type)),[t.type]),T=(0,p().IS)((()=>({wrap:{border:`1px solid ${F().Tj.border.secondary}`,background:F().Tj.background.secondaryTranslucent},headerRow:{display:"flex",alignItems:"center",gap:8},headerButton:{borderRadius:7,display:"flex",alignItems:"center",padding:"4px 10px",gap:8,flexShrink:1},headerContent:{display:"flex",alignItems:"center",gap:8,minHeight:28},stepIconWrap:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20,borderRadius:10,backgroundColor:A.colorPalette?F().Tj[A.colorPalette].background.secondaryTranslucent:F().Tj.background.secondaryTranslucent,border:`1px solid ${A.colorPalette?F().Tj[A.colorPalette].border.secondary:F().Tj.border.secondary}`,flexShrink:0},codeInner:{borderRadius:8,backgroundColor:F().Tj.background.secondary},previewContainer:{position:"relative",overflow:"hidden",padding:"8px 10px",borderRadius:8,border:`1px solid ${F().Tj.border.secondary}`,backgroundColor:F().Tj.background.primary},icon:{transition:"transform 0.2s ease-in-out",transformOrigin:"center",transform:y?"rotate(90deg)":"rotate(0deg)"},infoButton:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:12,border:`1px solid ${F().Tj.border.secondary}`,backgroundColor:F().Tj.background.primary,cursor:"pointer"}})),[y,A.colorPalette]),j=c.formatMessage(A.label.descriptor,A.label.values),M=c.formatMessage(A.tooltip.descriptor,A.tooltip.values),_=(0,s.useMemo)((()=>{if("agent-tool-result"!==t.type)return;const e=function(e){const t=[],n=e=>{if("string"!=typeof e)return;const n=e.trim();n&&!t.includes(n)&&t.push(n)};n(e.toolTitle),n(e.toolName),e.toolType!==e.toolName&&n(e.toolType);const a=(e,t)=>{if(!(t>un||null==e))if(Array.isArray(e))for(const n of e)a(n,t+1);else if((0,lt().Gv)(e)&&!Array.isArray(e)){n(e.toolName),n(e.toolType),"string"==typeof e.name&&"string"==typeof e.type&&e.type.toLowerCase().includes("tool")&&n(e.name);for(const[,n]of(0,lt().WP)(e))a(n,t+1)}};return a(e.result,0),a(e.additionalResultForRender,0),t}(t);if(0===e.length)return;const n=e.slice(0,3),a=e.length>n.length;return`${n.join(", ")}${a?", ...":""}`}),[t]),D=(0,s.useMemo)((()=>{if("agent-tool-result"===t.type)return fn(t)}),[t]),E=(0,u().K8)((()=>{if("agent-tool-result"===t.type&&m)return(0,X().ZX)({environment:g,spaceStore:m,threadStore:n,toolResultStep:t})}),[g,m,t,n]),R=(0,u().uB)(void 0,I().$),N=(0,s.useMemo)((()=>{var e;if("agent-tool-result"!==t.type)return;const n=null===(e=t.renderedResult)||void 0===e?void 0:e.content;return"string"==typeof n&&n.trim().length>0?n:void 0}),[t]),L=(0,s.useMemo)((()=>{if(!D)return;if("error"===D.variant)return c.formatMessage(He,{error:D.error});const e=[];if("data"===D.variant&&D.insufficientPermissions&&e.push(c.formatMessage(Ke)),"data"===D.variant&&D.state){const t=Ge[D.state];e.push(c.formatMessage(t))}if("data"===D.variant&&D.results){const{count:t,items:n,truncated:a}=D.results,i=n.length>0?`${n.join(", ")}${a||t>n.length?", ...":""}`:a||t>n.length?"...":"",s=c.formatMessage(qe,{count:t});e.push(i?`${s}: ${i}`:s)}else"data"===D.variant&&D.rawSnippet&&e.push(c.formatMessage($e,{snippet:D.rawSnippet}));return 0!==e.length?e.join("  "):void 0}),[c,D]),V=(0,u().K8)((()=>o.state.showDebug&&(0,$().Ke)()),[o]),z=(0,s.useMemo)((()=>JSON.stringify(t,null,2)),[t]),W=(0,u().K8)((()=>n.getMessageStoreById(t.id)),[n,t.id]),U=(0,s.useCallback)((e=>{try{const n=JSON.parse(e);if(n.id!==t.id)throw new Error("Step ID mismatch");if(!W)throw new Error("Thread message step store not found");H().createAndCommit({userAction:"DebugStep.updateStep",environment:g,perform:e=>{O().zv({store:W,transaction:e,data:{step:n}})},canUndo:!0})}catch(n){console.error("Error saving step",n)}}),[t,g,W]);return V?(0,ee.jsxs)(h().Y1,{direction:"vertical",padding:4,borderRadius:8,style:T.wrap,children:[(0,ee.jsxs)(h().Y1,{direction:"horizontal",gap:2,align:"center",children:[(0,ee.jsxs)("div",{style:{...T.headerRow,flex:1,minWidth:0},children:[(0,ee.jsx)(v().p,{style:T.headerButton,iconLeading:{icon:C().arrowChevronSingleRightSmallIcon,size:"xs",colorVariant:"secondary",style:T.icon},"aria-label":c.formatMessage({id:"aiInferenceTranscript.viewFullStep",defaultMessage:"View full step"}),onClick:w,children:(0,ee.jsxs)("div",{style:T.headerContent,children:[(0,ee.jsx)("div",{style:T.stepIconWrap,children:(0,ee.jsx)(f().I,{icon:A.icon,size:"xs",colorVariant:"secondary"})}),(0,ee.jsx)(S().D,{styleKey:"captionMedium",children:j}),_?(0,ee.jsx)(S().D,{styleKey:"captionRegular",colorVariant:"tertiary",children:_}):null]})}),(0,ee.jsx)(b().m,{renderTooltip:()=>M,render:e=>(0,ee.jsx)("button",{type:"button","aria-label":M,onClick:e=>{e.stopPropagation()},onMouseDown:t=>{var n;t.stopPropagation(),null===(n=e.onMouseDown)||void 0===n||n.call(e,t)},onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onFocus:e.onFocus,onBlur:e.onBlur,style:T.infoButton,children:(0,ee.jsx)(f().I,{icon:P().infoCircleSmallIcon,size:"xs",colorVariant:"secondary"})})})]}),(0,ee.jsx)(Ya,{step:t,threadStore:n})]}),(0,ee.jsxs)(h().Y1,{direction:"vertical",gap:4,padding:8,children:[E&&E.length>0?(0,ee.jsx)("div",{style:{...T.previewContainer,maxHeight:y?void 0:120,overflow:y?"visible":"hidden",maskImage:y?void 0:Pa,WebkitMaskImage:y?void 0:Pa},children:(0,ee.jsx)(x().A,{type:x().O.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,sections:E,store:R,disableKeyboard:!0})}):N?(0,ee.jsx)("div",{style:{...T.previewContainer,maxHeight:y?void 0:120,overflow:y?"visible":"hidden",maskImage:y?void 0:Pa,WebkitMaskImage:y?void 0:Pa},children:(0,ee.jsx)(An,{content:N})}):L?(0,ee.jsx)(S().D,{styleKey:"captionRegular",colorVariant:"secondary",children:L}):null,(0,ee.jsx)(a().N,{children:y?(0,ee.jsxs)(i().P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:[(0,ee.jsx)(Qa,{step:t,threadStore:n}),(0,ee.jsx)("div",{style:T.codeInner,children:(0,ee.jsx)(K().X,{value:z,language:"json",onSave:U})})]}):null}),l]})]}):l?(0,ee.jsx)(h().Y1,{direction:"vertical",gap:4,width:"hug",children:l}):null}function za(e){const{step:t}=e,n=(0,p().IS)((()=>({wrap:{display:"inline-flex",alignItems:"center",justifyContent:"center",padding:"4px 8px",borderRadius:8,alignSelf:"center",background:F().Tj.background.accentPrimary,boxShadow:`0 0 0 0.5px ${F().Tj.border.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.04)`,fontSize:11,fontWeight:600,color:F().Tj.white,textTransform:"uppercase",userSelect:"none"}})),[]);return(0,ee.jsx)("div",{style:n.wrap,children:t.value.type})}function Wa(e){const{step:t}=e,n=(0,p().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:4},button:{width:"fit-content",color:F().Tj.text.secondary,fontSize:12},bubble:{padding:"8px 12px",border:`1px solid ${F().Tj.border.secondaryTranslucent}`,borderRadius:12,backgroundColor:F().Tj.background.primary,marginBottom:4}})),[]),[a,i]=(0,s.useState)(!1),o=(0,s.useMemo)((()=>JSON.stringify(t,null,2)),[t]);return(0,ee.jsxs)("div",{style:n.container,children:[(0,ee.jsx)(v().p,{onClick:()=>i(!a),style:n.button,children:t.type}),a?(0,ee.jsx)("div",{style:n.bubble,children:(0,ee.jsx)(K().O,{value:o,language:"json"})}):void 0]})}function Ua(e){const{step:t,threadStore:n,label:a,disabled:i}=e,o=(0,d().v3)(),r=(0,s.useCallback)((()=>{(0,G().WF)({environment:o,threadStore:n,stepId:t.id})}),[o,t.id,n]);return i?null:(0,ee.jsx)(te,{colorPalette:"blue",onClick:r,children:a})}const Ha={default:E().Ev.sm,large:E().lD.default};function Ka(e){const t=(0,B().tz)(),{step:n,threadStore:a,feedbackType:i,mode:o,traceId:r,iconColorVariant:l,label:u,promptKey:p,variant:g="default",feature:h,buttonSize:f="md",iconSize:S}=e,x=(0,d().v3)(),[I,k]=(0,s.useState)(!1),w=o??"feedback",C=(0,s.useCallback)((e=>{const{additionalComments:t,failureReasons:s}=e;if(!r)throw new Error("No traceId found");const o=a.getTranscript().find((e=>"config"===e.type));if(!o)throw new Error("No config step found");const l=a.getSpaceId();if(!l)throw new Error("No spaceId found");(0,Y().WB)({environment:x,type:o.value.type,traceId:r,spaceId:l,feedbackType:i,userComment:t,threadId:a.id,stepId:n.id,config:o.value,promptKey:p,failureReasons:s}),k(!1)}),[x,r,a,i,n.id,p]),A=(0,s.useCallback)((()=>{const e=a.getTranscript().find((e=>"config"===e.type));if("workflow"===(null==e?void 0:e.value.type))try{N().trackThumbsUpDownClicked({environment:x,sentiment:"thumbs_up"===i?"thumbs_up":"thumbs_down",promptKey:p,threadId:a.id,feature:e.value.isCustomAgent?"custom_agent":h})}catch{}k(!0)}),[x,i,a,p,h]),P=(0,s.useMemo)((()=>"large"===g?"thumbs_up"===i?M().r:T()._:"thumbs_up"===i?_().s:j().d),[i,g]),D=S??Ha[g],E=t.formatMessage({id:"aiInferenceTranscript.shareFeedback",defaultMessage:"Share feedback"}),R=t.formatMessage("thumbs_up"===i?{id:"aiInferenceTranscript.sharePositiveFeedback",defaultMessage:"Share positive feedback"}:{id:"aiInferenceTranscript.shareNegativeFeedback",defaultMessage:"Share negative feedback"});return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(b().m,{renderTooltip:()=>E,render:e=>u?(0,ee.jsx)(v().p,{iconLeading:{icon:P,size:D},"aria-label":R,onClick:A,children:u}):(0,ee.jsx)(y().A,{icon:{icon:P,size:D},size:f,onClick:A,ariaLabel:R,colorVariant:l,...e})}),(0,ee.jsx)(m().A,{onDismiss:()=>k(!1),style:c().A.isMobile?{maxHeight:"100%",display:"flex"}:{},render:()=>(0,ee.jsx)(z().O,{handleSubmit:C,mode:w,closeForm:()=>k(!1),threadStore:a}),isOpen:I})]})}function qa(e){const t=(0,B().tz)(),{traceId:n,threadConfigType:a}=e,i=(0,s.useCallback)((()=>{if(!n)return;const e=(0,k().W)({environmentName:"production",suffix:a});window.open(`https://www.braintrust.dev/app/Notion/p/${e}/logs?r=${n}`,"_blank")}),[n,a]);return(0,ee.jsx)(y().A,{icon:D().b,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.openInBraintrust",defaultMessage:"Open in Braintrust"}),onClick:i})}function $a(e){const{step:t}=e,n=(0,p().IS)((()=>({container:{padding:8,marginBottom:20},icon:{fill:F().Tj.red.icon.accentPrimary},codeBlock:{padding:12,borderRadius:8,backgroundColor:F().Tj.codeBlockBackground}})),[]),a=(0,s.useMemo)((()=>{const{stack:e,...n}=t;return JSON.stringify(n,null,2)}),[t]),i=(0,B().tz)();return(0,ee.jsx)(ne().Q,{style:n.container,children:(0,ee.jsx)(q().b,{label:i.formatMessage({id:"aiInferenceTranscript.errorStep.label",defaultMessage:"An error occurred, please try again"}),icon:A().exclamationMarkTriangleSmallIcon,iconStyle:n.icon,children:(0,ee.jsx)("div",{style:n.codeBlock,children:(0,ee.jsx)(K().O,{value:a,language:"json"})})})})}function Ga(e){const{step:t}=e,n=(0,p().IS)((()=>({codeBlock:{padding:12,borderRadius:8,backgroundColor:F().Tj.codeBlockBackground}})),[]),a=(0,s.useMemo)((()=>JSON.stringify(t,null,2)),[t]);return(0,ee.jsx)(q().b,{label:t.type,children:(0,ee.jsx)("div",{style:n.codeBlock,children:(0,ee.jsx)(K().O,{value:a,language:"json"})})})}function Ya(e){const{step:t,threadStore:n}=e,a=(0,d().v3)(),i=(0,p().IS)((()=>({button:{fontSize:12,color:F().Tj.text.secondary,borderRadius:7}})),[]),o=(0,s.useCallback)((()=>{G().WF({environment:a,threadStore:n,stepId:t.id})}),[a,t.id,n]);return(0,ee.jsx)(v().p,{onClick:o,style:i.button,children:"Run from here"})}function Qa(e){const{step:t,threadStore:n}=e,a=(0,p().IS)((()=>({metadata:{display:"grid",fontSize:12,paddingInlineStart:8,marginTop:4,marginBottom:4,gridTemplateColumns:"96px 1fr",gap:4},metadataKey:{color:F().Tj.text.secondary},metadataValue:{color:F().Tj.text.primary,marginInlineStart:0}})),[]),i=(0,u().K8)((()=>{var e;return null===(e=n.getMessageStoreById(t.id))||void 0===e?void 0:e.getCreatedTime()}),[t.id,n]),o=(0,u().K8)((()=>{var e;return null===(e=n.getMessageStoreById(t.id))||void 0===e||null===(e=e.getData())||void 0===e?void 0:e.completed_time}),[t.id,n]),r=o&&i?(0,ja().a)(o-i):null,l=(0,u().K8)((()=>{var e;return null===(e=n.getMessageStoreById(t.id))||void 0===e||null===(e=e.getData())||void 0===e?void 0:e.unsatisfactory}),[t.id,n]),c={"Created Time":i?new Date(i).toLocaleString():null,"Completed Time":o?new Date(o).toLocaleString():null,Duration:r,Unsatisfactory:l?"Yes":null};return(0,ee.jsx)("dl",{style:a.metadata,children:Object.entries(c).filter((([,e])=>null!==e)).map((([e,t])=>(0,ee.jsxs)(s.Fragment,{children:[(0,ee.jsx)("dt",{style:a.metadataKey,children:e}),(0,ee.jsx)("dd",{style:a.metadataValue,children:t})]},e)))})}},102271:(e,t,n)=>{n.d(t,{o:()=>o,v:()=>s});var a=()=>n(169095),i=()=>n(544751);function s(){a().F0.setState({...a().F0.state,currentScreen:"settings"})}function o(){i().EF.setState({...i().EF.state,currentScreen:"settings"})}},103812:(e,t,n)=>{n.d(t,{cg:()=>oe,Mp:()=>se,_u:()=>ge});n(16280),n(944114),n(898992),n(354520),n(581454);var a=n(296540),i=()=>n(300474),s=()=>n(920198),o=()=>n(907258),r=()=>n(242422),l=()=>n(726637),c=()=>n(484714),d=()=>n(590526),u=()=>n(401497),p=()=>n(249046),g=()=>n(127833),m=()=>n(30537),h=()=>n(388926),f=()=>n(807449),y=()=>n(406094),v=()=>n(631524),S=()=>n(160432),b=()=>n(373009),x=()=>n(340498),I=n(474848);const k={viewBox:"0 0 21 20",fittedViewBox:"-0.01 2.12 20.29 15.76",svg:(0,I.jsx)("path",{d:"m4.004 10.548.76-.76A.875.875 0 1 1 6 11.025l-2.254 2.254a.875.875 0 0 1-1.237 0L.256 11.025a.875.875 0 0 1 1.238-1.237l.76.76V10a7.875 7.875 0 0 1 13.234-5.77.875.875 0 0 1-1.192 1.281A6.125 6.125 0 0 0 4.003 10zm14-1.096.76.76A.875.875 0 1 0 20 8.976l-2.254-2.254a.875.875 0 0 0-1.237 0l-2.254 2.254a.875.875 0 0 0 1.238 1.238l.76-.76V10A6.125 6.125 0 0 1 5.96 14.489a.875.875 0 1 0-1.19 1.282A7.875 7.875 0 0 0 18.004 10z"})},w=(0,x().wt)("arrowCircleLoopBackwardFill",k,"fill"),C={viewBox:"0 0 20 20",fittedViewBox:"1.28 3.52 17.42 12.96",svg:(0,I.jsx)("path",{d:"M10.45 3.525a6.48 6.48 0 0 0-6.384 5.39 3.856 3.856 0 0 0 1.056 7.56H15.2a3.494 3.494 0 0 0 1.725-6.532 6.475 6.475 0 0 0-6.475-6.418m-.075 3.25c.345 0 .625.28.625.625v3.15a.625.625 0 1 1-1.25 0V7.4c0-.345.28-.625.625-.625m0 6.775a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5"})},A=(0,x().wt)("cloudExclamationFill",C,"fill");var T=()=>n(765974),j=()=>n(69708),M=()=>n(100622),_=()=>n(534177),P=()=>n(987267),D=()=>n(399613),E=()=>n(170139);function R(){return(0,I.jsx)(se,{type:"error",title:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.asanaSelectWorkspaceActionRequired",defaultMessage:"No Asana workspace selected"}),caption:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.asanaSelectWorkspaceActionRequiredCaption",defaultMessage:"Click to confirm workspace or disconnect"}),actionButton:{label:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.asanaSelectWorkspaceActionRequiredButton",defaultMessage:"Finish setup"}),onClick:()=>{E().g()}}})}var B=()=>n(117991),F=()=>n(537429),N=()=>n(564884),L=()=>n(576590),O=()=>n(217714);function V(){const e=(0,i().r)(),t=(0,c().v3)(),n="chat_menu",a=l().A.isMobile?void 0:{label:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.ctaForGoogleDrive",defaultMessage:"Finish setup"}),onClick:()=>{e&&((0,N().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"user_google_drive_resume_pending_connection",integration_type:"google-drive",setup_session_id:O().d.state.sessionId,from:n}}}),(0,L().navigateToAIConnectorOnboarding)({connector:"google-drive",analyticsFrom:n,sessionId:O().d.state.sessionId}))}};return(0,I.jsx)(se,{type:"error",title:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.googleDriveConnectionPendingStatusConfirmation",defaultMessage:"Complete Google Drive Connection"}),caption:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.googleDriveConnectionPendingStatusConfirmationDescription",defaultMessage:"We need more information before starting your google drive connection"}),actionButton:a})}var z=()=>n(655600),W=()=>n(311546),U=()=>n(547149),H=()=>n(272286);function K(){const e=(0,i().r)(),t=(0,c().v3)(),n="chat_menu",s=l().A.isMobile?void 0:{label:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.ctaForJiraForge",defaultMessage:"Update"}),onClick:()=>{e&&((0,N().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"user_jira_migrate_to_forge",integration_type:"jira",setup_session_id:H().yg.state.sessionId,from:n}}}),(0,L().navigateToAIConnectorOnboarding)({connector:"jira",analyticsFrom:n}))}},r=(0,d().O$)(o().AppStoreSidebarSpaceViewStore),u=(0,a.useCallback)((()=>{r&&U().createAndCommit({userAction:"jiraAIConnector.onboarding.dismissMigrateToForgePrompt",environment:t,canUndo:!0,perform:e=>{U().applyOperation({store:r,operation:{pointer:r.pointer,path:["settings"],command:"update",args:{...r.getSettings(),dismissed_jira_migrate_prompt:!0}},transaction:e})}})}),[t,r]);return(0,I.jsx)(se,{type:"error",onDismiss:u,title:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.jiraConnectionMigratePopupTitle",defaultMessage:"Update Jira AI connector"}),caption:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.jiraConnectionMigratePopupDescription",defaultMessage:"Update to the latest Jira connector by Sep 30, 2025 to continue getting Jira answers in Notion AI"}),actionButton:s})}function q(){const e=(0,i().r)(),t=(0,c().v3)(),n="chat_menu",a=l().A.isMobile?void 0:{label:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.ctaForJira",defaultMessage:"Finish setup"}),onClick:()=>{e&&((0,N().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"user_jira_resume_pending_connection",integration_type:"jira",setup_session_id:H().yg.state.sessionId,from:n}}}),(0,L().navigateToAIConnectorOnboarding)({connector:"jira",analyticsFrom:n,sessionId:H().yg.state.sessionId}))}};return(0,I.jsx)(se,{type:"error",title:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.jiraConnectionPendingStatusConfirmation",defaultMessage:"Confirm Jira Connection"}),caption:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.jiraConnectionPendingStatusConfirmationDescription",defaultMessage:"We need more information before starting your jira connection"}),actionButton:a})}function $(e){const[t,n]=(0,a.useState)(!1),s=(0,i().r)(),r=(0,c().v3)(),u=(0,d().O$)(o().AppStoreCurrentUserSettingsStore),p=(0,d().O$)(H().yg),g=(0,d().O$)(o().AppStoreSidebarSpaceViewStore),m=(0,a.useCallback)((()=>{(0,N().u)({environment:r,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"user_auth_dismiss",integration_type:"jira",setup_session_id:H().yg.state.sessionId,from:"connect_nudge"}}}),u&&g&&(U().createAndCommit({userAction:"jiraAIConnector.onboarding.dismissPersonalAuthPrompt",environment:r,canUndo:!0,perform:e=>{U().applyOperation({store:g,operation:{pointer:g.pointer,path:["settings"],command:"update",args:{...g.getSettings(),dismissed_jira_user_auth_prompt:!0}},transaction:e})}}),H().yg.setState({...p,missingUserAuth:!1}))}),[u,g,r,p]),h=(0,d().K8)((()=>{const e=H().yg.state.jiraSiteUrl.match(/^https:\/\/([a-zA-Z0-9-]+)\.atlassian\.net/);return e?e[1]:H().yg.state.jiraSiteUrl}),[]),f="chat_menu",y=l().A.isMobile?void 0:{label:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.ctaForJiraPersonalAuth",defaultMessage:"Log in"}),onClick:async()=>{s&&(n(!0),await W().ol({environment:r,spaceId:s,analyticsProperties:{buttonName:"user_auth_connect",analyticsFrom:f,sessionId:H().yg.state.sessionId}}),e.hideNotification("jira_connect_user"),n(!1),(0,N().u)({environment:r,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"user_jira_user_auth_success",integration_type:"jira",setup_session_id:H().yg.state.sessionId,from:f}}}))},disabled:t};return(0,I.jsx)(se,{type:"error",title:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.jiraConnectionStatusActionRequiredForLogin",defaultMessage:"Log in to Jira"}),caption:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.jiraConnectionStatusActionRequiredForLoginDescription",defaultMessage:"Authenticate to get answers from {jiraSiteName}",values:{jiraSiteName:h}}),actionButton:y,onDismiss:m})}var G=()=>n(102271),Y=()=>n(461475),Q=()=>n(751699),J=()=>n(610083),X=()=>n(223034),Z=()=>n(631611),ee=()=>n(115512),te=()=>n(176983),ne=()=>n(229508),ae=()=>n(604018);const ie=(0,j().YK)({actionRequiredLabel:{id:"assistantChat.ingestion.actionRequiredButton",defaultMessage:"Action required"},infoLabel:{id:"assistantChat.ingestion.infoButton",defaultMessage:"Info"},syncingLabel:{id:"assistantChat.ingestion.syncingButton",defaultMessage:"Syncing"},mobileNotAvailable:{id:"assistantChat.ingestion.actionMenuNotAvailable",defaultMessage:"Access Notion on desktop to fix this issue."},disconnectingPopupTitle:{id:"assistantChat.ingestion.disconnectingPopupTitle",defaultMessage:"Disconnecting {appName}"},disconnectingPopupCaption:{id:"assistantChat.ingestion.disconnectingPopupCaption",defaultMessage:"Your workspace owner has disconnected {appName}. This can take up to 3 hours."},connectingPopupTitle:{id:"assistantChat.ingestion.connectingPopupTitle",defaultMessage:"Connecting {appName}"}});function se({type:e,title:t,caption:n,actionButton:i,onDismiss:s}){const o=(0,u().IS)((()=>({container:{display:"flex",gap:8,paddingBottom:i||s?4:0},iconContainer:{paddingTop:2},contentContainer:{display:"flex",flexDirection:"column",gap:2},title:{fontSize:ee().vQ},caption:{fontSize:ee().Kw,color:M().Tj.text.secondary},actionsContainer:{marginTop:6,display:"flex",gap:8}})),[i,s]),r={info:A,error:T().exclamationMarkTriangleFillIcon,progress:w,disconnecting:w},c=l().A.isMobile?(0,I.jsx)("div",{style:o.caption,children:(0,I.jsx)(j().sA,{...ie.mobileNotAvailable})}):(0,I.jsxs)(p().Ye,{gap:8,children:[i?(0,I.jsx)(S().A,{size:"sm",onClick:i.onClick,children:i.label}):void 0,s?(0,I.jsx)(y().A,{size:"sm",onClick:s,children:(0,I.jsx)(j().sA,{id:"aiConnectorNotifications.ingestion.dismissButton",defaultMessage:"Dismiss"})}):void 0]}),[d,g]=(0,a.useMemo)((()=>{switch(e){case"info":return[void 0,"secondary"];case"error":return["red","accentPrimary"];case"progress":case"disconnecting":return["blue","accentPrimary"]}}),[e]);return(0,I.jsxs)(p().Ye,{style:o.container,children:[(0,I.jsx)("div",{style:o.iconContainer,children:(0,I.jsx)(f().I,{icon:r[e],size:"sm",colorPalette:d,colorVariant:g})}),(0,I.jsxs)("div",{style:o.contentContainer,children:[(0,I.jsx)("div",{style:o.title,children:t}),(0,I.jsx)("div",{style:o.caption,children:n}),i||s?(0,I.jsx)("div",{style:o.actionsContainer,children:c}):void 0]})]})}function oe(e){const{tooltipEvents:t}=e,n=(0,s().L)(),i=(0,j().tz)(),o=(0,Z().jw)().isType("fullPage"),c=(0,te().J)(n),p=(0,ne().a)(),f=(0,d().K8)((()=>(0,ae().kB)()),[]),[y,S]=(0,a.useState)([]),x=(0,a.useCallback)((e=>{S((t=>[...t,e]))}),[]),k=(0,d().K8)((()=>z()._1.filter((e=>{return"slack_select_channels"!==e&&("microsoft_teams_select_teams"!==e&&("sharepoint_select_sites"!==e&&("google_drive_connection_pending"!==e&&("box_awaiting_confirmation"!==e&&("asana_select_workspace"===e?null==p||null===(t=p.getSettings())||void 0===t?void 0:t.dismissed_asana_select_workspace_prompt:"slack_re_auth"===e?null==p||null===(n=p.getSettings())||void 0===n?void 0:n.dismissed_slack_personal_auth_prompt:"slack_v2_user_connection"===e?"dismissed_slack_v2_user_connection_prompt":"github_re_auth"===e?null==p||null===(a=p.getSettings())||void 0===a?void 0:a.dismissed_github_personal_auth_prompt:"jira_connection_pending"===e?null==p||null===(i=p.getSettings())||void 0===i?void 0:i.dismissed_jira_installation_pending_prompt:"jira_connect_user"===e?null==p||null===(s=p.getSettings())||void 0===s?void 0:s.dismissed_jira_user_auth_prompt:"jira_select_projects"===e?null==p||null===(o=p.getSettings())||void 0===o?void 0:o.dismissed_jira_select_projects_prompt:"jira_migrate"===e?null==p||null===(r=p.getSettings())||void 0===r?void 0:r.dismissed_jira_migrate_prompt:"slack_migrate"===e?null==p||null===(l=p.getSettings())||void 0===l?void 0:l.dismissed_slack_migrate_prompt:"linear_re_auth"===e?null==p||null===(c=p.getSettings())||void 0===c?void 0:c[F().$Y.linear]:"discord_re_auth"===e?null==p||null===(d=p.getSettings())||void 0===d?void 0:d[F().$Y.discord]:"salesforce_re_auth"===e?null==p||null===(u=p.getSettings())||void 0===u?void 0:u[F().$Y.salesforce]:"asana_re_auth"===e?null==p||null===(g=p.getSettings())||void 0===g?void 0:g[F().$Y.asana]:void(0,_().HB)(e))))));var t,n,a,i,s,o,r,l,c,d,u,g}))),[p]),C=(0,d().K8)((()=>r().default.getConfigKey("ai_connector_user_notifications","notifications").map((e=>({type:"readonly_notification",message:e})))),[]),M=(0,d().K8)((()=>{const e=[];for(const t of f){const n=(0,z().uD)(t,c);for(const a of n)y.includes(a.type)||k.includes(a.type)||e.push({connector:t,type:"action_required",action:a})}return e}),[f,c,y,k]),P=(0,d().K8)((()=>{const e=[];for(const t of f){const n=(0,z().LT)(t);n.isInProgress&&e.push({connector:t,type:"in_progress",ingestionProgress:n.ingestionProgress})}return e}),[f]),D=(0,d().K8)((()=>{const e=[];for(const t of f){(0,z().$t)(t)&&e.push({connector:t,type:"disconnecting"})}return e}),[f]),E=M.length>0,R=C.length>0,B=(0,a.useMemo)((()=>[...C,...M,...P,...D]),[C,M,P,D]),[N,L]=(0,a.useState)(!1);(0,a.useEffect)((()=>{setTimeout((()=>{l().A.isMobile||L(E)}),1e3)}),[E]);const O=(0,a.useCallback)((()=>{L(!1)}),[]),V=(0,a.useCallback)(((e,t)=>e?T().exclamationMarkTriangleFillIcon:t?A:w),[]),W=(0,u().IS)((()=>({popupStyle:{minWidth:250},popupContainer:{display:"flex",flexDirection:"column",gap:2,paddingInlineStart:12,paddingTop:8,paddingInlineEnd:10,paddingBottom:8,maxWidth:l().A.isMobile?void 0:250,maxHeight:400,overflowY:"scroll"}})),[]);return 0===B.length?null:(0,I.jsx)(g().zD,{popupType:l().A.isMobile?m().n.BottomSheet:m().n.Popup,originGap:6,alignmentToOrigin:"center",open:N,onDismiss:()=>{L(!1)},placementToOrigin:o?"bottom":"top",borderRadius:6,trapFocus:!1,render:()=>(0,I.jsx)("div",{style:W.popupContainer,children:B.map(((e,t)=>(0,I.jsxs)(a.Fragment,{children:[(0,I.jsx)(re,{notification:e,hideNotification:x,minimizePopup:O}),t!==B.length-1?(0,I.jsx)(h().A,{size:14,isHidden:!1}):void 0]},t)))}),origin:o?(0,I.jsx)(b().E,{size:"xxs",...t,iconLeading:V(E,R),colorPalette:E?"red":R?void 0:"blue",onClick:()=>{L(!0)},children:E?i.formatMessage(ie.actionRequiredLabel):R?i.formatMessage(ie.infoLabel):i.formatMessage(ie.syncingLabel)}):(0,I.jsx)(v().p,{...t,size:"sm",iconLeading:V(E,R),colorPalette:E?"red":R?"gray":"blue",colorVariant:E?void 0:R?"tertiary":void 0,ariaLabel:i.formatMessage({id:"assistantChat.ingestion.viewConnectionStatusAriaLabel",defaultMessage:"View connection status"}),onClick:()=>{L(!0)}}),style:W.popupStyle})}function re(e){const{notification:t,hideNotification:n,minimizePopup:a}=e,i=(0,s().L)(),o=(0,te().J)(i);if("action_required"===t.type){if("slack_select_channels"===t.action.type)return(0,I.jsx)(pe,{});if("microsoft_teams_select_teams"===t.action.type)return(0,I.jsx)(Y().n,{});if("sharepoint_select_sites"===t.action.type)return(0,I.jsx)(ge,{canAdmin:o});if("slack_re_auth"===t.action.type)return(0,I.jsx)(he,{hideNotification:n});if("slack_v2_user_connection"===t.action.type)return(0,I.jsx)(me,{hideNotification:n});if("box_awaiting_confirmation"===t.action.type)return(0,I.jsx)(fe,{});if("github_re_auth"===t.action.type||"linear_re_auth"===t.action.type||"discord_re_auth"===t.action.type||"salesforce_re_auth"===t.action.type||"asana_re_auth"===t.action.type){if("github"===t.connector||"linear"===t.connector||"discord"===t.connector||"salesforce"===t.connector||"asana"===t.connector)return(0,I.jsx)(F().cy,{connector:t.connector,minimizePopup:a,hideNotification:n,showDismiss:!0,shouldDismiss:!0});throw new Error(`Unsupported connector: ${t.connector}`)}if("jira_connection_pending"===t.action.type)return(0,I.jsx)(q,{});if("google_drive_connection_pending"===t.action.type)return(0,I.jsx)(V,{});if("jira_connect_user"===t.action.type)return(0,I.jsx)($,{hideNotification:n});if("jira_select_projects"===t.action.type)return(0,I.jsx)(ue,{});if("jira_migrate"===t.action.type)return(0,I.jsx)(K,{});if("slack_migrate"===t.action.type)return null;if("asana_select_workspace"===t.action.type)return(0,I.jsx)(R,{});(0,_().HB)(t.action)}else{if("in_progress"===t.type){const{connector:e,ingestionProgress:n}=t;return(0,I.jsx)(ce,{connection:e,ingestionProgress:n,time:(0,X().iu)(e)})}if("disconnecting"===t.type){const{connector:e}=t;return(0,I.jsx)(de,{connection:e})}if("readonly_notification"===t.type)return(0,I.jsx)(le,{message:t.message});(0,_().HB)(t)}}function le(e){const{message:t}=e;return(0,I.jsx)(se,{type:"info",title:t.title,caption:t.caption})}function ce(e){const{connection:t,time:n,ingestionProgress:a}=e,i=P().w0[t],s=a?(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.textWithProgress",defaultMessage:"This can take up to 36h{br}{ingestionProgress}% done",values:{ingestionProgress:a,br:(0,I.jsx)("br",{})}}):(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.textWithoutProgress",defaultMessage:"This can take up to {time}h",values:{time:n||36}});return(0,I.jsx)(se,{type:"progress",title:(0,I.jsx)(j().sA,{...ie.connectingPopupTitle,values:{appName:i}}),caption:s})}function de(e){const{connection:t}=e,n=P().w0[t];return(0,I.jsx)(se,{type:"disconnecting",title:(0,I.jsx)(j().sA,{...ie.disconnectingPopupTitle,values:{appName:n}}),caption:(0,I.jsx)(j().sA,{...ie.disconnectingPopupCaption,values:{appName:n}})})}function ue(){const e=(0,d().O$)(o().AppStoreSidebarSpaceViewStore),t=(0,c().v3)(),n=(0,a.useCallback)((()=>{e&&U().createAndCommit({userAction:"jiraAIConnector.onboarding.dismissSelectProjectsPrompt",environment:t,canUndo:!0,perform:t=>{U().applyOperation({store:e,operation:{pointer:e.pointer,path:["settings"],command:"update",args:{...e.getSettings(),dismissed_jira_select_projects_prompt:!0}},transaction:t})}})}),[e,t]);return(0,I.jsx)(se,{type:"error",title:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.jiraSelectProjectsPopupTitle",defaultMessage:"Select Jira projects"}),caption:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.jiraSelectProjectsPopupCaption",defaultMessage:"Select projects to connect to Jira AI connector"}),actionButton:{label:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.jiraSelectProjectsActionRequiredButton",defaultMessage:"Select projects"}),onClick:()=>{W().G({analyticsFrom:"chat_menu",screenToShow:"connection_complete_screen"})}},onDismiss:n})}function pe(){return(0,I.jsx)(se,{type:"error",title:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.connectionStatusActionRequired",defaultMessage:"No Slack channels selected"}),caption:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.connectionStatusActionRequiredCaption",defaultMessage:"Click to confirm channels or disconnect"}),actionButton:{label:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.slackActionRequiredButton",defaultMessage:"Finish setup"}),onClick:()=>{Q().nh()}}})}function ge(e){const{canAdmin:t}=e;return(0,I.jsx)(se,{type:"error",title:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.sharepointConnectionStatusActionRequired",defaultMessage:"No SharePoint sites selected"}),caption:t?(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.sharepointConnectionStatusActionRequiredCaption",defaultMessage:"Click to select sites"}):(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.sharepointConnectionStatusActionRequiredCaptionNonAdmin",defaultMessage:"Your workspace owner needs to select sites"}),actionButton:t?{label:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.sharepointActionRequiredButton",defaultMessage:"Select sites"}),onClick:()=>{G().o()}}:void 0})}function me(e){const{hideNotification:t}=e,n=(0,c().v3)(),a=(0,i().r)();return(0,d().O$)(o().AppStoreSidebarSpaceViewStore)&&a?(0,I.jsx)(se,{type:"error",title:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.userConnectionStatusActionRequired",defaultMessage:"Connect to Slack"}),caption:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.userConnectionStatusActionRequiredCaption",defaultMessage:"Please connect your Slack account to continue using Notion AI"}),actionButton:{label:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.userConnectionStatusActionRequiredButton",defaultMessage:"Connect"}),onClick:()=>{t("slack_v2_user_connection"),Q().JR({environment:n,spaceId:a})}}}):null}function he(e){const{hideNotification:t}=e,n=(0,c().v3)(),a=(0,i().r)(),s=(0,d().O$)(o().AppStoreSidebarSpaceViewStore);return s&&a?(0,I.jsx)(se,{type:"error",title:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.connectionStatusActionRequiredForLoginStatusMenu",defaultMessage:"Log in to Slack"}),caption:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.connectionStatusActionRequiredCaptionForLogin",defaultMessage:"We couldnt verify your slack e-mail. Authenticate to proceed."}),actionButton:{label:(0,I.jsx)(j().sA,{id:"assistantChat.ingestion.slackActionRequiredButtonForLogin",defaultMessage:"Log in"}),onClick:()=>{t("slack_re_auth"),(0,D().t)({connector:"slack",environment:n,spaceId:a,analyticsProperties:{buttonName:"connect_slack_user_mapping"}})}},onDismiss:()=>{Q().R2({environment:n,sidebarSpaceViewStore:s,analyticsProperties:{analyticsFrom:J().Rh.state.analyticsFrom,buttonName:"dismiss_connect_slack_user_mapping",sessionId:J().Rh.state.sessionId}})}}):null}function fe(){return(0,I.jsx)(se,{type:"error",title:(0,I.jsx)(j().sA,{id:"assistantChat.box.connectionStatusActionRequired",defaultMessage:"Confirm connection"}),caption:(0,I.jsx)(j().sA,{id:"assistantChat.box.connectionStatusActionRequiredCaption",defaultMessage:"Click to confirm connection"}),actionButton:{label:(0,I.jsx)(j().sA,{id:"assistantChat.box.boxAwaitingConfirmationActionRequiredButton",defaultMessage:"Confirm connection"}),onClick:()=>{B().m()}}})}},105239:(e,t,n)=>{n.d(t,{N:()=>i});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"3.37 1.37 13.26 16.26",svg:(0,n(474848).jsx)("path",{d:"M9.191 1.478a.624.624 0 0 1 .864.867l-.08.099-1.942 1.932H10A6.625 6.625 0 1 1 3.375 11a.625.625 0 1 1 1.25 0A5.375 5.375 0 1 0 10 5.626H8.037L9.962 7.56l.08.098a.626.626 0 0 1-.966.783L6.083 5.434l-.077-.096a.626.626 0 0 1 .08-.788l3.007-2.993z"})},i=(0,n(340498).wt)("arrowCircleSpinCounterClockwise",a,"default")},108181:(e,t,n)=>{n.d(t,{N:()=>o});n(18107),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);var a=()=>n(907258),i=()=>n(696746),s=()=>n(712505);function o(e){const t=[],n=new Set;function o(e){return!!e&&(!n.has(e.id)&&(n.add(e.id),!0))}function r(e){o(e)&&t.push(e)}return o((0,i().x$)(a().default.state.sidebarSpaceViewStore)),r(e),s().default.state.open&&r(s().default.state.targetStore),r(a().default.state.mainEditorCurrentBlockStore),{primaryEditorStore:t.at(0),backgroundEditorStore:t.at(1)}}},109089:(e,t,n)=>{n.d(t,{N:()=>i});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"1.22 4 16.5 13.25",svg:(0,n(474848).jsx)("path",{d:"M1.23 13.313a.56.56 0 0 1 .842-.486l2.881 1.688c.37.216.37.754 0 .97l-2.88 1.688a.56.56 0 0 1-.843-.485zM17.1 14c.345 0 .626.28.626.625v.75c0 .345-.28.625-.625.625H7.9a.625.625 0 0 1-.626-.625v-.75l.013-.126A.625.625 0 0 1 7.9 14zm0-3.333a.625.625 0 1 1 0 1.25H7.9l-.127-.013a.626.626 0 0 1 0-1.224l.126-.013zm0-3.334a.625.625 0 0 1 0 1.25H7.9l-.127-.013a.626.626 0 0 1 0-1.224l.126-.013zM17.1 4a.625.625 0 1 1 0 1.25H7.9l-.127-.013a.626.626 0 0 1 0-1.224L7.9 4z"})},i=(0,n(340498).wt)("layoutBelowPageContent",a,"default")},110443:(e,t,n)=>{n.d(t,{Yl:()=>s,eH:()=>o,hy:()=>l,oB:()=>r,wk:()=>i});var a=()=>n(939768);const i="For security or quality reasons, this connection is not available at this time.";function s(e){const t=e.trim(),n=(0,a().bk)(t);if(!n)return t.toLowerCase();const i=n.pathname.replace(/\/+$/,"")||"/";return n.pathname=i,n.toString().toLowerCase()}function o(e){const t=(0,a().bk)(e);return!!t&&(t.hostname.endsWith("mcp.mail.notion.so")&&"/mail"===t.pathname||t.hostname.endsWith("mcp.mail.dev.notion.so")&&"/mail"===t.pathname||t.hostname.endsWith("mcp.mail.stg.notion.so")&&"/mail"===t.pathname||"localhost"===t.hostname&&"3000"===t.port&&"/mail"===t.pathname||"localhost"===t.hostname&&"6010"===t.port&&"/mail"===t.pathname)}function r(e){const t=(0,a().bk)(e);if(!t)return!1;const n=t.hostname.toLowerCase();return n.endsWith("notion.so")||n.endsWith("notion.com")}function l(e){return o(e)}},111251:(e,t,n)=>{n.d(t,{p:()=>c});n(296540);var a=()=>n(590526),i=()=>n(69708),s=()=>n(860864),o=()=>n(622936),r=()=>n(233692),l=n(474848);function c({store:e,rightIcon:t,serverName:n,serverIcon:c}){const d=(0,i().tz)(),{name:u,icon:p}=(0,a().K8)((()=>{const t=(0,r().m)(e,n||d.formatMessage({id:"workflow.emptyWorkflowTitle",defaultMessage:"Untitled agent"}));return{name:t.name,icon:c||t.icon}}),[e,d,n,c]);return(0,l.jsx)(s().dX,{mainIcon:(0,l.jsx)(o().AgentIcon,{agentIcon:p,workflowStore:e,size:20}),title:u,rightIcon:t,useThinTitle:!1})}},117991:(e,t,n)=>{n.d(t,{m:()=>i});var a=()=>n(61433);function i(){const{status:e}=a().MX.state;"box_awaiting_confirmation"===e&&a().MX.setState({...a().MX.state,currentScreen:"connecting"})}},119994:(e,t,n)=>{n.d(t,{U:()=>u});n(296540);var a=()=>n(699143),i=()=>n(493552),s=()=>n(783793),o=()=>n(453697),r=()=>n(436525),l=()=>n(742734),c=()=>n(622936),d=n(474848);function u(e){const t=e.avatarSize??(e.type,20),n=(0,l().E)({spaceStore:"user"===e.type?e.spaceStore:void 0,viewedUserId:"user"===e.type?e.userStore.id:void 0}),u=(0,d.jsxs)(a().Y1,{direction:"horizontal",gap:8,align:"agent"===e.type?"center-left":"center-right",style:{marginInlineStart:0,marginBottom:e.gap},children:["user"===e.type?(0,d.jsx)(o().A,{userStore:e.userStore,size:t}):e.workflowStore?(0,d.jsx)(c().AgentIcon,{agentIcon:void 0,workflowStore:e.workflowStore,size:t}):(0,d.jsx)(s().x,{variant:"plans",shadowVariant:"strong"}),(0,d.jsx)(i().D,{styleKey:"captionMedium",colorVariant:"secondary",children:e.displayName})]});return"user"===e.type&&n?(0,d.jsx)(r().D,{userStore:e.userStore,spaceStore:e.spaceStore,children:u}):u}},120013:(e,t,n)=>{n.d(t,{A:()=>i});class a extends(()=>n(757695))().Store{getInitialState(){return{available:!0}}}const i=new a},122078:(e,t,n)=>{n.d(t,{I:()=>F});n(944114),n(898992),n(354520),n(581454);var a=n(296540),i=()=>n(664594),s=()=>n(300474),o=()=>n(242422),r=()=>n(590526),l=()=>n(401497),c=()=>n(127833),d=()=>n(30537),u=()=>n(420802),p=()=>n(396896),g=()=>n(807449),m=()=>n(546926),h=()=>n(631524),f=()=>n(160432),y=()=>n(493552),v=()=>n(890492),S=()=>n(81068),b=()=>n(663639),x=()=>n(736847),I=()=>n(452004),k=()=>n(877551),w=()=>n(173614),C=()=>n(340498),A=()=>n(640182),T=()=>n(966249),j=()=>n(69708),M=()=>n(56394),_=()=>n(385226),P=()=>n(30757),D=()=>n(133532),E=()=>n(844317),R=n(474848);const B=(0,j().YK)({pillTitle:{id:"integrationsFilter.pillTitle",defaultMessage:"Integrations"},customIntegrationsSection:{id:"integrationsFilter.customIntegrationsSection",defaultMessage:"Custom integrations"},integrationsSection:{id:"integrationsFilter.integrationsSection",defaultMessage:"Integrations"}});function F({integrationTypes:e,setIntegrationTypes:t,mcpServerNames:n,setMcpServerNames:F,distinctMcpServers:N}){const L=(0,j().tz)(),O=(0,r().uB)(void 0,I().$),V=(0,l().IS)((()=>({container:{padding:"6px 0 6px"},footer:{paddingTop:8,paddingInlineEnd:8,paddingBottom:2,paddingInlineStart:8,justifyContent:"space-between",display:"flex",flexDirection:"row"}})),[]),[z,W]=(0,a.useState)(!1),U=(0,i().T)(),H=(0,s().r)(),K=(0,r().K8)((()=>{const e=[];for(const n of A().zP){var t;if("notion"===n||"mcpServer"===n)continue;const a=(0,T().jK)(n);if(!a)continue;((null==a||null===(t=a.isAvailable)||void 0===t?void 0:t.call(a,{experimentService:o().default,userId:U,spaceId:H??"",configStep:(0,E().getWorkflowAgentConfig)({isCustomAgent:!0})}))??!0)&&e.push(n)}return e}),[U,H]),q=(0,a.useMemo)((()=>{if(0===N.length)return!1;const e=N.filter((e=>n.includes(e.name))).length;return 0!==e&&(e===N.length||"partial")}),[N,n]),$=(0,a.useCallback)((()=>{W(!1)}),[]),G=(0,a.useCallback)((()=>{t([]),F([])}),[t,F]),Y=(0,a.useCallback)((n=>{e.includes(n)?t(e.filter((e=>e!==n))):t([...e,n])}),[e,t]),Q=(0,a.useCallback)((e=>{n.includes(e)?F(n.filter((t=>t!==e))):F([...n,e])}),[n,F]),J=(0,a.useCallback)((()=>{F(!0===q?[]:N.map((e=>e.name)))}),[q,N,F]),X=(0,a.useCallback)((e=>{const t=(0,T().jK)(e);return t?t.getName(L):e}),[L]),Z=(0,a.useCallback)((()=>{const t=[];if(K.length>0){const n=K.map((t=>{const n=(0,T().jK)(t),a=null==n?void 0:n.getIcon(),i=X(t),s=e.includes(t);return{key:t,action:()=>Y(t),render:e=>(0,R.jsx)(S().A,{...e,icon:(0,R.jsx)(u().S,{checked:s,onClick:()=>Y(t),size:16}),title:(0,R.jsxs)(p().fI,{gap:8,alignItems:"center",children:[a?(0,R.jsx)(g().I,{icon:a,size:"sm"}):null,(0,R.jsx)(y().D,{as:"span",styleKey:"bodySmRegular",children:i})]})})}}));t.push({key:"integrations",items:n,render:e=>(0,R.jsx)(x().A,{...e,title:L.formatMessage(B.integrationsSection),loading:!1})})}if(N.length>0){const e=[];e.push({key:"mcp-server-all",action:J,render:e=>(0,R.jsx)(S().A,{...e,icon:(0,R.jsx)(u().S,{checked:q,onClick:J,size:16}),title:(0,R.jsxs)(p().fI,{gap:8,alignItems:"center",children:[(0,R.jsx)(g().I,{icon:k().a,size:"sm"}),(0,R.jsx)(y().D,{as:"span",styleKey:"bodySmSemibold",children:L.formatMessage(B.customIntegrationsSection)})]})})});for(const t of N){const a=n.includes(t.name);e.push({key:`mcp-${t.name}`,action:()=>Q(t.name),render:e=>(0,R.jsx)(S().A,{...e,style:{paddingInlineStart:32},left:(0,R.jsxs)(p().fI,{gap:8,alignItems:"center",children:[(0,R.jsx)(u().S,{checked:a,onClick:()=>Q(t.name),size:16}),(0,R.jsx)(D().X,{iconUrl:t.serverIconUrl,serverUrl:t.serverUrl,serverName:t.name,size:C().Ev.sm})]}),title:t.name,right:(0,R.jsx)(P().W,{serverUrl:t.serverUrl})})})}t.push({key:"mcp-servers",items:e,render:e=>(0,R.jsx)(x().A,{...e,title:null,topBorder:!0})})}return(0,R.jsxs)("div",{style:V.container,children:[(0,R.jsx)(v().A,{menuType:m().gu.Popup,header:null,maxHeight:300,width:300,children:(0,R.jsx)(b().A,{type:b().O.Vertical,store:O,initialFocus:0,sections:t})}),(0,R.jsxs)(x().A,{topBorder:!0,style:V.footer,children:[e.length>0||n.length>0?(0,R.jsx)(h().p,{onClick:G,children:(0,R.jsx)(j().sA,{id:"integrationsFilter.clearButton",defaultMessage:"Clear"})}):(0,R.jsx)("div",{}),(0,R.jsx)(f().A,{colorPalette:"blue",onClick:$,children:(0,R.jsx)(j().sA,{id:"integrationsFilter.doneButton",defaultMessage:"Done"})})]})]})}),[K,N,e,n,q,X,Y,Q,J,G,$,L,O,V]),ee=(0,a.useMemo)((()=>{if(0===e.length&&0===n.length)return L.formatMessage(B.pillTitle);const t=[];for(const n of e)t.push(X(n));for(const e of n)t.push(e);return L.formatList(t,{type:"unit"})}),[e,n,X,L]),te=e.length>0||n.length>0,ne=(0,R.jsx)(M().A,{on:te,icon:(0,R.jsx)(g().I,{icon:w().c}),title:te?ee:L.formatMessage(B.pillTitle),onClick:()=>W(!0)});return(0,R.jsx)(_().A,{children:(0,R.jsx)(c().zD,{popupType:d().n.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",open:z,render:Z,onDismiss:$,keepFocus:!0,origin:ne,preventScaleTransition:!0,trapFocus:!0})})}},124972:(e,t,n)=>{n.d(t,{L:()=>E,h:()=>R});var a=n(296540),i=()=>n(726637),s=()=>n(381175),o=()=>n(590526),r=()=>n(401497),l=()=>n(295633),c=()=>n(849255),d=()=>n(699143),u=()=>n(807449),p=()=>n(26697),g=()=>n(81068),m=()=>n(764880),h=()=>n(878456),f=()=>n(584262),y=()=>n(921123),v=()=>n(209969),S=()=>n(179034),b=()=>n(798880),x=()=>n(931075),I=()=>n(187820),k=()=>n(128295),w=()=>n(16006),C=()=>n(877349),A=()=>n(457688),T=()=>n(492414),j=()=>n(470928),M=()=>n(246766),_=()=>n(813679),P=()=>n(996918),D=n(474848);function E(e){const{index:t,blockId:n,environment:a,spaceStore:i,threadStore:o,showUsedByLLM:r}=e;return{key:`notion:${n}:${t}`,render:e=>(0,D.jsx)(B,{...e,blockId:n,spaceStore:i,showUsedByLLM:r}),action:({event:e})=>{const t=l().B.createChildStore(i,{id:n,table:S().ev});if(!t)return;const r=(null==o?void 0:o.getTranscript())??[],c=(0,h().f_)(r),d=Boolean((0,h().sQ)(c)),u=(0,T().Ef)({environment:a,updates:{store:t,pageVisitSource:d?f().y8.AIQna:f().y8.AIChat}});(0,M().navigate)({environment:a,url:u,openInNew:(0,s().V)(e)})}}}function R(e){const{index:t,spaceStore:n,userId:a}=e,i=c().L.createChildStore(n,{id:a,table:b().oo}).getModel();if(i)return{key:`user:${a}:${t}`,render:e=>(0,D.jsx)(A().A,{...e,actor:(0,m().D3)(i)}),action:()=>{}}}function B(e){const{blockId:t,spaceStore:n,showUsedByLLM:s,...c}=e,m=(0,r().IS)((()=>({verifiedPageIcon:{marginInlineStart:4}})),[]),h=(0,a.useMemo)((()=>l().B.createChildStore(n,{id:t,table:S().ev})),[t,n]),{icon:f,iconRecordCategory:b,isEmptyPage:A,blockStoreHasPath:T,showVerifiedPageIcon:M,showArchivedPageIcon:E}=(0,o().K8)((()=>({icon:null==h?void 0:h.getIcon(),iconRecordCategory:(0,I().Te)(h),isEmptyPage:(null==h?void 0:h.isEmptyPage())??!0,blockStoreHasPath:h&&(0,k().a6)(h),showVerifiedPageIcon:(0,x().sN)(null==h?void 0:h.getModel()),showArchivedPageIcon:"archived"===(0,j().i1)(h).type})),[h]),R=(0,a.useCallback)((e=>(0,D.jsx)(C().y,{store:h,events:e})),[h]);return h?(0,D.jsx)(p().m,{noStyle:!0,delayThreshold:0,placement:"left",alignment:"center",originGap:24,renderTooltip:R,render:e=>(0,D.jsx)("div",{onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,style:{width:"100%"},children:(0,D.jsx)(g().A,{...c,...(0,_().g$)(),title:(0,D.jsxs)(d().Y1,{direction:"horizontal",align:"center-left",gap:2,style:{minWidth:0,flexShrink:0},children:[(0,D.jsx)(_().hL,{children:(0,D.jsx)(w().A,{store:h})}),s?(0,D.jsx)(P().M,{}):void 0,M?(0,D.jsx)(u().I,{icon:v().checkmarkCircleFillIcon,size:"xxs",colorPalette:"blue",colorVariant:"accentPrimary",style:m.verifiedPageIcon}):void 0,E?(0,D.jsx)(u().I,{icon:y().archiveBoxFillIcon,size:"xxs",colorPalette:"gray",colorVariant:"secondary",style:m.verifiedPageIcon}):void 0]}),icon:(0,D.jsx)(I().B6,{disabled:!0,icon:f,iconRecordCategory:b,isEmptyPage:A,size:i().A.isMobile?24:20}),right:T?(0,D.jsx)(k().Ay,{store:h,showFullPathInTooltip:!0}):void 0,className:"notranslate"})})}):null}},128555:(e,t,n)=>{n.d(t,{U:()=>fe,E:()=>he});n(18107),n(967357);var a=n(296540),i=()=>n(920198),s=()=>n(907258),o=()=>n(755531),r=()=>n(726637),l=()=>n(402014),c=()=>n(908006),d=()=>n(484714),u=()=>n(590526),p=()=>n(401497),g=()=>n(128933),m=()=>n(882722),h=()=>n(843427),f=()=>n(232615),y=()=>n(847832),v=()=>n(201980),S=()=>n(220719),b=()=>n(69708),x=()=>n(100622),I=()=>n(534177),k=()=>n(829300),w=()=>n(551414),C=()=>n(729368),A=()=>n(631611),T=()=>n(551345),j=()=>n(261999),M=()=>n(366437),_=()=>n(162629),P=()=>n(301421),D=()=>n(321874),E=()=>n(287234),R=()=>n(789586),B=()=>n(295304),F=()=>n(260850),N=()=>n(547149),L=()=>n(611947),O=()=>n(140022),V=()=>n(150984),z=()=>n(501305),W=()=>n(977270),U=()=>n(996477),H=()=>n(945710),K=()=>n(514624),q=()=>n(912771),$=()=>n(74831),G=()=>n(383070),Y=()=>n(483730),Q=()=>n(715142),J=()=>n(356983),X=()=>n(624652),Z=()=>n(895959),ee=()=>n(28070),te=()=>n(515692),ne=()=>n(220331),ae=()=>n(339780),ie=n(474848);function se(e){const{inferenceId:t,sessionId:n}=e;return(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(ae().DS,{sessionId:n,inferenceId:t,disableTooltip:!1}),(0,ie.jsx)(ae().gS,{sessionId:n,inferenceId:t,disableTooltip:!1})]})}var oe=()=>n(537525),re=()=>n(939584),le=()=>n(124092),ce=()=>n(373009),de=()=>n(26697),ue=()=>n(284371);const pe=(0,b().YK)({researchModeButton:{id:"assistant.welcomePage.researchModeButton",defaultMessage:"Research Mode"},researchModeButtonTooltip:{id:"assistant.welcomePage.researchModeButtonTooltip",defaultMessage:"Get a thorough report for any question or topic"},researchModeButtonAriaLabelOn:{id:"assistant.welcomePage.researchModeButton.ariaLabel.on",defaultMessage:"Research mode is on"},researchModeButtonAriaLabelOff:{id:"assistant.welcomePage.researchModeButton.ariaLabel.off",defaultMessage:"Research mode is off"}});function ge(e){const{buttonState:t,onClick:n}=e,i=(0,b().tz)(),s="active"===t,o=(0,p().IS)((()=>{const e={borderRadius:18,height:(0,te().Jc)(r().A.isMobile,!0),fontWeight:ue().Wy.medium};return{button:{...e,border:`1px solid ${x().Tj.outlineButtonBorder}`,color:x().Tj.text.tertiary,background:"transparent"},buttonActive:{border:"1px solid transparent",...e}}}),[]),l=(0,a.useCallback)((e=>{e.preventDefault()}),[]);return(0,ie.jsx)(de().m,{renderTooltip:()=>(0,ie.jsx)(b().sA,{...pe.researchModeButtonTooltip}),render:e=>s?(0,ie.jsx)(ce().E,{style:o.buttonActive,...e,onClick:n,onMouseDown:l,colorPalette:"blue","aria-pressed":!0,"aria-label":i.formatMessage(pe.researchModeButtonAriaLabelOn),children:(0,ie.jsx)(b().sA,{...pe.researchModeButton})}):(0,ie.jsx)(le().p,{style:o.button,...e,onClick:n,onMouseDown:l,"aria-pressed":!1,"aria-label":i.formatMessage(pe.researchModeButtonAriaLabelOff),children:(0,ie.jsx)(b().sA,{...pe.researchModeButton})})})}function me(e){const{mode:t,assistantSurface:n,store:l,onFocus:d,onBlur:g,isMultiline:h,typeaheadSkillElement:f,requestedSkill:y,assistantLoadingState:v,disabledMentionTypes:S,permittedMentionTypes:b,placeholder:I,disableEnter:w,handleEnter:A,handleEsc:T,handleClickStop:j,setSelectionAtEndIfNotEditing:_,canSupportAdditionalAttachmentUpload:D,writerSessionId:E,writerFeedbackInferenceId:B,onPasteFiles:F,storeIsEmpty:N,disableMentions:L,inputContainerOverrideStyles:O,inputPlaceholderOverrideStyles:V,textContainerWrapperOverrideStyles:z,textContainerOverrideStyles:U,actionsRowOverrideStyles:H,leftGutterOverrideStyles:K,rightGutterOverrideStyles:$,onClickInputBox:Y,onTextChange:Q,environment:J,isYassified:ae,showResearchModeButton:re,researchModeButtonState:le,onClickResearchModeButton:ce,restoreLastHumanStepOnScopeChange:de=!1,hasAssistantOutput:ue}=e,pe=(0,a.useRef)(null);(0,te().GI)(pe,l);const me=(0,q().q)(),he=Boolean(f),fe=(0,u().K8)((()=>G().zD.isNewWriterInputDesignEnabled(n)),[n]),ye=(0,i().L)(),ve=(0,p().eP)(),Se=(0,p().IS)((()=>{const e=r().A.isMobile?32:22,t=r().A.isMobile?{paddingTop:2,paddingInlineEnd:6,paddingBottom:2,paddingInlineStart:12}:{paddingTop:4,paddingInlineEnd:8,paddingBottom:4,paddingInlineStart:12};return{inputContainer:{flex:1,display:"flex",maxWidth:"100%",flexDirection:h?"column":"row",flexWrap:"wrap",boxShadow:x().Tj.inputBoxShadow,minHeight:me.inputHeight,backgroundColor:"dark"===ve?x().Tj.palette.translucentGray[100]:"transparent",borderRadius:r().A.isMobile?20:18,overflow:"inherit",...t,...O},inputRow:{minHeight:e,paddingTop:r().A.isMobile?4:void 0,paddingBottom:r().A.isMobile?4:void 0,paddingInlineEnd:t.paddingInlineStart-t.paddingInlineEnd,transform:!h&&he?"translateX(-6px)":void 0,flexWrap:"wrap",flexGrow:99999,display:"flex",alignItems:"center"},actionsRow:{minHeight:e,display:"flex",justifyContent:"space-between",alignItems:"center",maxWidth:"100%",flexGrow:1,paddingTop:2,paddingBottom:2,...H},wrap:{flex:1,display:"flex",gap:4,alignItems:"center",fontSize:r().A.isMobile?15:14,flexWrap:h?"wrap":void 0,...Y?{cursor:"pointer"}:{},...z},textContainer:{flexGrow:1,alignSelf:he?void 0:"flex-end",maxHeight:240,overflow:"auto",flexBasis:h?"100%":void 0,...U},placeholder:{opacity:w?.5:1,cursor:"text",...V},leftGutter:{display:"flex",flexDirection:"row",...K},rightGutter:{height:"100%",display:"flex",alignItems:"center",gap:r().A.isMobile?8:2,alignSelf:"flex-end",marginInlineEnd:-2,...$},rightGutterAdditionalItems:{display:"flex",alignItems:"center",gap:r().A.isMobile?8:0,marginInlineEnd:fe?4:void 0},typeaheadSkillWrapper:{display:"flex",justifyContent:"center",transform:h?"translateX(-6px)":void 0},attachmentStagingContainer:{paddingTop:4,paddingBottom:4,width:"100%",transform:!h&&he?void 0:"translateX(-6px)"}}}),[he,me.inputHeight,h,Y,O,U,z,w,V,H,K,$,fe,ve]),{spaceId:be,userId:xe}=(0,u().K8)((()=>{var e,t;return{spaceId:null===(e=(0,o().S)())||void 0===e?void 0:e.id,userId:null===(t=s().default.state.currentUserStore)||void 0===t?void 0:t.id}}),[]),Ie=(0,R().P)({name:"ai_usage",spaceId:be,userId:xe,amount:"unknown"}),ke=(0,ie.jsx)(ne().q,{onClick:e=>{e.preventDefault(),e.stopPropagation(),async function(){await _(),await c().default.afterNextFlush(),k().Gf({environment:J,mentionTypes:b,usePopupOnMobile:!0,mentionSectionOrdering:te().h2,spaceStore:ye}),W().assistantAnalyticsActions.trackAtMentionClick(J)}()}}),we=!y&&"active"!==le&&"deep_find_followup"!==t.type&&"research_mode"!==t.type&&"research_mode_inferencing"!==t.type&&(0,ie.jsx)(Z().so,{useVerboseTitle:ae,showIcons:ae,restoreLastHumanStep:de}),Ce=!L&&"active"!==le&&"deep_find_followup"!==t.type&&"research_mode"!==t.type&&"research_mode_inferencing"!==t.type&&(0,ie.jsxs)("div",{style:Se.rightGutterAdditionalItems,children:[D.canUpload?(0,ie.jsx)(X().v,{}):void 0,ke]}),Ae=ae&&!re,Te=!re,je=re&&le&&ce&&Ie&&(0,ie.jsx)(ge,{buttonState:le,onClick:ce});return(0,ie.jsxs)("div",{ref:pe,style:Se.inputContainer,...r().A.isMobile||n.isWriter?{}:{className:m().CCX},children:[(0,ie.jsx)(ee().bX,{containerStyle:Se.attachmentStagingContainer}),(0,ie.jsx)("div",{style:Se.inputRow,children:(0,ie.jsxs)("div",{style:Se.wrap,onClick:e=>{if(e.target===e.currentTarget){const t=P().n.findEditableWithStore(l);t&&t.handleClick(e)}},children:["select_parameters"===t.type||"select_parameters_freeform"===t.type||"input_parameter"===t.type?(0,ie.jsx)("div",{style:Se.typeaheadSkillWrapper,children:f}):void 0,(0,ie.jsx)(C().A,{onPasteFiles:F,style:Se.textContainer,onBlur:g,onEsc:T,placeholder:I,disabled:!1,onTab:()=>!0,onClick:void 0,store:l,placeholderStyle:Se.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEnter:w,onEnter:A,disableMobileActionBar:!0,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!0,onFocus:d,onChange:Q,disableMentions:L,disabledMentionTypes:S,disableSuggestEdit:!0,inPageFind:M().Os.none,usePopupForMentionOnMobile:!0,mentionSectionOrdering:te().h2,disableUpDownArrows:!h&&w,disableTryCloseSidePeek:!0})]})}),"deep_find"===t.type?null:(0,ie.jsxs)("div",{style:Se.actionsRow,children:[(0,ie.jsxs)("div",{style:Se.leftGutter,children:[je,Te?we:void 0,Ae?Ce:void 0]}),(0,ie.jsxs)("div",{style:Se.rightGutter,children:[B&&!v&&ue&&"deep_find_followup"!==t.type?(0,ie.jsx)(se,{sessionId:E,inferenceId:B}):void 0,Te?void 0:we,Ae?void 0:Ce,(0,ie.jsx)(oe().I,{storeIsEmpty:N,handleClickEnter:A,handleClickStop:j,mode:t,disableSubmit:w,isLarge:ae})]})]})]})}const he=(0,b().YK)({multiple_uploads:{id:"AssistantRichTextInput.multipleUploads",defaultMessage:"Only {maxAttachments} {maxAttachments, plural, =0 {attachments} one {attachment} other {attachments}} can be uploaded at a time"},not_authorized:{id:"AssistantRichTextInput.notAuthorized",defaultMessage:"Attachment uploads to the assistant are currently not supported"},invalid_surface:{id:"AssistantRichTextInput.invalidSurface",defaultMessage:"Attachment uploads are not supported in this context"}});function fe(e){const{store:t,onSubmit:n,onFocus:i,onBlur:s,onBackspaceOnEmptyInput:o,onSpaceOnEmptyInput:p,onActivateSkill:m,onTextChange:x,containerDivOverrideStyles:k,inputContainerOverrideStyles:C,inputPlaceholderOverrideStyles:M,textContainerWrapperOverrideStyles:P,textContainerOverrideStyles:R,actionsRowOverrideStyles:q,leftGutterOverrideStyles:Z,rightGutterOverrideStyles:ee,onEsc:ne,typeaheadSkillElement:ae,onClickInputBox:se,requestedSkill:oe,onSkillClear:le,sessionId:ce,isDeepFindFollowupInput:de,isMultilineOverride:ue,isYassified:pe,showResearchModeButton:ge,researchModeButtonState:fe,onClickResearchModeButton:ye,maybeRestoreLastHumanStepOnScopeChange:ve=!1}=e,Se=(0,d().v3)(),be=(0,b().tz)(),xe=(0,a.useRef)(null),Ie=(0,A().jw)(),ke=(0,u().K8)((()=>ce?Y().default.getSessionContext(ce):(0,Q().x3)().at(0)),[ce]),we=(0,u().K8)((()=>((null==ke?void 0:ke.assistantConfigurationStoreState)&&(0,T().pV)({configurationState:ke.assistantConfigurationStoreState,assistantSurface:Ie}))??!1),[Ie,ke]),Ce=(0,u().K8)((()=>t.getValue()),[t]),Ae=(0,a.useMemo)((()=>!Ce||0===(0,v().AhH)(Ce)),[Ce]),Te=(0,a.useMemo)((()=>v().q4_(Ce)),[Ce]),je=(0,te().Kk)({assistantChatRenderState:e.assistantChatRenderState,requestedSkill:oe,isSampling:e.isSampling,emptyStateResultsIsEmpty:e.emptyStateResultsIsEmpty,isDeepFindActive:we,isDeepFindFollowupInput:de??!1}),Me=Ie.isType("fullPage"),_e=(0,u().K8)((()=>G().zD.isXMLAssistantEnabled()),[]),Pe=(0,K().T)(ke),De=(0,u().K8)((()=>(null==ke?void 0:ke.getHasCommittedHumanStep())??!1),[ke]),Ee=(0,I().O9)(ue)?ue:Te.includes("\n"),Re=(0,a.useMemo)((()=>{if("default"===je.type||"inferencing"===je.type||"input_parameter"===je.type||"deep_find"===je.type)return be.formatMessage(te().ef.default);if("research_mode"===je.type||"research_mode_inferencing"===je.type)return be.formatMessage(te().ef.research_mode);if("deep_find_followup"===je.type)return be.formatMessage(te().ef.deep_find_followup);if("empty_state"===je.type)return be.formatMessage(te().ef.empty_state);if("select_parameters"===je.type||"select_parameters_freeform"===je.type){if(oe&&(0,y().Gt)(oe.skillType)){const e=(0,y().Bf)(oe.skillType).parameterDefinition.placeholder;return e?be.formatMessage(e):be.formatMessage(te().ef.default)}}else(0,I().HB)(je.type)}),[be,je.type,oe]),{writerFeedbackInferenceId:Be,writerSessionId:Fe,hasAssistantOutput:Ne}=(0,u().K8)((()=>{if(Ie!==A().wy.writer)return{};const e=(0,Q().K1)();if(0===(null==e?void 0:e.clientStepsFromStoreState.length))return{};const t=(null==e?void 0:e.getCombinedStepsWithAssistantOutput().length)??0;return{writerFeedbackInferenceId:null==e?void 0:e.latestCommitInferenceIdFromStoreState,writerSessionId:null==e?void 0:e.sessionIdFromStoreState,hasAssistantOutput:t>0}}),[Ie]),Le=(0,J().W)({sessionContext:ke,mode:je}),Oe=(0,u().K8)((()=>{var e;return!!ke&&((null===(e=ke.getStagedAttachmentUploadStoreIfExists())||void 0===e?void 0:e.isUploadInProgress())??!1)}),[ke]),Ve="default"!==je.type&&"deep_find"!==je.type&&"deep_find_followup"!==je.type&&"select_parameters_freeform"!==je.type&&"input_parameter"!==je.type&&"research_mode"!==je.type||Oe;(0,te().XF)(t);const ze=a.useCallback((async()=>{let e;e=Ie.isWriter?await(0,w().maybeNewAssistantWriterChat)({environment:Se,assistantSurface:Ie}):await(0,V().maybeCreateNewChat)({environment:Se,assistantSurface:Ie}),e&&(null==le||le())}),[Ie,Se,le]),We=(0,a.useCallback)((async e=>{await(0,l().s7)(e,l().y$.ButtonMouseDown,(async()=>{if(!ke)return;const e=(0,te().z$)({environment:Se,sessionContext:ke,store:t,assistantSurface:Ie});if(e&&e.sessionEnded)try{await ze(),(0,z().setPrimeTextInput)(e.lastHumanStepText)}catch(n){}}))}),[ke,Se,t,Ie,ze]),Ue=(0,a.useCallback)((()=>{Ae||!Ce||Oe||("select_parameters_freeform"===je.type&&oe&&(0,H().clientSkillHasFreeformFillableParameter)(oe)?null==m||m({clientSkill:oe,parameterValues:(0,y().b6)(oe.skillType,Ce)}):n&&(n({newValue:Ce}),"deep_find"!==je.type&&N().createAndCommit({userAction:"AssistantRichTextInput.valueChanged",environment:Se,canUndo:!0,perform:e=>{B().R9({environment:Se,store:t,value:void 0,transaction:e})}})))}),[Ae,Ce,Oe,je.type,oe,n,m,Se,t]),He=(0,a.useCallback)((()=>{ne?ne():((0,O().trackAssistantClosed)(Se,{from:Ie.isQuickSearchMode?"command_search_switching_panes":"search_switching_panes",sessionContext:ke}),Ie.isQuickSearchMode?(0,j().f)(!1):Ie.isType("searchPane")&&(E().Ay.switchToSearchPane(),D()._N({environment:Se,analyticsFrom:"search_switching_panes"})),Me||W().assistantMenuActions.closeAssistantRightHandSideMenu({environment:Se,assistantInputTextStore:t}))}),[ne,Se,Ie,ke,Me,t]),Ke=(0,_().J)({storeValue:Ce,onBackspaceOnEmptyInput:o,onSpaceOnEmptyInput:p,onTextChangeHook:x,additionalCallback:()=>{L().dismissTutorial(Se,"enhanced-qna-onboarding")}}),qe=(0,a.useCallback)((async()=>{const e=f().default.state;"editing"===e.mode&&(0,h().K)(e.multiSelection)&&e.multiSelection.start.store===t||((0,F().z)({store:t}),await c().default.afterNextFlush())}),[t]),$e=(0,u().K8)((()=>{var e;const t=null===(e=(0,U().fM)(Se))||void 0===e?void 0:e.id;return(0,S().o9)(t)}),[Se]),Ge=(0,X().U)({currentSpaceId:$e}),Ye=(0,$().yB)(),Qe=(0,a.useCallback)((e=>{0!==e.files.length&&(Le.canUpload?e.files.length>Ye?g().D6({label:be.formatMessage(he.multiple_uploads,{maxAttachments:Ye})}):Ge({files:e.files,method:"paste"}):g().D6({label:be.formatMessage(he[Le.reason],{maxAttachments:Ye})}))}),[Le,be,Ge,Ye]),Je="select_parameters"===je.type||"select_parameters_freeform"===je.type||"deep_find_followup"===je.type,Xe=!r().A.isMobile,Ze={mode:je,assistantSurface:Ie,store:t,onFocus:i,onBlur:s,isMultiline:Ee,typeaheadSkillElement:ae,requestedSkill:oe,assistantLoadingState:Pe,disabledMentionTypes:te().md,permittedMentionTypes:te().Ap,placeholder:Re,disableEnter:Ve,handleEnter:Ue,handleEsc:He,handleClickStop:We,setSelectionAtEndIfNotEditing:qe,canSupportAdditionalAttachmentUpload:Le,writerSessionId:Fe,writerFeedbackInferenceId:Be,onPasteFiles:Qe,storeIsEmpty:Ae,disableMentions:Je,inputContainerOverrideStyles:C,inputPlaceholderOverrideStyles:M,textContainerOverrideStyles:R,textContainerWrapperOverrideStyles:P,actionsRowOverrideStyles:q,leftGutterOverrideStyles:Z,rightGutterOverrideStyles:ee,onClickInputBox:se,onTextChange:Ke,environment:Se,isYassified:pe,showResearchModeButton:ge,researchModeButtonState:fe,onClickResearchModeButton:ye,restoreLastHumanStepOnScopeChange:ve&&Ae,hasAssistantOutput:Ne};return(0,ie.jsxs)("div",{style:{display:"flex",flex:1,gap:10,maxWidth:"100%",alignItems:"start",height:"100%",...k},ref:xe,children:["deep_find"===je.type||"deep_find_followup"===je.type||pe?void 0:(0,ie.jsx)(re().p,{isMultiline:Ee,showEnterTransition:!0,tooltipOnHover:Xe?!_e||De||Ie.isWriter?(0,ie.jsx)(b().sA,{id:"assistantRichTextInput.assistantLeftFace.tooltipOnHoverQnAOrAfterHumanStep",defaultMessage:"New AI chat"}):(0,ie.jsx)(b().sA,{id:"assistantRichTextInput.assistantLeftFace.tooltipOnHoverAssistant",defaultMessage:"See all actions"}):void 0,onClick:Xe?ze:void 0,onMouseDown:e=>e.preventDefault()}),(0,ie.jsx)(me,{...Ze})]})}},133532:(e,t,n)=>{n.d(t,{X:()=>m});var a=n(296540),i=()=>n(401497),s=()=>n(265060),o=()=>n(939768),r=()=>n(187859),l=()=>n(767079),c=()=>n(638124);const d=[{hostname:"mcp.asana.com",iconGroup:n(756374).X},{hostname:"mcp.atlassian.com",iconGroup:n(762118).z},{hostname:"mcp.box.com",iconGroup:n(256385).g},{hostname:"mcp.figma.com",basePath:"/mcp",iconGroup:n(850112).j},{hostname:"api.githubcopilot.com",basePath:"/mcp",iconGroup:n(941115).A},{hostname:"bigquery.googleapis.com",iconGroup:r().m},{hostname:"compute.googleapis.com",iconGroup:r().m},{hostname:"container.googleapis.com",iconGroup:r().m},{hostname:"mapstools.googleapis.com",iconGroup:n(28591).s},{hostname:"app.hex.tech",basePath:"/mcp",iconGroup:n(382733).k},{hostname:"app.hubspot.com",basePath:"/mcp",iconGroup:n(482747).Q},{hostname:"mcp.intercom.com",basePath:"/mcp",iconGroup:l().e},{hostname:"mcp.intercom.com",basePath:"/sse",iconGroup:l().e},{hostname:"mcp.jira.com",iconGroup:n(856988).N},{hostname:"mcp.linear.app",iconGroup:n(658861).u},{hostname:"mcp.monday.com",iconGroup:n(654184).h},{hostname:"mcp.ramp.com",iconGroup:c().V},{hostname:"ramp-mcp-remote.ramp.com",iconGroup:c().V},{hostname:"mcp.stripe.com",iconGroup:n(736541).q},{hostname:"mcp.zapier.com",iconGroup:n(704121).M}];var u=()=>n(802963),p=()=>n(738471),g=n(474848);function m(e){const{iconUrl:t,serverUrl:n,serverName:r,size:l}=e,{hasError:c,isLoading:m}=function(e,t={}){const{trackLoading:n=!1}=t,[i,s]=(0,a.useState)(!1),[o,r]=(0,a.useState)(n&&Boolean(e));return(0,a.useEffect)((()=>{if(s(!1),!e)return void r(!1);n&&r(!0);const t=new Image;return t.src=e,t.onload=()=>{n&&r(!1),s(!1)},t.onerror=()=>{n&&r(!1),s(!0)},()=>{t.onload=null,t.onerror=null}}),[e,n]),{hasError:i,isLoading:o}}(t,{trackLoading:!0}),h=a.useMemo((()=>function(e){if(!e)return;const t=(0,o().bk)(e);if(!t)return;const n=t.hostname.toLowerCase(),a=t.pathname.toLowerCase();for(const i of d){if(n!==i.hostname)continue;const e=i.basePath??"/";if("/"===e)return i.iconGroup;if(a===e||a.startsWith(e+"/"))return i.iconGroup}}(n)),[n]),f=function(e){return(0,i().IS)((()=>({iconWrapper:{width:e,height:e,borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center"},iconImage:{width:e,height:e,objectFit:"contain",borderRadius:4}})),[e])}(l);return h?(0,g.jsx)("div",{style:f.iconWrapper,children:(0,g.jsx)(s().Q,{iconGroup:h,variantName:"default",overrideSize:()=>l})}):!t||c||m?(0,g.jsx)(u().A,{size:l,title:r,isLarge:!0}):(0,g.jsx)("div",{style:f.iconWrapper,children:(0,g.jsx)(p().A,{src:t,alt:"MCP server icon",style:f.iconImage})})}},134589:(e,t,n)=>{n.d(t,{R:()=>s});n(296540);var a=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"3.37 1.43 13.25 15.44",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M9.325 10.466V2.063a.625.625 0 1 1 1.25 0v8.453l1.458-1.458a.625.625 0 1 1 .884.884l-2.5 2.5a.625.625 0 0 1-.884 0l-2.5-2.5a.625.625 0 1 1 .884-.884z"}),(0,a.jsx)("path",{d:"M11.825 6.375H14.5c.483 0 .875.392.875.875v7.5a.875.875 0 0 1-.875.875h-9a.875.875 0 0 1-.875-.875v-7.5c0-.483.392-.875.875-.875h2.575v-1.25H5.5A2.125 2.125 0 0 0 3.375 7.25v7.5c0 1.174.951 2.125 2.125 2.125h9a2.125 2.125 0 0 0 2.125-2.125v-7.5A2.125 2.125 0 0 0 14.5 5.125h-2.675z"})]})},s=(0,n(340498).wt)("squareAndArrowDown",i,"default")},143016:(e,t,n)=>{n.d(t,{D:()=>a});class a extends(()=>n(757695))().Store{getInitialState(){}}},144391:(e,t,n)=>{n.d(t,{au:()=>r,bs:()=>i});var a=()=>n(221844);const i="AssistantCaches",s=`${i}.updatesCache`,o=`${i}.diffCache`;class r{constructor(){this.updatesCache=void 0,this.diffCache=void 0,this.updatesCache=new(a().A)({name:s,isTemporaryData:!0}),this.diffCache=new(a().A)({name:o,isTemporaryData:!0})}getDiffCacheOnlyForTests(){return this.diffCache}ensureDefaultCacheOverride(e){const t=e.defaultRecordCache.inMemoryRecordCache;this.updatesCache.hasCacheFallback(t)||this.updatesCache.addCacheFallback(t),t.hasCacheOverride(this.diffCache)||t.addCacheOverride(this.diffCache)}removeDefaultCacheOverride(e){this.clear();const t=e.defaultRecordCache.inMemoryRecordCache;t.removeCacheOverride(this.diffCache),this.updatesCache.removeCacheFallback(t)}clear(){this.updatesCache.clearCache(),this.diffCache.clearCache()}commitTransaction(e){const{transactionActions:t,environment:n,perform:a,...i}=e,s=this;t.createAndCommit({environment:n,perform(e){a(e,s.updatesCache,!0),a(e,s.diffCache,!1)},...i})}commitDiffPreviewTransaction(e){const{transactionActions:t,environment:n,perform:a,...i}=e,{diffCache:s}=this;t.createAndCommit({environment:n,perform(e){a(e,s,!1)},...i})}makeGetRecordValueFnFromUpdatesCache(e){return this.updatesCache.makeGetRecordValueFn(e)}makeGetRecordValueFnFromDiffCache(e){return this.diffCache.makeGetRecordValueFn(e)}}},147796:(e,t,n)=>{n.d(t,{ng:()=>c,qO:()=>d});var a=n(296540),i=()=>n(484714),s=()=>n(354785),o=n(474848);const r=100,l=(0,a.createContext)({threadId:void 0,trackResearchModeStepExpanded:void 0,trackResearchModeStepCollapsed:void 0,trackResearchModeReportFirstCharRendered:void 0,trackResearchModeReportLastCharRendered:void 0,trackResearchModeReportCopied:void 0,trackResearchModeReportSavedToPage:void 0});function c({children:e,threadId:t}){const n=(0,i().v3)(),c=(0,a.useRef)(0),d=(0,a.useCallback)((()=>{c.current++<r&&s().Rk({environment:n,researchModeThreadId:t})}),[t,n]),u=(0,a.useCallback)((()=>{c.current++<r&&s().hK({environment:n,researchModeThreadId:t})}),[t,n]),p=(0,a.useCallback)((()=>{c.current++<r&&s().nM({environment:n,researchModeThreadId:t})}),[t,n]),g=(0,a.useCallback)((()=>{c.current++<r&&s().zJ({environment:n,researchModeThreadId:t})}),[t,n]),m=(0,a.useCallback)((()=>{c.current++<r&&s().q0({environment:n,researchModeThreadId:t})}),[t,n]),h=(0,a.useCallback)((()=>{c.current++<r&&s().tK({environment:n,researchModeThreadId:t})}),[t,n]),f=(0,a.useMemo)((()=>({threadId:t,trackResearchModeStepExpanded:d,trackResearchModeStepCollapsed:u,trackResearchModeReportFirstCharRendered:p,trackResearchModeReportLastCharRendered:g,trackResearchModeReportCopied:m,trackResearchModeReportSavedToPage:h})),[t,d,u,p,g,m,h]);return(0,o.jsx)(l.Provider,{value:f,children:e})}function d(){return(0,a.useContext)(l)}l.displayName="ResearchModeChatAnalyticsContext"},150984:(e,t,n)=>{n.r(t),n.d(t,{deleteAssistantChatSession:()=>le,fireAndForgetUpsertStepToChatSessionHistory:()=>ne,generateBlockStoresForClientChatStep:()=>ie,getTemporaryListStoreForClientChatStep:()=>oe,handleActivateNewSkill:()=>ue,handleSubmitNewQuestion:()=>de,loadChatHistoryForUserSpace:()=>fe,maybeCreateNewChat:()=>ge,performSecondarySidebarAction:()=>pe,preloadChatHistory:()=>he,prepareAssistantChatOpen:()=>me,submitVectorDbWarmUpQuery:()=>ce,upsertStepToChatSessionHistory:()=>ae,useTemporaryListStoreForClientChatStep:()=>se,wrapBlocksInTemporaryPage:()=>re});n(16280),n(898992),n(803949),n(581454),n(737550);var a=n(296540),i=()=>n(907258),s=()=>n(755531),o=()=>n(242422),r=()=>n(17022),l=()=>n(770063),c=()=>n(374580),d=()=>n(295633),u=()=>n(691309),p=()=>n(925193),g=()=>n(404931),m=()=>n(416504),h=()=>n(206267),f=()=>n(134025),y=()=>n(388821),v=()=>n(427704),S=()=>n(363497),b=()=>n(179034),x=()=>n(96689),I=()=>n(798880),k=()=>n(201980),w=()=>n(439180),C=()=>n(973647),A=()=>n(534177),T=()=>n(769864),j=()=>n(910302),M=()=>n(44729),_=()=>n(384944),P=()=>n(576590),D=()=>n(108184),E=()=>n(631611),R=()=>n(486674),B=()=>n(246766),F=()=>n(770906),N=()=>n(441199),L=()=>n(547149),O=()=>n(977270),V=()=>n(680325),z=()=>n(996477),W=()=>n(945710),U=()=>n(44971),H=()=>n(483730),K=()=>n(295173),q=()=>n(234637),$=()=>n(383706),G=()=>n(995277),Y=()=>n(685453),Q=()=>n(657133),J=()=>n(26080),X=()=>n(501305),Z=()=>n(371621),ee=()=>n(154373),te=()=>n(156008);function ne(e){ae(e)}async function ae(e){var t;const{sessionId:n,forceOverrideSessionContext:a,environment:s,assistantSurfaceType:o}=e;let r;if(a)r=a;else{const e=H().default.getActiveSession();if(!e)return;r=e}const l=null===(t=r)||void 0===t?void 0:t.getCombinedSteps().some((e=>"assistantStartResearchMode"===e.type));if(r.assistantConfigurationStoreState.deepFindRequested&&!l)return;const{sidebarSpaceStore:d,sidebarSpaceViewStore:u,currentUserRootStore:p,currentUserStore:g}=i().default.state;if(!(d&&p&&u&&g))return;if(!(0,E().Ui)(o)){const e=c().g.createChildStore(u,{id:n,table:S().TF,spaceId:d.id}),t=(0,J().TY)({environment:s,previousChatTranscriptStorageStepPointer:e.getChatStepId(),sessionId:n});await T().callApi({eventName:"saveAssistantChatHistory",environment:s,data:{sessionId:n,spaceId:d.id,storageStep:t}})}U().A.maybeAddKnownSession(d.id,n)&&L().createAndCommit({environment:s,userAction:"assistant.createRecent",canUndo:!0,perform:e=>{(0,ee().Wq)({environment:s,transaction:e,currentUserStore:g,currentSpaceViewStore:u,fromAssistantSurface:o,assistantSessionContext:r})}})}function ie(e){const{environment:t,clientStep:n,transaction:a,inMemoryRecordCache:i,isPreviewing:s}=e,o=new Map,r=i===t.defaultRecordCache.inMemoryRecordCache;r||i.addCacheFallback(t.defaultRecordCache.inMemoryRecordCache);const c=(0,$()._)(t),p=(0,z().fM)(t);if(!c)throw new Error("No current user.");if(!p)throw new Error("No space store.");const g={table:I().oo,id:c},h=L().createAndCommitOrAppend({userAction:"AssistantChatMessageRenderer.temporaryListStore",environment:t,transaction:a,perform:a=>{const h=e.stripCitations?{type:"stripCitations"}:{type:"createCitations",getPageLevelCitationId:t=>(0,V().yE)({hrefOrBlockId:t,evaluatorState:e.evaluatorState,parentStore:p})};for(const e of n.operations){const n=(0,u().Vz)({assistantOperation:e,actorPointer:g,getRecordValue:i.makeGetRecordValueFn(c),spaceId:p.id,spaceViewId:void 0,citationHandling:h,currentTimeZone:(0,m().P)()});if(C().Q.isFail(n)){console.error(n.error);break}const{operations:y,replacedBlockIdMap:v}=(0,u().g$)(n.value,(0,Z().BB)({shouldCreateUnknownBlock:!s}),!0);v.forEach(((e,t)=>{o.set(t,e)}));for(const e of y){let n;if((0,w().ph)(e)){const s=new(d().B)(t,e.pointer,{inMemoryRecordCache:i});n=s,L().applyCrdtTextOperation({store:s,operation:e,invertedOperation:void 0,transaction:a})}else if((0,f().$Y)(e)||(0,f().mP)(e))switch(e.pointer.table){case b().ev:{const s=new(d().B)(t,e.pointer,{inMemoryRecordCache:i});n=s,L().applyOperation({store:s,operation:e,transaction:a});break}default:{const n=new(l().pm)({environment:t,pointer:e.pointer,path:e.path,recordStoreOptions:{inMemoryRecordCache:i}});L().applyOperation({store:n,operation:e,transaction:a})}}else(0,A().HB)(e);n&&!r&&i.setModelAndRole({pointer:n.pointer,userId:c},n.getModel(),"reader")}}return n.blockIds.map((e=>o.get(e)??e)).map((e=>new(d().B)(t,{table:b().ev,id:e,spaceId:p.id},{inMemoryRecordCache:i})))},canUndo:!1});return h}function se(e){const{environment:t,clientStep:n,inMemoryRecordCache:i,listId:s,...o}=e;return(0,a.useMemo)((()=>r().e.withListenerIgnored((()=>oe({environment:t,clientStep:n,inMemoryRecordCache:i,listId:s,...o})))),[t,n,i,s,o])}function oe(e){const{environment:t,clientStep:n,inMemoryRecordCache:a,listId:i,...s}=e;return a.clearCache(),L().createAndCommit({userAction:"AssistantChatMessageRenderer.temporaryListStoreForClientChatStep",environment:t,canUndo:!1,perform:e=>{const r=ie({environment:t,clientStep:n,transaction:e,inMemoryRecordCache:a,...s,isPreviewing:!0});if(o().default.checkGate({gateName:"assistant_should_use_fake_page_to_render_blocks"})){return re({environment:t,stores:r,transaction:e,inMemoryRecordCache:a}).getKeyStore("content")}return(0,D().wrapTemporaryBlocksInList)({environment:t,stores:r,inMemoryRecordCache:a,listId:i,transaction:e})}}).performResult}function re(e){const{environment:t,stores:n,transaction:a,inMemoryRecordCache:i}=e;if(!i.isTemporaryData&&!i.isSyntheticAssistantData)throw new Error("inMemoryRecordCache must be temporary.");const s=(0,$()._)(t),o=(0,z().fM)(t);if(!o)throw new Error("No space store.");const r=_().Wv({environment:t,type:"page",inMemoryRecordCache:i,transaction:a});_().zv({store:r,data:{parent_id:o.id,parent_table:x().NX,alive:!0},transaction:a}),i.setModelAndRole({pointer:r.pointer,userId:s},r.getModel(),"reader");for(const l of n)void 0===l.getParentPointer()&&M().NI({childStore:l,parentStore:r,transaction:a});return r}function le(e){const{sessionId:t,environment:n}=e,a=(0,z().fM)(n);if(!a)return;const i=c().g.createChildStore(a,{id:t,table:S().TF,spaceId:a.id});L().createAndCommit({userAction:"assistantChatHistorySession.deleteAssistantChatSession",environment:n,canUndo:!0,perform:e=>{_().zv({store:i,data:{alive:!1},transaction:e})}}),U().A.removeSession(a.id,t),t===H().default.getActiveSessionId()&&H().default.endCurrentSession()}async function ce(e){const{environment:t}=e,{sidebarSpaceStore:n}=i().default.state;n&&await T().callCellCompatibleApi({eventName:"warmVectorDBCache",environment:t,data:{spaceId:n.id},cellNavigation:{spaceId:n.id}})}async function de(e){const{snapToBottom:t,newValue:n,currentClientSkillWithSettings:a,environment:i,shouldForceStartNewSession:s,source:o,assistantSurfaceType:r,scopeOverride:l,actionCardIdForLogging:c}=e;if(!n)return;const d=(0,k().bBR)(n);null==t||t();let u=H().default.getActiveSessionId();if(!u||s){u=(await(0,G().p)({environment:i,clientSkillWithParameterValues:a,actionCardIdForLogging:c})).sessionId}if(l){const e=H().default.getSessionContext(u);null==e||e.assistantConfigurationStore.setSearchScope(l)}(0,q().b)({environment:i,text:d,sessionId:u,source:o,assistantSurfaceType:r,clientSkillWithParameterValues:a}),(0,Q().Z)({environment:i})}async function ue(e){const{environment:t,clientSkillWithParameterValues:n,assistantSurface:a,shouldOpenAfterStart:i,snapToBottom:s}=e;if((0,W().clientSkillWithParameterValuesIsType)(n,"translate_page")){const e=(0,R().a)();if(!e)return;return j().Z9({pageStore:e,environment:t}),j().Ww({pageStore:e,targetLanguage:n.parameterValues.language,sourceLanguage:j().WO(e,t,O().AssistantFeatureGateStore.isFullPageTranslateEnabled()),environment:t,triggeredFrom:"action_menu"}),void O().assistantMenuStore.setState({...O().assistantMenuStore.state,open:!1})}null==s||s(),(0,Q().Z)({environment:t});const{sessionId:o}=await(0,G().p)({environment:t,clientSkillWithParameterValues:n,makeActiveSession:!0});i&&(t.device.isMobileNative?(0,B().navigate)({environment:t,url:`${v().GJ.nativeTab}/assistant`}):(0,K().openNewAgentSidebarFromMainBlock)({environment:t}));const r=H().default.getSessionContext(o),l=(0,W().getSearchScopeForSkill)({skill:n});l&&(null==r||r.assistantConfigurationStore.setSearchScope(l));if(!(0,g().dc)(n.clientSkill.skillType).requiresInput){const e=h().JW(),i=(0,z().fM)(t);if(!r||!i)return;await(0,Y().H)({environment:t,sessionId:o,inferenceId:e,assistantSurfaceType:a.type,inferenceStartMetadata:{source:"skill",skillType:n.clientSkill.skillType,mentionsUsed:void 0},inferenceEndMetadata:{parentStore:i,skillType:n.clientSkill.skillType,wasSkillSuggested:n.clientSkill.isSuggested}}),ne({sessionId:o,environment:t,assistantSurfaceType:a.type})}}function pe(e){const{environment:t,action:n}=e;n(),"peek"===N().default.state.mode&&(0,F().VI)({environment:t})}async function ge(e){const{environment:t,assistantSurface:n}=e,a=H().default.getActiveSession();let i=!0;return((null==a?void 0:a.hasPendingOperations())??!1)&&(i=await(0,X().confirmAndDiscardPendingEditsIfApplicable)({environment:t,assistantSurface:n})),!!i&&((0,te().Dd)({environment:t,source:n.type}),!0)}function me(e){const{environment:t,userAction:n,shouldPreloadChatHistory:a,onPreloadChatHistoryCallback:s}=e,{currentUserSettingsStore:o}=i().default.state;o&&(0,P().setQnaOnboardingPhase)(t,{phase:"complete",transactionUserAction:n,userSettingsStore:o}),ce({environment:t,assistantSurfaceType:"corner"}),a&&(he({environment:t}),null==s||s()),O().assistantOriginElementStore.setState({...O().assistantOriginElementStore.state,currentState:"default"})}async function he(e){var t;if(U().A.state.initialFetchComplete||U().A.state.isFetching)return;const{environment:n}=e,a=null===(t=(0,s().S)())||void 0===t?void 0:t.id;a&&await fe({environment:n,spaceId:a})}async function fe(e){try{const{environment:t,spaceId:n}=e;if(!n)return;if(U().A.state.isFetching)return;U().A.update((e=>({...e,isFetching:!0})));const a=await T().callApi({eventName:"getChatTranscriptSessionHistoryForUser",environment:t,data:{spaceId:n}});if("success"!==a.type)return;const i=Date.now(),s=a.data.chatSessionIds.map((e=>(0,p().pg)(e))),o=y().RecordMapWithRole.create(a.data.recordMap);U().A.setSessionInfos(n,s.map((e=>{var t;return{id:e,createdTime:(null===(t=o.getModel({id:e,table:S().TF}))||void 0===t?void 0:t.created_time)??i}}))),U().A.state.initialFetchComplete?U().A.update((e=>({...e,isFetching:!1}))):U().A.update((e=>({...e,initialFetchComplete:!0,isFetching:!1})))}catch(t){U().A.update((e=>({...e,isFetching:!1})))}}},152870:(e,t,n)=>{n.d(t,{Bt:()=>_,RH:()=>j,fe:()=>T,vU:()=>M});n(898992),n(354520),n(581454);var a=n(296540),i=()=>n(300474),s=()=>n(907258),o=()=>n(484714),r=()=>n(590526),l=()=>n(401497),c=()=>n(902006),d=()=>n(69708),u=()=>n(100622),p=()=>n(676510),g=()=>n(534177),m=()=>n(284371),h=()=>n(96563),f=()=>n(576590),y=()=>n(187820),v=()=>n(528093),S=()=>n(377134),b=()=>n(604018),x=()=>n(780175),I=()=>n(371960),k=n(474848);const w=(0,d().YK)({aiConnectorsCard:{defaultMessage:"Get answers from connected apps",id:"AssistantFullPageWelcome.aiConnectorsCard"},googleDriveRelevantInsights:{defaultMessage:"Outline relevant insights or updates",id:"AssistantFullPageWelcome.googleDriveRelevantInsights"},googleDriveTeamPresentationThemes:{defaultMessage:"Common themes in team presentations",id:"AssistantFullPageWelcome.googleDriveTeamPresentationThemes"},googleDriveUsageSummary:{defaultMessage:"Summarize key usage in Google Drive",id:"AssistantFullPageWelcome.googleDriveUsageSummary"},slackTrendingTopics:{defaultMessage:"What topics are trending today?",id:"AssistantFullPageWelcome.slackTrendingTopicsToday"},slackWritingStylePersonality:{defaultMessage:"What does my writing style say about me?",id:"AssistantFullPageWelcome.slackWritingStyle"},slackSummarizeActivity:{defaultMessage:"Summarize activity from this week",id:"AssistantFullPageWelcome.slackSummarizeActivityThisWeek"},slackOverviewOutOfOffice:{defaultMessage:"Overview of what happened while I was OOO",id:"AssistantFullPageWelcome.slackOverviewOutOfOffice"},slackCollaboration:{defaultMessage:"Which teammates do I collaborate with the most?",id:"AssistantFullPageWelcome.slackCollaboration"},githubTriagedBugs:{defaultMessage:"Outline bugs that were recently triaged",id:"AssistantFullPageWelcome.githubTriagedBugs"},githubWaitingPRs:{defaultMessage:"Which PRs have been waiting for review",id:"AssistantFullPageWelcome.githubWaitingPRs"},githubHighPriorityBugs:{defaultMessage:"Show me all high-priority bugs in our repo",id:"AssistantFullPageWelcome.githubHighPriorityBugs"},githubEngineeringReport:{defaultMessage:"Generate an engineering report",id:"AssistantFullPageWelcome.githubEngineeringReport"},jiraTasksThisSprint:{defaultMessage:"What are my tasks this sprint?",id:"AssistantFullPageWelcome.jiraTasksThisSprint"},jiraTicketsBlocked:{defaultMessage:"Which tickets are blocked in this sprint?",id:"AssistantFullPageWelcome.jiraTicketsBlocked"},jiraHighPriorityBugs:{defaultMessage:"List high-priority bugs assigned to me",id:"AssistantFullPageWelcome.jiraHighPriorityBugs"},jiraCommonIssuesLastMonth:{defaultMessage:"Most common issues reported last month?",id:"AssistantFullPageWelcome.jiraCommonIssuesLastMonthUpdated"},jiraInProgressTickets:{defaultMessage:"Show all In progress tickets assigned to me",id:"AssistantFullPageWelcome.jiraInProgressTickets"},microsoftTeamsTrendingTopics:{defaultMessage:"What topics are trending today?",id:"AssistantFullPageWelcome.microsoftTeamsTrendingTopicsToday"}}),C={"google-drive":[w.googleDriveRelevantInsights,w.googleDriveTeamPresentationThemes,w.googleDriveUsageSummary],slack:[w.slackTrendingTopics,w.slackWritingStylePersonality,w.slackSummarizeActivity,w.slackOverviewOutOfOffice,w.slackCollaboration,w.slackTrendingTopics,w.slackSummarizeActivity,w.slackOverviewOutOfOffice,w.slackCollaboration],github:[w.githubEngineeringReport,w.githubHighPriorityBugs,w.githubTriagedBugs,w.githubWaitingPRs],jira:[w.jiraTasksThisSprint,w.jiraTicketsBlocked,w.jiraHighPriorityBugs,w.jiraCommonIssuesLastMonth,w.jiraInProgressTickets],"microsoft-teams":[w.microsoftTeamsTrendingTopics]};function A(e){return C[e]??[]}function T(e){const{launchMessage:t,isConnectorInfoLoading:n,bubbleStyles:s,analyticsFrom:l}=e,d=(0,o().v3)(),u=(0,x().wh)(),p=(0,r().K8)(b().wd,[]),m=p.length>0,y=e=>e[Math.floor(Math.random()*e.length)],[I,C]=(0,a.useState)(void 0);(0,a.useEffect)((()=>{if(n||(0,g().O9)(I))return;const e=p.filter((e=>A(e).length>0));if(0===e.length)return;const t=[y(e),y(e)];C(t.map((e=>({message:y(A(e)),connector:e}))))}),[n,I,C,p]),(0,a.useEffect)((()=>{const e=(0,c().SC)(u.type)?u.type:S().x[u.type];if(e){if("notion"===e||0===A(e).length)return;C([{connector:e,message:y(A(e))},{connector:e,message:y(A(e))}])}}),[C,u.type]);const T=(0,r().K8)((()=>1===(0,b().wd)().length&&1===(0,b().uM)().length),[]),M=(0,a.useCallback)((e=>(0,f().openConnectorInProgressModal)({environment:d,from:l,connector:e})),[d,l]),_=(0,i().r)(),P=(0,v()._)({name:"ai_connectors",spaceId:_,userId:d.currentUser.id}),D=(0,a.useCallback)((()=>{P&&(0,h().pp)({environment:d,connector:"generic",analyticsFrom:l,connectorsFeatureAvailability:P})}),[d,l,P]);return m&&I?{isConnected:!0,actionCards:I.map((({connector:e,message:n})=>({message:n,handleClick:T?()=>M(e):()=>t(n,{type:e}),iconSection:(0,k.jsx)(j,{icons:[e],...s})})))}:{isConnected:!1,actionCards:[{message:w.aiConnectorsCard,handleClick:D,iconSection:(0,k.jsx)(j,{icons:["slack","github","google-drive"],...s})}]}}function j(e){const{icons:t,plusNBubble:n,iconSize:a,bubbleSize:i,marginLeft:o}=e,c=function(e){const{bubbleSize:t,iconSize:n,marginLeft:a,noBubbles:i}=e,s=(0,l().eP)();return(0,l().IS)((()=>{const e={display:"flex",alignItems:"center",justifyContent:"center",width:t,height:t,overflow:"hidden",marginInlineStart:a,...i?{}:"light"===s?{borderRadius:"100%",boxShadow:u().Tj.shadowSM,backgroundColor:u().Tj.assistantCornerButtonBackground}:{borderRadius:"100%",boxShadow:u().Tj.shadowSM,fill:u().Tj.icon.tertiary}};return{container:{display:"flex",flexDirection:"row"},iconBubble:e,firstIconBubble:{...e,marginInlineStart:0},icon:{height:n,width:n},jiraIcon:{width:n,marginInlineStart:-4},plusNText:{fontSize:9,color:u().Tj.text.tertiary,fontWeight:m().Wy.medium}}}),[n,t,a,i,s])}({iconSize:a,bubbleSize:i,marginLeft:o,noBubbles:!(0,g().O9)(n)&&1===t.length}),d=(0,x().wh)(),{isCurrentPageScope:p,maybeCurrentPageIcon:h,isEmptyPage:f,iconRecordCategory:v}=(0,r().K8)((()=>{const e=s().default.state.mainEditorCurrentBlockStore,t=(0,y().Te)(e);if(!e)return{maybeCurrentPageIcon:void 0,isEmptyPage:void 0,iconRecordCategory:t};const n=e.getIcon();return"page"===d.type&&d.pageId===e.id?{isCurrentPageScope:!0,maybeCurrentPageIcon:n,isEmptyPage:e.isEmptyPage(),iconRecordCategory:t}:{isCurrentPageScope:!1,maybeCurrentPageIcon:void 0,isEmptyPage:void 0,iconRecordCategory:t}}),[d]);return(0,k.jsxs)("div",{style:c.container,children:[t.map(((e,i)=>(0,k.jsx)("div",{style:{...0===i?c.firstIconBubble:c.iconBubble,zIndex:t.length-i-((0,g().O9)(n)?0:1)},children:"notion"===e&&p?(0,k.jsx)(y().B6,{disabled:!0,icon:h,size:a+6,style:c.icon,isEmptyPage:Boolean(f),iconRecordCategory:v}):(0,I().kS)({iconType:e,iconSize:a})},e))),(0,g().O9)(n)?(0,k.jsx)("div",{style:{...c.iconBubble,...c.plusNText,zIndex:0},children:`+${n}`}):void 0]})}function M(e){const{fontSize:t}=e,n=(0,l().IS)((()=>({textContainer:{position:"relative",marginInlineStart:10},headerText:{fontSize:t,lineHeight:1,fontWeight:m().Wy.semibold,color:u().Tj.text.primary}})),[t]);return(0,k.jsx)("span",{style:n.textContainer,children:(0,k.jsx)("span",{style:n.headerText,children:(0,k.jsx)(d().sA,{defaultMessage:"How can I help you today?",id:"How can I help you today?"})})})}function _(e){const{iconWidthOverride:t,makeBlack:n}=e,a=(0,g().O9)(t)?t:22;return(0,l().IS)((()=>({document:{width:a,color:n?u().Tj.primaryBlack:p().$.light.purple[400]},aiFillTemplate:{width:a,color:n?u().Tj.primaryBlack:p().$.light.purple[400]},collectionTable:{width:a,color:n?u().Tj.primaryBlack:p().$.light.purple[400]},pencil:{width:a,color:n?u().Tj.primaryBlack:p().$.light.purple[400]},translate:{width:a,color:n?u().Tj.primaryBlack:p().$.light.purple[400]},assistSummarize:{width:a,color:n?u().Tj.primaryBlack:p().$.light.green[400]},assistFindActionItems:{width:a,color:n?u().Tj.primaryBlack:p().$.light.green[400]},assistBrainstormIdeas:{width:a,color:n?u().Tj.primaryBlack:p().$.light.green[400]},aiMakeShorter:{width:a,color:n?u().Tj.primaryBlack:p().$.light.green[400]},aiExplainThis:{width:a,color:n?u().Tj.primaryBlack:p().$.light.green[400]},magicWand:{width:a,color:n?u().Tj.primaryBlack:p().$.light.green[400]},arrowPageUp:{width:a,color:n?u().Tj.primaryBlack:p().$.light.green[400]}})),[a,n])}},153996:(e,t,n)=>{n.d(t,{M:()=>s,x:()=>o});var a=()=>n(534177),i=()=>n(353566);function s(e){const{operation:t}=e;if("createBlock"===t.command){const{command:e,...n}=t;return{command:e,...n,blockNode:(0,i().fw)(t.blockNode)}}if("moveBlock"===t.command){const{command:e,...n}=t;return{command:e,...n,blockNode:(0,i().fw)(t.blockNode)}}if("removeBlock"===t.command){const{command:e,...n}=t;return{command:e,...n,removeBlockNode:(0,i().fw)(t.removeBlockNode)}}if("insertBlockBefore"===t.command){const{command:e,...n}=t;return{command:e,...n,insertBlockNode:(0,i().fw)(t.insertBlockNode)}}if("insertBlockAfter"===t.command){const{command:e,...n}=t;return{command:e,...n,insertBlockNode:(0,i().fw)(t.insertBlockNode)}}if("setBlockParent"===t.command){const{command:e,...n}=t;return{command:e,...n,blockNode:(0,i().fw)(t.blockNode)}}if("addBlockToPage"===t.command){const{command:e,...n}=t;return{command:e,...n,blockNode:(0,i().fw)(t.blockNode)}}if("setBlockText"===t.command){const{command:e,...n}=t;return{command:e,...n,blockNode:(0,i().fw)(t.blockNode)}}if("setBlockAttribute"===t.command){const{command:e,...n}=t;return{command:e,...n,blockNode:(0,i().fw)(t.blockNode)}}if("setBlockProperty"===t.command){const{command:e,...n}=t;return{command:e,...n,blockNode:(0,i().fw)(t.blockNode)}}if("setBlockTagName"===t.command){const{command:e,...n}=t;return{command:e,...n,blockNode:(0,i().fw)(t.blockNode)}}if("removeTableColumn"===t.command){const{command:e,...n}=t;return{command:e,...n,blockNode:(0,i().fw)(t.blockNode)}}if("insertOrMoveTableColumns"===t.command){const{command:e,...n}=t;return{command:e,...n,blockNode:(0,i().fw)(t.blockNode)}}(0,a().HB)(t)}function o(e){const{serializedOperation:t,getBlockById:n,assistantLoggingData:s}=e,o=e=>(0,i().vr)({node:e,getBlockById:n,assistantLoggingData:s});if("createBlock"===t.command){const{command:e,...n}=t,a=o(t.blockNode);if(a)return{command:e,...n,blockNode:a}}else if("moveBlock"===t.command){const{command:e,...n}=t,a=o(t.blockNode);if(a)return{command:e,...n,blockNode:a}}else if("removeBlock"===t.command){const{command:e,...n}=t,a=o(t.removeBlockNode);if(a)return{command:e,...n,removeBlockNode:a}}else if("insertBlockBefore"===t.command){const{command:e,...n}=t,a=o(t.insertBlockNode);if(a)return{command:e,...n,insertBlockNode:a}}else if("insertBlockAfter"===t.command){const{command:e,...n}=t,a=o(t.insertBlockNode);if(a)return{command:e,...n,insertBlockNode:a}}else if("setBlockParent"===t.command){const{command:e,...n}=t,a=o(t.blockNode);if(a)return{command:e,...n,blockNode:a}}else if("addBlockToPage"===t.command){const{command:e,...n}=t,a=o(t.blockNode);if(a)return{command:e,...n,blockNode:a}}else if("setBlockText"===t.command){const{command:e,...n}=t,a=o(t.blockNode);if(a)return{command:e,...n,blockNode:a}}else if("setBlockAttribute"===t.command){const{command:e,...n}=t,a=o(t.blockNode);if(a)return{command:e,...n,blockNode:a}}else if("setBlockProperty"===t.command){const{command:e,...n}=t,a=o(t.blockNode);if(a)return{command:e,...n,blockNode:a}}else if("setBlockTagName"===t.command){const{command:e,...n}=t,a=o(t.blockNode);if(a)return{command:e,...n,blockNode:a}}else if("removeTableColumn"===t.command){const{command:e,...n}=t,a=o(t.blockNode);if(a)return{command:e,...n,blockNode:a}}else if("insertOrMoveTableColumns"===t.command){const{command:e,...n}=t,a=o(t.blockNode);if(a)return{command:e,...n,blockNode:a}}else(0,a().HB)(t)}},154373:(e,t,n)=>{n.d(t,{SW:()=>w,Uj:()=>_,E4:()=>k,VP:()=>x,Tm:()=>j,Ub:()=>M,Wq:()=>D,KM:()=>T});n(944114),n(898992),n(354520),n(672577),n(581454);var a=()=>n(277519),i=()=>n(457726),s=()=>n(404931),o=()=>n(792071),r=()=>n(361619),l=()=>n(696706),c=()=>n(548632),d=()=>n(84520),u=()=>n(798880);function p(e){const{aiFavorite:t,spaceViewId:n,spaceId:a,userId:i,from:s}=e,o=Date.now();return{id:t.id,version:0,alive:!0,parent_id:n,parent_table:d().mu,created_by_table:u().oo,created_by_id:i,created_time:o,last_edited_time:o,last_edited_by_id:i,last_edited_by_table:u().oo,space_id:a,user_id:i,type:"favorite",data:{version:1,from:s,name:t.name,icon:void 0,executeImmediately:t.executeImmediately,type:"human_step_only",initialHumanStep:[[t.action.prompt]]}}}var g=()=>n(496603),m=()=>n(534177),h=()=>n(44729),f=()=>n(384944),y=()=>n(680977),v=()=>n(159495),S=()=>n(594794);const b=10;function x(e){const{currentSpaceViewStore:t,fromAssistantSurface:n,limit:a=b}=e,i=t.getAssistantSessionStarterStores(),s=[],o=e=>{const t=e.getData();if(!t)return!1;if(!n.canShowSessionStarterInContext(t))return!1;return void 0===s.find((e=>{const n=e.getData();return!!n&&(t.sessionId===n.sessionId||g().n4({...n,sessionId:void 0},{...t,sessionId:void 0}))}))};for(const r of i)r.isRecent()&&o(r)&&s.push(r);return null===a?s:s.slice(0,a)}const I=null;function k(e){const{currentSpaceViewStore:t,currentUserSettingsStore:n,fromAssistantSurface:a,limit:i=I}=e,s=n.getSettingsStore().getKeyStore("favorite_ai_actions").getValue()??[],l=[];for(const m of s){if(!(m.spaceIdsMigrated??[]).find((e=>t.getSpaceId()===e))){const e=p({aiFavorite:m,spaceViewId:t.id,spaceId:t.getSpaceId(),userId:n.id,from:"writer"}),a=(0,r().$)({table:c().YV,value:e},o().nhb);l.push(a)}}const d=[...t.getAssistantSessionStarterStores().map((e=>e.getModel())),...l],u=[],g=e=>{const t=e.getData();return!!t&&a.canShowSessionStarterInContext(t)};for(const o of d)null!=o&&o.isFavorite()&&g(o)&&u.push(o);return null===i?u:u.slice(0,i)}function w(e){const{id:t,currentSpaceViewStore:n,transaction:i}=e,s=l().L3.fromPointerLike({table:c().YV,id:t}),o=a().n.createChildStore(n,s);o.isRecent()&&o.isDefined()&&(h().zz({childStore:o,parentStore:n.getAssistantSessionStartersStore(),transaction:i}),h().Ti({childStore:o,parentStore:n.getAssistantSessionStartersStore(),transaction:i}))}function C(e){return"human_step_only"===e.type||e.skill.parameterValues||(e.skill.parameterValues={}),e}function A(e){const{like:t,currentSpaceViewStore:n,transaction:a}=e,i=n.getAssistantSessionStarterStores().filter((e=>e.isRecent())).filter((e=>{const n=e.getData();return void 0!==n&&(n.sessionId===t.sessionId||g().n4({...C(n),sessionId:void 0},{...C(t),sessionId:void 0}))}));for(const s of i)h().zz({childStore:s,parentStore:n.getAssistantSessionStartersStore(),transaction:a})}function T(e){const{currentUserSettingsStore:t,currentSpaceViewStore:n,transaction:i,data:s}=e,o=n.getSpaceId(),r=l().L3.fromPointerLike({table:c().YV,id:s.id,spaceId:o}),d=a().n.createChildStore(n,r);if(d.isFavorite()&&d.isDefined()){const e=d.getData();f().zv({store:d,transaction:i,data:{type:"favorite",data:{version:e.version,from:e.from,icon:e.icon,name:s.name,executeImmediately:s.executeImmediately,type:"human_step_only",initialHumanStep:s.initialHumanStep}}})}const u=(t.getSettingsStore().getKeyStore("favorite_ai_actions").getValue()??[]).find((e=>e.id===s.id));if(u){var m;const e="",s=l().L3.fromPointerLike({table:c().YV,id:e,spaceId:o}),r=a().n.createChildStore(n,s),d=p({aiFavorite:u,spaceViewId:n.id,spaceId:n.getSpaceId(),userId:t.id,from:"writer"});f().KY({store:r,value:{...d,id:e},transaction:i});const h=(null===(m=t.getSettingsStore().getKeyStore("favorite_ai_actions").getValue())||void 0===m?void 0:m.map((e=>e.id===u.id?{...u,spaceIdsMigrated:(0,g().sb)([...u.spaceIdsMigrated??[],o])}:e)))??[];(0,y().m)({userSettingsStore:t,transaction:i,data:{favorite_ai_actions:h}})}}function j(e){const{id:t,currentSpaceViewStore:n,currentUserSettingStore:i,transaction:s}=e,o=l().L3.fromPointerLike({table:c().YV,id:t}),r=a().n.createChildStore(n,o);if(r.isFavorite()&&r.isDefined())return void h().zz({childStore:r,parentStore:n.getAssistantSessionStartersStore(),transaction:s});const d=(i.getSettingsStore().getKeyStore("favorite_ai_actions").getValue()??[]).find((e=>e.id===t));d&&(0,v().$S)(d,i,s)}function M(e){const{id:t,currentSpaceViewStore:n,transaction:i}=e,s=l().L3.fromPointerLike({table:c().YV,id:t}),o=a().n.createChildStore(n,s);o.isRecent()&&o.isDefined()&&(h().zz({childStore:o,parentStore:n.getAssistantSessionStartersStore(),transaction:i}),A({like:o.getData(),currentSpaceViewStore:n,transaction:i}))}function _(e){const{id:t,currentSpaceViewStore:n,transaction:i}=e,s=l().L3.fromPointerLike({table:c().YV,id:t}),o=a().n.createChildStore(n,s);if(o.isRecent()&&o.isDefined()){const e=o.getAssistantSessionStarterData();if(!e)return;const t=o.getData(),a={version:1,from:t.from,...e};f().zv({store:o,transaction:i,data:{type:"favorite",data:a}}),A({like:t,currentSpaceViewStore:n,transaction:i})}}const P=20;function D(e){const{environment:t,transaction:n,currentUserStore:a,currentSpaceViewStore:o,fromAssistantSurface:r,assistantSessionContext:l}=e,d=function(e){const{assistantSessionContext:t,fromAssistantSurface:n}=e;if(t.selectedSkillFromStoreState){var a;const e={skillType:t.selectedSkillFromStoreState.clientSkill.skillType,parameterValues:t.selectedSkillFromStoreState.parameterValues};return(0,s().dc)(e.skillType).requiresInput?{version:1,sessionId:t.sessionIdFromStoreState,type:"skill_with_human_step",from:n,skill:e,initialHumanStep:(null===(a=t.clientStepsFromStoreState.find(i().Hr))||void 0===a?void 0:a.text)??[]}:{version:1,sessionId:t.sessionIdFromStoreState,type:"skill_only",from:n,skill:e}}var o;if(t.getHasCommittedHumanStep())return{version:1,sessionId:t.sessionIdFromStoreState,type:"human_step_only",from:n,initialHumanStep:(null===(o=t.clientStepsFromStoreState.find(i().Hr))||void 0===o?void 0:o.text)??[]}}({assistantSessionContext:l,fromAssistantSurface:r});if(!d)return;const u="human_step_only"===(p=d).type?{type:p.type,initialHumanStep:p.initialHumanStep}:"skill_only"===p.type?{type:p.type,skill:p.skill}:"skill_with_human_step"===p.type?{type:p.type,initialHumanStep:p.initialHumanStep,skill:p.skill}:void(0,m().HB)(p);var p;if(void 0!==o.getAssistantSessionStarterStores().find((e=>{if(e.isRecent())return!1;const t=e.getAssistantSessionStarterData();return!!t&&g().n4(C(t),C(u))})))return;A({like:d,currentSpaceViewStore:o,transaction:n});const y=o.getAssistantSessionStarterStores().filter((e=>e.isRecent()));for(;y.length>=P;){const e=y.pop();if(!e)break;h().zz({childStore:e,parentStore:o.getAssistantSessionStartersStore(),transaction:n})}const v=function(e){const{environment:t,transaction:n,currentUserStore:a,currentSpaceViewStore:i,assistantRecentData:s}=e;return f().vt({environment:t,transaction:n,table:c().YV,args:{id:(0,S().Z1)({environment:t,table:c().YV,spaceId:i.getSpaceId()}),alive:!1,space_id:i.getSpaceId(),user_id:a.id,parentPointer:i.pointer,createdByPointer:a.pointer,type:"recent",data:s},inMemoryRecordCache:a.inMemoryRecordCache})}({environment:t,transaction:n,currentUserStore:a,currentSpaceViewStore:o,assistantRecentData:d});v&&h().Ti({childStore:v,parentStore:o.getAssistantSessionStartersStore(),transaction:n})}},156008:(e,t,n)=>{n.d(t,{Dd:()=>w,IF:()=>T,WX:()=>C,bl:()=>A});n(16280),n(898992),n(354520),n(672577);var a=()=>n(907258),i=()=>n(675133),s=()=>n(792057),o=()=>n(374580),r=()=>n(445770),l=()=>n(860251),c=()=>n(363497),d=()=>n(449412),u=()=>n(973647),p=()=>n(140992),g=()=>n(36951),m=()=>n(166442),h=()=>n(631611),f=()=>n(564627),y=()=>n(263542),v=()=>n(483730),S=()=>n(677590),b=()=>n(140022),x=()=>n(26080),I=()=>n(501305);const k=(0,n(69708).YK)({errorLoadingChatHistory:{id:"chatHistoryActions.errorLoadingChatHistory",defaultMessage:"There was an error loading that chat history. Please contact support if the problem persists."}});function w(e){const{environment:t,source:n}=e;(0,S().U)({environment:t});if(!h().wy[n].supportsStartingNewChatAsInferenceTranscript)return y().P.setState({...y().P.state,currentView:"chat"}),void(0,b().trackAIChatTranscriptHistoryNewChatCreated)(t,{source:n});(0,I().closeAssistantRightHandSideMenu)({environment:t}).then((()=>{(0,g().VK)({environment:t,oldThreadStore:void 0,newThreadStore:void 0})})).catch((e=>{console.error(e)}))}async function C(e){const{environment:t,assistantSurface:n}=e,{previouslyVisitedSessionId:i}=f().G.state,{sidebarSpaceStore:s}=a().default.state;if(s)if(i)if(i!==v().default.getActiveSessionId()){const e=o().g.createChildStore(s,{id:i,table:c().TF,spaceId:s.id});await A({environment:t,chatStore:e,onRestoreChatSession:void 0,assistantSurface:n})}else y().P.setState({...y().P.state,currentView:"chat"});else w({environment:t,source:n.type})}async function A(e){const{environment:t,chatStore:n,onRestoreChatSession:a,assistantSurface:o}=e;if(!(await(0,I().confirmAndDiscardPendingEditsIfApplicable)({environment:t,assistantSurface:o})))return;const r=await T(n);if(!r||!n){s().f1(i().A.formatMessage(k.errorLoadingChatHistory));const e=new Error("Unable to restore chat history");return void d().Fg(e,{extra:{chatStoreId:null==n?void 0:n.id,chatTranscriptStorageStepId:null==r?void 0:r.id},tags:{event:"chatHistoryActions.restoreChatHistory"}})}const l=n.getCreatedTime();(0,p().Wq)({clientStore:m().defaultClientAIChatStore,environment:t}),(0,S().U)({environment:t}),await(0,x().hl)(r,l,t),y().P.setState({...y().P.state,currentView:"chat"}),(0,b().trackAIChatTranscriptHistoryItemRestored)(t,{sessionId:r.sessionId,stepId:r.id}),null==a||a()}async function T(e){var t;const n=null==e||null===(t=e.getChatStepStore())||void 0===t?void 0:t.dangerouslyGetUnmigratedStorageStep();if(!n||u().Q.isFail(n)||!n.value)return;const a=(0,x().dA)(),i=await(0,r().bK)(n.value,{desiredXMLVersion:a,desiredClientStepVersion:l().Np});return u().Q.isSuccess(i)?i.value:void 0}},156747:(e,t,n)=>{n.d(t,{Z:()=>y});n(296540);var a=()=>n(907258),i=()=>n(590526),s=()=>n(401497),o=()=>n(350013),r=()=>n(68169),l=()=>n(799288),c=()=>n(743246),d=()=>n(201980),u=()=>n(69708),p=()=>n(100622),g=()=>n(827368),m=()=>n(119994),h=()=>n(318670),f=n(474848);function y(e){const{step:t,threadStore:n}=e,y=(0,u().tz)(),v=(0,i().K8)((()=>{const{sidebarSpaceStore:e}=a().default.state;if(e&&t.parentAgentId&&!(0,l().ut)(t.parentAgentId))return o().N.createChildStore(e,{table:c().C0,id:t.parentAgentId,spaceId:e.id})}),[t.parentAgentId]),S=(0,i().K8)((()=>t.parentAgentId===r().Lj?y.formatMessage({id:"AgentMessageStep.personalAgent",defaultMessage:"Personal Agent"}):(null==v?void 0:v.getName())??"Agent"),[v,t.parentAgentId,y]),b=0===(0,d().AhH)(t.value),x=(0,h().gg)({threadStore:n,step:t}),{bodyStyleKey:I}=(0,g().yq)(),k=(0,g().Cd)(I),w=(0,s().IS)((()=>({container:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:4,marginBottom:16},messageRow:{display:"flex",alignItems:"start",gap:8,width:"100%"},bubbleContainer:{position:"relative",maxWidth:"80%",paddingTop:4,marginTop:-4,background:"transparent"},bubble:{...k,paddingTop:6,paddingBottom:6,paddingInlineStart:14,paddingInlineEnd:14,borderRadius:18,backgroundColor:p().Tj.background.tertiaryTranslucent,whiteSpace:"pre-wrap",wordWrap:"break-word",transition:"background-color 0.1s ease"}})),[k]);return b?null:(0,f.jsxs)("div",{style:w.container,children:[(0,f.jsx)(m().U,{type:"agent",workflowStore:v,displayName:S}),(0,f.jsx)("div",{style:w.messageRow,children:(0,f.jsx)("div",{style:w.bubbleContainer,children:(0,f.jsx)("div",{style:w.bubble,children:x})})})]})}},162437:(e,t,n)=>{n.d(t,{$:()=>S});n(581454);var a=()=>n(353566),i=()=>n(769864),s=()=>n(68465),o=()=>n(383070),r=()=>n(483730),l=()=>n(17849),c=()=>n(140022),d=(n(898992),n(823215),n(354520),n(737550),()=>n(295633)),u=()=>n(732810),p=()=>n(847708),g=()=>n(510818),m=()=>n(179034),h=()=>n(519831),f=()=>n(499764),y=()=>n(881480);var v=()=>n(259091);async function S(e){var t;const{environment:n,type:S,inferenceId:b,sessionId:x,userComment:I,shareWithNotion:k,userOptIn:w,source:C,debugShareWithSpace:A}=e,T=r().default.getSessionContextOrThrow(x),{assistantConfigurationStore:j}=T,M=o().zD.isXMLAssistantEnabled(),{previewingStepFromStoreState:_,evaluatorFromStoreState:P,previewingStepObservationsFromStoreState:D}=T,E=(0,v().x)(n),R=P.getTranscript(),B=P.state.getSerializedState(),F=o().zD.getMode(),N=o().zD.isLimitedQnaMode(),L=null===(t=l().c.state)||void 0===t?void 0:t.name,O=await async function(e){const{sessionId:t}=e,n=(0,y().g)(),a=r().default.getSessionContextOrThrow(t),i=a.evaluatorFromStoreState.state,s=i.getLoadedPageIds(),o=a.evaluatorFromStoreState.getTranscript().filter((e=>"observation"===e.type&&"search"===e.observationType)).some((e=>Boolean(e.containsNonSpaceSharedResults))),l=[...[...s,...(0,g().WF)(a.evaluatorFromStoreState)].map((e=>d().B.createChildStore(n,{table:m().ev,id:e,spaceId:n.getSpaceId()}))),...[...i.getLoadedDatabaseIds()].map((e=>u().m.createChildStore(n,{table:h().Vl,id:e,spaceId:n.getSpaceId()})))];return await Promise.all(l.map((e=>(0,p().n)(e)))),l.every((e=>(0,f().Jh)(e)))&&!o}({sessionId:x});"assistant_thumbs_up"!==S&&"assistant_thumbs_down"!==S||c().trackQnaFeedbackGiven(n,j.state,b,"assistant_thumbs_up"===S?"thumbs_up":"thumbs_down");const V=T.assistantConfigurationStoreState.currentUserInfo;await i().callCellCompatibleApi({eventName:"saveAssistantFeedback",environment:n,data:{id:b,type:S,start_transcript_steps:R,task_type:L,start_state:B,output:(null==_?void 0:_.value)??"",observationSteps:D.slice(),observation:D.map((e=>e.value)).join("\n"),space_id:E.id,user_id:V.id,client_version:a().Mz,timestamp:Date.now(),is_shared_with_space:A??O,is_dev_debug_share:A,is_search:!1,user_comment:I,share_with_notion:k,user_opt_in:w,is_labeler_mode:(0,s().cJ)(),is_teacher_mode:(0,s().lQ)(),is_assistant:M,input_source:C,mode:F,is_limited_qna:N,is_markdown_mode:"end_to_end"!==o().zD.getNamespace(),is_prompt_only_server:"prompt_only_server"===o().zD.getNamespace()},cellNavigation:{spaceId:E.id}})}},162629:(e,t,n)=>{n.d(t,{J:()=>o});var a=n(296540),i=()=>n(591779),s=()=>n(201980);function o(e){const{storeValue:t,onBackspaceOnEmptyInput:n,onSpaceOnEmptyInput:o,onTextChangeHook:r,additionalCallback:l}=e,c=(0,i().ZC)(t),d=(0,a.useRef)(c);d.current=c;const u=(0,a.useRef)(!1);return(0,a.useCallback)((e=>{const a=(0,s().AhH)(t??[]),i=(0,s().w9s)(t),c=(0,s().AhH)(d.current??[]),p=u.current;u.current=0===a,e&&e instanceof KeyboardEvent&&"Backspace"===e.key&&!e.repeat&&0===a&&(p||0===c)&&(null==n||n()),e&&e instanceof KeyboardEvent&&"Space"===e.code&&i&&(null==o||o()),null==r||r(t),null==l||l()}),[t,r,n,o,l])}},163591:(e,t,n)=>{n.d(t,{A:()=>v,z:()=>S});n(296540);var a=()=>n(755531),i=()=>n(242422),s=()=>n(590526),o=()=>n(401497),r=()=>n(807449),l=()=>n(902006),c=()=>n(642557),d=()=>n(69708),u=()=>n(100622),p=()=>n(534177),g=()=>n(284371),m=()=>n(987267),h=()=>n(16006),f=()=>n(255350),y=n(474848);function v(e){const{item:t}=e,n=(0,d().tz)(),v=(0,s().K8)((()=>{var e;return null===(e=(0,a().S)())||void 0===e||null===(e=e.getModel())||void 0===e?void 0:e.getRenderTitle()}),[]),S=(0,s().K8)((()=>(0,f().Nr)({item:t,intl:n})),[t,n]),b=(0,s().K8)((()=>i().default.getConfigKey("ingestion","slack").userScopes.length>0),[]),x=(0,o().IS)((()=>({nonRecordTitle:{...g().RC,width:"100%"},recordTitle:{alignItems:"center",display:"flex",...g().RC,minWidth:0,flex:1,marginInlineEnd:12,width:"100%"},pageTitle:{...g().RC,minWidth:0},lightText:{color:u().Tj.text.tertiary,whiteSpace:"nowrap"},hyphen:{display:"inline-block",marginInlineStart:3,marginInlineEnd:3}})),[]);return"everything"===S.type?(0,y.jsx)("div",{style:x.nonRecordTitle,children:(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.everythingItem.title",defaultMessage:"All sources I can access"})}):"notion"===S.type?(0,y.jsx)("div",{style:x.recordTitle,children:(0,y.jsx)(d().sA,{id:"assistantScopedSearchPageMenuItem.notionItem.title",defaultMessage:"<title>{spaceName}</title><light><spacearound></spacearound>Workspace</light>",values:{spaceName:v,title:(...e)=>(0,y.jsx)("div",{style:x.pageTitle,children:e}),light:(...e)=>(0,y.jsx)("div",{style:x.lightText,children:e}),spacearound:(...e)=>(0,y.jsx)("div",{style:x.hyphen,children:e})}})}):"slack"===S.type?b?(0,y.jsx)("div",{style:x.nonRecordTitle,children:(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.slackItem.title",defaultMessage:"Slack"})}):(0,y.jsx)("div",{style:x.nonRecordTitle,children:(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.slackItem.titlePublic",defaultMessage:"Slack<light><spacearound></spacearound>Public channels</light>",values:{light:(...e)=>(0,y.jsx)("div",{style:{...x.lightText,minWidth:0,display:"inline-block"},children:e}),spacearound:(...e)=>(0,y.jsx)("div",{style:x.hyphen,children:e})}})}):"web"===S.type?(0,y.jsx)("div",{style:x.nonRecordTitle,children:(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.webItem.title",defaultMessage:"Web"})}):"ai-knowledge"===S.type?(0,y.jsx)("div",{style:x.nonRecordTitle,children:(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.aiKnowledgeItem.title",defaultMessage:"AI knowledge"})}):"helpdocs"===S.type?(0,y.jsx)("div",{style:x.nonRecordTitle,children:(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.slackItem.dynamicNotionHelpTitle",defaultMessage:"Notion Help Center"})}):"workspace"===S.type?(0,y.jsx)("div",{style:x.recordTitle,children:(0,y.jsx)(d().sA,{id:"assistantScopedSearchPageMenuItem.workspaceItem.label",defaultMessage:"<title>{spaceName}</title><light><spacearound></spacearound>Public Workspace</light>",values:{spaceName:v,title:(...e)=>(0,y.jsx)("div",{style:x.pageTitle,children:e}),light:(...e)=>(0,y.jsx)("div",{style:x.lightText,children:e}),spacearound:(...e)=>(0,y.jsx)("div",{style:x.hyphen,children:e})}})}):"teamspace"===S.type?"private"===S.accessLevel?(0,y.jsxs)("div",{style:x.recordTitle,children:[(0,y.jsx)(h().A,{store:S.store}),(0,y.jsx)("span",{style:{marginInlineStart:4},children:(0,y.jsx)(r().I,{icon:c().lockSmallIcon,size:"sm",colorVariant:"secondary"})})]}):(0,y.jsx)("div",{style:x.recordTitle,children:(0,y.jsx)(h().A,{store:S.store})}):"page"===S.type?S.isCurrentPage?(0,y.jsx)("div",{style:x.recordTitle,children:(0,y.jsx)(d().sA,{id:"assistantScopedSearchPageMenuItem.currentPage.label",defaultMessage:"<title>{pageTitle}</title><light><spacearound></spacearound>Current page</light>",values:{pageTitle:S.title,title:(...e)=>(0,y.jsx)("div",{style:x.pageTitle,children:e}),light:(...e)=>(0,y.jsx)("div",{style:x.lightText,children:e}),spacearound:(...e)=>(0,y.jsx)("div",{style:x.hyphen,children:e})}})}):(0,y.jsx)("div",{style:x.recordTitle,children:(0,y.jsx)(h().A,{store:S.store})}):"site"===S.type?(0,y.jsx)("div",{style:x.recordTitle,children:(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.siteItem.dynamicNotionSiteTitle",defaultMessage:"Site"})}):"sharepoint"===S.type?(0,y.jsx)("div",{style:x.recordTitle,children:(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.sharepointItem.title",defaultMessage:"SharePoint and OneDrive"})}):"salesforce"===S.type?(0,y.jsx)("div",{style:x.recordTitle,children:(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.salesforceItem.title",defaultMessage:"Salesforce"})}):(0,l().SC)(S.type)?(0,y.jsx)("div",{style:x.recordTitle,children:m().w0[S.type]}):(0,p().HB)(S.type)}function S(e){const{item:t}=e,n=(0,d().tz)(),a=(0,s().K8)((()=>(0,f().Nr)({item:t,intl:n})),[t,n]);return"everything"===a.type?(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.everythingItem.tooltip",defaultMessage:"Find in all sources for the most comprehensive answers"}):"notion"===a.type?(0,y.jsx)(d().sA,{id:"assistantScopedSearchPageMenuItem.notionItem.tooltip",defaultMessage:"Find in Notion, excluding connected sources"}):"web"===a.type?(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.webItem.tooltip",defaultMessage:"Search the web for answers"}):"ai-knowledge"===a.type?(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.aiKnowledgeItem.tooltipWithDoubleCheck",defaultMessage:"Answer using AI models only, without searching your workspace or connected sources. Double-check for accuracy"}):"helpdocs"===a.type?(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.helpdocsItem.tooltip",defaultMessage:"Find in Notion Help Center for guidance and information on how to use Notion"}):"workspace"===a.type?(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.workspaceItem.tooltip",defaultMessage:"Find in your Notion workspace, excluding external sources"}):"teamspace"===a.type?(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.teamspaceItem.tooltip",defaultMessage:"Find in this teamspace"}):"page"===a.type?a.isCurrentPage?(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.currentPageItem.tooltip",defaultMessage:"Find in the currently opened page for context"}):(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.pageItem.tooltip",defaultMessage:"Find in a specific Notion page"}):"site"===a.type?(0,y.jsx)(d().sA,{id:"assistantScopedSearchMenu.siteItem.tooltip",defaultMessage:"Find on the site"}):(0,l().SC)(a.type)?(0,y.jsx)(d().sA,{...m().EH[a.type]}):(0,p().HB)(a.type)}},163749:(e,t,n)=>{n.d(t,{m:()=>i});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"2.18 3.24 11.63 11.45",svg:(0,n(474848).jsx)("path",{d:"m10.422 10.183-1.399 1.49c-.233.299-.458.746-.672 1.173-.143.283-.28.557-.413.773l-.287.589a1.024 1.024 0 0 1-1.232.418 1.023 1.023 0 0 1-.612-1.24l.403-1.41c.079-.273.192-.5.305-.73.11-.22.22-.441.3-.704a.32.32 0 0 0-.31-.41H3.248a.97.97 0 0 1-.969-.97c0-.333.179-.62.442-.79a.94.94 0 0 1-.534-.852c0-.427.27-.775.65-.907a.96.96 0 0 1-.364-.744c0-.535.426-.969.961-.969a.97.97 0 0 1 .69-1.65H7.55c.573 0 1.131.131 1.643.387v.008l1.131.387h.097zm.968-.517V4.032h1.696c.401 0 .726.325.726.727v4.18a.727.727 0 0 1-.726.727z"})},i=(0,n(340498).wt)("handThumbsDownFillSmall",a,"fillSmall")},168029:(e,t,n)=>{n.d(t,{p:()=>d});n(16280),n(410838),n(581454);var a=()=>n(908006),i=()=>n(722101),s=()=>n(23420),o=()=>n(747674),r=()=>n(836724),l=()=>n(483730),c=()=>n(150984);function d(e){const{environment:t,sessionId:n,transaction:d,pageStore:u}=e,p=l().default.getSessionContextOrThrow(n).getCombinedSteps().findLast((e=>"assistantChat"===e.type));if(!p)throw new Error("No lastSampledAssistantChatStep.");const g=(0,c().generateBlockStoresForClientChatStep)({environment:t,clientStep:p,transaction:d,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,stripCitations:!0,isPreviewing:!1}).map((e=>e.cloneWithNewUIParent(u.getContentStore())));for(const a of g)i().BC({parentStore:u.getContentStore(),appendStore:a,transaction:d});return a().default.afterNextFlush((()=>{const e=g.map((e=>e.id));(0,s().B)(e,!1,t);const n=r().T.findSelectablesFromIds(e).map((e=>e.props.store));(0,o().t)({environment:t,stores:n})})),g.length}},170139:(e,t,n)=>{n.d(t,{g:()=>i});var a=()=>n(484487);function i(){const{connectionStatus:e}=a().P0.state;"pending_selection"===e&&a().P0.setState({...a().P0.state,currentScreen:"pending_selection"})}},173443:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>a,sparklesFillIcon:()=>i});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"1.71 2.16 16.58 15.67",svg:(0,n(474848).jsx)("path",{d:"M6.35 2.795a.63.63 0 1 0-1.26 0c0 .541-.34 1.234-.925 1.82-.586.585-1.279.925-1.82.925a.63.63 0 1 0 0 1.26c.541 0 1.234.34 1.82.926.585.586.926 1.279.926 1.82a.63.63 0 0 0 1.26 0c0-.541.34-1.234.925-1.82.586-.585 1.279-.926 1.82-.926a.63.63 0 0 0 0-1.26c-.541 0-1.234-.34-1.82-.925-.585-.586-.925-1.279-.925-1.82m6.867 4.275a.63.63 0 1 0-1.26 0c0 1.115-.525 2.228-1.367 3.07-.843.843-1.956 1.367-3.07 1.367a.63.63 0 0 0 0 1.26c1.114 0 2.227.525 3.07 1.367.842.843 1.367 1.956 1.367 3.07a.63.63 0 1 0 1.26 0c0-1.114.524-2.227 1.367-3.07.842-.842 1.955-1.367 3.07-1.367a.63.63 0 1 0 0-1.26c-1.115 0-2.228-.524-3.07-1.366-.843-.843-1.367-1.956-1.367-3.07"})},i=(0,n(340498).wt)("sparklesFill",a,"fill")},181251:(e,t,n)=>{n.d(t,{H:()=>g});var a=n(296540),i=()=>n(312788),s=()=>n(381175),o=()=>n(484714),r=()=>n(590526),l=()=>n(584262),c=()=>n(172385),d=()=>n(496703),u=()=>n(786702),p=()=>n(38554);function g(e){const{aiChatFeatureController:t}=e,n=(0,o().v3)(),{navigate:g}=(0,a.useContext)(i().E),m=(0,p().U)(),{shouldUseSidePeek:h,sidePeekRoute:f}=(0,r().K8)((()=>{const e=n.RouterStore.state.route,a="agent"===e.name,i="chat"===e.name;let s;return a?s={type:"agent",route:e}:i&&(s={type:"chat",route:e}),{shouldUseSidePeek:m&&"full_page"===(null==t?void 0:t.agentChatFormFactor)&&(a||i),sidePeekRoute:s}}),[m,t,n]),y=(0,a.useCallback)((e=>{if(!f)return;if("agent"===f.type){const t=f.route;return(0,d().L)({workflowId:t.workflowId,params:{workflowViewType:t.workflowViewType,workflowViewId:t.workflowViewId,workflowPrompt:t.workflowPrompt,chatThreadId:t.chatThreadId,agentChatThreadId:t.agentChatThreadId},peekViewBlockId:e,peekModeParam:"s",pageVisitSource:l().y8.LinkInPage})}const t=f.route;return(0,c().EY)({isMobile:!1,currentRoute:t,pageId:e,pageVisitSource:l().y8.LinkInPage,peekModeParam:"s"})}),[f]),v=(0,a.useCallback)((e=>{const t=y(e);t&&g({environment:n,url:t})}),[y,n,g]),S=(0,a.useCallback)((e=>{if(!h)return;if((0,s().V)(e))return;const t=e.target;if(!(t instanceof HTMLElement))return;const n=t.closest("a[href]");if(!(n instanceof HTMLAnchorElement))return;const a=n.getAttribute("href");if(!a)return;if(a.startsWith("#"))return;const i=(0,u().w)(a);i&&(e.preventDefault(),e.stopPropagation(),v(i))}),[h,v]);return(0,a.useMemo)((()=>({shouldUseSidePeek:h,buildSidePeekUrl:y,navigateToSidePeek:v,handleLinkClick:S,sidePeekRoute:f})),[h,y,v,S,f])}},183373:(e,t,n)=>{n.d(t,{KS:()=>r,af:()=>c,ik:()=>l,w6:()=>o});n(581454);var a=()=>n(564884),i=()=>n(907258),s=()=>n(736423);function o(e){var t;const n=i().default.state.currentUserSettingsStore;return n?null===(t=n.getSettings())||void 0===t||null===(t=t.checklists)||void 0===t?void 0:t[e]:null}function r(e){const t=o(e);return s().y[e].steps.map((e=>({id:e.id,completed:e.id in((null==t?void 0:t.completedSteps)??{})})))}function l({environment:e,checklistId:t,stepId:n,type:i}){const s=function(e){const t=o(e);return Object.keys((null==t?void 0:t.completedSteps)??{}).length}(t);(0,a().u)({environment:e,event:{eventName:"checklist_interaction",eventProperties:{checklist_id:t,step_id:n,num_completed_steps:s,type:i}}})}function c(e){return null==e?e:function(e){return null==e?null:!(null!=e&&e.completedAt||null!=e&&e.dismissedAt)}(e)?e.state:void 0}},185078:(e,t,n)=>{n.d(t,{FM:()=>u,J6:()=>d,cE:()=>r,h5:()=>h,kl:()=>m,oQ:()=>g,vQ:()=>p});n(581454);var a=()=>n(534177),i=()=>n(700500),s=()=>n(644161);const o=["ar","bg","cs","da","de","el","es","et","fi","fr","he","hu","id","it","ja","ko","lt","lv","nb","nl","pl","ro","ru","sk","sl","sv","th","tr","uk","vi","zh","en","pt"];function r(e){return!!(0,a().Xk)(o,e)}const l=["en-US","ko","ja","fr","de","es","pt-BR","pt-PT","fi","da","nl","nb","sv","zh-HANS","zh-HANT","ru","it","id","th","vi"],c=[...l,"ar","he"];function d(e){return(null==e?void 0:e.includeRtlLanguages)?c:l}function u(e){return function(e){return!!(0,a().Xk)(c,e)}((0,s().JE)(e))}function p(e){return d({includeRtlLanguages:(null==e?void 0:e.includeRtlLanguages)??!0}).map((e=>({key:e,name:(0,s().Bj)(e)})))}function g(e){return(0,i().Db)(e,void 0)||"form"===e||"collection_view_page"===e?"title":(0,i().z9)(e)?"caption":"table_row"===e||"collection_view"===e?"properties":(0,i().Mp)(e)||"column"===e||"column_list"===e||"table"===e?"unmapped":void(0,a().HB)(e)}let m=function(e){return e.NAME="name",e.VIEW_NAME="view_name",e.DESCRIPTION="description",e.SCHEMA_PROPERTY_NAME="schema_property_name",e.SCHEMA_PROPERTY_OPTION="schema_property_option",e.SCHEMA_PROPERTY_AI_INFERENCE="schema_property_ai_inference_prompt",e}({});const h={questionName:"question_name",questionDescription:"question_description",checkboxLabel:"checkbox_label"}},186387:(e,t,n)=>{n.d(t,{A:()=>L});var a=n(296540),i=()=>n(920198),s=()=>n(484714),o=()=>n(590526),r=()=>n(401497),l=()=>n(249046),c=()=>n(807449),d=()=>n(416783),u=()=>n(631524),p=()=>n(282339),g=()=>n(340498),m=n(474848);const h={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 15.78 15.67",svg:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("path",{d:"M16.328 11.844a1.79 1.79 0 0 1 1.788 1.789v.882a1 1 0 0 1 .788.977v2.295a1 1 0 0 1-1 1H14.75a1 1 0 0 1-1-1v-2.295a1 1 0 0 1 .79-.977v-.882a1.79 1.79 0 0 1 1.788-1.79m0 4.108a.644.644 0 1 0-.001 1.289.644.644 0 0 0 0-1.289m0-3.108a.79.79 0 0 0-.789.789v.86h1.577v-.86a.79.79 0 0 0-.788-.79M5.75 5.625c.621 0 1.125.504 1.125 1.125v9c0 .621-.504 1.125-1.125 1.125h-1.5a1.125 1.125 0 0 1-1.125-1.125v-9c0-.621.504-1.125 1.125-1.125zm-1.375 10h1.25v-8.75h-1.25zm6.375-6c.621 0 1.125.504 1.125 1.125v5c0 .621-.504 1.125-1.125 1.125h-1.5a1.125 1.125 0 0 1-1.125-1.125v-5c0-.621.504-1.125 1.125-1.125zm-1.375 6h1.25v-4.75h-1.25z"}),(0,m.jsx)("path",{d:"M15.75 3.125c.621 0 1.125.504 1.125 1.125v6.852a3 3 0 0 0-.282-.045l-.265-.013q-.367.002-.703.099V4.375h-1.25v7.562a2.58 2.58 0 0 0-.636 1.696v.432a1.76 1.76 0 0 0-.614.78V4.25c0-.621.504-1.125 1.125-1.125z"})]})},f=(0,g().wt)("chartBarXAxisLock",h,"default"),y={viewBox:"0 0 20 20",fittedViewBox:"1.61 1.59 16.77 16.82",svg:(0,m.jsx)("path",{d:"M4.243 4.094c.621 0 1.125.503 1.125 1.125v9l-.006.115a1.125 1.125 0 0 1-1.119 1.01h-1.5a1.125 1.125 0 0 1-1.125-1.125v-9c0-.621.504-1.125 1.125-1.125zm-1.375 10h1.25v-8.75h-1.25zm6.375-6c.621 0 1.125.503 1.125 1.125v2.029l-1.25 2.165v-4.07h-1.25v4.75h.858l-.722 1.25h-.26a1.125 1.125 0 0 1-1.126-1.124v-5c0-.621.504-1.125 1.125-1.125zm5-6.5c.621 0 1.125.503 1.125 1.125v6.36a2.6 2.6 0 0 0-1.25-.65V2.844h-1.25V8.46a2.6 2.6 0 0 0-1.25.754V2.719c0-.621.504-1.125 1.125-1.125zm-1.819 8.769a1.312 1.312 0 0 1 2.273 0l3.507 6.075a1.313 1.313 0 0 1-1.137 1.968h-7.014a1.313 1.313 0 0 1-1.137-1.968zm1.062 5.423a.625.625 0 1 0 0 1.25.625.625 0 0 0 0-1.25m0-3.662a.55.55 0 0 0-.55.55v1.875a.55.55 0 0 0 1.1 0v-1.875a.55.55 0 0 0-.55-.55"})},v=(0,g().wt)("chartBarXAxisWarning",y,"default"),S={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 16.77 16.82",svg:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("path",{d:"M13.93 11.894a1.313 1.313 0 0 1 2.274 0l3.507 6.075a1.313 1.313 0 0 1-1.137 1.968H11.56a1.313 1.313 0 0 1-1.137-1.968zm1.062 5.423a.625.625 0 1 0 0 1.25.625.625 0 0 0 0-1.25m0-3.662a.55.55 0 0 0-.55.55v1.875a.55.55 0 0 0 1.1 0v-1.875a.55.55 0 0 0-.55-.55"}),(0,m.jsx)("path",{d:"M3.75 3.125c.345 0 .625.28.625.625v5.098l3.017-2.64.097-.07a.626.626 0 0 1 .756.098l3.035 3.036 3.485-3.484H12.75a.626.626 0 0 1 0-1.25h3.5c.345 0 .625.28.625.624l.001 3.501a.626.626 0 0 1-1.252 0V6.697L11.723 10.6a.625.625 0 0 1-.884 0L7.774 7.533l-3.399 2.975v4.242c0 .483.392.875.875.875h4.981l-.721 1.25H5.25a2.125 2.125 0 0 1-2.125-2.125v-11c0-.345.28-.625.625-.625"})]})},b=(0,g().wt)("chartLineUptrendWarning",S,"default");const x={viewBox:"0 0 20 20",fittedViewBox:"2.36 2.37 17.52 17.57",svg:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("path",{d:"M13.93 11.894a1.313 1.313 0 0 1 2.273 0l3.507 6.075a1.313 1.313 0 0 1-1.137 1.968H11.56a1.313 1.313 0 0 1-1.137-1.968zm1.061 5.422a.626.626 0 1 0 .001 1.252.626.626 0 0 0 0-1.252m0-3.662a.55.55 0 0 0-.55.55v1.875a.55.55 0 1 0 1.1 0v-1.875a.55.55 0 0 0-.55-.55M7.99 2.644a.624.624 0 0 1 .327 1.205A6.38 6.38 0 0 0 3.625 10 6.374 6.374 0 0 0 9.8 16.37l-.536.93a3 3 0 0 0-.138.273 7.624 7.624 0 0 1-1.137-14.93"}),(0,m.jsx)("path",{d:"M7.857 6.475a.625.625 0 0 1 .65 1.068 2.875 2.875 0 1 0 3.905 4.022.62.62 0 0 1 .302-.243L11.2 13.945a4.125 4.125 0 0 1-3.343-7.47M10 2.375A7.625 7.625 0 0 1 17.625 10c0 .345-.28.625-.625.625h-.11a2.66 2.66 0 0 0-3.606-.041.62.62 0 0 1-.409-.584A2.875 2.875 0 0 0 10 7.125a.625.625 0 0 1-.625-.625V3c0-.345.28-.625.625-.625m.625 3.547a4.13 4.13 0 0 1 3.452 3.453h2.267a6.376 6.376 0 0 0-5.719-5.72z"})]})},I=(0,g().wt)("donutChartWarning",x,"default");var k=()=>n(706021),w=()=>n(69708),C=()=>n(100622),A=()=>n(908201),T=()=>n(132389),j=()=>n(232930),M=()=>n(466088),_=()=>n(272509),P=()=>n(944369),D=()=>n(752860),E=()=>n(528093),R=()=>n(823541),B=()=>n(391930);const F=(0,w().YK)({generic:{id:"CollectionChartError.somethingWrong",defaultMessage:"Something is wrong with your chart data."},timeout:{id:"CollectionChartError.queryCollectionTimeoutBody",defaultMessage:"Oops! Your chart is taking too long to load."},offline:{id:"CollectionChartError.offlineBody",defaultMessage:"Go online to view this chart"}}),N=(0,w().YK)({fixable:{id:"CollectionChartError.fixableButton",defaultMessage:"Help me fix"},queryCollectionTimeout:{id:"CollectionChartError.queryCollectionTimeoutButton",defaultMessage:"Learn more"},learnMore:{id:"CollectionChartError.learnMoreButton",defaultMessage:"Learn more"}});const L=function(e){const{chartError:t,collectionSettingsStore:i,chartType:l}=e,d=(0,s().v3)(),u=(0,A().Ks)(),g=(0,o().K8)((()=>Boolean(null==u?void 0:u.isDashboardWidget())),[u]),h=(0,a.useCallback)((()=>{if((0,p().QW)(t)&&i)i.setState({open:!0,stack:[{type:"main"}]});else if("queryCollection_timeout"===t){const e=(0,j().x)("database.loadTimesAndPerformance");(0,D().L)({environment:d,url:e})}else{const e=(0,j().x)("guides.charts");(0,D().L)({environment:d,url:e})}}),[t,i,d]),f=(0,r().IS)((()=>({offlineErrorWrapper:{...(0,B()._)(g),width:"100%"},offlineErrorIcon:{fill:C().Tj.text.secondary},offlineErrorTitle:{fontSize:14,color:C().Tj.text.secondary,fontWeight:void 0}})),[g]);return"offline"===t?(0,m.jsx)(n(615927).Ay,{title:W(t),icon:(0,m.jsx)(c().I,{icon:n(553034).C,size:25,style:f.offlineErrorIcon}),style:f.offlineErrorWrapper,titleStyle:f.offlineErrorTitle}):"paywall"===t?(0,m.jsx)(O,{}):(0,m.jsx)(V,{icon:l?z[l]:v,body:W(t),buttonMessage:U(t),onClick:h})};function O(){var e;const t=(0,s().v3)(),n=(0,i().L)(),r=(0,o().K8)((()=>(0,_().I)(n)),[n]),c=(0,A().Ks)(),u=(0,o().K8)((()=>Boolean(null==c?void 0:c.isDashboardWidget())),[c]),p=(0,a.useMemo)((()=>(0,P().m)({environment:t})),[t]),g=t.device.isMobileNative&&!p,h=(0,o().K8)((()=>(0,M().w)(t)),[t]),y=r||h,v=(0,E()._)({name:"view_chart",spaceId:null==n?void 0:n.id,userId:null===(e=t.currentUser)||void 0===e?void 0:e.id,amount:"unknown"}),S=(0,k().Xq)(v);let b,x;return b=h||r?(0,m.jsx)(w().sA,{id:"CollectionChartError.paywallTitleSignedOut",defaultMessage:"This workspace has already used its 1 free chart."}):(0,m.jsx)(w().sA,{id:"CollectionChartError.paywallTitle",defaultMessage:"Your workspace has already used its 1 free chart."}),!y&&g?x=(0,m.jsx)(w().sA,{id:"CollectionChartError.paywallBodyMobileNative",defaultMessage:"Unfortunately, unlimited charts cannot be purchased on mobile."}):y||(x=(0,m.jsx)(w().sA,{id:"CollectionChartError.paywallBody",defaultMessage:"Upgrade to get unlimited charts. <learnmore>Learn more.</learnmore>",values:{learnmore:e=>(0,m.jsx)(d().V,{href:(0,j().x)("guides.charts"),external:!0,hoverColor:"blue",children:e})}})),S?(0,m.jsx)(l().Ye,{alignItems:"center",justifyContent:"center",style:{width:"100%",...(0,B()._)(u)},children:(0,m.jsx)(R().V,{icon:f,title:b,description:x,source:"database_chart_paywall",upsell:S,spaceStore:n})}):null}function V(e){const t=(0,A().Ks)(),n=(0,o().K8)((()=>Boolean(null==t?void 0:t.isDashboardWidget())),[t]),a=(0,r().IS)((()=>({container:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%",textAlign:"center",...(0,B()._)(n),fontSize:14},errorIcon:{width:48,height:48,fill:C().Tj.icon.tertiary},message:{color:C().Tj.text.tertiary,textAlign:"center",textWrap:"balance"},button:{width:"fit-content",height:"initial",fontSize:14,fontWeight:500,border:`1px solid ${C().Tj.outlineButtonBorder}`,lineHeight:"18px",padding:"7px 12px"}})),[n]);return(0,m.jsxs)("div",{style:a.container,children:[e.icon?e.icon(a.errorIcon):(0,m.jsx)(c().I,{icon:v,style:a.errorIcon}),(0,m.jsx)(T().A,{size:16}),(0,m.jsx)("span",{style:a.message,children:e.body}),(0,m.jsx)(T().A,{size:16}),e.buttonMessage?(0,m.jsx)(u().p,{style:a.button,onClick:e.onClick,iconLeading:e.buttonIcon?{icon:e.buttonIcon,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"}:void 0,children:(0,m.jsx)("span",{children:e.buttonMessage})}):void 0]})}const z={column:v,bar:v,line:b,donut:I,placeholder:v};function W(e){return(0,p().QW)(e)?(0,m.jsx)(w().sA,{...F.generic}):"queryCollection_timeout"===e?(0,m.jsx)(w().sA,{...F.timeout}):"offline"===e?(0,m.jsx)(w().sA,{...F.offline}):(0,m.jsx)(w().sA,{...F.generic})}function U(e){return(0,p().QW)(e)?(0,m.jsx)(w().sA,{...N.fixable}):"queryCollection_timeout"===e?(0,m.jsx)(w().sA,{...N.queryCollectionTimeout}):(0,m.jsx)(w().sA,{...N.learnMore})}},188158:(e,t,n)=>{n.d(t,{X_:()=>T,c2:()=>j});n(944114),n(898992),n(672577),n(581454);var a=n(296540),i=()=>n(338381),s=()=>n(221844),o=()=>n(484714),r=()=>n(590526),l=()=>n(295633),c=()=>n(902006),d=()=>n(179034),u=()=>n(201980),p=()=>n(924703),g=()=>n(534177),m=()=>n(485601),h=()=>n(43893),f=()=>n(486674),y=()=>n(594794),v=()=>n(151838),S=()=>n(141465),b=()=>n(150984),x=()=>n(680325),I=()=>n(483730),k=()=>n(143016),w=()=>n(390109),C=n(474848);const A="AssistantChatMessageRenderer";function T(e){const{clientStep:t,parentStore:n,disabled:i,searchResultsSteps:l,sessionId:c}=e,u=(0,o().v3)(),p=(0,a.useMemo)((()=>new(s().A)({name:A,isSyntheticAssistantData:!0,isTemporaryData:!0,relatedAssistantSessionId:c})),[c]),g=(0,a.useMemo)((()=>(0,y().Z1)({environment:u,table:d().ev,spaceId:n.pointer.spaceId})),[u,n.pointer.spaceId]),S=(0,r().uB)(void 0,k().D),T=e.citationHoverStore??S,{citationOrdering:M,evaluatorState:_}=(0,r().K8)((()=>{var e;const a=I().default.getActiveSession(),i=null===(e=(0,f().a)())||void 0===e?void 0:e.id;return{citationOrdering:(0,x().wo)({clientChatStep:t,searchResultsSteps:l,evaluatorState:null==a?void 0:a.evaluatorFromStoreState.state,parentStore:n,currentPageId:i}),evaluatorState:null==a?void 0:a.evaluatorFromStoreState.state}}),[l,t,n]),P=(0,b().useTemporaryListStoreForClientChatStep)({environment:u,clientStep:t,citationOrdering:M,evaluatorState:_,inMemoryRecordCache:p,listId:g}),D=(0,a.useMemo)((()=>e.wrapperRef??a.createRef()),[e.wrapperRef]);j({containerRef:D,citationHoverStore:T,parentStore:n,evaluatorState:_});const E=(0,C.jsx)(v().A,{store:P,render:()=>(0,C.jsx)(m().c,{displayName:"AssistantChatStepContent",disabled:!0,children:(0,C.jsx)(h().A,{store:P,disabled:!1,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0,disableSelection:!1})})});return e.disableWrap?(0,C.jsx)(C.Fragment,{children:E}):(0,C.jsx)(w().qX,{ref:D,clientStep:t,disabled:i,children:E})}function j(e){const{containerRef:t,citationHoverStore:n,parentStore:s,evaluatorState:o}=e,d=(0,r().K8)((()=>{const e=S().A.state;if(!e||"token"!==e.type||!t.current||!i().gR(t.current,e.token.node))return;const n=e.annotations.find(u().bZo);if(!n)return;const a=u().NpB(n);if(void 0===a.type||"query_database_result"===a.type);else{if("helpdoc"===a.type||"helpdoc-section"===a.type||"url"===a.type||"webpage"===a.type||u().E_d(a)){const t=(0,x().yE)({hrefOrBlockId:a.href,evaluatorState:o,parentStore:s});return{type:"token",citationType:"universal_search",href:(0,c().Ve)(t),node:e.token.node}}if("block"===a.type){const t=n?a.scrollToBlockId||a.blockId:void 0;if(!t||!s)return;const i=l().B.createChildStore(s,{table:"block",id:t}).getNavigableBlockStore();if(!i)return;return{type:"token",citationType:"notion",pageId:i.id,blockId:i.id===t?void 0:t,node:e.token.node,discussionId:a.discussionId,snapshotTimestamp:a.snapshotTimestamp}}(0,g().HB)(a.type)}}),[t,s,o]),m=(0,a.useRef)([]);(0,a.useEffect)((()=>{n.setState(d)}),[n,d]),(0,r().K8)((()=>{var e;for(const t of m.current)t.style.removeProperty("background-color");if(d)return;const a=[];if("list"===(null===(e=n.state)||void 0===e?void 0:e.type)&&t.current){let e;const i=n.state.citationType;if("notion"===i){e=`${(n.state.blockIds.length>0?n.state.blockIds:[n.state.pageId]).map((e=>`[${p().Je}='${e}']`)).join(",")}`}else"universal_search"===i?e=`[${p().TL}='${n.state.href}']`:(0,g().HB)(i);const s=t.current.querySelectorAll(e);for(const t of Array.from(s))t instanceof HTMLElement&&t&&a.push(t)}m.current=a}),[n,t,d]),(0,a.useEffect)((()=>()=>{for(const e of m.current)e.style.removeProperty("background-color")}),[])}},190547:(e,t,n)=>{n.d(t,{v:()=>o});var a=n(296540),i=()=>n(590526),s=()=>n(988083);function o(e={}){const{enabled:t=!0,timeoutMs:n=50}=e,[o,r]=(0,a.useState)(!1),l=(0,a.useRef)(n);l.current=n;const c=(0,i().K8)((()=>s().A.state.phase),[]),d=(0,i().K8)((()=>s().A.keyboardHeight()),[]);return(0,a.useEffect)((()=>{if(t){r(!0);const e=setTimeout((()=>{r(!1)}),l.current);return()=>clearTimeout(e)}r(!1)}),[d,c,t]),o}},191197:(e,t,n)=>{n.d(t,{i:()=>i,z:()=>s});var a=()=>n(314529);function i(e,t){const{from:n}=t;(0,a().DO_NOT_USE_trackLegacy)(e,"show_tooltip",{from:n,time:Date.now()})}function s(e,t){const{from:n}=t;(0,a().DO_NOT_USE_trackLegacy)(e,"dismiss_tooltip",{from:n,time:Date.now()})}},192962:(e,t,n)=>{n.d(t,{M:()=>l});n(16280),n(898992),n(672577);var a=()=>n(792057),i=()=>n(24279),s=()=>n(206267),o=()=>n(483730),r=()=>n(808725);async function l(e){const{environment:t,sessionId:n,commands:l,updater:c}=e,d=o().default.getSessionContextOrThrow(n).evaluatorFromStoreState.createAssistantStep(l),{observations:u}=await(0,r().T)({environment:t,step:d,commit:!0,inferenceId:s().JW(),isStreaming:!1,sessionId:n,updater:c}),p=u.find(i().XO);if(p)throw a().rG({message:p.value}),console.error(p),new Error(p.value)}},193620:(e,t,n)=>{n.d(t,{Jj:()=>h,Ke:()=>m,nv:()=>f});var a=n(296540),i=()=>n(401497),s=()=>n(807449),o=()=>n(31511),r=()=>n(160432),l=()=>n(344417),c=()=>n(69708),d=()=>n(100622),u=()=>n(496603),p=()=>n(34303),g=n(474848);let m=function(e){return e.OnChange="on-change",e.Button="button",e.AnimatedSearchButton="animated-search-button",e}({});const h=(0,c().YK)({placeholder:{id:"adminContentSearchTab.pagesTable.filters.query.placeholder",defaultMessage:"Search by page ID, title or content"},titleOnlyPlaceholder:{id:"settings.workspaceAnalytics.contentTab.placeholder",defaultMessage:"Search by title"}});function f({mode:e,query:t,setQueryFilter:n,placeholderText:f,disabled:y}){const v=(0,c().tz)(),[S,b]=(0,a.useState)(t??""),x=function(e){return(0,i().IS)((()=>({input:{paddingTop:4,paddingInlineEnd:4,paddingBottom:4,paddingInlineStart:10,margin:"0 auto 8px",width:"100%",background:d().Tj.background.elevated,opacity:e?.5:1},button:{opacity:e?.5:1},searchInputContainer:{display:"flex",justifyContent:"flex-end",alignItems:"center",flexDirection:"row"}})),[e])}(y),I=(0,a.useMemo)((()=>(0,u().sg)(n,500)),[n]),k=(0,a.useCallback)((t=>{void 0===t&&e===m.AnimatedSearchButton||(b(t??""),e!==m.OnChange&&e!==m.AnimatedSearchButton||I(t??""))}),[I,e]),w=(0,a.useCallback)((e=>{k(e.target.value)}),[k]);return e===m.AnimatedSearchButton?(0,g.jsx)("div",{style:x.searchInputContainer,children:(0,g.jsx)(p().A,{handleSearchQueryChange:k,handleEnterPressed:()=>n(S),handleInputCleared:()=>n(""),isSearchBarAlwaysOpen:!1})}):(0,g.jsx)(o().A,{value:S,style:x.input,left:(0,g.jsx)(s().I,{icon:l().magnifyingGlassSmallIcon,size:"sm",colorVariant:"tertiary",fitToViewBox:"horizontal"}),placeholder:f||v.formatMessage(h.placeholder),focus:!y&&void 0,onChange:w,onSubmit:()=>n(S),disabled:y,right:e===m.Button?(0,g.jsx)(r().A,{colorPalette:"blue",onClick:()=>n(S),disabled:y,style:x.button,children:(0,g.jsx)(c().sA,{id:"adminContentSearchTab.pagesTable.filters.query.searchButton",defaultMessage:"Search"})}):null})}},198630:(e,t,n)=>{n.d(t,{f:()=>k});var a=n(296540),i=()=>n(300474),s=()=>n(920198),o=()=>n(484714),r=()=>n(590526),l=()=>n(401497),c=()=>n(249046),d=()=>n(265060),u=()=>n(406094),p=()=>n(493552),g=()=>n(25729),m=()=>n(132855),h=()=>n(100622),f=()=>n(534177),y=()=>n(284371),v=()=>n(179030),S=()=>n(62368),b=()=>n(949305),x=()=>n(528093),I=n(474848);function k(e){const{sunsetCheckSource:t,additionalOnClickUpgrade:n}=e,k=(0,i().r)(),w=(0,o().v3)().currentUser.id,C=(0,x()._)({name:"ai_connectors",spaceId:k,userId:w}),{upsellMessage:A,upsellHeader:T,actionButtonMsg:j,actionForFeatureAvailability:M,isSunset:_}=(0,b().x)({featureAvailability:C,upsellFrom:"ai_connectors_sunset_banner",sunsetCheckSource:t}),P=(0,a.useCallback)((()=>{M&&M(),n&&n()}),[M,n]),D=(0,s().L)(),E=(0,r().K8)((()=>!!D&&(0,S().p)(D)),[D]),R=(0,l().IS)((()=>({title:{fontSize:y().J.UIRegular.desktop,fontWeight:y().Wy.regular,color:h().Tj.text.secondary},wrapperStyle:"assistant_overflow_menu_add_connectors"===t?{paddingTop:3,paddingInlineEnd:0,paddingBottom:0,paddingInlineStart:0}:"ai_settings_banner"===t?{marginBottom:24}:"ai_connectors_modal"===t?{padding:"0px 20px"}:{}})),[t]),{bannerIcon:B,bannerLabel:F,bannerDescription:N,bannerActions:L}=(0,a.useMemo)((()=>{switch(t){case"assistant_overflow_menu_add_connectors":return{bannerIcon:void 0,bannerLabel:(0,I.jsxs)(c().Ye,{gap:8,alignItems:"center",children:[(0,I.jsx)(d().Q,{iconGroup:g().k,variantName:"fill",colorPalette:"blue",colorVariant:"accentPrimary"}),(0,I.jsx)("div",{style:{maxWidth:360,whiteSpace:"pre-wrap"},children:T})]}),bannerDescription:(0,I.jsx)("div",{style:{maxWidth:360,whiteSpace:"pre-wrap"},children:A}),bannerActions:[{isCustom:!0,render:()=>(0,I.jsx)(u().A,{onClick:P,children:(0,I.jsx)(p().D,{styleKey:"bodyMedium",colorVariant:"primary",children:j})})}]};case"ai_settings_banner":return{bannerIcon:void 0,bannerLabel:(0,I.jsxs)(c().Ye,{alignItems:"center",justifyContent:"space-between",style:{marginBottom:-4},children:[(0,I.jsxs)(c().Ye,{gap:8,alignItems:"center",children:[(0,I.jsx)(d().Q,{iconGroup:g().k,variantName:"fill",colorPalette:"blue",colorVariant:"accentPrimary"}),(0,I.jsx)("div",{style:R.title,children:A})]}),(0,I.jsx)(u().A,{onClick:P,children:(0,I.jsx)(p().D,{styleKey:"bodyMedium",colorVariant:"primary",children:j})})]}),bannerDescription:void 0,bannerActions:void 0};case"ai_connectors_modal":return{bannerIcon:m().arrowInCircleUpFillIcon,bannerLabel:T,bannerDescription:A,bannerActions:[{isCustom:!0,render:()=>(0,I.jsx)(u().A,{onClick:P,children:(0,I.jsx)(p().D,{styleKey:"bodyMedium",colorVariant:"primary",children:j})})}]};default:(0,f().HB)(t)}}),[t,T,A,j,P,R]);return _&&M&&E&&C?(0,I.jsx)("div",{style:R.wrapperStyle,children:(0,I.jsx)(v().l,{staticIcon:B,iconColor:"blue",display:"inline",tint:"gray",label:F,description:N,actions:L})}):null}},201145:(e,t,n)=>{n.d(t,{y:()=>c});var a=()=>n(920198),i=()=>n(230711),s=()=>n(726637),o=()=>n(590526),r=()=>n(795523),l=()=>n(979340);function c(e){const t=(0,i().U2)(),n=(0,o().K8)((()=>Boolean((null==t?void 0:t.isMember())&&!(null!=t&&t.isWorkspaceOwner()))),[t]),c=(0,a().L)(),d=(0,o().K8)((()=>null==c?void 0:c.getDisableMemberUpgradeRequests()),[c]);return!s().A.isMobile&&(!d&&(!!(0,l().jR)((0,r().AI)(e))&&(!(0,r().et)(e)&&n)))}},215003:(e,t,n)=>{n.d(t,{C:()=>r});var a=()=>n(242422),i=()=>n(484714),s=()=>n(590526),o=()=>n(521350);function r(){const e=(0,i().v3)();return(0,s().K8)((()=>{if(!(0,o().wz)({environment:e,featureKey:"adoption_new_user_agent_onboarding_joiner_v2"}))return{variant:void 0};return{variant:a().default.getEligibleGroup({experimentId:"adoption_new_user_agent_onboarding_joiner_v2",disableExposureLogging:!0}),hasSeenNewUserOnboardingJoinerV2Experience:(0,o().dp)({environment:e})}}),[e])}},215103:(e,t,n)=>{n.d(t,{w:()=>r});n(296540);var a=()=>n(69708),i=()=>n(358296),s=n(474848);const o=(0,a().YK)({attemptedReplaceButNoOperations:{id:"assistantActions.attemptedReplaceButNoOperations",defaultMessage:"It appears there was nothing to change. Can I help you with anything else?"}});function r(){const e=(0,a().tz)();return(0,s.jsx)(i().r,{text:e.formatMessage(o.attemptedReplaceButNoOperations)})}},216128:(e,t,n)=>{n.d(t,{R:()=>s});n(296540);var a=n(474848);const i={viewBox:"0 0 16 16",fittedViewBox:"3.41 3.05 9.98 9.9",directional:!0,svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M4.482 3.238a.625.625 0 1 0-.884.884L7.476 8l-3.878 3.878a.625.625 0 0 0 .884.884l4.32-4.32a.625.625 0 0 0 0-.884z"}),(0,a.jsx)("path",{d:"M8.882 3.238a.625.625 0 0 0-.884.884L11.876 8l-3.878 3.878a.625.625 0 0 0 .884.884l4.32-4.32a.625.625 0 0 0 0-.884z"})]})},s=(0,n(340498).wt)("arrowChevronDoubleForwardSmall",i,"small")},218315:(e,t,n)=>{n.d(t,{HJ:()=>p,a3:()=>u,pu:()=>r});n(16280),n(944114),n(811558),n(898992),n(430670);var a=()=>n(973647),i=()=>n(691309);const s=Symbol("ReturnValueUnhandled");class o{constructor(){this.loadPage=()=>Promise.resolve({error:s}),this.loadDatabase=()=>Promise.resolve({error:s}),this.loadSlack=()=>Promise.resolve({error:s}),this.loadGoogleDrive=()=>Promise.resolve({error:s}),this.loadGithub=()=>Promise.resolve({error:s}),this.loadJira=()=>Promise.resolve({error:s}),this.loadLinear=()=>Promise.resolve({error:s}),this.loadBox=()=>Promise.resolve({error:s}),this.loadSalesforce=()=>Promise.resolve({error:s}),this.loadGithubCode=()=>Promise.resolve({error:s}),this.loadMicrosoftTeams=()=>Promise.resolve({error:s}),this.loadSharepoint=()=>Promise.resolve({error:s}),this.loadWebPage=()=>Promise.resolve({error:s}),this.loadPdf=()=>Promise.resolve({error:s}),this.searchDatabases=()=>Promise.resolve({error:s}),this.addOperation=()=>{},this.chat=()=>{},this.randomID=()=>({error:s})}}class r extends(()=>n(658102))().eg{constructor(e,t,n,a=void 0){super(e,a),this.modules=void 0,this.evaluatorStateContext=t,this.assistantLoggingData=a,this.modules=n??[]}static createForBuilder(e,t,n,a=void 0){return new r(e,t,n,a)}static newBuilder(e,t){return new l(e??{},t)}get moduleContext(){return{...this.evaluatorStateContext,randomID:()=>this.randomID()}}clone(){const e=new r(this.getContext(),this.evaluatorStateContext,this.modules,this.assistantLoggingData);return e.inheritPropsFromClonedParent(this),e}addOperation(e,t){for(const n of this.modules)n.addOperation(this.moduleContext,e,t)}async loadPage(e){for(const t of this.modules){const n=await t.loadPage(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have mock page for ID: ${e}`)}async loadSlack(e){for(const t of this.modules){const n=await t.loadSlack(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have mock slack for ID: ${e}`)}async loadGoogleDrive(e){for(const t of this.modules){const n=await t.loadGoogleDrive(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have mock Google Drive for ID: ${e}`)}async loadGithub(e){for(const t of this.modules){const n=await t.loadGithub(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have mock Github for ID: ${e}`)}async loadJira(e){for(const t of this.modules){const n=await t.loadJira(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have mock Jira for ID: ${e}`)}async loadLinear(e){for(const t of this.modules){const n=await t.loadLinear(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have mock Linear for ID: ${e}`)}async loadBox(e){for(const t of this.modules){const n=await t.loadBox(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have mock Box for ID: ${e}`)}async loadSalesforce(e){for(const t of this.modules){const n=await t.loadSalesforce(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have mock Salesforce for ID: ${e}`)}async loadGithubCode(e){for(const t of this.modules){const n=await t.loadGithubCode(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have mock Github for ID: ${e}`)}async loadMicrosoftTeams(e){for(const t of this.modules){const n=await t.loadMicrosoftTeams(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have mock Microsoft Teams for ID: ${e}`)}async loadSharepoint(e){for(const t of this.modules){const n=await t.loadSharepoint(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have mock Sharepoint for ID: ${e}`)}async loadWebPage(e){for(const t of this.modules){const n=await t.loadWebPage(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have mock web page for ID: ${e}`)}async loadPdf(e){for(const t of this.modules){const n=await t.loadPdf(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have mock pdf for ID: ${e}`)}async loadDatabase(e){for(const t of this.modules){const n=await t.loadDatabase(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have mock database for ID: ${e}`)}async searchDatabases(e){for(const t of this.modules){const n=await t.searchDatabases(e);if(a().Q.isSuccess(n))return n.value}throw new Error(`Don't have data for search databases ${e}`)}chat(e){for(const t of this.modules)t.chat(e)}randomID(){for(const e of this.modules){const t=e.randomID();if(a().Q.isSuccess(t))return t.value}return super.randomID()}}class l{constructor(e,t=void 0){this.assistantContext=void 0,this.modules=void 0,this.evaluatorStateContext=e,this.assistantLoggingData=t,this.assistantContext={mode:"direct","available-commands":n(353566).Eo},this.evaluatorStateContext=e,this.modules=[]}build(){return r.createForBuilder(this.assistantContext,this.evaluatorStateContext,this.modules,this.assistantLoggingData)}buildEvaluator(e={}){return new(n(832093).g)(this.build(),{...e})}withCurrentPageNode(e){return this.assistantContext["current-page-id"]=e.attributes.id,this.with(new c({node:e}))}withAvailableCommands(e){this.assistantContext["available-commands"]=e}withPageNode(e){return this.with(new c({node:e}))}withDatabaseNode(e){return this.with(new d({node:e}))}withDeterministicIDs(){return this.with(new g)}withSimpleDeterministicIDs(e){return this.with(new m(e))}with(...e){return this.modules.push(...e),this}}class c extends o{constructor(e){super(),this.node=void 0,this.loadPage=e=>e===this.node.attributes.id?Promise.resolve({value:{pageBlockNode:this.node,relatedNodes:[],relatedDatabaseNodes:[],isNonSpaceShared:!1}}):Promise.resolve({error:s}),this.node=e.node}}class d extends o{constructor(e){super(),this.node=void 0,this.loadDatabase=e=>e===this.node.attributes.id?Promise.resolve({value:{databaseNode:this.node,relatedNodes:[]}}):Promise.resolve({error:s}),this.node=e.node}}class u extends o{constructor(...e){super(...e),this.chats=[],this.chat=e=>{const{blockIds:t,operations:n}=e;this.chats.push({blockIds:t,operations:n})}}}class p extends o{constructor(e={}){super(),this.createdBlockIds=[],this.recordMap=void 0,this.executableOperations=[],this.addOperation=(e,t,s)=>{"createBlock"===t.command&&this.createdBlockIds.push(t.blockNode.attributes.id);const o=a().Q.unwrap((0,i().Vz)({assistantOperation:t,actorPointer:n(641007).rb.pointer,getRecordValue:n(813690).xb.fromRecordMap(this.recordMap),spaceId:e.spaceId,spaceViewId:void 0,currentTimeZone:(0,n(416504).P)(),legacyNonCrdt:!s}));this.executableOperations.push({...t,operations:o,id:(0,i().Vg)(e.randomID()),inferenceId:void 0}),(0,n(328876).applyOperationsToRecordMap)({operations:(0,i().g$)(o,(0,i().qY)(),!s).operations,recordMap:this.recordMap,updateOnly:!1})},this.recordMap=e.initialRecordMap??n(388821).RecordMap.create()}get operations(){return this.executableOperations.flatMap((({operations:e})=>e))}}class g extends o{constructor(...e){super(...e),this.nextId=0,this.randomID=()=>({value:(0,n(498212).gB)("evaluator-state-id-"+this.nextId++)})}}class m extends o{constructor(e){super(),this.nextId=0,this.prefix=void 0,this.randomID=()=>({value:`${this.prefix}${this.nextId++}`}),this.prefix=e??""}}},220331:(e,t,n)=>{n.d(t,{q:()=>c});var a=n(296540),i=()=>n(726637),s=()=>n(340498),o=()=>n(515692),r=n(474848);function l(e,t){const{onClick:a,style:l}=e,c=(0,n(69708).tz)(),d=(0,n(363901).A)(!0),u=(0,n(484714).v3)(),p=(0,n(590526).K8)((()=>(0,n(466088).w)(u)),[u]),g=c.formatMessage({id:"assistantRichTextInput.insertMention.button.tooltip",defaultMessage:"Mention a person, page, or date"});return p?null:(0,r.jsx)(n(26697).m,{renderTooltip:()=>g,render:e=>(0,r.jsx)(n(695115).A,{ref:t,ariaLabel:g,icon:n(537193).b,iconStyle:{width:s().Ev.default,height:s().Ev.default},style:{marginInlineStart:0,marginInlineEnd:0,width:(0,o().h6)(i().A.isMobile),height:(0,o().h6)(i().A.isMobile),...l},onClick:a,...e,...d})})}const c=a.forwardRef(l)},223034:(e,t,n)=>{n.d(t,{Iu:()=>Ln,aV:()=>Wn,KZ:()=>za,iu:()=>Qn,LR:()=>Un});var a=n(296540),i=()=>n(59226),s=(n(944114),n(581454),()=>n(564884)),o=()=>n(300474),r=()=>n(920198),l=()=>n(230711),c=()=>n(242422),d=()=>n(484714),u=()=>n(590526),p=()=>n(401497),g=()=>n(675133),m=()=>n(792057),h=()=>n(699143),f=()=>n(250910),y=()=>n(807449),v=()=>n(695115),S=()=>n(416783),b=()=>n(265060),x=()=>n(406094),I=()=>n(631524),k=()=>n(493552),w=()=>n(287188),C=()=>n(940148),A=()=>n(26697),T=()=>n(302501),j=()=>n(902006),M=()=>n(203717),_=()=>n(340498),P=n(474848);const D={viewBox:"0 0 17 16",fittedViewBox:"-0.02 1.74 16.11 12.51",svg:(0,P.jsx)("path",{d:"m3.303 8.778.523-.522a.75.75 0 0 1 1.06 1.06L3.083 11.12a.75.75 0 0 1-1.06 0L.22 9.316a.75.75 0 1 1 1.06-1.06l.523.522V8a6.25 6.25 0 0 1 9.752-5.178.75.75 0 1 1-.842 1.242A4.75 4.75 0 0 0 3.303 8zm11-1.556.523.522a.75.75 0 0 0 1.06-1.06L14.085 4.88a.75.75 0 0 0-1.061 0L11.22 6.684a.75.75 0 0 0 1.06 1.06l.523-.522V8a4.75 4.75 0 0 1-7.41 3.936.75.75 0 1 0-.841 1.242A6.25 6.25 0 0 0 14.303 8z"})},E=(0,_().wt)("arrowCircleLoopBackwardFillSmall",D,"fillSmall");var R=()=>n(73956),B=()=>n(765974),F=()=>n(212727),N=()=>n(73822),L=()=>n(427704),O=()=>n(795523),V=()=>n(871392),z=()=>n(84262),W=()=>n(979340),U=()=>n(69708),H=()=>n(100622),K=()=>n(778078),q=()=>n(534177),$=()=>n(284371),G=()=>n(384944),Y=()=>n(706024),Q=()=>n(648685),J=()=>n(987267),X=()=>n(843014),Z=()=>n(96563),ee=()=>n(634877),te=()=>n(399613),ne=()=>n(170139),ae=()=>n(117991),ie=()=>n(907258),se=()=>n(852507),oe=()=>n(249046),re=()=>n(98126),le=()=>n(576590),ce=()=>n(103812),de=()=>n(176983),ue=()=>n(655600),pe=()=>n(461475),ge=()=>n(537429),me=()=>n(546926),he=()=>n(890492),fe=()=>n(81068),ye=()=>n(663639),ve=()=>n(736847);function Se(e){const{items:t}=e,n=(0,p().IS)((()=>({option:{paddingTop:4,paddingBottom:4},optionLabel:{fontSize:14,marginBottom:2},caption:{color:H().Tj.text.tertiary,fontSize:12,textWrap:"wrap"}})),[]),a=e=>{const{key:t,component:a,caption:i,icon:s,iconElement:o,disabled:r,action:l,labelStyleOverride:c,captionStyleOverride:d,iconStyleOverride:u,body:p}=e,g=s?s({width:_().Ev.sm,height:_().Ev.sm}):o;return{key:t,action:()=>{l()},render:e=>(0,P.jsx)(fe().A,{...e,style:n.option,title:a,titleStyle:c??n.optionLabel,captionStyle:d??n.caption,caption:i,disabled:r,left:g,leftStyle:u,body:p})}},i=t.map(((e,t)=>({key:e.key,render:e=>(0,P.jsx)(ve().A,{...e,topBorder:0!==t}),items:[a(e)]})));return(0,P.jsx)(he().A,{menuType:me().gu.Popup,minWidth:230,children:(0,P.jsx)(ye().A,{type:ye().O.Vertical,sections:i,initialFocus:void 0})})}function be(e){const{parent:t,callGetStatusAPI:n,connector:i,connectionStatus:s}=e,o=Boolean(n),[r,l]=a.useState(o),c=(0,u().O$)(ee().NT[i]),p=(0,u().K8)((()=>(0,ue().zM)(i)),[i]),g=(0,u().K8)((()=>(0,ue().hA)(i)),[i]),m=(0,u().K8)((()=>(0,ue().UK)(i)),[i]),h=(0,u().K8)((()=>(0,ue().o5)(i)),[i]),{analyticsFrom:f}=c,v=(0,u().O$)(ie().AppStoreSidebarSpaceStore),S=(0,de().J)(v),b=(0,u().O$)(ie().AppStoreSidebarSpaceViewStore),I=(0,d().v3)();(0,se().l)((async()=>{v&&o&&(l(!0),await(0,ee().getAiConnectorRefreshFunction)(i)({environment:I,spaceId:v.getSpaceId()}),l(!1))}));const k=(0,a.useMemo)((()=>{const e=[];return"action_required"!==s.type&&e.push(s.type),"action_required"===s.type&&"sharepoint_select_sites"===s.action&&e.push("sharepoint_select_sites"),"action_required"===s.type&&"microsoft_teams_select_teams"===s.action&&e.push("microsoft_teams_select_teams"),"action_required"===s.type&&("slack_re_auth"===s.action||"github_re_auth"===s.action||"linear_re_auth"===s.action||"salesforce_re_auth"===s.action)||p&&"linear"!==i?e.push("authentication_required"):"connected"===s.type&&("github"===i||"slack"===i||"salesforce"===i||"linear"===i&&g)&&e.push("authenticated_with_logout_option"),(S||(0,j().q1)(i))&&"disconnecting"!==s.type&&"in_progress"!==s.type&&e.push("settings"),e}),[s,p,S,i,g]);return r?(0,P.jsx)(oe().Ye,{style:{width:200,height:50,justifyContent:"center",alignItems:"center"},children:(0,P.jsx)(re().k,{})}):(0,P.jsx)(Se,{items:k.map((e=>"in_progress"===e?{key:"ingestion-status-connecting",component:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.connecting",defaultMessage:"Connecting..."}),caption:(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{children:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.subtext",defaultMessage:"This can take up to {hours} hours",values:{hours:Qn(i)}})}),"in_progress"===s.type&&s.ingestionProgress?(0,P.jsx)("div",{children:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.subtextWithPercent",defaultMessage:"{percentComplete}% complete",values:{percentComplete:s.ingestionProgress}})}):void 0]}),iconElement:(0,P.jsx)(y().I,{icon:E,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"}),disabled:!0,action:()=>{}}:"connected"===e?{key:"ingestion-status-connected",component:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.connected",defaultMessage:"Connected"}),caption:(0,P.jsx)(xe,{connector:i,orgName:m}),iconElement:(0,P.jsx)(y().I,{icon:R().checkmarkFillSmallIcon,size:"sm",colorVariant:"tertiary"}),disabled:!0,action:()=>{}}:"disconnecting"===e?{key:"ingestion-status-disconnecting",component:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.disconnecting",defaultMessage:"Disconnecting {connector}",values:{connector:J().w0[i]}}),caption:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.disconnecting.subtext",defaultMessage:"This can take up to 3 hours."}),iconElement:(0,P.jsx)(y().I,{icon:E,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"}),disabled:!0,action:()=>{}}:"authentication_required"===e?{key:"ingestion-status-personal-auth-not-complete",component:("slack"===i||"github"===i||"linear"===i||"salesforce"===i)&&(0,P.jsx)(ge().cy,{connector:i,parent:t,showDismiss:!1,shouldDismiss:!1}),disabled:!0,action:()=>{}}:"authenticated_with_logout_option"===e?{key:"ingestion-status-logged-in",component:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.logged_in",defaultMessage:"Logged in"}),caption:h?(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.logged_in.subtext_with_external_username",defaultMessage:"Your {connector} user {externalUsername} is connected to Notion AI.",values:{connector:J().w0[i],externalUsername:h}}):(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.logged_in.subtext",defaultMessage:"Your {connector} user is connected to Notion AI.",values:{connector:J().w0[i]}}),body:(0,P.jsx)(x().A,{onClick:()=>{b&&("github"!==i&&"linear"!==i&&"salesforce"!==i||(0,le().disconnectConnectorPersonalAuth)({connector:i,sidebarSpaceViewStore:b,environment:I}))},children:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.logged_in.disconnect",defaultMessage:"Disconnect"})}),iconElement:(0,P.jsx)(y().I,{icon:R().checkmarkFillSmallIcon,size:"sm",colorVariant:"tertiary"}),disabled:!0,action:()=>{}}:"microsoft_teams_select_teams"===e?{key:"ingestion-status-microsoft-teams-select-teams",component:(0,P.jsx)(pe().n,{}),disabled:!0,action:()=>{}}:"sharepoint_select_sites"===e?{key:"ingestion-status-sharepoint-select-sites",component:(0,P.jsx)(ce()._u,{canAdmin:S}),disabled:!0,action:()=>{}}:"settings"===e?{key:"ingestion-status-settings",component:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.settings",defaultMessage:"Settings"}),icon:F().gearIcon,disabled:!1,action:()=>{null==t||t.close(),(0,le().navigateToAIConnectorSettingsScreen)({connector:i,analyticsFrom:f,sessionId:c.sessionId})}}:void(0,q().HB)(e)))})}function xe(e){const{connector:t,orgName:n}=e;return"gmail"===t||"google-drive"===t?n?(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.connected.subtext.googleWorkspace",defaultMessage:"Google Workspace {orgName} is connected to Notion.",values:{connector:J().w0[t],orgName:n}}):(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.connected.subtext.googleWorkspace.withoutOrgName",defaultMessage:"{connector} is connected to Notion.",values:{connector:J().w0[t]}}):"github"===t?n?(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.connected.subtext.github",defaultMessage:"{connector} organization {orgName} is connected to Notion.",values:{connector:J().w0[t],orgName:n}}):(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.connected.subtext.github.withoutOrgName",defaultMessage:"{connector} is connected to Notion.",values:{connector:J().w0[t]}}):(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.ingestion.connected.subtext",defaultMessage:"{connector} workspace{maybeOrgName} is connected to Notion.",values:{connector:J().w0[t],maybeOrgName:n?` ${n}`:""}})}var Ie=()=>n(424416);var ke=()=>n(311546);n(898992),n(354520);const we={viewBox:"0 0 16 16",fittedViewBox:"1.89 1.89 12.21 12.21",svg:(0,P.jsx)("path",{fillRule:"evenodd",d:"M8 1.9a6.1 6.1 0 1 1 0 12.202A6.1 6.1 0 0 1 8 1.9m3.111 4.724a.44.44 0 0 0-.553-.056l-.069.056-.902.902a.44.44 0 0 0 .623.622l.15-.15V8a2.36 2.36 0 0 1-3.966 1.73.44.44 0 0 0-.6.645A3.24 3.24 0 0 0 11.24 8v-.002l.152.15a.44.44 0 0 0 .622-.622zM8 4.76A3.24 3.24 0 0 0 4.76 8v.002l-.15-.15a.44.44 0 0 0-.623.622l.902.902c.15.15.383.168.553.056l.069-.056.902-.902a.44.44 0 0 0-.623-.622L5.64 8a2.361 2.361 0 0 1 3.966-1.73.44.44 0 0 0 .6-.646A3.23 3.23 0 0 0 8 4.76",clipRule:"evenodd"})},Ce=(0,_().wt)("arrowsCircleinCircleFillSmall",we,"fillSmall");var Ae=()=>n(349679),Te=()=>n(937854);function je(e){const{parent:t,from:n}=e,a=(0,r().L)(),i=(0,p().IS)((()=>({bannerLikeIcon:{alignSelf:"flex-start",marginBottom:48,marginInlineEnd:4},caption:{color:H().Tj.text.tertiary,fontSize:$().J.UISmall.desktop,textWrap:"wrap"},option:{paddingTop:4,paddingBottom:4},optionLabel:{fontSize:14,marginBottom:2},disabledOptionLabel:{color:H().Tj.text.tertiary,fontSize:14,marginBottom:2}})),[]),s=(0,de().J)(a),o=(0,u().K8)((()=>Te().EF.state.jiraSyncState),[]),l=(0,u().K8)((()=>Te().EF.state.analyticsFrom),[]),c="completed"===o,d=[{key:"jira-connection-section",render:e=>(0,P.jsx)(ve().A,{...e}),items:[{key:"jira-ingestion-status-connecting",label:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.connecting",defaultMessage:"Connecting"}),caption:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.subtext",defaultMessage:"Your workspace owner is connecting Jira. This can take up to 36 hours"}),iconElement:(0,P.jsx)("div",{style:i.bannerLikeIcon,children:(0,P.jsx)(y().I,{icon:Ce,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"})}),disabled:!0,hidden:!("in_progress"===o||"editing"===o||"pending_installation"===o),action:()=>{}},{key:"jira-ingestion-status-connected",label:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.connected",defaultMessage:"Connected"}),caption:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.connected.subtext",defaultMessage:"Connected by workspace owner"}),icon:Ae().checkmarkSmallIcon,disabled:!0,hidden:!c,action:()=>{}},{key:"jira-ingestion-disconnect",label:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.disconnect",defaultMessage:"Disconnecting..."}),caption:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.disconnecting.subtext",defaultMessage:"Your workspace owner has disconnected Jira. This can take up to 3 hours."}),iconElement:(0,P.jsx)("div",{style:i.bannerLikeIcon,children:(0,P.jsx)(y().I,{icon:Ce,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"})}),disabled:!0,hidden:"disconnecting"!==o,action:()=>{}},{key:"jira-ingestion-settings",label:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.settings",defaultMessage:"Settings"}),icon:F().gearIcon,disabled:!1,hidden:"completed"!==o||!s,action:()=>{null==t||t.close(),ke().G({screenToShow:"settings",analyticsFrom:n||l||"chat_menu"})}},{key:"jira-select-projects",label:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.selectProjects",defaultMessage:"Select projects"}),icon:B().exclamationMarkTriangleFillIcon,disabled:!1,hidden:"pending_selection"!==o,action:()=>{null==t||t.close(),ke().G({screenToShow:"connection_complete_screen",analyticsFrom:n||l||"chat_menu"})}}].filter((e=>!e.hidden)).map((e=>{const{key:t,label:n,caption:a,icon:s,iconElement:o,disabled:r,action:l,labelStyleOverride:c,captionStyleOverride:d,iconStyleOverride:u}=e,p=s?s({width:12,height:12}):o;return{key:t,action:()=>l(),render:e=>(0,P.jsx)(fe().A,{...e,disabled:r,title:(0,P.jsx)(oe().Ye,{children:(0,P.jsxs)("div",{style:i.option,children:[(0,P.jsx)("div",{style:c??(r?i.disabledOptionLabel:i.optionLabel),children:n}),a?(0,P.jsx)("div",{style:d??i.caption,children:a}):void 0]})}),left:p,leftStyle:u})}}))}];return(0,P.jsx)(he().A,{menuType:me().gu.Popup,minWidth:230,children:(0,P.jsx)(ye().A,{type:ye().O.Vertical,sections:d,initialFocus:void 0})})}var Me=()=>n(236262),_e=()=>n(272286);function Pe(e){const{parent:t,from:n}=e,a=(0,p().IS)((()=>({bannerLikeIcon:{alignSelf:"flex-start",marginBottom:48,marginInlineEnd:4},caption:{color:H().Tj.text.tertiary,fontSize:$().J.UISmall.desktop,textWrap:"wrap"},option:{paddingTop:4,paddingBottom:4},optionLabel:{fontSize:14,marginBottom:2},disabledOptionLabel:{color:H().Tj.text.tertiary,fontSize:14,marginBottom:2}})),[]),i=(0,d().v3)(),s=(0,u().K8)((()=>_e().yg.state.jiraSyncState),[]),o=(0,u().K8)((()=>_e().yg.state.userConnected),[]),r=(0,u().K8)((()=>_e().yg.state.analyticsFrom),[]),l=(0,u().O$)(ie().AppStoreSidebarSpaceStore),c=(0,de().J)(l),g=(0,u().K8)((()=>null==l?void 0:l.getSpaceId()),[l]),m="completed"===s,h=[{key:"jira-connection-section",render:e=>(0,P.jsx)(ve().A,{...e}),items:[{key:"jira-ingestion-status-connecting",label:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.connecting",defaultMessage:"Connecting"}),caption:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.subtext",defaultMessage:"Your workspace owner is connecting Jira. This can take up to 36 hours"}),iconElement:(0,P.jsx)("div",{style:a.bannerLikeIcon,children:(0,P.jsx)(y().I,{icon:Ce,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"})}),disabled:!0,hidden:!("in_progress"===s||"editing"===s),action:()=>{}},{key:"jira-ingestion-status-connected",label:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.connected",defaultMessage:"Connected"}),caption:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.connected.subtext",defaultMessage:"Connected by workspace owner"}),icon:Ae().checkmarkSmallIcon,disabled:!0,hidden:!m,action:()=>{}},{key:"jira-ingestion-disconnect",label:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.disconnect",defaultMessage:"Disconnecting..."}),caption:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.disconnecting.subtext",defaultMessage:"Your workspace owner has disconnected Jira. This can take up to 3 hours."}),iconElement:(0,P.jsx)("div",{style:a.bannerLikeIcon,children:(0,P.jsx)(y().I,{icon:Ce,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"})}),disabled:!0,hidden:"disconnecting"!==s,action:()=>{}},{key:"jira-ingestion-settings",label:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.settings",defaultMessage:"Settings"}),icon:F().gearIcon,disabled:!1,hidden:"completed"!==s||!c,action:()=>{null==t||t.close(),(0,le().navigateToJiraUniversalScreen)({screenToShow:"settings",analyticsFrom:n||r||"chat_menu"})}},{key:"jira-ingestion-user-disconnect",label:(0,P.jsx)(U().sA,{id:"assistantOverflowMenu.jiraIngestion.userDisconnect",defaultMessage:"Disconnect your account"}),icon:Me().trashIcon,disabled:!1,hidden:!o||"completed"!==s,action:async()=>{null==t||t.close(),g&&await(0,le().disconnectJiraUserConnection)({spaceId:g,environment:i})}}].filter((e=>!e.hidden)).map((e=>{const{key:t,label:n,caption:i,icon:s,iconElement:o,disabled:r,action:l,labelStyleOverride:c,captionStyleOverride:d,iconStyleOverride:u}=e,p=s?s({width:12,height:12}):o;return{key:t,action:()=>l(),render:e=>(0,P.jsx)(fe().A,{...e,disabled:r,title:(0,P.jsx)(oe().Ye,{children:(0,P.jsxs)("div",{style:a.option,children:[(0,P.jsx)("div",{style:c??(r?a.disabledOptionLabel:a.optionLabel),children:n}),i?(0,P.jsx)("div",{style:d??a.caption,children:i}):void 0]})}),left:p,leftStyle:u})}}))}];return(0,P.jsx)(he().A,{menuType:me().gu.Popup,minWidth:230,children:(0,P.jsx)(ye().A,{type:ye().O.Vertical,sections:h,initialFocus:void 0})})}var De=()=>n(102271),Ee=()=>n(751699),Re=()=>n(931711),Be=()=>n(610083),Fe=()=>n(604018),Ne=()=>n(383070),Le=()=>n(592420),Oe=()=>n(47373),Ve=()=>n(232930),ze=()=>n(5813),We=()=>n(997583),Ue=()=>n(499172);function He(e){return(0,u().K8)((()=>e.getSetting("custom_agent_creation_policy")??(0,Ue().D)()),[e])}var Ke=()=>n(259985),qe=()=>n(103725),$e=()=>n(615234),Ge=()=>n(404141);var Ye=()=>n(510473),Qe=()=>n(217714),Je=()=>n(962874),Xe=()=>n(193620),Ze=()=>n(169626),et=()=>n(208993),tt=()=>n(528093),nt=()=>n(704658),at=()=>n(547149),it=()=>n(148307),st=()=>n(529099),ot=()=>n(209969),rt=()=>n(38679);const lt={viewBox:"0 0 16 16",fittedViewBox:"3.55 1.77 8.89 12.28",svg:(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("path",{d:"M8 1.775A2.375 2.375 0 0 0 5.625 4.15v2.8a2.375 2.375 0 0 0 4.75 0v-2.8A2.375 2.375 0 0 0 8 1.775M6.875 4.15a1.125 1.125 0 0 1 2.25 0v2.8a1.125 1.125 0 0 1-2.25 0z"}),(0,P.jsx)("path",{d:"M4.696 8.614a.625.625 0 0 0-1.03.71 5.26 5.26 0 0 0 3.709 2.24V12.8H4.85a.625.625 0 0 0 0 1.25h6.3a.625.625 0 0 0 0-1.25H8.625v-1.237a5.26 5.26 0 0 0 3.708-2.238.625.625 0 0 0-1.029-.71A4.01 4.01 0 0 1 8 10.35c-1.37 0-2.58-.686-3.304-1.736"})]})},ct=(0,_().wt)("microphoneSmall",lt,"small");var dt=()=>n(564613),ut=()=>n(74007),pt=()=>n(280746),gt=()=>n(333461),mt=()=>n(679132),ht=()=>n(888382),ft=()=>n(783793),yt=()=>n(303470);const vt=(0,U().YK)({title:{id:"aiVisualUpsellBanner.title",defaultMessage:"The AI workspace that works for you"},description:{id:"aiVisualUpsellBanner.description",defaultMessage:"Get the Business plan for the all-in-one AI that takes notes, searches apps, and builds workflows"},notionAiFeatures:{id:"aiVisualUpsellBanner.notionAiFeatures",defaultMessage:"Write, ask, chat"},allCoreAiFeatures:{id:"aiVisualUpsellBanner.allCoreAiFeatures",defaultMessage:"All core AI features"},meetingNotes:{id:"aiVisualUpsellBanner.meetingNotes",defaultMessage:"Meeting notes"},researchMode:{id:"aiVisualUpsellBanner.researchMode",defaultMessage:"Research mode"},notionMailAutoLabel:{id:"aiVisualUpsellBanner.notionMailAutoLabel",defaultMessage:"Notion Mail Auto Label"},searchAcross:{id:"aiVisualUpsellBanner.searchAcross",defaultMessage:"Search across"},connectorsPlusCount:{id:"aiVisualUpsellBanner.connectorsPlusCount",defaultMessage:"+2"}});function St(e){const t=(0,p().IS)((()=>({container:{height:30,borderRadius:100,border:`1px solid ${H().Tj.border.secondary}`,background:H().Tj.state.hover,display:"flex",alignItems:"center",justifyContent:"center",gap:4,paddingTop:0,paddingInlineEnd:10,paddingBottom:0,paddingInlineStart:8,width:"fit-content"}})),[]);return(0,P.jsx)("div",{style:t.container,children:e.children})}function bt(e){return(0,P.jsx)(k().D,{colorVariant:e.tertiaryColor?"tertiary":void 0,styleKey:"captionMedium",children:e.content})}function xt(e){const t=(0,U().tz)();return(0,P.jsx)(yt().w,{source:"business_trial_ai_connectors_upsell",upsell:e.upsell,title:t.formatMessage(vt.title),description:t.formatMessage(vt.description),hideOverflow:!0,rightSideVisibleMinWidth:600,spaceStore:e.spaceStore,children:(0,P.jsx)(It,{})})}function It(){const e=(0,p().IS)((()=>({rightSideContainer:{display:"flex",alignItems:"center",alignSelf:"stretch",flex:"1 0 0",justifyContent:"end"},contentsContainer:{display:"flex",alignItems:"center",flexShrink:0,position:"absolute",gap:23,paddingInlineEnd:8}})),[]);return(0,P.jsx)("div",{style:e.rightSideContainer,children:(0,P.jsxs)("div",{style:e.contentsContainer,children:[(0,P.jsxs)(h().Y1,{direction:"vertical",gap:8,align:"center-right",children:[(0,P.jsx)(kt,{}),(0,P.jsx)(At,{}),(0,P.jsx)(Tt,{}),(0,P.jsx)(jt,{}),(0,P.jsx)(wt,{}),(0,P.jsx)(Ct,{})]}),(0,P.jsx)(ft().x,{style:{cursor:"default"},variant:"upsell_banner",imgSource:it().A.images.subscriptions.nosyFacePng})]})})}function kt(){const e=(0,U().tz)();return(0,P.jsxs)(St,{children:[(0,P.jsx)(y().I,{icon:st().aiFaceIcon,size:"sm"}),(0,P.jsx)(bt,{content:e.formatMessage(vt.notionAiFeatures)})]})}function wt(){const e=(0,U().tz)();return(0,P.jsxs)(St,{children:[(0,P.jsx)(y().I,{icon:rt().P,colorPalette:"red",colorVariant:"accentPrimary",size:"sm"}),(0,P.jsx)(bt,{content:e.formatMessage(vt.researchMode)})]})}function Ct(){const e=(0,U().tz)();return(0,P.jsxs)(St,{children:[(0,P.jsx)(y().I,{icon:gt().F,size:"sm"}),(0,P.jsx)(bt,{content:e.formatMessage(vt.notionMailAutoLabel)})]})}function At(){const e=(0,U().tz)();return(0,P.jsxs)(St,{children:[(0,P.jsx)(y().I,{icon:ot().checkmarkCircleFillIcon,colorPalette:"blue",colorVariant:"accentPrimary"}),(0,P.jsx)(bt,{content:e.formatMessage(vt.allCoreAiFeatures)})]})}function Tt(){const e=(0,U().tz)();return(0,P.jsxs)(St,{children:[(0,P.jsx)(y().I,{icon:ct,size:"sm"}),(0,P.jsx)(bt,{content:e.formatMessage(vt.meetingNotes)})]})}function jt(){const e=(0,U().tz)();return(0,P.jsxs)(St,{children:[(0,P.jsx)(bt,{content:e.formatMessage(vt.searchAcross)}),(0,P.jsx)(y().I,{size:"sm",icon:ht().slackIcon}),(0,P.jsx)(y().I,{size:"sm",icon:ut().googleDriveIcon}),(0,P.jsx)(y().I,{size:"sm",icon:dt().gitHubIcon}),(0,P.jsx)(y().I,{size:"sm",icon:pt().jiraIcon}),(0,P.jsx)(y().I,{size:"sm",icon:mt().microsoftTeamsIcon}),(0,P.jsx)(bt,{content:e.formatMessage(vt.connectorsPlusCount),tertiaryColor:!0})]})}var Mt=()=>n(13898),_t=()=>n(173783),Pt=()=>n(187820),Dt=()=>n(132389),Et=()=>n(8178),Rt=()=>n(702723),Bt=()=>n(259476),Ft=()=>n(192359),Nt=()=>n(575143),Lt=()=>n(680683),Ot=()=>n(906745),Vt=()=>n(664594),zt=()=>n(128933),Wt=()=>n(970236),Ut=()=>n(416504),Ht=()=>n(187174);const Kt=[{key:"never",label:"Never",caption:"Keep transcripts indefinitely"},{key:"immediately",label:"Immediately",caption:"Delete right after the summary is generated"},{key:"one_day",label:"After 1 day",caption:"Auto-delete 24 hours after transcription"},{key:"one_week",label:"After 1 week",caption:"Auto-delete 7 days after transcription"},{key:"one_month",label:"After 1 month",caption:"Auto-delete 30 days after transcription"},{key:"one_year",label:"After 1 year",caption:"Auto-delete 365 days after transcription"}];function qt(e){switch(e){case"never":return;case"immediately":return 0;case"one_day":return $e().i5;case"one_week":return $e()._h;case"one_month":return 30*$e().i5;case"one_year":return $e().xq;default:(0,q().HB)(e)}}function $t(e){switch(e){case void 0:return"never";case 0:return"immediately";case $e().i5:return"one_day";case $e()._h:return"one_week";case 30*$e().i5:return"one_month";case $e().xq:return"one_year";default:return"never"}}const Gt=(0,U().YK)({meetingNotesAutomaticTranscriptDeletionHeader:{id:"aiSettings.meetingNotesAutomaticTranscriptDeletionHeader",defaultMessage:"Automatic transcript deletion"},meetingNotesAutomaticTranscriptDeletionDescription:{id:"aiSettings.meetingNotesAutomaticTranscriptDeletionDescription",defaultMessage:"Delete AI Meeting Notes recordings and transcripts for all users in the workspace after a set time."},meetingNotesAutomaticTranscriptDeletionRetentionUpdateError:{id:"aiSettings.meetingNotesAutomaticTranscriptDeletionRetentionUpdateError",defaultMessage:"Something went wrong while updating the retention settings. Please try again."}}),Yt=(0,U().YK)({confirmationModalExplanation:{id:"aiSettings.confirmationModal.explanation",defaultMessage:"Delete AI Meeting Notes recordings and transcripts for all users in the workspace after a set time."},confirmationModalImmediateEffect:{id:"aiSettings.confirmationModal.immediateEffect",defaultMessage:"Reducing this retention setting may lead to transcripts being deleted immediately. Please confirm."}});function Qt(e){const{spaceStore:t,disabled:n,tooltipLabel:i}=e,s=(0,d().v3)(),o=(0,U().tz)(),r=(0,u().K8)((()=>{var e;return null===(e=t.getSettings())||void 0===e?void 0:e.purge_transcripts_delay_seconds}),[t]),l=(0,u().K8)((()=>{const e=(0,Ut().P)();return Ot().DateTime.utc().set({hour:11,minute:0,second:0,millisecond:0}).setZone(e).toLocaleString({hour:"numeric",minute:"2-digit",timeZoneName:"short"})}),[]),c=(0,a.useCallback)((e=>{at().createAndCommit({userAction:"AiSettings.setAutomatedTranscriptDeletion",environment:s,canUndo:!1,perform:n=>{at().applyOperation({store:t,operation:{pointer:t.pointer,path:["settings","purge_transcripts_delay_seconds"],command:"set",args:qt(e)},transaction:n}),n.postSubmitCallbacks.push((e=>{e&&(zt().N2(),zt().D6({label:o.formatMessage(Gt.meetingNotesAutomaticTranscriptDeletionRetentionUpdateError)}))}))}})}),[s,t,o]),[,p]=(0,Ht().V$)((async e=>{if(e)if(function(e,t){const n=qt(e),a=qt(t);return void 0!==a&&(void 0===n||n>a)}($t(r),e)){const{accept:t}=await m().Gh({message:o.formatMessage(Yt.confirmationModalExplanation),description:o.formatMessage(Yt.confirmationModalImmediateEffect),icon:(0,P.jsx)(y().I,{icon:Me().trashIcon,size:24})});t&&c(e)}else c(e)}),[r,o,c]);return(0,P.jsx)(Rt().A,{spaceStore:t,type:"dropdown",currentOption:$t(r),options:Kt,onSelectOption:p,disabled:n,tooltipLabel:i,title:(0,P.jsx)(U().sA,{...Gt.meetingNotesAutomaticTranscriptDeletionHeader}),caption:(0,P.jsx)(U().sA,{...Gt.meetingNotesAutomaticTranscriptDeletionDescription}),badge:(0,P.jsx)(Wt().E,{color:"gray",content:(0,P.jsx)(U().sA,{id:"aiSettings.meetingNotesAutomaticTranscriptDeletionRetentionTriggerTime",defaultMessage:"Runs daily at {retentionTriggerTimeUserLocale}",values:{retentionTriggerTimeUserLocale:l}})})})}const Jt=(0,U().YK)({eligible_to_purchase:{id:"aiSettings.meetingNotesAutomaticTranscriptDeletionUpgradeMessages.eligibleToPurchase",defaultMessage:"<highlight>Upgrade</highlight> to set transcript auto-deletion timing."},eligible_for_trial:{id:"aiSettings.meetingNotesAutomaticTranscriptDeletionUpgradeMessages.eligibleForTrial",defaultMessage:"<highlight>Start trial</highlight> to set transcript auto-deletion timing."},sales_eligible:{id:"aiSettings.meetingNotesAutomaticTranscriptDeletionUpgradeMessages.salesEligible",defaultMessage:"<highlight>Contact sales</highlight> to set transcript auto-deletion timing"},sales_assisted:{id:"aiSettings.meetingNotesAutomaticTranscriptDeletionUpgradeMessages.salesAssisted",defaultMessage:"<highlight>Contact sales</highlight> to set transcript auto-deletion timing"},eligible_to_request:{id:"aiSettings.meetingNotesAutomaticTranscriptDeletionUpgradeMessages.eligibleToRequest",defaultMessage:"<highlight>Request access</highlight> to set transcript auto-deletion timing"},not_eligible:{id:"aiSettings.meetingNotesAutomaticTranscriptDeletionUpgradeMessages.notEligible",defaultMessage:"<highlight>Upgrade</highlight> to set transcript auto-deletion timing"},request_pending:{id:"aiSettings.meetingNotesAutomaticTranscriptDeletionUpgradeMessages.requestPending",defaultMessage:"<highlight>Requested</highlight> to set transcript auto-deletion timing"}});function Xt(e){const{spaceStore:t}=e,n=t.id,a=(0,Vt().T)(),i=(0,tt()._)({name:"ai_meeting_notes_custom_transcript_retention",spaceId:n,userId:a}),s=(0,u().K8)((()=>{var e;return null===(e=t.getSettings())||void 0===e?void 0:e.purge_transcripts_delay_seconds}),[t]),o=null==i?void 0:i.upsell;return(0,P.jsx)(Rt().A,{spaceStore:t,type:"dropdown",currentOption:$t(s),options:Kt,onSelectOption:()=>{},disabled:!0,title:(0,P.jsx)(U().sA,{...Gt.meetingNotesAutomaticTranscriptDeletionHeader}),upsellOptions:o?{upsell:o,analyticsName:"ai_meeting_notes_custom_transcript_retention",customMessages:Jt}:void 0})}const Zt=(0,U().YK)({autoPlayConsentMessageAdminSettingLabel:{id:"aiSettings.autoPlayConsentMessageAdminSetting.label",defaultMessage:"Enforce consent for all workspace members"},autoPlayConsentMessageAdminSettingDescription:{id:"aiSettings.autoPlayConsentMessageAdminSetting.description",defaultMessage:"Enforce playing an audio consent message at the start of every transcription for all workspace members"}});function en(e){const{spaceStore:t,disabled:n,tooltipLabel:i}=e,o=(0,d().v3)(),r=(0,u().K8)((()=>{var e;return(null===(e=t.getSettings())||void 0===e?void 0:e.audio_consent_on_transcription)??!1}),[t]),l=(0,a.useCallback)((()=>{(0,s().u)({environment:o,event:{eventName:"ai_meeting_notes_audio_consent_settings_update",eventProperties:{type:"workspace",update:r?"off":"on"}}}),at().createAndCommit({userAction:"AiSettings.toggleAutoPlayConsentMessageAdminSetting",environment:o,canUndo:!1,perform:e=>{at().applyOperation({store:t,operation:{pointer:t.pointer,path:["settings","audio_consent_on_transcription"],command:"set",args:!r},transaction:e})}})}),[t,o,r]);return(0,P.jsx)(Rt().A,{spaceStore:t,type:"toggle",isOn:r,onToggle:l,disabled:n,tooltipLabel:i,title:(0,P.jsx)(U().sA,{...Zt.autoPlayConsentMessageAdminSettingLabel}),caption:(0,P.jsx)(U().sA,{...Zt.autoPlayConsentMessageAdminSettingDescription})})}var tn=()=>n(72234),nn=()=>n(362075),an=()=>n(79926);const sn=new(an().O2)("AiMeetingNotesSettings",(async()=>await n.e(56840).then(n.bind(n,774577)))),on=((0,an()._h)(sn,(e=>e.ResetAudioConsentNux)),(0,U().YK)({autoPlayConsentMessageLabel:{id:"aiSettings.autoPlayConsentMessage.label",defaultMessage:"Auto play consent message on start"},autoPlayConsentMessageDescription:{id:"aiSettings.autoPlayConsentMessage.description",defaultMessage:"Automatically play an audio consent message at the start of every transcription."},autoPlayConsentMessageAdminSettingDescription:{id:"aiSettings.autoPlayConsentMessageAdminCaption.description",defaultMessage:"Set by workspace admin"}}));function rn(e){const{spaceStore:t}=e,n=(0,d().v3)(),i=(0,u().O$)(ie().AppStoreSidebarSpaceViewStore),o=(0,nn().f1)(),r=(0,u().K8)((()=>{var e;return(null==t||null===(e=t.getSettingsStore())||void 0===e||null===(e=e.getKeyStore("audio_consent_on_transcription"))||void 0===e?void 0:e.getValue())??!1}),[t]),l=(0,a.useCallback)((()=>{i&&((0,s().u)({environment:n,event:{eventName:"ai_meeting_notes_audio_consent_settings_update",eventProperties:{type:"member",update:o?"off":"on"}}}),at().createAndCommit({userAction:"AiSettings.toggleAutoPlayConsentMessage",environment:n,canUndo:!0,perform:e=>{tn().AG(i,e,{audio_consent_on_transcription:!o})}}))}),[o,i,n]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Rt().A,{spaceStore:t,type:"toggle",isOn:o,onToggle:l,title:(0,P.jsx)(U().sA,{...on.autoPlayConsentMessageLabel}),caption:(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(U().sA,{...on.autoPlayConsentMessageDescription}),r?(0,P.jsx)(k().D,{styleKey:"bodySmRegular",colorPalette:"red",colorVariant:"accentPrimary",children:(0,P.jsx)(U().sA,{...on.autoPlayConsentMessageAdminSettingDescription})}):null]}),disabled:r}),null]})}const ln=(0,U().YK)({callDetectionLabel:{id:"aiSettings.meetingNotes.callDetection.label",defaultMessage:"Call detection"},callDetectionDescription:{id:"aiSettings.meetingNotes.callDetection.description",defaultMessage:"Detects when calls start, and auto-stops transcription when you leave calls"},callDetectionDisableDialogMessage:{id:"aiSettings.meetingNotes.callDetection.disableDialog.message",defaultMessage:"Disable call detection?"},callDetectionDisableDialogDescription:{id:"aiSettings.meetingNotes.callDetection.disableDialog.description",defaultMessage:"This will also disable notifications to start meeting notes when you join calls"},callDetectionDisableDialogAcceptLabel:{id:"aiSettings.meetingNotes.callDetection.disableDialog.acceptLabel",defaultMessage:"Disable call detection"},callDetectionDisableDialogDismissLabel:{id:"aiSettings.meetingNotes.callDetection.disableDialog.dismissLabel",defaultMessage:"Dismiss"}});function cn(e){var t;const n=(0,d().v3)(),s=(0,Vt().T)(),o=(0,de().J)(e),r=(0,i().X)("meeting_notes_entrypoints_v2"),l=(0,i().X)("show_workspace_member_admin_options_read_only_enabled"),c=e.id,p=o||l,g=r,m="available"===(null===(t=(0,tt()._)({name:"ai_meeting_notes_custom_transcript_retention",spaceId:c,userId:s}))||void 0===t?void 0:t.type),h=(0,i().X)("automated_transcript_deletion"),f=(0,nn().AB)(),y=(0,i().X)("audio_consent_admin_ff")&&f,v=(0,i().X)("meeting_notes_auto_share_setting"),S=(0,u().O$)(ie().AppStoreSidebarSpaceViewStore),{meetingNotesEnabled:b,meetingNotesSaveLocalRecordingsEnabled:x}=(0,u().K8)((()=>{const t=e.getModel();return t?{meetingNotesEnabled:t.isTranscriptionEnabled(),meetingNotesSaveLocalRecordingsEnabled:t.isMeetingNotesSaveLocalRecordingsEnabled()}:{meetingNotesEnabled:!1,meetingNotesSaveLocalRecordingsEnabled:!1}}),[e]),{defaultMeetingNotesLocation:I,hideMeetingsTab:k,callDetectionEnabled:w,meetingDetectionNotificationEnabled:C,autoShareMeetingNotesEnabled:A}=(0,u().K8)((()=>{var e;const t=null==S?void 0:S.getSettings();return{defaultMeetingNotesLocation:null==t||null===(e=t.default_meeting_notes_location)||void 0===e?void 0:e.collection,hideMeetingsTab:(null==t?void 0:t.hide_meetings_tab)??!1,callDetectionEnabled:!(null==t?void 0:t.disable_ai_meeting_notes_audio_process_detection_monitoring),meetingDetectionNotificationEnabled:!(null==t?void 0:t.disable_ai_meeting_notes_audio_process_detection_notification),autoShareMeetingNotesEnabled:!((null==t?void 0:t.disable_auto_share_meeting_notes)??1)}}),[S]),T=(0,a.useCallback)((()=>{at().createAndCommit({userAction:"AiSettings.toggleTranscription",environment:n,canUndo:!1,perform:t=>{G().zv({store:e.getSettingsStore(),transaction:t,data:{disable_transcription:b}})}})}),[b,e,n]),j=(0,a.useCallback)((()=>{at().createAndCommit({userAction:"AiSettings.toggleSaveLocalRecordings",environment:n,canUndo:!1,perform:t=>{G().zv({store:e.getSettingsStore(),transaction:t,data:{disable_meeting_notes_save_local_recordings:x}})}})}),[x,e,n]),M=(0,a.useCallback)((()=>{S&&at().createAndCommit({userAction:"AiSettings.toggleHideMeetingsTab",environment:n,canUndo:!1,perform:e=>{tn().AG(S,e,{hide_meetings_tab:!k})}})}),[k,S,n]),_=(0,a.useCallback)((e=>{S&&at().createAndCommit({userAction:"AiSettings.toggleCallDetectionMonitoring",environment:n,canUndo:!1,perform:t=>{tn().AG(S,t,{disable_ai_meeting_notes_audio_process_detection_monitoring:!e.enable,...void 0===e.disableNotification?{}:{disable_ai_meeting_notes_audio_process_detection_notification:e.disableNotification}})}})}),[n,S]),P=(0,a.useCallback)((()=>{S&&at().createAndCommit({userAction:"AiSettings.toggleAutoShareMeetingNotes",environment:n,canUndo:!1,perform:e=>{tn().AG(S,e,{disable_auto_share_meeting_notes:A})}})}),[A,S,n]),D=(0,a.useCallback)((()=>{S&&at().createAndCommit({userAction:"AiSettings.removeDefaultMeetingNotesLocation",environment:n,canUndo:!1,perform:e=>{at().applyOperation({store:S,operation:{pointer:S.pointer,path:["settings","default_meeting_notes_location"],command:"set",args:void 0},transaction:e})}})}),[n,S]),E=(0,a.useCallback)((e=>{if(!S)return;const t={table:"block",id:e.id},a=e.collectionId?{table:"collection",id:e.collectionId}:void 0;at().createAndCommit({userAction:"AiSettings.setDefaultMeetingNotesLocation",environment:n,canUndo:!1,perform:e=>{at().applyOperation({store:S,operation:{pointer:S.pointer,path:["settings","default_meeting_notes_location"],command:"set",args:{block:t,collection:a}},transaction:e})}})}),[n,S]),R=(0,u().K8)((()=>Ge().Ay.state.highlightedSetting===Ge().rF.DefaultMeetingNotesLocation),[]);return{environment:n,isAdmin:o,showWorkspaceSettings:p,showDefaultDatabaseSetting:g,hasAutomaticTranscriptDeletionPremiumFeature:m,showAutomaticTranscriptDeletionSetting:h,audioConsentOnTranscriptionExperiment:f,showAutoPlayConsentAdminSetting:y,showAutoShareMeetingNotesSetting:v,meetingNotesEnabled:b,meetingNotesSaveLocalRecordingsEnabled:x,defaultMeetingNotesLocation:I,hideMeetingsTab:k,callDetectionEnabled:w,meetingDetectionNotificationEnabled:C,autoShareMeetingNotesEnabled:A,shouldHighlightDefaultLocation:R,sidebarSpaceViewStore:S,onToggle:T,onToggleSaveLocalRecordings:j,onToggleHideMeetingsTab:M,setCallDetection:_,onToggleAutoShareMeetingNotes:P,onRemoveLocation:D,onLocationSelect:E}}const dn=(0,U().YK)({meetingNotesSettingsHeader:{id:"aiSettings.meetingNotesSettingsHeader",defaultMessage:"AI Meeting Notes"},meetingNotesSettingsDescription:{id:"aiSettings.meetingNotesSettingsDescription",defaultMessage:"When enabled, all members can access the AI Meeting Notes block to automatically create transcripts and summaries of their meetings. <learnmore>Learn more</learnmore>"},meetingNotesWorkspaceAvailabilityLabel:{id:"aiSettings.meetingNotesWorkspaceAvailability.label",defaultMessage:"Workspace availability"},meetingNotesWorkspaceAvailabilityDescription:{id:"aiSettings.meetingNotesWorkspaceAvailability.description",defaultMessage:"Allow everyone in your workspace to access AI Meeting Notes."},meetingNotesSaveLocalRecordingsLabel:{id:"aiSettings.meetingNotesSaveLocalRecordings.label",defaultMessage:"Store audio locally"},meetingNotesSaveLocalRecordingsDescription:{id:"aiSettings.meetingNotesSaveLocalRecordings.description",defaultMessage:"Allow members to temporarily store a local, on-device copy of their meeting audio for added reliability. <learnmore>Learn more</learnmore>"},meetingNotesDefaultDatabaseLabel:{id:"aiSettings.meetingNotesDefaultDatabase.label",defaultMessage:"Default meetings database"},meetingNotesDefaultDatabaseDescription:{id:"aiSettings.meetingNotesDefaultDatabase.description",defaultMessage:"Link or create a new database to store new AI meeting notes."},hideMeetingsTabLabel:{id:"aiSettings.hideMeetingsTab.label",defaultMessage:"Hide meetings tab"},hideMeetingsTabDescription:{id:"aiSettings.hideMeetingsTab.description",defaultMessage:"Hide the meetings tab from the sidebar."},adminPreferencesHeader:{id:"aiSettings.adminPreferencesHeader",defaultMessage:"Admin preferences"},userPreferencesHeader:{id:"aiSettings.userPreferencesHeader",defaultMessage:"Your preferences"}});function un(e){const{spaceStore:t,headingMessage:n}=e,s=(0,U().tz)(),o=(0,i().X)("meeting_notes_entrypoints_v2"),{isAdmin:r,showDefaultDatabaseSetting:l,hasAutomaticTranscriptDeletionPremiumFeature:c,showAutomaticTranscriptDeletionSetting:d,audioConsentOnTranscriptionExperiment:u,showAutoPlayConsentAdminSetting:p,environment:g,meetingNotesEnabled:h,meetingNotesSaveLocalRecordingsEnabled:f,defaultMeetingNotesLocation:y,hideMeetingsTab:v,shouldHighlightDefaultLocation:b,callDetectionEnabled:x,meetingDetectionNotificationEnabled:I,onToggle:k,onToggleSaveLocalRecordings:w,onToggleHideMeetingsTab:C,setCallDetection:A,onRemoveLocation:j,onLocationSelect:M}=cn(t),_=g.device.isElectron,D=(0,a.useCallback)((async()=>{if(x&&I){const{accept:e}=await m().Gh({message:(0,P.jsx)(U().sA,{...ln.callDetectionDisableDialogMessage}),description:(0,P.jsx)(U().sA,{...ln.callDetectionDisableDialogDescription}),acceptLabel:s.formatMessage(ln.callDetectionDisableDialogAcceptLabel),cancelLabel:s.formatMessage(ln.callDetectionDisableDialogDismissLabel)});if(!e)return;A({enable:!1,disableNotification:!0})}else A({enable:!x})}),[x,s,I,A]);const E=l||d||u;return(0,P.jsxs)(P.Fragment,{children:[n&&E?(0,P.jsx)(Et().A,{divider:"full",hasMarginTop:!0,children:(0,P.jsx)(U().sA,{...n})}):void 0,r?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(T().A,{style:{fontWeight:$().Wy.medium,display:"flex",height:28,alignItems:"center",marginBottom:12},children:(0,P.jsx)(U().sA,{...dn.adminPreferencesHeader})}),(0,P.jsx)(Rt().A,{spaceStore:t,type:"toggle",isOn:h,onToggle:k,title:(0,P.jsx)(U().sA,{...o?dn.meetingNotesWorkspaceAvailabilityLabel:dn.meetingNotesSettingsHeader}),caption:(0,P.jsx)(U().sA,{...o?dn.meetingNotesWorkspaceAvailabilityDescription:dn.meetingNotesSettingsDescription,values:{learnmore:e=>(0,P.jsx)(S().V,{href:(0,Ft().zv)(),external:!0,onClick:e=>e.stopPropagation(),children:e})}})}),(0,P.jsx)(Dt().A,{size:8}),d?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Dt().A,{size:8}),c?(0,P.jsx)(Qt,{spaceStore:t}):(0,P.jsx)(Xt,{spaceStore:t}),(0,P.jsx)(Dt().A,{size:8})]}):void 0,(0,P.jsx)(Rt().A,{spaceStore:t,type:"toggle",isOn:f,onToggle:w,title:(0,P.jsx)(U().sA,{...dn.meetingNotesSaveLocalRecordingsLabel}),caption:(0,P.jsx)(U().sA,{...dn.meetingNotesSaveLocalRecordingsDescription,values:{learnmore:e=>(0,P.jsx)(S().V,{href:(0,Ft().HQ)(),external:!0,onClick:e=>e.stopPropagation(),children:e})}})}),(0,P.jsx)(Dt().A,{size:8}),p?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(en,{spaceStore:t}),(0,P.jsx)(Dt().A,{size:8})]}):void 0]}):void 0,(0,P.jsx)(T().A,{style:{fontWeight:$().Wy.medium,display:"flex",height:28,alignItems:"center",marginBottom:"19px"},children:(0,P.jsx)(U().sA,{...dn.userPreferencesHeader})}),_?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Rt().A,{spaceStore:t,type:"toggle",isOn:x,onToggle:D,title:(0,P.jsx)(U().sA,{...ln.callDetectionLabel}),caption:(0,P.jsx)(U().sA,{...ln.callDetectionDescription})}),(0,P.jsx)(Dt().A,{size:8})]}):void 0,(0,P.jsx)(Rt().A,{spaceStore:t,type:"toggle",isOn:v,onToggle:C,title:(0,P.jsx)(U().sA,{...dn.hideMeetingsTabLabel}),caption:(0,P.jsx)(U().sA,{...dn.hideMeetingsTabDescription})}),(0,P.jsx)(Dt().A,{size:8}),l?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Rt().A,{spaceStore:t,type:"custom",title:(0,P.jsx)(U().sA,{...dn.meetingNotesDefaultDatabaseLabel}),caption:(0,P.jsx)(U().sA,{...dn.meetingNotesDefaultDatabaseDescription}),customButton:(0,P.jsx)("div",{style:{display:"flex",alignItems:"center",gap:4},children:(0,P.jsx)(Lt().B,{value:y,onChange:M,hidePages:!0,showCollections:!0,searchOptions:{source:"ai_meeting_notes_location_picker",requireEditPermissions:!1},renderSections:function(e){return y?(e.push({key:"customFilingLocationSettingActions",items:[{key:"removeFilingLocationSetting",action:()=>j(),render:e=>(0,P.jsx)(Nt().A,{...e,svg:Bt().trashSmallIcon,isRed:!0,title:(0,P.jsx)(U().sA,{id:"aiSettings.meetingNotesDefaultDatabase.remove",defaultMessage:"Remove"})})}],render:e=>(0,P.jsx)(ve().A,{...e,topBorder:!0})}),e):e},peopleBlocksToInclude:"none"})}),shouldHighlight:b}),(0,P.jsx)(Dt().A,{size:8})]}):void 0,u?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(rn,{spaceStore:t}),(0,P.jsx)(Dt().A,{size:8})]}):void 0]})}const pn=(0,U().YK)({workspaceSettingsHeader:{id:"aiSettings.meetingNotesV2.workspaceSettingsHeader",defaultMessage:"Workspace settings"},enableMeetingNotesLabel:{id:"aiSettings.meetingNotesV2.enableMeetingNotes.label",defaultMessage:"Enable Meeting notes for workspace"},enableMeetingNotesDescription:{id:"aiSettings.meetingNotesV2.enableMeetingNotes.description",defaultMessage:"Allow everyone in your workspace to access AI Meeting Notes."},storeAudioLocallyLabel:{id:"aiSettings.meetingNotesV2.storeAudioLocally.label",defaultMessage:"Store audio locally"},storeAudioLocallyDescription:{id:"aiSettings.meetingNotesV2.storeAudioLocally.description",defaultMessage:"Allow members to temporarily store a local, on-device copy of their meeting audio for added reliability. <learnmore>Learn more</learnmore>"},personalPreferencesHeader:{id:"aiSettings.meetingNotesV2.personalPreferencesHeader",defaultMessage:"Personal preferences"},hideMeetingNotesTabLabel:{id:"aiSettings.meetingNotesV2.hideMeetingNotesTab.label",defaultMessage:"Hide Meeting notes tab"},hideMeetingNotesTabDescription:{id:"aiSettings.meetingNotesV2.hideMeetingNotesTab.description",defaultMessage:"Hides it only from your sidebar"},autoShareMeetingNotesLabel:{id:"aiSettings.meetingNotesV2.autoShareMeetingNotes.label",defaultMessage:"Auto-share with internal calendar event participants"},autoShareMeetingNotesDescription:{id:"aiSettings.meetingNotesV2.autoShareMeetingNotes.description",defaultMessage:"Automatically shares AI Meeting Notes with calendar event participants who are members of your workspace. Only applies to AI Meeting Notes that are linked to calendar events."},selectDefaultDatabaseLabel:{id:"aiSettings.meetingNotesV2.selectDefaultDatabase.label",defaultMessage:"Select default meetings database"},selectDefaultDatabaseDescription:{id:"aiSettings.meetingNotesV2.selectDefaultDatabase.description",defaultMessage:"Link or create a new database to store new AI meeting notes."},removeDefaultDatabase:{id:"aiSettings.meetingNotesV2.selectDefaultDatabase.remove",defaultMessage:"Remove"},workspaceSettingLockedTooltip:{id:"aiSettings.meetingNotesV2.workspaceSettingLockedTooltip",defaultMessage:"Contact your workspace admin to change this setting"}});function gn(e){const{spaceStore:t}=e,n=(0,U().tz)(),{isAdmin:i,showWorkspaceSettings:s,showDefaultDatabaseSetting:o,hasAutomaticTranscriptDeletionPremiumFeature:r,showAutomaticTranscriptDeletionSetting:l,audioConsentOnTranscriptionExperiment:c,showAutoPlayConsentAdminSetting:d,environment:u,meetingNotesEnabled:p,meetingNotesSaveLocalRecordingsEnabled:g,defaultMeetingNotesLocation:h,hideMeetingsTab:f,shouldHighlightDefaultLocation:y,callDetectionEnabled:v,meetingDetectionNotificationEnabled:b,autoShareMeetingNotesEnabled:x,showAutoShareMeetingNotesSetting:I,onToggle:k,onToggleSaveLocalRecordings:w,onToggleHideMeetingsTab:C,onToggleAutoShareMeetingNotes:A,onRemoveLocation:j,onLocationSelect:M,setCallDetection:_}=cn(t),D=i?void 0:n.formatMessage(pn.workspaceSettingLockedTooltip),E=u.device.isElectron,R=(0,a.useCallback)((async()=>{if(v&&b){const{accept:e}=await m().Gh({message:(0,P.jsx)(U().sA,{...ln.callDetectionDisableDialogMessage}),description:(0,P.jsx)(U().sA,{...ln.callDetectionDisableDialogDescription}),acceptLabel:n.formatMessage(ln.callDetectionDisableDialogAcceptLabel),cancelLabel:n.formatMessage(ln.callDetectionDisableDialogDismissLabel)});if(!e)return;_({enable:!1,disableNotification:!0})}else _({enable:!v})}),[v,n,b,_]);const B={display:"flex",flexDirection:"column",gap:12},F={fontWeight:$().Wy.medium,display:"flex",height:28,alignItems:"center"};return(0,P.jsxs)(P.Fragment,{children:[s?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{style:B,children:[(0,P.jsx)(T().A,{style:F,children:(0,P.jsx)(U().sA,{...pn.workspaceSettingsHeader})}),(0,P.jsx)(Rt().A,{spaceStore:t,type:"toggle",isOn:p,onToggle:k,disabled:!i,tooltipLabel:D,title:(0,P.jsx)(U().sA,{...pn.enableMeetingNotesLabel}),caption:(0,P.jsx)(U().sA,{...pn.enableMeetingNotesDescription})}),(0,P.jsx)(Rt().A,{spaceStore:t,type:"toggle",isOn:g,onToggle:w,disabled:!i,tooltipLabel:D,title:(0,P.jsx)(U().sA,{...pn.storeAudioLocallyLabel}),caption:(0,P.jsx)(U().sA,{...pn.storeAudioLocallyDescription,values:{learnmore:e=>(0,P.jsx)(S().V,{href:(0,Ft().HQ)(),external:!0,onClick:e=>e.stopPropagation(),children:e})}})}),l?r?(0,P.jsx)(Qt,{spaceStore:t,disabled:!i,tooltipLabel:D}):(0,P.jsx)(Xt,{spaceStore:t}):void 0,d?(0,P.jsx)(en,{spaceStore:t,disabled:!i,tooltipLabel:D}):void 0]}),(0,P.jsx)(Dt().A,{size:16})]}):void 0,(0,P.jsxs)("div",{style:B,children:[(0,P.jsx)(T().A,{style:F,children:(0,P.jsx)(U().sA,{...pn.personalPreferencesHeader})}),E?(0,P.jsx)(Rt().A,{spaceStore:t,type:"toggle",isOn:v,onToggle:R,title:(0,P.jsx)(U().sA,{...ln.callDetectionLabel}),caption:(0,P.jsx)(U().sA,{...ln.callDetectionDescription})}):void 0,(0,P.jsx)(Rt().A,{spaceStore:t,type:"dropdown",currentOption:f?"always":"never",onSelectOption:e=>{("always"===e&&!f||"never"===e&&f)&&C()},title:(0,P.jsx)(U().sA,{...pn.hideMeetingNotesTabLabel}),caption:(0,P.jsx)(U().sA,{...pn.hideMeetingNotesTabDescription}),options:[{key:"never",label:"Never"},{key:"always",label:"Always"}]}),I?(0,P.jsx)(Rt().A,{spaceStore:t,type:"toggle",isOn:x,onToggle:A,title:(0,P.jsx)(U().sA,{...pn.autoShareMeetingNotesLabel}),caption:(0,P.jsx)(U().sA,{...pn.autoShareMeetingNotesDescription})}):void 0,o?(0,P.jsx)(Rt().A,{spaceStore:t,type:"custom",title:(0,P.jsx)(U().sA,{...pn.selectDefaultDatabaseLabel}),caption:(0,P.jsx)(U().sA,{...pn.selectDefaultDatabaseDescription}),customButton:(0,P.jsx)("div",{style:{display:"flex",alignItems:"center",gap:4},children:(0,P.jsx)(Lt().B,{value:h,onChange:M,hidePages:!0,showCollections:!0,searchOptions:{source:"ai_meeting_notes_location_picker",requireEditPermissions:!1},renderSections:function(e){return h?(e.push({key:"customFilingLocationSettingActions",items:[{key:"removeFilingLocationSetting",action:()=>j(),render:e=>(0,P.jsx)(Nt().A,{...e,svg:Bt().trashSmallIcon,isRed:!0,title:(0,P.jsx)(U().sA,{...pn.removeDefaultDatabase})})}],render:e=>(0,P.jsx)(ve().A,{...e,topBorder:!0})}),e):e},peopleBlocksToInclude:"none"})}),shouldHighlight:y}):void 0,c?(0,P.jsx)(rn,{spaceStore:t}):void 0]})]})}var mn=()=>n(209660),hn=()=>n(219348);const fn=n.p+"d81827135b71fcf9.png";var yn=()=>n(601751);const vn=(0,U().YK)({personalizationHeader:{id:"aiSettings.personalizationHeader",defaultMessage:"Personalization"},agentPersonalizationButton:{id:"aiSettings.agentPersonalizationButton",defaultMessage:"Edit"},agentPersonalizationSubtitle:{id:"aiSettings.agentPersonalizationSubtitle",defaultMessage:"Pick a name, choose an accessory, and set how Notion AI talks and helps you. Start from a template or build your own style."}});function Sn(){const e=(0,p().IS)((()=>({personalizationCard:{display:"flex",alignItems:"center",borderRadius:8,marginBottom:16,flexWrap:"wrap",gap:24,minWidth:200},personalizationContent:{display:"flex",flexDirection:"column",gap:8,flex:1,paddingTop:16,paddingInlineEnd:16,paddingBottom:16},personalizationSubtitle:{maxWidth:400},personalizationImage:{width:197,maxWidth:"100%",height:"auto",borderRadius:4}})),[]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et().A,{divider:"full",hasMarginTop:!0,children:(0,P.jsx)(U().sA,{...vn.personalizationHeader})}),(0,P.jsxs)("div",{style:e.personalizationCard,children:[(0,P.jsxs)("div",{style:e.personalizationContent,children:[(0,P.jsx)(k().D,{styleKey:"bodySmRegular",colorVariant:"secondary",style:e.personalizationSubtitle,children:(0,P.jsx)(U().sA,{...vn.agentPersonalizationSubtitle})}),(0,P.jsx)("div",{style:{marginTop:8},children:(0,P.jsx)(x().A,{onClick:()=>{hn().cP({store:yn().r,from:"ai_settings",shouldSetSeenPersonalizationSettingsModal:!1}),mn().os()},children:(0,P.jsx)(U().sA,{...vn.agentPersonalizationButton})})})]}),(0,P.jsx)("img",{src:fn,alt:"",style:e.personalizationImage})]})]})}var bn=()=>n(866894),xn=()=>n(394888),In=()=>n(89002),kn=()=>n(716500);var wn=()=>n(348670),Cn=()=>n(15897),An=()=>n(898568),Tn=()=>n(206867),jn=()=>n(429145);function Mn(e){const{value:t,setValue:n,setError:a}=e,i=(0,d().v3)(),s=(0,p().IS)((()=>({container:{display:"flex",alignItems:"center",gap:16},uploadButton:{height:64,width:64,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",background:t?`url(${t}) no-repeat center center/cover`:H().Tj.background.tertiary,borderRadius:4,border:`1px solid ${H().Tj.border.secondary}`,cursor:"pointer"},buttonContainer:{display:"flex",flexDirection:"column",justifyContent:"center",gap:8}})),[t]),{isUploading:o,uploadFile:r}=(0,jn().lN)({onError:e=>{a("string"==typeof e.message?e.message:void 0)},onSuccess:e=>{n(e),a(void 0)},environment:i});return(0,P.jsxs)("div",{style:s.container,children:[(0,P.jsxs)(I().p,{style:s.uploadButton,onClick:r,children:[t||o?null:(0,P.jsx)(y().I,{icon:Tn().J,size:"md",colorVariant:"tertiary"}),o?(0,P.jsx)(re().A,{}):null]}),(0,P.jsxs)("div",{style:s.buttonContainer,children:[(0,P.jsx)(x().A,{onClick:r,disabled:o,children:o?(0,P.jsx)(U().sA,{id:"aiSettings.customConnectors.uploading",defaultMessage:"Uploading..."}):(0,P.jsx)(U().sA,{id:"aiSettings.customConnectors.upload",defaultMessage:"Upload image"})}),t?(0,P.jsx)(x().A,{onClick:()=>{n(void 0),a(void 0)},iconLeading:Me().trashIcon,children:(0,P.jsx)(U().sA,{id:"aiSettings.customConnectors.remove",defaultMessage:"Remove"})}):null]})]})}function _n({onDismiss:e}){const t=(0,d().v3)(),n=(0,o().r)(),[i,s]=a.useState(!1),[r,l]=a.useState(""),[c,u]=a.useState(""),[g,m]=a.useState(void 0),[h,f]=a.useState(void 0),[y,v]=a.useState("project"),S=(0,U().tz)(),b=(0,p().IS)((()=>({form:{display:"flex",flexDirection:"column",gap:16},labelRow:{display:"flex",flexDirection:"column",gap:6}})),[]),x=(0,a.useCallback)((async()=>{if(n&&!i&&r&&c){s(!0);try{const a=await async function(e){const{environment:t,spaceId:n,thirdPartyId:a,displayName:i,archetype:s,iconUrl:o}=e;try{if("success"!==(await t.api.callCellCompatibleApi({eventName:"createCustomConnector",environment:t,cellNavigation:{spaceId:n},data:{spaceId:n,thirdPartyId:a,displayName:i,archetype:s,iconUrl:o,authDetails:{}}})).type)return{success:!1};const e=(0,kn().K)("custom");return await e.updateConnectorStatus({environment:t,spaceId:n}),{success:!0}}catch(r){return{success:!1}}}({environment:t,spaceId:n,thirdPartyId:c,displayName:r,archetype:y,iconUrl:g});a.success&&e()}finally{s(!1)}}}),[n,i,r,c,y,t,e,g]);return(0,P.jsx)(xn().s,{isOpen:!0,onDismiss:e,areaConstraint:{width:{type:"min",length:An().NF}},render:({sizeRange:t})=>(0,P.jsx)(In().t,{showDismissButton:!0,sizeRange:t,header:(0,P.jsx)(k().D,{styleKey:"bodyMedium",colorVariant:"primary",children:(0,P.jsx)(U().sA,{defaultMessage:"Add Custom AI Connector",id:"aiSettings.customConnectors.modalHeader"})}),footer:(0,P.jsx)(An().jl,{primaryText:(0,P.jsx)(U().sA,{defaultMessage:"Create",id:"aiSettings.customConnectors.create"}),primaryAction:x,primaryDisabled:i||!r||!c,secondaryText:(0,P.jsx)(U().sA,{defaultMessage:"Cancel",id:"aiSettings.customConnectors.cancel"}),secondaryAction:e,isLoading:i}),children:(0,P.jsxs)("div",{style:b.form,children:[(0,P.jsxs)("div",{style:b.labelRow,children:[(0,P.jsx)(k().D,{styleKey:"captionMedium",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{defaultMessage:"Icon",id:"aiSettings.customConnectors.iconLabel"})}),(0,P.jsx)(Mn,{value:g,setValue:m,setError:f}),h?(0,P.jsx)(k().D,{styleKey:"captionRegular",colorVariant:"accentPrimary",colorPalette:"red",children:h}):null]}),(0,P.jsxs)("div",{style:b.labelRow,children:[(0,P.jsx)(k().D,{styleKey:"captionMedium",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{defaultMessage:"Name",id:"aiSettings.customConnectors.nameLabel"})}),(0,P.jsx)(wn().t,{value:r,onChange:l,placeholder:S.formatMessage({id:"aiSettings.customConnectors.namePlaceholder",defaultMessage:"e.g. Acme CRM"})})]}),(0,P.jsxs)("div",{style:b.labelRow,children:[(0,P.jsx)(k().D,{styleKey:"captionMedium",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{defaultMessage:"Third-party ID",id:"aiSettings.customConnectors.thirdPartyIdLabel"})}),(0,P.jsx)(wn().t,{value:c,onChange:u,placeholder:S.formatMessage({id:"aiSettings.customConnectors.thirdPartyIdPlaceholder",defaultMessage:"e.g. acme-crm-prod"})}),(0,P.jsx)(k().D,{styleKey:"bodySmRegular",colorVariant:"secondary",style:{marginTop:4},children:(0,P.jsx)(U().sA,{id:"aiSettings.customConnectors.thirdPartyIdHelp",defaultMessage:"The unique ID your system uses to refer to this connector."})})]}),(0,P.jsxs)("div",{style:b.labelRow,children:[(0,P.jsx)(k().D,{styleKey:"captionMedium",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{defaultMessage:"Archetype",id:"aiSettings.customConnectors.archetypeLabel"})}),(0,P.jsx)(Cn().A,{items:[{key:"project",render:()=>(0,P.jsx)(U().sA,{defaultMessage:"Project",id:"aiSettings.customConnectors.project"})},{key:"chat",render:()=>(0,P.jsx)(U().sA,{defaultMessage:"Chat",id:"aiSettings.customConnectors.chat"})}],value:y,onChange:v})]})]})})})}var Pn=()=>n(864139);function Dn(){const e=(0,u().K8)((()=>Ne().zD.isAiConnectorEnabled("custom")),[]),t=(0,u().K8)((()=>Pn().qu.state.customConnectors??[]),[]),n=(0,p().DP)();return e?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et().A,{style:{marginBottom:6},children:(0,P.jsx)(h().Y1,{direction:"horizontal",align:"center-left",gap:3,children:(0,P.jsx)(U().sA,{defaultMessage:"Custom AI connectors",id:"aiSettings.customConnectors.header"})})}),(0,P.jsx)(k().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{defaultMessage:"Bring your own data connector for your workspace.",id:"aiSettings.customConnectors.sectionDescription"})}),(0,P.jsx)(Dt().A,{size:2}),(0,P.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:8},children:[(0,P.jsx)(En,{}),t.map((e=>(0,P.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:6},children:(0,P.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,padding:12,borderRadius:4,border:`1px solid ${n.border.secondary}`},children:[e.iconUrl?(0,P.jsx)("img",{src:e.iconUrl,alt:e.displayName??"Custom AI connector icon",style:{width:24,height:24,borderRadius:4,objectFit:"cover",flexShrink:0}}):(0,P.jsx)("div",{style:{width:24,height:24,flexShrink:0},children:(0,P.jsx)(y().I,{icon:bn().gridIcon,size:24})}),(0,P.jsx)(k().D,{styleKey:"bodyMedium",colorVariant:"primary",children:e.displayName??e.id}),e.archetype?(0,P.jsx)(k().D,{styleKey:"captionRegular",colorVariant:"secondary",children:e.archetype}):null]})},e.id)))]}),(0,P.jsx)(Dt().A,{size:16})]}):null}function En(){const[e,t]=(0,a.useState)(!1),n=(0,p().IS)((()=>({card:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,height:"auto",minHeight:50,borderRadius:4,padding:12,border:`1px dashed ${H().Tj.blue.border.accentPrimary}`,backgroundColor:H().Tj.blue.background.primaryTranslucent,cursor:"pointer",transition:"background-color 0.1s ease",":hover":{backgroundColor:H().Tj.blue.background.secondaryTranslucent}},icon:{fill:H().Tj.blue.icon.accentPrimary}})),[]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{style:n.card,onClick:()=>t(!0),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||t(!0)},children:[(0,P.jsx)(y().I,{icon:N().plusFillIcon,size:"sm",style:n.icon}),(0,P.jsx)(k().D,{styleKey:"bodySmMedium",colorVariant:"primary",colorPalette:"blue",children:(0,P.jsx)(U().sA,{defaultMessage:"Create Custom AI Connector",id:"aiSettings.customConnectors.createCta"})})]}),e?(0,P.jsx)(_n,{onDismiss:()=>t(!1)}):null]})}const Rn=(0,U().YK)({aiWebSearchSettingsHeader:{id:"aiSettings.aiWebSearchSettingsHeader",defaultMessage:"AI Web Search"},aiWebSearchGlobalToggleLabel:{id:"aiSettings.aiWebSearch.globalToggleLabel",defaultMessage:"Enable web search for workspace"},aiWebSearchGlobalToggleCaption:{id:"aiSettings.aiWebSearch.globalToggleCaption",defaultMessage:"Allow AI to search the web for up-to-date information when answering questions."},aiWebSearchZeroRetentionTooltip:{id:"aiSettings.aiWebSearch.zeroRetentionTooltip",defaultMessage:"AI web search is disabled for HIPAA workspaces."},enableCustomConnections:{id:"aiSettings.enableCustomConnections",defaultMessage:"Enable custom MCP servers"},enableCustomMcpServersDescription:{id:"aiSettings.enableCustomMcpServersDescription",defaultMessage:"Allow members to connect agents to custom MCP servers that Notion hasnt reviewed. Connected agents can share content externally, access external data, and take external actions through them."},turnOffAiWhenSubscribedToAiWarning:{id:"spaceBasicSettings.aiFeature.turnOffAiWhenSubscribedToAiWarning",defaultMessage:"Your current plan includes Notion AI. You can turn off access to AI, but you will continue to be billed for it."},turnOffAiWhenSubscribedToAccept:{id:"spaceBasicSettings.aiFeature.turnOffAiWhenSubscribedToAccept",defaultMessage:"Turn off AI"},enterpriseAiConnectorsDisabledTooltip:{id:"aiSettings.aiConnectors.enterpriseAiConnectorsDisabledTooltip",defaultMessage:"This connector is only available on the Enterprise plan"},personalAiConnectorsDisabledTooltip:{id:"aiSettings.aiConnectors.personalAiConnectorsDisabledTooltip",defaultMessage:"Your workspace is already connected to {workspaceConnector}"},personalAiConnectorsHeader:{id:"aiSettings.aiConnectors.personalAiConnectorsHeader",defaultMessage:"Notion apps"},personalAiConnectorsDescription:{id:"aiSettings.aiConnectors.personalAiConnectorsDescription",defaultMessage:"Connect your personal knowledge across your Notion apps."},workspaceAiConnectorsHeader:{id:"aiSettings.aiConnectors.workspaceAiConnectorsHeader",defaultMessage:"Workspace AI Connectors"},workspaceAiConnectorsDescription:{id:"aiSettings.aiConnectors.workspaceAiConnectorsDescription",defaultMessage:"Workspace owners can connect all your teams knowledge, across all apps you use for work."},workspaceAiConnectorsDescriptionWithLearnMore:{id:"aiSettings.aiConnectors.workspaceAiConnectorsDescriptionWithLearnMore",defaultMessage:"Workspace owners can connect all your teams knowledge, across all apps you use for work. <learnmore>Learn more</learnmore>"},connectedAppsLabel:{id:"aiSettings.aiConnectors.connectedAppsLabel",defaultMessage:"Connected"},aiLeapLabel:{id:"spaceBasicSettings.aiLeap.label",defaultMessage:"Share data to improve Notion AI"},aiLeapDescription:{id:"spaceBasicSettings.aiLeap.description",defaultMessage:"Help improve Notions AI models by allowing data from across this workspace to be shared with Notion. By enabling AI LEAP (Learning and Early Access Program) you are agreeing to the <inlinelink>Notion AI LEAP Supplementary Terms</inlinelink>. <learnmore>Learn more</learnmore>."},aiLeapDescriptionWithoutLearnMore:{id:"spaceBasicSettings.aiLeap.descriptionWithoutLearnMore",defaultMessage:"Help improve Notions AI models by allowing data from across this workspace to be shared with Notion. By enabling AI LEAP (Learning and Early Access Program) you are agreeing to the <inlinelink>Notion AI LEAP Supplementary Terms</inlinelink>."},aiLeapShortDescription:{id:"spaceBasicSettings.aiLeap.shortDescription",defaultMessage:"Help improve Notion AI by allowing data from this workspace to be shared with Notion. By enabling the Learning and Early Access Program you are agreeing to the <inlinelink>Supplementary Terms</inlinelink>. <learnmore>Learn more</learnmore>."},aiLeapShortDescriptionWithoutLearnMore:{id:"spaceBasicSettings.aiLeap.shortDescriptionWithoutLearnMore",defaultMessage:"Help improve Notion AI by allowing data from this workspace to be shared with Notion. By enabling the Learning and Early Access Program you are agreeing to the <inlinelink>Supplementary Terms</inlinelink>."},aiConnectedAppsSettingsButton:{id:"aiSettings.aiConnectedApps.settingsButton",defaultMessage:"Settings"},aiConnectedAppsConnectedStatus:{id:"aiSettings.aiConnectedApps.connectedStatus",defaultMessage:"Connected"},aiConnectedAppsConnectingStatus:{id:"aiSettings.aiConnectedApps.connectingStatus",defaultMessage:"Connecting... Could take up to {hours} hours"},aiConnectedAppsConnectingStatusWithProgress:{id:"aiSettings.aiConnectedApps.connectingStatusWithProgress",defaultMessage:"Connecting... {progress}% complete"},aiConnectedAppsDisconnectingStatus:{id:"aiSettings.aiConnectedApps.disconnectingStatus",defaultMessage:"Disconnecting..."},aiConnectorsSettingsHeader:{id:"aiSettings.aiConnectorsSettingsHeader",defaultMessage:"AI Connectors"},aiSettingsMeetingNotesHeader:{id:"aiSettings.meetingNotesHeader",defaultMessage:"AI Meeting Notes"},customAgentCreationHeader:{id:"aiSettings.customAgentCreationHeader",defaultMessage:"Agents"},customAgentCreationLabel:{id:"aiSettings.customAgentCreation.label",defaultMessage:"Who can create agents"},customAgentCreationCaption:{id:"aiSettings.customAgentCreation.caption",defaultMessage:"Control who can create AI agents in this workspace"},customAgentCreationOptionAllMembers:{id:"aiSettings.customAgentCreation.option.allMembers",defaultMessage:"All workspace members"},customAgentCreationOptionOwnersOnly:{id:"aiSettings.customAgentCreation.option.ownersOnly",defaultMessage:"Workspace owners only"},customAgentCreationOptionCustomOwners:{id:"aiSettings.customAgentCreation.option.customOwners",defaultMessage:"Workspace owners + added groups only"},permissionGroupCustomPoliciesHeader:{id:"aiSettings.customAgentCreation.permissionGroupCustomPolicies.header",defaultMessage:"Custom Permissions"},permissionGroupCustomPoliciesHeaderV2:{id:"aiSettings.customAgentCreation.permissionGroupCustomPolicies.headerV2",defaultMessage:"Control who can create agents"},permissionGroupCustomPoliciesCaption:{id:"aiSettings.customAgentCreation.permissionGroupCustomPolicies.caption",defaultMessage:"Choose which permission groups can create agents"},permissionGroupCustomPoliciesCaptionV2:{id:"aiSettings.customAgentCreation.permissionGroupCustomPolicies.captionV2",defaultMessage:"Add groups"},permissionGroupCustomPoliciesSearchPlaceholder:{id:"aiSettings.customAgentCreation.permissionGroupCustomPolicies.searchPlaceholder",defaultMessage:"Search groups by name..."},permissionGroupCustomPoliciesSearchPlaceholderV2:{id:"aiSettings.customAgentCreation.permissionGroupCustomPolicies.searchPlaceholderV2",defaultMessage:"Add groups by name..."},permissionGroupCustomPoliciesNoGroups:{id:"aiSettings.customAgentCreation.permissionGroupCustomPolicies.noGroups",defaultMessage:"No permission groups available in this workspace."},permissionGroupCustomPoliciesGroupCount:{id:"aiSettings.customAgentCreation.permissionGroupCustomPolicies.groupCount",defaultMessage:"{count, plural, =1 {# group} one {# group} other {# groups}}"},aiFeatureLabel:{id:"spaceBasicSettings.aiFeature.label",defaultMessage:"Enable Notion AI"},aiFeatureCaption:{id:"spaceBasicSettings.aiFeature.ga.caption",defaultMessage:"Enable to provide AI-powered functionality for all members of your workspace. By enabling Notion AI, you are agreeing to the <inlinelink>Notion AI Supplementary Terms</inlinelink>"},aiFeatureShortCaption:{id:"spaceBasicSettings.aiFeature.ga.shortCaption",defaultMessage:"Enable AI for all members of your workspace, agreeing to the <inlinelink>Notion AI Terms</inlinelink>"},learnMore:{id:"spaceBasicSettings.aiFeature.learnMore",defaultMessage:"Learn more"},aiDisabledNonEnterpriseMessage:{id:"aiSettings.aiDisabledNonEnterpriseMessage",defaultMessage:"Notion AI has been disabled for this workspace. Please reach out to <emaillink>team@makenotion.com</emaillink> to re-enable."}}),Bn=(0,U().YK)({slack_select_channels:{id:"aiSettings.aiConnectedApps.slackSelectChannels",defaultMessage:"Select channels"},microsoft_teams_select_teams:{id:"aiSettings.aiConnectedApps.microsoftTeamsSelectTeams",defaultMessage:"Select teams"},sharepoint_select_sites:{id:"aiSettings.aiConnectedApps.sharepointSelectSites",defaultMessage:"Select sites"},slack_re_auth:{id:"aiSettings.aiConnectedApps.slackReAuth",defaultMessage:"Login required"},slack_v2_user_connection:{id:"aiSettings.aiConnectedApps.slackV2UserConnection",defaultMessage:"Login required"},github_re_auth:{id:"aiSettings.aiConnectedApps.githubReAuth",defaultMessage:"Login required"},jira_connection_pending:{id:"aiSettings.aiConnectedApps.jiraConnectionPending",defaultMessage:"Finish setup"},jira_connect_user:{id:"aiSettings.aiConnectedApps.jiraConnectUser",defaultMessage:"Login required"},jira_select_projects:{id:"aiSettings.aiConnectedApps.jiraSelectProjects",defaultMessage:"Select projects"},jira_migrate:{id:"aiSettings.aiConnectedApps.jiraMigrate",defaultMessage:"Update"},slack_migrate:{id:"aiSettings.aiConnectedApps.slackMigrate",defaultMessage:"Update"},linear_re_auth:{id:"aiSettings.aiConnectedApps.linearReAuth",defaultMessage:"Login required"},discord_re_auth:{id:"aiSettings.aiConnectedApps.discordReAuth",defaultMessage:"Login required"},salesforce_re_auth:{id:"aiSettings.aiConnectedApps.salesforceReAuth",defaultMessage:"Login required"},google_drive_connection_pending:{id:"aiSettings.aiConnectedApps.googleDriveConnectionPending",defaultMessage:"Finish setup"},asana_re_auth:{id:"aiSettings.aiConnectedApps.asanaReAuth",defaultMessage:"Login required"},asana_select_workspace:{id:"aiSettings.aiConnectedApps.asanaSelectWorkspace",defaultMessage:"Select workspace"},box_awaiting_confirmation:{id:"aiSettings.aiConnectedApps.boxAwaitingConfirmation",defaultMessage:"Finish setup"}}),Fn=(0,U().YK)({slack_select_channels:{id:"aiSettings.aiConnectedApps.slackSelectChannelsNonAdminTooltip",defaultMessage:"Your workspace owner needs to select channels"},microsoft_teams_select_teams:{id:"aiSettings.aiConnectedApps.microsoftTeamsSelectTeamsNonAdminTooltip",defaultMessage:"Your workspace owner needs to select teams"},sharepoint_select_sites:{id:"aiSettings.aiConnectedApps.sharepointSelectSitesNonAdminTooltip",defaultMessage:"Your workspace owner needs to select sites"},jira_connection_pending:{id:"aiSettings.aiConnectedApps.jiraConnectionPendingNonAdminTooltip",defaultMessage:"Your workspace owner needs to finish setup"},jira_select_projects:{id:"aiSettings.aiConnectedApps.jiraSelectProjectsNonAdminTooltip",defaultMessage:"Your workspace owner needs to select projects"},jira_migrate:{id:"aiSettings.aiConnectedApps.jiraMigrateNonAdminTooltip",defaultMessage:"Your workspace owner needs to update Jira connector"},slack_migrate:{id:"aiSettings.aiConnectedApps.slackMigrateNonAdminTooltip",defaultMessage:"Your workspace owner needs to update Slack connector"},google_drive_connection_pending:{id:"aiSettings.aiConnectedApps.googleDriveConnectionPendingNonAdminTooltip",defaultMessage:"Your workspace owner needs to finish setup"}}),Nn=(0,U().YK)({slack_migrate:{id:"aiSettings.aiConnectedApps.slackMigrateAdminTooltip",defaultMessage:"Update the Slack AI Connector to enable answers from private channels and messages for your workspace. Every user must authenticate."}});function Ln({securitySettingsStore:e,spaceStore:t,useShortDescription:n}){const a=(0,d().v3)(),i=(0,u().K8)((()=>Boolean(e.state.enableAiTraining)),[e]);return(0,P.jsx)(Rt().A,{spaceStore:t,type:"toggle",isOn:i,onToggle:()=>{Y().X(a,{securitySettingsStore:e,spaceStore:t,fields:{enableAiTraining:!i}})},title:(0,P.jsxs)(h().Y1,{direction:"horizontal",gap:3,align:"center-left",children:[(0,P.jsx)(U().sA,{...Rn.aiLeapLabel}),(0,P.jsx)(et().W,{tooltipTitle:(0,P.jsx)(U().sA,{...Rn.learnMore}),buttonProps:{href:L().JZ.aiLeapProgramFaqs,external:!0}})]}),caption:(0,P.jsx)(U().sA,{...n?Rn.aiLeapShortDescriptionWithoutLearnMore:Rn.aiLeapDescriptionWithoutLearnMore,values:{learnmore:e=>(0,P.jsx)(S().V,{href:L().JZ.aiLeapProgramFaqs,external:!0,onClick:e=>e.stopPropagation(),children:e}),inlinelink:e=>(0,P.jsx)(S().V,{href:"https://notion.notion.site/0c55d702d0154a788d9e70c4ee396399",external:!0,onClick:e=>e.stopPropagation(),children:e})}})})}function On({spaceStore:e,hidePermissionGroups:t=!1,hideTitleAndCaption:n=!1,customTitle:a}){const i=(0,d().v3)(),s=(0,U().tz)(),o=He(e),{isEnabled:r,tooltipMessage:l}=(0,Je().P)();return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Rt().A,{spaceStore:e,type:"dropdown",currentOption:o,onSelectOption:t=>{try{at().createAndCommit({userAction:"AiSettings.updateCustomAgentCreationPolicy",environment:i,canUndo:!1,perform:n=>{if(G().zv({store:e.getSettingsStore(),transaction:n,data:{custom_agent_creation_policy:t}}),"custom"===o&&"custom"!==t){const t=Ze().h.getAllGroupData();for(const a of t){const t=a.group.v("settings");if(!0===(null==t?void 0:t.can_create_custom_agents)){const i=(0,Ye().E)({spaceStore:e,groupId:a.group.group_id}),s={...t,can_create_custom_agents:!1};(0,Q().O)({spacePermissionGroupStore:i,transaction:n,value:{settings:s,last_edited_at:Date.now()}})}}}}})}catch(n){}},menuStyle:{width:320},isLocked:!r,lockedTooltip:l,buttonStyle:r?void 0:{cursor:"not-allowed"},title:a??(n?void 0:(0,P.jsx)(U().sA,{...Rn.customAgentCreationLabel})),caption:n?void 0:(0,P.jsx)(U().sA,{...Rn.customAgentCreationCaption}),options:[{key:"all_workspace_members",label:s.formatMessage(Rn.customAgentCreationOptionAllMembers)},{key:"workspace_owners_only",label:s.formatMessage(Rn.customAgentCreationOptionOwnersOnly)},{key:"custom",label:s.formatMessage(Rn.customAgentCreationOptionCustomOwners)}]}),t||"custom"!==o?void 0:(0,P.jsx)(zn,{spaceStore:e})]})}function Vn(){const e=(0,p().IS)((()=>({noRowContainer:{display:"flex",height:32,padding:"0px 4px",alignItems:"center",gap:4,borderBottom:`1px solid ${H().Tj.border.primary}`}})),[]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Dt().A,{size:16}),(0,P.jsx)(T().A,{isSmall:!0,style:{marginBottom:6},children:(0,P.jsx)(U().sA,{...Rn.permissionGroupCustomPoliciesHeader})}),(0,P.jsx)(k().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{...Rn.permissionGroupCustomPoliciesCaption})}),(0,P.jsx)(Dt().A,{size:12}),(0,P.jsx)(T().A,{isSmall:!0,style:e.noRowContainer,children:(0,P.jsx)(U().sA,{...Rn.permissionGroupCustomPoliciesNoGroups})})]})}function zn({spaceStore:e}){const t=(0,U().tz)(),n=(0,d().v3)(),[i,s]=(0,a.useState)(""),o=(0,u().K8)((()=>Ze().h.getAllGroupData().sort(((e,t)=>{const n=e.group.name||"",a=t.group.name||"";return n.localeCompare(a)}))),[]),r=(0,u().K8)((()=>i.trim()?(0,K().Ay)(i,o,(e=>e.group.name||"")):o),[i,o]),l=(0,a.useCallback)(((t,a)=>{at().createAndCommit({userAction:"AiSettings.updatePermissionGroupAgentPolicy",environment:n,canUndo:!0,perform:n=>{const i=(0,Ye().E)({spaceStore:e,groupId:t}),s={...i.getSettings()||{},can_create_custom_agents:a};(0,Q().O)({spacePermissionGroupStore:i,transaction:n,value:{settings:s,last_edited_at:Date.now()}})}})}),[n,e]),c=(0,u().K8)((()=>r.map((e=>{const n=e.group.v("settings"),a=!0===(null==n?void 0:n.can_create_custom_agents);return{id:e.group.group_id,isClickable:!1,groupId:e.group.group_id,groupName:e.group.name||t.formatMessage({id:"spacePermissionsSettings.groupsTab.untitled",defaultMessage:"Untitled"}),memberCount:e.memberCount,group:e.group,currentPolicy:a}}))),[r,t]),g=(0,a.useMemo)((()=>[{id:"name",headerTitle:(0,P.jsx)(U().sA,{id:"aiSettings.customAgentCreation.permissionGroupCustomPolicies.table.nameColumn",defaultMessage:"Group"}),renderCell:t=>(0,P.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,P.jsx)(_t().A,{size:28}),(0,P.jsx)("span",{children:t.groupName}),t.group.icon?(0,P.jsx)(Pt().B6,{disabled:!0,bucket:"public",icon:{pointer:e.pointer,icon:t.group.icon},size:18,isEmptyPage:!1,title:t.groupName,style:{marginInlineStart:4}}):void 0]}),widthData:{widthPercent:50,minWidth:150},sortable:!1},{id:"members",headerTitle:(0,P.jsx)(U().sA,{id:"aiSettings.customAgentCreation.permissionGroupCustomPolicies.table.membersColumn",defaultMessage:"Members"}),renderCell:e=>(0,P.jsx)("span",{style:{color:H().Tj.text.secondary,fontSize:"14px"},children:1===e.memberCount?"1 member":`${e.memberCount} members`}),widthData:{widthPercent:25,minWidth:150},sortable:!1},{id:"policy",headerTitle:(0,P.jsx)(U().sA,{id:"aiSettings.customAgentCreation.permissionGroupCustomPolicies.table.policyColumn",defaultMessage:"Agent Creation"}),renderCell:t=>(0,P.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,P.jsx)(Rt().A,{spaceStore:e,type:"toggle",isOn:t.currentPolicy,onToggle:()=>l(t.groupId,!t.currentPolicy)})}),widthData:{widthPercent:25,minWidth:150},sortable:!1}]),[l,e]),m=(0,C().rC)({columnRenderInfo:g,containerMarginTop:12}),h=(0,p().IS)((()=>({searchContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},searchInput:{width:240,maxWidth:"40%"},groupCount:{fontSize:"13px",color:H().Tj.text.tertiary},noRowContainer:{display:"flex",height:32,padding:"0px 4px",alignItems:"center",gap:4,borderBottom:`1px solid ${H().Tj.border.primary}`}})),[]);return 0===o.length?(0,P.jsx)(Vn,{}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Dt().A,{size:16}),(0,P.jsx)(Et().A,{style:{marginBottom:6},children:(0,P.jsx)(U().sA,{...Rn.permissionGroupCustomPoliciesHeader})}),(0,P.jsx)(k().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{...Rn.permissionGroupCustomPoliciesCaption})}),(0,P.jsx)(Dt().A,{size:12}),(0,P.jsxs)("div",{style:h.searchContainer,children:[(0,P.jsx)("span",{style:h.groupCount,children:t.formatMessage(Rn.permissionGroupCustomPoliciesGroupCount,{count:r.length})}),(0,P.jsx)("div",{style:h.searchInput,children:(0,P.jsx)(Xe().nv,{mode:Xe().Ke.OnChange,query:i,setQueryFilter:s,placeholderText:t.formatMessage(Rn.permissionGroupCustomPoliciesSearchPlaceholder)})})]}),(0,P.jsx)(C().WE,{showRowBorders:!0,hideHeaderRowPadding:!0,columnRenderInfo:g,rows:c,styles:m,renderNoRowsComponent:()=>(0,P.jsx)(T().A,{isSmall:!0,style:h.noRowContainer,children:(0,P.jsx)(U().sA,{id:"aiSettings.customAgentCreation.permissionGroupCustomPolicies.noEnabledGroups",defaultMessage:"No groups enabled for agent creation"})})})]})}function Wn({billingData:e,spaceStore:t,useShortDescription:n}){const a=(0,d().v3)(),i=(0,u().K8)((()=>t.isAiEnabledOnSpace()),[t]);return(0,P.jsx)(Rt().A,{spaceStore:t,type:"toggle",isOn:i,onToggle:async()=>{await Hn({environment:a,billingData:e,spaceStore:t})},title:(0,P.jsx)(U().sA,{...Rn.aiFeatureLabel}),caption:(0,P.jsx)(U().sA,{...n?Rn.aiFeatureShortCaption:Rn.aiFeatureCaption,values:{inlinelink:e=>(0,P.jsx)(S().V,{href:"https://notion.notion.site/fa9034c8b5a04818a6baf3eac2adddbb",external:!0,onClick:e=>e.stopPropagation(),children:e})}})})}function Un(e){var t;const{spaceStore:n,billingData:a}=e;return!!n.canAdmin()&&(!!Boolean(null===(t=n.getModel())||void 0===t?void 0:t.isAiLeapEnabledOnSpace())||!(0,O().N8)(a)&&Ne().zD.isWorkspaceLeapEligible({ignoreEnterpriseCheck:!0}))}async function Hn(e){const{environment:t,billingData:n,spaceStore:a}=e,i=(0,V().a)({billingData:n,experimentService:c().default,spaceId:a.id}),o=a.isAiEnabledOnSpace();if((0,s().u)({environment:t,event:{eventName:"clicked_toggle_notion_ai",eventProperties:{ai_is_enabled:o,has_ai_product:i}}}),o&&i){if(!(await m().Gh({message:g().A.formatMessage(Rn.turnOffAiWhenSubscribedToAiWarning),acceptLabel:g().A.formatMessage(Rn.turnOffAiWhenSubscribedToAccept)})).accept)return void(0,s().u)({environment:t,event:{eventName:"clicked_dismiss_turn_off_notion_ai",eventProperties:{}}});(0,s().u)({environment:t,event:{eventName:"clicked_turn_off_notion_ai_confirmation",eventProperties:{}}})}at().createAndCommit({userAction:"AiSettings.toggleAiFeature",environment:t,canUndo:!1,perform:e=>{"enterprise"===a.getSubscriptionTier()?G().zv({store:a.getSettingsStore(),transaction:e,data:{enable_ai_feature:!o}}):G().zv({store:a.getSettingsStore(),transaction:e,data:{disable_ai_feature:o}})}})}function Kn({connectorType:e}){const t=(0,d().v3)(),[n,i]=(0,a.useState)(!1),s=(0,r().L)(),l=(0,u().K8)((()=>null==s?void 0:s.getSubscriptionTier()),[s]),c=(0,u().K8)((()=>{if((0,j().n6)(e)&&"enterprise"!==l&&!Ne().zD.isEnterpriseAiConnectorBypassOn(e))return{enabled:!1,reason:"enterprise_only",message:Rn.enterpriseAiConnectorsDisabledTooltip};if((0,j().q1)(e)){const t=(0,J().uV)(e),n=J().w0[t];if((0,Fe().wd)().includes(t))return{enabled:!1,reason:"workspace_connector_already_connected",message:Rn.personalAiConnectorsDisabledTooltip,messageValues:{workspaceConnector:n}}}return{enabled:!0}}),[e,l]),g=(0,p().IS)((()=>({contentWrapper:{display:"flex",flexDirection:"column",gap:4,height:"auto",borderRadius:4,padding:12,...c.enabled?{boxShadow:H().Tj.shadowXS,opacity:1}:{boxShadow:H().Tj.shadow2XS,opacity:.4,background:H().Tj.background.tertiary}},topRow:{display:"flex",justifyContent:"space-between",width:"100%"},iconTitleWrapper:{display:"flex",alignItems:"center",gap:4,width:"fit-content",maxWidth:"calc(100% - 24px)"},iconWrapper:{width:24,height:24,borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center"},title:{fontSize:$().J.UIRegular.desktop,color:H().Tj.text.primary,fontWeight:$().Wy.medium,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",gap:2},fakePlusIconButton:{width:24,height:24,flexShrink:0,borderRadius:"50%",backgroundColor:n?H().Tj.palette.blue[100]:H().Tj.palette.blue[50],display:"flex",alignItems:"center",justifyContent:"center"},fakePlusIcon:{fill:H().Tj.palette.uiBlue[600]},betaBadge:{alignSelf:"flex-start",marginTop:4}})),[n,c.enabled]),m=(0,o().r)(),h=(0,tt()._)({name:"ai_connectors",spaceId:m,userId:t.currentUser.id});return(0,P.jsx)(A().m,{disableTooltip:c.enabled,alignment:"start",renderTooltip:()=>c.enabled?null:(0,P.jsx)("div",{style:{padding:2,maxWidth:160,whiteSpace:"normal",overflow:"wrap"},children:(0,P.jsx)(U().sA,{...c.message,values:c.messageValues})}),render:n=>(0,P.jsx)(I().p,{disabled:!h||!c.enabled,onClick:()=>{h&&function(e,t,n){(0,Z().pp)({connector:e,environment:t,analyticsFrom:"ai_workspace_settings_connector_cards",connectorsFeatureAvailability:n})}(e,t,h)},style:g.contentWrapper,...n,children:(0,P.jsxs)("div",{style:g.topRow,children:[(0,P.jsxs)("div",{style:g.iconTitleWrapper,children:[(0,P.jsx)("div",{style:g.iconWrapper,children:"sharepoint"===e?(0,P.jsx)(Ie().E,{size:24}):(0,P.jsx)(b().Q,{iconGroup:M().G[e],variantName:"default"})}),(0,P.jsx)("div",{style:g.title,children:J().w0[e]}),(0,J().Bm)(e)?void 0:(0,P.jsx)(Mt().A,{style:g.betaBadge})]}),c.enabled?(0,P.jsx)("div",{style:g.fakePlusIconButton,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:(0,P.jsx)(y().I,{icon:N().plusFillIcon,size:"sm",style:g.fakePlusIcon})}):void 0]})})})}function qn({availableConnectors:e}){const[t,n]=(0,We().z)(),i=(0,a.useMemo)((()=>n<250?1:Math.min(3,Math.floor(n/250))),[n]);return(0,P.jsx)("div",{ref:t,style:{display:"grid",gridTemplateColumns:`repeat(${i}, 1fr)`,gap:8},children:e.map((e=>(0,P.jsx)(Kn,{connectorType:e},e)))})}function $n({availableConnectors:e}){return 0===e.length?null:(0,P.jsx)("div",{style:{display:"flex",flexDirection:"column"},children:(0,P.jsx)(qn,{availableConnectors:e})})}function Gn({connectorType:e,connectionStatus:t,showTopBorder:n,spaceStore:i}){const s=(0,U().tz)(),o=(0,u().O$)(Be().Rh),r=(0,u().K8)((()=>"slack"===e&&Ne().zD.isCustomAgentsWriteAccessRestricted(o)),[e,o]),l=(0,de().J)(i),c=(0,u().K8)((()=>"slack"===e&&l&&Ne().zD.isSlackPrivateSettingsEnabled()&&!o.isSlackGridAiConnectorEnabled),[e,l,o]),d=(0,a.useCallback)((()=>{Be().Rh.setState({...Be().Rh.state,currentScreen:"private-settings"})}),[]),g=(0,p().IS)((()=>({contentWrapper:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 0px",borderBottom:`1px solid ${H().Tj.border.secondary}`,borderTop:n?`1px solid ${H().Tj.border.secondary}`:"none",borderRadius:4},leftContentWrapper:{display:"flex",alignItems:"center",gap:10},rightContentWrapper:{display:"flex",alignItems:"center",gap:12},iconWrapper:{width:24,height:24,display:"flex",alignItems:"center",justifyContent:"center"},titleAndExternalSourceNameWrapper:{display:"flex",flexDirection:"column",gap:0},title:{display:"flex",alignItems:"center",gap:4,fontSize:$().J.UIRegular.desktop,fontWeight:$().Wy.medium,color:H().Tj.text.primary},externalSourceName:{fontSize:$().J.UISmall.desktop,fontWeight:$().Wy.regular,color:H().Tj.text.secondary}})),[n]);return(0,P.jsxs)("div",{style:g.contentWrapper,children:[(0,P.jsxs)("div",{style:g.leftContentWrapper,children:[(0,P.jsx)("div",{style:g.iconWrapper,children:"sharepoint"===e?(0,P.jsx)(Ie().E,{size:24}):(0,P.jsx)(b().Q,{iconGroup:M().G[e],variantName:"default"})}),(0,P.jsxs)("div",{style:g.titleAndExternalSourceNameWrapper,children:[(0,P.jsxs)("div",{style:g.title,children:[J().w0[e],(0,J().Bm)(e)?void 0:(0,P.jsx)(Mt().A,{})]}),t.externalSourceName?(0,P.jsxs)("div",{style:g.externalSourceName,children:[t.externalSourceName,t.isEnabledForCustomAgents?"slack"===e?r?(0,P.jsx)(U().sA,{id:"aiSettings.customAgentsLabel.readOnly",defaultMessage:"  Read only"}):(0,P.jsx)(U().sA,{id:"aiSettings.customAgentsLabel.readAndPost",defaultMessage:"  Read and post messages"}):(0,P.jsx)(U().sA,{id:"aiSettings.customAgentsLabel",defaultMessage:"  Enterprise Search & Agents"}):null]}):null]})]}),(0,P.jsxs)("div",{style:g.rightContentWrapper,children:[(0,P.jsx)(Xn,{connectorType:e,connectionStatus:t,spaceStore:i}),c?(0,P.jsx)(v().A,{style:{width:24,height:24},iconStyle:{width:20,height:20},icon:F().gearIcon,ariaLabel:s.formatMessage(Rn.aiConnectedAppsSettingsButton),onClick:d}):(0,P.jsx)(f().A,{popupType:f().z.Popup,renderOrigin:e=>(0,P.jsx)(v().A,{...e,style:{width:24,height:24},iconStyle:{width:20,height:20},icon:F().gearIcon,ariaLabel:s.formatMessage(Rn.aiConnectedAppsSettingsButton)}),render:n=>(0,P.jsx)(Yn,{connectorType:e,connectionStatus:t,buttonPopupParent:n})})]})]})}function Yn(e){const{connectorType:t,connectionStatus:n,buttonPopupParent:a}=e,i=(0,u().K8)((()=>Te().EF.isJiraForgeConnectionDone()),[]);return"slack"===t?(0,P.jsx)(Re().SlackConnectionOptions,{parent:a}):"jira"===t?i?(0,P.jsx)(je,{parent:a}):(0,P.jsx)(Pe,{parent:a}):(0,P.jsx)(be,{connector:t,parent:a,connectionStatus:n})}function Qn(e){return"github"===e||"microsoft-teams"===e?72:36}const Jn=["slack_select_channels","microsoft_teams_select_teams","sharepoint_select_sites","jira_connection_pending","jira_select_projects","jira_migrate","slack_migrate","google_drive_connection_pending"];function Xn(e){const{connectorType:t,connectionStatus:n,spaceStore:a}=e,i=(0,d().v3)(),r=(0,o().r)(),l=(0,de().J)(a),c=(0,p().IS)((()=>({connectedStatusWrapper:{display:"flex",gap:4,flexWrap:"nowrap"},connectedStatusIconWrapper:{display:"flex",alignItems:"center",justifyContent:"center"},connectedStatusMessage:{fontSize:$().J.UISmall.desktop,fontWeight:$().Wy.regular,color:H().Tj.text.secondary},connectingStatusWrapper:{display:"flex",gap:4,flexWrap:"nowrap"},connectingStatusIconWrapper:{display:"flex",alignItems:"center",justifyContent:"center"},connectingStatusMessage:{fontSize:$().J.UISmall.desktop,fontWeight:$().Wy.regular,color:H().Tj.text.secondary},connectingStatusIcon:{fill:H().Tj.palette.uiBlue[600]}})),[]);if("connected"===n.type)return(0,P.jsxs)("div",{style:c.connectedStatusWrapper,children:[(0,P.jsx)("div",{style:c.connectedStatusIconWrapper,children:(0,P.jsx)(y().I,{icon:R().checkmarkFillSmallIcon,size:"sm",colorVariant:"tertiary"})}),(0,P.jsx)("div",{style:c.connectedStatusMessage,children:(0,P.jsx)(U().sA,{...Rn.aiConnectedAppsConnectedStatus})})]});if("in_progress"===n.type)return(0,P.jsxs)("div",{style:c.connectingStatusWrapper,children:[(0,P.jsx)("div",{style:c.connectingStatusIconWrapper,children:(0,P.jsx)(y().I,{icon:E,size:"sm",style:c.connectingStatusIcon})}),(0,P.jsx)("div",{style:c.connectingStatusMessage,children:n.ingestionProgress?(0,P.jsx)(U().sA,{...Rn.aiConnectedAppsConnectingStatusWithProgress,values:{progress:n.ingestionProgress}}):(0,P.jsx)(U().sA,{...Rn.aiConnectedAppsConnectingStatus,values:{hours:Qn(t)}})})]});if("action_required"===n.type){const e=(0,q().Xk)(Jn,n.action)&&!l,t=l&&(0,q().O)(Nn,n.action);return(0,P.jsx)(A().m,{disableTooltip:!(e||t),renderTooltip:()=>{const{action:e}=n;if(l&&(0,q().O)(Nn,e)){const t=Nn[e];return(0,P.jsx)(U().sA,{...t})}if((0,q().O)(Fn,e)){const t=Fn[e];return(0,P.jsx)(U().sA,{...t})}return null},render:t=>(0,P.jsx)(x().A,{...t,iconLeading:{icon:B().exclamationMarkTriangleFillIcon,colorVariant:"accentPrimary",colorPalette:"red",size:"sm"},disabled:e,onClick:()=>{r&&function(e){const{action:t,environment:n,spaceId:a,analyticsFrom:i}=e;"slack_select_channels"===t?Ee().nh():"microsoft_teams_select_teams"===t?De().v():"sharepoint_select_sites"===t?De().o():"jira_select_projects"===t?ke().zr():"slack_re_auth"===t?(0,te().t)({connector:"slack",environment:n,spaceId:a,analyticsProperties:{analyticsFrom:i,buttonName:t}}):"slack_v2_user_connection"===t?Ee().JR({environment:n,spaceId:a}):"github_re_auth"===t?(0,te().t)({connector:"github",environment:n,spaceId:a,analyticsProperties:{analyticsFrom:i,buttonName:t}}):"jira_connection_pending"===t?ke().bS({environment:n,spaceId:a,analyticsProperties:{analyticsFrom:i,buttonName:t,sessionId:_e().yg.state.sessionId}}):"jira_connect_user"===t?ke().ol({environment:n,spaceId:a,analyticsProperties:{analyticsFrom:i,buttonName:t,sessionId:_e().yg.state.sessionId}}):"jira_migrate"===t?ke().G({analyticsFrom:i,screenToShow:"introduction"}):"slack_migrate"===t?Ee().FM({environment:n,spaceId:a}):"linear_re_auth"===t?(0,te().t)({connector:"linear",environment:n,spaceId:a,analyticsProperties:{analyticsFrom:i,buttonName:t}}):"discord_re_auth"===t?(0,te().t)({connector:"discord",environment:n,spaceId:a,analyticsProperties:{analyticsFrom:i,buttonName:t}}):"salesforce_re_auth"===t?(0,te().t)({connector:"salesforce",environment:n,spaceId:a,analyticsProperties:{analyticsFrom:i,buttonName:t}}):"google_drive_connection_pending"===t?function(e){const{environment:t,spaceId:n,analyticsProperties:a}=e;n&&((0,s().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:a.buttonName,integration_type:"google-drive",setup_session_id:a.sessionId,from:a.analyticsFrom}}}),(0,le().navigateToAIConnectorOnboarding)({connector:"google-drive",analyticsFrom:a.analyticsFrom,sessionId:a.sessionId}))}({environment:n,spaceId:a,analyticsProperties:{analyticsFrom:i,buttonName:t,sessionId:Qe().d.state.sessionId}}):"asana_re_auth"===t?(0,te().t)({connector:"asana",environment:n,spaceId:a,analyticsProperties:{analyticsFrom:i,buttonName:t}}):"asana_select_workspace"===t?ne().g():"box_awaiting_confirmation"===t?ae().m():(0,q().HB)(t)}({action:n.action,environment:i,spaceId:r,analyticsFrom:"ai_workspace_settings"})},children:(0,P.jsx)(U().sA,{...Bn[n.action]})})})}if("disconnecting"===n.type)return(0,P.jsxs)("div",{style:c.connectingStatusWrapper,children:[(0,P.jsx)("div",{style:c.connectedStatusIconWrapper,children:(0,P.jsx)(y().I,{icon:E,size:"sm",style:c.connectingStatusIcon})}),(0,P.jsx)("div",{style:c.connectingStatusMessage,children:(0,P.jsx)(U().sA,{...Rn.aiConnectedAppsDisconnectingStatus})})]});(0,q().HB)(n)}function Zn({connectedConnectors:e,spaceStore:t}){const n=(0,p().IS)((()=>({contentWrapper:{display:"flex",flexDirection:"column"}})),[]);return(0,P.jsx)("div",{style:n.contentWrapper,children:e.map(((e,n)=>(0,P.jsx)(ea,{spaceStore:t,connectorType:e,showTopBorder:0===n},e)))})}function ea(e){const{connectorType:t,showTopBorder:n,spaceStore:a}=e,i=(0,u().K8)((()=>(0,ue().HF)(t)),[t]);return(0,P.jsx)(Gn,{spaceStore:a,connectorType:t,connectionStatus:i,showTopBorder:n})}function ta(e){const{spaceStore:t,billingData:n,securitySettingsStore:a}=e,s=(0,d().v3)(),o=(0,de().J)(t),r=(0,u().K8)((()=>(0,Le().Q)(s)),[s]),l=(0,u().K8)((()=>t.isAiEnabledOnSpace()),[t]),c=(0,u().K8)((()=>Un({spaceStore:t,billingData:n})&&l),[t,n,l]),p=l,g=l,m=(0,u().K8)((()=>(0,Oe().$6)()),[]),h=(0,i().X)("agent_creation_permissions"),f=(0,u().K8)((()=>(0,W().OX)(t.getSubscriptionTier())),[t]),y=l&&o&&m&&h&&f,v=o&&!l&&!f,b=o&&(r||c),x=(0,u().K8)((()=>l&&(0,Fe().kB)().length>0),[l]),I=l&&o,w=(0,u().K8)((()=>t.getSpaceId()),[t]),C=(0,tt()._)({name:"ai_connectors",spaceId:w,userId:s.currentUser.id}),A=(0,z().wy)(null==C?void 0:C.upsell),T=A?"none":"full";return(0,P.jsxs)(P.Fragment,{children:[b?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et().A,{divider:T,fontSize:A?16:void 0,fontWeight:A?$().Wy.medium:void 0,style:A?{marginBottom:16}:{},hasMarginTop:g,children:(0,P.jsx)(U().sA,{...X().D.notionAI})}),(0,z().wy)(null==C?void 0:C.upsell)?(0,P.jsx)("div",{style:{margin:"24px 0"},children:(0,P.jsx)(xt,{upsell:C.upsell,spaceStore:t})}):void 0,r?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Wn,{billingData:n,spaceStore:t,useShortDescription:!0}),(0,P.jsx)(Dt().A,{size:16})]}):void 0,c?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Ln,{securitySettingsStore:a,spaceStore:t,useShortDescription:!0}),(0,P.jsx)(Dt().A,{size:16})]}):void 0]}):void 0,v?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et().A,{divider:"full",hasMarginTop:!0,children:(0,P.jsx)(U().sA,{...X().D.notionAI})}),(0,P.jsx)(k().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{...Rn.aiDisabledNonEnterpriseMessage,values:{emaillink:e=>(0,P.jsx)(S().V,{href:"mailto:team@makenotion.com",external:!0,onClick:e=>e.stopPropagation(),children:e})}})})]}):void 0,x?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et().A,{divider:"full",hasMarginTop:!0,children:(0,P.jsx)(U().sA,{...Rn.aiConnectorsSettingsHeader})}),(0,P.jsx)(na,{spaceStore:t,featureAvailability:C})]}):void 0,I?(0,P.jsx)(ia,{spaceStore:t}):void 0,g?(0,P.jsx)(Sn,{}):void 0,p?(0,P.jsx)(un,{spaceStore:t,headingMessage:Rn.aiSettingsMeetingNotesHeader}):void 0,y?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et().A,{divider:"full",hasMarginTop:!0,children:(0,P.jsx)(U().sA,{...Rn.customAgentCreationHeader})}),(0,P.jsx)(On,{spaceStore:t}),(0,P.jsx)(Dt().A,{size:16})]}):void 0]})}function na(e){const{featureAvailability:t,spaceStore:n}=e,s=(0,d().v3)(),o=(0,a.useRef)(null),r=(0,l().U2)(n),c=(0,Oe().ke)(),g=(0,i().X)("custom_mcp_server_workspace_toggle"),m=(0,u().K8)((()=>(null==r?void 0:r.isWorkspaceOwner())??!1),[r]),f=(0,u().K8)((()=>!1===n.getSetting("disallow_custom_mcp_servers")),[n]),y=function({setting:e,elementRef:t,scrollDelayMs:n=200,scrollPaddingToEdge:i=64,clearAfterMs:s=4*$e().TD}){const o=(0,d().v3)(),r=(0,a.useContext)(Ke().U),l=(0,u().K8)((()=>Ge().Ay.state.highlightedSetting===e),[e]);return(0,a.useEffect)((()=>{if(!l)return;const a=t.current;if(!a)return;const c=window.setTimeout((()=>{if(null!=r&&r.verticalScroller){const e=r.verticalScroller.getClientRect();if(!e)return void a.scrollIntoView({behavior:"smooth",block:"center"});const t=a.getBoundingClientRect(),n=e.top+i,s=e.bottom-i,l=t.top<n?"top":t.bottom>s?"bottom":void 0;l&&(0,qe().h)({element:a,environment:o,scrollerContext:r,vertical:{reveal:l,paddingToTopEdge:i,paddingToBottomEdge:i},horizontal:void 0,animate:!0})}else a.scrollIntoView({behavior:"smooth",block:"center"})}),n),d=void 0===s?void 0:window.setTimeout((()=>{Ge().Ay.state.highlightedSetting===e&&Ge().Ay.setState({...Ge().Ay.state,highlightedSetting:void 0})}),s);return()=>{window.clearTimeout(c),void 0!==d&&window.clearTimeout(d)}}),[s,t,o,r,n,i,e,l]),l}({setting:Ge().rF.CustomMcpServers,elementRef:o}),v=a.useCallback((e=>{at().createAndCommit({userAction:"AiSettings.toggleCustomMcpServers",environment:s,canUndo:!1,perform:t=>{G().zv({store:n.getSettingsStore(),transaction:t,data:{disallow_custom_mcp_servers:!e}})}})}),[s,n]),b=(0,p().IS)((()=>({settingRow:{display:"flex",alignItems:"center",gap:16,minHeight:40,borderRadius:4,backgroundColor:y?H().Tj.blue.background.secondaryTranslucent:void 0,boxShadow:y?`0 0 0 8px ${H().Tj.blue.background.secondaryTranslucent}`:void 0,transition:"background-color 150ms ease-out, box-shadow 150ms ease-out"},settingDetails:{flex:1,display:"flex",flexDirection:"column",gap:6},settingTitle:{display:"flex",alignItems:"center",gap:10},descriptionText:{lineHeight:1.4}})),[y]),{isLoading:x}=(0,ee().ts)(void 0,!0),I=(0,u().K8)((()=>(0,Fe().kB)()),[]),C=(0,u().K8)((()=>x?[]:(0,Fe().wd)()),[x]),{availableWorkspaceConnectors:A,availablePersonalConnectors:M,inProgressAndConnectedConnectors:_}=(0,u().K8)((()=>{const e=[],t=[],n=[];for(const a of I){const i=(0,ue().HF)(a);if("action_required"===i.type)n.push(a);else if("in_progress"===i.type)n.push(a);else if("disconnecting"===i.type)n.push(a);else if((0,j().q1)(a)){const e=(0,J().uV)(a);C.includes(e)?t.push(a):C.includes(a)?n.push(a):t.push(a)}else C.includes(a)?n.push(a):e.push(a)}return{availableWorkspaceConnectors:e,availablePersonalConnectors:t,inProgressAndConnectedConnectors:n}}),[I,C]);return(0,P.jsxs)(P.Fragment,{children:[_.length>0?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(T().A,{isSmall:!0,style:{marginBottom:6},children:(0,P.jsx)(U().sA,{...Rn.connectedAppsLabel})}),(0,P.jsx)(Zn,{spaceStore:n,connectedConnectors:_}),(0,P.jsx)(Dt().A,{size:8})]}):void 0,M.length>0?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et().A,{fontWeight:$().Wy.medium,style:{marginBottom:6},children:(0,P.jsx)(h().Y1,{direction:"horizontal",align:"center-left",gap:3,children:(0,P.jsx)(U().sA,{...Rn.personalAiConnectorsHeader})})}),(0,P.jsx)(k().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{...Rn.personalAiConnectorsDescription})}),(0,P.jsx)(Dt().A,{size:2}),(0,P.jsx)($n,{availableConnectors:M}),(0,P.jsx)(Dt().A,{size:8})]}):void 0,A.length>0?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et().A,{fontWeight:$().Wy.medium,style:{marginBottom:6},children:(0,P.jsx)(h().Y1,{direction:"horizontal",align:"center-left",gap:3,children:(0,P.jsxs)(h().Y1,{direction:"horizontal",align:"center-left",gap:3,children:[(0,P.jsx)(U().sA,{...Rn.workspaceAiConnectorsHeader}),(0,P.jsx)(et().W,{tooltipTitle:(0,P.jsx)(U().sA,{...Rn.learnMore}),buttonProps:{href:(0,Ve().x)("guides.aiConnectors"),external:!0}})]})})}),(0,z().wy)(null==t?void 0:t.upsell)?(0,P.jsxs)(h().Y1,{direction:"horizontal",align:"center-left",children:[(0,P.jsx)(k().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{...Rn.workspaceAiConnectorsDescription})}),(0,P.jsx)(nt().UpgradeButton,{source:"business_trial_ai_connectors_upsell",upsell:null==t?void 0:t.upsell,display:"text",spaceStore:n})]}):(0,P.jsx)(k().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{...Rn.workspaceAiConnectorsDescriptionWithLearnMore,values:{learnmore:e=>(0,P.jsx)(S().V,{href:(0,Ve().x)("guides.aiConnectors"),external:!0,onClick:e=>e.stopPropagation(),children:e})}})}),(0,P.jsx)(Dt().A,{size:2}),(0,P.jsx)($n,{availableConnectors:A}),(0,P.jsx)(Dt().A,{size:16}),(0,P.jsx)(Dn,{})]}):void 0,m&&c&&g?(0,P.jsxs)("div",{style:b.settingRow,ref:o,children:[(0,P.jsxs)("div",{style:b.settingDetails,children:[(0,P.jsx)("div",{style:b.settingTitle,children:(0,P.jsxs)(h().Y1,{direction:"horizontal",gap:3,align:"center-left",children:[(0,P.jsx)(k().D,{styleKey:"bodyRegular",colorVariant:"primary",children:(0,P.jsx)(U().sA,{...Rn.enableCustomConnections})}),(0,P.jsx)(et().W,{tooltipTitle:(0,P.jsx)(U().sA,{...Rn.learnMore}),buttonProps:{href:"https://developers.notion.com/docs/mcp-security-best-practices",external:!0}})]})}),(0,P.jsx)("div",{style:b.descriptionText,children:(0,P.jsx)(k().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{...Rn.enableCustomMcpServersDescription})})})]}),(0,P.jsx)(w().A,{on:f,onClick:()=>{v(!f)}})]}):null]})}function aa({spaceStore:e,isZeroRetentionEnabled:t}){const n=(0,d().v3)(),i=(0,de().J)(e),s=(0,u().K8)((()=>Boolean(e.getSetting("force_ask_for_confirmation_on_web_open_requests"))),[e]),o=!i||t,r=(0,a.useCallback)((()=>{i&&!t&&at().createAndCommit({userAction:"AiSettings.toggleWebSearch",environment:n,canUndo:!1,perform:t=>{G().zv({store:e.getSettingsStore(),transaction:t,data:{force_ask_for_confirmation_on_web_open_requests:!s}})}})}),[i,n,e,s,t]),l=t?(0,P.jsx)(U().sA,{...Rn.aiWebSearchZeroRetentionTooltip}):void 0;return(0,P.jsx)(Rt().A,{spaceStore:e,type:"toggle",isOn:s,onToggle:r,disabled:o,isLocked:t,lockedTooltip:l,title:(0,P.jsx)(U().sA,{defaultMessage:"Require confirmation for web requests",id:"aiSettings.aiForceConfirmationOnWebOpenRequestsToggleLabel"}),caption:(0,P.jsx)(U().sA,{defaultMessage:"Agent might try to load external web pages to get information not available though web search. Require AI to request user confirmation to view any web page.",id:"aiSettings.aiForceConfirmationOnWebOpenRequestsToggleCaption"})})}function ia({spaceStore:e}){const t=(0,d().v3)(),n=(0,de().J)(e),i=(0,u().K8)((()=>(0,ze().A)(e)),[e]),s=(0,u().K8)((()=>Boolean(e.getSetting("disable_ai_web_search"))),[e]),o=!!i||s,r=!n||i,l=i?(0,P.jsx)(U().sA,{...Rn.aiWebSearchZeroRetentionTooltip}):void 0,c=(0,a.useCallback)((()=>{n&&!i&&at().createAndCommit({userAction:"AiSettings.toggleWebSearch",environment:t,canUndo:!1,perform:t=>{G().zv({store:e.getSettingsStore(),transaction:t,data:{disable_ai_web_search:!s}})}})}),[t,e,s,n,i]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et().A,{divider:"full",hasMarginTop:!0,children:(0,P.jsx)(U().sA,{...Rn.aiWebSearchSettingsHeader})}),(0,P.jsx)(Rt().A,{spaceStore:e,type:"toggle",isOn:!o,onToggle:c,disabled:r,isLocked:i,lockedTooltip:l,title:(0,P.jsx)(U().sA,{...Rn.aiWebSearchGlobalToggleLabel}),caption:(0,P.jsx)(U().sA,{...Rn.aiWebSearchGlobalToggleCaption})}),(0,P.jsx)(Dt().A,{size:16}),(0,P.jsx)(aa,{spaceStore:e,isZeroRetentionEnabled:i}),(0,P.jsx)(Dt().A,{size:16})]})}var sa=()=>n(457063),oa=()=>n(807778);const ra=(0,U().YK)({webSearchHeader:{id:"aiSettings.webSearchV2.header",defaultMessage:"Web search"},enableWebSearchLabel:{id:"aiSettings.webSearchV2.enableWebSearch.label",defaultMessage:"Enable web search for workspace"},enableWebSearchDescription:{id:"aiSettings.webSearchV2.enableWebSearch.description",defaultMessage:"Allow AI to search the web for up-to-date information when answering questions."},requireConfirmationLabel:{id:"aiSettings.webSearchV2.requireConfirmation.label",defaultMessage:"Require confirmation for web requests"},requireConfirmationDescription:{id:"aiSettings.webSearchV2.requireConfirmation.description",defaultMessage:"Agent might try to load external web pages to get information not available though web search. Require AI to request user confirmation to view any web page."}});function la({spaceStore:e}){const t=(0,d().v3)(),n=(0,l().U2)(e),i=(0,u().K8)((()=>(null==n?void 0:n.isWorkspaceOwner())??!1),[n]),s=(0,u().K8)((()=>(0,ze().A)(e)),[e]),o=(0,u().K8)((()=>Boolean(e.getSetting("disable_ai_web_search"))),[e]),r=(0,u().K8)((()=>Boolean(e.getSetting("force_ask_for_confirmation_on_web_open_requests"))),[e]),c=(0,a.useCallback)((()=>{i&&at().createAndCommit({userAction:"AiSettings.toggleWebSearch",environment:t,canUndo:!1,perform:t=>{G().zv({store:e.getSettingsStore(),transaction:t,data:{disable_ai_web_search:!o}})}})}),[t,e,o,i]),g=(0,a.useCallback)((()=>{i&&at().createAndCommit({userAction:"AiSettings.toggleForceConfirmationOnWebOpenRequests",environment:t,canUndo:!1,perform:t=>{G().zv({store:e.getSettingsStore(),transaction:t,data:{force_ask_for_confirmation_on_web_open_requests:!r}})}})}),[t,e,r,i]),m=!!s||o,h=(0,p().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:12},header:{fontWeight:$().Wy.medium,display:"flex",height:28,alignItems:"center"}})),[]);return i?(0,P.jsxs)("div",{style:h.container,children:[(0,P.jsx)(T().A,{style:h.header,children:(0,P.jsx)(U().sA,{...ra.webSearchHeader})}),(0,P.jsx)(Rt().A,{spaceStore:e,type:"toggle",isOn:!m,onToggle:c,title:(0,P.jsx)(U().sA,{...ra.enableWebSearchLabel}),caption:(0,P.jsx)(U().sA,{...ra.enableWebSearchDescription})}),(0,P.jsx)(Rt().A,{spaceStore:e,type:"toggle",isOn:r,onToggle:g,title:(0,P.jsx)(U().sA,{...ra.requireConfirmationLabel}),caption:(0,P.jsx)(U().sA,{...ra.requireConfirmationDescription})})]}):null}function ca({spaceStore:e,featureAvailability:t}){return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{children:(0,P.jsx)(na,{spaceStore:e,featureAvailability:t})}),(0,P.jsx)(la,{spaceStore:e})]})}var da=()=>n(427508);function ua({spaceStore:e}){return(0,P.jsx)(da().Z,{spaceStore:e})}n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(803949);var pa=()=>n(791177),ga=()=>n(569397),ma=()=>n(274570),ha=()=>n(126617),fa=()=>n(344417),ya=()=>n(792071),va=()=>n(785728),Sa=()=>n(769864),ba=()=>n(322976),xa=()=>n(483838),Ia=()=>n(388521),ka=()=>n(860814),wa=()=>n(450338),Ca=()=>n(786416),Aa=()=>n(122078),Ta=()=>n(297474),ja=()=>n(800023),Ma=()=>n(419357),_a=()=>n(817865);const Pa=(0,U().YK)({agentsSearchPlaceholder:{id:"aiSettings.customAgents.searchPlaceholder",defaultMessage:"Search by name..."},moreActionsAriaLabel:{id:"aiSettings.customAgents.moreActionsAriaLabel",defaultMessage:"More actions"},agentsTableTitle:{id:"aiSettings.customAgents.agentsTableTitle",defaultMessage:"Search agents in workspace"},monthlyCreditUtilization:{id:"aiSettings.customAgents.monthlyCreditUtilization",defaultMessage:"Monthly credit utilization"},aiCreditsLink:{id:"aiSettings.customAgents.aiCreditsLink",defaultMessage:"AI credits"},showAllAgents:{id:"aiSettings.customAgents.showAllAgents",defaultMessage:"Show all"},statusActive:{id:"aiSettings.customAgents.status.active",defaultMessage:"Active"},statusDisabled:{id:"aiSettings.customAgents.status.disabled",defaultMessage:"Disabled"},statusDeleted:{id:"aiSettings.customAgents.status.deleted",defaultMessage:"Deleted"},statusPillTitle:{id:"aiSettings.customAgents.status.pillTitle",defaultMessage:"Status"}});function Da({spaceStore:e,hideHeader:t=!1}){const n=(0,U().tz)(),i=(0,d().v3)();(0,a.useEffect)((()=>{(async()=>{const t=e.getSpaceId(),n=await Sa().callApi({eventName:"getAllSpacePermissionGroupsWithMemberCount",environment:i,data:{spaceId:t},headers:(0,va().WS)({cellId:void 0,spaceId:t})});if("success"===n.type){const e=new Map;n.data.groupsWithMemberCount.forEach((t=>{const n=ya().Bj6.fromValue("space_permission_group",t.group);e.set(n.getGroupId(),{group:n,memberCount:t.memberCount,membershipTypes:t.membershipTypes})})),Ze().h.setState({permissionGroupsAndMemberCounts:e})}})()}),[e,i]);const[s,o]=(0,a.useState)(""),[r,l]=(0,pa().$)(),[c,g]=(0,a.useState)(!1),m=(0,u().K8)((()=>Array.from(Ze().h.state.permissionGroupsAndMemberCounts.values()).sort(((e,t)=>{const n=e.group.name||"",a=t.group.name||"";return n.localeCompare(a)}))),[]),h=(0,u().K8)((()=>m.filter((e=>{const t=e.group.v("settings");return!0===(null==t?void 0:t.can_create_custom_agents)}))),[m]),S=(0,u().K8)((()=>m.filter((e=>{const t=e.group.v("settings");return!0!==(null==t?void 0:t.can_create_custom_agents)}))),[m]),b=(0,u().K8)((()=>s.trim()?(0,K().Ay)(s,S,(e=>e.group.name||"")):[]),[s,S]),x=(0,a.useCallback)(((t,n)=>{at().createAndCommit({userAction:"AiSettings.updatePermissionGroupAgentPolicy",environment:i,canUndo:!0,perform:a=>{const i=(0,Ye().E)({spaceStore:e,groupId:t}),s={...i.getSettings()||{},can_create_custom_agents:n};(0,Q().O)({spacePermissionGroupStore:i,transaction:a,value:{settings:s,last_edited_at:Date.now()}})}})}),[i,e]),I=(0,u().K8)((()=>h.map((e=>{const t=e.group.v("settings"),a=!0===(null==t?void 0:t.can_create_custom_agents);return{id:e.group.group_id,isClickable:!1,groupId:e.group.group_id,groupName:e.group.name||n.formatMessage({id:"spacePermissionsSettings.groupsTab.untitled",defaultMessage:"Untitled"}),memberCount:e.memberCount,group:e.group,currentPolicy:a}}))),[h,n]),w=(0,a.useMemo)((()=>[{id:"name",headerTitle:(0,P.jsx)(U().sA,{id:"spacePermissionsSettings.groupsTab.nameColumn",defaultMessage:"Group name"}),renderCell:e=>(0,P.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,P.jsx)(_t().A,{size:20}),(0,P.jsx)("span",{children:e.groupName})]}),widthData:{widthPercent:50,minWidth:150},sortable:!1},{id:"members",headerTitle:(0,P.jsx)(U().sA,{id:"spacePermissionsSettings.groupsTab.membersColumn",defaultMessage:"Members"}),renderCell:e=>(0,P.jsx)("span",{style:{color:H().Tj.text.secondary,fontSize:"14px"},children:1===e.memberCount?"1 member":`${e.memberCount} members`}),widthData:{widthPercent:25,minWidth:150},sortable:!1},{id:"policy",headerTitle:"",renderCell:e=>(0,P.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:(0,P.jsx)(f().A,{popupType:f().z.Popup,originGap:4,renderOrigin:e=>(0,P.jsx)(v().A,{...e,icon:ha().ellipsisSmallIcon,ariaLabel:n.formatMessage(Pa.moreActionsAriaLabel)}),render:t=>{const n=[{key:"actions",render:e=>(0,P.jsx)(ve().A,{...e}),items:[{key:"remove",render:e=>(0,P.jsx)(Nt().A,{...e,svg:()=>(0,P.jsx)(y().I,{icon:Me().trashIcon,size:"sm"}),title:"Remove",isRed:!0}),action:()=>{x(e.groupId,!1),t.close()}}]}];return(0,P.jsx)(he().A,{menuType:me().gu.Popup,width:200,maxHeight:300,header:null,children:(0,P.jsx)("div",{style:{padding:"6px 0"},children:(0,P.jsx)(ye().A,{type:ye().O.Vertical,sections:n,onAccept:t.close,initialFocus:0})})})}})}),widthData:{widthPercent:10,minWidth:60},sortable:!1}]),[x,n]),A=(0,C().rC)({columnRenderInfo:w,containerMarginTop:12}),j=(0,p().IS)((()=>({noRowContainer:{display:"flex",height:32,paddingInlineStart:12,paddingInlineEnd:12,alignItems:"center",gap:4,borderBottom:`1px solid ${H().Tj.border.primary}`},searchContainer:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},searchInput:{width:240,maxWidth:"40%"}})),[]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Dt().A,{size:12}),t?void 0:(0,P.jsx)(Et().A,{children:(0,P.jsx)(U().sA,{...Rn.permissionGroupCustomPoliciesHeaderV2})}),(0,P.jsxs)("div",{style:j.searchContainer,children:[(0,P.jsx)(k().D,{styleKey:"bodyRegular",colorVariant:"primary",children:(0,P.jsx)(U().sA,{...Rn.permissionGroupCustomPoliciesCaptionV2})}),(0,P.jsx)("div",{style:j.searchInput,children:(0,P.jsx)(f().A,{popupType:f().z.Popup,open:c,originGap:4,renderOrigin:()=>(0,P.jsx)(Ma().Ay,{placeholder:n.formatMessage(Rn.permissionGroupCustomPoliciesSearchPlaceholderV2),value:s,onChange:e=>{const t=e.target.value;o(t),g(t.trim().length>0)},inputLeft:(0,P.jsx)(Ma().Zf,{icon:fa().magnifyingGlassSmallIcon}),...r}),render:e=>{const t=[{key:"results",render:e=>(0,P.jsx)(ve().A,{...e}),items:0===b.length?[{key:"no-results",render:e=>(0,P.jsx)(fe().A,{...e,disabled:!0,title:(0,P.jsx)(U().sA,{id:"aiSettings.customAgentCreation.permissionGroupCustomPolicies.noResults",defaultMessage:"No groups found"})}),action:()=>{}}]:b.map((t=>({key:t.group.group_id,render:e=>(0,P.jsx)(fe().A,{...e,icon:(0,P.jsx)(_t().A,{size:20}),title:t.group.name||"Untitled",caption:1===t.memberCount?"1 member":`${t.memberCount} members`}),action:()=>{x(t.group.group_id,!0),o(""),g(!1),e.close()}})))}];return(0,P.jsx)(he().A,{menuType:me().gu.Popup,width:400,maxHeight:400,minHeight:50,children:(0,P.jsx)(ye().A,{type:ye().O.Vertical,sections:t,comboboxProps:l,onAccept:e.close,initialFocus:0})})}})})]}),(0,P.jsx)(C().WE,{showRowBorders:!0,hideHeaderRowPadding:!0,columnRenderInfo:w,rows:I,styles:A,renderNoRowsComponent:()=>(0,P.jsx)(T().A,{isSmall:!0,style:j.noRowContainer,children:(0,P.jsx)(U().sA,{id:"aiSettings.customAgentCreation.permissionGroupCustomPolicies.noEnabledGroups",defaultMessage:"No groups enabled for agent creation"})})})]})}function Ea({spaceStore:e,onNavigateToCreditUtilization:t}){const n=(0,U().tz)(),i=(0,l().U2)(e),s=(0,u().K8)((()=>(null==i?void 0:i.isWorkspaceOwner())??!1),[i]),r=(0,u().K8)((()=>(0,W().HO)(e.getSubscriptionTier())),[e]),[c,d]=(0,a.useState)(""),[g,m]=(0,a.useState)([]),[h,f]=(0,a.useState)({starting:void 0,ending:void 0}),[v,S]=(0,a.useState)({starting:void 0,ending:void 0}),[b,w]=(0,a.useState)(),[C,A]=(0,a.useState)({starting:void 0,ending:void 0}),[T,j]=(0,a.useState)(["active","disabled"]),[M,_]=(0,a.useState)([]),[D,E]=(0,a.useState)([]),[R,B]=(0,a.useState)([]),[F,N]=(0,a.useState)(!1),[L,O]=(0,a.useState)(0),V=n.formatMessage(Pa.agentsSearchPlaceholder),z=(0,o().r)(),K=(0,oa().Yv)(),{dateRanges:$,isLoading:G}=(0,ja().C)(z),Y=$[$.length-1],Q=null==Y?void 0:Y.start.getTime(),{usage:J,limits:X,isLoading:Z}=(0,Ta().$)(z,Q),ee=(null==J?void 0:J.currentServicePeriod.spaceUsage)??0,te=(null==X?void 0:X.purchased.totalLimit)??0,ne=(0,p().IS)((()=>({searchContainer:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},agentsSearchInput:{width:240,maxWidth:"40%"},filterPillsContainer:{display:"flex",gap:2,alignItems:"center",flexWrap:"nowrap",flex:1,minWidth:0},loadMoreButton:{display:"flex",alignItems:"center",marginInlineStart:6,paddingTop:2,paddingBottom:2,paddingInlineStart:6,paddingInlineEnd:8,marginTop:-8,marginBottom:4,color:H().Tj.text.tertiary},loadMoreButtonIcon:{marginInlineStart:1,marginInlineEnd:7}})),[]),ae=(0,a.useMemo)((()=>new Set(["active","disabled","deleted"])),[]),ie=He(e);return(0,P.jsxs)(P.Fragment,{children:[K&&!G&&!Z&&$.length>0&&t?(0,P.jsx)(Rt().A,{type:"custom",spaceStore:e,title:(0,P.jsx)(U().sA,{...Pa.monthlyCreditUtilization}),caption:(0,P.jsx)(U().sA,{id:"aiSettings.customAgents.creditUsageWithHighlight",defaultMessage:"Custom agents have used {usageHighlight} workspace credits",values:{usageHighlight:(0,P.jsxs)("span",{style:{color:H().Tj.purple.text.accentPrimary},children:[n.formatNumber(ee)," of ",n.formatNumber(te)]})}}),customButton:(0,P.jsx)(x().A,{size:"md",onClick:t,iconTrailing:ga().arrowStraightRightSmallIcon,children:(0,P.jsx)(U().sA,{...Pa.aiCreditsLink})})}):void 0,s&&r?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(On,{spaceStore:e,hidePermissionGroups:!0,hideTitleAndCaption:!0,customTitle:(0,P.jsx)(U().sA,{...Rn.permissionGroupCustomPoliciesHeaderV2})}),"custom"===ie?(0,P.jsx)(Da,{spaceStore:e,hideHeader:!0}):void 0,(0,P.jsx)(Dt().A,{size:12})]}):void 0,s&&r?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{style:ne.searchContainer,children:[(0,P.jsx)(k().D,{styleKey:"bodyRegular",colorVariant:"primary",children:(0,P.jsx)(U().sA,{...Pa.agentsTableTitle})}),(0,P.jsx)("div",{style:ne.agentsSearchInput,children:(0,P.jsx)(Ma().Ay,{placeholder:V,value:c,onChange:e=>d(e.target.value),inputLeft:(0,P.jsx)(Ma().Zf,{icon:fa().magnifyingGlassSmallIcon})})})]}),(0,P.jsxs)("div",{style:ne.filterPillsContainer,children:[(0,P.jsx)(wa().I,{spaceStore:e,sharedWithFilterItems:b,setSharedWithFilter:e=>w(e),runNewSearch:()=>{},includeGroups:!0,includeGuests:!0,includeAgents:!1}),(0,P.jsx)(xa().Q,{spaceStore:e,createdByFilterIds:g,setCreatedByFilter:m,includeGuests:!0}),(0,P.jsx)(Ia().Z,{lastEditedTime:v,createdTime:h,setLastEditedTime:S,setCreatedOnTime:f}),(0,P.jsx)(_a().A,{mode:ba().C.Pill,focused:!1,hideTime:!0,pillTitle:"Last activity",title:"Last activity",icon:ma().clockIcon,value:C,showButtons:"footer",onChange:e=>{A(e)}}),(0,P.jsx)(ka().A,{allOptions:ae,selectedOptions:T,setSelectedOption:j,getFormattedStringTitle:e=>"active"===e?n.formatMessage(Pa.statusActive):"disabled"===e?n.formatMessage(Pa.statusDisabled):"deleted"===e?n.formatMessage(Pa.statusDeleted):void(0,q().HB)(e),getFormattedStringCaption:()=>"",getPillTitle:e=>0===e.length?n.formatMessage(Pa.statusPillTitle):e.map((e=>"active"===e?n.formatMessage(Pa.statusActive):"disabled"===e?n.formatMessage(Pa.statusDisabled):"deleted"===e?n.formatMessage(Pa.statusDeleted):void(0,q().HB)(e))).join(", "),pillIcon:ma().clockIcon}),(0,P.jsx)(Aa().I,{integrationTypes:M,setIntegrationTypes:_,mcpServerNames:D,setMcpServerNames:E,distinctMcpServers:R})]}),(0,P.jsx)(Ca().l,{spaceStore:e,searchQuery:c,createdByIds:g,createdTime:h,lastEditedTime:v,sharedWith:b,lastActivityTime:C,status:T,integrationTypes:M,mcpServerNames:D,limit:F?void 0:3,onHasMore:O,onDistinctMcpServersChange:B}),!F&&L>3?(0,P.jsxs)(I().p,{onClick:()=>N(!0),style:ne.loadMoreButton,children:[(0,P.jsx)(y().I,{icon:ha().ellipsisSmallIcon,colorVariant:"tertiary",size:"sm",style:ne.loadMoreButtonIcon}),(0,P.jsx)(U().sA,{...Pa.showAllAgents})]}):void 0]}):void 0]})}var Ra=()=>n(361173),Ba=()=>n(324883);const Fa=(0,U().YK)({enableNotionAI:{id:"aiSettings.enableNotionAI",defaultMessage:"Enable Notion AI"},enableNotionAIDescription:{id:"aiSettings.enableNotionAIDescription",defaultMessage:"Enable AI for all members of your workspace, agreeing to the <inlinelink>Notion AI Terms</inlinelink>"},shareDataToImprove:{id:"aiSettings.shareDataToImprove",defaultMessage:"Share data to improve Notion AI"},shareDataToImproveDescription:{id:"aiSettings.shareDataToImproveDescription",defaultMessage:"Help improve Notion AI by allowing data from this workspace to be shared with Notion. By enabling the Learning and Early Access Program you are agreeing to the <inlinelink>Supplementary Terms</inlinelink>."},personalization:{id:"aiSettings.personalization",defaultMessage:"Personalization"},personalizationDescription:{id:"aiSettings.personalizationDescription",defaultMessage:"Pick a name, choose an accessory, and set how Notion AI talks and helps you. Start from a template or build your own style."},personalizeButton:{id:"aiSettings.personalizeButton",defaultMessage:"Personalize"}});function Na({spaceStore:e,securitySettingsStore:t,billingData:n}){const a=(0,d().v3)(),i=(0,l().U2)(e),s=(0,u().K8)((()=>(null==i?void 0:i.isWorkspaceOwner())??!1),[i]),o=(0,u().K8)((()=>(0,W().OX)(e.getSubscriptionTier())),[e]),r=(0,u().K8)((()=>e.isAiEnabledOnSpace()),[e]),c=(0,u().K8)((()=>Un({spaceStore:e,billingData:n})&&r),[e,n,r]),g=(0,u().K8)((()=>Boolean(t.state.enableAiTraining)),[t]),m=(0,p().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:24},settingRow:{display:"flex",alignItems:"center",gap:16,minHeight:40},settingDetails:{flex:1,display:"flex",flexDirection:"column",gap:6},settingTitle:{display:"flex",alignItems:"center",gap:10},infoIcon:{display:"flex",alignItems:"center",justifyContent:"center",width:16,height:16},descriptionText:{lineHeight:1.4}})),[]);return(0,P.jsxs)("div",{style:m.container,children:[s&&o?(0,P.jsxs)("div",{style:m.settingRow,children:[(0,P.jsxs)("div",{style:m.settingDetails,children:[(0,P.jsx)("div",{style:m.settingTitle,children:(0,P.jsx)(k().D,{styleKey:"bodyRegular",colorVariant:"primary",children:(0,P.jsx)(U().sA,{...Fa.enableNotionAI})})}),(0,P.jsx)("div",{style:m.descriptionText,children:(0,P.jsx)(k().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{...Fa.enableNotionAIDescription,values:{inlinelink:e=>(0,P.jsx)(S().V,{href:"https://www.notion.so/terms#notion-ai-supplemental",external:!0,children:e})}})})})]}),(0,P.jsx)(w().A,{on:r,onClick:async()=>{await Hn({environment:a,billingData:n,spaceStore:e})}})]}):void 0,s&&c?(0,P.jsxs)("div",{style:m.settingRow,children:[(0,P.jsxs)("div",{style:m.settingDetails,children:[(0,P.jsxs)("div",{style:m.settingTitle,children:[(0,P.jsx)(k().D,{styleKey:"bodyRegular",colorVariant:"primary",children:(0,P.jsx)(U().sA,{...Fa.shareDataToImprove})}),(0,P.jsx)("div",{style:m.infoIcon,children:(0,P.jsx)(y().I,{icon:Ra().infoCircleFillSmallIcon,colorVariant:"secondary",size:"sm"})})]}),(0,P.jsx)("div",{style:m.descriptionText,children:(0,P.jsx)(k().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{...Fa.shareDataToImproveDescription,values:{inlinelink:e=>(0,P.jsx)(S().V,{href:"https://www.notion.so/terms#supplemental",external:!0,children:e})}})})})]}),(0,P.jsx)(w().A,{on:g,onClick:()=>{Y().X(a,{securitySettingsStore:t,spaceStore:e,fields:{enableAiTraining:!g}})}})]}):void 0,r?(0,P.jsxs)("div",{style:m.settingRow,children:[(0,P.jsxs)("div",{style:m.settingDetails,children:[(0,P.jsx)("div",{style:m.settingTitle,children:(0,P.jsx)(k().D,{styleKey:"bodyRegular",colorVariant:"primary",children:(0,P.jsx)(U().sA,{...Fa.personalization})})}),(0,P.jsx)("div",{style:m.descriptionText,children:(0,P.jsx)(k().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,P.jsx)(U().sA,{...Fa.personalizationDescription})})}),(0,P.jsx)("div",{style:{marginTop:6},children:(0,P.jsx)(x().A,{onClick:()=>{hn().cP({store:yn().r,from:"ai_settings",shouldSetSeenPersonalizationSettingsModal:!1}),mn().os()},iconLeading:{icon:Ba().s,size:"sm"},children:(0,P.jsx)(U().sA,{...Fa.personalizeButton})})})]}),(0,P.jsx)("img",{src:fn,alt:"",style:{width:197,height:"auto",borderRadius:4}})]}):null]})}function La(){const e=(0,p().IS)((()=>({container:{display:"flex",alignItems:"center",height:20,paddingInlineEnd:8},iconWrapper:{display:"flex",alignItems:"center",justifyContent:"center",width:18,height:18,borderRadius:27,backgroundColor:H().Tj.background.primary,boxShadow:"0px 0px 0px 0.75px rgba(227, 226, 224, 0.3), 0px 3px 9px -1.5px rgba(0, 0, 0, 0.08)",padding:3,marginInlineEnd:-6}})),[]),t=M().s.slack,n=M().s.github,a=M().s["google-drive"];return(0,P.jsxs)("div",{style:e.container,children:[(0,P.jsx)("div",{style:{...e.iconWrapper,zIndex:3},children:(0,P.jsx)(y().I,{icon:t,size:"xxs"})}),(0,P.jsx)("div",{style:{...e.iconWrapper,zIndex:2},children:(0,P.jsx)(y().I,{icon:n,size:"xxs"})}),(0,P.jsx)("div",{style:{...e.iconWrapper,zIndex:1},children:(0,P.jsx)(y().I,{icon:a,size:"xxs"})})]})}const Oa=(0,U().YK)({aiSettingsGeneralTabLabel:{id:"aiSettings.tabs.general",defaultMessage:"General"},aiSettingsAiConnectorsTabLabel:{id:"aiSettings.tabs.aiConnectors",defaultMessage:"AI connectors"},aiSettingsCustomAgentsTabLabel:{id:"aiSettings.tabs.customAgents",defaultMessage:"Agents"},aiSettingsMeetingNotesTabLabel:{id:"aiSettings.tabs.meetingNotes",defaultMessage:"Meeting notes"},aiSettingsCreditUtilizationTabLabel:{id:"aiSettings.tabs.creditUtilization",defaultMessage:"Credit utilization"}});function Va(e){const t=(0,d().v3)(),[n,i]=(0,a.useState)("general");(0,a.useEffect)((()=>{const e=Ge().Ay.state;"ai"===e.currentTab&&e.defaultSubtab&&(0,q().Xk)(Ge().IO,e.defaultSubtab)&&(i(e.defaultSubtab),Ge().Ay.setState({...e,defaultSubtab:void 0}))}),[]);const s=(0,l().U2)(e.spaceStore),o=(0,u().K8)((()=>(null==s?void 0:s.isWorkspaceOwner())??!1),[s]),r=(0,oa().Yv)(),c=(0,oa().QH)(),g=(0,u().K8)((()=>e.spaceStore.getSpaceId()),[e.spaceStore]),m=(0,u().K8)((()=>(0,W().HO)(e.spaceStore.getSubscriptionTier())),[e.spaceStore]),h=(0,tt()._)({name:"ai_connectors",spaceId:g,userId:t.currentUser.id}),f=(0,p().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:32},header:{display:"flex",flexDirection:"column",gap:12},tabContent:{display:"flex",flexDirection:"column",gap:24}})),[]),y=(0,P.jsx)("div",{style:f.tabContent,children:(0,P.jsx)(Na,{spaceStore:e.spaceStore,securitySettingsStore:e.securitySettingsStore,billingData:e.billingData})}),v=(0,P.jsx)("div",{style:f.tabContent,children:(0,P.jsx)(ca,{spaceStore:e.spaceStore,featureAvailability:h})}),S=(0,P.jsx)("div",{style:f.tabContent,children:(0,P.jsx)(Ea,{spaceStore:e.spaceStore,onNavigateToCreditUtilization:()=>i("credit_utilization")})}),b=(0,P.jsx)("div",{style:f.tabContent,children:(0,P.jsx)(gn,{spaceStore:e.spaceStore})}),x=(0,P.jsx)("div",{style:f.tabContent,children:(0,P.jsx)(ua,{spaceStore:e.spaceStore})}),I=Ge().IO.filter((e=>"credit_utilization"===e?r&&(c||o):"custom_agents"!==e||o&&m)),w=I.map((e=>{switch(e){case"general":return(0,P.jsx)(U().sA,{...Oa.aiSettingsGeneralTabLabel});case"ai_connectors":return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(La,{}),(0,P.jsx)(U().sA,{...Oa.aiSettingsAiConnectorsTabLabel})]});case"custom_agents":return(0,P.jsx)(U().sA,{...Oa.aiSettingsCustomAgentsTabLabel});case"meeting_notes":return(0,P.jsx)(U().sA,{...Oa.aiSettingsMeetingNotesTabLabel});case"credit_utilization":return(0,P.jsx)(U().sA,{...Oa.aiSettingsCreditUtilizationTabLabel});default:return null}})),C=new Map([["general",y],["ai_connectors",v],["custom_agents",S],["meeting_notes",b],["credit_utilization",x]]),A=I.indexOf(n),T=-1===A?0:A,j=I[T]??"general",M=C.get(j)??null;return(0,P.jsxs)("div",{style:f.container,children:[(0,P.jsxs)("div",{style:f.header,children:[(0,P.jsx)(k().D,{styleKey:"titleSmSemibold",colorVariant:"primary",children:(0,P.jsx)(U().sA,{...X().D.notionAI})}),(0,P.jsx)(sa().I,{tabs:w,selectedIndex:T,onChange:e=>i(I[e]??"general")})]}),M]})}function za(e){return(0,i().X)("notion_ai_settings_tab_v2")?(0,P.jsx)(Va,{...e}):(0,P.jsx)(ta,{...e})}},234637:(e,t,n)=>{n.d(t,{b:()=>V});var a=()=>n(711339),i=()=>n(483730),s=(n(16280),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(672577),n(581454),()=>n(726637)),o=()=>n(675133),r=()=>n(792057),l=()=>n(902006),c=()=>n(24279),d=()=>n(252050),u=()=>n(436468),p=()=>n(416504),g=()=>n(206267),m=()=>n(792071),h=()=>n(651784),f=()=>n(201980),y=()=>n(496603),v=()=>n(534177),S=()=>n(108184),b=()=>n(383070),x=()=>n(302607),I=()=>n(600881),k=()=>n(140022),w=()=>n(150984),C=()=>n(830010),A=()=>n(918678),T=()=>n(839710),j=()=>n(108181),M=()=>n(259091),_=()=>n(615304);var P=()=>n(383706),D=()=>n(763578),E=()=>n(948411),R=()=>n(192962),B=()=>n(50744),F=()=>n(808725),N=()=>n(622595);async function L(e){const{environment:t,text:n,sessionId:a}=e,r=(0,P()._)(t);if(!r)throw new Error("No valid user.");if(!r)throw new Error("No valid user.");const c=i().default.getSessionContextOrThrow(a),{evaluatorFromStoreState:g}=c,y=g.state,S=m().h0Y.fromGetRecordModelFn(m().b4_.fromGetRecordValueFn(t.defaultRecordCache.inMemoryRecordCache.makeGetRecordValueFn(r))),x=await(0,u().jk)({textValue:n,allowsText:!0,allowedTagNames:(0,v().uv)(d()._S),loadRecordModel:S,intl:o().A.getIntl(),currentTimeZone:(0,p().P)()}),I=(0,u().y5)({inlineNodes:x,idMapper:y.getIdMapper(),humanChatTag:(0,_().m)()}),k=function(e){const{humanInput:t}=e,n=new Set;for(const a of t){const e=(0,f().uPN)(a),t=(0,f().Sev)(e);if(t){const e=(0,f().i$F)(t);e&&n.add(e.id)}const i=(0,f().VtW)(e);if(i){const e=(0,f().cQR)(i);if(e){const t=(0,h().parseRoute)({url:e,isMobile:s().A.isMobile,baseUrl:s().A.domainBaseUrl,publicDomainName:s().A.publicDomainName,protocol:s().A.protocol,currentUrl:window.location.href});"page"!==t.name||t.requestedOnPublicDomain||n.add(t.blockId)}}}return Array.from(n)}({environment:t,humanInput:n}),w=function(e){const{humanInput:t}=e,n=new Set;for(const a of t){const e=(0,f().uPN)(a),t=(0,f().VtW)(e);if(t){const e=(0,f().cQR)(t);if(e){const t=(0,l().Tq)(e);(b().zD.canLoadWebPageURLs()||"web"!==t)&&n.add(e)}}}return Array.from(n)}({environment:t,humanInput:n});return{humanStepValue:I,loadPageIds:k,loadUniversalIds:w}}async function O(e){const{environment:t,text:n,sessionId:a,source:s,retrying:o,assistantSurfaceType:l,updater:d,clientSkillWithParameterValues:u,selectedSkillCategoryOverride:p}=e,m=(0,M().x)(t),h=m.id;try{d.write((e=>{e.setIsCurrentlyCommittingHumanStep(!0),e.setShowGetSupportPill(!1),e.assistantConfigurationStore.updateState({retrying:o??!1})}));const{evaluatorFromStoreState:e,previewingStepFromStoreState:f,assistantConfigurationStoreState:v}=d.getReadOnlySessionContext(),b=g().JW(),x=Date.now(),w=i().default.getSessionContext(a);k().trackInferenceStart({environment:t,configurationState:v,inferenceId:b,source:s,mentionsUsed:(0,I().W8)(n),skillType:null==u?void 0:u.clientSkill.skillType,actionCardIdForLogging:null==w?void 0:w.actionCardIdForLoggingFromStoreState,from:l}),w&&await(0,C().rejectEdits)({environment:t,sessionContext:w,inferenceId:b,isAutomatedReject:!0,assistantSurfaceType:l}),f&&await(0,A().o)({environment:t,sessionId:a,updater:d,assistantSurfaceType:l});const M=g().JW();d.write((e=>{e.addClientStep({type:"human",text:n,inferenceId:M})})),d.addUpdaterToEvaluatorStateCallbacks(),await e.refreshPageObservations(),await async function(e){var t,n;const{environment:a,sessionId:s,updater:o}=e,l=(0,j().N)();if(!l)return;const d=i().default.getSessionContextOrThrow(s),u=d.evaluatorFromStoreState.state;if(u.getValueFromContext("current-page-id")===(null===(t=l.primaryEditorStore)||void 0===t?void 0:t.id)&&u.getValueFromContext("current-background-page-id")===(null===(n=l.backgroundEditorStore)||void 0===n?void 0:n.id))return;const{currentUserInfo:p,currentSpaceInfo:m}=d.assistantConfigurationStoreState,h=(0,T().A)({currentUserInfo:p,currentSpaceName:m.name}),f=d.evaluatorFromStoreState.createContextStep(h),{observations:y}=await(0,F().T)({environment:a,step:f,commit:!0,isStreaming:!1,inferenceId:g().JW(),sessionId:s,updater:o}),v=y.find(c().XO);if(v)throw r().rG({message:v.value}),new Error("Error updating context for current page");await(0,D().q)({environment:a,currentPageInformation:l,xmlEvaluatorState:u,sessionId:s,updater:o})}({environment:t,sessionId:a,updater:d});const{humanStepValue:_,loadPageIds:P,loadUniversalIds:O}=await L({text:n,environment:t,sessionId:a}),V=e.createHumanStep(_);await(0,F().T)({environment:t,step:V,commit:!0,isStreaming:!1,inferenceId:M,sessionId:a,updater:d}),d.write((e=>{e.commitPreviewingStep(),e.commitAndClearStagedAssistantAttachmentSteps()}));const z=null==w?void 0:w.assistantConfigurationStoreState.searchScope,W="page"===(null==z?void 0:z.type)?[...P,z.pageId]:P;W.length>0&&await(0,E().Z)({environment:t,pageIds:W,xmlEvaluatorState:e.state,sessionId:a,updater:d}),O.length>0&&await async function(e){const{environment:t,ids:n,sessionId:a,xmlEvaluatorState:s,updater:o}=e,r=i().default.getSessionContextOrThrow(a),l=y().sb(y().R9(n,Array.from(r.evaluatorFromStoreState.state.getLoadedUniversalIds())));if(0===l.length)return;const c=l.map((e=>function(e){const{idMapper:t}=e;return`<load id="${t.mapKeyToCounter({type:"universal",key:e.mappedUniversalId})}"/>`}({mappedUniversalId:e,assistantSessionContext:r,idMapper:s.getIdMapper()}))).join("");await(0,R().M)({environment:t,sessionId:a,commands:c,updater:o})}({environment:t,ids:O,xmlEvaluatorState:e.state,sessionId:a,updater:d});const U=d.getReadOnlySessionContext();await(0,B().f)({environment:t,inferenceId:b,sessionId:a,source:s,updater:d,assistantSurfaceType:l}),(0,N().X)({environment:t,assistantSessionContext:U,inferenceId:b,timeTook:Date.now()-x,parentStore:m,transcript:e.getTranscript(),from:l,forcefullyStoppedByUser:!d.isValid(),skillType:null==u?void 0:u.clientSkill.skillType,wasSkillSuggested:null==u?void 0:u.clientSkill.isSuggested,selectedSkillCategoryOverride:p}),S().maybeUpdateAiEligibility(t,h)}finally{d.write((e=>{e.setIsCurrentlyCommittingHumanStep(!1),e.clearTemporaryUserInputData()})),x().O.setState({...x().O.state,lastStepLoadingCompletionUnixEpochMs:Date.now()}),d.isValid()&&(0,w().fireAndForgetUpsertStepToChatSessionHistory)({sessionId:a,environment:t,assistantSurfaceType:l})}}async function V(e){const{sessionId:t}=e,n=i().default.getSessionContextOrThrow(t);a().default.DO_NOT_USE_markLegacy("assistant.time_to_effect"),await n.withCurrentHumanStepSubmission((async t=>{await O({...e,updater:t})}))}},240959:(e,t,n)=>{n.d(t,{P:()=>g,a:()=>m});n(581454);var a=n(296540),i=()=>n(401497),s=()=>n(807449),o=()=>n(98126),r=()=>n(631524),l=()=>n(803960),c=()=>n(69708),d=()=>n(100622),u=()=>n(827368),p=n(474848);function g(e){const{steps:t,renderStep:n,done:g,style:m,hideLoadingSpinner:h,headerText:f}=e,[y,v]=(0,a.useState)(!1),S=(0,a.useRef)(null),{bodyStyleKey:b}=(0,u().yq)(),x=(0,u().Cd)(b);(0,a.useEffect)((()=>{!y&&t.length>0&&S.current&&(S.current.scrollTop=S.current.scrollHeight)}),[t,y]);const I=!g&&t.length>0,k=(0,i().IS)((()=>({container:{display:"flex",flexDirection:"column",...m,maxWidth:600,backgroundColor:d().Tj.selectLightGray[30],borderRadius:8,boxShadow:`0px 0px 0px 1px ${d().Tj.border.secondary}, 0 1px 3px rgba(0, 0, 0, 0.06)`,padding:4},header:{display:"flex",alignItems:"center",gap:8,color:d().Tj.text.tertiary,...x,cursor:"pointer",padding:"16px 8px",borderRadius:y||I?"7px 7px 0 0":"7px"},headerText:{flexGrow:1,fontWeight:500},steps:{display:"flex",flexDirection:"column",color:d().Tj.text.tertiary,...x,listStyle:"none",padding:"4px 8px",margin:0,maxHeight:400,overflowY:"auto"},step:{display:"flex",gap:14,minHeight:28,flexShrink:0,flexGrow:0},icon:{transition:"transform 0.2s ease-in-out",transformOrigin:"center",transform:y?"rotate(0deg)":"rotate(calc(var(--direction, 1) * -90deg))"},stepContent:{flexGrow:1,alignSelf:"flex-start",color:d().Tj.text.secondary,width:"100%"},collapsedStepsContainer:{maxHeight:140,overflowY:"auto",position:"relative",padding:"0 0 12px"},collapsedSteps:{display:"flex",flexDirection:"column",color:d().Tj.text.tertiary,...x,listStyle:"none",padding:"0 16px",margin:0},collapsedStep:{display:"flex",color:d().Tj.text.secondary,minHeight:28,padding:"4px 0"}})),[y,I,m,x]),w=(0,a.useCallback)((()=>{v(!y)}),[y]);let C;return C=f||(g?(0,p.jsx)(c().sA,{defaultMessage:"Thought",id:"aiInference.thinkingStep.thought"}):(0,p.jsx)(c().sA,{defaultMessage:"Thinking",id:"aiInference.thinkingStep.thinking"})),(0,p.jsxs)("div",{style:k.container,children:[(0,p.jsxs)(r().p,{style:k.header,onClick:w,disabled:0===t.length,"aria-expanded":y,children:[g||h?void 0:(0,p.jsx)(o().A,{size:"sm"}),(0,p.jsx)("div",{style:k.headerText,children:C}),t.length>0?(0,p.jsx)(s().I,{icon:l().arrowChevronSingleDownIcon,size:"sm",colorVariant:"secondary",style:k.icon}):void 0]}),y?(0,p.jsx)("ul",{style:k.steps,children:t.map(((e,t)=>(0,p.jsx)("li",{style:k.step,children:(0,p.jsx)("div",{style:k.stepContent,children:n(e)})},t)))}):I&&(0,p.jsx)("div",{style:k.collapsedStepsContainer,ref:S,children:(0,p.jsx)("ul",{style:k.collapsedSteps,children:t.map(((e,t)=>(0,p.jsx)("li",{style:k.collapsedStep,children:n(e)},t)))})})]})}function m(e){const t=Math.floor(e/6e4),n=Math.floor(e%6e4/1e3);return t>0?n>0?`${t}m ${n}s`:`${t}m`:`${n}s`}},241863:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>i,priceTagIcon:()=>s});n(296540);var a=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"2.19 2.19 15.61 15.61",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M12.338 7.662a1.188 1.188 0 1 0 1.68-1.68 1.188 1.188 0 0 0-1.68 1.68"}),(0,a.jsx)("path",{d:"M14.906 2.796a2.05 2.05 0 0 0-1.74-.58l-2.682.383a2.05 2.05 0 0 0-1.16.58L2.797 9.708c-.8.8-.8 2.098 0 2.899l4.597 4.597c.8.8 2.099.8 2.9 0l6.528-6.528a2.05 2.05 0 0 0 .58-1.16l.383-2.682a2.05 2.05 0 0 0-.58-1.74zm-1.563.658a.8.8 0 0 1 .679.226l2.298 2.299a.8.8 0 0 1 .227.678l-.384 2.682a.8.8 0 0 1-.226.453L9.41 16.32a.8.8 0 0 1-1.132 0L3.68 11.723a.8.8 0 0 1 0-1.131l6.529-6.529a.8.8 0 0 1 .452-.226z"})]})},s=(0,n(340498).wt)("priceTag",i,"default")},244837:(e,t,n)=>{n.d(t,{E:()=>h});n(296540);var a=()=>n(484714),i=()=>n(590526),s=()=>n(401497),o=()=>n(631524),r=()=>n(992214),l=()=>n(69708),c=()=>n(100622),d=()=>n(857783),u=()=>n(187820),p=()=>n(16006),g=()=>n(681445),m=n(474848);function h(e){const{collectionStore:t,pageVisitSource:n,size:h}=e,f=(0,a().v3)(),y=(0,l().tz)(),v=(0,i().K8)((()=>{var e;return null==t||null===(e=t.getParentBlockStore())||void 0===e?void 0:e.getNavigableBlockStore()}),[t]),S=(0,i().K8)((()=>null==t?void 0:t.getIcon()),[t]),b=function(e){return(0,s().IS)((()=>({button:{display:"inline-flex",alignItems:"center",color:c().Tj.text.primary,paddingInlineStart:4,paddingInlineEnd:4,marginInlineEnd:2,height:24,flex:"1 1 auto",gap:4,fontSize:e}})),[e])}(h);return(0,m.jsxs)(o().p,{style:b.button,onClick:e=>{v&&(d().uK({environment:f,store:v,pageVisitSource:n}),g().Q.close(),e.stopPropagation(),e.preventDefault())},children:[(0,m.jsx)(u().B6,{disabled:!0,icon:S,iconRecordCategory:"collection",isEmptyPage:!1,size:h,useInvertedColors:!1}),t?(0,m.jsx)(p().A,{store:t}):(0,r().L)(y)]})}},246686:(e,t,n)=>{n.d(t,{s:()=>r});n(898992),n(672577),n(296540);var a=()=>n(590526),i=()=>n(791256),s=()=>n(788749),o=n(474848);function r(e){const{clientStore:t,threadStore:n}=e;return"researcher"===(0,a().K8)((()=>{var e;const{steps:a}=(0,i().A3)({clientStore:t,threadStore:n});return null===(e=a.find((e=>"config"===e.type)))||void 0===e||null===(e=e.value)||void 0===e?void 0:e.type}),[t,n])?(0,o.jsx)(s().Qc,{clientStore:t,threadStore:n}):null}},248053:(e,t,n)=>{n.d(t,{I:()=>u});var a=n(296540),i=()=>n(590526),s=()=>n(534177),o=()=>n(440024),r=()=>n(295304),l=()=>n(260850),c=()=>n(547149),d=()=>n(977270);function u(e,t){const n=(0,i().K8)((()=>d().assistantMenuStore.state.primeTextInput),[]);(0,a.useEffect)((()=>{requestAnimationFrame((()=>requestAnimationFrame((()=>{(0,s().O9)(null==n?void 0:n.textValue)&&n.textValue.length>0&&c().createAndCommit({userAction:"assistant.primeTextInput",environment:e,canUndo:!0,perform:a=>{r().R9({environment:e,store:t,value:n.textValue,transaction:a})}}),null!=n&&n.shouldFocusInput&&((0,o().I)({environment:e}),(0,l().z)({store:t}))})))),d().assistantMenuStore.setState({...d().assistantMenuStore.state,primeTextInput:void 0})}),[e,t,n])}},254312:(e,t,n)=>{n.d(t,{q:()=>s});var a=()=>n(590526),i=()=>n(183373);function s(e){const{state:t,steps:n,completedAt:s,dismissedAt:o}=(0,a().K8)((()=>{const t=(0,i().w6)(e);return{state:(0,i().af)(t),steps:(0,i().KS)(e),completedAt:null==t?void 0:t.completedAt,dismissedAt:null==t?void 0:t.dismissedAt}}),[e]);return{state:t,steps:n,completedAt:s,dismissedAt:o}}},255063:(e,t,n)=>{n.d(t,{BI:()=>p,Dd:()=>f,an:()=>u,dC:()=>d,g3:()=>m,mG:()=>c,my:()=>h,nL:()=>g});n(813451),n(944114),n(898992),n(672577),n(803949),n(737550),n(814603),n(147566),n(198721);var a=()=>n(902006),i=()=>n(68169),s=()=>n(534177),o=()=>n(915189),r=()=>n(166442),l=()=>n(383070);function c(e){const{configurationState:t}=e;return t.researchModeRequested&&l().zD.isResearchModeUnifiedFindEnabled()}function d(e){var t;return"researcher"===(null===(t=e.find((e=>"config"===e.type)))||void 0===t?void 0:t.value.type)}function u(e){const{transcript:t,threadId:n,preserveNonResearcherSteps:a=!1}=e;let s=t;const o=e=>"researcher-agent"===e.type&&e.value.agent!==i().RD||"researcher-report"===e.type||"researcher-agent-group"===e.type||"researcher-next-steps"===e.type,l=t.findIndex(o);if(t.some((e=>"premium-feature-unavailable"===e.type))&&-1===l)return[...t];if(-1===l){const e={id:"empty-researcher-agent-group",type:"researcher-agent-group",value:{thinkingRounds:[],status:0===t.length?"loading":"in-progress",writing:"not-started"}};return a?[...t,e]:[e]}const c=a?t.slice(0,l):[];s=t.slice(l);const d=[];let u=null,p=[],g=[];s.forEach((e=>{"researcher-next-steps"===e.type?(u&&(g.push({thinkingStep:u,agentSteps:[...p]}),p=[]),u=e):"researcher-agent"===e.type?p.push(e):"user"===e.type||"researcher-report"===e.type||"markdown-chat"===e.type?(u&&g.push({thinkingStep:u,agentSteps:[...p]}),g.length>0&&d.push({id:`grouped-researcher-agent-${g[0].thinkingStep.id}`,type:"researcher-agent-group",value:{thinkingRounds:g,status:"done",writing:"not-started"}}),u=null,p=[],g=[],d.push(e)):"error"===e.type||d.push(e)})),u&&g.push({thinkingStep:u,agentSteps:[...p]}),g.length>0&&d.push({id:`grouped-researcher-agent-${g[0].thinkingStep.id}`,type:"researcher-agent-group",value:{thinkingRounds:g,status:"in-progress",writing:"not-started"}});const m=n&&r().defaultClientAIChatStore.getOrCreateClientAIChatThreadStore(n).state.loading;let h=!1,f=!1;for(let i=d.length-1;i>=0;i--){const e=d[i];if("researcher-agent-group"===e.type){const t=f&&!m||h?"done":!h&&f&&m?"in-progress":"not-started";e.value.writing=t,"in-progress"===t&&(e.value.status="in-progress")}else"researcher-report"===e.type?f=!0:h=!0}for(let i=d.length-1;i>=0;i--){const e=d[i];"researcher-report"===e.type&&(i<d.length-1||!m)&&(d[i]={...e,finished:!0})}if(0===d.length||!o(d[d.length-1])){const e={id:"empty-researcher-agent-group",type:"researcher-agent-group",value:{thinkingRounds:[],status:0===t.length?"loading":"in-progress",writing:"not-started"}};d.push(e)}let y=!1;for(let i=0;i<d.length;i++){const e=d[i];"researcher-agent-group"===e.type&&(y?d[i]={...e,value:{...e.value,isFollowUpResearcherAgentStep:!0}}:y=!0)}return[...c,...d.filter((e=>"researcher-agent-group"!==e.type||!(e.value.isFollowUpResearcherAgentStep&&"done"===e.value.status&&e.value.thinkingRounds.length>0&&0===e.value.thinkingRounds[0].agentSteps.length)))]}function p(e){const{transcript:t,threadId:n}=e,a=[...t],i=n&&r().defaultClientAIChatStore.getOrCreateClientAIChatThreadStore(n).state.loading;for(let s=a.length-1;s>=0;s--){const e=a[s];"researcher-report"===e.type&&(s<a.length-1||!i)&&(a[s]={...e,finished:!0})}return a}function g(e){const{transcript:t,runningInference:n}=e,a=e=>"researcher-agent"===e.type&&e.value.agent!==i().RD||"researcher-report"===e.type||"researcher-agent-group"===e.type||"researcher-next-steps"===e.type,s=t.findIndex(a);if(t.some((e=>"premium-feature-unavailable"===e.type))&&-1===s)return[...t];const o=t.slice(0,-1===s?t.length:s),r=-1===s?[]:t.slice(s),l=[];let c=null,d=[],u=[];const p=()=>{c&&(u.push({thinkingStep:c,agentSteps:[...d]}),d=[])},g=e=>{u.length>0&&(l.push({id:`grouped-researcher-agent-${u[0].thinkingStep.id}`,type:"researcher-agent-group",value:{thinkingRounds:[...u],status:e}}),u=[])};r.forEach((e=>{switch(e.type){case"researcher-next-steps":p(),c=e;break;case"researcher-agent":d.push(e);break;case"user":case"researcher-report":case"markdown-chat":case"error":p(),g("done"),c=null,l.push(e);break;default:l.push(e)}})),p(),u.length>0&&g("in-progress");let m=!1,h=!1;for(let i=l.length-1;i>=0;i--){const e=l[i];"researcher-agent-group"===e.type?e.value.status=h||m?"done":"in-progress":"researcher-report"===e.type?((i<l.length-1||!n)&&(e.finished=!0),h=!0):m=!0}if(0===l.length||!a(l[l.length-1])){const e=t.findLastIndex((e=>"user"===e.type));(e>=0?t.slice(e).some((e=>"error"===e.type)):t.some((e=>"error"===e.type)))||l.push({id:"empty-researcher-agent-group",type:"researcher-agent-group",value:{thinkingRounds:[],status:0===t.length?"loading":"in-progress",writing:"not-started"}})}let f=!1;for(let i=0;i<l.length;i++){const e=l[i];"researcher-agent-group"===e.type&&(f?l[i]={...e,value:{...e.value,isFollowUpResearcherAgentStep:!0}}:f=!0)}return[...o,...l.filter((e=>"researcher-agent-group"!==e.type||!(e=>"researcher-agent-group"===e.type&&e.value.isFollowUpResearcherAgentStep&&"done"===e.value.status&&e.value.thinkingRounds.length>0&&0===e.value.thinkingRounds[0].agentSteps.length)(e)))]}function m(e){const{artifact:t,spaceStore:n}=e,a=null==t?void 0:t.citationInfo;if(!a)return;const i=a.citationType;if("notion"===i||"universal_search"===i){var s;const e=null===(s=a.searchResultWithExtraInfo)||void 0===s?void 0:s.searchResult;if(!e)return;if("title"in e&&!e.title)return;return(0,o().SF)(e,n)}}function h(e){const t={id:e.url||"",lastEdited:"",title:e.title||e.url||"",text:e.text||""};switch(e.target){case"slack":return{...t,href:(0,a().V9)(e.href),domain:e.domain||"",baseUrl:e.baseUrl||"",channelId:e.channelId||"",messageId:e.messageId||"",threadTs:e.threadTs||"",type:"slack"};case"webpage":return{...t,href:(0,a().RW)(e.href),url:e.url||"",domain:e.domain||"",type:"webpage"};case"microsoft-teams":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"microsoft-teams",channelId:e.channelId||"",messageId:e.messageId||"",threadTs:e.threadTs||"",messageType:e.messageType||"channel"};case"helpdoc":return{...t,href:(0,a().h5)(e.href),url:e.url||"",type:"helpdocs"};case"githubCode":case"github":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"github"};case"google-drive":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"google-drive"};case"jira":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"jira"};case"sharepoint":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"sharepoint"};case"gmail":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"gmail",emailAddress:""};case"linear":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"linear"};case"outlook":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"outlook",emailAddress:""};case"notion-mail":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"notion-mail",emailAddress:""};case"google-calendar":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"google-calendar",emailAddress:""};case"notion-calendar":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"notion-calendar",emailAddress:""};case"salesforce":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"salesforce"};case"discord":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"discord",channelId:e.channelId||"",messageId:e.messageId||"",guildId:e.guildId||"",threadHref:e.href||""};case"box":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"box"};case"asana":return{...t,href:(0,a().V9)(e.href),url:e.url||"",type:"asana"};case"custom":return{...t,href:(0,a().RW)(e.href),url:e.url||"",domain:e.url?new URL(e.url).hostname:"",type:"webpage"};default:(0,s().HB)(e.target)}}function f(e,t){return e.find((e=>e.href===t||(e.messages?e.messages.find((e=>e.messageId===t)):void 0)))}},259091:(e,t,n)=>{n.d(t,{x:()=>i});n(16280);var a=()=>n(996477);function i(e){const t=(0,a().fM)(e);if(!t)throw new Error("No current space");return t}},264503:(e,t,n)=>{n.d(t,{z:()=>p});n(296540);var a=()=>n(590526),i=()=>n(401497),s=()=>n(69708),o=()=>n(100622),r=()=>n(908201),l=()=>n(132389),c=()=>n(391930),d=n(474848);function u(e){return"line"===e?"line-chart-loading":"donut"===e?"donut-chart-loading":"column-chart-loading"}function p({chartType:e,showCopy:t}){const n=function(){const e=(0,r().Ks)(),t=(0,a().K8)((()=>Boolean(null==e?void 0:e.isDashboardWidget())),[e]),n=(0,i().eP)();return(0,i().IS)((()=>({text:{color:o().Tj.text.tertiary,fontSize:14},container:{color:"dark"===n?o().Tj.palette.gray[500]:o().Tj.palette.gray[200],display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%",...(0,c()._)(t)}})),[t,n])}();return(0,d.jsxs)("div",{className:u(e),style:n.container,children:[(0,d.jsx)(g,{chartType:e}),t?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(l().A,{size:8}),(0,d.jsx)("div",{style:n.text,children:(0,d.jsx)(s().sA,{defaultMessage:"Preparing your chart",id:"charts.initialLoading"})})]}):void 0]})}function g({chartType:e}){return"line"===e?(0,d.jsx)(h,{}):"column"===e||"bar"===e?(0,d.jsx)(m,{}):"donut"===e?(0,d.jsx)(f,{}):(0,d.jsx)(m,{})}function m(){return(0,d.jsxs)("svg",{width:"72",height:"72",viewBox:"0 0 72 72",fill:"none",children:[(0,d.jsx)("line",{className:"column-loader-1",x1:"11",y1:"35",x2:"11",y2:"53",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round"}),(0,d.jsx)("line",{className:"column-loader-2",x1:"24",y1:"19",x2:"24",y2:"53",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round"}),(0,d.jsx)("line",{className:"column-loader-3",x1:"63",y1:"25",x2:"63",y2:"53",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round"}),(0,d.jsx)("line",{className:"column-loader-4",x1:"37",y1:"29",x2:"37",y2:"53",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round"}),(0,d.jsx)("line",{className:"column-loader-5",x1:"50",y1:"35",x2:"50",y2:"53",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round"})]})}function h(){return(0,d.jsx)("svg",{width:"72",height:"72",viewBox:"0 0 72 72",fill:"none",children:(0,d.jsx)("path",{d:"M4 54L10.7601 43.0148C11.4087 41.9609 12.8491 41.743 13.7804 42.5579L18.1597 46.3898C19.1109 47.2221 20.5861 46.9743 21.2132 45.8769L25.9913 37.5152C26.8134 36.0765 28.9281 36.2042 29.5711 37.7313L34.0639 48.4018C34.7639 50.0644 37.1339 50.0234 37.7761 48.3376L43.794 32.5408C43.9286 32.1875 44.1605 31.8796 44.463 31.6528L50.6123 27.0408C51.4086 26.4436 52.5228 26.5228 53.2265 27.2265L58.0379 32.0379C59.0032 33.0032 60.6305 32.7391 61.241 31.5181L68 18",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})})}function f(){return(0,d.jsxs)("svg",{width:"72",height:"72",viewBox:"0 0 72 72",fill:"none",children:[(0,d.jsx)("circle",{className:"outer-loader",cx:"36",cy:"36",r:"24",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"}),(0,d.jsx)("circle",{className:"inner-loader",cx:"36",cy:"36",r:"12",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})]})}},270812:(e,t,n)=>{n.d(t,{E:()=>y});var a=n(296540),i=()=>n(564884),s=()=>n(664594),o=()=>n(920198),r=()=>n(484714),l=()=>n(741615),c=()=>n(232802),d=()=>n(795523),u=()=>n(706021),p=()=>n(806080),g=()=>n(568688),m=()=>n(201145),h=()=>n(398304),f=()=>n(612320);function y(e){const{type:t,analyticsEntrypoint:n,entrypoint:y,isOptimisticUpsell:v}=e,S=(0,r().v3)(),b=(0,o().L)(),x=null==b?void 0:b.id,I=(0,s().T)(),k=(0,l().lh)({spaceId:x}),w=(0,m().y)(k);let C,A;if("product"!==t||(0,d().eh)(k,e.product)){if("feature"===t&&(v||!(0,u().e2)(e.featureAvailability))){var T;const t=null===(T=e.featureAvailability)||void 0===T?void 0:T.upsell;"product"===(null==t?void 0:t.type)&&(C=t.product)}}else C=e.product;C&&(0,c().rU)(C)&&(A=C);const{requests:j}=(0,g().I)({spaceId:x}),[M,_]=(0,f().k)({feature:A,requests:j,userId:I}),P=w&&"unrequested"===M,D=(0,a.useCallback)((()=>{if(!A||!P)return p().lQ;(0,i().u)({environment:S,event:{eventName:"upgrade_request_button_clicked",eventProperties:{feature:A,entrypoint:n}}}),h().Q.update((e=>({open:!0,feature:A,userId:I,setRequestState:_,entrypoint:y})))}),[P,S,A,n,I,_,y]);return A?{openModal:D,requestState:M,canUserRequestUpgrade:P,isUserEligibleToRequestUpgrade:w,userHasPendingRequest:"pending"===M}:{openModal:D,requestState:"unrequested",canUserRequestUpgrade:!1,isUserEligibleToRequestUpgrade:!1,userHasPendingRequest:!1}}},275143:(e,t,n)=>{n.d(t,{y:()=>i});n(898992),n(737550);var a=()=>n(602098);function i(e){return e.blocks.some(a().u)}},282027:(e,t,n)=>{n.d(t,{v:()=>a});n(296540),n(474848);const a=(0,n(69708).YK)({thinking:{id:"assistantThinkingMessages.thinking",defaultMessage:"Thinking"}})},282148:(e,t,n)=>{n.d(t,{N5:()=>d,YA:()=>u,eQ:()=>p});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(803949),n(581454),n(737550);var a=()=>n(726637),i=()=>n(221844),s=()=>n(201980),o=()=>n(759082),r=()=>n(108184),l=()=>n(295304),c=()=>n(547149);function d(e){const{linkAnnotationToCitationAnnotations:t,useExportedCitations:n,getRecordModelFn:i}=e;let r=1;const l={},c={};return e=>{if(!s().BEe(e))return{val:[e],modified:!1};const d=e[1],u=s().VtW(d);if(!u)return{val:[e],modified:!1};const p=t(u),{annotations:g,status:m}=p;if("other_link"===m)return{val:[s().Ey_(e[0],[...g,...d.filter((e=>!s().sh$(e)))])],modified:!0};if("missing_citation"===m)return{val:[],modified:!0};const h=g.map((e=>{if(s().bZo(e)){if(n){const t=s().NpB(e).href;let n;c[t]?n=c[t]:(n=""+r++,l[n]=t,c[t]=n);const d=(0,o()._)({citationAnnotation:e,baseUrl:a().A.domainBaseUrl,getRecordModel:i});if(!d)return;return s().Ey_(`[${n}]`,[s().Sez(d)])}return s().wmz(e)}})).filter((e=>void 0!==e));return{val:h,modified:!0}}}function u(e){const{store:t,environment:n,transaction:a,modifyTokens:i}=e,o=t.getTitleStore(),r=null==o?void 0:o.getValue();if(o&&void 0!==r){const e=s().RQ(r).map(i),t=e.map((e=>e.val)).flat(),c=e.map((e=>e.modified)).some(Boolean),d=g(t);c&&l().R9({environment:n,store:o,value:d,transaction:a})}const c=t.getPropertiesStore(),d=null==c?void 0:c.getValue();d&&Object.entries(d).forEach((([e,o])=>{if("title"===e)return;const r=s().RQ(o).map(i),c=r.map((e=>e.val)).flat(),d=r.map((e=>e.modified)).some(Boolean),u=g(c);if(d){const i=t.getPropertyStore(e);if(!i)return;l().R9({environment:n,store:i,value:u,transaction:a})}}));const p=t.getContentStores();p&&p.forEach((e=>u({store:e,environment:n,transaction:a,modifyTokens:i})))}function p(e){const{markdown:t,environment:n,linkAnnotationToCitationAnnotations:a,useExportedCitations:s,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:l,clipboardActions:p}=e,g=new(i().A)({name:"AIChatTranscript.MarkdownChatStep",isTemporaryData:!0,isSyntheticAssistantData:!0}),m=g.makeGetRecordModelFn(n.currentUser.id),h=c().createAndCommit({userAction:"AIChatTranscript.MarkdownChatStep.markdownToBlocks",environment:n,canUndo:!1,perform:e=>{const i=p.markdownToBlocks({environment:n,text:t,inMemoryRecordCache:g,transaction:e,markdownOptions:{},markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:l,ignoreImages:!0});if(!i)return;const c=d({linkAnnotationToCitationAnnotations:a,useExportedCitations:s,getRecordModelFn:m});for(const t of i)u({store:t,environment:n,transaction:e,modifyTokens:c});return(0,r().wrapTemporaryBlocksInList)({environment:n,stores:i,inMemoryRecordCache:g,transaction:e})}}).performResult;return g.addCacheFallback(n.defaultRecordCache.inMemoryRecordCache),h}function g(e){if(!e.length)return e;const t=[];let n=[],a=!1;const i=e=>{const t=s().uPN(e),n=s().g2K(t),a=s().VtW(t);if(n){const e=s().NpB(n);return"slack"===e.type||"microsoft-teams"===e.type?e.threadTs??e.threadHref:e.href}if(a)return s().cQR(a)},o=()=>{if(n.length){const e=new Set,a=n.filter((t=>{const n=i(t);return!n||!e.has(n)&&(e.add(n),!0)}));t.push(...a),n=[]}};for(const r of e){i(r)?(a=!0,n.push(r)):a?s()._g9(r)?n.push(r):(o(),a=!1,t.push(r)):t.push(r)}return o(),t}},295173:(e,t,n)=>{n.r(t),n.d(t,{openAgentSidebarFromAttachmentBlockSelection:()=>T,openNewAgentSidebarFromMainBlock:()=>j});n(16280);var a=()=>n(564884),i=()=>n(907258),s=()=>n(675133),o=()=>n(128933),r=()=>n(443541),l=()=>n(68169),c=()=>n(17217),d=()=>n(155792),u=()=>n(706021),p=()=>n(560459),g=()=>n(449412),m=()=>n(140283),h=()=>n(498212),f=()=>n(973647),y=()=>n(769864),v=()=>n(989826),S=()=>n(140992),b=()=>n(388066),x=()=>n(166442),I=()=>n(703748),k=()=>n(429145),w=()=>n(594794),C=()=>n(390366),A=()=>n(547149);async function T(e){const{selectedAttachmentStore:t,environment:n,inferenceContext:i}=e;if(!i.blockStore)return;const T=(0,b().Jh)(t);if(!T)return;const j=(0,h().Ay)(),{performResult:M,serverCommitResult:_}=A().createAndCommit({userAction:"AIChatInput.useUploadAttachments",environment:n,canUndo:!1,perform:e=>(0,S().aP)({environment:n,spaceStore:i.spaceStore,userStore:i.userStore,transaction:e,threadType:"workflow"})});if(await _,!M)return void o().D6({label:s().A.formatMessage(k().c7.uploadError)});(0,I().openChatPanel)({environment:n,store:i.blockStore,chatPanelState:{isOpen:!0,threadId:M.id}});const P=x().defaultClientAIChatStore.getOrCreateClientAIChatThreadStore(M.id),D=P.getTemporaryAttachmentStagedDataOrInstantiate().stagedAttachmentUploadStore,E=e=>{D.onFileUploadPercentageChanged({fileId:j,percentage:e,fileName:(null==T?void 0:T.fileName)??"",contentType:(null==T?void 0:T.contentType)??"application/pdf"})};E(0);const R=await async function(e){const{environment:t,spaceId:n,fileData:a,sessionPointer:i,onProgress:o}=e,l=(0,c().F0)(a.source);if(l.error)return f().Q.fail({message:s().A.formatMessage(k().c7.invalidFileType),type:"upload",error:l.error,errorCode:"UNSUPPORTED_CONTENT_TYPE"});const d=(0,b().hr)(a);if(!d)return f().Q.fail({message:s().A.formatMessage(k().c7.missingFileSize),type:"upload",error:new Error("Failed to get file size"),errorCode:"FILE_SIZE_IS_0"});const g=await(0,C().B)(t,{spaceId:n,userId:t.currentUser.id,amount:d,name:(0,c().CE)(a.contentType)});if(!(0,u().e2)(g))return f().Q.fail({message:s().A.formatMessage(k().c7.assistantFileTooLarge,{fileSize:"unlimited"!==g.limit.amount?g.limit.amount/m().B:p().VZ}),type:"size",error:new Error("File too large"),errorCode:"FILE_SIZE_EXCEEDS_MAX_SIZE"});const h=new AbortController,S=await y().callApi({eventName:"copyBlockFileToAssistantChatTranscriptSessionUpload",environment:t,data:{assistantChatTranscriptSessionPointer:i,blockPointer:{...a.originalBlockStore.pointer,spaceId:n}},headers:{},abortSignal:h.signal});if("failed"===S.type)return f().Q.fail({message:s().A.formatMessage(k().c7.failedToRetrieveFile),type:"upload",error:S.error});if(!S.data.url)return f().Q.fail({message:s().A.formatMessage(k().c7.uploadError),type:"upload",error:new Error("Failed to get signed GET URL"),errorCode:"SIGNED_URL_GENERATION_FAILED"});const x=await(0,v().v)({originalFileUrl:S.data.url,fileId:S.data.url,threadPointer:i,fileName:a.fileName,contentType:a.contentType,environment:t,progressCallback:e=>{o(e.progress)}}),I=function(e){if(f().Q.isFail(e))return e;const t=(0,r().mM)({attachment:e.value,failOnRiskyAttachments:!1});if(f().Q.isFail(t))return f().Q.fail(t.error);return e}(x);if(f().Q.isFail(I)){const e=(0,b().zR)(I.error.code,I.error.message,I.error.error),t="FILE_SIZE_EXCEEDS_MAX_SIZE"===e.code?"size":"upload";return f().Q.fail({message:e.message,type:t,error:e.error,errorCode:e.code})}return o(100),f().Q.success(I.value)}({environment:n,fileData:T,spaceId:t.getSpaceId(),sessionPointer:M.pointer,onProgress:E,attachmentSource:"page_block"});if(f().Q.isFail(R)){const e=R.error;o().D6({label:e.message});const t={...e,files:[{fileId:j,fileName:(null==T?void 0:T.fileName)??""}]};return D.onFileUploadFailed({error:t}),g().Fg(e.error,{extra:{error:e},tags:{event:"assistant_attachment_upload_error"}}),void(0,a().u)({environment:n,event:{eventName:"assistant_attachment_upload_failed",eventProperties:{message:e.message,code:e.errorCode,offline:"OFFLINE"===e.errorCode,framework:"inference_transcript",config_type:"workflow",source:"workflows",upload_method:"page_block"}}})}const B=(0,w().Z1)({environment:n,table:d().mS,spaceId:i.spaceStore.id}),F=(0,l().jx)({uploadedFileData:R.value,id:B});P.stageAttachmentInferenceTranscriptStep({step:F}),D.onFileUploadCompleted(j,R.value),(0,a().u)({environment:n,event:{eventName:"assistant_attachment_upload_successful",eventProperties:{content_type:R.value.contentType,source:"notion",framework:"inference_transcript",config_type:"workflow"}}})}function j(e){const{environment:t,primeTextInput:n}=e,a=i().default.state.mainEditorCurrentBlockStore;a&&(x().defaultClientAIChatStore.setState({...x().defaultClientAIChatStore.state,primeInput:n?{text:n,surfaceOverride:void 0,chatTypes:["agent","agent_popup","agent_mobile"]}:void 0}),(0,I().openChatPanel)({environment:t,store:a,chatPanelState:{isOpen:!0,isNewThread:!0}}))}},297474:(e,t,n)=>{n.d(t,{$:()=>r});var a=n(296540),i=()=>n(484714),s=()=>n(165358),o=()=>n(239575);function r(e,t){const n=(0,i().v3)(),[r,l]=(0,a.useState)(void 0),[c,d]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{!async function(){d(!0);try{if(!e||void 0===t)return void d(!1);const a=await(0,o().QR)({environment:n,request:{spaceId:e,servicePeriodStartMs:t}});a&&l(a)}catch(a){s().log({level:"error",from:"useAIUsageEligibility",type:"fetchUsageEligibilityFailed",data:{miscDataToConvertToString:{error:a,spaceId:e,servicePeriodStartMs:t,userId:n.currentUser.id}}})}finally{d(!1)}}()}),[n,e,t]),{usage:null==r?void 0:r.usage,limits:null==r?void 0:r.limits,isLoading:c}}},297780:(e,t,n)=>{n.d(t,{A:()=>c});var a=n.n(n(32485)),i=(n(296540),()=>n(726637)),s=()=>n(383036),o=()=>n(31511),r=()=>n(100622),l=n(474848);const c=function({readOnly:e,onClick:t,style:n,tokens:s,value:o,onRemoveLastToken:r,onChange:c,onSubmit:p,onBlur:m,overflowHorizontally:h,focus:f,type:y,placeholder:v,errorOutline:S,inputStyle:b,inputElementAttributes:x}){return(0,l.jsxs)("div",{className:e?void 0:a()({"notion-focusable-within":!0,"notion-focusable-within-error-outline":S}),onClick:t,style:i().A.isMobile?u(n):d(n),children:[h?(0,l.jsx)("div",{style:{display:"flex",flexShrink:0},children:s}):s,(0,l.jsx)(g,{tokens:s,value:o,onRemoveLastToken:r,onChange:c,onSubmit:p,onBlur:m,focus:f,readOnly:e,type:y,placeholder:v,inputStyle:b,inputElementAttributes:x})]})};function d(e){return{display:"flex",flexWrap:"wrap",alignItems:"flex-start",minHeight:32,boxShadow:r().Tj.inputBoxShadow,background:r().Tj.inputBackground,borderRadius:4,fontSize:14,cursor:"text",overflow:"hidden",padding:"7px 9px 0px",...e}}function u(e){return{...d(e),fontSize:14,padding:"7px 10px 0"}}const p={flexGrow:1,flexShrink:1,flexBasis:60,minWidth:60,width:"auto",lineHeight:"20px"};function g({tokens:e,value:t,onRemoveLastToken:n,onChange:a,onSubmit:r,onBlur:c,focus:d,readOnly:u,type:g,placeholder:m,inputStyle:h,inputElementAttributes:f}){const y=0===e.length;return(0,l.jsx)(o().A,{format:"transparent",...(0,s().A)({onKeyDown:e=>function(e,t,n){"Backspace"===e.key&&0===t.length&&n()}(e,t,n)},{onChange:a}),value:t,onSubmit:r,onBlur:c,focus:d,style:{...p,margin:i().A.isMobile?"0 8px 8px 0":"0 6px 6px 0"},readOnly:u,inputStyle:{height:18,...h},size:1,type:g,placeholder:y?m:"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,inputElementAttributes:f})}},302995:(e,t,n)=>{n.r(t),n.d(t,{creditCardIcon:()=>s,iconDefinition:()=>i});n(296540);var a=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.12 15.25 11.75",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M5.5 11.031a.5.5 0 0 0-.5.5v1.219a.5.5 0 0 0 .5.5h2.011a.5.5 0 0 0 .5-.5v-1.219a.5.5 0 0 0-.5-.5z"}),(0,a.jsx)("path",{d:"M2.375 6.25c0-1.174.951-2.125 2.125-2.125h11c1.174 0 2.125.951 2.125 2.125v7.5a2.125 2.125 0 0 1-2.125 2.125h-11a2.125 2.125 0 0 1-2.125-2.125zM4.5 5.375a.875.875 0 0 0-.875.875v.825h12.75V6.25a.875.875 0 0 0-.875-.875zm-.875 8.375c0 .483.392.875.875.875h11a.875.875 0 0 0 .875-.875V8.175H3.625z"})]})},s=(0,n(340498).wt)("creditCard",i,"default")},303470:(e,t,n)=>{n.d(t,{w:()=>T});var a=n(296540),i=()=>n(401497),s=()=>n(699143),o=()=>n(631524),r=()=>n(493552),l=()=>n(69708),c=()=>n(100622),d=()=>n(981305),u=(n(581454),()=>n(907258)),p=()=>n(484714),g=()=>n(590526),m=()=>n(574359),h=()=>n(807449),f=()=>n(132855),y=()=>n(187820),v=()=>n(738471),S=n(474848);function b({position:e,iconSource:t}){const n=(0,l().tz)(),a=(0,i().IS)((()=>({iconContainer:{display:"flex",justifyContent:"center",alignItems:"center",width:38,height:38,padding:8,borderRadius:"100%",background:c().Tj.background.elevated,boxShadow:c().Tj.shadowXS,position:"absolute",...e},..."src"in t?{image:{borderRadius:t.isSquare?0:"100%",display:"flex",justifyContent:"center",alignItems:"center",flexShrink:0,width:t.width??22,height:t.height??22},placeholder:{display:"flex",justifyContent:"center",alignItems:"center"}}:{}})),[e,t]);return(0,S.jsx)("div",{style:a.iconContainer,children:"icon"in t?(0,S.jsx)(h().I,{icon:t.icon,size:"lg",colorVariant:"tertiary"}):(0,S.jsx)(v().A,{src:t.src,alt:t.alt??n.formatMessage({id:"upgrade.feature_icon",defaultMessage:"Feature icon"}),style:a.image,placeholderLoadedStyle:a.placeholder})})}function x({size:e}){const t=(0,i().IS)((()=>({ring:{stroke:c().Tj.border.primary}})),[]);return(0,S.jsx)("svg",{width:e,height:e,viewBox:`0 0 ${e} ${e}`,fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{position:"absolute",overflow:"visible"},children:(0,S.jsx)("rect",{width:e,height:e,rx:e/2,stroke:t.ring.stroke,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"0.1 9"})})}const I=304,k=185,w={fourIcons:{outer:[{top:148.5,insetInlineStart:-19},{top:118,insetInlineEnd:-19}],inner:[{top:34,insetInlineStart:-9},{top:112,insetInlineEnd:-8}]},sixIcons:{outer:[{top:148.5,insetInlineStart:-19},{top:118,insetInlineEnd:-19}],inner:[{top:34,insetInlineStart:-9},{top:146,insetInlineStart:24},{top:1,insetInlineEnd:15},{top:111,insetInlineEnd:-8}]}};function C({icons:e}){const t=(0,p().v3)(),{spaceIcon:n,spaceName:a}=(0,g().K8)((()=>{const{sidebarSpaceStore:e}=u().default.state;return e?{spaceIcon:e.getIcon(),spaceName:(0,m().G)(t,e)}:{}}),[t]),s=(0,i().IS)((()=>{const e={display:"flex",justifyContent:"center",alignItems:"center"};return{illustrationContainer:{...e,flex:"1 0 0",alignSelf:"stretch"},outerRing:{...e,flexShrink:0,position:"absolute",width:I,height:I},innerRing:{...e,flexShrink:0,position:"relative",width:k,height:k},spaceIconContainer:{...e,position:"relative"},upArrowIcon:{position:"absolute",bottom:-7,insetInlineEnd:-8,width:32,height:32,borderRadius:"100%",background:c().Tj.background.secondary,display:"flex",justifyContent:"center",alignItems:"center"},spaceIcon:{borderRadius:12,boxShadow:c().Tj.shadowXS,background:c().Tj.gray.background.tertiaryTranslucent}}}),[]),o=4===e.length?w.fourIcons:w.sixIcons;return(0,S.jsx)("div",{style:s.illustrationContainer,children:(0,S.jsxs)("div",{style:s.outerRing,children:[(0,S.jsx)(x,{size:I}),(0,S.jsx)(b,{position:o.outer[0],iconSource:e[0]}),(0,S.jsx)(b,{position:o.outer[1],iconSource:e[e.length-1]}),(0,S.jsxs)("div",{style:s.innerRing,children:[(0,S.jsx)(x,{size:k}),e.slice(1,-1).map(((e,t)=>(0,S.jsx)(b,{position:o.inner[t],iconSource:e},t))),(0,S.jsxs)("div",{style:s.spaceIconContainer,children:[(0,S.jsx)(y().B6,{disabled:!0,icon:n,iconRecordCategory:"workspace",isEmptyPage:!1,title:a,size:64,isLarge:!0,iconBoxStyles:s.spaceIcon}),(0,S.jsx)("div",{style:s.upArrowIcon,children:(0,S.jsx)(h().I,{icon:f().arrowInCircleUpFillIcon,colorPalette:"blue",colorVariant:"accentPrimary",size:"xl"})})]})]})]})})}var A=()=>n(704658);function T(e){const{title:t,description:n,onClickLearnMore:o,source:r,rightSideVisibleMinWidth:l=600,...u}=e,p=(0,i().IS)((()=>({container:{borderRadius:10,border:`1px solid ${c().Tj.border.secondary}`,background:`linear-gradient(90deg, ${c().Tj.background.primary} 0%, ${c().Tj.background.secondary} 100%)`,...e.icons||e.children&&e.hideOverflow?{position:"relative",overflow:"hidden"}:{}}})),[e.icons,e.children,e.hideOverflow]),g=(0,a.useRef)(null),[m,h]=(0,a.useState)(!0);(0,d().B)(g,(e=>{const{width:t}=e.getState();h(t>l)}));const f=e.children||(0,S.jsx)(C,{icons:e.icons});return(0,S.jsxs)(s().Y1,{direction:"horizontal",align:"center",padding:24,gap:12,width:"fill",style:p.container,ref:g,children:[(0,S.jsx)(j,{title:t,description:n,onClickLearnMore:o,source:r,...u}),m?f:void 0]})}function j({title:e,description:t,onClickLearnMore:n,source:a,...i}){return(0,S.jsxs)(s().Y1,{direction:"vertical",align:"center-left",gap:20,children:[(0,S.jsxs)(s().Y1,{direction:"vertical",align:"center-left",gap:4,children:[(0,S.jsx)(r().D,{styleKey:"bodyMedium",colorVariant:"primary",children:e}),(0,S.jsx)("span",{style:{textWrap:"pretty"},children:(0,S.jsx)(r().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:t})})]}),(0,S.jsxs)(s().Y1,{direction:"horizontal",width:"hug",gap:4,align:"center-left",children:[(0,S.jsx)(A().UpgradeButton,{display:"primary",source:a,...i}),n?(0,S.jsx)(o().p,{size:"lg",colorPalette:"blue",onClick:n,children:(0,S.jsx)(l().sA,{id:"upgrade.button.learnMore",defaultMessage:"Learn more"})}):null]})]})}},305425:(e,t,n)=>{n.d(t,{HS:()=>j,a9:()=>T,nM:()=>M});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(581454);var a=n(296540),i=()=>n(664594),s=()=>n(59226),o=()=>n(726637),r=()=>n(17022),l=()=>n(221844),c=()=>n(484714),d=()=>n(590526),u=()=>n(770063),p=()=>n(295633),g=()=>n(687249),m=()=>n(1295),h=()=>n(145480),f=()=>n(663760),y=()=>n(134025),v=()=>n(388821),S=()=>n(179034),b=()=>n(798880),x=()=>n(384944),I=()=>n(108184),k=()=>n(547149),w=()=>n(63606),C=()=>n(336847),A=()=>n(2151);function T(e){const{markdown:t,toolUseInfoMap:n,pageId:a,spaceId:i,idCreator:s,actorPointer:r,citationFormat:l,omitBlockTypes:c=h().W,simpleBulletsEnabled:d}=e,{blocks:u}=(0,f().VT)(t,(()=>!1),{omitBlockTypes:c,toolUseInfoMap:n});return(0,m().ie)({pageId:a,recordMap:v().RecordMap.create(),updates:[{action:"insert",blocks:u}],spaceId:i,legacyNonCrdt:!0,idCreator:s,actorPointer:r,uriContext:{baseUrl:o().A.domainBaseUrl,publicDomainName:o().A.publicDomainName},agentBlocksOnPage:[],options:{citationFormat:l,simpleBulletsEnabled:d},parseAgentUrlFn:g().X1,suppressErrors:!0})}function j(e){const{environment:t,transaction:n,rootStore:a,blockOperations:i,citationContext:s}=e,o=a.getContentStore(),r=new Set(o.getValue()??[]);for(const c of i)((0,y().$Y)(c)||(0,y().mP)(c))&&k().applyOperation({store:(0,u().v3)(o,c.pointer),operation:c,transaction:n});const l=(o.getValue()??[]).filter((e=>!r.has(e))).map((e=>p().B.createChildStore(o,{table:S().ev,id:e})));return l.length>0&&((0,I().postProcessAICreatedStores)(t,l),(0,w().v4)(l,t,n,s)),l}function M(e){const{markdown:t,spaceStore:n,citationFormat:o,citationContext:u,turnSteps:p,stepId:g,threadStore:m}=e,f=(0,c().v3)(),y=(0,i().T)(),v=(0,s().X)("agent_generate_image"),I=(0,s().X)("bullets_in_simple_tables_yuh"),w=n.id,M=(0,d().K8)((()=>f.idCreator.getSpaceIdCreatorSync(w)),[f.idCreator,w]),_=(0,a.useMemo)((()=>{if(!p)return;const e=new Map;for(const t of p){if("agent-tool-result"!==t.type)continue;const n=t.input;if(!n||"object"!=typeof n||!("editDescriptionVariableName"in n)||!t.toolCallId)continue;const a="string"==typeof n.editDescriptionVariableName?n.editDescriptionVariableName:void 0;if(!a)continue;const i=(0,A().v)(t);if(!i||0===i.length)continue;const s={recordPointers:i,toolResultStep:t,stepId:g};e.set(a,s)}return e}),[p,g]),P=(0,a.useMemo)((()=>new(l().A)({name:C().i,isTemporaryData:!0,relatedThreadPointer:null==m?void 0:m.pointer})),[m]);(0,a.useEffect)((()=>()=>{P.removeCacheFallback(f.defaultRecordCache.inMemoryRecordCache)}),[f.defaultRecordCache.inMemoryRecordCache,P]);return(0,a.useMemo)((()=>{if(!t)return;if(!y)return;const e={table:b().oo,id:y},n=M.idInSavedSpace(S().ev),a=v?h().W.filter((e=>"image"!==e)):h().W,i=T({markdown:t,pageId:n,spaceId:w,idCreator:M,actorPointer:e,citationFormat:o,toolUseInfoMap:_,omitBlockTypes:a,simpleBulletsEnabled:I});return r().e.withListenerIgnored((()=>{P.addCacheFallback(f.defaultRecordCache.inMemoryRecordCache);return k().createAndCommit({userAction:`${C().i}.markdownToBlocks`,environment:f,canUndo:!1,perform:e=>{const t=x().Wv({environment:f,type:"page",id:n,inMemoryRecordCache:P,transaction:e,spaceId:w,format:{page_small_text:!0}});return j({environment:f,transaction:e,rootStore:t,blockOperations:i,citationContext:u}),t}}).performResult}))}),[t,f,y,M,w,o,u,P,_,v,I])}},309431:(e,t,n)=>{n.d(t,{e:()=>d});var a=n(296540),i=()=>n(484714),s=()=>n(631611),o=()=>n(140022),r=()=>n(830010),l=()=>n(371621),c=()=>n(483730);function d(e){const{inferenceId:t,operationIds:n}=e,d=(0,i().v3)(),u=(0,s().jw)().type;return(0,a.useCallback)((async()=>{const e=c().default.getActiveSession();e&&(await(0,r().acceptEdits)({environment:d,sessionContext:e,inferenceId:t,operationIds:n,operationContext:(0,l().BB)({shouldCreateUnknownBlock:!0}),assistantSurfaceType:u}),o().trackAcceptAllPill(d,{sessionId:e.sessionIdFromStoreState,from:u,inferenceId:t}))}),[u,d,t,n])}},310770:(e,t,n)=>{n.d(t,{b$:()=>r,d7:()=>o});n(898992),n(354520),n(672577),n(581454);var a=()=>n(534177),i=()=>n(949575);function s(e){const t=function(e){const{assistantSuggestionContext:t}=e;if("assistant"===t.type){if(t.requestedOnPublicDomain)return["chat_key_points","translate"];if(!("selectionState"in t))return"pageStore"in t?["connectApps","search_qna","help_me_draft","brainstorm_ideas","watchDemoVideo"]:(0,a().HB)(t);if("corner"===t.surface)return i().assistantSurfaceActionValidators.isStudent(t)&&i().assistantSurfaceActionValidators.isPageFilled(t)?["connectApps","create_quiz","page_qna","watchDemoVideo"]:i().assistantSurfaceActionValidators.isPageEmpty(t)&&!i().assistantSurfaceActionValidators.isCollection(t)?["connectApps","draft_outline","draft_table","watchDemoVideo"]:["connectApps","chat_key_points","chat_action_items","watchDemoVideo"];if("mobileWriter"===t.surface||"writer"===t.surface){if(i().assistantSurfaceActionValidators.isPageEmpty(t))return["help_me_draft","draft_outline","draft_table","draft_diagram"];if(i().assistantSurfaceActionValidators.isPageLong(t))return i().assistantSurfaceActionValidators.hasSelection(t)?["improve_writing","fix_spelling_grammar","translate"]:["continue_writing"];if(i().assistantSurfaceActionValidators.isPageShort(t))return i().assistantSurfaceActionValidators.hasSelection(t)?["continue_writing","improve_writing","fix_spelling_grammar","translate"]:["continue_writing","draft_table","draft_diagram"]}}else{if("entrypoint"!==t.type)return(0,a().HB)(t);if("pageEnd"===t.entrypoint)return["help_me_draft","browseTemplates"];if("richTextMenu"===t.entrypoint)return i().assistantSurfaceActionValidators.isSelectionLong(t)?["improve_writing"]:["explain_this"];if("blockPasteMenu"===t.entrypoint)return["reformat","improve_writing","fix_spelling_grammar","make_shorter"]}return["connectApps","brainstorm_ideas","watchDemoVideo"]}(e);return t}function o(e){const{assistantSuggestionContext:t,validatedActions:n}=e;return s({assistantSuggestionContext:t}).map((e=>n.find((t=>"clientSkill"===t.actionType?t.skillType===e:"arbitrary"===t.actionType?t.key===e:(0,a().HB)(t))))).filter(a().O9)}function r(e){const{assistantSuggestionContext:t}=e;if("assistant"===t.type){if("corner"===t.surface)return["findSearch","create","thinkAskChat","notionActions"];if("mobileWriter"===t.surface||"writer"===t.surface)return["edit","writeInsert","create","thinkAskChat","findSearch"]}return["thinkAskChat","findSearch","create","writeInsert","notionActions"]}},311546:(e,t,n)=>{n.d(t,{Df:()=>y,G:()=>S,R:()=>g,Rr:()=>h,Zh:()=>I,bS:()=>f,ol:()=>m,vq:()=>b,zn:()=>x,zr:()=>v});var a=()=>n(564884),i=()=>n(836095),s=()=>n(675133),o=()=>n(128933),r=()=>n(206267),l=()=>n(769864),c=()=>n(61958),d=()=>n(576590),u=()=>n(716500),p=()=>n(937854);async function g(e){const{environment:t,spaceId:n,jiraApiToken:a,jiraSiteUrl:i}=e,s=await l().callApi({eventName:"authenticateJiraAiConnector",environment:t,data:{spaceId:n,jiraApiToken:a,jiraSiteUrl:i}});return"success"!==s.type?{status:"failed"}:"success"===s.type&&"failed"===s.data.connectionStatus?{status:"failed",errorCode:s.data.errorCode}:{status:"success"}}async function m(e){const{environment:t,spaceId:n,analyticsProperties:s}=e,{analyticsFrom:o,buttonName:r,sessionId:d}=s;(0,a().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:r,integration_type:"jira",setup_session_id:d,from:o}}});const p=await l().callApi({eventName:"getJiraUserAuthUrl",environment:t,data:{spaceId:n,isDesktop:t.device.isElectron,sessionId:d}});if("success"===p.type)if(t.device.isElectron)(0,i().P)(p.data.url);else{const e=(0,u().K)("jira");c().P(t,{width:800,height:600,url:p.data.url,titleMessage:e.messages.oauthPopupTitleMessage})}}async function h(e){const{environment:t,spaceId:n}=e;"failed"!==(await l().callApi({eventName:"disconnectAiConnector",environment:t,data:{spaceId:n,connector:"jira"}})).type?(o().D6({label:s().A.getIntl().formatMessage({defaultMessage:"Started disconnecting Jira. This can take up to 3 hours.",id:"jira.v2.disconnect.started"}),position:"bottom"}),p().EF.setState({...p().EF.state,jiraSyncState:"disconnecting",isDisconnecting:!0})):o().D6({label:s().A.getIntl().formatMessage({defaultMessage:"Something went wrong. Please try again.",id:"jira.v2.disconnect.failed"})})}function f(e){const{spaceId:t,environment:n,analyticsProperties:i}=e;t&&((0,a().u)({environment:n,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"user_jira_resume_pending_connection",integration_type:"jira",setup_session_id:i.sessionId,from:i.analyticsFrom}}}),(0,d().navigateToAIConnectorOnboarding)({connector:"jira",analyticsFrom:i.analyticsFrom,sessionId:i.sessionId}))}async function y(e){const{environment:t,spaceId:n}=e,a=await l().callApi({eventName:"getJiraSelection",environment:t,data:{spaceId:n}});if("success"===a.type)return p().EF.setState({...p().EF.state,syncControl:a.data}),a.data}function v(){p().EF.setState({...p().EF.state,currentScreen:"connection_complete_screen"})}function S(e){const{analyticsFrom:t,screenToShow:n}=e,a=e.sessionId??r().JW();p().EF.setState({...p().EF.state,analyticsFrom:t,currentScreen:n,sessionId:a})}async function b(e){const{environment:t,spaceId:n,projectSelection:a}=e,i=await l().callApi({eventName:"setJiraSelection",environment:t,data:{spaceId:n,...a}});var r;return"failed"!==i.type||("NO_CHANGES"===(null===(r=i.error)||void 0===r||null===(r=r.data)||void 0===r||null===(r=r.responseBody)||void 0===r?void 0:r.debugMessage)?(o().D6({label:s().A.getIntl().formatMessage({defaultMessage:"No changes to the selection",id:"jira.v2.project.selection.no_changes"}),position:"bottom"}),!1):(o().D6({label:s().A.getIntl().formatMessage({defaultMessage:"Something went wrong. Please try again.",id:"jira.v2.project.selection.failed"}),position:"bottom"}),!1))}async function x(e){const{environment:t,spaceId:n}=e;"failed"!==(await l().callApi({eventName:"startJiraAIV2Editflow",environment:t,data:{spaceId:n}})).type?(o().D6({label:s().A.getIntl().formatMessage({defaultMessage:"Editing Jira connection. This can take up to 36 hours.",id:"jira.v2.editflow.started"}),position:"bottom"}),p().EF.setState({...p().EF.state,jiraSyncState:"editing",jiraSyncProgress:0})):o().D6({label:s().A.getIntl().formatMessage({defaultMessage:"Something went wrong. Please try again.",id:"jira.v2.editflow.failed"}),position:"bottom"})}async function I(e){const{environment:t,spaceId:n,analyticsProperties:a}=e,i=await l().callApi({eventName:"startIngestion",environment:t,data:{connector:"jira",spaceId:n,setupSessionId:a.sessionId}});"failed"===i.type||"success"===i.type&&!i.data.success?o().D6({label:s().A.getIntl().formatMessage({defaultMessage:"Something went wrong. Please try again.",id:"jira.v2.sync.failed"}),position:"bottom"}):(o().D6({label:s().A.getIntl().formatMessage({defaultMessage:"Jira sync started. This can take up to 36 hours.",id:"jira.v2.sync.started"}),position:"bottom"}),p().EF.setState({...p().EF.state,jiraSyncState:"in_progress"}))}},318670:(e,t,n)=>{n.d(t,{IT:()=>E,gg:()=>B});n(898992),n(672577);var a=n(296540),i=()=>n(135168),s=()=>n(59226),o=()=>n(726637),r=()=>n(484714),l=()=>n(590526),c=()=>n(401497),d=()=>n(128933),u=()=>n(849255),p=()=>n(695115),g=()=>n(26697),m=()=>n(209969),h=()=>n(105819),f=()=>n(864896),y=()=>n(599813),v=()=>n(427704),S=()=>n(798880),b=()=>n(530199),x=()=>n(69708),I=()=>n(100622),k=()=>n(939768),w=()=>n(712030),C=()=>n(483795),A=()=>n(29554),T=()=>n(547149),j=()=>n(140992),M=()=>n(791256),_=()=>n(119994),P=()=>n(803078),D=n(474848);function E(e){const{step:t,clientStore:n,threadStore:m,runningInference:y}=e,w=(0,r().v3)(),E=(0,x().tz)(),F=!w.currentUser.id||t.userId===w.currentUser.id,N=(0,l().K8)((()=>(0,i().f)(m)),[m]),L=(0,l().K8)((()=>{if(N&&t.userId)return u().L.createChildStore(N,{table:S().oo,id:t.userId})}),[N,t.userId]),O=(0,l().K8)((()=>null==L?void 0:L.getDisplayName(E)),[L,E]),V=(0,l().K8)((()=>{var e;return"search"===(null===(e=(0,M().L2)(m))||void 0===e?void 0:e.type)}),[m]),z=(0,l().K8)((()=>{var e;return"researcher"===(null===(e=(0,M().L2)(m))||void 0===e?void 0:e.type)}),[m]),W=(0,l().K8)((()=>{var e;return"markdown-chat"===(null===(e=(0,M().L2)(m))||void 0===e?void 0:e.type)}),[m]),U=(0,s().X)("agent_partial_transcript"),H=(0,s().X)("agent_patch_streaming"),[K,q]=(0,a.useState)(!1),[$,G]=(0,a.useState)(!1),Y=(0,a.useRef)(null),Q=(0,c().IS)((()=>({container:{display:"flex",flexDirection:"column",alignItems:F?"flex-end":"flex-start"},messageRow:{display:"flex",alignItems:"start",gap:8,width:"100%",justifyContent:F?"flex-end":"flex-start"},bubbleContainer:{position:"relative",maxWidth:"80%",paddingTop:4,marginTop:-4,background:"transparent"},bubble:{paddingTop:6,paddingBottom:6,paddingInlineStart:F?14:4,paddingInlineEnd:F?14:4,borderRadius:F?18:0,...F&&{backgroundColor:I().Tj.background.tertiaryTranslucent},whiteSpace:"pre-wrap",wordWrap:"break-word",transition:"background-color 0.1s ease",...K&&F&&{backgroundColor:I().Tj.background.tertiaryTranslucent}},actionsRow:{position:"absolute",transform:"translateY(-100%)",top:0,insetInlineEnd:0,display:"flex",gap:2,boxShadow:`0 0 0 0.5px ${I().Tj.border.secondary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.04)`,opacity:K||$?1:0,backgroundColor:I().Tj.background.elevated,borderRadius:8,padding:2,zIndex:1,transition:"opacity 0.2s ease"},hoverAction:{width:24,height:24},stagingAndInputWrap:V?{borderRadius:18,paddingTop:6,paddingBottom:6,paddingInlineStart:14,paddingInlineEnd:14,minHeight:32}:{},textContainer:V?{paddingTop:0,paddingBottom:0}:{}})),[F,K,$,V]),J=B({threadStore:m,step:t}),X=(0,a.useCallback)((()=>{q(!0)}),[]),Z=(0,a.useCallback)((()=>{q(!1)}),[]),ee=(0,a.useCallback)((()=>{G(!0),q(!1),setTimeout((()=>{var e;null===(e=Y.current)||void 0===e||e.focus()}),1)}),[]),te=(0,a.useCallback)((e=>{G(!1),q(!1),function(e){const{environment:t,threadStore:n,clientStore:a,step:i,newValue:s,sendPartialTranscript:o,sendPatchResponse:r}=e,l=n.getTranscript().find((e=>"user"===e.type)),c=(null==l?void 0:l.id)===i.id,{serverCommitResult:d}=T().createAndCommit({userAction:"AIChatTranscript.RunFromStepButton.handleClick",environment:t,canUndo:!0,perform:e=>{(0,j().D7)({threadStore:n,step:i,newValue:s,transaction:e}),(0,j().Pz)({threadStore:n,stepId:i.id,transaction:e})}});(0,j().WE)({environment:t,threadStore:n,clientStore:a,forceRegenerateTitle:c,stepIdsToInclude:Boolean(o)?[i.id]:void 0,waitBeforeSending:d,sendPatchResponse:r})}({environment:w,threadStore:m,clientStore:n,step:t,newValue:e,sendPartialTranscript:U,sendPatchResponse:H})}),[w,m,n,t,U,H]),ne=(0,a.useCallback)((()=>{if(!m)return;const e=(0,A().r4)(t.value,m),n=(0,k().Gm)({url:`${o().A.domainBaseUrl}${v().JZ.chat}`,query:{[b().ah]:e}});navigator.clipboard.writeText(n).then((()=>{d().D6({label:E.formatMessage({id:"aiInferenceTranscript.userStep.linkCopiedToClipboard",defaultMessage:"Link copied to clipboard"}),durationMs:1e4})}))}),[E,t.value,m]),{store:ae,setValue:ie}=(0,C().AI)({initialValue:t.value}),se=(0,a.useCallback)((()=>{G(!1),ie(t.value)}),[t.value,ie]),oe=(0,a.useCallback)((()=>{te(ae.getValue()||[])}),[te,ae]);return(0,D.jsxs)("div",{style:Q.container,children:[!F&&L&&N?(0,D.jsx)(_().U,{type:"user",userStore:L,spaceStore:N,displayName:O??"",avatarSize:32,gap:2}):void 0,(0,D.jsx)("div",{style:Q.messageRow,children:(0,D.jsxs)("div",{style:Q.bubbleContainer,onMouseEnter:X,onMouseLeave:Z,children:[$?(0,D.jsx)(P().k,{onSubmit:oe,store:ae,textRef:Y,fontSize:V||z||W?16:void 0,stagingAndInputWrapStyle:Q.stagingAndInputWrap,textContainerStyle:Q.textContainer}):(0,D.jsx)("div",{style:Q.bubble,children:J}),(0,D.jsxs)("div",{style:Q.actionsRow,children:[F&&!$?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(p().A,{style:Q.hoverAction,icon:h().pencilLineIcon,ariaLabel:E.formatMessage({id:"aiInferenceTranscript.userStep.editMessage",defaultMessage:"Edit message"}),onClick:ee,disabled:y}),(0,D.jsx)(g().m,{renderTooltip:()=>E.formatMessage({id:"aiInferenceTranscript.userStep.shareMessage",defaultMessage:"Copy link to message"}),render:e=>(0,D.jsx)(p().A,{style:Q.hoverAction,icon:f().Y,ariaLabel:E.formatMessage({id:"aiInferenceTranscript.userStep.shareMessage",defaultMessage:"Copy link to message"}),onClick:ne,disabled:y,...e})})]}):void 0,$?(0,D.jsx)(R,{step:t,onCancel:se,onSave:oe}):void 0]})]})})]})}function R(e){const{step:t,onCancel:n,onSave:i}=e,s=(0,x().tz)(),{store:o}=(0,C().AI)({initialValue:t.value}),r=(0,a.useCallback)((()=>{i(o.getValue()||[])}),[o,i]);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(p().A,{onClick:n,icon:y().xMarkIcon,ariaLabel:s.formatMessage({id:"aiInferenceTranscript.userStep.cancel",defaultMessage:"Cancel"})}),(0,D.jsx)(p().A,{onClick:r,icon:m().checkmarkCircleFillIcon,ariaLabel:s.formatMessage({id:"aiInferenceTranscript.userStep.save",defaultMessage:"Save"})})]})}function B(e){const{threadStore:t,step:n}=e,a=(0,r().v3)(),i=(0,c().DP)();return(0,l().K8)((()=>{const e=t.getSpaceId();return e?(0,A().S5)({environment:a,textValue:{value:n.value||[],spaceId:e},parentStore:t,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disabled:!0,theme:i,emojiType:(0,w().FN)(a),katex:a.KatexStore.getKatex(),formulaValueTypes:[]}):null}),[n.value,a,t,i])}},321701:(e,t,n)=>{n.d(t,{_:()=>l});var a=()=>n(100622),i=()=>n(631611),s=()=>n(520937);const o=(0,n(69708).YK)({thisPage:{id:"assistant.skillCategory.thisPage",defaultMessage:"This page"},search:{id:"assistant.skillCategory.search",defaultMessage:"Search"}}),r={thinkAskChat:{label:o.thisPage,color:e=>(0,s().kO)(a().Tj.palette.blue,e)},findSearch:{label:o.search,color:()=>({color:a().Tj.palette.gray[500],background:a().Tj.grayButtonBackground,hoveredBackground:a().Tj.grayButtonHoveredBackground,pressedBackground:a().Tj.grayButtonPressedBackground})},notionActions:{color:()=>({color:a().Tj.primaryBlack,background:a().Tj.grayButtonBackground,hoveredBackground:a().Tj.grayButtonHoveredBackground,pressedBackground:a().Tj.grayButtonPressedBackground})}};function l(e){return{...(0,s().vJ)(e),...(0,i().jw)().canUseUpdatedSkillDisplayFormat&&r[e]}}},324883:(e,t,n)=>{n.d(t,{s:()=>i});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"3.28 3.22 9.44 9.45",svg:(0,n(474848).jsx)("path",{d:"M12.487 3.457a.804.804 0 0 0-1.13 0l-.553.552a.075.075 0 0 0 0 .106l1.03 1.03a.075.075 0 0 0 .106 0l.547-.546a.1.1 0 0 0 .019-.032.804.804 0 0 0-.019-1.11m-2.247 1.22a.075.075 0 0 0-.105 0l-6.337 6.326a1.1 1.1 0 0 0-.237.393l-.269.87v.002c-.063.232.153.466.388.383l.863-.267q.222-.061.398-.239l6.331-6.331a.075.075 0 0 0 0-.106z"})},i=(0,n(340498).wt)("pencilSmall",a,"small")},328729:(e,t,n)=>{n.d(t,{w:()=>y,y:()=>f});n(898992),n(354520),n(581454);var a=n(296540),i=()=>n(590526),s=()=>n(295633),o=()=>n(249046),r=()=>n(758304),l=()=>n(179034),c=()=>n(69708),d=()=>n(496603),u=()=>n(534177),p=()=>n(284371),g=()=>n(187820),m=()=>n(16006),h=n(474848);function f(e){const{clientStep:t,parentStore:n}=e,a=(0,i().K8)((()=>{if(t.pageIds)return t.pageIds.map((e=>s().B.createChildStore(n,{table:l().ev,id:e})));{const e=t.searchResults.map((e=>s().B.createChildStore(n,{table:l().ev,id:e})));return d().hS(e.map((e=>e.getNavigableBlockStore())).filter(u().O9),(e=>e.id))}}),[t,n]);return(0,h.jsx)(y,{searchResultStores:a})}function y(e){const{searchResultStores:t}=e,[n,s]=(0,a.useState)(0);(0,a.useEffect)((()=>{const e=setInterval((()=>{s((e=>e+1))}),800);return()=>clearInterval(e)}),[]);const l=(0,i().K8)((()=>t.map(((e,t)=>(0,h.jsxs)(o().Ye,{style:{alignItems:"center",gap:4},children:[(0,h.jsx)(r().N,{styleKey:"bodyMedium",animate:!0,colorVariant:"secondary",text:(0,h.jsx)(c().sA,{id:"AssistantChatStep.searchingText",defaultMessage:"Reading"})}),(0,h.jsx)("div",{style:p().RC,children:(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,h.jsx)(g().B6,{disabled:!0,isEmptyPage:e.isEmptyPage(),icon:e.getIcon(),size:16,emojiSize:16,disableShrinking:!0,largeIcon:!0,style:{margin:"0px 4px"},iconRecordCategory:(0,g().Te)(e)}),(0,h.jsx)(m().A,{store:e})]})})]},t)))),[t]),d=n>=t.length?(0,h.jsx)(o().Ye,{children:(0,h.jsx)(c().sA,{id:"AssistantChatStep.summarize",defaultMessage:"Summarizing"})}):l[n];return(0,h.jsx)("div",{style:{display:"flex"},children:(0,h.jsx)("div",{style:{minWidth:50},children:d})})}},329840:(e,t,n)=>{n.d(t,{Y:()=>d});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(581454);var a=()=>n(496603),i=()=>n(534177),s=()=>n(181856),o=()=>n(832443),r=()=>n(353566),l=()=>n(252050);let c;"undefined"!=typeof window&&window.FinalizationRegistry&&(c=new FinalizationRegistry((e=>{!function(e){function t(e){e.parent=void 0;const n=e.children;e.children=[];for(const a of n)"collectionView"!==a.type&&t(a)}for(const n of e.keys()){const a=e.get(n);a&&t(a)}e.clear()}(e)})));class d{constructor(e,t=void 0){var n;this.context=void 0,this.selection=void 0,this.schemaIdMap=void 0,this.blockIdMap=void 0,this.loadedPageIds=void 0,this.loadedDatabaseIds=void 0,this.peopleIdMap=void 0,this.universalIdMap=void 0,this.universalSearchResultPayloadMap=void 0,this.loadedUniversalIds=void 0,this.loadedAttachmentIds=void 0,this.idMapper=void 0,this.collectionIdMap=void 0,this.namespace=void 0,this.maybeConnectorSearchContext=void 0,this.inheritPropsFromClonedParent=e=>{for(const t of e.getLoadedPageIds())this.markPageAsLoaded(t);this.selection=a().mg(e.getAssistantSelectionIfExists()),this.blockIdMap=e.cloneBlockIdMap(),this.schemaIdMap=e.cloneSchemaIdMap();for(const[t,n]of e.peopleIdMap.entries())this.peopleIdMap.set(t,{...n});this.collectionIdMap=e.cloneCollectionIdMap(),this.universalIdMap=e.cloneUniversalIdMap(),this.universalSearchResultPayloadMap=e.cloneUniversalSearchResultPayloadMap(),this.context=e.getContext(),this.idMapper=e.getIdMapper(),this.maybeConnectorSearchContext=e.maybeConnectorSearchContext},this.getIdMapper=()=>this.idMapper,this.cloneCollectionIdMap=()=>{const e=new Map;for(const[t,n]of this.collectionIdMap.entries()){const a={type:n.type,tagName:n.tagName,parent:n.parent,attributes:{id:n.attributes.id,title:n.attributes.title},persisted:n.persisted,schemaId:n.schemaId,schemas:{...n.schemas},properties:{...n.properties}};e.set(t,a)}return e},this.addCollectionToCollectionIdMap=(e,t)=>{this.collectionIdMap.set(e,t)},this.getCollectionFromCollectionIdMap=e=>this.collectionIdMap.get(e),this.getBlockIdMap_DO_NOT_USE=()=>this.blockIdMap,this.setIdMapper=e=>{this.idMapper=e},this.setPeopleIdMap=e=>{this.peopleIdMap=e},this.setUniversalIdMap=e=>{this.universalIdMap=e},this.setUniversalSearchResultPayloadMap=e=>{this.universalSearchResultPayloadMap=e},this.getContext=()=>this.context,this.getValueFromContext=e=>this.context[e],this.getLoadedPageIds=()=>this.loadedPageIds,this.getLoadedDatabaseIds=()=>this.loadedDatabaseIds,this.getLoadedUniversalIds=()=>this.loadedUniversalIds,this.getAssistantSelectionIfExists=()=>this.selection,this.setAssistantSelection=e=>{this.selection=e},this.getBlockFromBlockIdMap=e=>{const t=this.blockIdMap.get(e);if(!t)throw n=e,new(s().Te)("block_not_found",`Block ${n} not found.`);var n;return t},this.getBlockFromBlockIdMapIfExists=e=>this.blockIdMap.get(e),this.getNodeFromUniversalIdMapIfExists=e=>this.universalIdMap.get(e),this.getPageOrChildPageFromBlockIdMapIfExists=e=>{for(const t of this.blockIdMap.values())if("page"===t.tagName&&t.attributes.id===e||"child-page"===t.tagName&&t.attributes["page-id"]===e)return t},this.doesBlockIdMapHaveBlock=e=>this.blockIdMap.has(e),this.doesCollectionIdMapHaveCollection=e=>this.collectionIdMap.has(e),this.setUniversalIdMapForUniversalNode=(e,t)=>{this.universalIdMap.set(e,t)},this.setBlockIdMapForBlock=(e,t)=>{this.blockIdMap.set(e,t)},this.setCollectionIdMapForCollection=(e,t)=>{this.collectionIdMap.set(e,t)},this.getPageIdToBlockIdMap=()=>{const e=new Map;for(const[t,n]of this.blockIdMap.entries())if("child-page"===n.tagName){const a=n.attributes["page-id"];e.set(a,t)}else if("page"===n.tagName){const a=n.attributes.id;e.set(a,t)}return e},this.getSchemaFromSchemaIdMapIfExists=e=>this.schemaIdMap.get(e),this.setSchemaIdMapForSchema=(e,t)=>{this.schemaIdMap.set(e,t)},this.setSchemaIdMapForSchemaIfNotExists=(e,t)=>{this.schemaIdMap.has(e)||this.schemaIdMap.set(e,t)},this.cloneSchemaIdMap=()=>{const e=new Map;for(const[t,n]of this.schemaIdMap.entries())e.set(t,a().mg(n));return e},this.markPageAsLoaded=e=>{this.loadedPageIds=Array.from(new Set([...this.loadedPageIds,e]))},this.markPagesAsLoaded=e=>{this.loadedPageIds=Array.from(new Set([...this.loadedPageIds,...e]))},this.markAttachmentAsLoaded=e=>{this.loadedAttachmentIds.add(e)},this.markUniversalIdAsLoaded=e=>{this.loadedUniversalIds.add(e)},this.unmarkPageAsLoaded=e=>{this.loadedPageIds=this.loadedPageIds.filter((t=>t!==e))},this.markDatabaseAsLoaded=e=>{this.loadedDatabaseIds.add(e)},this.setMaybeConnectorSearchContext=e=>{this.maybeConnectorSearchContext=e},this.overwriteSchemaIdMap=e=>{this.schemaIdMap=e},this.appendNewSearchDatabasesResult=e=>{for(const t of e)this.collectionIdMap.set(t.attributes.id,t)},this.appendNewSearchPeopleResult=e=>{for(const t of e)this.peopleIdMap.set(t.id,t)},this.getSerializedState=()=>({version:r().Mz,context:this.getContext(),selection:this.getAssistantSelectionIfExists(),loadedPageIds:[...this.loadedPageIds],idMapper:this.getIdMapper().serialize(),schemaIdMap:Object.fromEntries(this.schemaIdMap),blockIdMap:this.replaceCircularReferencesInBlockIdMap(),peopleIdMap:Object.fromEntries(this.peopleIdMap),collectionIdMap:Object.fromEntries(this.collectionIdMap),universalIdMap:Object.fromEntries(this.universalIdMap),universalSearchResultPayloadMap:Object.fromEntries(this.universalSearchResultPayloadMap),loadedUniversalIds:[...this.loadedUniversalIds],loadedDatabaseIds:[...this.loadedDatabaseIds],loadedAttachmentIds:[...this.loadedAttachmentIds]}),this.setContext=e=>{this.context=e},this.getNamespace=()=>this.namespace,this.setNamespace=e=>{this.namespace=e},this.replaceCircularReferencesInBlockIdMap=()=>{const e={};for(const[t,n]of this.blockIdMap.entries()){const a=(0,r().fw)(n);e[t]=a}return e},this.lazyCloneAndAssignBlock=e=>{const{block:t,oldMap:n,newMap:i}=e,s=i.get(t.attributes.id);if(s)return s;const o={type:"block",tagName:t.tagName,attributes:{...t.attributes},persisted:t.persisted,parent:void 0,children:[],text:a().mg(t.text),properties:a().mg(t.properties),schemas:a().mg(t.schemas),schemaId:t.schemaId};if(i.set(t.attributes.id,o),"database-views"===t.tagName){const e=t.children;o.children=e.map((e=>a().mg(e)))}else{const e=t.children;o.children=e.map((e=>this.lazyCloneAndAssignBlock({block:e,oldMap:n,newMap:i})))}return t.parent&&(o.parent=this.lazyCloneAndAssignBlock({block:t.parent,oldMap:n,newMap:i})),o},this.cloneBlockIdMap=()=>{const e=new Map;for(const t of this.blockIdMap.keys())this.lazyCloneAndAssignBlock({block:this.blockIdMap.get(t),oldMap:this.blockIdMap,newMap:e});return e},this.cloneUniversalIdMap=()=>a().mg(this.universalIdMap),this.cloneUniversalSearchResultPayloadMap=()=>a().mg(this.universalSearchResultPayloadMap),this.toParserArgs=()=>({allocateIdFn:()=>this.randomID(),mapCounterToKey:e=>this.idMapper.mapCounterToKey(e)}),this.assistantLoggingData=t;const i="mode"in e?e:e.context;this.context=i,this.selection=void 0,this.schemaIdMap=new Map,this.blockIdMap=new Map,this.loadedPageIds=[],this.universalIdMap=new Map,this.universalSearchResultPayloadMap=new Map,this.loadedUniversalIds=new Set,this.loadedAttachmentIds=new Set,this.peopleIdMap=new Map,this.idMapper=new(o().tD),this.collectionIdMap=new Map,this.loadedDatabaseIds=new Set,this.clone=d.safeBind(this,this.clone),this.parse=d.safeBind(this,this.parse),this.addOperation=d.safeBind(this,this.addOperation),this.randomID=d.safeBind(this,this.randomID),this.loadPage=d.safeBind(this,this.loadPage),this.loadDatabase=d.safeBind(this,this.loadDatabase),this.search=d.safeBind(this,this.search),this.chat=d.safeBind(this,this.chat),this.chatMd=d.safeBind(this,this.chatMd),this.searchPeople=d.safeBind(this,this.searchPeople),this.loadSlack=d.safeBind(this,this.loadSlack),this.loadGoogleDrive=d.safeBind(this,this.loadGoogleDrive),this.loadGithub=d.safeBind(this,this.loadGithub),this.loadJira=d.safeBind(this,this.loadJira),this.loadLinear=d.safeBind(this,this.loadLinear),this.loadBox=d.safeBind(this,this.loadBox),this.loadSalesforce=d.safeBind(this,this.loadSalesforce),this.loadGithubCode=d.safeBind(this,this.loadGithubCode),this.loadWebPage=d.safeBind(this,this.loadWebPage),this.loadMicrosoftTeams=d.safeBind(this,this.loadMicrosoftTeams),this.loadSharepoint=d.safeBind(this,this.loadSharepoint),this.loadPdf=d.safeBind(this,this.loadPdf),this.searchDatabases=d.safeBind(this,this.searchDatabases),this.namespace="end_to_end","mode"in e||this.setState(e),null===(n=c)||void 0===n||n.register(this,this.blockIdMap,this)}setState(e){this.markPagesAsLoaded(e.loadedPageIds),this.overwriteSchemaIdMap(new Map((0,i().WP)(e.schemaIdMap))),this.setPeopleIdMap(new Map((0,i().WP)(e.peopleIdMap)));const t=(0,r().et)(e.blockIdMap),n=new Map;for(const a of Object.values(e.blockIdMap)){const i=(0,r().W6)({node:a,blockIdMap:e.blockIdMap,childIdToParentIdMap:t,alreadyConvertedBlocks:n});i&&this.setBlockIdMapForBlock(a.attributes.id,i)}this.collectionIdMap=new Map((0,i().WP)(e.collectionIdMap)),e.universalSearchResultPayloadMap&&this.setUniversalSearchResultPayloadMap(new Map((0,i().WP)(e.universalSearchResultPayloadMap))),this.setIdMapper(new(o().tD)(e.idMapper)),this.setAssistantSelection(e.selection)}static safeBind(e,t){return function(...n){if(this!==e&&e.shouldThrowOnUnboundMethodCalled())throw new(s().Te)("incorrect_receiver",`Method '${t.name}' called with incorrect receiver, please fix the call site!`);return t.apply(e,n)}}shouldThrowOnUnboundMethodCalled(){return!1}getUniversalResultPayloadForHrefIfExists(e){const t=o().tD.parseAssistantHref(e);if(void 0===t){const t=(0,l().ew)(e);return this.getUniversalResultPayloadIfExists(t)}return"webpage"===t.type||"helpdoc"===t.type||"helpdoc-section"===t.type||(0,n(933528).aB)(t)?this.getUniversalResultPayloadIfExists(t.href):"block"===t.type?this.getUniversalResultPayloadIfExists((0,l().ew)(t.blockId)):void("database_query_results"!==t.type&&"citation_unsupported"!==t.type&&(0,i().HB)(t))}getUniversalResultPayloadIfExists(e){return this.universalSearchResultPayloadMap.get(e)}setUniversalResultPayload(e,t){this.universalSearchResultPayloadMap.set(e,t)}mergeWithState(e){this.schemaIdMap=new Map([...e.schemaIdMap,...this.schemaIdMap]),this.blockIdMap=new Map([...e.blockIdMap,...this.blockIdMap]),this.loadedPageIds=[...new Set([...e.loadedPageIds,...this.loadedPageIds])],this.loadedDatabaseIds=new Set([...e.loadedDatabaseIds,...this.loadedDatabaseIds]),this.peopleIdMap=new Map([...e.peopleIdMap,...this.peopleIdMap]),this.universalIdMap=new Map([...e.universalIdMap,...this.universalIdMap]),this.universalSearchResultPayloadMap=new Map([...e.universalSearchResultPayloadMap,...this.universalSearchResultPayloadMap]),this.loadedUniversalIds=new Set([...e.loadedUniversalIds,...this.loadedUniversalIds]),this.loadedAttachmentIds=new Set([...e.loadedAttachmentIds,...this.loadedAttachmentIds]),this.collectionIdMap=new Map([...e.collectionIdMap,...this.collectionIdMap])}}},332705:(e,t,n)=>{n.d(t,{t:()=>p});n(296540);var a=()=>n(726637),i=()=>n(401497),s=()=>n(695115),o=()=>n(589407),r=()=>n(126617),l=()=>n(340498),c=n(474848);const d=40,u=28;function p({variant:e="sidebar",ariaLabel:t,onClick:n,...p}){const g="header"===e?o().ellipsisIcon:r().ellipsisSmallIcon,m=a().A.isMobile?"tertiary":"sidebar"===e?"secondary":"primary",h=(0,i().IS)((()=>{if("header"===e){const e=a().A.isMobile?d:u,t=a().A.isMobile?l().lD.default:l().Ev.default;return{iconButton:{width:e,height:e},iconButtonIcon:{width:t,height:t}}}return{iconButton:{},iconButtonIcon:{}}}),[e]);return(0,c.jsx)(s().A,{icon:g,ariaLabel:t,onClick:n,colorVariant:m,style:h.iconButton,iconStyle:h.iconButtonIcon,...p})}},333461:(e,t,n)=>{n.d(t,{F:()=>i});n(296540);const a={viewBox:"0 0 20 20",svg:(0,n(474848).jsx)("path",{fillRule:"evenodd",d:"M17.4685918,3.4486694c-.276062-.4232178-.7411499-.6759033-1.2441406-.6759033-.1889648,0-.3743896.0357056-.5512085.1061401L3.0777837,7.8930664c-.40271.1603394-.6936035.5178223-.7687378.9447021s.0762329.8622437.4000244,1.1503906l2.4732056,2.2012329v4.2337646c0,.6617432.793457,1.0004272,1.2713013.5426636l1.9723511-1.8895264,2.0613403,1.8346558c.2311401.2056885.52771.3162842.8310547.3162842.088501,0,.1775513-.0094604.2657471-.0286255.390625-.0849609.71698-.3516235.8781738-.7174683l5.1207275-11.6225586c.2032471-.4614868.1604614-.9884644-.1143799-1.4099121ZM16.4390508,4.3546143l-5.1207275,11.6225586-3.963623-3.52771,5.2460327-5.0794067c.064209-.065918.0716553-.168457.0177002-.243042-.0568237-.0785522-.1638184-.1014404-.2478638-.0530396l-6.562439,3.9990234-2.2680054-2.0185547,12.5956421-5.0142822c.0299683-.0119019.0598755-.017395.0886841-.017395.15979,0,.2867432.1680908.2145996.3318481Z",clipRule:"evenodd"})},i=(0,n(340498).wt)("mail",a,"default")},334600:(e,t,n)=>{n.d(t,{WD:()=>y,lR:()=>b,Op:()=>S,_i:()=>f});n(296540);var a=()=>n(529099),i=n(474848);const s={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.26 15.25",svg:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("path",{d:"M6.575 10A3.425 3.425 0 0 1 10 6.575v-.64c0-.445.533-.664.847-.35l1.328 1.329a.49.49 0 0 1 0 .7l-1.328 1.329a.495.495 0 0 1-.847-.35v-.918A2.325 2.325 0 1 0 12.325 10a.55.55 0 1 1 1.1 0 3.425 3.425 0 0 1-6.85 0"}),(0,i.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 1 0 0 12.75 6.375 6.375 0 0 0 0-12.75"})]})},o=(0,n(340498).wt)("arrowInCircleClockwiseInCircle",s,"default");var r=()=>n(973238),l=()=>n(12193),c=()=>n(207207),d=()=>n(735790),u=()=>n(158469),p=()=>n(979340),g=()=>n(534177),m=()=>n(795438);const h=["profile","plans","members"];function f(e){return!!(0,g().Xk)(h,e)}const y={user_settings:{icon:d().M,title:m().D.preferencesTabTitle},notifications_and_settings:{icon:d().M,title:m().D.notificationsAndSettingsTabTitle},notifications:{icon:n(104077).r,title:m().D.notificationsTabTitle},connected_apps:{icon:n(212473).arrowUpRightSquareIcon,title:m().D.connectionsTabTitle},language_and_region:{icon:l().globeIcon,title:m().D.languageAndRegionTabTitle},offline:{icon:r().arrowInCircleDownIcon,title:m().D.offlineTabTitle},settings:{icon:n(212727).gearIcon,title:m().D.generalTabTitle},teams:{icon:n(737693).V,title:m().D.teamsTabTitle},billing:{icon:n(302995).creditCardIcon,title:m().D.billingTabTitle},ai_usage_dashboard:{icon:a().aiFaceIcon,title:m().D.aiUsageDashboardTabTitle},subscription:{icon:o,title:m().D.subscriptionTabTitle},requests:{icon:n(898615).F,title:m().D.requestsTabTitle},security:{icon:n(753363).keyIcon,title:m().D.securityTabTitle},identity_provisioning:{icon:n(15936).checkmarkShieldIcon,title:m().D.identityTabTitle},admin_content_search:{icon:c().magnifyingGlassIcon,title:m().D.adminContentSearchTabTitle},integrations:{icon:n(858141).squareGrid2X2Icon,title:m().D.spaceConnectionsTabTitle},audit_log:{icon:n(517397).F,title:m().D.auditLogTabTitle},analytics:{icon:u().f,title:m().D.analyticsTabTitle},imports:{icon:n(820579).arrowLineDownIcon,title:m().D.importTabTitle},sites:{icon:n(470356).c,title:m().D.sitesTabTitle},public_pages:{icon:l().globeIcon,title:m().D.publicPagesTabTitle},custom_emoji:{icon:n(424139).emojiFaceIcon,title:m().D.customEmojiTabTitle},verified_pages:{icon:n(112665).badgeCheckIcon,title:m().D.verifiedPagesTabTitle},ai:{icon:a().aiFaceIcon,title:m().D.aiTabTitle,badge:(0,i.jsx)(n(147294).Ee,{newBadgeKey:"notion_ai_workspace_settings",didUserEngage:!1,keyType:"date"})},workspace_discovery:{icon:c().magnifyingGlassIcon,title:m().D.workspaceDiscoveryTabTitle},experiments:{icon:n(824375).sparklesIcon,title:m().D.experimentsTabTitle},performance_toolbar:{icon:n(200582).m,title:m().D.performanceToolbarTabTitle},user_similarity_scores:{icon:n(835607).F,title:m().D.userSimilarityScoresTabTitle},collection_debug:{icon:n(62616).c,title:m().D.collectionsDebugTabTitle},offline_mode_debug:{icon:r().arrowInCircleDownIcon,title:m().D.offlineModeDebugTabTitle},design_previews:{icon:u().f,title:m().D.designPreviewsTabTitle},mobile_native:{icon:n(530093).iPhoneIcon,title:m().D.mobileNativeTabTitle}},v={user_settings:{},profile:{},notifications:{},notifications_and_settings:{},connected_apps:{},language_and_region:{},offline:{},settings:{},teams:{adminOnly:!0,membersOnly:!0},members:{membersOnly:!0},analytics:{membersOnly:!0,enterpriseOnly:!0},plans:{membersOnly:!0},billing:{},ai_usage_dashboard:{},subscription:{},requests:{adminOnly:!0},security:{adminOnly:!0},identity_provisioning:{adminOnly:!0},admin_content_search:{adminOnly:!0,enterpriseOnly:!0},integrations:{adminOnly:!0},imports:{},audit_log:{adminOnly:!0,enterpriseOnly:!0},public_pages:{membersOnly:!0},sites:{membersOnly:!0},custom_emoji:{membersOnly:!0},verified_pages:{membersOnly:!0},workspace_discovery:{membersOnly:!0},experiments:{},performance_toolbar:{},user_similarity_scores:{},collection_debug:{},offline_mode_debug:{},ai:{},design_previews:{},mobile_native:{}};function S(e,t){const n=v[e];return!(n.adminOnly&&!t.canAdmin())&&(!(n.membersOnly&&!t.canRead())&&!(n.enterpriseOnly&&!(0,p().OX)(t.getSubscriptionTier())))}function b(e){switch(e){case"profile":case"notifications_and_settings":case"user_settings":case"notifications":case"connected_apps":case"language_and_region":case"offline":case"settings":case"members":case"plans":case"billing":case"ai_usage_dashboard":case"subscription":case"security":case"identity_provisioning":case"admin_content_search":case"integrations":case"imports":case"teams":case"audit_log":case"analytics":case"sites":case"public_pages":case"custom_emoji":case"verified_pages":case"requests":case"workspace_discovery":case"experiments":case"performance_toolbar":case"user_similarity_scores":case"collection_debug":case"offline_mode_debug":case"ai":case"design_previews":case"mobile_native":return e;default:return}}},339780:(e,t,n)=>{n.d(t,{DS:()=>w,d4:()=>k,gS:()=>C});n(16280);var a=n(296540),i=()=>n(756117),s=()=>n(484714),o=()=>n(590526),r=()=>n(401497),l=()=>n(695115),c=()=>n(26697),d=()=>n(163749),u=()=>n(340266),p=()=>n(322972),g=()=>n(557943),m=()=>n(69708),h=()=>n(68465),f=()=>n(440024),y=()=>n(977270),v=()=>n(669358),S=()=>n(483730),b=()=>n(762771),x=n(474848);const I=(0,m().YK)({thumbsUpButton:{id:"assistant.chat.actions.thumbsUpButton.label",defaultMessage:"Helpful"},thumbsDownButton:{id:"assistant.chat.actions.thumbsDownButton.label",defaultMessage:"Not helpful"}});function k(e){const{isVisible:t,clientStep:n,style:a,sessionId:s,showTooltips:l}=e,{inferenceId:c}=n,d=(0,o().K8)((()=>v().A.state[c]??void 0),[c]),u=(0,r().IS)((()=>({wrap:{marginTop:"auto",display:"flex",...a}})),[a]),p=t||Boolean(d),g=!l||!p;return(0,x.jsxs)(i().A,{animate:{opacity:p?1:0},style:u.wrap,children:[(0,x.jsx)(w,{disableTooltip:g,inferenceId:c,sessionId:s}),(0,x.jsx)(C,{disableTooltip:g,inferenceId:c,sessionId:s})]})}function w(e){const t=(0,m().tz)(),{disableTooltip:n,inferenceId:i,sessionId:r,buttonStyle:d,iconStyle:u}=e,f=(0,s().v3)(),k=(0,o().K8)((()=>v().A.state[i]??void 0),[i]),w=(0,o().K8)((()=>(0,h().cJ)()),[]),C="thumbs_up"===k,A=(0,a.useCallback)((()=>{const e=r||S().default.getActiveSessionId();if(!e)throw new Error("No active session ID found");y().assistantActions.saveFeedback({environment:f,inferenceId:i,type:"assistant_thumbs_up",sessionId:e}),v().A.update((e=>({...e,[i]:"thumbs_up"}))),w&&b().A.update((()=>({open:!0,type:"slackbot_followup_feedback",traceId:i,thumbsUpOrDown:"up",sessionId:e})))}),[f,i,w,r]);return(0,x.jsx)(c().m,{disableTooltip:n,renderTooltip:()=>(0,x.jsx)(m().sA,{...I.thumbsUpButton}),render:e=>(0,x.jsx)(l().A,{...e,icon:C?p().P:g().s,onClick:A,disableBackground:C,disabled:C,disabledFeedback:!1,style:d,iconStyle:u,ariaLabel:t.formatMessage(I.thumbsUpButton),...C?{colorPalette:"blue",colorVariant:"accentPrimary"}:{}})})}function C(e){const t=(0,m().tz)(),{disableTooltip:n,inferenceId:i,sessionId:r,buttonStyle:p,iconStyle:g}=e,h=(0,s().v3)(),k="thumbs_down"===(0,o().K8)((()=>v().A.state[i]??void 0),[i]),w=(0,a.useCallback)((()=>{(0,f().I)({environment:h});const e=r||S().default.getActiveSessionId();if(!e)throw new Error("No active session ID found");y().assistantActions.saveFeedback({environment:h,inferenceId:i,type:"assistant_thumbs_down",sessionId:e}),v().A.update((e=>({...e,[i]:"thumbs_down"}))),b().A.update((()=>({open:!0,type:"slackbot_followup_feedback",traceId:i,thumbsUpOrDown:"down",sessionId:e})))}),[h,i,r]);return(0,x.jsx)(c().m,{disableTooltip:n,renderTooltip:()=>(0,x.jsx)(m().sA,{...I.thumbsDownButton}),render:e=>(0,x.jsx)(l().A,{...e,icon:k?d().m:u().d,onClick:w,disableBackground:k,disabled:k,disabledFeedback:!1,style:p,iconStyle:g,ariaLabel:t.formatMessage(I.thumbsDownButton),...k?{colorPalette:"blue",colorVariant:"accentPrimary"}:{}})})}},340266:(e,t,n)=>{n.d(t,{d:()=>i});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"1.56 2.62 12.88 12.68",svg:(0,n(474848).jsx)("path",{d:"M1.56 7.52c0-.39.14-.77.41-1.06-.08-.19-.12-.39-.12-.59 0-.54.27-1.04.71-1.33-.02-.11-.03-.21-.03-.32 0-.88.71-1.59 1.59-1.59h3.43c.67 0 1.32.15 1.93.46l.95.33h2.66c.75 0 1.35.61 1.35 1.35v4.18c0 .75-.61 1.35-1.35 1.35h-1.91l-1.67 1.78c-.16.21-.33.53-.48.84l-.1.2c-.14.28-.29.57-.43.8l-.27.56s-.02.03-.03.05c-.3.5-.84.78-1.4.78-.19 0-.39-.03-.58-.1a1.66 1.66 0 0 1-.99-2l.4-1.41c.09-.32.23-.59.34-.82l.02-.04.09-.18H3.27c-.88 0-1.59-.71-1.59-1.59 0-.26.07-.51.19-.74-.19-.26-.28-.57-.28-.9zm5.71 2.37c.18.24.23.55.14.83-.1.32-.23.58-.33.79v.02c-.12.22-.21.4-.27.6l-.41 1.42c-.06.2.04.41.23.48.17.06.37 0 .46-.14l.27-.56s.02-.04.03-.05c.12-.19.23-.43.38-.71.04-.08.08-.15.12-.23.19-.38.4-.77.63-1.06.01-.01.02-.03.04-.04l1.76-1.88V4.65c-.07 0-.14-.01-.2-.03l-1.13-.39c-.06-.02-.11-.05-.15-.07-.41-.19-.84-.29-1.3-.29H4.11c-.19 0-.34.15-.34.34 0 .09.04.18.11.25a.63.63 0 0 1-.46 1.06.329.329 0 0 0-.19.6c.17.14.26.37.22.59s-.2.41-.41.48c-.14.05-.23.17-.23.32 0 .13.07.23.18.29.2.1.34.3.35.52s-.1.44-.29.56c-.1.06-.16.16-.16.27 0 .19.15.34.34.34h3.25c.3 0 .58.14.76.39zm4.21-5.23v4.38h1.6a.1.1 0 0 0 .1-.1V4.76a.1.1 0 0 0-.1-.1z"})},i=(0,n(340498).wt)("handThumbsDownSmall",a,"small")},340644:(e,t,n)=>{n.d(t,{Y:()=>i});class a extends(()=>n(757695))().Store{getInitialState(){return{variant:void 0,exposedToExperiment:!1,shouldRenderTextPrompt:!1}}getVariant(){return this.state.variant}getExposedToExperiment(){return this.state.exposedToExperiment}getShouldRenderTextPrompt(){return this.state.shouldRenderTextPrompt}}const i=new a},356983:(e,t,n)=>{n.d(t,{W:()=>o,z:()=>r});var a=()=>n(590526),i=()=>n(631611),s=()=>n(383070);function o(e){const{sessionContext:t,mode:n}=e,o=(0,i().jw)();return(0,a().K8)((()=>{if(!o.isValidSurfaceForAttachmentUploads)return{canUpload:!1,reason:"invalid_surface"};if(!s().zD.isAttachmentUploadEnabledForUser())return{canUpload:!1,reason:"not_authorized"};if("empty_state"!==n.type&&"inferencing"!==n.type&&"default"!==n.type)return{canUpload:!1,reason:"invalid_surface"};if(!t)return{canUpload:!0};const e=t.getStagedAttachmentUploadStoreIfExists();return e&&e.hasTooManyAttachments()?{canUpload:!1,reason:"multiple_uploads"}:{canUpload:!0}}),[o,n,t])}function r(e){const{threadClientStore:t,config:n,clientChatStore:i,aiChatFeatureController:s}=e;return(0,a().K8)((()=>{if(!t)return{canUpload:!0};const e=n??i.state.configForNewTranscripts;if(!s.shouldSupportAttachments(e.type))return{canUpload:!1,reason:"not_authorized"};const a=t.getStagedAttachmentUploadStoreIfExists();return a&&a.hasTooManyAttachments()?{canUpload:!1,reason:"multiple_uploads"}:{canUpload:!0}}),[s,i,n,t])}},358296:(e,t,n)=>{n.d(t,{r:()=>s});n(296540);var a=()=>n(390109),i=n(474848);function s(e){const{text:t}=e;return(0,i.jsx)(a().qX,{clientStep:void 0,children:(0,i.jsx)("div",{style:{padding:"40px 2px"},children:t})})}},358481:(e,t,n)=>{n.d(t,{h:()=>a});n(16280);class a{get updater(){if(!this.maybeUpdater)throw new Error("EvaluatorStateCallbacks is missing an updater!");return this.maybeUpdater}constructor(e){this.attributionActor=void 0,this.maybeUpdater=void 0,this.attributionActor=e}setUpdater(e){this.maybeUpdater=e}addExecutableOperationToTemporaryOperations(e){this.updater.write((t=>{t.addTemporaryExecutableOperation({...e,inferenceId:t.latestCommitInferenceIdFromStoreState})}))}appendAssistantLoadPageTemporaryClientStep(e){this.updater.write((t=>{t.addTemporaryClientStep({type:"assistantLoadPage",pointer:e,inferenceId:t.latestCommitInferenceIdFromStoreState})}))}appendAssistantLoadDatabaseTemporaryClientStep(e){this.updater.write((t=>{t.addTemporaryClientStep({type:"assistantLoadDatabase",pointer:e,inferenceId:t.latestCommitInferenceIdFromStoreState})}))}appendSearchResultsTemporaryClientStep(e){const{searchResults:t,pageIds:n}=e;this.updater.write((e=>{e.addTemporaryClientStep({type:"assistantShowSearchResults",searchResults:t,pageIds:n,inferenceId:e.latestCommitInferenceIdFromStoreState})}))}upsertOrReplaceSearchResultsTemporaryClientStep(e){const{searchResults:t,pageIds:n,shouldReplaceInsteadOfUpsert:a}=e;this.updater.write((e=>{const i=e.temporaryClientStepsFromStoreState[e.temporaryClientStepsFromStoreState.length-1],s="assistantShowSearchResults"===(null==i?void 0:i.type)?i:void 0;s&&e.removeTemporaryClientStep(s),e.addTemporaryClientStep({type:"assistantShowSearchResults",searchResults:a?t:[...(null==s?void 0:s.searchResults)??[],...t],pageIds:a?n:[...(null==s?void 0:s.pageIds)??[],...n],inferenceId:e.latestCommitInferenceIdFromStoreState})}))}appendAssistantSearchClientStep(e){this.updater.write((t=>{t.addTemporaryClientStep({type:"assistantSearch",query:e,inferenceId:t.latestCommitInferenceIdFromStoreState})}))}appendQueryingDatabaseClientStep(e){this.updater.write((t=>{t.addTemporaryClientStep({type:"assistantQueryingDatabase",collectionPointer:e,inferenceId:t.latestCommitInferenceIdFromStoreState})}))}appendQueryDatabaseClientStep(e){this.updater.write((t=>{t.addTemporaryClientStep({type:"queryDatabase",inferenceId:t.latestCommitInferenceIdFromStoreState,...e})}))}appendAssistantChatClientStep({mappedBlockIds:e,mappedOperations:t,uncited:n}){this.updater.write((a=>{a.addTemporaryClientStep({type:"assistantChat",blockIds:e,operations:t,inferenceId:a.latestCommitInferenceIdFromStoreState,uncited:n})}))}appendAssistantChatMdClientStep(e){this.updater.write((t=>{t.addTemporaryClientStep({type:"assistantChatText",text:e,inferenceId:t.latestCommitInferenceIdFromStoreState})}))}appendAssistantSearchDatabasesClientStep(e){this.updater.write((t=>{t.addTemporaryClientStep({type:"assistantSearchDatabases",searchQuery:e,inferenceId:t.latestCommitInferenceIdFromStoreState})}))}appendAssistantSearchPeopleClientStep(e){this.updater.write((t=>{t.addTemporaryClientStep({type:"assistantSearchPeople",search:e,inferenceId:t.latestCommitInferenceIdFromStoreState})}))}getAttributionActor(){return this.attributionActor}}},362075:(e,t,n)=>{n.d(t,{AB:()=>l,BU:()=>r,Ru:()=>c,f1:()=>u,yz:()=>d});var a=()=>n(907258),i=()=>n(242422),s=()=>n(590526),o=()=>n(209199);function r(){var e;const t=(null===(e=a().default.state.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.preferred_locale)??o().q;if("en"===(0,o().o_)(t)){return"play_audio"===i().default.getEligibleGroup({experimentId:"audio_consent_on_transcription_experiment",defaultGroup:"control"})}return!1}function l(){return(0,s().K8)((()=>r()),[])}function c(){var e;const t=a().AppStoreSidebarSpaceStore.state;return(null==t||null===(e=t.getSettingsStore())||void 0===e||null===(e=e.getKeyStore("audio_consent_on_transcription"))||void 0===e?void 0:e.getValue())??!1}function d(){const e=r();if(!e)return!1;if(!a().AppStoreSidebarSpaceViewStore.getState())return!1;const t=c(),n=function(){var e;const t=a().AppStoreSidebarSpaceViewStore.getState();return!!t&&((null===(e=t.getSettings())||void 0===e?void 0:e.audio_consent_on_transcription)??!0)}();return e&&(t||n)}function u(){return(0,s().K8)((()=>d()),[])}},364294:(e,t,n)=>{n.d(t,{g:()=>z});n(944114),n(898992),n(354520),n(581454);var a=n(296540),i=()=>n(907258),s=()=>n(590526),o=()=>n(401497),r=()=>n(807449),l=()=>n(265060),c=()=>n(631524),d=()=>n(160432),u=()=>n(463438),p=()=>n(26697),g=()=>n(902006),m=()=>n(510818),h=()=>n(239666),f=()=>n(73956),y=()=>n(112412),v=()=>n(863330),S=()=>n(435644),b=()=>n(42583),x=()=>n(69708),I=()=>n(100622),k=()=>n(284371),w=()=>n(843014),C=()=>n(460089),A=()=>n(791256),T=()=>n(773363),j=()=>n(742382),M=()=>n(971736),_=()=>n(51700),P=()=>n(795783),D=()=>n(322976),E=()=>n(474962),R=()=>n(610884),B=()=>n(472090),F=()=>n(298182),N=()=>n(899483),L=n(474848);const O=(0,x().YK)({createdBy:{id:"deepFindSidebar.createdByFilterTitle",defaultMessage:"Author"},lastEditedTime:{id:"deepFindSidebar.lastEditedTimeFilterTitle",defaultMessage:"Date"},applyFilters:{id:"deepFindSidebar.applyFilters",defaultMessage:"Apply"},titleOnly:{id:"deepFindHeaderFilter.titleOnly",defaultMessage:"Title only"},teamspace:{id:"deepFindHeaderFilter.teamspace",defaultMessage:"Teamspace"},in:{id:"deepFindHeaderFilter.in",defaultMessage:"In"},more:{id:"deepFindHeaderTabs.moreTabs",defaultMessage:"{count} more..."}});function V(e){return!("helpdocs"!==e&&"helpdoc-section"!==e&&"webpage"!==e&&"notion"!==e&&!(0,g().SC)(e))}function z(e){const{setToggled:t,setIsToggleHovered:n,toggled:i,deepFindFeedbackPayload:r,sources:l,selectedDeepFindSource:c,setSelectedDeepFindSource:d,assistantSearchScope:u,deepFindSearchFilters:p=h().NH,searchAgainAndUpdateAssistantSearchScope:g,step:f,useWebSearch:y}=e,[v,S]=(0,a.useState)(!1),[b,x]=(0,a.useState)(p),w=(0,a.useMemo)((()=>(0,m().vb)(p,b)),[p,b]),{current:C}=(0,a.useRef)(new(E().A)({initialDateRange:G(p.dateRangeFilter??h().NH.dateRangeFilter)})),A=(0,s().O$)(C),T=(0,a.useRef)(!1);(0,a.useEffect)((()=>{T.current?x((e=>{return{...e,dateRangeFilter:(t=A.temporaryDateRange,{startDate:Boolean(null===(n=t.starting)||void 0===n?void 0:n.start_date)?null===(a=t.starting)||void 0===a?void 0:a.start_date:void 0,endDate:Boolean(null===(i=t.ending)||void 0===i?void 0:i.start_date)?null===(s=t.ending)||void 0===s?void 0:s.start_date:void 0})};var t,n,a,i,s})):T.current=!0}),[A]);const j=(0,a.useCallback)((e=>x((t=>({...t,createdByFilter:e})))),[]),M=(0,a.useCallback)((()=>x((e=>({...e,titleOnlyFilter:!e.titleOnlyFilter})))),[]),_=(0,a.useCallback)((e=>{const{recordIds:t,type:n}=e,a="page"===n?"ancestorsFilter":"teamspacesFilter";x((e=>({...e,[a]:t})))}),[]),P=(0,o().IS)((()=>({container:{marginTop:6,marginBottom:6},filterBar:{width:"calc(100% + 20px)",marginBottom:8,marginInlineStart:-8,paddingInlineStart:0,paddingInlineEnd:0,whiteSpace:"nowrap",minWidth:0,flexShrink:0,color:I().Tj.text.secondary,fontSize:14,fontWeight:k().Wy.regular,display:"flex",alignItems:"center",justifyContent:"space-between"},filterContainer:{flexGrow:1,display:"flex",gap:4,width:"100%",alignItems:"center",minHeight:32},filterRow:{display:"flex",alignItems:"center",flexGrow:1,height:40,overflowX:"auto",position:"relative"}})),[]),D=(0,F().CJ)(c,"titleOnlyFilter"),R=(0,F().CJ)(c,"createdByFilter"),B=(0,F().CJ)(c,"teamspacesFilter"),N=(0,F().CJ)(c,"ancestorsFilter"),O=(0,F().CJ)(c,"dateRangeFilter"),V=(0,a.useMemo)((()=>{return!!((e=p).titleOnlyFilter||e.createdByFilter&&e.createdByFilter.length>0||e.teamspacesFilter&&e.teamspacesFilter.length>0||e.ancestorsFilter&&e.ancestorsFilter.length>0||e.dateRangeFilter&&(e.dateRangeFilter.startDate||e.dateRangeFilter.endDate));var e}),[p]);return(0,L.jsxs)("div",{style:P.container,children:[(0,L.jsx)(J,{setToggled:t,toggled:i,setIsToggleHovered:n,sources:l,selectedDeepFindSource:c,setSelectedDeepFindSource:d,step:f,isFilterBarOpen:v,setIsFilterBarOpen:S,isAnyFilterApplied:V}),v||V?(0,L.jsx)("div",{style:P.filterBar,children:l.length>0&&c?(0,L.jsx)("div",{style:P.filterContainer,children:(0,L.jsxs)("div",{style:P.filterRow,children:[D?(0,L.jsx)(U,{onChange:M,value:b.titleOnlyFilter}):void 0,R?(0,L.jsx)($,{onChange:j,value:b.createdByFilter??(null==p?void 0:p.createdByFilter)}):void 0,B?(0,L.jsx)(H,{value:b.teamspacesFilter??(null==p?void 0:p.teamspacesFilter),onChange:_}):void 0,N?(0,L.jsx)(K,{value:b.ancestorsFilter??(null==p?void 0:p.ancestorsFilter),onChange:_}):void 0,O?(0,L.jsx)(q,{searchDateFilterStore:C}):void 0,(0,L.jsx)(W,{shouldShowApplyButton:!w,deepFindFeedbackPayload:r,onApplyClick:()=>g({assistantSearchScope:u,searchFilters:b,useWebSearch:y??!1})})]})}):void 0}):void 0]})}function W(e){const{shouldShowApplyButton:t,onApplyClick:n,deepFindFeedbackPayload:a}=e,i=(0,o().IS)((()=>({floatingButtons:{display:"flex",alignItems:"center",width:"100%",justifyContent:"flex-end",gap:4}})),[]);return(0,L.jsx)("div",{style:i.floatingButtons,children:t?(0,L.jsx)(d().A,{colorPalette:"blue",iconLeading:{icon:f().checkmarkFillSmallIcon,size:"xs"},onClick:n,children:(0,L.jsx)(x().sA,{...O.applyFilters})}):(0,L.jsx)("div",{children:a?(0,L.jsx)(N().Az,{deepFindFeedbackPayload:a}):null})})}function U(e){const{value:t,onChange:n}=e,a=(0,x().tz)();return(0,L.jsx)(P().J,{mode:D().C.Pill,focused:!1,title:a.formatMessage(O.titleOnly),icon:S().a,value:Boolean(t),onChange:n})}function H(e){const{value:t,onChange:n}=e,a=(0,x().tz)(),o=(0,s().O$)(i().AppStoreSidebarSpaceStore);return o?(0,L.jsx)(_().SZ,{parentStore:o,mode:D().C.Pill,title:a.formatMessage(O.teamspace),teamIds:t,onChange:e=>n({recordIds:e,type:"teamspace"}),focused:!1}):null}function K(e){const{value:t,onChange:n}=e,a=(0,x().tz)(),o=(0,s().O$)(i().AppStoreSidebarSpaceStore);return o?(0,L.jsx)(j().E,{parentStore:o,mode:D().C.Pill,blockIds:t??[],onChange:e=>n({recordIds:e,type:"page"}),focused:!1,peopleBlocksToInclude:"none",title:a.formatMessage(O.in)}):null}function q(e){const{searchDateFilterStore:t}=e,n=(0,x().tz)();return(0,L.jsx)(R().m,{title:n.formatMessage(O.lastEditedTime),focused:!1,mode:D().C.Pill,showButtons:!0,icon:b().D,dateFilterType:"lastEditedTime",store:t})}function $(e){const{onChange:t,value:n}=e,a=(0,x().tz)(),o=(0,s().O$)(i().AppStoreSidebarSpaceStore);return o?(0,L.jsx)("div",{children:(0,L.jsx)(M().A,{mode:D().C.Pill,title:a.formatMessage(O.createdBy),parentStore:o,userIds:n??[],onChange:e=>t(e),focused:!1})}):null}function G(e){return e?{starting:e.startDate?{type:"date",start_date:e.startDate}:void 0,ending:e.endDate?{type:"date",start_date:e.endDate}:void 0}:{starting:void 0,ending:void 0}}function Y(e,t,n){if("all"===e)return null;const a=(0,N().CH)(e).icon;return"function"==typeof a?a({width:t,height:t}):(0,L.jsx)(l().Q,{iconGroup:a,variantName:"default",overrideSize:()=>t})}const Q=a.memo((function({overflowTabs:e,selectedDeepFindSource:t,setSelectedDeepFindSource:i,sourceToCountMap:s,connectorsUpsellOrManage:r,styles:l}){const c=(0,a.useRef)(null),d=((0,o().eP)(),(0,a.useCallback)((()=>{c.current&&c.current.setOpen(!1)}),[c]));return(0,L.jsx)("div",{style:l.moreTabStyle,children:(0,L.jsx)(n(250910).A,{ref:c,alignmentToOrigin:"start",placementToOrigin:"bottom",originGap:4,popupType:n(127833).nl.Popup,renderOrigin:t=>(0,L.jsx)(n(718827).Ay,{style:l.moreButton,ignoreLocalHoverState:!0,ignoreLocalPressedState:!0,...t,children:(0,L.jsx)(x().sA,{...O.more,values:{count:e.length}})}),render:()=>(0,L.jsx)(n(890492).A,{menuType:n(546926).gu.Popup,width:220,onClickOutside:d,children:(0,L.jsxs)(n(736847).A,{children:[e.map((e=>(0,L.jsx)(n(81068).A,{focused:!1,onClick:()=>{d(),i(e)},icon:"all"===e?null:Y(e,14),title:"all"===e?(0,L.jsx)(x().sA,{id:"assistantCitationHelpers.allSources",defaultMessage:"All"}):(0,N().CH)(e).name,right:void 0!==s[e]?(0,L.jsx)("span",{style:l.count,children:s[e]}):void 0,isChecked:e===t},e))),r?(0,L.jsx)(n(750127).$,{focused:!1,onClick:()=>{d(),r()}}):void 0]})})},"more")})}));function J(e){const{sources:t,selectedDeepFindSource:n,setSelectedDeepFindSource:i,step:s,isFilterBarOpen:l,setIsFilterBarOpen:d,isAnyFilterApplied:g}=e,m="dark"===(0,o().eP)(),h=(0,a.useMemo)((()=>new(B().E)({throttleMs:50})),[]),[f,S]=(0,a.useState)(0),b=(0,a.useRef)(null),j=(0,x().tz)(),M=(0,a.useMemo)((()=>new(T().k)({style:{fontSize:"14px",fontWeight:k().Wy.medium}})),[]),_=(0,a.useMemo)((()=>{const e=j.formatMessage(O.more,{count:99}),t=M.measure(e);return Math.ceil(t.width)+32}),[j,M]),P=(0,a.useMemo)((()=>{const e={};if(!s||!(0,A().l0)(s))return e;for(const n in s.results)if(V(n)){var t;e[(0,A().tC)(n)]=(null===(t=s.results[n])||void 0===t?void 0:t.length)??0}return e}),[s]),D=(0,a.useCallback)((e=>{const t="all"===e?"All":(0,N().CH)(e).name,n=P[e],a=void 0!==n?`${t} ${n}`:t,i=M.measure(a),s="all"===e?0:14;return Math.min(32+i.width+s,220)}),[P,M]),E=(0,a.useMemo)((()=>{if(!f)return t;const e=f-_,a=[];let i=0;if(n){const t=D(n);if(!(t<=e))return[n];i+=t}for(const s of t){if(s===n)continue;const t=D(s);if(!(i+t<=e))break;a.push(s),i+=t}if(n){const e=t.indexOf(n);let i=0;for(let n=0;n<a.length;n++){if(t.indexOf(a[n])>e)break;i=n+1}a.splice(i,0,n)}return a}),[f,t,D,n,_]),R=(0,a.useMemo)((()=>t.filter((e=>!E.includes(e)))),[t,E]),F=(0,a.useCallback)((e=>{e&&(h.observe(e),h.rect.addListener((e=>{S(e.state.width)})))}),[h]),z=(0,a.useCallback)((()=>{b.current&&b.current.setOpen(!1)}),[b]),W=(0,o().IS)((()=>({tabIcon:{width:14,height:14,color:I().Tj.icon.primary},count:{display:"flex",alignItems:"start",color:I().Tj.text.tertiary,fontSize:12,flexWrap:"nowrap",gap:8,width:"fit-content"},moreButton:{height:32,borderRadius:16,color:I().Tj.text.secondary,fontSize:14,fontWeight:k().Wy.medium,whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center",width:"100%",minWidth:0,paddingInlineStart:12,paddingInlineEnd:12},moreTabStyle:{display:"flex",alignItems:"center",paddingTop:2,paddingBottom:2,gap:5},selectedCount:{display:"flex",alignItems:"center",color:I().Tj.text.secondary,fontSize:12,flexWrap:"nowrap",gap:8,width:"fit-content"},tabStyle:{display:"flex",alignItems:"center",paddingInlineStart:12,paddingInlineEnd:12,paddingTop:2,paddingBottom:2,gap:5},tabsContainer:{width:"calc(100% + 20px)",marginInlineStart:-8,paddingInlineStart:0,paddingInlineEnd:0,gap:1},baseTabStyle:{paddingBottom:8,paddingTop:8},tabTitleStyle:{color:I().Tj.text.secondary,height:32,borderRadius:16,paddingInlineStart:0,paddingInlineEnd:0},selectedTabTitleStyle:{background:I().Tj.background.tertiaryTranslucent,color:I().Tj.text.primary},tabBorderStyle:{borderBottom:void 0}})),[]),{bubbleIcons:U,connectorsUpsellOrManage:H,hasExistingConnectors:K}=(0,C().b)({connector:"generic",analyticsFrom:"ai_chat_search_results_tab"}),q=(0,a.useMemo)((()=>(0,L.jsx)(p().m,{disableTooltip:!K,originGap:4,renderTooltip:()=>(0,L.jsx)(x().sA,{...w().D.connectMoreApps}),render:e=>(0,L.jsx)("div",{style:{...W.tabStyle,padding:0,display:"flex",alignItems:"center",justifyContent:"center",...K&&{height:32,width:32,borderRadius:16,marginTop:-8,marginBottom:-8,marginInlineStart:-8,marginInlineEnd:-8}},...e,children:K?(0,L.jsx)(r().I,{icon:v().plusSmallIcon,size:"xs",colorVariant:"secondary",style:{padding:"0px"}}):(0,L.jsxs)("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[U,(0,L.jsx)(x().sA,{...w().D.connectApps})]})},"add_connectors")})),[W.tabStyle,K,U]),$=(0,a.useCallback)((e=>{e<t.length?i(t[e]):void 0!==H&&(z(),H())}),[t,i,H,z]),G=(0,a.useCallback)((e=>Y(e,14)),[m,14]);return(0,L.jsx)("div",{ref:F,children:(0,L.jsx)(u().LZ,{style:W.tabsContainer,tabStyle:W.baseTabStyle,tabTitleStyle:W.tabTitleStyle,selectedTabTitleStyle:W.selectedTabTitleStyle,tabBorderStyle:W.tabBorderStyle,tabs:[...E.map((e=>{const t=e===n;return(0,L.jsxs)("div",{style:W.tabStyle,children:[G(e),"all"===e?(0,L.jsx)(x().sA,{id:"assistantCitationHelpers.allSources",defaultMessage:"All"}):(0,N().CH)(e).name,void 0!==P[e]?(0,L.jsx)("span",{style:t?W.selectedCount:W.count,children:P[e]}):void 0]},e)})),...R.length>0?[(0,L.jsx)(Q,{overflowTabs:R,selectedDeepFindSource:n,setSelectedDeepFindSource:i,sourceToCountMap:P,connectorsUpsellOrManage:H,styles:W},"more-tabs-button")]:[],...H&&t.length>0&&0===R.length?[q]:[]],selectedIndex:n&&E.includes(n)?E.indexOf(n):-1,right:(0,L.jsx)(c().p,{size:"lg",shape:"pill",iconLeading:{icon:y().filterSmallIcon,size:"xs"},colorPalette:g?"blue":void 0,onClick:()=>d(!l)}),onChange:$})})}},370964:(e,t,n)=>{n.d(t,{J:()=>d});var a=n(296540),i=()=>n(300474),s=()=>n(484714),o=()=>n(590526),r=()=>n(187174),l=()=>n(150984),c=()=>n(44971);function d(e=!0){const t=(0,a.useRef)(!1),n=(0,s().v3)(),d=(0,i().r)(),{haveFetchedChatHistory:u,isFetchingChatHistory:p}=(0,o().K8)((()=>({haveFetchedChatHistory:c().A.state.initialFetchComplete,isFetchingChatHistory:c().A.state.isFetching})),[]);(0,r().Yb)((async()=>{p||u||!e||t.current||(t.current=!0,await(0,l().loadChatHistoryForUserSpace)({environment:n,spaceId:d}))}),[n,u,d,e,p])}},371960:(e,t,n)=>{n.d(t,{Ay:()=>S,kS:()=>b});n(296540);var a=()=>n(907258),i=()=>n(590526),s=()=>n(401497),o=()=>n(265060),r=()=>n(902006),l=()=>n(203717),c=()=>n(682759),d=()=>n(822423);const u=(0,n(340498).xh)("sparkles",{default:{loader:()=>n.e(30260).then(n.bind(n,824375))},small:{loader:()=>n.e(30260).then(n.bind(n,608145))},fill:{loader:()=>n.e(30260).then(n.bind(n,173443))},fillSmall:{loader:()=>n.e(30260).then(n.bind(n,534842))}},["ai","artificial","intelligence","sparkle","technology"]);var p=()=>n(374693),g=()=>n(534177),m=()=>n(187820),h=()=>n(453697),f=()=>n(898808),y=n(474848);const v=18;function S(e){const{item:t,iconWrapStyles:n}=e,o=(0,i().O$)(a().AppStoreSidebarSpaceStore),l=(0,i().K8)((()=>{var e;return null==o||null===(e=o.getModel())||void 0===e?void 0:e.getRenderIcon()}),[o]),c=(0,i().K8)((()=>{var e;return null==o||null===(e=o.getModel())||void 0===e?void 0:e.getRenderTitle()}),[o]),d=(0,i().K8)((()=>"everything"===t.type?{type:"everything",currentUserStore:a().default.state.currentUserStore}:"workspace"===t.type?{type:"workspace"}:"notion"===t.type?{type:"notion"}:"teamspace"===t.type?{type:"teamspace",teamStore:t.teamStore}:"page"===t.type||"collection"===t.type?{type:"page",pageStore:t.pageStore,icon:t.pageStore.getIcon(),isEmptyPage:t.pageStore.isEmptyPage(),iconRecordCategory:(0,m().Te)(t.pageStore)}:"helpdocs"===t.type?{type:"helpdocs"}:"web"===t.type?{type:"web"}:"ai-knowledge"===t.type?{type:"ai-knowledge"}:"site"===t.type?{type:"workspace"}:(0,r().SC)(t.type)?{type:t.type}:(0,g().HB)(t.type)),[t]),u=(null==e?void 0:e.iconSize)??v,p=(0,s().IS)((()=>({icon:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,flexGrow:0,width:22,height:18,marginInlineEnd:4,position:"relative",...n}})),[n]);return"everything"===d.type?(0,y.jsx)("div",{style:p.icon,children:(0,y.jsx)(h().A,{size:u,userStore:d.currentUserStore})}):"workspace"===d.type||"notion"===d.type?(0,y.jsx)("div",{style:p.icon,children:(0,y.jsx)(m().B6,{icon:l,title:c,iconRecordCategory:"workspace",isEmptyPage:!1,size:u,disabled:!0})}):"teamspace"===d.type?(0,y.jsx)("div",{style:p.icon,children:(0,y.jsx)(f().x,{disabled:!0,store:d.teamStore,size:u})}):"page"===d.type?(0,y.jsx)("div",{style:p.icon,children:(0,y.jsx)(m().B6,{icon:d.icon,iconRecordCategory:d.iconRecordCategory,isEmptyPage:d.isEmptyPage,title:void 0,size:u,disabled:!0})}):(0,y.jsx)("div",{style:p.icon,children:b({iconType:d.type,iconSize:u})})}function b(e){const{iconType:t,iconSize:n}=e;let a;return(0,r().SC)(t)?a=l().G[t]:"notion"===t?a=p()._:"helpdocs"===t?a=c().s:"web"===t?a=d().u:"ai-knowledge"===t?a=u:(0,g().HB)(t),(0,y.jsx)(o().Q,{iconGroup:a,overrideSize:()=>n,variantName:"default"})}},372976:(e,t,n)=>{n.d(t,{A:()=>g});var a=()=>n(414783),i=(a(),n(296540)),s=()=>n(590526),o=()=>n(100594),r=()=>n(449412),l=()=>n(532564),c=()=>n(423213),d=()=>n(186387),u=n(474848);function p({chartOptions:e,containerHeight:t,getResponsiveChartOptions:n}){const p=(0,l().V)(),g=(0,i.useRef)(null),[m,h]=(0,i.useState)(),[f,y]=(0,i.useState)(!1),v=(0,s().K8)((()=>n?{...e,...n(m,void 0)}:e),[e,m,n]);(0,i.useEffect)((()=>{try{const e=a().chart(g.current,v);return p.setState({...p.state,chart:e,responsiveChartOptions:n?n(c().o0,o().bg.medium):{}}),()=>{p.reset(),e.destroy()}}catch(e){y(!0),(0,r().O8)(e,{from:"ResizableChart",type:"HighchartsError"})}}),[p,v,n]);const S=(0,i.useRef)(null),b=(0,i.useCallback)((e=>{if(null!==e){const t=S.current=new ResizeObserver((e=>{const t=p.state.chart;if(!t)return;const n=e[0].contentRect.width;t.setSize(n,void 0,!1),h(n)}));t.observe(e)}else if(S.current){var t;null===(t=S.current)||void 0===t||t.disconnect(),S.current=null}}),[p]);return f?(0,u.jsx)(d().A,{chartError:"highcharts_error"}):(0,u.jsx)("div",{ref:b,children:(0,u.jsx)("div",{ref:g})})}function g(e){const{loadingProps:t,containerHeight:n}=e;return t.isInitialLoading?t.initialLoadingSvg():(0,u.jsx)("div",{style:{height:n,...e.paddingInlineStart&&{paddingInlineStart:e.paddingInlineStart},...e.paddingInlineEnd&&{paddingInlineEnd:e.paddingInlineEnd},...e.paddingTop&&{paddingTop:e.paddingTop},...e.paddingBottom&&{paddingBottom:e.paddingBottom}},className:t.isThrottledLoading?"notion-shimmer-timeline notion-shimmer-timeline-transition":e.className,children:(0,u.jsx)(p,{...e})})}},375308:(e,t,n)=>{n.d(t,{v:()=>o});n(898992),n(737550);var a=()=>n(457419),i=()=>n(486674),s=()=>n(478726);function o(e){return e.blocks.some((e=>{const t=(0,i().a)();return!(!t||!(0,s().fc)(t))||!(!(0,a().S)(t)||null==t||!t.uiContains(e)||t===e)}))}},377134:(e,t,n)=>{n.d(t,{x:()=>a});const a={notion:"notion",workspace:"notion",teamspace:"notion",page:"notion",collection:"notion",helpdocs:"notion",web:"notion","ai-knowledge":"notion",everything:void 0,labeler:void 0,slackbot:void 0,"notion-none":void 0,site:void 0,"universal-workspace":void 0,"universal-none":void 0}},379018:(e,t,n)=>{n.d(t,{F:()=>m});var a=n(296540),i=()=>n(590526),s=()=>n(108181),o=()=>n(160907),r=()=>n(179034),l=()=>n(496603),c=()=>n(763824),d=()=>n(814964);const u=new(n(999752).O)(1);var p=()=>n(383070),g=n(474848);function m(){const e=(0,i().K8)((()=>p().zD.isXMLAssistantEnabled()),[]);return(0,g.jsx)(g.Fragment,{children:e?(0,g.jsx)(h,{}):null})}function h(){const e=(0,i().K8)((()=>(0,s().N)()),[]),t=(0,i().K8)((()=>(0,o().f)()),[]);return(0,a.useEffect)((()=>{t&&e&&async function(e){const{currentPageInformation:t,parentRecordStore:n}=e;await u.enqueue((async()=>{var e,a;const i=l().oE([null===(e=t.primaryEditorStore)||void 0===e?void 0:e.id,null===(a=t.backgroundEditorStore)||void 0===a?void 0:a.id]);await c().lX(i,5,(e=>d().A.loadPageAndRelatedRecords({parentRecordStore:n,pointer:{id:e,table:r().ev,spaceId:n.getSpaceId()}})))}))}({currentPageInformation:e,parentRecordStore:t}).catch((e=>{console.error(e)}))}),[e,t]),null}},379178:(e,t,n)=>{n.d(t,{N:()=>o});n(296540);var a=()=>n(69708),i=n(474848);const s=(0,a().YK)({personalizedTooltipHeading:{id:"assistantOriginElement.personalized.tooltipHeading",defaultMessage:"Hi, its {name}"},safetyHatTooltipHeading:{id:"assistantOriginElement.personalized.safetyHatTooltipHeading",defaultMessage:"All clear, {name}s on site"},mustacheTooltipHeading:{id:"assistantOriginElement.personalized.mustacheTooltipHeading",defaultMessage:"Hello there, its {name}"},headphoneTooltipHeading:{id:"assistantOriginElement.personalized.headphoneTooltipHeading",defaultMessage:"Youre tuned in to Radio {name}"},flowerTooltipHeading:{id:"assistantOriginElement.personalized.flowerTooltipHeading",defaultMessage:"{name}s in bloom today"},pencilTooltipHeading:{id:"assistantOriginElement.personalized.pencilTooltipHeading",defaultMessage:"Hi, its {name}"},paprikaTooltipHeading:{id:"assistantOriginElement.personalized.paprikaTooltipHeading",defaultMessage:"Extra hot {name}, coming right up"},duckTooltipHeading:{id:"assistantOriginElement.personalized.duckTooltipHeading",defaultMessage:"Quack! Its me, {name}"},catTooltipHeading:{id:"assistantOriginElement.personalized.catTooltipHeading",defaultMessage:"Meow {name}s here"},crownTooltipHeading:{id:"assistantOriginElement.personalized.crownTooltipHeading",defaultMessage:"All hail Queen {name}"},cowboyTooltipHeading:{id:"assistantOriginElement.personalized.cowboyTooltipHeading",defaultMessage:"Yeehaw partner, {name}s ridin in"},leafTooltipHeading:{id:"assistantOriginElement.personalized.leafTooltipHeading",defaultMessage:"Hehe! You found {name}!"},magicianTooltipHeading:{id:"assistantOriginElement.personalized.magicianTooltipHeading",defaultMessage:"Ta-da, its magically {name}"},bowTooltipHeading:{id:"assistantOriginElement.personalized.bowTooltipHeading",defaultMessage:"Hello, Im {name}"},cherryTooltipHeading:{id:"assistantOriginElement.personalized.cherryTooltipHeading",defaultMessage:"Just a little cherry on top of {name}"},propellerTooltipHeading:{id:"assistantOriginElement.personalized.propellerTooltipHeading",defaultMessage:"Up, up, and away with {name}"},accessoryWithoutNameTooltipHeading:{id:"assistantOriginElement.accessoryWithoutName.tooltipHeading",defaultMessage:"Hi, its Notion AI"},duckAccessoryWithoutNameTooltipHeading:{id:"assistantOriginElement.duckAccessoryWithoutName.tooltipHeading",defaultMessage:"Quack, its Notion AI"},catAccessoryWithoutNameTooltipHeading:{id:"assistantOriginElement.catAccessoryWithoutName.tooltipHeading",defaultMessage:"Meow, its Notion AI"},cowboyAccessoryWithoutNameTooltipHeading:{id:"assistantOriginElement.cowboyAccessoryWithoutName.tooltipHeading",defaultMessage:"Yeehaw, its Notion AI"},firefighterTooltipHeading:{id:"assistantOriginElement.personalized.firefighterTooltipHeading",defaultMessage:"On call, its {name}"},firefighterAccessoryWithoutNameTooltipHeading:{id:"assistantOriginElement.firefighterAccessoryWithoutName.tooltipHeading",defaultMessage:"On call, its Notion AI"},scarfTooltipHeading:{id:"assistantOriginElement.personalized.scarfTooltipHeading",defaultMessage:"All cozy, its {name}"},scarfAccessoryWithoutNameTooltipHeading:{id:"assistantOriginElement.scarfAccessoryWithoutName.tooltipHeading",defaultMessage:"Hi, its Notion AI"},seasonalOctober25TooltipHeading:{id:"assistantOriginElement.personalized.seasonalOctober25TooltipHeading",defaultMessage:"Boo! Its {name}"},seasonalOctober25AccessoryWithoutNameTooltipHeading:{id:"assistantOriginElement.seasonalOctober25AccessoryWithoutName.tooltipHeading",defaultMessage:"Boo!"},seasonalDecember25TooltipHeading:{id:"assistantOriginElement.personalized.seasonalDecember25TooltipHeading",defaultMessage:"Ho ho ho! Its {name}"},seasonalDecember25AccessoryWithoutNameTooltipHeading:{id:"assistantOriginElement.seasonalDecember25AccessoryWithoutName.tooltipHeading",defaultMessage:"Ho ho ho!"},seasonalJanuary26TooltipHeading:{id:"assistantOriginElement.personalized.seasonalJanuary26TooltipHeading",defaultMessage:"Happy 2026! Its {name}"},seasonalJanuary26AccessoryWithoutNameTooltipHeading:{id:"assistantOriginElement.seasonalJanuary26AccessoryWithoutName.tooltipHeading",defaultMessage:"Happy 2026!"}});function o(e,t){if(t){if(!e)return(0,i.jsx)(a().sA,{...s.personalizedTooltipHeading,values:{name:t}});switch(e){case"safety-hat":return(0,i.jsx)(a().sA,{...s.safetyHatTooltipHeading,values:{name:t}});case"mustache":return(0,i.jsx)(a().sA,{...s.mustacheTooltipHeading,values:{name:t}});case"headphone":return(0,i.jsx)(a().sA,{...s.headphoneTooltipHeading,values:{name:t}});case"flower":return(0,i.jsx)(a().sA,{...s.flowerTooltipHeading,values:{name:t}});case"pencil":return(0,i.jsx)(a().sA,{...s.pencilTooltipHeading,values:{name:t}});case"paprika":return(0,i.jsx)(a().sA,{...s.paprikaTooltipHeading,values:{name:t}});case"duck":return(0,i.jsx)(a().sA,{...s.duckTooltipHeading,values:{name:t}});case"cat":return(0,i.jsx)(a().sA,{...s.catTooltipHeading,values:{name:t}});case"crown":return(0,i.jsx)(a().sA,{...s.crownTooltipHeading,values:{name:t}});case"cowboy":return(0,i.jsx)(a().sA,{...s.cowboyTooltipHeading,values:{name:t}});case"leaf":return(0,i.jsx)(a().sA,{...s.leafTooltipHeading,values:{name:t}});case"magician":return(0,i.jsx)(a().sA,{...s.magicianTooltipHeading,values:{name:t}});case"bow":return(0,i.jsx)(a().sA,{...s.bowTooltipHeading,values:{name:t}});case"cherry":return(0,i.jsx)(a().sA,{...s.cherryTooltipHeading,values:{name:t}});case"propeller":return(0,i.jsx)(a().sA,{...s.propellerTooltipHeading,values:{name:t}});case"firefighter":return(0,i.jsx)(a().sA,{...s.firefighterTooltipHeading,values:{name:t}});case"scarf":return(0,i.jsx)(a().sA,{...s.scarfTooltipHeading,values:{name:t}});case"seasonal-bat":case"seasonal-demon":case"seasonal-frankenstein":case"seasonal-pumpkin":return(0,i.jsx)(a().sA,{...s.seasonalOctober25TooltipHeading,values:{name:t}});case"seasonal-santa-hat":return(0,i.jsx)(a().sA,{...s.seasonalDecember25TooltipHeading,values:{name:t}});case"seasonal-new-year":return(0,i.jsx)(a().sA,{...s.seasonalJanuary26TooltipHeading,values:{name:t}});default:return(0,i.jsx)(a().sA,{...s.personalizedTooltipHeading,values:{name:t}})}}if(e)switch(e){case"duck":return(0,i.jsx)(a().sA,{...s.duckAccessoryWithoutNameTooltipHeading});case"cat":return(0,i.jsx)(a().sA,{...s.catAccessoryWithoutNameTooltipHeading});case"cowboy":return(0,i.jsx)(a().sA,{...s.cowboyAccessoryWithoutNameTooltipHeading});case"firefighter":return(0,i.jsx)(a().sA,{...s.firefighterAccessoryWithoutNameTooltipHeading});case"scarf":return(0,i.jsx)(a().sA,{...s.scarfAccessoryWithoutNameTooltipHeading});case"seasonal-bat":case"seasonal-demon":case"seasonal-frankenstein":case"seasonal-pumpkin":return(0,i.jsx)(a().sA,{...s.seasonalOctober25AccessoryWithoutNameTooltipHeading});case"seasonal-santa-hat":return(0,i.jsx)(a().sA,{...s.seasonalDecember25AccessoryWithoutNameTooltipHeading});case"seasonal-new-year":return(0,i.jsx)(a().sA,{...s.seasonalJanuary26AccessoryWithoutNameTooltipHeading});default:return(0,i.jsx)(a().sA,{...s.accessoryWithoutNameTooltipHeading})}return null}},381571:(e,t,n)=>{n.d(t,{B:()=>o});var a=()=>n(59226),i=()=>n(401497),s=()=>n(100622);function o(e){const t=(0,a().X)("more_rounded_block_container");return(0,i().IS)((()=>({wrapper:{background:s().Tj.background.secondary,borderRadius:t?10:5,padding:"8px 12px",userSelect:"none",pointerEvents:"auto",width:"100%"}})),[t])}},383706:(e,t,n)=>{n.d(t,{_:()=>o});var a=()=>n(907258),i=()=>n(466088),s=()=>n(578872);function o(e){let t;const n=a().default.state.mainEditorCurrentBlockStore;if(e.currentUser.id)t=e.currentUser.id;else if(n&&(0,i().w)(e)){var o;const e=(0,s().GN)(n),a=null==e||null===(o=e.getSiteStore())||void 0===o?void 0:o.getSettings();null!=a&&a.enableQna&&(t=a.siteUserId)}return t}},383894:(e,t,n)=>{n.d(t,{N:()=>d});n(296540);var a=()=>n(401497),i=()=>n(829098),s=()=>n(807449),o=()=>n(100622),r=()=>n(827368),l=()=>n(781317),c=n(474848);function d({icon:e,title:t,colorVariant:n="secondary",variant:d="default",hideIcon:u=!1}){const{bodyStyleKey:p}=(0,r().yq)(),g=(0,r().Cd)(p),m=(0,a().IS)((()=>({container:{display:"flex",alignItems:"center",gap:u?4:8},icon:{display:"flex",alignItems:"center",justifyContent:"center",height:l().SCROLLING_SQUIGGLE_DEFAULTS.height,width:l().SCROLLING_SQUIGGLE_DEFAULTS.width,flexShrink:0},title:{overflow:"hidden",minWidth:0,flex:1,color:o().Tj.text[n],...i().U.bodyRegular,...g},iconHidden:{display:"none"}})),[n,u,g]);return(0,c.jsxs)("div",{style:m.container,children:[(0,c.jsx)("div",{style:u?m.iconHidden:m.icon,children:u?null:"function"==typeof e?(0,c.jsx)(s().I,{icon:e,size:"large"===d?"default":"sm",colorVariant:n}):e}),(0,c.jsx)("div",{style:m.title,children:t})]})}},388066:(e,t,n)=>{n.d(t,{A7:()=>f,Jh:()=>x,hr:()=>S,kb:()=>y,zR:()=>b});n(16280);var a=()=>n(675133),i=()=>n(302996),s=()=>n(463086),o=()=>n(68169),r=()=>n(17217),l=()=>n(522419),c=()=>n(72135),d=()=>n(96689),u=()=>n(234459),p=()=>n(201980),g=()=>n(319625),m=()=>n(429145),h=()=>n(166442);function f(e,t){return v({pointer:e,environment:t},(e=>{var t;return"attachment"===e.type&&"application/pdf"===e.contentType&&null!==(t=e.metadata)&&void 0!==t&&t.numPages?e.metadata.numPages:0}))}function y(e,t){return v({pointer:e,environment:t},(e=>(0,o().tT)(e.contentType)?1:0))}function v(e,t){const{pointer:n,environment:a}=e;let o=0;if(n.table===u().To){const e=new(i().SpaceStore)(a,{table:d().NX,id:n.spaceId}),l={...n,table:u().To},c=s().E.createChildStore(e,l).getTranscript();for(const n of c)"attachment"===n.type&&(o+=t(n));const p=h().defaultClientAIChatStore.getExistingClientAIChatThreadStore(n.id);if(p){var r;const e=null===(r=p.state.stagedData)||void 0===r?void 0:r.attachmentStagedData;if(e)for(const n of e.stagedInferenceTranscriptSteps)"attachment"===n.type&&(o+=t(n))}}return o}function S(e){const t=e.size.trim().toUpperCase().match(/^([\d.]+)\s*([KMGTPEZY]?I?B)?$/);if(!t)return;const[,n,a="B"]=t,i=parseFloat(n);if(isNaN(i))return;return i*({B:1,KB:1024,MB:1048576,GB:1073741824,TB:1099511627776,PB:1024**5,EB:1024**6,ZB:1024**7,YB:1024**8,KIB:1024,MIB:1048576,GIB:1073741824,TIB:1099511627776,PIB:1024**5,EIB:1024**6,ZIB:1024**7,YIB:1024**8}[a]||1)}function b(e,t,n){const i=(0,g().A)(n??new Error(t));switch(e){case"MODERATION_FAILED":return{message:a().A.formatMessage(m().c7.moderationFlagged),error:i,code:e};case"CSV_TOO_MANY_ROWS_AND_COLUMNS":return{message:a().A.formatMessage(m().c7.csvTooManyRowsAndColumns,{maxRowCount:r().ks,maxColCount:r().qV}),error:i,code:e};case"CSV_TOO_LARGE":return{message:a().A.formatMessage(m().c7.csvTooLarge,{maxSize:(0,c().z3)(r().gB,{base:10,decimals:0})}),error:i,code:e};case"PDF_TOO_MANY_PAGES":return{message:a().A.formatMessage(m().c7.pdfTooManyPages,{maxPageCount:r().gD}),error:i,code:e};case"FILE_SIZE_EXCEEDS_MAX_SIZE":return{message:a().A.formatMessage(m().c7.assistantFileTooLarge),error:i,code:e};case"PASSWORD_PROTECTED":return{message:a().A.formatMessage(m().c7.passwordProtected),error:i,code:e};case"CORRUPTED_FILE":case"FILE_SIZE_IS_0":return{message:a().A.formatMessage(m().c7.corruptedFile),error:i,code:e};case"UNSUPPORTED_CONTENT_TYPE":return{message:a().A.formatMessage(m().c7.invalidFileType),error:i,code:e};default:return{message:a().A.formatMessage(m().c7.uploadError),error:i,code:e}}}function x(e){const t=e.getProperties();if((e.isType("file")||e.isType("image")||e.isType("pdf"))&&t){const n=(0,p().k4p)(t.title),a=(0,p().k4p)(t.size),i=(0,p().q4_)(t.source);if(!i)return;const s=(0,l().QC)(i);if(!s)return;const o=(0,r().F0)(s);if(o.error)return;const{mimeType:c}=o.value;return{fileName:(0,l().SB)({title:n,source:i}),source:i,contentType:c,originalBlockStore:e,size:a}}}},388521:(e,t,n)=>{n.d(t,{Z:()=>k});var a=n(296540),i=()=>n(590526),s=()=>n(401497),o=()=>n(718827),r=()=>n(807449),l=()=>n(546926),c=()=>n(81068),d=()=>n(597777),u=()=>n(803960),p=()=>n(42583),g=()=>n(69708),m=()=>n(100622),h=()=>n(534177),f=()=>n(284371),y=()=>n(30731),v=()=>n(933117),S=()=>n(817865),b=()=>n(220818),x=()=>n(322976),I=n(474848);function k({lastEditedTime:e,createdTime:t,setLastEditedTime:n,setCreatedOnTime:s}){const o=(0,g().tz)(),[r,l]=(0,a.useState)("createdTime"),c=(0,a.useMemo)((()=>{switch(r){case"createdTime":return t;case"lastEditedTime":return e;default:(0,h().HB)(r)}}),[e,t,r]),u=(0,a.useMemo)((()=>{switch(r){case"createdTime":return s;case"lastEditedTime":return n;default:(0,h().HB)(r)}}),[n,s,r]);const m=(0,i().K8)((()=>{if((0,y().jO)(c))switch(r){case"createdTime":return(0,I.jsx)(g().sA,{id:"adminContentSearchTab.pagesTable.filters.createdOn.title",defaultMessage:"Created on"});case"lastEditedTime":return(0,I.jsx)(g().sA,{id:"adminContentSearchTab.pagesTable.filters.lastEditedOn.title",defaultMessage:"Last edited on"});default:(0,h().HB)(r)}const e=(0,y().ES)(c),t=(0,b().t)(e,o,d().vz);switch(r){case"createdTime":return(0,I.jsx)(g().sA,{id:"adminContentSearchTab.pagesTable.filters.createdOn.titleWithDateRange",defaultMessage:"<b>Created on</b>: {dateRangeString}",values:{dateRangeString:t,b:e=>(0,I.jsx)("span",{style:{fontWeight:f().Wy.medium},children:e})}});case"lastEditedTime":return(0,I.jsx)(g().sA,{id:"adminContentSearchTab.pagesTable.filters.lastEditedOn.titleWithDateRange",defaultMessage:"<b>Last edited on</b>: {dateRangeString}",values:{dateRangeString:t,b:e=>(0,I.jsx)("span",{style:{fontWeight:f().Wy.medium},children:e})}});default:(0,h().HB)(r)}}),[c,r,o]);return(0,I.jsx)(S().A,{header:(0,I.jsx)(w,{selectedItem:r,setSelectedItem:function(e){l(e)}}),mode:x().C.Pill,focused:!1,hideTime:!0,pillTitle:m,title:m,icon:p().D,value:c,showButtons:"footer",onChange:e=>{u(e)}})}function w({selectedItem:e,setSelectedItem:t}){const n=(0,s().IS)((()=>({button:{margin:"14px 12px 4px",padding:"2px 8px",width:"fit-content",borderRadius:4},text:{display:"flex",alignItems:"center",color:m().Tj.text.secondary,fill:m().Tj.icon.tertiary,fontWeight:500,fontSize:13},icon:{marginInlineStart:4}})),[]),a={width:190,items:["createdTime","lastEditedTime"],selectedItem:e,getKey:e=>e,onSelect:e=>t(e),renderItem:e=>(0,I.jsx)(c().A,{title:C(e.value),...e}),renderOrigin:t=>(0,I.jsx)(o().Ay,{...t,style:n.button,children:(0,I.jsxs)("div",{style:n.text,children:[C(e),(0,I.jsx)(r().I,{icon:u().arrowChevronSingleDownIcon,size:"xs",style:n.icon})]})})};return(0,I.jsx)(v().A,{...a,menuTypeOverride:(0,l().PK)()})}function C(e){return{lastEditedTime:(0,I.jsx)(g().sA,{id:"adminContentSearchTab.pagesTable.filters.lastEditedOn.option",defaultMessage:"Last edited on"}),createdTime:(0,I.jsx)(g().sA,{id:"adminContentSearchTab.pagesTable.filters.createdOn.option",defaultMessage:"Created on"})}[e]}},390109:(e,t,n)=>{n.d(t,{Cp:()=>v,Qr:()=>p,ZQ:()=>m,qX:()=>h});var a=n(296540),i=()=>n(726637),s=()=>n(401497),o=()=>n(26697),r=()=>n(69708),l=()=>n(100622),c=()=>n(284371),d=()=>n(912771),u=n(474848);const p="min(calc(100% - 48px), 512px)",g="100%",m=8,h=(0,a.forwardRef)(((e,t)=>{const{children:s,clientStep:r,disabled:l}=e,[c,d]=(0,a.useState)(!1),[p,g]=(0,a.useState)(!1),m=(0,a.useMemo)((()=>(0,n(496603).sg)(g,100)),[g]),h=(0,a.useMemo)((()=>"assistantChat"===(null==r?void 0:r.type)?"assistant":"human"===(null==r?void 0:r.type)||"humanAction"===(null==r?void 0:r.type)||"clientAssistantHumanAttachmentUpload"===(null==r?void 0:r.type)?"human":"assistantScopeChange"===(null==r?void 0:r.type)?"context":"assistantLoading"===(null==r?void 0:r.type)||"assistantShowSearchResults"===(null==r?void 0:r.type)?"loading":void 0),[null==r?void 0:r.type]),f=v({hovered:c,isAssistantChat:"assistant"===h||void 0===h});return(0,u.jsx)(o().m,{placement:"left",textWrap:!0,style:{maxWidth:240},disableTooltip:!r||!("thought"in r&&r.thought)||!0,renderTooltip:()=>r&&"thought"in r?` ${r.thought}`:void 0,delayThreshold:500,render:e=>(0,u.jsxs)("div",{ref:t,style:f.wrap,...i().A.isMobile?{tabIndex:0}:{},...e,onFocus:t=>{var a;null===(a=e.onFocus)||void 0===a||a.call(e,t),(0,n(819121).p)(t.target)&&(d(!0),m(!0))},onMouseEnter:t=>{var n;null===(n=e.onMouseEnter)||void 0===n||n.call(e,t),i().A.isMobile||(d(!0),m(!0))},onBlur:t=>{var n;null===(n=e.onBlur)||void 0===n||n.call(e,t),d(!1),m(!1)},onMouseLeave:t=>{var n;null===(n=e.onMouseLeave)||void 0===n||n.call(e,t),i().A.isMobile||(d(!1),m(!1))},onClick:e=>{i().A.isMobile&&(d(!c),m(!c))},children:["human"===h?(0,u.jsx)("div",{style:{flexGrow:1}}):void 0,(0,u.jsxs)("div",{style:{...f.baseMessage,..."human"===h?f.humanMessage:{},..."loading"===h?f.assistantLoadingMessage:{},..."context"===h?f.contextMessage:{},..."assistant"===h||void 0===h?f.assistantMessage:{}},children:[s,"assistantChat"===(null==r?void 0:r.type)||"assistantTransaction"===(null==r?void 0:r.type)?(0,u.jsx)(y,{clientStep:r,isVisible:c&&p,disabled:l}):void 0]})]})})})),f=(0,r().YK)({copyButton:{id:"assistant.chat.actions.copyButton.label",defaultMessage:"Copy"}});function y(e){const t=(0,r().tz)(),{clientStep:a,isVisible:i,disabled:c}=e,d=(0,n(484714).v3)(),p=(0,s().IS)((()=>({container:{display:"flex",boxShadow:l().Tj.shadowSM,position:"absolute",flexShrink:0,backgroundColor:l().Tj.buttonGroupBackground,maxHeight:28,top:-16,insetInlineEnd:6,gap:1,borderRadius:6,padding:2,transition:"opacity 100ms ease-out, visibility 100ms ease-out",zIndex:1e5,opacity:i?1:0,visibility:i?"visible":"hidden"}})),[i]);return c?null:(0,u.jsxs)("div",{style:p.container,children:[(0,u.jsx)(n(339780).d4,{isVisible:!0,clientStep:a,showTooltips:!0}),"assistantChat"===a.type?(0,u.jsx)(o().m,{renderTooltip:()=>(0,u.jsx)(r().sA,{...f.copyButton}),render:e=>(0,u.jsx)(n(695115).A,{ariaLabel:t.formatMessage({id:"assistant.chat.actions.copyButton.label",defaultMessage:"Copy"}),icon:n(951105).k,onClick:()=>{(0,n(600881).wj)({environment:d,clientStep:a})},...e})}):void 0]})}function v(e){const{hovered:t,isAssistantChat:n}=e,a=(0,d().q)(),i=(0,s().eP)();return(0,s().IS)((()=>({wrap:{display:"flex",marginTop:m,marginBottom:m,gap:6},baseMessage:{maxWidth:g,borderRadius:16,padding:"4px 12px",fontSize:a.chatBodyTextSize,whiteSpace:"pre-wrap",overflowWrap:"break-word",position:"relative",lineHeight:a.chatLineHeight},userLabel:{fontSize:a.smallTextSize,color:l().Tj.text.secondary},humanMessage:{backgroundColor:"light"===i?l().Tj.cardHoveredBackground:l().Tj.palette.translucentGray[100],color:l().Tj.text.primary,padding:"6px 14px",border:"unset",marginInlineStart:80},assistantLoadingMessage:{fontSize:a.smallTextSize,color:l().Tj.text.secondary,fontWeight:500,paddingTop:4,paddingInlineEnd:0,paddingBottom:0,paddingInlineStart:4,width:"100%"},assistantMessage:{fontSize:a.chatBodyTextSize,fontWeight:c().Wy.regular,lineHeight:a.chatLineHeight,backgroundColor:t&&n?"light"===i?l().Tj.gray.background.tertiaryTranslucent:l().Tj.gray.background.secondaryTranslucent:void 0,padding:"8px 12px",maxWidth:"calc(100% + 8px)",minWidth:"80px",marginInlineStart:-8,transition:"background-color 150ms"},contextMessage:{flexGrow:1}})),[a,t,n,i])}h.displayName="AssistantChatStepWrapper"},391657:(e,t,n)=>{n.d(t,{g:()=>g,t:()=>u});n(581454);var a=n(296540),i=()=>n(484714),s=()=>n(264300),o=()=>n(690495),r=()=>n(300789),l=()=>n(51367),c=()=>n(832895),d=n(474848);function u(e){const{messageKey:t,onDismiss:n}=e;return p({message:(0,a.useMemo)((()=>t?{key:t,type:"static",props:{},id:"",category:o().lU[t].category}:void 0),[t]),onDismiss:n})}function p(e){const t=null==e?void 0:e.message,n=null==e?void 0:e.onDismiss,o=(0,i().v3)();(0,a.useEffect)((()=>{t&&l().DL(o,{callout_key:t.key,placement_key:(0,s().Q3)(t)})}),[o,t]);return{onClick:(0,a.useCallback)((e=>{t&&l().Y5(o,{callout_key:t.key,placement_key:(0,s().Q3)(t),click_type:"primary_cta"}),e&&e()}),[o,t]),onDismiss:(0,a.useCallback)((()=>{t&&(l().Sq(o,{callout_key:t.key,placement_key:(0,s().Q3)(t),dismiss_type:"sidebar_dismiss"}),r().OX(o,t)),n&&n()}),[o,t,n])}}function g(e){const{onClick:t,buttons:n,...a}=e,{onClick:i,onDismiss:s}=p(e),o=null==n?void 0:n.map((e=>({...e,onClick:()=>{i(e.onClick)}})));return(0,d.jsx)(c().Ue,{children:(0,d.jsx)(c().wY,{...a,...o?{buttons:o}:{onClick:t?()=>{i(t)}:void 0},onDismiss:s})})}},391930:(e,t,n)=>{n.d(t,{H:()=>i,_:()=>s});var a=()=>n(969318);function i(e){return e?0:15}function s(e){return e?{height:"100%",position:"absolute",top:0,bottom:0,padding:10}:{height:a().iZ,position:"relative",top:-i(!1)}}},398304:(e,t,n)=>{n.d(t,{Q:()=>a});const a=n(757695).Store.createValue({open:!1},{name:"UpgradeRequestFormModalStore"})},399613:(e,t,n)=>{n.d(t,{t:()=>o});var a=()=>n(564884),i=()=>n(634877),s=()=>n(716500);async function o(e){const{environment:t,spaceId:n,onAuthSuccess:o,analyticsProperties:r,connector:l}=e,{buttonName:c}=r,d=i().NT[l].state;(0,a().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:c,integration_type:l,setup_session_id:d.sessionId,from:r.analyticsFrom??d.analyticsFrom}}});const u=(0,s().K)(l);await u.authenticate({environment:t,spaceId:n,onAuthSuccess:o})}},401306:(e,t,n)=>{n.d(t,{n:()=>i});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.25 15.25",svg:(0,n(474848).jsx)("path",{d:"M10 2.375a7.625 7.625 0 1 1 0 15.25 7.625 7.625 0 0 1 0-15.25M8.25 7.25a1 1 0 0 0-1 1v3.5a1 1 0 0 0 1 1h3.5a1 1 0 0 0 1-1v-3.5a1 1 0 0 0-1-1z"})},i=(0,n(340498).wt)("stopCircleFill",a,"fill")},401535:(e,t,n)=>{n.d(t,{DZ:()=>E,EC:()=>R,lL:()=>V});var a=n(296540),i=()=>n(300474),s=()=>n(59226),o=()=>n(484714),r=()=>n(590526),l=()=>n(401497),c=()=>n(160432),d=()=>n(493552),u=()=>n(373009),p=()=>n(404931),g=()=>n(132855),m=()=>n(71805),h=()=>n(69708),f=()=>n(534177),y=()=>n(843014),v=()=>n(661077),S=()=>n(330966),b=()=>n(860921),x=()=>n(85207),I=()=>n(807778),k=()=>n(528093),w=()=>n(270812),C=()=>n(668721),A=()=>n(704658),T=()=>n(383070),j=()=>n(483730),M=()=>n(412669),_=()=>n(274894),P=()=>n(533927),D=n(474848);const E=(0,h().YK)({requestAccessButton:{id:"AssistantLimitReached.requestAccess.button",defaultMessage:"Request access"},requestAccessMessageV2:{id:"AssistantLimitReached.requestAccess.messageV2",defaultMessage:"Youve run out of free AI responses. Request to upgrade <bold>Notion AI</bold> from your workspace owner."},requestAccessNoFreeCreditsMessage:{id:"AssistantLimitReached.requestAccessNoFreeCredits.message",defaultMessage:"Request the <bold>Notion AI add-on</bold> from your workspace owner."},requestAccessNoFreeCreditsMessageV2:{id:"AssistantLimitReached.requestAccessNoFreeCredits.messageV2",defaultMessage:"Request to upgrade <bold>Notion AI</bold> from your workspace owner."},requestAccessReceived:{id:"AssistantLimitReached.requestAccess.received",defaultMessage:"Youve run out of free AI responses. Weve sent your request to the workspace owner for the Notion AI add-on."},requestAccessReceivedV2:{id:"AssistantLimitReached.requestAccess.receivedV2",defaultMessage:"Youve run out of free AI responses. Weve sent your request to the workspace owner to upgrade Notion AI."},requestAccessReceivedNoFreeCredits:{id:"AssistantLimitReached.requestAccessNoFreeCredits.received",defaultMessage:"Weve sent your request to the workspace owner for the Notion AI add-on."},requestAccessReceivedNoFreeCreditsV2:{id:"AssistantLimitReached.requestAccessNoFreeCredits.receivedV2",defaultMessage:"Weve sent your request to the workspace owner to upgrade Notion AI."},unavailableMessage:{id:"AssistantLimitReached.unavailable.message",defaultMessage:"Reach out to your account representative to purchase the Notion AI add-on."},unavailableMessageV2:{id:"AssistantLimitReached.unavailable.messageV2",defaultMessage:"Reach out to your account representative to upgrade Notion AI."},upsellMessage:{id:"AssistantLimitReached.upsell.message",defaultMessage:"Youve run out of free AI responses. Get the <bold>Notion AI add-on</bold> so that I can answer more questions for you."},upsellMessageV2:{id:"AssistantLimitReached.upsell.messageV2",defaultMessage:"Youve run out of free AI responses. Upgrade <bold>Notion AI</bold> so that I can answer more questions for you."},upgradeRequestReceived:{id:"AssistantLimitReached.upgradeRequest.received",defaultMessage:"Weve sent your request to the workspace owner for the Notion AI add-on."},upgradeRequestReceivedV2:{id:"AssistantLimitReached.upgradeRequest.receivedV2",defaultMessage:"Weve sent your request to the workspace owner to upgrade Notion AI."},upgradeRequestButton:{id:"AssistantLimitReached.upgradeRequest.button",defaultMessage:"Request Notion AI"},contactSalesButton:{id:"AssistantLimitReached.contactSales.button",defaultMessage:"Contact sales"}});function R(e){const{sessionId:t,requestedSkill:n}=e;return(0,r().K8)((()=>V(t,n)),[t,n])?(0,D.jsx)(B,{...e}):null}function B(e){const t=(0,b().z)(),n=(0,o().v3)(),a=(0,i().r)(),l=(0,s().X)("upgrade_system_ai"),c=(0,k()._)({name:"ai_usage",spaceId:a,userId:n.currentUser.id,amount:"unknown"}),d=(0,r().K8)((()=>T().zD.isXMLAssistantEnabled()),[])?"ai_assistant_limit_in_app":"ai_qna_limit_in_app",u=(0,S().o)({source:d,featureAvailability:c,type:"text",size:"default"});return l?u?(0,D.jsx)(A().UpgradeButton,{...u}):null:"unavailable"===t?(0,D.jsx)(O,{...e}):"requestAccess"===t?(0,D.jsx)(F,{...e}):"requestAccessNoFreeCredits"===t?(0,D.jsx)(F,{...e,noFreeCredits:!0}):"upsell"===t?(0,D.jsx)(L,{...e}):void(0,f().HB)(t)}function F(e){const{displayAsChatStep:t,chatStepProps:n,noFreeCredits:i}=e,s=(0,o().v3)(),l=(0,r().K8)((()=>C().o.didRequest()),[]),d=(0,h().tz)(),u=z(t),p=(0,r().K8)((()=>T().zD.isXMLAssistantEnabled()),[]),g=(0,r().K8)((()=>(0,I().up)()),[]),f=(0,a.useCallback)((()=>{(0,x().RV)({upsellType:"requestAccess",environment:s,isAssistantEnabled:p,aiUpsell:void 0})}),[s,p]);if(g&&!i)return(0,D.jsx)(N,{...e});const y=function(e,t){return e.formatMessage(t?E.requestAccessReceivedNoFreeCreditsV2:E.requestAccessReceivedV2)}(d,i);if(l)return(0,D.jsx)("div",{style:u.wrapper,children:t?(0,D.jsx)(P().x7,{...n,latestStepCitationHoverStore:void 0,clientStep:{type:"assistantLimitReached",message:y,inferenceId:"hard-coded"}}):y});const v=function(e,t,n){return e.formatMessage(t?E.requestAccessNoFreeCreditsMessageV2:E.requestAccessMessageV2,{bold:e=>(0,D.jsx)(_().f,{onClick:n,children:e})})}(d,i,f);return(0,D.jsxs)("div",{style:u.wrapper,children:[t?(0,D.jsx)(P().x7,{...n,latestStepCitationHoverStore:void 0,clientStep:{type:"assistantLimitReached",message:v,inferenceId:"hard-coded"}}):v,t?(0,D.jsx)(c().A,{colorPalette:"blue",style:u.button,onClick:f,iconLeading:{icon:m().arrowInCircleUpSmallIcon,size:"sm"},children:d.formatMessage(E.requestAccessButton)}):void 0]})}function N(e){const{displayAsChatStep:t,chatStepProps:n}=e,s=(0,o().v3)(),r=(0,i().r)(),l=(0,k()._)({name:"ai_usage",spaceId:r,userId:s.currentUser.id,amount:"unknown"}),{userHasPendingRequest:c,canUserRequestUpgrade:p,openModal:m}=(0,w().E)({type:"feature",featureAvailability:l,entrypoint:"ai_corner_chat",analyticsEntrypoint:"ai_corner_chat",isOptimisticUpsell:!1}),f=(0,h().tz)(),y=z(t),v=(0,a.useCallback)((()=>{m()}),[m]);if(c)return(0,D.jsx)("div",{style:y.wrapper,children:t?(0,D.jsx)(P().x7,{...n,latestStepCitationHoverStore:void 0,clientStep:{type:"assistantLimitReached",message:f.formatMessage(E.upgradeRequestReceivedV2),inferenceId:"hard-coded"}}):f.formatMessage(E.upgradeRequestReceivedV2)});if(!p)return null;const S=f.formatMessage(E.requestAccessMessageV2,{bold:e=>(0,D.jsx)(_().f,{onClick:v,children:e})});return(0,D.jsxs)("div",{style:y.wrapper,children:[t?(0,D.jsx)(P().x7,{...n,latestStepCitationHoverStore:void 0,clientStep:{type:"assistantLimitReached",message:S,inferenceId:"hard-coded"}}):S,t?(0,D.jsx)(u().E,{iconLeading:{icon:g().arrowInCircleUpFillIcon,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"},onClick:v,style:y.button,children:(0,D.jsx)(d().D,{styleKey:"bodyMedium",children:f.formatMessage(E.upgradeRequestButton)})}):void 0]})}function L(e){const{displayAsChatStep:t,chatStepProps:n}=e,s=(0,o().v3)(),l=(0,i().r)(),d=z(t),u=(0,h().tz)(),p=(0,r().K8)((()=>T().zD.isXMLAssistantEnabled()),[]),g=(0,k()._)({name:"ai_usage",spaceId:l,userId:s.currentUser.id,amount:"unknown"}),f=(0,a.useCallback)((()=>{(0,x().RV)({environment:s,upsellType:"upsell",isAssistantEnabled:p,aiUpsell:null==g?void 0:g.upsell})}),[s,p,null==g?void 0:g.upsell]),v=u.formatMessage(E.upsellMessageV2,{bold:e=>(0,D.jsx)(_().f,{onClick:f,children:e})});return(0,D.jsxs)("div",{style:d.wrapper,children:[t?(0,D.jsx)(P().x7,{...n,latestStepCitationHoverStore:void 0,clientStep:{type:"assistantLimitReached",message:v,inferenceId:"hard-coded"}}):v,t?(0,D.jsx)(c().A,{colorPalette:"blue",style:d.button,onClick:f,iconLeading:{icon:m().arrowInCircleUpSmallIcon,size:"sm"},children:u.formatMessage(y().D.getNotionAI)}):void 0]})}function O(e){const{displayAsChatStep:t,chatStepProps:n}=e,s=z(t),l=(0,h().tz)(),c=(0,o().v3)(),p=(0,i().r)(),m=(0,r().K8)((()=>T().zD.isXMLAssistantEnabled()),[]),f=(0,k()._)({name:"ai_usage",spaceId:p,userId:c.currentUser.id,amount:"unknown"}),y=(0,a.useCallback)((()=>{(0,x().RV)({environment:c,upsellType:"upsell",isAssistantEnabled:m,aiUpsell:null==f?void 0:f.upsell})}),[c,m,null==f?void 0:f.upsell]),v=l.formatMessage(E.unavailableMessageV2);return(0,D.jsxs)("div",{style:s.wrapper,children:[t?(0,D.jsx)(P().x7,{...n,latestStepCitationHoverStore:void 0,clientStep:{type:"assistantLimitReached",message:v,inferenceId:"hard-coded"}}):v,t?(0,D.jsx)(u().E,{iconLeading:{icon:g().arrowInCircleUpFillIcon,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"},onClick:y,style:s.button,children:(0,D.jsx)(d().D,{styleKey:"bodyMedium",children:l.formatMessage(E.contactSalesButton)})}):void 0]})}function V(e,t){var n,a;if(!e)return!1;if(t){if((0,p().dc)(t.skillType).requiresInput)return!1}const i=null===(n=j().default.getSessionContext(e))||void 0===n?void 0:n.assistantConfigurationStoreState,s=Boolean((null==i?void 0:i.sampling)||(null==i?void 0:i.evaluating)),o=null===(a=j().default.getSessionContext(e))||void 0===a?void 0:a.getPreviewingStepErrorObservations(),r=o&&o.length>0;return Boolean(!s&&(M().K.state||r))&&!v().P.state}function z(e){return(0,l().IS)((()=>({button:{alignSelf:"flex-start",borderRadius:100,display:"flex",marginTop:6,marginBottom:6,padding:"7px 12px"},wrapper:e?{marginTop:4,display:"flex",flexDirection:"column"}:{fontSize:14,padding:8},blurryUpsell:{marginTop:6,marginBottom:6}})),[e])}},404931:(e,t,n)=>{n.d(t,{yj:()=>h,dc:()=>f,$u:()=>p});n(16280),n(898992),n(737550);var a=()=>n(201980);const i={type:"custom",version:1,getInstructions:e=>{var t;const n=null===(t=e.parameterValues)||void 0===t?void 0:t.instructions;return n?n.some((e=>(0,a().qXl)(e)))?n:(0,a().q4_)(n):""},requiresInput:!1};n(944114),n(354520);var s=()=>n(534177);function o(e){const{outputType:t}=e;return`\n\tHelp the user draft a ${t}. You should use the same language as the user unless the user says otherwise.  \n\t`}function r(e){return[[e.join("\n")]]}function l(e){let{mode:t,style:n}=e;const{selection:i,pageOrTopic:o}=e;t||(t="chat"),n||(n="prose");const l=o?Array.isArray(o)?[['"'],...o,['"']]:[a().wmz(a().ld4(o.id,o.spaceId))]:u(i)?[["the selected text"]]:[["the current page"]];if(!l)throw new Error("Expected summary target");const c="chat"===t?[...a().x9d("Respond with a short summary of "),...l,...a().x9d(" using chat.\n")].filter(s().O9):"insert"===t?[...a().x9d("Add a short summary of "),...l,...a().x9d(` ${i?"directly after the user's selection.":"to an appropriate location"} in the current page.\n`),,].filter(s().O9):(0,s().HB)(t),d=[...a().x9d("- Output in the same language as "),...l,...a().x9d(".\n")],p=[...a().x9d("Respond with a short summary of "),...l,...a().x9d(".")];return[...c,...r(["Content guidelines:","- Capture just the key conclusions and takeaways.",'- Never introduce the document with phrases like "This document..."; instead, simply restate the document\'s content concisely.',"- Use clear, concise language. Avoid verbosity and repetition.","prose"===n?"- Make your summary flow naturally using smooth transitions and easy-to-read language. It should read like a human wrote it.":"","Formatting guidelines:\n"]),...d,...r(["- "+("prose"===n?"Output no more than one paragraph.":"Output no more than 8 bullet points."),"- Do not link to the page.\n"]),...p]}function c(e){return`Your goal is try to find and extract action items by reading all the text in the current page.\n\n\tRules for finding action items:\n\tOnly include action items that explicitly reference a specific task or action to be taken in the future.\n\tDo not include action items that are implied but not directly stated.\n\tDo not include action items that are already completed.\n\tUnanswered questions that are explicitly stated should be considered action items.\n\n\tHow to format action items:\n\tUse <todo> blocks.\n\tThe title of the action item should be rephrased to be a single clear, concise statement of the task to be done. You do not need a period at the end of the title.\n\tIf the action item has a clear due date, include it at the end of the todo block using a <mention-date> tag.\n\tIf the action item has one or more people responsible and this person is unambiguously present in the context via ID, include them at the end of the todo block using a <mention-person> tag.\n\tMentions should have a single whitespace between them and other text or mentions. Make sure to place a space between the title and the mention, and between each mention.\n\tAction items should be in the same order as they appear in the text.\n\tUse the same language as the page.\n\t${"chat"===e.mode?"Make sure to include a citation to the specific block that the action item was found in.":"Do not include any citations or links"}\n\t\n\tStep-by-step instructions:\n\tIf you found action items:\n\t${"chat"===e.mode?"Use <chat> to list all action items in a message.":"create"===e.mode?"Use <create> to output a page containing all action items.":"insert"===e.mode?"Use <insert> to insert action item todo blocks in the page.":(0,s().HB)(e.mode)}\n\tIf you did not find any action items, say so concisely and enclose your response in appropriate XML tags.`}function d(e){const{mode:t,selection:n}=e,a=u(n);return`Revise ${a?"the user's selected text":"the entire page"} to be ${t}, while still preserving the key ideas.\n\n\tFor any given span of text, there always exists a ${t} version that satisfies the following guidelines. You must discover and implement this version.\n\n\tContent guidelines:\n\tYou must make revisions that are different from the original text.\n\tDo not editorialize or add new detail. Only rephrase to make the text ${t}. Keep the same tone.\n\t${a?"- Only include the selected content; do not incorporate any surrounding context.":""}\n\n\tFormatting guidelines:\n\tOutput in the same language as the text you are rewriting.\n\tPreserve the original text's structure and formatting. If the original text had inline formatting, preserve them in corresponding locations in the new text.\n\tAs appropriate, try to preserve the original text's wording, paragraph structure, and line breaks.\n\tIf the original selection or page contains lists, tables, or other structured content, reproduce those structures in the new text.\n\tYou may not modify page properties. You can only edit blocks in the page body.\n\tYou may not search for information or or create a new page.\n\t${"longer"===t?"Do not trivially repeat text to make it longer. Instead, add new information or expand on existing ideas.":""}\n\n\tStep-by-step instructions:\n\tYou may only EDIT the current ${a?"selection":"page"}. Do not chat, search, or attempt to take any other action.\n\t`}function u(e){return Boolean(e&&("block"===e.type||"text"===e.type&&e.start.index!==e.end.index))}const p=["search_qna","summarize","chat_key_points","chat_action_items","page_qna","fix_spelling_grammar","fill_title","add_summary","add_key_points","add_action_items","continue_writing","translate","improve_writing","make_shorter","make_longer","reformat","change_tone","simplify_language","brainstorm_ideas","write_code","draft_outline","draft_template","draft_table","draft_diagram","draft_poem","draft_email","draft_meeting_agenda","custom","explain_this","database_filing","query_database","new_page_from_template","improve_formatting","help_me_draft","help_me_edit","help_me_write","create_quiz","translate_page","search_workspace","search_ai_knowledge","new_years_resolution","summarize_transcript","alphabetize_list"],g={search_qna:{type:"search_qna",version:1,requiresInput:!0,getInstructions:()=>"\n\t\tAnswer the user's question.\n\n\t\tContent guidelines:\n\t\tProvide a clear, concise answer to the user's question.\n\t\tThe more specific and detailed the question, the more detailed and specific your answer should be.\n\t\tMake sure to properly cite and reference the information you provide.\n\n\t\tStep-by-step instructions:\n\t\tFirst perform a SEARCH to find the information needed to answer the user's question in the user's workspace.\n\t\tRespond via CHAT with the answer to the user's question.\n\t\t"},search_workspace:{type:"search_workspace",version:1,getInstructions:()=>"Search the workspace to answer the user's question.",requiresInput:!0},search_ai_knowledge:{type:"search_ai_knowledge",version:1,getInstructions:()=>"Respond via chat to attempt to answer the user's question. Do not search.",requiresInput:!0},summarize:{type:"summarize",version:1,getInstructions:e=>{var t;return l({mode:e.parameterValues.summarizeMode,style:e.parameterValues.summarizeStyle,selection:e.selection,pageOrTopic:null===(t=e.parameterValues)||void 0===t?void 0:t.pageOrTopic})},requiresInput:!1},chat_key_points:{type:"chat_key_points",version:1,getInstructions:e=>{var t;return l({mode:e.parameterValues.summarizeMode,style:e.parameterValues.summarizeStyle,selection:e.selection,pageOrTopic:null===(t=e.parameterValues)||void 0===t?void 0:t.pageOrTopic})},requiresInput:!1},chat_action_items:{type:"chat_action_items",version:1,getInstructions:e=>c({mode:"chat",selection:e.selection}),requiresInput:!1},page_qna:{type:"page_qna",version:1,getInstructions:()=>"Respond via chat to attempt to answer the user's question about the page. Do not search.",requiresInput:!0},create_quiz:{type:"create_quiz",version:1,getInstructions:e=>{const t=["A","B","C","D"];return`\n\t\t\t\tCreate a multiple choice quiz based on the content of the page.\n\n\t\t\t\tContent guidelines:\n\t\t\t\tCapture just the key conclusions and takeaways.\n\t\t\t\tMake answer choices realistic and plausiblemake it challenging but not impossible.\n\t\t\t\tThe answers should follow the same cadence as each other to avoid giving away the correct answer.\n\t\t\t\tThis is a college level quiz, so make sure the questions are challenging and require a deep understanding of the content.\n\t\t\t\tMake sure all information needed to answer the question is in the question itself.\n\t\t\t\tExplanations should explain why your answer is correct and why the other answers are incorrect, and should be detailed and informative.\n\t\t\t\tIMPORTANT: Your 5 correct answer choices should be the letters ${(()=>{const e=[];for(let n=0;n<5;n++){const n=Math.floor(Math.random()*t.length);e.push(t[n])}return e})().join(", ")}.\n\n\t\t\t\tFormatting guidelines:\n\t\t\t\tFormat your answer with 4 <text> blocks, each representing a multiple choice answer.\n\t\t\t\tOutput no more than 5 questions.\n\t\t\t\tHave all the answers to the questions be hidden under one toggle beneath the entire page. <toggle>Answer Key: <text><b>1. answer goes here</b></text><text>your explanation goes here</text><text><b>2. answer goes here</b></text><text>etc...</text></toggle>\n\n\t\t\t\tExample of a one question quiz (notice how each answer is similar and hard to distinguish):\n\t\t\t\t<text><b>Question 1:</b> How does mitosis work?</text>\n\t\t\t\t<text>A. The cell grows, duplicates its DNA, and undergoes four distinct phases where chromosomes are aligned, separated, and enclosed in two new nuclei, followed by cytokinesis.</text>\n\t\t\t\t<text>B. Chromosomes replicate, then the cell divides into two identical daughter cells, each receiving half of the chromosomes.</text>\n\t\t\t\t<text>C. The cell divides into four daughter cells, each with half the original number of chromosomes, through a process involving two rounds of division and genetic recombination.</text>\n\t\t\t\t<text>D. Mitosis occurs in four main stages: prophase, metaphase, anaphase, and telophase, where chromosomes are duplicated and equally distributed to two daughter cells without recombination.</text>\n\n\t\t\t\t<toggle>Answer Key to All Questions: <text><b>1. A. The cell grows, duplicates its DNA, and undergoes four distinct phases</b></text><text><i>Explanation:</i> Mitosis is the process where a single cell divides to produce two genetically identical daughter cells. It involves several phases: prophase, metaphase, anaphase, and telophase, followed by cytokinesis, which divides the cytoplasm and completes the cell division.</text></toggle>\n\n\t\t\t\tUse only information from the current page. Now, create a new page based on the instructions using create-page.\n\t\t\t\t`},requiresInput:!1},fix_spelling_grammar:{type:"fix_spelling_grammar",version:1,getInstructions:e=>{const t=u(e.selection)?"the user's selected text":"the entire page";return`Make any necessary edits to ${t} to fix all spelling, grammar, punctuation, and formatting mistakes.\n\n\t\tImprove upon any spelling, grammar, and punctuation errors.\n\t\tUse the most appropriate punctuation available in Unicode. For example, use smart quotes and em dashes.\n\t\tYou may reword the text if this is necessary for it to be grammatically correct or for it to accurately convey the user's intended meaning.\n\t\tDo not change the user's voice or tone. For instance, do not make the text more formal or verbose.\n\t\tBe sparing with changes to the original formatting, layout, and word choice. Any changes must be well motivated.\n\n\t\tEXAMPLE (DO NOT REFERENCE THIS EXAMPLE IN YOUR OUTPUT):\n\t\tselection: Overall switching to sporks is a great idea -shoudl cut expense for no real downside.\n\t\treplacement: Overall, switching to sporks is a great idea  it should cut expenses, with no real downside.\n\t\tEND OF EXAMPLE\n\n\t\tIf there are no spelling, grammar or punctuation mistakes, respond via chat saying so in one short sentence (in the same language as ${t}).\n\t\t`},requiresInput:!1},fill_title:{type:"fill_title",version:1,getInstructions:e=>"Edit this page to set the title only based on the current page content. Use set-property.",requiresInput:!1},add_summary:{type:"add_summary",version:1,getInstructions:e=>'\n\t\t\t\tWrite a short summary.\n\n\t\t\t\tContent guidelines:\n\t\t\t\tCapture just the key conclusions and takeaways.\n\t\t\t\tNever introduce the document with phrases like "This document..."; instead, simply restate the document\'s content concisely.\n\t\t\t\tUse clear, concise language. Avoid verbosity and repetition.\n\t\t\t\tUse simple, plain language.\n\n\t\t\t\tFormatting guidelines:\n\t\t\t\tOutput in the same language as the page.\n\t\t\t\tEmphasize 2-3 key words or phrases by bolding them.\n\t\t\t\tFormat your response as a short paragraph. Output no more than one paragraph.\n\t\t\t',requiresInput:!1},add_key_points:{type:"add_key_points",version:1,getInstructions:e=>l({mode:"insert",style:"list",selection:void 0,pageOrTopic:void 0}),requiresInput:!1},add_action_items:{type:"add_action_items",version:1,getInstructions:e=>c({mode:"insert",selection:e.selection}),requiresInput:!1},continue_writing:{type:"continue_writing",version:1,getInstructions:()=>{},requiresInput:!1},translate:{type:"translate",version:1,getInstructions:e=>{const t="\n\t\tContent guidelines:\n\t\tDo not simply translate word-for-word; make sure the translation is accurate and idiomatic, and follows the tone and register of formality expressed by the author in the original text, and appropriate for the current document type.\n\t\tIf the original text contains idiomatic expressions, translate them into equivalent idiomatic expressions in the target language rather than translating them literally.\n\t\tFor any company jargon, names, trademarks, or other proper nouns, ensure that they are translated consistently and can be referenced back to the original text.\n\n\t\tFormatting guidelines:\n\t\tMake sure to preserve all inline formatting and block structure. Every block should retain its original type without exception, so that the translation may be inserted directly into the document.\n\t\tDo not skip any content; if some content should logically not be translate (like code or links), you should still include them in the translation unchanged.\n\t\t";return e.selection?`\n\t\t\t\tRespond using <chat> with a translated version of ${u(e.selection)?"the user's selected text only":"the section around the user's cursor/selection"} in ${e.parameterValues.language}.\n\t\t\t\tRespond with the translation only, with no additional commentary.\n\n\t\t\t\t${t}\n\t\t\t`:`\n\t\t\t\tTranslate the entire page (including all blocks) translated to ${e.parameterValues.language}.\n\t\t\t\tOutput only the translation, without any additional commentary or the original text.\n\n\t\t\t\t${t}\n\t\t\t`},requiresInput:!1},translate_page:{type:"translate_page",version:1,getInstructions:()=>{},requiresInput:!1},improve_writing:{type:"improve_writing",version:1,getInstructions:e=>`Revise ${u(e.selection)?"the user's selected text only":"the entire page"} to improve its writing quality.\n\t\tInstructions:  \n\t\tImprove clarity and conciseness.\n\t\tImprove the ordering of concepts to make it more clear and readable.\n\t\tSplit up run-on sentences.\n\t\tReduce repetition.\n\t\tReplace overly complex words with simpler ones. Avoid jargon or complex terms.\n\t\tFix spelling and grammar.\n\t\tUse most appropriate punctuation. For example, use smart quotes and em dashes.\n\t\tOutput in the same language as the text you are rewriting.\n\t\tTake special care not to alter the block or inline formatting of the original text. Preserve all URLs, links, XML tags, code snippets, (un)escaped characters, etc. as they are.\n\t\tDo not change the meaning of the text or add new information to it.\n\t\tBear in mind that in this interaction the user was shown two options in the UI, IMPROVE WRITING and FIX SPELLING AND GRAMMAR, and they clicked on IMPROVE WRITING. This means that simply fixing spelling and grammar mistakes is not sufficient: you should also make more subjective writing improvements, even if the original text seems well-written. \n\t\t`,requiresInput:!1},make_shorter:{type:"make_shorter",version:1,getInstructions:e=>d({mode:"shorter",selection:e.selection}),requiresInput:!1},make_longer:{type:"make_longer",version:1,getInstructions:e=>d({mode:"longer",selection:e.selection}),requiresInput:!1},reformat:{type:"reformat",version:1,getInstructions:()=>"Reformat this text, but do not change the content.\n- Collapse any improper line breaks into one line.\n- Turn any valid line breaks into new blocks.\n- Turn dashes (-) intended to be bullets into bullet blocks.",requiresInput:!1},change_tone:{type:"change_tone",version:1,getInstructions:e=>{const t=u(e.selection);return`You are an assistant that revises text with a specific tone.\n\t\t\t\tEdit ${t?"the user's selection":"the entire page"} using a revised tone that is more ${e.parameterValues.tone}${"professional"===e.parameterValues.tone?", but not overly formal":""} ${"confident"===e.parameterValues.tone?" but NOT bombastic -- do not exaggerate the author's claims. Be very careful not to change or add to the substance of the text (i.e. what is claimed, what is referred to, etc.). Try to keep the style similar to the original -- do not be drastically more formal or verbose, for instance":""}.\n\n\t\t\t\tContent guidelines:\n\t\t\t\tYou must make revisions that are different from the original text, even if you feel the original text is already in a ${e.parameterValues.tone} tone.\n\t\t\t\tDo not add new information or change the meaning of the text. Only change the tone.\n\n\t\t\t\tFormatting guidelines:\n\t\t\t\tOutput in the same language as the text you are rewriting.\n\t\t\t\tPreserve the original text's overall structure, just change the tone.\n\n\t\t\t\tStep-by-step instructions:\n\t\t\t\tYou may only EDIT the current ${t?"selection":"page"}.\n\t\t\t`},requiresInput:!1},simplify_language:{type:"simplify_language",version:1,getInstructions:e=>`Replace ${u(e.selection)?"the user's selection":"the entire page"} to be simpler and more understandable for most people.\n\t\tWrite in the same language as the original text you are rewriting.\n\t\t`,requiresInput:!1},improve_formatting:{type:"improve_formatting",version:1,getInstructions:e=>{const t=u(e.selection);return`\n\t\t\tYou are a print and digital designer with impeccable aesthetic taste tasked with improving the formatting of the user's text to add structure, hierarchy, and readability.\n\t\t\tImprove the structure and presentation of the ${t?"selected content":"page"} to look nicer and be easier to read.\n\n\t\t\tContent guidelines:\n\t\t\tYou may not add or remove wording; repeat the exact text with only stylistic formatting changed.\n\t\t\tDo not change the ordering of the text.\n\n\t\t\tStep-by-step instructions:\n\t\t\tYou may only EDIT the current ${t?"selection":"page"}. Do not chat, search, or attempt to take any other action.\n\t\t`},requiresInput:!1},brainstorm_ideas:{type:"brainstorm_ideas",version:1,getInstructions:()=>"Brainstorm ideas on the user's requested topic.\n\nUnless specified by the user, brainstorm ideas based on the general topic of the input page or user's message, not on specific details.\nProvide a variety of at least 10 ideas, including both common and creative suggestions. No idea is too outlandish.\n\nYou may search the workspace only to understand the context of the user's request. You must not copy ideas from the search results, they must be novel and generated by you.\n",requiresInput:!0},write_code:{type:"write_code",version:1,getInstructions:({namespace:e})=>"Chat with the user to write code or answer questions about code.",requiresInput:!0},draft_outline:{type:"draft_outline",version:1,getInstructions:()=>r([o({outputType:"outline"}),"Write an outline, not a complete piece of work.","Use only nested <oli> blocks to create a hierarchical list of points and subpoints related to the topic.","Keep your outline reasonably short unless otherwise specified by the user. Do not make it longer than 3 levels deep.","NEVER make up information and present it as if it is real."]),requiresInput:!0},draft_template:{type:"draft_template",version:1,getInstructions:({namespace:e})=>r([o({outputType:"template"}),"A template is a pre-formatted document that can be used as a starting point for a new document.",..."end_to_end"!==e?["It should contain well-formatted sections (denoted by headings) and placeholders for information that will be filled in later."]:["It should contain well-formatted sections (denoted by headings <h1> and subheadings <h2>) and placeholders for information that will be filled in later.","You can make the template more visually appealing by using <callout> and <columns> blocks"]]),requiresInput:!0},draft_table:{type:"draft_table",version:1,getInstructions:e=>`${o({outputType:"table"})}\nBefore creating the table, consider the user's requested topic and which columns would be most relevant and useful.\nUse as many rows and columns as necessary to complete the user's request. In most cases, 3-5 columns and at least 3 rows suffice.\nKeep each cell concise and to the point to save visual space.\nIt is better to keep cells empty than to fill them with placeholder content.\n\nCreate your table following the Blocks documentation for 'table', which wraps 'tr' and 'td' blocks around inline content.`,requiresInput:!0},draft_diagram:{type:"draft_diagram",version:1,getInstructions:()=>`\n\t\t\t${o({outputType:"Mermaid diagram"})}\n\t\t\tBefore creating the diagram, consider the user's requested topic and which elements would be most relevant and useful.\n\t\t\tWrite the diagram in Mermaid syntax within a <code-block language="mermaid"> block.\n\t\t\tEnclose node text in double quotes to escape parentheses. Code comments should only be added on a new line after double percent %% sign.\n\t\t\t`,requiresInput:!0},draft_poem:{type:"draft_poem",version:1,getInstructions:()=>`\n\t\t\t${o({outputType:"poem"})}\n\t\t\tBefore creating the poem, consider the user's requested topic and the tone they are looking for.\n\t\t\t`,requiresInput:!0},draft_email:{type:"draft_email",version:1,getInstructions:()=>r([o({outputType:"email"}),"Start with a header to create a subject line.","Use text blocks to create the body of the email.","Emails may only contain plain text, so you may only use headers and text blocks.","Remember to include a greeting and a closing.","Dont be afraid to use placeholder text in cases where users expect specific information that you do not have.","Write in a tone that is friendly and not overly formal, unless otherwise specified by the user."]),requiresInput:!0},draft_meeting_agenda:{type:"draft_meeting_agenda",version:1,getInstructions:({namespace:e})=>r([o({outputType:"meeting agenda"}),"This meeting agenda document will be shared with all attendees before the meeting.","Perform the following actions in order:","If you need clarification on the user's request, CHAT to ask for more information.",'If the user\'s agenda topic requires additional context, SEARCH for information. Use "lookback" and "latest" params to ensure you are fetching the most recent information.',"If you find a similar meeting in the search results, consider using it as a reference to draft the new agenda by copying its structure.","","Formatting guidelines:","This is a concise outline document and should be easy to skim. Do not add introductory fluff or unnecessary details.","The page should include these sections using headers. Beneath each section you should add details using <uli>, unless you cannot find relevant details in which case you should insert placeholder text.","Background: summary of the most recent information","Relevant pages: an unordered list of relevant pages with citations","Discussion topics: an unordered list of discussion topics to cover in the meeting (don't include time estimates)","Action items: one blank todo item","Feel free to add any other relevant sections."]),requiresInput:!0},new_years_resolution:{type:"new_years_resolution",version:1,getInstructions:()=>"\n\t\t\tCONTEXT  The user just listed out their New Year's Resolutions. Your job is to create a page to help them track and reflect upon these resolutions for the next year.\n\n\t\t\tINSTRUCTIONS  For each resolution, you must fill out the following format (specifically that within the {}):\n\n\t\t\t<h1>{emoji that best suits the goal}{synthesized title}</h1><text>{the users specific wording from the previous prompt}</text><toggle size=\"h2\"><i>Measurable Milestones</i><text>The best way to achieve something grand is to break it down into smaller chunks that are easier to achieve!<todo>By the end of January, {milestone one}</todo><todo>By the end of March, {milestone two}</todo><todo>By July, {milestone three}</todo><todo>By December, {final milestone, should have goal achieved}</todo><text/></text></toggle><toggle size=\"h2\"><i>Helpful Questions</i><text>Another great way to help yourself achieve your goals is to spell out why exactly they are important to you. Here are some ideas to get you started:<uli>What first inspired me to pursue {this goal}?</uli><uli>How would achieving {this goal} make me feel?</uli><uli>How would I explain the importance of {this goal} to someone I care about?</uli></text><text/></toggle>\n\n\t\t\tUSEFUL TIPS\n\t\t\t- When breaking resolutions down into smaller milestones, make sure that you are setting realistic achievable goals.\n\t\t\t- If two or more resolutions seem closely related, feel free to group them in under the same synthesized resolution.\n\t\t\t- Stick as close as you can to the template's structure and XML tags because they are easiest to understand for the user.\n\t\t\t- Make sure to put all of the templates on the same page, meaning that there must only one <create-page> </create-page> XML pair that all falls within.\n\t\t\t- Your page must be entirely in the same language as the user's input.\n\n\t\t\tNow, begin writing up the user's 2025 Resolutions using <create-page>\n\t\t",requiresInput:!0},custom:i,explain_this:{type:"explain_this",version:1,getInstructions:()=>"Briefly explain the selected word, entity, or phrase, using both context from the surrounding text and any knowledge you find by searching the workspace, if necessary.\n\n\t\tFocus on the selection itself, not the entire page.\n\t\tUse clear, concise language. Assume an intelligent reader who's unfamiliar with the topic.\n\t\tBreak down any complex terms or concepts and explain the meaning in an easy to understand way. Avoid jargon.\n\t\tMake absolutely certain that you evidence your claims with citations to the original block or any search results.\n\n\t\tIf you feel the selected text COULD be specific to the user's workspace or domain, SEARCH for additional information that may help you. When in doubt, search first.\n\t\t",requiresInput:!1},database_filing:{type:"database_filing",version:1,getInstructions:e=>[...[...a().x9d("You are an Assistant that helps the user add content into the "),a().wmz(a().h71(e.parameterValues.collection.id,e.parameterValues.collection.spaceId)),...a().x9d(" database.\n")],...r(["Perform the following actions in order:","1. Use <load id={database id}> to load the schema of the user's specified database.","2. Infer the schema values to fill out based on the user's message. Refer to the database description for additional instructions if applicable.","3. Use <create-page> to insert a new page into the databasecontaining the user's message. Include a detailed summary of the user's information inside of the page.",'<create-page in="{database id}"><page><property-title name={property name}></property-title><text>{detailed summary of user\'s provided information}</text></page></create-page>',"","You may file multiple entries in the database if the user has provided multiple distinct pieces of information."])],requiresInput:!0},query_database:{type:"query_database",version:1,getInstructions:e=>[...[...a().x9d("You are an assistant that helps the user sort, search, and filter the "),a().wmz(a().h71(e.parameterValues.collection.id,e.parameterValues.collection.spaceId)),...a().x9d(" database.\n")],...r(["1. Query the given database with the most appropriate set of sort and filter parameters to fulfill the user's request.","2. Based on the retrieved information, use <chat> to address the user's question in as helpful a way as you can.","","Your response will be presented alongside the query you make, so you need not repeat the query itself."])],requiresInput:!0},new_page_from_template:{type:"new_page_from_template",version:1,getInstructions:e=>[...[...a().x9d("You are an Assistant that helps the user fill out a new page based on the"),a().wmz(a().ld4(e.parameterValues.template.id,e.parameterValues.template.spaceId)),...a().x9d(" template.\n")],...r(["Load the template first, then ask the user for the information needed to fill out the page in the following form:","1. The user would have provided a brief description of the new page, or a list of related documents.","2. Then, load all related documents if provided, or do a search based on the description if provided.","3. After Step 2, you should have enough background information for reference.","4. Go through each section of the template one by one:","4.1. For each section, fill it with the initial background information if possible, then ask the user to either confirm or to provide more details.",`5. Repeat Step 4 until all sections are filled. Then, use ${"end_to_end"!==e.namespace?"<create-page>":"<create>"} to create the new page.`])],requiresInput:!0},help_me_draft:{type:"help_me_draft",version:1,getInstructions:e=>"You are an expert writer helping a user draft content in a new document. Using their description of what they'd like to draft, start writing in the document.\nDont be afraid to use placeholder text in cases where users expect specific information that you do not have.",requiresInput:!0},help_me_edit:{type:"help_me_edit",version:1,getInstructions:e=>"You are an expert editor helping a user edit their text. The user has specified a selection and what they would like to change. Make the specified changes to the user's selected text, taking care to follow their instructions.",requiresInput:!0},help_me_write:{type:"help_me_write",version:1,getInstructions:e=>"You are an expert writer helping a user add new content to their document. Using their selection and description of what they'd like to write, add to the user's document, matching their tone and style.",requiresInput:!0},summarize_transcript:{type:"summarize_transcript",version:1,getInstructions:()=>{},requiresInput:!1},alphabetize_list:{type:"alphabetize_list",version:1,getInstructions:e=>{const t=u(e.selection);return`\n\t\t\tYou are tasked with alphabetizing lists to improve organization and readability.\n\t\t\tAlphabetize the ${t?"selected list items":"lists on the page"} in ascending order (A to Z).\n\n\t\t\tContent guidelines:\n\t\t\t- Sort list items alphabetically by their first word, ignoring case (case-insensitive sorting)\n\t\t\t- Preserve the exact text content of each list item - do not modify the wording\n\t\t\t- Maintain the original formatting style (bullets, numbers, indentation levels)\n\t\t\t- For numbered lists, keep the numbering format but reorder the content alphabetically\n\t\t\t- For bulleted lists, maintain the bullet style and reorder the content alphabetically\n\t\t\t- For nested lists, sort items at each level independently while preserving the hierarchy\n\t\t\t- If an item contains multiple lines or sub-content, treat the first line as the sorting key\n\t\t\t- Ignore leading articles (a, an, the) when sorting if they appear at the beginning of items\n\t\t\t- Handle special characters and numbers by sorting them before letters\n\n\t\t\tFormatting guidelines:\n\t\t\t- Preserve all original formatting (bold, italic, links, etc.) within each list item\n\t\t\t- Maintain proper spacing and indentation\n\t\t\t- Keep the same list type (bulleted vs numbered) as the original\n\t\t\t- For mixed content (text + lists), only alphabetize the actual list items, leave other content unchanged\n\n\t\t\tStep-by-step instructions:\n\t\t\tYou may only EDIT the current ${t?"selection":"page"}. Do not chat, search, or attempt to take any other action.\n\t\t\tIdentify all list items, sort them alphabetically while preserving their formatting, and replace the original list with the sorted version.\n\t\t`},requiresInput:!1}};function m(e){const t=g[e];if(!t)throw new Error(`No skill found for type: ${e}`);return t}function h(e){const{skillType:t,parameterValues:n,selection:a,namespace:i}=e;return m(t).getInstructions({parameterValues:n,selection:a,namespace:i})??""}function f(e){if(void 0!==e)return m(e)}},408464:(e,t,n)=>{n.d(t,{_:()=>p});n(296540);var a=()=>n(907258),i=()=>n(590526),s=()=>n(807449),o=()=>n(424400),r=()=>n(888867),l=()=>n(69708),c=()=>n(187820),d=()=>n(650598),u=n(474848);function p({name:e,icon:t,role:n}){const p=(0,l().tz)(),g=(0,i().O$)(a().AppStoreSidebarSpaceStore),m=(0,d().J)(p,n);return(0,u.jsx)(o().Ay,{desktopIconStyle:{alignSelf:"center",width:24,fontSize:18},icon:(0,u.jsx)(c().B6,{disabled:!0,icon:t&&g?{pointer:g.pointer,icon:t}:void 0,size:20,isEmptyPage:!1,title:e,defaultIcon:(0,u.jsx)(s().I,{icon:r().s,colorVariant:"tertiary"})}),title:e||(0,u.jsx)(l().sA,{id:"adminContentSearchTab.pagesTable.sharedWithCell.untitledPage",defaultMessage:"Untitled{maybeRoleString}",values:{maybeRoleString:m?`  ${m}`:""}}),caption:(0,u.jsx)(l().sA,{id:"adminContentSearchTab.pagesTable.sharedWithCell.group",defaultMessage:"Group{maybeRoleString}",values:{maybeRoleString:m?`  ${m}`:""}})})}},410930:(e,t,n)=>{n.d(t,{z:()=>s});var a=()=>n(79926);const i={CollapsiblePanel:new(a().O2)("CollapsiblePanel",(()=>n.e(35905).then(n.bind(n,829298))))},s=(0,a()._h)(i.CollapsiblePanel,(e=>e.CollapsiblePanel))},415211:(e,t,n)=>{n.d(t,{P:()=>s});n(898992),n(672577);var a=()=>n(24279),i=()=>n(945710);function s(e){const t=e.find(a().wc);if(null!=t&&t.skillContext)return{clientSkill:(0,i().createClientGlobalSkill)(t.skillContext.type),parameterValues:t.skillContext.settings??{}}}},418133:(e,t,n)=>{n.d(t,{dX:()=>ae});n(944114),n(898992),n(354520),n(581454);var a=n.n(n(844751)),i=n(296540),s=()=>n(907258),o=()=>n(59226),r=()=>n(726637),l=()=>n(381175),c=()=>n(484714),d=()=>n(590526),u=()=>n(401497),p=()=>n(463086),g=()=>n(874832),m=()=>n(696060),h=()=>n(396896),f=()=>n(807449),y=()=>n(98126),v=()=>n(890492),S=()=>n(81068),b=()=>n(663639),x=()=>n(736847),I=()=>n(427704),k=()=>n(234459),w=()=>n(69708),C=()=>n(100622),A=()=>n(496603),T=()=>n(534177),j=()=>n(944584),M=()=>n(36951),_=()=>n(596120),P=()=>n(918052),D=()=>n(781697),E=()=>n(419357),R=()=>n(631611),B=()=>n(130119),F=()=>n(825972),N=()=>n(246766),L=()=>n(637307),O=()=>n(440024),V=()=>n(150984),z=()=>n(156008),W=()=>n(977270),U=()=>n(370964),H=()=>n(44971),K=()=>n(483730),q=()=>n(695115),$=()=>n(236262),G=()=>n(140022),Y=n(474848);const Q=(0,w().YK)({trashIconAriaLabel:{id:"assistantChatHistoryIcon.deleteSession.label",defaultMessage:"Delete chat"},chatHistoryConfirmation:{id:"assistantChatHistory.deleteConfirmation.message",defaultMessage:"Are you sure you want to delete this chat?"}}),J=i.forwardRef(((e,t)=>{const{chatTranscriptInfo:a,hideBottomBorder:s,isSelected:o,isThreadActionsMenuEnabled:l,...p}=e,g=(0,c().v3)(),m=(0,w().tz)(),{type:h}=(0,R().jw)(),f=(0,_().m)(a),y=(0,n(815585).nl)(f,{useCompactFormat:!0,roundDownYears:!0,useWeeks:!0,useLowercase:!0}),v=(0,d().K8)((()=>{if("assistant"!==a.configType){var e;const t=null===(e=a.store.getData())||void 0===e?void 0:e.title;if(t&&t.length>0)return t}return a.title}),[a]),b=(0,i.useCallback)((async()=>{(await n(792057).Gh({message:m.formatMessage(Q.chatHistoryConfirmation)})).accept&&"assistant"===a.configType&&(0,V().deleteAssistantChatSession)({sessionId:a.id,environment:g}),G().trackAIChatTranscriptHistoryChatDeleted(g,{source:h})}),[m,g,h,a]),x=(0,i.useCallback)((()=>{"assistant"!==a.configType&&(0,n(140992).vy)({chatTranscriptInfo:a,environment:g,clientStore:n(166442).defaultClientAIChatStore}),G().trackAIChatTranscriptHistoryChatDeleted(g,{source:h})}),[g,h,a]),I=(0,i.useCallback)((()=>{"assistant"!==a.configType&&(0,M().VK)({environment:g,oldThreadStore:void 0,newThreadStore:a.store,openInNewTab:!0})}),[g,a]),[k,A]=(0,n(554283).B)(),T=(0,u().IS)((()=>({buttonStyle:{...r().A.isMobile&&{background:C().Tj.background.primary,boxShadow:void 0},...o&&!r().A.isMobile?{background:C().Tj.sidebarItemSelectedBackground}:{},minHeight:30,borderRadius:6,padding:"4px 0px"},labelArea:{display:"flex",flexDirection:"row",alignItems:"baseline",gap:4,minWidth:0},titleArea:{overflow:"hidden"},captionStyle:{fontSize:12,fontWeight:n(284371).Wy.regular,color:C().Tj.text.tertiary}})),[o]),j=(0,n(93583).A)(t,k);return(0,Y.jsx)(S().A,{...p,ref:j,icon:(0,Y.jsx)(X,{chatTranscriptInfo:a}),buttonStyle:T.buttonStyle,titleStyle:T.labelArea,title:(0,Y.jsx)(n(493552).D,{styleKey:"bodyMedium",style:T.titleArea,children:(0,Y.jsx)(n(404905).j,{children:v})}),caption:y,captionStyle:T.captionStyle,right:(r().A.isMobile||p.focused||A)&&("assistant"!==a.configType?l?(0,Y.jsx)(n(731881).R,{threadStore:a.store,onDelete:x,onOpenInNewTab:I}):(0,Y.jsx)(q().A,{icon:$().trashIcon,ariaLabel:m.formatMessage(Q.trashIconAriaLabel),colorVariant:"secondary",iconStyle:{height:16,width:16},onClick:e=>{e.stopPropagation(),x()}}):(0,Y.jsx)(Z,{onDeleteHistoryItem:b}))})}));function X(e){const{chatTranscriptInfo:t}=e;switch(t.configType){case"researcher":return(0,Y.jsx)(f().I,{size:"default",icon:n(38679).P,colorVariant:"secondary"});case"setup-generator":return(0,Y.jsx)(f().I,{size:"default",icon:n(62616).c,colorVariant:"secondary"});default:return(0,Y.jsx)(f().I,{size:"default",icon:n(107620).y,colorVariant:"secondary"})}}function Z(e){const{onDeleteHistoryItem:t}=e,n=(0,w().tz)(),a=(0,u().IS)((()=>({container:{padding:3,borderRadius:6,...r().A.isMobile&&{marginInlineEnd:16}},trashIcon:{height:16,width:16,color:C().Tj.icon.tertiary}})),[]);return(0,Y.jsx)(q().A,{icon:$().trashIcon,ariaLabel:n.formatMessage(Q.trashIconAriaLabel),style:a.container,iconStyle:a.trashIcon,onClick:t})}J.displayName="AssistantChatHistoryItem";const ee=24,te=12,ne=(0,w().YK)({chatHistorySearchPlaceholder:{id:"assistant.chatHistory.placeholder",defaultMessage:"Search or start new chat"},untitledChat:{id:"assistant.chatHistory.untitledChat",defaultMessage:"New AI chat"}});function ae(e){const{onRestoreChatSession:t}=e,n=(0,c().v3)(),g=(0,w().tz)(),[f,S]=i.useState(""),C=(0,d().O$)(s().AppStoreSidebarSpaceStore),E=(0,R().jw)(),{renderChatHistoryAsFullPage:B}=E,q=E.isType("fullPage"),$=E.supportsChatHistoryWithInferenceTranscripts,G=(0,P().s)({parentStore:C,threadStore:void 0,isEnabled:$,enableInfiniteScroll:!0}),Q=(0,d().K8)((()=>{const e=!H().A.state.initialFetchComplete;if($){const t="pending"===G.status||"idle"===G.status;return e||t}return e}),[$,G.status]),X=(0,o().X)("ai_thread_actions_menu");(0,U().J)();const Z=(0,d().K8)((()=>{if(!C)return[];return(G.value??[]).map((e=>{const t=p().E.createChildStore(C,{id:e.id,table:k().To,spaceId:C.id});if(t.isDefined()&&!1===t.getAlive())return;let n;for(const a of t.getMessageStores()){const e=a.getStep();if("config"===(null==e?void 0:e.type)){n=e.value.type;break}}return n?{id:e.id,configType:n,title:e.title??g.formatMessage(ne.untitledChat),description:"",updatedTime:e.updated_at,createdTime:e.created_at,store:t}:void 0})).filter(T().O9)}),[C,G.value,g]),ae=(0,i.useMemo)((()=>A().Ul(Z,(e=>-(0,_().m)(e)))),[Z]),se=(0,i.useCallback)((()=>{G.loadMore&&G.hasMore&&!G.isLoadingMore&&G.loadMore()}),[G]),ce=(0,i.useMemo)((()=>{if(!f)return ae;return a().filter(f,ae,{extract:e=>"string"==typeof e.title?`${e.title} ${e.description}`:e.description}).map((e=>e.original))}),[f,ae]),de=(0,i.useMemo)((()=>A().$z(ce,(e=>(0,F().ht)((0,_().m)(e))))),[ce]),ue=(0,d().K8)((()=>{const{route:e}=n.RouterStore.state;if("chat"===e.name){const{threadId:t}=e;if(t)return t}const t=K().default.getActiveSession();return null==t?void 0:t.sessionIdFromStoreState}),[n]),pe=(0,u().IS)((()=>({shimmerWrapper:{padding:12,marginTop:10}})),[]),ge=(0,d().K8)((()=>{const e=F().Rj.map((e=>{const a=de[e]??[];if(0===a.length)return;const i=a.findIndex((e=>e.id===ue)),s=a.map(((e,a)=>{const s=-1!==i&&i-1===a;return function(e){const{environment:t,onRestoreChatSession:n,chatTranscriptInfo:a,isChatItemSelected:i,isBeforeSelectedChatItem:s,assistantSurface:o,isThreadActionsMenuEnabled:r}=e;return{key:a.id,render:e=>(0,Y.jsx)(J,{...e,chatTranscriptInfo:a,isSelected:i,hideBottomBorder:e.focused||e.isBeforeFocused||e.isLastInSection||s,isThreadActionsMenuEnabled:r}),action:({event:e})=>{const i="tab"===(0,l().V)(e);j().trackAgentChatHistoryItemClicked({environment:t,threadId:a.id,from:"ai_home"}),(0,V().performSecondarySidebarAction)({environment:t,action:()=>{"assistant"===a.configType?(0,z().bl)({environment:t,chatStore:a.store,onRestoreChatSession:()=>{W().assistantMenuStore.setState({currentView:"chat",open:o.shouldOpenAssistantMenuOnRestoreChatSession,from:"secondary_sidebar",isAssistantInputEmpty:!0}),o.isType("fullPage")&&(0,N().navigate)({environment:t,url:I().JZ.chat}),null==n||n()},assistantSurface:o}):(W().assistantMenuStore.setState({...W().assistantMenuStore.state,open:!1}),(0,M().VK)({environment:t,oldThreadStore:void 0,newThreadStore:a.store,openInNewTab:i}),null==n||n())}})}}}({environment:n,chatTranscriptInfo:e,onRestoreChatSession:t,isChatItemSelected:e.id===ue,isBeforeSelectedChatItem:s,assistantSurface:E,isThreadActionsMenuEnabled:X})})).filter(T().O9);return{key:e,render:t=>(0,Y.jsx)(x().A,{...t,title:(0,Y.jsx)(L().sg,{bucket:e}),enableActionSheetTitle:!0}),items:s}})).filter(T().O9);return 0===e.length&&q&&e.push({key:"empty",render:e=>(0,Y.jsx)(x().A,{...e}),items:[{key:"no_results",render:()=>(0,Y.jsx)(re,{}),action:()=>{}}]}),q||e.push({key:"empty",render:e=>(0,Y.jsx)(x().A,{...e}),items:[{key:"start_new_chat_option",render:e=>(0,Y.jsx)(le,{...e}),action:()=>{(0,V().performSecondarySidebarAction)({environment:n,action:()=>{(0,z().Dd)({environment:n,source:E.type})}})}}]}),e}),[n,de,t,ue,E,X,q]),me=(0,Y.jsx)(oe,{userSearchQuery:f,setUserSearchQuery:S,onFocus:()=>{(0,O().I)({environment:n})}}),he=ee+te,fe={...(0,D().e)(),header:me,...B?{minHeight:0,maxHeight:r().A.isMobile||q?"100vh":`calc(100vh - ${he}px)`}:{minHeight:0,height:450}};return(0,Y.jsx)(v().A,{...fe,children:Q?(0,Y.jsx)("div",{style:pe.shimmerWrapper,children:(0,Y.jsxs)(h().VP,{gap:32,children:[(0,Y.jsx)(ie,{count:4}),(0,Y.jsx)(ie,{count:10})]})}):(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(b().A,{style:r().A.isMobile?void 0:q?{padding:"0 4px 16px 4px"}:{padding:"0 4px 4px 4px"},type:b().O.Vertical,initialFocus:void 0,sections:ge}),G.isLoadingMore?(0,Y.jsx)("div",{style:pe.shimmerWrapper,children:(0,Y.jsx)(y().k,{})}):void 0,(0,Y.jsx)(m().A,{onLoadMore:se,loading:Boolean(G.isLoadingMore),loadMoreOffsetThreshold:100})]})})}function ie(e){const{count:t}=e,n=(0,u().IS)((()=>({sectionHeader:{height:13,width:60,borderRadius:4},icon:{height:28,width:28,borderRadius:4},container:{borderBottom:`1px solid ${C().Tj.border.secondaryTranslucent}`,paddingBottom:15}})),[]),a=Array.from({length:t},(()=>!0));return(0,Y.jsxs)(h().VP,{gap:24,children:[(0,Y.jsx)(g().P,{style:n.sectionHeader}),(0,Y.jsx)(h().VP,{gap:12,children:a.map(((e,t)=>(0,Y.jsx)("div",{style:n.container,children:(0,Y.jsxs)(h().fI,{gap:16,children:[(0,Y.jsx)(g().P,{style:n.icon}),(0,Y.jsx)(se,{})]})},`chat-history-shimmer-${t}`)))})]})}function se(){const e=(0,u().IS)((()=>({chatTitle:{width:200,height:20,borderRadius:4},chatSummary:{height:12,borderRadius:4},container:{width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",gap:5}})),[]);return(0,Y.jsxs)("div",{style:e.container,children:[(0,Y.jsx)(g().P,{style:{...e.chatTitle,width:"55%"}}),(0,Y.jsx)(g().P,{style:{...e.chatSummary,width:"65%"}})]})}function oe(e){const{onFocus:t,userSearchQuery:n,setUserSearchQuery:a}=e,i=(0,w().tz)(),s=(0,c().v3)(),o=(0,R().jw)(),l=(0,u().IS)((()=>{let e;return e=o.isType("corner")||o.isType("fullPage")?{paddingTop:0,paddingInlineEnd:8,paddingBottom:4,paddingInlineStart:8}:o.isCommandSearchOrSearchPane?{paddingTop:10,paddingInlineEnd:8,paddingBottom:2,paddingInlineStart:8,...o.isType("commandSearch")&&{...(0,B().g)({noDrag:!0})}}:{padding:"10px 0 2px"},{container:e,inputOuterStyle:{backgroundColor:C().Tj.whiteButtonBackground,borderRadius:6,padding:"4px 8px"},inputStyle:{backgroundColor:C().Tj.whiteButtonBackground}}}),[o]);return(0,Y.jsx)(E().Ay,{autoFocus:r().A.isMobile,onFocus:t,...o.isType("fullPage")?{showClearButton:!0}:{},style:l.container,inputOuterStyle:l.inputOuterStyle,inputStyle:l.inputStyle,value:n,onChange:e=>{a(e.target.value)},placeholder:i.formatMessage(ne.chatHistorySearchPlaceholder),onSubmit:()=>{(0,V().performSecondarySidebarAction)({environment:s,action:async()=>{await(0,W().handleSubmitNewQuestion)({newValue:[[n]],environment:s,currentClientSkillWithSettings:void 0,shouldForceStartNewSession:!0,source:"transcript",assistantSurfaceType:o.type}),W().assistantMenuStore.setState({...W().assistantMenuStore.state,currentView:"chat"})}})}})}function re(){const e=(0,u().IS)((()=>({noResultsMessage:{paddingTop:30,paddingBottom:30,display:"flex",justifyContent:"center",alignItems:"center",color:C().Tj.text.tertiary,fontSize:12}})),[]);return(0,Y.jsx)("div",{style:e.noResultsMessage,children:(0,Y.jsx)(w().sA,{id:"assistant.chatHistory.noResults",defaultMessage:"No results"})})}const le=i.forwardRef(((e,t)=>(0,Y.jsx)(S().A,{ref:t,...e,icon:(0,Y.jsx)(f().I,{size:"default",icon:n(617668).plusIcon,colorVariant:"secondary"}),title:(0,Y.jsx)(w().sA,{id:"assistant.chatHistory.startNewChat",defaultMessage:"Start a new AI chat"})})));le.displayName="CreateNewChatMenuItem"},423995:(e,t,n)=>{n.d(t,{n:()=>r});var a=()=>n(206267),i=()=>n(150984),s=()=>n(587685),o=()=>n(808725);async function r(e){const{environment:t,assistantSessionContext:n,collectionId:r,assistantSurfaceType:l}=e,{evaluatorFromStoreState:c,sessionIdFromStoreState:d}=n,u=(0,s().P)({mappedDatabaseId:r,assistantSessionContext:n,idMapper:c.state.getIdMapper()}),p=a().JW(),g=c.createAssistantStep(u,{inferenceId:p});await(0,o().T)({environment:t,step:g,commit:!0,inferenceId:p,isStreaming:!1,sessionId:d,updater:n.createUpdater()}),(0,i().fireAndForgetUpsertStepToChatSessionHistory)({sessionId:d,environment:t,assistantSurfaceType:l})}},424416:(e,t,n)=>{n.d(t,{E:()=>h,b:()=>f});n(296540);var a=()=>n(401497),i=()=>n(249046),s=()=>n(807449),o=()=>n(265060),r=()=>n(203717),l=()=>n(377114),c=()=>n(599813),d=()=>n(558687),u=()=>n(582162),p=()=>n(100622),g=()=>n(284371),m=n(474848);function h({size:e=40}){const t=(0,a().IS)((()=>({wrapper:{width:e,height:e,display:"flex",justifyContent:"center",alignItems:"center",position:"relative"},largeLogo:{width:"80%",height:"80%",position:"absolute",top:"-10%",insetInlineStart:"-5%"},smallLogoWrapper:{width:"60%",height:"60%",display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",bottom:0,insetInlineEnd:0,boxShadow:p().Tj.shadowMD,borderRadius:"50%",backgroundColor:p().Tj.palette.gray[0]},smallLogo:{width:"70%"}})),[e]);return(0,m.jsxs)("div",{style:t.wrapper,children:[(0,m.jsx)(o().Q,{iconGroup:r().G.sharepoint,variantName:"default",style:t.largeLogo}),(0,m.jsx)("div",{style:t.smallLogoWrapper,children:(0,u().oneDriveIcon)(t.smallLogo)})]})}function f(e){const{connectorType:t,title:n,subtext:u,titleSubtitleGap:f=!1,fullWidthTitle:y=!1}=e,v=r().G[t],S=(0,a().IS)((()=>({logoSection:{paddingTop:40,paddingInlineEnd:20,paddingBottom:24,paddingInlineStart:20,gap:8,justifyContent:"center",alignItems:"center"},logos:{width:40,height:40},titleWrapper:{width:"100%",justifyContent:"center",textAlign:"center",alignItems:"center",gap:f?12:0},title:{fontSize:16,paddingInlineStart:20,paddingInlineEnd:20,width:y?"auto":352,fontWeight:g().Wy.medium,lineHeight:"22px",marginBottom:"2px",justifyContent:"center",textWrap:"balance"},subtext:{fontSize:14,fontWeight:g().Wy.regular,color:`${p().Tj.text.secondary}`,textAlign:"center",alignItems:"center",justifyContent:"center",paddingInlineStart:20,paddingInlineEnd:20,textWrap:"balance"},wrapper:{paddingBottom:16}})),[f,y]);return(0,m.jsxs)("div",{style:S.wrapper,children:[(0,m.jsxs)(i().Ye,{style:S.logoSection,children:[(0,d().notionIcon)(S.logos),e.disconnectFlow?(0,m.jsx)(s().I,{icon:c().xMarkIcon,colorVariant:"secondary"}):(0,m.jsx)(s().I,{icon:l().arrowLeftRightIcon,colorVariant:"secondary"}),"sharepoint"===t?(0,m.jsx)(h,{}):(0,m.jsx)(o().Q,{iconGroup:v,overrideSize:()=>S.logos.width,variantName:"default"})]}),(0,m.jsxs)(i().wt,{style:S.titleWrapper,children:[(0,m.jsx)(i().Ye,{style:S.title,children:n}),u?(0,m.jsx)(i().Ye,{style:S.subtext,children:u}):(0,m.jsx)(m.Fragment,{})]})]})}},424735:(e,t,n)=>{n.r(t),n.d(t,{arrowBranchSmallIcon:()=>i,iconDefinition:()=>a});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"2.66 3.01 10.68 10.48",svg:(0,n(474848).jsx)("path",{d:"M3.286 3.015a.625.625 0 0 0-.625.625v2.8a.625.625 0 0 0 1.25 0V5.15l2.382 2.38a3.7 3.7 0 0 1 1.082 2.607v3.277c0 .042.034.075.075.075h1.1a.075.075 0 0 0 .075-.075v-3.277A3.7 3.7 0 0 1 9.707 7.53l2.382-2.382V6.44a.625.625 0 1 0 1.25 0v-2.8a.625.625 0 0 0-.625-.625h-2.8a.625.625 0 0 0 0 1.25h1.29l-2.38 2.382A5 5 0 0 0 8 7.737a5 5 0 0 0-.823-1.09L4.795 4.265h1.291a.625.625 0 0 0 0-1.25z"})},i=(0,n(340498).wt)("arrowBranchSmall",a,"small")},427508:(e,t,n)=>{n.d(t,{Z:()=>me});var a=()=>n(906745),i=n(296540),s=()=>n(401497),o=()=>n(741615),r=()=>n(98126),l=()=>n(795523),c=()=>n(297474),d=()=>n(800023),u=()=>n(484714),p=()=>n(165358),g=()=>n(187174),m=()=>n(239575);n(581454);var h=()=>n(249046),f=()=>n(807449),y=()=>n(493552),v=()=>n(69708),S=()=>n(100622),b=n(474848);const x=[{icon:n(120282).a,iconColor:"#2383E2",iconBackgroundColor:"rgba(35, 131, 226, 0.1)",count:"124 hours saved",label:"Meeting notes"},{icon:n(421559).T,iconColor:"#D9730D",iconBackgroundColor:"rgba(217, 115, 13, 0.1)",count:"23 hours saved",label:"Database creation"},{icon:n(818541).V,iconColor:"#9F6B53",iconBackgroundColor:"rgba(159, 107, 83, 0.1)",count:"391 hours saved",label:"Enterprise search"}];function I(){const e=(0,s().IS)((()=>({header:{marginBlockEnd:4},actionsList:{gap:12},actionItem:{flex:1,padding:16,backgroundColor:S().Tj.background.secondary,borderRadius:12},iconWrapper:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:4,marginBlockEnd:8},analyticsLink:{cursor:"pointer",userSelect:"none"}})),[]);return(0,b.jsxs)(h().wt,{gap:12,children:[(0,b.jsxs)(h().Ye,{alignItems:"center",justifyContent:"space-between",style:e.header,children:[(0,b.jsx)(y().D,{styleKey:"bodyMedium",colorVariant:"primary",children:(0,b.jsx)(v().sA,{id:"creditsInAction.title",defaultMessage:"Credits in action"})}),(0,b.jsx)("div",{style:e.analyticsLink,children:(0,b.jsxs)(h().Ye,{alignItems:"center",gap:4,children:[(0,b.jsx)(y().D,{styleKey:"bodySm",colorVariant:"secondary",children:(0,b.jsx)(v().sA,{id:"creditsInAction.analyticsLink",defaultMessage:"AI Analytics Dashboard"})}),(0,b.jsx)(y().D,{styleKey:"bodySm",colorVariant:"secondary",children:""})]})})]}),(0,b.jsx)(h().Ye,{style:e.actionsList,children:x.map(((t,n)=>(0,b.jsxs)(h().wt,{gap:8,style:e.actionItem,children:[(0,b.jsx)("div",{style:{...e.iconWrapper,backgroundColor:t.iconBackgroundColor},children:(0,b.jsx)(f().I,{icon:t.icon,size:20})}),(0,b.jsxs)(h().wt,{gap:4,children:[(0,b.jsx)(y().D,{styleKey:"bodySm",colorVariant:"secondary",children:t.label}),(0,b.jsx)(y().D,{styleKey:"bodyMedium",colorVariant:"primary",children:t.count})]})]},n)))})]})}var k=()=>n(590526),w=()=>n(496603),C=()=>n(264503),A=()=>n(372976),T=()=>n(700461),j=()=>n(532564),M=()=>n(505776);n(964979);const _=(0,v().YK)({annualElasticCreditsTitle:{id:"aiUsageDashboard.additionalUsage.annualElasticCredits.title",defaultMessage:"Annual elastic credits consumed"},overageCreditsTitle:{id:"aiUsageDashboard.additionalUsage.overageCredits.title",defaultMessage:"Overage credits consumed"},available:{id:"aiUsageDashboard.additionalUsage.available",defaultMessage:"{available} available"},usageThisMonth:{id:"aiUsageDashboard.additionalUsage.usageThisMonth",defaultMessage:"{usage} this month"}});function P({usedThisMonth:e,rolloverFromLastMonth:t,totalAvailable:n}){const a=(0,v().tz)(),i=(0,s().IS)((()=>({card:{flex:1,paddingBlock:"12px 16px",paddingInline:12,backgroundColor:S().Tj.background.secondary,borderRadius:12},header:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:9},usageText:{marginBlockStart:2},progressTrack:{marginBlockStart:8,width:"100%",height:6,borderRadius:100,display:"flex",overflow:"hidden",backgroundColor:S().Tj.gray.background.secondaryTranslucent},rolloverSegment:{height:"100%",borderRadius:100,backgroundColor:S().Tj.orange.text.disabled},usedSegment:{height:"100%",borderRadius:100,backgroundColor:S().Tj.orange.text.accentPrimary}})),[]),o=n>0?Math.min(t/n*100,100):0,r=n>0?Math.min(e/n*100,100-o):0,l=Math.max(0,n-e-t);return(0,b.jsxs)("div",{style:i.card,children:[(0,b.jsxs)("div",{style:i.header,children:[(0,b.jsx)(y().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:a.formatMessage(_.annualElasticCreditsTitle)}),(0,b.jsx)(y().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:(0,b.jsx)(v().sA,{..._.available,values:{available:(0,b.jsx)(v().Gr,{value:l})}})})]}),(0,b.jsx)(y().D,{styleKey:"bodyMedium",colorVariant:"primary",style:i.usageText,children:(0,b.jsx)(v().sA,{..._.usageThisMonth,values:{usage:(0,b.jsx)(v().Gr,{value:e})}})}),(0,b.jsxs)("div",{style:i.progressTrack,children:[(0,b.jsx)("div",{style:{...i.rolloverSegment,width:`${o}%`}}),(0,b.jsx)("div",{style:{...i.usedSegment,width:`${r}%`}})]})]})}function D({usedThisMonth:e,totalAvailable:t}){const n=(0,v().tz)(),a=(0,s().IS)((()=>({card:{flex:1,paddingBlock:"12px 16px",paddingInline:12,backgroundColor:S().Tj.background.secondary,borderRadius:12},header:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:9},usageText:{marginBlockStart:2},progressTrack:{marginBlockStart:8,width:"100%",height:6,borderRadius:100,display:"flex",overflow:"hidden",backgroundColor:S().Tj.gray.background.secondaryTranslucent},usedSegment:{height:"100%",borderRadius:100,backgroundColor:S().Tj.gray.text.tertiary}})),[]),i=t>0?Math.min(e/t*100,100):0,o=Math.max(0,t-e);return(0,b.jsxs)("div",{style:a.card,children:[(0,b.jsxs)("div",{style:a.header,children:[(0,b.jsx)(y().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:n.formatMessage(_.overageCreditsTitle)}),(0,b.jsx)(y().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:(0,b.jsx)(v().sA,{..._.available,values:{available:(0,b.jsx)(v().Gr,{value:o})}})})]}),(0,b.jsx)(y().D,{styleKey:"bodyMedium",colorVariant:"primary",style:a.usageText,children:(0,b.jsx)(v().sA,{..._.usageThisMonth,values:{usage:(0,b.jsx)(v().Gr,{value:e})}})}),(0,b.jsx)("div",{style:a.progressTrack,children:(0,b.jsx)("div",{style:{...a.usedSegment,width:`${i}%`}})})]})}function E(){const e=(0,s().IS)((()=>({container:{display:"flex",gap:12}})),[]);return(0,b.jsxs)("div",{style:e.container,children:[(0,b.jsx)(P,{usedThisMonth:2298,rolloverFromLastMonth:5e3,totalAvailable:1e5}),(0,b.jsx)(D,{usedThisMonth:12e3,totalAvailable:1e5})]})}const R=["M8.833 7.26a2.522 2.522 0 0 1 4.34.022.551.551 0 0 1-.95.555 1.422 1.422 0 0 0-2.446-.012L6.676 13l2.255.366a.55.55 0 0 1-.176 1.085L5.7 13.956a.55.55 0 0 1-.384-.825z","M10.518 8.605a.705.705 0 1 1-.225 1.393.705.705 0 0 1 .225-1.393m-3.719-.602a.706.706 0 1 1-.227 1.393.706.706 0 0 1 .227-1.393M5.146 5.999a2.524 2.524 0 0 1 3.586.23.55.55 0 0 1-.83.72 1.426 1.426 0 0 0-2.023-.13.55.55 0 1 1-.733-.82","M11.258 1.236c4.03 0 7.097 4.047 7.098 8.764s-3.069 8.762-7.098 8.763H8.743l-.375-.012C4.524 18.509 1.645 14.569 1.645 10c0-4.717 3.068-8.763 7.097-8.764zm-2.516 1.1c-3.202 0-5.998 3.31-5.998 7.664 0 4.355 2.796 7.663 5.998 7.663S14.74 14.355 14.74 10s-2.795-7.664-5.998-7.664m6.846 5.354c.164.74.253 1.516.253 2.31 0 3.134-1.356 5.97-3.446 7.522 2.699-.674 4.86-3.693 4.86-7.522a9.7 9.7 0 0 0-.275-2.31zm-.979-2.622q.396.718.672 1.523h1.35a8 8 0 0 0-.784-1.523zm-2.215-2.591a7.6 7.6 0 0 1 1.499 1.492h1.054c-.74-.738-1.614-1.258-2.553-1.492"],B="M11.258 1.236c4.03 0 7.097 4.047 7.098 8.764s-3.069 8.762-7.098 8.763H8.743l-.375-.012C4.524 18.509 1.645 14.569 1.645 10c0-4.717 3.068-8.763 7.097-8.764z",F=(0,v().YK)({currentSeriesName:{id:"aiUsageDashboard.creditUsage.chart.series.current",defaultMessage:"Current"},estimatedSeriesName:{id:"aiUsageDashboard.creditUsage.chart.series.estimated",defaultMessage:"Estimated"},monthlyLimitSeriesName:{id:"aiUsageDashboard.creditUsage.chart.series.monthlyLimit",defaultMessage:"Monthly limit"},creditsUnit:{id:"upgradeAction.credits",defaultMessage:"credits"}});function N({spaceId:e,startDate:t,endDate:n,showAdditionalUsageCards:a}){const o=(0,s().eP)(),r=(0,S().O4)({theme:o}),l=(0,k().uB)(void 0,M().A),c=(0,v().tz)(),d=t.startOf("day").toMillis(),g=n.startOf("day").toMillis(),{data:m,isLoading:h}=function(e,t,n){const a=(0,u().v3)(),[s,o]=(0,i.useState)(void 0),[r,l]=(0,i.useState)(!0),c=(0,i.useRef)(null),d=(0,i.useCallback)((async()=>{var i,s;if(!e||!t||!n)return null===(s=c.current)||void 0===s||s.abort(),c.current=null,void l(!1);null===(i=c.current)||void 0===i||i.abort(),c.current=null,l(!0);try{c.current=new AbortController;const i=await a.api.callCellCompatibleApi({eventName:"getAIDailyCreditUsage",environment:a,data:{spaceId:e,startDate:t,endDate:n},cellNavigation:{spaceId:e},abortSignal:c.current.signal});if("failed"===i.type)return void l(!1);o({usageData:i.data.usageData,projectionData:i.data.projectionData,totalMonthly:i.data.totalMonthly}),l(!1)}catch(r){if(r instanceof DOMException&&"AbortError"===r.name)return;p().log({level:"error",from:"useAIDailyUsage",type:"fetchDailyUsageFailed",data:{miscDataToConvertToString:{error:r,spaceId:e,startDate:t,endDate:n,userId:a.currentUser.id}}}),l(!1)}}),[a,e,t,n]);return(0,i.useEffect)((()=>(d(),()=>{var e;null===(e=c.current)||void 0===e||e.abort()})),[d]),{data:s,isLoading:r}}(e,d,g),f=(0,s().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:12}})),[]),y=(0,i.useMemo)((()=>e=>`url(data:image/svg+xml;charset=utf-8,${encodeURIComponent(e)})`),[]),x=(0,i.useMemo)((()=>{const e=`<path d="${B}" fill="#FFFFFF"/>`,t=R.map((e=>`<path d="${e}" fill="#000000"/>`)).join("");return y(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 34"><circle cx="17" cy="17" r="17" fill="#F5C84B" fill-opacity="0.5"/><g transform="translate(17 17) scale(-1.4 1.4) translate(-10 -10)">${e}${t}</g></svg>`)}),[y]),{usageData:I,projectionData:_,totalMonthly:P}=(0,i.useMemo)((()=>({usageData:(null==m?void 0:m.usageData)??[],projectionData:(null==m?void 0:m.projectionData)??[],totalMonthly:(null==m?void 0:m.totalMonthly)??0})),[m]),D=(0,i.useMemo)((()=>{const e=r.border.inversePrimary,t=r.border.secondary,n=r.blue.border.secondary,a=I.map((e=>({x:e.date,y:e.usage}))),i=_.map((e=>({x:e.date,y:e.usage}))),s=a.length>0?[{x:a[a.length-1].x,y:a[a.length-1].y}]:[];return[{name:c.formatMessage(F.currentSeriesName),type:"line",data:a,color:e,dashStyle:"Solid",lineWidth:2,zIndex:2},{type:"scatter",data:s,showInLegend:!1,enableMouseTracking:!1,opacity:1,states:{inactive:{opacity:1}},lineWidth:0,marker:{enabled:!0,symbol:x,width:34,height:34,states:{inactive:{opacity:1}}},clip:!1,zIndex:99},{name:c.formatMessage(F.estimatedSeriesName),type:"line",data:i,color:t,dashStyle:"Solid",lineWidth:2,zIndex:1},{name:c.formatMessage(F.monthlyLimitSeriesName),id:"monthlyLimit",type:"line",data:_.length>0?[[_[0].date,P],[_[_.length-1].date,P]]:[],color:n,dashStyle:"Solid",marker:{enabled:!1},lineWidth:2,dataLabels:{enabled:!0,formatter(){if(0!==this.point.index)return"";const e="number"==typeof this.y?this.y:P;return`${c.formatNumber(e)} ${c.formatMessage(F.creditsUnit)}`},align:"left",verticalAlign:"bottom",x:0,y:12,backgroundColor:r.background.primary,style:{color:r.blue.text.accentPrimary,fontWeight:"normal",textOutline:"none"},padding:6,borderRadius:6,borderWidth:0,reserveSpace:!1,allowOverlap:!0,crop:!1,overflow:"allow"},zIndex:3}]}),[r,x,c,I,_,P]),N=(0,i.useMemo)((()=>{const e=(0,T().A)(r),t={chart:{type:"line",height:300,spacingTop:0},title:{text:void 0},xAxis:{type:"datetime",tickPositioner(){const{dataMin:e,dataMax:t}=this.getExtremes();return[e,e+(t-e)/2,t]},gridLineWidth:0,minorGridLineWidth:0,tickLength:4,tickWidth:1,tickColor:r.border.primary,labels:{formatter(){const e=this.value;if("number"!=typeof e)return String(e);const t=new Date(e);return c.formatDate(t,{month:"short",day:"numeric"})},style:{color:r.text.secondary}},title:{text:void 0},lineColor:"transparent"},yAxis:{gridLineWidth:0,minorGridLineWidth:0,lineWidth:0,tickLength:0,tickWidth:0,maxPadding:.02,minPadding:0,endOnTick:!1,startOnTick:!1,labels:{enabled:!1},plotLines:[{id:"baseline",value:0,color:r.border.primary,width:1,zIndex:2}],visible:!0},tooltip:{enabled:!1},plotOptions:{series:{enableMouseTracking:!1,states:{hover:{enabled:!1},inactive:{opacity:1}},marker:{enabled:!1}}},legend:{enabled:!0,align:"left",verticalAlign:"bottom",layout:"horizontal",itemStyle:{color:r.text.secondary,fontWeight:"normal"}},series:D};return t.yAxis&&!Array.isArray(t.yAxis)&&(t.yAxis.labels={enabled:!1},t.yAxis.title={text:void 0},t.yAxis.gridLineWidth=0,t.yAxis.minorGridLineWidth=0),w().h1(e,t)}),[r,D,c]);return(0,b.jsxs)("div",{style:f.container,children:[(0,b.jsx)(j().Z,{value:l,children:(0,b.jsx)(A().A,{loadingProps:{isInitialLoading:h,isThrottledLoading:!1,initialLoadingSvg:()=>(0,b.jsx)(C().z,{chartType:"line",showCopy:!1})},chartOptions:N,containerHeight:300})}),a?(0,b.jsx)(E,{}):void 0]})}var L=()=>n(373009),O=()=>n(647621),V=()=>n(695115),z=()=>n(336610),W=()=>n(26697),U=()=>n(481975),H=()=>n(906380),K=()=>n(340498);const q={viewBox:"0 0 16 16",fittedViewBox:"2.37 2.37 13.3 13.3",svg:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("path",{d:"M4.25 2.375c-1.036 0-1.875.84-1.875 1.875v7.5c0 1.036.84 1.875 1.875 1.875h4.618l-.023-.093a4 4 0 0 1-.11-1.08l.003-.077H4.25a.625.625 0 0 1-.625-.625V5.632h8.75v3.106l.078-.003a4 4 0 0 1 1.079.11l.093.023V4.25c0-1.036-.84-1.875-1.875-1.875z"}),(0,b.jsx)("path",{d:"M7.053 6.407a.643.643 0 1 0 0 1.286.643.643 0 0 0 0-1.286m1.894 0a.643.643 0 1 0 0 1.286.643.643 0 0 0 0-1.286m1.893 0a.643.643 0 1 0 0 1.286.643.643 0 0 0 0-1.286M5.159 8.3a.643.643 0 1 0 0 1.287.643.643 0 0 0 0-1.286M7.053 8.3a.643.643 0 1 0 0 1.287.643.643 0 0 0 0-1.286M8.947 8.3a.643.643 0 1 0 0 1.287.643.643 0 0 0 0-1.286M10.84 8.3a.643.643 0 0 0-.483 1.068l.043.05.055-.037q.447-.299.968-.467l.063-.02-.012-.064a.64.64 0 0 0-.633-.53M12.6 9.525a3.075 3.075 0 1 0 0 6.15 3.075 3.075 0 0 0 0-6.15m-.425 1.409a.425.425 0 1 1 .85 0v1.665c0 .234-.19.425-.425.425l-.011-.001h-.018l-.036.002H10.92a.42.42 0 0 1-.41-.425c0-.237.185-.425.41-.425h1.255zm-7.016-.739a.643.643 0 1 0 0 1.286.643.643 0 0 0 0-1.286m1.894 0a.643.643 0 1 0 0 1.286.643.643 0 0 0 0-1.286m1.894 0a.643.643 0 0 0-.116 1.275l.064.012.02-.062c.111-.347.27-.672.468-.969l.037-.054-.05-.044a.64.64 0 0 0-.423-.158"})]})},$=(0,K().wt)("calendarBadgeClockSmall",q,"small"),G={viewBox:"0 0 16 16",fittedViewBox:"2.45 2.44 13.06 12.07",svg:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("path",{d:"M14.371 8.597a.625.625 0 0 1 1.014.732l-3.559 4.925a.627.627 0 0 1-.941.083l-2.372-2.299a.625.625 0 1 1 .869-.897l1.853 1.794z"}),(0,b.jsx)("path",{d:"M11.75 2.45a1.8 1.8 0 0 1 1.8 1.8v3.392a2 2 0 0 0-.192.223l-.908 1.256V5.557h-8.9v6.193a.7.7 0 0 0 .7.7h3.033q.136.266.36.487l.632.613H4.25a1.8 1.8 0 0 1-1.8-1.8v-7.5a1.8 1.8 0 0 1 1.8-1.8z"}),(0,b.jsx)("path",{d:"M5.16 10.27a.569.569 0 1 1-.001 1.137.569.569 0 0 1 0-1.137m1.894 0a.569.569 0 1 1 0 1.137.569.569 0 0 1 0-1.137M5.16 8.376a.569.569 0 1 1-.001 1.137.569.569 0 0 1 0-1.137m1.894 0a.568.568 0 1 1 0 1.137.568.568 0 0 1 0-1.137m1.894 0a.569.569 0 1 1 0 1.137.569.569 0 0 1 0-1.137m1.893 0a.569.569 0 1 1 0 1.137.569.569 0 0 1 0-1.137M7.053 6.481a.569.569 0 1 1 0 1.138.569.569 0 0 1 0-1.138m1.894 0a.569.569 0 1 1 0 1.138.569.569 0 0 1 0-1.138m1.893 0a.569.569 0 1 1 0 1.138.569.569 0 0 1 0-1.138"})]})},Y=(0,K().wt)("calendarCheckSmall",G,"small");function Q(e){const{currentDateRange:t,canGoPrevious:n,canGoNext:a,onPrevious:i,onNext:s,isCurrentRange:o}=e,r=(0,v().tz)(),l=r.formatDate(t.start,{month:"short",day:"numeric"}),c=r.formatDate(t.end,{month:"short",day:"numeric"}),d=o?r.formatMessage(J.current):r.formatMessage(J.dateRange,{startDate:l,endDate:c}),u=o?r.formatMessage(J.dateRange,{startDate:l,endDate:c}):void 0;return(0,b.jsxs)(h().Ye,{alignItems:"center",gap:8,children:[(0,b.jsxs)(h().Ye,{alignItems:"center",gap:4,children:[(0,b.jsx)(f().I,{icon:o?Y:$,colorVariant:"primary"}),u?(0,b.jsx)(W().m,{renderTooltip:()=>u,render:e=>(0,b.jsx)(z().D,{styleKey:"bodyRegular",colorVariant:"primary",...e,children:d})}):(0,b.jsx)(z().D,{styleKey:"bodyRegular",colorVariant:"primary",children:d})]}),(0,b.jsx)(V().A,{ariaLabel:r.formatMessage(J.previousDateRange),icon:U().s,onClick:i,disabled:!n}),(0,b.jsx)(V().A,{ariaLabel:r.formatMessage(J.nextDateRange),icon:H().arrowChevronSingleRightSmallIcon,onClick:s,disabled:!a})]})}const J=(0,v().YK)({dateRange:{id:"aiUsageDashboard.dateRange",defaultMessage:"{startDate} - {endDate}"},previousDateRange:{id:"aiUsageDashboard.previousDateRange",defaultMessage:"Previous date range"},nextDateRange:{id:"aiUsageDashboard.nextDateRange",defaultMessage:"Next date range"},current:{id:"aiUsageDashboard.current",defaultMessage:"Current Period"}});function X(e){const{usage:t,limit:n,currentDateRange:a,canGoPrevious:i=!1,canGoNext:o=!1,onPrevious:r,onNext:l,isCurrentRange:c=!1,onAddCreditsClick:d}=e,u=(0,v().tz)(),p=(0,s().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:8},topRow:{display:"flex",alignItems:"center",justifyContent:"space-between"},rightSection:{display:"flex",alignItems:"center",gap:12}})),[]);return(0,b.jsx)("div",{style:p.container,children:(0,b.jsxs)("div",{style:p.topRow,children:[(0,b.jsx)(y().D,{styleKey:"titleLgBold",colorVariant:"primary",children:u.formatMessage(O().sm.creditUsage,{usage:u.formatNumber(t),limit:u.formatNumber(n)})}),a?(0,b.jsxs)("div",{style:p.rightSection,children:[(0,b.jsx)(Q,{currentDateRange:a,canGoPrevious:i,canGoNext:o,onPrevious:r,onNext:l,isCurrentRange:c}),d?(0,b.jsx)(L().E,{size:"md",colorPalette:"blue",onClick:d,children:(0,b.jsx)(v().sA,{id:"aiUsageDashboard.creditUsage.addCredits",defaultMessage:"Add AI credits"})}):void 0]}):void 0]})})}var Z=()=>n(699143),ee=()=>n(127833),te=()=>n(250910),ne=()=>n(546926),ae=()=>n(940148),ie=()=>n(890492),se=()=>n(81068),oe=()=>n(663639),re=()=>n(736847),le=()=>n(126617),ce=()=>n(253673),de=()=>n(284371);function ue(){const e=(0,v().tz)(),t=(0,i.useMemo)((()=>[{key:"actions",render:e=>(0,b.jsx)(re().A,{...e}),items:[{key:"custom-agent-controls",render:t=>(0,b.jsx)(se().A,{...t,title:e.formatMessage(ge.customAgentControls)}),action:()=>{}},{key:"enable-disable",render:t=>(0,b.jsx)(se().A,{...t,title:e.formatMessage(ge.enableDisable)}),action:()=>{}},{key:"cost-caps",render:t=>(0,b.jsx)(se().A,{...t,title:e.formatMessage(ge.costCaps)}),action:()=>{}}]}]),[e]);return(0,b.jsx)(te().A,{popupType:ee().nl.Popup,renderOrigin:t=>(0,b.jsx)(V().A,{ariaLabel:e.formatMessage(ge.entityActionsMenu),icon:le().ellipsisSmallIcon,...t}),render:e=>(0,b.jsx)(ie().A,{menuType:ne().gu.Popup,width:200,children:(0,b.jsx)(oe().A,{type:oe().O.Vertical,initialFocus:void 0,sections:t})}),alignmentToOrigin:"end",originGap:2})}function pe(e){const{entities:t,canGoPrevious:n,canGoNext:a,onPreviousPage:o,onNextPage:r}=e,l=(0,v().tz)(),c=(0,i.useMemo)((()=>t?t.map((e=>({id:e.id,isClickable:!1,iconUrl:e.icon,name:e.name??l.formatMessage(ge.unknownEntity),creditsUsed:e.usage}))):[]),[t,l]),d=(0,s().IS)((()=>({iconContainer:{width:20,height:20,borderRadius:10,overflow:"hidden"},nameText:{...de().RC,fontWeight:de().Wy.regular},noDataContainer:{padding:24,textAlign:"center",color:S().Tj.text.secondary}})),[]),u=(0,i.useMemo)((()=>[{id:"name",headerTitle:l.formatMessage(ge.nameColumn),widthData:{widthPercent:100,minWidth:200},sortable:!1,headerStyle:{paddingInlineStart:6},rowStyle:{paddingInlineStart:6},renderCell:e=>(0,b.jsxs)(h().Ye,{alignItems:"center",gap:6,children:[e.iconUrl?(0,b.jsx)("img",{src:e.iconUrl,style:d.iconContainer,alt:""}):(0,b.jsx)(Z().Y1,{direction:"horizontal",align:"center",style:d.iconContainer,children:(0,b.jsx)(f().I,{icon:ce().personIcon,size:"default",colorVariant:"secondary"})}),(0,b.jsx)("div",{style:d.nameText,children:e.name})]})},{id:"creditsUsed",headerTitle:l.formatMessage(ge.creditsUsedColumn),widthData:{width:120},sortable:!1,renderCell:e=>(0,b.jsx)(y().D,{styleKey:"bodyRegular",children:e.creditsUsed.toLocaleString()})},{id:"actions",headerTitle:"",widthData:{width:28},sortable:!1,renderCell:()=>(0,b.jsx)(ue,{})}]),[d,l]),p=(0,i.useMemo)((()=>(0,ae().rC)({columnRenderInfo:u})),[u]);return t?(0,b.jsxs)("div",{style:{paddingBlockEnd:12},children:[(0,b.jsx)("div",{style:{paddingInlineStart:6},children:(0,b.jsx)(y().D,{styleKey:"bodyMedium",colorVariant:"primary",children:(0,b.jsx)(v().sA,{id:"aiUsageDashboard.creditDetails.title",defaultMessage:"This months usage"})})}),(0,b.jsx)(ae().WE,{columnRenderInfo:u,rows:c,styles:p,showRowBorders:!0,hideHeaderRowPadding:!0,renderNoRowsComponent:()=>(0,b.jsx)("div",{style:d.noDataContainer,children:l.formatMessage(ge.noData)})}),(0,b.jsxs)(h().Ye,{justifyContent:"flex-end",alignItems:"center",gap:8,style:{paddingBlockStart:12},children:[(0,b.jsx)(V().A,{ariaLabel:l.formatMessage(ge.previousPage),icon:U().s,onClick:o,disabled:!n}),(0,b.jsx)(V().A,{ariaLabel:l.formatMessage(ge.nextPage),icon:H().arrowChevronSingleRightSmallIcon,onClick:r,disabled:!a})]})]}):null}const ge=(0,v().YK)({nameColumn:{id:"aiUsageDashboard.topEntities.nameColumn",defaultMessage:"Name"},creditsUsedColumn:{id:"aiUsageDashboard.topEntities.creditsUsedColumn",defaultMessage:"Credits used"},noData:{id:"aiUsageDashboard.topEntities.noData",defaultMessage:"No data available"},unknownEntity:{id:"aiUsageDashboard.topEntities.unknownEntity",defaultMessage:"Unknown"},entityActionsMenu:{id:"aiUsageDashboard.topEntities.entityActionsMenu",defaultMessage:"Entity actions"},customAgentControls:{id:"aiUsageDashboard.topEntities.customAgentControls",defaultMessage:"Custom Agent controls"},enableDisable:{id:"aiUsageDashboard.topEntities.enableDisable",defaultMessage:"Enable/disable"},costCaps:{id:"aiUsageDashboard.topEntities.costCaps",defaultMessage:"Cost Caps for CA"},previousPage:{id:"aiUsageDashboard.topEntities.previousPage",defaultMessage:"Previous page"},nextPage:{id:"aiUsageDashboard.topEntities.nextPage",defaultMessage:"Next page"}});function me({spaceStore:e}){const t=e.id,[n,h]=(0,i.useState)(0),[f,y]=(0,i.useState)(void 0),v=(0,o().lh)({spaceId:t}),S=(0,l().N8)(v),{dateRanges:x,isLoading:k}=(0,d().C)(t),w=x[x.length-1-n],C=null==w?void 0:w.start.getTime(),{usage:A,limits:T,isLoading:j}=(0,c().$)(t,C),M=(0,i.useMemo)((()=>({spaceId:t,servicePeriodStart:C,limit:10,cursor:f})),[t,C,f]),{entities:_,next_cursor:P,previous_cursor:D,isLoading:E}=function(e){var t,n,a;const i=(0,u().v3)(),[s]=(0,g().Yb)((async()=>{if(e.spaceId&&void 0!==e.servicePeriodStart)try{return await(0,m().vm)({environment:i,...e})}catch(t){throw p().log({level:"error",from:"useTopEntitiesByUsage",type:"fetchTopEntitiesFailed",data:{miscDataToConvertToString:{error:t,request:e,userId:i.currentUser.id}}}),t}}),[i,e],{debugName:"useTopEntitiesByUsage"});return{entities:null===(t=s.value)||void 0===t?void 0:t.entities,next_cursor:null===(n=s.value)||void 0===n?void 0:n.next_cursor,previous_cursor:null===(a=s.value)||void 0===a?void 0:a.previous_cursor,isLoading:"pending"===s.status||"idle"===s.status}}(M);(0,i.useEffect)((()=>{y(void 0)}),[t,C]);const R=k||j||E,B=(0,s().IS)((()=>({loadingContainer:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"}})),[]);if(R)return(0,b.jsx)("div",{style:B.loadingContainer,children:(0,b.jsx)(r().k,{})});if(0===x.length)return null;const F=0===n,L=(null==A?void 0:A.currentServicePeriod.spaceUsage)??0,O=(null==T?void 0:T.purchased.totalLimit)??0,V=void 0!==D,z=void 0!==P;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{style:{paddingBlockEnd:32},children:(0,b.jsx)(X,{usage:L,limit:O,currentDateRange:w,canGoPrevious:n<x.length-1,canGoNext:n>0,onPrevious:()=>h(n+1),onNext:()=>h(n-1),isCurrentRange:F,onAddCreditsClick:()=>{}})}),(0,b.jsx)(N,{spaceId:t,startDate:a().DateTime.fromJSDate(w.start),endDate:a().DateTime.fromJSDate(w.end),showAdditionalUsageCards:S}),(0,b.jsx)("div",{style:{paddingInlineStart:6,paddingBlockEnd:12},children:(0,b.jsx)(I,{})}),t&&C?(0,b.jsx)(pe,{entities:_,canGoPrevious:V,canGoNext:z,onPreviousPage:()=>{D&&y(D)},onNextPage:()=>{P&&y(P)}}):void 0]})}},429145:(e,t,n)=>{n.d(t,{ZR:()=>B,c7:()=>F,lN:()=>R});n(16280),n(898992),n(354520),n(803949),n(581454);var a=n(296540),i=()=>n(564884),s=()=>n(664594),o=()=>n(755531),r=()=>n(242422),l=()=>n(590526),c=()=>n(675133),d=()=>n(443541),u=()=>n(938108),p=()=>n(17217),g=()=>n(522419),m=()=>n(206267),h=()=>n(363497),f=()=>n(234459),y=()=>n(84262),v=()=>n(220719),S=()=>n(99895),b=()=>n(496603),x=()=>n(763824),I=()=>n(498212),k=()=>n(973647),w=()=>n(534177),C=()=>n(720665),A=()=>n(892632),T=()=>n(989826),j=()=>n(388066),M=()=>n(975445),_=()=>n(995277),P=()=>n(150984),D=()=>n(631611),E=()=>n(390366);function R(e){const{onError:t,onSuccess:n,onStart:i,onComplete:s,environment:o,bucket:r,record:l,accept:d="image/png, image/jpeg"}=e,[u,p]=(0,a.useState)(!1);return{uploadFile:(0,a.useCallback)((async()=>{const e=await A().dA({environment:o,supportsMobileNativeFileUpload:!1,multiple:!1,accept:d});if(0===e.length)return;const a=e[0],u=(0,g().QC)(a.name),h=m().Dt(),f=a instanceof File?new File([a],`${h}${u}`,{type:a.type}):a;if(a.size>2097152)return t({message:c().A.formatMessage(F.fileTooLarge),type:"size"}),null==s||s(),void p(!1);const y={environment:o,file:f,onStart:()=>{null==i||i(),p(!0)},onError:e=>{t({message:c().A.formatMessage(F.uploadError),type:"upload",error:e}),null==s||s(),p(!1)},onComplete:e=>{n(e,a.name),null==s||s(),p(!1)}};"secure"===r&&l?A().QM({...y,bucket:r,record:l,isFileBlock:!1}):A().QM({...y,bucket:"public"})}),[o,t,i,n,s,r,l,d]),isUploading:u}}function B(e){const{onError:t,onSuccess:n,onStart:g,environment:m,threadStore:R,workflowId:B}=e,[N,L]=(0,a.useState)(void 0),O=(0,D().jw)(),V=(0,a.useRef)(new(S().G)((()=>(0,I().Ay)()))),z=(0,l().K8)((()=>{var e;return null===(e=(0,o().S)())||void 0===e?void 0:e.getSpaceId()}),[]),{aiSessionId:W,aiDraftInferenceId:U}=(0,M().N)({threadStore:R,spaceId:z}),H=(0,s().T)(),K=(0,a.useRef)(0),q=(0,a.useRef)(0),$=(0,a.useCallback)(((e,a)=>{var i;if(k().Q.isFail(e)){const{code:n,message:i,error:s}=e.error,o=(0,j().zR)(n,i,s);return void t({message:o.message,type:"upload",error:o.error,files:[a],errorCode:o.code})}const s=(0,d().mM)({attachment:e.value,failOnRiskyAttachments:!1});if(k().Q.isFail(s)){const{code:e,message:n,error:i}=s.error,o=(0,j().zR)(e,n,i);return void t({message:o.message,type:"upload",error:o.error,files:[a],errorCode:o.code})}let o=0;if("application/pdf"===e.value.contentType&&null!==(i=e.value.metadata)&&void 0!==i&&i.numPages){o=e.value.metadata.numPages;if((0,b().qE)(p().gD-K.current-o,0,p().gD)<=0)return void t({message:c().A.formatMessage(F.noRemainingPagesForUpload,{maxPageCount:p().gD}),type:"upload",errorCode:"PDF_TOO_MANY_PAGES",error:new Error("PDF has too many pages"),files:[a]})}K.current+=o,n({...e.value,uploadIdentifier:a.fileId})}),[t,n]),G=(0,a.useCallback)(((e,n)=>{t({message:c().A.formatMessage(F.uploadError),type:"upload",error:e,files:[n],errorCode:"INTERNAL_ERROR",offline:!1})}),[t]);return{uploadFiles:(0,a.useCallback)((async n=>{const{files:a,method:s}=n,{assistantSessionPointer:o,analyticsArgs:l}=e,d=V.current;if(null==a||a.forEach((e=>{d.set(e.name,(0,I().Ay)())})),K.current=0,"clicked_attachment_button"===s?(0,i().u)({environment:m,event:{eventName:"click_ai_chat_attachment_button",eventProperties:{config_type:null==l?void 0:l.configType,source:null==l?void 0:l.source,ai_session_id:W,ai_inference_id:U}}}):"paste"===s||"page_block"===s||(0,w().HB)(s),!z)return;const S=o??{id:U,table:f().To,spaceId:z},k=await async function(e){const{environment:t,assistantSurfaceType:n,spaceId:a,assistantChatStepSessionPointer:i,files:s}=e,o=async()=>{const{sessionId:e}=await(0,_().p)({makeActiveSession:!0,environment:t});return await(0,P().upsertStepToChatSessionHistory)({sessionId:e,environment:t,assistantSurfaceType:n}),{id:e,table:h().TF,spaceId:a}},l=async()=>{const e=r().default.checkGate({gateName:"assistant_enable_heic_image_support"}),n=await A().dA({environment:t,supportsMobileNativeFileUpload:!1,multiple:!0,accept:(0,p().QV)({enableHeicSupport:e}),focus:!1});if(0!==n.length)return n};if(!s||0===s.length){if(!i){const[e,t]=await Promise.allSettled([o(),l()]);return"rejected"===e.status?{type:"failure",error:new Error("Failed to create chat history session")}:"rejected"!==t.status&&t.value?{type:"success",files:t.value,assistantChatStepSessionPointer:e.value}:{type:"failure",error:new Error("Failed to pick file")}}const e=await l();return e?{type:"success",files:e,assistantChatStepSessionPointer:(0,v().o9)(i)}:{type:"failure",error:new Error("Failed to pick file")}}if(!i)return{type:"success",files:s,assistantChatStepSessionPointer:await o()};return{type:"success",files:s,assistantChatStepSessionPointer:i}}({environment:m,assistantSurfaceType:O.type,spaceId:z,assistantChatStepSessionPointer:S,files:a});if("success"===k.type){const{assistantChatStepSessionPointer:e}=k;K.current=(0,j().A7)(e,m),q.current=(0,j().kb)(e,m)}const M=(null==a?void 0:a.filter((e=>"application/pdf"===e.type)).length)||0,D=(0,b().qE)(p().gD-(K.current+M),0,p().gD);if(M>0&&0===D)return void t({message:c().A.formatMessage(F.assistantPdfTooManyPages,{maxPageCount:D}),type:"upload",error:new Error("PDF has too many pages"),errorCode:"PDF_TOO_MANY_PAGES",files:Array.from(d).map((([e,t])=>({fileName:e,fileId:t})))});if("failure"===k.type)return void t({message:c().A.formatMessage(F.somethingWentWrong),type:"upload",error:k.error,files:Array.from(d).map((([e,t])=>({fileName:e,fileId:t})))});const{assistantChatStepSessionPointer:R,files:N}=k;await(0,x().lX)(N,10,(async e=>{const n=(0,p().F0)(e.type),a=e.name,i=d.get(a);if(n.error)return void t({message:c().A.formatMessage(F.invalidFileType),type:"upload",error:n.error,files:[{fileName:a,fileId:i}]});const{mimeType:r,extension:h}=n.value,v=(0,I().Ay)(),S=e instanceof File?new File([e],`${v}${h}`,{type:e.type}):e,b=await(0,E().B)(m,{name:(0,p().CE)(r),spaceId:z,userId:H,amount:e.size});if(!(0,y().e2)(b))return void t({message:c().A.formatMessage(F.assistantFileTooLarge,{fileSize:"unlimited"!==b.limit.amount?b.limit.amount/C().Bu:0}),type:"size",files:[{fileName:e.name,fileId:i}],errorCode:"FILE_SIZE_EXCEEDS_MAX_SIZE"});const x={environment:m,file:S,bypassFreeFileUploadLimitCheck:!0,onStart:()=>{null==g||g(),L({fileName:a,progress:0,uniqueFileIdentifier:i,contentType:r})},onError:n=>{t({message:c().A.formatMessage(F.uploadError),type:"upload",errorCode:n.code,error:n,files:[{fileName:e.name,fileId:i}]})},onProgress:e=>{const{progressPercent:t}=e;if(!t)return;const n=(0,u().tD)({step:"upload",fileType:r,progressPercentDecimal:t/100});L({fileName:a,progress:n,uniqueFileIdentifier:i,contentType:r})},onComplete:(t,n,a)=>{if(!t)return;const s={fileName:e.name,fileId:i};(0,T().v)({originalFileUrl:t,fileId:i,threadPointer:R,fileName:e.name,contentType:r,environment:m,progressCallback:L}).then((e=>$(e,s))).catch((e=>G(e,s)))}};A().qL({...x,assistantChatTranscriptSessionPointer:R,workflowId:B,analyticsArgs:{configType:null==l?void 0:l.configType,source:null==l?void 0:l.source,frameworkForLogging:(null==o?void 0:o.table)===f().To?"inference_transcript":"assistant",method:s}})}))}),[z,H,e,m,t,g,O.type,$,G,W,U,B]),uploadProgress:N}}const F=(0,n(69708).YK)({pdfTooManyPages:{id:"useFileUpload.pdfTooManyPages",defaultMessage:"Please limit the PDF to {maxPageCount} pages or less."},fileTooLarge:{id:"creatorProfile.useFileUpload.fileTooLarge",defaultMessage:"Please limit file size to 10MB or less."},assistantFileTooLarge:{id:"useFileUpload.assistantFileTooLarge",defaultMessage:"Please limit the file size to {fileSize}MB or less."},assistantPdfFileNoContent:{id:"useFileUpload.assistantPdfFileNoContent",defaultMessage:"Unable to extract text. Note that reading images within PDFs is not supported."},assistantPdfTooManyPages:{id:"useFileUpload.assistantPdfTooManyPages",defaultMessage:"Please limit the PDF file to {maxPageCount} pages or less."},uploadError:{id:"creatorProfile.useFileUpload.uploadError",defaultMessage:"Failed to upload the file. Please try again."},invalidFileType:{id:"useFileUpload.invalidFileType",defaultMessage:"Unable to upload this file type. Please select a different type"},failedToRetrieveFile:{id:"useFileUpload.failedToRetrieveFile",defaultMessage:"Unable to find the file."},missingFileSize:{id:"useFileUpload.missingFileSize",defaultMessage:"File metadata is missing. Re-uploading may resolve this issue."},somethingWentWrong:{id:"useFileUpload.somethingWentWrong",defaultMessage:"Something went wrong. Please try again later"},noRemainingPagesForUpload:{id:"useFileUpload.noRemainingPagesForUpload",defaultMessage:"You have reached the maximum of {maxPageCount} PDF pages per session."},passwordProtected:{id:"useFileUpload.passwordProtected",defaultMessage:"The file is password protected."},corruptedFile:{id:"useFileUpload.corruptedFile",defaultMessage:"The file is corrupted or invalid."},moderationFlagged:{id:"useFileUpload.moderationFlagged",defaultMessage:"The content of this file has been flagged by moderation and cannot be used."},csvTooManyRowsAndColumns:{id:"useFileUpload.csvTooManyRowsAndColumns",defaultMessage:"For CSVs that exceed {maxRowCount} rows and {maxColCount} columns, please import the CSV as a database."},csvTooLarge:{id:"useFileUpload.csvTooLarge",defaultMessage:"Please limit the CSV to {maxSize} or less."}})},434990:(e,t,n)=>{n.d(t,{_:()=>i});class a extends(()=>n(757695))().Store{getInitialState(){return{shouldRenderTextPrompt:!1}}getShouldRenderTextPrompt(){return this.state.shouldRenderTextPrompt}}const i=new a},441738:(e,t,n)=>{n.d(t,{Mc:()=>i,Nf:()=>o,dx:()=>s});n(16280),n(898992),n(672577),n(737550);var a=()=>n(416845);const i=["ai_add_on_employee_discount_monthly","ai_add_on_employee_discount_yearly"],s=["ai_add_on_standard_sales_assisted","ai_add_on_standard_sales_assisted_eur","ai_add_on_standard_sales_assisted_gbp","ai_add_on_standard_sales_assisted_jpy","ai_add_on_standard_sales_assisted_krw","ai_add_on_employee_discount_monthly","ai_add_on_employee_discount_yearly","ai_add_on_marketing_discount_monthly","ai_add_on_marketing_discount_yearly","sites_custom_hostnames_add_on_sales_assisted_gbp","sites_custom_hostnames_add_on_sales_assisted_usd","sites_custom_hostnames_add_on_sales_assisted_eur","sites_custom_hostnames_add_on_sales_assisted_jpy","sites_custom_hostnames_add_on_sales_assisted_krw","ai_add_on_standard_trial_monthly_usd","ai_add_on_standard_trial_yearly_usd","ai_add_on_standard_trial_monthly_eur","ai_add_on_standard_trial_yearly_eur","ai_add_on_standard_trial_monthly_gbp","ai_add_on_standard_trial_yearly_gbp","ai_add_on_standard_trial_monthly_jpy","ai_add_on_standard_trial_yearly_jpy","ai_add_on_standard_trial_monthly_krw","ai_add_on_standard_trial_yearly_krw",...["ai_add_on_standard_monthly_10","ai_add_on_standard_monthly_eur","ai_add_on_standard_monthly_gbp","ai_add_on_standard_monthly_jpy","ai_add_on_standard_monthly_krw","ai_add_on_standard_yearly_96","ai_add_on_standard_yearly_eur","ai_add_on_standard_yearly_gbp","ai_add_on_standard_yearly_jpy","ai_add_on_standard_yearly_krw","sites_custom_hostnames_add_on_monthly_usd","sites_custom_hostnames_add_on_yearly_usd","sites_custom_hostnames_add_on_monthly_eur","sites_custom_hostnames_add_on_yearly_eur","sites_custom_hostnames_add_on_monthly_gbp","sites_custom_hostnames_add_on_yearly_gbp","sites_custom_hostnames_add_on_monthly_jpy","sites_custom_hostnames_add_on_yearly_jpy","sites_custom_hostnames_add_on_monthly_krw","sites_custom_hostnames_add_on_yearly_krw","ai_credit_pack_100_monthly_usd","ai_credit_pack_100_yearly_usd","ai_credit_pack_100_monthly_eur","ai_credit_pack_100_yearly_eur","ai_credit_pack_100_monthly_gbp","ai_credit_pack_100_yearly_gbp","ai_credit_pack_100_monthly_jpy","ai_credit_pack_100_yearly_jpy","ai_credit_pack_100_monthly_krw","ai_credit_pack_100_yearly_krw"]];function o(e){return e===a()._D_}Error},443541:(e,t,n)=>{n.d(t,{mM:()=>o});n(16280);var a=()=>n(973647),i=()=>n(17217);const s=["text/csv"];function o(e){var t,n,o,r,l,c,d;const{attachment:u,failOnRiskyAttachments:p=!0}=e;if(p&&"risky"===(null===(t=u.metadata)||void 0===t||null===(t=t.guardrail)||void 0===t?void 0:t.attachmentRisk))return a().Q.fail({code:"ATTACHMENT_RISKY",message:"Attachment is risky",error:new Error("Attachment is risky")});var g;if(s.includes(u.contentType)&&(null!==(g=u.metadata)&&void 0!==g&&g.fileSizeBytes&&u.metadata.fileSizeBytes>i().CR))return a().Q.fail({code:"FILE_SIZE_EXCEEDS_MAX_SIZE",message:"Exceeds the maximum file size",error:new Error("Inline file size exceeds the maximum")});if(null!==(n=u.metadata)&&void 0!==n&&n.fileSizeBytes&&u.metadata.fileSizeBytes>i().Mf)return a().Q.fail({code:"FILE_SIZE_EXCEEDS_MAX_SIZE",message:"Exceeds the maximum file size",error:new Error("Image file size exceeds the maximum")});switch(u.contentType){case"application/pdf":return null!==(o=u.metadata)&&void 0!==o&&o.numPages&&u.metadata.numPages>i().gD?a().Q.fail({code:"PDF_TOO_MANY_PAGES",message:"Exceeds the maximum number of pages",error:new Error("PDF has too many pages")}):a().Q.success(void 0);case"text/csv":return null!==(r=u.metadata)&&void 0!==r&&r.fileSizeBytes&&u.metadata.fileSizeBytes>i().gB?a().Q.fail({code:"CSV_TOO_LARGE",message:"Exceeds the maximum size of CSV content",error:new Error("CSV content is too large")}):null!==(l=u.metadata)&&void 0!==l&&l.numRows&&u.metadata.numRows>i().ks||null!==(c=u.metadata)&&void 0!==c&&c.numFields&&u.metadata.numFields>i().qV?a().Q.fail({code:"CSV_TOO_MANY_ROWS_AND_COLUMNS",message:"Exceeds the maximum number of rows",error:new Error("CSV has too many rows")}):a().Q.success(void 0);case"image/jpeg":case"image/png":case"image/webp":case"image/gif":case"image/heic":return"flagged"===(null===(d=u.metadata)||void 0===d||null===(d=d.moderation)||void 0===d?void 0:d.status)?a().Q.fail({code:"MODERATION_FAILED",message:"Moderation failed",error:new Error("Moderation failed")}):a().Q.success(void 0);default:return a().Q.success(void 0)}}},445770:(e,t,n)=>{n.d(t,{Bm:()=>W,bK:()=>U});n(16280),n(811558),n(898992),n(354520),n(672577),n(803949),n(581454);var a=()=>n(498212),i=()=>n(973647),s=()=>n(534177),o=()=>n(638681),r=()=>n(412412),l=()=>n(416504),c=()=>n(128713),d=()=>n(792071),u=()=>n(328876),p=()=>n(251582),g=()=>n(388821),m=()=>n(179034),h=()=>n(798880),f=()=>n(24279),y=()=>n(670913);var v=()=>n(353566),S=()=>n(691309),b=()=>n(925193),x=()=>n(471159);n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);var I=()=>n(496603),k=()=>n(832443);const w={id:!0,"page-id":!0,"database-id":!0,"data-source-id":!0,"person-id":!0,"person-name":!1,href:!0,category:!1,option:!1,format:!1,number:!1,date:!1,time:!1,"start-date":!1,"start-time":!1,"end-date":!1,"end-time":!1,"synced-property-name":!1,"synced-block-id":!0,"external-id":!1,index:!1,name:!1,equation:!1};function C(e,t,n){const a={...t};if("block"===a.type){return a.children=a.children.map((t=>e.mapCounterToKeyInModeOrThrow(t,"block_counter"))),(0,s().O9)(a.parent)&&(a.parent=e.mapCounterToKeyInModeOrThrow(a.parent,"block_counter")),a.attributes=A(e,a.attributes,n),a.properties=T(e,a.properties,n),a.schemas=T(e,a.schemas,n),a.schemaId=e.mapCounterToKey(a.schemaId).key,a}if("property"===a.type||"schema"===a.type||"inline"===a.type){a.attributes=A(e,a.attributes,n);const t=a.children;return a.children=t.map((t=>C(e,t,n))),a}if("text"===a.type)return a;if("move"===a.type)return a.attributes=A(e,a.attributes,n),a;throw new Error(`Unknown node type: ${a}`)}function A(e,t,n){if(!t)return t;const i={...t};for(const[o,r]of Object.entries(w)){if(!r)continue;const t=i[o];if(t){if(!(0,k().D4)(t))continue;if("href"===o)i[o]=k().tD.mapHrefCounterToUrl(e,t);else try{i[o]=e.mapCounterToKey(t).key}catch(s){if(!(s instanceof k().V6)||"person-id"!==o&&"page-id"!==o&&"database-id"!==o)throw s;{let e=n.keyMap.find((e=>e.counter===t));e||(e={key:{type:"person-id"===o?"person":"block",key:(0,a().gB)(`fake-id-${t}`)},counter:t},n.keyMap.push(e)),i[o]=e.key.key}}}}return i}function T(e,t,n){const a={};for(const[i,s]of Object.entries(t))s&&(a[i]=C(e,s,n));return a}var j=()=>n(206267);const M=["<insert-inside","<set-tag-name","<set-title","<create>","<delete id="];var _=()=>n(331119);const P=p().p.mapResult((0,_().U5)("search-people-results"),(e=>{const t=(0,_().ke)({inputAttributes:e.attributes,definitions:{"current-results":{required:!0,values:!0,description:"the number of results returned in this response"},"total-results":{required:!0,values:!0,description:"the total number of results available"}},tagName:e.tagName,mapCounterToKey:void 0});if(i().Q.isFail(t))return t;const a=p().p.mapResult((0,_().U5)("person"),(e=>{var t;if(null===(t=e.attributes)||void 0===t||!t["person-id"])return{error:new(n(181856).HQ)({attributeName:"person-id",tagName:"person"})};const a=e.attributes["person-id"],s=(e,t)=>p().p.mapResult((0,_().U5)(e),(e=>{const n=(0,p().$d)(p().p.many(_().W6),e.children??[]);if(i().Q.isFail(n))return n;const a=n.value;return{value:{type:t,value:a.map((e=>e.value)).join("")}}})),o=(0,p().$d)(p().p.many(p().p.choice([s("property-text","name"),s("property-email","email")])),e.children??[]);if(i().Q.isFail(o))return o;const r=o.value.find((e=>"email"===e.type)),l=o.value.find((e=>"name"===e.type));return r&&l?{value:{id:a,name:l.value,email:r.value}}:{error:new Error("Invalid email or name")}})),s=(0,p().$d)(p().p.manyTill(a,p().p.eof()),e.children??[]);return i().Q.isFail(s)?s:{value:{currentResults:parseInt(t.value["current-results"]),totalResults:parseInt(t.value["total-results"]),results:s.value}}}));const D={6:new class{migrateStartStateAndTranscriptSteps(e,t){return(async()=>({migratedStartState:await this.migrateStartState(e,t),migratedTranscriptSteps:await this.migrateStartTranscriptSteps(t,e)}))()}migrateStartState(e,t){const n={context:{...e.context},pages:e.pages,selection:void 0,searchResults:[],queryDatabaseResults:[],searchPeopleResults:[]};return Promise.resolve(n)}migrateStartTranscriptSteps(e,t){return Promise.resolve(e??[{type:"context",context:t.context}])}},7:new class{constructor(){this.includeLimitInPersonPropertySchemaNode=e=>{if("element"===e.type&&"schema-property-person"===e.tagName){var t;return{...e,attributes:{...e.attributes,limit:(null===(t=e.attributes)||void 0===t?void 0:t.limit)??"Infinity"}}}return"element"===e.type?{...e,children:e.children?e.children.map(this.includeLimitInPersonPropertySchemaNode.bind(this)):[]}:e}}migrateStartStateAndTranscriptSteps(e,t){return(async()=>({migratedStartState:await this.migrateStartState(e,t),migratedTranscriptSteps:await this.migrateStartTranscriptSteps(t,e)}))()}dedupeTranscript(e){const t=I().mg(e),n=[];for(const a of t)"observation"===a.type&&"page"===a.observationType&&(n.includes(a.pageId)?a.duplicate=!0:n.push(a.pageId));return t.filter((e=>!0!==e.duplicate))}migrateStartState(e,t){return{...e,context:{...e.context,"available-commands":v().Eo},pages:e.pages.map((e=>(0,r()._o)(this.includeLimitInPersonPropertySchemaNode((0,r().BD)(e)[0])))),searchResults:(e.searchResults??[]).map((e=>(0,r()._o)(this.includeLimitInPersonPropertySchemaNode((0,r().BD)(e)[0])))),queryDatabaseResults:(e.queryDatabaseResults??[]).map((e=>(0,r()._o)(this.includeLimitInPersonPropertySchemaNode((0,r().BD)(e)[0]))))}}migrateStartTranscriptSteps(e,t){return Promise.resolve(this.dedupeTranscript(e.map(((t,n)=>{var a;if("context"===t.type&&(t.context["available-commands"]=v().Eo),"observation"!==t.type)return t;if("pagesFromQueryDatabase"===t.observationType)return t;const i={...t,value:(0,r()._o)(this.includeLimitInPersonPropertySchemaNode((0,r().BD)(t.value||"")[0]))};if("queryDatabase"!==i.observationType)return i;const s=e[n-1];if(!s||"assistant"!==s.type)return i;const o=null===(a=/<query-database id="(\d+)"/g.exec(s.value))||void 0===a?void 0:a[1];if(!o)return i;const l=(0,r().BD)(i.value);if(1!==l.length)return i;const c=l[0],d=new Set(["page","link-page","child-page"]);if("element"!==c.type)return i;for(const e of c.children??[])"element"===e.type&&d.has(e.tagName)&&e.attributes&&(e.attributes["database-id"]=o);return{...i,value:(0,r()._o)(c)}}))))}},8:new class{migrateStartStateAndTranscriptSteps(e,t){return(async()=>({migratedStartState:await this.migrateStartState(e,t),migratedTranscriptSteps:await this.migrateStartTranscriptSteps(t)}))()}migrateStartTranscriptSteps(e){return Promise.resolve(e)}getInitialNodeIdsFromPage(e){const{node:t}=e,n=new Map,a=new Map,i=new Map;if("element"===t.type){var s,o,r,l,c,d,u,p;if(null!==(s=t.attributes)&&void 0!==s&&s.id&&n.set(t.attributes.id,t),"page"!==t.tagName&&"instructions-page"!==t.tagName||null===(o=t.attributes)||void 0===o||!o.id||a.set(t.attributes.id,t),"child-page"===t.tagName&&null!==(r=t.attributes)&&void 0!==r&&r["page-id"])a.set(null===(d=t.attributes)||void 0===d?void 0:d["page-id"],t);if("database"===t.tagName&&null!==(l=t.attributes)&&void 0!==l&&l.id)i.set(null===(u=t.attributes)||void 0===u?void 0:u.id,t);if("child-database"===t.tagName&&null!==(c=t.attributes)&&void 0!==c&&c["database-id"])i.set(null===(p=t.attributes)||void 0===p?void 0:p["database-id"],t);if(t.children)for(const e of t.children){const{databaseIds:t,allNodeIds:s,pageIds:o}=this.getInitialNodeIdsFromPage({node:e});for(const[e,a]of s.entries())n.set(e,a);for(const[e,n]of t.entries())i.set(e,n);for(const[e,n]of o.entries())a.set(e,n)}}return{allNodeIds:n,pageIds:a,databaseIds:i}}getPeopleMapDataFromSearchPeopleResultChild(e){const t=(0,p().$d)(P,[e]);if(t.error)throw t.error;return t.value}getAllNodesFromTranscript(e){var t;const n=new Map,a=new Map,i=new Map;for(const d of e)if("observation"===d.type)switch(d.observationType){case"page":{var o;const e=(0,r().BD)(d.value)[0];if("element"!==e.type||null===(o=e.attributes)||void 0===o||!o.id)throw new Error("Invalid Page");n.set(d.pageId,e);break}case"instructionsPage":const e=(0,r().BD)(d.value)[0];if("element"!==e.type||null===(t=e.attributes)||void 0===t||!t.id)throw new Error("Invalid Page");n.set(d.pageId,e);break;case"search":{const e=(0,r().BD)(d.value)[0],t=this.parseSearchResult(e);t&&(n.set(t.id,t.page),a.set(t.id,t.page));break}case"queryDatabase":{const e=(0,r().BD)(d.value)[0];if("element"===e.type&&"query-database-results"===e.tagName&&e.children)for(const t of e.children){var l,c;if(t&&"element"===t.type&&"child-page"===t.tagName&&t.attributes)t.attributes["database-id"]&&i.set(t.attributes["database-id"],t),null!==(l=t.attributes)&&void 0!==l&&l.id&&n.set(t.attributes.id,t),null!==(c=t.attributes)&&void 0!==c&&c["page-id"]&&(n.set(t.attributes["page-id"],t),a.set(t.attributes["page-id"],t))}}break;case"pagesFromQueryDatabase":case"error":case"warning":case"js":case"database":case"searchPeople":case"loadUniversalResource":case"namespaceStart":case"namespaceEnd":case"attachment":case"searchDatabases":break;default:throw(0,s().HB)(d)}return{allNodeIds:n,pageIds:a,databaseIds:i}}parseSearchResult(e){if(e&&"element"===e.type&&"search-results"===e.tagName&&e.children)for(const n of e.children){var t;if(n&&"element"===n.type&&"page-result"===n.tagName&&null!==(t=n.attributes)&&void 0!==t&&t.id){const e=n.attributes.id;return{id:e,page:{type:"element",tagName:"page",attributes:{id:e},children:[]}}}}}migrateStartState(e,t){const a={context:e.context,blockIdMap:{},schemaIdMap:{},peopleIdMap:{},selection:e.selection,version:9,loadedPageIds:[],idMapper:(new(k().tD)).serialize()},i=new Map,o=new Map,l=new Map;for(const n of e.pages){var c;const e=(0,r().BD)(n)[0];if("element"!==e.type||null===(c=e.attributes)||void 0===c||!c.id)throw new Error("Invalid Page");const{allNodeIds:t,pageIds:a,databaseIds:s}=this.getInitialNodeIdsFromPage({node:e});Array.from(t.entries()).forEach((([e,t])=>{i.set(e,t)})),Array.from(a.entries()).forEach((([e,t])=>{o.set(e,t),i.set(e,t)})),Array.from(s.entries()).forEach((([e,t])=>{l.set(e,t)}))}const d=this.getAllNodesFromTranscript(t);for(const[n,s]of d.allNodeIds.entries())i.has(n)||i.set(n,s);for(const[n,s]of d.pageIds.entries())o.has(n)||o.set(n,s);for(const[n,s]of d.databaseIds.entries())l.has(n)||l.set(n,s);for(const n of e.searchResults??[]){const e=(0,r().BD)(n)[0];if(e&&"element"===e.type&&"search-results"===e.tagName&&e.children)for(const t of e.children){const e=this.parseSearchResult(t);if(e){const{id:t,page:n}=e;o.set(t,n),i.set(t,n)}}}for(const n of e.queryDatabaseResults??[]){const e=(0,r().BD)(n)[0];if("element"===e.type&&"query-database-results"===e.tagName&&e.children)for(const t of e.children){var u,p;if(t&&"element"===t.type&&"child-page"===t.tagName&&t.attributes)t.attributes["database-id"]&&l.set(t.attributes["database-id"],t),null!==(u=t.attributes)&&void 0!==u&&u.id&&i.set(t.attributes.id,t),null!==(p=t.attributes)&&void 0!==p&&p["page-id"]&&(i.set(t.attributes["page-id"],t),o.set(t.attributes["page-id"],t))}}for(const n of e.searchPeopleResults??[]){const e=(0,r().BD)(n)[0];if("element"===e.type&&"search-people-results"===e.tagName&&e.children)for(const t of e.children)if(t&&"element"===t.type&&"person"===t.tagName&&t.children){const e=this.getPeopleMapDataFromSearchPeopleResultChild(t);if(e)for(const t of e.results)a.peopleIdMap[t.id]=t,a.idMapper.keyMap.push({key:{type:"person",key:j().Dt()},counter:t.id})}}for(const n of i.keys())a.idMapper.keyMap.push({key:{type:"block",key:j().Dt()},counter:n});for(const n of l.keys())if(!i.has(n)){a.idMapper.keyMap.push({key:{type:"block",key:j().Dt()},counter:n});const e={attributes:{"database-id":n,id:n},parent:void 0,children:[],tagName:"child-database",schemaId:n,text:[],type:"block",schemas:{},properties:{},persisted:!1};a.blockIdMap[n]=e,a.schemaIdMap[n]=e.schemas}const g=new Map;for(const[s,r]of i.entries())if(void 0!==n(252050).sA[r.tagName]||"instructions-page"===r.tagName){const e=(0,v().fw)((0,v().F1)({node:r,mapCounterToKey:void 0}));for(const t of e.children)g.set(t,e.attributes.id);a.schemaIdMap[s]=e.schemas,a.blockIdMap[s]=e}for(const n of o.keys())a.loadedPageIds.push(n);for(const n of Object.values(a.blockIdMap)){const e=g.get(n.attributes.id);(0,s().O9)(e)&&(n.parent=e)}return Promise.resolve(a)}},9:new class{migrateStartStateAndTranscriptSteps(e,t){return(async()=>({migratedStartState:await this.migrateStartState(e,t),migratedTranscriptSteps:await this.migrateStartTranscriptSteps(t)}))()}migrateStartTranscriptSteps(e){const t=new Set;return Promise.resolve(e.filter((e=>{if("observation"===e.type){const n=String(e.value||"");if(t.has(n))return!1;t.add(n)}return!0})))}migrateStartState(e,t){return Promise.resolve({...e,version:10})}},10:new class{migrateStartStateAndTranscriptSteps(e,t){return(async()=>({migratedStartState:await this.migrateStartState(e,t),migratedTranscriptSteps:await this.migrateStartTranscriptSteps(t)}))()}migrateStartTranscriptSteps(e){return Promise.resolve(e)}migrateStartState(e,t){return Promise.resolve({...e,version:11})}},11:new class{migrateStartStateAndTranscriptSteps(e,t){return(async()=>({migratedStartState:await this.migrateStartState(e,t),migratedTranscriptSteps:await this.migrateStartTranscriptSteps(t)}))()}migrateStartTranscriptSteps(e){return Promise.resolve(e)}migrateStartState(e,t){const n=I().mg(e.idMapper),i=new Set(e.idMapper.keyMap.map((e=>e.counter)));for(const[l,c]of[["current-person-id","person"],["current-page-id","block"],["instructions-page-id","block"],["current-thread-id","slack-thread"]])(0,s().O9)(e.context[l])&&!i.has(e.context[l])&&n.keyMap.push({counter:e.context[l],key:{type:c,key:(0,a().gB)(`fake-context-${l}`)}});const o=new(k().tD)(n),r={...e,loadedPageIds:e.loadedPageIds.map((e=>o.mapCounterToKeyInModeOrThrow(e,"block_counter"))),context:o.mapAssistantContextCounterToKey(e.context),blockIdMap:Object.fromEntries((0,s().WP)(e.blockIdMap).map((([e,t])=>[o.mapCounterToKeyInModeOrThrow(e,"block_counter"),C(o,I().mg(t),n)]))),selection:void 0,schemaIdMap:Object.fromEntries(I().oE((0,s().WP)(e.schemaIdMap).map((([e,t])=>{try{return[o.mapCounterToKeyInModeOrThrow(e,"block_counter"),I().LG(t,(e=>C(o,I().mg(e),n)))]}catch(a){if(a instanceof k().V6)return;throw a}})))),peopleIdMap:Object.fromEntries((0,s().WP)(e.peopleIdMap).map((([e,t])=>[o.mapCounterToKeyInModeOrThrow(e,"person_counter"),{...t,id:o.mapCounterToKeyInModeOrThrow(t.id,"person_counter")}]))),idMapper:n,version:12};return Promise.resolve(r)}},12:new class{migrateStartStateAndTranscriptSteps(e,t){return(async()=>({migratedStartState:await this.migrateStartState(e,t),migratedTranscriptSteps:await this.migrateStartTranscriptSteps(t,e)}))()}migrateStartTranscriptSteps(e,t){const n=e.map((e=>{if("context"===e.type){return{...e,context:{...e.context,"available-commands":[...new Set([...e.context["available-commands"],"load-database"])]}}}return e}));return Promise.resolve(n)}migrateStartState(e,t){const n=I().mg(e.idMapper),a=new(k().tD)(n),i={...e.context,"available-commands":[...new Set([...e.context["available-commands"],"load-database"])]},o=[],r=()=>{const e=j().Dt();return a.mapKeyToCounter({type:"collection",key:e}),o.push(e),e},l=()=>{const e=j().Dt();return a.mapKeyToCounter({type:"collection-view",key:e}),e},c={},d={};(0,s().WP)(e.blockIdMap).forEach((([e,t])=>{if("child-database"===t.tagName||"database"===t.tagName){const e={type:"collection",tagName:"database",parent:t.attributes.id,attributes:{id:r(),title:"Untitled"},persisted:!0,schemaId:t.attributes.id,schemas:I().mg(t.schemas),properties:I().mg(t.properties)};d[e.attributes.id]=e;const n={type:"block",tagName:"database-views",parent:t.parent,attributes:t.attributes,text:t.text,properties:{},schemas:{},persisted:!0,schemaId:t.schemaId,children:[{type:"collectionView",tagName:"database-view",parent:t.attributes.id,attributes:{id:l(),title:"Untitled","database-id":r(),"database-name":"Untitled"},persisted:!0,schemaId:t.schemaId}]};c[t.attributes.id]=n}else c[t.attributes.id]=t;if("database-id"in t.attributes){const e=t.attributes["database-id"];if(a.doesIdMapperContainKey({type:"block",key:e})){const t=a.utilitiesForTests.removeKey({type:"block",key:e});t&&a.utilitiesForTests.setCounterValueForKey({type:"collection",key:e},t)}const n={type:"collection",tagName:"database",parent:t.attributes.id,attributes:{id:e,title:"Untitled"},persisted:!0,schemaId:t.attributes.id,schemas:{},properties:{}};d[e]=n,o.push(e)}}));const u={...e,version:13,context:i,collectionIdMap:d,blockIdMap:c,loadedDatabaseIds:o,idMapper:a.serialize()};return Promise.resolve(u)}},13:new class{migrateStartStateAndTranscriptSteps(e,t){const n=new(k().tD)(e.idMapper),a=t.map((e=>{if("observation"===e.type&&"queryDatabase"===e.observationType){const t=(0,r().BD)(e.value)[0];if("text"===t.type)return e;const a=j().Dt(),i=n.mapKeyToCounter({type:"query-database-result",key:a});t.attributes.id=i;return{...e,value:(0,r()._o)(t)}}return e}));return Promise.resolve({migratedStartState:{...e,idMapper:n.serialize(),version:14},migratedTranscriptSteps:a})}},14:new class{migrateStartStateAndTranscriptSteps(e,t){const n=t.map((e=>{if("assistant"===e.type&&e.value.includes("<load-")){const t=(0,r().BD)(e.value).map((e=>"element"!==e.type||"load-page"!==e.tagName&&"load-database"!==e.tagName?e:{...e,tagName:"load"}));return{...e,value:t.map((e=>(0,r()._o)(e))).join("")}}return"context"===e.type?{...e,context:{...e.context,"available-commands":v().Eo}}:e}));return Promise.resolve({migratedStartState:{...e,context:{...e.context,"available-commands":v().Eo},version:15},migratedTranscriptSteps:n})}},15:new class{migrateStartStateAndTranscriptSteps(e,t){const n=t.map((e=>{return"assistant"===e.type&&M.some((t=>e.value.includes(t)))?{...e,value:"[redacted]"}:"observation"===e.type||"assistant"===e.type||"human"===e.type&&e.value.includes("<table")?"observation"===e.type&&"pagesFromQueryDatabase"===e.observationType?e:{...e,value:(t=e.value||"",t.replace(/<table[\s\S]*?<\/table>/g,(e=>e.replace(/<property-text name="\d+">/g,"<td>").replace(/<property-text name="\d+"\/>/g,"<td/>").replace(/<\/property-text>/g,"</td>"))))}:e;var t}));return Promise.resolve({migratedStartState:{...e,version:16},migratedTranscriptSteps:n})}}};var E=()=>n(860251);function R(e){return e.map((e=>{const{message:t,type:n}=e;if("assistantClient"===n){if("humanAction"===t.type&&"accept"===t.action){const e=function(e){if(void 0===e.version)return;if(1===e.version){const{version:t,...n}=e;return n}(0,s().HB)(e)}(t);if(void 0===e)return;return{type:n,message:e}}return{type:n,message:t}}if("slack"===n)return e;(0,s().HB)(e)})).filter(s().O9)}const B={1:new class{async migrateStep(e){const{messages:t,...n}=e;return Promise.resolve({migratedStep:{...n,messages:R(t),version:2}})}}};var F=()=>n(218315);const N=o().union([o().object({required:{type:o().literal("singleUser"),slackUserId:o().string()},optional:{}}),o().object({required:{type:o().literal("everyone")},optional:{}})]),L=o().union([o().object({required:{type:o().literal("channel"),channelId:o().string()},optional:{}}),o().object({required:{type:o().literal("thread"),channelId:o().string(),threadTs:o().string()},optional:{}})]),O=o().object({required:{visibility:N,location:L},optional:{}});var V=()=>n(586984);o().object({required:{id:b().$F,sessionId:b().dx,parentPointer:o().union([n(764880).Ah,o().object({required:{id:o().uuid(),table:o().literal(n(123382).MC),spaceId:o().uuid()},optional:{}})]),serializedXMLEvaluatorState:o().any(),serializedTranscriptSteps:o().array(o().any()),messages:o().array(o().object({required:{type:o().literal("assistantClient"),message:o().any()},optional:{}})),assistantOperations:o().array(o().any()),operations:o().array(o().any()),invertedOperations:o().array(o().any()),isCancelled:o().boolean(),assistantFeedback:o().union([o().literal("thumbsUp"),o().literal("thumbsDown"),o().isUndefined()]),version:(0,n(671593).rv)((e=>o().number().validator(e)),o().number().toString)},optional:{previousChatTranscriptStorageStepPointer:b().$F,slackAssistantMetadata:o().object({required:{slackPostTarget:O},optional:{}})}});function z(e){const{step:t,intl:n,experimentService:o,formulasModule:f,spaceIdCreator:b}=e,I=new(F().a3),k=F().pu.newBuilder().with(I).build(),w=(0,i().j)((()=>(0,r().BD)(t.value)));if(i().Q.isFail(w))return w;const C=(0,p().$d)(p().p.map(p().p.sequence([(0,V().dl)(k.toParserArgs()),p().p.eof((()=>new Error("Expected single chat effect node")))]),(([e])=>e)),(0,x().gO)(w.value,v().p$));if(i().Q.isFail(C))return C;const A=C.value,T=(0,i().j)((()=>(0,v().zY)(A,k,!0)));if(i().Q.isFail(T))return T;const j=I.chats[0];if(!j)return{error:new Error("Step did not contain a <chat> effect")};if(0===j.blockIds.length)return{value:""};const M=new Map,_=g().RecordMap.create(),P=d().b4_.fromRecordMap(_),D={table:h().oo,id:a().rN},E=a().rN;let R;for(const a of j.operations){const e=(0,S().Vz)({assistantOperation:a,actorPointer:D,getRecordValue:P.getRecordValue,spaceId:E,spaceViewId:void 0,currentTimeZone:(0,l().P)()});if(i().Q.isFail(e))return e;const{operations:t,replacedBlockIdMap:n}=(0,S().g$)(e.value,(0,S().ze)());n.forEach(((e,t)=>{M.set(t,e)})),R=(0,u().applyOperationsToRecordMap)({recordMap:_,operations:t,updateOnly:!1,crdtMaps:R})}const B=j.blockIds.map((e=>M.get(e)??e)),N=function(e){return{blockId:e.pointer.id,navigableBlockId:e.pointer.id,renderParentBlockId:void 0,root:e.pointer,numberedListCache:{},bulletedListCache:{},getExportedPathToFile:e=>"",getExportedRenderAsset:e=>"",getExportedPathToPage:e=>"",getRecordValue:e.getRecordModel.getRecordValue,getRecordModel:e.getRecordModel,getRecordsWithParent:()=>[],userTimeZone:(0,l().P)(),intl:e.intl,baseUrl:e.config.domainBaseUrl,publicDomainName:e.config.publicDomainBaseUrl,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,experimentService:e.experimentService,collectionFeatureGates:(0,y().v)({experimentService:e.experimentService,actor:void 0,spaceId:e.pointer.spaceId}),formulasModule:e.formulasModule,spaceIdCreator:e.spaceIdCreator}}({config:{domainBaseUrl:"",publicDomainBaseUrl:""},getRecordModel:P,intl:n,pointer:{id:B[0],table:m().ev,spaceId:E},experimentService:o,formulasModule:f,spaceIdCreator:b});return{value:(0,c().V$)(B.map((e=>_.getValue({id:e,table:m().ev}))).filter(s().O9),N)??""}}function W(e){const{steps:t,intl:n,experimentService:a,formulasModule:i,spaceIdCreator:s}=e,o=t.find(f().ox);return o?z({step:o,intl:n,experimentService:a,formulasModule:i,spaceIdCreator:s}):{error:new Error("No human step found")}}async function U(e,t={}){const{desiredXMLVersion:n,desiredClientStepVersion:a}=t;if((0,s().O9)(n)&&n<e.serializedXMLEvaluatorState.version)return{error:new Error("Cannot migrate XML version backwards")};const o=await async function(e,t,n={}){if(!e.version||e.version<=10)return{error:new Error("Unsupported XML EvaluatorSerialized state version for migration.")};let a=e.version,i=e,s=t;const o=n.desiredVersion??v().Mz;for(;a<o;){if(!(a in D))return{error:new Error(`No transformer for version ${a}`)};const e=D[a];e.migrateStartStateAndTranscriptSteps&&({migratedStartState:i,migratedTranscriptSteps:s}=await e.migrateStartStateAndTranscriptSteps(i,s)),a++}return{value:{migratedStartState:i,migratedTranscriptSteps:s}}}(e.serializedXMLEvaluatorState,e.serializedTranscriptSteps,{desiredVersion:n});if(i().Q.isFail(o))return o;if(!o.value)return{error:new Error("Expected XML migrated value")};const{migratedStartState:r,migratedTranscriptSteps:l}=o.value,c={...e,serializedXMLEvaluatorState:r,serializedTranscriptSteps:l};if((0,s().O9)(a)&&a<e.version)return{error:new Error("Cannot migrate client step version backwards")};const d=await async function(e,t={}){const n=t.desiredVersion??E().Np;let a=e.version,i=e;for(;a<n;){if(!(a in B))return{error:new Error(`No transformer for version ${a}`)};const e=B[a];e&&e.migrateStep&&({migratedStep:i}=await e.migrateStep(i)),a++}return{value:{migratedStep:i}}}(c,{desiredVersion:a});if(i().Q.isFail(d))return d;if(!d.value)return{error:new Error("Expected clientStep migrated value")};const{migratedStep:u}=d.value;return{value:u}}},450104:(e,t,n)=>{n.r(t),n.d(t,{LargeSurfaceRenderError:()=>r});n(296540);var a=()=>n(835470),i=()=>n(874848),s=()=>n(649673),o=n(474848);function r(e){return(0,o.jsx)(i().L,{...e,iconGroup:a().F,children:(0,o.jsx)(s().g,{})})}},450338:(e,t,n)=>{n.d(t,{I:()=>l});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(581454);var a=n(296540),i=()=>n(69708),s=()=>n(497799),o=()=>n(892205),r=n(474848);function l({spaceStore:e,sharedWithFilterItems:t,setSharedWithFilter:n,runNewSearch:l,includeGroups:c,includeGuests:d,includeAgents:u}){const p=(0,s().H)({spaceStore:e}),g=(0,a.useMemo)((()=>p.loading?[]:d?[...p.members,...p.guests]:p.members),[p,d]),m=(0,a.useMemo)((()=>p.loading?new Set:new Set(p.guests.map((e=>e.id)))),[p]);return(0,r.jsx)(o().Jo,{isMultiSelect:!0,includePermissionGroups:c,includeAgents:u,userStores:g,title:(0,r.jsx)(i().sA,{id:"adminContentSearchTab.pagesTable.filters.sharedWith.title",defaultMessage:"Shared with"}),selectedItems:t??[],setSelectedItems:function(e){const t=e.map((({id:e,type:t})=>({type:t,id:e})));n(t.length>0?t:void 0)},onMenuClose:l,guestUserIdSet:m,includeGuests:d})}},454354:(e,t,n)=>{n.d(t,{A:()=>s});var a=()=>n(755531);class i extends(()=>n(757695))().Store{getInitialState(){return{changePermissionsEnabled:!1,privatePageStore:void 0,privateWorkflowStore:void 0,loading:!1,error:void 0}}shouldSaveTransactionWithSudoMode(e){const t=e===this.state.privatePageStore||e===this.state.privateWorkflowStore,n=this.doesUserAlreadyHaveEditorAccess(e.pointer);return t&&this.state.changePermissionsEnabled&&!n}shouldUserHaveAccessToPrivatePageBlock(){var e,t;const n=null===(e=(0,a().S)())||void 0===e?void 0:e.canAdmin(),i="enterprise"===(null===(t=(0,a().S)())||void 0===t?void 0:t.getSubscriptionTier());return this.state.privatePageStore&&n&&i}shouldUserHaveAccessToPrivateWorkflow(){var e,t;const n=null===(e=(0,a().S)())||void 0===e?void 0:e.canAdmin(),i="enterprise"===(null===(t=(0,a().S)())||void 0===t?void 0:t.getSubscriptionTier());return this.state.privateWorkflowStore&&n&&i}doesUserAlreadyHaveEditorAccess(e){const t=n(907258).default.state.sidebarSpaceStore;if(!t)return!1;return(e.table===n(179034).ev?n(295633).B.createChildStore(t,e):"collection"===e.table?n(732810).m.createChildStore(t,e):n(350013).N.createChildStore(t,e)).canAdmin()}}const s=i},457063:(e,t,n)=>{n.d(t,{I:()=>l});n(296540);var a=()=>n(401497),i=()=>n(463438),s=()=>n(100622),o=()=>n(284371),r=n(474848);function l({tabs:e,selectedIndex:t,onChange:n,marginBottom:l=0,tabGap:c=8}){const d=(0,a().IS)((()=>({tabBar:{paddingInlineStart:0,paddingInlineEnd:0,margin:0,marginBottom:l},tabStyle:{paddingTop:0,paddingBottom:0,marginInlineEnd:c,borderRadius:999},selectedTabStyle:{paddingTop:0,paddingBottom:0,marginInlineEnd:c,borderRadius:999},tabTitleStyle:{padding:8,borderRadius:999,fontSize:14,color:s().Tj.text.secondary,fontWeight:o().Wy.medium},selectedTabTitleStyle:{padding:8,borderRadius:999,background:s().Tj.background.secondary,fontSize:14,color:s().Tj.text.primary,fontWeight:o().Wy.medium},tabBorderStyle:{display:"none"}})),[l,c]);return(0,r.jsx)(i().LZ,{tabs:e,selectedIndex:t,onChange:n,style:d.tabBar,tabStyle:d.tabStyle,selectedTabStyle:d.selectedTabStyle,tabTitleStyle:d.tabTitleStyle,selectedTabTitleStyle:d.selectedTabTitleStyle,tabBorderStyle:d.tabBorderStyle,hideTabBorder:!0})}},457726:(e,t,n)=>{n.d(t,{EX:()=>l,Hr:()=>s,Hz:()=>v,N:()=>p,ON:()=>d,XS:()=>u,Yd:()=>c,_p:()=>r,h2:()=>g,jC:()=>f,og:()=>y,uL:()=>o,uy:()=>m,xg:()=>h});n(898992),n(354520),n(581454);var a=()=>n(534177),i=()=>n(153996);function s(e){return"human"===e.type}function o(e){return"humanAction"===e.type&&"accept"===e.action}function r(e){return"humanAction"===e.type&&"reject_all"===e.action}function l(e){return"assistantScopeChange"===e.type}function c(e){if("insert"===e.action||"accept"===e.action||"reject_all"===e.action||"accept_page_delete"===e.action)return e.pageId}function d(e){return"assistantChat"===e.type}function u(e){return"groupedEditCard"===e.type}function p(e){return"assistantShowSearchResults"===e.type}function g(e){return"queryDatabase"===e.type}function m(e){return"assistantShowSearchResults"===e.type}const h={human:!1,humanAction:!1,groupedEditCard:!0,assistantLoading:!1,assistantChatText:!0,assistantChat:!0,assistantTransaction:!0,assistantSearch:!1,assistantLoadPage:!1,assistantLoadDatabase:!1,queryDatabase:!1,assistantSearchPeople:!1,assistantShowSearchResults:!0,assistantLimitReached:!0,assistantQueryingDatabase:!1,assistantRetry:!0,assistantNoOperationsFromReplace:!0,assistantSelectEntity:!1,assistantSearchDatabases:!1,assistantScopeChange:!1,clientAssistantHumanAttachmentUpload:!1,assistantStartResearchMode:!1},f=(0,a().uv)({human:!0,humanAction:!0,groupedEditCard:!0,assistantLoading:!0,assistantChatText:!0,assistantChat:!0,assistantTransaction:!0,assistantSearch:!0,assistantLoadPage:!0,assistantLoadDatabase:!0,queryDatabase:!0,assistantSearchPeople:!0,assistantShowSearchResults:!0,assistantLimitReached:!0,assistantQueryingDatabase:!0,assistantRetry:!0,assistantNoOperationsFromReplace:!0,assistantSelectEntity:!0,assistantSearchDatabases:!0,assistantScopeChange:!0,clientAssistantHumanAttachmentUpload:!0,assistantStartResearchMode:!0});function y(e){const{step:t}=e;if("assistantChat"===t.type){const{type:e,...n}=t;return{type:e,...n,operations:t.operations.map((e=>(0,i().M)({operation:e})))}}if("assistantTransaction"===t.type){const{type:e,...n}=t;return{type:e,...n,operations:t.operations.map((e=>(0,i().M)({operation:e})))}}return"humanAction"===t.type?"accept"===t.action||"accept_page_delete"===t.action?{...t,undoCheckpointNames:void 0}:t:"assistantChatText"===t.type||"assistantLimitReached"===t.type||"assistantLoadPage"===t.type||"assistantLoadDatabase"===t.type||"groupedEditCard"===t.type||"assistantLoading"===t.type||"assistantSearch"===t.type||"assistantSearchPeople"===t.type||"assistantShowSearchResults"===t.type||"human"===t.type||"queryDatabase"===t.type||"assistantQueryingDatabase"===t.type||"assistantRetry"===t.type||"assistantNoOperationsFromReplace"===t.type||"assistantSelectEntity"===t.type||"assistantSearchDatabases"===t.type||"assistantScopeChange"===t.type||"clientAssistantHumanAttachmentUpload"===t.type||"assistantStartResearchMode"===t.type?t:void(0,a().HB)(t)}function v(e){const{serializedStep:t,getBlockById:n,assistantLoggingData:s}=e;if("assistantChat"===t.type){const{type:e,...o}=t;return{type:e,...o,operations:t.operations.map((e=>(0,i().x)({serializedOperation:e,getBlockById:n,assistantLoggingData:s}))).filter(a().O9)}}if("assistantTransaction"===t.type){const{type:e,...o}=t;return{type:e,...o,operations:t.operations.map((e=>(0,i().x)({serializedOperation:e,getBlockById:n,assistantLoggingData:s}))).filter(a().O9)}}if("assistantChatText"===t.type||"assistantLimitReached"===t.type||"assistantLoadPage"===t.type||"assistantLoadDatabase"===t.type||"groupedEditCard"===t.type||"assistantLoading"===t.type||"assistantSearch"===t.type||"assistantSearchPeople"===t.type||"assistantShowSearchResults"===t.type||"human"===t.type||"queryDatabase"===t.type||"humanAction"===t.type||"assistantQueryingDatabase"===t.type||"assistantRetry"===t.type||"assistantNoOperationsFromReplace"===t.type||"assistantSelectEntity"===t.type||"assistantSearchDatabases"===t.type||"assistantScopeChange"===t.type||"clientAssistantHumanAttachmentUpload"===t.type||"assistantStartResearchMode"===t.type)return t;(0,a().HB)(t)}},460089:(e,t,n)=>{n.d(t,{b:()=>p});var a=n(296540),i=()=>n(300474),s=()=>n(484714),o=()=>n(590526),r=()=>n(96563),l=()=>n(663929),c=()=>n(604018),d=()=>n(528093),u=n(474848);function p(e){const{connector:t,analyticsFrom:n}=e,p=(0,s().v3)(),[g,m]=(0,o().K8)((()=>[(0,c().Nr)(),(0,c().wd)().length>0]),[]),h=(0,i().r)(),f=(0,d()._)({name:"ai_connectors",spaceId:h,userId:p.currentUser.id}),y=(0,a.useCallback)((()=>{(0,r().pp)({environment:p,connector:t,analyticsFrom:n,connectorsFeatureAvailability:f})}),[p,t,n,f]),v=(0,a.useMemo)((()=>{if(0===g.length)return;const e=g.length<=2?1:3;return(0,u.jsx)("div",{style:{display:"flex",marginInlineEnd:4},children:(0,u.jsx)(l().hC,{connectors:g,maxBubbles:e,iconSize:14})})}),[g]);return 0===g.length?{bubbleIcons:void 0,connectorsUpsellOrManage:void 0,hasExistingConnectors:m}:{bubbleIcons:v,connectorsUpsellOrManage:y,hasExistingConnectors:m}}},461475:(e,t,n)=>{n.d(t,{n:()=>D});n(944114),n(898992),n(354520),n(672577),n(581454),n(737550);var a=n(296540),i=()=>n(564884),s=()=>n(300474),o=()=>n(933922),r=()=>n(484714),l=()=>n(590526),c=()=>n(401497),d=()=>n(107975),u=()=>n(128933),p=()=>n(249046),g=()=>n(420802),m=()=>n(388926),h=()=>n(807449),f=()=>n(31511),y=()=>n(98126),v=()=>n(406094),S=()=>n(160432),b=()=>n(26697),x=()=>n(187174),I=()=>n(471095),k=()=>n(69708),w=()=>n(100622),C=()=>n(284371),A=()=>n(576590),T=()=>n(383070),j=()=>n(942089),M=()=>n(424416),_=()=>n(169095),P=n(474848);function D(){const[e,t]=(0,a.useState)(!0),[n,D]=(0,a.useState)(!1),[R,B]=a.useState(!0),[F,N]=(0,a.useState)(0),[L,O]=(0,a.useState)(""),[V,z]=(0,a.useState)([]),[W,U]=(0,a.useState)(!1),H=(0,c().IS)((()=>({wrapper:{width:400,display:"flex",flexDirection:"column",minHeight:530},footer:{width:"100%",justifySelf:"flex-end",boxShadow:"0px 9px 24px 0px #0F0F0F33",paddingTop:16,paddingInlineEnd:20,paddingBottom:16,paddingInlineStart:20,gap:12,bottom:0},connectButton:{fontSize:14,fontWeight:C().Wy.semibold,width:360},searchBarWrapper:{justifyContent:"center"},searchBar:{width:360,padding:4},selectionContainer:{marginTop:18,marginBottom:18,width:"100%",height:"100%",justifyContent:"center",padding:"0px 20px 0px",flexGrow:1},selection:{width:"100%"},channelItem:{gap:4,alignItems:"center"},channelsText:{fontSize:12,lineHeight:"16px",display:"flex",flexDirection:"row",gap:4},divider:{marginTop:5,marginBottom:5},futureChannelsCheckboxWrapper:{gap:4,visibility:"visible"},loadingChannelsWrapper:{alignItems:"center",gap:8,fontSize:12,color:w().Tj.text.secondary,marginTop:8},selectionWrapper:{overflowY:"scroll",maxHeight:170},channelItemWrapper:{marginTop:12},manualSettingsLink:{marginInlineStart:"auto",fontSize:12}})),[]),K=(0,r().v3)(),q=(0,k().tz)(),$=(0,s().r)(),G=(0,l().K8)((()=>_().F0.state.currentScreen),[]),Y=(0,l().K8)((()=>_().F0.state.sessionId),[]),Q=(0,l().K8)((()=>_().F0.state.analyticsFrom),[]),J=(0,l().K8)((()=>_().F0.state.connectionStatus),[]);(0,x().Yb)((async()=>{var e;if(!$||"settings"!==G)return;if(!J)return t(!1),void(0,A().navigateToMicrosoftTeamsUniversalScreen)({currentScreen:"none",analyticsFrom:Q,sessionId:Y});if(["in_progress","disconnecting","editing"].includes(J))return t(!1),void(0,A().navigateToMicrosoftTeamsUniversalScreen)({currentScreen:"none",analyticsFrom:Q,sessionId:Y});t(!0);if(!(await(0,A().getMicrosoftTeamsAIConnectorStatusAction)({environment:K,spaceId:$})))return;const n=null===(e=await(0,A().getMicrosoftTeamsSyncControlsAction)({environment:K,spaceId:$}))||void 0===e?void 0:e.configuredSyncControls;if(!n)return;U(n.syncFutureTeams),z([]);const a=[];let i;do{const e=await(0,A().getMicrosoftTeamsTeamsAction)({environment:K,spaceId:$,cursor:i});if(!e)return;i=e.cursor,e.totalTeamCount&&N(e.totalTeamCount);for(const i of e.teams){const{id:e,name:t}=i;n.syncFutureTeams?a.push({id:e,name:t,checked:!n.teamsToExcludeFromSync.includes(e)}):a.push({id:e,name:t,checked:n.teamsToSync.includes(e)})}const t=a.find((e=>e.checked)),s=a.find((e=>!e.checked));let o=!1;t&&s?o="partial":t&&(o=!0),B(o),z([...a])}while(i);t(!1)}),[$,G,J,K,Q,Y]);const X=(0,l().K8)((()=>T().zD.isMicrosoftTeamsSelectionV2Enabled()),[]),Z=(0,a.useCallback)((e=>{const t=V.find((t=>t.id===e));return Boolean(null==t?void 0:t.checked)}),[V]),ee=(0,a.useCallback)((e=>{const t=V.map((t=>t.id===e?{...t,checked:!t.checked}:t));z(t);const n=t.find((e=>e.checked)),a=t.find((e=>!e.checked));let i=!1;n&&a?i="partial":n&&(i=!0),B(i)}),[V]),te=(0,a.useCallback)((()=>{const e=!R;B(e),z((t=>t.map((t=>({...t,checked:e})))))}),[R]),ne=(0,a.useCallback)((()=>V.some((e=>e.checked))),[V]),ae=(0,a.useCallback)((()=>{(0,i().u)({environment:K,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"settings_modal_close",integration_type:"microsoft-teams",setup_session_id:Y,from:Q}}}),t(!0),D(!1),B(!0),N(0),O(""),z([]),U(!1),(0,A().navigateToMicrosoftTeamsUniversalScreen)({currentScreen:"none",analyticsFrom:Q,sessionId:Y})}),[Q,Y,K]),ie=(0,a.useCallback)((async()=>{if(!$)return;(0,i().u)({environment:K,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"settings_modal_save_button",integration_type:"microsoft-teams",setup_session_id:Y,from:Q}}}),D(!0);const e=await(0,A().getMicrosoftTeamsAIConnectorStatusAction)({environment:K,spaceId:$});if(!e)return u().D6({label:q.formatMessage(E.retryActionRequest),position:"bottom"}),void D(!1);if("completed"!==e.connectionStatus&&"pending_selection"!==e.connectionStatus)return u().D6({label:q.formatMessage(E.alreadySyncing),position:"bottom"}),D(!1),void(0,A().navigateToMicrosoftTeamsUniversalScreen)({currentScreen:"none",analyticsFrom:Q,sessionId:Y});let t;if(W){const e={syncFutureTeams:!0,teamsToSync:[],teamsToExcludeFromSync:V.filter((e=>!e.checked)).map((e=>e.id))};t=await(0,A().setMicrosoftTeamsSyncControlsAction)({environment:K,spaceId:$,syncControls:e})}else{const e={syncFutureTeams:!1,teamsToSync:V.filter((e=>e.checked)).map((e=>e.id)),teamsToExcludeFromSync:[]};t=await(0,A().setMicrosoftTeamsSyncControlsAction)({environment:K,spaceId:$,syncControls:e})}return t?t.syncControlsUpdated?"pending_selection"===e.connectionStatus?(D(!1),u().D6({label:q.formatMessage(E.syncingWithNewSyncControl),position:"bottom"}),void(0,A().navigateToMicrosoftTeamsUniversalScreen)({currentScreen:"none",analyticsFrom:Q,sessionId:Y})):(D(!1),u().D6({label:q.formatMessage(E.syncingWithNewSyncControl),position:"bottom"}),void(0,A().navigateToMicrosoftTeamsUniversalScreen)({currentScreen:"post_edit_screen",analyticsFrom:Q,sessionId:Y})):(u().D6({label:q.formatMessage(E.syncControlNotUpdated),position:"bottom"}),void D(!1)):(u().D6({label:q.formatMessage(E.retryActionRequest),position:"bottom"}),void D(!1))}),[$,K,W,Q,Y,q,V]),se=(0,a.useCallback)((()=>{$&&"not_started"!==J?((0,i().u)({environment:K,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"settings_modal_disconnect_button",integration_type:"microsoft-teams",setup_session_id:Y,from:Q}}}),"in_progress"===J?(0,A().navigateToMicrosoftTeamsUniversalScreen)({currentScreen:"error_screen",analyticsFrom:Q,sessionId:Y}):(0,A().navigateToMicrosoftTeamsUniversalScreen)({currentScreen:"disconnect_screen",analyticsFrom:Q,sessionId:Y})):(0,A().navigateToMicrosoftTeamsUniversalScreen)({currentScreen:"none",analyticsFrom:Q,sessionId:Y})}),[$,J,Q,Y,K]),oe=(0,a.useCallback)((()=>(0,P.jsxs)(p().wt,{children:[(0,P.jsxs)(p().Ye,{children:[(0,P.jsx)(b().m,{render:t=>(0,P.jsxs)(p().Ye,{style:H.channelItem,children:[(0,P.jsx)("div",{...t,children:(0,P.jsx)(g().S,{disabled:n||e,checked:R,size:14,onClick:()=>{te()}})}),(0,P.jsx)("div",{style:H.channelsText,children:(0,P.jsx)(k().sA,{id:"universalSearch.microsoftTeams.settings.allTeamsToggle",defaultMessage:"All teams"})})]}),renderTooltip:()=>(0,P.jsx)("div",{style:{width:280},children:(0,P.jsx)(k().sA,{...E.disabledTooltip})}),disableTooltip:!(n||e)}),X?(0,P.jsx)("div",{style:H.manualSettingsLink,children:(0,P.jsx)(j()._,{href:"#",external:!0,onClick:()=>{(0,A().navigateToMicrosoftTeamsUniversalScreen)({currentScreen:"manual_settings"})},children:(0,P.jsx)(k().sA,{id:"universalSearch.microsoftTeams.manualSettings.manualSettings",defaultMessage:"Manual Settings"})})}):void 0]}),(0,P.jsx)(m().A,{style:H.divider,size:4}),(0,P.jsx)(P.Fragment,{children:e?(0,P.jsxs)(p().Ye,{style:H.loadingChannelsWrapper,children:[(0,P.jsx)("div",{children:(0,P.jsx)(y().k,{})}),(0,P.jsxs)(p().wt,{children:[(0,P.jsx)("div",{children:(0,P.jsx)(k().sA,{id:"universalSearch.microsoftTeams.settings.loadedXTeams",defaultMessage:"{teamsFetched} of {totalTeams} teams loaded",values:{teamsFetched:V.length,totalTeams:F}})}),(0,P.jsx)("div",{children:(0,P.jsx)(k().sA,{id:"universalSearch.microsoftTeams.settings.loading1000PerMinute",defaultMessage:"This can take up to one minute for every 1,000 teams."})})]})]}):(0,P.jsx)(p().wt,{style:H.selectionWrapper,children:(L?V.filter((e=>e.name.toLowerCase().includes(L.toLowerCase()))):V).map((e=>(0,P.jsxs)(p().Ye,{gap:8,style:H.channelItemWrapper,children:[(0,P.jsx)("div",{children:(0,P.jsx)(g().S,{disabled:n,checked:Z(e.id),onClick:()=>{ee(e.id)},size:14},`${e.id}-checkbox`)}),(0,P.jsx)("div",{style:H.channelsText,children:` ${e.name}`},`${e.id}-label`)]},e.id)))})})]})),[H,n,e,V,F,L,R,te,Z,ee,X]);return(0,P.jsx)(d().a,{open:"settings"===G,showCloseIcon:!0,onDismiss:ae,render:()=>(0,P.jsxs)("div",{style:H.wrapper,children:[(0,P.jsx)(M().b,{connectorType:"microsoft-teams",title:(0,P.jsx)(k().sA,{id:"universalSearch.microsoftTeams.settings.title",defaultMessage:"Connection Settings"})}),(0,P.jsx)(o().A,{capture:!0,allowEsc:!0,render:()=>(0,P.jsx)(b().m,{textWrap:!0,placement:"top",render:t=>(0,P.jsx)("div",{...t,children:(0,P.jsx)(p().Ye,{style:H.searchBarWrapper,children:(0,P.jsx)(f().A,{id:"microsoftTeamsUniversalQnASearchBar",style:H.searchBar,placeholder:q.formatMessage(E.searchBoxPlaceholder),value:L,onChange:e=>{O(e.target.value)},disabled:e},"microsoftTeamsUniversalQnASearchBar")})}),renderTooltip:()=>(0,P.jsx)(k().sA,{...E.disabledTooltip}),disableTooltip:!e})}),(0,P.jsx)(p().Ye,{style:H.selectionContainer,children:(0,P.jsx)(p().wt,{style:H.selection,children:oe()})}),(0,P.jsxs)(p().wt,{style:H.footer,children:[(0,P.jsx)(b().m,{textWrap:!0,placement:"top",render:t=>(0,P.jsxs)(p().Ye,{style:H.futureChannelsCheckboxWrapper,children:[(0,P.jsx)("div",{...t,children:(0,P.jsx)(g().S,{disabled:n||e,checked:W,size:14,onClick:()=>{U(!W)}})}),(0,P.jsx)("div",{style:H.channelsText,children:(0,P.jsx)(k().sA,{...E.syncFutureTeamsCheckboxLabel})})]}),renderTooltip:()=>(0,P.jsx)(k().sA,{...E.disabledTooltip}),disableTooltip:!e}),(0,P.jsxs)(p().Ye,{style:H.futureChannelsCheckboxWrapper,children:[(0,P.jsx)("div",{children:(0,P.jsx)(h().I,{icon:I().lockFillIcon,size:"sm"})}),(0,P.jsx)("div",{style:H.channelsText,children:(0,P.jsx)(k().sA,{...E.syncPrivateConversationLabel})})]}),(0,P.jsx)(S().A,{colorPalette:"blue",style:H.connectButton,onClick:ie,disabled:n||e||!ne()&&!W,children:(0,P.jsx)(k().sA,{...E.saveButton})}),(0,P.jsx)(v().A,{colorPalette:"red",style:H.connectButton,disabled:n||e||"in_progress"===J,onClick:se,children:(0,P.jsx)(k().sA,{...E.disconnectButton})})]})]}),ariaLabel:q.formatMessage(E.modalAriaLabel)})}const E=(0,k().YK)({disabledTooltip:{id:"universalSearch.microsoftTeams.settings.disabledTooltip",defaultMessage:"You can only interact after all teams are loaded"},saveButton:{id:"universalSearch.microsoftTeams.settings.settingsModal.saveChangesButtonText",defaultMessage:"Save Changes"},disconnectButton:{id:"universalSearch.microsoftTeams.settings.settingsModal.disconnectButtonText",defaultMessage:"Disconnect"},modalAriaLabel:{id:"universalSearch.microsoftTeams.settings.modalAriaLabel",defaultMessage:"Microsoft Teams error modal"},searchBoxPlaceholder:{id:"universalSearch.microsoftTeams.settings.searchBoxPlaceholder",defaultMessage:"Search for a Team"},alreadySyncing:{defaultMessage:"Microsoft Teams is already syncing. This can take up to 72 hours.",id:"universalSearch.microsoftTeams.settings.alreadySyncing"},retryActionRequest:{defaultMessage:"Action failed. Please try again.",id:"universalSearch.microsoftTeams.settings.retryActionRequest"},syncFutureTeamsCheckboxLabel:{id:"universalSearch.microsoftTeams.settings.syncFutureTeamsCheckboxLabel",defaultMessage:"Include teams created in the future"},syncPrivateConversationLabel:{id:"universalSearch.microsoftTeams.settings.syncPrivateConversationLabel",defaultMessage:"Content in private conversations will only be shown to members who have access to them. Permissions are strictly respected."},syncControlNotUpdated:{id:"universalSearch.microsoftTeams.settings.syncControlNotUpdated",defaultMessage:"No change made to Microsoft Teams Connection."},syncingWithNewSyncControl:{id:"universalSearch.microsoftTeams.settings.syncingWithNewSyncControl",defaultMessage:"Started syncing from Microsoft Teams. This can take up to 72 hours."}})},465614:(e,t,n)=>{n.d(t,{e:()=>f,y:()=>y});n(898992),n(672577),n(581454);var a=()=>n(60481),i=()=>n(908006),s=()=>n(295633),o=()=>n(755125),r=()=>n(547033),l=()=>n(867201),c=()=>n(255460),d=()=>n(391214),u=()=>n(981475),p=()=>n(401040),g=()=>n(747674),m=()=>n(836724),h=()=>n(718957);async function f(e){const{environment:t,spaceStore:n,blockPointers:a,currentPageId:r,pageVisitSource:u,chatThreadId:p}=e;if(0===a.length)return;const g=s().B.createChildStore(n,a[0]),h=g.getNavigableBlockStore();if(!h)return;const f=a.map((e=>e.id));if(h.id!==r)l().Y({store:g,environment:t,pageVisitSource:u,chatThreadId:p});else{(0,o().clear)({environment:t}),await c().NH(t,h,f),await i().default.afterNextFlush();const e=m().T.findSelectablesFromIds(f);if(0===e.length)return;const n=e[0];d().gm(t,{selectable:n,animate:!0})}}async function y(e){const{environment:t,spaceStore:n,textSelection:d,currentPageId:f,pageVisitSource:y,chatThreadId:v}=e,S=d.start.pointer.id,b=d.end.pointer.id,x=s().B.createChildStore(n,d.start.pointer),I=x.getNavigableBlockStore();if(I)if(I.id!==f)l().Y({store:x,environment:t,pageVisitSource:y,chatThreadId:v});else{(0,o().clear)({environment:t});const e=[S,b];await c().NH(t,I,e),await i().default.afterNextFlush();const n=m().T.findSelectablesFromIds(e);if(0===n.length)return;const s=n.find((e=>e.props.store.id===S)),l=n.find((e=>e.props.store.id===b));if(!s||!l)return;const f=s.props.store,y=l.props.store,v=f.getTitleStore(),x=y.getTitleStore();if(v&&x){const e=(0,h().hn)({store:v,index:d.start.index},{store:x,index:d.end.index});(0,r().setMultiSelection)({multiSelection:e}),(0,g().t)({environment:t,stores:[f],phase:a().o.Editing,pivot:f})}else(0,g().t)({environment:t,stores:[f]});const k=(0,p().G)();k&&u().globalChatPanelRuntimeStore.setState({...u().globalChatPanelRuntimeStore.state,completionContext:k})}}},465672:(e,t,n)=>{n.d(t,{j:()=>p});n(296540);var a=()=>n(401497),i=()=>n(127833),s=()=>n(250910),o=()=>n(695115),r=()=>n(126617),l=()=>n(718827),c=()=>n(100622),d=()=>n(623275);var u=n(474848);function p(e){const{onClose:t,originAriaLabel:n,popupStore:p,render:g,useShareMenuStyles:m,renderOrigin:h}=e,{popupShareModal:f,popupMenu:y}=function(){const e=(0,a().eP)();return(0,a().IS)((()=>({destructiveMenuItemHover:{background:(0,l().i)({color:c().Tj.red.background.secondaryTranslucent,mode:e})},destructiveMenuItemPressed:{background:(0,l().yZ)({color:c().Tj.red.background.secondaryTranslucent,mode:e})},popupMenu:{width:248},popupShareModal:{width:d().$D,borderRadius:d().Sg}})),[e])}(),v=(0,a().IS)((()=>({originEllipsesIcon:{width:16,height:16}})),[]);return(0,u.jsx)(s().A,{popupType:i().nl.Popup,alignmentToOrigin:"start",placementToOrigin:"bottom",style:m?f:y,render:g,onClose:t,buttonPopupStore:p,renderOrigin:h??(e=>(0,u.jsx)(o().A,{iconStyle:v.originEllipsesIcon,ariaLabel:n,icon:r().ellipsisSmallIcon,...e}))})}},470356:(e,t,n)=>{n.d(t,{c:()=>s});n(296540);var a=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.12 16.53 14.66",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M2.375 6.25c0-1.174.951-2.125 2.125-2.125h11c1.174 0 2.125.951 2.125 2.125v6.04l-1.25-.632V7.5H3.625v6.25c0 .483.392.875.875.875h7.213l.454 1.25H4.5a2.125 2.125 0 0 1-2.125-2.125zm2.258.184a.625.625 0 1 0 0-1.25.625.625 0 0 0 0 1.25m2.625-.625a.625.625 0 1 0-1.25 0 .625.625 0 0 0 1.25 0m1.375.625a.625.625 0 1 0 0-1.25.625.625 0 0 0 0 1.25"}),(0,a.jsx)("path",{d:"m17.426 14.65.474-.17a.433.433 0 0 0 .047-.796l-5.644-2.85a.433.433 0 0 0-.604.533l2.268 6.239a.435.435 0 0 0 .815.007l.574-1.509 2.225 2.433a.758.758 0 1 0 1.122-1.022l-2.287-2.501z"})]})},s=(0,n(340498).wt)("browserClick",i,"default")},471415:(e,t,n)=>{n.d(t,{B5:()=>C,O1:()=>M,Z4:()=>j,NM:()=>w,Nj:()=>T,tY:()=>A,V0:()=>k,DZ:()=>I});n(944114),n(296540);var a=()=>n(484714),i=()=>n(401497),s=()=>n(929219),o=()=>n(807449),r=()=>n(736847),l=()=>n(340498),c=n(474848);const d={viewBox:"0 0 20 20",fittedViewBox:"4.42 4.42 11.16 11.16",directional:!0,svg:(0,c.jsx)("path",{d:"M4.425 5.05c0-.345.28-.625.625-.625h7.637a.625.625 0 1 1 0 1.25H6.559l8.846 8.846a.616.616 0 0 1-.013.87.615.615 0 0 1-.87.014L5.674 6.56v6.128a.625.625 0 1 1-1.25 0z"})},u=(0,l().wt)("arrowDiagonalUpLeft",d,"default");var p=()=>n(412975),g=()=>n(589407),m=()=>n(100622),h=()=>n(534177),f=()=>n(177163),y=()=>n(668346),v=()=>n(551414),S=()=>n(525569),b=()=>n(907487),x=()=>n(267271);const I=(0,n(69708).YK)({notionAI:{defaultMessage:"Notion AI",id:"completions.completionActions.AIAssist"},more:{defaultMessage:"See more",id:"completions.completionActions.more"},alternativeUiString:{defaultMessage:"{text}",id:"completions.completionActions.alternativeUiString"},aiFreePromptBlockDisplayName:{defaultMessage:"AI block",id:"completions.completionActions.aiFreePromptBlockDisplayName"},aiSectionBlockDisplayName:{defaultMessage:"Custom AI section",id:"completions.completionActions.aiSectionBlockDisplayName"}});function k(e){return function(t){return(0,c.jsx)(r().A,{...t,title:(0,c.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,c.jsx)("div",{children:t.title})}),right:e})}}function w(e,t=5,a){const i=[];return i.push(...e.slice(0,t)),i.push((0,x().Fw)({key:"more",displayName:I.more,analyticsName:"Completions - assistant skill more",validators:b().X,svg:()=>(0,c.jsx)(j,{style:a}),action:async({environment:e})=>{const{aiDependency:t}=await Promise.resolve().then(n.bind(n,662453));(await t.load()).completionInitialPromptActions.toggleInitialPrompt({from:"slash_menu",environment:e})},shortcuts:(0,y().K)(),closeParentMenu:!0,sortScoreMultiplier:0,disabled:()=>!s().A.state.online})),i}function C(e){const{focused:t,type:n}=e,s=(0,a().WS)(),r=(0,i().IS)((()=>({iconStyle:{opacity:!s&&t?1:0},containerStyle:{width:18,height:18,display:"flex",alignItems:"center",justifyContent:"center"}})),[t,s]);switch(n){case"submitPrompt":return(0,c.jsx)("div",{style:r.containerStyle,children:(0,c.jsx)(o().I,{icon:p().arrowTurnDownLeftIcon,size:"xs",colorVariant:"secondary",style:r.iconStyle})});case"updatePrompt":return(0,c.jsx)("div",{style:r.containerStyle,children:(0,c.jsx)(o().I,{icon:u,size:"xs",colorVariant:"secondary",style:r.iconStyle})});default:(0,h().HB)(n)}}function A(e){return function(t){return(0,c.jsx)(C,{type:e,focused:t.focused})}}async function T(e){const{environment:t,clientSkillWithParameterValues:n,from:a,assistantSurfaceType:i,context:s}=e;await(0,f().toggleInitialPrompt)({from:a,environment:t,context:s});const o=S().default.state;o&&"assistantCompletionPopup"===o.type&&"initialPrompt"===o.stage&&await(0,v().triggerAssistantSkillCompletion)({environment:t,context:o.context,clientSkillWithParameterValues:n,updater:S().default.createUpdater(),sessionId:o.sessionId,from:a,assistantSurfaceType:i})}function j(e){const t=(0,i().IS)((()=>({icon:{marginInlineStart:2,marginInlineEnd:2,...e.style}})),[e.style]);return(0,c.jsx)(o().I,{icon:g().ellipsisIcon,size:"sm",colorVariant:"secondary",style:t.icon})}function M(e){const t=(0,i().IS)((()=>({box:{height:e.fixedWidth?22:void 0,width:e.fixedWidth?22:void 0,display:"flex",alignItems:"center",justifyContent:"center",...e.boxStyles},icon:{height:l().Ev.default,width:l().Ev.default,fill:e.svgFill??(0,m().O4)({theme:"light"}).icon.primary,...e.iconStyle}})),[e.boxStyles,e.fixedWidth,e.svgFill,e.iconStyle]);return(0,c.jsx)("div",{style:t.box,children:e.svg(t.icon)})}},476195:(e,t,n)=>{n.r(t),n.d(t,{codeSmallIcon:()=>i,iconDefinition:()=>a});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"0.17 1.77 15.66 12.45",svg:(0,n(474848).jsx)("path",{d:"M9.772 1.8a.625.625 0 0 0-.773.428l-3.2 11.2a.625.625 0 1 0 1.202.344l3.2-11.2a.625.625 0 0 0-.43-.773M4.762 4.038a.625.625 0 0 0-.884 0l-3.52 3.52a.625.625 0 0 0 0 .884l3.52 3.52a.625.625 0 1 0 .884-.884L1.684 8l3.078-3.078a.625.625 0 0 0 0-.884m7.36 0a.625.625 0 0 0-.884.884L14.316 8l-3.078 3.078a.625.625 0 0 0 .884.884l3.52-3.52a.625.625 0 0 0 0-.884z"})},i=(0,n(340498).wt)("codeSmall",a,"small")},481975:(e,t,n)=>{n.d(t,{s:()=>i});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"4.77 3.05 5.58 9.9",directional:!0,svg:(0,n(474848).jsx)("path",{d:"M10.162 3.238a.625.625 0 0 0-.884 0l-4.32 4.32a.625.625 0 0 0 0 .884l4.32 4.32a.625.625 0 1 0 .884-.884L6.284 8l3.878-3.878a.625.625 0 0 0 0-.884"})},i=(0,n(340498).wt)("arrowChevronSingleLeftSmall",a,"small")},482707:(e,t,n)=>{n.d(t,{k:()=>s});var a=()=>n(79926);const i=new(a().O2)("shareMenuContainer",(async()=>await Promise.all([n.e(75134),n.e(35530),n.e(9773),n.e(36556),n.e(55373),n.e(36192),n.e(40537),n.e(71562),n.e(96346),n.e(44711),n.e(53321),n.e(51220),n.e(16471),n.e(37353),n.e(37571),n.e(29151),n.e(40118),n.e(50397),n.e(62475),n.e(3151),n.e(98629),n.e(22926),n.e(22900),n.e(42838),n.e(85128),n.e(49889),n.e(20108),n.e(46174),n.e(27992),n.e(63452),n.e(66249),n.e(92845),n.e(87249),n.e(79022),n.e(44854),n.e(34877),n.e(46414),n.e(11676),n.e(61165),n.e(47668),n.e(94522),n.e(44584),n.e(24587),n.e(67494),n.e(3651),n.e(38293),n.e(40992),n.e(88455),n.e(64556),n.e(33893),n.e(91793),n.e(55162),n.e(71003),n.e(32370),n.e(26264),n.e(36437),n.e(50363),n.e(42660),n.e(44590),n.e(55113),n.e(85071),n.e(7914),n.e(25588),n.e(68637),n.e(23640),n.e(72252),n.e(93134),n.e(12452),n.e(52871),n.e(29351),n.e(18825),n.e(71853),n.e(93049),n.e(22582),n.e(18636),n.e(87289),n.e(16060),n.e(34281),n.e(48376),n.e(35279),n.e(80229),n.e(77754),n.e(71309),n.e(74562),n.e(39986),n.e(47431),n.e(47160),n.e(76677),n.e(68609),n.e(37384),n.e(15553),n.e(77345),n.e(67720),n.e(37759),n.e(41423),n.e(13955),n.e(42056),n.e(14699),n.e(57924),n.e(5181),n.e(3261),n.e(19456),n.e(17729),n.e(45147),n.e(65375),n.e(32116),n.e(94995),n.e(98339),n.e(51240),n.e(82641),n.e(20029),n.e(68395),n.e(81803),n.e(96654),n.e(68643),n.e(32625),n.e(63687),n.e(95885),n.e(27083),n.e(78999),n.e(11424),n.e(40119),n.e(54742),n.e(38946),n.e(90880),n.e(49175),n.e(8852),n.e(5331),n.e(92924),n.e(71381),n.e(1947),n.e(96385),n.e(80326),n.e(53352),n.e(2373),n.e(5315),n.e(995),n.e(76690),n.e(60713),n.e(31106),n.e(63248),n.e(54719),n.e(48570),n.e(78862),n.e(54234),n.e(85160),n.e(15381),n.e(50525),n.e(15922),n.e(77651),n.e(51204),n.e(34974),n.e(58672),n.e(95103),n.e(58071),n.e(75681)]).then(n.bind(n,303893)))),s=(0,a()._h)(i,(e=>e.ShareMenuContainer))},483838:(e,t,n)=>{n.d(t,{Q:()=>l});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(581454);var a=n(296540),i=()=>n(69708),s=()=>n(497799),o=()=>n(892205),r=n(474848);function l({spaceStore:e,createdByFilterIds:t,setCreatedByFilter:n,runNewSearch:l,includeGuests:c}){const d=(0,s().H)({spaceStore:e}),u=(0,a.useMemo)((()=>d.loading?[]:c?[...d.members,...d.guests]:d.members),[d,c]),p=(0,a.useMemo)((()=>d.loading?new Set:new Set(d.guests.map((e=>e.id)))),[d]);const g=(0,a.useMemo)((()=>t.map((e=>({id:e,type:"user"})))),[t]);return(0,r.jsx)(o().Jo,{userStores:u,title:(0,r.jsx)(i().sA,{id:"adminContentSearchTab.pagesTable.filters.createdBy.title",defaultMessage:"Created by"}),selectedItems:g,setSelectedItems:function(e){const t=e.map((({id:e})=>e));n(t)},onMenuClose:l||(()=>{}),isMultiSelect:!0,guestUserIdSet:p,includeGuests:c})}},497799:(e,t,n)=>{n.d(t,{H:()=>c});n(898992),n(823215),n(354520),n(581454);var a=()=>n(590526),i=()=>n(849255),s=()=>n(983610),o=()=>n(798880),r=()=>n(322769),l=()=>n(134217);function c({spaceStore:e}){return(0,a().K8)((()=>{const t=s().subscriptionDataStoreInstance.state;if(!t)return{loading:!0};const n=l().Be(t);if(!n.every((t=>i().L.createChildStore(e,{table:o().oo,id:t.userId}).isReady())))return{loading:!0};const a=n.filter(r().c7),c=n.filter(r().QE);return{loading:!1,members:a.map((({userId:t})=>i().L.createChildStore(e,{table:o().oo,id:t}))),guests:c.map((({userId:t})=>i().L.createChildStore(e,{table:o().oo,id:t})))}}),[e])}},499172:(e,t,n)=>{n.d(t,{D:()=>i,K:()=>s});n(898992),n(737550);var a=()=>n(68263);function i(){return"all_workspace_members"}function s(e){const{policy:t,userRole:n,userPermissionGroups:i}=e,s=t??"all_workspace_members",o=n&&(0,a().Km)(n);switch(s){case"workspace_owners_only":if(!o)return{canCreate:!1,reason:"policy_restriction"};break;case"all_workspace_members":break;case"custom":if(!(null==i?void 0:i.some((e=>{var t;return!0===(null===(t=e.settings)||void 0===t?void 0:t.can_create_custom_agents)})))&&!o)return{canCreate:!1,reason:"policy_restriction"};break}return{canCreate:!0}}},499201:(e,t,n)=>{n.d(t,{V:()=>u});n(16280),n(18107),n(967357),n(581454);var a=()=>n(453607),i=()=>n(722101),s=()=>n(384944),o=()=>n(391214),r=()=>n(486674),l=()=>n(836724),c=()=>n(483730),d=()=>n(150984);function u(e){const{environment:t,sessionId:n,transaction:u,chatStep:p}=e,g=c().default.getSessionContextOrThrow(n).evaluatorFromStoreState.state.getAssistantSelectionIfExists();if(!g)throw new Error("No assistantSelection.");const m="block"===g.type?g.blockIds.at(-1):g.end.blockId;if(!m)throw new Error("No lastSelectedBlockId.");const h=l().T.findSelectablesFromIds([m]).at(0);let f,y,v;if(h)f=h.props.store,y=f.getRecordStoreUIParent();else{const e=(0,r().a)();if(!e)throw new Error("No currentPageStore.");const n=e.getContentStores().at(-1);if(n)f=n,y=f.getRecordStoreUIParent();else{const n=s().Wv({environment:t,type:"text",inMemoryRecordCache:e.inMemoryRecordCache,transaction:u,spaceId:e.pointer.spaceId});i().BC({parentStore:e.getContentStore(),appendStore:n,transaction:u}),f=n,y=e.getContentStore()}v=l().T.findSelectablesFromIds([f.id]).at(0)}if(!y)throw new Error("No blockParentStore.");const S=(0,d().generateBlockStoresForClientChatStep)({environment:t,clientStep:p,transaction:u,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,stripCitations:!0,isPreviewing:!1}).map((e=>e.cloneWithNewUIParent(y)));o().LE({environment:t,blocksToInsert:S,target:[f],replaceEmptyTextBlock:!0,transaction:u}),v&&(0,a().p)({handle:v,vertical:{reveal:"closest"},horizontal:{reveal:"closest"},animate:!0,environment:t})}},501305:(e,t,n)=>{n.r(t),n.d(t,{assistantMenuHelpPopupStore:()=>W,closeAssistantRightHandSideMenu:()=>q,confirmAndDiscardPendingEditsIfApplicable:()=>K,handleClickConnectApps:()=>X,navigateToFullPageChatAndLogAnalytics:()=>$,navigateToView:()=>U,openAssistantFromAttachmentLoad:()=>J,openAssistantFromEdit:()=>Q,openCornerChatHelp:()=>Z,openFullPageChat:()=>G,openNotionSupportChat:()=>ee,setPrimeTextInput:()=>H,switchToChatHistory:()=>Y});var a=()=>n(907258),i=()=>n(755531),s=()=>n(201794),o=()=>n(906536),r=()=>n(206267),l=()=>n(427704),c=()=>n(201980),d=()=>n(530199),u=()=>n(534177),p=()=>n(939768),g=()=>n(537941),m=()=>n(994877),h=()=>n(36951),f=()=>n(631611),y=()=>n(619553),v=()=>n(246766),S=()=>n(770906),b=()=>n(732797),x=()=>n(260850),I=()=>n(564627),k=()=>n(859841),w=()=>n(263542),C=()=>n(856411),A=()=>n(483730),T=()=>n(715142),j=()=>n(295173),M=()=>n(677590),_=()=>n(754461),P=()=>n(140022),D=()=>n(830010),E=()=>n(371621),R=(n(296540),()=>n(401497)),B=()=>n(675133),F=()=>n(792057),N=()=>n(69708),L=()=>n(284371),O=()=>n(732067),V=n(474848);function z(e){const{hasPendingEdits:t}=e,n=(0,R().IS)((()=>({wrapper:{padding:8,display:"flex",flexDirection:"column"},question:{fontWeight:L().Wy.medium,textAlign:"center",marginTop:8,lineHeight:"1.2em"},iconWrapper:{display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8}})),[]);return(0,V.jsxs)("div",{style:n.wrapper,children:[(0,V.jsx)(O().cG,{style:n.iconWrapper,variant:"large"}),(0,V.jsx)("div",{style:n.question,children:t?(0,V.jsx)(N().sA,{id:"assistantWriterPopup.ExitConfirmationDialog.questionWithPendingEdits",defaultMessage:"Do you want to keep or discard pending AI edits?"}):(0,V.jsx)(N().sA,{id:"assistantWriterPopup.ExitConfirmationDialog.questionNoPendingEdits",defaultMessage:"Do you want to discard the AI response?"})})]})}const W=new(n(118307).A);function U(e){w().P.setState({...w().P.state,currentView:e.view})}function H(e,t=!0){"string"==typeof e?w().P.setState({...w().P.state,primeTextInput:{shouldFocusInput:t,textValue:(0,c().x9d)(e)}}):Array.isArray(e)?w().P.setState({...w().P.state,primeTextInput:{shouldFocusInput:t,textValue:e}}):w().P.setState({...w().P.state,primeTextInput:{shouldFocusInput:t,textValue:void 0}})}async function K(e){const{environment:t,humanInput:n,assistantSurface:i,assistantInputTextStore:s,discardWithoutConfirmation:l=!1}=e,d=i.isWriter,p=i.type,g=d?(0,T().K1)():A().default.getActiveSession(),m=null==g?void 0:g.isStreaming(),h=null==g?void 0:g.getAllPendingNonCreateExecutableOperations(),f=Boolean(g)&&void 0!==h&&h.length>0;if(g&&(f||!(0,c().w9s)(n)||m)){const e=(null==g?void 0:g.latestCommitInferenceIdFromStoreState)??r().JW();if(f||d){s&&(0,o().t)({store:s,readOnly:!0});const n=l?{accept:!0,keepOrDiscard:"discard"}:await async function(e){const{hasPendingEdits:t}=e;return new Promise((e=>{let n=[];n=t?[{label:(0,V.jsx)(N().sA,{id:"assistantWriterPopup.ExitConfirmationDialog.confirmExitKeepPendingEdits",defaultMessage:"Keep"}),color:void 0,onAccept:()=>{e({accept:!0,keepOrDiscard:"keep"})}},{label:(0,V.jsx)(N().sA,{id:"assistantWriterPopup.ExitConfirmationDialog.confirmExitDiscardPendingEdits",defaultMessage:"Discard"}),color:void 0,onAccept:()=>{e({accept:!0,keepOrDiscard:"discard"})}}]:[{label:(0,V.jsx)(N().sA,{id:"assistantWriterPopup.ExitConfirmationDialog.confirmExit",defaultMessage:"Discard"}),color:void 0,onAccept:()=>{e({accept:!0,keepOrDiscard:"discard"})}}],F().ui({showCancel:!1,keepFocus:!1,message:(0,V.jsx)(z,{hasPendingEdits:t}),mode:"normal",onDismiss(){e({accept:!1})},items:[...n,{label:B().A.formatMessage(F()._0.cancelButtonLabel),onAccept:t=>{e({accept:!1})}}]})}))}({hasPendingEdits:f});if(!n.accept)return s&&(0,x().z)({store:s}),!1;if("keep"===n.keepOrDiscard){var y;(null===(y=a().default.state.sidebarSpaceViewStore)||void 0===y?void 0:y.id)&&(await(0,D().acceptEdits)({environment:t,inferenceId:e,sessionContext:g,operationContext:(0,E().BB)({shouldCreateUnknownBlock:!0}),assistantSurfaceType:p}),(0,P().trackAcceptAllPill)(t,{inferenceId:e,sessionId:g.sessionIdFromStoreState,from:p}))}else"discard"===n.keepOrDiscard?((0,_().p)({environment:t,sessionContext:g,assistantSurface:i}),l||(0,P().trackDiscardAllPill)(t,{inferenceId:e,sessionId:g.sessionIdFromStoreState,from:p}),(0,M().U)({environment:t,sessionId:g.sessionIdFromStoreState})):(0,u().HB)(n.keepOrDiscard)}return!0}return!0}async function q(e){const t=f().wy.corner;if(!e.withoutDismissCheck){const n=await K({...e,assistantSurface:t});if(!n)return n}return w().P.setState({...w().P.state,open:!1,from:void 0}),!0}function $(e){const{environment:t,from:n,callback:a}=e,s=A().default.getActiveSessionId()||A().default.getNextSessionId(),o=A().default.getActiveAssistantConfigurationState(),r=A().default.getActiveSession();P().trackAssistantOpened(t,{hasQuery:!1,from:n,searchSessionId:void 0,isReminder:!1,reminderType:void 0,sessionId:s,startTimestamp:(null==o?void 0:o.sessionStartTimestamp)||Date.now(),transcript:(null==r?void 0:r.evaluatorFromStoreState.getTranscript())||[]});const c=t.RouterStore.state.route;let d;"chat"===c.name&&(d=c.threadId),async function(){var e;r?(w().P.setState({...w().P.state,currentView:"chat",from:n}),(0,v().navigate)({environment:t,url:l().JZ.chat,callback:a})):(await q({environment:t}),(0,v().navigate)({environment:t,url:(0,h().NC)({environment:t,threadId:d,spaceId:null===(e=(0,i().S)())||void 0===e?void 0:e.id}),callback:a}))}()}function G(e){const{environment:t,shouldFocusInput:n=!0,openInNew:a,queryTextValue:s,from:o,deepFindRequestedForNewTabOrWindow:r}=e;if(a&&t.device.isElectron){var c;const e=p().Gm({url:l().JZ.chat,query:{[d().ah]:JSON.stringify(s),spaceId:null===(c=(0,i().S)())||void 0===c?void 0:c.id,...r?{deepFind:"true"}:{}}});(0,y().B)({makeTabActive:!0,url:e,position:"end",openInNew:a,environment:t})}else w().P.setState({...w().P.state,currentView:"chat",primeTextInput:{shouldFocusInput:Boolean(n),textValue:s},from:o}),(0,v().navigate)({environment:t,url:l().JZ.chat})}async function Y(e){const{environment:t,currentSessionId:n,inferenceId:a,assistantSurface:i}=e,s=i.type;await K({environment:t,inferenceId:a,assistantSurface:i})&&(n&&I().G.setPreviouslyVisitedSession(n),"fullPage"===s?(0,S().ZT)({environment:t,contentType:"assistant"}):w().P.setState({...w().P.state,currentView:"chatHistory"}),P().trackAiChatTranscriptHistoryOpenHistoryButtonSelected(t,{from:s}))}function Q(e){const{environment:t}=e;t.device.isMobileNative?(0,v().navigate)({environment:t,url:`${l().GJ.nativeTab}/assistant`}):(0,j().openNewAgentSidebarFromMainBlock)({environment:t})}function J(e){const{environment:t}=e;if(t.device.isMobileNative)if((0,s().T)("supportsHorizon1Navigation")){const{activeTab:e}=t.TabbedRouterStore.state;g().s({environment:t,tab:e,modal:[{type:"web",url:"/nativetab/assistant",route:{name:"nativeTab",tab:"assistant"}}]})}else(0,v().navigate)({environment:t,url:`${l().GJ.nativeTab}/assistant`});else(0,j().openNewAgentSidebarFromMainBlock)({environment:t})}function X(e){const{environment:t,sessionId:n,assistantSurfaceType:a,source:i}=e;b().r.setState({...b().r.state,open:!0,source:"assistantMenu"}),k().A.setState({...k().A.state,open:!0}),C().c.setCurrentView("helpOverflowMenu"),P().trackConnectAppsClick({environment:t,sessionId:n,assistantSurfaceType:a,source:i})}function Z(){b().r.setState({...b().r.state,open:!0,source:"assistantMenu"}),k().A.setState({...k().A.state,open:!0}),C().c.setCurrentView("mainHelpMenu")}function ee({environment:e,from:t}){q({environment:e,withoutDismissCheck:!0}),m().SI({environment:e,from:t})}},505121:(e,t,n)=>{n.d(t,{Z:()=>W});n(898992),n(581454),n(908872);var a=n(296540),i=()=>n(929151),s=()=>n(401497),o=()=>n(100622),r=()=>n(534177),l=()=>n(671593),c=()=>n(638681),d=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),()=>n(681873)),u=n(474848);var p=()=>n(695115),g=()=>n(26697),m=()=>n(412412),h=()=>n(252050),f=(n(16280),n(811558),n(672577),()=>n(973647)),y=()=>n(416504),v=()=>n(402390),S=()=>n(792071),b=()=>n(179034),x=()=>n(24279),I=()=>n(832443),k=()=>n(943290),w=()=>n(436468),C=()=>n(706461),A=()=>n(218315);async function T(e){const t=await async function(e){const{command:t}=e,n=new(A().HJ),a=A().pu.newBuilder().with(n).withSimpleDeterministicIDs().buildEvaluator({namespace:"router"}),{observations:i}=await a.commitStep({id:0,type:"assistant",value:t}),s=i.find(x().XO);if(s)return{error:(0,x().aR)(s)};const o=(0,k().iL)(n.executableOperations);return 1===o.length&&"updatedPage"===o[0].type&&o[0].didCreatePage?{value:{pagePointer:{id:o[0].pageId,table:b().ev},recordMap:n.recordMap}}:{error:new Error("Unexpected operation group: expected 1 create page group")}}(e);if(f().Q.isFail(t))return t;const{node:n}=await(0,w().Rz)({pointer:{...t.value.pagePointer,spaceId:"fake"},loadRecordModel:S().h0Y.fromRecordMap(t.value.recordMap),intl:(0,v()._z)(),currentTimeZone:(0,y().P)()}),a=(new(I().tD)).mapNodeKeyToCounter(n);return{value:(0,C().sD)({node:a,selection:void 0,namespace:"end_to_end"})}}var j=()=>n(187174),M=()=>n(97059),_=()=>n(340498),P=()=>n(206267),D=()=>n(69708),E=()=>n(284371);function R(e){return P().JW()}function B(e){const t=e.defaultExpanded??!0,n=(0,m().BD)(e.xml).map((e=>"element"===e.type?e:{type:"element",tagName:"_",attributes:{},children:[e]}));return(0,u.jsx)(u.Fragment,{children:n.map(((e,n)=>(0,u.jsx)(L,{node:e,defaultExpanded:t},n)))})}function F(e){return`<create-page>\n<property-title name="Title">Debug page</property-title>\n${e}</create-page>`}const N={"create-page":e=>e,replace:F,"insert-before":F,"insert-after":F,chat:F};function L(e){const{node:t,defaultExpanded:n}=e,i=(0,s().eP)(),r=(0,s().IS)((()=>({node:{},light:{color:o().Tj.text.tertiary},medium:{color:o().Tj.text.secondary,fontWeight:E().Wy.medium},arrow:{color:o().Tj.darkTextColor,fontWeight:E().Wy.semibold,marginInlineEnd:4,cursor:"pointer"},children:{marginInlineStart:2,paddingInlineStart:10,borderInlineStart:"1px solid rgba(55, 53, 47, 0.2)"},error:{color:"light"===i?o().Tj.palette.red[500]:o().Tj.palette.red[800]},iconButton:{marginInlineStart:4,position:"relative",top:1},iconButtonIcon:{width:_().Ev.sm,height:_().Ev.sm}})),[i]),[l,c]=(0,a.useState)(n),[d,y]=(0,a.useState)(!1),v=(0,a.useMemo)((()=>{if(1!==t.children.length||"text"!==t.children[0].type)return;const e=N[t.tagName];if(!e)return;return e(t.children[0].value)}),[t]),S=(0,D().tz)().formatMessage({id:"prettyXML.convertMarkdownButton",defaultMessage:"Toggle convert Markdown to XML"}),b=v&&l?(0,u.jsx)(g().m,{renderTooltip:()=>S,render:e=>(0,u.jsx)(p().A,{style:r.iconButton,iconStyle:r.iconButtonIcon,onClick:()=>y(!d),...e,icon:M().s,ariaLabel:S})}):null,[x]=(0,j().Yb)((async()=>{if(d&&v){const e=await T({command:v});if(f().Q.isFail(e))throw e;return(0,m().BD)(e.value)}return t.children}),[v,d,t]),I="resolved"===x.status&&x.value.length>0;return(0,u.jsxs)("div",{style:r.node,children:[I?(0,u.jsx)("span",{style:r.arrow,onClick:()=>c((e=>!e)),children:l?"":""}):void 0,(0,u.jsx)("span",{style:r.light,children:"<"}),(0,u.jsx)("span",{style:r.medium,children:t.tagName}),t.attributes?Object.entries(t.attributes).map((([e,t])=>(0,u.jsxs)(a.Fragment,{children:[(0,u.jsx)("span",{style:r.light,children:` ${e}="`}),(0,u.jsx)("span",{style:r.medium,children:t}),(0,u.jsx)("span",{style:r.light,children:'"'})]},e))):void 0,(0,u.jsx)("span",{style:r.light,children:I?">":"/>"}),b,"rejected"===x.status?(0,u.jsx)("div",{style:{...r.children,...r.error},children:`Error: ${x.error.message}`}):void 0,"resolved"===x.status&&x.value.length>0&&l?(0,u.jsx)("div",{style:r.children,children:x.value.map((e=>{const t=R();return"text"===e.type?(0,u.jsx)("span",{style:{whiteSpace:"pre-wrap"},children:e.value},t):h()._S[e.tagName]?(0,u.jsx)(O,{node:e},t):(0,u.jsx)(L,{node:e,defaultExpanded:n},t)}))}):void 0,I?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{style:r.light,children:"</"}),(0,u.jsx)("span",{style:r.medium,children:t.tagName}),(0,u.jsx)("span",{style:r.light,children:">"})]}):void 0]})}function O(e){const{node:t}=e,n=(0,s().IS)((()=>({light:{color:o().Tj.text.tertiary},medium:{color:o().Tj.text.secondary,fontWeight:E().Wy.medium}})),[]),i=t.children&&t.children.length>0;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{style:n.light,children:"<"}),(0,u.jsx)("span",{style:n.medium,children:t.tagName}),t.attributes?Object.entries(t.attributes).map((([e,t])=>(0,u.jsxs)(a.Fragment,{children:[(0,u.jsx)("span",{style:n.light,children:` ${e}="`}),(0,u.jsx)("span",{style:n.medium,children:t}),(0,u.jsx)("span",{style:n.light,children:'"'})]},e))):void 0,(0,u.jsx)("span",{style:n.light,children:i?">":"/>"}),t.children&&t.children.length>0?t.children.map((e=>{const t=R();return"text"===e.type?(0,u.jsx)("span",{children:`${e.value}`},t):(0,u.jsx)(O,{node:e},t)})):void 0,i?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{style:n.light,children:"</"}),(0,u.jsx)("span",{style:n.medium,children:t.tagName}),(0,u.jsx)("span",{style:n.light,children:">"})]}):void 0]})}const V=c().object({required:{id:c().number(),type:c().literals("context","human","assistant","observation","instructions")},optional:{}});const z=c().object({required:{inferenceId:c().string(),type:c().literals(...n(457726).jC)},optional:{}});function W(e){const{data:t,wordsToHighlight:n,shouldExpandNode:s,collectionLimit:r}=e,c=(0,a.useMemo)((()=>({scheme:"scheme",author:"author",base00:"unset",base01:o().Tj.text.tertiary,base02:o().Tj.text.secondary,base03:o().Tj.text.secondary,base04:o().Tj.text.secondary,base05:o().Tj.text.primary,base06:o().Tj.text.primary,base07:o().Tj.text.primary,base08:o().Tj.text.secondary,base09:o().Tj.blue.text.accentPrimary,base0A:o().Tj.text.tertiary,base0B:o().Tj.green.text.accentPrimary,base0C:o().Tj.text.secondary,base0D:o().Tj.text.secondary,base0E:o().Tj.purple.text.accentPrimary,base0F:o().Tj.text.tertiary})),[]);return(0,u.jsx)("div",{style:{position:"relative",width:"100%"},children:(0,u.jsx)(i().d,{data:t,invertTheme:!1,collectionLimit:r,theme:{extend:c,tree:{marginTop:0,marginBottom:0,marginLeft:0,paddingTop:0,userSelect:"auto"}},hideRoot:!0,shouldExpandNode:s,getItemString:(e,t,n,a,i)=>{return s=t,(0,l().Xj)(V,s)?(0,u.jsx)(U,{step:t}):function(e){return(0,l().Xj)(z,e)}(t)?(0,u.jsx)(H,{step:t}):(0,u.jsxs)("span",{style:{color:o().Tj.text.secondary},children:[n," ",a]});var s},valueRenderer:(e,t,...i)=>{return"string"==typeof t&&t.startsWith("<")?(0,u.jsx)("div",{children:(0,u.jsx)(B,{xml:t,defaultExpanded:t.length<300})}):"string"==typeof t&&t.trim().startsWith("Human: <")?(0,u.jsx)("div",{style:{color:o().Tj.text.tertiary,display:"inline"},children:`[Transcript "${t.trim().slice(0,24)}..."]`}):"stack"===i[0]?(s=t,(0,u.jsx)(u.Fragment,{children:(0,d().G)(s.split("\n"),(()=>(0,u.jsx)("br",{})))})):n?function(e,t){const n=e.split("\n");return n.map(((e,i)=>(0,u.jsxs)(a.Fragment,{children:[e.split(" ").map(((e,n)=>t.includes(e.toLowerCase())?(0,u.jsx)("span",{style:{color:"orange"},children:e},n):(0,u.jsx)("span",{children:e},n))).reduce(((e,t)=>(0,u.jsx)(u.Fragment,{children:[e," ",t]}))),i===n.length-1?null:(0,u.jsx)("br",{})]},i)))}(e,n):(0,u.jsx)(u.Fragment,{children:e});var s}})})}function U(e){const{step:t}=e,n=(0,s().IS)((()=>{let e;return"assistant"===t.type?e=o().Tj.palette.purple[200]:"context"===t.type?e=o().Tj.palette.green[200]:"human"===t.type?e=o().Tj.palette.blue[200]:"observation"===t.type?e="error"===t.observationType?o().Tj.palette.red[200]:o().Tj.palette.brown[200]:"instructions"===t.type?e=o().Tj.palette.yellow[200]:(0,r().HB)(t),{wrap:{backgroundColor:e,borderRadius:4,padding:2}}}),[t]);let a=`${t.type} step`;return"observation"===t.type&&(a=`${t.observationType} ${a}`),(0,u.jsx)("span",{style:n.wrap,children:a})}function H(e){const{step:t}=e,n=(0,s().IS)((()=>{let e=o().Tj.palette.gray[100];return"human"===t.type?e=o().Tj.palette.blue[200]:"assistantChat"===t.type?e=o().Tj.palette.purple[200]:"groupedEditCard"===t.type?e=o().Tj.palette.yellow[200]:"humanAction"===t.type&&(e=o().Tj.palette.green[200]),{wrap:{backgroundColor:e,borderRadius:4,padding:2}}}),[t]),a=`${t.type} ClientStep`;return(0,u.jsx)("span",{style:n.wrap,children:a})}},505776:(e,t,n)=>{n.d(t,{A:()=>i});class a extends(()=>n(757695))().Store{constructor(...e){super(...e),this.updatePreviewState=e=>{this.update((t=>({...t,previewCanvasState:e(t.previewCanvasState)})))}}getInitialState(){return{chart:void 0,responsiveChartOptions:void 0,previewCanvasState:void 0,exportBackgroundColor:"gradient"}}}const i=a},514624:(e,t,n)=>{n.d(t,{T:()=>s});n(18107),n(967357),n(898992),n(672577);var a=()=>n(590526),i=()=>n(996477);function s(e){return(0,a().K8)((()=>{if(!e)return;const t=e.assistantConfigurationStore.state;if(!t.sampling&&!t.evaluating&&!e.isCurrentlyCommittingHumanStepFromStoreState)return;const n=e.temporaryClientStepsFromStoreState.find((e=>"assistantChat"===e.type||"assistantTransaction"===e.type||"assistantChatText"===e.type||"assistantRetry"===e.type));if(n&&"assistantRetry"!==n.type&&("assistantTransaction"===n.type||!(0,i().Cb)(n)))return;const a=e.getCombinedSteps().at(-1);return{loadingStep:a&&(s=a,"assistantShowSearchResults"===s.type||"assistantSearchPeople"===s.type||"assistantQueryingDatabase"===s.type||"assistantLoadDatabase"===s.type||"assistantLoadPage"===s.type||"queryDatabase"===s.type||"assistantRetry"===s.type||"assistantSearchDatabases"===s.type||"groupedEditCard"===s.type)?a:void 0};var s}),[e])}},515692:(e,t,n)=>{n.d(t,{Ap:()=>w,GI:()=>R,Jc:()=>_,Kk:()=>T,XF:()=>B,ef:()=>j,h2:()=>A,h6:()=>P,md:()=>C,z$:()=>M});n(18107),n(967357);var a=n(296540),i=()=>n(587682),s=()=>n(484714),o=()=>n(590526),r=()=>n(86159),l=()=>n(404931),c=()=>n(847832),d=()=>n(591779),u=()=>n(340498),p=()=>n(206267),g=()=>n(534177),m=()=>n(631611),h=()=>n(190547),f=()=>n(673477),y=()=>n(295304),v=()=>n(260850),S=()=>n(547149),b=()=>n(251383),x=()=>n(754461),I=()=>n(977270),k=()=>n(120013);const w={page:!0,collection:!1,createPage:!1,user:!0,inviteUserToWorkspace:!1,inviteUserToPage:!1,date:!0,reminder:!1,bot:!1,group:!1,team:!1,heading:!1,templateVariable:!1,formulaContextVariable:!1,slackSpecialMention:!1,property:!1},C=(0,n(756005).xS)(w),A=["user","page","date"];function T(e){const{assistantChatRenderState:t,requestedSkill:n,isSampling:a,emptyStateResultsIsEmpty:i,isDeepFindActive:s,isDeepFindFollowupInput:r}=e,d=(0,m().jw)(),u="empty_state"===(null==t?void 0:t.type),p=(0,o().K8)((()=>k().A.state.available),[]);if(s)return r?{type:"deep_find_followup"}:{type:"deep_find"};if(u&&n&&(0,c().Gt)(n.skillType)){return"blockOrText"!==(0,c().Bf)(n.skillType).parameterDefinition.type||p?{type:"select_parameters"}:{type:"select_parameters_freeform"}}return n&&(0,l().dc)(n.skillType).requiresInput?{type:"input_parameter"}:u&&i?{type:"default",isWriter:d.isWriter}:u?{type:"empty_state"}:"chat"===(null==t?void 0:t.type)&&a?{type:"inferencing"}:"research_mode_chat"===(null==t?void 0:t.type)?a?{type:"research_mode_inferencing"}:{type:"research_mode"}:{type:"default",isWriter:d.isWriter}}const j=(0,n(69708).YK)({default:{id:"assistantRichTextInput.placeholder",defaultMessage:"Ask AI anything"},empty_state:{id:"assistantRichTextInput.placeholder.empty_state",defaultMessage:"Ask anything or select"},deep_find_followup:{id:"assistantRichTextInput.placeholder.deep_find_followup",defaultMessage:"Ask a follow up question"},research_mode:{id:"assistantRichTextInput.placeholder.research_mode_followup",defaultMessage:"Ask a follow up question"}});function M(e){const{sessionContext:t,environment:n,store:a,assistantSurface:i}=e,s=(0,x().p)({environment:n,sessionContext:t,assistantSurface:i});if(s){const{lastHumanStepText:e,lastUploadedFileData:i,sessionEnded:o}=s;if(t.addTemporaryOperationsToUncommittedOperations(),(0,b().V)({environment:n,sessionId:t.sessionIdFromStoreState}),t.caches.removeDefaultCacheOverride(n),i){t.getTemporaryAttachmentStagedDataOrInstantiate().stagedAttachmentUploadStore.setCompletedFileForRetry(i);const e={inferenceId:p().JW(),type:"clientAssistantHumanAttachmentUpload",fileData:i};t.stageAttachmentClientStep(e);const n=t.evaluatorFromStoreState.createAttachmentObservationStep(i);t.stageAttachmentEngineStep(n)}o||(S().createAndCommit({userAction:"AssistantRichTextInput.stopStepSubmission",environment:n,canUndo:!0,perform:t=>{y().R9({environment:n,store:a,value:e,transaction:t})}}),(0,v().z)({store:a}))}return I().assistantAnalyticsActions.trackUserStoppedAssistantOutput(n,{sessionId:t.sessionIdFromStoreState,assistantSurfaceType:i.type}),s}function _(e,t){return e?u().Ev.xl:t?24:u().Ev.lg}function P(e){return e?26:24}function D(){if(f().Ay.state.open&&f().Ay.state.selectionRect){const e=r().getSelectionRect();if(!e)return;const t=f().Ay.state.selectionRect,n=new(i().z8)(t.x,e.y,t.width,e.height);f().Ay.setState({...f().Ay.state,selectionRect:n})}}function E(e){const[t,n]=(0,o().K8)((()=>f().Ay.state.open?[!0,f().Ay.state.textStore]:[!1,void 0]),[]);return t&&n===e}function R(e,t){const n=E(t),i=(0,a.useRef)(0);(0,a.useEffect)((()=>{if(e.current&&n){const t=new ResizeObserver((e=>{var t;const n=null===(t=e.at(0))||void 0===t||null===(t=t.target)||void 0===t?void 0:t.scrollHeight;(0,g().O9)(n)&&n!==i.current&&(i.current=n,D())}));return t.observe(e.current),()=>{t.disconnect()}}i.current=0}),[e,n])}function B(e){const{isMobileNative:t}=(0,s().Y0)(),n=E(e),i=(0,h().v)({enabled:t&&n}),o=(0,d().ZC)(i);(0,a.useEffect)((()=>{!i&&o&&D()}),[i,o])}},517397:(e,t,n)=>{n.d(t,{F:()=>s});n(296540);var a=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"2.4 2.88 15.21 14.27",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M7.975 5.175a.55.55 0 1 0 0 1.1h4.05a.55.55 0 1 0 0-1.1zm-.55 2.692a.55.55 0 0 1 .55-.55h4.05a.55.55 0 1 1 0 1.1h-4.05a.55.55 0 0 1-.55-.55"}),(0,a.jsx)("path",{d:"M2.4 4.861c0-1.092.883-1.975 1.975-1.975h8.55c1.092 0 1.975.883 1.975 1.975v7.889h2.075c.345 0 .625.28.625.625v1.8a1.973 1.973 0 0 1-1.975 1.975h-8.55A1.973 1.973 0 0 1 5.1 15.175V7.25H3.025a.625.625 0 0 1-.625-.625zM9.554 15.9h6.07a.723.723 0 0 0 .726-.725V14H9.5v1.175c0 .256-.049.5-.137.725zm-2.025 0c.4-.002.72-.325.72-.725v-1.8c0-.345.28-.625.626-.625h4.775V4.861a.723.723 0 0 0-.725-.725H6.213c.088.224.137.469.137.725v10.314c0 .402.323.725.725.725zM5.1 4.861a.723.723 0 0 0-.724-.725.723.723 0 0 0-.725.725V6H5.1z"})]})},s=(0,n(340498).wt)("scroll",i,"default")},520937:(e,t,n)=>{n.d(t,{iS:()=>w,kO:()=>A,vJ:()=>j,gH:()=>M,Fi:()=>S});n(296540);var a=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 16.12 14.98",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M18.12 10.953a.626.626 0 0 1 1.014.732l-4.449 6.157a.626.626 0 0 1-.94.083l-2.966-2.873a.626.626 0 0 1 .87-.899l2.446 2.37z"}),(0,a.jsx)("path",{d:"M14.75 3.125c1.174 0 2.125.951 2.125 2.125v5.294l-1.25 1.73v-5.46H4.375v7.936c0 .483.392.875.875.875h4.395q.111.174.265.324l.955.926H5.25a2.125 2.125 0 0 1-2.125-2.125v-9.5c0-1.174.951-2.125 2.125-2.125z"}),(0,a.jsx)("path",{d:"M6.528 12.778a.695.695 0 1 1 0 1.39.695.695 0 0 1 0-1.39m2.315 0a.695.695 0 1 1 0 1.39.695.695 0 0 1 0-1.39m-2.315-2.315a.695.695 0 1 1 0 1.39.695.695 0 0 1 0-1.39m2.315 0a.695.695 0 1 1-.001 1.39.695.695 0 0 1 0-1.39m2.315 0a.694.694 0 1 1 0 1.389.694.694 0 0 1 0-1.39m2.316.001a.695.695 0 1 1-.001 1.39.695.695 0 0 1 0-1.39M8.843 8.148a.695.695 0 1 1 0 1.39.695.695 0 0 1 0-1.39m2.314 0a.694.694 0 1 1 0 1.389.694.694 0 0 1 0-1.389m2.316 0a.695.695 0 1 1 0 1.39.695.695 0 0 1 0-1.39"})]})},s=(0,n(340498).wt)("calendarCheck",i,"default");var o=()=>n(425940),r=()=>n(575157),l=()=>n(116089),c=()=>n(207207),d=()=>n(105819),u=()=>n(37719),p=()=>n(824375),g=()=>n(877235),m=()=>n(421559),h=()=>n(69708),f=()=>n(751735),y=()=>n(100622),v=()=>n(949575);const S=(0,h().YK)({summarize:{defaultMessage:"Summarize",id:"skills.summarize"},fillTitle:{defaultMessage:"Fill page title",id:"skills.fillTitle"},chatKeyPoints:{defaultMessage:"Summarize",id:"skills.keyPoints"},chatActionItems:{defaultMessage:"Find action items",id:"skills.chatActionItems"},brainstormIdeas:{defaultMessage:"Brainstorm ideas",id:"skills.brainstormIdeas"},writeCode:{defaultMessage:"Get help with code",id:"skills.writeCode"},searchQnA:{defaultMessage:"Ask a question",id:"skills.searchQnA"},pageQnA:{defaultMessage:"Ask about this page",id:"skills.pageQnA"},fixSpellingGrammar:{defaultMessage:"Proofread",id:"skills.fixSpellingGrammar"},addSummary:{defaultMessage:"Add a summary",id:"skills.addSummary"},addKeyPoints:{defaultMessage:"Add a summary",id:"skills.addKeyPoints"},addActionItems:{defaultMessage:"Add action items",id:"skills.addActionItems"},custom:{defaultMessage:"Custom AI action",id:"skills.custom"},draftOutline:{defaultMessage:"Draft an outline",id:"skills.draftOutline"},draftTemplate:{defaultMessage:"Draft a template",id:"skills.draftTemplate"},draftTable:{defaultMessage:"Make a table",id:"skills.makeTable"},draftDiagram:{defaultMessage:"Make a flowchart",id:"skills.makeDiagram"},draftPoem:{defaultMessage:"Draft a poem",id:"skills.draftPoem"},draftEmail:{defaultMessage:"Draft an email",id:"skills.draftEmail"},draftMeetingAgenda:{defaultMessage:"Draft a meeting agenda",id:"skills.draftMeetingAgenda"},continueWriting:{defaultMessage:"Continue writing",id:"skills.continueWriting"},translate:{defaultMessage:"Translate to",id:"skills.translate"},translatePage:{defaultMessage:"Translate page",id:"skills.translatePage"},improveWriting:{defaultMessage:"Improve writing",id:"skills.improveWriting"},improveFormatting:{defaultMessage:"Improve formatting",id:"skills.improveFormatting"},makeShorter:{defaultMessage:"Make shorter",id:"skills.makeShorter"},makeLonger:{defaultMessage:"Make longer",id:"skills.makeLonger"},changeTone:{defaultMessage:"Change tone",id:"skills.changeTone"},reformat:{defaultMessage:"Reformat",id:"skills.reformat"},simplifyLanguage:{defaultMessage:"Simplify language",id:"skills.simplifyLanguage"},explainThis:{defaultMessage:"Explain",id:"skills.explainThis"},databaseFiling:{defaultMessage:"Add a new page in",id:"skills.databaseFiling"},queryDatabase:{defaultMessage:"Ask or find in",id:"skills.queryDatabase"},newPageFromTemplate:{defaultMessage:"Fill template",id:"skills.newPageFromTemplate"},helpMeDraft:{defaultMessage:"Draft anything",id:"skills.helpMeDraft"},helpMeWrite:{defaultMessage:"Write anything",id:"skills.helpMeWrite"},helpMeEdit:{defaultMessage:"Edit selection",id:"skills.helpMeEdit"},createQuiz:{defaultMessage:"Make a quiz",id:"skills.createQuiz"},searchWorkspace:{id:"skills.searchWorkspace",defaultMessage:"Notion"},searchAiKnowledge:{id:"skills.searchAiKnowledge",defaultMessage:"AI knowledge"},newYearsResolution:{id:"skills.newYearsResolution",defaultMessage:"New Years resolution"},summarizeTranscript:{id:"skills.summarizeTranscript",defaultMessage:"Summarize transcript"},alphabetizeList:{id:"skills.alphabetizeList",defaultMessage:"Alphabetize list"}}),b=(0,h().YK)({searchQnADefaultAssistantMessage:{defaultMessage:"Ask me anything, Ill try to find an answer in pages and connected apps you have access to.",id:"skills.searchQnADefaultAssistantMessage"},brainstormIdeasDefaultAssistantMessage:{defaultMessage:"What to brainstorm about? Ill help you come up with ideas.",id:"skills.brainstormIdeasDefaultAssistantMessage"},writeCodeDefaultAssistantMessage:{defaultMessage:"What coding problem are we solving today? Let me help you with that.",id:"skills.writeCodeDefaultAssistantMessage"},pageQnADefaultAssistantMessage:{defaultMessage:"Ask anything about whats on the page.",id:"skills.pageQnADefaultAssistantMessage"},draftOutlineDefaultAssistantMessage:{defaultMessage:"Describe topic and format for the outline. Ill help you draft it.",id:"skills.draftOutlineDefaultAssistantMessage"},draftTemplateDefaultAssistantMessage:{defaultMessage:"Describe what the template is used for, and its format. Ill help you make it.",id:"skills.draftTemplateDefaultAssistantMessage"},draftTableDefaultAssistantMessage:{defaultMessage:"Whats the table about? Ill help you make it.",id:"skills.makeTableDefaultAssistantMessage"},draftDiagramDefaultAssistantMessage:{defaultMessage:"Whats the flowchart about? Ill help you make it.",id:"skills.makeDiagramDefaultAssistantMessage"},draftPoemDefaultAssistantMessage:{defaultMessage:"Whats the poem about? Ill help you draft it.",id:"skills.draftPoemDefaultAssistantMessage"},draftEmailDefaultAssistantMessage:{defaultMessage:"Whats the email about? Ill help you draft it.",id:"skills.draftEmailDefaultAssistantMessage"},draftMeetingAgendaDefaultAssistantMessage:{defaultMessage:"Whats the meeting about? Ill help you draft an agenda.\nFeel free to @-mention past meetings or other pages for context.",id:"skills.draftMeetingAgendaDefaultAssistantMessage"},databaseFilingDefaultAssistantMessage:{defaultMessage:"What do you want to add to this database?\nFeel free to mention any properties, topics, and format.",id:"skills.databaseFilingDefaultAssistantMessage"},queryDatabaseDefaultAssistantMessage:{defaultMessage:"Ask me a question about this database, Ill help you find an answer.",id:"skills.queryDatabaseDefaultAssistantMessage"},newPageFromTemplateDefaultAssistantMessage:{defaultMessage:"Whats the new page about? Feel free to @-mention other pages for context.",id:"skills.newPageFromTemplateDefaultAssistantMessage"},helpMeDraftDefaultAssistantMessage:{defaultMessage:"Whats the new page about? Feel free to @-mention other pages for context.",id:"skills.helpMeDraftDefaultAssistantMessage"},helpMeWriteDefaultAssistantMessage:{defaultMessage:"Describe what to write. Ill help you add it.",id:"skills.helpMeWriteDefaultAssistantMessage"},helpMeEditDefaultAssistantMessage:{defaultMessage:"What do you want to change in this selection? Ill help you edit it.",id:"skills.helpMeEditDefaultAssistantMessage"},searchWorkspaceDefaultAssistantMessage:{defaultMessage:"Ask me anything, Ill try to find an answer from your workspace.",id:"skills.searchWorkspaceDefaultAssistantMessage"},searchAiKnowledgeDefaultAssistantMessage:{defaultMessage:"Ask me anythinglike What are the health benefits of green tea?",id:"skills.searchAiKnowledgeDefaultAssistantMessage"},newYearsResolutionDefaultAssistantMessage:{defaultMessage:"What are you trying to achieve in 2025? Ill write a plan for you.",id:"skills.newYearsResolutionDefaultAssistantMessage"},summarizeTranscriptDefaultAssistantMessage:{defaultMessage:"Summarize the transcript of the meeting you just had.",id:"skills.summarizeTranscriptDefaultAssistantMessage"}}),x=[v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.and(v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isCornerEntrypoint),v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isSelectedBlockEmpty)),v().assistantSurfaceActionValidators.isEditingAutomationButton)],I=[...x,v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.isPageEditable,v().assistantSurfaceActionValidators.isEditingAutomationButton)],k=[v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isWriterEntrypoint),v().assistantSurfaceActionValidators.isSelectedBlockEmpty),v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isPageAvailable),v().assistantSurfaceActionValidators.isPageEditable)],w={summarize:{displayName:S.summarize,assistantMessage:void 0,icon:u().P,category:"thinkAskChat",validators:[v().assistantSurfaceActionValidators.never],boosters:[v().assistantSurfaceActionValidators.isPageLong,v().assistantSurfaceActionValidators.isSelectionLong,[v().assistantSurfaceActionValidators.isCornerEntrypoint,3],v().assistantSurfaceActionValidators.isFullPageEntrypoint,v().assistantSurfaceActionValidators.hasContentfulPageOrSelection]},chat_key_points:{displayName:S.chatKeyPoints,assistantMessage:void 0,icon:u().P,category:"thinkAskChat",validators:[v().assistantSurfaceActionValidators.entrypointSupportsParameterization],boosters:[v().assistantSurfaceActionValidators.isPageLong,v().assistantSurfaceActionValidators.isSelectionLong]},chat_action_items:{displayName:S.chatActionItems,assistantMessage:void 0,icon:o().a,category:"thinkAskChat",validators:[v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.isEditingAutomationButton,v().assistantSurfaceActionValidators.and(v().assistantSurfaceActionValidators.isAssistantSurface,v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isWriterEntrypoint),v().assistantSurfaceActionValidators.hasContentfulPageOrSelection),v().assistantSurfaceActionValidators.isCornerEntrypoint)],boosters:[v().assistantSurfaceActionValidators.isPageLong,v().assistantSurfaceActionValidators.isSelectionLong]},add_summary:{displayName:S.addSummary,assistantMessage:void 0,icon:u().P,category:"writeInsert",validators:[v().assistantSurfaceActionValidators.never],boosters:[v().assistantSurfaceActionValidators.isPageLong,v().assistantSurfaceActionValidators.isSelectionLong]},add_key_points:{displayName:S.addKeyPoints,assistantMessage:void 0,icon:u().P,category:"writeInsert",validators:[v().assistantSurfaceActionValidators.isWriterEntrypoint,v().assistantSurfaceActionValidators.isSelectedBlockEmpty,v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isPageEmpty)],boosters:[v().assistantSurfaceActionValidators.isPageLong,v().assistantSurfaceActionValidators.isSelectionLong]},add_action_items:{displayName:S.addActionItems,assistantMessage:void 0,icon:o().a,category:"writeInsert",validators:[v().assistantSurfaceActionValidators.isWriterEntrypoint,v().assistantSurfaceActionValidators.isSelectedBlockEmpty,v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isPageEmpty)],boosters:[v().assistantSurfaceActionValidators.isPageLong,v().assistantSurfaceActionValidators.isSelectionLong]},search_qna:{displayName:S.searchQnA,assistantMessage:b.searchQnADefaultAssistantMessage,icon:c().magnifyingGlassIcon,category:"findSearch",validators:[v().assistantSurfaceActionValidators.isAssistantSurface],boosters:[v().assistantSurfaceActionValidators.isFullPageEntrypoint]},fill_title:{displayName:S.fillTitle,assistantMessage:void 0,icon:n(435644).a,category:"edit",validators:[v().assistantSurfaceActionValidators.never],boosters:[[v().assistantSurfaceActionValidators.isPageTitleEmpty,5],[v().assistantSurfaceActionValidators.isPageStartEntrypoint,5],v().assistantSurfaceActionValidators.isPageEndEntrypoint]},brainstorm_ideas:{displayName:S.brainstormIdeas,assistantMessage:b.brainstormIdeasDefaultAssistantMessage,icon:n(123411).lightBulbBrightIcon,category:"thinkAskChat",validators:[v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.isSelectedBlockEmpty,v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isWriterEntrypoint))],boosters:[v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.isEditingAutomationButton,v().assistantSurfaceActionValidators.and(v().assistantSurfaceActionValidators.isPageEndEntrypoint,v().assistantSurfaceActionValidators.isPageEmpty,v().assistantSurfaceActionValidators.isFullPageEntrypoint))]},write_code:{displayName:S.writeCode,assistantMessage:b.writeCodeDefaultAssistantMessage,icon:n(481721).codeIcon,category:"thinkAskChat",validators:[v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isPageEndEntrypoint),v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isCornerEntrypoint)],boosters:[v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.isEditingAutomationButton,v().assistantSurfaceActionValidators.selectionContainsBlockType("code"))]},page_qna:{displayName:S.pageQnA,assistantMessage:b.pageQnADefaultAssistantMessage,icon:c().magnifyingGlassIcon,category:"findSearch",validators:[v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.isEditingAutomationButton,v().assistantSurfaceActionValidators.and(v().assistantSurfaceActionValidators.isPageAvailable,v().assistantSurfaceActionValidators.isPageFilled),v().assistantSurfaceActionValidators.isCornerEntrypoint)],boosters:[[v().assistantSurfaceActionValidators.isCornerEntrypoint,4]]},fix_spelling_grammar:{displayName:S.fixSpellingGrammar,assistantMessage:void 0,icon:n(671089).checkmarkCircleIcon,category:"edit",validators:[...I,v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isBlockPasteMenuEntrypoint),v().assistantSurfaceActionValidators.isSelectionExtraLong),v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isSelectionEmpty)],boosters:[v().assistantSurfaceActionValidators.isSelectionLong,v().assistantSurfaceActionValidators.isSelectionMultiline,[v().assistantSurfaceActionValidators.isCornerEntrypoint,4]]},draft_outline:{displayName:S.draftOutline,assistantMessage:b.draftOutlineDefaultAssistantMessage,icon:d().pencilLineIcon,category:"create",validators:k,boosters:[v().assistantSurfaceActionValidators.isPageEmpty,[v().assistantSurfaceActionValidators.isFullPageEntrypoint,-4]]},draft_template:{displayName:S.draftTemplate,assistantMessage:b.draftTemplateDefaultAssistantMessage,icon:r().D,category:"create",validators:[v().assistantSurfaceActionValidators.never]},draft_table:{displayName:S.draftTable,assistantMessage:b.draftTableDefaultAssistantMessage,icon:m().T,category:"writeInsert",validators:k,boosters:[v().assistantSurfaceActionValidators.isFullPageEntrypoint,v().assistantSurfaceActionValidators.isSelectionLong]},draft_diagram:{displayName:S.draftDiagram,assistantMessage:b.draftDiagramDefaultAssistantMessage,icon:n(413364).E,category:"writeInsert",validators:k,boosters:[v().assistantSurfaceActionValidators.isPageLong,v().assistantSurfaceActionValidators.isFullPageEntrypoint]},draft_poem:{displayName:S.draftPoem,assistantMessage:b.draftPoemDefaultAssistantMessage,icon:d().pencilLineIcon,category:"create",validators:[v().assistantSurfaceActionValidators.never],boosters:[v().assistantSurfaceActionValidators.isPageEmpty,[v().assistantSurfaceActionValidators.isFullPageEntrypoint,-5]]},draft_email:{displayName:S.draftEmail,assistantMessage:b.draftEmailDefaultAssistantMessage,icon:d().pencilLineIcon,category:"create",validators:[...k,v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isCornerEntrypoint)],boosters:[v().assistantSurfaceActionValidators.isPageEmpty,[v().assistantSurfaceActionValidators.isFullPageEntrypoint,-5]]},draft_meeting_agenda:{displayName:S.draftMeetingAgenda,assistantMessage:b.draftMeetingAgendaDefaultAssistantMessage,icon:d().pencilLineIcon,category:"create",validators:[...k,v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isCornerEntrypoint)],boosters:[v().assistantSurfaceActionValidators.isPageEmpty,[v().assistantSurfaceActionValidators.isFullPageEntrypoint,-5]]},continue_writing:{displayName:S.continueWriting,assistantMessage:void 0,icon:d().pencilLineIcon,category:"edit",validators:[v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isPageEmpty),v().assistantSurfaceActionValidators.isWriterEntrypoint,v().assistantSurfaceActionValidators.isPageEditable,v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.isSelectionEmpty,v().assistantSurfaceActionValidators.isSelectedBlockEmpty)],boosters:[v().assistantSurfaceActionValidators.isSelectionEmpty,[v().assistantSurfaceActionValidators.isPageLong,5]]},translate:{displayName:S.translate,assistantMessage:void 0,icon:g().textTranslateIcon,category:"thinkAskChat",validators:[v().assistantSurfaceActionValidators.and(v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isSelectedBlockEmpty),v().assistantSurfaceActionValidators.isEditingAutomationButton),v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isCornerEntrypoint))],boosters:[[v().assistantSurfaceActionValidators.and(v().assistantSurfaceActionValidators.isWriterEntrypoint,v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isSelectedBlockEmpty)),5]]},translate_page:{displayName:S.translatePage,assistantMessage:void 0,icon:g().textTranslateIcon,category:"thinkAskChat",validators:[v().assistantSurfaceActionValidators.and(v().assistantSurfaceActionValidators.isCornerEntrypoint,v().assistantSurfaceActionValidators.isPageFilled,v().assistantSurfaceActionValidators.shouldShowFullPageTranslateSkill)],boosters:[[v().assistantSurfaceActionValidators.isCornerEntrypoint,5]]},improve_writing:{displayName:S.improveWriting,assistantMessage:void 0,icon:l().x,category:"edit",validators:[...I,v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isSelectionEmpty),v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isBlockPasteMenuEntrypoint),v().assistantSurfaceActionValidators.isSelectionExtraLong)],boosters:[[v().assistantSurfaceActionValidators.isWriterEntrypoint,5],[v().assistantSurfaceActionValidators.isCornerEntrypoint,4],v().assistantSurfaceActionValidators.isSelectionLong,[v().assistantSurfaceActionValidators.isRichTextMenuEntrypoint,10]]},improve_formatting:{displayName:S.improveFormatting,assistantMessage:void 0,icon:n(594952).I,category:"edit",validators:[v().assistantSurfaceActionValidators.never],boosters:[]},make_shorter:{displayName:S.makeShorter,assistantMessage:void 0,icon:n(469635).t,category:"edit",validators:[...I,v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isBlockPasteMenuEntrypoint),v().assistantSurfaceActionValidators.isSelectionExtraLong)],boosters:[v().assistantSurfaceActionValidators.isSelectionMultiline,v().assistantSurfaceActionValidators.isSelectionLong]},make_longer:{displayName:S.makeLonger,assistantMessage:void 0,icon:n(467248).i,category:"edit",validators:I,boosters:[v().assistantSurfaceActionValidators.isSelectionShort]},reformat:{displayName:S.reformat,assistantMessage:void 0,icon:p().sparklesIcon,category:"edit",validators:[v().assistantSurfaceActionValidators.isFeatureGateEnabled("agent_writer")],boosters:[]},change_tone:{displayName:S.changeTone,assistantMessage:void 0,icon:n(724925).l,category:"edit",validators:I,boosters:[v().assistantSurfaceActionValidators.isSelectionLong]},simplify_language:{displayName:S.simplifyLanguage,assistantMessage:void 0,icon:p().sparklesIcon,category:"edit",validators:I,boosters:[v().assistantSurfaceActionValidators.isSelectionMultiline,v().assistantSurfaceActionValidators.isSelectionLong]},explain_this:{displayName:S.explainThis,assistantMessage:void 0,icon:n(406533).questionMarkCircleIcon,category:"thinkAskChat",validators:[...x,v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isSelectionLong)],boosters:[v().assistantSurfaceActionValidators.isSelectionShort,[v().assistantSurfaceActionValidators.isRichTextMenuEntrypoint,20]]},custom:{displayName:S.custom,assistantMessage:void 0,icon:l().x,category:"custom",validators:[v().assistantSurfaceActionValidators.isEditingAutomationButton]},database_filing:{displayName:S.databaseFiling,assistantMessage:b.databaseFilingDefaultAssistantMessage,icon:n(617668).plusIcon,category:"create",validators:[v().assistantSurfaceActionValidators.entrypointSupportsParameterization,v().assistantSurfaceActionValidators.canUseDatabaseSkills],boosters:[v().assistantSurfaceActionValidators.isFullPageEntrypoint,v().assistantSurfaceActionValidators.isCornerEntrypoint,[v().assistantSurfaceActionValidators.isCollection,2]]},query_database:{displayName:S.queryDatabase,assistantMessage:b.queryDatabaseDefaultAssistantMessage,icon:m().T,category:"findSearch",validators:[v().assistantSurfaceActionValidators.entrypointSupportsParameterization,v().assistantSurfaceActionValidators.canUseDatabaseSkills],boosters:[v().assistantSurfaceActionValidators.isFullPageEntrypoint,v().assistantSurfaceActionValidators.isCornerEntrypoint,[v().assistantSurfaceActionValidators.isCollection,2]]},new_page_from_template:{displayName:S.newPageFromTemplate,assistantMessage:b.newPageFromTemplateDefaultAssistantMessage,icon:r().D,category:"create",validators:[v().assistantSurfaceActionValidators.never],boosters:[v().assistantSurfaceActionValidators.isPageEmpty,v().assistantSurfaceActionValidators.isFullPageEntrypoint,v().assistantSurfaceActionValidators.isCornerEntrypoint]},help_me_draft:{displayName:S.helpMeDraft,category:"create",assistantMessage:b.helpMeDraftDefaultAssistantMessage,icon:d().pencilLineIcon,validators:k,boosters:[]},help_me_write:{displayName:S.helpMeWrite,category:"writeInsert",assistantMessage:b.helpMeWriteDefaultAssistantMessage,icon:d().pencilLineIcon,validators:[v().assistantSurfaceActionValidators.isWriterEntrypoint],boosters:[]},help_me_edit:{displayName:S.helpMeEdit,category:"edit",assistantMessage:b.helpMeEditDefaultAssistantMessage,icon:d().pencilLineIcon,validators:[v().assistantSurfaceActionValidators.isWriterEntrypoint,v().assistantSurfaceActionValidators.hasSelection],boosters:[]},create_quiz:{displayName:S.createQuiz,category:"thinkAskChat",assistantMessage:void 0,icon:d().pencilLineIcon,validators:[v().assistantSurfaceActionValidators.isStudent,v().assistantSurfaceActionValidators.isCornerEntrypoint],boosters:[[v().assistantSurfaceActionValidators.isStudent,10]]},search_workspace:{displayName:S.searchWorkspace,category:"findSearch",assistantMessage:b.searchWorkspaceDefaultAssistantMessage,icon:n(182183).notionTintableIcon,validators:[v().assistantSurfaceActionValidators.isCornerEntrypoint]},search_ai_knowledge:{displayName:S.searchAiKnowledge,category:"findSearch",assistantMessage:b.searchAiKnowledgeDefaultAssistantMessage,icon:p().sparklesIcon,validators:[v().assistantSurfaceActionValidators.isCornerEntrypoint]},new_years_resolution:{displayName:S.newYearsResolution,category:"create",assistantMessage:b.newYearsResolutionDefaultAssistantMessage,icon:s,validators:[v().assistantSurfaceActionValidators.never],boosters:[v().assistantSurfaceActionValidators.isPageEmpty,v().assistantSurfaceActionValidators.isFullPageEntrypoint]},summarize_transcript:{displayName:S.summarizeTranscript,category:"thinkAskChat",assistantMessage:b.summarizeTranscriptDefaultAssistantMessage,icon:u().P,validators:[v().assistantSurfaceActionValidators.never],boosters:[]},alphabetize_list:{displayName:S.alphabetizeList,category:"edit",assistantMessage:void 0,icon:n(782452).Q,validators:[...I,v().assistantSurfaceActionValidators.not(v().assistantSurfaceActionValidators.isSelectionEmpty),v().assistantSurfaceActionValidators.or(v().assistantSurfaceActionValidators.selectionIsEntirelyOfBlockType("bulleted_list"),v().assistantSurfaceActionValidators.selectionIsEntirelyOfBlockType("numbered_list"))],boosters:[[v().assistantSurfaceActionValidators.isWriterEntrypoint,5],[v().assistantSurfaceActionValidators.isCornerEntrypoint,4],[v().assistantSurfaceActionValidators.isRichTextMenuEntrypoint,10]]}},C=(0,h().YK)({favorite:{id:"skill.categories.favorite",defaultMessage:"Favorites"},edit:{id:"skills.categories.edit",defaultMessage:"Edit"},writeInsert:{id:"skill.categories.writeInsert",defaultMessage:"Write"},create:{id:"skill.categories.create",defaultMessage:"Draft"},thinkAskChat:{id:"skill.categories.thinkAskChat",defaultMessage:"Think, ask, chat"},findSearch:{id:"skill.categories.findSearch",defaultMessage:"Find, search"},custom:{id:"skill.categories.custom",defaultMessage:"Custom"},notionActions:{id:"skill.categories.notionActions",defaultMessage:"More"},recent:{id:"skill.categories.recent",defaultMessage:"Recents"}});function A(e,t){return{color:"dark"===t?e[700]:e[500],background:"dark"===t?(0,f().X4)(e[500],.2):(0,f().X4)(e[500],.12),hoveredBackground:"dark"===t?(0,f().X4)(e[500],.4):(0,f().X4)(e[500],.95),pressedBackground:e[100]}}const T={favorite:{label:C.favorite,color:()=>({color:y().Tj.palette.gray[500],background:y().Tj.grayButtonBackground,hoveredBackground:y().Tj.grayButtonHoveredBackground,pressedBackground:y().Tj.grayButtonPressedBackground}),boosters:[[v().assistantSurfaceActionValidators.always,11]]},edit:{label:C.edit,color:e=>A(y().Tj.palette.purple,e),boosters:[[v().assistantSurfaceActionValidators.isWriterEntrypoint,10]]},writeInsert:{label:C.writeInsert,color:e=>A(y().Tj.palette.purple,e),boosters:[[v().assistantSurfaceActionValidators.isWriterEntrypoint,10]]},create:{label:C.create,color:e=>A(y().Tj.palette.purple,e),boosters:[v().assistantSurfaceActionValidators.isPageEmpty]},thinkAskChat:{label:C.thinkAskChat,color:e=>A(y().Tj.palette.green,e),boosters:[[v().assistantSurfaceActionValidators.always,9]]},findSearch:{label:C.findSearch,color:e=>A(y().Tj.palette.blue,e),boosters:[[v().assistantSurfaceActionValidators.always,8]]},custom:{label:C.custom,color:e=>A(y().Tj.palette.blue,e),boosters:[[v().assistantSurfaceActionValidators.isEditingAutomationButton,10]]},notionActions:{label:C.notionActions,color:()=>({color:y().Tj.palette.gray[500],background:y().Tj.grayButtonBackground,hoveredBackground:y().Tj.grayButtonHoveredBackground,pressedBackground:y().Tj.grayButtonPressedBackground}),boosters:[]},recent:{label:C.recent,color:()=>({color:y().Tj.palette.gray[500],background:y().Tj.grayButtonBackground,hoveredBackground:y().Tj.grayButtonHoveredBackground,pressedBackground:y().Tj.grayButtonPressedBackground}),boosters:[]}};function j(e,t){return{...T[e],...null==t?void 0:t[e]}}function M(e,t){return(0,v().rankItemsForContext)({items:e,getBoosters:e=>j(e).boosters,context:t})}},521350:(e,t,n)=>{n.d(t,{dp:()=>r,mA:()=>o,wz:()=>s});var a=()=>n(680074);function i(e){var t;const{environment:n,featureKey:i}=e,s=(0,a().R$)(n);if(!s||!s.isReady())return;const o=null===(t=s.getSettings())||void 0===t?void 0:t.exposed_to_adoption_feature;return(null==o?void 0:o[i])??[]}function s(e){const{environment:t,featureKey:n}=e,a=i({environment:t,featureKey:n});return a?a.length>0:void 0}function o(e){var t;const{environment:n}=e,i=(0,a().R$)(n);return!(!i||!i.isReady())&&((null===(t=i.getSettings())||void 0===t?void 0:t.seen_new_user_onboarding_checklist_experience)??!1)}function r(e){var t;const{environment:n}=e,i=(0,a().R$)(n);return!(!i||!i.isReady())&&((null===(t=i.getSettings())||void 0===t?void 0:t.seen_new_user_onboarding_joiner_v2_experience)??!1)}},533927:(e,t,n)=>{n.d(t,{x7:()=>An,wY:()=>jn,_H:()=>wn,a_:()=>Tn});n(410838),n(898992),n(354520),n(672577),n(581454);var a=n(296540),i=()=>n(564884),s=()=>n(484714),o=()=>n(590526),r=()=>n(401497),l=()=>n(295633),c=()=>n(732810),d=()=>n(874832),u=()=>n(807449),p=()=>n(26697),g=()=>n(302501),m=()=>n(529099),h=()=>n(476195),f=()=>n(344417),y=()=>n(69708),v=()=>n(534177),S=()=>n(284371),b=()=>n(135221),x=()=>n(16006),I=()=>n(611491),k=()=>n(631611),w=()=>n(551345),C=()=>n(68465),A=()=>n(977270),T=()=>n(680325),j=()=>n(101927),M=()=>n(605804),_=()=>n(996477),P=()=>n(483730),D=()=>n(300474),E=()=>n(115512),R=()=>n(830010),B=()=>n(943290),F=()=>n(179034),N=n.n(n(32485)),L=()=>n(756117),O=()=>n(726637),V=()=>n(312788),z=()=>n(17022),W=()=>n(795732),U=()=>n(695115),H=()=>n(89956),K=()=>n(134589),q=()=>n(206267),$=()=>n(100622),G=()=>n(908201),Y=()=>n(512039),Q=()=>n(612900),J=()=>n(817942),X=()=>n(578405),Z=()=>n(309431),ee=()=>n(631524),te=()=>n(886358),ne=()=>n(589407),ae=n(474848);function ie(e){const{onClick:t,forceHover:n,variant:i,shouldUseUpdatedStyle:s}=e,[o,l]=(0,a.useState)(!1),c=Boolean(n||o),d=(0,r().IS)((()=>({button:{fontSize:E().vQ,fontWeight:500,color:$().Tj.text.secondary,gap:6,marginInlineStart:-8,marginTop:8,padding:8,width:"calc(100% + 16px)",height:"auto"},icon:{marginInlineEnd:3}})),[]),p=(0,r().IS)((()=>({wrap:{position:"absolute",insetInlineStart:0,insetInlineEnd:0,bottom:0,cursor:"pointer",height:24,display:"flex",justifyContent:"center",alignItems:"flex-end",fontSize:E().Kw,opacity:c?1:0,transition:"opacity 0.2s ease",...e.style},label:{display:"flex",gap:2,alignItems:"center",color:$().Tj.text.secondary,fontWeight:500,fontSize:11,borderRadius:6,padding:"2px 6px",boxShadow:"0px 0px 1px 0px rgba(0, 0, 0, 0.04), 0px 0px 2px 0px rgba(0, 0, 0, 0.06), 0px 4px 8px 0px rgba(0, 0, 0, 0.04)",background:$().Tj.whiteButtonBackground}})),[c,e.style]);return s?(0,ae.jsx)(ee().p,{style:d.button,iconLeading:{icon:ne().ellipsisIcon,style:d.icon,colorVariant:"secondary"},onClick:t,children:(0,ae.jsx)(y().sA,{id:"assistantCitationHelpers.more",defaultMessage:"More"})}):(0,ae.jsx)("div",{style:p.wrap,onClick:t,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:(0,ae.jsx)("div",{style:p.label,children:"see_more"===i?(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsx)("div",{children:(0,ae.jsx)(y().sA,{id:"assistantCitationHelpers.seeMore",defaultMessage:"See more"})}),(0,ae.jsx)(u().I,{icon:te().arrowStraightDownFillSmallIcon,size:"xs",colorVariant:"secondary"})]}):"open_page"===i?(0,ae.jsx)("div",{children:(0,ae.jsx)(y().sA,{id:"assistantCitationHelpers.openPage",defaultMessage:"Open page"})}):(0,v().HB)(i)})})}function se(e){const{isSmall:t,children:n,style:a,...i}=e,s=(0,r().IS)((()=>({wrap:{paddingInlineStart:4,paddingInlineEnd:4,...t?{fontSize:E().Kw,lineHeight:"initial"}:{height:24},...a}})),[t,a]);return(0,ae.jsx)(ee().p,{style:s.wrap,size:t?"sm":"md",...i,children:n})}var oe=()=>n(790748),re=()=>n(882722),le=()=>n(947983),ce=()=>n(390109);function de(e){const{children:t,group:n,style:i,...s}=e,o=(0,a.useRef)(null);return(0,oe().b)(le().A,(()=>({getNode:()=>o.current,getGroups:()=>[n]})),[n]),(0,ae.jsx)(ue,{style:i,...s,ref:o,className:re()._Qb,children:t})}const ue=a.forwardRef((function(e,t){const{style:n,children:a,...i}=e,s=(0,r().eP)(),o=(0,r().IS)((()=>({wrap:{display:"flex",flexDirection:"column",boxShadow:$().Tj.shadowXS,background:"dark"===s?$().Tj.background.secondaryTranslucent:$().Tj.background.primary,borderRadius:12,padding:"6px 0",maxWidth:"min(100%, 640px)",fontSize:E().vQ,marginTop:ce().ZQ,marginBottom:ce().ZQ,...n}})),[n,s]);return(0,ae.jsx)("div",{style:o.wrap,...i,ref:t,className:re()._Qb,children:a})}));var pe=()=>n(664594),ge=()=>n(920198),me=()=>n(569797),he=()=>n(26105),fe=()=>n(197636),ye=()=>n(854705),ve=()=>n(642557),Se=()=>n(360576),be=()=>n(187820),xe=()=>n(71304),Ie=()=>n(51967),ke=()=>n(292664),we=()=>n(32043);function Ce(e){const{pageStore:t,style:n,isSmall:a}=e,i=(0,r().IS)((()=>({wrap:{gap:4,borderRadius:6,color:$().Tj.text.primary,fontWeight:S().Wy.medium,fontSize:13,...n}})),[n]),s=(0,we().mI)(t),c=(0,o().K8)((()=>t.getIcon()),[t]),d=(0,o().K8)((()=>t instanceof l().B&&t.isEmptyPage()),[t]);return(0,ae.jsxs)(se,{href:s,style:i.wrap,isSmall:a,children:[c?(0,ae.jsx)(be().B6,{disabled:!0,icon:c,isEmptyPage:d,size:18}):void 0,(0,ae.jsx)(x().A,{store:t})]})}function Ae(e){const{pageStore:t,renderTitle:n,afterTitle:a,rightSide:i,detail:c,showLocationIfNotCurrentPage:d}=e,u=(0,s().v3)(),p=(0,r().IS)((()=>({wrap:{display:"flex",paddingInlineEnd:6,paddingInlineStart:8,justifyContent:"space-between",alignItems:"center",fontSize:13,...e.style},left:{display:"flex",overflow:"hidden",flexDirection:"column",marginInlineEnd:4},titleWrap:{display:"flex",alignItems:"center",overflow:"hidden"},right:{display:"flex",alignItems:"center",flexShrink:0},standalonePageTitle:{flex:"1 1 auto"},detailWrap:{display:"flex",marginInlineStart:4,fontWeight:500}})),[e.style]),g=(0,o().K8)((()=>{const e=new(l().B)(u,t.pointer);return e.isDefined()?e:void 0}),[u,t])??t,m=(0,we().K1)(g.id);let h;return h=n?(0,ae.jsx)(ae.Fragment,{children:n()}):!m&&d?(0,ae.jsx)(_e,{pageStore:g}):(0,ae.jsx)(Ce,{pageStore:g,style:p.standalonePageTitle}),(0,ae.jsxs)("div",{style:p.wrap,children:[(0,ae.jsxs)("div",{style:p.left,children:[(0,ae.jsxs)("div",{style:p.titleWrap,children:[h,a]}),(0,ae.jsx)("div",{style:p.detailWrap,children:c})]}),i?(0,ae.jsx)("div",{style:p.right,children:i}):void 0]})}function Te(e){const{style:t,children:n,...a}=e,i=(0,r().IS)((()=>({wrap:{display:"flex",fontSize:E().Kw,cursor:"default",alignItems:"center",userSelect:"none",marginTop:-2,...t}})),[t]);return(0,ae.jsx)("div",{style:i.wrap,...a,children:n})}function je(e){const{label:t,expanded:n,onClick:a}=e,i=(0,r().IS)((()=>({wrap:{cursor:"pointer",color:$().Tj.palette.uiBlue[600]},icon:{marginInlineStart:4,transform:`rotateZ(${n?0:-90}deg)`,transition:"opacity 0.2s ease, transform 200ms ease-out"}})),[n]);return(0,ae.jsxs)(Te,{style:i.wrap,onClick:a,children:[t," ",(0,ae.jsx)("span",{style:i.icon,children:(0,ae.jsx)(u().I,{icon:ye().arrowChevronSingleDownFillSmallIcon,size:"xs",colorVariant:"tertiary"})})]})}function Me(e){const{label:t}=e,n=(0,r().IS)((()=>({wrap:{color:$().Tj.text.secondary}})),[]);return(0,ae.jsx)(Te,{style:n.wrap,children:t})}function _e(e){const{pageStore:t}=e,n=(0,r().IS)((()=>({wrap:{display:"flex",color:$().Tj.text.tertiary,cursor:"default",alignItems:"center",width:"100%",borderRadius:12},parentPageWrap:{display:"flex",gap:4,alignItems:"center",flex:"1 1 auto",overflow:"hidden"},customIcon:{marginInlineEnd:2},pageTitle:{flex:"1 1 auto"},fixedSpan:{flexShrink:0,display:"flex",alignItems:"center"}})),[]),i=(0,a.useMemo)((()=>(0,ae.jsx)(Ce,{pageStore:t,style:n.pageTitle})),[t,n]),s=(0,pe().T)(),c=(0,ge().L)(),d=(0,o().K8)((()=>{if((0,ke().K)(t))return(0,ae.jsx)(y().sA,{id:"AssistantEditHeader.pageEditInPrivate",defaultMessage:"{pageTitle}<span>{nbspThisIsASpacePleaseIgnore}in{nbspThisIsASpacePleaseIgnore}{icon}Private</span>",values:{nbspThisIsASpacePleaseIgnore:(0,ae.jsx)("span",{children:""}),pageTitle:i,icon:(0,ae.jsx)(u().I,{icon:ve().lockSmallIcon,size:"sm",style:n.customIcon}),span:e=>(0,ae.jsx)("span",{style:n.fixedSpan,children:e})}});if(s&&c&&(0,Ie().B)({store:t,spaceStore:c,userId:s}))return(0,ae.jsx)(y().sA,{id:"AssistantEditHeader.pageEditInShared",defaultMessage:"{pageTitle}<span>{nbspThisIsASpacePleaseIgnore}in{nbspThisIsASpacePleaseIgnore}{icon}Shared</span>",values:{nbspThisIsASpacePleaseIgnore:(0,ae.jsx)("span",{children:""}),pageTitle:i,icon:(0,ae.jsx)(u().I,{icon:Se().personFillSmallIcon,size:"sm",style:n.customIcon}),span:e=>(0,ae.jsx)("span",{style:n.fixedSpan,children:e})}});{const e=t.getParentStore();if(e&&(0,xe().D_)(e)&&!(e instanceof he().j||e instanceof me().p||e instanceof fe().K)){const t=e.getIcon(),a=e instanceof l().B&&e.isEmptyPage();return(0,ae.jsx)(y().sA,{id:"AssistantEditHeader.pageEditInLocation",defaultMessage:"{pageTitle}<span>{nbspThisIsASpacePleaseIgnore}in{nbspThisIsASpacePleaseIgnore}</span>{parentLocation}",values:{nbspThisIsASpacePleaseIgnore:(0,ae.jsx)("span",{children:""}),pageTitle:i,parentLocation:(0,ae.jsxs)("div",{style:n.parentPageWrap,children:[(0,ae.jsx)(be().B6,{disabled:!0,icon:t,isEmptyPage:a,size:18,iconRecordCategory:(0,be().Te)(e)}),(0,ae.jsx)(x().A,{store:e})]}),span:e=>(0,ae.jsx)("span",{style:n.fixedSpan,children:e})}})}return i}}),[t,i,n,s,c]);return(0,ae.jsx)("div",{style:n.wrap,children:d})}const Pe=(0,y().YK)({expandAriaLabel:{id:"AssistantEditHeader.expandAriaLabel",defaultMessage:"Expand page"}});function De(e){const{navigate:t}=(0,a.useContext)(V().E),{group:n,pageStore:i}=e,r=(0,s().v3)(),l=(0,a.useRef)(null),[c,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1),g=(0,we().K1)(i.id),m=(0,a.useRef)(z().e.withListenerIgnored((()=>{var e;return(null===(e=P().default.getActiveSession())||void 0===e?void 0:e.isStreaming())??!1}))),h=Ve({hovered:c,shouldTruncate:!0}),f=(0,o().K8)((()=>i.getRenderableContentIds()),[i]),y=(0,o().K8)((()=>i.getSpaceId()),[i]),v=(0,we().mI)(i),S=(0,a.useCallback)((()=>{t({environment:r,url:v})}),[r,v,t]);return(0,a.useEffect)((()=>{if(!l.current)return;const e=new ResizeObserver((function(){l.current&&p(l.current.clientHeight>=Fe)}));return e.observe(l.current),()=>{e.disconnect()}}),[]),(0,ae.jsxs)(de,{onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),group:n,style:h.card,onClick:S,children:[(0,ae.jsx)(Ee,{group:n,pageStore:i}),(0,ae.jsx)("div",{style:{...h.fadeWrap,flexDirection:m.current?"column-reverse":"column"},children:(0,ae.jsxs)("div",{style:h.inner,ref:l,children:[(0,ae.jsx)(Le,{pageStore:i,hasContent:f.length>0}),f.length>0?(0,ae.jsx)("div",{style:h.blockListWrap,children:(0,ae.jsx)(we().XT,{parentStore:i,spaceId:y,blockIds:f,shouldReverse:!1})}):void 0]})}),u&&!g?(0,ae.jsx)(ie,{variant:"open_page",onClick:S,style:h.expandOverlay,forceHover:c}):void 0]})}function Ee(e){const{navigate:t}=(0,a.useContext)(V().E),{pageStore:n,shouldHighlight:i,onExpandPageClick:l}=e,c=(0,s().v3)(),d=(0,we().mI)(n),u=(0,o().K8)((()=>{var e;return(null===(e=P().default.getActiveSession())||void 0===e?void 0:e.isStreaming())??!1}),[]),p=(0,r().IS)((()=>({header:{paddingTop:6,marginInlineStart:2}})),[]),g=(0,a.useCallback)((()=>{t({environment:c,url:d}),null==l||l()}),[c,l,d,t]),m=(0,we().K1)(n.id),h=(0,a.useMemo)((()=>m?null:i?(0,ae.jsx)(Q().u,{shape:"circle",withBackground:!0,onReturnPressed:g,children:(0,ae.jsx)(Re,{shouldHighlight:i,pageStore:n,onExpandPageClick:l})}):(0,ae.jsx)(Re,{pageStore:n})),[m,l,n,i,g]),f=e.group&&!O().A.isMobile&&!u;return(0,ae.jsx)(Ae,{pageStore:n,style:p.header,afterTitle:f?(0,ae.jsx)(Be,{group:e.group,visible:!0}):void 0,rightSide:h,showLocationIfNotCurrentPage:!1})}function Re(e){const{navigate:t}=(0,a.useContext)(V().E),{pageStore:n,onExpandPageClick:i,shouldHighlight:o}=e,r=(0,s().v3)(),l=(0,y().tz)(),c=(0,we().mI)(n),d=(0,a.useCallback)((e=>{e.stopPropagation(),t({environment:r,url:c}),null==i||i()}),[r,i,c,t]);return(0,ae.jsx)(p().m,{renderTooltip:()=>l.formatMessage(Pe.expandAriaLabel),render:e=>(0,ae.jsx)(U().A,{ariaLabel:l.formatMessage(Pe.expandAriaLabel),icon:H().p,onClick:d,colorPalette:o?"blue":void 0,colorVariant:o?"accentPrimary":"secondary",style:o?{borderRadius:"50%"}:void 0,...e})},"expand")}function Be(e){const{group:t,visible:n}=e,i=(0,s().v3)(),l=(0,k().jw)(),[c]=(0,a.useState)((()=>q().JW())),d=(0,r().IS)((()=>({button:{color:$().Tj.text.secondary,marginInlineStart:4,marginInlineEnd:4}})),[]),u=(0,Z().e)({inferenceId:c,operationIds:t.operationIds}),p=(0,o().K8)((()=>{const e=P().default.getActiveSession();return!!e&&(0,v().O9)(e.getCollectionTargetForPendingPage({environment:i,pageId:t.pageId}))}),[i,t.pageId]),g=(0,a.useCallback)((async e=>{e.stopPropagation();const n=P().default.getActiveSession();n&&!n.isStreaming()&&(p?await u():(0,R().openMoveToMenuAndAcceptPagesCreated)({environment:i,groups:[t],sessionContext:n,originRectForMenu:e.currentTarget.getBoundingClientRect(),assistantSurfaceType:l.type}))}),[u,i,t,p,l.type]);return(0,ae.jsx)(L().A,{animate:{opacity:n?1:0},children:(0,ae.jsx)(se,{iconLeading:{icon:K().R,colorVariant:"secondary"},style:d.button,onClick:g,children:(0,ae.jsx)(y().sA,{id:"AssistantEditHeader.saveButton",defaultMessage:"Save"})})})}const Fe=200;function Ne(e){const{navigate:t}=(0,a.useContext)(V().E),{pageStore:n,shouldHighlightOpenPageButton:i,onExpandPageClick:r,shouldTruncate:l=!1}=e,c=(0,s().v3)(),[d,u]=(0,a.useState)(!1),[p,g]=(0,a.useState)(!1),m=(0,we().K1)(n.id),h=Ve({hovered:d,shouldTruncate:l}),f=(0,o().K8)((()=>n.getRenderableContentIds()),[n]),y=(0,o().K8)((()=>n.getSpaceId()),[n]),v=(0,we().mI)(n),S=(0,a.useRef)(null),b=(0,a.useCallback)((()=>{t({environment:c,url:v}),null==r||r()}),[c,r,v,t]);(0,a.useEffect)((()=>{if(!S.current||!l)return;const e=new ResizeObserver((function(){S.current&&g(S.current.clientHeight>=Fe)}));return e.observe(S.current),()=>{e.disconnect()}}),[l]);const x=(0,a.useCallback)((()=>{u(!0)}),[]),I=(0,a.useCallback)((()=>{u(!1)}),[]);return(0,ae.jsxs)(ue,{style:h.card,onClick:b,onMouseEnter:x,onMouseLeave:I,children:[(0,ae.jsx)(Ee,{pageStore:n,group:void 0,shouldHighlight:i,onExpandPageClick:r}),(0,ae.jsx)("div",{style:h.fadeWrapNoScroll,children:(0,ae.jsxs)("div",{style:h.inner,ref:S,children:[(0,ae.jsx)(Le,{pageStore:n,hasContent:f.length>0}),(0,ae.jsx)("div",{style:h.blockListWrap,children:(0,ae.jsx)(we().XT,{parentStore:n,spaceId:y,blockIds:f,shouldReverse:!1})})]})}),l&&p&&!m?(0,ae.jsx)(ie,{variant:"open_page",onClick:b,style:h.expandOverlay,forceHover:d}):void 0]})}function Le(e){const{pageStore:t,hasContent:n}=e,a=(0,o().K8)((()=>t.getAssociatedCollectionStore()),[t]);return a?(0,ae.jsx)(Oe,{pageStore:t,collectionStore:a,hasContent:n}):null}function Oe(e){const{pageStore:t,collectionStore:n,hasContent:i}=e,o=(0,s().v3)(),l=(0,r().IS)((()=>({wrap:{marginInlineStart:6,marginInlineEnd:6}})),[]),c=(0,a.useMemo)((()=>new(Y().B)(o)),[o]);return(0,a.useEffect)((()=>{c.setContext({type:"collectionPage",collectionStore:n})}),[c,n]),(0,ae.jsx)("div",{style:l.wrap,children:(0,ae.jsx)(G().RI,{value:c,children:(0,ae.jsx)(X().h,{context:W().R.PeekView,disabled:!1,store:t,layoutModule:void 0,customization:{hideEmptyProperties:!0,neverShowNotionSystemProperties:!0,dontRenderIfNoPropertiesDefaultShown:!0,neverShowEmptyPropertiesIfMoreThanNProperties:20,sortNonEmptyPropertiesFirst:!0,disableContainerPadding:!0,doNotShowPropertyGroups:!0},wrapper:e=>(0,ae.jsx)(J().vV,{className:N()({"layout-content-with-divider":i}),style:{marginBottom:i?8:0},children:e})})})})}function Ve(e){const{hovered:t,shouldTruncate:n}=e,a=(0,r().eP)();return(0,r().IS)((()=>{const e=Fe,i=`linear-gradient(transparent 0, black 2em, black calc(${e}px - 2em), transparent ${e}px)`;return{blockListWrap:{marginInlineStart:6,marginInlineEnd:6,paddingInlineStart:6,paddingInlineEnd:6},inner:{display:"flex",flexDirection:"column",gap:2},card:{userSelect:"none",position:"relative",cursor:"pointer",marginTop:0,paddingTop:0,paddingBottom:0,...t?{background:"light"===a?$().Tj.cardHoveredBackground:$().Tj.palette.translucentGray[100]}:{},transition:"all .2s ease"},fadeWrap:{position:"relative",display:"flex",flexDirection:"column-reverse",...n?{maxHeight:e,overflowY:"scroll",WebkitMaskImage:i,maskImage:i,paddingTop:"1em",paddingBottom:"1em"}:{}},fadeWrapNoScroll:{position:"relative",display:"flex",flexDirection:"column",...n?{maxHeight:e,overflowY:"hidden",WebkitMaskImage:i,maskImage:i}:{}},expandOverlay:{bottom:8}}}),[t,n,a])}n(18107),n(967357),n(430670);var ze=()=>n(907258),We=()=>n(383036),Ue=()=>n(79926),He=()=>n(779315),Ke=()=>n(680474),qe=()=>n(292985),$e=()=>n(797809),Ge=()=>n(496603),Ye=()=>n(23420),Qe=()=>n(462685),Je=()=>n(862292),Xe=()=>n(712505),Ze=()=>n(371621),et=()=>n(928739),tt=(n(16280),()=>n(242422)),nt=()=>n(683259),at=()=>n(416504),it=()=>n(792071),st=()=>n(201980),ot=()=>n(89053);function rt(){return Promise.reject(new Error("Async rendering not supported"))}const lt={text:rt,header:rt,sub_header:rt,sub_sub_header:rt,header_4:rt,quote:rt,bulleted_list:rt,toggle:rt,to_do:rt,numbered_list:rt,code:rt,page:rt,image:rt,video:rt,embed:rt,bookmark:rt,file:rt,temporary_ui:rt,edit_reference:rt,tweet:rt,maps:rt,gist:rt,framer:rt,invision:rt,mixpanel:rt,drive:rt,figma:rt,loom:rt,pdf:rt,typeform:rt,codepen:rt,audio:rt,divider:rt,equation:rt,collection_view:rt,collection_view_page:rt,column_list:rt,column:rt,factory:rt,copy_indicator:rt,breadcrumb:rt,link_to_collection:rt,link_to_page:rt,table_of_contents:rt,callout:rt,whimsical:rt,miro:rt,abstract:rt,sketch:rt,excalidraw:rt,replit:rt,alias:rt,transclusion_container:rt,transclusion_reference:rt,external_object_instance:rt,table:rt,table_row:rt,tab:rt,hex:rt,deepnote:rt,external_object_instance_page:rt,button:rt,ai_block:rt,drawing:rt,slide:rt,personal_home_page:rt,home_shortcuts:rt,form:rt,post:rt,workflow:rt,transcription:rt,mail:rt},ct={[st().Ifu.Page]:({annotation:e,exportArgs:t})=>{const n=it().b4_.fromGetRecordValueFn(t.getRecordValue),a=st().v55(e);if(!n({table:F().ev,id:a}))return;return`@${(0,nt()._z)({intl:t.intl,blockId:a,getRecordValue:t.getRecordValue,userTimeZone:t.userTimeZone})}`},[st().Ifu.Collection]:({annotation:e,exportArgs:t})=>{const n=it().b4_.fromGetRecordValueFn(t.getRecordValue),a=st().TSJ(e);if(!a)return;const i=n(a);return i?`@${i.getRenderTitleWithPlaceholder({getRecordModel:n,userTimeZone:t.userTimeZone,intl:t.intl})}`:void 0},[st().Ifu.CustomEmoji]:({annotation:e,exportArgs:t})=>{const n=it().b4_.fromGetRecordValueFn(t.getRecordValue),a=st().qS0(e);var i;if(a)return null===(i=n(a))||void 0===i?void 0:i.getRenderTitle()},[st().Ifu.User]:({annotation:e,exportArgs:t})=>{const{intl:a}=t,i=it().b4_.fromGetRecordValueFn(t.getRecordValue),s=st().NcG(e),o=i({table:n(798880).oo,id:s});return`@${null==o?void 0:o.getFullName(a)}`},[st().Ifu.SlackSpecialMention]:({annotation:e,exportArgs:t})=>`@${st().p5C(e)}`,[st().Ifu.ChatSelectionContext]:({annotation:e})=>st().$sA(e).text,[st().Ifu.Group]:({annotation:e,exportArgs:t})=>(0,nt().Pf)({annotation:e,exportArgs:t}),[st().Ifu.Team]:({annotation:e,exportArgs:t})=>(0,nt().nZ)({annotation:e,exportArgs:t}),[st().Ifu.LinkMention]:({annotation:e})=>st().q1R(e).href,[st().Ifu.Date]:({annotation:e,exportArgs:t})=>{const{date_format:a,time_format:i,...s}=st().K7D(e);return`@${(0,n(869190).ZF)({value:s,date_format:a,time_format:i,userTimeZone:t.userTimeZone,allowRelativeDates:!1,intl:t.intl})}`},[st().Ifu.Equation]:n(856197).z.annotationRenderers[st().Ifu.Equation],[st().Ifu.Place]:({annotation:e})=>{const t=e[1];return(0,n(96330).X1)(t)},[st().Ifu.ExternalObjectInstance]:nt().if,[st().Ifu.Link]:nt().if,[st().Ifu.Bot]:nt().if,[st().Ifu.Comment]:nt().if,[st().Ifu.Bold]:nt().if,[st().Ifu.Italic]:nt().if,[st().Ifu.Strike]:nt().if,[st().Ifu.Code]:nt().if,[st().Ifu.Highlight]:nt().if,[st().Ifu.Discussion]:nt().if,[st().Ifu.SuggestionInsertText]:nt().if,[st().Ifu.SuggestionRemoveText]:nt().if,[st().Ifu.SuggestionAnnotate]:nt().if,[st().Ifu.SuggestionUnannotate]:nt().if,[st().Ifu.Underline]:nt().if,[st().Ifu.Inserted]:nt().if,[st().Ifu.Deleted]:nt().if,[st().Ifu.TemporaryComment]:nt().if,[st().Ifu.TemporaryCursor]:nt().if,[st().Ifu.DeletionMarker]:nt().if,[st().Ifu.TemporaryEquation]:nt().if,[st().Ifu.TemporaryPage]:nt().if,[st().Ifu.TemporaryCollection]:nt().if,[st().Ifu.TemporaryInput]:nt().if,[st().Ifu.TemporarySelection]:nt().if,[st().Ifu.TemporaryFindHighlight]:nt().if,[st().Ifu.TemporarySelectedFindHighlight]:nt().if,[st().Ifu.TemplateVariable]:nt().if,[st().Ifu.FormulaPageProperty]:nt().if,[st().Ifu.FormulaContextValue]:nt().if,[st().Ifu.FormulaError]:nt().if,[st().Ifu.Citation]:nt().if,[st().Ifu.TemporaryCitation]:nt().if,[st().Ifu.TemporaryNativeMABFilter]:nt().if,[st().Ifu.TemporaryDictation]:nt().if,[st().Ifu.TemporaryHighlight]:nt().if,[st().Ifu.AssistantInstructionsCollection]:nt().if,[st().Ifu.TemporaryCommentHighlight]:nt().if,[st().Ifu.TemporarySuggestionUnderline]:nt().if,[st().Ifu.TemporarySearchFilter]:nt().if,[st().Ifu.TitleOnly]:nt().if,[st().Ifu.Sort]:nt().if,[st().Ifu.SearchFilterCreatedTime]:nt().if,[st().Ifu.SearchFilterLastEditedTime]:nt().if};function dt(){}const ut={title:dt,text:dt,select:dt,multi_select:dt,status:dt,relation:dt,rollup:dt,url:dt,email:dt,phone_number:dt,checkbox:dt,person:dt,number:dt,date:dt,file:dt,formula:dt,created_time:dt,last_edited_time:dt,created_by:dt,last_edited_by:dt,button:dt,auto_increment_id:dt,last_visited_time:dt,location:dt,verification:dt,place:dt};function pt(e,t){return(0,nt().vy)({textValue:e,exportArgs:t,renderers:ht,fromString:e=>e}).join("")}function gt(){return({block:e,exportArgs:t})=>pt(it().Bj6.fromBlock(e).getProperty("title"),t)}function mt(){return""}const ht={blockRenderers:{text:gt(),header:gt(),sub_header:gt(),sub_sub_header:gt(),header_4:gt(),quote:gt(),bulleted_list:gt(),toggle:gt(),to_do:gt(),numbered_list:gt(),code:gt(),page:gt(),image:mt,video:mt,embed:mt,bookmark:mt,temporary_ui:mt,edit_reference:mt,file:mt,tweet:mt,maps:mt,gist:mt,framer:mt,invision:mt,mixpanel:mt,drive:mt,figma:mt,loom:mt,pdf:mt,typeform:mt,codepen:mt,audio:mt,divider:mt,equation:mt,collection_view:mt,collection_view_page:mt,column_list:mt,column:mt,factory:mt,copy_indicator:mt,breadcrumb:mt,link_to_collection:mt,link_to_page:mt,table_of_contents:mt,callout:gt(),whimsical:mt,miro:mt,abstract:mt,sketch:mt,excalidraw:mt,replit:mt,alias:mt,transclusion_container:mt,transclusion_reference:mt,external_object_instance:mt,table:mt,table_row:({block:e,exportArgs:t})=>{const a=it().b4_.fromGetRecordValueFn(t.getRecordValue),i=it().Bj6.fromBlock(e),s=i.getParentPointer();if(s.table!==F().ev)return;const o=a(s);if(!o||!o.isType(n(700500).xd.table))return;return(o.getFormatValue("table_block_column_order")??[]).map((e=>pt(i.getProperty(e),t))).filter((e=>e)).join(" ")},tab:mt,hex:mt,deepnote:mt,external_object_instance_page:mt,button:mt,ai_block:mt,drawing:mt,slide:mt,personal_home_page:mt,home_shortcuts:mt,form:mt,post:mt,workflow:mt,transcription:gt(),mail:mt},asyncBlockRenderers:lt,annotationRenderers:ct,propertyRenderers:ut},ft=(0,y().YK)({added:{id:"assistantGroupedEditsRenderer.added",defaultMessage:"Added"},updated:{id:"assistantGroupedEditsRenderer.updated",defaultMessage:"Edited"},removed:{id:"assistantGroupedEditsRenderer.removed",defaultMessage:"Deleted"},updatedPageProperties:{id:"assistantGroupedEditsRenderer.updatedPageProperties",defaultMessage:"{total, plural, one {Updated property} other {Updated properties}}"},updatedTitle:{id:"assistantGroupedEditsRenderer.updateTitle",defaultMessage:"Updated title"},viewEditInPageTooltip:{id:"assistantGroupedEditsRenderer.viewEditsInPageTooltipLabel",defaultMessage:"View edit in page"},numberOfPendingEdits:{id:"assistantGroupedEditsRenderer.numberOfPendingEdits",defaultMessage:"{numberOfEdits, plural, one {1 pending edit} other {{numberOfEdits} pending edits}}"}});function yt(e){const{group:t,pageStore:n}=e,i=(0,r().IS)((()=>({groupedEditListWrap:{display:"flex",flexDirection:"column",overflow:"hidden"},groupedEditList:{display:"flex",flexDirection:"column",borderTop:`1px solid ${$().Tj.border.secondaryTranslucent}`,marginTop:6,paddingTop:6}})),[]),[s,o]=(0,a.useState)(!0),[l,c]=(0,a.useState)(!1),d=(0,a.useCallback)((e=>{o(e),c(!0)}),[]),{value:u}=(0,Ue().fJ)(Ke().fM);if(!u)return null;const{AnimatePresence:p,motion:g}=u;return(0,ae.jsxs)(de,{group:t,children:[(0,ae.jsx)(vt,{group:t,pageStore:n,editsExpanded:s,setEditsExpanded:d}),(0,ae.jsx)(p,{children:s?(0,ae.jsx)(g.div,{style:i.groupedEditListWrap,initial:!!l&&{height:0},animate:{height:"auto"},exit:{height:0},children:(0,ae.jsx)("div",{style:i.groupedEditList,children:t.groupedEdits.map(((e,t)=>(0,ae.jsx)(St,{edit:e,pageStore:n},t)))})}):void 0})]})}function vt(e){const{group:t,pageStore:n,editsExpanded:i,setEditsExpanded:l}=e,c=(0,s().v3)(),d=(0,k().jw)(),u=(0,o().K8)((()=>{var e;return Boolean(null===(e=P().default.getActiveSession())||void 0===e?void 0:e.isStreaming())}),[]),p=(0,r().IS)((()=>({acceptRejectButtons:{padding:"0 6px",visibility:u?"hidden":"visible"}})),[u]),g=(0,a.useMemo)((()=>t.groupedEdits.flatMap((e=>e.operationIds))),[t]),m=(0,a.useCallback)((async()=>{const e=P().default.getActiveSession();e&&await(0,R().acceptEdits)({environment:c,sessionContext:e,inferenceId:q().JW(),operationIds:g,operationContext:(0,Ze().BB)({shouldCreateUnknownBlock:!0}),assistantSurfaceType:d.type})}),[c,g,d.type]),h=(0,a.useCallback)((async()=>{const e=P().default.getActiveSession();e&&await(0,R().rejectEdits)({environment:c,sessionContext:e,inferenceId:q().JW(),operationIds:g,assistantSurfaceType:d.type})}),[c,g,d.type]),f=t.groupedEdits.length;return(0,ae.jsx)(Ae,{pageStore:n,rightSide:(0,ae.jsxs)("div",{style:p.acceptRejectButtons,children:[(0,ae.jsx)(we().LR,{onClick:m,variant:"all"}),(0,ae.jsx)(we().Y4,{onClick:h,variant:"all"})]}),showLocationIfNotCurrentPage:!0,detail:(0,ae.jsx)(je,{label:(0,ae.jsx)(y().sA,{...ft.numberOfPendingEdits,values:{numberOfEdits:f}}),expanded:i,onClick:()=>l(!i)})})}function St(e){const{edit:t,pageStore:n}=e,a=(0,we().K1)(n.id);return"insertedBlocks"===t.type||"removedBlocks"===t.type||"updatedBlocks"===t.type?a?(0,ae.jsx)(Tt,{edit:t,pageStore:n}):(0,ae.jsx)(At,{edit:t,pageStore:n}):"updatedProperties"===t.type?(0,ae.jsx)(kt,{edit:t,pageStore:n}):"updatedTitle"===t.type?(0,ae.jsx)(It,{edit:t,pageStore:n}):void(0,v().HB)(t)}function bt(e){const{edit:t,children:n,onClick:i,isCompact:s}=e,l=(0,r().IS)((()=>({wrap:{display:"flex",height:s?32:"initial",margin:"0 6px",padding:"6px 6px",borderRadius:8,position:"relative",...s?{flexDirection:"row",alignItems:"center",justifyContent:"space-between"}:{flexDirection:"column",alignItems:"initial"}}})),[s]),[c,d]=(0,a.useState)(!1),[u,g]=(0,a.useState)(!1),m=(0,o().K8)((()=>et().A.state.hoveredEditId===t.editId),[t]),h=c||m,f=(0,a.useCallback)((()=>{et().A.setState({...et().A.state,hoveredEditId:t.editId}),d(!0),g(!0)}),[t]),v=(0,a.useCallback)((()=>{et().A.setState({...et().A.state,hoveredEditId:void 0}),d(!1),g(!1)}),[]);return(0,ae.jsx)(p().m,{forceVisibleState:u,placement:"top",alignment:"start",renderTooltip:()=>(0,ae.jsx)(y().sA,{...ft.viewEditInPageTooltip}),render:a=>(0,ae.jsxs)(ee().p,{...(0,We().A)(a,{onMouseEnter:f,onMouseLeave:v}),style:l.wrap,onClick:i,hovered:h,children:[s?void 0:(0,ae.jsx)(xt,{headerComp:e.headerComp,headerColor:e.headerColor}),n,(0,ae.jsx)(jt,{isCompact:s,setViewEditInPageToolTipVisible:()=>{g(!1)},edit:t,visible:!!s||c})]})})}function xt(e){const{headerComp:t,headerColor:n}=e,a=(0,r().IS)((()=>({wrap:{color:"insert"===n||"update"===n?$().Tj.palette.uiBlue[600]:"remove"===n?$().Tj.text.tertiary:(0,v().HB)(n),fontWeight:S().Wy.medium,fontSize:O().A.isMobile?12:S().J.UISmall.desktop}})),[n]);return(0,ae.jsx)("div",{style:a.wrap,children:t})}function It(e){const{edit:t,pageStore:n}=e,a=(0,y().tz)(),i=(0,$e().RX)(a).title,s=(0,o().K8)((()=>n.getTitleValue()),[n]),r=(0,o().K8)((()=>n.getSpaceId()),[n]),l=wt({pageStore:n});return i?(0,ae.jsx)(bt,{isCompact:!1,edit:t,headerColor:"insert",onClick:l,headerComp:(0,ae.jsx)(y().sA,{...ft.updatedTitle}),children:(0,ae.jsx)(Qe().A,{propertySchema:i,rootStore:n,value:{value:s,spaceId:r}})}):null}function kt(e){const{edit:t,pageStore:n}=e,a=(0,o().K8)((()=>{const e=n.getAssociatedCollectionStore(),a=null==e?void 0:e.getSchema();return Ge().oE(Array.from(t.propertyNames).map((e=>{const t=Object.entries(a||{}).find((([,t])=>(null==t?void 0:t.name)===e));if(t)return t[0]})))}),[t,n]),i=wt({pageStore:n});return(0,ae.jsx)(bt,{isCompact:!1,edit:t,headerColor:"insert",onClick:i,headerComp:(0,ae.jsx)(y().sA,{...ft.updatedPageProperties,values:{total:a.length}}),children:a.map(((e,t)=>(0,ae.jsx)(we().sj,{pageStore:n,property:e},t)))})}function wt(e){const{navigate:t}=(0,a.useContext)(V().E),{pageStore:n}=e,i=(0,s().v3)(),r=(0,we().K1)(n.id),l=(0,o().K8)((()=>{var e;return Xe().default.state.open&&Xe().default.state.targetStore.id===n.id?He().A.PeekViewScroller:(null===(e=ze().default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.id)===n.id?He().A.PageScroller:void 0}),[n]),c=(0,we().mI)(n);return(0,a.useCallback)((()=>{r?(0,qe().V)({element:null==l?void 0:l.getNode(),environment:i,options:{top:0,behavior:"smooth"}}):t({environment:i,url:c})}),[r,l,i,c,t])}function Ct(e){const{navigate:t}=(0,a.useContext)(V().E),{edit:n,pageStore:i}=e,o=(0,s().v3)(),r=(0,we().K1)(i.id),l=(0,we().mI)(i,{scrollToBlockId:"insertedBlocks"===n.type||"updatedBlocks"===n.type?[...n.blockIds].at(0):"removedBlocks"===n.type?void 0:(0,v().HB)(n)});return(0,a.useCallback)((()=>{r?"insertedBlocks"===n.type||"updatedBlocks"===n.type?(0,Ye().B)(Array.from(n.blockIds),!0,o):"removedBlocks"===n.type||(0,v().HB)(n):t({environment:o,url:l})}),[n,o,r,l,t])}function At(e){const{edit:t,pageStore:n}=e,i=(0,y().tz)(),s=(0,we().K1)(n.id),l=(0,r().IS)((()=>{const e="linear-gradient(180deg, black 0, black 30px, transparent 100%)";return{blockListWrap:{marginInlineStart:-2,marginInlineEnd:-2,marginBottom:-4,lineHeight:"1.1rem",...s?{maxHeight:60,overflowY:"hidden",WebkitMaskImage:e,maskImage:e}:{}}}}),[s]),c=Ct(e),d=(0,o().K8)((()=>n.getSpaceId()),[n]),u=(0,a.useMemo)((()=>[...t.blockIds]),[t.blockIds]);let p,g;return"insertedBlocks"===t.type?(p="insert",g=i.formatMessage(ft.added)):"updatedBlocks"===t.type?(p="update",g=i.formatMessage(ft.updated)):"removedBlocks"===t.type?(p="remove",g=i.formatMessage(ft.removed)):(0,v().HB)(t),(0,ae.jsx)(bt,{isCompact:!1,edit:t,headerColor:p,headerComp:g,onClick:c,children:(0,ae.jsx)("div",{style:l.blockListWrap,children:(0,ae.jsx)(we().XT,{parentStore:n,spaceId:d,blockIds:u,shouldReverse:!1})})})}function Tt(e){const{edit:t}=e,n=(0,s().v3)(),i=(0,y().tz)(),{value:l}=(0,Ue().fJ)(Je().T.formulas),c=(0,r().IS)((()=>({inner:{...S().RC,color:$().Tj.text.secondary,fontSize:13},bold:{fontWeight:S().Wy.medium,color:$().Tj.text.primary}})),[]),d=Ct(e),u=(0,D().r)(),{cacheToUse:p,ignoreAllCaches:g}=(0,o().K8)((()=>{if("removedBlocks"===t.type)return{cacheToUse:n.defaultRecordCache.inMemoryRecordCache,ignoreAllCaches:!0};if("insertedBlocks"===t.type||"updatedBlocks"===t.type){const e=P().default.getActiveSession();return{cacheToUse:null==e?void 0:e.caches.updatesCache,ignoreAllCaches:!1}}(0,v().HB)(t)}),[n,t]),[m,h]=(0,a.useState)("");(0,a.useEffect)((()=>{if(!p||!u)return;const e=p,a=[...t.blockIds].map((e=>({id:e,table:F().ev,spaceId:u})));function s(){const t=a.map((t=>function(e){const{intl:t,pointer:n,getRecordValue:a,formulasModule:i,spaceIdCreator:s}=e,o={root:n,navigableBlockId:n.id,renderParentBlockId:void 0,blockId:n.id,userTimeZone:(0,at().P)(),intl:t,getRecordValue:a,getRecordModel:it().b4_.fromGetRecordValueFn(a),numberedListCache:{},bulletedListCache:{},getRecordsWithParent:()=>[],getExportedPathToFile:({toFileURI:e})=>e,getExportedRenderAsset:({toFileURI:e})=>e,getExportedPathToPage:e=>"",baseUrl:O().A.domainBaseUrl,publicDomainName:O().A.publicDomainName,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,experimentService:tt().default,collectionFeatureGates:(0,ot().i)(),formulasModule:i,spaceIdCreator:s};return(0,nt().g8)({exportArgs:{...o},renderers:ht})}({intl:i,pointer:{id:t.id,table:t.table,spaceId:t.spaceId},getRecordValue:e.makeGetRecordValueFn(n.currentUser.id,{ignoreAllCaches:g}),formulasModule:l,spaceIdCreator:n.idCreator.getSpaceIdCreatorSync(u??"")})));h(i.formatList(Ge().oE(t),{type:"unit"}))}s();for(const t of a)p.addListenerToRecord(t,s);return()=>{for(const e of a)p.removeListenerToRecord(e,s)}}),[p,g,t,n,i,u,l]);const f=(0,a.useCallback)((e=>(0,ae.jsx)("span",{style:c.bold,children:e})),[c]);return(0,ae.jsx)(bt,{isCompact:!0,edit:t,onClick:d,children:(0,ae.jsx)("div",{style:c.inner,children:"updatedBlocks"===t.type?m?(0,ae.jsx)(y().sA,{id:"assistantGroupedEditsRenderer.editedCompact",defaultMessage:"<bold>Edited:</bold>{text}",values:{bold:f,text:m}}):(0,ae.jsx)(y().sA,{id:"assistantGroupedEditsRenderer.editedCompactNoText",defaultMessage:"<bold>Edited</bold>",values:{bold:f}}):"insertedBlocks"===t.type?m?(0,ae.jsx)(y().sA,{id:"assistantGroupedEditsRenderer.insertedCompact",defaultMessage:"<bold>Added:</bold>{text}",values:{bold:f,text:m}}):(0,ae.jsx)(y().sA,{id:"assistantGroupedEditsRenderer.insertedCompactNoText",defaultMessage:"<bold>Added</bold>",values:{bold:f}}):"removedBlocks"===t.type?m?(0,ae.jsx)(y().sA,{id:"assistantGroupedEditsRenderer.removedCompact",defaultMessage:"<bold>Deleted:</bold>{text}",values:{bold:f,text:m}}):(0,ae.jsx)(y().sA,{id:"assistantGroupedEditsRenderer.removedCompactNoText",defaultMessage:"<bold>Deleted:</bold>",values:{bold:f}}):(0,v().HB)(t)})})}function jt(e){const{edit:t,visible:n,setViewEditInPageToolTipVisible:i,isCompact:l}=e,c=(0,s().v3)(),d=(0,k().jw)(),u=(0,r().IS)((()=>({wrap:{display:"flex",alignItems:"center",flexShrink:0,...l?{}:{background:$().Tj.background.primary,position:"absolute",top:6,insetInlineEnd:8,boxShadow:$().Tj.shadowSM,borderRadius:6}},leftButton:{...l?{}:{borderStartStartRadius:6,borderStartEndRadius:0,borderEndStartRadius:6,borderEndEndRadius:0}},rightButton:{...l?{}:{borderStartStartRadius:0,borderStartEndRadius:6,borderEndStartRadius:0,borderEndEndRadius:6}}})),[l]),p=(0,o().K8)((()=>{var e;return Boolean(null===(e=P().default.getActiveSession())||void 0===e?void 0:e.isStreaming())}),[]),g=n&&!p,m=(0,a.useCallback)((async()=>{const e=P().default.getActiveSession();e&&await(0,R().acceptEdits)({environment:c,sessionContext:e,inferenceId:q().JW(),operationIds:t.operationIds,operationContext:(0,Ze().BB)({shouldCreateUnknownBlock:!0}),assistantSurfaceType:d.type})}),[c,t,d.type]),h=(0,a.useCallback)((async()=>{const e=P().default.getActiveSession();e&&await(0,R().rejectEdits)({environment:c,sessionContext:e,inferenceId:q().JW(),operationIds:t.operationIds,assistantSurfaceType:d.type})}),[c,t,d.type]);return(0,ae.jsxs)(L().A,{animate:{opacity:g?1:0,visibility:g?"visible":"hidden"},style:u.wrap,onMouseEnter:i,children:[(0,ae.jsx)(we().LR,{style:u.leftButton,onClick:m}),(0,ae.jsx)(we().Y4,{style:u.rightButton,onClick:h})]})}function Mt(e){const{group:t,pageStore:n}=e;return(0,ae.jsx)(ue,{children:(0,ae.jsx)(_t,{group:t,pageStore:n})})}function _t(e){const{group:t,pageStore:n}=e,i=(0,s().v3)(),l=(0,k().jw)(),c=(0,o().K8)((()=>{var e;return Boolean(null===(e=P().default.getActiveSession())||void 0===e?void 0:e.isStreaming())}),[]),d=(0,r().IS)((()=>({acceptRejectButtons:{padding:"0 6px",visibility:c?"hidden":"visible"},titleWrap:{display:"flex",alignItems:"center",cursor:"default",overflow:"hidden"},titleMessage:{lineHeight:1.2,paddingInlineStart:4},pageTitleButton:{flex:"1 1 auto"}})),[c]),u=(0,a.useCallback)((async()=>{const e=P().default.getActiveSession();e&&await(0,R().acceptEdits)({environment:i,sessionContext:e,inferenceId:q().JW(),operationIds:t.operationIds,operationContext:(0,Ze().BB)({shouldCreateUnknownBlock:!0}),assistantSurfaceType:l.type})}),[i,t,l.type]),p=(0,a.useCallback)((async()=>{const e=P().default.getActiveSession();e&&await(0,R().rejectEdits)({environment:i,sessionContext:e,inferenceId:q().JW(),operationIds:t.operationIds,assistantSurfaceType:l.type})}),[i,t,l.type]);return(0,ae.jsx)(Ae,{pageStore:n,renderTitle:()=>(0,ae.jsx)("div",{style:d.titleWrap,children:(0,ae.jsx)(y().sA,{id:"AssistantPageRemovedGroup.title",defaultMessage:"<message>Delete</message>{pageTitle}",values:{message:e=>(0,ae.jsx)("div",{style:d.titleMessage,children:e}),pageTitle:(0,ae.jsx)(Ce,{pageStore:n,style:d.pageTitleButton})}})}),rightSide:(0,ae.jsxs)("div",{style:d.acceptRejectButtons,children:[(0,ae.jsx)(we().LR,{onClick:u,variant:"single"}),(0,ae.jsx)(we().Y4,{onClick:p,variant:"single"})]}),showLocationIfNotCurrentPage:!1})}function Pt(e){const{group:t,parentStore:n,parentSpaceId:a}=e,i=l().B.createChildStore(n,{table:F().ev,id:t.pageId,spaceId:a});return"updatedPage"===t.type?t.didCreatePage?(0,ae.jsx)(De,{group:t,pageStore:i}):(0,ae.jsx)(yt,{group:t,pageStore:i}):"removedPage"===t.type?(0,ae.jsx)(Mt,{group:t,pageStore:i}):void(0,v().HB)(t)}function Dt(e){const{clientStep:t,parentStore:n}=e,a=(0,r().IS)((()=>({wrap:{fontSize:E().vQ,display:"flex",flexDirection:"column",gap:8}})),[]),i=(0,o().K8)((()=>(0,R().getPageGroupForGroupedEditCard)(t)),[t]),s=(0,D().r)();return s&&i?(0,ae.jsx)("div",{style:a.wrap,children:(0,ae.jsx)(Pt,{group:i,parentStore:n,parentSpaceId:s})}):null}var Et=()=>n(613601);const Rt=(0,y().YK)({undo:{id:"AssistantEditsAcceptedCard.undo",defaultMessage:"Undo"}});function Bt(e){const{pageId:t,message:n,parentStore:a,onUndo:i}=e,s=(0,r().IS)((()=>({wrap:{marginTop:12,marginBottom:12}})),[]),o=l().B.createChildStore(a,{table:F().ev,id:t});return(0,ae.jsx)(ue,{style:s.wrap,children:(0,ae.jsx)(Ae,{pageStore:o,showLocationIfNotCurrentPage:!1,detail:(0,ae.jsx)(Me,{label:n}),rightSide:i?(0,ae.jsx)(Ft,{onClick:i}):null})})}function Ft(e){const t=(0,y().tz)();return(0,ae.jsx)(p().m,{renderTooltip:()=>(0,ae.jsx)(y().sA,{...Rt.undo}),render:n=>(0,ae.jsx)(U().A,{ariaLabel:t.formatMessage(Rt.undo),icon:Et().arrowUTurnUpLeftSmallIcon,onClick:e.onClick,style:{marginInlineEnd:4},...n})},"expand")}function Nt(e){const{clientStep:t,parentStore:n}=e;return"accept"===t.action?(0,ae.jsx)(Ot,{clientStep:t,parentStore:n}):"accept_page_delete"===t.action?(0,ae.jsx)(zt,{clientStep:t,parentStore:n}):"reject"===t.action?(0,ae.jsx)(Ht,{clientStep:t}):"insert"===t.action?(0,ae.jsx)(qt,{parentStore:n,clientStep:t}):"create_page"===t.action?(0,ae.jsx)($t,{clientStep:t}):"reject_all"===t.action?(0,ae.jsx)(Gt,{clientStep:t,parentStore:n}):void(0,v().HB)(t)}function Lt(e){const{children:t}=e,n=(0,r().IS)((()=>({stepContainer:{display:"flex",alignItems:"center",marginTop:4,marginBottom:4,justifyContent:"center"},step:{fontSize:E().Kw,color:$().Tj.text.tertiary,display:"flex",alignItems:"center",gap:2,overflow:"hidden"}})),[]);return(0,ae.jsx)("div",{style:n.stepContainer,children:(0,ae.jsx)("div",{style:n.step,children:t})})}function Ot(e){const{parentStore:t,clientStep:n}=e;return(0,ae.jsx)(Vt,{parentStore:t,clientStep:n})}function Vt(e){const{parentStore:t,clientStep:n}=e;return n.wasPageCreate?(0,ae.jsx)(Wt,{parentStore:t,clientStep:n}):(0,ae.jsx)(Ut,{parentStore:t,clientStep:n})}function zt(e){const{parentStore:t,clientStep:n}=e,{canUndo:a,handleUndo:i}=Kt(n);return(0,ae.jsx)(Bt,{parentStore:t,pageId:n.pageId,message:(0,ae.jsx)(y().sA,{id:"assistantChatHumanActionStep.acceptPageDelete.message",defaultMessage:"Page deleted"}),onUndo:a?i:void 0})}function Wt(e){const{parentStore:t,clientStep:n}=e,a=l().B.createChildStore(t,{table:F().ev,id:n.pageId});return(0,ae.jsx)(Ne,{pageStore:a,shouldHighlightOpenPageButton:!1,shouldTruncate:!0})}function Ut(e){const{parentStore:t,clientStep:n}=e,{canUndo:a,handleUndo:i}=Kt(n);return(0,ae.jsx)(Bt,{parentStore:t,pageId:n.pageId,message:(0,ae.jsx)(y().sA,{id:"assistantChatHumanActionStep.acceptEdits.numberOfEditsAccepted",defaultMessage:"{numberOfEdits, plural, one {1 edit accepted} other {{numberOfEdits} edits accepted}}",values:{numberOfEdits:n.numberOfEdits}}),onUndo:a?i:void 0})}function Ht(e){const{clientStep:t}=e,{canUndo:n,renderUndo:a}=Kt(t);return n?(0,ae.jsx)(Lt,{children:(0,ae.jsx)(y().sA,{id:"assistantChatHumanActionStep.rejectedEdits.confirmationWithUndo",defaultMessage:"{numberOfEdits, plural, one {1 edit rejected} other {{numberOfEdits} edits rejected}}<undo>Undo</undo>",values:{numberOfEdits:t.numberOfEdits,undo:e=>a(e)}})}):(0,ae.jsx)(Lt,{children:(0,ae.jsx)(y().sA,{id:"assistantChatHumanActionStep.rejectedEdits.confirmation",defaultMessage:"{numberOfEdits, plural, one {1 edit rejected} other {{numberOfEdits} edits rejected}}",values:{numberOfEdits:t.numberOfEdits}})})}function Kt(e){const t=(0,s().v3)(),n=Yt(),i=(0,k().jw)(),r=(0,o().K8)((()=>(0,R().canUndoStepEdits)(e)),[e]),l=(0,a.useCallback)((()=>{(0,R().undoEditsForClientStep)({environment:t,clientStep:e,assistantSurfaceType:i.type})}),[e,t,i.type]);return{canUndo:r,renderUndo:(0,a.useCallback)((e=>(0,ae.jsx)(se,{isSmall:!0,style:n.undoButton,onClick:l,children:e})),[l,n]),handleUndo:l}}function qt(e){const{clientStep:t,parentStore:n}=e,i=Yt(),s=l().B.createChildStore(n,{table:F().ev,id:t.pageId}),{canUndo:o,renderUndo:r}=Kt(t),c=(0,a.useMemo)((()=>(0,ae.jsx)(Ce,{pageStore:s,isSmall:!0,style:i.pageTitleButton})),[s,i]);return(0,ae.jsx)(Lt,{children:o?(0,ae.jsx)(y().sA,{id:"assistantChatHumanActionStep.acceptedInserts.confirmationWithPageAndUndo",defaultMessage:"{numberOfEdits, plural, one {<growSpan><span>Added 1 block in{nbspThisIsASpacePleaseIgnore}</span>{page}</growSpan>} other {Added <growSpan><span>{numberOfEdits} blocks in{nbspThisIsASpacePleaseIgnore}</span>{page}</growSpan>}}{middotThisIsADivider}<undo>Undo</undo>",values:{nbspThisIsASpacePleaseIgnore:(0,ae.jsx)("span",{children:""}),middotThisIsADivider:(0,ae.jsx)("span",{children:""}),numberOfEdits:t.numberOfEdits,growSpan:e=>(0,ae.jsx)("span",{style:i.growSpan,children:e}),span:e=>(0,ae.jsx)("span",{style:i.noShrinkSpan,children:e}),undo:e=>r(e),page:c}}):(0,ae.jsx)(y().sA,{id:"assistantChatHumanActionStep.acceptedInserts.confirmationWithPage",defaultMessage:"{numberOfEdits, plural, one {<growSpan><span>Added 1 block in{nbspThisIsASpacePleaseIgnore}</span>{page}</growSpan>} other {Added <growSpan><span>{numberOfEdits} blocks in{nbspThisIsASpacePleaseIgnore}</span>{page}</growSpan>}}",values:{nbspThisIsASpacePleaseIgnore:(0,ae.jsx)("span",{children:""}),numberOfEdits:t.numberOfEdits,growSpan:e=>(0,ae.jsx)("span",{style:i.growSpan,children:e}),span:e=>(0,ae.jsx)("span",{style:i.noShrinkSpan,children:e}),page:c}})})}function $t(e){return(0,ae.jsx)(Lt,{children:(0,ae.jsx)(y().sA,{id:"assistantChatHumanActionStep.createdPage.confirmation",defaultMessage:"1 page created"})})}function Gt(e){const{clientStep:t,parentStore:n}=e,{canUndo:a,renderUndo:i,handleUndo:s}=Kt(t);let o;return t.pageId?(0,ae.jsx)(Bt,{parentStore:n,pageId:t.pageId,message:(0,ae.jsx)(y().sA,{id:"assistantChatHumanActionStep.rejectAll.confirmationNoPageTitle",defaultMessage:"{numberOfEdits, plural, one {Edit discarded} other {Edits discarded}}",values:{numberOfEdits:t.numberOfEdits}}),onUndo:a?s:void 0}):(o=a?(0,ae.jsx)(y().sA,{id:"assistantChatHumanActionStep.rejectAll.confirmationPageCreatedWithUndo",defaultMessage:"Page discarded<undo>Undo</undo>",values:{undo:e=>i(e)}}):(0,ae.jsx)(y().sA,{id:"assistantChatHumanActionStep.rejectAll.confirmationPageCreated",defaultMessage:"Page discarded"}),(0,ae.jsx)(Lt,{children:o}))}function Yt(){return(0,r().IS)((()=>({pageTitleButton:{color:$().Tj.text.tertiary,fontWeight:S().Wy.regular,flex:"1 1 auto"},undoButton:{color:$().Tj.text.tertiary},growSpan:{display:"flex",alignItems:"center",cursor:"default",flex:"1 1 auto",overflow:"hidden"},noShrinkSpan:{display:"flex",alignItems:"center",flexShrink:0,cursor:"default"}})),[])}var Qt=()=>n(692031),Jt=()=>n(212497),Xt=()=>n(402014),Zt=()=>n(450648),en=()=>n(161479),tn=()=>n(712030),nn=()=>n(29554);function an(e){const{clientStep:t,parentStore:n,showTranslationTooltips:i,parentSpaceId:l}=e,c=(0,s().v3)(),d=(0,r().DP)(),u=(0,o().K8)((()=>(0,nn().S5)({environment:c,textValue:{value:t.text,spaceId:(0,en().e)(l)},parentStore:n,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disabled:!0,theme:d,emojiType:(0,tn().FN)(c),katex:c.KatexStore.getKatex(),formulaValueTypes:[]})),[t.text,c,l,n,d]),g=(0,y().tz)(),m=(0,a.useCallback)((async e=>{const[a,i]=await Promise.all([(0,Qt().r)(),(0,Jt().jd)()]);(0,Xt().SQ)(e,Xt().y$.CopyToClipboard,(()=>{const e=(0,Zt().r4)({textValue:t.text,intl:g,getRecordModel:n.getRecordModel,userTimeZone:(0,at().P)()});i({environment:c,stringValue:e,copiedMessage:a.copiedHumanMessageToClipboard})}))}),[t.text,g,n.getRecordModel,c]);return(0,ae.jsx)(p().m,{placement:"left",renderTooltip:()=>(0,ae.jsx)(Tn,{text:(0,st().k4p)(t.text)}),delayThreshold:0,disableTooltip:!i,render:e=>(0,ae.jsx)("div",{...e,style:{wordBreak:"break-word"},onCopy:m,children:u})})}var sn=()=>n(188158),on=()=>n(274981),rn=()=>n(783793),ln=()=>n(215103),cn=()=>n(28070),dn=()=>n(849255),un=()=>n(806080),pn=()=>n(41161),gn=()=>n(651196);function mn(e){const{clientStep:t,parentStore:n}=e,a=(0,s().v3)(),i=(0,y().tz)(),r=(0,o().K8)((()=>{let e=[];if("options"===t.displayType)e=t.options.map((e=>"block"===e.table?l().B.createChildStore(n,e):"notion_user"===e.table?dn().L.createChildStore(n,e):"collection"===e.table?c().m.createChildStore(n,e):void(0,v().HB)(e)));else{const t=a.currentUser.id;e=pn().A.getVisitedIds(t).map((e=>l().B.createChildStore(n,{table:"block",id:e})))}return e.map((e=>e.getModel())).filter(v().O9).map((e=>{if("block"===e.table){const t=e.getRenderTitle({getRecordModel:n.getRecordModel,intl:i,userTimeZone:(0,at().P)()}),a=e.getRenderIcon({getRecordModel:n.getRecordModel});return(0,ae.jsx)(gn().Ay,{style:{whiteSpace:"nowrap",flexGrow:0},onClick:un().lQ,icon:n=>(0,ae.jsx)(be().B6,{style:n,icon:a,title:t,isEmptyPage:!1,size:14,disabled:!0,iconRecordCategory:e.isCollectionView()?"collectionViewBlock":"pageBlock"}),title:t},`action__${e.id}`)}return"collection"===e.table||"notion_user"===e.table?(0,ae.jsx)("div",{},e.id):void(0,v().HB)(e)}))}),[t,a.currentUser.id,i,n]);return(0,ae.jsxs)("div",{style:{display:"grid",gridTemplateRows:"1fr 1fr",gap:"4px",overflow:"auto"},children:[(0,ae.jsx)("div",{style:{display:"flex",gap:"4px"},children:r.slice(0,(r.length-1)/2)}),(0,ae.jsx)("div",{style:{display:"flex",gap:"4px"},children:r.slice((r.length-1)/2)})]})}var hn=()=>n(282027),fn=()=>n(996332),yn=()=>n(388926),vn=()=>n(691309),Sn=()=>n(498212);function bn(e){const{clientStep:t}=e,n=(0,B().iL)(t.operations.map((e=>({...e,operations:[],id:(0,vn().Vg)(Sn().rN),inferenceId:void 0})))),i=(0,r().IS)((()=>({divider:{marginTop:6,marginBottom:6}})),[]);return(0,ae.jsx)(ae.Fragment,{children:n.map(((e,t)=>(0,ae.jsxs)(a.Fragment,{children:[(0,ae.jsx)(xn,{group:e},t),n[t+1]?(0,ae.jsx)(yn().A,{style:i.divider,size:1}):void 0]},t)))})}function xn(e){const{group:t}=e,n=(0,r().IS)((()=>({header:{marginTop:4,marginBottom:6,color:$().Tj.text.secondary},pageTitle:{display:"inline",color:$().Tj.text.primary,fontWeight:S().Wy.semibold,whiteSpace:void 0,overflow:void 0,textOverflow:void 0,textDecoration:"underline"},subheader:{color:$().Tj.text.secondary,marginBottom:4}})),[]),a=(0,o().O$)(ze().AppStoreMainEditorCurrentBlockStore),i=(0,o().O$)(ze().AppStoreSidebarSpaceStore),s=a||i;if(!i)throw new Error("No current space store");if(!s)throw new Error("No parent store");const c=(null==a?void 0:a.id)!==t.pageId,d=i.id,u=l().B.createChildStore(s,{table:F().ev,id:t.pageId,spaceId:d}),p=(0,we().mI)(u),g=(0,o().K8)((()=>{if("updatedPage"!==t.type)return[];const e=u.getAssociatedCollectionStore(),n=null==e?void 0:e.getSchema();return Ge().oE(Array.from(t.updatedPropertyNames).map((e=>{const t=Object.entries(n||{}).find((([,t])=>(null==t?void 0:t.name)===e));if(t)return t[0]})))}),[u,t]);if("updatedPage"===t.type){const{insertedBlockIds:e,updatedBlockIds:a,removedBlockIds:i,updatedTitle:o}=t,r=(0,B().j_)(t);return(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsx)(fn().Q,{style:n.header,href:p,children:(0,ae.jsx)("span",{children:t.didCreatePage?(0,ae.jsx)(y().sA,{defaultMessage:"Created {page}",id:"assistant.transactionRenderer.createdPage.title",values:{page:(0,ae.jsx)(x().A,{store:u,style:n.pageTitle})}}):(0,ae.jsx)(y().sA,{defaultMessage:"{numEdits, plural, one {1 edit to {page}} other {{numEdits} edits to {page}}}",id:"assistant.transactionRenderer.editedPage.title",values:{numEdits:r,page:(0,ae.jsx)(x().A,{store:u,style:n.pageTitle})}})})}),o?(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsx)("div",{style:n.subheader,children:"Updated title"}),c?(0,ae.jsx)(we().XT,{spaceId:d,blockIds:[t.pageId],parentStore:s,shouldReverse:!0}):void 0]}):void 0,g.length>0?(0,ae.jsxs)(ae.Fragment,{children:[`Updated ${g.length} ${g.length>1?"properties":"property"}`,c?g.map(((e,t)=>(0,ae.jsx)(we().sj,{pageStore:u,property:e},t))):void 0]}):void 0,e.size>0?(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsx)("div",{style:n.subheader,children:`Inserted ${e.size} block${e.size>1?"s":""}`}),c?(0,ae.jsx)(we().XT,{spaceId:d,blockIds:Array.from(e),parentStore:s,shouldReverse:!0}):void 0]}):void 0,a.size>0?(0,ae.jsxs)("div",{style:n.subheader,children:[`Updated ${a.size} block${a.size>1?"s":""}`,c?(0,ae.jsx)(we().XT,{spaceId:d,blockIds:Array.from(a),parentStore:s,shouldReverse:!0}):void 0]}):void 0,i.size>0?(0,ae.jsxs)("div",{style:n.subheader,children:[`Removed ${i.size} block${i.size>1?"s":""}`,c?(0,ae.jsx)(we().XT,{spaceId:d,blockIds:Array.from(i),parentStore:s,shouldReverse:!0}):void 0]}):void 0]})}if("removedPage"===t.type)return(0,ae.jsx)(fn().Q,{style:n.header,href:p,children:(0,ae.jsx)("span",{children:(0,ae.jsx)(y().sA,{defaultMessage:"Deleted {page}",id:"assistant.transactionRenderer.removedPage.title",values:{page:(0,ae.jsx)("span",{style:{fontWeight:S().Wy.bold},children:(0,ae.jsx)(x().A,{store:u,style:n.pageTitle})})}})})});(0,v().HB)(t)}var In=()=>n(255350);function kn(e){const{searchScope:t}=e,n=(0,y().tz)(),a=(0,s().v3)(),i=(0,o().O$)(ze().AppStoreSidebarSpaceStore),l=(0,o().K8)((()=>{var e;if(i)return null===(e=(0,In().tu)({environment:a,searchScope:t,spaceStore:i,intl:n,showEverythingLabel:!0}))||void 0===e?void 0:e.scopeTitle}),[i,n,t,a]),c=(0,r().IS)((()=>({wrapper:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center",flexGrow:1,color:$().Tj.text.tertiary,fontSize:E().Kw}})),[]);return(0,ae.jsx)("div",{style:c.wrapper,children:(0,ae.jsx)(y().sA,{id:"assistant.chat.scopeChangeBadge",defaultMessage:"Find in {scopeTitle}",values:{scopeTitle:l}})})}function wn(e){const{numberOfRows:t}=e;return(0,ae.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:18,width:"100%"},children:Array.from({length:t}).map(((e,t)=>(0,ae.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:12,width:"100%"},children:[(0,ae.jsx)(d().P,{style:{height:18,width:18,borderRadius:3}}),(0,ae.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8,width:"100%"},children:[(0,ae.jsx)(d().P,{style:{height:18,width:"50%",borderRadius:3}}),(0,ae.jsxs)("div",{style:{display:"flex",gap:4,flexDirection:"column",width:"100%"},children:[(0,ae.jsx)(d().P,{style:{height:16,width:"100%",borderRadius:3}}),(0,ae.jsx)(d().P,{style:{height:16,width:"70%",borderRadius:3}})]})]})]},t)))})}function Cn(){const e=(0,r().IS)((()=>({container:{display:"flex",padding:4,alignItems:"center",gap:8,marginTop:24},label:{fontWeight:500}})),[]);return(0,ae.jsxs)("div",{style:e.container,children:[(0,ae.jsx)(u().I,{icon:m().aiFaceIcon,colorVariant:"secondary"}),(0,ae.jsx)(g().A,{isSecondaryColor:!0,style:e.label,children:"AI Summary"})]})}function An(e){const{clientStep:t,parentStore:n,parentSpaceId:r,latestStepCitationHoverStore:d,mockTextStore:g,wrapperRef:m,disabled:I}=e,D=(0,s().v3)(),E=(0,o().K8)((()=>{const e=P().default.getActiveSession(),t=(null==e?void 0:e.getCombinedSteps())??[],n=t.findLast((e=>"human"===e.type));if(!n)return;const a=t.indexOf(n);return t.slice(a-1).find((e=>"assistantSearch"===e.type||"assistantLoadPage"===e.type))}),[]),R=(0,o().K8)(j().mR,[]),B=(0,k().jw)(),F=(0,o().K8)((()=>(0,C().cJ)()),[]),N=(0,o().K8)((()=>{var e;return null===(e=P().default.getActiveSession())||void 0===e?void 0:e.sessionIdFromStoreState}),[]),L=(0,o().K8)((()=>{if(!N)return!1;const e=P().default.getSessionContextOrThrow(N).assistantConfigurationStoreState;return Boolean(e&&(0,w().pV)({assistantSurface:B,configurationState:e}))}),[B,N]),O=(0,o().K8)((()=>A().AssistantFeatureGateStore.isNewCornerChatWelcomeStateEnabled(B)),[B]),V=(0,o().K8)((()=>{const e=P().default.getActiveSession();return((null==e?void 0:e.getCombinedSteps())??[]).filter((e=>"human"===e.type)).length<=1}),[]),{isCurrentClientStepLatestStep:z,searchResultsSteps:W}=(0,o().K8)((()=>{const e=P().default.getActiveSession(),n=(null==e?void 0:e.getCombinedSteps())??[],a=n.indexOf(t),i=(0,M().l0)(n.slice(0,a));return{isCurrentClientStepLatestStep:a>=0&&a===n.length-1,searchResultsSteps:i}}),[t]),U=(0,o().K8)((()=>{if("human"===t.type)return[{key:t.type,element:(0,ae.jsx)(an,{clientStep:t,parentStore:n,showTranslationTooltips:R,parentSpaceId:r})}];if("groupedEditCard"===t.type)return[{key:t.inferenceId,element:(0,ae.jsx)(Dt,{clientStep:t,parentStore:n}),doNotWrap:!0}];if("assistantLoading"===t.type)return[{key:t.inferenceId,element:(0,ae.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:24,width:"100%"},children:[(0,ae.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"},children:[O?(0,ae.jsx)("div",{style:{marginInlineEnd:4},children:(0,ae.jsx)(rn().x,{variant:"xsmall"})}):void 0,"assistantSearch"===(null==E?void 0:E.type)?(0,ae.jsx)(y().sA,{id:"AssistantChatStep.searching",defaultMessage:"Searching {icon} {keywords}",description:"Placeholder text while the AI is searching. The icon is a magnifying glass.",values:{icon:(0,ae.jsx)(u().I,{icon:f().magnifyingGlassSmallIcon,size:"xxs"}),keywords:(0,ae.jsx)("span",{style:{fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",maxWidth:"70%",textTransform:"lowercase",whiteSpace:"nowrap"},children:E.query.questionIntl??E.query.keywords})},children:function(e){return(0,ae.jsx)(ae.Fragment,{children:e.map(((e,t)=>"string"==typeof e?(0,ae.jsx)("span",{children:e},t):e))})}}):(0,ae.jsxs)(ae.Fragment,{children:[t.message?(0,ae.jsx)("div",{style:{maxWidth:"min(calc(100%), 512px)"},children:(0,ae.jsx)("div",{style:{flex:"1 1 auto",...S().RC},children:t.message})}):(0,ae.jsx)(y().sA,{...hn().v.thinking})," "]}),(0,ae.jsx)("div",{style:{marginInlineStart:4},children:(0,ae.jsx)(b().A,{isTriColored:!0})})]}),"assistantSearch"===(null==E?void 0:E.type)&&L&&V?(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsx)(wn,{numberOfRows:5}),(0,ae.jsx)(jn,{})]}):null]})}];if("assistantChatText"===t.type)return(0,_().Cb)(t)?[{key:t.inferenceId,element:null,doNotWrap:!0}]:[{key:t.inferenceId,element:(0,ae.jsx)(on().c,{clientStep:t})}];if("assistantChat"===t.type){if((0,_().Cb)(t)&&!L)return[{key:t.inferenceId,element:null,doNotWrap:!0}];const e=(0,T().q6)({clientStep:t}),a={wrapperRef:m,clientStep:t,parentStore:n,disabled:I,searchResultsSteps:W,citationHoverStore:z?d:void 0,sessionId:N},i=(0,ae.jsxs)(ae.Fragment,{children:[L&&V?(0,ae.jsx)(Cn,{}):void 0,(0,ae.jsx)(sn().X_,{...a})]});return[{key:t.inferenceId,element:R?(0,ae.jsx)(p().m,{placement:"left",renderTooltip:()=>(0,ae.jsx)(Tn,{text:e}),delayThreshold:0,render:e=>(0,ae.jsx)("div",{...e,children:i})}):i,doNotWrap:!0}]}return"assistantTransaction"===t.type?[{key:t.inferenceId,element:(0,ae.jsx)(bn,{clientStep:t})}]:"assistantSearch"===t.type?F?[{key:t.inferenceId,element:(0,ae.jsx)(p().m,{placement:"left",renderTooltip:()=>(0,ae.jsx)("div",{style:{whiteSpace:"pre",fontFamily:"monospace"},children:JSON.stringify(t.query,null,2)}),delayThreshold:0,render:e=>(0,ae.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},...e,children:[(0,ae.jsx)(u().I,{icon:h().codeSmallIcon,size:"xs"}),`Search ${t.query.question}`]})})}]:[]:"assistantLoadPage"===t.type?F?[{key:t.inferenceId,element:(0,ae.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,ae.jsx)(u().I,{icon:h().codeSmallIcon,size:"xs"}),(0,ae.jsx)("span",{style:{whiteSpace:"nowrap"},children:"Load page"}),(0,ae.jsx)(x().A,{style:{marginInlineStart:2},store:l().B.createChildStore(n,t.pointer)})]})}]:[]:"assistantSearchPeople"===t.type?F?[{key:t.inferenceId,element:(0,ae.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,ae.jsx)(u().I,{icon:h().codeSmallIcon,size:"xs"}),`Search people ${t.search}`]})}]:[]:"assistantSearchDatabases"===t.type?F?[{key:t.inferenceId,element:(0,ae.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,ae.jsx)(u().I,{icon:h().codeSmallIcon,size:"xs"}),`Search databases ${t.searchQuery}`]})}]:[]:"queryDatabase"===t.type?F?[{key:t.inferenceId,element:(0,ae.jsx)(p().m,{placement:"left",renderTooltip:()=>(0,ae.jsx)("div",{style:{whiteSpace:"pre",fontFamily:"monospace"},children:JSON.stringify(t.query,null,2)}),delayThreshold:0,render:e=>(0,ae.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},...e,children:[(0,ae.jsx)(u().I,{icon:h().codeSmallIcon,size:"xs"}),"Query database",(0,ae.jsx)(x().A,{style:{marginInlineStart:2},store:c().m.createChildStore(n,t.collectionPointer)})]})})}]:[]:"assistantQueryingDatabase"===t.type?F?[{key:t.inferenceId,element:(0,ae.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,ae.jsx)(u().I,{icon:h().codeSmallIcon,size:"xs"}),(0,ae.jsx)("span",{style:{whiteSpace:"nowrap"},children:"Querying database"}),(0,ae.jsx)(x().A,{style:{marginInlineStart:2},store:c().m.createChildStore(n,t.collectionPointer)})]})}]:[]:"assistantShowSearchResults"===t.type?[{key:t.inferenceId,element:null,doNotWrap:!0}]:"assistantLimitReached"===t.type?[{key:t.inferenceId,element:(0,ae.jsx)(ae.Fragment,{children:t.message})}]:"assistantLoadDatabase"===t.type?F?[{key:t.inferenceId,element:(0,ae.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,ae.jsx)(u().I,{icon:h().codeSmallIcon,size:"xs"}),(0,ae.jsx)("span",{style:{whiteSpace:"nowrap"},children:"Load database"}),(0,ae.jsx)("div",{style:{marginInlineStart:2},children:(0,ae.jsx)(x().A,{store:c().m.createChildStore(n,t.pointer)})})]})}]:[]:"humanAction"===t.type?[{key:`${t.type}_confirmation_step_${t.inferenceId}`,element:(0,ae.jsx)(Nt,{clientStep:t,parentStore:n}),doNotWrap:!0}]:"assistantRetry"===t.type?[{key:t.type,element:null,doNotWrap:!0}]:"assistantNoOperationsFromReplace"===t.type?[{key:t.inferenceId,element:(0,ae.jsx)(ln().w,{}),doNotWrap:!0}]:"assistantSelectEntity"===t.type?[{key:t.inferenceId,element:(0,ae.jsx)(mn,{clientStep:t,parentStore:n,mockTextStore:g})}]:"assistantScopeChange"===t.type?[{key:t.inferenceId,element:(0,ae.jsx)(kn,{searchScope:t.scope})}]:"clientAssistantHumanAttachmentUpload"===t.type?[{key:t.inferenceId,doNotWrap:!0,element:(0,ae.jsxs)("div",{style:{display:"flex"},children:[(0,ae.jsx)("div",{style:{flexGrow:1}}),(0,ae.jsx)(cn().kp,{uploadProgress:{status:"complete",fileUrl:t.fileData.originalFileUrl,fileName:t.fileData.fileName,contentType:t.fileData.contentType}})]})}]:"assistantStartResearchMode"===t.type?[{key:t.type,element:null,doNotWrap:!0}]:void(0,v().HB)(t)}),[t,n,R,r,E,L,m,I,W,z,d,N,F,g,V,O]),H=(0,a.useRef)(void 0);return(0,a.useEffect)((()=>{H.current!==t.inferenceId&&(H.current=t.inferenceId,(0,i().u)({environment:D,event:{eventName:"assistant_chat_step_displayed",eventProperties:{thread_id:N,step_id:t.inferenceId}}}))}),[t,D,N]),(0,ae.jsx)(ae.Fragment,{children:U.map(((e,n)=>{const i=`${e.key}_${n}`;return e.doNotWrap?(0,ae.jsx)(a.Fragment,{children:e.element},i):(0,ae.jsx)(ce().qX,{ref:m,clientStep:t,disabled:I,children:e.element},i)}))})}function Tn(e){const{text:t}=e,{getTranslationForString:n}=(0,I().MC)({getTranslatableStrings:(0,a.useCallback)((()=>[t]),[t])});return(0,ae.jsx)("div",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",maxWidth:500,height:"auto",overflowWrap:"break-word"},children:n(t)??"Loading..."})}function jn(){const e=(0,r().IS)((()=>({shimmerBox:{height:16,borderRadius:6},container:{height:156,borderRadius:6,width:"100%",display:"flex",flexDirection:"column",gap:12}})),[]);return(0,ae.jsxs)("div",{style:e.container,children:[(0,ae.jsx)(d().P,{style:{...e.shimmerBox,width:"65%"}}),(0,ae.jsx)(d().P,{style:{...e.shimmerBox,width:"90%"}}),(0,ae.jsx)(d().P,{style:{...e.shimmerBox,width:"65%"}}),(0,ae.jsx)(d().P,{style:{...e.shimmerBox,width:"65%"}}),(0,ae.jsx)(d().P,{style:{...e.shimmerBox,width:"75%"}}),(0,ae.jsx)(d().P,{style:{...e.shimmerBox,width:"45%"}})]})}},535358:(e,t,n)=>{n.d(t,{IA:()=>r,NN:()=>c});n(18107),n(296540);var a=()=>n(907258),i=()=>n(680977),s=()=>n(547149),o=()=>n(140022);n(720665).TD;function r(){const{currentUserSettingsStore:e}=a().default.state;if(!e)return;return{last_exposed_to_ai_qna_at:e.getSettingsStore().getKeyStore("last_exposed_to_ai_qna_at").getValue(),qna_reminders_shown_at:e.getSettingsStore().getKeyStore("qna_reminders_shown_at").getValue(),ai_qna_abandoned_search_reminder_shown_at:e.getSettingsStore().getKeyStore("ai_qna_abandoned_search_reminder_shown_at").getValue(),ai_assistant_onboarding_phase:e.getSettingsStore().getKeyStore("ai_assistant_onboarding_phase").getValue(),assistant_fill_database_shown:e.getSettingsStore().getKeyStore("assistant_fill_database_shown").getValue(),assistant_summarize_this_page_shown_at:e.getSettingsStore().getKeyStore("assistant_summarize_this_page_shown_at").getValue()}}function l(){const{currentUserSettingsStore:e}=a().default.state;if(e)return e.getSettingsStore().getKeyStore("qna_sessions_initialized").getValue()??0}function c(e){const{currentUserSettingsStore:t}=a().default.state;if(!t)return;const n=l();void 0!==n&&(s().createAndCommit({environment:e,userAction:"useApplicableQnaReminder.updateQnaUsageCount",canUndo:!1,perform:e=>{(0,i().m)({userSettingsStore:t,transaction:e,data:{qna_sessions_initialized:n+1}})}}),(0,o().trackQnaSessionInitialized)(e,{current_initialization_count:n+1}))}},537429:(e,t,n)=>{n.d(t,{$Y:()=>S,cy:()=>b});var a=n(296540),i=()=>n(564884),s=()=>n(300474),o=()=>n(907258),r=()=>n(726637),l=()=>n(484714),c=()=>n(852507),d=()=>n(590526),u=()=>n(69708),p=()=>n(987267),g=()=>n(103812),m=()=>n(547149),h=()=>n(399613),f=()=>n(655600),y=n(474848);const v={asana:n(484487).P0,github:n(913839).o,slack:n(610083).Rh,linear:n(265015).W,discord:n(313535).lk,salesforce:n(919515).Ci},S={asana:"dismissed_asana_personal_auth_prompt",github:"dismissed_github_personal_auth_prompt",slack:"dismissed_slack_personal_auth_prompt",linear:"dismissed_linear_personal_auth_prompt",discord:"dismissed_discord_personal_auth_prompt",salesforce:"dismissed_salesforce_personal_auth_prompt"};function b({connector:e,showDismiss:t,shouldDismiss:n,parent:b,minimizePopup:x,hideNotification:I}){const[k,w]=(0,a.useState)(!1),C=(0,d().K8)((()=>v[e].state),[e]),A=(0,s().r)(),T=(0,l().v3)(),j=(0,d().O$)(o().AppStoreCurrentUserSettingsStore),M=(0,d().O$)(o().AppStoreSidebarSpaceViewStore),_=p().w0[e],P=(0,a.useCallback)((()=>{if(!j||!M)return;if(!n)return;const t=S[e];m().createAndCommit({userAction:`AIConnector.${e}.onboarding.dismissPersonalAuthPrompt`,environment:T,canUndo:!0,perform:e=>{m().applyOperation({store:M,operation:{pointer:M.pointer,path:["settings"],command:"update",args:{...M.getSettings(),[t]:!0}},transaction:e})}})}),[j,M,T,e,n]),D=(0,a.useCallback)((()=>{(0,i().u)({environment:T,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"user_auth_dismiss",integration_type:e,setup_session_id:C.sessionId,from:"connect_nudge"}}}),v[e].setState({...C,forceShowAuthNotificationTriggeredAt:void 0}),P()}),[P,T,C,e]),E=(0,d().K8)((()=>(0,f().UK)(e)),[e]),R=t?"connect_nudge":"chat_menu";(0,c().w)((()=>{(0,i().u)({environment:T,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:`show_${e}_personal_auth_prompt`,integration_type:e,setup_session_id:C.sessionId,from:R}}})}));const B=r().A.isMobile?void 0:{label:(0,y.jsx)(u().sA,{id:"assistantChat.ingestion.ctaForConnectorPersonalAuth",defaultMessage:"Log in"}),onClick:async()=>{if(!A)return;const t=Boolean(C.forceShowAuthNotificationTriggeredAt);v[e].setState({...C,analyticsFrom:R,forceShowAuthNotificationTriggeredAt:void 0}),t||null==I||I(`${e}_re_auth`),w(!0),await(0,h().t)({connector:e,environment:T,spaceId:A,analyticsProperties:{buttonName:"user_auth_connect"},onAuthSuccess:()=>{null==b||b.close(),null==x||x()}}),w(!1)},disabled:k};return(0,y.jsx)(g().Mp,{type:"error",title:(0,y.jsx)(u().sA,{id:"assistantChat.ingestion.connectionStatusActionRequiredForLogin",defaultMessage:"Log in to {connectorName}",values:{connectorName:_}}),caption:(0,y.jsx)(u().sA,{id:"assistantChat.ingestion.connectionStatusActionRequiredForLoginDescription",defaultMessage:"Authenticate to get answers from {orgName}",values:{orgName:E}}),actionButton:B,onDismiss:t?D:void 0})}},537525:(e,t,n)=>{n.d(t,{I:()=>g});n(296540);var a=()=>n(726637),i=()=>n(401497),s=()=>n(695115),o=()=>n(132855),r=()=>n(401306),l=()=>n(69708),c=()=>n(100622),d=()=>n(534177),u=()=>n(515692),p=n(474848);function g(e){const t=(0,l().tz)(),{storeIsEmpty:n,handleClickStop:g,handleClickEnter:m,mode:h,disableSubmit:f,isLarge:y}=e,v=(0,i().IS)((()=>{const e=(0,u().Jc)(a().A.isMobile,Boolean(y)),t=(0,u().h6)(a().A.isMobile);return{stopIcon:{fill:c().Tj.icon.primary},icon:{height:e,width:e},button:{pointerEvents:"auto",height:Math.max(e,t),width:Math.max(e,t),borderRadius:"100%"}}}),[y]),S={onMouseDown:e=>{e.preventDefault()},style:v.button,iconStyle:v.icon};return"inferencing"===h.type?(0,p.jsx)(s().A,{...S,icon:r().n,onClick:g,iconStyle:{...v.icon,...v.stopIcon},ariaLabel:t.formatMessage({id:"assistantRichTextInput.stop",defaultMessage:"Stop"})}):"select_parameters"===h.type||"empty_state"===h.type?(0,p.jsx)(s().A,{...S,icon:o().arrowInCircleUpFillIcon,onClick:m,disabled:!0,ariaLabel:t.formatMessage({id:"assistantRichTextInput.submit",defaultMessage:"Submit"})}):"select_parameters_freeform"===h.type||"input_parameter"===h.type?(0,p.jsx)(s().A,{...S,icon:o().arrowInCircleUpFillIcon,onClick:m,colorPalette:n||f?void 0:"blue",colorVariant:n||f?"secondary":"accentPrimary",disabled:n||f,ariaLabel:t.formatMessage({id:"assistantRichTextInput.submitTextAsParameter",defaultMessage:"Submit text as parameter"})}):"default"===h.type||"deep_find"===h.type||"deep_find_followup"===h.type||"research_mode"===h.type||"research_mode_inferencing"===h.type?(0,p.jsx)(s().A,{...S,icon:o().arrowInCircleUpFillIcon,onClick:m,colorPalette:n||f?void 0:"blue",colorVariant:n||f?"secondary":"accentPrimary",disabled:n||f,ariaLabel:t.formatMessage({id:"assistantRichTextInput.submit",defaultMessage:"Submit"})}):void(0,d().HB)(h.type)}},539092:(e,t,n)=>{n.d(t,{Au:()=>v,L9:()=>S,MH:()=>y,Xn:()=>u,fw:()=>g,g9:()=>c,jr:()=>l,n5:()=>m,xD:()=>d,yG:()=>h,yQ:()=>p});var a=()=>n(907258),i=()=>n(242422),s=()=>n(262661),o=()=>n(924102),r=()=>n(521350);function l(e){const{spaceStore:t,isMeetingNotesTrialFlow:n,spaceJoinOrCreate:a,isFirstTimeOnboarding:s,planType:o}=e;if(!(null==t?void 0:t.isAiEnabledOnSpace()))return!1;if("team"!==o)return!1;if(n)return!1;if(!s)return!1;if("create"!==a)return!1;const r=i().default.getEligibleGroup({experimentId:"getting_started_example_company_workspace",disableExposureLogging:!0});return!r||"control"===r}function c(e){const{environment:t,spaceJoinOrCreate:n}=e;if("create"!==n)return;i().default.getEligibleGroup({experimentId:"adoption_new_user_agent_onboarding_checklist"})&&(0,o().o)({environment:t,featureKey:"adoption_agent_new_user_onboarding_checklist"})}function d(e){const{environment:t}=e;if(!f({environment:t}))return!1;return"checklist_d1"===i().default.getEligibleGroup({experimentId:"adoption_new_user_agent_onboarding_checklist",disableExposureLogging:!0})}function u(e){const{environment:t}=e,{currentUserSettingsStore:n}=a().default.state;if(!n)return!1;if(!f({environment:t}))return!1;if("checklist_d2"===i().default.getEligibleGroup({experimentId:"adoption_new_user_agent_onboarding_checklist",disableExposureLogging:!0})){const e=(0,s().i)(n);return null!==e&&e>=1}return!1}function p(e){const{environment:t}=e;if(!f({environment:t}))return!1;return"checklist_nudge"===i().default.getEligibleGroup({experimentId:"adoption_new_user_agent_onboarding_checklist",disableExposureLogging:!0})}function g(e){const{environment:t}=e;if(!f({environment:t}))return!1;return"sidebar_d1"===i().default.getEligibleGroup({experimentId:"adoption_new_user_agent_onboarding_checklist",disableExposureLogging:!0})}function m(e){const{environment:t}=e,{currentUserSettingsStore:n}=a().default.state;if(!n)return!1;if(!f({environment:t}))return!1;if("sidebar_d2"===i().default.getEligibleGroup({experimentId:"adoption_new_user_agent_onboarding_checklist",disableExposureLogging:!0})){const e=(0,s().i)(n);return null!==e&&e>=1}return!1}function h(e){const{environment:t}=e;if(!f({environment:t}))return!1;return"sidebar_nudge"===i().default.getEligibleGroup({experimentId:"adoption_new_user_agent_onboarding_checklist",disableExposureLogging:!0})}function f(e){const{environment:t}=e,{currentUserSettingsStore:n}=a().default.state;if(!n)return!1;if((0,r().mA)({environment:t}))return!1;return!!(0,r().wz)({environment:t,featureKey:"adoption_agent_new_user_onboarding_checklist"})}function y(e){const{environment:t}=e;if(!b({environment:t}))return!1;return"sidebar_d1"===i().default.getEligibleGroup({experimentId:"adoption_new_user_agent_onboarding_joiner_v2",disableExposureLogging:!0})}function v(e){const{environment:t}=e,{currentUserSettingsStore:n}=a().default.state;if(!n)return!1;if(!b({environment:t}))return!1;if("sidebar_d2"===i().default.getEligibleGroup({experimentId:"adoption_new_user_agent_onboarding_joiner_v2",disableExposureLogging:!0})){const e=(0,s().i)(n);return null!==e&&e>=1}return!1}function S(e){const{environment:t}=e;if(!b({environment:t}))return!1;return"sidebar_nudge"===i().default.getEligibleGroup({experimentId:"adoption_new_user_agent_onboarding_joiner_v2",disableExposureLogging:!0})}function b(e){const{environment:t}=e,{currentUserSettingsStore:n}=a().default.state;if(!n)return!1;if((0,r().dp)({environment:t}))return!1;return!!(0,r().wz)({environment:t,featureKey:"adoption_new_user_agent_onboarding_joiner_v2"})}},545390:(e,t,n)=>{n.d(t,{n:()=>r});var a=()=>n(242422),i=()=>n(484714),s=()=>n(590526),o=()=>n(521350);function r(){const e=(0,i().v3)();return(0,s().K8)((()=>{if(!(0,o().wz)({environment:e,featureKey:"adoption_agent_new_user_onboarding_checklist"}))return{variant:void 0};return{variant:a().default.getEligibleGroup({experimentId:"adoption_new_user_agent_onboarding_checklist",disableExposureLogging:!0}),hasSeenNewUserOnboardingChecklistExperience:(0,o().mA)({environment:e})}}),[e])}},547090:(e,t,n)=>{n.d(t,{j:()=>i});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"1.31 2.48 13.04 10.27",svg:(0,n(474848).jsx)("path",{d:"M4.876 8.65c.565 0 1.024.459 1.024 1.025v2.05c0 .566-.458 1.024-1.024 1.025h-2.05A1.025 1.025 0 0 1 1.8 11.725v-2.05c0-.566.458-1.025 1.024-1.025zm-1.976 3h1.9v-1.9H2.9zm10.9-1.5a.55.55 0 1 1 0 1.1h-6a.55.55 0 0 1 0-1.1zM5.379 2.742a.55.55 0 0 1 .943.566l-2.4 4a.55.55 0 0 1-.889.076l-1.6-1.868a.55.55 0 0 1 .835-.715l1.103 1.286zM13.8 4.75a.55.55 0 1 1 0 1.1h-6a.55.55 0 0 1 0-1.1z"})},i=(0,n(340498).wt)("checklistSmall",a,"small")},551345:(e,t,n)=>{n.d(t,{or:()=>i,pV:()=>s});var a=()=>n(383070);function i(e){const{configurationState:t}=e;return t.deepFindRequested&&a().zD.isDeepFindEnabled()}function s(e){const{configurationState:t,assistantSurface:n}=e;return i({configurationState:t})&&n.isType("fullPage")}},551414:(e,t,n)=>{n.r(t),n.d(t,{acceptCursorCompletionAssistant:()=>N,cancelAssistantCompletion:()=>F,cancelCursorCompletionAssistant:()=>L,insertCursorCompletionAssistantSuggestionsBelow:()=>O,maybeNewAssistantWriterChat:()=>B,refreshAssistantCompletion:()=>R,triggerAssistantCompletion:()=>V,triggerAssistantSkillCompletion:()=>E,triggerHumanStepCompletion:()=>D});n(16280),n(18107),n(967357),n(898992),n(803949);var a=()=>n(907258),i=()=>n(908006),s=()=>n(295633),o=()=>n(755125),r=()=>n(436468),l=()=>n(404931),c=()=>n(206267),d=()=>n(179034),u=()=>n(534177),p=()=>n(44729),g=()=>n(384944),m=()=>n(576590),h=()=>n(825836),f=()=>n(677590),y=()=>n(234637),v=()=>n(918678),S=()=>n(995277),b=()=>n(685453),x=()=>n(501305),I=()=>n(371621),k=()=>n(945710),w=()=>n(383070),C=()=>n(483730),A=()=>n(715142),T=()=>n(440024),j=()=>n(206051),M=()=>n(525569),_=()=>n(295304),P=()=>n(926974);async function D(e){const{environment:t,context:n,updater:a,sessionId:s,from:r,assistantSurfaceType:l,skillCategoryOverride:c}=e;"textSelection"===n.type&&a((()=>{(0,o().clear)({environment:t}),(0,T().I)({environment:t})}));const d={type:"assistantCompletionPopup",stage:"results",loading:!0,sessionId:s,context:n,from:r,hasErrored:!1,skillCategoryOverride:c};a((()=>{M().default.setState(d)})),await i().default.afterNextFlush(),await R({...e,updater:a,from:l})}async function E(e){const{environment:t,context:n,clientSkillWithParameterValues:a,updater:s,sessionId:r,from:l,assistantSurfaceType:c,immediatelyCommitHumanText:d,skillCategoryOverride:u}=e;"textSelection"===n.type&&s((()=>{(0,o().clear)({environment:t}),(0,T().I)({environment:t})}));const p={type:"assistantCompletionPopup",stage:"results",loading:!0,sessionId:r,context:n,from:l,hasErrored:!1,clientSkillWithParameterValues:a,skillCategoryOverride:u};s((()=>{M().default.setState(p)})),await i().default.afterNextFlush(),await R({...e,updater:s,from:c,humanText:d})}async function R(e){const{environment:t,updater:n,humanText:i,from:s,skillCategoryOverride:o}=e,r=M().default.state;if("assistantCompletionPopup"!==r.type||"results"!==r.stage)return;const{clientSkillWithParameterValues:d}=r,p=r.skillCategoryOverride??o,g=r.sessionId;if(C().default.getSessionContext(g)||await(0,S().p)({environment:t,completionContext:r.context,clientSkillWithParameterValues:d,sessionId:g,makeActiveSession:!1,selectedSkillCategoryOverride:p}),w().zD.showAssistantNotionAiCopy()){const e=a().default.state.currentUserSettingsStore;e&&(0,m().setLastExposedToQnaAtToCurrentTimestamp)(t,{userSettingsStore:e})}const h=(0,l().dc)(null==d?void 0:d.clientSkill.skillType),f=C().default.getSessionContext(g);if(d){const e=(0,k().getSearchScopeForSkill)({skill:d});e&&(null==f||f.assistantConfigurationStore.setSearchScope(e))}if((0,u().O9)(i))await(0,y().b)({environment:t,text:i,sessionId:g,assistantSurfaceType:"writer",clientSkillWithParameterValues:d,selectedSkillCategoryOverride:p});else if(null==h||!h.requiresInput){const e=c().JW(),{sidebarSpaceStore:n}=a().default.state;if(!n)throw new Error("Expected active space");await(0,b().H)({environment:t,sessionId:g,inferenceId:e,assistantSurfaceType:s,inferenceStartMetadata:{source:Boolean(d)?"skill":"chat",skillType:null==d?void 0:d.clientSkill.skillType,mentionsUsed:void 0},inferenceEndMetadata:{parentStore:n,skillType:null==d?void 0:d.clientSkill.skillType,wasSkillSuggested:null==d?void 0:d.clientSkill.isSuggested,selectedSkillCategoryOverride:p}})}await n((()=>{const e=M().default.state;if("assistantCompletionPopup"!==e.type||"results"!==e.stage)return;const t=j().default.state.stores.at(-1);M().default.setState({...e,context:{...e.context,origin:t||e.context.origin},loading:!1})}))}async function B(e){const{environment:t,assistantInputTextStore:n,assistantSurface:a}=e,i=M().default.state;if("assistantCompletionPopup"!==i.type||"results"!==i.stage)return!1;const s=(0,A().K1)();let o=!0;return((null==s?void 0:s.hasPendingOperations())??!1)&&(o=await x().confirmAndDiscardPendingEditsIfApplicable({environment:t,assistantSurface:a,assistantInputTextStore:n})),!!o&&(M().default.setState({...i,clientSkillWithParameterValues:void 0,stage:"initialPrompt",sessionId:c().JW(),loading:!1,hasErrored:!1,skillCategoryOverride:void 0}),!0)}function F(e){const{environment:t,completionState:n}=e;(0,f().U)({environment:t,sessionId:n.sessionId})}async function N(e){const{environment:t,assistantSurfaceType:n}=e,a=M().default.state;if("assistantCompletionPopup"!==a.type)return;const i=a.sessionId;M().default.invalidateLastUpdater(),M().default.resetStore();const s=C().default.getSessionContextOrThrow(i);await(0,v().o)({environment:t,sessionId:i,updater:s.createUpdater(),assistantSurfaceType:n}),await(0,h().i)({environment:t,sessionId:i,operationContext:(0,I().BB)({shouldCreateUnknownBlock:!0})}),(0,f().U)({environment:t,sessionId:i})}function L(e){const{environment:t}=e,n=M().default.state;if("assistantCompletionPopup"!==n.type)return;const a=n.sessionId;M().default.invalidateLastUpdater(),M().default.resetStore(),(0,f().U)({environment:t,sessionId:a})}async function O(e){const{environment:t,targetBlockStore:n,parentStore:a,operationsToApply:i,executableOperationsToApply:o,transaction:l}=e;if(!(0,P().MC)({executableOperations:o}))return;if(!(0,P().LC)({pendingExecutableOperations:o,currentPageStore:a}))return;return(0,P().h0)({operations:o}).forEach((e=>{const i=s().B.createChildStore(a,{id:e.attributes.id,table:d().ev}),o=r().w$[e.tagName];if(!o||"unknown-block"===e.tagName)return;const c=g().Wv({environment:t,type:o,inMemoryRecordCache:i.inMemoryRecordCache,transaction:l});p().Ti({parentStore:a.getContentStore(),childStore:s().B.createChildStore(i.getContentStore(),c.pointer),transaction:l,before:n.id});const u=i.getTitleStore(),m=u?u.getValue():void 0;_().R9({environment:t,store:c.getBlockTitleStore(),value:m,transaction:l})})),await(0,I().y2)({environment:t,transaction:l,operations:i,operationContext:(0,I().BB)({shouldCreateUnknownBlock:!0})})}function V(e){const{environment:t,context:n,sessionId:a,from:i,updater:s}=e;"textSelection"===n.type&&s((()=>{(0,o().clear)({environment:t}),(0,T().I)({environment:t})}));const r={type:"assistantCompletionPopup",stage:"initialPrompt",sessionId:a,context:n,from:i,loading:!1,hasErrored:!1,skillCategoryOverride:void 0};s((()=>{M().default.setState(r)}))}},552736:(e,t,n)=>{function a(e){return e.scrollHeight-(e.scrollTop+e.clientHeight)}n.d(t,{W:()=>a})},564627:(e,t,n)=>{n.d(t,{G:()=>i});class a extends(()=>n(757695))().Store{getInitialState(){return{previouslyVisitedSessionId:void 0}}setPreviouslyVisitedSession(e){this.setState({...this.state,previouslyVisitedSessionId:e})}}const i=new a;(0,n(852832).exposeDebugValue)("AssistantChatHistoryPreviouslyVisitedSessionStore",i)},568688:(e,t,n)=>{n.d(t,{I:()=>o});var a=()=>n(484714),i=()=>n(590526),s=()=>n(920370);function o({spaceId:e}){const t=(0,a().v3)(),n=(0,i().K8)((()=>e?s().L.getData(t,{spaceId:e}):"no_space_id"),[t,e]);return"no_space_id"===n?{isLoading:!1,requests:{}}:{isLoading:void 0===n,requests:n??{}}}},579819:(e,t,n)=>{n.d(t,{O:()=>x,Q:()=>v});n(410838),n(944114),n(898992),n(354520),n(672577),n(803949),n(581454),n(737550);var a=()=>n(203066),i=()=>n(153321),s=n(296540),o=()=>n(401497),r=()=>n(807449),l=()=>n(98126),c=()=>n(493552),d=()=>n(209969),u=()=>n(69708),p=()=>n(100622),g=()=>n(899086),m=()=>n(135221),h=()=>n(115512),f=()=>n(788749),y=n(474848);const v=(0,u().YK)({thinking:{id:"ResearchModePlanningStep.action.thinking",defaultMessage:"Thinking"},browsing:{id:"ResearchModePlanningStep.action.browsing",defaultMessage:"Browsing web"},searching:{id:"ResearchModePlanningStep.action.searching",defaultMessage:"Search"},loading:{id:"ResearchModePlanningStep.action.loading",defaultMessage:"Loading"},querying:{id:"ResearchModePlanningStep.action.querying",defaultMessage:"Querying"},reading:{id:"ResearchModePlanningStep.action.reading",defaultMessage:"Reading"},readingDatabasePages:{id:"ResearchModePlanningStep.action.readingDatabasePages",defaultMessage:"Reading Database Pages"}}),S=(0,u().YK)({researchComplete:{id:"ResearchModePlanningStep.status.researchComplete",defaultMessage:"Research complete"},startingResearch:{id:"ResearchModePlanningStep.status.startingResearch",defaultMessage:"Starting research"},researchTimeInfo:{id:"ResearchModePlanningStep.status.researchTimeInfo",defaultMessage:"This will take 3 to 5 minutes"},researchInProgress:{id:"ResearchModePlanningStep.status.researchInProgress",defaultMessage:"Researching"}});function b({stepGroup:e,playIntroAnimation:t}){const n=(0,o().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:8,padding:"18px 16px",borderBottom:`1px solid ${p().Tj.border.secondaryTranslucent}`},headerContainer:{display:"flex",alignItems:"center",gap:12},iconContainer:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",color:p().Tj.blue.icon.accentPrimary}})),[]),[g,m]=(0,s.useState)("starting");(0,s.useEffect)((()=>{const e=setTimeout((()=>{m("time-info")}),2500),t=setTimeout((()=>{m("researching")}),5e3);return()=>{clearTimeout(e),clearTimeout(t)}}),[]);const h=(0,s.useMemo)((()=>"done"===e.value.status?"researchComplete":t?"starting"===g?"startingResearch":"time-info"===g?"researchTimeInfo":"researchInProgress":"in-progress"===e.value.status?"researchInProgress":"researchComplete"),[t,e.value.status,g]),f=(0,s.useMemo)((()=>"done"===e.value.status?(0,y.jsx)(r().I,{icon:d().checkmarkCircleFillIcon,size:"lg",style:{fill:n.iconContainer.color}}):(0,y.jsx)(l().A,{size:"md"})),[e.value.status,n.iconContainer.color]);return(0,y.jsx)("div",{style:n.container,children:(0,y.jsxs)("div",{style:n.headerContainer,children:[(0,y.jsx)("div",{style:n.iconContainer,children:f}),(0,y.jsx)(a().N,{mode:"wait",children:(0,y.jsx)(i().P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeInOut"},children:(0,y.jsx)(c().D,{styleKey:"bodyMedium",colorVariant:"primary",children:(0,y.jsx)(u().sA,{...S[h]})})},h)})]})})}function x({stepGroup:e}){const t=e.value.isFollowUpResearcherAgentStep??!1,n=(0,o().eP)(),r=(0,o().IS)((()=>({container:{display:"flex",flexDirection:"column",background:p().Tj.background.elevated,borderRadius:8,maxHeight:500,overflow:"hidden",...(0,h().nl)({width:1,color:"dark"===n?p().Tj.palette.gray[400]:p().Tj.palette.gray[100]})},thinkingContainer:{display:"flex",flexDirection:"column",paddingInlineStart:16,paddingInlineEnd:48,flex:1,overflow:"auto"},loadingContainer:{marginTop:18,display:"flex",alignItems:"center",gap:12},loadingDots:{display:"flex",gap:4,alignItems:"flex-end"}})),[n]),l=e.value.thinkingRounds.length>0?e.value.thinkingRounds[e.value.thinkingRounds.length-1]:void 0,d=(0,s.useMemo)((()=>{if(!l)return"";if(!l.thinkingStep.output)return"";const e=Array.isArray(l.thinkingStep.output)&&l.thinkingStep.output.find((e=>"thinking"===e.type));return e&&e.content}),[l]),S=d&&d.length>0,x=e.value.thinkingRounds,I=(0,s.useRef)(null),k=(0,s.useMemo)((()=>{const t=[];for(const e of x)t.push({type:"thinking",step:e.thinkingStep}),e.agentSteps.forEach((e=>{t.push({type:"agent",step:e})}));const n=t.filter((e=>"thinking"!==e.type||void 0!==e.step.output));return n.length>0&&"thinking"!==n[n.length-1].type&&"in-progress"===e.value.status&&n.push({type:"thinking",step:{id:"thinking-placeholder",type:"researcher-next-steps",value:{nextSteps:[]},done:!1}}),n}),[x,e.value.status]),w=(0,s.useMemo)((()=>k.some((e=>"agent"===e.type))),[k]),[C,A]=(0,s.useState)(!1),[T,j]=(0,s.useState)(!0),[M,_]=(0,s.useState)(1),P=(0,s.useCallback)((()=>{if(I.current){const e=I.current;e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}}),[]),[D,E]=(0,s.useState)(!1),R=(0,s.useRef)(!1);(0,s.useEffect)((()=>{if(!D){const e=k.length>0?k[k.length-1]:void 0;e&&"thinking"===e.type&&!e.step.output?_(k.length-1):_(k.length),E(!0),k.filter((e=>"thinking"===e.type)).length<=1&&!t&&V(!0)}}),[k,D,t]),(0,s.useEffect)((()=>{if(M<k.length){const e=k[M],t=e&&"thinking"===e.type;if(t){if(k.slice(0,M).filter((e=>"agent"===e.type)).some((e=>"in-progress"===e.step.value.status)))return}const n=setTimeout((()=>{R.current=!0,_((e=>Math.min(e+1,k.length)))}),t?2e3:100);return()=>clearTimeout(n)}}),[M,k.length,k]);const B=(0,s.useMemo)((()=>{var e,t;const n=null===(e=k.findLast((e=>"thinking"===e.type)))||void 0===e?void 0:e.step;if(null==n||!n.output)return null;return(Array.isArray(n.output)?null===(t=n.output.find((e=>"thinking"===e.type)))||void 0===t?void 0:t.content:null)??null}),[k]),[F,N]=(0,s.useState)(!1),L=(0,s.useCallback)((()=>{if(!I.current)return!0;const e=I.current;return e.scrollHeight-e.scrollTop-e.clientHeight<=5}),[]);(0,s.useEffect)((()=>{const e=I.current;if(!e)return;const t=()=>{C||(L()?j(!0):j(!1))};return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}),[L,C]),(0,s.useEffect)((()=>{if(F&&T&&R.current){A(!0),P();const e=setTimeout((()=>{A(!1),N(!1)}),500);return()=>clearTimeout(e)}}),[F,P,T]),(0,s.useEffect)((()=>{if(T&&R.current){A(!0),P();const e=setTimeout((()=>{A(!1)}),500);return()=>clearTimeout(e)}}),[B,P,T]);const[O,V]=(0,s.useState)(!1);return"loading"===e.value.status?null:!S||t&&!w||!D?(0,y.jsxs)("div",{style:r.loadingContainer,children:[(0,y.jsx)(g().jh,{sizeVariant:"plans"}),(0,y.jsxs)("div",{style:r.loadingDots,children:[(0,y.jsx)(c().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:(0,y.jsx)(u().sA,{...v.thinking})}),(0,y.jsx)(m().A,{isTriColored:!0})]})]}):(0,y.jsxs)("div",{style:r.container,children:[(0,y.jsx)(b,{stepGroup:e,playIntroAnimation:O}),(0,y.jsx)(a().N,{children:(0,y.jsx)(i().P.div,{style:{...r.thinkingContainer,overflowY:C?"hidden":"auto"},ref:I,initial:{paddingBottom:0},animate:{paddingBottom:"26px"},exit:{paddingBottom:0},children:(0,y.jsx)(a().N,{children:k.slice(0,M).map(((e,t)=>"thinking"===e.type?(0,y.jsx)(i().P.div,{initial:{opacity:0,paddingTop:0},animate:{opacity:1,paddingTop:18},exit:{opacity:0,paddingTop:0},transition:{duration:.3,ease:"easeOut"},children:(0,y.jsx)(f().Ps,{thinkingStep:e.step,onExpandCompleteCallback:()=>N(!0)})},t):(0,y.jsx)(i().P.div,{initial:{opacity:0,paddingTop:0},animate:{opacity:1,paddingTop:18},exit:{opacity:0,paddingTop:0},transition:{duration:.3,ease:"easeOut"},children:(0,y.jsx)(f().eS,{agentStep:e.step,onExpandCompleteCallback:()=>{k.length>t+1&&"thinking"===k[t+1].type&&N(!0)}})},t)))})})})]})}},580035:(e,t,n)=>{n.d(t,{V:()=>s});n(898992),n(737550);var a=()=>n(484714),i=()=>n(590526);function s(e){const t=(0,a().v3)();return(0,i().K8)((()=>{if(!e)return!1;const n=e.getTranscript();if(!(null==n?void 0:n.some((e=>"title"===e.type))))return!1;const a=t.currentUser.id,i=e.getCreatedById()===a,s="editor"===e.getRole();return i||s}),[e,t.currentUser.id])}},582094:(e,t,n)=>{n.d(t,{$:()=>a,A:()=>s});const a={INVALID_DATE:"Invalid date",INVALID_RANGE:"Invalid range",NOT_SUPPORTED:"Not supported"};class i extends(()=>n(757695))().Store{getInitialState(){return{dateEdited:!1,timeEdited:!1,temporaryValue:{date:void 0,time:void 0},error:void 0}}}const s=i},582162:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>i,oneDriveIcon:()=>s});n(296540);var a=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"-0.01 3.44 20.01 12.82",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("g",{clipPath:"url(#clip0_16020_1017)",children:[(0,a.jsx)("path",{fill:"#0364B8",d:"m7.627 7.008 4.198 2.514 2.502-1.053a4.05 4.05 0 0 1 1.885-.321A6.25 6.25 0 0 0 4.936 6.264L5 6.262a5 5 0 0 1 2.627.746"}),(0,a.jsx)("path",{fill:"#0078D4",d:"M7.627 7.007v.001A5 5 0 0 0 5 6.262l-.064.002A4.998 4.998 0 0 0 .898 14.12l3.703-1.558 1.646-.692 3.664-1.542 1.914-.806z"}),(0,a.jsx)("path",{fill:"#1490DF",d:"M16.212 8.148a4.05 4.05 0 0 0-1.885.322l-2.502 1.052.726.435 2.378 1.424 1.037.622 3.548 2.125a4.062 4.062 0 0 0-3.302-5.98"}),(0,a.jsx)("path",{fill:"#28A8EA",d:"m15.966 12.003-1.037-.622-2.378-1.424-.726-.435-1.914.806-3.664 1.542-1.646.692L.898 14.12A5 5 0 0 0 5 16.263h10.938a4.06 4.06 0 0 0 3.576-2.135z"})]}),(0,a.jsx)("defs",{children:(0,a.jsx)("clipPath",{id:"clip0_16020_1017",children:(0,a.jsx)("path",{fill:"#fff",d:"M0 3.45h20v12.813H0z"})})})]})},s=(0,n(340498).wt)("oneDrive",i,"default")},584774:(e,t,n)=>{n.d(t,{T:()=>g});var a=()=>n(664594),i=()=>n(300474),s=()=>n(242422),o=()=>n(484714),r=()=>n(590526),l=()=>n(706021),c=()=>n(924102),d=()=>n(528093),u=()=>n(748355),p=()=>n(759418);function g(){const e=(0,i().r)(),t=(0,a().T)(),n=(0,o().v3)(),g=(0,d()._)({name:"ai_usage",spaceId:e,userId:t,amount:1}),{variant:m,spaceJoinOrCreate:h,exposedToExperiment:f}=(0,p().V)();(0,r().K8)((()=>void 0!==m&&"join"===h&&!f&&(!!(0,l().e2)(g)&&(s().default.getEligibleGroup({experimentId:"adoption_show_ai_to_new_user_joiner"}),(0,c().o)({environment:n,featureKey:"adoption_show_ai_to_new_user_joiner"}),u().$.setState({...u().$.state,exposedToExperiment:!0}),!0))),[g,h,m,n,f])}},587685:(e,t,n)=>{function a(e){const{idMapper:t}=e;return`<load id="${t.mapKeyToCounter({type:"collection",key:e.mappedDatabaseId})}"/>`}n.d(t,{P:()=>a})},588047:(e,t,n)=>{n.d(t,{k:()=>i});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"2.42 2.11 11.16 12.13",svg:(0,n(474848).jsx)("path",{d:"M8 2.115c-.854 0-1.569.554-1.824 1.315a3.96 3.96 0 0 0-2.138 3.518v.895c0 .655-.238 1.287-.669 1.78l-.616.704c-.75.858-.141 2.202 1 2.202H5.89a2.156 2.156 0 0 0 4.218 0h2.139c1.14 0 1.75-1.344.999-2.202l-.616-.704a2.7 2.7 0 0 1-.669-1.78v-.895A3.96 3.96 0 0 0 9.824 3.43 1.92 1.92 0 0 0 8 2.115m-.669 1.839A.68.68 0 0 1 8 3.365c.34 0 .623.253.669.589l.048.353.33.138a2.71 2.71 0 0 1 1.665 2.503v.895c0 .958.348 1.882.978 2.603l.616.704a.078.078 0 0 1-.058.129H3.752a.078.078 0 0 1-.058-.129l.616-.704c.63-.72.978-1.645.978-2.603v-.895c0-1.126.686-2.093 1.665-2.503l.33-.138zM8 13.084c-.394 0-.735-.226-.9-.555h1.8c-.165.33-.506.556-.9.556"})},i=(0,n(340498).wt)("bellSmall",a,"small")},588104:(e,t,n)=>{n.d(t,{Q:()=>o});n(296540);var a=()=>n(401497),i=()=>n(100622),s=n(474848);function o(e){const t=(0,a().eP)(),n=(0,a().IS)((()=>({container:{boxShadow:e.isFocused?`0px 0px 0px 1px ${i().Tj.blue.border.accentPrimary}, 0px 0px 0px 3px ${i().Tj.blue.border.strong}`:`0px 0px 0px 1px ${i().Tj.border.secondary}, 0 1px 3px rgba(0, 0, 0, 0.06)`,backgroundColor:"dark"===t?i().Tj.palette.translucentGray[100]:i().Tj.background.primary,borderRadius:8,...e.style}})),[e.style,e.isFocused,t]);return(0,s.jsx)("div",{style:n.container,children:e.children})}},589222:(e,t,n)=>{n.d(t,{h:()=>a});const a=(0,n(340498).xh)("plus",{default:{loader:()=>n.e(8881).then(n.bind(n,617668))},small:{loader:()=>n.e(8881).then(n.bind(n,863330))},fill:{loader:()=>n.e(8881).then(n.bind(n,73822))},fillSmall:{loader:()=>n.e(8881).then(n.bind(n,621837))}},["plus","add","new","create","increase"])},592420:(e,t,n)=>{n.d(t,{Q:()=>s});var a=()=>n(755531),i=()=>n(134217);function s(e){var t;return!(null===(t=(0,a().S)())||void 0===t||!t.canAdmin())&&(0,i().n)(e,"enterprise")}},596120:(e,t,n)=>{function a(e){return e.updatedTime??e.createdTime}function i(e,t){return a(t)-a(e)}n.d(t,{X:()=>i,m:()=>a})},596635:(e,t,n)=>{n.d(t,{J:()=>a,f:()=>i});n(898992),n(672577),n(737550);const a={create_page:"create-page",replace_in_page:"replace",replace_page:"replace-page",insert_in_page:"insert",chat:"chat",improve_writing:"replace",continue_writing:"insert",explain_this:"chat",create_page_in_database:"create-page"};function i(e){const t=e.find(((t,n)=>{if("observation"===t.type&&"namespaceStart"===t.observationType){const a=e.findIndex(((e,a)=>a>n&&"observation"===e.type&&"namespaceStart"===e.observationType&&e.namespace===t.namespace)),i=e.slice(n+1,-1===a?void 0:a),s=i.some((e=>"observation"===e.type&&"namespaceEnd"===e.observationType&&e.namespace===t.namespace)),o=i.some(((e,n)=>{const a=i[n+1];return"assistant"===e.type&&e.namespace===t.namespace&&!(a&&"observation"===a.type)}));return!s&&!o}return!1}));return t?t.namespace:"prompt_only_top_level"}},598900:(e,t,n)=>{n.d(t,{f:()=>i});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"3.62 1.34 8.75 12.93",svg:(0,n(474848).jsx)("path",{d:"M9.332 1.38a.575.575 0 0 0-.662.204l-4.936 6.84a.575.575 0 0 0 .466.911h2.398l-.315 4.32a.575.575 0 0 0 1.039.378l4.944-6.832a.575.575 0 0 0-.466-.912H9.401l.309-4.328a.575.575 0 0 0-.378-.582M7.216 8.185H5.324l3.095-4.289-.209 2.927a.575.575 0 0 0 .574.616h1.89l-3.097 4.28.212-2.917a.575.575 0 0 0-.573-.617"})},i=(0,n(340498).wt)("lightningSmall",a,"small")},600881:(e,t,n)=>{n.d(t,{Jw:()=>A,L_:()=>w,RP:()=>C,W8:()=>k,wj:()=>I,xM:()=>x});n(18107),n(967357),n(898992),n(823215),n(354520),n(430670),n(581454),n(908872);var a=()=>n(907258),i=()=>n(692031),s=()=>n(212497),o=()=>n(221844),r=()=>n(295633),l=()=>n(902006),c=()=>n(832443),d=()=>n(179034),u=()=>n(201980),p=()=>n(99895),g=()=>n(496603),m=()=>n(534177),h=()=>n(862292),f=()=>n(951177),y=()=>n(836724),v=()=>n(605804),S=()=>n(774111),b=()=>n(150984);async function x(e){const{environment:t,groups:n,spaceStore:a}=e,o=await h().T.formulas.load(),l=n.map((e=>e.pageId));if(!a)return;const c=l.map((e=>new(r().B)(t,{id:e,table:d().ev,spaceId:a.id}))),u=c.map((e=>e.getValue())).filter(m().O9),p=c.at(0);if(!p)return;const g=(0,f().ZI)({rootBlock:p.getSpaceShardedPointer(),blockValues:u,getRecordValue:p.getRecordValue,isWindows:t.device.isWindows,markdownLinkifyIt:void 0,formulasModule:o,spaceIdCreator:p.environment.idCreator.getSpaceIdCreatorSync(p.getSpaceId())}),[y,v]=await Promise.all([(0,i().r)(),(0,s().jd)()]);v({environment:t,stringValue:g.markdown??"",copiedMessage:y.copiedPageToClipboard})}async function I(e){const{clientStep:t,environment:n}=e,[a,r]=await Promise.all([(0,i().r)(),(0,s().jd)()]),l=await h().T.formulas.load();if("assistantChatText"===t.type)r({environment:n,stringValue:t.text??"",copiedMessage:a.copiedQnAMessageToClipboard});else if("assistantChat"===t.type){const e=(0,b().generateBlockStoresForClientChatStep)({environment:n,clientStep:t,citationOrdering:void 0,inMemoryRecordCache:new(o().A)({name:"assistantChat.clipboard"}),isPreviewing:!1});r({environment:n,stringValue:(0,f().ZI)({rootBlock:{...e[0].pointer,spaceId:e[0].getSpaceId()},blockValues:e.map((e=>e.getValue())).filter(m().O9),getRecordValue:e[0].getRecordValue,isWindows:n.device.isWindows,markdownLinkifyIt:void 0,formulasModule:l,spaceIdCreator:e[0].environment.idCreator.getSpaceIdCreatorSync(e[0].getSpaceId())}).markdown??"",copiedMessage:a.copiedQnAMessageToClipboard})}else(0,m().HB)(t)}function k(e){const t=new(p().G)((()=>0));for(const a of e){const e=(0,u().uPN)(a);for(const n of e)(0,u().qsB)(n)?t.set("date",t.get("date")+1):(0,u().rie)(n)?t.set("user",t.get("user")+1):(0,u().jIt)(n)&&t.set("page",t.get("page")+1)}const n={};for(const[a,i]of t.entries())n[a]=i;return n}function w(e){const{sidebarSpaceStore:t}=a().default.state,{clientStep:n,imageSrc:i}=e;t&&S().A.setState({isOpen:!0,clientStep:n,parentSpaceId:t.id,parentStore:t,imageSrc:i})}function C(e){const t=(0,v().l0)(e);let n,a,i,s,o=!1;if(t){const e=g().sb(t.flatMap((e=>e.pageIds))),r=t.flatMap((e=>e.searchResults)),d=g().sb(r).map((e=>c().tD.parseAssistantHref(e)));let u=0;for(const t of d)if(void 0!==t)if((0,l().SC)(t.type)||"helpdoc"===t.type||"helpdoc-section"===t.type||"webpage"===t.type||"database_query_results"===t.type)u++;else{if("block"===t.type||"citation_unsupported"===t.type)continue;(0,m().HB)(t.type)}a=e.length+u,n=d.reduce(((e,t)=>(void 0!==t&&(e[t.type]=(e[t.type]||0)+1),e)),{}),e&&(n.page=e.length),i=n.slack||0,s=n["google-drive"]||0,o=n.helpdoc>0}return{numSearchResults:a,numSlackSearchResults:i,numGoogleDriveSearchResults:s,resultsBySource:n,searchedHelpdocs:o}}function A(e){const{assistantSelection:t}=e;if(!t)return!1;if("block"===t.type){const e=t.blockIds.at(0);if(!e)return!1;const[n]=y().T.findSelectablesFromIds([e]);if(!n)return!1;const a=n.props.store,i=a.getParentBlockStore(),s=i?i.getRenderableContentIds():[],o=s.indexOf(a.id);return Boolean(i&&t.blockIds.every(((e,t)=>s.indexOf(e)===o+t)))}if("text"===t.type)return!0;(0,m().HB)(t)}},601751:(e,t,n)=>{n.d(t,{r:()=>i});class a extends(()=>n(757695))().Store{getInitialState(){return{isOpen:!1,openCount:0,from:void 0}}}const i=new a;(0,n(852832).exposeDebugValue)("agentPersonalizationSettingsModalStore",i)},603907:(e,t,n)=>{n.d(t,{j:()=>i});n(581454);var a=()=>n(388821);const i=new(n(607780).n)(((e,{spaceId:t,query:n="",createdByIds:a=[],createdTimeFrom:i,createdTimeTo:s,lastEditedTimeFrom:o,lastEditedTimeTo:r,sharedWithUserIds:l=[],sharedWithGroupIds:c=[],lastActivityFrom:d,lastActivityTo:u,status:p=[],integrationTypes:g=[],mcpServerNames:m=[]})=>[t,n,a.join(","),`${i??""}-${s??""}`,`${o??""}-${r??""}`,l.join(","),c.join(","),`${d??""}-${u??""}`,p.join(","),g.join(","),m.join(",")].join("::")),(async(e,t)=>{const{spaceId:i,query:s,createdByIds:o=[],createdTimeFrom:r,createdTimeTo:l,lastEditedTimeFrom:c,lastEditedTimeTo:d,sharedWithUserIds:u=[],sharedWithGroupIds:p=[],lastActivityFrom:g,lastActivityTo:m,status:h=[],integrationTypes:f=[],mcpServerNames:y=[]}=t,v=await e.api.callApi({eventName:"workspaceOwnerSearchAgents",environment:e,data:{spaceId:i,query:s,createdByIds:o,createdTimeFrom:r,createdTimeTo:l,lastEditedTimeFrom:c,lastEditedTimeTo:d,sharedWithUserIds:u,sharedWithGroupIds:p,lastActivityFrom:g,lastActivityTo:m,status:h,integrationTypes:f,mcpServerNames:y}});if("success"!==v.type)return;const S=a().RecordMapWithRole.create(v.data.recordMap),b=a().RecordMapWithRole.create();for(const{pointer:n,model:a}of S)a&&b.setModelAndRole(n,a,"editor");const x=new(n(221844).A)({name:n(223116).a9,data:new(n(445120).UserRecordMap)});x.data.getUserRecordMap(e.currentUser.id).assign(b),x.addCacheFallback(e.defaultRecordCache.inMemoryRecordCache);const I=v.data.agentIds.map((t=>new(n(350013).N)(e,{table:n(743246).C0,id:t,spaceId:i},{inMemoryRecordCache:x}))),k={};for(const n of v.data.mostRecentTranscripts)k[n.parent_id]=Number(n.created_time);const w={},C=new Map((v.data.meta??[]).map((e=>[e.id,e])));for(const n of I){var A;const e=C.get(n.id);w[n.id]={createdTime:(null==e?void 0:e.created_time)??n.getCreatedTime(),lastEditedTime:(null==e?void 0:e.last_edited_time)??n.getLastEditedTime(),createdById:(null==e?void 0:e.created_by_id)??n.getCreatedById(),lastEditedById:(null==e?void 0:e.last_edited_by_id)??n.getLastEditedById(),name:(null==e?void 0:e.name)??n.getName(),icon:(null==e?void 0:e.icon)??n.getRawIcon(),alive:(null==e?void 0:e.alive)??n.getAlive(),hasEnabledTriggers:null==e?void 0:e.has_enabled_triggers,modules:null===(A=n.getData())||void 0===A?void 0:A.modules}}return{value:{agents:I,lastActivityByWorkflowId:k,metaByWorkflowId:w,distinctMcpServers:v.data.distinctMcpServers},dependencies:v.data.dependencies}}))},605804:(e,t,n)=>{n.d(t,{ND:()=>g,Wj:()=>c,dF:()=>p,l0:()=>d});n(18107),n(944114),n(967357),n(898992),n(354520),n(672577),n(430670),n(581454);var a=()=>n(457726),i=()=>n(436468),s=()=>n(416504),o=()=>n(681873),r=()=>n(201980),l=()=>n(534177);function c(e){const{currentSteps:t,stepType:n}=e,a=[],i=[...t].reverse(),s=i.find((e=>e.type===n));if(!s)return{error:`Could not find Step of type ${n}`};const o=i.indexOf(s);let r=0;for(const l of i)r<=o||a.push(l),r+=1;return{value:{newSteps:a.reverse(),previousStep:s}}}function d(e){return u(e).filter(a().uy)}function u(e){const t=e.at(-1);return t?function(e,t){return-1===e.indexOf(t)?[]:p(e).find((e=>e.includes(t)))||[]}(e,t):[]}function p(e){const t=[];let n=[];for(const a of e)"human"===a.type?(n.length>0&&t.push(n),n=[a]):n.push(a);return n.length>0&&t.push(n),t}function g(e){const{step:t,getRecordModel:n,evaluatorState:a}=e,c=(0,i().Ij)({humanChatValue:t.value,evaluatorState:a}).map((e=>(0,i().ld)({type:"text",nodes:[e],getRecordModel:n,currentTimeZone:(0,s().P)()}))).filter(l().O9);return(0,o().G)(c,(()=>(0,r().x9d)("\n"))).flatMap((e=>e))}},607833:(e,t,n)=>{n.d(t,{x3:()=>Ee,DZ:()=>Me});n(16280),n(18107),n(410838),n(944114),n(378347),n(967357),n(898992),n(354520),n(672577),n(581454),n(908872),n(737550);var a=n(296540),i=()=>n(564884),s=()=>n(242422),o=()=>n(726637),r=()=>n(484714),l=()=>n(590526),c=()=>n(401497),d=()=>n(718827),u=()=>n(250910),p=()=>n(807449),g=()=>n(736847),m=()=>n(474587),h=()=>n(457726),f=()=>n(847832),y=()=>n(775842),v=()=>n(132855),S=()=>n(40457),b=()=>n(454503),x=()=>n(29037),I=()=>n(126617),k=()=>n(109089),w=()=>n(105819),C=()=>n(724925),A=()=>n(562042),T=()=>n(877235),j=()=>n(599813),M=()=>n(123382),_=()=>n(201980),P=()=>n(69708),D=()=>n(100622),E=()=>n(496603),R=()=>n(534177),B=()=>n(671894),F=()=>n(471415),N=()=>n(12956),L=()=>n(267271),O=()=>n(600881),V=()=>n(154373),z=()=>n(977270),W=()=>n(946560),U=()=>n(401535),H=()=>n(546926),K=()=>n(890492),q=()=>n(663639),$=()=>n(236262),G=()=>n(575143),Y=()=>n(525569),Q=()=>n(547149),J=()=>n(501305),X=()=>n(383070),Z=n(474848);const ee=(0,P().YK)({editFavoriteAction:{id:"assistant.editFavoriteAction",defaultMessage:"Edit favorite"},removeFavoriteAction:{id:"assistant.removeFromFavoritesAction",defaultMessage:"Remove from favorites"}});function te(e){const t=(0,P().tz)(),{favorite:n,currentSpaceViewStore:s,currentUserSettingStore:o}=e,c=(0,r().v3)(),[d,u]=(0,a.useState)("menu"),p=(0,l().K8)((()=>X().zD.canEditAssistantWriterFavorite()),[]),m=(0,a.useMemo)((()=>{const e=n.data;return[{key:"favorite_actions",items:[..."human_step_only"===e.type&&p?[{key:"edit",action:()=>{"assistantCompletionPopup"===Y().default.state.type&&((0,J().setPrimeTextInput)(e.initialHumanStep),Y().default.setState({...Y().default.state,stage:"editing",favoriteId:n.id,name:e.name,executeImmediately:e.executeImmediately}),(0,i().u)({environment:c,event:{eventName:"assistant_writer_edit_favorite",eventProperties:{favorite_id:n.id}}}))},render:e=>(0,Z.jsx)(G().A,{...e,svg:w().pencilLineIcon,title:t.formatMessage(ee.editFavoriteAction)})}]:[],{key:"remove",action:()=>{Q().createAndCommit({userAction:"ai.assistantSessionStarterAction.removeFavoriteAction",environment:c,canUndo:!0,perform(e){(0,V().Tm)({id:n.id,currentSpaceViewStore:s,currentUserSettingStore:o,transaction:e}),(0,i().u)({environment:c,event:{eventName:"assistant_writer_remove_favorite",eventProperties:{favorite_id:n.id}}})}})},render:e=>(0,Z.jsx)(G().A,{...e,svg:$().trashIcon,title:t.formatMessage(ee.removeFavoriteAction)})}],render:e=>(0,Z.jsx)(g().A,{...e})}]}),[n.data,n.id,p,c,t,s,o]),h=(0,a.useMemo)((()=>{if("menu"===d)return(0,Z.jsx)(q().A,{priority:1,sections:m,type:q().O.Vertical,initialFocus:0});(0,R().HB)(d)}),[m,d]);return(0,Z.jsx)(K().A,{menuType:H().gu.Popup,width:250,children:h})}const ne=(0,P().YK)({removeRecentAction:{id:"assistant.removeFromRecentsAction",defaultMessage:"Remove from recents"}});function ae(e){const t=(0,P().tz)(),{recent:n,currentSpaceViewStore:s}=e,o=(0,r().v3)(),[l,c]=(0,a.useState)("menu"),d=(0,a.useMemo)((()=>[{key:"recent_actions",items:[{key:"remove",action:()=>{Q().createAndCommit({userAction:"ai.assistantSessionStarterAction.removeRecentAction",environment:o,canUndo:!0,perform(e){(0,V().Ub)({id:n.id,currentSpaceViewStore:s,transaction:e}),(0,i().u)({environment:o,event:{eventName:"assistant_writer_remove_recent",eventProperties:{recent_id:n.id}}})}})},render:e=>(0,Z.jsx)(G().A,{...e,svg:$().trashIcon,title:t.formatMessage(ne.removeRecentAction)})}],render:e=>(0,Z.jsx)(g().A,{...e})}]),[s,o,t,n.id]),u=(0,a.useMemo)((()=>{if("menu"===l)return(0,Z.jsx)(q().A,{priority:1,sections:d,type:q().O.Vertical,initialFocus:0});(0,R().HB)(l)}),[d,l]);return(0,Z.jsx)(K().A,{menuType:H().gu.Popup,width:250,children:u})}var ie=()=>n(949575),se=()=>n(945710),oe=()=>n(520937),re=()=>n(483730),le=()=>n(715142),ce=()=>n(631611),de=()=>n(29554),ue=()=>n(511393),pe=()=>n(781919),ge=()=>n(295304),me=()=>n(260850),he=()=>n(551414),fe=()=>n(926974),ye=()=>n(695115),ve=()=>n(526278),Se=()=>n(134589);class be extends(()=>n(757695))().Store{getInitialState(){return{favoriteId:"",name:"",executeImmediately:!1}}syncWithCompletionsStore(e){this.setState({favoriteId:e.favoriteId,name:e.name??"",executeImmediately:e.executeImmediately??!1})}}const xe=new be;(0,n(852832).exposeDebugValue)("AssistantFavoriteStore",xe);const Ie=xe;var ke=()=>n(419357),we=()=>n(574036);const Ce=(0,P().YK)({save:{id:"assistant.favorites.save",defaultMessage:"Save changes"},delete:{id:"assistant.favorites.delete",defaultMessage:"Delete"},runImmediately:{id:"assistant.favorites.runImmediately",defaultMessage:"Run immediately"},actionNameLabel:{id:"assistant.favorites.actionNameLabel",defaultMessage:"Action name"},cancelAndGoBack:{id:"assistant.favorites.cancelAndGoBack",defaultMessage:"Cancel and go back"},editorTitle:{id:"assistant.favorites.editorTitle",defaultMessage:"Edit favorite"}});function Ae(e){const{environment:t,currentUserSettingsStore:n,currentSpaceViewStore:a,mockTextStore:s}=e,o=()=>{Q().createAndCommit({environment:t,userAction:"assistantFavoritesEditor.goBackAction",canUndo:!0,perform:e=>{ge().R9({environment:t,store:s,value:void 0,transaction:e})}});const e=Y().default.state;"assistantCompletionPopup"===e.type&&"editing"===e.stage&&(Ie.reset(),Y().default.setState({...e,stage:"initialPrompt"}))},r=()=>{Q().createAndCommit({userAction:"assistantFavoritesEditor.saveFavoriteAction",environment:t,canUndo:!0,perform:e=>{const o=Y().default.state;"assistantCompletionPopup"===o.type&&"editing"===o.stage&&((0,V().KM)({currentSpaceViewStore:a,currentUserSettingsStore:n,transaction:e,data:{id:Ie.state.favoriteId,name:Ie.state.name,executeImmediately:Ie.state.executeImmediately??!1,initialHumanStep:s.getValue()??[[""]]}}),(0,i().u)({environment:t,event:{eventName:"assistant_writer_favorite_saved",eventProperties:{favorite_id:Ie.state.favoriteId,execute_immediately:Ie.state.executeImmediately}}}))}}),o()},l=function(e){const{onSave:t,goBack:n}=e,a=(0,L().Ls)({key:"input",analyticsName:"assistantFavoriteName",displayName:Ce.save,validators:[],closeParentMenu:!1,render:e=>(0,Z.jsx)(Te,{onSave:t,goBack:n}),action:()=>{}}),i=(0,L().Ls)({key:"runImmediately",analyticsName:"assistantFavoriteRunImmediately",displayName:Ce.runImmediately,validators:[],closeParentMenu:!1,render:e=>(0,Z.jsx)(je,{...e}),action:()=>{Ie.update((e=>({...e,executeImmediately:!e.executeImmediately})))}});return(0,L().gy)({key:"assistant favorites options section",render:e=>(0,Z.jsx)(g().A,{...e}),actions:[a,i]})}({onSave:r,goBack:o}),c=(0,L().gy)({key:"save section",render:e=>(0,Z.jsx)(g().A,{...e}),actions:[(0,L().Ls)({key:"save action",analyticsName:"saveAssistantFavorite",displayName:Ce.save,validators:[],svg:Se().R,closeParentMenu:!1,action:()=>{r()}})]}),d=(0,L().gy)({key:"delete section",render:e=>(0,Z.jsx)(g().A,{...e}),actions:[(0,L().Ls)({key:"delete action",analyticsName:"deleteAssistantFavorite",displayName:Ce.delete,validators:[],svg:$().trashIcon,closeParentMenu:!1,action:()=>{(()=>{const e=Y().default.state;if("assistantCompletionPopup"===e.type&&"editing"===e.stage){const i=e.favoriteId;Q().createAndCommit({userAction:"ai.assistantSessionStarterAction.removeFavoriteAction",environment:t,canUndo:!0,perform:e=>{(0,V().Tm)({id:i,currentSpaceViewStore:a,currentUserSettingStore:n,transaction:e})}}),o()}})()}})]});return[l,c,d]}function Te(e){const{onSave:t,goBack:n}=e,i=(0,P().tz)();(0,a.useEffect)((()=>{const e=Y().default.state;"assistantCompletionPopup"===e.type&&"editing"===e.stage&&e.favoriteId!==Ie.state.favoriteId&&Ie.syncWithCompletionsStore(e)}),[]);const s=(0,l().K8)((()=>Ie.state.name),[]),o=(0,a.useCallback)((e=>{const t=Y().default.state;"assistantCompletionPopup"===t.type&&"editing"===t.stage&&Ie.update((t=>({...t,name:e})))}),[]);return(0,Z.jsx)(g().A,{isInput:!0,style:{marginTop:0},title:(0,Z.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,Z.jsx)(ye().A,{icon:ve().arrowStraightLeftIcon,onClick:n,ariaLabel:i.formatMessage(Ce.cancelAndGoBack)}),i.formatMessage(Ce.editorTitle)]}),desktopTitleStyle:{padding:0,marginTop:0},children:(0,Z.jsx)(ke().Ay,{focus:!0,value:s,onChange:e=>{o(e.target.value)},placeholder:i.formatMessage(Ce.actionNameLabel),focusInitial:!0,onSubmit:t})})}function je(e){const t=(0,P().tz)(),n=(0,l().K8)((()=>Ie.state.executeImmediately),[]);return(0,Z.jsx)(we().A,{...e,on:n,title:t.formatMessage(Ce.runImmediately)})}const Me=(0,P().YK)({writerGlobalSkill:{id:"assistant.skillMenuItem.writerGlobalSkill",defaultMessage:"{acceptsParameters, select, true {{displayName}...} other {{displayName}}}"},writerWithHumanStepSkill:{id:"assistant.skillMenuItem.writerWithHumanStepSkill",defaultMessage:"{displayName} {humanStep}"},tryAgain:{id:"completions.CompletionMenuActionBar.tryAgain",defaultMessage:"Try again"},delete:{id:"completions.CompletionMenuActionBar.delete",defaultMessage:"Discard"},close:{id:"completions.CompletionMenuActionBar.close",defaultMessage:"Close"},accept:{id:"completions.CompletionMenuActionBar.accept",defaultMessage:"Accept"},replace:{id:"completions.CompletionMenuActionBar.replace",defaultMessage:"Replace selection"},insert:{id:"completions.CompletionMenuActionBar.insert",defaultMessage:"Insert below"},upsell:{id:"completions.CompletionMenuActionBar.upsell",defaultMessage:"Get Notion AI"},requestAccess:{id:"completions.CompletionMenuActionBar.requestAccess",defaultMessage:"Request Access"}}),_e="This string should never show up in analytics";function Pe(e){const{mockTextStore:t,menuListItemProps:n,currentSpaceStore:i}=e,s=(0,l().K8)((()=>t.getValue()),[t]),o=(0,a.useMemo)((()=>(0,de().r4)(s,i)),[s,i]),r=(0,c().eP)(),d=(0,c().IS)((()=>({boxedIconFill:{color:(0,oe().vJ)("recent").color(r).color}})),[r]);return(0,Z.jsx)(G().A,{...n,title:o,svg:()=>(0,Z.jsx)(F().O1,{svg:w().pencilLineIcon,svgFill:d.boxedIconFill.color}),right:(0,Z.jsx)(F().B5,{type:"submitPrompt",focused:n.focused})})}function De(e){const{mockTextStore:t,handleSubmit:n,spaceStore:a}=e;return(0,L().Ls)({key:"escape_hatch",analyticsName:"Assistant Writer - escape hatch",closeParentMenu:!1,displayName:void 0,right:(0,F().tY)("submitPrompt"),render:(e,n,i)=>(0,Z.jsx)(Pe,{menuListItemProps:e,mockTextStore:t,currentSpaceStore:a}),validators:[],action:({environment:e})=>{var a;const i=t.getValue(),s=!i||0===(0,_().AhH)(i),o=(0,le().x3)().at(0),r=(null==o||null===(a=o.getStagedAttachmentUploadStoreIfExists())||void 0===a?void 0:a.isUploadInProgress())??!1;s||!i||r||(n({newValue:i}),Q().createAndCommit({userAction:"AssistantWriterActions.escapeHatch",environment:e,canUndo:!0,perform:n=>{ge().R9({environment:e,store:t,value:void 0,transaction:n})}}))}})}function Ee(e){const{assistantSurface:t,environment:n,theme:a,filter:r,mockTextStore:l,state:c,from:d,context:u,intl:p,completionResultInfo:v,assistantConfigurationStore:S,shouldShowLimitedQnaUpsell:I,assistantSuggestionContext:A,suggestedSectionSkills:_,currentPageStore:P,spaceStore:H,currentUserSettingsStore:K,currentUserStore:q,requestedSkill:$,favorites:G,recents:J,currentSpaceViewStore:ee,handleSubmit:te,aiUsageAvailability:ne,upgradeEligibility:ae,upgradeAction:pe,isUpgradeSystemEnabled:ye}=e,ve=(0,U().lL)(null==S?void 0:S.state.sessionId,$);let Se;if("initialPrompt"===c.stage)Se=ve?ze({aiUsageAvailability:ne,upgradeEligibility:ae,upgradeAction:pe,isUpgradeSystemEnabled:ye,spaceStore:H}):function(e){const{assistantSurface:t,intl:n,from:a,mockTextStore:r,theme:l,assistantSuggestionContext:c,suggestedSectionSkills:d,dedupeAcrossSkillSections:u,favorites:p,recents:h,spaceStore:y,currentSpaceViewStore:v,currentUserSettingsStore:S,currentUserStore:b,environment:x,sessionId:I}=e;let k=(0,se().getAllClientSkills)({currentPageRecordPointer:void 0,currentCollectionRecordPointer:void 0}),A=p.reduce(((e,t,n)=>{const a=t.getData(),i="human_step_only"!==a.type?a.skill:void 0;return void 0===i||Object.hasOwn(oe().iS,i.skillType)?(e.push((0,ie().assistantSessionStarterModelToAssistantSurfaceAction)({assistantSessionStarter:t,validators:i?oe().iS[i.skillType].validators:[],boosters:[[ie().assistantSurfaceActionValidators.always,n>1?0:15-n]]})),e):e}),[]),j=h.reduce(((e,t,n)=>{const a=t.getData(),i="human_step_only"!==a.type?a.skill:void 0;return void 0===i||Object.hasOwn(oe().iS,i.skillType)?(e.push((0,ie().assistantSessionStarterModelToAssistantSurfaceAction)({assistantSessionStarter:t,validators:i?oe().iS[i.skillType].validators:[],boosters:[[ie().assistantSurfaceActionValidators.always,n>1?0:15-n]]})),e):e}),[]);c&&(k=(0,ie().filterAndRankAssistantSurfaceActionsForContext)((0,ie().clientSkillToAssistantSurfaceAction)(k),c),A=(0,ie().filterAssistantSurfaceActionsForContext)(A,c),j=(0,ie().filterAssistantSurfaceActionsForContext)(j,c));const _=["suggested",...c?(0,oe().gH)(M().sq,c):M().sq];return E().oE(_.map((e=>{let c,p;if("suggested"===e)p=(0,ie().clientSkillToAssistantSurfaceAction)(d),c=se().skillSectionMessages.suggestedSection;else if("favorite"===e){const e=(0,oe().vJ)("favorite");p=A,c=e.label}else if("recent"===e){const e=(0,oe().vJ)("recent");p=j,c=e.label}else p=u?(0,ie().clientSkillToAssistantSurfaceAction)(k.filter((t=>t.category===e))).filter((e=>!d.some((t=>e.skillType===t.skillType&&e.type===t.type)))):(0,ie().clientSkillToAssistantSurfaceAction)(k.filter((t=>t.category===e))),c=(0,oe().vJ)(e).label;if(0===p.length)return;let h=E().oE(p.map((e=>{if("clientSkill"===e.actionType){const c=function(e){return t=>{const{clientSkill:n,mockTextStore:a,sessionId:s,currentUserStore:o,currentSpaceViewStore:r,assistantSurface:l}=e,{environment:c}=t;(0,i().u)({environment:c,event:{eventName:"assistant_inline_menu_option_click",eventProperties:{skill_type:n.skillType,from:n.type}}}),function(e){const{environment:t,mockTextStore:n}=e;Q().createAndCommit({userAction:"AssistantWriterActions.clearInputAfterSkillActivate",environment:t,canUndo:!1,perform:e=>{ge().R9({environment:t,store:n,value:void 0,transaction:e})}})}({environment:c,mockTextStore:a}),!(0,f().yH)(n.skillType)&&o&&r&&Q().createAndCommit({userAction:"AssistantWriterActions.saveRecent",environment:c,canUndo:!1,perform:e=>{(0,V().Wq)({transaction:e,environment:c,assistantSessionContext:re().default.getSessionContextOrThrow(s),currentUserStore:o,currentSpaceViewStore:r,fromAssistantSurface:l.type})}})}}({clientSkill:e,mockTextStore:r,sessionId:I,currentUserStore:b,currentSpaceViewStore:v,assistantSurface:t});return(0,se().clientSkillIsType)(e,"translate")?function(e){const{clientSkill:t,intl:n,from:a,themeMode:i,afterAssistantSkillCompletion:r,sessionId:l}=e;if("translate"!==t.skillType)throw new Error("Expected translate skill");const c=(0,m().fS)({includeRtlLanguages:s().default.checkGate({gateName:"editor_basic_rtl"})}).map((({key:e,name:i})=>(0,L().Ls)({clientSkill:t,key:`assistant.translate.${e}`,analyticsName:`Assistant - translate - ${e}`,displayName:i,validators:[],closeParentMenu:!1,right:(0,F().tY)("submitPrompt"),action:async({environment:i})=>{const s=Y().default.state;s&&"assistantCompletionPopup"===s.type&&"initialPrompt"===s.stage&&(await he().triggerAssistantSkillCompletion({environment:i,context:s.context,clientSkillWithParameterValues:{clientSkill:t,parameterValues:{language:e}},intl:n,updater:Y().default.createUpdater(),sessionId:l,from:a,assistantSurfaceType:o().A.isMobile?"mobileWriter":"writer"}),r({environment:i}))}}))),d=(0,L().gy)({key:"translate language actions",render:e=>(0,Z.jsx)(g().A,{...e}),actions:c}),u=()=>(0,Z.jsx)(F().O1,{svg:T().textTranslateIcon,svgFill:(0,oe().vJ)(t.category).color(i).color});return(0,N().u)({clientSkill:t,key:"translate",displayName:oe().Fi.translate,analyticsName:`Assistant - ${t.skillType}`,validators:[],svg:u,subActions:()=>[d]})}({clientSkill:e,intl:n,from:a,themeMode:l.mode,afterAssistantSkillCompletion:c,sessionId:I}):(0,se().clientSkillIsType)(e,"change_tone")?function(e){const{clientSkill:t,intl:n,from:a,themeMode:i,afterAssistantSkillCompletion:s,sessionId:r}=e;if("change_tone"!==t.skillType)throw new Error("Expected change_tone skill");const l=m().$L.map((({key:e,name:i})=>(0,L().Ls)({clientSkill:t,key:`assistant.changeTone.${e}`,analyticsName:`Assistant - changeTone - ${e}`,displayName:i,validators:[],closeParentMenu:!1,right:(0,F().tY)("submitPrompt"),action:async({environment:i})=>{const l=Y().default.state;l&&"assistantCompletionPopup"===l.type&&"initialPrompt"===l.stage&&(await he().triggerAssistantSkillCompletion({environment:i,context:l.context,clientSkillWithParameterValues:{clientSkill:t,parameterValues:{tone:e}},intl:n,updater:Y().default.createUpdater(),sessionId:r,from:a,assistantSurfaceType:o().A.isMobile?"mobileWriter":"writer"}),s({environment:i}))}}))),c=(0,L().gy)({key:"changeTone actions",render:e=>(0,Z.jsx)(g().A,{...e}),actions:l}),d=()=>(0,Z.jsx)(F().O1,{svg:C().l,svgFill:(0,oe().vJ)(t.category).color(i).color});return(0,N().u)({clientSkill:t,key:"changeTone",displayName:oe().Fi.changeTone,analyticsName:`Assistant - ${t.skillType}`,validators:[],svg:d,subActions:()=>[c]})}({clientSkill:e,intl:n,from:a,themeMode:l.mode,afterAssistantSkillCompletion:c,sessionId:I}):(0,L().Ls)({clientSkill:e,key:e.skillType,analyticsName:`Completions - ${e.skillType}`,displayName:Me.writerGlobalSkill,displayNameInterpolatedValues:{displayName:n.formatMessage(e.displayName),acceptsParameters:(0,f().yH)(e.skillType)||(0,f().SH)(e.skillType)},validators:[],closeParentMenu:!1,svg:()=>(0,Z.jsx)(F().O1,{svg:e.icon,svgFill:(0,oe().vJ)(e.category).color(l.mode).color}),right:(0,F().tY)("submitPrompt"),action:async({environment:t})=>{const i=Y().default.state;i&&"assistantCompletionPopup"===i.type&&"initialPrompt"===i.stage&&(await he().triggerAssistantSkillCompletion({environment:t,context:i.context,clientSkillWithParameterValues:(0,se().dangerouslyCreateClientSkillWithParameterValues)(e),intl:n,updater:Y().default.createUpdater(),sessionId:I,from:a,assistantSurfaceType:o().A.isMobile?"mobileWriter":"writer"}),c({environment:t}))}})}if("assistant_session_starter"===e.actionType)return function(e){const{surfaceAction:t}=e,n=t.type;if("recent"===n)return function(e){const{surfaceAction:t,assistantRecentData:n,environment:a,intl:i,theme:s,spaceStore:r,currentSpaceViewStore:l,currentUserSettingsStore:c,from:d,mockTextStore:u}=e,p={validators:[],closeParentMenu:!1,right:Ne({surfaceAction:t,currentSpaceViewStore:l,currentUserSettingsStore:c})},g=()=>{Q().createAndCommit({userAction:"AssistantWriterActions.bumpRecent",environment:a,canUndo:!0,perform:e=>{(0,V().SW)({id:t.id,currentSpaceViewStore:l,transaction:e})}})};if("human_step_only"===n.type)return(0,L().Ls)({key:t.id,analyticsName:"Assistant Recents",displayName:void 0,contextualDisplayName:()=>(0,de().r4)(n.initialHumanStep,r),userProvidedSearchName:Ue(n.initialHumanStep,r),renderTooltip:()=>Ue(n.initialHumanStep,r),tooltipPlacement:"left",svg:()=>(0,Z.jsx)(F().O1,{svg:w().pencilLineIcon,svgFill:(0,oe().vJ)("recent").color(s.mode).color}),action:async({environment:e})=>{const a=Y().default.state;a&&"assistantCompletionPopup"===a.type&&"initialPrompt"===a.stage&&(E().n4(u.getValue(),n.initialHumanStep)?(Le({environment:e,mockTextStore:u,type:t.type}),await he().triggerHumanStepCompletion({environment:e,context:a.context,humanText:n.initialHumanStep,intl:i,updater:Y().default.createUpdater(),sessionId:a.sessionId,from:d,assistantSurfaceType:o().A.isMobile?"mobileWriter":"writer",skillCategoryOverride:"recent"})):Q().createAndCommit({userAction:"AssistantWriterActions.triggerRecent.humanStepOnly",environment:e,canUndo:!0,perform:t=>{Y().default.setState({...a,skillCategoryOverride:"recent"}),ge().R9({environment:e,store:u,value:n.initialHumanStep,transaction:t}),(0,me().z)({store:u})}}),g())},...p});if("skill_only"===n.type){const e=(0,se().createClientParameterValuesSkill)(n.skill.skillType,n.skill.parameterValues),c=(0,W().ho)({sidebarSpaceStore:r,environment:a,clientSkill:e,intl:i,theme:s});if(!c)return;const m=(0,W().wp)({sidebarSpaceStore:l.getSpaceStore(),environment:a,theme:s,clientSkill:e,intl:i}),h=m?()=>m:void 0;return(0,L().Ls)({clientSkill:e,key:t.id,analyticsName:`Assistant Recents - ${e.skillType}`,contextualDisplayName:()=>c,displayName:Me.writerGlobalSkill,displayNameInterpolatedValues:{displayName:i.formatMessage(e.displayName),acceptsParameters:(0,f().yH)(e.skillType)||(0,f().SH)(e.skillType)},renderTooltip:h,tooltipPlacement:"left",svg:()=>(0,Z.jsx)(F().O1,{svg:e.icon,svgFill:(0,oe().vJ)(e.category).color(s.mode).color}),action:async({environment:n})=>{const a=Y().default.state;a&&"assistantCompletionPopup"===a.type&&"initialPrompt"===a.stage&&(Le({environment:n,mockTextStore:u,type:t.type}),await he().triggerAssistantSkillCompletion({environment:n,context:a.context,clientSkillWithParameterValues:{clientSkill:e,parameterValues:e.parameterValues},intl:i,updater:Y().default.createUpdater(),sessionId:a.sessionId,from:d,assistantSurfaceType:o().A.isMobile?"mobileWriter":"writer",skillCategoryOverride:"recent"}),g())},...p})}if("skill_with_human_step"===n.type){const e=(0,se().createClientParameterValuesSkill)(n.skill.skillType,n.skill.parameterValues);return(0,L().Ls)({clientSkill:e,key:t.id,analyticsName:`Assistant Recents with human step - ${e.skillType}`,contextualDisplayName:()=>(0,Z.jsxs)("span",{children:[i.formatMessage(e.displayName)," ",(0,Z.jsx)("span",{style:{display:"inline",color:s.text.secondary,overflow:"auto",textOverflow:"ellipsis"},children:(0,de().r4)(n.initialHumanStep,r)})]}),displayName:Me.writerWithHumanStepSkill,displayNameInterpolatedValues:{displayName:i.formatMessage(e.displayName),humanStep:(0,de().r4)(n.initialHumanStep,r)},userProvidedSearchName:Ue(n.initialHumanStep,r),renderTooltip:()=>Ue(n.initialHumanStep,r),tooltipPlacement:"left",svg:()=>(0,Z.jsx)(F().O1,{svg:e.icon,svgFill:(0,oe().vJ)(e.category).color(s.mode).color}),action:async({environment:t})=>{const a=Y().default.state;if(!a||"assistantCompletionPopup"!==a.type||"initialPrompt"!==a.stage)return;const s={environment:t,context:a.context,clientSkillWithParameterValues:{clientSkill:e,parameterValues:e.parameterValues},intl:i,updater:Y().default.createUpdater(),sessionId:a.sessionId,from:d,assistantSurfaceType:o().A.isMobile?ce().wy.mobileWriter.type:ce().wy.writer.type,skillCategoryOverride:"recent"};await he().triggerAssistantSkillCompletion(s),Q().createAndCommit({userAction:"AssistantWriterActions.triggerRecent.skillWithHumanStep",environment:t,canUndo:!0,perform:e=>{Y().default.setState({...a,skillCategoryOverride:"recent"}),ge().R9({environment:t,store:u,value:n.initialHumanStep,transaction:e}),(0,me().z)({store:u})}}),g()},...p})}(0,R().HB)(n)}({...e,surfaceAction:t,assistantRecentData:t.data});if("favorite"===n)return function(e){const{surfaceAction:t,assistantFavoriteData:n,environment:a,intl:i,theme:s,spaceStore:r,currentSpaceViewStore:l,currentUserSettingsStore:c,from:d,mockTextStore:u}=e,p={validators:[],closeParentMenu:!1,right:Ne({surfaceAction:t,currentSpaceViewStore:l,currentUserSettingsStore:c})};if("human_step_only"===n.type)return(0,L().Ls)({key:t.id,analyticsName:"Assistant Favorites",displayName:void 0,contextualDisplayName:()=>n.name??(0,de().r4)(n.initialHumanStep,r),userProvidedSearchName:Ue(n.initialHumanStep,r),renderTooltip:()=>Ue(n.initialHumanStep,r),tooltipPlacement:"left",svg:()=>(0,Z.jsx)(F().O1,{svg:w().pencilLineIcon,svgFill:(0,oe().vJ)("favorite").color(s.mode).color}),action:async({environment:e})=>{const a=Y().default.state;a&&"assistantCompletionPopup"===a.type&&"initialPrompt"===a.stage&&(n.executeImmediately||E().n4(u.getValue(),n.initialHumanStep)?(Le({environment:e,mockTextStore:u,type:t.type}),await he().triggerHumanStepCompletion({environment:e,context:a.context,humanText:n.initialHumanStep,intl:i,updater:Y().default.createUpdater(),sessionId:a.sessionId,from:d,assistantSurfaceType:o().A.isMobile?"mobileWriter":"writer",skillCategoryOverride:"favorite"})):Q().createAndCommit({userAction:"AssistantWriterActions.triggerFavorite.humanStepOnly",environment:e,canUndo:!0,perform:t=>{Y().default.setState({...a,skillCategoryOverride:"favorite"}),ge().R9({environment:e,store:u,value:n.initialHumanStep,transaction:t}),(0,me().z)({store:u})}}))},...p});if("skill_only"===n.type){const e=(0,se().createClientParameterValuesSkill)(n.skill.skillType,n.skill.parameterValues),c=(0,W().ho)({sidebarSpaceStore:r,environment:a,clientSkill:e,intl:i,theme:s});if(!c)return;const g=(0,W().wp)({sidebarSpaceStore:l.getSpaceStore(),environment:a,theme:s,clientSkill:e,intl:i}),m=g?()=>g:void 0;return(0,L().Ls)({clientSkill:e,key:t.id,analyticsName:`Assistant Favorites - ${e.skillType}`,contextualDisplayName:()=>c,displayName:Me.writerGlobalSkill,displayNameInterpolatedValues:{displayName:i.formatMessage(e.displayName),acceptsParameters:(0,f().yH)(e.skillType)||(0,f().SH)(e.skillType)},renderTooltip:m,tooltipPlacement:"left",svg:()=>(0,Z.jsx)(F().O1,{svg:e.icon,svgFill:(0,oe().vJ)(e.category).color(s.mode).color}),action:async({environment:n})=>{const a=Y().default.state;a&&"assistantCompletionPopup"===a.type&&"initialPrompt"===a.stage&&(Le({environment:n,mockTextStore:u,type:t.type}),await he().triggerAssistantSkillCompletion({environment:n,context:a.context,clientSkillWithParameterValues:{clientSkill:e,parameterValues:e.parameterValues},intl:i,updater:Y().default.createUpdater(),sessionId:a.sessionId,from:d,assistantSurfaceType:o().A.isMobile?"mobileWriter":"writer",skillCategoryOverride:"favorite"}))},...p})}if("skill_with_human_step"===n.type){const e=(0,se().createClientParameterValuesSkill)(n.skill.skillType,n.skill.parameterValues);return(0,L().Ls)({clientSkill:e,key:t.id,analyticsName:`Assistant Favorites with human step - ${e.skillType}`,contextualDisplayName:()=>(0,Z.jsxs)("span",{children:[i.formatMessage(e.displayName)," ",(0,Z.jsx)("span",{style:{display:"inline",color:D().Tj.text.secondary,overflow:"auto",textOverflow:"ellipsis"},children:(0,de().r4)(n.initialHumanStep,r)})]}),displayName:Me.writerWithHumanStepSkill,displayNameInterpolatedValues:{displayName:i.formatMessage(e.displayName),humanStep:(0,de().r4)(n.initialHumanStep,r)},userProvidedSearchName:Ue(n.initialHumanStep,r),renderTooltip:()=>Ue(n.initialHumanStep,r),tooltipPlacement:"left",svg:()=>(0,Z.jsx)(F().O1,{svg:e.icon,svgFill:(0,oe().vJ)(e.category).color(s.mode).color}),action:async({environment:a})=>{const s=Y().default.state;if(!s||"assistantCompletionPopup"!==s.type||"initialPrompt"!==s.stage)return;const r={environment:a,context:s.context,clientSkillWithParameterValues:{clientSkill:e,parameterValues:e.parameterValues},intl:i,updater:Y().default.createUpdater(),sessionId:s.sessionId,from:d,assistantSurfaceType:o().A.isMobile?ce().wy.mobileWriter.type:ce().wy.writer.type,skillCategoryOverride:"favorite"};n.executeImmediately?(Le({environment:a,mockTextStore:u,type:t.type}),await he().triggerAssistantSkillCompletion({...r,immediatelyCommitHumanText:n.initialHumanStep})):(await he().triggerAssistantSkillCompletion(r),Q().createAndCommit({userAction:"AssistantWriterActions.triggerFavorite.skillWithHumanStep",environment:a,canUndo:!0,perform:e=>{Y().default.setState({...s,skillCategoryOverride:"favorite"}),ge().R9({environment:a,store:u,value:n.initialHumanStep,transaction:e}),(0,me().z)({store:u})}}))},...p})}(0,R().HB)(n)}({...e,surfaceAction:t,assistantFavoriteData:t.data});(0,R().HB)(n)}({environment:x,intl:n,theme:l,spaceStore:y,currentSpaceViewStore:v,currentUserSettingsStore:S,from:a,surfaceAction:e,mockTextStore:r});if("arbitrary"===e.actionType)throw new Error("This action type is not supported in Writer.");(0,R().HB)(e)})));"recent"===e&&(h=function(e,t,n=5){const a=[];if(a.push(...e.slice(0,n)),e.length>n){const i=(0,L().gy)({key:`${t} more`,render:e=>(0,Z.jsx)(g().A,{...e}),actions:e.slice(n)});a.push((0,N().u)({key:"more",displayName:F().DZ.more,analyticsName:`assistant - ${t} - more`,validators:[],svg:()=>(0,Z.jsx)(F().Z4,{}),subActions:()=>[i],collapseSubActionsIntoParent:!0,width:350}))}return a}(h,e));const M=(0,L().gy)({key:e,title:c,render:e=>(0,Z.jsx)(g().A,{...e}),actions:h});return M})))}({intl:p,from:d,mockTextStore:l,theme:a,assistantSurface:t,assistantSuggestionContext:A,dedupeAcrossSkillSections:!0,suggestedSectionSkills:_,favorites:G,recents:J,spaceStore:H,currentSpaceViewStore:ee,currentUserSettingsStore:K,currentUserStore:q,environment:n,sessionId:c.sessionId});else if("results"===c.stage){if(Se=c.loading?[]:ve?ze({aiUsageAvailability:ne,upgradeEligibility:ae,isUpgradeSystemEnabled:ye,upgradeAction:pe,spaceStore:H}):function(e){const{environment:t,resultHandlers:n,shouldShowLimitedQnaUpsell:a,currentPageStore:i,spaceStore:s,aiUsageAvailability:o,upgradeEligibility:r,upgradeAction:l,isUpgradeSystemEnabled:c}=e,d=x().checkmarkIcon,u=(0,le().K1)();if(!u)return[];const p=u.sampledStepsFromStoreState.length>0,m=u.getAllPendingExecutableOperations().length>0,f=u.temporaryClientStepsFromStoreState.findLast(h().ON),v=(0,fe().tk)({sessionContext:u,currentPageStore:i}),S=!m&&f||m&&v?{key:"insert",analyticsName:_e,displayName:Me.insert,validators:[],closeParentMenu:!0,svg:k().N,action(){!m&&f?n.onInsert({chatStep:f}):m&&(0,R().O9)(v)&&n.onInsertBlockSuggestions({targetBlockStore:v})}}:void 0,I=X().zD.isReplaceSelectionEnabled()&&!m&&f&&(0,O().Jw)({assistantSelection:u.evaluatorFromStoreState.state.getAssistantSelectionIfExists()})?{key:"replace_selection",analyticsName:_e,displayName:Me.replace,validators:[],closeParentMenu:!0,svg:y().a,action(){n.onReplace({chatStep:f})}}:void 0,w=(0,ue().h)(t);return p?m?[(0,L().gy)({key:"main",render:e=>(0,Z.jsx)(g().A,{...e}),actions:E().oE([(0,L().Ls)({key:"keep",analyticsName:_e,displayName:Me.accept,validators:[],closeParentMenu:!0,svg:d,action(){n.onAccept({exitType:"accept"}),z().assistantAnalyticsActions.trackAcceptAllPill(t,{sessionId:u.sessionIdFromStoreState,from:"writer",inferenceId:u.latestCommitInferenceIdFromStoreState})}}),(0,L().Fw)({key:"close",analyticsName:_e,displayName:Me.delete,validators:[],closeParentMenu:!0,svg:j().xMarkIcon,shortcuts:["esc"],action(e,a){n.onCancel({showDiscardModal:!1}),z().assistantAnalyticsActions.trackDiscardAllPill(t,{sessionId:u.sessionIdFromStoreState,from:"writer",inferenceId:u.latestCommitInferenceIdFromStoreState})}}),S?(0,L().Ls)(S):void 0,(0,L().Ls)({key:"tryAgain",analyticsName:_e,displayName:Me.tryAgain,validators:[],closeParentMenu:!1,svg:b().arrowUTurnUpLeftIcon,action(){n.onRetry()}})])}),...Oe({shouldShowLimitedQnaUpsell:a,isUpgradeSystemEnabled:c,upgradeEligibility:r,aiUsageAvailability:o,upgradeAction:l,isWorkspaceOwner:w,spaceStore:s})]:[(0,L().gy)({key:"main",render:e=>(0,Z.jsx)(g().A,{...e}),actions:E().oE([S?(0,L().Ls)(S):void 0,I?(0,L().Ls)(I):void 0,(0,L().Ls)({key:"tryAgain",analyticsName:_e,displayName:Me.tryAgain,validators:[],closeParentMenu:!1,svg:b().arrowUTurnUpLeftIcon,action(){n.onRetry()}}),(0,L().Fw)({key:"close",analyticsName:_e,displayName:Me.close,validators:[],closeParentMenu:!0,svg:j().xMarkIcon,shortcuts:["esc"],action(){n.onCancel({showDiscardModal:!1})}})])}),...Oe({shouldShowLimitedQnaUpsell:a,isUpgradeSystemEnabled:c,upgradeEligibility:r,upgradeAction:l,aiUsageAvailability:o,isWorkspaceOwner:w,spaceStore:s})]:[]}({environment:n,resultHandlers:v,shouldShowLimitedQnaUpsell:I,currentPageStore:P,spaceStore:H,aiUsageAvailability:ne,upgradeEligibility:ae,upgradeAction:pe,isUpgradeSystemEnabled:ye}),o().A.isMobile)return Se}else if("editing"===c.stage){if(o().A.isMobile)return[];Se=Ae({environment:n,currentUserSettingsStore:K,currentSpaceViewStore:ee,mockTextStore:l})}else(0,R().HB)(c);if("editing"!==c.stage){const e=(0,B().js)({sections:Se,context:u,query:r});return function(e){return e.length>0&&void 0===e.find((e=>"favorite"!==e.key&&"recent"!==e.key))}(e)&&e.unshift((0,L().gy)({key:"send_current_input_escape_hatch",render:e=>(0,Z.jsx)(g().A,{...e}),actions:[De({mockTextStore:l,handleSubmit:te,spaceStore:H})]})),e}return Se}function Re(e){const{focused:t}=e,{isPhone:n}=(0,r().Y0)();return(0,c().IS)((()=>({buttonStyle:{display:"grid",placeItems:"center",width:22,height:22,borderRadius:22},containerStyle:{display:"grid",gridAutoFlow:"column",placeItems:"center",gap:4,opacity:!n&&t?1:0}})),[t,n])}function Be(e){const{focused:t,recent:n,currentSpaceViewStore:s}=e,o=(0,r().v3)(),l=(0,a.useCallback)((()=>{Q().createAndCommit({userAction:"ai.assistantSessionStarterAction.favoriteRecentAction",environment:o,canUndo:!0,perform(e){(0,V().Uj)({id:n.id,currentSpaceViewStore:s,transaction:e}),(0,i().u)({environment:o,event:{eventName:"assistant_writer_saved_favorite_from_recent",eventProperties:{recent_id:n.id}}})}})}),[o,n.id,s]),c=Re({focused:t});return(0,Z.jsxs)("div",{style:c.containerStyle,children:[(0,Z.jsx)(d().Ay,{onClick:l,disallowTabbing:!0,style:c.buttonStyle,disabled:!t,children:(0,Z.jsx)(p().I,{icon:A().f,size:"xs",colorVariant:"secondary"})}),(0,Z.jsx)(u().A,{stopClickPropagation:!0,renderOrigin:({onClick:e})=>(0,Z.jsx)(d().Ay,{onClick:e,disallowTabbing:!0,style:c.buttonStyle,disabled:!t,children:(0,Z.jsx)(p().I,{icon:I().ellipsisSmallIcon,size:"xs",colorVariant:"secondary"})}),popupType:u().z.Popup,render:()=>(0,Z.jsx)(ae,{recent:n,currentSpaceViewStore:s}),placementToOrigin:"bottom",alignmentToOrigin:"start"}),(0,Z.jsx)(p().I,{icon:S().arrowTurnDownLeftSmallIcon,size:"xs",colorVariant:"secondary"})]})}function Fe(e){const{focused:t,favorite:n,currentSpaceViewStore:i,currentUserSettingStore:s}=e,o=Re({focused:t}),r=(0,a.useMemo)((()=>(0,Z.jsx)(u().A,{stopClickPropagation:!0,renderOrigin:({onClick:e})=>(0,Z.jsx)(d().Ay,{onClick:e,disallowTabbing:!0,style:o.buttonStyle,disabled:!t,children:(0,Z.jsx)(p().I,{icon:I().ellipsisSmallIcon,size:"xs",colorVariant:"secondary"})}),popupType:u().z.Popup,render:()=>(0,Z.jsx)(te,{favorite:n,currentSpaceViewStore:i,currentUserSettingStore:s}),placementToOrigin:"bottom",alignmentToOrigin:"start"})),[i,s,n,t,o.buttonStyle]);return(0,Z.jsxs)("div",{style:o.containerStyle,children:[r,(0,Z.jsx)(p().I,{icon:S().arrowTurnDownLeftSmallIcon,size:"xs",colorVariant:"secondary"})]})}function Ne(e){const{surfaceAction:t,currentSpaceViewStore:n,currentUserSettingsStore:a}=e,i=t.type;return"recent"===i?function(e){const{recent:t,currentSpaceViewStore:n}=e;return function(e,a,i){return(0,Z.jsx)(Be,{focused:e.focused,recent:t,currentSpaceViewStore:n})}}({recent:t,currentSpaceViewStore:n}):"favorite"===i?function(e){const{favorite:t,currentSpaceViewStore:n,currentUserSettingsStore:a}=e;return function(e,i,s){return(0,Z.jsx)(Fe,{focused:e.focused,favorite:t,currentSpaceViewStore:n,currentUserSettingStore:a})}}({favorite:t,currentSpaceViewStore:n,currentUserSettingsStore:a}):void(0,R().HB)(i)}function Le(e){const{environment:t,mockTextStore:n,type:a}=e;let i;"favorite"===a?i="AssistantWriterActions.clearInputBeforeFavoriteSkillActivate":"recent"===a?i="AssistantWriterActions.clearInputBeforeRecentSkillActivate":(0,R().HB)(a),Q().createAndCommit({userAction:i,environment:t,canUndo:!0,perform:e=>{ge().R9({environment:t,store:n,value:void 0,transaction:e})}})}function Oe(e){return e.shouldShowLimitedQnaUpsell?e.isUpgradeSystemEnabled?function(e){const{upgradeEligibility:t,aiUsageAvailability:n,spaceStore:a}=e;if("not_eligible"===t.status||"request_pending"===t.status)return[];return[(0,L().gy)({key:"upsell",render:e=>(0,Z.jsx)(g().A,{...e}),actions:[(0,L().Ls)({key:"upgrade",analyticsName:"assistant_writer_upgrade_limited_qna",displayName:void 0,validators:[],closeParentMenu:!0,render:e=>(0,Z.jsx)(Ve,{menuItemProps:e,aiUsageAvailability:n,spaceStore:a}),action(){}})]})]}(e):function(e){const{isWorkspaceOwner:t,upgradeAction:n}=e;return[(0,L().gy)({key:"upsell",render:e=>(0,Z.jsx)(g().A,{...e}),actions:E().oE([(0,L().Ls)({key:"upsell",analyticsName:"assistant_writer_upsell_limited_qna",displayName:t?Me.upsell:Me.requestAccess,validators:[],closeParentMenu:!1,svg:v().arrowInCircleUpFillIcon,svgCustomFill:()=>D().Tj.blue.icon.accentPrimary,action(){n()}})])})]}(e):[]}function Ve(e){const{menuItemProps:t,aiUsageAvailability:n,spaceStore:i}=e,s=a.useRef(null);return(0,Z.jsx)("div",{ref:s,children:(0,Z.jsx)(pe().N,{source:"ai_limited_qna_upsell_action_button",upsell:null==n?void 0:n.upsell,title:({upgradeLabel:e})=>e,buttonMenuItemProps:t,hoverRef:s,display:"text",featureName:"ai_usage",spaceStore:i})})}function ze(e){const{aiUsageAvailability:t,upgradeEligibility:n,upgradeAction:a,isUpgradeSystemEnabled:i,spaceStore:s}=e;if(i)return"not_eligible"===n.status||"request_pending"===n.status?[]:[(0,L().gy)({key:"main",render:e=>(0,Z.jsx)(g().A,{...e}),actions:[(0,L().Ls)({key:"upgrade",analyticsName:"assistant_writer_upgrade",displayName:void 0,validators:[],closeParentMenu:!0,render:e=>(0,Z.jsx)(Ve,{menuItemProps:e,aiUsageAvailability:t,spaceStore:s}),action(){}})]})];let o=[];return o="not_eligible"===n.status||"request_pending"===n.status?[]:[(0,L().gy)({key:"main",render:e=>(0,Z.jsx)(g().A,{...e}),actions:E().oE([(0,L().Ls)({key:"upsell",analyticsName:"assistant_writer_upsell",displayName:Me.upsell,validators:[],closeParentMenu:!0,svg:v().arrowInCircleUpFillIcon,svgCustomFill:()=>D().Tj.blue.icon.accentPrimary,action(){a()}})])})],o}const We=1e3;function Ue(e,t){return(0,de().r4)(e,t).slice(0,We)}},611491:(e,t,n)=>{n.d(t,{MC:()=>y,N7:()=>f});n(16280),n(581454);var a=n(296540),i=()=>n(907258),s=()=>n(484714),o=()=>n(590526),r=()=>n(187174),l=()=>n(206267),c=()=>n(785728),d=()=>n(999752),u=()=>n(532659),p=()=>n(496603),g=()=>n(769864),m=n(474848);const h=(0,a.createContext)(void 0);function f({xmlMode:e,children:t}){const[n,i]=(0,a.useReducer)(((e,t)=>({...e,[t.str]:t.translation})),{}),s=(0,a.useMemo)((()=>({translationCache:n,addToTranslationCache:i,xmlMode:e})),[n,i,e]);return(0,m.jsx)(h.Provider,{value:s,children:t})}function y(e){const{getTranslatableStrings:t}=e,n=(0,s().v3)(),m=(0,a.useContext)(h);if(!m)throw Error("TranslationContext is required - please wrap the component using useAITranslations in a TranslationProvider");const{translationCache:f,addToTranslationCache:y,xmlMode:v}=m,S=(0,a.useCallback)((e=>f[e]),[f]),b=(0,a.useCallback)((e=>{y(e)}),[y]),x=(0,a.useRef)([]);(0,a.useEffect)((()=>{x.current=Object.keys(f)}),[f]);const I=(0,o().K8)((()=>{var e;return null===(e=i().default.state.currentUserRootStore)||void 0===e||null===(e=e.getSpaceViewStores())||void 0===e||null===(e=e[0])||void 0===e?void 0:e.getSpaceStore()}),[]),[k]=(0,r().Yb)((async()=>{const e=p().R9((null==t?void 0:t())??[],x.current);if(!I)return;await d().O.map(5,e,(async e=>{const t=await g().callStreamApi({eventName:"getCompletion",environment:n,data:{id:l().JW(),context:{type:"aiJsonTranslate",text:e,textOnly:!v},aiSessionId:l().JW(),model:"openai-gpt-4o-mini",spaceId:I.id,isSpacePermission:!0,inferenceReason:"eval",attributionForLogging:void 0,metadata:{}},headers:(0,c().WS)({spaceId:I.id})});if("success"!==t.type)return;let a="";if(u().hS.is(t.data))for await(const n of t.data){if("success"!==n.type)return;a+=n.completion}a=a.trim(),b({str:e,translation:a})}))}),[n,t,b,v,I]);return(0,a.useMemo)((()=>({getTranslationForString:S,isLoading:"pending"===k.status,handleAddTranslation:b})),[k.status,S,b])}h.displayName="AITranslationContext"},612320:(e,t,n)=>{n.d(t,{k:()=>i});var a=n(296540);n(898992),n(672577);function i({requests:e,feature:t,userId:n}){const[i,s]=(0,a.useState)("loading");return(0,a.useEffect)((()=>{if(!t)return;const a=function(e,t,n){var a;if(!t||!n)return"unrequested";const i=null===(a=t[e])||void 0===a?void 0:a.find((e=>e.created_by_id===n));return i&&i.request_status||"unrequested"}(t,e,n);s(a)}),[e,t,n]),[i,s]}},614818:(e,t,n)=>{n.d(t,{d:()=>w,c:()=>k});var a=n(296540),i=()=>n(726637),s=()=>n(17022),o=()=>n(221844),r=()=>n(484714),l=()=>n(79926),c=()=>n(201980),d=()=>n(884107),u=()=>n(108184),p=()=>n(485601),g=()=>n(43893),m=()=>n(659602),h=()=>n(335722),f=()=>n(687249),y=()=>n(911676),v=()=>n(534177),S=()=>n(854227);function b(e){return t=>{(0,S().lB)(t),(0,S().WD)(t),(0,S().GU)(t),function(e,t){(0,S().jg)({md:e,name:"user_uri",regex:(0,f().Xh)(),createTokens(e,n){let a;try{a=(0,f().Mg)(e,t)}catch(i){return}switch(a.type){case"user":return function(e,t,n){return[{type:"agent_uri_open",tag:"a",level:e+1,attrs:n},{type:"text",content:t},{type:"agent_uri_close",tag:"/a",level:e}]}(n,"user",{[y().lc[c().Ifu.User]]:a.userId});case"pageOrCollectionViewBlock":case"collection":case"collectionProperty":case"collectionPropertyOption":case"integration":case"view":case"formulaResult":case"formulaCode":case"notification":case"discussion":case"pageDiscussions":case"trigger":case"script":case"slackUser":case"slackMessage":case"slackChannel":case"agent":case"thread":case"file":case"webpage":case"worker":case"citation":case"snapshot":return;default:(0,v().HB)(a)}}})}(t,e)}}var x=()=>n(547149),I=n(474848);function k(e){const{step:t}=e;return(0,I.jsx)(w,{markdown:t.value})}function w(e){const{markdown:t,style:n}=e,f=(0,r().v3)(),y=(0,l().fJ)(m().g),v=(0,l().fJ)(h().S),{value:S}=(0,l().fJ)(d().R.clipboardActions),k=(0,a.useMemo)((()=>{if(!t||!S)return;if(["idle","pending"].includes(y.status)||["idle","pending"].includes(v.status))return;const e=i().A.domainBaseUrl,n=i().A.publicDomainName;return s().e.withListenerIgnored((()=>{const a=new(o().A)({name:"AIChatTranscript.MarkdownChatStep",isTemporaryData:!0,isSyntheticAssistantData:!0}),i=c().xV3(t),s=x().createAndCommit({userAction:"AIChatTranscript.MarkdownChatStep.markdownToBlocks",environment:f,canUndo:!1,perform:t=>{const s=S.markdownToBlocks({environment:f,text:i,inMemoryRecordCache:a,transaction:t,markdownOptions:(o={baseUrl:e,publicDomainName:n},{plugin:b(o)}),markdownLinkifyIt:y.value,tinyMceMicrosoftWordPasteFilter:v.value,ignoreImages:!0});var o;if(s)return(0,u().postProcessAICreatedStores)(f,s),(0,u().wrapTemporaryBlocksInList)({environment:f,stores:s,inMemoryRecordCache:a,transaction:t})}}).performResult;return a.addCacheFallback(f.defaultRecordCache.inMemoryRecordCache),s}))}),[t,f,y,v,S]);return k?(0,I.jsx)(p().c,{displayName:"AIChatTranscript.MarkdownChatStep",disabled:!0,style:n,children:(0,I.jsx)(g().A,{store:k,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0})}):null}},615304:(e,t,n)=>{function a(){return"chat"}n.d(t,{m:()=>a})},615927:(e,t,n)=>{n.d(t,{Ay:()=>u,P6:()=>d,l1:()=>c});n(296540);var a=()=>n(401497),i=()=>n(718827),s=()=>n(406094),o=()=>n(100622),r=()=>n(284371),l=n(474848);const c=16;function d(e){const t=(0,a().IS)((()=>({button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[]);return(0,l.jsx)(i().Ay,{style:t.button,onClick:e.onClick,children:e.children})}const u=function(e){const{title:t,description:n,icon:i,style:d,titleStyle:u,buttonText:p,buttonOnClick:g,buttonIcon:m,secondaryButtonText:h,secondaryButtonOnClick:f}=e,y=(0,a().IS)((()=>({wrapper:{minHeight:250,height:1,display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center",gap:4,padding:c,...d},title:{fontSize:16,fontWeight:r().Wy.medium,color:o().Tj.text.tertiary,textAlign:"center",marginBottom:-2,...u},description:{margin:"0 auto",textAlign:"center",fontSize:14,color:o().Tj.text.tertiary},button:{marginTop:12,fontSize:14,fontWeight:r().Wy.medium,color:o().Tj.text.primary}})),[d,u]);return(0,l.jsxs)("div",{style:y.wrapper,children:[i,(0,l.jsx)("div",{style:y.title,children:t}),n?(0,l.jsx)("div",{style:y.description,children:n}):void 0,p?(0,l.jsx)(s().A,{size:"lg",onClick:g,style:y.button,iconLeading:m?{icon:m,size:"xs"}:void 0,children:p}):void 0,h?(0,l.jsx)(s().A,{size:"lg",onClick:f,style:y.button,children:h}):void 0]})}},622595:(e,t,n)=>{n.d(t,{X:()=>p});n(18107),n(813451),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(967357),n(898992),n(354520),n(581454),n(908872),n(737550);var a=()=>n(412412),i=()=>n(457726),s=()=>n(832443),o=()=>n(680325),r=()=>n(520937),l=()=>n(412669),c=()=>n(600881),d=()=>n(140022);function u(e,t){const n=e.findIndex((e=>"human"===e.type));if(-1===n)return[];const a=("before"===t?e.slice(0,n):e.slice(n+1)).filter((e=>"observation"===e.type)).map((e=>e.observationType));return[...new Set(a)]}function p(e){var t;const{environment:n,assistantSessionContext:p,inferenceId:g,timeTook:m,parentStore:h,transcript:f,from:y,forcefullyStoppedByUser:v,skillType:S,wasSkillSuggested:b,selectedSkillCategoryOverride:x}=e,I=p.getCombinedSteps(),k=I.at(-1),w=function(e){const{combinedSteps:t,transcript:n,forcefullyStoppedByUser:a}=e;return l().K.state||t.some((e=>"assistantLimitReached"===e.type))?"payment_error":n.some((e=>"observation"===e.type&&"error"===e.observationType))||a?"error":"success"}({combinedSteps:I,transcript:f,forcefullyStoppedByUser:Boolean(v)}),C=I.filter(i().N).map((e=>e.searchResults)).flat().map((e=>{const t=s().tD.parseAssistantHref(e);return void 0===t||"block"===t.type||"database_query_results"===t.type||"citation_unsupported"===t.type?e:t.type}));let A,T;if("assistantChat"===(null==k?void 0:k.type)){const{pageCitations:e,databaseCitations:t,universalCitations:n}=(0,o().Q_)({clientStep:k,citationOrdering:void 0,parentStore:h});A=e.length+t.length+n.length;const a=n.reduce(((e,t)=>(e[t.type]=(e[t.type]||0)+1,e)),{});T={page:e.length,database:t.length,...a}}const{numSearchResults:j,numSlackSearchResults:M,numGoogleDriveSearchResults:_,resultsBySource:P,searchedHelpdocs:D}=(0,c().RP)(I),E=null===(t=p.selectedSkillFromStoreState)||void 0===t?void 0:t.clientSkill.skillType,R=p.actionCardIdForLoggingFromStoreState,B=function(e){const t=e.findLastIndex((e=>"human"===e.type)),n=e.slice(t+1).filter((e=>"assistant"===e.type)),i=[];if(n)for(const s of n){const e=(0,a().BD)(s.value);for(const t of e)"element"===t.type&&("create-page"===t.tagName&&"in"in t.attributes?i.push("create-page-in-database"):"search"===t.tagName&&"database"in t.attributes?i.push("search-in-database"):i.push(t.tagName))}return[...new Set(i)]}(f);let F=x;void 0===F&&S&&(F=b?"suggested":r().iS[S].category),d().trackInferenceEnd(n,{configurationState:p.assistantConfigurationStoreState,inferenceId:g,timeTook:m,resultIds:C,numCitationsShown:A,numSearchResults:j,numSlackSearchResults:M,numGoogleDriveSearchResults:_,resultsBySource:P,searchedHelpdocs:D,citationsBySource:T,selectedSkill:E,actionCardId:R,assistantActions:B,from:y,observationsAfterFirstHumanStep:u(f,"after"),observationsBeforeFirstHumanStep:u(f,"before"),forcefullyStoppedByUser:Boolean(v),result:w,selectedSkillCategory:F})}},623275:(e,t,n)=>{n.d(t,{$D:()=>u,CJ:()=>m,CY:()=>v,Sg:()=>d,iM:()=>b,kJ:()=>h,kx:()=>y,qj:()=>S,rL:()=>r,sH:()=>f,u6:()=>l,zr:()=>p});var a=()=>n(726637),i=()=>n(278238),s=()=>n(100622),o=()=>n(115512);const r=16,l=20,c=10,d=12,u=456,p=24,g=24,m=48;function h(){return{background:s().Tj.background.tertiaryTranslucent,borderRadius:8,paddingTop:8,paddingBottom:8,paddingInlineStart:8,paddingInlineEnd:8,marginInlineStart:a().A.isMobile?0:r,marginInlineEnd:a().A.isMobile?0:r,marginTop:4,marginBottom:8}}function f(){return{...v(),width:"unset",height:m,paddingTop:6,paddingBottom:6,paddingInlineEnd:6}}function y(){return a().A.isMobile?o().Kw:o().vQ}function v(){return{borderRadius:c,transition:"background 150ms ease-out"}}function S({isMobile:e}){return e?12:10}function b({themeMode:e,colorOverride:t,size:n=g,useLargeBorderRadius:a,useLightBackgroundColor:o,icon:r}){return{background:t||(r&&(0,i().T8)(r)?(0,i().ez)({icon:r,mode:e,useLightGrayColor:o}):s().Tj.border.secondaryTranslucent),width:n,height:n,borderRadius:a?6:"0.25em"}}},624006:(e,t,n)=>{n.d(t,{N:()=>s});var a=()=>n(79926);const i=new(a().O2)("RenameThreadPopup",(async()=>await n.e(42489).then(n.bind(n,968845)))),s=(0,a()._h)(i,(e=>e.RenameThreadPopup))},624652:(e,t,n)=>{n.d(t,{U:()=>j,v:()=>T});var a=n(296540),i=()=>n(564884),s=()=>n(300474),o=()=>n(726637),r=()=>n(484714),l=()=>n(363901),c=()=>n(590526),d=()=>n(128933),u=()=>n(695115),p=()=>n(26697),g=()=>n(609616),m=()=>n(206267),h=()=>n(363497),f=()=>n(449412),y=()=>n(69708),v=()=>n(631611),S=()=>n(429145),b=()=>n(466088),x=()=>n(74831),I=()=>n(44971),k=()=>n(483730),w=()=>n(715142),C=()=>n(515692),A=n(474848);function T(){const e=(0,r().v3)(),t=(0,c().K8)((()=>(0,b().w)(e)),[e]),n=(0,s().r)();return!n||t?null:(0,A.jsx)(M,{currentSpaceId:n})}function j(e){const t=(0,v().jw)(),{currentSpaceId:n,progressOverrides:s,analyticsArgs:o,threadStore:l,workflowId:u}=e,p=(0,c().K8)((()=>{if(null!=s&&s.threadPointer)return s.threadPointer;const e=t.isType("writer")?(0,w().K1)():k().default.getActiveSession();if(!e||!n)return;return I().A.doesSpaceHaveTrackedSession(n,e.sessionIdFromStoreState)?{id:e.sessionIdFromStoreState,spaceId:n,table:h().TF}:void 0}),[t,n,null==s?void 0:s.threadPointer]),g=(0,r().v3)(),y=(0,c().K8)((()=>{if(null!=s&&s.progressStore)return s.progressStore;const e=k().default.getActiveSession();return e?e.getTemporaryAttachmentStagedDataOrInstantiate().stagedAttachmentUploadStore:void 0}),[null==s?void 0:s.progressStore]),{uploadFiles:b,uploadProgress:x}=(0,S().ZR)({threadStore:l,assistantSessionPointer:p,workflowId:u,onError:e=>{d().D6({label:e.message}),null==y||y.onFileUploadFailed({error:e}),f().Fg(e.error,{extra:{err:e},tags:{event:"assistant_attachment_upload_error"}}),(0,i().u)({environment:g,event:{eventName:"assistant_attachment_upload_failed",eventProperties:{message:e.message,code:e.errorCode,offline:e.offline??!1,framework:"inference_transcript",config_type:"workflow",source:"workflows",upload_method:"clicked_attachment_button"}}})},onStart:()=>{},onSuccess:e=>{if(s)s.onSuccess(e);else{const t=k().default.getSessionContextOrThrow(e.assistantSessionId),{stagedAttachmentUploadStore:n}=t.getTemporaryAttachmentStagedDataOrInstantiate(),a=t.evaluatorFromStoreState.createAttachmentObservationStep(e);t.stageAttachmentEngineStep(a);const r={inferenceId:m().JW(),type:"clientAssistantHumanAttachmentUpload",fileData:e};t.stageAttachmentClientStep(r),n.onFileUploadCompleted(e.uploadIdentifier,e),(0,i().u)({environment:g,event:{eventName:"assistant_attachment_upload_successful",eventProperties:{content_type:a.contentType,source:"custom_upload",framework:s?"inference_transcript":"assistant",config_type:null==o?void 0:o.configType}}})}},environment:g,analyticsArgs:o});return(0,a.useEffect)((()=>{void 0!==x&&100!==x.progress&&(null==y||y.onFileUploadPercentageChanged({fileId:x.uniqueFileIdentifier,fileName:x.fileName,percentage:x.progress,contentType:x.contentType}))}),[y,x]),b}function M(e){const{currentSpaceId:t}=e,n=j({currentSpaceId:t}),i=(0,a.useCallback)((async()=>await n({files:void 0,method:"clicked_attachment_button"})),[n]),s=(0,y().tz)(),r=(0,l().A)(!0),c=(0,x().yB)(),d=s.formatMessage({id:"assistantRichTextInput.insertAttachment.button.tooltip",defaultMessage:"{count, plural, one {Attach file} other {Attach files}}"},{count:c});return(0,A.jsx)(p().m,{renderTooltip:()=>d,render:e=>(0,A.jsx)(u().A,{ariaLabel:d,icon:g().o,iconStyle:{width:o().A.isMobile?19:16,height:o().A.isMobile?19:16},style:{marginInlineStart:0,marginInlineEnd:0,width:(0,C().h6)(o().A.isMobile),height:(0,C().h6)(o().A.isMobile)},onClick:i,...e,...r})})}},626466:(e,t,n)=>{n.r(t),n.d(t,{arrowChevronSingleDownFillIcon:()=>i,iconDefinition:()=>a});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"3.72 6.72 12.56 7.16",svg:(0,n(474848).jsx)("path",{d:"M9.38 13.619a.875.875 0 0 0 1.238 0l5.4-5.4a.875.875 0 0 0-1.237-1.238L10 11.763 5.218 6.98a.875.875 0 1 0-1.237 1.24z"})},i=(0,n(340498).wt)("arrowChevronSingleDownFill",a,"fill")},627637:(e,t,n)=>{n.d(t,{A:()=>k,x:()=>w});var a=n(296540),i=()=>n(755531),s=()=>n(484714),o=()=>n(590526),r=()=>n(401497),l=()=>n(574359),c=()=>n(148297),d=()=>n(970236),u=()=>n(406094),p=()=>n(148307),g=()=>n(69708),m=()=>n(100622),h=()=>n(534177),f=()=>n(191197),y=()=>n(72234),v=()=>n(295173),S=()=>n(300789),b=()=>n(51367),x=()=>n(46986),I=n(474848);const k=(0,g().YK)({primedTextInput:{id:"assistant.universalQna.slackConnectedNotificationTooltip.tryItPrimedInput",defaultMessage:"Find a Slack message about: "}});function w(e){const{origin:t}=e,n=(0,s().v3)(),w=(0,g().tz)(),C="dark"===(0,r().eP)(),A=(0,o().K8)((()=>{const e=(0,i().S)();if(e)return(0,l().G)(n,e)}),[n]),T=(0,r().IS)((()=>({tooltip:{width:250},headerWrapper:{display:"flex",flexDirection:"row",alignItems:"start"},slackIcon:{width:20},betaBadge:{borderRadius:4,background:m().Tj.palette.translucentGray[300],color:"#7F7F7F",display:"inline-block",fontSize:11,fontWeight:500,padding:"2px 5px",marginInlineStart:6},content:{padding:"4px 0px"},tryIt:{border:C?`1px solid ${m().Tj.palette.gray[500]}`:`1px solid ${m().Tj.palette.gray[700]}`,marginTop:6,color:m().Tj.text.inversePrimary},tryItHovered:{border:`1px solid ${m().Tj.palette.gray[600]}`,backgroundColor:C?m().Tj.palette.gray[400]:m().Tj.palette.gray[800]}})),[C]);(0,a.useEffect)((()=>{y().Mk(n),f().i(n,{from:"slack_qna_ai_notification"}),b().DL(n,{callout_key:"ai_slack_qna_notification_tooltip",placement_key:"Tooltip"})}),[n]);const j=(0,x().i7)(),M=(0,a.useCallback)((e=>{const{tryIt:t}=e;if(S().a(n,"ai_slack_qna_notification_tooltip"),t){const e=w.formatMessage(k.primedTextInput);j&&(0,v().openNewAgentSidebarFromMainBlock)({environment:n,primeTextInput:e}),b().Y5(n,{callout_key:"ai_slack_qna_notification_tooltip",click_type:"primary_cta",placement_key:"Tooltip"})}else f().z(n,{from:"slack_qna_ai_notification"}),b().Sq(n,{callout_key:"ai_slack_qna_notification_tooltip",dismiss_type:"tooltip_dismiss",placement_key:"Tooltip"})}),[n,w,j]);return(0,h().O9)(A)?(0,I.jsx)(c().k,{style:T.tooltip,pointerLength:25,pointerPosition:"90%",origin:t,placementToOrigin:"top",header:(0,I.jsxs)("div",{style:T.headerWrapper,children:[(0,I.jsx)("img",{src:p().A.images.externalIntegrations.slackIconPng,style:T.slackIcon}),(0,I.jsx)(d().E,{style:T.betaBadge,content:(0,I.jsx)(g().sA,{id:"AiSlackQnaNotificationTooltip.betaLabel",defaultMessage:"Beta"})})]}),content:(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{style:T.content,children:(0,I.jsx)(g().sA,{id:"AiSlackQnaNotificationTooltip.message",defaultMessage:"Notion AI can now find information from public Slack channels. Your workspace owner has enabled this feature for you!"})}),(0,I.jsx)(u().A,{style:T.tryIt,hoveredStyle:T.tryItHovered,size:"sm",onClick:()=>M({tryIt:!0}),children:(0,I.jsx)(g().sA,{id:"AiSlackQnaNotificationTooltip.tryIt",defaultMessage:"Ask AI"})})]}),onCloseClick:()=>M({tryIt:!1})}):null}},638001:(e,t,n)=>{n.d(t,{j:()=>a});const a=n(757695).Store.createValue(void 0,{name:"CurrentFullScreenCollectionContextStore"})},639162:(e,t,n)=>{n.d(t,{H:()=>E});n(581454);var a=n(296540),i=()=>n(907258),s=()=>n(312788),o=()=>n(484714),r=()=>n(590526),l=()=>n(401497),c=()=>n(295633),d=()=>n(849255),u=()=>n(350013),p=()=>n(807449),g=()=>n(631524),m=()=>n(584262),h=()=>n(799288),f=()=>n(15857),y=()=>n(179034),v=()=>n(798880),S=()=>n(743246),b=()=>n(695608),x=()=>n(496703),I=()=>n(69708),k=()=>n(100622),w=()=>n(496603),C=()=>n(284371),A=()=>n(867201),T=()=>n(770160),j=()=>n(187820),M=()=>n(16006),_=()=>n(453697),P=()=>n(465614),D=n(474848);function E(e){const{navigate:t}=(0,a.useContext)(s().E),n=(0,o().v3)(),E=(0,I().tz)(),R=(0,T().useThreadStoreFromCurrentRoute)(),B=(0,r().O$)(i().AppStoreMainEditorCurrentBlockStore),{spaceStore:F,context:N}=e,{pointers:L,selectedBlockPointers:O,textSelectionContext:V}=(0,a.useMemo)((()=>{var e,t,n;return{pointers:(null===(e=N.value)||void 0===e?void 0:e.pointers)??[],selectedBlockPointers:(null===(t=N.value)||void 0===t||null===(t=t.blockSelection)||void 0===t?void 0:t.value)??[],textSelectionContext:(null===(n=N.value)||void 0===n?void 0:n.textSelection)??void 0}}),[N.value]),z=(0,a.useCallback)((e=>{const t=e.map((e=>e.pointer));(0,P().e)({environment:n,spaceStore:F,blockPointers:t,currentPageId:null==B?void 0:B.id,pageVisitSource:m().y8.MentionInPage,chatThreadId:null==R?void 0:R.id})}),[R,n,B,F]),W=(0,a.useCallback)((e=>{(0,P().y)({environment:n,spaceStore:F,textSelection:e.value,currentPageId:null==B?void 0:B.id,pageVisitSource:m().y8.MentionInPage,chatThreadId:null==R?void 0:R.id})}),[R,n,B,F]),U=(0,l().IS)((()=>({container:{display:"flex",flexWrap:"wrap",justifyContent:"end",gap:"2px 0"},blockContainer:{color:k().Tj.text.secondary,display:"flex",maxWidth:"50%",alignItems:"center",gap:5,fontSize:C().J.UISmall.desktop,paddingTop:4,paddingInlineEnd:8,paddingBottom:4,paddingInlineStart:6,borderRadius:12},blockContainerHover:{background:k().Tj.background.tertiaryTranslucent},ellipsisText:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",minWidth:0},additionalBlocksCount:{opacity:.5,marginInlineStart:4,flexShrink:0}})),[]),H=(0,r().K8)((()=>(0,w().oE)(L.map((e=>{if(e.table===y().ev){const t=c().B.createChildStore(F,e);return(0,D.jsxs)(g().p,{onClick:()=>{A().Y({store:t,environment:n,pageVisitSource:m().y8.MentionInPage,chatThreadId:null==R?void 0:R.id})},style:U.blockContainer,hoveredStyle:U.blockContainerHover,size:"sm",children:[(0,D.jsx)(j().B6,{disabled:!0,icon:t.getIcon(),isEmptyPage:!1,size:14,iconRecordCategory:(0,j().Te)(t)}),(0,D.jsx)(M().A,{store:t})]},e.id)}if(e.table===v().oo){const t=d().L.createChildStore(F,e),n=(0,b().c6)(E,t.getModel());return(0,D.jsxs)(g().p,{style:U.blockContainer,hoveredStyle:U.blockContainerHover,size:"sm",children:[(0,D.jsx)(_().A,{userStore:t,size:14}),(0,D.jsx)("span",{children:n})]},e.id)}if(e.table!==S().C0||(0,h().ut)(e.id))return null;{const a=u().N.createChildStore(F,e).getRenderTitle(E);return(0,D.jsx)(g().p,{onClick:()=>{t({environment:n,url:(0,x().L)({workflowId:e.id,params:{}})})},style:U.blockContainer,hoveredStyle:U.blockContainerHover,size:"sm",children:(0,D.jsx)("span",{children:a})},e.id)}})))),[n,E,L,F,U.blockContainer,U.blockContainerHover,R,t]),K=(0,a.useMemo)((()=>O.map((e=>c().B.createChildStore(F,e)))),[O,F]),q=(0,r().K8)((()=>{if(0===K.length)return null;const e=K[0],t=K.length-1;return(0,D.jsxs)(g().p,{style:U.blockContainer,hoveredStyle:U.blockContainerHover,size:"sm",onClick:()=>z(K),children:[(0,D.jsx)(p().I,{icon:f().a,size:"xs"}),(0,D.jsx)("span",{style:U.ellipsisText,children:(0,D.jsx)(M().A,{store:e,shouldWrap:!0})}),t>0?(0,D.jsx)("span",{style:U.additionalBlocksCount,children:(0,D.jsx)(I().sA,{id:"agentUserSpecifiedContextRenderer.additionalBlocksCount",defaultMessage:"+{count}",values:{count:t}})}):null]},e.id)}),[K,U.blockContainer,U.blockContainerHover,U.ellipsisText,U.additionalBlocksCount,z]),$=(null==V?void 0:V.text.trim())??"",G=(0,a.useMemo)((()=>V&&$?(0,D.jsxs)(g().p,{style:U.blockContainer,hoveredStyle:U.blockContainerHover,size:"sm",onClick:()=>W(V),children:[(0,D.jsx)(p().I,{icon:f().a,size:"xs"}),(0,D.jsx)("span",{style:U.ellipsisText,children:$})]}):null),[V,$,U.blockContainer,U.blockContainerHover,U.ellipsisText,W]);return 0!==L.length||0!==O.length||$?(0,D.jsxs)("div",{style:U.container,children:[H,q,G]}):null}},642119:(e,t,n)=>{n.d(t,{N:()=>p});n(296540);var a=()=>n(907258),i=()=>n(755531),s=()=>n(590526),o=()=>n(424400),r=()=>n(68263),l=()=>n(69708),c=()=>n(898808),d=()=>n(650598),u=n(474848);function p({permissionItem:e}){const t=(0,l().tz)(),n=(0,s().O$)(a().AppStoreSidebarSpaceStore),p=(0,s().K8)((()=>{var e;return null===(e=(0,i().S)())||void 0===e?void 0:e.getName()}),[]),g=null==e?void 0:e.role,m=(0,r().PW)(g)?(0,d().J)(t,g):void 0;return(0,u.jsx)(o().Ay,{desktopIconStyle:{alignSelf:"center",width:24},icon:n?(0,u.jsx)(c().x,{disabled:!0,store:n,size:24}):void 0,title:p,caption:(0,u.jsx)(l().sA,{id:"adminContentSearchTab.pagesTable.sharedWithCell.spaceMembers",defaultMessage:"Members{maybeRoleString}",values:{maybeRoleString:m?`  ${m}`:""}})})}},644161:(e,t,n)=>{n.d(t,{Bj:()=>d,JE:()=>l,gi:()=>p});var a=()=>n(69708),i=()=>n(534177);const s=(0,a().YK)({aa:{id:"translation.iso639TwoLetterLanguageCodes.aa",defaultMessage:"Afar"},ab:{id:"translation.iso639TwoLetterLanguageCodes.ab",defaultMessage:"Abkhazian"},af:{id:"translation.iso639TwoLetterLanguageCodes.af",defaultMessage:"Afrikaans"},ak:{id:"translation.iso639TwoLetterLanguageCodes.ak",defaultMessage:"Akan"},sq:{id:"translation.iso639TwoLetterLanguageCodes.sq",defaultMessage:"Albanian"},am:{id:"translation.iso639TwoLetterLanguageCodes.am",defaultMessage:"Amharic"},ar:{id:"translation.iso639TwoLetterLanguageCodes.ar",defaultMessage:"Arabic"},an:{id:"translation.iso639TwoLetterLanguageCodes.an",defaultMessage:"Aragonese"},hy:{id:"translation.iso639TwoLetterLanguageCodes.hy",defaultMessage:"Armenian"},as:{id:"translation.iso639TwoLetterLanguageCodes.as",defaultMessage:"Assamese"},av:{id:"translation.iso639TwoLetterLanguageCodes.av",defaultMessage:"Avaric"},ae:{id:"translation.iso639TwoLetterLanguageCodes.ae",defaultMessage:"Avestan"},ay:{id:"translation.iso639TwoLetterLanguageCodes.ay",defaultMessage:"Aymara"},az:{id:"translation.iso639TwoLetterLanguageCodes.az",defaultMessage:"Azerbaijani"},ba:{id:"translation.iso639TwoLetterLanguageCodes.ba",defaultMessage:"Bashkir"},bm:{id:"translation.iso639TwoLetterLanguageCodes.bm",defaultMessage:"Bambara"},eu:{id:"translation.iso639TwoLetterLanguageCodes.eu",defaultMessage:"Basque"},be:{id:"translation.iso639TwoLetterLanguageCodes.be",defaultMessage:"Belarusian"},bn:{id:"translation.iso639TwoLetterLanguageCodes.bn",defaultMessage:"Bengali"},bh:{id:"translation.iso639TwoLetterLanguageCodes.bh",defaultMessage:"Bihari languages"},bi:{id:"translation.iso639TwoLetterLanguageCodes.bi",defaultMessage:"Bislama"},bs:{id:"translation.iso639TwoLetterLanguageCodes.bs",defaultMessage:"Bosnian"},br:{id:"translation.iso639TwoLetterLanguageCodes.br",defaultMessage:"Breton"},bg:{id:"translation.iso639TwoLetterLanguageCodes.bg",defaultMessage:"Bulgarian"},my:{id:"translation.iso639TwoLetterLanguageCodes.my",defaultMessage:"Burmese"},ca:{id:"translation.iso639TwoLetterLanguageCodes.ca",defaultMessage:"Catalan; Valencian"},ch:{id:"translation.iso639TwoLetterLanguageCodes.ch",defaultMessage:"Chamorro"},ce:{id:"translation.iso639TwoLetterLanguageCodes.ce",defaultMessage:"Chechen"},zh:{id:"translation.iso639TwoLetterLanguageCodes.zh",defaultMessage:"Chinese"},cu:{id:"translation.iso639TwoLetterLanguageCodes.cu",defaultMessage:"Church Slavic; Old Slavonic; Church Slavonic; Old Bulgarian; Old Church Slavonic"},cv:{id:"translation.iso639TwoLetterLanguageCodes.cv",defaultMessage:"Chuvash"},kw:{id:"translation.iso639TwoLetterLanguageCodes.kw",defaultMessage:"Cornish"},co:{id:"translation.iso639TwoLetterLanguageCodes.co",defaultMessage:"Corsican"},cr:{id:"translation.iso639TwoLetterLanguageCodes.cr",defaultMessage:"Cree"},cs:{id:"translation.iso639TwoLetterLanguageCodes.cs",defaultMessage:"Czech"},da:{id:"translation.iso639TwoLetterLanguageCodes.da",defaultMessage:"Danish"},dv:{id:"translation.iso639TwoLetterLanguageCodes.dv",defaultMessage:"Divehi; Dhivehi; Maldivian"},nl:{id:"translation.iso639TwoLetterLanguageCodes.nl",defaultMessage:"Dutch"},dz:{id:"translation.iso639TwoLetterLanguageCodes.dz",defaultMessage:"Dzongkha"},en:{id:"translation.iso639TwoLetterLanguageCodes.en",defaultMessage:"English"},eo:{id:"translation.iso639TwoLetterLanguageCodes.eo",defaultMessage:"Esperanto"},et:{id:"translation.iso639TwoLetterLanguageCodes.et",defaultMessage:"Estonian"},ee:{id:"translation.iso639TwoLetterLanguageCodes.ee",defaultMessage:"Ewe"},fo:{id:"translation.iso639TwoLetterLanguageCodes.fo",defaultMessage:"Faroese"},fj:{id:"translation.iso639TwoLetterLanguageCodes.fj",defaultMessage:"Fijian"},fi:{id:"translation.iso639TwoLetterLanguageCodes.fi",defaultMessage:"Finnish"},fr:{id:"translation.iso639TwoLetterLanguageCodes.fr",defaultMessage:"French"},fy:{id:"translation.iso639TwoLetterLanguageCodes.fy",defaultMessage:"Western Frisian"},ff:{id:"translation.iso639TwoLetterLanguageCodes.ff",defaultMessage:"Fulah"},ka:{id:"translation.iso639TwoLetterLanguageCodes.ka",defaultMessage:"Georgian"},de:{id:"translation.iso639TwoLetterLanguageCodes.de",defaultMessage:"German"},gd:{id:"translation.iso639TwoLetterLanguageCodes.gd",defaultMessage:"Gaelic; Scottish Gaelic"},ga:{id:"translation.iso639TwoLetterLanguageCodes.ga",defaultMessage:"Irish"},gl:{id:"translation.iso639TwoLetterLanguageCodes.gl",defaultMessage:"Galician"},gv:{id:"translation.iso639TwoLetterLanguageCodes.gv",defaultMessage:"Manx"},el:{id:"translation.iso639TwoLetterLanguageCodes.el",defaultMessage:"Greek"},gn:{id:"translation.iso639TwoLetterLanguageCodes.gn",defaultMessage:"Guarani"},gu:{id:"translation.iso639TwoLetterLanguageCodes.gu",defaultMessage:"Gujarati"},ht:{id:"translation.iso639TwoLetterLanguageCodes.ht",defaultMessage:"Haitian; Haitian Creole"},ha:{id:"translation.iso639TwoLetterLanguageCodes.ha",defaultMessage:"Hausa"},he:{id:"translation.iso639TwoLetterLanguageCodes.he",defaultMessage:"Hebrew"},hz:{id:"translation.iso639TwoLetterLanguageCodes.hz",defaultMessage:"Herero"},hi:{id:"translation.iso639TwoLetterLanguageCodes.hi",defaultMessage:"Hindi"},ho:{id:"translation.iso639TwoLetterLanguageCodes.ho",defaultMessage:"Hiri Motu"},hr:{id:"translation.iso639TwoLetterLanguageCodes.hr",defaultMessage:"Croatian"},hu:{id:"translation.iso639TwoLetterLanguageCodes.hu",defaultMessage:"Hungarian"},ig:{id:"translation.iso639TwoLetterLanguageCodes.ig",defaultMessage:"Igbo"},is:{id:"translation.iso639TwoLetterLanguageCodes.is",defaultMessage:"Icelandic"},io:{id:"translation.iso639TwoLetterLanguageCodes.io",defaultMessage:"Ido"},ii:{id:"translation.iso639TwoLetterLanguageCodes.ii",defaultMessage:"Sichuan Yi; Nuosu"},iu:{id:"translation.iso639TwoLetterLanguageCodes.iu",defaultMessage:"Inuktitut"},ie:{id:"translation.iso639TwoLetterLanguageCodes.ie",defaultMessage:"Interlingue; Occidental"},ia:{id:"translation.iso639TwoLetterLanguageCodes.ia",defaultMessage:"Interlingua (International Auxiliary Language Association)"},id:{id:"translation.iso639TwoLetterLanguageCodes.id",defaultMessage:"Indonesian"},ik:{id:"translation.iso639TwoLetterLanguageCodes.ik",defaultMessage:"Inupiaq"},it:{id:"translation.iso639TwoLetterLanguageCodes.it",defaultMessage:"Italian"},jv:{id:"translation.iso639TwoLetterLanguageCodes.jv",defaultMessage:"Javanese"},ja:{id:"translation.iso639TwoLetterLanguageCodes.ja",defaultMessage:"Japanese"},kl:{id:"translation.iso639TwoLetterLanguageCodes.kl",defaultMessage:"Kalaallisut; Greenlandic"},kn:{id:"translation.iso639TwoLetterLanguageCodes.kn",defaultMessage:"Kannada"},ks:{id:"translation.iso639TwoLetterLanguageCodes.ks",defaultMessage:"Kashmiri"},kr:{id:"translation.iso639TwoLetterLanguageCodes.kr",defaultMessage:"Kanuri"},kk:{id:"translation.iso639TwoLetterLanguageCodes.kk",defaultMessage:"Kazakh"},km:{id:"translation.iso639TwoLetterLanguageCodes.km",defaultMessage:"Central Khmer"},ki:{id:"translation.iso639TwoLetterLanguageCodes.ki",defaultMessage:"Kikuyu; Gikuyu"},rw:{id:"translation.iso639TwoLetterLanguageCodes.rw",defaultMessage:"Kinyarwanda"},ky:{id:"translation.iso639TwoLetterLanguageCodes.ky",defaultMessage:"Kirghiz; Kyrgyz"},kv:{id:"translation.iso639TwoLetterLanguageCodes.kv",defaultMessage:"Komi"},kg:{id:"translation.iso639TwoLetterLanguageCodes.kg",defaultMessage:"Kongo"},ko:{id:"translation.iso639TwoLetterLanguageCodes.ko",defaultMessage:"Korean"},kj:{id:"translation.iso639TwoLetterLanguageCodes.kj",defaultMessage:"Kuanyama; Kwanyama"},ku:{id:"translation.iso639TwoLetterLanguageCodes.ku",defaultMessage:"Kurdish"},lo:{id:"translation.iso639TwoLetterLanguageCodes.lo",defaultMessage:"Lao"},la:{id:"translation.iso639TwoLetterLanguageCodes.la",defaultMessage:"Latin"},lv:{id:"translation.iso639TwoLetterLanguageCodes.lv",defaultMessage:"Latvian"},li:{id:"translation.iso639TwoLetterLanguageCodes.li",defaultMessage:"Limburgan; Limburger; Limburgish"},ln:{id:"translation.iso639TwoLetterLanguageCodes.ln",defaultMessage:"Lingala"},lt:{id:"translation.iso639TwoLetterLanguageCodes.lt",defaultMessage:"Lithuanian"},lb:{id:"translation.iso639TwoLetterLanguageCodes.lb",defaultMessage:"Luxembourgish; Letzeburgesch"},lu:{id:"translation.iso639TwoLetterLanguageCodes.lu",defaultMessage:"Luba-Katanga"},lg:{id:"translation.iso639TwoLetterLanguageCodes.lg",defaultMessage:"Ganda"},mk:{id:"translation.iso639TwoLetterLanguageCodes.mk",defaultMessage:"Macedonian"},mh:{id:"translation.iso639TwoLetterLanguageCodes.mh",defaultMessage:"Marshallese"},ml:{id:"translation.iso639TwoLetterLanguageCodes.ml",defaultMessage:"Malayalam"},mi:{id:"translation.iso639TwoLetterLanguageCodes.mi",defaultMessage:"Maori"},mr:{id:"translation.iso639TwoLetterLanguageCodes.mr",defaultMessage:"Marathi"},ms:{id:"translation.iso639TwoLetterLanguageCodes.ms",defaultMessage:"Malay"},mg:{id:"translation.iso639TwoLetterLanguageCodes.mg",defaultMessage:"Malagasy"},mt:{id:"translation.iso639TwoLetterLanguageCodes.mt",defaultMessage:"Maltese"},mn:{id:"translation.iso639TwoLetterLanguageCodes.mn",defaultMessage:"Mongolian"},na:{id:"translation.iso639TwoLetterLanguageCodes.na",defaultMessage:"Nauru"},nv:{id:"translation.iso639TwoLetterLanguageCodes.nv",defaultMessage:"Navajo; Navaho"},nr:{id:"translation.iso639TwoLetterLanguageCodes.nr",defaultMessage:"Ndebele, South; South Ndebele"},nd:{id:"translation.iso639TwoLetterLanguageCodes.nd",defaultMessage:"Ndebele, North; North Ndebele"},ng:{id:"translation.iso639TwoLetterLanguageCodes.ng",defaultMessage:"Ndonga"},ne:{id:"translation.iso639TwoLetterLanguageCodes.ne",defaultMessage:"Nepali"},nn:{id:"translation.iso639TwoLetterLanguageCodes.nn",defaultMessage:"Norwegian Nynorsk; Nynorsk, Norwegian"},nb:{id:"translation.iso639TwoLetterLanguageCodes.nb",defaultMessage:"Norwegian"},no:{id:"translation.iso639TwoLetterLanguageCodes.no",defaultMessage:"Norwegian"},ny:{id:"translation.iso639TwoLetterLanguageCodes.ny",defaultMessage:"Chichewa; Chewa; Nyanja"},oc:{id:"translation.iso639TwoLetterLanguageCodes.oc",defaultMessage:"Occitan (post 1500)"},oj:{id:"translation.iso639TwoLetterLanguageCodes.oj",defaultMessage:"Ojibwa"},or:{id:"translation.iso639TwoLetterLanguageCodes.or",defaultMessage:"Oriya"},om:{id:"translation.iso639TwoLetterLanguageCodes.om",defaultMessage:"Oromo"},os:{id:"translation.iso639TwoLetterLanguageCodes.os",defaultMessage:"Ossetian; Ossetic"},pa:{id:"translation.iso639TwoLetterLanguageCodes.pa",defaultMessage:"Panjabi; Punjabi"},fa:{id:"translation.iso639TwoLetterLanguageCodes.fa",defaultMessage:"Persian"},pi:{id:"translation.iso639TwoLetterLanguageCodes.pi",defaultMessage:"Pali"},pl:{id:"translation.iso639TwoLetterLanguageCodes.pl",defaultMessage:"Polish"},pt:{id:"translation.iso639TwoLetterLanguageCodes.pt",defaultMessage:"Portuguese"},ps:{id:"translation.iso639TwoLetterLanguageCodes.ps",defaultMessage:"Pushto; Pashto"},qu:{id:"translation.iso639TwoLetterLanguageCodes.qu",defaultMessage:"Quechua"},rm:{id:"translation.iso639TwoLetterLanguageCodes.rm",defaultMessage:"Romansh"},ro:{id:"translation.iso639TwoLetterLanguageCodes.ro",defaultMessage:"Romanian; Moldavian; Moldovan"},rn:{id:"translation.iso639TwoLetterLanguageCodes.rn",defaultMessage:"Rundi"},ru:{id:"translation.iso639TwoLetterLanguageCodes.ru",defaultMessage:"Russian"},sg:{id:"translation.iso639TwoLetterLanguageCodes.sg",defaultMessage:"Sango"},sa:{id:"translation.iso639TwoLetterLanguageCodes.sa",defaultMessage:"Sanskrit"},si:{id:"translation.iso639TwoLetterLanguageCodes.si",defaultMessage:"Sinhala; Sinhalese"},sk:{id:"translation.iso639TwoLetterLanguageCodes.sk",defaultMessage:"Slovak"},sl:{id:"translation.iso639TwoLetterLanguageCodes.sl",defaultMessage:"Slovenian"},se:{id:"translation.iso639TwoLetterLanguageCodes.se",defaultMessage:"Northern Sami"},sm:{id:"translation.iso639TwoLetterLanguageCodes.sm",defaultMessage:"Samoan"},sn:{id:"translation.iso639TwoLetterLanguageCodes.sn",defaultMessage:"Shona"},sd:{id:"translation.iso639TwoLetterLanguageCodes.sd",defaultMessage:"Sindhi"},so:{id:"translation.iso639TwoLetterLanguageCodes.so",defaultMessage:"Somali"},st:{id:"translation.iso639TwoLetterLanguageCodes.st",defaultMessage:"Sotho, Southern"},es:{id:"translation.iso639TwoLetterLanguageCodes.es",defaultMessage:"Spanish"},sc:{id:"translation.iso639TwoLetterLanguageCodes.sc",defaultMessage:"Sardinian"},sr:{id:"translation.iso639TwoLetterLanguageCodes.sr",defaultMessage:"Serbian"},ss:{id:"translation.iso639TwoLetterLanguageCodes.ss",defaultMessage:"Swati"},su:{id:"translation.iso639TwoLetterLanguageCodes.su",defaultMessage:"Sundanese"},sw:{id:"translation.iso639TwoLetterLanguageCodes.sw",defaultMessage:"Swahili"},sv:{id:"translation.iso639TwoLetterLanguageCodes.sv",defaultMessage:"Swedish"},ty:{id:"translation.iso639TwoLetterLanguageCodes.ty",defaultMessage:"Tahitian"},ta:{id:"translation.iso639TwoLetterLanguageCodes.ta",defaultMessage:"Tamil"},tt:{id:"translation.iso639TwoLetterLanguageCodes.tt",defaultMessage:"Tatar"},te:{id:"translation.iso639TwoLetterLanguageCodes.te",defaultMessage:"Telugu"},tg:{id:"translation.iso639TwoLetterLanguageCodes.tg",defaultMessage:"Tajik"},tl:{id:"translation.iso639TwoLetterLanguageCodes.tl",defaultMessage:"Tagalog"},th:{id:"translation.iso639TwoLetterLanguageCodes.th",defaultMessage:"Thai"},bo:{id:"translation.iso639TwoLetterLanguageCodes.bo",defaultMessage:"Tibetan"},ti:{id:"translation.iso639TwoLetterLanguageCodes.ti",defaultMessage:"Tigrinya"},to:{id:"translation.iso639TwoLetterLanguageCodes.to",defaultMessage:"Tonga (Tonga Islands)"},tn:{id:"translation.iso639TwoLetterLanguageCodes.tn",defaultMessage:"Tswana"},ts:{id:"translation.iso639TwoLetterLanguageCodes.ts",defaultMessage:"Tsonga"},tk:{id:"translation.iso639TwoLetterLanguageCodes.tk",defaultMessage:"Turkmen"},tr:{id:"translation.iso639TwoLetterLanguageCodes.tr",defaultMessage:"Turkish"},tw:{id:"translation.iso639TwoLetterLanguageCodes.tw",defaultMessage:"Twi"},ug:{id:"translation.iso639TwoLetterLanguageCodes.ug",defaultMessage:"Uighur; Uyghur"},uk:{id:"translation.iso639TwoLetterLanguageCodes.uk",defaultMessage:"Ukrainian"},ur:{id:"translation.iso639TwoLetterLanguageCodes.ur",defaultMessage:"Urdu"},uz:{id:"translation.iso639TwoLetterLanguageCodes.uz",defaultMessage:"Uzbek"},ve:{id:"translation.iso639TwoLetterLanguageCodes.ve",defaultMessage:"Venda"},vi:{id:"translation.iso639TwoLetterLanguageCodes.vi",defaultMessage:"Vietnamese"},vo:{id:"translation.iso639TwoLetterLanguageCodes.vo",defaultMessage:"Volapk"},cy:{id:"translation.iso639TwoLetterLanguageCodes.cy",defaultMessage:"Welsh"},wa:{id:"translation.iso639TwoLetterLanguageCodes.wa",defaultMessage:"Walloon"},wo:{id:"translation.iso639TwoLetterLanguageCodes.wo",defaultMessage:"Wolof"},xh:{id:"translation.iso639TwoLetterLanguageCodes.xh",defaultMessage:"Xhosa"},yi:{id:"translation.iso639TwoLetterLanguageCodes.yi",defaultMessage:"Yiddish"},yo:{id:"translation.iso639TwoLetterLanguageCodes.yo",defaultMessage:"Yoruba"},za:{id:"translation.iso639TwoLetterLanguageCodes.za",defaultMessage:"Zhuang; Chuang"},zu:{id:"translation.iso639TwoLetterLanguageCodes.zu",defaultMessage:"Zulu"}});const o=["en-US","en-GB","zh-HANS","zh-HANT","pt-BR","pt-PT"];const r={en:"en-US",zh:"zh-HANT",pt:"pt-BR"};function l(e){return(0,i().O)(r,e)?r[e]:e}const c=(0,a().YK)({"en-US":{id:"translation.iso639TwoLetterLanguageCodes.en-US",defaultMessage:"English"},"en-GB":{id:"translation.iso639TwoLetterLanguageCodes.en-GB",defaultMessage:"English (United Kingdom)"},"zh-HANT":{id:"translation.iso639TwoLetterLanguageCodes.zh-HANT",defaultMessage:"Chinese (Traditional)"},"zh-HANS":{id:"translation.iso639TwoLetterLanguageCodes.zh-HANS",defaultMessage:"Chinese (Simplified)"},"pt-BR":{id:"translation.iso639TwoLetterLanguageCodes.pt-BR",defaultMessage:"Portuguese (Brazil)"},"pt-PT":{id:"translation.iso639TwoLetterLanguageCodes.pt-PT",defaultMessage:"Portuguese (Portugal)"}});function d(e){return function(e){return(0,i().Xk)(o,e)}(e)?function(e){return c[e]}(e):function(e){return s[e]}(e)}const u={"en-US":"en-US","ko-KR":"ko","ja-JP":"ja","fr-FR":"fr","de-DE":"de","es-ES":"es","es-LA":"es","pt-BR":"pt-BR","zh-CN":"zh-HANS","zh-TW":"zh-HANT","fi-FI":"fi","da-DK":"da","nl-NL":"nl","nb-NO":"nb","sv-SE":"sv","en-GB":"en-GB","vi-VN":"vi","th-TH":"th","id-ID":"id","he-IL":"he","ar-SA":"ar",pseudo:"en"};function p(e){return(0,i().O)(u,e)?u[e]:void 0}},647621:(e,t,n)=>{n.d(t,{Ks:()=>i,XZ:()=>s,sm:()=>o,xc:()=>r});var a=()=>n(69708);const i=(0,a().YK)({paymentMethodUnverified:{id:"subscriptions.paymentMethodUnverified",defaultMessage:"Your payment is being processed. Please try again when your payment has completed."},otherPaymentMethod:{id:"subscriptions.otherPaymentMethod",defaultMessage:"Other"},adminOnlyAction:{id:"subscriptions.adminOnlyAction",defaultMessage:"Only workspace owners can perform this action."},iosSubscriptionRestriction:{id:"subscriptions.iosSubscriptionRestriction",defaultMessage:"Youre currently subscribed through an in-app purchase with Apple. To change your subscription, cancel your subscription with Apple first."},androidSubscriptionRestriction:{id:"subscriptions.androidSubscriptionRestriction",defaultMessage:"Youre currently subscribed through an in-app purchase with Google. To change your subscription, cancel your subscription with Google first."},mixedSubscriptionRestriction:{id:"subscriptions.mixedSubscriptionRestriction",defaultMessage:"Youre currently subscribed through Notion and an in-app purchase. To change your subscription, cancel your subscription with your mobile app store first."},galaxyAppRestriction:{id:"subscriptions.galaxyAppRestriction",defaultMessage:"This action is currently not available on the Samsung Galaxy app."}}),s=(0,a().YK)({approachingBlockLimitTitle:{id:"nudges.approachingBlockLimit.title",defaultMessage:"Upgrade to go unlimited"},approachingBlockLimitDescription:{id:"nudges.approachingBlockLimit.description",defaultMessage:"Continue using Notion to collaborate with others"},approachingBlockLimitTooltip:{id:"nudges.approachingBlockLimit.tooltip",defaultMessage:"Youre reaching the maximum number of free blocks given on your plan ({percentageUsed}). You wont be able to create more content unless you upgrade to the Plus plan."},reachedBlockLimitTitle:{id:"nudges.reachedBlockLimit.title",defaultMessage:"Keep using Notion"},reachedBlockLimitDescription:{id:"nudges.reachedBlockLimit.description",defaultMessage:"{spaceName} has used 100% of the free blocks in the workspace"},manageMembersCta:{id:"nudges.manageMembers.cta",defaultMessage:"Manage members"},reachedBlockLimitCta:{id:"nudges.reachedBlockLimit.cta",defaultMessage:"Upgrade plan"},reachedBlockLimitCtaForMembers:{id:"spaceSettings.sidebar.button.contactWorkspaceOwner",defaultMessage:"Contact a workspace owner"},reachedBlockLimitTooltip:{id:"nudges.reachedBlockLimit.tooltip",defaultMessage:"Youve reached the maximum number of free blocks for your plan (100%). You wont be able to create more content unless you upgrade to the Plus plan."}}),o=(0,a().YK)({creditUsage:{id:"aiUsageDashboard.creditUsage.usage",defaultMessage:"{usage} / {limit} AI credits"}}),r=(0,a().YK)({approachingBlockLimitTitle:{id:"blockLimit.approachingBlockLimit.title",defaultMessage:"Running out of free blocks"},approachingBlockLimitDescription:{id:"blockLimit.approachingBlockLimit.description",defaultMessage:"Youve used most of this workspaces 1,000 free blocks"},approachingBlockLimitTooltip:{id:"blockLimit.approachingBlockLimit.tooltip",defaultMessage:"You wont be able to create new content unless you upgrade to a paid plan"},enteringGracePeriodTitle:{id:"blockLimit.enteringGracePeriod.title",defaultMessage:"{dayCount, plural, one {1 day} other {{dayCount} days}} left to upgrade"},enteringGracePeriodDescription:{id:"blockLimit.enteringGracePeriod.description",defaultMessage:"This workspace is out of free blocks for you and your team"},enteringGracePeriodTooltip:{id:"blockLimit.enteringGracePeriod.tooltip",defaultMessage:"Notion is free & unlimited for workspaces with 1 member"},enteringGracePeriodTooltipSubtitle:{id:"blockLimit.enteringGracePeriod.tooltipDescription",defaultMessage:"You can manage members via the People tab in settings"},afterGracePeriodTitle:{id:"blockLimit.afterGracePeriod.title",defaultMessage:"Keep using Notion"},afterGracePeriodDescription:{id:"blockLimit.afterGracePeriod.description",defaultMessage:"Youve used all of this workspaces free blocks"},afterGracePeriodTooltip:{id:"blockLimit.afterGracePeriod.tooltip",defaultMessage:"You can only create new content when you upgrade your plan"}})},650598:(e,t,n)=>{n.d(t,{J:()=>i});const a=(0,n(69708).YK)({editor:{id:"adminContentSearchTab.sharedWith.permissions.editor",defaultMessage:"Full access"},readAndWrite:{id:"adminContentSearchTab.sharedWith.permissions.readAndWrite",defaultMessage:"Can edit"},commentOnly:{id:"adminContentSearchTab.sharedWith.permissions.commentOnly",defaultMessage:"Can comment"},reader:{id:"adminContentSearchTab.sharedWith.permissions.reader",defaultMessage:"Can view"},none:{id:"adminContentSearchTab.sharedWith.permissions.none",defaultMessage:"None"}});function i(e,t){switch(t){case"editor":return e.formatMessage(a.editor);case"read_and_write":return e.formatMessage(a.readAndWrite);case"comment_only":return e.formatMessage(a.commentOnly);case"reader":return e.formatMessage(a.reader);case"none":return e.formatMessage(a.none)}}},651196:(e,t,n)=>{n.d(t,{Ay:()=>b,BW:()=>y,Es:()=>f,LV:()=>v});n(581454);var a=n(296540),i=()=>n(726637),s=()=>n(401497),o=()=>n(718827),r=()=>n(250910),l=()=>n(807449),c=()=>n(854705),d=()=>n(324254),u=()=>n(100622),p=()=>n(284371),g=()=>n(656134),m=n(474848);const h=a.forwardRef((function(e,t){const{style:r,hoveredStyle:l,icon:c,disabled:d,iconStyle:p,title:g,onClick:h,focused:f,variant:y,singleLineTitle:v,...S}=e,b=function(e){const t=(0,n(912771).q)(),a=(0,s().eP)();return(0,s().IS)((()=>({AssistantActionButton:{display:"flex",alignItems:"center",boxShadow:e.tinted?"none":u().Tj.inputBoxShadow,paddingTop:6,paddingInlineEnd:12,paddingBottom:6,paddingInlineStart:12,marginBottom:6,color:e.lightGrey?u().Tj.text.tertiary:u().Tj.text.primary,fontSize:t.actionButtonLabelTextSize,fontWeight:500,borderRadius:24,width:"max-content",background:e.tinted?u().Tj.background.secondaryTranslucent:"transparent",height:t.actionButtonHeight,...i().A.isMobile&&{flexWrap:"nowrap",textWrap:"nowrap"}},...e.tinted&&{hoveredStyle:{background:(0,o().i)({color:u().Tj.background.secondaryTranslucent,mode:a})},pressedStyle:{background:(0,o().yZ)({color:u().Tj.background.secondaryTranslucent,mode:a})}},icon:{width:t.actionIconSize,height:t.actionIconSize,fill:e.lightGrey?u().Tj.icon.tertiary:u().Tj.icon.primary,marginInlineEnd:e.hasTitle?6:0}})),[e.hasTitle,e.lightGrey,e.tinted,t.actionButtonHeight,t.actionButtonLabelTextSize,t.actionIconSize,a])}({lightGrey:"lightGrey"===y,tinted:"tinted"===y,hasTitle:Boolean(g)}),x=c?Array.isArray(c)?c:[c]:void 0;return(0,m.jsxs)(o().Ay,{...S,ref:t,disabled:d,style:{...b.AssistantActionButton,...r},hoveredStyle:{...b.hoveredStyle,...l},pressedStyle:b.pressedStyle,onClick:h,focused:f,...e.tooltipEvents??{},children:[null==x?void 0:x.map(((e,t)=>(0,m.jsx)(a.Fragment,{children:"function"==typeof e?e({...b.icon,...p}):e},t))),v?(0,m.jsx)("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:g}):g]})}));function f(e){const{onDropdownClick:t,variant:n,disabled:a,dropdownTooltipEvents:o,fontSize:r,...c}=e,p=(0,s().IS)((()=>({wrap:{display:"flex",alignItems:"center",borderRadius:24},button:{boxShadow:"none",...r?{fontSize:r}:{}},buttonLeft:{...!i().A.isMobile&&{borderStartEndRadius:0,borderEndEndRadius:0,borderInlineEnd:`1px solid ${u().Tj.border.primaryTranslucent}`,paddingInlineEnd:7}},buttonRight:{borderStartStartRadius:0,borderEndStartRadius:0,alignSelf:"stretch",paddingInlineStart:5,paddingInlineEnd:5}})),[r]);return(0,m.jsxs)("div",{style:p.wrap,children:[(0,m.jsx)(h,{style:{...p.button,...p.buttonLeft},variant:n,disabled:a,...c}),i().A.isMobile?void 0:(0,m.jsx)(h,{onClick:t,style:{...p.button,...p.buttonRight},icon:e=>(0,m.jsx)(l().I,{icon:d().arrowChevronSingleDownSmallIcon,size:"xs",colorVariant:"secondary"}),variant:n,disabled:a,tooltipEvents:o})]})}function y(e){const{actionIcon:t,buttonTitle:n,...a}=e,i=(0,g().j)(),s=S();return(0,m.jsx)(r().A,{popupType:i,placementToOrigin:"top",alignmentToOrigin:"center",renderOrigin:e=>(0,m.jsx)(h,{...e,style:s.buttonContainer,iconStyle:s.iconColor,icon:t,title:(0,m.jsxs)(m.Fragment,{children:[n,(0,m.jsx)(l().I,{icon:c().arrowChevronSingleDownFillSmallIcon,size:"xs",colorVariant:"tertiary"})]}),variant:"tinted"}),...a})}function v(e){const{titleMessage:t,selectedOptionMessage:n}=e,a=S();return(0,m.jsxs)("div",{style:a.messagesWrap,children:[(0,m.jsx)("div",{style:a.titleMessage,children:t}),n?(0,m.jsx)("div",{style:a.selectedOptionMessageWrap,children:(0,m.jsx)("div",{style:a.selectedOptionMessage,children:n})}):void 0]})}function S(){return(0,s().IS)((()=>({buttonContainer:{display:"flex",alignItems:"center",minWidth:"fit-content",...!i().A.isMobile&&{maxWidth:250,...p().RC}},buttonStyle:{height:24,width:24},messagesWrap:{display:"flex",flexGrow:1,justifyItems:"space-between",...p().RC},titleMessage:{flexGrow:1,paddingInlineEnd:4,marginInlineEnd:"auto",whiteSpace:"nowrap"},selectedOptionMessageWrap:{display:"flex",alignItems:"center",flexShrink:1},selectedOptionMessage:{minWidth:0,maxWidth:55,color:u().Tj.text.tertiary,...p().RC},iconColor:{fill:u().Tj.icon.primary}})),[])}const b=h},655581:(e,t,n)=>{n.d(t,{X:()=>r,Y:()=>o});var a=n(296540),i=n(474848);const s=(0,a.createContext)({threadStore:void 0,turnSteps:void 0});function o(e){const{threadStore:t,turnSteps:n,children:o}=e,r=(0,a.useMemo)((()=>({threadStore:t,turnSteps:n})),[t,n]);return(0,i.jsx)(s.Provider,{value:r,children:o})}function r(){return(0,a.useContext)(s)}s.displayName="EditReferenceBlockContext"},657133:(e,t,n)=>{n.d(t,{Z:()=>r});var a=()=>n(907258),i=()=>n(576590),s=()=>n(383070),o=()=>n(483730);function r(e){const{environment:t}=e;if(o().default.setLastSessionInitializedUnixEpochTime(),s().zD.showRemindersToUseQnA()){const{currentUserSettingsStore:e}=a().default.state;e&&(0,i().setLastExposedToQnaAtToCurrentTimestamp)(t,{userSettingsStore:e})}}},657349:(e,t,n)=>{n.d(t,{O:()=>C});n(898992),n(354520),n(581454);var a=n(296540),i=()=>n(933922),s=()=>n(726637),o=()=>n(484714),r=()=>n(590526),l=()=>n(401497),c=()=>n(611648),d=()=>n(988083),u=()=>n(917150),p=()=>n(420802),g=()=>n(31511),m=()=>n(406094),h=()=>n(160432),f=()=>n(493552),y=()=>n(878456),v=()=>n(531197),S=()=>n(69708),b=()=>n(100622),x=()=>n(140992),I=()=>n(111043),k=()=>n(547149),w=n(474848);function C({handleSubmit:e,closeForm:t,mode:n,threadStore:C}){const A=(0,o().v3)(),T=(0,S().tz)(),[j,M]=(0,r().K8)((()=>s().A.isMobile?[A.WindowSizeStore.getSafePaddingLeftCSS(24),A.WindowSizeStore.getSafePaddingRightCSS(24)]:[0,0]),[A.WindowSizeStore]),_=(0,I().o)(),P=(0,r().K8)((()=>s().A.isMobile?A.WindowSizeStore.getSafePaddingBottomPx(0):0),[A.WindowSizeStore]),D=(0,l().IS)((()=>{const e=Math.max(0,_-P);return{wrap:{display:"flex",flexDirection:"column",height:"100%",width:s().A.isMobile?"min(100%, 600px)":void 0,maxWidth:s().A.isMobile?void 0:800,maxHeight:s().A.isMobile?void 0:"max(calc(100vh - 78px), 300px)"},modalWrap:{padding:24,paddingInlineStart:s().A.isMobile?j:24,paddingInlineEnd:s().A.isMobile?M:24,paddingBottom:24,fontSize:14,width:"100%"},inputStyle:{fontSize:s().A.isMobile?17:14},titleContainer:{marginBottom:12},buttonArea:{display:"flex",justifyContent:"flex-end",gap:8},buttonToolbar:{flexShrink:0,paddingInlineStart:s().A.isMobile?j:24,paddingInlineEnd:s().A.isMobile?M:24,paddingTop:s().A.isMobile?12:24,paddingBottom:s().A.isMobile?e>0?12:P:24,borderTop:`1px solid ${b().Tj.border.secondary}`,background:b().Tj.background.secondary},workflowShareSettings:{marginTop:12,display:"flex",alignItems:"flex-start",gap:8},scroller:{flex:1,display:"flex",flexDirection:"column",minHeight:0,paddingBottom:s().A.isMobile?e:0}}}),[j,M,_,P]),[E,R]=(0,a.useState)(),[B,F]=(0,a.useState)([]),[N,L]=(0,a.useState)([]),[O,V]=(0,a.useState)(!0),[z,W]=(T.formatMessage({id:"AIFeedbackForm.reason.searchFailure",defaultMessage:"Could not find relevant information"}),T.formatMessage({id:"AIFeedbackForm.reason.deletionFailure",defaultMessage:"Deleted content"}),T.formatMessage({id:"AIFeedbackForm.reason.databaseCreateUpdateFailure",defaultMessage:"Incorrect database creation / update"}),T.formatMessage({id:"AIFeedbackForm.reason.databaseQueryFailure",defaultMessage:"Incorrect database querying"}),T.formatMessage({id:"AIFeedbackForm.reason.incompleteTask",defaultMessage:"Did not complete the task"}),T.formatMessage({id:"AIFeedbackForm.reason.other",defaultMessage:"Something else"}),(0,a.useState)([])),U=(0,r().K8)((()=>(0,y().q1)((null==C?void 0:C.getTranscript())??[])),[C]),H=(0,r().K8)((()=>{var e;return(null==C||null===(e=C.getData())||void 0===e?void 0:e.shared_with_space)??!1}),[C]),K=(0,a.useCallback)((()=>{e({tags:B,routingLabels:N,additionalComments:E,failureReasons:z}),U&&O!==H&&C&&k().createAndCommit({userAction:"AIFeedbackForm.setSharedWithSpace",environment:A,canUndo:!0,perform:e=>{(0,x().D5)({threadStore:C,transaction:e,sharedWithSpace:O})}})}),[e,B,N,E,z,C,A,H,O,U]),q=(0,a.useRef)(null),$="assistant-labeler"===n,G=!1;let Y,Q;switch(n){case"assistant-labeler":Y=(0,w.jsx)(S().sA,{id:"AIFeedbackForm.assistant.title",defaultMessage:"Give additional feedback on this step"});break;case"feedback":Y=(0,w.jsx)(S().sA,{id:"AIFeedbackForm.title",defaultMessage:"How can we improve this response?"});break;case"feedback-positive":Y=(0,w.jsx)(S().sA,{id:"AIFeedbackForm.titlePositive",defaultMessage:"What did you like about this response?"});break;case"error-report":Y=(0,w.jsx)(S().sA,{id:"AIFeedbackForm.error.title",defaultMessage:"Report an error"})}switch(n){case"error-report":Q=T.formatMessage({id:"AIFeedbackForm.additionalCommentsErrorPlaceholder",defaultMessage:"What led to the error?"});break;case"feedback-positive":Q=T.formatMessage({id:"AIFeedbackForm.additionalCommentsPositivePlaceholder",defaultMessage:"What did you like about this response? How could it be even better?"});break;default:Q=T.formatMessage({id:"AIFeedbackForm.additionalCommentsPlaceholder",defaultMessage:"What did you want to see? How can we make it better?"})}const J="feedback"===n||"feedback-positive"===n||"error-report"===n,X=("feedback"===n||"error-report"===n)&&U&&G;return(0,w.jsx)(i().N,{allowMobileAutoScroll:!0,capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1,wrapperTag:"div",children:(0,w.jsxs)("div",{style:D.wrap,children:[(0,w.jsx)(u()._,{ref:q,type:c().A.Y,style:D.scroller,children:(0,w.jsxs)("div",{style:D.modalWrap,children:[(0,w.jsxs)("div",{style:D.titleContainer,children:[(0,w.jsx)(f().D,{styleKey:"titleMedium",colorVariant:"primary",children:Y}),J?(0,w.jsxs)(f().D,{colorVariant:"tertiary",styleKey:"bodyRegular",style:{marginTop:8},children:[(0,w.jsx)(S().sA,{id:"AIFeedbackForm.warning",defaultMessage:"Your feedback helps Notion AI improve. The messages from your chat, the search results, and your feedback will be sent to Notion to help improve Notion AI."}),X?(0,w.jsxs)(w.Fragment,{children:[" ",(0,w.jsx)(S().sA,{id:"AIFeedbackForm.selectAllIssues",defaultMessage:"Select all issues you experienced."})]}):void 0]}):void 0]}),void 0,$?(0,w.jsxs)("div",{style:{marginBottom:12},children:[(0,w.jsx)("div",{style:{marginBottom:8},children:"Tags"}),v().YI.map((e=>{const t=()=>{B.includes(e)?F(B.filter((t=>t!==e))):F([...B,e])};return(0,w.jsxs)("div",{role:"button",tabIndex:0,style:{display:"flex",alignItems:"center",marginBottom:8,cursor:"pointer"},onClick:t,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t())},children:[(0,w.jsx)(p().S,{size:16,checked:B.includes(e),onClick:t}),(0,w.jsx)(f().D,{styleKey:"bodyRegular",colorVariant:"primary",style:{marginInlineStart:8},children:e})]},e)}))]}):void 0,$?(0,w.jsxs)("div",{style:{marginBottom:12},children:[(0,w.jsx)("div",{style:{marginBottom:8},children:"Expected action(s)"}),v().me.map((e=>{const t=()=>{N.includes(e)?L(N.filter((t=>t!==e))):L([...N,e])};return(0,w.jsxs)("div",{role:"button",tabIndex:0,style:{display:"flex",alignItems:"center",marginBottom:8,cursor:"pointer"},onClick:t,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t())},children:[(0,w.jsx)(p().S,{size:16,checked:N.includes(e),onClick:t}),(0,w.jsx)(f().D,{styleKey:"bodyRegular",colorVariant:"primary",style:{marginInlineStart:8},children:e})]},e)}))]}):void 0,(0,w.jsx)(g().A,{placeholder:Q,value:E,onChange:e=>R(e.target.value),focusInitial:!s().A.isMobile,onFocus:()=>{s().A.isMobile&&d().A.onShow((()=>{var e;const t=null===(e=q.current)||void 0===e?void 0:e.getNode();null==t||t.scrollTo({top:t.scrollHeight})}))},textarea:!0,textareaSubmitOnEnter:!0,style:D.inputStyle,inputStyle:{padding:8},onSubmit:K}),void 0]})}),(0,w.jsx)("div",{style:D.buttonToolbar,children:(0,w.jsxs)("div",{style:D.buttonArea,children:[(0,w.jsx)(m().A,{size:"lg",onClick:t,children:(0,w.jsx)(f().D,{styleKey:"bodyMedium",colorVariant:"primary",children:(0,w.jsx)(S().sA,{id:"AIFeedbackForm.cancelButton.label",defaultMessage:"Cancel"})})}),(0,w.jsx)(h().A,{colorPalette:"blue",size:"lg",onClick:K,children:(0,w.jsx)(f().D,{styleKey:"bodyMedium",colorVariant:"inversePrimary",children:(0,w.jsx)(S().sA,{id:"AIFeedbackForm.reportButton.label",defaultMessage:"Send"})})})]})})]})})}},658102:(e,t,n)=>{n.d(t,{eg:()=>i});n(16280),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(672577),n(430670),n(581454);var a=()=>n(206267);class i extends(()=>n(329840))().Y{async*streamInference(){}parse(e){return(0,n(412412).BD)(e)}chat(e){}chatMd(){}search(){return Promise.resolve({searchResults:[]})}searchPeople(){return Promise.resolve({results:[],total:0})}searchDatabases(e){return Promise.resolve({results:[],total:0})}randomID(){return a().Dt()}}},663199:(e,t,n)=>{n.d(t,{W:()=>s});var a=()=>n(341136),i=()=>n(72135);function s({intl:e,propertySchema:t,value:n}){const s=t&&((0,a().A)(t)||"formula"===t.type)?t.number_format??i().C4:i().C4;return i().ZV(n,s,e)}},665638:(e,t,n)=>{n.d(t,{$:()=>p,S:()=>g});var a=n(296540),i=()=>n(45105),s=()=>n(590526),o=()=>n(401497),r=()=>n(100622),l=()=>n(209199),c=()=>n(180252),d=()=>n(644914),u=()=>n(965833);function p(e){const{environment:t,rightEdgeDistance:n,isInPeekRenderer:p,shouldShowAgentNewUserOnboardingChecklistProgressIndicator:m}=e,h=e.width??36,f=(0,a.useContext)(i().w),y=(0,s().K8)((()=>(0,d().zo)(t,p)-(0,d().Ql)(t)),[t,p]),v=(0,s().K8)((()=>g(t,16+f)),[t,f]),S=n+f,b=(0,s().K8)((()=>(0,c().$o)(t).state?0:1),[t]);return(0,o().IS)((()=>({buttonPositionStyle:{display:"flex",position:"absolute",bottom:v,insetInlineEnd:S,opacity:b,transform:`translateX(${(0,l().A1)()?"":"-"}${y}px) translateZ(0)`,transition:`\n\t\t\t\t\topacity ${u().L}ms,\n\t\t\t\t\tcolor ${u().L}ms,\n\t\t\t\t\ttransform 200ms\n\t\t\t\t`,alignItems:"center",flexDirection:m?"column":"row",gap:m?10:8},roundButtonStyle:{display:"flex",alignItems:"center",justifyContent:"center",background:r().Tj.whiteButtonBackground,width:h,height:h,borderRadius:"100%",fontSize:20,boxShadow:r().Tj.shadowSM}})),[y,v,S,h,b,m])}function g(e,t){return e.WindowSizeStore.getSafePaddingBottomCSS(t+(e.device.isTablet?-12:0))}},668346:(e,t,n)=>{n.d(t,{K:()=>i});var a=()=>n(242422);function i(){return[a().default.checkGate({gateName:"agent_writer"})?"commandAltJ":"commandJ"]}},670371:(e,t,n)=>{n.r(t),n.d(t,{eyeSmallIcon:()=>s,iconDefinition:()=>i});n(296540);var a=n(474848);const i={viewBox:"0 0 16 16",fittedViewBox:"0.7 3.26 14.6 9.48",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M8 5.372a2.626 2.626 0 0 1 2.625 2.626l-.014.269A2.626 2.626 0 0 1 8 10.624l-.269-.014A2.626 2.626 0 0 1 5.39 8.267l-.014-.269A2.626 2.626 0 0 1 8 5.372m0 1.75a.875.875 0 1 0 0 1.75.875.875 0 0 0 0-1.75"}),(0,a.jsx)("path",{d:"M8 3.26c3.125 0 5.857 1.673 7.152 4.141l.065.144c.11.293.11.617 0 .91l-.065.145c-1.295 2.468-4.027 4.14-7.152 4.14-3.027 0-5.685-1.57-7.026-3.912L.848 8.6a1.29 1.29 0 0 1 0-1.199l.126-.228C2.314 4.83 4.972 3.26 8 3.26m0 1.252c-2.6 0-4.833 1.345-5.941 3.281l-.104.19a.04.04 0 0 0 0 .036l.104.189c1.108 1.935 3.34 3.281 5.941 3.281 2.684 0 4.976-1.434 6.045-3.47L14.05 8l-.005-.018c-1.069-2.036-3.36-3.47-6.045-3.47"})]})},s=(0,n(340498).wt)("eyeSmall",i,"small")},680325:(e,t,n)=>{n.d(t,{Gv:()=>_,Q_:()=>k,q6:()=>A,wo:()=>j,yE:()=>M});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(430670),n(803949),n(581454),n(908872),n(737550);var a=()=>n(295633),i=()=>n(732810),s=()=>n(902006),o=()=>n(832443),r=()=>n(252050),l=()=>n(691309),c=()=>n(416504),d=()=>n(328876),u=()=>n(813690),p=()=>n(388821),g=()=>n(179034),m=()=>n(798880),h=()=>n(201980),f=()=>n(99895),y=()=>n(496603),v=()=>n(498212),S=()=>n(973647),b=()=>n(534177),x=()=>n(483730);const I=2;function k(e){const{clientStep:t,parentStore:n,evaluatorState:a,maxArtificialDatabaseCitations:i=I}=e,o=C({clientStep:t,getPageLevelCitationId:e=>M({hrefOrBlockId:e,evaluatorState:a,parentStore:n})}).getModels(t.blockIds.map((e=>({table:g().ev,id:e})))).filter(b().O9).flatMap((e=>e.getProperty("title")??[])).filter(h().qXl).flatMap(h().wQU).filter(h().bZo),r=[],l=new w({sessionContext:x().default.getActiveSession(),parentStore:n});let c=0;for(const y of o){const e=h().NpB(y);if("query_database_result"===e.type){const{queryDatabaseResultId:t}=e,n=x().default.getActiveSessionId();if(!n)continue;const a=x().default.getSessionContext(n);if(!a)continue;const i=a.clientStepsFromStoreState.find((e=>"queryDatabase"===e.type));if(!i)continue;const{collectionPointer:s}=i;r.push({type:"databaseCitation",citation:{pointer:s,queryDatabaseResultId:t}})}else if(void 0===e.type||"block"===e.type){const{blockId:t}=e;if(t){r.push({type:"pageCitation",citation:{pointer:{id:t,table:g().ev}}});const e=l.databaseResultIdByCollectionId.get(t);if(!r.some((t=>"databaseCitation"===t.type&&t.citation.queryDatabaseResultId===e))&&c<i){const e=l.buildAssociatedDbCitation({table:g().ev,id:t});e&&(c++,r.push({type:"databaseCitation",citation:e}))}}}else if("helpdoc"===e.type||"helpdoc-section"===e.type||"webpage"===e.type||"url"===e.type||(0,s().SC)(e.type)){const t=(0,s().Ve)(e.href);r.push({type:"universalCitation",citation:{href:t,type:"url"===e.type?"webpage":e.type}})}else(0,b().HB)(e.type)}const d=r.filter((e=>"pageCitation"===e.type)).map((e=>e.citation)),u=y().hS(d,(e=>e.pointer.id)),p=r.filter((e=>"databaseCitation"===e.type)).map((e=>e.citation)),m=y().hS(p,(e=>e.pointer.id)),f=r.map((e=>"universalCitation"===e.type?e.citation:void 0)).filter(b().O9);return{pageCitations:u,databaseCitations:m,universalCitations:y().hS(f,(e=>e.href))}}class w{constructor(e){this.sessionContext=void 0,this.parentStore=void 0,this.databaseResultIdByCollectionId=void 0,this.buildAssociatedDbCitation=e=>{const t=a().B.createChildStore(this.parentStore,e).getAssociatedCollectionId();if(!t)return;const i=this.databaseResultIdByCollectionId.get(t);return i?{pointer:{table:n(519831).Vl,id:t},queryDatabaseResultId:i}:void 0},this.sessionContext=e.sessionContext,this.parentStore=e.parentStore,this.databaseResultIdByCollectionId=this.constructEphemeralViewIdMap()}constructEphemeralViewIdMap(){var e;const t=new Map,n=(null===(e=this.sessionContext)||void 0===e?void 0:e.clientStepsFromStoreState.slice().reverse())??[];for(const s of n)if("queryDatabase"===s.type&&s.ephemeralViewData){var i;const e=a().B.createChildStore(this.parentStore,{table:g().ev,id:s.ephemeralViewData.collectionViewBlockId}),n=(null==e?void 0:e.DANGEROUSLY_INCORRECT_getCollectionPointer())??(null==e||null===(i=e.getModel())||void 0===i?void 0:i.getFirstCollectionPointerFromViews(e.getRecordModel));n&&!t.has(n.id)&&t.set(n.id,s.ephemeralViewData.assistantQueryDatabaseResultId)}return t}}function C(e){const{clientStep:t,getPageLevelCitationId:n}=e,a=p().RecordMap.create(),i=u().xb.fromRecordMap(a),s={table:m().oo,id:v().rN},o=v().rN;let r;for(const u of t.operations){const e=(0,l().Vz)({assistantOperation:u,actorPointer:s,getRecordValue:i,spaceId:o,citationHandling:n?{type:"createCitations",getPageLevelCitationId:n}:void 0,spaceViewId:void 0,currentTimeZone:(0,c().P)()});if(S().Q.isFail(e))break;const{operations:t}=(0,l().g$)(e.value,(0,l().ze)());r=(0,d().applyOperationsToRecordMap)({recordMap:a,operations:t,updateOnly:!1,crdtMaps:r})}return a}function A(e){const{clientStep:t}=e,n=C({clientStep:t}).getModels(t.blockIds.map((e=>({table:g().ev,id:e})))).filter(b().O9).flatMap((e=>e.getProperty("title")??[]));return h().q4_(n)}function T(e){return"notion"===e.type?e.pointer.id:e.href}function j(e){const{searchResultsSteps:t,clientChatStep:n,currentPageId:a,parentStore:i,evaluatorState:s}=e,o=y().sb(t.flatMap((e=>e.searchResults))),r=y().sb(o.map((e=>M({hrefOrBlockId:e,evaluatorState:s,parentStore:i}))).filter(b().O9));return a&&n&&function(e){const{clientStep:t,pageId:n,parentStore:a}=e;return k({clientStep:t,parentStore:a,citationOrdering:void 0}).pageCitations.some((e=>e.pointer.id===n))}({clientStep:n,parentStore:i,pageId:a})&&r.unshift(a),r}function M(e){const{hrefOrBlockId:t,evaluatorState:n,parentStore:i}=e,l=o().tD.parseAssistantHref(t);if(!l||"block"===l.type){var c;const e=l?l.blockId:t,n=i&&(null===(c=a().B.createChildStore(i,{table:g().ev,id:e}).getNavigableBlockStore())||void 0===c?void 0:c.id),s=(0,r().ew)(n??e);return l?o().tD.blockIdToHref(s):s}if("helpdoc-section"===l.type){const e=null==n?void 0:n.getUniversalResultPayloadForHrefIfExists(l.href);return e&&"helpdoc-section"===e.type?e.parentPageHref:t}if("slack"===l.type||"gmail"===l.type||"microsoft-teams"===l.type){const e=null==n?void 0:n.getUniversalResultPayloadForHrefIfExists(l.href);return e&&("slack"===e.type||"microsoft-teams"===e.type||"gmail"===e.type)&&e.threadHref?e.threadHref:t}if("citation_unsupported"===l.type||"database_query_results"===l.type||"webpage"===l.type||"helpdoc"===l.type||(0,s().SC)(l.type))return t;(0,b().HB)(l.type)}function _(e){const{clientStep:t,searchResultsSteps:n,queryDatabaseSteps:l,parentStore:c,evaluatorState:d,currentPageId:u}=e,p=j({clientChatStep:t,searchResultsSteps:n,evaluatorState:d,parentStore:c,currentPageId:u}),m=y().sb(n.flatMap((e=>function(e){const{searchResultsStep:t,parentStore:n}=e,i=new Set;return(0,b().O9)(t.pageIds)?t.pageIds:(t.searchResults.forEach((e=>{var t;const s=null===(t=a().B.createChildStore(n,{table:g().ev,id:e}).getNavigableBlockStore())||void 0===t?void 0:t.id;s&&i.add(s)})),Array.from(i))}({parentStore:c,searchResultsStep:e})))),h=y().hS(n.flatMap((e=>function(e){const{searchResultsStep:t,evaluatorState:n,parentStore:a}=e;if(void 0===n)return[];const i=[];return t.searchResults.forEach((e=>{const t=o().tD.parseAssistantHref(e);if(!(0,b().O9)(t)||"block"===t.type||"citation_unsupported"===t.type||"database_query_results"===t.type)return;const r=M({hrefOrBlockId:t.href,evaluatorState:n,parentStore:a}),l=n.getUniversalResultPayloadForHrefIfExists((0,s().Ve)(r));l&&"page"!==l.type&&i.push(l)})),i}({searchResultsStep:e,evaluatorState:d,parentStore:c}))),(e=>e.href)),{pageCitations:v,databaseCitations:S,universalCitations:x}=t?function(e){const{parentStore:t}=e,{pageCitations:n,databaseCitations:i,universalCitations:o}=k(e),r=[];o.forEach((n=>{var a;const i=M({hrefOrBlockId:n.href,evaluatorState:e.evaluatorState,parentStore:t}),o=null===(a=e.evaluatorState)||void 0===a?void 0:a.getUniversalResultPayloadForHrefIfExists((0,s().Ve)(i));o&&"page"!==o.type&&r.push({...o})}));const l=n.reduce(((t,n)=>{var i;const s=null===(i=a().B.createChildStore(e.parentStore,n.pointer).getNavigableBlockStore())||void 0===i?void 0:i.id;return s?(t[s]||(t[s]={pointer:{table:g().ev,id:s},inlineCitedBlockIds:[]}),s!==n.pointer.id&&t[s].inlineCitedBlockIds.push(n.pointer.id),t):t}),{});return{pageCitations:Object.values(l),databaseCitations:i,universalCitations:r}}({clientStep:t,parentStore:c,citationOrdering:p,evaluatorState:d}):{pageCitations:[],databaseCitations:[],universalCitations:[]},I=v.length+S.length+x.length,w=[];[...h,...x].forEach((e=>{w.find((t=>t.href===e.href))||w.push(e)}));const C=y().sb([...m,...v.map((e=>e.pointer.id))]),A=new Map(v.map((e=>[e.pointer.id,e]))),_=C.map((e=>{const t=A.get(e),n={table:g().ev,id:e};return{pointer:n,store:a().B.createChildStore(c,n),inlineCitedBlockIds:(null==t?void 0:t.inlineCitedBlockIds)??[]}})),P=[],D=new(f().G)((()=>[]));for(const a of _){var E;const e=null===(E=a.store.getNavigableBlockStore())||void 0===E?void 0:E.getAssociatedCollectionId();D.get(e??"unassociated").push(a)}const R=new Map;for(const a of l){var B;const e=a.resultBlockIds??[],t=null===(B=a.ephemeralViewData)||void 0===B?void 0:B.assistantQueryDatabaseResultId;t&&R.set(t,e)}const F=new Set;for(const a of S){const e=a.pointer.id,t=D.get(e).filter((e=>{var t;return null===(t=R.get(a.queryDatabaseResultId))||void 0===t?void 0:t.includes(e.pointer.id)}));P.push({store:i().m.createChildStore(c,a.pointer),queryDatabaseResultId:a.queryDatabaseResultId,relatedPages:t}),t.forEach((e=>F.add(e.pointer.id)))}return{displayableCitations:[..._.filter((e=>!F.has(e.pointer.id))).map((e=>({type:"notion",id:(0,r().ew)(e.pointer.id),...e}))),...w].sort(((e,t)=>{const n=p.indexOf(T(e)),a=p.indexOf(T(t));return-1===n&&-1===a?0:-1===n?1:-1===a?-1:n-a})),databaseCitations:P,numberOfCitedResults:I}}},680369:(e,t,n)=>{n.d(t,{xr:()=>Me,ZX:()=>Pe});n(944114),n(898992),n(354520),n(672577),n(430670),n(803949),n(581454);var a=n(296540),i=()=>n(907258),s=()=>n(59226),o=()=>n(726637),r=()=>n(401497),l=()=>n(849255),c=()=>n(807449),d=()=>n(493552),u=()=>n(373009),p=()=>n(302501),g=()=>n(424400),m=()=>n(736847),h=()=>n(365646),f=()=>n(128424),y=()=>n(800204),v=()=>n(395797),S=(n(814603),n(147566),n(198721),()=>n(362750));var b=()=>n(450424),x=()=>n(126912),I=()=>n(651784),k=()=>n(96689),w=()=>n(798880),C=()=>n(201980),A=()=>n(69708),T=()=>n(100622),j=()=>n(498212),M=()=>n(534177),_=()=>n(703748),P=()=>n(687879),D=()=>n(246766),E=()=>n(699143),R=()=>n(453697),B=n(474848);function F(e){var t;const{coworker:n}=e,a=(0,r().IS)((()=>({container:{position:"sticky",top:0,background:T().Tj.background.primary,zIndex:2,boxShadow:`${T().Tj.background.primary} 0 4px 4px`}})),[]),i=n.coworkerEmail,s=null===(t=n.profile)||void 0===t?void 0:t.displayName;return i?(0,B.jsx)(E().Y1,{direction:"horizontal",align:"center-left",gap:10,padding:"8px 12px 8px 0",style:a.container,children:(0,B.jsx)(R().A,{type:s?"avatar-name-email":"avatar-name",avatar:{email:i,name:s||i},size:16})}):null}var N=()=>n(868859),L=()=>n(496603),O=()=>n(416783),V=()=>n(447587);function z(e){const{children:t,maxLines:n}=e,a=(0,r().IS)((()=>({moreButtonWrapper:{color:T().Tj.text.tertiary,display:"block",pointerEvents:"auto"}})),[]);return t?(0,B.jsx)(V().A,{maxLines:n,moreElement:(0,B.jsx)(d().D,{styleKey:"captionRegular",children:(0,B.jsxs)(O().V,{disableUnderline:!0,style:a.moreButtonWrapper,hoverColor:"blue",children:["","",(0,B.jsx)("span",{children:(0,B.jsx)(A().sA,{id:"comment.truncated.showMoreLabel",defaultMessage:"more"})})]})}),children:(0,B.jsx)(d().D,{styleKey:"captionRegular",colorVariant:"secondary",children:t})}):null}function W(e){const{calendarEvent:t,showAll:n}=e,i=function(e){return(0,L().My)((null==e?void 0:e.filter((e=>!e.isSelf&&"declined"!==e.responseStatus&&(e.email||e.displayName))))||[],[e=>e.isOrganizer?0:1,e=>"accepted"===e.responseStatus?0:"tentative"===e.responseStatus?1:"needsAction"===e.responseStatus?2:3,e=>e.isOptional?1:0,e=>e.displayName?0:1],["asc","asc","asc","asc"])}(null==t?void 0:t.attendees);return null!=i&&i.length?(0,B.jsx)(z,{maxLines:n?void 0:1,children:i.map(((e,t)=>(0,B.jsxs)(a.Fragment,{children:[t>0?", ":void 0,(0,B.jsx)(U,{attendee:e})]},t)))}):null}function U(e){const{attendee:t}=e,n=(0,r().IS)((()=>({link:{color:T().Tj.text.secondary,textDecoration:"none"}})),[]),a=t.displayName||t.email;return a?t.email?(0,B.jsx)("a",{style:n.link,href:`mailto:${t.email}`,children:a}):(0,B.jsx)("span",{children:a}):null}var H=()=>n(906745),K=()=>n(135428);function q(e){const{calendarEvent:t}=e,n=(0,A().tz)();if(null==t||!t.period)return null;const a=function(e){const{period:t,intl:n}=e,[a,i]="DATE"===t.type?[H().DateTime.fromISO(t.start.date),H().DateTime.fromISO(t.end.date)]:[H().DateTime.fromISO(t.start.dateTime),H().DateTime.fromISO(t.end.dateTime)];if(!a.isValid||!i.isValid)return;const s=a.year===i.year,o=a.toISODate()===i.toISODate();let r;r="DATE"===t.type?o?[$({dateTime:a,intl:n})]:[$({dateTime:a,intl:n,noYear:s}),$({dateTime:i,intl:n})]:[G({dateTime:a,intl:n}),G({dateTime:i,intl:n,noYear:s,noDate:o})];return r.join(`${K().iw}${K().u3}${K().iw}`).replaceAll(" ",K().iw)}({period:t.period,intl:n});return a?(0,B.jsx)(d().D,{styleKey:"captionRegular",colorVariant:"secondary",children:a}):null}function $(e){const{dateTime:t,intl:n,noYear:a}=e;return t.toLocaleString({...H().DateTime.DATE_MED_WITH_WEEKDAY,...a||H().DateTime.now().year===t.year?{year:void 0}:void 0},{locale:n.locale})}function G(e){const{dateTime:t,intl:n,noYear:a,noDate:i}=e,s=(0,K().iI)(n.locale),o=0!==t.minute||!s;return t.toLocaleString({...i?H().DateTime.TIME_SIMPLE:H().DateTime.DATE_MED_WITH_WEEKDAY,...a||H().DateTime.now().year===t.year?{year:void 0}:void 0,hour:"numeric",minute:o?"2-digit":void 0,hour12:s},{locale:n.locale})}function Y(e){var t,n,a,i,s;const{calendarEvent:o,detailed:r}=e,l=(0,N().Mr)({titleStartY:0,titleEndY:0,eventIndex:0,event:{isAllDay:!1,eventType:o.eventType,responseStatus:o.responseStatus,hasParticipants:Boolean(null===(t=o.attendees)||void 0===t?void 0:t.length),color:void 0},calendarColor:{type:"custom",colorHexes:{light:{backgroundPrimary:(null===(n=o.colors)||void 0===n?void 0:n.background)||(null===(a=o.colors)||void 0===a?void 0:a.foreground)||T().Tj.red.background.accentSecondary},dark:{backgroundPrimary:(null===(i=o.colors)||void 0===i?void 0:i.background)||(null===(s=o.colors)||void 0===s?void 0:s.foreground)||T().Tj.red.background.accentSecondary}}}});return(0,B.jsxs)(E().Y1,{direction:"horizontal",align:"center-left",gap:10,padding:"8px 12px",borderRadius:10,children:[(0,B.jsx)(E().Y1,{style:l,height:"fill",width:"hug"}),(0,B.jsxs)(E().Y1,{width:"fill",direction:"vertical",gap:4,padding:"4px 0px",children:[o.summary?(0,B.jsx)(d().D,{styleKey:"bodyMedium",children:o.summary}):void 0,(0,B.jsx)(q,{calendarEvent:o}),(0,B.jsx)(W,{calendarEvent:o,showAll:r}),(0,B.jsx)(z,{maxLines:r?void 0:1,children:o.location}),(0,B.jsx)(z,{maxLines:2,children:o.description})]})]})}function Q(e,t){return"DATE"===e.type?e[t].date:e[t].dateTime}function J(e){const{resultStep:t,environment:n}=e,a=function(e){const{environment:t,resultStep:n}=e;try{if((0,h().gY)(n,"calendar.listEvents"))return function(e){var t;const{environment:n,result:a}=e;if(null==a||null===(t=a.accounts)||void 0===t||!t.length)return;const i=[];for(const s of a.accounts)for(const e of s.calendars)i.push(...e.events);if(!i.length)return;return Z({environment:n,calendarEvents:i,detailed:!1})}({environment:t,result:n.result});if((0,h().gY)(n,"calendar.listCoworkersEvents"))return function(e){const{environment:t,result:n}=e;if(!n)return;if(null==n||!n.coworkers||!Array.isArray(n.coworkers))return;const a=[];for(const{events:i,...s}of n.coworkers){const e=X({coworker:s,environment:t});e&&a.push(e,...Z({environment:t,calendarEvents:i,detailed:!1})||[])}return a}({environment:t,result:n.result});if((0,h().gY)(n,"calendar.createEvents"))return function(e){var t;const{environment:n,input:a,result:i}=e;if(null!=i&&null!==(t=i.accounts)&&void 0!==t&&t.length){const e=[];for(const t of i.accounts)for(const n of t.calendars)e.push(...n.createdEvents);if(e.length)return Z({environment:n,calendarEvents:e,detailed:!1})}if(Array.isArray(null==a?void 0:a.events))return Z({environment:n,calendarEvents:a.events,detailed:!0})}({environment:t,input:n.input,result:n.result});if((0,h().gY)(n,"calendar.updateEvents"))return function(e){const{environment:t,result:n}=e;if(!n)return;if(null==n||!n.updatedEvents||!Array.isArray(n.updatedEvents))return;return Z({environment:t,calendarEvents:n.updatedEvents,detailed:!1})}({environment:t,result:n.result})}catch{}}({environment:n,resultStep:t});if(null!=a&&a.length)return[{key:t.id,render:e=>(0,B.jsx)(m().A,{...e}),items:a}]}function X(e){const{coworker:t}=e;if(null!=t&&t.coworkerEmail)return{key:`coworker-${t.coworkerEmail}`,action(){},render:e=>(0,B.jsx)(F,{coworker:t})}}function Z(e){const{calendarEvents:t,environment:n,detailed:a}=e;if(Array.isArray(t)&&t.length)return function(e){return(0,L().My)(e,[({period:e})=>Q(e,"start"),({period:e})=>Q(e,"end")],["asc","desc"])}(t).map((e=>function(e){const{calendarEvent:t,environment:n,detailed:a}=e,{eventId:i,webUrl:s,calendar:o}=t;return{key:`${JSON.stringify(o)}:${i||JSON.stringify(t)}`,action(){s&&(0,D().navigate)({environment:n,url:s,openInNew:"tab"})},render:e=>(0,B.jsx)(Y,{calendarEvent:t,detailed:a})}}({environment:n,calendarEvent:e,detailed:a}))).filter((e=>void 0!==e))}var ee=()=>n(129852);function te(e){const{from:t,to:n,subject:i,text:s}=e,o=(0,r().IS)((()=>({container:{paddingTop:12,paddingBottom:24,backgroundColor:T().Tj.background.primary,width:"100%",overflow:"hidden",gap:12,display:"flex",flexDirection:"column"},fieldRow:{display:"flex",alignItems:"flex-start",padding:"0 16px",gap:6},fieldLabel:{color:T().Tj.text.tertiary,width:60,flexShrink:0,fontWeight:400,display:"flex",alignItems:"center",gap:4},recipientDisplayName:{color:T().Tj.text.primary,fontWeight:400,flexShrink:0},recipientAddressWithoutName:{color:T().Tj.text.primary,fontWeight:400,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},recipientAddressWithName:{color:T().Tj.text.secondary,fontWeight:400,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},fieldValueContainer:{display:"flex",flexDirection:"column",alignSelf:"stretch",flex:1,minWidth:0},fieldValue:{display:"flex",gap:4,minWidth:0},subjectValue:{color:T().Tj.text.primary,flex:1,fontWeight:400},fieldEmptyValue:{color:T().Tj.text.tertiary,flex:1,fontWeight:400},bodyPreview:{padding:"0 16px",fontSize:14,color:T().Tj.blue.text.accentPrimary,whiteSpace:"pre-wrap",wordWrap:"break-word",boxSizing:"border-box"},lineHighlight:{display:"inline",backgroundColor:T().Tj.blue.background.secondaryTranslucent,padding:"0 4px",boxDecorationBreak:"clone",WebkitBoxDecorationBreak:"clone"},bodySeparator:{borderTop:`1px solid ${T().Tj.border.secondary}`}})),[]);return(0,B.jsxs)("div",{style:o.container,children:[null!=t&&t.address?(0,B.jsxs)("div",{style:o.fieldRow,children:[(0,B.jsx)("div",{style:o.fieldLabel,children:"From"}),(0,B.jsxs)("div",{style:o.fieldValue,children:[Boolean(t.name)?(0,B.jsx)("div",{style:o.recipientDisplayName,children:t.name}):void 0,(0,B.jsx)("div",{style:Boolean(t.name)?o.recipientAddressWithName:o.recipientAddressWithoutName,children:t.address})]})]}):void 0,n&&n.length>0?(0,B.jsxs)("div",{style:o.fieldRow,children:[(0,B.jsx)("div",{style:o.fieldLabel,children:"To"}),(0,B.jsx)("div",{style:o.fieldValueContainer,children:n.map(((e,t)=>(0,B.jsx)("div",{style:o.fieldValue,children:(0,B.jsxs)("div",{style:o.fieldValue,children:[Boolean(e.name)?(0,B.jsx)("div",{style:o.recipientDisplayName,children:e.name}):void 0,(0,B.jsx)("div",{style:Boolean(e.name)?o.recipientAddressWithName:o.recipientAddressWithoutName,children:e.address})]})},`${e.address}-${t}`)))})]}):(0,B.jsxs)("div",{style:o.fieldRow,children:[(0,B.jsxs)("div",{style:o.fieldLabel,children:["To",(0,B.jsx)(c().I,{icon:ee().exclamationMarkCircleIcon,size:"xs",colorPalette:"yellow",colorVariant:"accentPrimary"})]}),(0,B.jsx)("div",{style:o.fieldEmptyValue,children:"Missing recipient"})]}),(0,B.jsxs)("div",{style:o.fieldRow,children:[(0,B.jsx)("div",{style:o.fieldLabel,children:"Subject"}),Boolean(i)?(0,B.jsx)("div",{style:o.subjectValue,children:i}):(0,B.jsx)("div",{style:o.fieldEmptyValue,children:"(No subject)"})]}),Boolean(s)?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("div",{style:o.bodySeparator}),(0,B.jsx)("div",{style:o.bodyPreview,children:(s||"").split("\n").map(((e,t,n)=>(0,B.jsxs)(a.Fragment,{children:[e.trim().length>0?(0,B.jsx)("span",{style:o.lineHighlight,children:e}):void 0,t<n.length-1?"\n":void 0]},`${e.slice(0,10)}-${t}`)))})]}):void 0]})}var ne=()=>n(960674);var ae=()=>n(844317),ie=()=>n(207214),se=()=>n(827368),oe=()=>n(555102),re=()=>n(975366),le=(n(908872),()=>n(696706)),ce=()=>n(561190),de=()=>n(484714),ue=()=>n(35622),pe=()=>n(79075),ge=()=>n(738471),me=()=>n(360083);function he(e){const{fileUrl:t,permissionRecord:n}=e,i=(0,de().v3)(),s=(0,a.useRef)(null),[o,l]=(0,a.useState)(void 0),c=(0,r().IS)((()=>({container:{width:"100%",maxWidth:300,borderRadius:12,overflow:"hidden",border:`1px solid ${T().Tj.border.secondary}`},error:{padding:12},image:{display:"block",width:"100%",maxWidth:300,cursor:"zoom-in"}})),[]),u=(0,a.useCallback)((()=>{var e;if(!o)return;const t=null===(e=s.current)||void 0===e?void 0:e.getImageDimensions();t&&ue().o9({environment:i,renderFullScreenNode:()=>(0,B.jsx)(pe().A,{url:o,error:void 0,imageNaturalHeight:t.naturalHeight,imageNaturalWidth:t.naturalWidth}),fullScreenNodeRect:t.clientRect,contentAspectRatio:t.naturalWidth/Math.max(t.naturalHeight,1)})}),[i,o]),p=(0,a.useCallback)(((e,t)=>e||!t?(0,B.jsx)("div",{style:c.error,children:(0,B.jsx)(d().D,{styleKey:"captionRegular",colorVariant:"tertiary",children:(0,B.jsx)(A().sA,{id:"AgentBrowserScreenshot.loadError",defaultMessage:"Unable to load screenshot"})})}):(0,B.jsx)(ge().A,{src:t,ref:s,onClick:u,style:c.image,placeholderStyle:c.image,alt:"Browser screenshot"})),[u,c.error,c.image]);return n?(0,B.jsx)("div",{style:c.container,children:(0,B.jsx)(me().A,{isAuthenticated:!0,url:t,permissionRecord:n,onFinishedLoadingProxyUrl:l,render:p})}):(0,B.jsx)("div",{style:c.container,children:(0,B.jsx)("div",{style:c.error,children:(0,B.jsx)(d().D,{styleKey:"captionRegular",colorVariant:"tertiary",children:(0,B.jsx)(A().sA,{id:"AgentBrowserScreenshot.missingPermissionRecord",defaultMessage:"Unable to display screenshot"})})})})}function fe(e){var t,n,a;const{step:i}=e,s=(null===(t=i.input)||void 0===t?void 0:t.actions)??[],o=(0,r().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:12},actionRow:{display:"flex",flexDirection:"column",gap:8},actionText:{whiteSpace:"pre-wrap",wordBreak:"break-word"},resultBlock:{padding:12,borderRadius:8,background:T().Tj.gray.background.primary}})),[]),l=s.map(((e,t)=>s.slice(0,t).reduce(((e,t)=>e+("screenshot"===t.action?1:0)),0))),c=s.map(((e,t)=>{const n=function(e){switch(e.action){case"list":return"List tabs";case"create":return`Create tab "${e.tab}" at ${e.url}`;case"goto":return`Navigate tab "${e.tab}" to ${e.url}`;case"click":return`Click ${ye(e.x,e.y)} in tab "${e.tab}"`+(e.button?` (${e.button})`:"");case"double_click":return`Double click ${ye(e.x,e.y)} in tab "${e.tab}"`;case"scroll":return`Scroll in tab "${e.tab}" by (${e.scroll_x}, ${e.scroll_y}) from ${ye(e.x,e.y)}`;case"type":return`Type "${e.text}" in tab "${e.tab}"`;case"keypress":return`Press keys ${function(e){if(!Array.isArray(e))return"(unspecified)";const t=[];for(const n of e)"string"==typeof n&&t.push(n);if(0===t.length)return"(unspecified)";return t.join(" + ")}(e.keys)} in tab "${e.tab}"`;case"wait":return`Wait ${e.seconds}s in tab "${e.tab}"`;case"move":return`Move cursor to ${ye(e.x,e.y)} in tab "${e.tab}"`;case"drag":return function(e){if(!Array.isArray(e.path)||0===e.path.length)return`Drag with empty path in tab "${e.tab}"`;const t=e.path[0],n=e.path[e.path.length-1];return`Drag from ${ye(t.x,t.y)} to ${ye(n.x,n.y)} in tab "${e.tab}"`}(e);case"get_current_url":return`Get current URL in tab "${e.tab}"`;case"screenshot":return`Screenshot tab "${e.tab}"`;case"print_accessibility_tree":return`Capture accessibility tree in tab "${e.tab}"`;case"close":return`Close tab "${e.tab}"`;default:return(0,M().HB)(e),"Unknown browser action"}}(e);let a;if("screenshot"===e.action){const e=l[t],n=function(e,t){if(!e||"object"!=typeof e)return;const n=Reflect.get(e,"files");if(!Array.isArray(n))return;const a=n[t];if(!a||"object"!=typeof a)return;if("file"!==Reflect.get(a,"type"))return;const i=Reflect.get(a,"attachmentStep");if(!i||"object"!=typeof i)return;const s=Reflect.get(i,"fileUrl");if("string"!=typeof s)return;const o=function(e){if(!e||"object"!=typeof e)return;const t=Reflect.get(e,"table"),n=Reflect.get(e,"id"),a=Reflect.get(e,"spaceId");if("string"!=typeof t||!(0,ce().bI)(t))return;if("string"!=typeof n)return;if(void 0!==a&&"string"!=typeof a)return;if((0,le().w1)(t)){if("string"!=typeof a)return;return le().L3.fromPointerLike({table:t,id:n,spaceId:a})}return le().L3.fromPointerLike({table:t,id:n,spaceId:a})}(Reflect.get(i,"permissionRecord"));return{fileUrl:s,permissionRecord:o}}(i.result,e);n&&(a=(0,B.jsx)(he,{...n}))}return(0,B.jsxs)("div",{style:o.actionRow,children:[(0,B.jsx)(d().D,{styleKey:"bodyRegular",colorVariant:"secondary",style:o.actionText,children:n}),a]},`${t}-${n}`)})),u=(null===(n=i.result)||void 0===n?void 0:n.text)??"",p=(null===(a=i.result)||void 0===a?void 0:a.error)??"";return(0,B.jsxs)("div",{style:o.container,children:[c.length>0?c:null,u?(0,B.jsx)("div",{style:o.resultBlock,children:(0,B.jsx)(d().D,{styleKey:"bodyRegular",colorVariant:"primary",children:u})}):null,p?(0,B.jsx)("div",{style:o.resultBlock,children:(0,B.jsx)(d().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:p})}):null]})}function ye(e,t){return`(${e}, ${t})`}var ve=()=>n(571376);const Se=(0,A().YK)({input:{id:"AgentScriptToolVisualizer.input",defaultMessage:"Input"},output:{id:"AgentScriptToolVisualizer.output",defaultMessage:"Output"}});function be(e){var t;const{step:n}=e,i=n.result,s=Boolean((null==i?void 0:i.error)??n.error),o=("string"==typeof(null===(t=n.input)||void 0===t?void 0:t.function)&&n.input.function.length>0?n.input.function:void 0)??"Unknown function",l=(0,r().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:12},codeBlock:{borderRadius:8,padding:12,background:T().Tj.gray.background.primary},section:{display:"flex",flexDirection:"column",gap:6},functionName:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}})),[]),c=(0,a.useMemo)((()=>JSON.stringify(n.input??{},null,2)),[n.input]),u=(0,a.useMemo)((()=>{if(!i)return"No output";if(i.error)return`Error: ${i.error}`;if(void 0!==i.output)try{return JSON.stringify(JSON.parse(i.output),null,2)}catch{return i.output}return"No output"}),[i]);return(0,B.jsxs)("div",{style:l.container,children:[(0,B.jsx)(d().D,{styleKey:"bodySmRegular",colorVariant:"primary",style:l.functionName,children:o}),(0,B.jsxs)("div",{style:l.section,children:[(0,B.jsx)(d().D,{styleKey:"bodySmMedium",colorVariant:"secondary",children:(0,B.jsx)(A().sA,{...Se.input})}),(0,B.jsx)("div",{style:l.codeBlock,children:(0,B.jsx)(ve().O,{value:c,language:"json"})})]}),(0,B.jsxs)("div",{style:l.section,children:[(0,B.jsx)(d().D,{styleKey:"bodySmMedium",colorVariant:"secondary",children:(0,B.jsx)(A().sA,{...Se.output})}),(0,B.jsx)("div",{style:l.codeBlock,children:(0,B.jsx)(ve().O,{value:u,language:s?"text":"json"})})]})]})}const xe=(0,A().YK)({script:{id:"AgentNotionScriptToolVisualizer.script",defaultMessage:"Script"},output:{id:"AgentNotionScriptToolVisualizer.output",defaultMessage:"Output"}});function Ie(e){var t;const{step:n}=e,i=(null===(t=n.input)||void 0===t?void 0:t.code)??"",s=n.result,o=(0,r().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:12},codeBlock:{borderRadius:8,padding:12,background:T().Tj.gray.background.primary},section:{display:"flex",flexDirection:"column",gap:6}})),[]),l=(0,a.useMemo)((()=>{if(!s)return"No output";const e=s.typecheckErrors??[],t=s.runtimeError,n=s.logs??[],a=[],i=t||e.length>0?"Error":"Success";if(a.push(`Status: ${i}`),t||e.length>0){const n=[];t&&n.push(t),n.push(...e),a.push("Error:"),a.push(...n)}return a.push("Logs:"),0===n.length?a.push("(none)"):a.push(...n),a.join("\n")}),[s]);return(0,B.jsxs)("div",{style:o.container,children:[(0,B.jsxs)("div",{style:o.section,children:[(0,B.jsx)(d().D,{styleKey:"bodySmMedium",colorVariant:"secondary",children:(0,B.jsx)(A().sA,{...xe.script})}),(0,B.jsx)("div",{style:o.codeBlock,children:(0,B.jsx)(ve().O,{value:i,language:"typescript"})})]}),(0,B.jsxs)("div",{style:o.section,children:[(0,B.jsx)(d().D,{styleKey:"bodySmMedium",colorVariant:"secondary",children:(0,B.jsx)(A().sA,{...xe.output})}),(0,B.jsx)("div",{style:o.codeBlock,children:(0,B.jsx)(ve().O,{value:l,language:"text"})})]})]})}const ke=(0,A().YK)({completed:{id:"AgentTerminalToolVisualizer.completed",defaultMessage:"Completed"},background:{id:"AgentTerminalToolVisualizer.background",defaultMessage:"Running in background"},pid:{id:"AgentTerminalToolVisualizer.pid",defaultMessage:"PID {pid}"},statusCode:{id:"AgentTerminalToolVisualizer.statusCode",defaultMessage:"Exit code {code}"}});function we(e){var t,n,i,s,o;const{step:l}=e,c=(null===(t=l.input)||void 0===t?void 0:t.command)??"",u=(null===(n=l.result)||void 0===n?void 0:n.output)??"",p=(null===(i=l.result)||void 0===i?void 0:i.finished)??!1,g=null===(s=l.result)||void 0===s?void 0:s.statusCode,m=null===(o=l.result)||void 0===o?void 0:o.processId,h=(0,r().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:12},codeBlock:{borderRadius:8,padding:12,background:T().Tj.gray.background.primary},metadata:{display:"flex",flexWrap:"wrap",gap:12}})),[]),f=(0,a.useMemo)((()=>{const e=["> "+c];return e.push(""),u.length>0&&e.push(u),e.join("\n")}),[c,u]);return(0,B.jsxs)("div",{style:h.container,children:[(0,B.jsx)("div",{style:h.codeBlock,children:(0,B.jsx)(ve().O,{value:f,language:"text"})}),(0,B.jsxs)("div",{style:h.metadata,children:[p?(0,B.jsx)(d().D,{styleKey:"captionRegular",colorVariant:"tertiary",children:(0,B.jsx)(A().sA,{...ke.completed})}):(0,B.jsx)(d().D,{styleKey:"captionRegular",colorVariant:"tertiary",children:(0,B.jsx)(A().sA,{...ke.background})}),void 0!==m?(0,B.jsx)(d().D,{styleKey:"captionRegular",colorVariant:"tertiary",children:(0,B.jsx)(A().sA,{...ke.pid,values:{pid:m}})}):null,void 0!==g?(0,B.jsx)(d().D,{styleKey:"captionRegular",colorVariant:"tertiary",children:(0,B.jsx)(A().sA,{...ke.statusCode,values:{code:g}})}):null]})]})}var Ce=()=>n(124972);const Ae=(0,A().YK)({statusSuccess:{id:"agentInference.status.success",defaultMessage:"Successfully finished task"},statusFailed:{id:"agentInference.status.failed",defaultMessage:"Failed to finish task"},improveAgentButton:{id:"agentInference.improveAgent.button",defaultMessage:"Improve this agent"},fixAgentButton:{id:"agentInference.fixAgent.button",defaultMessage:"Fix this agent"}});function Te(e){const{bodyStyleKey:t}=(0,se().yq)(),n=(0,se().Cd)(t);return(0,B.jsx)(p().A,{isSecondaryColor:!0,style:n,children:(0,B.jsx)(re().h,{markdown:e.markdown})})}function je(e){const t="<lang ",n=/<lang[^>]*\/?>/i,a=(i=e,i.replace(/\{\{([^{}]+)\}\}/g,((e,t)=>{const n=t.match(/^\[prefix=([^\]]+)\](.+)$/);return n?n[2]:t}))).split(/\n\n\n+/);var i;const s=[];let o="";for(let r=0;r<a.length;r++){const e=o+a[r].trim();if(o="",e.startsWith(t)||t.startsWith(e)){if(e.match(n)){const t=e.replace(n,"").trim();t&&s.push(t)}else o=e}else e&&s.push(e)}return{processedParts:s,buffer:o}}function Me(e){const{step:t,toolResultsForStep:n,threadStore:a,runningInference:i,queryGenStepMapToSearchCallId:s}=e;if("string"==typeof t.value&&t.value.includes("__databaseAgentSetup"))try{if(JSON.parse(t.value).__databaseAgentSetup){return[{type:"database-agent-setup",isFinished:!0,key:`database-agent-setup-${t.id}`,step:t}]}}catch(u){}if("string"==typeof t.value&&t.value.includes("__databaseAgentRunning"))try{if(JSON.parse(t.value).__databaseAgentRunning){return[{type:"database-agent-running",key:`database-agent-running-${t.id}`,step:t,isFinished:!0}]}}catch(p){}const r=[...(t.previousAttemptValues??[]).flatMap(S().lH).filter((e=>"tool_use"!==e.type)),...(0,S().lH)(t.value)],l=[],c=function(e){const{threadStore:t}=e,n=t.getMessageStores().map((e=>e.getStep())).filter(M().O9),a=(0,f().P)({transcript:n,domainBaseUrl:o().A.domainBaseUrl}),i=function(e){const{transcript:t}=e,n={};return t.map((e=>{"agent-tool-result"===(null==e?void 0:e.type)&&e.result&&"object"==typeof e.result&&"citationContext"in e.result&&Object.assign(n,e.result.citationContext)})),n}({transcript:n}),s={...a,...i};return s}({threadStore:a}),d=function({chunks:e,toolResultsForStep:t}){const n=[];for(let a=0;a<e.length;a++){const i=e[a];if("thinking"===i.type){i.content.trim()&&n.push({type:"thinking",content:i.content.trim(),isLastThinkingPart:a===e.length-1,startedAt:i.startedAt,finishedAt:i.finishedAt})}else if("text"===i.type){i.content.trim()&&n.push({type:"text",content:i.content.trim()})}else if("tool_use"===i.type){const e=t.find((e=>e.toolCallId===i.id));n.push({type:"tool_use",toolUse:i,toolResultStep:e,id:i.id})}else"follow_ups"===i.type?i.followUps.length>0&&n.push({type:"follow_ups",followUps:i.followUps}):"custom_agent_template_picker"===i.type&&n.push({type:"custom_agent_template_picker"})}return n}({chunks:r,toolResultsForStep:n});for(const[o,g]of d.entries())if("thinking"===g.type){const{isLastThinkingPart:e,content:n,startedAt:a,finishedAt:i}=g,s=!e&&i&&a?i-a:void 0,r={type:"thinking",key:`thinking-${t.id}-${o}`,content:n,isLastThinkingPart:e,step:t,isFinished:!e,durationMs:s};l.push(r)}else if("text"===g.type){const{content:e}=g,{processedParts:n}=je(e);n.forEach(((e,n)=>{const a={type:"chat",key:`text-${t.id}-${o}-${n}`,markdown:e,citationContext:c,step:t,isFinished:!0};l.push(a)}))}else if("tool_use"===g.type){const e=_e({toolUse:g.toolUse,step:t,toolResultStep:g.toolResultStep,runningInference:i,queryGenStepMapToSearchCallId:s});e&&l.push(e)}else if("follow_ups"===g.type){if(g.followUps.length>0){const e={type:"follow-ups",key:`follow-ups-${t.id}-${o}`,followUps:g.followUps,step:t,isFinished:!0};l.push(e)}}else if("custom_agent_template_picker"===g.type){const e={type:"custom-agent-template-picker",key:`custom-agent-template-picker-${t.id}-${o}`,step:t,isFinished:!0};l.push(e)}return l}function _e(e){var t;const{queryGenStepMapToSearchCallId:n,runningInference:a,step:i,toolResultStep:s,toolUse:o}=e;if(!a&&s&&!(0,v().nP)(s)&&!(0,v().I6)(s))return;if(!((0,y().U3)(o.name)||s&&((0,y().U3)(s.toolType)||(0,y().og)(s.toolType))))return;const r=s&&((0,y().U3)(s.toolType)||(0,y().og)(s.toolType))?s.toolType:((0,y().U3)(o.name),o.name),l=Boolean(s&&(0,v().nP)(s));if("search"===r)return{type:"search-tool-use",key:`search-tool-${o.id}`,toolName:r,toolUse:o,toolResultStep:s,step:i,isFinished:l,queryGenSteps:n.get(o.id)||[]};if("mcpServer.runTool"===r&&"mail.runTool"===(null==s?void 0:s.toolType))return{type:"tool-use",key:`tool-use-${o.id}`,toolName:"mail.runTool",toolUse:o,toolResultStep:s,step:i,isFinished:l};if("mcpServer.runTool"===r&&s&&(0,h().gY)(s,"mcpServer.runTool")&&"mcpServer"===(null===(t=s.moduleInfo)||void 0===t?void 0:t.type)){const e=s.moduleInfo.name||"MCP Server",t=s.toolTitle||"tool";return{type:"mcp-tool-use",key:`mcp-tool-${o.id}`,toolName:"mcpServer.runTool",serverName:e,mcpToolName:t,toolUse:o,toolResultStep:s,step:i,isFinished:l}}return{type:"tool-use",key:`tool-use-${o.id}`,toolName:r,toolUse:o,toolResultStep:s,step:i,isFinished:l}}function Pe(e){var t;const{environment:n,spaceStore:a,threadStore:i,toolResultStep:s}=e;if(s)switch(s.toolType){case"query-data-sources":if(!(0,h().gY)(s,"query-data-sources"))return;const e=null===(t=s.result)||void 0===t||null===(t=t.results)||void 0===t?void 0:t.map((e=>function(e){if("object"!=typeof e||!e)return;if("id"in e&&"string"==typeof e.id&&(0,j().uj)(e.id))return e.id;if("url"in e&&"string"==typeof e.url){const t=(0,I().bn)(e.url);return(0,j().uj)(t)?t:(0,j().parseUUIDWithoutDashes)(t)}}(e))).map(((e,t)=>e?(0,Ce().L)({index:t,environment:n,spaceStore:a,threadStore:i,blockId:e}):void 0)).filter(M().O9);if(null==e||!e.length)return;return[{key:`${s.id}-results`,render:e=>(0,B.jsx)(m().A,{...e}),items:e}];case"result":if(!(0,h().gY)(s,"result"))return;return function({result:e,environment:t,spaceStore:n}){if(!e.result)return[];const{success:a,message:i,reflection:s}=e.result,o=[];if(o.push({key:"result-status",render:t=>(0,B.jsx)(g().Ay,{...t,title:(0,B.jsx)(p().A,{isSecondaryColor:!0,style:{height:24,display:"flex",alignItems:"center"},children:(0,B.jsx)(A().sA,{...a?Ae.statusSuccess:Ae.statusFailed})}),caption:(0,B.jsx)(Te,{markdown:i?je(i).processedParts.join("\n\n"):""}),shouldWrapCaption:De(e.toolType),icon:(0,B.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24},children:a?(0,B.jsx)(c().I,{icon:b().checkmarkCircleFillSmallIcon,size:"sm",colorPalette:"green",colorVariant:"accentPrimary"}):(0,B.jsx)(c().I,{icon:x().xMarkCircleFillSmallIcon,size:"sm",colorPalette:"red",colorVariant:"accentPrimary"})}),allowTextSelection:!0,desktopIconStyle:{marginTop:0,minWidth:void 0,minHeight:void 0},style:{padding:0},captionStyle:{marginTop:8}}),action:()=>{}}),s&&(0,y().jm)(s)&&t&&n&&e.result){const i=JSON.stringify(e.result,null,2);o.push({key:"result-improve-agent",render:()=>(0,B.jsx)("div",{style:{paddingTop:16},children:(0,B.jsx)(Ee,{resultJson:i,environment:t,spaceStore:n,success:a})}),action:()=>{}})}return[{key:"result",render:e=>(0,B.jsx)(m().A,{...e,disableDesktopPadding:!0}),items:o}]}({result:s,environment:n,spaceStore:a});case"exit-setup-mode":{var o,r;if(!(0,h().gY)(s,"exit-setup-mode"))return;const e=(null===(o=s.result)||void 0===o?void 0:o.summary)??(null===(r=s.input)||void 0===r?void 0:r.result);if(!e)return;return[{key:`${s.id}-exit-setup-mode`,items:[],render:t=>(0,B.jsx)(m().A,{...t,children:(0,B.jsx)(d().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:e})})}]}case"search":case"search.autosearch":case"queryMail":case"queryCalendar":case"view":case"view-notifications":case"view-version-history":case"view-database-files":case"view-channel":case"view-slack-channel":case"view-code-repo":case"create-database":case"update-database":case"update-database-data-sources":case"update-database-views":case"update-database-triggers":case"error":case"create-pages":case"update-page":case"update-page-v2":case"delete-pages":case"revert":case"create-agent":case"create-agent-v2":case"update-agent":case"update-agent-v2":case"delete-agent":case"generate-image":case"images.generate":case"toggle-user-integration-tools":case"update-user-integrations":case"edit-json":case"query-salesforce-tool":case"mcpServer.getPrompt":case"mcpServer.listPrompts":case"mcpServer.listResources":case"mcpServer.readResource":case"mcpServer.runTool":case"mcpServer.listTools":case"slack.addReactionToMessage":case"slack.createThreadInChannel":case"slack.createThreadInDirectMessage":case"slack.findUserByEmail":case"slack.getThreadsInChannelSince":case"slack.getUser":case"slack.parseSlackUriOrUrl":case"slack.queryChannels":case"slack.removeReactionFromMessage":case"slack.replyInThread":case"slack.updateMessage":case"notion.addCommentToDiscussion":case"notion.getPageDiscussions":case"notion.sendNotification":case"mail.getPrompt":case"mail.listTools":case"files.getFileContent":case"files.getFileName":case"files.getFileUrl":case"cursor.createAgent":case"cursor.addFollowup":case"cursor.getAgent":case"cursor.listRepositories":case"summarize-meeting-note":case"update-todos":case"wait":case"calendar.fetchPlaybook":case"list-machines":case"create-machine":case"destroy-machine":case"query-agent-threads":case"investigate-agent-thread":case"run-agent":case"worker.listTools":case"worker.runTool":case"workers.list":case"notion.querySql":case"notion.queryView":return;case"mail.runTool":if(!(0,h().gY)(s,"mail.runTool"))return;return function(e){const{toolResultStep:t}=e;if(t&&(0,h().gY)(t,"mail.runTool")&&t.input&&(0,ne().D)(t.toolName)){const e=t.input,n=null==e?void 0:e.subject,a=null==e?void 0:e.to,i=null==e?void 0:e.from,s=[],o=Array.isArray(i)&&i.length>0?i[0]:i&&"object"==typeof i&&"address"in i?i:void 0,r=Array.isArray(a)&&a.length>0?a:void 0,l=n,c=null==e?void 0:e.text;return s.push({key:`mail-compose-${t.id}`,render:e=>(0,B.jsx)(te,{from:o,to:r,subject:l,text:c}),action:()=>{}}),[{key:`mail-run-tool-${t.id}`,render:e=>(0,B.jsx)(m().A,{...e,disableDesktopPadding:!0}),items:s}]}}({environment:n,spaceStore:a,toolResultStep:s});case"calendar.listCalendars":case"calendar.listEvents":case"calendar.listCoworkersEvents":case"calendar.createEvents":case"calendar.updateEvents":case"calendar.cancelEvents":case"calendar.suggestMeetingTimes":return J({environment:n,resultStep:s});case"terminal":if(!(0,h().gY)(s,"terminal"))return;return[{key:`${s.id}-terminal-visualizer`,items:[],render:e=>(0,B.jsx)(m().A,{...e,disableDesktopPadding:!0,disableMobilePadding:!0,children:(0,B.jsx)(we,{step:s})})}];case"browser":if(!(0,h().gY)(s,"browser"))return;return[{key:`${s.id}-browser-visualizer`,items:[],render:e=>(0,B.jsx)(m().A,{...e,disableDesktopPadding:!0,disableMobilePadding:!0,children:(0,B.jsx)(fe,{step:s})})}];case"callFunction":if(!(0,h().gY)(s,"callFunction"))return;return[{key:`${s.id}-callFunction-visualizer`,items:[],render:e=>(0,B.jsx)(m().A,{...e,disableDesktopPadding:!0,disableMobilePadding:!0,children:(0,B.jsx)(be,{step:s})})}];case"runScript":if(!(0,h().gY)(s,"runScript"))return;return[{key:`${s.id}-runScript-visualizer`,items:[],render:e=>(0,B.jsx)(m().A,{...e,disableDesktopPadding:!0,disableMobilePadding:!0,children:(0,B.jsx)(Ie,{step:s})})}];case"computer.listMachines":case"computer.listSecrets":case"computer.createMachine":case"computer.destroyMachine":case"computer.setSecret":case"computer.terminal":case"computer.browser":case"computer.getJobStatus":case"computer.getJobLogs":case"modules.list":case"modules.create":case"modules.update":case"modules.delete":case"test.getState":case"fs.readDir":case"fs.readFiles":case"notion.createDatabase":case"notion.updateDatabase":case"notion.createAgent":case"notion.loadAgent":case"notion.loadUser":case"notion.updateAgent":case"notion.loadDatabase":case"notion.loadDataSource":case"notion.getFormulaValue":case"notion.loadPage":case"notion.createPage":case"notion.updatePage":case"notion.queryThreads":case"notion.investigateThread":case"notion.createAndRunThread":case"notion.viewFileUrl":case"computer.viewFileUrl":case"slack.viewFileUrl":case"enter-setup-mode":case"asana.search":case"box.search":case"discord.search":case"github.search":case"github.grepCode":case"github.lsDirectory":case"github.loadPR":case"github.loadIssue":case"github.loadCommit":case"github.loadFile":case"gmail.search":case"gmail.loadThread":case"gmail.query":case"googleDrive.search":case"googleDrive.loadFile":case"googleCalendar.search":case"googleCalendar.query":case"jira.search":case"jira.loadIssue":case"linear.search":case"linear.loadIssue":case"microsoftTeams.search":case"microsoftTeams.loadMessage":case"microsoftTeams.viewChannel":case"microsoftTeams.viewChat":case"outlook.search":case"outlook.loadMessage":case"outlook.loadThread":case"outlook.query":case"asana.loadTask":case"sharepoint.loadFile":case"slack.loadMessage":case"salesforce.search":case"sharepoint.search":case"slack.search":case"web.search":case"web.loadPage":return[];default:(0,M().HB)(s.toolType)}}function De(e){return"result"===e}function Ee(e){const{resultJson:t,environment:n,spaceStore:o,success:r}=e,c=(0,A().tz)(),d=(0,s().X)("custom-agents-fix-me-button"),p=a.useCallback((()=>{const e=i().default.state.mainEditorCurrentBlockStore||(0,ie().k)(n);if(!e)return;const a=`This custom agent ran into some issues. Please do your best to fix the issues and improve the agent, presumably by Updating the Agent's settings or system prompts in order to fix it. If it is ever unclear what the desired behavior should be, please ask the user for clarification. You're authorized to make changes you think are necessary, since the user will be asked to review the changes. Your changes should be the minimal possible changes to get the agent to work. Eg if the agent is failing because of a missing tool, you should add the tool to the agent and change nothing else. When making permissions changes, please first view the pages or databases for which you're changing permissions to best understand how they're structured. Here is the result from the last run \n ${t}`,s=c.formatMessage({id:"agentInference.fixThisAgent.injectedMessage",defaultMessage:"Fix this agent"}),r=oe().bX.state;if(!r)return;const d=n.currentUser.id;if(!d)return;const u=l().L.createChildStore(o,{table:w().oo,id:d}),p=(0,oe().uP)({environment:n,spaceStore:o,userStore:u,actualMessage:(0,C().x9d)(a),displayMessage:(0,C().x9d)(s)}),g=(0,ae().getWorkflowAgentConfig)({isCustomAgent:!1,environment:n,spaceId:o.id}),m={...r,blockStore:"block"===e.table?e:r.blockStore,workflowStore:"workflow"===e.table?e:r.workflowStore},h=(0,oe().Xd)({environment:n,inferenceContext:m,config:g,addSteps:[p],surface:"custom_agent"}),f=(0,P().addTranscriptToNewThreadAndRun)({environment:n,spaceStore:o,transcript:h,parentPointer:{table:k().NX,id:o.id,spaceId:o.id},createdSource:"custom_agent"});(0,_().openChatPanel)({environment:n,store:e,chatPanelState:{isOpen:!0,threadId:f.id}})}),[t,n,c,o]);return d?(0,B.jsx)(u().E,{onClick:p,children:c.formatMessage(r?Ae.improveAgentButton:Ae.fixAgentButton)}):null}},680683:(e,t,n)=>{n.d(t,{B:()=>v});n(944114),n(898992),n(354520),n(581454);var a=n(296540),i=()=>n(590526),s=()=>n(250910),o=()=>n(663639),r=()=>n(736847),l=()=>n(245241),c=()=>n(69708),d=()=>n(100622),u=()=>n(71304),p=()=>n(135599),g=()=>n(305390),m=()=>n(320865),h=n(474848);const f=(0,c().YK)({placeholder:{id:"pageSelector.placeholder",defaultMessage:"Search for a page or database..."},placeholderDatabasesOnly:{id:"pageSelector.placeholderDatabasesOnly",defaultMessage:"Search for a database..."},placeholderPagesOnly:{id:"pageSelector.placeholderPagesOnly",defaultMessage:"Search for a page..."},pagesSection:{id:"pageSelector.pagesSection",defaultMessage:"Pages"},collectionsSection:{id:"pageSelector.collectionsSection",defaultMessage:"Databases"}});function y({value:e,onChange:t,placeholder:y,width:v=300,disabled:S=!1,searchOptions:b,hidePages:x=!1,showCollections:I=!1,pagesSectionTitle:k,collectionsSectionTitle:w,excludedBlockIds:C=[],peopleBlocksToInclude:A,renderOrigin:T,renderSections:j},M){const _=(0,n(484714).v3)(),P=(0,c().tz)(),[D,E]=(0,a.useState)(""),R=(0,i().O$)(n(907258).AppStoreSidebarSpaceStore),B=(0,i().uB)(void 0,n(452004).$),[F,N]=(0,n(791177).$)(),L=(0,n(401497).IS)((()=>({selectorButton:{paddingTop:8,paddingBottom:8,paddingInlineStart:8,paddingInlineEnd:8,opacity:S?.4:1,width:v,border:`1px solid ${d().Tj.border.secondary}`,justifyContent:"space-between",borderRadius:4,backgroundColor:d().Tj.background.primary},chevronIcon:{marginInlineStart:4},selectedText:{color:d().Tj.text.primary,fontSize:14,fontWeight:"medium"},placeholderText:{color:d().Tj.text.secondary,fontSize:14}})),[S,v]),O=(0,i().K8)((()=>{if(!e||!R)return null;const t="block"===e.table?new(n(295633).B)(_,e):new(n(732810).m)(_,e);return t.getModel()?{id:e,store:t}:null}),[R,_,e]),V=(0,p().W)({type:l().Vz.BlocksInSpace,query:D,source:b.source,excludedBlockIds:C,limit:5,filters:{blockTypes:["page"]},options:{disable:x||!D},peopleBlocksToInclude:A}),z=(0,i().K8)((()=>D&&V.results.length>0?V.results.map((e=>({id:e.id,store:e.store}))):(n(825972).wI.state||[]).filter((e=>{const t=e.store.getModel();return"page"===(null==t?void 0:t.type)})).slice(0,5).map((e=>({id:e.pageId,store:e.store})))),[D,V.results]),W=(0,p().W)({type:l().Vz.CollectionsInSpace,query:D,source:b.source,excludedBlockIds:C,limit:5,options:{disable:!I},peopleBlocksToInclude:A}),U=(0,a.useMemo)((()=>W.results.length>0?W.results.map((e=>({id:e.id,store:e.store,collectionId:e.collectionId}))):[]),[W.results]),H=(0,a.useMemo)((()=>x&&I?P.formatMessage(f.placeholderDatabasesOnly):x||I?P.formatMessage(f.placeholder):P.formatMessage(f.placeholderPagesOnly)),[x,I,P]),K=(0,i().K8)((()=>O?(0,u().Jq)(O.store,P,_)??(0,u().gG)(O.store,P):y||H),[O,y,H,P,_]),q=(0,a.useCallback)((e=>{null==t||t(e),E(""),B.unsetFocus()}),[t,B]),$=(0,a.useMemo)((()=>{let e=[];e.push({key:"search",render:()=>(0,h.jsx)(r().A,{isInput:!0,children:(0,h.jsx)(n(419357).Ay,{placeholder:H,value:D,onChange:e=>E(e.target.value),inputElementAttributes:F.inputElementAttributes,suppressFocusRing:F.suppressFocusRing,onFocus:F.onFocus,onBlur:F.onBlur})}),items:[]});const t=z&&z.length>0,a=V.isResultsLoading;if(!x){const n=[...t?z.map((e=>({key:e.id,action:()=>q(e),render:t=>(0,h.jsx)(g().A,{...t,store:e.store,showTooltipOnOverflow:!0})}))):[],...a?[{key:"loading-pages-item",action:()=>{},render:()=>(0,h.jsx)(m().A,{})}]:[]];e.push({key:"pages",render:e=>(0,h.jsx)(r().A,{title:k||(0,h.jsx)(c().sA,{...f.pagesSection}),children:e.children}),items:n,showNoResultMessage:!a&&!t})}const i=U&&U.length>0,s=W.isResultsLoading;if(I){const t=[...i?U.map((e=>({key:e.id,action:()=>q(e),render:t=>(0,h.jsx)(g().A,{...t,store:e.store,showTooltipOnOverflow:!0})}))):[],...s?[{key:"loading-collections-item",action:()=>{},render:()=>(0,h.jsx)(m().A,{})}]:[]];e.push({key:"collections",render:e=>(0,h.jsx)(r().A,{title:w||(0,h.jsx)(c().sA,{...f.collectionsSection}),children:e.children}),items:t,showNoResultMessage:!s&&!i})}return j&&(e=j(e)),e}),[V.isResultsLoading,z,D,q,F,W.isResultsLoading,U,x,I,k,w,H,j]);return(0,h.jsx)(s().A,{ref:M,popupType:s().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"end",disabled:S,renderOrigin:T??(e=>(0,h.jsxs)(n(631524).p,{...e,style:L.selectorButton,disabled:S,children:[(0,h.jsx)(n(249046).Ye,{alignItems:"center",style:{minWidth:0},children:(0,h.jsx)(n(302501).A,{style:O?L.selectedText:L.placeholderText,children:K})}),(0,h.jsx)(n(807449).I,{icon:n(324254).arrowChevronSingleDownSmallIcon,size:"xxs",colorVariant:"tertiary",style:L.chevronIcon})]})),render:()=>(0,h.jsx)(n(890492).A,{menuType:n(546926).gu.Popup,width:v,maxHeight:400,children:(0,h.jsx)(o().A,{type:o().O.Vertical,initialFocus:void 0,store:B,comboboxProps:N,sections:$})})})}const v=a.forwardRef(y)},682759:(e,t,n)=>{n.d(t,{s:()=>a});const a=(0,n(340498).xh)("book",{default:{loader:()=>n.e(96166).then(n.bind(n,605777))},small:{loader:()=>n.e(96166).then(n.bind(n,852219))},fill:{loader:()=>n.e(96166).then(n.bind(n,488017))},fillSmall:{loader:()=>n.e(96166).then(n.bind(n,821080))}},["book","open","literature","education","reading"])},683886:(e,t,n)=>{n.d(t,{J:()=>s});n(296540);var a=n(474848);const i={viewBox:"0 0 16 16",fittedViewBox:"3.37 2.12 12.04 13.29",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M5.25 2.125c-1.036 0-1.875.84-1.875 1.875v8c0 1.036.84 1.875 1.875 1.875h3.348l-.076-.116a3.9 3.9 0 0 1-.497-1.08l-.015-.054H5.25A.625.625 0 0 1 4.625 12V4c0-.345.28-.625.625-.625h5.5c.345 0 .625.28.625.625v3.697l.082-.007a4 4 0 0 1 1.079.054l.089.017V4c0-1.036-.84-1.875-1.875-1.875z"}),(0,a.jsx)("path",{d:"M5.75 4.175a.575.575 0 1 0 0 1.15h4.5a.575.575 0 1 0 0-1.15zm0 2a.575.575 0 1 0 0 1.15h4.5a.575.575 0 1 0 0-1.15zm6.05 2.4a3.025 3.025 0 1 0 1.62 5.58l.91 1.056a.625.625 0 0 0 .94-.823l-.954-1.108A3.025 3.025 0 0 0 11.8 8.575M10.025 11.6a1.775 1.775 0 1 1 3.55 0 1.775 1.775 0 0 1-3.55 0"})]})},s=(0,n(340498).wt)("docTextMagnifyingGlassSmall",i,"small")},685453:(e,t,n)=>{n.d(t,{H:()=>r});var a=()=>n(483730),i=()=>n(140022),s=()=>n(50744),o=()=>n(622595);async function r(e){const t=Date.now(),n=a().default.getSessionContextOrThrow(e.sessionId);i().trackInferenceStart({environment:e.environment,configurationState:null==n?void 0:n.assistantConfigurationStoreState,inferenceId:e.inferenceId,source:e.inferenceStartMetadata.source,skillType:e.inferenceStartMetadata.skillType,from:e.assistantSurfaceType,mentionsUsed:e.inferenceStartMetadata.mentionsUsed}),await n.withCurrentHumanStepSubmission((async n=>{await(0,s().f)({...e,updater:n});const a=n.getReadOnlySessionContext();(0,o().X)({environment:e.environment,assistantSessionContext:a,inferenceId:e.inferenceId,timeTook:Date.now()-t,parentStore:e.inferenceEndMetadata.parentStore,transcript:[...a.evaluatorFromStoreState.getTranscript(),...a.previewingStepFromStoreState?[a.previewingStepFromStoreState]:[]],from:e.assistantSurfaceType,skillType:e.inferenceEndMetadata.skillType,wasSkillSuggested:e.inferenceEndMetadata.wasSkillSuggested,selectedSkillCategoryOverride:e.inferenceEndMetadata.selectedSkillCategoryOverride})}))}},689825:(e,t,n)=>{n.d(t,{U:()=>i});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.25 15.25",directional:!0,svg:(0,n(474848).jsx)("path",{d:"M10 17.625a7.625 7.625 0 1 1 0-15.25 7.625 7.625 0 0 1 0 15.25m-1.046-4.769 3.834-2.236a.718.718 0 0 0 0-1.24L8.954 7.144a.718.718 0 0 0-1.079.62v4.472c0 .554.6.9 1.08.62"})},i=(0,n(340498).wt)("arrowTriangleRightCircleFill",a,"fill")},700461:(e,t,n)=>{n.d(t,{A:()=>g});n(898992),n(581454),n(737550);var a=()=>n(414783),i=(a(),n.n(n(444802))),s=n.n(n(923280)),o=n.n(n(309264)),r=n.n(n(984834)),l=n.n(n(214808)),c=()=>n(209199);function d(e){return{maxPointWidth:16,borderRadius:2,pointPadding:.22,groupPadding:.22,borderColor:e.background.primary,borderWidth:.5}}function u(e){return{dataLabels:{...p(e)},lineWidth:1.25,states:{hover:{lineWidth:1.25}},marker:{states:{hover:{radius:3,lineColor:e.background.primary}},symbol:"circle",enabled:!1}}}function p(e){return{style:{fontWeight:"normal",color:e.text.secondary,textOutline:"none",fontSize:"12px"},x:-1}}s()(a()),o()(a()),r()(a()),i()(a()),l()(a());const g=function(e){return{chart:{inverted:!1,animation:!1,backgroundColor:"transparent",style:{cursor:"default",fontSize:"12px",fontFamily:n(284371).Tf.sans},marginTop:20},colors:["#2383E2"],xAxis:{title:{margin:16,style:{color:e.text.primary,fontWeight:"600",fontSize:"12px"}},crosshair:{color:e.buttonHoveredBackground},labels:{distance:8,style:{color:e.text.secondary,fontSize:"12px",textOverflow:"ellipsis",overflow:"hidden"}},lineColor:e.border.primary,lineWidth:1,gridLineDashStyle:"Dot",gridLineColor:e.border.primary,gridLineWidth:1.25,tickWidth:0,tickColor:e.border.primary,minPadding:0,maxPadding:0,dateTimeLabelFormats:{day:"%b %e",week:"%b %e"},tickPixelInterval:100},yAxis:{title:{margin:16,style:{color:e.text.primary,fontWeight:"600",fontSize:"12px"}},labels:{distance:8,style:{color:e.text.secondary,fontSize:"12px"}},stackLabels:{...p(e)},lineColor:e.border.primary,lineWidth:1,gridLineDashStyle:"Dot",gridLineColor:e.border.primary,gridLineWidth:1.25,allowDecimals:!1},plotOptions:{column:{dataLabels:{...p(e)},...d(e)},bar:{dataLabels:{...p(e)},...d(e)},pie:{dataLabels:{enabled:!1,connectorColor:e.border.primary,connectorWidth:1,connectorShape:"straight",connectorPadding:2,style:{fontWeight:"normal",color:e.text.tertiary,textOutline:"none",fontSize:"12px"},useHTML:!0},borderRadius:0,borderWidth:1,borderColor:e.background.primary,point:{events:{legendItemClick(){const e=this,t=e.series.points.map((e=>e.visible));t[e.index]=!t[e.index];if(!t.some((e=>e)))return!1}}}},area:u(e),areaspline:u(e),series:{animation:!1,borderColor:"transparent",events:{legendItemClick(){const e=this,t=e.chart.series.map((e=>e.visible));t[e.index]=!t[e.index];if(!t.some((e=>e)))return!1}}}},legend:{symbolRadius:2,symbolHeight:8,symbolPadding:4,useHTML:!0,itemStyle:{fontSize:"12px",color:e.text.secondary,paddingTop:"2px"},rtl:(0,c().A1)(),navigation:{enabled:!0,activeColor:e.text.secondary,inactiveColor:e.text.disabled,style:{color:e.text.secondary}},itemHiddenStyle:{color:e.chartLegendItemHiddenColor},itemHoverStyle:{color:e.darkTextColor},maxHeight:100},caption:{align:"center",style:{color:e.text.secondary,fontSize:"12px",fontWeight:"normal",useHTML:!0,direction:(0,c().A1)()?"rtl":"ltr"}},tooltip:{animation:!1,shared:!0,style:{direction:(0,c().A1)()?"rtl":"ltr"}},exporting:{enabled:!1,fallbackToExportServer:!1,allowHTML:!0},credits:{enabled:!1},accessibility:{enabled:!0}}}},709380:(e,t,n)=>{n.d(t,{R:()=>I});var a=n(296540),i=()=>n(484714),s=()=>n(590526),o=()=>n(732810),r=()=>n(416504),l=()=>n(591779),c=()=>n(187174),d=()=>n(450648),u=()=>n(69708),p=()=>n(534177),g=()=>n(661077),m=()=>n(115512),h=()=>n(996477),f=()=>n(143016),y=()=>n(533927),v=()=>n(328729),S=()=>n(282027),b=n(474848);const x=(0,u().YK)({editing:{id:"AssistantLoadingStateRenderer.editing",defaultMessage:"Editing"},searchingPeople:{id:"AssistantLoadingStateRenderer.searchingPeople",defaultMessage:"Finding people"},searhingDatabases:{id:"AssistantLoadingStateRenderer.searchingDatabases",defaultMessage:"Finding databases"},queryingDatabase:{id:"AssistantLoadingStateRenderer.queryingDatabase",defaultMessage:"Searching {database}"},loadingDatabase:{id:"AssistantLoadingStateRenderer.loadingDatabase",defaultMessage:"Loading {database}"},loadingPage:{id:"AssistantLoadingStateRenderer.loadingPage",defaultMessage:"Reading page"},retrying:{id:"AssistantLoadingStateRenderer.wentWrongTryAgain",defaultMessage:"Trying again"}});function I(e){const t=(0,i().v3)(),n=(0,s().K8)((()=>(0,h().fM)(t)),[t]);return n&&e.loadingState?(0,b.jsx)(k,{...e,sidebarSpaceStore:n}):null}function k(e){const{loadingState:t,sidebarSpaceStore:n,handleShowSearchResults:i}=e,o=(0,u().tz)(),r=!(0,s().O$)(g().P),l=(0,a.useMemo)((()=>{if((0,p().O9)(t.loadingStep)){if(r)return{type:"message",messageFn:()=>o.formatMessage(S().v.thinking)};if("assistantShowSearchResults"===t.loadingStep.type)return i?{type:"comp",comp:(0,b.jsx)(v().y,{parentStore:n,clientStep:t.loadingStep})}:{type:"empty"};if("assistantLoadPage"===t.loadingStep.type)return{type:"message",messageFn:()=>o.formatMessage(x.loadingPage)};if("assistantLoadDatabase"===t.loadingStep.type){const e=t.loadingStep.pointer;return{type:"message",messageFn:async()=>{const t=await C({sidebarSpaceStore:n,collectionPointer:e,intl:o});return o.formatMessage(x.loadingDatabase,{database:t})}}}if("assistantQueryingDatabase"===t.loadingStep.type||"queryDatabase"===t.loadingStep.type){const e=t.loadingStep.collectionPointer;return{type:"message",messageFn:async()=>{const t=await C({sidebarSpaceStore:n,collectionPointer:e,intl:o});return o.formatMessage(x.queryingDatabase,{database:t})}}}if("assistantSearchPeople"===t.loadingStep.type)return{type:"message",messageFn:()=>o.formatMessage(x.searchingPeople)};if("assistantSearchDatabases"===t.loadingStep.type)return{type:"message",messageFn:()=>o.formatMessage(x.searhingDatabases)};if("assistantRetry"===t.loadingStep.type)return{type:"message",messageFn:()=>o.formatMessage(x.retrying)};if("groupedEditCard"===t.loadingStep.type)return{type:"message",messageFn:()=>o.formatMessage(x.editing)};(0,p().HB)(t.loadingStep)}return{type:"message",messageFn:void 0}}),[n,o,t,i,r]);return"empty"===l.type?null:(0,b.jsx)(w,{...e,renderState:l})}function w(e){const{sidebarSpaceStore:t,renderState:n}=e,[a]=(0,c().Yb)((async()=>"comp"===n.type?n:"message"===n.type?{type:"message",message:n.messageFn?await n.messageFn():void 0}:void(0,p().HB)(n)),[n]),i=(0,l().wb)(null==a?void 0:a.value,500,((e,t)=>e===t)),o=(0,s().uB)(void 0,f().D);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{role:"status","aria-live":"polite",style:m().Qg,children:"message"===(null==i?void 0:i.type)&&i.message?i.message:void 0}),(0,b.jsx)(y().x7,{clientStep:{type:"assistantLoading",inferenceId:"hard-coded",message:i&&("message"===i.type?i.message:"comp"===i.type?i.comp:(0,p().HB)(i))},parentStore:t,parentSpaceId:t.id,latestStepCitationHoverStore:o})]})}async function C(e){const{sidebarSpaceStore:t,collectionPointer:n,intl:a}=e,i=o().m.createChildStore(t,n);return await i.load(),(0,d().r4)({textValue:i.getName(),getRecordModel:i.getRecordModel,userTimeZone:(0,r().P)(),deterministic:!0,intl:a})}},714318:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>a,plugSmallIcon:()=>i});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"1.17 2.97 13.65 10.06",svg:(0,n(474848).jsx)("path",{d:"M7.592 2.975c-.531 0-1.045.19-1.448.536L3.969 5.375H1.8A.625.625 0 0 0 1.175 6v4c0 .345.28.625.625.625h2.169l2.175 1.864c.403.346.917.536 1.448.536H10.6c.345 0 .625-.28.625-.625v-1.575H14.2a.625.625 0 1 0 0-1.25h-2.975v-3.15H14.2a.625.625 0 1 0 0-1.25h-2.975V3.6a.625.625 0 0 0-.625-.625zM6.957 4.46a.98.98 0 0 1 .635-.235h2.383v7.55H7.592a.98.98 0 0 1-.635-.235l-2.35-2.015a.63.63 0 0 0-.407-.15H2.425v-2.75H4.2c.15 0 .294-.053.407-.15z"})},i=(0,n(340498).wt)("plugSmall",a,"small")},724925:(e,t,n)=>{n.d(t,{l:()=>i});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.87 14.75 14.75",svg:(0,n(474848).jsx)("path",{d:"M2.865 17.61q.069.015.136.015a.626.626 0 0 0 .61-.49c.024-.11 2.473-10.663 11.949-12.82a15.2 15.2 0 0 1-1.617 3.008l-1.996-.087a.6.6 0 0 0-.49.206.63.63 0 0 0-.155.51l.294 1.984a12.8 12.8 0 0 1-4.218 2.424.624.624 0 1 0 .405 1.182 14 14 0 0 0 4.9-2.9.63.63 0 0 0 .199-.555l-.232-1.57 1.579.07a.59.59 0 0 0 .533-.258c1.683-2.316 2.276-4.422 2.335-4.644a.64.64 0 0 0-.127-.586.64.64 0 0 0-.582-.214C5.21 4.633 2.417 16.743 2.39 16.865a.626.626 0 0 0 .475.745M6 17.625h10a.626.626 0 0 0 0-1.25H6a.625.625 0 0 0 0 1.25"})},i=(0,n(340498).wt)("quill",a,"default")},731881:(e,t,n)=>{n.d(t,{R:()=>j});n(944114);var a=n(296540),i=()=>n(590526),s=()=>n(401497),o=()=>n(792057),r=()=>n(250910),l=()=>n(807449),c=()=>n(546926),d=()=>n(26697),u=()=>n(302501),p=()=>n(890492),g=()=>n(81068),m=()=>n(424400),h=()=>n(663639),f=()=>n(736847),y=()=>n(105239),v=()=>n(955363),S=()=>n(859384),b=()=>n(236262),x=()=>n(69708),I=()=>n(815585),k=()=>n(580035),w=()=>n(624006),C=()=>n(332705),A=n(474848);const T=(0,x().YK)({menuTooltip:{id:"chatHistoryItemMenu.tooltip",defaultMessage:"Delete, rename, and more"},rename:{id:"chatHistoryItemMenu.rename",defaultMessage:"Rename"},delete:{id:"chatHistoryItemMenu.delete",defaultMessage:"Delete"},clearDailyBrief:{id:"chatHistoryItemMenu.clearDailyBrief",defaultMessage:"Clear todays brief"},openInNewTab:{id:"chatHistoryItemMenu.openInNewTab",defaultMessage:"Open in new tab"},lastUpdated:{id:"chatHistoryItemMenu.lastUpdated",defaultMessage:"Last updated {timestamp}"},deleteConfirmation:{id:"chatHistoryItemMenu.deleteConfirmation",defaultMessage:"Are you sure you want to delete this chat?"}});function j({threadStore:e,isDailyBriefThread:t,onDelete:n,onClearDailyBrief:j,onOpenInNewTab:M,onRename:_,variant:P="sidebar"}){const D=(0,x().tz)(),E=(0,s().IS)((()=>({menuItem:{paddingBlock:4,paddingInline:14}})),[]),R=(0,s().IS)((()=>({tooltip:{display:"flex",alignItems:"center",gap:8}})),[]),B=(0,i().K8)((()=>{const t=e.getUpdatedTime();if(t)return(0,I().nl)(t,{useLowercase:!0,useCompactFormat:!0,roundDownYears:!0})}),[e]),[F,N]=(0,a.useState)(!1),[L,O]=(0,a.useState)(void 0),V=(0,a.useRef)(null),z=(0,a.useRef)(void 0),W=(0,k().V)(e),U=(0,a.useCallback)((()=>{N(!1),O(void 0)}),[]),H=(0,a.useCallback)((()=>{var e;if(_)return void _();const t=null===(e=V.current)||void 0===e?void 0:e.getAnchor();if(t instanceof HTMLElement){var n;const e=t.getBoundingClientRect();null===(n=z.current)||void 0===n||n.call(z),requestAnimationFrame((()=>{requestAnimationFrame((()=>{O(e),N(!0)}))}))}}),[_]),K=(0,a.useCallback)((async()=>{var e;null===(e=z.current)||void 0===e||e.call(z);(await o().Gh({message:D.formatMessage(T.deleteConfirmation)})).accept&&(null==n||n())}),[D,n]),q=(0,a.useCallback)((()=>{var e;null===(e=z.current)||void 0===e||e.call(z),null==j||j()}),[j]),$=(0,a.useCallback)((()=>{var e;null===(e=z.current)||void 0===e||e.call(z),null==M||M()}),[M]),G=D.formatMessage(T.menuTooltip);if(!(W||n||M||t&&j))return null;const Y=[];W&&Y.push({key:"rename",render:e=>{const{ref:t,...n}=e;return(0,A.jsx)(g().A,{...n,icon:(0,A.jsx)(l().I,{icon:S().M}),title:D.formatMessage(T.rename),ref:t})},action:H}),t&&j&&Y.push({key:"clear-daily-brief",render:e=>(0,A.jsx)(g().A,{icon:(0,A.jsx)(l().I,{icon:y().N}),title:D.formatMessage(T.clearDailyBrief),...e}),action:q}),n&&Y.push({key:"delete",render:e=>(0,A.jsx)(g().A,{icon:(0,A.jsx)(l().I,{icon:b().trashIcon}),title:D.formatMessage(T.delete),...e}),action:K});const Q=[];M&&Q.push({key:"open-in-new-tab",render:e=>(0,A.jsx)(g().A,{icon:(0,A.jsx)(l().I,{icon:v().arrowDiagonalUpRightIcon}),title:D.formatMessage(T.openInNewTab),...e}),action:$});const J=[];return Y.length>0&&J.push({key:"primary-actions",render:e=>(0,A.jsx)(f().A,{...e,topBorder:!1}),items:Y}),Q.length>0&&J.push({key:"navigation-actions",render:e=>(0,A.jsx)(f().A,{...e,topBorder:Y.length>0}),items:Q}),B&&J.push({key:"metadata",render:e=>(0,A.jsx)(f().A,{...e,topBorder:!0}),items:[{key:"last-updated",render:()=>(0,A.jsx)(m().Ay,{shouldWrapTitle:!0,title:(0,A.jsx)(u().A,{isSmall:!0,isSecondaryColor:!0,children:(0,A.jsx)(x().sA,{...T.lastUpdated,values:{timestamp:B}})}),style:E.menuItem}),action:()=>{}}]}),(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(d().m,{renderTooltip:()=>(0,A.jsx)("div",{style:R.tooltip,children:(0,A.jsx)(x().sA,{...T.menuTooltip})}),render:e=>(0,A.jsx)(r().A,{ref:V,popupType:r().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",originGap:0,trapFocus:!0,render:e=>(z.current=e.close,(0,A.jsx)(p().A,{menuType:c().gu.Popup,children:(0,A.jsx)(h().A,{type:h().O.Vertical,onAccept:e.close,initialFocus:void 0,sections:J})})),renderOrigin:({onClick:t})=>(0,A.jsx)(C().t,{variant:P,ariaLabel:G,onClick:t,...e})})}),_?void 0:(0,A.jsx)(w().N,{threadStore:e,open:F,originRect:L,onDismiss:U})]})}},732067:(e,t,n)=>{n.d(t,{vF:()=>m,Su:()=>h,cG:()=>u,UY:()=>f,T5:()=>p});var a=n(296540),i=()=>n(401497),s=()=>n(100622),o=()=>n(783793);const r=n.p+"edfba4a6d1ff7acd.png",l=n.p+"c9223887dcb57b7d.gif",c=n.p+"7e9cbd56b1eca7b9.gif";var d=n(474848);function u(e){const{variant:t,style:n={}}=e;return(0,d.jsx)("div",{style:n,children:(0,d.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,d.jsx)(o().x,{variant:t,shadowVariant:"light"})})})}function p(e){const{variant:t}=e,n=(0,i().IS)((()=>({faceWrapper:{marginInlineEnd:8}})),[]);return(0,d.jsx)("div",{style:n.faceWrapper,children:(0,d.jsx)(g,{variant:t})})}function g(e){const{variant:t}=e,n="dark"===(0,i().eP)(),[s,r]=(0,a.useState)(!0);(0,a.useEffect)((()=>{setTimeout((()=>{r(!1)}),6e3)}),[]);const u=(0,a.useMemo)((()=>{if(s)return n?l:c}),[n,s]);return(0,d.jsx)("div",{style:{marginInlineStart:8},children:(0,d.jsx)(o().x,{variant:t,shadowVariant:"light",imgSource:u})})}function m(){const e=(0,i().IS)((()=>({faceImgStyles:{width:20,height:20,background:s().Tj.assistantCornerButtonBackground,borderRadius:"50%",border:`1px solid ${s().Tj.border.primary}`}})),[]);return(0,d.jsx)("img",{style:e.faceImgStyles,src:r,role:"presentation",alt:"Notion AI Face"})}function h(){const e=(0,i().IS)((()=>({faceImgStyles:{width:20,height:20,background:s().Tj.assistantCornerButtonBackground,borderRadius:"50%",border:`1px solid ${s().Tj.border.primary}`}})),[]);return(0,d.jsx)("img",{style:e.faceImgStyles,src:r,role:"presentation",alt:"Notion AI Face"})}function f(){const e=(0,i().IS)((()=>({faceImgStyles:{width:20,height:20,background:s().Tj.assistantCornerButtonBackground,borderRadius:"50%",border:`1px solid ${s().Tj.border.primary}`,marginInlineStart:-2,marginInlineEnd:2}})),[]);return(0,d.jsx)("img",{style:e.faceImgStyles,src:r,role:"presentation",alt:"Notion AI Face"})}},736423:(e,t,n)=>{n.d(t,{y:()=>a});const a={agent_new_user_onboarding:{steps:[{id:"manage-projects"},{id:"action-items"},{id:"meeting-notes"}]},new_user_home_checklist:{steps:[{id:"connect-email"},{id:"power-up-search"},{id:"get-meeting-memory"},{id:"get-daily-page"},{id:"invite-team"}]}}},748355:(e,t,n)=>{n.d(t,{$:()=>i});class a extends(()=>n(757695))().Store{getInitialState(){return{variant:void 0,spaceJoinOrCreate:void 0,shouldRenderTextPrompt:!1,exposedToExperiment:!1}}getVariant(){return this.state.variant}getSpaceJoinOrCreate(){return this.state.spaceJoinOrCreate}getShouldRenderTextPrompt(){return this.state.shouldRenderTextPrompt}getExposedToExperiment(){return this.state.exposedToExperiment}}const i=new a},750127:(e,t,n)=>{n.d(t,{$:()=>u});n(296540);var a=()=>n(590526),i=()=>n(265060),s=()=>n(81068),o=()=>n(589222),r=()=>n(69708),l=()=>n(604018),c=()=>n(663929),d=n(474848);function u(e){const{onClick:t,focused:n}=e,u=(0,a().K8)((()=>(0,l().Nr)()),[]);return(0,d.jsx)(s().A,{focused:n,onClick:t,icon:(0,d.jsx)(i().Q,{iconGroup:o().h,variantName:"small"}),title:(0,d.jsx)(r().sA,{id:"AIChatSearchScopePopup.AIChatSearchScopeMenu.getAiConnectorsFooterTitle",defaultMessage:"Connect apps"}),right:(0,d.jsx)(c().hC,{connectors:u,maxBubbles:2,iconSize:12,bubbleStyles:{width:16,height:16}})})}},751699:(e,t,n)=>{n.d(t,{FM:()=>y,JR:()=>f,R2:()=>m,lx:()=>g,nh:()=>h});n(16280),n(898992),n(354520);var a=()=>n(564884),i=()=>n(836095),s=()=>n(675133),o=()=>n(128933),r=()=>n(769864),l=()=>n(61958),c=()=>n(383070),d=()=>n(547149),u=()=>n(716500),p=()=>n(610083);async function g(e){const{environment:t,spaceId:n}=e,a=await r().callApi({eventName:"disconnectSlackIngestion",environment:t,data:{spaceId:n,disconnectForWorkspace:!1}});var i;"success"===a.type&&p().Rh.setState({...p().Rh.state,connectedApps:null===(i=p().Rh.state.connectedApps)||void 0===i?void 0:i.filter((e=>"slack"!==e)),isPrivateSync:!1});return"success"===a.type}function m(e){const{environment:t,sidebarSpaceViewStore:n,analyticsProperties:i}=e,{analyticsFrom:s,buttonName:o,sessionId:r}=i;(0,a().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:o,integration_type:"slack",setup_session_id:r,from:s}}}),d().createAndCommit({userAction:"slackAIConnector.onboarding.dismissPersonalAuthPrompt",environment:t,canUndo:!0,perform:e=>{d().applyOperation({store:n,operation:{pointer:n.pointer,path:["settings"],command:"update",args:{...n.getSettings(),dismissed_slack_personal_auth_prompt:!0}},transaction:e})}})}function h(){p().Rh.setState({...p().Rh.state,currentScreen:"settings"})}async function f(e){const{environment:t,spaceId:n}=e,d=c().zD.isSlackV2AiConnectorEnabled();(0,a().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"private_auth_connect_start",integration_type:"slack",setup_session_id:p().Rh.state.sessionId,from:p().Rh.state.analyticsFrom,connection_version:2}}});const g=p().Rh.state.privateAccessEnabled??!0,m=await r().callApi({eventName:"getSlackIngestionAuthorizeUrl",environment:t,data:{spaceId:n,isAdminAuth:!1,isDesktopApp:t.device.isElectron,isPrivateAccessEnabled:g}});let h;if("success"===m.type)if(t.device.isElectron)h=await(0,i().P)(m.data.url);else{const e=(0,u().K)("slack");if(!e.messages.userOverwritePopupTitleMessage)throw new Error("User overwrite popup title message is not defined");h=await l().P(t,{width:800,height:600,url:m.data.url,titleMessage:e.messages.userOverwritePopupTitleMessage})}d&&h&&(p().Rh.setState({...p().Rh.state,connectedApps:[...p().Rh.state.connectedApps??[],"slack"]}),o().D6({label:s().A.getIntl().formatMessage({defaultMessage:"You are connected to both Private and Public messages",id:"slack.v2.user.auth.success"}),position:"bottom"}),(0,a().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"private_auth_connect_success",integration_type:"slack",setup_session_id:p().Rh.state.sessionId,from:p().Rh.state.analyticsFrom,connection_version:2}}}))}async function y(e){const{environment:t,spaceId:n,isWriteAccessApproved:c,isPrivateAccessEnabled:d}=e;(0,a().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"admin_migration_start",integration_type:"slack",setup_session_id:p().Rh.state.sessionId,from:p().Rh.state.analyticsFrom,connection_version:2}}});const g=await r().callApi({eventName:"getSlackIngestionAuthorizeUrl",environment:t,data:{spaceId:n,isAdminAuth:!0,isDesktopApp:t.device.isElectron,isWriteAccessApproved:c,isPrivateAccessEnabled:d}});let m;if("success"===g.type)if(t.device.isElectron)m=await(0,i().P)(g.data.url);else{const e=(0,u().K)("slack");if(!e.messages.userOverwritePopupTitleMessage)throw new Error("User overwrite popup title message is not defined");m=await l().P(t,{width:800,height:600,url:g.data.url,titleMessage:e.messages.userOverwritePopupTitleMessage})}if(m){if(p().Rh.setState({...p().Rh.state,connectionVersion:2,connectedApps:[...p().Rh.state.connectedApps??[],"slack"],writeAccessApproved:c}),c)return;o().D6({label:s().A.getIntl().formatMessage({defaultMessage:"Slack AI updated, You now have access to Private conversations",id:"slack.v2.admin.auth.success"}),position:"bottom"}),(0,a().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"admin_migration_success",integration_type:"slack",setup_session_id:p().Rh.state.sessionId,from:p().Rh.state.analyticsFrom,connection_version:2}}})}}},753363:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>i,keyIcon:()=>s});n(296540);var a=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"4.87 1.62 9.98 16.75",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M9.86 6.61a.969.969 0 1 0 0-1.938.969.969 0 0 0 0 1.937"}),(0,a.jsx)("path",{d:"M9.86 1.625a4.984 4.984 0 0 0-2.563 9.26v5.17c0 .18.078.351.213.47l1.938 1.695a.625.625 0 0 0 .823 0l1.937-1.695a.625.625 0 0 0 .063-.877l-1.104-1.289 1.104-1.288a.63.63 0 0 0 .15-.407v-1.779a4.984 4.984 0 0 0-2.563-9.26M6.124 6.609a3.734 3.734 0 1 1 5.394 3.347.63.63 0 0 0-.347.56v1.917l-1.303 1.52c-.2.234-.2.58 0 .813l1.05 1.226-1.06.927-1.312-1.148v-5.255a.63.63 0 0 0-.347-.56 3.73 3.73 0 0 1-2.075-3.347"})]})},s=(0,n(340498).wt)("key",i,"default")},754461:(e,t,n)=>{n.d(t,{p:()=>b});n(16280),n(898992),n(908872);var a=()=>n(755531),i=()=>n(68169),s=()=>n(24279),o=()=>n(832093),r=()=>n(792071),l=()=>n(201980),c=()=>n(496603),d=()=>n(68465),u=()=>n(358481),p=()=>n(605804),g=()=>n(383070),m=()=>n(483730),h=()=>n(150984),f=()=>n(814964),y=()=>n(934215),v=()=>n(358579);function S(e){return e.reduce(((e,t)=>((0,s().wc)(t)?e.instructionSteps+=1:(0,s().ox)(t)?e.humanSteps+=1:(0,s().b1)(t)&&Boolean(t.namespace)&&(e.assistantStepsWithNamespace+=1),e)),{instructionSteps:0,humanSteps:0,assistantStepsWithNamespace:0})}function b(e){const{environment:t,sessionContext:n,assistantSurface:b}=e,x=g().zD.getNamespace(),I=n.evaluatorFromStoreState.getTranscript(),k=c().Uk(I,s().ox),w=c().Uk(I,s().kO);let C;w&&(C=(0,i().PM)(w,n.sessionIdFromStoreState));const A=(0,a().S)(),T=k?(0,p().ND)({step:k,evaluatorState:n.evaluatorFromStoreState.state,getRecordModel:(null==A?void 0:A.getRecordModel)??r().b4_.constant(void 0)}):(0,l().x9d)(""),j=n.maybeStopCurrentHumanStepSubmission((e=>{const a=e.clone();if(!(a instanceof f().A))throw new Error("Unexpected instance of XMLEvaluatorState on the client");return a.setEvaluatorStateCallbacks(new(u().h)(n.attributionActorFromStoreState)),new(o().g)(e,{namespace:x,persistStates:(0,d().cJ)(),errorLogger:(0,y().P)(t)})})),M=n.evaluatorFromStoreState.getTranscript();if(j){n.caches.clear(),(0,v().Z)({environment:t,sessionContext:n});const{instructionSteps:e,humanSteps:a}=S(I),{assistantStepsWithNamespace:i}=S(M),s=void 0===C&&(e>0&&0===a||0===e&&0===i),o=!b.isWriter&&i>0;return s?m().default.endCurrentSession():o&&(0,h().fireAndForgetUpsertStepToChatSessionHistory)({sessionId:n.sessionIdFromStoreState,environment:t,assistantSurfaceType:b.type}),{lastHumanStepText:T,lastUploadedFileData:C,sessionEnded:s}}}},758632:(e,t,n)=>{n.d(t,{M:()=>K,C:()=>q});var a=n(296540),i=(n(898992),n(354520),n(581454),()=>n(717137)),s=()=>n(484714),o=()=>n(590526),r=()=>n(401497),l=()=>n(882722),c=()=>n(127833),d=()=>n(30537),u=()=>n(807449),p=()=>n(695115),g=()=>n(26697),m=()=>n(24279),h=()=>n(187174),f=()=>n(613601),y=()=>n(158661),v=()=>n(514608),S=()=>n(995847),b=()=>n(979004),x=()=>n(201980),I=()=>n(69708),k=()=>n(100622),w=()=>n(534177),C=()=>n(284371),A=()=>n(914577),T=()=>n(890678),j=()=>n(631611),M=()=>n(354584),_=()=>n(483795),P=()=>n(525569),D=()=>n(808725),E=()=>n(996477),R=()=>n(483730),B=n(474848);function F(e){const{open:t,onDismiss:n,...a}=e,i=(0,s().v3)(),r=(0,o().K8)((()=>{var e;return null===(e=(0,E().fM)(i))||void 0===e?void 0:e.id}),[i]);return r?(0,B.jsx)(c().zD,{popupType:d().n.Popup,originGap:8,alignmentToOrigin:"center",open:t,onDismiss:n,placementToOrigin:"left",...a,render:()=>(0,B.jsx)(N,{parentSpaceId:r,onDismiss:n})}):null}function N(e){const t=(0,j().jw)().isWriter,n=(0,o().K8)((()=>"assistantCompletionPopup"===P().default.state.type?P().default.state.sessionId:void 0),[]),a=(0,o().K8)((()=>{const e=t&&n?R().default.getSessionContext(n):R().default.getActiveSession();return null==e?void 0:e.previewingStepFromStoreState}),[n,t],{useDeepEqual:!0});return a?(0,B.jsx)(O,{...e,previewingStep:a}):(0,B.jsx)(L,{})}function L(){const e=(0,r().IS)((()=>({wrap:{display:"flex",flexDirection:"column",padding:8}})),[]);return(0,B.jsx)("div",{style:e.wrap,children:"No previewing step"})}function O(e){const{parentSpaceId:t,onDismiss:n,previewingStep:c}=e,d=(0,r().IS)((()=>({wrap:{display:"flex",flexDirection:"column",width:450},codeWrap:{display:"flex",padding:8,overflow:"scroll"},codeBlock:{padding:0,height:200},codeBlockWrap:{width:"100%"}})),[]),u=(0,s().v3)(),p=(0,o().K8)((()=>R().default.getActiveSession()),[]),g=(0,o().K8)((()=>{const e=null==p?void 0:p.assistantConfigurationStoreState;return Boolean(e&&(e.sampling||e.evaluating))}),[p]),h=(0,o().K8)((()=>(null==p?void 0:p.previewingStepObservationsFromStoreState)||[]),[p],{useDeepEqual:!0}),f=h.filter(m().XO),y=h.filter((e=>!(0,m().XO)(e))),v=(0,a.useCallback)((async e=>{if(!p)return;const t=(0,x().k4p)(e),n={...c,value:t},a=p.sessionIdFromStoreState;p.setPendingStepValue({step:n}),await(0,D().T)({environment:u,step:n,commit:!1,isStreaming:!1,preventSelection:!0,sessionId:a,inferenceId:"",updater:p.createUpdater()})}),[u,c,p]),{store:S,setValue:b}=(0,_().AI)({initialValue:(0,x().x9d)(c.value),onChange:v}),[I]=(0,a.useState)((()=>c.value)),k=(0,a.useCallback)((()=>{b((0,x().x9d)(I))}),[I,b]);return t?(0,B.jsx)(i().A,{capture:!0,debugName:"EditLastStepPopup",children:(0,B.jsxs)("div",{style:d.wrap,children:[(0,B.jsx)(V,{onDismiss:n,onRevert:k}),(0,B.jsx)("div",{style:d.codeWrap,className:l().CCX,children:(0,B.jsx)(T().G,{store:S,language:"JavaScript",blockStore:void 0,codeWrap:!0,isQuickFind:!1,parentSpaceId:t,style:d.codeBlock,disabled:!1,wrapStyle:d.codeBlockWrap})}),f.length>0&&!g?(0,B.jsx)(U,{messages:f.map((e=>e.value))}):void 0,y.length>0&&!g?(0,B.jsx)(z,{values:y.map((e=>"pagesFromQueryDatabase"===e.observationType?(0,m().y8)(e):e.value||""))}):void 0]})}):null}function V(e){const{onDismiss:t,onRevert:n}=e,a=(0,r().IS)((()=>({wrap:{display:"flex",gap:8,justifyContent:"flex-end",backgroundColor:k().oZ.contentGrayBackground,padding:4},iconButton:{height:14,width:14}})),[]),i=(0,I().tz)(),s=i.formatMessage({id:"assistant.editLastStepPopup.revert",defaultMessage:"Revert to original value"}),o=i.formatMessage({id:"assistant.editLastStepPopup.close",defaultMessage:"Close"});return(0,B.jsxs)("div",{style:a.wrap,children:[(0,B.jsx)(g().m,{renderTooltip:()=>s,placement:"bottom",alignment:"center",render:e=>(0,B.jsx)(p().A,{...e,style:a.iconButton,icon:f().arrowUTurnUpLeftSmallIcon,ariaLabel:s,onClick:n})}),(0,B.jsx)(g().m,{renderTooltip:()=>o,placement:"bottom",alignment:"center",render:e=>(0,B.jsx)(p().A,{...e,style:a.iconButton,icon:S().xMarkSmallIcon,ariaLabel:o,onClick:t})})]})}function z(e){const{values:t}=e,n=(0,r().IS)((()=>({wrap:{display:"flex",flexDirection:"column"},icon:{display:"inline",marginInlineEnd:4,marginTop:4},itemWrap:{display:"flex",alignItems:"flex-start",fontSize:C().J.UISmall.desktop,borderTop:`1px solid ${k().Tj.outlineButtonBorder}`,padding:4}})),[]);return(0,B.jsx)("div",{style:n.wrap,children:t.map(((e,t)=>(0,B.jsxs)("div",{style:n.itemWrap,children:[(0,B.jsx)("span",{style:n.icon,children:(0,B.jsx)(u().I,{icon:v().eyeFillSmallIcon,size:"xxs"})}),(0,B.jsx)(W,{value:e,disableFormat:!1})]},t)))})}function W(e){const{value:t,disableFormat:n}=e,a=(0,r().IS)((()=>({wrap:{whiteSpace:"pre",fontFamily:"monospace",overflow:"scroll",maxHeight:150}})),[]),[i]=(0,h().Yb)((async()=>{if(!n){const e=await A().P_({codeSnippet:t,language:"XML"});if(e){const t=await M().y.load();return{type:"html",html:t.highlight(e,t.languages[b().PrismLanguages.xml],b().PrismLanguages.xml)}}}return{type:"plain",value:t}}),[t,n]);if("resolved"!==i.status)return null;const s=i.value;return"plain"===s.type?(0,B.jsx)("div",{style:a.wrap,children:s.value}):"html"===s.type?(0,B.jsx)("div",{style:a.wrap,dangerouslySetInnerHTML:{__html:s.html}}):(0,w().HB)(s)}function U(e){const{messages:t}=e,n=(0,r().eP)(),a=(0,r().IS)((()=>({wrap:{display:"flex",alignItems:"flex-start",fontSize:C().J.UISmall.desktop,borderTop:`1px solid ${k().Tj.outlineButtonBorder}`,color:"light"===n?k().Tj.palette.red[500]:k().Tj.palette.red[800],padding:4},icon:{display:"inline",marginInlineEnd:4,marginTop:4},messages:{whiteSpace:"pre-wrap"}})),[n]);return(0,B.jsxs)("div",{style:a.wrap,children:[(0,B.jsx)("span",{style:a.icon,children:(0,B.jsx)(u().I,{icon:y().exclamationMarkTriangleFillSmallIcon,size:"xs",colorPalette:"red",colorVariant:"accentPrimary"})}),(0,B.jsx)("div",{style:a.messages,children:t.join("\n")})]})}const H=(0,a.createContext)(void 0);function K(e){const{...t}=e,[n,i]=(0,a.useState)(!1),s=(0,a.useCallback)((()=>{i(!0)}),[]),o=(0,a.useCallback)((()=>{i(!1)}),[]),r=(0,a.useMemo)((()=>({openEditLastStepPopup:s})),[s]);return(0,B.jsx)(H.Provider,{value:r,children:(0,B.jsx)(F,{open:n,onDismiss:o,...t})})}function q(){var e;return(null===(e=(0,a.useContext)(H))||void 0===e?void 0:e.openEditLastStepPopup)??(()=>{console.error("Called useOpenEditStepPopup outside of an EditLastStepProvider!")})}H.displayName="EditLastStepContext"},759418:(e,t,n)=>{n.d(t,{V:()=>s});var a=()=>n(590526),i=()=>n(748355);function s(){return(0,a().K8)((()=>({variant:i().$.getVariant(),spaceJoinOrCreate:i().$.getSpaceJoinOrCreate(),shouldRenderTextPrompt:i().$.getShouldRenderTextPrompt(),exposedToExperiment:i().$.getExposedToExperiment()})),[])}},761777:(e,t,n)=>{n.r(t),n.d(t,{appendAssistantLoadDatabaseStepForScopedSearch:()=>a().n,applyUncommittedOperations:()=>i().i,clearActiveAssistantSession:()=>s().U,clearAllAssistantSessions:()=>r,commitAssistantFeedback:()=>l().f,commitHumanStep:()=>c().b,commitPreviewAssistantStep:()=>d().o,findAssistantClientSkillFromTranscriptIfExists:()=>u().P,getAssistantContext:()=>p().A,getAssistantCurrentPageInformation:()=>g().N,getAssistantParentRecordStore:()=>b().f,getFiltersFromBlockIds:()=>y,getHumanChatTag:()=>v().m,getLoggedInUserOrPublicSiteUserId:()=>S()._,getParentRecordStoreOrThrow:()=>x().g,insertAssistantChatBelowSelection:()=>I().V,insertAssistantChatIntoPage:()=>k().p,isAssistantOperationInBlockOrBlockSubtree:()=>A,isSelectionValidAttachmentSelection:()=>P,loadAssistantCurrentPages:()=>D().q,loadDatabaseRelatedNodesForChildPage:()=>$,loadDatabaseRelatedNodesForValue:()=>G,loadPages:()=>Y().Z,loadRelatedNodesForValue:()=>Q,resetAndInitializeAssistantSession:()=>J().p,resetAssistantUncommittedOperations:()=>X().V,sampleNextAssistantSteps:()=>Z().f,sampleNextAssistantStepsAsHumanSubmissionWithInferenceAnalytics:()=>ee().H,saveFeedback:()=>te().$,showAssistantRemainingPendingOperations:()=>ne().Z,simulateOrCommitStep:()=>ae().T,stopAssistantCurrentHumanStepSubmission:()=>ie().p,updateAssistantTimestampsAfterSessionInitialization:()=>se().Z});var a=()=>n(423995),i=()=>n(825836),s=()=>n(677590),o=()=>n(483730);function r(){o().default.clearAllSessions()}var l=()=>n(795901),c=()=>n(234637),d=()=>n(918678),u=()=>n(415211),p=()=>n(839710),g=()=>n(108181),m=(n(944114),()=>n(295633)),h=()=>n(179034),f=()=>n(29554);function y(e){const{blockIds:t,parentRecordStore:n}=e,a=[];for(const s of t){var i;const e=m().B.createChildStore(n,{table:h().ev,id:s});if(!e)continue;const t={property:"title",filter:{operator:"string_is",value:{type:"exact",value:(0,f().r4)(null===(i=e.getTitleStore())||void 0===i?void 0:i.getValue(),n)}}};a.push(t)}return a}var v=()=>n(615304),S=()=>n(383706),b=()=>n(160907),x=()=>n(881480),I=()=>n(499201),k=()=>n(168029),w=()=>n(534177);function C(e,t){let n=e.parent;for(;n;){if(n.attributes.id===t)return!0;n=n.parent}return!1}function A(e,t){switch(t.command){case"createBlock":case"moveBlock":case"setBlockText":case"setBlockAttribute":case"setBlockProperty":case"setBlockTagName":case"insertOrMoveTableColumns":case"removeTableColumn":return C(t.blockNode,e.id);case"removeBlock":return C(t.removeBlockNode,e.id);case"insertBlockBefore":case"insertBlockAfter":return C(t.insertBlockNode,e.id);case"setBlockParent":case"addBlockToPage":return!1;default:(0,w().HB)(t)}}var T=()=>n(17217),j=()=>n(522419),M=()=>n(201980),_=()=>n(383070);function P(e){if(!_().zD.isAttachmentUploadEnabledForUser())return!1;if(1!==e.length)return!1;const[t]=e;if(!t)return!1;const n=t.getProperties();if(!n)return!1;if(t.isType("file")||t.isType("image")||t.isType("pdf")){const e=M().q4_(n.source);if(!e)return!1;const t=(0,j().QC)(e);if(!t)return!1;return!(0,T().F0)(t).error}return!1}var D=()=>n(763578),E=()=>n(675133),R=(n(16280),n(898992),n(354520),n(581454),()=>n(319625)),B=()=>n(496603),F=()=>n(763824),N=()=>n(165358),L=()=>n(519831),O=()=>n(181856),V=()=>n(510818);const z=10;async function W(e){const{node:t,spaceId:n,loadPageAsXMLFn:a,getNavigableParentPointerFn:i}=e,s=[];try{const e=await(async({blockId:e,shouldShowObservation:t})=>({blockId:e,node:await a({table:h().ev,id:e,spaceId:n}),shouldShowObservation:t}))({blockId:t.schemaId,shouldShowObservation:!1});s.push(e)}catch(l){const e=l instanceof Error?l:new Error(String(l));throw new Error(`Unable to load page schema: ${t.schemaId}: ${e.message}`)}const o=(0,V().sX)(t),r=(0,B().iv)(o,z);for(const c of r)try{const e=await(0,F().aN)(c.map((async e=>{try{const t=await i({table:h().ev,id:e,spaceId:n});if(!t)return void N().log({level:"debug",from:"loadBlockRelatedNodesForValueShared",type:"parentNotFound",data:{miscDataToConvertToString:{syncedBlockId:e,spaceId:n}}});const s=await a({...t,spaceId:n});return{blockId:t.id,node:s,shouldShowObservation:!1}}catch(l){return}})));s.push(...e.filter(w().O9))}catch(l){N().log({level:"debug",from:"loadBlockRelatedNodesForValueShared",type:"batchError",data:{miscDataToConvertToString:{syncedBlockIds:o.join(","),spaceId:n}}})}return s}async function U(e){const{nodes:t,loadRelatedNode:n,context:a}=e,i=function(e){const{loadRelatedNode:t,context:n}=e;return async e=>{try{return await t(e)}catch(a){if(a instanceof O().QT)return void N().log({level:"debug",from:"assistantLoadingHelpers",type:"skippedDependencyDatabasePermissionError",data:{miscDataToConvertToString:{databaseId:a.databaseId,errorMessage:a.message,context:n}}});{const e=(0,R().A)(a);throw N().log({level:"error",from:n,type:"unexpectedDependencyDatabaseLoadError",data:{miscDataToConvertToString:{errorMessage:e.message}}}),a}}}}({loadRelatedNode:n,context:a}),s=(0,V().MJ)(t);return(await(0,F().aN)(s.map((e=>i({collectionId:e,shouldShowObservation:!1}))))).filter(w().O9)}var H=()=>n(436468),K=()=>n(416504),q=()=>n(792071);async function $(e){const{node:t,parentRecordStore:n}=e;return async function(e){const{assistantBlockNode:t,spaceId:n,loadDatabaseAsXMLFn:a}=e,i=async({collectionId:e,shouldShowObservation:t})=>({collectionId:e,node:await a({table:L().Vl,id:e,spaceId:n}),shouldShowObservation:t});if("page"!==t.tagName||!t.attributes["database-id"])return[];const s=await i({collectionId:t.attributes["database-id"],shouldShowObservation:!1}),o=[s],r=await U({nodes:[s.node],loadRelatedNode:i,context:"loadParentDatabaseForChildPageShared"});return o.push(...r),o}({assistantBlockNode:t,spaceId:n.getSpaceId(),loadDatabaseAsXMLFn:e=>(0,H().BM)({collectionPointer:e,loadRecordModel:q().h0Y.fromLoadRecordValueFn(n.loadRecordValue),intl:E().A.getIntl(),currentTimeZone:(0,K().P)()})})}async function G(e){const{node:t,parentRecordStore:n}=e;return async function(e){const{node:t,spaceId:n,loadDatabaseAsXMLFn:a}=e;return U({nodes:[t],loadRelatedNode:async({collectionId:e,shouldShowObservation:t})=>({collectionId:e,node:await a({table:L().Vl,id:e,spaceId:n}),shouldShowObservation:t}),context:"loadDatabaseRelatedNodesForValueShared"})}({node:t,spaceId:n.getSpaceId(),loadDatabaseAsXMLFn:e=>(0,H().BM)({collectionPointer:e,loadRecordModel:q().h0Y.fromLoadRecordValueFn(n.loadRecordValue),intl:E().A.getIntl(),currentTimeZone:(0,K().P)()})})}var Y=()=>n(948411);async function Q(e){const{node:t,parentRecordStore:n}=e;return W({node:t,spaceId:n.getSpaceId(),loadPageAsXMLFn:async e=>(await(0,H().Rz)({pointer:e,loadRecordValue:n.loadRecordValue,intl:E().A.getIntl(),currentTimeZone:(0,K().P)()})).node,getNavigableParentPointerFn:async e=>{var t;const a=m().B.createChildStore(n,e);return await a.load(),null===(t=a.getNavigableBlockStore())||void 0===t?void 0:t.pointer}})}var J=()=>n(995277),X=()=>n(251383),Z=()=>n(50744),ee=()=>n(685453),te=()=>n(162437),ne=()=>n(358579),ae=()=>n(808725),ie=()=>n(754461),se=()=>n(657133)},762771:(e,t,n)=>{n.d(t,{A:()=>i});class a extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}}const i=new a},763578:(e,t,n)=>{n.d(t,{q:()=>s});var a=()=>n(496603),i=()=>n(948411);async function s(e){var t,n;const{environment:s,currentPageInformation:o,xmlEvaluatorState:r,sessionId:l,updater:c}=e;await(0,i().Z)({environment:s,pageIds:a().oE([null===(t=o.primaryEditorStore)||void 0===t?void 0:t.id,null===(n=o.backgroundEditorStore)||void 0===n?void 0:n.id]),xmlEvaluatorState:r,sessionId:l,updater:c})}},770636:(e,t,n)=>{n.d(t,{H:()=>c});n(18107),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(967357),n(898992),n(823215),n(354520),n(581454);var a=()=>n(590526),i=()=>n(457726),s=()=>n(943290),o=()=>n(496603),r=()=>n(534177),l=()=>n(680325);function c(e){const{sessionContext:t,currentSpaceStore:n}=e;return(0,a().K8)((()=>{if(!t)return{type:"empty_state"};if(!t.selectedSkillFromStoreState&&0===t.clientStepsFromStoreState.length)return{type:"empty_state"};if(!t.selectedSkillFromStoreState&&1===t.clientStepsFromStoreState.length&&"assistantLoadPage"===t.clientStepsFromStoreState[0].type)return{type:"empty_state"};if(null!=t&&t.hasPreviewingStepErrorObservations())return{type:"error"};const e=(null==t?void 0:t.getCombinedSteps())??[],{latestCommitInferenceIdFromStoreState:a}=t,c=o().$n(e,(e=>"groupedEditCard"===e.type&&e.inferenceId===a));if(c.length>0){const e=t.groupedPendingOperations.state,n=new Set(c.map((e=>e.pageId))),a=e.filter((e=>n.has(e.pageId)));return a.length>0?a.every(s().BL)?{type:"pages_created",groups:a}:{type:"accept_edits",operationIds:(0,s().qT)(a)}:{type:"actioned_edits"}}const d=e.filter((e=>!(0,i().EX)(e))),u=d.at(d.length-1);if(void 0===u)return{type:"chat",chatStep:void 0};const{type:p}=u;if("assistantShowSearchResults"===p||"assistantSearch"===p)return{type:"search_result_chat",chatStep:void 0};if("assistantChat"===p){const{pageCitations:e,databaseCitations:t}=(0,l().Q_)({clientStep:u,citationOrdering:void 0,parentStore:n});return e.length>0||t.length>0?{type:"search_result_chat",chatStep:u}:{type:"chat",chatStep:u}}return"humanAction"===p?{type:"actioned_edits"}:"human"===p||"groupedEditCard"===p||"assistantLimitReached"===p||"assistantChatText"===p||"assistantSearchPeople"===p||"assistantSearchDatabases"===p||"assistantTransaction"===p||"assistantLoading"===p||"assistantLoadDatabase"===p||"assistantQueryingDatabase"===p||"assistantRetry"===p||"assistantNoOperationsFromReplace"===p||"assistantSelectEntity"===p||"assistantLoadPage"===p||"queryDatabase"===p||"clientAssistantHumanAttachmentUpload"===p||"assistantStartResearchMode"===p?{type:"chat",chatStep:void 0}:void(0,r().HB)(p)}),[n,t])}},771828:(e,t,n)=>{n.d(t,{A:()=>p});var a=n(296540),i=()=>n(933922),s=()=>n(590526),o=()=>n(401497),r=()=>n(396896),l=()=>n(31511),c=()=>n(100622),d=()=>n(17849),u=n(474848);function p(){const e=(0,s().K8)((()=>d().c.state.nudge),[]),t=(0,s().K8)((()=>{var e;return null===(e=d().c.state)||void 0===e?void 0:e.temperatureOverride}),[]),[n,p]=a.useState(!1),g=(0,a.useCallback)((e=>{const t=parseFloat(e.target.value);d().c.setState({...d().c.state,temperatureOverride:isNaN(t)?void 0:t})}),[]),m=(0,a.useCallback)((e=>{const t=e.target.value;d().c.setState({...d().c.state,nudge:t})}),[]),h=(0,a.useCallback)((()=>{p(!0)}),[p]),f=(0,a.useCallback)((()=>{p(!1)}),[p]),y=(0,o().IS)((()=>({heading:{textTransform:"uppercase",fontSize:12,fontWeight:600,color:c().Tj.text.tertiary,textAlign:"end",marginInlineEnd:4},field:{fontWeight:500,fontSize:14},wrap:{display:"flex",flexDirection:"column",gap:4,borderRadius:6,marginTop:8,marginBottom:8,background:c().Tj.background.secondaryTranslucent,padding:10},inputs:{display:"flex",flexDirection:"column",gap:4,whiteSpace:"nowrap"}})),[]);return(0,u.jsxs)("div",{style:y.wrap,children:[(0,u.jsx)("div",{style:y.heading,children:"Labeler mode"}),(0,u.jsx)(i().A,{capture:n,render:n=>(0,u.jsxs)("div",{style:y.inputs,children:[(0,u.jsxs)(r().fI,{gap:8,children:[(0,u.jsx)("div",{style:y.field,children:"Temperature: "}),(0,u.jsx)(l().A,{value:String(t??""),onChange:g,placeholder:"0.7 (default)",...n,onFocus:h,onBlur:f})]}),(0,u.jsxs)(r().fI,{gap:8,children:[(0,u.jsx)("div",{style:y.field,children:"Nudge: "}),(0,u.jsx)(l().A,{value:e,onChange:m,placeholder:"Optional nudge shown to the model",...n,onFocus:h,onBlur:f})]})]})})]})}},774111:(e,t,n)=>{n.d(t,{A:()=>i});class a extends(()=>n(757695))().Store{getInitialState(){return{isOpen:!1}}}const i=new a},780175:(e,t,n)=>{n.d(t,{Qx:()=>we,CP:()=>Ce,Ay:()=>ke,wh:()=>Te,CZ:()=>je});n(944114),n(898992),n(354520),n(581454),n(737550);var a=n(296540),i=()=>n(907258),s=()=>n(717137),o=()=>n(782482),r=()=>n(726637),l=()=>n(484714),c=()=>n(590526),d=()=>n(991003),u=()=>n(779315),p=()=>n(710515),g=()=>n(127833),m=()=>n(98126),h=()=>n(546926),f=()=>n(890492),y=()=>n(736847),v=()=>n(452004),S=()=>n(902006),b=()=>n(24279),x=()=>n(206267),I=()=>n(69708),k=()=>n(496603),w=()=>n(534177),C=()=>n(576590),A=()=>n(913839),T=()=>n(655600),j=()=>n(610083),M=()=>n(419357),_=()=>n(631611),P=()=>n(691298),D=()=>n(864139),E=()=>n(895933),R=()=>n(525569),B=()=>n(423995),F=()=>n(995277),N=()=>n(501305),L=()=>n(977270),O=()=>n(255350),V=()=>n(605804),z=()=>n(604018),W=()=>n(383070),U=()=>n(483730),H=()=>n(715142),K=()=>n(879643),q=(n(672577),()=>n(401497)),$=()=>n(718827),G=()=>n(807449),Y=()=>n(26697),Q=()=>n(349679),J=()=>n(100622),X=()=>n(606273),Z=()=>n(396301),ee=()=>n(371960),te=()=>n(163591),ne=n(474848);const ae=20,ie=14,se=24;function oe(e){const{item:t,onClick:n,showToggle:i,currentSearchScope:s}=e,o=e.depth??0,[l,d]=a.useState(!1),u=a.useMemo((()=>!!s&&(0,O().I9)({scopeMenuItem:t,currentSearchScope:s})),[t,s]),p=a.useCallback((()=>{n(t)}),[n,t]),g=a.useCallback((()=>{d(!l)}),[l,d]),m=function(e){const{depth:t}=e;return(0,q().IS)((()=>({outlinerItem:{display:"flex",flexDirection:"row",fontSize:14,height:28,paddingInlineStart:re(t),color:J().Tj.text.primary,alignItems:"center",...r().A.isMobile&&{fontSize:16,height:56,backgroundColor:J().Tj.background.primary,borderBottom:`1px ${J().Tj.border.primaryTranslucent} solid`}},noChildrenLabelItem:{paddingInlineStart:re(t)+se,fontSize:14,paddingBottom:6.5,color:J().Tj.text.tertiary,...r().A.isMobile&&{paddingBottom:void 0,fontSize:16,height:56,backgroundColor:J().Tj.background.primary,borderBottom:`1px ${J().Tj.border.primaryTranslucent} solid`}},checkmarkIcon:{marginInlineEnd:12,justifySelf:"right"},noToggleButtonDiv:{width:se},tooltipBody:{display:"flex",flexDirection:"column"},tooltip:{whiteSpace:"pre-wrap"}})),[t])}({depth:o}),h=a.useMemo((()=>!!i&&("everything"!==t.type&&"workspace"!==t.type&&"notion"!==t.type&&"helpdocs"!==t.type&&"ai-knowledge"!==t.type&&"web"!==t.type&&"site"!==t.type&&!(0,S().SC)(t.type)&&("teamspace"===t.type||"page"===t.type||"collection"===t.type||(0,w().HB)(t.type)))),[t,i]),f=(0,c().K8)((()=>!("everything"!==t.type&&"teamspace"!==t.type&&"workspace"!==t.type&&"notion"!==t.type&&"helpdocs"!==t.type&&"ai-knowledge"!==t.type&&"web"!==t.type&&"site"!==t.type&&!(0,S().SC)(t.type))||("page"===t.type||"collection"===t.type?(0,O().JW)(t.pageStore):"site"!==t.type&&(0,w().HB)(t.type))),[t]),y=(0,c().K8)((()=>{const e=(0,O().hX)();return"everything"===t.type||"workspace"===t.type||"collection"===t.type||"slack"===t.type||"notion"===t.type||"helpdocs"===t.type||"ai-knowledge"===t.type||"web"===t.type||"site"===t.type||(0,S().SC)(t.type)?[]:"teamspace"===t.type?t.teamStore.getTeamPageStores():"page"===t.type?(0,Z().yD)({rootStore:t.pageStore,shouldSkipItemTypes:O().j8,shouldShowItemTypes:e}):(0,w().HB)(t.type)}),[t]),v=(0,c().K8)((()=>y.map((e=>(0,O().D0)(e)))),[y]);if(!f)return null;const b=0!==y.length,x=b?(0,ne.jsx)(ne.Fragment,{children:v.map((e=>(0,ne.jsx)(oe,{item:e,onClick:e=>n(e),depth:o+1,showToggle:i,currentSearchScope:s},e.pageStore.id)))}):(0,ne.jsx)("div",{style:m.noChildrenLabelItem,children:(0,ne.jsx)(I().sA,{defaultMessage:"No pages inside",id:"assistantScopedSearchOutlinerItem.NoPagesInside.placeholder"})});return(0,ne.jsx)(Y().m,{style:m.tooltip,placement:"left",renderTooltip:()=>(0,ne.jsx)("div",{style:m.tooltipBody,children:(0,ne.jsx)(te().z,{item:t})}),render:e=>(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)($().Ay,{onClick:p,...e,children:(0,ne.jsxs)("div",{style:m.outlinerItem,children:[h?b?(0,ne.jsx)(X().f,{isSidebar:!1,fill:!0,icon:"chevron",open:l,color:J().Tj.icon.secondary,onClick:g}):(0,ne.jsx)("div",{style:m.noToggleButtonDiv}):void 0,(0,ne.jsx)(ee().Ay,{item:t}),(0,ne.jsx)(te().A,{item:t}),u?(0,ne.jsx)("span",{style:m.checkmarkIcon,children:(0,ne.jsx)(G().I,{icon:Q().checkmarkSmallIcon,size:"sm",colorVariant:"tertiary"})}):void 0]})}),l&&o<ae?x:void 0]})})}function re(e){return(e+1)*ie}function le(e){const{defaultScopeMenuItems:t,teamSpaceMenuItems:n,onSelect:i,currentSearchScope:s,currentSearchScopes:o}=e,r=(0,q().IS)((()=>({mobileSectionTitleStyle:{lineHeight:"14px"}})),[]),l=(0,a.useCallback)((e=>{let t=s;return(0,w().O9)(o)&&(t=o.find((t=>t.type===e.type))||s),t}),[s,o]);return(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(y().A,{mobileTitleStyle:r.mobileSectionTitleStyle,children:t.map(((e,t)=>(0,ne.jsx)(oe,{showToggle:!1,item:e,onClick:e=>{i(e)},currentSearchScope:l(e)},`${e.type}_${t}`)))}),n.length>0?(0,ne.jsx)(y().A,{mobileTitleStyle:r.mobileSectionTitleStyle,title:(0,ne.jsx)(I().sA,{id:"assistantScopedSearchSuggestedResults.teamspaces.title",defaultMessage:"Select a team or page"}),children:n.map(((e,t)=>(0,ne.jsx)(oe,{showToggle:!0,item:e,onClick:e=>{i(e)},currentSearchScope:l(e)},`${e.type}_${t}`)))}):void 0]})}var ce=()=>n(300474),de=()=>n(852507),ue=()=>n(81068),pe=()=>n(944924),ge=()=>n(617668),me=()=>n(96563),he=()=>n(528093),fe=()=>n(152870),ye=()=>n(895959);const ve=(0,I().YK)({getAiConnectorsFooterTitle:{id:"maybeAssistantScopedSearchMenuGetAiConnectorsFooter.titleHasSomeConnectors",defaultMessage:"Connect apps"}}),Se=2;const be=300,xe=325,Ie=(0,I().YK)({inputPlaceholder:{id:"assistantScopedSearchMenu.inputMenuItem.searchSource.placeholder",defaultMessage:"Find or use knowledge in"}});function ke(e){const{buttonPopupParent:t,onSelect:n,analyticsSource:s,restoreLastHumanStep:o=!1}=e,r=(0,l().v3)(),d=(0,_().jw)(),u=je(),{completionContext:p,writerSessionId:g}=(0,c().K8)((()=>{const e=R().default.state;return"assistantCompletionPopup"===e.type?{completionContext:e.context,writerSessionId:e.sessionId}:{completionContext:void 0,writerSessionId:void 0}}),[]),m=Te(),h=(0,c().O$)(i().AppStoreSidebarSpaceStore),{clearSavedSelection:f}=(0,P().A)({shouldPreserveTextSelection:!0,shouldPreserveBlockSelection:!1,shouldRestoreSelection:!0}),y=a.useCallback((async e=>{let n=u;if(n)n.assistantConfigurationStore.setSearchScope(e);else{var a;const{sessionId:t}=await(0,F().p)({environment:r,sessionId:g,completionContext:p,makeActiveSession:!(0,w().O9)(p)});n=U().default.getSessionContext(t),null===(a=n)||void 0===a||a.assistantConfigurationStore.setSearchScope(e)}if(n){n.createUpdater().write((t=>{if(t.commitPreviewingStep(),t.addClientStep({inferenceId:x().JW(),type:"assistantScopeChange",scope:e}),o){const e=k().Uk(t.evaluatorFromStoreState.getTranscript(),b().ox),n=e&&null!=h&&h.getRecordModel?(0,V().ND)({step:e,evaluatorState:t.evaluatorFromStoreState.state,getRecordModel:h.getRecordModel}):void 0;n&&(0,N().setPrimeTextInput)(n),f()}}))}n&&"collection"===e.type&&await(0,B().n)({environment:r,assistantSessionContext:n,collectionId:e.collectionId,assistantSurfaceType:d.type}),t.close()}),[u,r,t,g,p,h,f,d.type,o]);return(0,ne.jsx)(we,{currentSearchScope:m,onChangeSearchScope:y,buttonPopupParent:t,onSelect:n,analyticsSource:s})}function we(e){const{currentSearchScope:t,currentSearchScopes:n,onChangeSearchScope:d,onSelect:g,analyticsSource:m,buttonPopupParent:b,isSearchMenuScopePermitted:x}=e,k=(0,l().v3)(),M=(0,_().jw)(),{isPhone:P}=(0,l().Y0)(),E=M.isWriter,R=M.isType("workflowEditor"),[B,F]=a.useState(""),[N,V]=a.useState(!1),H=(0,c().uB)(void 0,v().$),$=(0,c().O$)(i().AppStoreSidebarSpaceStore),Y=(0,c().O$)(i().AppStoreSidebarSpaceViewStore),Q=(0,c().O$)(A().o),X=(0,c().K8)((()=>Y?(0,p().r)(Y).map((e=>({type:"teamspace",teamStore:e}))):[]),[Y]),Z=(0,c().O$)(i().AppStoreMainEditorCurrentBlockStore),ee=(0,c().K8)((()=>{const e=[{type:"everything"}];Z&&(0,O().JW)(Z)&&e.push((0,O().D0)(Z));const a=(0,z().wd)();(0,T().F1)(Q)&&!r().A.isMobile&&a.push("github"),(0,T().al)(j().Rh.state)&&!r().A.isMobile&&a.push("slack");const i=D().qu.state.isLoaded&&D().qu.state.hasCustomConnector&&W().zD.canUseAiConnectorSearchScope("custom"),s=W().zD.canShowWebSearchScopeForAssistant(),o=!E;R&&(e.push({type:"workspace"}),e.push({type:"web"}));(s||o||a.length>0||i)&&e.push({type:"notion"}),o&&e.push({type:"ai-knowledge"}),i&&e.push({type:"custom"});for(const t of a)"custom"!==t&&e.push({type:t});e.push({type:"helpdocs"});let l;return e.some((e=>(0,w().O9)(n)?n.some((t=>(0,O().I9)({scopeMenuItem:e,currentSearchScope:t}))):(0,O().I9)({scopeMenuItem:e,currentSearchScope:t})))||!$?l=e:(l=[...e],(0,w().O9)(n)?l.concat(n.map((e=>(0,O().Io)({searchScope:e,sidebarSpaceStore:$})))):l.concat((0,O().Io)({searchScope:t,sidebarSpaceStore:$}))),x&&(l=l.filter(x)),l}),[Z,E,R,$,x,t,n,Q]);a.useEffect((()=>(L().assistantAnalyticsActions.trackScopeSearchMenuOpen(k,{from:m,options_displayed:ee.map((e=>e.type))}),()=>{L().assistantAnalyticsActions.trackScopeSearchMenuClose(k,{from:m})})),[k,m,ee]);const te=a.useCallback((()=>{b.close()}),[b]),ae=a.useCallback((e=>{F(e),H.update((e=>({...e,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})))}),[F,H]),ie=a.useCallback((e=>{let t;if("slack"===e.type){if((0,T().al)(j().Rh.state))return void(0,C().openAuthNeededModal)({environment:k,connector:"slack",from:"ai_chat_scoped_search_menu"});t=e}else if("github"===e.type){if((0,T().F1)(Q))return void(0,C().openAuthNeededModal)({environment:k,connector:"github",from:"ai_chat_scoped_search_menu"});t=e}else"everything"===e.type||"workspace"===e.type||"helpdocs"===e.type||"notion"===e.type||"web"===e.type||"ai-knowledge"===e.type?t=e:(0,S().SC)(e.type)?t="custom"===e.type?{type:"custom",thirdPartyId:"",displayName:""}:{type:e.type}:"teamspace"===e.type?t={type:e.type,teamId:e.teamStore.id}:"page"===e.type?t={type:e.type,pageId:e.pageStore.id}:"collection"===e.type?t={type:e.type,pageId:e.pageStore.id,collectionId:e.collectionId}:"site"===e.type?t={type:e.type,siteId:e.siteStore.id}:(0,w().HB)(e.type);d(t),null==g||g()}),[Q,d,g,k]);let se;const oe=(0,ne.jsx)(Ae,{onCancel:te,query:B,onChange:ae,isLoading:N});se=P?oe:(0,ne.jsx)(y().A,{isInput:!0,children:oe});const[re,Ie]=(0,a.useState)(!1),ke=(0,a.useCallback)((()=>{var e;const t=null===(e=u().A.MenuScroller)||void 0===e?void 0:e.getNode();if(!t)return;const n=Math.abs(t.scrollHeight-(t.scrollTop+t.clientHeight))<4;Ie(n)}),[]);(0,a.useEffect)((()=>{if(!u().A.MenuScroller)return;const e=u().A.MenuScroller.getNode();if(!e)return;const t=new MutationObserver((()=>{ke()}));return t.observe(e,{childList:!0,subtree:!0}),ke(),()=>t.disconnect()}),[ke]);const{footer:we,scrollerStyle:Ce}=function(e){const{buttonPopupParent:t,isScrolledToBottom:n}=e,i=(0,l().v3)(),s=(0,_().jw)().canUseGetAiConnectorScopeMenuFooter,o=(0,c().K8)((()=>L().AssistantFeatureGateStore.isNewFullPageWelcomeStateEnabled()),[]),d=(0,ce().r)(),u=(0,c().K8)((()=>U().default.getActiveSessionId()),[]),p=(0,he()._)({name:"ai_connectors",spaceId:d,userId:i.currentUser.id}),g=(0,c().K8)(z().kB,[]),m=(0,c().K8)(z().Nr,[]),h=(0,q().IS)((()=>({container:{boxShadow:`0 -1px 0 ${J().Tj.border.secondaryTranslucent}`,paddingTop:9,paddingBottom:8,paddingInlineStart:18,gap:4},buttonStyle:{borderRadius:0},titleWrapper:{display:"flex",flexDirection:"row",justifyContent:"space-between"},rightWrapper:{display:"flex",flexDirection:"row",alignItems:"flex-start"},icon:{width:22,height:18},chevronIcon:{marginInlineStart:4}})),[]);(0,de().w)((()=>{L().assistantAnalyticsActions.trackAssistantScopeMenuGetAiConnectorsInteraction({environment:i,sessionId:u,interaction:"seen"})}));const f=(0,a.useCallback)((()=>{L().assistantAnalyticsActions.trackAssistantScopeMenuGetAiConnectorsInteraction({environment:i,sessionId:u,interaction:"clicked"}),t.close(),p&&(0,me().pp)({environment:i,connector:"generic",analyticsFrom:"ai_corner_chat_connectors_button",connectorsFeatureAvailability:p})}),[i,t,u,p]);if(!o||!s||r().A.isMobile||0!==g.length&&0===m.length)return{footer:null};const y=m.map((e=>(0,ye().aY)(e)));return{footer:(0,ne.jsx)(ue().A,{style:h.container,buttonStyle:h.buttonStyle,onClick:f,icon:(0,ne.jsx)(G().I,{icon:ge().plusIcon,style:h.icon}),title:(0,ne.jsxs)("div",{style:h.titleWrapper,children:[(0,ne.jsx)(I().sA,{...ve.getAiConnectorsFooterTitle}),(0,ne.jsxs)("div",{style:h.rightWrapper,children:[(0,ne.jsx)(fe().RH,{icons:y.slice(0,Se),plusNBubble:y.length>Se?y.length-Se:void 0,iconSize:12,bubbleSize:16,marginLeft:-3}),(0,ne.jsx)(G().I,{icon:pe().arrowChevronSingleRightFillIcon,size:18,colorVariant:"tertiary",style:h.chevronIcon})]})]}),focused:!1}),scrollerStyle:n?void 0:{WebkitMaskImage:"linear-gradient(black calc(100% - 32px), transparent calc(100%))"}}}({buttonPopupParent:b,isScrolledToBottom:re});let Te;return Te=P?{menuType:h().gu.Modal,right:(0,ne.jsx)(I().sA,{defaultMessage:"Done",id:"assistantScopedSearch.rightDoneButton.label"}),onClickRight:te,header:se,footer:we,scrollerStyle:Ce,onScroll:ke}:{menuType:h().gu.Popup,width:be,maxHeight:xe,header:se,footer:we,scrollerStyle:Ce,onScroll:ke},(0,ne.jsxs)(s().A,{debugName:"AssistantScopedSearchMenuIgnore",capture:!0,children:[(0,ne.jsx)(o().N,{debugName:"AssistantScopedSearchMenu",capture:!0,onEsc:te}),(0,ne.jsx)(f().A,{...Te,children:B?(0,ne.jsx)(K().A,{defaultMenuItems:ee,menuListStore:H,onSelect:ie,query:B,setIsLoading:V,teamSpaceMenuItems:X}):(0,ne.jsx)(le,{currentSearchScope:t,currentSearchScopes:n,defaultScopeMenuItems:ee,onSelect:ie,teamSpaceMenuItems:X})})]})}function Ce(){var e;const t=(0,c().O$)(E().A);return t.open&&t.originComponent?(0,ne.jsx)(g().zD,{enableOutsideClickDismiss:!0,alignmentToOrigin:"start",placementToOrigin:"left",originGap:8,onDismiss:()=>{E().A.setState({...E().A.state,open:!1})},open:t.open,originRect:null===(e=t.originComponent)||void 0===e?void 0:e.getBoundingClientRect(),popupType:g().nl.Popup,render:()=>(0,ne.jsx)(ke,{buttonPopupParent:{close:()=>{E().A.setState({...E().A.state,open:!1})}},analyticsSource:"find_in_action"})}):null}function Ae(e){const{isLoading:t,onCancel:n,query:a,onChange:i}=e,s=(0,I().tz)(),{isPhone:o}=(0,l().Y0)(),r=(0,d().A)(t,400,0);return(0,ne.jsx)(M().Ay,{style:{marginBottom:-2},onCancel:n,focus:!o||void 0,focusAfterAnimation:!0,focusInitial:!0,value:a,onChange:e=>{i(e.target.value)},placeholder:s.formatMessage(Ie.inputPlaceholder),inputRight:r&&(0,ne.jsx)(m().A,{style:{marginInlineEnd:2}})})}function Te(){const e=(0,_().jw)(),t=je();return(0,c().K8)((()=>{var n;return(null==t||null===(n=t.assistantConfigurationStoreState)||void 0===n?void 0:n.searchScope)??(0,O().Ac)(e.isWriter,!1)}),[e,t])}function je(){const e=(0,_().jw)();return(0,c().K8)((()=>e.isWriter?(0,H().K1)():U().default.getActiveSession()),[e])}},782215:(e,t,n)=>{n.d(t,{Wq:()=>b,Z2:()=>x,lN:()=>I});var a=()=>n(564884),i=()=>n(295633),s=()=>n(584262),o=()=>n(165358),r=()=>n(427704),l=()=>n(179034),c=()=>n(229833),d=()=>n(534177),u=()=>n(209660),p=()=>n(857783),g=()=>n(977270),m=()=>n(854513),h=()=>n(246766),f=()=>n(334600),y=()=>n(261505),v=()=>n(11786),S=()=>n(46986);function b({action:e,environment:t,metadata:n}){switch(e.type){case"link":window.open(e.link);break;case"open_settings":const b=(0,f().lR)(e.page);b&&u().Ow({currentTab:b});break;case"view_block":const x=new(i().B)(t,{table:l().ev,id:e.blockId});x.isDefined()&&p().uK({environment:t,store:x,pageVisitSource:s().y8.Sidebar});break;case"create_database":const I=function(e){if(e&&"object"==typeof e&&"nudgeData"in e&&e.nudgeData&&"object"==typeof e.nudgeData){const t=e.nudgeData;if("todoBlocks"in t&&"currentBlockId"in t&&"parentBlock"in t)return t}return null}(n);I&&(0,v().createDatabaseFromTodoBlocks)({environment:t,nudgeData:I});break;case"open_agent":(0,S().re)()&&g().agentActions.openNewAgentSidebarFromMainBlock({environment:t,primeTextInput:e.query});break;case"create_transcription_block":(async()=>{try{(await m().$.load()).createAndNavigateToTranscriptionBlock({environment:t,from:e.from,title:"new_page"})}catch(n){o().log({level:"error",from:"handleInAppMessageAction",type:"failed_to_lazy_load_transcription_create_actions",error:(0,c().convertErrorToLog)(n)})}})();break;case"open_trial_modal":!function(e){const{modalType:t}=e;switch(t){case"business_trial_start":y().openBusinessTrialStartModal({openedFrom:"sidebar_upgrade_nudge"});break;case"business_trial_ending":y().openBusinessTrialEndingModal({openedFrom:"self_serve_business_trial_ending_soon_nudge",modalState:"initial"});break;case"business_trial_explore":y().openBusinessTrialExplorePlanModal({openedFrom:"self_serve_business_trial_nudge"});break;default:(0,d().HB)(t)}}(e);break;case"open_meetings_tab":(0,a().u)({environment:t,event:{eventName:"ai_meetings_tab_click",eventProperties:{source:"in_app_message"}}}),(0,h().navigate)({environment:t,url:r().JZ.meet});break;default:(0,d().HB)(e)}}function x(e){return"tooltip"===e.type&&"object"==typeof e.props&&"tooltipOrigin"in e.props&&"bottom_assistant"===e.props.tooltipOrigin}function I(e){return"toast"===e.type?(e.type,!0):(e.type,!1)}},782535:(e,t,n)=>{n.r(t),n.d(t,{trackDatabaseEntrypointCta:()=>i});var a=()=>n(564884);function i(e){const{environment:t,...n}=e;(0,a().u)({environment:t,event:{eventName:"database_entrypoint_cta",eventProperties:n}})}},786416:(e,t,n)=>{n.d(t,{l:()=>me});n(898992),n(354520),n(581454);var a=n(296540),i=()=>n(484714),s=()=>n(590526),o=()=>n(396896),r=()=>n(98126),l=()=>n(940148),c=()=>n(302501),d=()=>n(604995),u=()=>n(69708),p=()=>n(603907),g=()=>n(625383),m=(n(814603),n(147566),n(198721),()=>n(907258)),h=()=>n(692031),f=()=>n(212497),y=()=>n(59226),v=()=>n(792057),S=()=>n(118307),b=()=>n(807449),x=()=>n(546926),I=()=>n(26697),k=()=>n(890492),w=()=>n(81068),C=()=>n(663639),A=()=>n(736847),T=()=>n(745130),j=()=>n(742852),M=()=>n(735790),_=n(474848);const P={viewBox:"0 0 20 20",fittedViewBox:"2.37 3.12 15.25 13.75",svg:(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("path",{d:"M5.5 7.625a1.375 1.375 0 1 0 0-2.75 1.375 1.375 0 0 0 0 2.75"}),(0,_.jsx)("path",{d:"M5.5 3.125a3.125 3.125 0 1 0 0 6.25h9a3.125 3.125 0 1 0 0-6.25zM3.625 6.25c0-1.036.84-1.875 1.875-1.875h9a1.875 1.875 0 0 1 0 3.75h-9A1.875 1.875 0 0 1 3.625 6.25M5.5 10.625a3.125 3.125 0 1 0 0 6.25h9a3.125 3.125 0 1 0 0-6.25zm9 4.625a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"})]})},D=(0,n(340498).wt)("switch",P,"default");var E=()=>n(236262),R=()=>n(496703),B=()=>n(769864),F=()=>n(904671),N=()=>n(482707),L=()=>n(114871),O=()=>n(437487),V=()=>n(454354),z=()=>n(962874),W=()=>n(465672);n(737550);function U(e){var t,n;const a=(null===(t=e.getDraftData())||void 0===t?void 0:t.triggers)||[],i=(null===(n=e.getData())||void 0===n?void 0:n.triggers)||[];return a.length>0?a:i}function H(e){return U(e).some((e=>e.enabled))}function K(e,t){if(!1===t)return!0;return!1===e.getAlive()||void 0!==e.getMovedToTrashId()}function q({workflowStore:e,spaceId:t,serverAlive:n,onRefresh:o}){const r=(0,i().v3)(),l=(0,u().tz)(),c=(0,s().uB)(void 0,S().A),[d,p]=(0,a.useState)(!1),g=(0,s().uB)(void 0,L().Ay),P=(0,s().uB)(void 0,V().A),U=(0,s().O$)(m().AppStoreSidebarSpaceStore),{isEnabled:q,tooltipMessage:$}=(0,z().P)(),G=(0,s().K8)((()=>{const t=P.state.privateWorkflowStore;return t&&t.id===e.id?t:e}),[P,e]),Y=(0,y().X)("workflow_disable_agent_level"),Q=(0,s().K8)((()=>{var t;const n=e.getDataStore().getValue();return"paused"===(null==n?void 0:n.status)&&"disabledByAdmin"===(null==n||null===(t=n.paused_reason)||void 0===t?void 0:t.reason)}),[e]),J=(0,s().K8)((()=>Y?Q:Q||!H(e)),[e,Y,Q]),X=(0,s().K8)((()=>K(e,n)),[e,n]),Z=(0,a.useCallback)((async()=>{const n=t||e.getSpaceId();if(!n)return;const{accept:a}=await v().Gh({message:l.formatMessage({id:"adminContentSearchTab.agentsTable.disableAgent.confirm",defaultMessage:"Are you sure you want to disable this agent?"}),acceptLabel:l.formatMessage({id:"adminContentSearchTab.agentsTable.disableAgent.acceptLabel",defaultMessage:"Disable agent"})});a&&(c.setState({open:!1}),await B().callApi({eventName:"disableWorkflow",environment:r,data:{workflowId:e.id,spaceId:n}}),await o())}),[r,e,t,l,c,o]),ee=(0,a.useCallback)((async()=>{const n=t||e.getSpaceId();n&&(c.setState({open:!1}),await B().callApi({eventName:"enableWorkflow",environment:r,data:{workflowId:e.id,spaceId:n}}),await o())}),[r,e,t,c,o]),te=(0,a.useCallback)((async()=>{const t=new URL((0,R().L)({workflowId:e.id,params:{}}),window.location.origin).href,[n,a]=await Promise.all([(0,h().r)(),(0,f().jd)()]);await a({environment:r,stringValue:t,copiedMessage:n.copiedLinkToClipboard})}),[r,e.id]),ne=(0,a.useCallback)((async()=>{const{accept:n}=await v().Gh({message:l.formatMessage({id:"adminContentSearchTab.agentsTable.delete.confirm",defaultMessage:"Delete this agent?"}),acceptLabel:l.formatMessage({id:"workflows.agentTopbar.deleteAcceptLabel",defaultMessage:"Delete"})});if(!n)return;const a=t||e.getSpaceId();a&&(await B().callApi({eventName:"deleteWorkflow",environment:r,data:{workflowId:e.id,spaceId:a}}),await o())}),[r,e,l,t,o]),ae=(0,a.useCallback)((async()=>{const n=t||e.getSpaceId();n&&(await B().callApi({eventName:"restoreWorkflow",environment:r,data:{workflowId:e.id,spaceId:n}}),await o())}),[r,e,t,o]),ie=(0,_.jsx)(k().A,{menuType:x().gu.Popup,width:256,children:(0,_.jsx)(C().A,{type:C().O.Vertical,initialFocus:void 0,sections:[{key:0,render:e=>(0,_.jsx)(A().A,{...e}),items:[{key:"change-permissions",render:e=>q?(0,_.jsx)(w().A,{icon:(0,_.jsx)(b().I,{icon:M().M}),title:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.actions.changePermissions",defaultMessage:"Change permissions"}),...e}):(0,_.jsx)(I().m,{delayThreshold:0,renderTooltip:()=>$,placement:"right",textWrap:!0,render:t=>(0,_.jsx)("div",{...t,children:(0,_.jsx)(w().A,{...e,icon:(0,_.jsx)(b().I,{icon:M().M}),title:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.actions.changePermissions",defaultMessage:"Change permissions"}),disabled:!0,disabledFeedback:!0,buttonStyle:{cursor:"not-allowed"}})})}),action:async()=>{q&&(P.setState({...P.state,changePermissionsEnabled:!0}),!U||P.state.privateWorkflowStore&&P.state.privateWorkflowStore.id===e.id||await F().YL({environment:r,sudoModeStore:P,workflowId:e.id,sidebarSpaceStore:U}),p(!0))}},...Q?[{key:"enable-workflow",render:e=>(0,_.jsx)(w().A,{icon:(0,_.jsx)(b().I,{icon:D}),title:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.actions.enableAgent",defaultMessage:"Enable agent"}),...e}),action:ee}]:[],...J?[]:[{key:"disable-workflow",render:e=>(0,_.jsx)(w().A,{icon:(0,_.jsx)(b().I,{icon:D}),title:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.actions.disableAgent",defaultMessage:"Disable agent"}),...e}),action:Z}],{key:"copy-link",render:e=>(0,_.jsx)(w().A,{icon:(0,_.jsx)(b().I,{icon:j().linkIcon}),title:(0,_.jsx)(u().sA,{id:"workflows.agentTopbar.copyLink",defaultMessage:"Copy link"}),...e}),action:te},...X?[{key:"restore",render:e=>(0,_.jsx)(w().A,{icon:(0,_.jsx)(b().I,{icon:T().E}),title:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.actions.restoreAgent",defaultMessage:"Restore agent"}),...e}),action:ae}]:[{key:"delete",render:e=>q?(0,_.jsx)(w().A,{isRedOnHover:!0,icon:(0,_.jsx)(b().I,{icon:E().trashIcon}),title:(0,_.jsx)(u().sA,{id:"workflows.agentTopbar.deleteAgent",defaultMessage:"Delete agent"}),...e}):(0,_.jsx)(I().m,{delayThreshold:0,renderTooltip:()=>$,placement:"right",textWrap:!0,render:t=>(0,_.jsx)("div",{...t,children:(0,_.jsx)(w().A,{...e,icon:(0,_.jsx)(b().I,{icon:E().trashIcon}),title:(0,_.jsx)(u().sA,{id:"workflows.agentTopbar.deleteAgent",defaultMessage:"Delete agent"}),disabled:!0,disabledFeedback:!0,buttonStyle:{cursor:"not-allowed"}})})}),action:async()=>{q&&await ne()}}]]}]})});return(0,_.jsx)(W().j,{onClose:()=>{p(!1),O().Ay.reset()},originAriaLabel:l.formatMessage({id:"adminContentSearchTab.agentsTable.actions.more",defaultMessage:"More actions for agent"}),popupStore:c,render:()=>d?(0,_.jsx)(N().k,{store:G,inviteTargetsStore:g,sudoModeStore:P,location:"admin_content_search"}):ie,useShareMenuStyles:d})}n(944114),n(672577);var $=()=>n(493552),G=()=>n(101163),Y=()=>n(966249),Q=()=>n(297872);function J(e){const{modules:t}=e,i=(0,u().tz)(),s=(0,n(401497).IS)((()=>({integrationRow:{display:"flex",alignItems:"center",gap:6},iconContainer:{width:16,height:16,display:"grid",placeItems:"center"},menuItem:{display:"flex",alignItems:"center",gap:8,padding:"6px 8px"}})),[]),o=(0,a.useMemo)((()=>{if(!t||!Array.isArray(t))return[];try{return t}catch{return[]}}),[t]),r=(0,a.useMemo)((()=>{const e=o.find((e=>"notion"===e.type));return!!e&&(0,n(905470).qQ)(e.permissions)}),[o]),l=(0,a.useMemo)((()=>o.filter((e=>"notion"!==e.type))),[o]),c=l.length+(r?1:0),d=(0,a.useMemo)((()=>{if(0===c)return"";if(1===c){if(r)return i.formatMessage({id:"workflows.notion.permissions.webAccess",defaultMessage:"Web access"});const e=l[0],t=Y().Nh[e.type];return t?t.getName(i):""}return i.formatMessage({id:"adminContentSearchTab.agentsTable.integrations.count",defaultMessage:"{count, plural, one {# connection} other {# connections}}"},{count:c})}),[c,r,l,i]),p=(0,a.useMemo)((()=>{const e=[];r&&e.push({key:"web-access",render:e=>(0,_.jsxs)("div",{style:s.menuItem,...e,children:[(0,_.jsx)("span",{style:s.iconContainer,children:(0,_.jsx)(b().I,{icon:G().globeSmallIcon,size:"sm",colorVariant:"primary"})}),(0,_.jsx)($().D,{styleKey:"bodyRegular",children:(0,_.jsx)(u().sA,{id:"workflows.notion.permissions.webAccess",defaultMessage:"Web access"})})]}),action:()=>{}});for(const t of l){const n=Y().Nh[t.type];if(!n)continue;const a=n.getIcon(),o=n.getName(i);e.push({key:t.id,render:e=>(0,_.jsxs)("div",{style:s.menuItem,...e,children:[(0,_.jsx)("span",{style:s.iconContainer,children:(0,_.jsx)(b().I,{icon:a,size:"sm"})}),(0,_.jsx)($().D,{styleKey:"bodyRegular",children:o})]}),action:()=>{}})}return e}),[r,l,i,s]);if(0===c)return(0,_.jsx)($().D,{styleKey:"bodyRegular",color:"secondary",children:""});if(1===c){if(r)return(0,_.jsxs)("div",{style:s.integrationRow,children:[(0,_.jsx)("span",{style:s.iconContainer,children:(0,_.jsx)(b().I,{icon:G().globeSmallIcon,size:"sm",colorVariant:"primary"})}),(0,_.jsx)($().D,{styleKey:"bodyRegular",children:(0,_.jsx)(u().sA,{id:"workflows.notion.permissions.webAccess",defaultMessage:"Web access"})})]});const e=l[0],t=Y().Nh[e.type];if(!t)return null;const n=t.getIcon(),a=t.getName(i);return(0,_.jsxs)("div",{style:s.integrationRow,children:[(0,_.jsx)("span",{style:s.iconContainer,children:(0,_.jsx)(b().I,{icon:n,size:"sm"})}),(0,_.jsx)($().D,{styleKey:"bodyRegular",children:a})]})}return(0,_.jsx)(Q().ED,{title:d,items:p,disabled:!1})}n(908872);var X=()=>n(68263),Z=()=>n(922528);const ee=(0,u().YK)({sharedWithMembers:{id:"adminContentSearchTab.agentsTable.sharedWith.members",defaultMessage:"{numMembers, plural, one {# member} other {# members}}"},sharedWithGroups:{id:"adminContentSearchTab.agentsTable.sharedWith.groups",defaultMessage:"{numGroups, plural, one {# group} other {# groups}}"},sharedWithGuests:{id:"adminContentSearchTab.agentsTable.sharedWith.guests",defaultMessage:"{numGuests, plural, one {# guest} other {# guests}}"},separator:{id:"adminContentSearchTab.agentsTable.sharedWith.separator",defaultMessage:", "}});function te({workflowStore:e,ownerUserId:t}){const a=(0,u().tz)(),{summary:i,items:o}=(0,s().K8)((()=>{const t=e.getPermissionItems()||[],i=t.find((e=>"space_permission"===e.type&&"none"!==e.role)),s=[];for(const e of t)if((0,X().Ds)(e)){const t=n(169626).h.getGroup(e.group_id);t&&e.role&&"none"!==e.role&&s.push({group:t,role:e.role})}const o=t.filter((e=>!!(0,X().B2)(e)&&"none"!==e.role)),[r,l]=o.reduce(((t,a)=>{const i=(0,n(230711).sE)(e.getSpaceStore(),a.user_id);return Boolean(i&&!i.isMember())?[[...t[0],a],t[1]]:[t[0],[...t[1],a]]}),[[],[]]),c=[];l.length>0&&c.push(a.formatMessage(ee.sharedWithMembers,{numMembers:l.length})),s.length>0&&c.push(a.formatMessage(ee.sharedWithGroups,{numGroups:s.length})),r.length>0&&c.push(a.formatMessage(ee.sharedWithGuests,{numGuests:r.length}));return{summary:c.length>0?c.join(a.formatMessage(ee.separator)):a.formatMessage({id:"adminContentSearchTab.agentsTable.sharedWith.nobody",defaultMessage:"Nobody"}),items:[...i?[{key:"space-permission",render:e=>(0,_.jsx)(n(642119).N,{...e,permissionItem:i}),action:()=>{}}]:[],...s.map((({group:e,role:t})=>({key:e.group_id,render:a=>(0,_.jsx)(n(408464)._,{...a,name:e.name,icon:e.icon,role:t}),action:()=>{}}))),...l.map((e=>({key:e.user_id,render:t=>(0,_.jsx)(Z().m,{...t,userId:e.user_id,role:e.role}),action:()=>{}}))),...r.map((e=>({key:e.user_id,render:t=>(0,_.jsx)(Z().m,{...t,userId:e.user_id,role:e.role,isGuest:!0}),action:()=>{}})))]}}),[e,a]);return(0,_.jsx)(Q().ED,{title:i,items:o,disabled:0===o.length})}function ne({workflowStore:e,serverAlive:t,serverHasEnabledTriggers:n}){const a=(0,s().K8)((()=>K(e,t)),[e,t]),i=(0,y().X)("workflow_disable_agent_level"),o=(0,s().K8)((()=>{var t;const n=e.getDataStore().getValue(),a="paused"===(null==n?void 0:n.status)&&"disabledByAdmin"===(null==n||null===(t=n.paused_reason)||void 0===t?void 0:t.reason);return i?a:a||!H(e)}),[e,i]);return(0,_.jsx)(c().A,{children:a?(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.status.deleted",defaultMessage:"Deleted"}):o?(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.status.disabledByOwner",defaultMessage:"Disabled"}):(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.status.active",defaultMessage:"Active"})})}function ae({store:e,userIds:t,isClickable:a}){const i=(0,s().K8)((()=>t.map((t=>n(849255).L.createChildStore(e,{table:n(798880).oo,id:t})))),[e,t]);return(0,_.jsx)(n(317131).l,{userStores:i,isClickable:a})}var ie=()=>n(111251);const se={id:"agent",headerTitle:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.agent.name",defaultMessage:"Agent"}),renderCell:e=>(0,_.jsx)(ie().p,{store:e.workflowStore,serverName:e.name,serverIcon:e.icon}),widthData:{width:320,maxWidth:320},sortable:!1},oe={id:"lastActivity",headerTitle:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.lastActivity.name",defaultMessage:"Last activity"}),renderCell:e=>e.lastActivityTs?(0,_.jsx)(g().d,{dateTs:e.lastActivityTs}):(0,_.jsx)(c().A,{children:""}),widthData:{width:120},sortable:!1},re={id:"createdBy",headerTitle:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.createdBy.name",defaultMessage:"Created by"}),renderCell:e=>e.createdById?(0,_.jsx)(ae,{store:e.workflowStore,userIds:[e.createdById]}):null,widthData:{width:140},sortable:!1},le={id:"createdTime",headerTitle:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.createdTime.name",defaultMessage:"Created on"}),renderCell:e=>(0,_.jsx)(g().d,{dateTs:e.createdTime}),widthData:{width:140},sortable:!1},ce={id:"lastEditedBy",headerTitle:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.lastEditedBy.name",defaultMessage:"Last edited by"}),renderCell:e=>e.lastEditedById?(0,_.jsx)(ae,{store:e.workflowStore,userIds:[e.lastEditedById]}):null,widthData:{width:140},sortable:!1},de={id:"lastEditedTime",headerTitle:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.lastEditedTime.name",defaultMessage:"Last edited on"}),renderCell:e=>(0,_.jsx)(g().d,{dateTs:e.lastEditedTime}),widthData:{width:140},sortable:!1},ue={id:"status",headerTitle:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.status.name",defaultMessage:"Status"}),renderCell:e=>(0,_.jsx)(ne,{workflowStore:e.workflowStore,serverAlive:e.alive,serverHasEnabledTriggers:e.hasEnabledTriggers}),widthData:{width:140},sortable:!1},pe={id:"sharedWith",headerTitle:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.sharedWith.name",defaultMessage:"Shared with"}),renderCell:e=>(0,_.jsx)(te,{workflowStore:e.workflowStore,ownerUserId:e.createdById}),widthData:{width:180},sortable:!1},ge={id:"integrations",headerTitle:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.integrations.name",defaultMessage:"Connections"}),renderCell:e=>(0,_.jsx)(J,{modules:e.modules}),widthData:{width:140},sortable:!1};function me(e){const{spaceStore:t,searchQuery:n,createdByIds:g=[],createdTime:m,lastEditedTime:h,sharedWith:f,lastActivityTime:y,status:v=[],integrationTypes:S=[],mcpServerNames:b=[],limit:x,onHasMore:I,onDistinctMcpServersChange:k}=e,w=(0,i().v3)(),C=(0,s().K8)((()=>{if(!t.id)return;const e=e=>{if(null==e||!e.start_date)return;return d().C6.notionDateTimeToLuxon(e,"en").toMillis()},a=e(null==m?void 0:m.starting),i=e(null==m?void 0:m.ending),s=e(null==h?void 0:h.starting),o=e(null==h?void 0:h.ending),r=e(null==y?void 0:y.starting),l=e(null==y?void 0:y.ending);return p().j.getData(w,{spaceId:t.id,query:n,createdByIds:g,createdTimeFrom:a,createdTimeTo:i,lastEditedTimeFrom:s,lastEditedTimeTo:o,sharedWithUserIds:(null==f?void 0:f.filter((e=>"user"===e.type)).map((e=>e.id)))??[],sharedWithGroupIds:(null==f?void 0:f.filter((e=>"permission_group"===e.type)).map((e=>e.id)))??[],lastActivityFrom:r,lastActivityTo:l,status:v,integrationTypes:S,mcpServerNames:b})}),[w,t,n,g,m,h,f,y,v,S,b]),A=void 0===C;(0,a.useEffect)((()=>{null!=C&&C.distinctMcpServers&&k&&k(C.distinctMcpServers)}),[null==C?void 0:C.distinctMcpServers,k]);const T=(0,s().K8)((()=>{const e=null==C?void 0:C.agents,t=(null==C?void 0:C.lastActivityByWorkflowId)||{},n=(null==C?void 0:C.metaByWorkflowId)||{};if(!e)return[];const a=e=>{const t=Number(e);return!Number.isFinite(t)||t<=0?0:t<1e12?1e3*t:t};return e.map((e=>{const i=a(t[e.id]),s=n[e.id];return{id:e.id,isClickable:!1,workflowStore:e,createdTime:a((null==s?void 0:s.createdTime)??e.getCreatedTime()),lastEditedTime:a((null==s?void 0:s.lastEditedTime)??e.getLastEditedTime()),createdById:(null==s?void 0:s.createdById)??e.getCreatedById(),lastEditedById:(null==s?void 0:s.lastEditedById)??e.getLastEditedById(),lastActivityTs:i||void 0,name:null==s?void 0:s.name,icon:null==s?void 0:s.icon,alive:(null==s?void 0:s.alive)??e.getAlive(),hasEnabledTriggers:null==s?void 0:s.hasEnabledTriggers,modules:null==s?void 0:s.modules}}))}),[C]),j=T.length,M=(0,a.useMemo)((()=>void 0!==x&&T.length>x?T.slice(0,x):T),[T,x]);(0,a.useEffect)((()=>{I&&I(void 0!==x&&j>x?j:0)}),[I,x,j]);const P=(0,a.useCallback)((async()=>{if(!t.id)return;const e=e=>{if(null==e||!e.start_date)return;return d().C6.notionDateTimeToLuxon(e,"en").toMillis()};await p().j.resetData(w,{spaceId:t.id,query:n,createdByIds:g,createdTimeFrom:e(null==m?void 0:m.starting),createdTimeTo:e(null==m?void 0:m.ending),lastEditedTimeFrom:e(null==h?void 0:h.starting),lastEditedTimeTo:e(null==h?void 0:h.ending),sharedWithUserIds:(null==f?void 0:f.filter((e=>"user"===e.type)).map((e=>e.id)))??[],sharedWithGroupIds:(null==f?void 0:f.filter((e=>"permission_group"===e.type)).map((e=>e.id)))??[],lastActivityFrom:e(null==y?void 0:y.starting),lastActivityTo:e(null==y?void 0:y.ending),status:v,integrationTypes:S,mcpServerNames:b})}),[w,t.id,n,g,m,h,f,y,v,S,b]),D=(0,a.useMemo)((()=>({...se,renderCell:e=>(0,_.jsx)(ie().p,{store:e.workflowStore,rightIcon:(0,_.jsx)(q,{workflowStore:e.workflowStore,spaceId:e.workflowStore.getSpaceId(),serverAlive:e.alive,onRefresh:P}),serverName:e.name,serverIcon:e.icon})})),[P]),E=(0,a.useMemo)((()=>[D,oe,re,le,ce,de,ue,pe,ge]),[D]),R=(0,a.useMemo)((()=>(0,l().rC)({columnRenderInfo:E,containerMarginTop:0})),[E]);return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(l().WE,{hideHeaderRowPadding:!0,allowHorizontalScroll:!0,setStickyHeaderRow:!0,columnRenderInfo:E,rows:M,renderNoRowsComponent:()=>(0,_.jsx)(c().A,{isSmall:!0,style:{marginTop:15,marginBottom:40,textAlign:"center"},children:(0,_.jsx)(u().sA,{id:"adminContentSearchTab.agentsTable.empty",defaultMessage:"No agents found."})}),styles:R}),A?(0,_.jsx)(o().fI,{justifyContent:"center",children:(0,_.jsx)(r().A,{style:{margin:"24px auto 24px"}})}):null]})}},788749:(e,t,n)=>{n.d(t,{Ps:()=>B,Qc:()=>R,eS:()=>F});n(898992),n(354520),n(672577),n(430670),n(581454);var a=()=>n(203066),i=()=>n(153321),s=n(296540),o=()=>n(907258),r=()=>n(590526),l=()=>n(401497),c=()=>n(295633),d=()=>n(732810),u=()=>n(62178),p=()=>n(699143),g=()=>n(807449),m=()=>n(758304),h=()=>n(493552),f=()=>n(902006),y=()=>n(68169),v=()=>n(605777),S=()=>n(62616),b=()=>n(12193),x=()=>n(207207),I=()=>n(179034),k=()=>n(519831),w=()=>n(69708),C=()=>n(899086),A=()=>n(899483),T=()=>n(143016),j=()=>n(135221),M=()=>n(255063),_=()=>n(883476),P=()=>n(579819),D=n(474848);function E(e,t){try{const n=d().m.createChildStore(t,{table:k().Vl,id:e,spaceId:t.id}),a=(0,u().D)(n,(e=>!0),0);return a&&a instanceof c().B?a.id:void 0}catch(n){return}}function R(e){return(0,D.jsx)(p().Y1,{direction:"vertical",height:"fill",width:"fill",children:(0,D.jsx)("div",{children:"Research mode side panel"})})}function B(e){const{thinkingStep:t,onExpandCompleteCallback:n}=e,o=(0,s.useMemo)((()=>{if(!t.output)return null;const e=Array.isArray(t.output)&&t.output.find((e=>"thinking"===e.type)),n=e&&e.content;return n||null}),[t.output]),r=(0,l().IS)((()=>({container:{marginTop:12,marginBottom:12},thinkingTextContainer:{marginInlineStart:32},thinkingAnimationContainer:{display:"flex",gap:12},thinkingDotsContainer:{display:"flex",gap:4,alignItems:"flex-end"}})),[]);return(0,D.jsx)(a().N,{children:(0,D.jsx)(i().P.div,{initial:{opacity:0,minHeight:0,overflow:"hidden"},animate:{opacity:1,minHeight:"30px",overflow:"auto"},exit:{opacity:0,minHeight:0,overflow:"hidden"},style:r.container,children:(0,D.jsx)(a().N,{children:o?(0,D.jsx)(i().P.div,{initial:{opacity:0,height:0,overflow:"hidden"},animate:{opacity:1,height:"auto",overflow:"auto"},exit:{opacity:0,height:0,overflow:"hidden"},style:r.thinkingTextContainer,children:(0,D.jsx)(h().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:o})},"markdown"):(0,D.jsxs)(i().P.div,{initial:{opacity:0,height:0,overflow:"hidden"},animate:{opacity:1,height:"auto",overflow:"auto"},exit:{opacity:0,height:0,overflow:"hidden"},onAnimationComplete:()=>{null==n||n()},style:r.thinkingAnimationContainer,children:[(0,D.jsx)(C().jh,{sizeVariant:"plans"}),(0,D.jsxs)("div",{style:r.thinkingDotsContainer,children:[(0,D.jsx)(h().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:(0,D.jsx)(w().sA,{...P().Q.thinking})}),(0,D.jsx)(j().A,{isTriColored:!0})]})]},"loading")})})})}function F(e){const{agentStep:t,onExpandCompleteCallback:n}=e;return"readingAgent"===t.value.input.agent?(0,D.jsx)(N,{agentStep:t,onExpandCompleteCallback:n}):"searchAgent"===t.value.input.agent?"internal"===t.value.input.searchType?(0,D.jsx)(L,{agentStep:t,searchType:"internal",onExpandCompleteCallback:n}):"web"===t.value.input.searchType?(0,D.jsx)(L,{agentStep:t,searchType:"web",onExpandCompleteCallback:n}):(0,D.jsx)("div",{children:`Unknown search type: ${t.value.input.searchType}`}):"taskAgent"===t.value.input.agent?(0,D.jsx)("div",{children:`Unknown task type: ${t.value.input.taskType}`}):"databaseAgent"===t.value.input.agent?(0,D.jsx)(O,{agentStep:t,onExpandCompleteCallback:n}):"databaseBulkReadContentAgent"===t.value.input.agent?(0,D.jsx)(V,{agentStep:t,onExpandCompleteCallback:n}):(0,D.jsx)("div",{children:`Unknown agent type: ${t.value.input.agent}`})}function N(e){const{agentStep:t,onExpandCompleteCallback:n}=e,d=(0,s.useRef)(null),u=(0,l().IS)((()=>({headerRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:12,width:"100%"},headerTextContainer:{display:"flex",flexDirection:"row",alignItems:"center",gap:4,minWidth:0,flexShrink:1,flexGrow:0},subheaderContainer:{display:"flex",flexDirection:"row",alignItems:"center",gap:4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flexShrink:1,flexGrow:0}})),[]),p=(0,r().uB)(void 0,T().D),m=(0,r().O$)(o().AppStoreSidebarSpaceStore),y=(0,r().K8)((()=>{if(!m||"readingAgent"!==t.value.input.agent)return"Page";const e=t.value.input.artifact;let n;return"notion"===e.citationType?n={type:"notion",citationLevel:"page",store:c().B.createChildStore(m,{table:I().ev,id:e.pageId,spaceId:m.id}),id:e.pageId,pageId:e.pageId,title:"",path:"",text:"",lastEdited:""}:"universal_search"===e.citationType&&e.url&&(n=(0,M().my)(e)),n?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(_().K,{result:n,position:0,onMouseEnter:e=>{"notion"===n.type?p.setState({type:"list",node:e.currentTarget,citationType:"notion",pageId:n.pageId,blockIds:[]}):p.setState({type:"list",node:e.currentTarget,citationType:"universal_search",href:(0,f().Ve)(n.href)})},onMouseLeave:()=>{p.reset()},compact:!0,hideArrowOnHover:!0},n.id),m?(0,D.jsx)(A().cE,{containerRef:d,hoverStore:p,parentStore:m}):void 0]}):"Page"}),[t.value.input,m,p]);return(0,D.jsx)(a().N,{children:(0,D.jsxs)(i().P.div,{style:u.headerRow,ref:d,initial:{opacity:0,height:0,overflow:"hidden"},animate:{opacity:1,height:"auto",overflow:"auto"},exit:{opacity:0,height:0,overflow:"hidden"},onAnimationComplete:()=>{null==n||n()},children:[(0,D.jsx)(g().I,{icon:v().bookIcon}),(0,D.jsxs)("div",{style:u.headerTextContainer,children:[(0,D.jsx)(h().D,{styleKey:"bodyMedium",colorVariant:"primary",children:(0,D.jsx)(w().sA,{...P().Q.reading})}),(0,D.jsx)("div",{style:u.subheaderContainer,children:y})]})]})})}function L(e){const{agentStep:t,onExpandCompleteCallback:n}=e,c=(0,l().IS)((()=>({stepContainer:{display:"flex",flexDirection:"column",gap:4},headerRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:12},subheaderContainer:{display:"flex",flexDirection:"row",alignItems:"center",gap:4,overflow:"hidden",flexShrink:1},resultsList:{display:"flex",flexDirection:"column",marginInlineStart:32},pageResult:{minHeight:30,display:"flex",alignItems:"center"},noResultsContainer:{minHeight:30,display:"flex",alignItems:"center"}})),[]),d=(0,s.useRef)(null),u=(0,r().uB)(void 0,T().D),p=(0,r().O$)(o().AppStoreSidebarSpaceStore),y=(0,s.useMemo)((()=>{return p&&t.value.output&&"artifacts"in t.value.output?(null===(e=t.value.output)||void 0===e||null===(e=e.artifacts)||void 0===e||null===(e=e.flatMap((e=>(0,M().g3)({artifact:e,spaceStore:p}))))||void 0===e?void 0:e.filter((e=>void 0!==e)))??[]:[];var e}),[t.value.output,p]),v=(0,s.useMemo)((()=>y.slice(0,3)),[y]),S=(0,s.useMemo)((()=>"done"===t.value.status),[t.value.status]),I=(0,s.useMemo)((()=>"failed"===t.value.status),[t.value.status]);return(0,D.jsxs)("div",{style:c.stepContainer,children:[(0,D.jsx)(a().N,{children:(0,D.jsxs)(i().P.div,{style:c.headerRow,initial:{opacity:0,height:0,overflow:"hidden"},animate:{opacity:1,height:"auto",overflow:"auto"},exit:{opacity:0,height:0,overflow:"hidden"},onAnimationComplete:()=>{null==n||n()},children:[(0,D.jsx)(g().I,{icon:"internal"===e.searchType?x().magnifyingGlassIcon:b().globeIcon}),(0,D.jsx)("div",{style:c.subheaderContainer,children:(0,D.jsx)(m().N,{text:t.value.input.displayName??t.value.input.question,styleKey:"bodyMedium",textOverflow:"ellipsis",animate:!S&&!I})})]})}),(0,D.jsx)(a().N,{children:S?(0,D.jsxs)(i().P.div,{ref:d,style:c.resultsList,initial:{opacity:0,height:0,overflow:"hidden"},animate:{opacity:1,height:"auto",overflow:"auto",maxHeight:90,transition:{height:{duration:.4,ease:"easeInOut"},opacity:{duration:.3,ease:"easeIn"},staggerChildren:.5}},exit:{opacity:0,height:0,overflow:"hidden",transition:{height:{duration:.3,ease:"easeInOut"},opacity:{duration:.2,ease:"easeOut"},when:"afterChildren"}},children:[v.map(((e,t)=>(0,D.jsx)(i().P.div,{style:c.pageResult,initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.5,ease:"easeOut"},children:(0,D.jsx)(_().K,{result:e,position:t,onMouseEnter:t=>{"notion"===e.type?u.setState({type:"list",node:t.currentTarget,citationType:"notion",pageId:e.pageId,blockIds:[]}):u.setState({type:"list",node:t.currentTarget,citationType:"universal_search",href:(0,f().Ve)(e.href)})},onMouseLeave:()=>{u.reset()},compact:!0},e.id)},t))),0===y.length?(0,D.jsx)(h().D,{styleKey:"bodyRegular",colorVariant:"secondary",style:c.noResultsContainer,children:(0,D.jsx)(w().sA,{id:"ResearchModeSidePanel.AgentInternalOrWebSearchStep.noResults",defaultMessage:"No results"})},"no-results"):void 0,p?(0,D.jsx)(A().cE,{containerRef:d,hoverStore:u,parentStore:p,getPayloadDataForHref:e=>v.filter((e=>"notion"!==e.type)).find((t=>t.href===e)),useCompactWebPreview:!0}):void 0]}):void 0})]})}function O(e){const{agentStep:t,onExpandCompleteCallback:n}=e,d=(0,l().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:8},headerRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:12},headerTextContainer:{display:"flex",flexDirection:"row",alignItems:"center",gap:4},subheaderContainer:{display:"flex",flexDirection:"row",alignItems:"center",gap:4},queryContainer:{marginInlineStart:32}})),[]),u=(0,s.useRef)(null),p=(0,r().uB)(void 0,T().D),m=(0,r().O$)(o().AppStoreSidebarSpaceStore),f=(0,r().K8)((()=>{if(!m||t.value.input.agent!==y().iC)return"Database";const e=t.value.input.args.databaseId;if(!e)return"Database";const n=E(e,m)||e,a={type:"notion",citationLevel:"page",store:c().B.createChildStore(m,{table:I().ev,id:n,spaceId:m.id}),id:n,pageId:n,title:"",path:"",text:"",lastEdited:""};return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(_().K,{result:a,position:0,onMouseEnter:e=>{p.setState({type:"list",node:e.currentTarget,citationType:"notion",pageId:a.pageId,blockIds:[]})},onMouseLeave:()=>{p.reset()},compact:!0,hideArrowOnHover:!0},a.id),m?(0,D.jsx)(A().cE,{containerRef:u,hoverStore:p,parentStore:m}):void 0]})}),[t.value.input,m,p]),v=(0,s.useMemo)((()=>{const e=t.value.input;if(e.agent===y().iC){if("run-sql-on-database"===e.args.taskType)return`Database (ID: ${e.args.databaseId})`;if("preview-database-schema"===e.args.taskType)return`Database Info (ID: ${e.args.databaseId})`}return"Database"}),[t.value.input]),b=t.value.input.agent===y().iC?t.value.input.displayName:void 0,x=t.value.input.agent===y().iC&&"run-sql-on-database"===t.value.input.args.taskType?P().Q.querying:P().Q.loading;return(0,D.jsx)(a().N,{children:(0,D.jsxs)(i().P.div,{style:d.container,ref:u,initial:{opacity:0,height:0,overflow:"hidden"},animate:{opacity:1,height:"auto",overflow:"auto"},exit:{opacity:0,height:0,overflow:"hidden"},onAnimationComplete:()=>{null==n||n()},children:[(0,D.jsxs)("div",{style:d.headerRow,children:[(0,D.jsx)(g().I,{icon:S().c}),(0,D.jsxs)("div",{style:d.headerTextContainer,children:[(0,D.jsx)(h().D,{styleKey:"bodyMedium",colorVariant:"primary",style:{whiteSpace:"nowrap"},children:(0,D.jsx)(w().sA,{...x})}),(0,D.jsx)("div",{style:d.subheaderContainer,children:m?f:(0,D.jsx)(h().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:v})})]})]}),b?(0,D.jsx)("div",{style:d.queryContainer,children:(0,D.jsx)(h().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:b})}):void 0]})})}function V(e){const{agentStep:t,onExpandCompleteCallback:n}=e,d=(0,l().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:4},headerRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:12},headerTextContainer:{display:"flex",flexDirection:"row",alignItems:"center",gap:4},subheaderContainer:{display:"flex",flexDirection:"row",alignItems:"center",gap:4},contentRow:{marginInlineStart:32}})),[]),u=(0,s.useRef)(null),p=(0,r().uB)(void 0,T().D),m=(0,r().O$)(o().AppStoreSidebarSpaceStore),f=(0,r().K8)((()=>{return m&&t.value.output&&"artifacts"in t.value.output?null===(e=t.value.output)||void 0===e||null===(e=e.artifacts)||void 0===e?void 0:e.map((e=>{if(e.citationInfo&&"pageId"in e.citationInfo){return{type:"notion",citationLevel:"page",store:c().B.createChildStore(m,{table:I().ev,id:e.citationInfo.pageId,spaceId:m.id}),id:e.citationInfo.pageId,pageId:e.citationInfo.pageId,title:"",path:"",text:"",lastEdited:""}}})):[];var e}),[t.value.output,m]),v=(0,r().K8)((()=>{if(!m||t.value.input.agent!==y().cZ)return"Database content";const e=t.value.input.args.databaseId;if(!e)return"Database content";const n=E(e,m)||e,a={type:"notion",citationLevel:"page",store:c().B.createChildStore(m,{table:I().ev,id:n,spaceId:m.id}),id:n,pageId:n,title:"",path:"",text:"",lastEdited:""};return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(_().K,{result:a,position:0,onMouseEnter:e=>{p.setState({type:"list",node:e.currentTarget,citationType:"notion",pageId:a.pageId,blockIds:[]})},onMouseLeave:()=>{p.reset()},compact:!0,hideArrowOnHover:!0},a.id),m?(0,D.jsx)(A().cE,{containerRef:u,hoverStore:p,parentStore:m}):void 0]})}),[t.value.input,m,p]),b=(0,s.useMemo)((()=>{const e=t.value.input;return e.agent===y().cZ?`Database content (ID: ${e.args.databaseId})`:"Database content"}),[t.value.input]),x=(0,s.useMemo)((()=>"done"===t.value.status),[t.value.status]),k=(0,s.useMemo)((()=>"failed"===t.value.status),[t.value.status]),C=(0,s.useMemo)((()=>!!k||!(!x||0!==f.length)),[k,x,f]);return(0,D.jsxs)("div",{style:d.container,ref:u,children:[(0,D.jsx)(a().N,{children:(0,D.jsxs)(i().P.div,{style:d.headerRow,initial:{opacity:0,height:0,overflow:"hidden"},animate:{opacity:1,height:"auto",overflow:"auto"},exit:{opacity:0,height:0,overflow:"hidden"},onAnimationComplete:()=>{null==n||n()},children:[(0,D.jsx)(g().I,{icon:S().c}),(0,D.jsxs)("div",{style:d.headerTextContainer,children:[(0,D.jsx)(h().D,{styleKey:"bodyMedium",colorVariant:"primary",style:{whiteSpace:"nowrap"},children:(0,D.jsx)(w().sA,{...P().Q.readingDatabasePages})}),(0,D.jsx)("div",{style:d.subheaderContainer,children:m?v:(0,D.jsx)(h().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:b})})]})]})}),(0,D.jsx)(a().N,{children:C?void 0:(0,D.jsxs)(i().P.div,{initial:{opacity:0,minHeight:0,overflow:"hidden"},animate:{opacity:1,minHeight:"30px",overflow:"auto"},exit:{opacity:0,minHeight:0,overflow:"hidden"},children:[(0,D.jsx)(a().N,{children:x?(0,D.jsx)(i().P.div,{initial:{opacity:0,height:0,overflow:"hidden"},animate:{opacity:1,height:30,overflow:"auto"},exit:{opacity:0,height:0,overflow:"hidden"},children:(0,D.jsx)(h().D,{styleKey:"bodyRegular",colorVariant:"secondary",style:d.contentRow,children:(0,D.jsx)(w().sA,{id:"ResearchModeSidePanel.AgentDatabaseBulkReadContentStep.resultCount",defaultMessage:"Read {count} pages",values:{count:f.length}})},"more-results")}):void 0}),(0,D.jsx)(a().N,{children:x?void 0:(0,D.jsx)(i().P.div,{style:d.contentRow,initial:{opacity:0,height:0,overflow:"hidden"},animate:{opacity:1,height:30,overflow:"auto",transition:{duration:.2,ease:"easeInOut",delay:1}},exit:{opacity:0,height:0,overflow:"hidden",transition:{duration:0,ease:"easeInOut",delay:0}},children:(0,D.jsx)(j().A,{isTriColored:!0})})})]})})]})}},795438:(e,t,n)=>{n.d(t,{D:()=>a});const a=(0,n(69708).YK)({offlineModeDebugTabTitle:{id:"spaceSettingsSidebar.offlineModeDebugTab.title",defaultMessage:"Offline Mode"},offlineTabTitle:{id:"spaceSettingsSidebar.offlineTab.title",defaultMessage:"Offline"},generalTabTitle:{id:"spaceSettingsSidebar.generalTab.title",defaultMessage:"General"},teamsTabTitle:{id:"spaceSettingsSidebar.teamsTab.title",defaultMessage:"Teamspaces"},peopleTabTitle:{id:"spaceSettingsSidebar.peopleTab.title",defaultMessage:"People"},membersTabTitle:{id:"spaceSettingsSidebar.membersTab.title",defaultMessage:"Members"},explorePlansTabTitle:{id:"spaceSettingsSidebar.explorePlansTab.title",defaultMessage:"Explore plans"},upgradePlanTabTitle:{id:"spaceSettingsSidebar.upgradePlanTab.title",defaultMessage:"Upgrade plan"},billingTabTitle:{id:"spaceSettingsSidebar.billingTab.title",defaultMessage:"Billing"},aiUsageDashboardTabTitle:{id:"spaceSettingsSidebar.aiUsageDashboardTab.title",defaultMessage:"AI usage"},subscriptionTabTitle:{id:"spaceSettingsSidebar.subscriptionTab.title",defaultMessage:"Subscription"},connectionsTabTitle:{id:"spaceSettingsSidebar.connectionsTab.title",defaultMessage:"Connections"},securityTabTitle:{id:"spaceSettingsSidebar.securityTab.title",defaultMessage:"Security"},identityTabTitle:{id:"spaceSettingsSidebar.identityTab.title",defaultMessage:"Identity"},publicPagesTabTitle:{id:"spaceSettingsSidebar.publicPages.title",defaultMessage:"Public pages"},sitesTabTitle:{id:"spaceSettingsSidebar.sites.title",defaultMessage:"Sites"},customEmojiTabTitle:{id:"spaceSettingsSidebar.emoji.title",defaultMessage:"Emoji"},adminContentSearchTabTitle:{id:"spaceSettingsSidebar.adminContentSearch.title",defaultMessage:"Content search"},languageAndRegionTabTitle:{id:"spaceSettingsSidebar.languageAndRegionTab.title",defaultMessage:"Language & region"},spaceConnectionsTabTitle:{id:"spaceSettingsSidebar.spaceConnectionsTab.title",defaultMessage:"Connections"},auditLogTabTitle:{id:"spaceSettingsSidebar.auditLogTab.title",defaultMessage:"Audit log"},notificationsAndSettingsTabTitle:{id:"spaceSettingsSidebar.notificationsAndSettings.title",defaultMessage:"My notifications & settings"},preferencesTabTitle:{id:"spaceSettingsSidebar.preferences.title",defaultMessage:"Preferences"},notificationsTabTitle:{id:"spaceSettingsSidebar.notifications.title",defaultMessage:"Notifications"},analyticsTabTitle:{id:"spaceSettingsSidebar.analyticsTab.title",defaultMessage:"Analytics"},importTabTitle:{id:"spaceSettingsSidebar.importsTab.title",defaultMessage:"Import"},verifiedPagesTabTitle:{id:"spaceSettingsSidebar.verifiedPagesTab.title",defaultMessage:"Verified pages"},requestsTabTitle:{id:"spaceSettingsSidebar.requestsTab.title",defaultMessage:"Requests"},workspaceDiscoveryTabTitle:{id:"spaceSettingsSidebar.workspaceDiscoveryTab.title",defaultMessage:"Explore workspaces"},experimentsTabTitle:{id:"spaceSettingsSidebar.experimentsTab.title",defaultMessage:"Experiments"},performanceToolbarTabTitle:{id:"spaceSettingsSidebar.performanceToolbarTab.title",defaultMessage:"Performance Toolbar"},userSimilarityScoresTabTitle:{id:"spaceSettingsSidebar.userSimilarityScoresTab.title",defaultMessage:"User Similarity Scores"},collectionsDebugTabTitle:{id:"spaceSettingsSidebar.collectionsDebug.title",defaultMessage:"Collections"},aiTabTitle:{id:"spaceSettingsSidebar.aiTab.title",defaultMessage:"Notion AI"},designPreviewsTabTitle:{id:"spaceSettingsSidebar.designPreviewsTab.title",defaultMessage:"Design Previews"},mobileNativeTabTitle:{id:"spaceSettingsSidebar.mobileNativeTab.title",defaultMessage:"Mobile Native"}})},795901:(e,t,n)=>{n.d(t,{f:()=>r});n(16280);var a=()=>n(206267),i=()=>n(483730),s=()=>n(259091),o=()=>n(50744);async function r(e){const{environment:t,sessionId:n,assistantSurfaceType:r}=e,l=i().default.getSessionContextOrThrow(n);(0,s().x)(t);const{previewingStepFromStoreState:c,evaluatorFromStoreState:d}=l;if(!c)throw new Error("No previewing step");l.clearPreviewingStep(),d.commitStepWithoutEvaluating(c),d.commitStepWithoutEvaluating({id:0,type:"observation",observationType:"error",errorType:"human_feedback",value:e.feedback,stack:void 0}),await(0,o().f)({environment:t,inferenceId:a().JW(),sessionId:n,updater:l.createUpdater(),assistantSurfaceType:r})}},800023:(e,t,n)=>{n.d(t,{C:()=>r});n(581454);var a=n(296540),i=()=>n(484714),s=()=>n(165358),o=()=>n(769864);function r(e){const t=(0,i().v3)(),[n,r]=(0,a.useState)([]),[l,c]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{!async function(){if(e){c(!0);try{const n=await o().callApi({eventName:"getAIUsageDashboardServicePeriods",environment:t,data:{spaceId:e}});if("failed"===n.type)return void c(!1);const a=n.data.periods.map((e=>({start:new Date(e.start),end:new Date(e.end)})));r(a)}catch(n){s().log({level:"error",from:"useAIUsageDashboardServicePeriods",type:"fetchServicePeriodsFailed",data:{miscDataToConvertToString:{error:n,spaceId:e,userId:t.currentUser.id}}})}finally{c(!1)}}else c(!1)}()}),[t,e]),{dateRanges:n,isLoading:l}}},803078:(e,t,n)=>{n.d(t,{k:()=>p});n(296540);var a=()=>n(782482),i=()=>n(401497),s=()=>n(100622),o=()=>n(729368),r=()=>n(366437),l=()=>n(301421),c=()=>n(827368),d=n(474848);const u=Object.freeze({property:!0});function p(e){const{store:t,onSubmit:n,textRef:p,stagingAndInputWrapStyle:g,textContainerStyle:m,testId:h}=e,f=(0,i().eP)(),{bodyStyleKey:y}=(0,c().yq)(),v=(0,c().Cd)(y),S=e.fontSize??v.fontSize??14,b=(0,i().IS)((()=>({stagingAndInputWrap:{boxShadow:`\n\t\t\t\t\t0px 0px 0px 1px ${s().Tj.border.secondary},\n\t\t\t\t\t0px 4px 12px -2px rgba(0, 0, 0, 0.08)`,backgroundColor:"dark"===f?s().Tj.palette.translucentGray[100]:"transparent",borderRadius:12,paddingTop:6,paddingBottom:6,paddingInlineStart:12,paddingInlineEnd:12,overflow:"inherit",flexGrow:1,flexShrink:1,...g},wrap:{display:"flex",alignItems:"center",fontSize:S,flexWrap:"wrap"},textContainer:{flexGrow:1,paddingTop:4,paddingBottom:4,minHeight:void 0,maxHeight:240,overflow:"auto",...m},placeholder:{opacity:1,cursor:"text"}})),[S,g,m,f]);return(0,d.jsx)(a().N,{debugName:"TextInput",capture:!0,children:(0,d.jsx)("div",{style:b.stagingAndInputWrap,tabIndex:0,children:(0,d.jsx)("div",{style:b.wrap,onClick:e=>{if(e.target===e.currentTarget){const n=l().n.findEditableWithStore(t);n&&n.handleClick(e)}},children:(0,d.jsx)(o().A,{onEnter:n,style:b.textContainer,placeholder:"Ask AI anything",disabled:!1,store:t,placeholderStyle:b.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEnter:!1,disableMobileActionBar:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,inPageFind:r().Os.none,usePopupForMentionOnMobile:!0,enableChatSelectionContextTokens:!0,ref:p,testId:h,disabledMentionTypes:u})})})})}},804059:(e,t,n)=>{n.r(t),n.d(t,{ellipsisFillIcon:()=>i,iconDefinition:()=>a});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"2.24 8.25 15.51 3.5",svg:(0,n(474848).jsx)("path",{d:"M4 11.75a1.75 1.75 0 1 0 0-3.5 1.75 1.75 0 0 0 0 3.5m6 0a1.75 1.75 0 1 0 0-3.5 1.75 1.75 0 0 0 0 3.5m6 0a1.75 1.75 0 1 0 0-3.5 1.75 1.75 0 0 0 0 3.5"})},i=(0,n(340498).wt)("ellipsisFill",a,"fill")},807253:(e,t,n)=>{n.d(t,{P:()=>d});var a=n(296540),i=()=>n(493552),s=()=>n(621594),o=()=>n(69708),r=()=>n(383894),l=n(474848);const c=(0,o().YK)({researcherTimeout:{id:"aiInferenceTranscript.userFriendlyErrorStep.researcherTimeout",defaultMessage:"Research timed out, generating report with limited information"},researcherPlanFailure:{id:"aiInferenceTranscript.userFriendlyErrorStep.researcherPlanFailure",defaultMessage:"Error during research, generating report with limited information"},noFallbackModel:{id:"aiInferenceTranscript.userFriendlyErrorStep.noFallbackModel",defaultMessage:"This chats model provider is currently not available. Please try a different model in a new chat."},customAgentRateLimited:{id:"aiInferenceTranscript.userFriendlyErrorStep.customAgentRateLimited",defaultMessage:"Agent is being rate limited. Will retry automatically in a moment."},genericError:{id:"aiInferenceTranscript.userFriendlyErrorStep.genericError",defaultMessage:"An error occurred, please try again"},trustRuleDenied:{id:"aiInferenceTranscript.userFriendlyErrorStep.trustRuleDenied",defaultMessage:"This action is not currently available. Please try again later or contact support if this persists."}});function d(e){const{errorStep:t,configType:n}=e,d=a.useMemo((()=>{if("researcher"===n){if(/timeout/i.test(t.message))return c.researcherTimeout;if(/Failed to generate plan:/i.test(t.message))return c.researcherPlanFailure}else{if("no-fallback-model"===t.subType)return c.noFallbackModel;if("custom-agent-rate-limited"===t.subType)return c.customAgentRateLimited;if("trust-rule-denied"===t.subType)return c.trustRuleDenied}return c.genericError}),[t.message,n,t.subType]);return(0,l.jsx)(r().N,{icon:s().exclamationMarkCircleSmallIcon,title:(0,l.jsx)(i().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,l.jsx)(o().sA,{...d})})})}},808725:(e,t,n)=>{n.d(t,{T:()=>v});var a=()=>n(483730),i=(n(16280),n(18107),n(967357),n(898992),n(672577),n(581454),()=>n(755531)),s=()=>n(908006),o=()=>n(24279),r=()=>n(510818),l=()=>n(943290),c=()=>n(165358),d=()=>n(496603),u=()=>n(836724),p=()=>n(525569),g=()=>n(383070),m=()=>n(371621),h=()=>n(980382),f=()=>n(383706);class y extends Error{constructor(e){super(e.value),this.step=void 0,e.stack&&(this.stack=e.stack),this.step=e}}async function v(e){const{sessionId:t,...n}=e,v=a().default.getSessionContextOrThrow(t);return await v.runSerialized((async()=>await async function(e){var t;const{environment:n,commit:a,isStreaming:v,inferenceId:S,inferencingError:b,updater:x}=e,I=x.getReadOnlySessionContext();let k=e.step;if(!(0,f()._)(n))throw new Error("No valid user.");const w="assistant"===k.type?Math.max(I.sampledStepsFromStoreState.indexOf(k),0):0,{evaluatorFromStoreState:C}=I,A=e.preventSelection??I.preventSelectionFromStoreState,{uncommittedOperationsFromStoreState:T}=I;x.write((e=>{const{assistantConfigurationStore:t}=e;e.resetRandomIDIndex(),t.setState({...t.state,evaluating:!0}),e.caches.clear(),e.caches.ensureDefaultCacheOverride(n),t.setState({...t.state,committing:a}),T.length>0&&(0,m().gv)({environment:n,operations:T,caches:e.caches,attributionActor:e.attributionActorFromStoreState})})),"assistant"===k.type&&!a&&v&&(k={...k,value:(0,r().e_)(k.value)});const j=null===(t=(0,i().S)())||void 0===t?void 0:t.id;let M;const{observations:_,didForceExit:P,error:D}=await x.runTransaction(S,(async e=>{const{observations:t,didForceExit:i,newState:s}=await(a?C.commitStep(k):C.simulateStep(k));let r;if(a||(M=s),b)r=b;else{const e=t.find(o().XO);e&&(r=new y(e))}return r&&(x.write((e=>{e.caches.clear(),T.length>0&&(0,m().gv)({environment:n,operations:T,caches:e.caches,attributionActor:e.attributionActorFromStoreState})})),v||c().log({level:"error",from:"assistantActions",type:"assistantStepErrorNoTranscript",data:{miscDataToConvertToString:{error:r,assistantMode:g().zD.getMode(),spaceId:j}}}),v?(e.revertToPreviousTemporaryState(),x.write((e=>{e.temporaryOperationsFromStoreState.length>0&&(0,m().gv)({environment:n,operations:e.temporaryOperationsFromStoreState,caches:e.caches,attributionActor:e.attributionActorFromStoreState})}))):x.write((e=>{e.replaceTemporaryState({temporaryClientSteps:[]})}))),{observations:t,didForceExit:i,error:r}}));return x.write((e=>{const{assistantConfigurationStore:t}=e;if(a||"assistant"!==k.type||e.updatePreviewingStep({previewingStep:k,previewingStepIndex:w,previewingStepObservations:_,previewingState:M}),a&&e.addTemporaryOperationsToUncommittedOperations(),e.temporaryExecutableOperationsFromStoreState.length>0&&!D){const t=(0,l().iL)(e.temporaryExecutableOperationsFromStoreState).map((e=>e.pageId)),n=(0,l().iL)(e.getAllPendingExecutableOperations());for(const a of n)if(t.includes(a.pageId)){const t=(0,l().qT)([a]);e.addTemporaryGroupedEditCardClientStep({type:"groupedEditCard",inferenceId:S,pageId:a.pageId,executableOperationIds:t})}}if(e.getAllPendingOperations().length>0&&!D){const t=v&&e.temporaryExecutableOperationsFromStoreState.at(-1),a=t&&"setBlockText"===(null==t?void 0:t.command)?t.blockNode.attributes.id:void 0;(0,h().I)({environment:n,assistantSessionContext:e,processingBlockId:a})}D||A||s().default.afterNextFlush((()=>{if(!x.isValid())return;const t=e.getAllPendingExecutableOperations(),n=d().oE(t.map((e=>(0,l().wF)(e).attributes.id)));if(0===n.length)return;const a=p().default.state;if("assistantCompletionPopup"!==a.type||"results"!==a.stage)return;const i=u().T.findSelectablesFromIds(n),s=d().oE(i.map((e=>({store:e.props.store,rect:u().T.getRectFromStore(e.props.store)})))),o=d().Sk(s,(e=>{var t;return(null===(t=e.rect)||void 0===t?void 0:t.bottom)??-1/0}));o&&p().default.setState({...a,context:{...a.context,origin:o.store}})})),a&&e.resetRandomIDCache(),t.setState({...t.state,evaluating:!1,committing:!1})})),{observations:_,didForceExit:P}}(n)))}},813679:(e,t,n)=>{n.d(t,{$x:()=>d,FD:()=>l,g$:()=>u,hL:()=>c});var a=n(296540),i=()=>n(265060),s=()=>n(493552),o=()=>n(340498),r=n(474848);function l(e){const{caption:t}=e;return t?(0,r.jsx)(s().D,{styleKey:"captionRegular",colorVariant:"tertiary",style:{minWidth:0},textOverflow:"ellipsis",children:t}):null}function c(e){const{children:t}=e;return(0,r.jsx)(s().D,{styleKey:"bodyRegular",colorVariant:"primary",textOverflow:"ellipsis",children:t})}function d(e){const{iconGroup:t,iconSize:n}=e,s=(0,a.useCallback)((()=>o().Ev[n]),[n]);return(0,r.jsx)(i().Q,{iconGroup:t,overrideSize:s,variantName:"default"})}function u(){return{textWrapperStyle:{minWidth:160},style:{borderBottom:"none",borderColor:"transparent",marginTop:0,marginBottom:0}}}},814964:(e,t,n)=>{n.d(t,{A:()=>H});n(16280),n(944114),n(898992),n(354520),n(672577),n(803949),n(581454);var a=()=>n(755531),i=()=>n(675133),s=()=>n(711339),o=()=>n(732810),r=()=>n(353566),l=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(737550),()=>n(496603)),c=()=>n(534177),d=()=>n(604995),u=()=>n(252050);const p="\n\t\tOutputs are formatted using a custom XML syntax. You must output valid XML only, closely following the spec below.\n\t\tDo not output any markdown or HTML formatting except inside of <code> or <code-block>.\n\t\tYou may output multiple XML commands. Output as many as needed to complete the user's request.\n\t",g="\n\t\tThe user may ask to perform a task that is not technically possible to achieve by using your allowed XML APIs.\n\t\tHere are some examples:\n\t\tYou cannot set reminders.\n\t\tYou cannot schedule tasks.\n\t\tYou cannot create databases, but if the user creates a new database on a page, they will be given the option to set it up with AI.\n\t\tIn these cases, you may refuse to perform the action and tell the user via chat.\n\t\tHowever, remember that you can chat about any topic, including creative requests, and you can search for information in the user's workspace.\n\t\tYou should strive to be helpful within your capabilities and limitations.\n\t",m="\n\t\tNewlines and whitespace are stripped from the output. To create a new paragraph or add whitespace, use <text> blocks for each line.\n\t",h='\n\t<hr/>\n\t<unknown-block id={id} type={Block Type} />\n\t<h1 color?={Color}>{Inline}</h1>\n\t<h2 color?={Color}>{Inline}</h2>\n\t<h3 color?={Color}>{Inline}</h3>\n\t<text color?={Color}>{Inline}{Blocks}</text>\n\t<uli color?={Color}>{Inline}{Blocks}</uli> - Bulleted list item (do not wrap in ul tags)\n\t<oli color?={Color}>{Inline}{Blocks}</oli> - Numbered list item (do not wrap in ul tags)\n\t<toggle color?={Color} size?={default|h1|h2|h3|h4}>{Inline}{Blocks}</toggle>\n\t<quote color?={Color}>{Inline}{Blocks}</quote>\n\t<todo checked="{true|false}" color?={Color}>{Inline}{Blocks}</todo>\n\t<callout color?={Color}>{Inline}{Blocks}</callout>\n\t<code-block language={str, lowercase name of code language}>{String, do not escape characters}</code-block>\n\t<math-block>{Inline}</math-block>\n\t<columns>{<column>{Blocks}</column>}...</columns>\n\t<table>{<tr>{<td>{Inline}</td>...}</tr>}...</table>\n\t<page page-font?={default|serif|mono} page-font-size?={default|small} page-width?={default|full-width}>{Properties}{Blocks}</page>\n'.split("\n").map((e=>e.trim())).filter(Boolean).join("\n"),f="\n\t{str}\n\t<b>{Inline}</b>\n\t<i>{Inline}</i>\n\t<s>{Inline}</s> - strikethrough\n\t<u>{Inline}</u> - underline\n\t<a href={id|url}>{Inline}</a>\n\t<code>{Inline, do not escape characters}</code> - Any XML inside <code> will be displayed as plain text\n\t<h color={Color}>{Inline}</h> - highlight\n\n\tInlineDate:\n\t<mention-date date={YYYY-MM-DD}/>\n\t<mention-datetime date={YYYY-MM-DD} time={HH:MM}/>\n\t<mention-date-range start-date={YYYY-MM-DD} end-date={YYYY-MM-DD}/>\n\t<mention-datetime-range start-date={YYYY-MM-DD} end-date={YYYY-MM-DD} start-time={HH:MM} end-time={HH:MM}/>\n\n\tInlinePage:\n\t<mention-page page-id={id}/>\n\n\tInlineDatabase:\n\t<mention-database database-id={id}/>\n\n\tInlinePerson:\n\t<mention-person person-id={id}/>\n\n\tInlineExternalLink:\n\t<mention-link href={url} icon_url={favicon_url} description={str}>{external link title}</mention-link>\n\n\tNOTE: If you want to display XML/HTML code to the user, you should enclose it in <code> tags to ensure it not mis-parsed. Do not escape characters. For instance, use <code><b></code> to display a bold tag.\n".split("\n").map((e=>e.trim())).filter(Boolean).join("\n"),y="{str}\n\t<b>{Inline}</b>\n\t<i>{Inline}</i>\n\t<s>{Inline}</s> - strikethrough\n\t<u>{Inline}</u> - underline\n\t<a href={id|url}>{Inline}</a>\n\t<code>{Inline, do not escape characters}</code> - Any XML inside <code> will be displayed as plain text\n\n\tInlineDate:\n\t<mention-date date={YYYY-MM-DD}/>\n\t<mention-datetime date={YYYY-MM-DD} time={HH:MM}/>\n\t<mention-date-range start-date={YYYY-MM-DD} end-date={YYYY-MM-DD}/>\n\t<mention-datetime-range start-date={YYYY-MM-DD} end-date={YYYY-MM-DD} start-time={HH:MM} end-time={HH:MM}/>\n\n\tInlinePage:\n\t<mention-page page-id={id}/>\n\n\tInlinePerson:\n\t<mention-person person-id={id}/>  -- When referring to a person whose ID you know, use this tag.\n".split("\n").map((e=>e.trim())).filter(Boolean).join("\n"),v=l().Bj((e=>{const{hasPage:t,hasDatabase:n}=e;return`\n\t\t<property-title name={str}>{Text}</property-title>\n\t\t${t||n?"\n\t\t\t<property-text name={str}>{Text}</property-text>\n\t\t\t<property-url name={str}>{str}</property-url>\n\t\t\t<property-email name={str}>{str}</property-email>\n\t\t\t<property-phone-number name={str}>{str}</property-phone-number>\n\t\t\t<property-person name={str}>{InlinePerson}</property-person>\n\t\t\t<property-date name={str}>{InlineDate}</property-date>\n\t\t\t<property-created-time name={str}>{InlineDate}</property-created-time>\n\t\t\t<property-last-edited-time name={str}>{InlineDate}</property-property-last-edited-time>\n\t\t\t<property-created-by name={str}>{InlinePerson}</property-created-by>\n\t\t\t<property-last-edited-by name={str}>{InlinePerson}</property-last-edited-by>\n\t\t\t<property-checkbox name={str} checked={true|false}/>\n\t\t\t<property-select name={str}>{SelectOption}</property-select>\n\t\t\t<property-multi-select name={str}>{SelectOptions}</property-multi-select>\n\t\t\t<property-status name={str}>{SelectOption}</property-status>\n\t\t\t<property-number name={str} number={str}/>\n\t\t\t<property-relation name={str}>{InlinePages}</property-relation>\n\n\t\t\tSelectOption:\n\t\t\t<option option={option name}/>\n\n\t\t\tSelectOptionCategory:\n\t\t\t<option-category category={option category}/>\n\t\t\t":""}\n\t\t`}));l().Bj((e=>{const{version:t,hasPage:n,hasDatabase:a,hasDatabaseQuery:i,hasSkill:s}=e;return{1:`\n\t\t\tYou are Notion AI.\n\t\t\tYou must output valid XML only, closely following the spec below. Do not output markdown.\n\n\t\t\t${!s&&"\n\t\t\t\tOverall guidelines for responses:\n\t\t\t\tUse a friendly and genuine, but neutral tone, as if you were a highly competent and knowledgeable colleague.\n\n\t\t\t\tUse plain language that is easy to understand.\n\t\t\t\tAvoid business jargon, marketing speak, and corporate buzzwords.\n\n\t\t\t\tProvide clear and actionable information.\n\t\t\t\tAvoid unnecessary filler text.\n\t\t\t\tAvoid obvious caveats.\n\t\t\t\tAvoid generic suggestions to check other sources.\n\n\t\t\t\tTailor the detail of your responses to the user's request, with concise responses to simple requests, and more thorough responses to more complex or open-ended requests.\n\n\t\t\t\tFormat responses for easy readability, making use of bullets, bolded text, or other formatting as appropriate.\n\n\t\t\t\tWhen using information from the context inside <chat>, you must include citations to all references in the format <a href={id}/>, using the most specific IDs available.\n\n\t\t\t\tYou should avoid repeating information that has already been provided in the conversation, except when this is clearly necessary for the user's request.\n\t\t\t\tEach assistant output in the transcript must be unique. If an output is repeated, it will not be executed.\n\t\t\t"}\n\n\t\t\tActions:\n\t\t\t<search question={str} keywords={str, space-separated list of terms with unpacked acronyms/abbreviations} lookback?={{{num}{d|w|m|y}|all_time|default, searches over this time range} sort?={"latest", prefers most recent search results} question-intl?={str, question in user's language only if non-English} exact-match?="{strings that need an exact match separated by spaces}" source?={slack|notion} channel?={str, Slack channel if provided}/>\n\t\t\t<chat>{Blocks}</chat>\n\t\t\t<create><page><property-title name="Title">{str}</property-title>{Blocks}</page></create>\n\t\t\t<load id={page or database id}/>\n\t\t\t<search-databases search={str, fuzzy-match database name}/> - Only use when the request is explicitly referring to a database, including words like "database" or "db", as well as the database's name, and the database ID is not already shown in the context.\n\t\t\t<search-people search={str, fuzzy-match name or email}/> - Only use when the request is explicitly referring to a person by name or email, and the person ID is not already shown in the context.\n\t\t\t${n?"\n\t\t\t\t<insert-before id={id}>{Blocks|<move id={id}/>}</insert-before>\n\t\t\t\t<insert-after id={id}>{Blocks|<move id={id}/>}</insert-after>\n\t\t\t\t<insert-inside id={id}>{Blocks|<move id={id}/>}</insert-inside> - Insert inside a block or page\n\t\t\t\t":""}\n\t\t\t${a?"\n\t\t\t\t<insert-inside id={database id}>{Page blocks|<move id={id}/>}</insert-inside> - Insert inside a database\n\t\t\t\t":""}\n\t\t\t${n?"\n\t\t\t\t<delete id={id}/>\n\t\t\t\t<set-title id={id}>{Inline}</set-title> - Make sure to only use Inline XML, defined in the spec for Inline.\n\t\t\t\t<set-attribute id={id} {attribute}={value}/> - Make sure to only use attribute names and values that are defined in the spec for Blocks.\n\t\t\t\t<set-tag-name id={id} tag-name={Block tag name}/>\n\t\t\t\t":""}\n\t\t\t${n?"\n\t\t\t\t\t<insert-before id={Table id} name={index}><schema-property-text name={index}/></insert-before> - New table column before\n\t\t\t\t\t<insert-after id={Table id} name={index}><schema-property-text name={index}/></insert-after> - New table column after\n\t\t\t\t\t<insert-before id={Table id} name={index}><move id={Table id} name={index}/></insert-before> - Move table column before\n\t\t\t\t\t<insert-after id={Table id} name={index}><move id={Table id} name={index}/></insert-after> - Move table column after\n\t\t\t\t\t<delete id={Table id} name={index}/> - Delete table column\n\t\t\t\t":""}\n\t\t\t${n||i?"\n\t\t\t\t\t<set-property id={id}>{Properties}</set-property>\n\t\t\t\t":""}\n\t\t\t${a?'\n\t\t\t\t\tDatabase querying search:\n\t\t\t\t\t<search question={str} keywords={str, expanded keywords} question-intl?={str, question in user\'s language if non-English}/>\n\n\t\t\t\t\tDatabase querying filters:\n\t\t\t\t\t<filter-property-{text|title|phone-number|email|url} name={str} condition={contains|not contains|is|not is|not is empty}>{text}</filter-property-text>\n\t\t\t\t\t<filter-property-date name={str} condition={is|>|<||}>{InlineDate}</filter-property-date>\n\t\t\t\t\t<filter-property-number name={str} condition={is|not is|>|<||} number="{number}"/>\n\t\t\t\t\t<filter-property-checkbox name={str} condition="is" checked={true|false}/>\n\t\t\t\t\t<filter-property-select name={str} condition="is|not is">{SelectOption}</filter-property-select>\n\t\t\t\t\t<filter-property-status name={str} condition="is|not is">{SelectOption|SelectOptionCategory}</filter-property-status>\n\t\t\t\t\t<filter-property-multi-select name={str} condition="contains|not contains">{SelectOption}</filter-property-multi-select>\n\t\t\t\t\t<filter-property-relation name={str} condition="contains|not contains"><mention-page page-id={page id}></mention-page></filter-property-relation>\n\t\t\t\t\t<filter-property-person name={str} condition="contains|not contains"><mention-person person-id={person ID}/></filter-property-person>\n\t\t\t\t\t<filter-group match="any|all">{Filters}</filter-group>\n\n\t\t\t\t\tDatabase querying sorts:\n\t\t\t\t\t<sort-property-{type} name={str} direction={ascending|descending}/>\n\t\t\t\t':""}\n\n\t\t\tBlocks:\n\t\t\t${h}\n\n\t\t\tInline:\n\t\t\t${f}\n\n\t\t\tProperties:\n\t\t\t${v({hasPage:n,hasDatabase:a})}\n\n\t\t\t${n?`\n\t\t\tColors:\n\t\t\t${u().Bt.join("\n")}\n\t\t\t`:""}\n\n\t\t\tLimits per response:\n\t\t\t<search>: up to 3.\n\t\t\t<search-people>: up to 3.\n\t\t\t<load>: up to 10.\n\t\t\t`}[t].split("\n").map((e=>e.trim())).filter(Boolean).join("\n")}));`\nYour last output threw an error the entire output was not executed. An error message is shown above in <stderr>...</stderr>.\n\nCarefully review all error messages and your previous attempts and output XML with a corrected version of the entire output, including parts that may have succeeded.\n\nThe user will not be able to see any of the failed attempts, only the final successful output. Do not reference the failed attempts in your response.\n\n${g}\n`.split("\n").map((e=>e.trim())).filter(Boolean).join("\n");const S={bio:"\n\t\tYou are Notion AI. You were created by Notion with these core capabilities: help users search the workspace, chat with the user about any topic, and create and edit pages.\n\t",outputResponseStyle:"\n\t\tOverall guidelines for responses:\n\t\tUse a friendly and genuine, but neutral tone, as if you were a highly competent and knowledgeable colleague.\n\n\t\tUse plain language that is easy to understand.\n\t\tAvoid business jargon, marketing speak, and corporate buzzwords.\n\n\t\tProvide clear and actionable information.\n\t\tAvoid unnecessary filler text.\n\t\tAvoid obvious caveats.\n\t\tAvoid generic suggestions to check other sources.\n\n\t\tTailor the detail of your responses to the user's request. Simple requests should result in very concise responses, and more open-ended requests can have longer responses. You should generally err on the side of being more concise.\n\t\tFormat responses for easy readability, making use of bullets, bolded text, or other formatting as appropriate.\n\n\t\tWhen possible, you should prefer to use information from the context in your responses. When there is no information on a topic in the context, you can use your general knowledge. You do not need to mention that you are using your general knowledge.\n\t\tThe context may contain incomplete or contradictory information. Make sure to think rigorously and be careful not to make false assumptions.\n\t\tThe context may contain incorrect information. Make sure to use your best judgment and not make any unreasonable claims.\n\t\tDo not make up information unless the user explicitly asks for it.\n\n\t\tWhen referring to dates, you should present them in a readable format.\n\t",chat:"\n\t\tYou should respond to the user using markdown format only.\n\t",languageFollowingChat:"\n\t\tIf the user specifies a particular language to use, then respond only in the requested language.\n\t\tOtherwise, respond only in the same language as the last user message.\n\t\tNote that the context might contain text in multiple languages. Make sure to use the language specified by the user.\n\t",citations:"\n\t\tWhen referencing ANY information from the context in your response, you must cite ALL sources by creating a markdown link with no text inside and a single ID as the URL. The ID should be the most specific ID of the element containing the information you are directly sourcing as evidence of your claim.\n\t\tExample: This is a claim[](1). This is another claim that has a lot of information[](4)[](7).\n\t\t- Cite only one ID per markdown link.\n\t\t- One piece of information can have multiple citations in the form of multiple links.\n\t\t- You do not need to include the title of pages in your response.\n\t\t- Do not reference these IDs anywhere in your response, except for within citations or links.\n\t\t- In addition to citations, you may also include normal links if needed. For example: [Link to external site](https://www.example.com).\n\t\t- When multiple lines of information all have the same source, group the information together so they can be cited with a single link. Try not to cite the same source over and over for each line of information.\n\n\t\tWhen referencing information from pages or search results:\n\t\t- Cite the most specific block or message IDs when possible that link to the line of text in the source, otherwise fall back to citing the <result> or <page> ID.\n\t\t- Ensure that the element whose ID you are citing is ALWAYS correct. Do not cite wrong or adjacent elements.\n\t\t- Do NOT cite when you are mentioning general information that isn't directly evidenced by a specific page or search result. Citations must be reserved for evidence that directly and completely supports your claims.\n\t\t- Do NOT cite database views as they do not contain citable information themselves.\n\t"},b={bio:`\n\t\tYou are Notion AI. You were created by Notion with these core capabilities: help users search the workspace, chat with the user about any topic, and create and edit pages.\n\t\t${p}\n\t\t${g}\n\t`,qnaEnhancedBio:`\n\t\tYou are Notion AI. You were created by Notion with these core capabilities: help users search the workspace and chat with the user about any topic.\n\t\t${p}\n\t\t${g}\n\t`,outputResponseStyle:"\n\t\tOverall guidelines for responses:\n\t\tUse a friendly and genuine, but neutral tone, as if you were a highly competent and knowledgeable colleague.\n\n\t\tUse plain language that is easy to understand.\n\t\tAvoid business jargon, marketing speak, and corporate buzzwords.\n\n\t\tProvide clear and actionable information.\n\t\tAvoid unnecessary filler text.\n\t\tAvoid obvious caveats.\n\t\tAvoid generic suggestions to check other sources.\n\n\t\tTailor the detail of your responses to the user's request. Simple requests should result in very concise responses, and more open-ended requests can have longer responses. You should generally err on the side of being more concise.\n\t\tFormat responses for easy readability, making use of bullets, bolded text, or other formatting as appropriate.\n\n\t\tWhen possible, you should prefer to use information from the context in your responses. When there is no information on a topic in the context, you can use your general knowledge. You do not need to mention that you are using your general knowledge.\n\t\tThe context may contain incomplete or contradictory information. Make sure to think rigorously and be careful not to make false assumptions.\n\t\tThe context may contain incorrect information. Make sure to use your best judgment and not make any unreasonable claims.\n\t\tDo not make up information unless the user explicitly asks for it.\n\n\t\tWhen referring to dates, you should present them in a readable format.\n\n\t\tYou should avoid repeating information that has already been provided in the conversation, except when this is clearly necessary for the user's request.\n\t\tEach assistant output in the transcript must be unique. If an output is repeated, it will not be executed.\n\t",editResponseStyle:"\n\t\tGeneral instructions for edits:\n\n\t\tFollow any specific instructions in the user's request\n\n\t\tUse a friendly and genuine, but neutral tone, as if you were a highly competent and knowledgeable colleague.\n\t\tUse plain language that is easy to understand.\n\t\tAvoid business jargon, marketing speak, and corporate buzzwords.\n\n\t\tEnsure there are no spelling or grammar mistakes.\n\t\tEnsure the ideas are clear and concise.\n\t\tSplit up long sentences.\n\t\tSplit up long paragraphs into multiple blocks.\n\t\tReduce repetition of words or phrases.\n\t\tAvoid unnecessary filler text.\n\t\tAvoid obvious caveats.\n\t\tAvoid generic suggestions to check other sources.\n\n\t\tFormat for easy readability, making use of bullets, bolded text, or other formatting as appropriate.\n\t\tWhen referring to dates, you should present them in a readable format.\n\n\t\tWhen possible, you should prefer to use information from the context in your responses. When there is no information on a topic in the context, you can use your general knowledge.\n\t\tThe context may contain incomplete or contradictory information. Make sure to think rigorously and be careful not to make false assumptions.\n\t\tThe context may contain incorrect information. Make sure to use your best judgment and not make any unreasonable claims.\n\t\tDo not make up information unless the user explicitly asks for it.\n\t",chat:"\n\t\tTo send a message to the person in the current context, use chat:\n\t\tSpec:\n\t\t<chat>\n\t\t{Blocks}\n\t\t</chat>\n\t\tExample:\n\t\t<chat>\n\t\t\t<text>Hello! Here is a list:</text>\n\t\t\t<uli>Item 1</uli>\n\t\t\t<uli>Item 2</uli>\n\t\t</chat>\n\n\t\tMake sure to include only Block tags at the top-level of chat.\n\t\tChat should only include the following Block XML tag names unless the user explicitly asks for them: text, uli, oli, code-block, math-block.\n\t\tChat should only include the following Inline XML tag names unless the user explicitly asks for them: h2, h3, b, i, a.\n\t",editInsert:"\n\t\tTo insert content after a block with a \x3c!--<selection>--\x3e\x3c!--</selection>--\x3e, use insert:\n\t\t<insert>\n\t\t{Blocks}\n\t\t</insert>\n\t\tExample:\n\t\tHuman: <text>I love sandwiches \x3c!--<selection>--\x3e\x3c!--</selection>--\x3ea lot.</text>\n\t\tAssistant: <insert>\n\t\t<text>They are my favorite food because you can put anything between the bread.</text>\n\t\t</insert>\n\t\tResult: <text>I love sandwiches a lot.</text><text>They are my favorite food because you can put anything between the bread.</text>\n\n\t\tYou are not allowed to provide <page> blocks inside insert. Instead, just provide the content blocks to be inserted directly.\n\t",edit:'\n\t\tTo insert content before a block, use insert-before:\n\t\tSpec:\n\t\t<insert-before id="{id}">\n\t\t{Blocks}\n\t\t</insert-before>\n\t\tExample:\n\t\t<insert-before id="1">\n\t\t<h1>New header</h1>\n\t\t<text>Here is a list:</text>\n\t\t<uli>Item 1</uli>\n\t\t<uli>Item 2</uli>\n\t\t<text>Here is a code block:</text>\n\t\t<code-block language="python">\n\t\tprint("Hello, world!")\n\t\t</code-block>\n\t\t</insert-before>\n\n\t\tTo insert content after a block, use insert-after:\n\t\tSpec:\n\t\t<insert-after id="{id}">\n\t\t{Blocks}\n\t\t</insert-after>\n\t\tExample:\n\t\t<insert-after id="1">\n\t\t<h1>New header</h1>\n\t\t<text>Here is a numbered list:</text>\n\t\t<oli>Item 1</oli>\n\t\t<oli>Item 2</oli>\n\t\t<callout>Important note</callout>\n\t\t</code-block>\n\t\t</insert-after>\n\n\t\tTo replace a range of blocks with new content, use replace:\n\t\tSpec:\n\t\t<replace start="{id}" end="{id}">\n\t\t{Blocks}\n\t\t</replace>\n\t\tExample:\n\t\t<replace start="1" end="2">\n\t\t<h1>New header</h1>\n\t\t<text>New text</text>\n\t\t<text>To-do list:</text>\n\t\t<todo checked="true">Completed task</todo>\n\t\t<todo checked="false">Incomplete task</todo>\n\t\t</replace>\n\n\t\tAll blocks between start and end will be replaced, including the start and end blocks. Make sure to consider ALL blocks in the range when writing your replacement content.\n\t\tChild blocks will only be replaced if they are within the range of the line numbers between start and end. If end has child blocks, they will not be replaced since they are not within the range.\n\t\tWhen using replace, you must provide a value that is differnet from the original content.\n\n\t\tWhen using insert-after, insert-before, or replace, do not provide block IDs (they will be created automatically by the system).\n\n\t\tTo "fill out" or edit a page from start to end, you may want to replace an entire page\'s properties and content.\n\t\tTo replace an entire page\'s properties and content, you can use this format:\n\t\t<replace start="{page ID}" end="{last block ID in page}">\n\t\t<page>\n\t\t{Properties}\n\t\t{Blocks}\n\t\t</page>\n\t\t</replace>\n\n\t\tTo delete a range of blocks, use delete:\n\t\tSpec:\n\t\t<delete start="{id}" end="{id}"/>\n\t\tExample:\n\t\t<delete start="1" end="2"/>\n\n\t\tstart and end are inclusive, meaning all blocks between and including the start and end blocks will be deleted.\n\n\t\tTo set an attribute of a page or block, use set-attribute:\n\t\tSpec: <set-attribute id={id} {attribute}={value}/>\n\t\tExample:\n\t\t<set-attribute id="23" checked="true"/>\n\n\t\tMake sure to only use attribute names and values that are allowed for the block\'s type, as defined in the spec for Blocks.\n\t\t',setProperties:'\n\t\tTo set a property of a page, use set-property:\n\t\tSpec:\n\t\t<set-property id="{id}">{Property}</set-property>\n\t\tExample:\n\t\t<set-property id="1"><property-text name="Title">New value with <b>bolded text</b></property-text></set-property>\n\n\t\tWhen setting a property:\n\t\t- Make sure to use the XML tag name that corresponds to the property type you are setting.\n\t\t- You can only set properties that are defined in the database schema. Do not make up new properties.\n\t\t- If the user references a schema value that does not exist but is similar to an existing property, then use the existing property. E.g., if the user asks "set priority to important" but priority options are [low, medium, high], you can reasonably set it to \'high\'.\n\t\t- You cannot set properties that are read-only.\n\t\t- You cannot create new select, multi-select, or status options. Only use the options that are defined in the database schema.\n\t',editBlocks:`\n\tBlocks:\n\t<hr/>\n\t<unknown-block id={id} type={Block Type}/>\n\t<h1 color?={Color}>{Inline}</h1>\n\t<h2 color?={Color}>{Inline}</h2>\n\t<h3 color?={Color}>{Inline}</h3>\n\t<text color?={Color}>{Inline}{Blocks}</text>\n\t<uli color?={Color}>{Inline}{Blocks}</uli> - Bulleted list item (do not wrap in ul tags)\n\t<oli color?={Color}>{Inline}{Blocks}</oli> - Numbered list item (do not wrap in ul tags)\n\t<toggle color?={Color} size?={default|h1|h2|h3|h4}>{Inline}{Blocks}</toggle>\n\t<quote color?={Color}>{Inline}{Blocks}</quote>\n\t<todo checked="{true|false}" color?={Color}>{Inline}{Blocks}</todo>\n\t<callout color?={Color}>{Inline}{Blocks}</callout>\n\t<code-block language={str, lowercase name of code language}>{String, do not escape characters}</code-block>\n\t<math-block>{Inline}</math-block>\n\t<columns>{<column>{Blocks}</column>}...</columns>\n\t<table>{<tr>{<td>{Inline}</td>...}</tr>}...</table>\n\t<page page-font?={default|serif|mono} page-font-size?={default|small} page-width?={default|full-width}>{Properties}{Blocks}</page>\n\n\tNesting:\n\tRepresent nested list items by including <uli> or <oli> blocks inside other <uli> or <oli> blocks.\n\tExample: <oli>Item 1<uli>Subitem 1.1</uli><uli>Subitem 1.2</uli></oli><oli>Item 2<uli>Subitem 2.1</uli></oli>\n\tOnly these blocks may contain nested blocks: <uli>, <oli>, <toggle>, <quote>, <todo>, <callout>\n\n\t${m}\n\t`,chatBlocks:`\n\tBlocks allowed inside <chat>:\n\t<unknown-block id={id} type={Block Type}/>\n\t<h1>{Inline}</h1>\n\t<h2>{Inline}</h2>\n\t<h3>{Inline}</h3>\n\t<text>{Inline}{Blocks}</text>\n\t<uli>{Inline}{Blocks}</uli> - Bulleted list item (do not wrap in ul tags)\n\t<oli>{Inline}{Blocks}</oli> - Numbered list item (do not wrap in ul tags)\n\t<quote>{Inline}{Blocks}</quote>\n\t<todo checked="{true|false}">{Inline}{Blocks}</todo>\n\t<code-block language={str, lowercase name of code language}>{String, do not escape characters}</code-block>\n\t<math-block>{Inline}</math-block>\n\t<table>{<tr>{<td>{Inline}</td>...}</tr>}...</table>\n\n\tNesting:\n\tRepresent nested list items by including <uli> or <oli> blocks inside other <uli> or <oli> blocks.\n\tExample: <uli>Item 1<uli>Subitem 1.1</uli><uli>Subitem 1.2</uli></uli><uli>Item 2<uli>Subitem 2.1</uli></uli>\n\n\t${m}\n\t`,unknownBlock:"\n\tUnknown block:\n\tIf you encounter an unknown block and you want to include it in your output, you MUST return it as-is in your response with its id.\n\tNever attempt to create or edit an unknown block.\n\t",inline:`\n\tInline:\n\t${f}\n\t`,chatInline:`\n\tInline:\n\t${y}\n\t`,colors:`\n\tTo color an entire block, use the color attribute. For example:\n\t<uli color="red">This list item is red</uli>\n\n\tTo color text within a block, use the <h> (highlight) inline tag. For example:\n\t<uli>This list item has <h color="red">red text</h></uli>\n\n\tAvailable colors:\n\t${u().Bt.join("\n")}\n\tWhen a block has no color attribute set, it will be displayed in the default color, which is usually black.\n\tDo not use any other colors.\n\t`,editMultiTurn:"\n\t\tAfter you perform an edit, the user may give feedback or ask for further edits.\n\t\tIf any changes were made during the session, you will see multiple <page> tags in the context, with the most recent version of the page at the end.\n\t\tYou should always refer to the most recent version of the page when making further edits.\n\t",createPage:'\n\t\tTo create a new top-level page, use create-page:\n\t\tSpec:\n\t\t<create-page>\n\t\t<property-title name="Title">{Title}</property-title>\n\t\t{Blocks}\n\t\t</create-page>\n\t\tExample:\n\t\t<create-page>\n\t\t\t<property-title name="Title">New page</property-title>\n\t\t\t<uli>List item 1</uli>\n\t\t\t<uli>List item 2</uli>\n\t\t</create-page>\n\n\t\tWhen creating a top-level page:\n\t\t- You should always provide a concise title for the page in the <property-title> tag.\n\t\t- DO NOT provide any properties other than property-title.\n\t\t- Make sure to fill out the content of the page.\n\t\t- Do not use a heading to represent the page title. The title MUST be ONLY written with property-title.\n\t\t- Keep in mind all of the block types available in Notion, and be thoughtful to use the most appropriate block type for each block to ensure the best reader experience.\n\t\t- Aim to create an aesthetically pleasing page. Use color as appropriate.\n\t\t- If the user asks to create in the style or format of a reference page, adhere to the reference page\'s style and format as much as possible. Any style or format rules given should take precedence over your own preferences.\n\t',createPageInDatabase:'\n\t\tTo create a new page in a specific database, use create-page with the \'in\' attribute:\n\t\tSpec:\n\t\t<create-page in="{database id}">\n\t\t{Properties}\n\t\t{Blocks}\n\t\t</create-page>\n\t\tExample:\n\t\t<create-page in="4">\n\t\t\t<property-title name="Title">New page</property-title>\n\t\t\t<property-person name="Assignee"><mention-person person-id="6"/></property-person>\n\t\t\t<property-phone-number name="Phone">756-387-3988</property-phone-number>\n\t\t\t<uli>List item 1</uli>\n\t\t\t<uli>List item 2</uli>\n\t\t</create-page>\n\n\t\tYou may only create pages in databases that are shown in the current context.\n\n\t\tWhen creating a page in a database:\n\t\t- You should always provide a title via the <property-title> XML tag, unless the user explicitly asks for a page without a title.\n\t\t- You should only provide other properties beyond the title when either the user explicitly asks for them, or there are explicit instructions to do so in the context.\n\t\t- Make sure to fill out the content of the page if this is merited by the user\'s request.\n\t\t- Make sure to use the XML tag name that corresponds to the property type you are setting.\n\t\t- You can only set properties that are defined in the database schema. Do not make up new properties.\n\t\t- You cannot set properties that are read-only.\n\t\t- You cannot create new select, multi-select, or status options. Only use the options that are defined in the database schema.\n\t\t- Do not provide empty properties. Instead, omit the property tag entirely.\n\t',pages:"\n\tThere are one or more <page> tags shown inside <stdout>. These are pages in Notion.\n\t",databaseQueryResults:"\n\tThere are one or more <query-database-results> tags shown inside <stdout>. These are the results of a Notion database query.\n\t",qnaAnswerAccuracyRubric:"\n\tYour answer must be accurate and based on the information available to you. You must not make any false claims or provide misleading information.\n\tIf the question is based on false information, you must correct the user's understanding.\n\tIf you did not find any relevant information, you must say so and provide a clear explanation.",searchResults:"\n\tThere are one or more <search-results> tags shown inside <stdout>. These are the results of a search, and may contain results from Notion, or external apps like Slack or Google Drive.\n\n\tSearch results may be incomplete, be irrelevant to the user's question, or contain outdated information.\n\tMake sure to reason carefully about the information you use from the search results.\n\n\tSome mistakes to avoid when using search results:\n\tDo not use information that is not relevant to the query.\n\tSearch results may contain deceptive results, such as information mentioning related entities that are:\n\t- Not the real entity being asked about\n\t- About unrelated events in the past or future. Note the date in the most current context you have.\n\t- General statements rather than a specific answer to the user's specific question\n\tMake sure not to fall victim to these mistakes:\n\tIf results are deceptive or you are unsure, you MUST err on the side of caution and not use the information.\n\tAvoid unsubstantiated claims, even if the user may have assumed them to be true.\n\tWhen dealing with names of people, places, or things, you must not mistake similar sounding names or entities.\n\t",citations:'\n\tWhen referencing ANY information from the context in <chat>, you must cite ALL sources by creating an <a> tag, with no text inside and a single ID as the href. The ID should be the most specific ID of the element containing the information you are directly sourcing as evidence of your claim.\n\tExample: This is a claim<a href="1"/>. This is another claim that has a lot of information<a href="4"/><a href="7"/>.\n\t- Cite only one ID per <a> element.\n\t- One piece of information can have multiple citations in the form of multiple links.\n\t- You do not need to include the title of pages in your response.\n\t- Do not reference these IDs anywhere in your response, except for within citations or links.\n\t- In addition to citations, you may also include normal links if needed. For example: <a href="https://www.example.com">Link to external site</a>.\n\t- Citations must always be displayed inline, inside a block element such as <text>...</text>. Citations may not appear by itself.\n\t- When multiple lines of information all have the same source, group the information together so they can be cited with a single <a> tag. Try not to cite the same source over and over for each line of information.\n\n\tWhen referencing information from pages or search results:\n\t- Cite the most specific block IDs when possible that link to the line of text in the source, otherwise fall back to citing the <result> or <page> ID.\n\t- Ensure that the element whose ID you are citing is ALWAYS correct. Do not cite wrong or adjacent elements.\n\t- Do NOT cite when you are mentioning general information that isn\'t directly evidenced by a specific page or search result. Citations must be reserved for evidence that directly and completely supports your claims.\n\t- Do NOT cite database views as they do not contain citable information themselves.\n\t',createOrEditLinks:'\n\tWhen creating or editing a page, you may include links if this is merited by the user\'s request.\n\tTo do this, use <a> tags.\n\tYou must provide link text (it cannot be empty).\n\tYou can link to page, database, or block IDs, or to external URLs.\n\tExternal links must be real. Do not make up URLs.\n\tExamples:\n\t<a href="1">Link to page</a>\n\t<a href="https://www.example.com">Link to external site</a>\n',properties:"\n\tProperties:\n\t<property-title name={str}>{Markdown}</property-title>\n\t<property-text name={str}>{Markdown}</property-text>\n\t<property-url name={str}>{Markdown}</property-url>\n\t<property-email name={str}>{Markdown}</property-email>\n\t<property-phone-number name={str}>{Markdown}</property-phone-number>\n\t<property-person name={str}>{InlinePerson}</property-person>\n\t<property-date name={str}>{InlineDate}</property-date>\n\t<property-checkbox name={str} checked={true|false}/>\n\t<property-select name={str}>{SelectOption}</property-select>\n\t<property-multi-select name={str}>{SelectOptions}</property-multi-select>\n\t<property-status name={str}>{SelectOption}</property-status>\n\t<property-number name={str} number={str}/>\n\t<property-relation name={str}>{InlinePages}</property-relation>\n\t<property-created-time name={str}>{InlineDate}</property-created-time> // Read-only\n\t<property-last-edited-time name={str}>{InlineDate}</property-last-edited-time> // Read-only\n\t<property-created-by name={str}>{InlinePerson}</property-created-by> // Read-only\n\t<property-last-edited-by name={str}>{InlinePerson}</property-last-edited-by> // Read-only\n\n\tInlineDate:\n\t<mention-date date={YYYY-MM-DD}/>\n\t<mention-datetime date={YYYY-MM-DD} time={HH:MM}/>\n\t<mention-date-range start-date={YYYY-MM-DD} end-date={YYYY-MM-DD}/>\n\t<mention-datetime-range start-date={YYYY-MM-DD} end-date={YYYY-MM-DD} start-time={HH:MM} end-time={HH:MM}/>\n\n\tInlinePage:\n\t<mention-page page-id={id}/>\n\n\tInlineDatabase:\n\t<mention-database database-id={id}/>\n\n\tInlinePerson:\n\t<mention-person person-id={id}/>\n\n\tSelectOption:\n\t<option option={option name}/>\n\n\tSelectOptionCategory:\n\t<option-category category={option category}/>\n\n\tDo not use any property tags that are not listed above.\n\t",languageFollowingChatWithInstructions:"\n\tIf the user or <instructions> specify a particular language to use, then <chat> only in the requested language.\n\tOtherwise, <chat> only in the same language as the last user message.\n\tNote that the context might contain text in multiple languages. Make sure to use the language specified by the user or <instructions>.\n\t",languageFollowingChat:"\n\tIf the user specifies a particular language to use, then <chat> only in the requested language.\n\tOtherwise, <chat> only in the same language as the last user message.\n\tNote that the context might contain text in multiple languages. Make sure to use the language specified by the user.\n\t",languageFollowingCreateOrEdit:"\n\tLanguage following rules for creating or editing content:\n\t1. If the user or <instructions> specify a particular language to use, you should create content in that language.\n\t2. Otherwise, if you are editing existing content, you should maintain the language of the content you are editing.\n\t3. Otherwise, use the user's language.\n\tNote that language following rules also apply when assigning properties, like property-title.\n\tNote that the context might contain text in multiple languages. Make sure to use the language specified by the user.\n\t",languageFollowingXmlInstructionSnippet:'\n\tYou MUST respond in the language most appropriate to the user\'s question and context, unless they explicitly ask for a translation. They may ask a question about another language, but if the question was asked in English you should almost always respond in English, unless it\'s absolutely clear that they are asking for a response in another language. NEVER assume that the user is using "broken English" (or a "broken" version of any other language) or that their message has been translated from another language. If you find their message unintelligible, feel free to ask the user for clarification. Even if many of the search results and pages they are asking about are in another language, the actual question asked by the user should be prioritized above all else when determining the language to use in responding to them. If the user\'s question or current page or their selection conflicts with an <instructions> tag, prioritize the user\'s question/context.\n\n\tFirst output a an XML tag like <lang primary="en-US" /> before responding. If there\'s a chance that the user could have wanted an answer in a different language, output an "alt" attribute <lang primary="en-US" alt="pt-BR" />. Always respond in the "primary" language.\n\t',replaceInPageXmlFormat:"Use this XML syntax:\n\t<replace>\n\t{Blocks}\n\t</replace>",replaceInPageSelection:"\n\tThe user has selected some text or blocks on a page, indicated by \x3c!--<selection>--\x3e...\x3c!--</selection--\x3e.\n\n\tGuidelines for replacing content:\n\tYou will use <replace> to overwrite the entire selection to match the user's request.\n\tWhen appropriate, your replacement should match the style and meaning of the surrounding text.\n\tDo not duplicate content from outside the selection unless instructed otherwise.\n\n\tYour replacement may change the inline formatting (e.g. bolding, capitalizing, colors), block formatting (e.g. the color attribute), or block structure (e.g. converting to bullets <uli> or paragraphs <text>), but take care to only do so when it is appropriate for the user's request.\n\tDo not modify or remove inline tags like <mention-person> or <mention-date>, unless explicitly instructed to do so.\n\tSeparate multiple paragraphs by wrapping them in respective <text> blocks.\n\tDo not change the block nesting structure (e.g. nested <oli> bullets) unless explicitly instructed to do so.\n\n\tYour replacement may change the text content of the selection, but take care to only do so when it is appropriate for the user's request.\n\tDo not change the meaning or intent of the original text unless explicitly instructed to do so.\n\n\tPrecautions:\n\tConsider every single block in the selection and whether you want to keep or modify it.\n\tIf you are modifying only a part of the user's selection, you should keep the other parts of the selection intact by including them in the output verbatim.\n\t",replaceEntirePage:'\n\tUse this XML syntax:\n\t<replace id="{page ID}"><page>\n\t<property-title name="Title">{Title}</property-title>\n\t{Blocks}\n\t</page></replace>\n\t',replaceEntirePageNudge:"\n\tThe user wants your help rewriting all contents of their page based on their request.\n\tUnless instructed otherwise, you should match the writing style and block structure of the original page.\n\n\tPage properties:\n\tIf the page <property-title> is empty, you must update it.\n\tIf the page has an existing <property-title>, you may update it if it improves the content and readability of the page.\n\tDo not provide any other page properties in your response.\n\t",noWorldKnowledge:"You must ONLY use information explicitly in the context. If you did not find the information you need in the the current context, you MAY NOT use your own knowledge. Do not decline the request, but try your best given the available context info.",findRelatedContentOutput:"\n\tYour output must follow the following response:\n\t<related-content>\n\t{sources}\n\t</related-content>\n\n\tSources:\n\t<source id={id} reason={one or two sentence description why the source is related}/>\n\n\tMake sure to only include sources and nothing else inside the <related-content> tags.\n\t"},x={bio:"\n\tYou are Notion AI.\n\tYou must output valid XML only, closely following the spec and examples below. Make sure not to include any extra whitespace or newlines in your XML output.\n\tDO NOT output any markdown formatting except inside of <code> or <code-block>.\n\t",hallucinations:"\n\tYou can use information from anything in the current context (<context>, user <chat> messages, and <stdout>).\n\t",useWorldKnowledge:"\n\tYou can use information from your general knowledge.\n\t",chat:'\n\tTo send a message to the person or people in the current context, use "chat":\n\tSpec: <chat>{Blocks}</chat>\n\tExample: <chat><text>Hello, here is a list:</text><uli>One</uli><uli>Two</uli></chat>\n\t',creation:'\n\tTo create a new page, use "create":\n\t\tSpec: <create><page>...</page></create>\n\t\tExample: <create><page><property-title name="Title">New page</property-title><text>New block in page</text></page></create>\n\n\tWhenever you are drafting new content that the user might want to edit themselves, or ask for further edits on, you should use <create>.\n\tYou should always provide a concise title for the page.\n\t',pageEditing:`\n\tTo insert blocks before / above a block, use "insert-before":\n\t\tSpec: <insert-before id="{id}">{Blocks}</insert-before>\n\t\tExample: <insert-before id="1"><text>New block</text></insert-before>\n\t\tNote that you can insert multiple blocks at once.\n\tTo insert blocks after / below a block, use "insert-after":\n\t\tSpec: <insert-after id="{id}">{Blocks}</insert-after>\n\t\tExample: <insert-after id="1"><text>New block</text></insert-after>\n\t\tNote that you can insert multiple blocks at once.\n\tTo insert blocks indented inside a block, page, or database, use "insert-inside":\n\t\tSpec: <insert-inside id="{id}">{Blocks}</insert-inside>\n\t\tExample: <insert-inside id="1"><text>New block</text></insert-inside>\n\t\tThe new blocks will be inserted at the end of the block, page, or database, indented inside.\n\t\tWhen a page is empty, insert-inside is the only way to insert content into it.\n\t\tNote that if you want to insert above or below a block, you should use insert-after or insert-before instead.\n\t\tNote that you can insert multiple blocks at once.\n\tTo insert blocks after the block that contains the selection, use "insert":\n\t\tSpec: <insert>{Blocks}</insert>\n\t\tExample: <insert><text>New block</text></insert>\n\t\tNote that you can insert multiple blocks at once.\n\tTo move blocks, use "insert-before", "insert-after", or "insert-inside" with "move":\n\t\tSpec: <insert-before id="{id}"><move id="{id}"/></insert-before>\n\t\tExample: <insert-before id="1"><h1>Header</h1><move id="2"/><move id="3"/></insert-before>\n\t\tNote that you can move multiple blocks at once.\n\t\tNote that you can combine creating and moving blocks in the same request.\n\tTo delete a block, use "delete":\n\t\tSpec: <delete id="{id}"/>\n\t\tExample: <delete id="1"/>\n\tTo set the text of a block, use "set-title":\n\t\tSpec: <set-title id="{id}">{Inline}</set-title>\n\t\tExample: <set-title id="1">New title with <b>bolded text</b></set-title>\n\t\tset-title is only supported on these block types: ${Object.entries(u().sA).filter((([e,t])=>t.title)).map((([e])=>e)).join(",")}\n\tTo set an attribute of a block, use "set-attribute":\n\t\tSpec: <set-attribute id="{id}" {attribute name}="{attribute value}"/>\n\t\tExample: <set-attribute id="1" checked="true"/>\n\tTo set the tag name of a block, use "set-tag-name":\n\t\tSpec: <set-tag-name id="{id}" tag-name="{tag name}"/>\n\t\tExample: <set-tag-name id="1" tag-name="h2"/>\n\t\tThis will transform or turn the block into the specified type.\n\tTo set a property of a page or block, use "set-property":\n\t\tSpec: <set-property id="{id}><property-text name="{property name}">{Inline}</property-text></set-property>\n\t\tExample: <set-property id="1"><property-text name="1">New value with <b>bolded text</b></property-text></set-property>\n\t`,setProperty:'\n\tTo set a property of a page or block, use "set-property":\n\t\tSpec: <set-property id="{id}><property-text name="{property name}">{Inline}</property-text></set-property>\n\t\tExample: <set-property id="1"><property-text name="1">New value with <b>bolded text</b></property-text></set-property>\n\n\tReason carefully about whether you need to use load-database to load the database schema first, before setting a property.\n\tYou need to load the database schema first when:\n\t- You are setting a property that is not currently shown in the page properties. Any empty properties will not be shown.\n\t- When writing a new value to a property-select, property-multi-select, property-status, since you need to see the list of options first in the schema.\n\tYou do not need to load the database schema first when:\n\t- Setting the value of property types that do not require seeing the schema (property-text, property-url, property-email, property-phone-number, property-person, property-date, property-checkbox, property-number), when they are already shown in the page properties.\n\t- Clearing the value of any property, when it is already shown in the page properties.\n\t',blocks:`\n\tBlocks:\n\t${h}\n\tDo not use any block tags that are not listed above.\n\tWhen creating new blocks, do not provide an id attribute.\n\t`,inline:`\n\tInline:\n\t${f}\n\tDo not use any inline tags that are not listed above.\n\t`,propertiesMinimal:`\n\tProperties:\n\t${v({hasPage:!0,hasDatabase:!0})}\n\tDo not use any property tags that are not listed above.\n\t`,loadingPages:'\n\tTo load a page or database\'s content, use "load":\n\tSpec: <load id="{id}"/>\n\tExample: <load id="0"/>\n\tYou can only load pages or databases that are shown in the current context.\n\t',search:(e,t)=>{const a=e.filter((e=>"context"===e.type||"human"===e.type)).find((e=>"context"===e.type));if(!a)throw new Error("Context step not found");const i=a.context,s=i["current-datetime"]||"";let o=n(906745).DateTime.fromISO(s);o.isValid||(o=(0,d().vF)({}));const r=o.toFormat("ccc d LLL yyyy"),l=i["current-person-name"]||"",u=i["current-space-name"]||"";return["You are an Assistant that generates search queries to find useful information. You have access to "+(t?"<search>, <search-people> and <search-databases>.":"<search>."),'The main search API is <search question="{question}" keywords="{keywords}" lookback="{time to search over expressed as d, w, m, y, all_time or default}" sort?="latest" question-intl?="{question in human\'s language}" exact-match?="{strings that need an exact match separated by spaces}" source?="{notion or slack or google-drive}" channel?="{slack channel name}"/>',"You can additionally search for people and database IDs, if and only if the query mentions specific people or databases:",t?"<search-people search={person name}/>":void 0,t?"<search-databases search={database name}/>":void 0,`${l?u?`The human's name is "${l}". Their Notion workspace is called "${u}". Today's date is ${r}.`:`The human's name is "${l}" and today's date is ${r}.`:`Today's date is ${r}.`} Do not infer any additional context.`,...["To generate a <search> query:","- It should be specific and semantically consistent to the chat message. Key information should not be lost or changed. It may rephrase the question to better find an answer.","- Include at least two keywords, and allow any keywords that are relevant to the input to improve the chances of finding the best document. Do not repeat keywords. Keywords should only include relative dates if the document might contain the date.",'- You must provide a lookback period of time. If the question does not imply a clear lookback time, set it to "default". If it has to search from all documents without filtering by time, set to "all_time". "all_time" is expensive, so use only when absolutely necessary.','- If the user is clearly asking for the latest information include sort="latest", else ignore.',"- The question and keywords attributes must always be in English. If and only if the raw question is non-English, the search query should contain a question-intl attribute with the question in that language.","- If the user explicitly asks to search from a single data source, in addition to the regular query, please generate an additional query:",'  - Move the mentioned data source from questions and keywords attributes to the source attribute, indicating where to find the answer. Valid sources are "notion", "slack", or "google-drive". Only use the source attribute if the user clearly asks to search from that specific data source.','  - If the source is "slack" and if the user provides a certain Slack channel to search from, include its name in the channel attribute. Otherwise, skip. Remember it has to be a valid Slack channel name.',"  - Do not infer a data source unless the user explicitly specifies. Don't generate the additional query if the user only asks about Notion/Slack/Google brands, products, or companies.","- Handle the exact-match attribute with special precision. This attribute should only be set if the input message requires a specific literal match that is critical to filter the search results, such as an ID number or proper noun with exact quotation. Exclude human names and websites from the exact-match field.","- Ensure the text value in exact-match is as precise as possible to improve recall. Avoid putting multi-line text in exact-match.","- If the chat message contains a simple keyword, statement, or command, convert it to a basic question.","- If the chat message contains a common abbreviation or acronym, it needs to be expanded in the keywords attribute.",'- If the context provides a user name, rephrase questions about "me" and "my" as questions about the user name.','- If the context provides a workspace name, rephrase questions about "our" as questions about the workspace name.',"- If there are multiple questions on diverse topics in the user's message, split it into up to 3 separate queries. Each query must be based on the original user message. If multiple questions are similar, only pick one. Never output more than 3 search queries."],...t?["To generate a <search-databases> query:",'- Only use when the request is explicitly referring to a database, including words like "database" or "db", as well as the database\'s name, and the database ID is not already shown in the context.']:[],...t?["To generate a <search-people> query:","- This is mainly useful for fetching person ID for setting a property-person value. To find specific details about a person; use an additional <search> in addition.","- Only search for people, not for companies, job titles, or other non-human entities.","- Only use when the request explicitly references a person by name, and their ID is not already known in the context."]:[]].filter(c().O9).join("\n")},setDatabasePageProperty:'\n\tSet a database page relation property:\n\tTo set a relation property, first look up the page id of the page you want to relate using the database-id of the relation property.\n\tThen use the page-id to set the relation property: <set-property id="{id}"><property-relation name="{str}"><mention-page page-id="{page id}"></mention-page></property-relation></set-property>\n\tTo add a page reference to a relation property, first lookup the page id of the page you want to relate using the database-id of the relation property.\n\tThen use the page-id you found in the query to append the new page id: <insert-inside id="{id}"><property-relation name="{str}"><mention-page page-id="{page id}" /></property-relation></insert-inside>.\n\tThis will add the page-id to the relation property without removing any of the existing values.\n\tTo remove a page reference from a relation property, first lookup the page id of the page you want to relate using the database-id of the relation property.\n\tThen use the page-id you found in the query to remove the page id from the relation: <delete id="{id}" name="{str}"><property-relation name="{str}"><mention-page page-id="{page id}" /></property-relation></delete>.\n\tThis will add the page-id to the relation property without removing any of the existing values.\n\n\tSet a database page person property:\n\tTo set a person property use <set-property>. For example <set-property id="{id}"><property-person name="{str}"><mention-person person-id="{person id}"></mention-person></property-person></set-property>\n\tTo add a value to a person property, use <insert-inside>, for example <insert-inside id="{id}"><property-person name="{str}"><mention-person person-id="{person id}"></mention-person></property-person></insert-inside>\n\tThis will add an additional value to the person property without overwriting it.\n\tTo remove a person from the person property use <delete>. For example,\n\t<delete id="{id}"><property-person name="{str}"><mention-person person-id="{person id}"></mention-person></property-person></delete>\n\n\tSet a database page multi-select property:\n\tTo set a multi-select property use <set-property>. For example <set-property id="{id}"><property-multi-select name="Genre"><option option="Art"/><option option="Photography"/></property-multi-select></set-property>\n\tThis will set the value of the multi-select property to Art and Photography\n\tTo add a value to a multi-select property, use <insert-inside>, for example <insert-inside id="{id}"><property-multi-select name="Genre"><option option="Art"/></property-multi-select></insert-inside>\n\tThis will add Art to the property without deleting removing any existing values.\n\tTo remove a value from a multi-select property use <delete>. For example,\n\t<delete id="{id}"><property-multi-select name="Genre"><option option="Art"/></property-multi-select></delete>\n\tThis will remove the Art option from the multi-select\n\t',searchPeople:'\n\tTo search for people, use "search-people":\n\tSpec: <search-people search="{fuzzy match string}"/>\n\tExample: <search-people search="james"/>\n\tProvide a fuzzy match string, which can match any part of a user\'s full name or email address. This will not search any other information about them, so do not try to use search-people to search for people by terms other than their name or email address.\n\tInside <stdout>, search-people will output a list of possible people that match the search string, including their ID, full name and email address.\n\tWhen you reference a person, use a person mention. This will render as their full name.\n\tSpec: <mention-person person-id="person ID"/>\n\tExample: <mention-person person-id="425"/>\n\t',databaseNewPage:'\n\tInstructions for creating a new page inside a database:\n\tUse "insert-inside" to create a new page inside a database.\n\tSpec: <insert-inside id="{database ID}"><page><property-title name="{Title}">{Page title}</property-title><property-text name="{Another property}">{Property value}</property-text><text>{Optional page content}</text></page></insert-inside>,\n\tYou can only create pages inside databases that are shown in the current context.\n\tWhen referencing a database by ID from a child-database, make sure to use the ID from the database-id attribute.\n\tYou can set any number of properties, but make sure to only set properties that are explicitly requested.\n\tYou can insert page content by including blocks inside the <page> tag after the properties, but only insert page content when explicitly requested.\n\tYou can create multiple pages at once, but only create multiple pages when explicitly requested.\n\t',tableCreate:"\n\tYou may create tables as part of your response.\n\tHere is an example of a table: <table><tr><td>Abyssinian</td><td>Medium length fur, colorful (ticked)</td></tr><tr><td>Bengal</td><td>Short hair, leopard-like markings</td></tr></table>\n\t",diagramCreate:'\n\tYou may create diagrams or flowcharts using Mermaid. Wrap your node text in quotes to escape parentheses. Code comments should only be added on a new line after double percent %% sign.\n<code-block language="mermaid">\ngraph TD;\n    A["Start"] --\x3e B{"Is it working?"};\n    B -- Yes --\x3e C["Continue"];\n    B -- No --\x3e D["Fix it (Resolve)"];\n    D --\x3e B;\n</code-block>\n\t',tableEdit:'\n\tInstructions for manipulating tables:\n\tTo create a new table: use <insert-after>, <insert-before>, or <insert-inside> with <table>...</table>. For example, here is a table: <table><tr><td>Abyssinian</td><td>Medium length fur, colorful (ticked)</td></tr><tr><td>Bengal</td><td>Short hair, leopard-like markings</tr></table>\n\tTo add a new table column before an existing column: <insert-before id="table ID" name="Insert before column index"><schema-property-text name="New column index"/></insert-before>\n\tTo add a new table column after an existing column: <insert-after id="table ID" name="Insert after column index"><schema-property-text name="New column index"/></insert-after>\n\tTo move a table column before an existing column:  <insert-before id="Table ID" name="Before column ID"><move id="Table ID" name="Move column ID"/></insert-before>\n\tTo move a table column after an existing column:  <insert-after id="Table ID" name="After column ID"><move id="Table ID" name="Move column ID"/></insert-after>\n\tTo delete a table column: <delete id="Table ID" name="Column ID"/>\n\tTo set a table cell value: <set-property id="Row ID"><property-text name="Column index">Cell value</property-text></set-property>\n\tTo clear a table cell value: <set-property id="Row ID"><property-text name="Column index"></property-text></set-property>\n\tTo add a new table row before another row: <insert-before id="Table ID" name="Before row ID"><tr>...</tr></insert-before>\n\tTo add a new table row after another row: <insert-after id="Table ID" name="After row ID"><tr>...</tr></insert-after>\n\tTo move a table row before another row: <insert-before id="Before row ID"><move id="Move row ID"/></insert-before>\n\tTo move a table row after another row: <insert-after id="After row ID"><move id="Move row ID"/></insert-after>\n\tTo delete a table row: <delete id="Row ID"/>\n\t',searchResults:"\n\tSearch results can return any page from the entire workspace. Search results may be incomplete, be irrelevant to the user's question, or contain outdated information. Search results may be unrelated to each other.\n\t",chatWithCitableObservation:"\n\tThere is a page, search results, or database query results in the context, so you need to try to use this information to formulate a response to the user, using these rules:\n\tIf you found an exact answer to the question in the context, provide the answer.\n\tIf you found multiple sources with exact answers which disagree with each other, state that you found multiple answers, and provide the best answers.\n\tIf you could not find an exact answer to the question, but found some highly relevant information, state that you could not find an exact answer, and then\n\tprovide the relevant information.\n\tIf you could not find any relevant information, you must use chat to explicitly state that you could not find an answer. Then, if you have information from your general knowledge that is relevant to the question, you may provide a response using that information.\n\t",createOrEditWithCitableObservation:"\n\tThere is a page, search results, or database query results in the context, so you need to try to use this information to formulate your next action, using these rules:\n\tIf you found relevant information, or the user's request does not require any more information, then you may take your next action immediately.\n\tIf you did not find relevant information, you must first use <chat> to tell the user about this. Then, you may choose use your general knowledge to take your next action.\n\t",responseRubricWithoutCitableObservation:"\n\tYour response will be graded according to the following rubric:\n\tLength: Consider the length of the response the user would want, and tailor your response to that length. Responses should be concise and to the point when the request is about a very specific piece of information or the answer is very simple. Responses should be more detailed and thorough when the request is more open-ended or the answer is complex.\n\tRelevance: You should stay on topic and not provide any information that is not directly relevant to the request.\n\tReadability: Your responses should be very readable and well-structured. Split long pieces of text into multiple paragraphs, make use of bulleted or numbered lists, and use inline formatting to improve readability.\n\t",responseRubricWithCitableObservation:"\n\tYour response will be graded according to the following rubric:\n\tLength: Consider the length of the response the user would want, and tailor your response to that length. Responses should be concise and to the point when the request is about a very specific piece of information or the answer is very simple. Responses should be more detailed and thorough when the request is more open-ended or the answer is complex.\n\tRelevance: You should stay on topic and not provide any information that is not directly relevant to the request.\n\tAccuracy: Make sure to accurately summarize the referenced information. Be careful not to make any assumptions.\n\tTransparency: You should take into account when pages were last edited relative to the current date. You should take into account whether pages are marked as old, outdated, deprecated, etc. If the document is outdated or was last edited a long time ago, you should mention that the answer may not be reliable.\n\tReadability: Your responses should be very readable and well-structured. Split long pieces of text into multiple paragraphs, make use of bulleted or numbered lists, and use inline formatting to improve readability.\n\t",citations:'\n\tWhen referencing information from the context in a <chat>, you must cite your sources by putting a single block or page id in an empty <a> tag.\n\tYou should cite specific blocks when possible, unless it is a result of a database query, or the user explicitly asks for a page.\n\tOne piece of information can have multiple citations.\n\tIf you cannot find an answer, do not add citations.\n\tExample: This is a claim<a href="1"/>. This is another claim that has a lot of information<a href="4" /><a href="7" />.\n\tYou do not need to include the title of the pages in your answer.\n\tDo not reference the block ID, page ID, or number anywhere in your response, except for within a citation.\n\t',cursor:"\n\tCursor location:\n\tThe user has placed their cursor in a specific location, indicated by \x3c!--<selection>--\x3e\x3c!--</selection--\x3e.\n\tMake sure to formulate your response in the context of this cursor location. The user's request might implicitly refer to the region around their cursor.\n\n\tIf the user is asking to insert new content, you should insert the new content right after the cursor location, unless explicitly instructed otherwise.\n\n\tDon't explicitly mention their cursor location in your response.\n\t",cursorChat:"\n\tDon't explicitly mention their cursor location in your response.\n\t",cursorEdit:"\n\tIf the user is asking to insert new content, you should insert the new content right after the cursor location, unless explicitly instructed otherwise.\n\t",selection:"\n\tSelection:\n\tThe user has selected some text or blocks on a page, indicated by \x3c!--<selection>--\x3e...\x3c!--</selection--\x3e.\n\tMake sure to formulate your response in the context of this selection.\n\tMake sure to consider the entire selection when formulating your response. Do not ignore any part of the selection.\n\t",selectionNonConditional:"\n\tSelection:\n\tIf the user has selected some text or blocks on a page, it will be indicated inside the page observation by \x3c!--<selection>--\x3e...\x3c!--</selection--\x3e.\n\tIf a selection is present, make sure to formulate your response in the context of this selection.\n\tMake sure to consider the entire selection when formulating your response. Do not ignore any part of the selection.\n\t",cursorNonConditional:"\n\tCursor location:\n\tIf the user has placed their cursor in a specific location, it will be indicated inside the page observation by \x3c!--<selection>--\x3e\x3c!--</selection--\x3e.\n\tIf a cursor is present, make sure to formulate your response in the context of this cursor location. The user's request might implicitly refer to the region around their cursor.\n\n\tIf the user is asking to insert new content when a cursor is present, you should insert the new content right after the cursor location, unless explicitly instructed otherwise.\n\n\tDon't explicitly mention their cursor location in your response.\n\t",mentionPage:'\n\tMentioned page:\n\tThe user has mentioned a specific page in their message, indicated by <mention-page page-id="{page ID}"/>.\n\tConsider the content of the mentioned page when formulating your response. If the user asks to use the mentioned page in a specific way, you should follow their instructions.\n\t',selectionChat:"\n\tDon't explicitly mention their selection in your response.\n\t",selectionEdit:"\n\tIf the user is asking for an edit to existing content, and they have made a selection, you should edit just the range that was selected unless explicitly instructed otherwise.\n\n\tIf the user is asking to insert new content, you should insert the new content right after the selected blocks, unless explicitly instructed otherwise.\n\t",translation:"\n\tYou have the ability to translate from one language to another. Provide translations directly in your response. Do not reject requests to translate.\n\t",languageFollowing:"\n\tWhen chatting or taking any actions, you should use the same language as the people interacting with you, unless explicitly specified otherwise in their message or in your instructions.\n\t",chainOfThought:"\n\tBefore taking any actions, use <think>:\n\tSpec: <think>{Observation}{Plan}</think>\n\tObservation: Briefly summarize the latest state of the current task and context.\n\tPlan: Make a short plan that describes the next actions you will take, considering all of the instructions that are relevant to the current task.\n\tMake sure to include both an observation and a plan.\n\tAnything you write inside <think>...</think> will not be shown to the user.\n\tDo not include any XML tags inside <think>...</think>.\n\t"};for(const K of(0,c().uv)(x))"search"!==K&&(x[K]=x[K].split("\n").map((e=>e.trim())).filter(Boolean).join("\n"));for(const K of(0,c().uv)(b))b[K]=b[K].split("\n").map((e=>e.trim())).filter(Boolean).join("\n");for(const K of(0,c().uv)(S))S[K]=S[K].split("\n").map((e=>e.trim())).filter(Boolean).join("\n");r().Eo,r().Eo,r().Eo,r().Eo,r().Eo,r().Eo,r().Eo,r().Eo,r().Eo;r().Eo,r().Eo;function I(e){const{transcript:t}=e;return function(e){const{transcript:t}=e;return{systemInstructions:{type:"custom",instructions:""},transcript:t,forcePrefix:"<think>"}}({transcript:t})}function k(e){const{assistantOutputMode:t,selectedSkillType:a,transcript:i,currentTaskType:s,modelOverride:o,namespace:l}=e;let c;const d="qna-enhanced"===t?n(563217).Nh:"assistant_0.3";let u;if(l&&"router"!==l&&"end_to_end"!==l&&"prompt_only_server"!==l){if("chat"===l)c={type:"assistantChat",state:r().p$,transcript:i,mode:d};else if("edit_page"===l)c={type:"assistantEditPage",state:r().p$,transcript:i,mode:d};else if("create_page"===l)c={type:"assistantCreatePage",state:r().p$,transcript:i,mode:d};else{if("continue_writing"!==l)throw new Error("Namespace not supported on the client (use runAssistant).");c={type:"assistantContinueWriting",state:r().p$,transcript:i}}u="openai-gpt-4o"}else c={type:"assistant",...I({type:s,transcript:i}),skillType:a},u="openai-gpt-4o";return o&&(u=o),{promptArgs:c,model:u,outputPostProcessingConfig:{type:"none"}}}var w=()=>n(691309),C=()=>n(436468),A=()=>n(416504),T=()=>n(792071),j=()=>n(179034),M=()=>n(519831),_=()=>n(763824),P=()=>n(769864),D=()=>n(108184),E=()=>n(106628),R=()=>n(996477),B=()=>n(195181),F=()=>n(383070),N=()=>n(483730),L=()=>n(17849);class O extends Error{constructor(e,t){super(t),this.errorCode=void 0,this.name="AIInferenceError",this.errorCode=e}get isProviderError(){return 502===this.errorCode||503===this.errorCode||504===this.errorCode}}var V=()=>n(761777),z=()=>n(384944);function W(e){var t;const{environment:a,collectionViewStore:i,parentCollectionViewBlockStore:s,transaction:o,filter:r,inMemoryRecordCache:l,sort:c,semanticQuery:d,assistantChatSessionId:u}=e,p=(0,n(135168).f)(s),g=p?(0,n(443002).H)({spaceStore:p,userId:a.currentUser.id??"",environment:a}):void 0;if(!p||!g)throw new Error("No current space or space view.");const m=a.currentUser.id;if(!m)throw new Error("User is not logged in.");const h=z().Wv({environment:a,type:n(700500).xd.collectionViewPage,inMemoryRecordCache:p.inMemoryRecordCache,transaction:o,spaceId:p.id,permissions:[{type:"user_permission",user_id:m,role:"editor"}]}),f={type:"table",parent_id:h.id,parent_table:j().ev,alive:!0,space_id:p.id,format:{table_properties:i.getFormat().table_properties,timeline_arrows_by:void 0,subitem_display_mode:"hidden",table_subitem_toggle_column:"title",is_unlisted:!0,collection_pointer:i.getFormat().collection_pointer??(null===(t=s.getCollectionPointers())||void 0===t?void 0:t[0]),...d?{is_unlisted_from_semantic_query:{is_from_semantic_query:!0,query:d}}:{is_unlisted_from_semantic_query:{is_from_semantic_query:!1}}},query2:{filter:r,sort:c}},y=z().eC({environment:a,table:n(869558).Gy,value:f,inMemoryRecordCache:l,transaction:o});return z().zv({store:h,data:{parent_id:u,parent_table:n(363497).TF,alive:!0,view_ids:[y.id]},transaction:o}),{collectionViewStore:y,linkedDatabaseCollectionBlockStore:h}}class U extends(()=>n(329840))().Y{constructor(e){const{environment:t,assistantEvaluatorStateCallbacks:n,sessionId:a,contextOrState:i}=e,s=(0,V().getLoggedInUserOrPublicSiteUserId)(t);if(!s)throw new Error("No valid user.");const o=(0,R().fM)(t);if(!o)throw new Error("No valid space.");const r={spaceId:o.id,userId:s,sessionId:a},l=t.idCreator.getSpaceIdCreatorSync(o.id);super(i,r),this.environment=void 0,this.assistantEvaluatorStateCallbacks=void 0,this.currentUserId=void 0,this.sessionId=void 0,this.spaceIdCreator=void 0,this.environment=t,this.assistantEvaluatorStateCallbacks=n,this.currentUserId=s,this.sessionId=a,this.spaceIdCreator=l}shouldThrowOnUnboundMethodCalled(){return!1}clone(){const e=new U({contextOrState:this.getContext(),environment:this.environment,assistantEvaluatorStateCallbacks:this.assistantEvaluatorStateCallbacks,sessionId:this.sessionId});return e.inheritPropsFromClonedParent(this),e}setEvaluatorStateCallbacks(e){this.assistantEvaluatorStateCallbacks=e}getEvaluatorStateCallbacks(){return this.assistantEvaluatorStateCallbacks}parse(e){return(0,n(412412).BD)(e)}addOperation(e){const t=this.getAssistantConfigurationState();if(t.limitEditsInsideBlockSubtree&&!(0,V().isAssistantOperationInBlockOrBlockSubtree)(t.limitEditsInsideBlockSubtree,e))return;const a=(0,n(371621).r0)({environment:this.environment,attributionActor:this.assistantEvaluatorStateCallbacks.getAttributionActor(),caches:this.getSessionContext().caches,assistantOperation:e,currentUserId:this.currentUserId});this.assistantEvaluatorStateCallbacks.addExecutableOperationToTemporaryOperations({...e,operations:a,id:(0,w().Vg)(this.samplingStableID())})}samplingStableID(){const e=N().default.getSessionContextOrThrow(this.sessionId),t=e.getLatestCachedID();if(t)return e.incrementRandomIDIndex(),t;{const t=this.generateBlockID();return e.addToRandomIDCache(t),t}}generateBlockID(){return this.spaceIdCreator.idInSavedSpace(j().ev)}randomID(){return this.samplingStableID()}async measureApi(e,t){const n=s().default.DO_NOT_USE_markLegacy("assistant.evaluator_api"),a=await t();return s().default.DO_NOT_USE_measureLegacy(n,{environment:this.environment,data:{assistant_api_name:e}}),a}async loadDatabase(e){const t=(0,V().getParentRecordStoreOrThrow)();if(this.getAssistantConfigurationState().sampling){return{databaseNode:{type:"collection",tagName:"database",attributes:{id:e,title:"Untitled"},persisted:!0,schemaId:e,parent:e,schemas:{},properties:{}},relatedNodes:[]}}const n={table:M().Vl,id:e,spaceId:t.getSpaceId()};return this.assistantEvaluatorStateCallbacks.appendAssistantLoadDatabaseTemporaryClientStep(n),await this.measureApi("load_database",(async()=>{const e=await(0,C().BM)({collectionPointer:n,loadRecordModel:T().h0Y.fromLoadRecordValueFn(t.loadRecordValue),intl:i().A.getIntl(),currentTimeZone:(0,A().P)()});if(!e)throw new Error("Unable to load database");return{relatedNodes:await(0,V().loadDatabaseRelatedNodesForValue)({node:e,parentRecordStore:t}),databaseNode:e}}))}static async loadPageAndRelatedRecords(e){const{parentRecordStore:t,pointer:n}=e,{node:a,isNonSpaceShared:s}=await(0,C().Rz)({pointer:n,loadRecordValue:t.loadRecordValue,intl:i().A.getIntl(),currentTimeZone:(0,A().P)()});return{pageBlockNode:a,relatedNodes:await(0,V().loadRelatedNodesForValue)({node:a,parentRecordStore:t}),relatedDatabaseNodes:await(0,V().loadDatabaseRelatedNodesForChildPage)({node:a,parentRecordStore:t}),isNonSpaceShared:s}}async loadPage(e){const t=(0,V().getParentRecordStoreOrThrow)();if(this.getAssistantConfigurationState().sampling){return{pageBlockNode:{type:"block",tagName:"page",text:[],attributes:{id:e},properties:{},schemas:{},children:[],parent:void 0,persisted:!0,schemaId:e},relatedNodes:[],relatedDatabaseNodes:[],isNonSpaceShared:!1}}const n={table:j().ev,id:e,spaceId:t.getSpaceId()};return this.assistantEvaluatorStateCallbacks.appendAssistantLoadPageTemporaryClientStep(n),await this.measureApi("load_page",(()=>U.loadPageAndRelatedRecords({parentRecordStore:t,pointer:n})))}async loadSlack(e){var t;const n=null===(t=(0,a().S)())||void 0===t?void 0:t.id,i=e;if(!n)throw new Error("No space id");const s=await P().callApi({eventName:"loadUniversalObject",environment:this.environment,data:{type:"slack",url:i,aiSessionId:this.sessionId,spaceId:n}});if("success"!==s.type)throw s.error;return{slackMessage:s.data}}async loadGoogleDrive(e){var t;const n=null===(t=(0,a().S)())||void 0===t?void 0:t.id,i=e;if(!n)throw new Error("No space id");const s=await P().callApi({eventName:"loadUniversalObject",environment:this.environment,data:{type:"google-drive",url:i,aiSessionId:this.sessionId,spaceId:n}});if("success"!==s.type)throw s.error;return{googleDriveContent:s.data}}async loadGithub(e){var t;const n=null===(t=(0,a().S)())||void 0===t?void 0:t.id,i=e;if(!n)throw new Error("No space id");const s=await P().callApi({eventName:"loadUniversalObject",environment:this.environment,data:{type:"github",url:i,aiSessionId:this.sessionId,spaceId:n}});if("success"!==s.type)throw s.error;return{githubContent:s.data}}async loadGithubCode(e){var t;const n=null===(t=(0,a().S)())||void 0===t?void 0:t.id,i=e;if(!n)throw new Error("No space id");const s=await P().callApi({eventName:"loadUniversalObject",environment:this.environment,data:{type:"githubCode",url:i,aiSessionId:this.sessionId,spaceId:n}});if("success"!==s.type)throw s.error;return{githubCodeContent:s.data}}async loadJira(e){var t;const n=null===(t=(0,a().S)())||void 0===t?void 0:t.id,i=e;if(!n)throw new Error("No space id");const s=await P().callApi({eventName:"loadUniversalObject",environment:this.environment,data:{type:"jira",url:i,aiSessionId:this.sessionId,spaceId:n}});if("success"!==s.type)throw s.error;return{jiraContent:s.data}}async loadLinear(e){var t;const n=null===(t=(0,a().S)())||void 0===t?void 0:t.id,i=e;if(!n)throw new Error("No space id");const s=await P().callApi({eventName:"loadUniversalObject",environment:this.environment,data:{type:"linear",url:i,aiSessionId:this.sessionId,spaceId:n}});if("success"!==s.type)throw s.error;return{linearContent:s.data}}async loadBox(e){var t;const n=null===(t=(0,a().S)())||void 0===t?void 0:t.id,i=e;if(!n)throw new Error("No space id");const s=await P().callApi({eventName:"loadUniversalObject",environment:this.environment,data:{type:"box",url:i,aiSessionId:this.sessionId,spaceId:n}});if("success"!==s.type)throw s.error;return{boxContent:s.data}}async loadSalesforce(e){var t;const n=null===(t=(0,a().S)())||void 0===t?void 0:t.id,i=e;if(!n)throw new Error("No space id");const s=await P().callApi({eventName:"loadUniversalObject",environment:this.environment,data:{type:"salesforce",url:i,aiSessionId:this.sessionId,spaceId:n}});if("success"!==s.type)throw s.error;return{salesforceContent:s.data}}async loadMicrosoftTeams(e){var t;const n=null===(t=(0,a().S)())||void 0===t?void 0:t.id,i=e;if(!n)throw new Error("No space id");const s=await P().callApi({eventName:"loadUniversalObject",environment:this.environment,data:{type:"microsoft-teams",url:i,aiSessionId:this.sessionId,spaceId:n}});if("success"!==s.type)throw s.error;return{microsoftTeamsContent:s.data}}async loadSharepoint(e){var t;const n=null===(t=(0,a().S)())||void 0===t?void 0:t.id,i=e;if(!n)throw new Error("No space id");const s=await P().callApi({eventName:"loadUniversalObject",environment:this.environment,data:{type:"sharepoint",url:i,aiSessionId:this.sessionId,spaceId:n}});if("success"!==s.type)throw s.error;return{sharepointContent:s.data}}async loadWebPage(e){var t;const n=null===(t=(0,a().S)())||void 0===t?void 0:t.id,i=e;if(!n)throw new Error("No space id");const s=await P().callApi({eventName:"loadUniversalObject",environment:this.environment,data:{type:"web",url:i,aiSessionId:this.sessionId,spaceId:n}});if("success"!==s.type)throw s.error;return{AssistantWebpageSearchResult:s.data}}loadPdf(e){return Promise.resolve({pdfContent:{textContent:[],fileKey:""}})}async search(e){return this.performSearch(e,!0)}async performSearch(e,t){var n,a;const i=null===(n=(0,R().fM)(this.environment))||void 0===n?void 0:n.id;if(!i)throw new Error("No space id");const{assistantConfigurationStore:s}=N().default.getSessionContextOrThrow(this.sessionId),o=this.getAssistantConfigurationState(),r=null==s?void 0:s.getSearchMode(),l=o.searchScope;if(o.sampling)return{searchResults:[],scope:l};const c={question:e.question,keywords:e.keywords,...e.lookback&&{lookback:e.lookback},...e.questionIntl&&{questionIntl:e.questionIntl},...e.channel&&{channel:e.channel},...e.sort&&{sort:e.sort},...e.fileType&&{filterType:e.fileType},...e.sourcePreference&&{sourcePreference:e.sourcePreference},...e.database&&{database:e.database},scope:o.searchScope};if(this.assistantEvaluatorStateCallbacks.appendAssistantSearchClientStep(c),!t)return{searchResults:[],scope:l};const d=null===(a=o.searchCache.get(c))||void 0===a?void 0:a[r];if(d){const e=await d,t=e.results.map((e=>e.id));return t.length>0&&this.assistantEvaluatorStateCallbacks.appendSearchResultsTemporaryClientStep({searchResults:t,pageIds:e.response.data.results.filter((e=>"page"===e.type)).map((e=>e.id))}),{searchResults:e.results,systemMessages:e.response.data.additionalMessagesToModel,scope:l}}this.maybeLaunchBackgroundSearch({searchArgs:c,spaceId:i});const u=this.measureApi("search",(()=>this.executeAssistantSearch({searchMode:r,searchArgs:c,spaceId:i})));o.searchCache.set(c,{...o.searchCache.get(c),[r]:u});const p=await u;return{searchResults:p.results,systemMessages:p.response.data.additionalMessagesToModel,scope:l}}async executeAssistantSearch(e){const{searchMode:t}=e;let n;"default"===t?n=this.executeDefaultAssistantSearch({...e}).then():"firstResult"===t?n=this.executeAssistantSearchFirstNResultsOnly({...e,N:1}):"firstTwoResults"===t?n=this.executeAssistantSearchFirstNResultsOnly({...e,N:2}):(0,B().Bg)(t)||(0,B().Wo)(t)?n=this.executeDefaultAssistantSearch({...e,searchDebugOverrides:B().BG[t]}):(0,c().HB)(t);const a=await n;return this.handleSearchResponse({response:a,dontStreamResults:e.dontStreamResults})}async executeDefaultAssistantSearch(e){const{searchArgs:t,spaceId:a}=e,i=(0,n(68465).cJ)(),s=(0,n(933528).yh)(t),o=await P().callApi({eventName:"performAiSearch",environment:this.environment,data:{...t,spaceId:a,aiSessionId:this.sessionId,source:"assistant",searchDebugOverrides:e.searchDebugOverrides,sourceSpecificOptions:s,...i&&"everything"===t.scope.type?{scope:{type:"labeler"}}:void 0,maybeNotionHelp:t.maybeNotionHelp}});if("success"!==o.type)throw o.error;return o}async executeAssistantSearchFirstNResultsOnly(e){const t=await this.executeDefaultAssistantSearch(e);return t.data.results=t.data.results.slice(0,e.N),t.data.blocksByPage=t.data.blocksByPage.filter((({pageId:e})=>t.data.results.find((t=>t.id===e)))),t}handleSearchResponse(e){const{response:t,dontStreamResults:a,shouldUseDeepFindBehavior:i}=e,s=this.getAssistantConfigurationState();for(const n of t.data.results){var o;const e=null===(o=t.data.searchDebugExtras)||void 0===o?void 0:o.hits.find((e=>e.pageId===n.pageId||e.pageId===n.id));s.searchDebugHits.set(n.id,{result:n,hit:e})}const r=t.data.results;return r.length>0&&!a&&((0,n(316581).nt)({searchResults:r,state:this}),i?this.assistantEvaluatorStateCallbacks.upsertOrReplaceSearchResultsTemporaryClientStep({searchResults:r.map((e=>e.id)),pageIds:r.filter((e=>"page"===e.type)).map((e=>e.id)),shouldReplaceInsteadOfUpsert:i.shouldReplaceInsteadOfUpsert}):this.assistantEvaluatorStateCallbacks.appendSearchResultsTemporaryClientStep({searchResults:r.map((e=>e.id)),pageIds:r.filter((e=>"page"===e.type)).map((e=>e.id))})),{results:r,response:t}}maybeLaunchBackgroundSearch(e){const{searchArgs:t,spaceId:a}=e,{assistantConfigurationStore:i}=N().default.getSessionContextOrThrow(this.sessionId),s=this.getAssistantConfigurationState(),o=null==i?void 0:i.getLaunchSilentSearchMode();if(!o)return;n(140022).trackQnASilentRetry(this.environment,{event:"silent_retry_triggered",sessionId:this.sessionId});const r=this.executeAssistantSearch({searchMode:o,searchArgs:t,spaceId:a,dontStreamResults:!0});s.searchCache.set(t,{...s.searchCache.get(t),[o]:r})}async performQueryDatabase(e,t){const a=(0,V().getParentRecordStoreOrThrow)();if(!a)throw new Error("No current block store");const{collectionPointer:i,filter:s,sort:o,limit:r,aggregation:l}=await(0,w().l4)({assistantDatabaseQuery:e,spaceId:a.getSpaceId(),loadRecordModel:a.loadRecordModel});if(this.assistantEvaluatorStateCallbacks.appendQueryingDatabaseClientStep(i),!t)return{results:[],total:0,dependentAssistantNodes:[]};const c=await n(634054).mA(this.environment,{source:"assistant",parentRecordStore:a,collectionPointer:i,filter:s,sort:o,limit:r,aggregations:{total:{aggregator:"count"},...l&&{aggregation:l}}});if(n(973647).Q.isFail(c))throw c.error;return this.handleQueryDatabaseResponse(e,c.value)}async handleQueryDatabaseResponse(e,t){const{inMemoryRecordCache:a}=this.environment.defaultRecordCache,s=(0,V().getParentRecordStoreOrThrow)();if(!s)throw new Error("No current block store");const{collectionViewBlockPointer:r,collectionPointer:l,filter:d,sort:p}=await(0,w().l4)({assistantDatabaseQuery:e,spaceId:s.getSpaceId(),loadRecordModel:s.loadRecordModel});let g;if(F().zD.isEphemeralViewDatabaseQueryingEnabled()){const i=void 0===d.filters||0===d.filters.length?{operator:"or",filters:(0,V().getFiltersFromBlockIds)({blockIds:t.blockIds,parentRecordStore:s})}:d,r=o().m.createChildStore(s,l).getParentBlockStore();if(!r)throw new Error("No parent for collection store");const c=r.getCollectionViewStores();if(0===c.length)throw new Error("No collection view stores");const m=c[0];await r.load(),await(0,n(150984).upsertStepToChatSessionHistory)({environment:this.environment,sessionId:(0,n(925193).pg)(this.sessionId),assistantSurfaceType:"corner"});const{performResult:{collectionViewStore:h,linkedDatabaseCollectionBlockStore:f}}=n(547149).createAndCommit({userAction:"completionActions.createUnlistedView",environment:this.environment,canUndo:!0,perform:t=>{var n,s;return W({assistantChatSessionId:this.sessionId,environment:this.environment,parentCollectionViewBlockStore:r,inMemoryRecordCache:a,collectionViewStore:m,transaction:t,filter:i,sort:p,semanticQuery:void 0===d.filters||0===d.filters.length?(null===(n=e.search)||void 0===n?void 0:n.questionIntl)??(null===(s=e.search)||void 0===s?void 0:s.question):void 0})}});g={collectionViewId:h.id,collectionViewBlockId:f.id,assistantQueryDatabaseResultId:(0,u().aL)(e)}}this.assistantEvaluatorStateCallbacks.appendQueryDatabaseClientStep({collectionPointer:l,query:e,ephemeralViewData:g,resultBlockIds:t.blockIds});const m=(await(0,_().lX)(t.blockIds,10,(e=>(0,C().Xp)({pointer:{table:j().ev,id:e},rootPointer:s.pointer,parentPointer:r,loadRecordModel:s.loadRecordModel,intl:i().A.getIntl(),currentTimeZone:(0,A().P)(),spaceId:s.getSpaceId()})))).filter(c().O9),h=[],f=r.id;let y;this.doesBlockIdMapHaveBlock(f)?y=this.getBlockFromBlockIdMap(f):(y=await(0,C().Xp)({pointer:r,parentPointer:void 0,rootPointer:s.pointer,spaceId:s.getSpaceId(),loadRecordModel:s.loadRecordModel,intl:i().A.getIntl(),currentTimeZone:(0,A().P)()}),y&&h.push(y)),y&&m.forEach((e=>e.parent=y));const v=(0,n(510818).MJ)(m);for(const n of v)h.push(await(0,C().BM)({collectionPointer:{table:M().Vl,id:n,spaceId:s.getSpaceId()},loadRecordModel:T().h0Y.fromLoadRecordValueFn(s.loadRecordValue),intl:i().A.getIntl(),currentTimeZone:(0,A().P)()}));return{results:m,total:t.total,dependentAssistantNodes:h}}chat(e){const{blockIds:t,operations:n,uncited:a}=e;this.assistantEvaluatorStateCallbacks.appendAssistantChatClientStep({mappedBlockIds:t,mappedOperations:n,uncited:a})}chatMd(e){this.assistantEvaluatorStateCallbacks.appendAssistantChatMdClientStep(e)}async searchDatabases(e){const t=(0,R().fM)(this.environment);if(!t)return{results:[],total:0};return this.getAssistantConfigurationState().sampling?{results:[],total:0}:await this.measureApi("search_databases",(()=>this.searchDatabasesImpl(e,t)))}async searchDatabasesImpl(e,t){this.assistantEvaluatorStateCallbacks.appendAssistantSearchDatabasesClientStep(e);const n=await E().T.searchActions.load(),a=await n.searchCollections(this.environment,{query:e,limit:r().Yf,source:"assistant_search_databases",spaceStore:t,searchSessionId:void 0,peopleBlocksToInclude:"none"}),s=(0,V().getParentRecordStoreOrThrow)(),{results:l,total:c}=a,u=l.map((e=>o().m.createChildStore(s,{table:"collection",id:e})));await(0,_().lX)(u,25,(e=>e.load()));return{results:l.map((e=>{var t;const n=u.find((t=>t.id===e));if(!n)throw new Error("Collection store not found");return{type:"search-databases-result",parentId:n.getParentId(),id:n.id,title:(null===(t=n.getModel())||void 0===t?void 0:t.getRenderTitle({getRecordModel:n.getRecordModel,userTimeZone:(0,d().dB)(),intl:i().A.getIntl()}))??""}})),total:c}}async searchPeople(e){if(this.getAssistantConfigurationState().sampling)return{results:[],total:0};this.assistantEvaluatorStateCallbacks.appendAssistantSearchPeopleClientStep(e);const t=await E().T.searchActions.load(),a=await this.measureApi("search_people",(()=>t.searchSpaceUsers({environment:this.environment,query:e,membersOnly:!1,limit:n(33642).YL})));return{results:a.map((e=>({id:e.id,name:e.name||"",email:e.email}))),total:a.length}}async*streamInference(e,t){var a,i;const s=l().mg(e),o=(0,R().fM)(this.environment);if(!o)throw new Error("No current space.");const r=o.getMemberCountFromPublicSpaceData()??1,c=this.environment,d=N().default.getSessionContextOrThrow(this.sessionId).selectedSkillFromStoreState,u=F().zD.getNamespace();let p;p=F().zD.isXMLAssistantEnabled()?"xml_finetuned":"labeling";const g="prompt_only_top_level"===u?(0,n(596635).f)(e):u,{promptArgs:m,model:h,outputPostProcessingConfig:f}=k({assistantOutputMode:p,selectedSkillType:null==d?void 0:d.clientSkill.skillType,transcript:s,currentTaskType:null===(a=L().c.state)||void 0===a?void 0:a.name,modelOverride:(0,n(101927).DE)(c),shouldRewriteNamesInQuery:r>1&&!n(242422).default.checkGate({gateName:"experimental-cohere-only-for-personal-workspace"}),namespace:g}),y={id:t,aiSessionId:this.sessionId,context:m,model:h,spaceId:o.id,isSpacePermission:!1,temperature:null===(i=L().c.state)||void 0===i?void 0:i.temperatureOverride,metadata:{},attributionForLogging:void 0,inferenceReason:"assistant"},v=n(726637).A.isDevelopingInAirplaneMode?n(556122).QJ:P().callStreamApi,S=await v({eventName:"getCompletion",environment:c,data:y,headers:(0,n(785728).WS)({spaceId:o.id})});if("success"!==S.type)return n(792057).Qg(S),{type:"error_modal_shown"};let b,x=!1;if(n(532659).hS.is(S.data)){for await(const t of S.data)if("success"===t.type)if(x)yield t.completion;else{const e=t.completion.trim();if(""===e)continue;if("prepend_human_chat_prefix"!==f.type||e.startsWith("<"))"prepend_custom_prefix"===f.type?(b=f.prefix,yield`${b}${t.completion}`):yield t.completion;else{b=`<${(0,V().getHumanChatTag)()}><text>`;const e=t.completion;yield`${b}${e}`}x=!0}else if("error"===t.type){if(n(441738).Nf(t.errorCode)){var I;const e=null===(I=(0,R().fM)(c))||void 0===I?void 0:I.id;return void(e&&await D().maybeUpdateAiEligibility(c,e))}throw(0,D().showCompletionErrorWithCode)(t.errorCode),new O(t.errorCode,t.message)}const e=(0,V().getHumanChatTag)();b===`<${e}><text>`&&(yield`</text></${e}>`)}}getSessionContext(){return N().default.getSessionContextOrThrow(this.sessionId)}getAssistantConfigurationState(){const{assistantConfigurationStore:e}=this.getSessionContext();return e.state}}const H=U},817865:(e,t,n)=>{n.d(t,{A:()=>pe});var a=n(296540),i=()=>n(782482),s=()=>n(726637),o=()=>n(590526),r=()=>n(127833),l=()=>n(30537),c=()=>n(807449),d=()=>n(631524),u=()=>n(160432),p=()=>n(81068),g=()=>n(736847),m=()=>n(42583),h=()=>n(381553),f=()=>n(69708),y=()=>n(100622),v=()=>n(534177),S=()=>n(30731),b=()=>n(56394),x=()=>n(484714),I=()=>n(245720),k=()=>n(546926),w=()=>n(604995),C=()=>n(416504),A=()=>n(574036),T=()=>n(474962),j=()=>n(117586),M=()=>n(340347),_=()=>n(870068),P=()=>n(746031),D=()=>n(31511),E=()=>n(498140),R=()=>n(582094),B=n(474848);const F=(0,f().YK)({invalidDateError:{id:"dateInputError.invalidDateError.tooltip",defaultMessage:"Invalid date"},invalidDateRangeError:{id:"dateInputError.invalidDateRangeError.tooltip",defaultMessage:"Invalid range"},notSupportedDateRangeError:{id:"dateInputError.notSupportedDateRangeError.tooltip",defaultMessage:"The date is not supported"}});const N=function(e){const t=(0,f().tz)(),i=(0,o().uB)(void 0,R().A),{value:s,customErrorMessage:r}=e;(0,a.useEffect)((()=>{i.reset()}),[s,i]);const l=(0,a.useCallback)((()=>(0,B.jsx)(q,{dateTimeInputMenuItemProps:e,store:i})),[e,i]),c=(0,o().K8)((()=>V(t,i,r)),[t,i,r]);return c?(0,B.jsx)(n(26697).m,{renderTooltip:()=>c,forceVisibleState:!0,placement:"left",render:l,originGap:-8}):(0,B.jsx)(q,{dateTimeInputMenuItemProps:e,store:i})};function L(e,t){return!!s().A.isMobile||!t}function O(){return{inputDefault:{background:y().Tj.inputBackground,boxShadow:y().Tj.inputBoxShadow},inputFocused:{boxShadow:y().Tj.inputBlueFocusRing},inputError:{boxShadow:y().Tj.inputRedFocusRing},placeholder:{color:y().Tj.text.tertiary}}}function V(e,t,n){if(!t.state.error)return;const a=n&&n(t.state.error);if(a)return a;switch(t.state.error){case R().$.INVALID_DATE:return e.formatMessage(F.invalidDateError);case R().$.INVALID_RANGE:return e.formatMessage(F.invalidDateRangeError);case R().$.NOT_SUPPORTED:return e.formatMessage(F.notSupportedDateRangeError);default:(0,v().HB)(t.state.error)}}function z(e,t,n,a,i,s){const o=function(e,t,n,a,i){if(!n.state.dateEdited&&!n.state.timeEdited)return;if(!n.state.temporaryValue.date&&!n.state.temporaryValue.time)return{value:void 0};const s=(0,E().J8)(n.state.temporaryValue.date||"",t);if(s){let t="";return t=a?(null==e?void 0:e.start_time)||"00:00":i?"23:59":"00:00",{value:{type:"datetime",start_date:s,time_zone:(null==e?void 0:e.time_zone)||(0,C().P)(),start_time:t}}}const o=(0,E().KZ)(n.state.temporaryValue.time||"",t);return(null!=e&&e.start_date||s)&&o?{value:{type:"datetime",start_date:(null==e?void 0:e.start_date)||s,start_time:o,time_zone:(null==e?void 0:e.time_zone)||(0,C().P)()}}:{error:R().$.INVALID_DATE}}(e,t,n,i,s);if(o)return a?a(o):o}function W(e){const{disabled:t,focus:n,intl:a,store:i,customErrorMessage:s}=e,o=O(),r=V(a,i,s);if(!t)return r?o.inputError:n?o.inputFocused:o.inputDefault}function U(e,t,n,a,i,o,r,l,c,d){const u=function(e,t){return{menuItem:{marginBottom:s().A.isMobile?1:12},inputWrapper:{borderRadius:6,height:28,paddingInlineEnd:L(0,t)?6:0,position:"relative"},inputEditRegion:{width:L(0,t)?"calc(100% - 14px)":"100%"},inputEditRegionMobile:{padding:"2px 6px",position:"relative"}}}(0,c);return{style:{...u.menuItem,...a},inputOuterStyle:{...u.inputWrapper,...n,...W({disabled:i,focus:o,intl:r,store:l,customErrorMessage:d})},inputStyle:{...u.inputEditRegion,...s().A.isMobile&&u.inputEditRegionMobile,...t}}}function H(e,t,n,a,i,s,o,r,l,c){let d;(!r||"date"===t&&null!=i&&i.start_time||"time"===t&&null!=i&&i.start_date)&&(d=z(i,s,o,l,r,c),d&&(n(d),d.error?o.setState({...o.state,dateEdited:!1,error:d.error}):o.reset())),a&&a(e,d)}function K(e,t,n,a,i,s,o,r,l){const c=z(t,n,a,s,o,r);c?(e(c),c.error?a.setState({...a.state,dateEdited:!1,timeEdited:!1,error:c.error}):a.reset()):a.setState({...a.state,dateEdited:!1,timeEdited:!1}),l&&i&&i(l)}function q({dateTimeInputMenuItemProps:e,store:t}){const{store:n,hideClearButton:i,focus:r,showTime:l,placeholder:c,customErrorMessage:d,...u}=e,{onBlur:p,onClear:g,onDateFocus:m,onSubmit:h,onTimeFocus:v,onUpdate:b,isEndingDate:I,inputStyle:k,inputOuterStyle:w,style:C,disabled:A,validate:T,value:j}=e,M=(0,f().tz)(),_=(0,x().v3)(),P=(0,a.useCallback)((e=>function(e,t,n,a,i,s,o,r,l,c){const{device:d}=t;s.setState({...s.state,timeEdited:!0,temporaryValue:{...s.state.temporaryValue,time:e.target.value||""}}),d.isAndroid&&K(n,a,i,s,o,r,l,c)}(e,_,b,j,M,t,p,T,l,I)),[_,b,j,M,t,p,T,l,I]),E=(0,a.useCallback)((e=>function(e,t,n){t.setState({...t.state,timeEdited:!1}),n&&n(e)}(e,t,v)),[t,v]),R=(0,a.useCallback)((()=>function(e,t,n,a,i,s,o,r){a.setState({...a.state,dateEdited:!0,timeEdited:!0,temporaryValue:{date:void 0,time:void 0},error:void 0});const l=z(t,n,a,s,o,r);l&&e(l),a.setState({...a.state,dateEdited:!1,timeEdited:!1}),i&&i()}(b,j,M,t,g,T,l,I)),[b,j,M,t,g,T,l,I]),F=(0,a.useCallback)((e=>K(b,j,M,t,p,T,l,I)),[b,j,M,t,p,T,l,I]),N=(0,a.useCallback)((e=>function(e,t,n,a,i,s,o,r,l,c){const{device:d}=t;s.setState({...s.state,dateEdited:!0,temporaryValue:{...s.state.temporaryValue,date:e.target.value||""}}),d.isAndroid&&K(n,a,i,s,o,r,l,c)}(e,_,b,j,M,t,p,T,l,I)),[_,b,j,M,t,p,T,l,I]),O=(0,a.useCallback)((e=>function(e,t,n){t.setState({...t.state,dateEdited:!1}),n&&n(e)}(e,t,m)),[t,m]),V=s().A.isMobile?"date":"text",W=s().A.isMobile?"time":"text",q="transparent",G=s().A.isMobile?void 0:r,Y=(0,o().K8)((()=>U(0,k,w,C,A,G,M,t,i,d).inputOuterStyle),[_,k,w,C,A,G,M,t,i,d]),Q={display:"flex",alignItems:"center",lineHeight:2,background:y().Tj.inputBackground,paddingLeft:8,flexBasis:"50%",...Y},J=(0,o().K8)((()=>function(e,t,n,a){return s().A.isMobile?t?S().Tq(t,n):"":a.state.temporaryValue.date?a.state.temporaryValue.date:a.state.dateEdited?a.state.temporaryValue.date||"":t?S().Tq(t,n):""}(0,j,M,t)),[_,j,M,t]),X=(0,o().K8)((()=>function(e,t,n,a){return s().A.isMobile?t?S().Em(t,n):"":a.state.temporaryValue.time?a.state.temporaryValue.time:a.state.timeEdited?a.state.temporaryValue.time||"":t?S().Em(t,n):""}(0,j,M,t)),[_,j,M,t]);return(0,B.jsxs)("div",{style:Q,children:[(0,B.jsx)(D().A,{...u,type:V,format:q,placeholder:c,focus:"date"===G,onFocus:O,onChange:N,onSubmit:e=>H(e,"date",b,h,j,M,t,l,T,I),onBlur:F,value:J,size:1,style:{fontSize:s().A.isMobile?16:14},showClearButton:!l&&L(0,i),onClearButtonClick:R}),l?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("div",{style:{height:14,width:1,background:y().Tj.border.secondaryTranslucent,marginInlineStart:6,marginInlineEnd:12,flexShrink:0}}),(0,B.jsx)(D().A,{...u,placeholder:M.formatMessage($.timePlaceholder),type:W,format:q,focus:"time"===G,onFocus:E,onChange:P,onSubmit:e=>H(e,"time",b,h,j,M,t,l,T,I),onBlur:F,value:X,size:1,style:{fontSize:s().A.isMobile?16:14},showClearButton:L(0,i),onClearButtonClick:R})]}):void 0]})}const $=(0,f().YK)({startingDateMessage:{defaultMessage:"Starting",id:"auditLog.dateTimeRangeMenu.startingDatePlaceholder"},endingDateMessage:{defaultMessage:"Ending",id:"auditLog.dateTimeRangeMenu.endingDatePlaceholder"},timePlaceholder:{defaultMessage:"12:00 AM",id:"auditLog.dateTimeRangeMenu.timePlaceholderInNumber"}});const G=function({title:e,value:t,onUpdate:a,onDismiss:i,disabled:r,footer:l,header:c,hideTime:d,showTime:u,store:p,dayRangeStore:g,minDate:m,maxDate:h,customErrorMessage:f}){const y=(0,x().v3)(),v=(0,o().uB)(g,T().A),S=(0,o().uB)(p,_().Ay);return(0,n(852507).l)((()=>{void 0!==u&&S.setState({...S.state,showTime:u})})),(0,B.jsx)(n(890492).A,{...se(y,e,t,a,S,v,i,r,l,m,h),children:(0,B.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,B.jsxs)("div",{children:[c,s().A.isMobile?void 0:(0,B.jsx)(ie,{value:t,disabled:r,onUpdate:a,store:S,dayRangeStore:v,minDate:m,maxDate:h,customErrorMessage:f}),(0,B.jsx)(Z,{value:t,onUpdate:a,store:S,dayRangeStore:v,minDate:m,maxDate:h})]}),(0,B.jsx)(ae,{onUpdate:a,value:t,hideTime:d,store:S,dayRangeStore:v})]})})};function Y(e){const{field:t,parsed:n,value:a,minValue:i,maxValue:s}=e;return n.error?n:function(e){const{range:t,minValue:n,maxValue:a}=e,i=t.starting?w().C6.notionDateTimeToLuxon(t.starting):void 0,s=t.ending?w().C6.notionDateTimeToLuxon(t.ending):void 0;if(i&&s&&s<i)return{error:M().$.INVALID_RANGE};const o=e=>(0,v().O9)(n)&&(0,v().O9)(e)&&e<n,r=e=>(0,v().O9)(a)&&(0,v().O9)(e)&&e>a;return o(i)||o(s)||r(i)||r(s)?{error:M().$.NOT_SUPPORTED}:{value:t}}({range:{...a,[t]:n.value},minValue:i,maxValue:s})}function Q(e){const{field:t,parsed:n,value:a,minValue:i,maxValue:s}=e;if(n.error)return n;return function(e){const{range:t,minValue:n,maxValue:a}=e,i=t.starting?w().C6.notionDateToLuxon(t.starting):void 0,s=t.ending?w().C6.notionDateToLuxon(t.ending):void 0;if(i&&s&&s<i)return{error:M().$.INVALID_RANGE};const o=e=>n&&e&&e<n,r=e=>a&&e&&e>a;return o(i)||o(s)||r(i)||r(s)?{error:M().$.NOT_SUPPORTED}:{value:t}}({range:{...S().BI(a),[t]:n.value},minValue:i,maxValue:s})}function J(){return{pickerSectionMobile:{background:y().Tj.popoverBackground,boxShadow:`0 1px 0 ${y().Tj.border.secondaryTranslucent}`,marginBottom:1}}}function X(){return{pickerSection:{paddingInlineStart:16,paddingInlineEnd:16},pickerSectionMobile:{paddingTop:16,paddingBottom:8},sidebar:{paddingTop:12,paddingBottom:24,overflowY:"auto",overflowX:"hidden",flex:"0 0 220px",backgroundColor:y().Tj.sidebarSecondaryBackground,borderInlineStart:`1px solid ${y().Tj.border.secondaryTranslucent}`,maxWidth:"fit-content"},menuItem:{minHeight:void 0,paddingTop:s().A.isMobile?12:4,paddingBottom:s().A.isMobile?12:4,color:y().Tj.text.secondary}}}function Z({value:e,onUpdate:t,store:n,dayRangeStore:a,minDate:i,maxDate:r}){const l=(0,o().uB)(a,T().A),c=(0,o().uB)(n,_().Ay),d=X(),u=J(),p={...d.pickerSection,...s().A.isMobile&&d.pickerSectionMobile,...s().A.isMobile&&u.pickerSectionMobile};return(0,B.jsx)(g().A,{children:(0,B.jsx)("div",{style:p,children:(0,B.jsx)(P().A,{value:S().BI(e),dateTimeStore:c,store:l,onUpdate:n=>{if(n.error)return null;const a=S().y2(e,n.value);return t({error:n.error,value:a})},minDate:i,maxDate:r,validate:(t,n)=>Q({field:t,parsed:n,value:e,minValue:i,maxValue:r})})})})}function ee(e,t,n){t.setState({...t.state,focus:e});const a=_().yL[e];n.setState({...n.state,focus:a})}function te(e,t){t.setState({...t.state,focus:e})}function ne(e,t,n){e.ending&&ee(j().xQ.EndDate,t,n),t.setState({...t.state,temporaryDateRange:e}),n.setState({...n.state,displayMonth:e.starting||e.ending?w().mF(e.starting||e.ending):void 0,temporaryDateRange:{starting:S().qC(e.starting),ending:S().qC(e.ending)}})}function ae({onUpdate:e,value:t,hideTime:n,store:a,dayRangeStore:i}){const s=(0,o().K8)((()=>a.state.showTime),[a]);return(0,B.jsxs)("aside",{style:X().sidebar,children:[n?null:(0,B.jsx)(A().A,{title:(0,B.jsx)(f().sA,{id:"auditlogDateFilter.timeToggle",defaultMessage:"Use time"}),on:s,onClick:()=>{if(a.toggleShowTime(),a.state.showTime){const n=t;n.starting&&(n.starting.start_time="00:00"),n.ending&&(n.ending.start_time="23:59"),e({value:n})}},focused:!1}),(0,B.jsx)(p().A,{focused:!1,title:(0,B.jsx)(f().sA,{id:"auditlogDateFilter.quickFilters.today",defaultMessage:"Today"}),onClick:()=>{const e=Date.now(),t=w().KQ(e,(0,C().P)());ne({starting:{...t,start_time:"00:00"},ending:t},a,i)},style:X().menuItem}),(0,B.jsx)(p().A,{focused:!1,title:(0,B.jsx)(f().sA,{id:"auditlogDateFilter.quickFilters.yesterday",defaultMessage:"Yesterday"}),onClick:()=>{const e=w().jI((0,C().P)());ne({starting:{type:"datetime",start_date:e.start_date,start_time:"00:00",time_zone:(0,C().P)()},ending:{type:"datetime",start_date:e.start_date,start_time:"23:59",time_zone:(0,C().P)()}},a,i)},style:X().menuItem}),(0,B.jsx)(p().A,{focused:!1,title:(0,B.jsx)(f().sA,{id:"auditlogDateFilter.quickFilters.lastWeek",defaultMessage:"Last 7 days"}),onClick:()=>{const e=w().t0((0,C().P)()),t=w().KQ(Date.now(),(0,C().P)());ne({starting:{type:"datetime",start_date:e.start_date,start_time:"00:00",time_zone:(0,C().P)()},ending:t},a,i)},style:X().menuItem}),(0,B.jsx)(p().A,{focused:!1,title:(0,B.jsx)(f().sA,{id:"auditlogDateFilter.quickFilters.lastMonth",defaultMessage:"Last 30 days"}),onClick:()=>{const e=w().ZG((0,C().P)()),t=w().KQ(Date.now(),(0,C().P)());ne({starting:{type:"datetime",start_date:e.start_date,start_time:"00:00",time_zone:(0,C().P)()},ending:t},a,i)},style:X().menuItem})]})}function ie({value:e,disabled:t,onUpdate:n,store:a,dayRangeStore:i,minDate:r,maxDate:l,customErrorMessage:c}){const d=(0,f().tz)(),u=(0,x().v3)(),{WindowSizeStore:p}=u,g=(0,o().K8)((()=>a.getFocus()),[a]);let m="date";g!==j().xQ.StartTime&&g!==j().xQ.EndTime||(m="time");const h=function(e,t){return{earliestValidEnding:e.starting&&S().r6(e.starting,t),latestValidStarting:e.ending&&S().r6(e.ending,t)}}(e,d),v=(0,o().K8)((()=>a.state.showTime),[a]),b=(0,o().K8)((()=>p.getSafePaddingLeftCSS(16)),[p]);return(0,B.jsxs)("div",{style:{paddingTop:s().A.isMobile?16:12,paddingBottom:s().A.isMobile?16:8,paddingInlineStart:s().A.isMobile?b:14,paddingInlineEnd:s().A.isMobile?b:14,display:v?"block":"flex",...s().A.isMobile&&{boxShadow:`\n                        0 1px 0 ${y().Tj.border.secondaryTranslucent}\n                    `,position:"relative",zIndex:2},background:s().A.isMobile?y().Tj.popoverBackground:void 0},children:[(0,B.jsx)(N,{disabled:t,placeholder:d.formatMessage($.startingDateMessage),focus:g===j().xQ.StartDate||g===j().xQ.StartTime?m:void 0,value:e.starting,validate:t=>function(e){const{parsed:t,value:n,minValue:a,maxValue:i}=e,s=Y({field:"starting",parsed:t,value:n,minValue:a,maxValue:i});return s.error?s:{value:s.value.starting}}({parsed:t,value:e,minValue:r,maxValue:l}),customErrorMessage:c,onUpdate:t=>function(e,t,n){e.error||t({value:{...n,starting:e.value}})}(t,n,e),onDateFocus:()=>ee(j().xQ.StartDate,a,i),onTimeFocus:()=>te(j().xQ.StartTime,a),onSubmit:(e,t)=>function(e,t,n,a,i){t&&t.error||(n===j().xQ.StartDate&&a.state.showTime?a.setState({...a.state,focus:j().xQ.StartTime}):(a.setState({...a.state,focus:j().xQ.EndDate}),i.setState({...i.state,focus:"ending"})))}(0,t,g,a,i),inputElementAttributes:{max:h.latestValidStarting},showTime:v}),(0,B.jsx)("div",{style:{width:12,height:8}}),(0,B.jsx)(N,{disabled:t,placeholder:d.formatMessage($.endingDateMessage),focus:g===j().xQ.EndDate||g===j().xQ.EndTime?m:void 0,value:e.ending,validate:t=>function(e){const{parsed:t,value:n,minValue:a,maxValue:i}=e,s=Y({field:"ending",parsed:t,value:n,minValue:a,maxValue:i});return s.error?s:{value:s.value.ending}}({parsed:t,value:e,minValue:r,maxValue:l}),customErrorMessage:c,onUpdate:t=>function(e,t,n){e.error||t({value:{...n,ending:e.value}})}(t,n,e),onDateFocus:()=>ee(j().xQ.EndDate,a,i),onTimeFocus:()=>te(j().xQ.EndTime,a),onSubmit:(e,t)=>function(e,t,n,a){t&&t.error||n===j().xQ.EndDate&&a.state.showTime&&a.setState({...a.state,focus:j().xQ.EndTime})}(0,t,g,a),inputElementAttributes:{min:h.earliestValidEnding},showTime:v})]})}function se(e,t,n,a,i,o,r,l,c,d,u){if(s().A.isMobile){return{menuType:k().gu.Modal,title:t,right:(0,B.jsx)(f().sA,{...I().W.done}),onClickRight:r,header:(0,B.jsx)(ie,{value:n,disabled:l,onUpdate:a,store:i,dayRangeStore:o,minDate:d,maxDate:u})}}return{menuType:k().gu.Popup,onClickOutside:r,footer:c}}var oe=()=>n(602667),re=()=>n(220818),le=()=>n(322976),ce=()=>n(976361),de=()=>n(385226),ue=()=>n(297401);function pe({onChange:e,onMenuDismiss:t,showButtons:n,title:i,header:r,sidebar:l,hideTime:c,value:d,disabled:u,icon:p,mode:g,focused:m,pillTitle:h,minDate:f,maxDate:y,customErrorMessage:v}){const S=(0,o().uB)(void 0,T().A),b=(0,o().uB)(void 0,_().Ay);return(0,a.useEffect)((()=>{Se({value:d},b,S)}),[d,b,S]),s().A.isMobile?(0,B.jsx)(je,{onChange:e,onMenuDismiss:t,showButtons:n,title:i,header:r,sidebar:l,hideTime:c,value:d,disabled:u,icon:p,store:b,dayRangeStore:S,mode:g,minDate:f,maxDate:y,customErrorMessage:v}):(0,B.jsx)(Te,{onChange:e,onMenuDismiss:t,showButtons:n,title:i,header:r,sidebar:l,hideTime:c,value:d,disabled:u,focused:m,icon:p,mode:g,pillTitle:h,store:b,dayRangeStore:S,minDate:f,maxDate:y,customErrorMessage:v})}function ge(){return{buttonMenuItem:{color:y().Tj.text.secondary},activeMenuItem:{color:y().Tj.text.primary}}}function me(e){e.preventDefault&&e.preventDefault()}function he(e){e({starting:void 0,ending:void 0})}function fe(){return{menuItem:{minHeight:void 0,paddingTop:s().A.isMobile?12:4,paddingBottom:s().A.isMobile?12:4},icon:{marginInlineEnd:6},iconActiveDesktop:{height:14,width:14,fill:"currentColor",alignSelf:"flex-start",marginTop:2,marginInlineEnd:2},iconActiveDesktopWrapper:{marginTop:0},iconActiveMobile:{marginTop:1,marginInlineEnd:6},popup:{paddingTop:0,paddingBottom:8},popupWithSidebar:{display:"flex"},menuItemTitleDesktop:{width:"100%"},summary:{display:"inline-flex"}}}function ye(e,t,n){n||(e.setState({...e.state,isOpen:!0,focus:j().xQ.StartDate}),t.setState({...t.state,isOpen:!0,focus:"starting"}))}function ve(e,t,n,a,i,s){const{temporaryDateRange:o}=n.state;(0,oe().a)(e)||(s||t(o),n.setState({...n.state,isOpen:!1,temporaryDateRange:{starting:void 0,ending:void 0}}),a.setState({...a.state,isOpen:!1,temporaryDateRange:{starting:void 0,ending:void 0}}),i&&i())}function Se(e,t,n){if(e.error)return;const a={starting:(0,S().qC)(e.value.starting),ending:(0,S().qC)(e.value.ending)};return n.setState({...n.state,temporaryDateRange:{...n.state.temporaryDateRange,...a}}),t.setState({...t.state,temporaryDateRange:{...t.state.temporaryDateRange,...e.value}})}function be({disabled:e,icon:t,title:n,store:i,dayRangeStore:s}){const o=(0,a.useCallback)((()=>ye(i,s,e)),[i,s,e]),r=fe();return(0,B.jsx)(p().A,{disabled:e,focused:!1,icon:(0,B.jsx)(c().I,{icon:t,style:r.icon}),title:n,onClick:o})}function xe({disabled:e,title:t,value:n,intl:i,onChange:s,store:o,dayRangeStore:r}){const l=(0,a.useCallback)((()=>ye(o,r,e)),[o,r,e]),d=fe(),u=(0,B.jsxs)("div",{style:d.summary,children:[(0,B.jsx)(c().I,{icon:h().Y,size:"xs",style:d.iconActiveMobile}),(0,re().t)(n,i)]});return(0,B.jsx)(ce().A,{disabled:e,onClick:l,onClickClear:()=>he(s),label:t,title:u})}function Ie({disabled:e,value:t,focused:n,intl:i,onChange:s,store:o,dayRangeStore:r}){const l=(0,a.useCallback)((()=>ye(o,r,e)),[o,r,e]),d=fe(),u=ge(),g={...d.menuItem,...u.activeMenuItem},h=(0,re().t)(t,i),f=(0,B.jsx)(ue().A,{onClick:()=>he(s),disabled:e});return(0,B.jsx)(p().A,{focused:n,disabled:e,icon:(0,B.jsx)(c().I,{icon:m().D,style:d.iconActiveDesktop}),title:h,right:f,isTokenTitle:!0,alignIconTop:!0,onClick:l,desktopTitleStyle:d.menuItemTitleDesktop,desktopIconStyle:d.iconActiveDesktopWrapper,style:g})}function ke({disabled:e,title:t,icon:n,focused:i,mode:s,store:o,dayRangeStore:r}){const l=(0,a.useCallback)((()=>ye(o,r,e)),[o,r,e]),d=fe(),u=ge(),g={...d.menuItem,...u.buttonMenuItem,...s===le().C.Pill?{width:"fit-content",border:"solid 1px",paddingInlineStart:0,paddingInlineEnd:0,borderRadius:20,fontSize:12}:{}};return(0,B.jsx)(p().A,{focused:i,disabled:e,icon:(0,B.jsx)(c().I,{icon:n,style:d.icon}),title:t,onClick:l,style:g})}function we({disabled:e,value:t,pillTitle:n,store:i,dayRangeStore:s}){const o=(0,a.useCallback)((()=>ye(i,s,e)),[i,s,e]),r=(0,B.jsx)(f().sA,{id:"searchDateFilter.shortTitle",defaultMessage:"Date"});return(0,B.jsx)(b().A,{on:Boolean(t.starting||t.ending),icon:(0,B.jsx)(c().I,{icon:m().D}),title:(0,B.jsx)("span",{children:n||r}),onClick:o})}function Ce({onChange:e,onMenuDismiss:t,showButtons:n,store:a,dayRangeStore:i}){return(0,B.jsxs)(g().A,{topBorder:!0,style:{paddingTop:8,paddingInlineEnd:8,paddingBottom:2,paddingInlineStart:8,justifyContent:"space-between",display:"flex",flexDirection:"row"},children:[(0,B.jsx)(d().p,{onClick:()=>{a.clearTemporaryDateRange(),i.clearTemporaryDateRange(),e({starting:void 0,ending:void 0})},children:(0,B.jsx)(f().sA,{id:"searchDateFilter.clearButton",defaultMessage:"Clear"})}),(0,B.jsx)(u().A,{colorPalette:"blue",onClick:s=>{e(a.state.temporaryDateRange),ve(s,e,a,i,t,n)},children:(0,B.jsx)(f().sA,{id:"searchDateFilter.applyButton",defaultMessage:"Apply"})})]})}function Ae({onChange:e,onMenuDismiss:t,showButtons:n,title:i,header:s,sidebar:r,hideTime:l,value:c,store:p,dayRangeStore:g,minDate:m,maxDate:h,customErrorMessage:y}){const v=(0,a.useCallback)((a=>ve(a,e,p,g,t,n)),[e,p,g,t,n]),S=(0,a.useCallback)((e=>Se(e,p,g)),[p,g]),b=(0,o().K8)((()=>function(e,t){const{temporaryDateRange:n}=t.state;return{...e,...n}}(c,p)),[c,p]);return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(G,{title:i,value:b,onUpdate:S,store:p,dayRangeStore:g,onDismiss:v,footer:"footer"===n&&(0,B.jsx)(Ce,{onChange:e,onMenuDismiss:t,showButtons:n,store:p,dayRangeStore:g}),sidebar:r,hideTime:l,header:s,minDate:m,maxDate:h,customErrorMessage:y}),"side"===n?(0,B.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",padding:"0px 10px"},children:[(0,B.jsx)(d().p,{colorPalette:"gray",style:{marginInlineStart:"auto",marginInlineEnd:8},onClick:v,children:(0,B.jsx)(f().sA,{defaultMessage:"Cancel",id:"DateTimeFilter.cancelButton.label"})}),(0,B.jsx)(u().A,{colorPalette:"blue",onClick:()=>e(p.state.temporaryDateRange),children:(0,B.jsx)(f().sA,{defaultMessage:"Accept",id:"DateTimeFilter.acceptButton.label"})})]}):void 0]})}function Te({mode:e,onChange:t,onMenuDismiss:n,showButtons:c,title:d,header:u,sidebar:p,hideTime:g,value:m,disabled:h,focused:y,icon:S,pillTitle:b,store:x,dayRangeStore:I,minDate:k,maxDate:w,customErrorMessage:C}){const A=(0,f().tz)(),T=(0,a.useCallback)((e=>ve(e,t,x,I,n,c)),[t,x,I,n,c]),j=(0,a.useCallback)((()=>(0,B.jsx)(Ae,{onChange:t,onMenuDismiss:n,showButtons:c,title:d,header:u,sidebar:p,hideTime:g,value:m,store:x,dayRangeStore:I,minDate:k,maxDate:w,customErrorMessage:C})),[t,n,c,d,u,p,g,m,x,I,k,w,C]),M=fe(),_=e===le().C.Section,P=_?d:void 0,D=e===le().C.Section?(0,B.jsx)(Ie,{disabled:h,value:m,focused:y,intl:A,onChange:t,store:x,dayRangeStore:I}):e===le().C.Button?(0,B.jsx)(ke,{disabled:h,title:d,icon:S,focused:y,mode:e,store:x,dayRangeStore:I}):e===le().C.Pill?(0,B.jsx)(we,{disabled:h,value:m,pillTitle:b,store:x,dayRangeStore:I}):void(0,v().HB)(e),E=(0,o().K8)((()=>x.state.isOpen),[x]);return(0,B.jsx)(de().A,{title:P,marginAfter:_,children:(0,B.jsx)(i().N,{debugName:"DateTimeFilter",capture:E,onUp:me,onDown:me,onEnter:me,children:(0,B.jsx)(r().zD,{popupType:s().A.isMobile?l().n.SlideUp:l().n.Popup,open:E,origin:D,render:j,onDismiss:T,placementToOrigin:"bottom",alignmentToOrigin:"start",style:p?M.popupWithSidebar:M.popup,originGap:8,trapFocus:!0})})})}function je({mode:e,onChange:t,onMenuDismiss:n,showButtons:i,title:s,header:c,sidebar:d,hideTime:u,value:p,disabled:g,icon:m,store:h,dayRangeStore:y,minDate:v,maxDate:S,customErrorMessage:b}){const x=(0,f().tz)(),I=(0,a.useCallback)((e=>ve(e,t,h,y,n,i)),[t,h,y,n,i]),k=(0,a.useCallback)((()=>(0,B.jsx)(Ae,{onChange:t,onMenuDismiss:n,showButtons:i,title:s,header:c,sidebar:d,hideTime:u,value:p,store:h,dayRangeStore:y,minDate:v,maxDate:S,customErrorMessage:b})),[t,n,i,s,c,d,u,p,h,y,v,S,b]),w=(0,o().K8)((()=>h.state.isOpen),[h]),C=e===le().C.Section?(0,B.jsx)(xe,{disabled:g,title:s,value:p,intl:x,onChange:t,store:h,dayRangeStore:y}):(0,B.jsx)(be,{disabled:g,icon:m,title:s,store:h,dayRangeStore:y});return(0,B.jsx)(r().zD,{popupType:l().n.SlideUp,open:w,origin:C,render:k,onDismiss:I,preventScaleTransition:!0})}},822423:(e,t,n)=>{n.d(t,{u:()=>a});const a=(0,n(340498).xh)("globe",{default:{loader:()=>n.e(62396).then(n.bind(n,12193))},small:{loader:()=>n.e(62396).then(n.bind(n,101163))},fill:{loader:()=>n.e(62396).then(n.bind(n,805697))},fillSmall:{loader:()=>n.e(62396).then(n.bind(n,585288))}},["globe","world","earth","global","international"])},825836:(e,t,n)=>{n.d(t,{i:()=>f});n(16280),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(430670);var a=()=>n(295633),i=()=>n(943290),s=()=>n(691309),o=()=>n(925193),r=()=>n(696706),l=()=>n(179034),c=()=>n(798880),d=()=>n(534177),u=()=>n(516430),p=()=>n(547149),g=()=>n(483730),m=()=>n(371621),h=()=>n(358579);async function f(e){const{environment:t,sessionId:n,operationIds:f,operationContext:y}=e,v=t.currentUser.id;if(!v)throw new Error("No current user.");const S=g().default.getSessionContextOrThrow(n);S.caches.clear();const{evaluatorFromStoreState:b}=S,x=r().L3.isEqual(S.attributionActorFromStoreState,{id:v,table:c().oo});let I=S.uncommittedExecutableOperationsFromStoreState;if((0,d().O9)(f)){const e=new Set(f);I=I.filter((t=>e.has(t.id)))}const k=(0,i().iL)(I),w=I.flatMap((({operations:e})=>e)),C=`assistant-${(0,o().W7)("apply-uncommitted-")}`,{performResult:{editedPageIds:A}}=await p().createAndCommitAsync({environment:t,undoCheckpoint:C,waitForServerCommit:!1,perform:async e=>{for(const o of k){const n=(0,i().qT)([o]),r=I.filter((e=>n.includes(e.id))).flatMap((e=>e.operations)),c=(0,s().Nc)(r),d=new(a().B)(t,{id:o.pageId,table:l().ev});for(const i of c){const n=new(a().B)(t,{id:i,table:l().ev});u().kE({environment:t,transaction:e,blockStore:n,currentPageStore:d})}}const{editedPageIds:n}=await(0,m().y2)({environment:t,transaction:e,operations:w,operationContext:y});return{editedPageIds:n}},userAction:"assistantActions.applyUncommittedOperations",userId:v,...!x&&{skipUpdatingEditedMetadata:!0}}),T=b.state;if(A.size>0)for(const a of A)T.getLoadedPageIds().includes(a)||await b.loadPageWithoutAssistantStep(a);return S.addExecutableOperationsToExecutedOperationMap(I),S.clearUncommittedOperations({onlyClearOperationIds:f}),(0,h().Z)({environment:t,sessionContext:S}),{editGroupsThatWereApplied:k,undoCheckpointName:C}}},830010:(e,t,n)=>{n.r(t),n.d(t,{acceptEdits:()=>j,acceptPagesCreatedInCurrentBlockStore:()=>E,canUndoStepEdits:()=>_,getPageGroupForGroupedEditCard:()=>P,openMoveToMenuAndAcceptPagesCreated:()=>D,rejectEdits:()=>T,saveAssistantCreatedPage:()=>R,undoEditsForClientStep:()=>M});n(18107),n(944114),n(967357),n(898992),n(823215),n(354520),n(430670),n(581454);var a=()=>n(907258),i=()=>n(675133),s=()=>n(128933),o=()=>n(295633),r=()=>n(231940),l=()=>n(457726),c=()=>n(943290),d=()=>n(206267),u=()=>n(179034),p=()=>n(534177),g=()=>n(495262),m=()=>n(631611),h=()=>n(376049),f=()=>n(206051),y=()=>n(483730),v=()=>n(715142),S=()=>n(825836),b=()=>n(918678),x=()=>n(251383),I=()=>n(162437),k=()=>n(358579),w=()=>n(150984),C=()=>n(371621);const A=(0,n(69708).YK)({savePageSuccess:{id:"assistant.savePage.success",defaultMessage:"Page saved to Private"}});async function T(e){const{environment:t,sessionContext:n,inferenceId:a,operationIds:i,isAutomatedReject:s,assistantSurfaceType:o}=e,r=n.sessionIdFromStoreState;(0,I().$)({environment:t,inferenceId:a,type:"assistant_undo",sessionId:r}),await(0,b().o)({environment:t,sessionId:r,updater:n.createUpdater(),assistantSurfaceType:o});const u=n.getAllPendingExecutableOperations(),p=(0,c().qT)(n.getAllPendingNonCreateExecutableOperations()),g=u.filter((e=>p.includes(e.id)));n.addExecutableOperationsToExecutedOperationMap(g);const m=i||p,{editGroupsThatWereRejected:h}=(0,x().V)({environment:t,sessionId:r,operationIds:m});for(const f of h){const e=n.getHumanActionCardInsertIndex(f,"reject_all");void 0!==e&&-1!==e&&n.upsertClientStep({stepIndex:e,typeFilter:l()._p,factory:e=>({inferenceId:d().JW(),type:"humanAction",action:"reject_all",numberOfEdits:((null==e?void 0:e.numberOfEdits)??0)+(0,c().Wu)([f]),pageId:"updatedPage"===f.type&&f.didCreatePage?void 0:f.pageId,executableOperationIds:[...(null==e?void 0:e.executableOperationIds)??[],...m]})})}s||(0,w().fireAndForgetUpsertStepToChatSessionHistory)({environment:t,sessionId:r,assistantSurfaceType:o})}async function j(e){const{environment:t,sessionContext:n,inferenceId:a,operationIds:i,operationContext:s,assistantSurfaceType:o}=e,r=n.sessionIdFromStoreState;(0,I().$)({environment:t,inferenceId:a,type:"assistant_accept_edits",sessionId:r}),await(0,b().o)({environment:t,sessionId:r,updater:n.createUpdater(),assistantSurfaceType:o});const u=(0,c().qT)(n.getAllPendingNonCreateExecutableOperations()),g=i||u,{undoCheckpointName:m,editGroupsThatWereApplied:h}=await(0,S().i)({environment:t,sessionId:r,operationIds:g,operationContext:s});for(const f of h){const e=(0,c().Wu)([f]);if("updatedPage"===f.type){const t=n.getHumanActionCardInsertIndex(f,"accept");if(void 0===t)continue;n.upsertClientStep({stepIndex:t,typeFilter:l().uL,factory:t=>({type:"humanAction",action:"accept",inferenceId:(null==t?void 0:t.inferenceId)??d().JW(),numberOfEdits:((null==t?void 0:t.numberOfEdits)??0)+e,pageId:f.pageId,wasPageCreate:f.didCreatePage,undoCheckpointNames:[...(null==t?void 0:t.undoCheckpointNames)??[],m],executableOperationIds:[...(null==t?void 0:t.executableOperationIds)??[],...g]})})}else"removedPage"===f.type?n.addClientStep({type:"humanAction",action:"accept_page_delete",inferenceId:d().JW(),pageId:f.pageId,undoCheckpointNames:[m],executableOperationIds:[...g]}):(0,p().HB)(f)}(0,w().fireAndForgetUpsertStepToChatSessionHistory)({environment:t,sessionId:r,assistantSurfaceType:o})}function M(e){const{environment:t,clientStep:n,assistantSurfaceType:a}=e;if("reject"===n.action)return;if("create_page"===n.action)return;const i="insert"===n.action||"accept"===n.action||"accept_page_delete"===n.action,s="reject_all"===n.action;let o;if(i){o=n.pageId;if(!y().default.getActiveSession())return;if(!(0,p().O9)(n.undoCheckpointNames))return;const e=[...n.undoCheckpointNames].reverse();for(const n of e)g().JM({environment:t,namedRevisionId:n,skipDefaultPostPerformValidationChecks:!0})}else s&&(o=n.pageId);const r=y().default.getActiveSession();if(r){if(r.removeClientStep(n),o){var l;const e=[];"insert"!==n.action&&e.push(...n.executableOperationIds??[]);const a=null===(l=r.getAndDeleteFromExecutedOperationsMap(o,e))||void 0===l?void 0:l.slice();a&&(r.prependUncommittedOperations(a),(0,k().Z)({environment:t,sessionContext:r}))}(0,w().fireAndForgetUpsertStepToChatSessionHistory)({sessionId:r.sessionIdFromStoreState,environment:t,assistantSurfaceType:a})}}function _(e){return"reject"!==e.action&&("create_page"!==e.action&&(function(e){const t="insert"===e.action||(0,l().uL)(e)||"accept_page_delete"===e.action,n="reject_all"===e.action;if(t)return(0,p().O9)(e.undoCheckpointNames)&&e.undoCheckpointNames.length>0&&e.undoCheckpointNames.every((e=>g().xy(e)));if(n){var a;const t=y().default.getActiveSession();if(!t)return!1;const n=(0,l().Yd)(e),i=e.executableOperationIds;return n&&(null===(a=t.getFromExecutedOperationsMap(n))||void 0===a?void 0:a.filter((e=>i.includes(e.id))))}return!1}(e)&&!function(e){const t=(0,l().Yd)(e),n=y().default.getActiveSession();if(!t||!n)return!1;const a=n.getCombinedSteps(),i=a.findIndex((t=>t===e)),s=a.findIndex(((e,t)=>t>i&&"human"===e.type)),o=a.slice().reverse().findIndex((e=>"groupedEditCard"===e.type&&e.pageId===t)),r=-1===o?-1:a.length-o-1;return-1!==s&&-1!==r&&r>s}(e)))}function P(e){const t=y().default.getActiveSession(),n=(null==t?void 0:t.getAllPendingExecutableOperations().filter((t=>{var n;return null===(n=e.executableOperationIds)||void 0===n?void 0:n.includes(t.id)})))??[];return(0,c().iL)(n).filter((t=>t.pageId===e.pageId)).at(0)}function D(e){const{environment:t,sessionContext:n,groups:i,originRectForMenu:s,assistantSurfaceType:r}=e,l=a().default.state.sidebarSpaceViewStore;if(!l)return;const c=i.map((e=>o().B.createChildStore(l,{id:e.pageId,table:u().ev})));h().ho({environment:t,blocks:c,originRect:s,moveToContext:"action_menu",isAddTo:!0,disableSuccessToast:!0,forceShowPrivatePageOption:!0,dontCommitActions:!0,onAccept:({value:e})=>{(async e=>{for(const a of i)await j({environment:t,sessionContext:n,inferenceId:d().JW(),operationIds:a.operationIds,operationContext:e,assistantSurfaceType:r})})((0,C()._W)(e))}})}async function E(e){const{environment:t,sessionContext:n,groups:i,assistantSurfaceType:s}=e,o=f().default.state.stores.at(0),l=o?(0,r().N)(o):a().default.state.mainEditorCurrentBlockStore;if(!l)return;const c=l.getType();if("page"!==c)return;if(!i.every((e=>e.pageId!==l.id)))return;const u=(()=>{const e=l.id;if("page"===c)return{addBlockToPage:{target:"page",pageId:e}};(0,p().HB)(c)})();await j({environment:t,sessionContext:n,inferenceId:d().JW(),operationIds:i.flatMap((e=>e.operationIds)),operationContext:u,assistantSurfaceType:s})}async function R(e){const t=y().default.getActiveSession();if(!t||t.isStreaming())return;const n=t.latestCommitInferenceIdFromStoreState??d().JW(),a=(0,v().Lz)(e).flatMap((e=>e.operationIds));await j({environment:e,sessionContext:t,inferenceId:n,operationIds:a,operationContext:(0,C().BB)({shouldCreateUnknownBlock:!0}),assistantSurfaceType:m().wy.corner.type}),s().D6({label:i().A.formatMessage(A.savePageSuccess)})}},832093:(e,t,n)=>{n.d(t,{g:()=>ve});n(16280),n(944114),n(898992),n(672577),n(581454),n(737550);var a=()=>n(496603),i=()=>n(534177),s=()=>n(24279),o=()=>n(596635),r=()=>n(319625),l=()=>n(251582),c=()=>n(181856),d=()=>n(353566),u=(n(354520),n(430670),n.n(n(542922))),p=()=>n(412412),g=()=>n(292722);function m(e){const t=e.replace(/\[(\d+)\](?!\()/g,"[]($1)");const n=new(u())({linkify:!0}).render(t);let a=(0,p().BD)(n);return a=a.flatMap((e=>"element"===e.type?f(e):[])),a=a.map(v),a}const h={p:!0,h1:!0,h2:!0,h3:!0,ul:!0,ol:!0,pre:!0,table:!0};function f(e){if("p"===e.tagName)return[{type:"element",tagName:"text",attributes:{},children:y(e.children)}];if("h1"===e.tagName||"h2"===e.tagName||"h3"===e.tagName)return[{type:"element",tagName:e.tagName,attributes:{},children:y(e.children)}];if("ul"===e.tagName||"ol"===e.tagName){const t=e.children.filter((e=>"element"===e.type&&"li"===e.tagName));return a().oE(t.map(((t,n)=>{const a=t.children.flatMap((e=>"element"===e.type&&"p"===e.tagName?e.children:[e])),i=a.filter((e=>"element"===e.type&&h[e.tagName])),s=a.filter((e=>!("element"===e.type&&h[e.tagName])));return{type:"element",tagName:"ul"===e.tagName?"uli":"oli",attributes:{..."ol"===e.tagName&&{index:(n+1).toString()}},children:[...y(s),...i.flatMap((e=>f(e)))]}})))}if("pre"===e.tagName){const t=e.children[0],n="text"===t.type?t.value:"",a=(0,g().c9)({tagName:"code",inputString:n}),i=n.match(/class="language-(\w+)"/),s=i?i[1]:void 0;return[{type:"element",tagName:"code-block",attributes:{...s&&{language:s}},children:[{type:"text",value:a.trim()}]}]}if("table"===e.tagName){const t=e.children.filter((e=>"element"===e.type&&"thead"===e.tagName)),n=e.children.filter((e=>"element"===e.type&&"tbody"===e.tagName));return[{type:"element",tagName:"table",attributes:{},children:[...t.flatMap((e=>e.children)),...n.flatMap((e=>e.children))].filter((e=>"element"===e.type&&"tr"===e.tagName)).flatMap((e=>f(e)))}]}if("tr"===e.tagName){return[{type:"element",tagName:"tr",attributes:{},children:e.children.filter((e=>"element"===e.type&&("td"===e.tagName||"th"===e.tagName))).map(((e,t)=>({type:"element",tagName:"property-text",attributes:{name:(t+1).toString()},children:y(e.children)})))}]}return[]}function y(e){const t=e.flatMap((e=>"text"===e.type?"\n"===e.value?[]:[e]:"p"===e.tagName?y(e.children):"strong"===e.tagName?[{...e,tagName:"b",children:y(e.children)}]:"a"===e.tagName?[e]:"em"===e.tagName?[{...e,tagName:"i",children:y(e.children)}]:"code"===e.tagName?[{...e,tagName:"code",children:y(e.children)}]:void 0));return function(e){e=e.filter(((t,n)=>0!==n&&n!==e.length-1||"text"!==t.type||""!==t.value.trim()));return e.map(((t,n)=>(0===n&&"text"===t.type&&(t={...t,value:t.value.trimStart()}),n===e.length-1&&"text"===t.type&&(t={...t,value:t.value.trimEnd()}),t)))}(a().oE(t))}function v(e){return"element"===e.type&&"a"===e.tagName&&"uncited"===e.attributes.href?{type:"element",tagName:"uncited",attributes:{},children:[]}:"element"===e.type?{...e,children:e.children.map(v)}:e}function S(){return{chat:C,"edit-page":T,"related-content":()=>[]}}function b(){return{search:d().$P,load:d().Hh,"load-page":d().wu,"load-database":d().qY,"load-slack":d().TM,"load-google-drive":d().C1,"load-github":d().UQ,"load-github-code":d().xR,"create-page":A,"load-attachment":d().WM,"load-web-page":d().uz,"search-databases":d().lo,"load-jira":d().FO,"load-microsoft-teams":d().b8,"load-sharepoint":d().iL,"load-linear":d().Dp,"load-box":d().cW,"load-salesforce":d()._r}}function x(e){return e.tagName in S()}function I(e,t){const n=S();return"chat"===e.tagName||"edit-page"===e.tagName||"related-content"===e.tagName?n[e.tagName]({effectNode:e,state:t}):void(0,i().HB)(e)}function k(e){return e.tagName in b()}function w(e,t){const n=b();return"load-page"===e.tagName||"search"===e.tagName||"load-database"===e.tagName||"load-slack"===e.tagName||"load-google-drive"===e.tagName||"load-github"===e.tagName||"load-jira"===e.tagName||"load-github-code"===e.tagName||"load-microsoft-teams"===e.tagName||"load-sharepoint"===e.tagName||"create-page"===e.tagName||"load-attachment"===e.tagName||"load-web-page"===e.tagName||"search-databases"===e.tagName||"load-linear"===e.tagName||"load-box"===e.tagName||"load-salesforce"===e.tagName?n[e.tagName]({observationNode:e,state:t}):void(0,i().HB)(e)}function C(e){const{effectNode:t}=e;return[{type:"observation",observationType:"namespaceStart",namespace:"chat",args:t}]}async function A(e){const{state:t,observationNode:n}=e;let a=[];if("collection"===n.insertType&&!t.getLoadedDatabaseIds().has(n.attributes.in)){const e=await(0,d().qY)({state:t,observationNode:{type:"observation",tagName:"load-database",attributes:{id:n.attributes.in}}});a=a.concat(e)}return a.push({type:"observation",observationType:"namespaceStart",namespace:"create_page",args:n}),a}function T(e){const{effectNode:t}=e;return[{type:"observation",observationType:"namespaceStart",namespace:"edit_page",args:t}]}n(803949);var j=()=>n(902006),M=()=>n(208685),_=()=>n(706461);function P(e){const{result:t,assistantSelection:n,idMapper:a,namespace:s}=e,o=()=>n?a.mapAssistantSelectionKeyToCounter(n):void 0;if("webpage"===t.observationType)return{type:"observation",observationType:"loadUniversalResource",value:(0,p()._o)({...t.value,attributes:{...t.value.attributes,id:a.mapKeyToCounter({type:"webpage",key:t.value.attributes.id})},type:"element"})};if("page"===t.observationType)return{type:"observation",observationType:"page",pageId:a.mapKeyToCounter({type:"block",key:t.pageId}),value:(0,_().sD)({node:a.mapNodeKeyToCounter(t.value),selection:o(),namespace:s}),isNonSpaceShared:t.isNonSpaceShared};if("database"===t.observationType)return{type:"observation",observationType:"database",databaseId:a.mapKeyToCounter({type:"collection",key:t.databaseId}),value:(0,_().sD)({node:a.mapNodeKeyToCounter(t.value),selection:o(),namespace:s})};if("search"===t.observationType){const e={},{searchResults:n,idToCounter:i}=function(e){const{idMapper:t,node:n}=e,a={};return{searchResults:{...n,children:n.children.map((e=>{if("google-drive-result"===e.tagName){const n=t.mapKeyToCounter({type:"google-drive",key:(0,j().V9)(e.attributes.id)});return a[e.attributes.id]=n,{...e,attributes:{...e.attributes,id:n}}}if("webpage"===e.tagName){const n=t.mapKeyToCounter({type:"webpage",key:(0,j().RW)(e.attributes.id)});return a[e.attributes.id]=n,{...e,attributes:{...e.attributes,id:n}}}if("helpdoc"===e.tagName){const n=t.mapKeyToCounter({type:"helpdoc",key:(0,j().h5)(e.attributes.id)});return a[e.attributes.id]=n,{...e,attributes:{...e.attributes,id:n},children:e.children.map((e=>{const n=t.mapKeyToCounter({type:"helpdoc-section",key:(0,j().w3)(e.attributes.id)});return a[e.attributes.id]=n,{...e,attributes:{...e.attributes,id:n}}}))}}if("page"===e.tagName){const n=t.mapKeyToCounter({type:"block",key:e.attributes.id});return a[e.attributes.id]=n,{...e,attributes:{...e.attributes,id:n},children:e.children.map((e=>{const n=t.mapKeyToCounter({type:"block",key:e.attributes.id});return a[e.attributes.id]=n,{...e,attributes:{...e.attributes,id:n}}}))}}if("github-result"===e.tagName){const n=t.mapKeyToCounter({type:"github",key:(0,j().V9)(e.attributes.id)});return a[e.attributes.id]=n,{...e,attributes:{...e.attributes,id:n}}}if("notion-mail-result"===e.tagName){const n=t.mapKeyToCounter({type:"notion-mail",key:(0,j().V9)(e.attributes.id)});return a[e.attributes.id]=n,{...e,attributes:{...e.attributes,id:n},children:e.children.map((e=>{const n=t.mapKeyToCounter({type:"notion-mail",key:(0,j().V9)(e.attributes.id)});return a[e.attributes.id]=n,{...e,attributes:{...e.attributes,id:n}}}))}}if("outlook-result"===e.tagName){const n=t.mapKeyToCounter({type:"outlook",key:(0,j().V9)(e.attributes.id)});return a[e.attributes.id]=n,{...e,attributes:{...e.attributes,id:n},children:e.children.map((e=>{const n=t.mapKeyToCounter({type:"outlook",key:(0,j().V9)(e.attributes.id)});return a[e.attributes.id]=n,{...e,attributes:{...e.attributes,id:n}}}))}}if("linear-result"===e.tagName){const n=t.mapKeyToCounter({type:"linear",key:(0,j().V9)(e.attributes.id)});return a[e.attributes.id]=n,{...e,attributes:{...e.attributes,id:n,title:e.attributes.title}}}if("notion-calendar-result"===e.tagName){const n=t.mapKeyToCounter({type:"notion-calendar",key:(0,j().V9)(e.attributes.id)});return a[e.attributes.id]=n,{...e,attributes:{...e.attributes,id:n,title:e.attributes.title}}}if("page-result"===e.tagName){const n=t.mapKeyToCounter({type:"block",key:e.attributes.id});return a[e.attributes.id]=n,{...e,attributes:{...e.attributes,id:n}}}{const n=(0,M().U)(e.tagName);return(null==n?void 0:n.mapObservationResultNode({node:e,idMapper:t,idToCounter:a}))??e}}))},idToCounter:a}}({idMapper:a,node:t.value});Object.entries(t.idToDeIdentifiedIds||{}).forEach((([t,n])=>{const a=i[t];void 0!==a&&(e[a]={id:t,deIdentifiedId:n.deIdentifiedId,type:n.type})}));return{type:"observation",observationType:"search",value:(0,p()._o)(n,void 0,void 0,"research_mode"===s||void 0),containsNonSpaceSharedResults:t.containsNonSpaceSharedResults,systemMessages:t.systemMessages,counterToIds:e,evaluationId:t.evaluationId,scope:t.scope}}if("queryDatabase"===t.observationType){return{type:"observation",observationType:"pagesFromQueryDatabase",databaseId:a.mapKeyToCounter({type:"collection",key:t.databaseId}),value:{summary:{value:(0,p()._o)({...t.value,attributes:{...t.value.attributes,id:a.mapKeyToCounter({type:"query-database-result",key:t.value.attributes.id})},children:[]})},pages:t.value.children.map((e=>{let t;if("block"===e.type){const n=a.mapNodeKeyToCounter(e);t=(0,p()._o)({type:"text",value:(0,_().sD)({node:n,selection:o(),namespace:s})})}else t=(0,p()._o)(e);return{value:t}}))}}}if("searchPeople"===t.observationType)return{type:"observation",observationType:"searchPeople",value:(0,p()._o)({...t.value,children:t.value.children.map((e=>({...e,attributes:{...e.attributes,"person-id":a.mapKeyToCounter({type:"person",key:e.attributes["person-id"]})}})))})};if("searchDatabases"===t.observationType)return{type:"observation",observationType:"searchDatabases",value:(0,p()._o)({...t.value,children:t.value.children.map((e=>({type:"text",value:(0,_().sD)({node:a.mapNodeKeyToCounter(e),selection:o(),namespace:s})})))})};if("slack"===t.observationType)return{type:"observation",observationType:"loadUniversalResource",value:(0,p()._o)({...t.value,type:"element",attributes:{...t.value.attributes,id:a.mapKeyToCounter({type:"slack-message",key:t.value.attributes.id})},children:t.value.children.map((e=>({...e,type:"element",attributes:{...e.attributes},children:[{type:"text",value:e.value}]})))})};if("namespaceStart"===t.observationType)return t;if("namespaceEnd"===t.observationType)return t;if("attachment"===t.observationType)throw new Error("Invalid observationType for the engine");if("googleDrive"===t.observationType)return{type:"observation",observationType:"loadUniversalResource",value:(0,p()._o)({...t.value,type:"element",attributes:{...t.value.attributes,id:a.mapKeyToCounter({type:"google-drive",key:t.value.attributes.id})},children:t.value.children.map((e=>({...e,type:"element",attributes:{},children:[{type:"text",value:e.value}]})))})};if("github"===t.observationType)return{type:"observation",observationType:"loadUniversalResource",value:(0,p()._o)({...t.value,type:"element",attributes:{...t.value.attributes,id:a.mapKeyToCounter({type:"github",key:t.value.attributes.id})},children:t.value.children.map((e=>({...e,type:"element",attributes:{},children:[{type:"text",value:e.value}]})))})};if("githubCode"===t.observationType){const{content:e,...n}=t.value.attributes;return{type:"observation",observationType:"loadUniversalResource",value:(0,p()._o)({...t.value,type:"element",attributes:{...n,id:a.mapKeyToCounter({type:"github",key:t.value.attributes.id})},children:[{type:"text",value:e}]})}}return"jira"===t.observationType?{type:"observation",observationType:"loadUniversalResource",value:(0,p()._o)({...t.value,type:"element",attributes:{...t.value.attributes,id:a.mapKeyToCounter({type:"jira",key:t.value.attributes.id})}})}:"linear"===t.observationType?{type:"observation",observationType:"loadUniversalResource",value:(0,p()._o)({...t.value,type:"element",attributes:{...t.value.attributes,id:a.mapKeyToCounter({type:"linear",key:t.value.attributes.id})}})}:"box"===t.observationType?{type:"observation",observationType:"loadUniversalResource",value:(0,p()._o)({...t.value,type:"element",attributes:{...t.value.attributes,id:a.mapKeyToCounter({type:"box",key:t.value.attributes.id})}})}:"salesforce"===t.observationType?{type:"observation",observationType:"loadUniversalResource",value:(0,p()._o)({...t.value,type:"element",attributes:{...t.value.attributes,id:a.mapKeyToCounter({type:"salesforce",key:t.value.attributes.id})}})}:"microsoft-teams"===t.observationType?{type:"observation",observationType:"loadUniversalResource",value:(0,p()._o)({...t.value,type:"element",attributes:{...t.value.attributes,id:a.mapKeyToCounter({type:"microsoft-teams-message",key:t.value.attributes.id})},children:t.value.children.map((e=>({...e,type:"element",attributes:{...e.attributes},children:[{type:"text",value:e.value}]})))})}:"sharepoint"===t.observationType?{type:"observation",observationType:"loadUniversalResource",value:(0,p()._o)({...t.value,type:"element",attributes:{...t.value.attributes,id:a.mapKeyToCounter({type:"sharepoint",key:t.value.attributes.id})},children:t.value.children.map((e=>({...e,type:"element",attributes:{},children:[{type:"text",value:e.value}]})))})}:void(0,i().HB)(t)}n(18107),n(967357),n(823215);var D=()=>n(795727),E=()=>n(252050),R=()=>n(634201);function B(e){const{text:t,index:n}=e,a=[],i=[];let s=0;return function e(t,a,i){for(const o of t)if("text"===o.type)if(s+o.value.length<=n)a.push(o),s+=o.value.length;else{const e=n-s;if(e>0){const t=(0,R().PE)(o.value);a.push({type:"text",value:t.slice(0,e).join("")}),i.push({type:"text",value:t.slice(e).join("")})}else i.push(o);s=n}else if((0,g().Ld)(o)||"e"===o.tagName)s<n?(a.push(o),s+=1):i.push(o);else if((0,g().ag)(o)){const t=[],n=[];e(o.children,t,n),t.length>0&&a.push({...o,children:t}),n.length>0&&i.push({...o,children:n})}}(t,a,i),{start:a,end:i}}const F={insert:function(e){const{state:t,effectNode:n,useCrdt:a}=e,i=H({state:t});if(!i)throw new Error("Start ID not found");const{endId:s}=i;(0,d().WH)({state:t,effectNode:{type:"effect",tagName:"insert-after",insertType:"block",attributes:{id:s},children:n.children},useCrdt:a});const o=t.getBlockFromBlockIdMap(s);0===o.children.length&&0===o.text.length&&(0,d().ZL)({remove:[o],state:t})},"insert-before":d().nc,"insert-after":d().WH,replace:function(e){var t,n;const{state:s,effectNode:o,useCrdt:r}=e,l=o.attributes.id?{startId:o.attributes.id,endId:o.attributes.id}:o.attributes.start&&o.attributes.end?{startId:o.attributes.start,endId:o.attributes.end}:H({state:s});if(!l)throw new Error("Range not found");const{startId:u,endId:p}=l;if(!u||!p)throw new Error("Start or end ID not found");const g=s.getBlockFromBlockIdMap(u);let m=s.getBlockFromBlockIdMap(p);const h=z([V(g)]);o.properties.length>0&&(0,d().oq)({state:s,effectNode:{type:"effect",tagName:"set-property",attributes:{id:u},children:o.properties}});let f=o.children;const y=function(e){const{state:t}=e,n=t.getAssistantSelectionIfExists();if(!n||"text"!==n.type)return;const a=t.getBlockFromBlockIdMap(n.start.blockId),i=t.getBlockFromBlockIdMap(n.end.blockId),s=B({text:a.text,index:n.start.index}),o=B({text:i.text,index:n.end.index}),r=s.end[0],l=o.start[o.start.length-1];return{start:0===s.end.length||q(s.start)?void 0:s.start,end:0===o.start.length||q(o.end)?void 0:o.end,selectionStartsWithWhitespace:r&&$(r),selectionEndsWithWhitespace:l&&G(l)}}({state:s});if(y){const e={type:"text",value:" "};f=[{...f[0],tagName:"text"===o.children[0].tagName?g.tagName:o.children[0].tagName,text:[...y.start??[],...y.selectionStartsWithWhitespace?[e]:[],...f[0].text,...y.selectionEndsWithWhitespace?[e]:[]]},...f.slice(1)],f=[...f.slice(0,-1),{...f.at(-1),text:[...f.at(-1).text,...y.end??[]]}]}if("page"===g.tagName){var v;if("page"!==(null===(v=o.children.at(0))||void 0===v?void 0:v.tagName)){f=[{type:"block",tagName:"page",attributes:{id:g.attributes.id},children:o.children,persisted:!0,properties:g.properties,schemas:g.schemas,text:g.text,hasUncited:!1}]}else if(o.children.length>1)throw new(c().kT);u===p&&(m=h.valuesArray().at(-1)??m)}const S=z(f),b=[...h.entries()],x=null===(t=b.find((([e,t])=>t===g)))||void 0===t?void 0:t[0],I=null===(n=b.find((([e,t])=>t===m)))||void 0===n?void 0:n[0];if(!x||!I)throw new Error("Start or end node not found in subtree");const{result:k,leftovers:w}=function(e){const{subtree:t,startCoordinates:n,endCoordinates:i,selectionType:s}=e,o=[...t.entries()],r=a().Hd(o,(([e])=>!a().n4(e,n))),l=new(D().A),d=[];if(W(i,n))throw new(c().af);for(const[a,c]of r){if("block"===s&&U(i,a)||"block"!==s&&W(i,a))break;if(a.length>=n.length){const e=[a[n.length-1]-n.at(-1),...a.slice(n.length)];l.set(e,c)}else d.push(c)}return{result:l,leftovers:d}}({subtree:h,startCoordinates:x,endCoordinates:I,selectionType:K({state:s})}),C=a().RK([...S.keys(),...k.keys()],(e=>JSON.stringify(e)));for(const a of C){const e=k.get(a),t=S.get(a);if((0,i().O9)(e)&&(0,i().O9)(t))O({state:s,oldNode:e,newNode:t,useCrdt:r});else if(!(0,i().O9)(e)&&(0,i().O9)(t))if(1===a.length){if(0===a[0])throw new Error("First replace node should always be defined");const e=[a[0]-1],n=k.get(e)??S.get(e);if(!n)throw new Error("Could not find previous node");(0,d().WH)({state:s,effectNode:{type:"effect",tagName:"insert-after",insertType:"block",attributes:{id:n.attributes.id},children:[t]},useCrdt:r})}else{const e=a.slice(0,-1),n=k.get(e)??S.get(e);if(!n)throw new Error("Could not find parent node");(0,d().mK)({state:s,effectNode:{type:"effect",tagName:"insert-inside",insertType:"block",attributes:{id:n.attributes.id},children:[t]},useCrdt:r})}else(0,i().O9)(e)&&!(0,i().O9)(t)&&(0,d().ZL)({remove:[e],state:s})}w.length>0&&(0,d().ZL)({remove:w,state:s})},delete:function(e){const{state:t,effectNode:n}=e,a=n.attributes.start,i=n.attributes.end,s=t.getBlockFromBlockIdMap(a),o=t.getBlockFromBlockIdMap(i);if(a===i&&"page"!==s.tagName)return void(0,d().ZL)({remove:[t.getBlockFromBlockIdMap(a)],state:t});const r=function(e){const t=[e];function n(e){for(const a of e.children)"block"===a.type&&(t.push(a),n(a))}return n(e),t}(V(s)),l=r.slice(r.indexOf(s),r.indexOf(o)+1).filter((e=>"page"!==e.tagName));(0,d().ZL)({remove:l,state:t})},"set-property":d().oq,"set-attribute":d().Bq,chat:d().TE,"create-page":function(e){const{state:t,effectNode:n,useCrdt:a}=e;if("block"===n.insertType)(0,d().mK)({state:t,effectNode:{type:"effect",tagName:"insert-inside",insertType:"block",attributes:{id:n.attributes.in},children:[n.page]},useCrdt:a});else{if("collection"!==n.insertType)return(0,d().vt)({state:t,effectNode:{type:"effect",tagName:"create",children:[n.page]},useCrdt:a});(0,d().mK)({state:t,effectNode:{type:"effect",tagName:"insert-inside",insertType:"blockIntoDatabase",attributes:{id:n.attributes.in},children:[n.page]},useCrdt:a})}},done:function(e){const{state:t,effectNode:n}=e;return[{type:"observation",observationType:"namespaceEnd",namespace:t.getNamespace(),args:n}]},"related-content":()=>[]};function N(e){return e.tagName in F}function L(e,t,n){return"chat"===e.tagName||"insert-after"===e.tagName||"delete"===e.tagName||"insert-before"===e.tagName||"create-page"===e.tagName||"set-property"===e.tagName||"set-attribute"===e.tagName||"replace"===e.tagName||"insert"===e.tagName||"done"===e.tagName||"related-content"===e.tagName?F[e.tagName]({effectNode:e,state:t,useCrdt:n}):void(0,i().HB)(e)}function O(e){const{state:t,oldNode:n,newNode:a,useCrdt:i}=e;if(n.tagName!==a.tagName&&(0,d().UO)({state:t,effectNode:{type:"effect",tagName:"set-tag-name",attributes:{id:n.attributes.id,newTagName:a.tagName}}}),E().sA[a.tagName].title&&"tr"!==a.tagName&&(0,d().D6)({state:t,effectNode:{type:"effect",tagName:"set-title",attributes:{id:n.attributes.id},children:a.text},useCrdt:i}),Object.keys(a.properties).length>0&&((0,d().oq)({state:t,effectNode:{type:"effect",tagName:"set-property",attributes:{id:n.attributes.id},children:Object.values(a.properties)}}),"tr"===a.tagName)){const e=n.parent;if(e&&"table"===e.tagName){const i=Object.keys(n.properties),s=Object.keys(a.properties),o=i.filter((e=>!s.includes(e))).map((e=>Number(e))).filter(Number.isInteger).sort(((e,t)=>t-e)).map(String);for(const n of o)(0,d().AR)({state:t,effectNode:{type:"effect",tagName:"delete",deleteType:"table-column",attributes:{id:e.attributes.id,name:n}}})}}const{id:s,...o}=a.attributes;Object.keys(o).length>0&&(0,d().Bq)({state:t,effectNode:{type:"effect",tagName:"set-attribute",id:n.attributes.id,attributes:Object.entries(o).map((([e,t])=>({key:e,value:t})))}})}function V(e){let t=e;for(;t.parent;)t=t.parent;return t}function z(e){const t=new(D().A);function n(e,a){for(let i=0;i<e.children.length;i++){const s=e.children[i];if("block"===s.type){const e=[...a,i];t.set(e,s),n(s,e)}}}for(let a=0;a<e.length;a++){const i=e[a];t.set([a],i),n(i,[a])}return t}function W(e,t){for(let n=0;n<Math.max(e.length,t.length);n++){const a=e[n]??-1,i=t[n]??-1;if(a<i)return!0;if(a>i)return!1}return!1}function U(e,t){const n=Math.min(e.length,t.length);for(let a=0;a<n;a++){if(t[a]>e[a])return!0;if(t[a]<e[a])return!1}return!1}function H(e){const{state:t}=e,n=t.getAssistantSelectionIfExists();if(n)return"text"===n.type?{startId:n.start.blockId,endId:n.end.blockId}:{startId:n.blockIds[0],endId:n.blockIds[n.blockIds.length-1]}}function K(e){var t;return null===(t=e.state.getAssistantSelectionIfExists())||void 0===t?void 0:t.type}function q(e){return e.every((e=>"text"===e.type?""===e.value.trim():!(0,g().Ld)(e)&&((0,g().ag)(e)?q(e.children):void 0)))}function $(e){return!!e&&("text"===e.type?" "===e.value[0]:!!(0,g().ag)(e)&&$(e.children[0]))}function G(e){if("text"===e.type)return" "===e.value[e.value.length-1];if((0,g().ag)(e)){const t=e.children[e.children.length-1];return!!t&&G(t)}return!1}var Y=()=>n(586984),Q=()=>n(968579),J=()=>n(973647),X=()=>n(162278),Z=()=>n(233364),ee=()=>n(331119);function te(e){return l().p.mapResult((0,ee().U5)("delete"),(t=>{const n=(0,ee().ke)({inputAttributes:t.attributes,definitions:{start:{required:!0,values:!0,mappingMode:"block_counter"},end:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:"delete",mapCounterToKey:e.mapCounterToKey});if(J().Q.isFail(n))return n;const a=(0,ee().x3)(t);if(J().Q.isFail(a))return a;return{value:{type:"effect",tagName:"delete",attributes:n.value}}}))}function ne(e){return l().p.mapResult((0,ee().U5)("create-page"),(t=>{const n=t.attributes.in?function(e){const{id:t,mapCounterToKey:n}=e;if(!n)return{error:new Error("mapCounterToKey is required")};const a=(0,J().j)((()=>n(t)));if(J().Q.isFail(a))return a;return"block"===a.value.type||"collection"===a.value.type?{value:a.value}:{error:new Error(`Expected block or collection ID, got ${a.value.type}`)}}({id:t.attributes.in,mapCounterToKey:e.mapCounterToKey}):void 0;if(n&&J().Q.isFail(n))return n;const a=e.allocateIdFn(),i=[(0,Z().Q)(e),(0,X().V8)({allocateIdFn:e.allocateIdFn,allowMove:!1,allowUncited:!1,persisted:!1,mapCounterToKey:e.mapCounterToKey})],s=(t.children||[]).filter((e=>"element"===e.type)),o=(0,l().$d)((0,ee().nx)("create-page",i),s);if(J().Q.isFail(o))return o;const r=o.value.filter((e=>"property"===e.type)),c={type:"block",tagName:"page",attributes:{id:a},persisted:!1,children:o.value.filter((e=>"block"===e.type)),properties:Object.fromEntries(r.map((e=>[e.attributes.name,e]))),schemas:{},text:[],hasUncited:!1};if(n&&"block"===n.value.type){return{value:{type:"effect",tagName:"create-page",insertType:"block",attributes:{in:n.value.key},page:c}}}if(n&&"collection"===n.value.type){return{value:{type:"effect",tagName:"create-page",insertType:"collection",attributes:{in:n.value.key},page:c}}}return{value:{type:"effect",tagName:"create-page",insertType:"root",attributes:{in:void 0},page:c}}}))}function ae(e){return l().p.mapResult((0,ee().U5)("replace"),(t=>{const n=(0,ee().ke)({inputAttributes:t.attributes,definitions:{id:{required:!1,values:!0,mappingMode:"block_counter"},start:{required:!1,values:!0,mappingMode:"block_counter"},end:{required:!1,values:!0,mappingMode:"block_counter"}},tagName:"replace",mapCounterToKey:e.mapCounterToKey});if(J().Q.isFail(n))return n;const a=[(0,Z().Q)(e),(0,X().V8)({allocateIdFn:e.allocateIdFn,allowMove:!1,allowUncited:!1,persisted:!1,mapCounterToKey:e.mapCounterToKey})],i=(t.children||[]).filter((e=>"element"===e.type)),s=(0,l().$d)((0,ee().nx)("replace",a),i);if(J().Q.isFail(s))return s;const o=s.value.filter((e=>"block"===e.type)),r=s.value.filter((e=>"property"===e.type));return{value:{type:"effect",tagName:"replace",attributes:n.value,properties:r,children:o}}}))}function ie(e){return l().p.mapResult((0,ee().U5)("insert"),(t=>{const n=[(0,X().V8)({allocateIdFn:e.allocateIdFn,allowMove:!1,allowUncited:!1,persisted:!1,mapCounterToKey:e.mapCounterToKey})],a=(t.children||[]).filter((e=>"element"===e.type)),i=(0,l().$d)((0,ee().nx)("replace",n),a);if(J().Q.isFail(i))return i;return{value:{type:"effect",tagName:"insert",children:i.value}}}))}function se(e){return l().p.mapResult((0,ee().U5)("related-content"),(e=>({value:{type:"effect",tagName:"related-content"}})))}function oe(e){return{chat:(0,Y().dl)(e),"chat-md":Y().WR,delete:(0,Y().Y2)(e),"insert-after":(0,Y().wT)(e),"insert-before":(0,Y().dF)(e),"insert-inside":(0,Y().oZ)(e),"persist-blocks":(0,Y().tl)(e),"set-attribute":(0,Y().ZE)(e),"set-property":(0,Y().C)(e),"set-tag-name":(0,Y().wq)(e),"set-title":(0,Y().pf)(e),create:(0,Y().VY)(e),"related-content":se(),"load-page":(0,Q().XO)(e),search:Q().Or,"search-people":Q().Dk,"load-database":(0,Q().Lh)(e),"load-slack":(0,Q().yX)(e),"load-google-drive":(0,Q().zD)(e),"load-github":(0,Q().dR)(e),"load-github-code":(0,Q().GC)(e),"load-attachment":(0,Q().lM)(e),"load-jira":(0,Q().w2)(e),"load-linear":(0,Q().F6)(e),"load-box":(0,Q().xw)(e),"load-salesforce":(0,Q().N3)(e),"load-microsoft-teams":(0,Q().Uj)(e),"load-sharepoint":(0,Q().d5)(e),load:(0,Q().aD)(e),"load-web-page":(0,Q().Nm)(e),"search-databases":Q().Wg}}function re(e){return l().p.choice([...Object.values(oe(e)),l().p.fail((e=>e.length>0&&"element"===e[0].type?new(c().TP)(e[0].tagName):new Error(`Unexpected node(s) provided to parseAssistantApi: ${JSON.stringify(e)}`)))])}function le(e){return l().p.mapResult((0,ee().U5)("create-page"),(t=>{const n=t.attributes.in?de({id:t.attributes.in,mapCounterToKey:e.mapCounterToKey}):void 0;if(n&&J().Q.isFail(n))return n;if(n&&"block"===n.value.type){return{value:{type:"effect",tagName:"create-page",insertType:"block",attributes:{in:n.value.key}}}}if(n&&"collection"===n.value.type){return{value:{type:"effect",tagName:"create-page",insertType:"collection",attributes:{in:n.value.key}}}}return{value:{type:"effect",tagName:"create-page",insertType:"root",attributes:{in:void 0}}}}))}function ce(e){return l().p.mapResult((0,ee().U5)("edit-page"),(t=>{const n=t.attributes.in?de({id:t.attributes.in,mapCounterToKey:e.mapCounterToKey}):void 0;if(n&&J().Q.isFail(n))return n;if(n&&"block"===n.value.type){return{value:{type:"effect",tagName:"edit-page",insertType:"block",attributes:{in:n.value.key}}}}return{value:{type:"effect",tagName:"edit-page",insertType:"root",attributes:{in:void 0}}}}))}function de(e){const{id:t,mapCounterToKey:n}=e;if(!n)return{error:new(c().Te)("map_counter_to_key_required","mapCounterToKey is required")};const a=(0,J().j)((()=>n(t)));return J().Q.isFail(a)?a:"block"===a.value.type||"collection"===a.value.type?{value:a.value}:{error:new(c().Te)("invalid_block_or_collection_id",`Expected block or collection ID, got ${a.value.type}`)}}function ue(e){return{chat:l().p.mapResult((0,ee().U5)("chat"),(e=>({value:{type:"effect",tagName:"chat"}}))),"create-page":le(e),"edit-page":ce(e),"related-content":l().p.mapResult((0,ee().U5)("related-content"),(e=>({value:{type:"effect",tagName:"related-content"}}))),search:Q().Or,load:(0,Q().aD)(e),"load-page":(0,Q().XO)(e),"load-database":(0,Q().Lh)(e),"load-slack":(0,Q().yX)(e),"load-google-drive":(0,Q().zD)(e),"load-github":(0,Q().dR)(e),"load-github-code":(0,Q().GC)(e),"load-jira":(0,Q().w2)(e),"load-linear":(0,Q().F6)(e),"load-box":(0,Q().xw)(e),"load-salesforce":(0,Q().N3)(e),"load-microsoft-teams":(0,Q().Uj)(e),"load-sharepoint":(0,Q().d5)(e),"load-attachment":(0,Q().lM)(e),"load-web-page":(0,Q().Nm)(e),"search-databases":Q().Wg}}function pe(e){return l().p.choice([...Object.values(ue(e)),l().p.fail((e=>e.length>0&&"element"===e[0].type?new(c().TP)(e[0].tagName):new Error(`Unexpected node(s) provided to parseAssistantRouterApi: ${JSON.stringify(e)}`)))])}function ge(e){return{chat:(0,Y().dl)(e),delete:te(e),replace:ae(e),insert:ie(e),"insert-after":(0,Y().wT)(e),"insert-before":(0,Y().dF)(e),"set-property":(0,Y().C)(e),"set-attribute":(0,Y().ZE)(e),"create-page":ne(e),done:l().p.mapResult((0,ee().U5)("done"),(e=>({value:{type:"effect",tagName:"done"}}))),"related-content":se(),"load-page":(0,Q().XO)(e),search:Q().Or,"search-people":Q().Dk,"load-database":(0,Q().Lh)(e),"load-slack":(0,Q().yX)(e),"load-github":(0,Q().dR)(e),"load-github-code":(0,Q().GC)(e),"load-google-drive":(0,Q().zD)(e),"load-jira":(0,Q().w2)(e),"load-linear":(0,Q().F6)(e),"load-box":(0,Q().xw)(e),"load-salesforce":(0,Q().N3)(e),"load-microsoft-teams":(0,Q().Uj)(e),"load-sharepoint":(0,Q().d5)(e),load:(0,Q().aD)(e),"search-databases":Q().Wg,"load-attachment":(0,Q().lM)(e),"load-web-page":(0,Q().Nm)(e)}}function me(e){return l().p.choice([...Object.values(ge(e)),l().p.fail((e=>e.length>0&&"element"===e[0].type?new(c().TP)(e[0].tagName):new Error(`Unexpected node(s) provided to parseAssistantRouterApi: ${JSON.stringify(e)}`)))])}async function he(e){const{state:t,errorLogger:a,namespace:s,useCrdt:r}=e,u=t.clone(),p=[];u.setNamespace(s);const h=[],f=[],y=[],v=e=>{const t=d().By[e];if(t){return y.filter((t=>t===e)).length>=t}};try{let a;if("chat_markdown"===s)a=[{type:"element",tagName:"chat",attributes:{},children:m(e.input)}];else{let i=(0,g().A0)(e.input);if(i=(0,g().SH)(i),i=i.trim(),0===i.length)return{newState:u,observations:[]};i=(0,g().rk)(i),i=(0,n(510818).tm)(i),a=t.parse(i),"end_to_end"!==s&&(a=(0,n(471159).gO)(a,t.getSerializedState()))}const S=[],b=function(e){switch(e){case"end_to_end":return{parser:re,isEffectNode:d().yK,isObservationNode:d().XD,runEffectNode:d().zY,runObservationNode:d().__};case"prompt_only_top_level":return{parser:pe,isEffectNode:x,isObservationNode:k,runEffectNode:I,runObservationNode:w};default:return{parser:me,isEffectNode:N,isObservationNode:d().XD,runEffectNode:L,runObservationNode:d().__}}}(s),C=[];for(const e of a){if("element"!==e.type)continue;if("lang"===e.tagName)continue;const t=(0,l().AZ)(b.parser(u.toParserArgs()),e);if(v(t.tagName))throw new(c().Te)("api_limit_reached",`The API ${t.tagName} was used too many times in a single response, the limit is ${d().By[t.tagName]}`);if(b.isEffectNode(t)){const e=b.runEffectNode(t,u,r);e&&C.push(...e.map((e=>P({result:e,assistantSelection:u.getAssistantSelectionIfExists(),idMapper:u.getIdMapper(),namespace:s})))),y.push(t.tagName)}else if(b.isObservationNode(t)){const e=b.runObservationNode(t,u).catch((e=>{p.push(fe(e))}));S.push(e),h.push(t.tagName),y.push(t.tagName)}else(0,i().HB)(t)}if(0===y.length&&!e.allowEmpty){const e=o().J[s];throw new(c().Te)("empty_direct_mode",`The assistant output did not use any XML APIs for ${s}. ${e?`Please use the API "<${e}>" to respond to the user's request.`:"Please ensure that your output has at least one XML API."}`)}if(h.length>0&&f.length>0)throw new(c().Te)("mixed_observation_and_effect_apis",`Observation APIs (${h.join(", ")}) and effect APIs (${f.join(", ")}) cannot be used at the same time.`);const A=await Promise.all(S);for(const e of A)e&&p.push(...e.map((e=>P({result:e,assistantSelection:u.getAssistantSelectionIfExists(),idMapper:u.getIdMapper(),namespace:s}))));for(const e of C)p.push(e)}catch(S){const e=ye(S);p.push(fe(e)),e instanceof c().Te&&a&&a(e)}finally{return{newState:u,observations:p}}}function fe(e){const t=ye(e);return{type:"observation",observationType:"error",value:`${t.name}: ${t.message}`,stack:t.stack,errorType:t instanceof c().Te?t.type:void 0,metadata:t instanceof c().Te?t.getMetadata():void 0}}function ye(e){return e instanceof c().Te?e:(0,r().A)(e)}class ve{constructor(e,t){this.transcript=[],this.state=void 0,this.counter=0,this.inferenceIdToStateSnapshot={},this.shouldPersistStateForLabelerMode=!1,this.lastInferences=[],this.errorLogger=void 0,this.namespace=void 0,this.state=e,this.shouldPersistStateForLabelerMode=Boolean(null==t?void 0:t.persistStates),this.errorLogger=null==t?void 0:t.errorLogger,this.namespace=(null==t?void 0:t.namespace)||"end_to_end"}clone(){const e=this.state.clone(),t=new ve(e);return t.setTranscript(this.getTranscript()),t}getTranscript(){return this.transcript}setTranscript(e){var t;this.transcript=e,this.counter=(null===(t=a().Sk(e,(e=>e.id)))||void 0===t?void 0:t.id)??0}clearTranscript(){this.transcript=[],this.counter=0}getInferenceInputForEval(e){let t=this.getTranscript();return e.skipLastAssistantStep&&t.length>0&&"assistant"===t[t.length-1].type&&(t=t.slice(0,t.length-1)),e.appendPreviewingStepForDebug&&(t=[...t,e.appendPreviewingStepForDebug]),{id:n(206267).Dt(),startState:this.state.getSerializedState(),startTranscript:t}}async*streamSampleNextStep(e){const t=this.getTranscript(),n=this.getActiveNamespace(),a=this.state.streamInference(t,e);let i,s;this.shouldPersistStateForLabelerMode&&(i=this.state.getSerializedState(),s=this.getTranscript());const o=this.counter++;let r="";for await(const l of a)r+=l,yield{type:"assistant",id:o,value:r,inferenceId:e,namespace:n};if(this.shouldPersistStateForLabelerMode&&(this.inferenceIdToStateSnapshot[e]={startState:i,startTranscript:s,output:r},this.lastInferences.push(e),this.lastInferences.length>5)){const e=this.lastInferences.shift();e&&delete this.inferenceIdToStateSnapshot[e]}}async sampleNextStep(e){let t;for await(const n of this.streamSampleNextStep(e))t=n;return t}async simulateStep(e){return"assistant"===e.type||"human"===e.type?await this.evaluateStep(e,!1):{observations:[],newState:this.state,didForceExit:!1}}async commitStep(e,t){if("assistant"===e.type){const{observations:n,newState:a,didForceExit:i}=await this.evaluateStep(e,!0,t);this.transcript=[...this.transcript,e];for(const e of n)this.appendObservation(e);return{observations:n,newState:a,didForceExit:i}}return"context"===e.type&&this.state.setContext(this.state.getIdMapper().mapAssistantContextCounterToKey(e.context)),this.transcript=[...this.transcript,e],{observations:[],newState:this.state,didForceExit:!1}}commitStepWithoutEvaluating(e){this.transcript=[...this.transcript,e]}createAssistantStep(e,t,n){return{id:this.counter++,type:"assistant",value:e,namespace:n,...t}}createHumanStep(e){return{id:this.counter++,type:"human",value:e}}createObservationStep(e){const{output:t}=e;return{id:this.counter++,...t}}createInstructionsStep(e,t){return{id:this.counter++,type:"instructions",value:t,skillContext:e}}createAttachmentObservationStep(e){return"application/pdf"===e.contentType?{id:this.counter++,type:"observation",observationType:"attachment",fileUrl:e.originalFileUrl,fileName:e.fileName,contentType:e.contentType,base64EncodedFileUrl:""}:"text/csv"===e.contentType||(0,n(68169).tT)(e.contentType)?{id:this.counter++,type:"observation",observationType:"attachment",fileUrl:e.originalFileUrl,fileName:e.fileName,contentType:e.contentType}:void(0,i().HB)(e.contentType)}createContextStep(e){const t=this.state.getIdMapper();return{id:this.counter++,type:"context",context:t.mapAssistantContextKeyToCounter(e)}}async evaluateStep(e,t,n){const i="assistant"===e.type&&e.namespace?e.namespace:this.getActiveNamespace(),s=this.state,{newState:o,observations:r,didForceExit:l}={...await he({state:this.state,input:e.value,errorLogger:this.errorLogger,allowRepeatedAssisantSteps:null==n?void 0:n.allowRepeatedAssisantSteps,allowEmpty:null==n?void 0:n.allowEmpty,namespace:i,useCrdt:(null==n?void 0:n.useCrdt)??!1}),didForceExit:!1};t&&(this.state!==s&&o.mergeWithState(this.state),this.state=o);const c=r.map((e=>{const t=this.counter++;return e.observationType,{...e,id:t}}));return{newState:o,observations:a().oE(c),didForceExit:l}}async loadPageWithoutAssistantStep(e){const t=this.state.getIdMapper().mapKeyToCounter({type:"block",key:e}),{observations:n}=await this.evaluateStep({id:0,type:"assistant",value:`<load id="${t}"/>`},!0,{allowRepeatedAssisantSteps:!0}),a=n.find(s().XO);if(a)throw(0,s().aR)(a);const i=n.map((e=>({...e,id:this.counter++})));for(const s of i)this.appendObservation(s)}async refreshPageObservations(){const e=this.state.getLoadedPageIds(),t=async e=>{const t=`<load id="${this.state.getIdMapper().mapKeyToCounter({type:"block",key:e})}"/>`,{observations:n}=await this.evaluateStep({id:0,type:"assistant",value:t},!0,{allowRepeatedAssisantSteps:!0}),a=n[0];if("page"!==(null==a?void 0:a.observationType))throw new Error("Expected page observation");return a};for(const n of e){const e=await t(n);this.appendObservation({...e,id:this.counter++})}}appendObservation(e){this.transcript.some((t=>"observation"===t.type&&"attachment"===t.observationType&&"attachment"===e.observationType?t.contentType===e.contentType&&t.fileUrl===e.fileUrl:"observation"===t.type&&"error"!==t.observationType&&t.observationType===e.observationType&&t.value===e.value&&"namespaceStart"!==t.observationType))||(this.transcript=[...this.transcript,e])}setAssistantSelection(e){this.state.setAssistantSelection(e)}setNamespace(e){this.namespace=e}getActiveNamespace(){return"prompt_only_top_level"===this.namespace?(0,o().f)(this.getTranscript()):this.namespace}}},832895:(e,t,n)=>{n.d(t,{Ue:()=>b,wY:()=>x});n(944114),n(898992),n(803949);var a=n(296540),i=()=>n(401497),s=()=>n(699143),o=()=>n(718827),r=()=>n(606712),l=()=>n(970236),c=()=>n(807449),d=()=>n(406094),u=()=>n(631524),p=()=>n(493552),g=()=>n(995847),m=()=>n(340498),h=()=>n(100622),f=()=>n(534177),y=n(474848);const v=(0,a.createContext)(void 0);v.displayName="AnimationDismissContext";const S=300;function b(e){const{children:t}=e,[n,s]=(0,a.useState)(100),o=(0,i().IS)((()=>({card:{marginBottom:`-${n}%`,transitionProperty:"margin-bottom",transitionDuration:`${S}ms`,transitionTimingFunction:"ease"}})),[n]);(0,a.useEffect)((()=>{s(0)}),[]);const r=(0,a.useCallback)((e=>{s(100),setTimeout(e,S)}),[]);return(0,y.jsx)(v.Provider,{value:r,children:(0,y.jsx)("div",{style:o.card,children:t})})}function x(e){const{onClick:t,onDismiss:n,...l}=e,d=(0,i().eP)(),p=(0,i().IS)((()=>({container:{background:"transparent",margin:8,display:"flex",position:"relative"},card:{width:"100%",position:"relative",padding:8,borderRadius:8,boxShadow:h().Tj.shadow.outline.sm,background:h().Tj.background.secondary,WebkitBackdropFilter:"blur(30px)",backdropFilter:"blur(30px)",overflow:"hidden"},cardHovered:{background:(0,r().R)({color:h().Tj.background.secondary,mode:d,adjustmentFactor:.5})},cardPressed:{background:(0,r().y)({color:h().Tj.background.secondary,mode:d,adjustmentFactor:1})},closeButton:{position:"absolute",top:8,insetInlineEnd:8,width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center"}})),[d]),m=(0,a.useContext)(v),f=(0,a.useCallback)((e=>{e.stopPropagation(),m?m((()=>null==n?void 0:n())):null==n||n()}),[n,m]);let S;return n&&(S=(0,y.jsx)(u().p,{colorPalette:"gray",size:"xs",style:p.closeButton,onClick:f,children:(0,y.jsx)(c().I,{icon:g().xMarkSmallIcon,size:"xs",colorVariant:"secondary"})})),(0,y.jsx)("div",{style:p.container,children:t?(0,y.jsxs)(o().Ay,{onClick:t,style:p.card,hoveredStyle:p.cardHovered,pressedStyle:p.cardPressed,children:[(0,y.jsx)(s().Y1,{direction:"vertical",gap:8,children:(0,y.jsx)(I,{...l})}),S]}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(s().Y1,{direction:"vertical",style:p.card,gap:8,children:(0,y.jsx)(I,{...l})}),S]})})}function I(e){const{title:t,body:n,buttons:a,imageSources:o,imageHeight:r,imageMarginLeft:c,imageMarginTop:d,onDismiss:u,icon:g,iconColor:v,badge:S,fullWidth:b,heroElement:x}=e,I=(0,i().eP)(),w=(null==S?void 0:S.placement)??"inlineWithTitle",C=(0,i().IS)((()=>({content:{paddingTop:4},image:{height:r??56,alignSelf:"start",maxWidth:"100%",marginInlineStart:c??4,marginTop:d??0},icon:{width:m().Ev.default,height:m().Ev.default,fill:v?h().Tj[v].icon.accentPrimary:h().Tj.icon.primary},iconWrapper:{width:24,height:24,display:"flex",justifyContent:"center",alignItems:"center"},title:{textWrap:"pretty"},badgeWrapper:{marginInlineStart:6},badge:{display:"inline-flex",alignSelf:"aboveTitle"===w?"flex-start":void 0}})),[v,r,c,d,w]),A=[];let T;return a&&(0,f().EI)(a)&&a.forEach(((e,t)=>A.push((0,y.jsx)(k,{...e},t)))),o?T=(0,y.jsx)("img",{src:o[I],style:C.image,alt:""}):x&&(T=x),(0,y.jsxs)(y.Fragment,{children:[T,(0,y.jsxs)(s().Y1,{direction:"horizontal",children:[g?(0,y.jsx)("span",{style:C.iconWrapper,children:g(C.icon)}):null,(0,y.jsxs)(s().Y1,{gap:4,style:C.content,children:[(0,y.jsxs)(s().Y1,{gap:4,padding:b?"0px":`0px ${u?32:8}px 0px 8px`,children:[S&&"aboveTitle"===w?(0,y.jsx)(l().E,{content:S.content,color:S.color,style:C.badge}):null,(0,y.jsxs)(p().D,{style:C.title,styleKey:"captionSemibold",colorVariant:"primary",children:[t,S&&"inlineWithTitle"===w?(0,y.jsx)("span",{style:C.badgeWrapper,children:(0,y.jsx)(l().E,{content:S.content,color:S.color,style:C.badge})}):null]}),(0,y.jsx)(p().D,{styleKey:"captionRegular",colorVariant:"secondary",children:n})]}),(0,y.jsx)("div",{children:A})]})]})]})}function k(e){const{text:t,onClick:n,leftIcon:a,rightIcon:r,disabled:l,variant:c="default",colorPalette:u,colorVariant:g="primary"}=e,f="outline-fill"===c,v=(0,i().IS)((()=>({defaultIconStyles:{width:m().Ev.sm,height:m().Ev.sm,fill:l?h().Tj.gray.text.primary:u?h().Tj[u].text[g]:h().Tj.text.primary},button:{paddingTop:4,paddingInlineEnd:8,paddingBottom:4,paddingInlineStart:Boolean(a)?6:8,borderRadius:6,...f?{width:"100%"}:{}}})),[a,f,u,g,l]),S="outline-fill"===c?d().A:o().Ay,b=f?"fill":"hug",x=f?"center":"center-left";return(0,y.jsx)(s().Y1,{direction:"horizontal",children:(0,y.jsx)(S,{disabled:l,style:v.button,onClick:n,children:(0,y.jsxs)(s().Y1,{direction:"horizontal",align:x,gap:Boolean(a)?4:6,width:b,children:[a?a(v.defaultIconStyles):null,(0,y.jsx)(p().D,{styleKey:"captionSemibold",colorPalette:l?"gray":u??void 0,colorVariant:l?"primary":g,children:t}),r?r(v.defaultIconStyles):null]})})})}},838319:(e,t,n)=>{n.d(t,{AK:()=>l,Cu:()=>r,Sn:()=>c,lp:()=>d});var a=()=>n(907258),i=()=>n(680977),s=()=>n(547149),o=()=>n(183373);function r({environment:e,checklistId:t,stepId:n}){var s,r;const{currentUserSettingsStore:l}=a().default.state;if(!l)return;const c=(null===(s=l.getSettings())||void 0===s?void 0:s.checklists)??{},d={...c,[t]:{...c[t]??{},completedSteps:{...(null===(r=c[t])||void 0===r?void 0:r.completedSteps)??{},[n]:Date.now()}}};(0,o().ik)({environment:e,checklistId:t,stepId:n,type:"completeStep"}),u({userAction:"checklistActions.completeChecklistStep",environment:e,perform:e=>{(0,i().m)({userSettingsStore:l,transaction:e,data:{checklists:d}})},userId:l.id})}function l({environment:e,checklistId:t,state:n}){var s,r;const{currentUserSettingsStore:l}=a().default.state;if(!l)return;const c=(null===(s=l.getSettings())||void 0===s?void 0:s.checklists)??{};null!==(r=c[t])&&void 0!==r&&r.dismissedAt||((0,o().ik)({environment:e,checklistId:t,type:"open"===n?"expand":"collapse"}),u({userAction:"checklistActions.setChecklistExpansion",environment:e,perform:e=>{(0,i().m)({userSettingsStore:l,transaction:e,data:{checklists:{...c,[t]:{...c[t],state:n}}}})},userId:l.id}))}function c({environment:e,checklistId:t}){var n,s;const{currentUserSettingsStore:r}=a().default.state;if(!r)return;const l=(null===(n=r.getSettings())||void 0===n?void 0:n.checklists)??{};null!==(s=l[t])&&void 0!==s&&s.completedAt||((0,o().ik)({environment:e,checklistId:t,type:"complete"}),u({userAction:"checklistActions.completeChecklist",environment:e,perform:e=>{(0,i().m)({userSettingsStore:r,transaction:e,data:{checklists:{...l,[t]:{...l[t],completedAt:Date.now()}}}})},userId:r.id}))}function d({environment:e,checklistId:t}){var n;const{currentUserSettingsStore:s}=a().default.state;if(!s)return;const o={...(null===(n=s.getSettings())||void 0===n?void 0:n.checklists)??{}};delete o[t],u({userAction:"checklistActions.resetChecklist",environment:e,perform:e=>{(0,i().m)({userSettingsStore:s,transaction:e,data:{checklists:o}})},userId:s.id})}function u(e){return s().createAndCommit({...e,canUndo:!1})}},839710:(e,t,n)=>{n.d(t,{A:()=>r});var a=()=>n(906745),i=()=>n(353566),s=()=>n(29554),o=()=>n(108181);function r(e){const{currentUserInfo:t,currentSpaceName:n}=e,r=a().DateTime.local().toISO({suppressMilliseconds:!0}),l=t.name,c=e.currentPageOverrideStore?{primaryEditorStore:e.currentPageOverrideStore}:(0,o().N)();return{mode:"direct","available-commands":i().Eo,"current-datetime":r,...function(e){var t;if(!e)return{};const n=e=>{if(!e)return"";const t=e.getBlockTitleStore();return t?(0,s().r4)(t.getValue(),t):""},a=null===(t=e.primaryEditorStore)||void 0===t?void 0:t.id;return{...a&&{"current-page-id":a},"current-page-name":n(e.primaryEditorStore),...e.backgroundEditorStore?{"current-background-page-id":e.backgroundEditorStore.id,"current-background-page-name":n(e.backgroundEditorStore)}:{}}}(c),...l&&{"current-person-id":t.id,"current-person-name":l},...n&&{"current-space-name":n}}}},847832:(e,t,n)=>{n.d(t,{Bf:()=>m,Gt:()=>I,H8:()=>d,LP:()=>w,M4:()=>k,SH:()=>x,Yx:()=>h,b6:()=>f,f3:()=>l,in:()=>S,oy:()=>c,yH:()=>C});n(898992),n(672577);var a=()=>n(534177),i=()=>n(474587),s=()=>n(404931);const o=(0,n(69708).YK)({summarizePageParameter:{id:"parameters.summarize.page",defaultMessage:"Page"},translateLanguageParameter:{id:"parameters.translate.language",defaultMessage:"Language"},changeToneToneParameter:{id:"parameters.changeTone.tone",defaultMessage:"Tone"},customNameParameter:{id:"parameters.custom.name",defaultMessage:"Name"},customInitialUserPromptParameter:{id:"parameters.custom.initialUserPrompt",defaultMessage:"Initial User Prompt"},customInstructionsParameter:{id:"parameters.custom.instructions",defaultMessage:"Instructions"},summarizeModeParameter:{id:"parameters.summarize.mode",defaultMessage:"Mode"},summarizeStyleParameter:{id:"parameters.summarize.style",defaultMessage:"Style"},databaseFilingDatabaseParameter:{id:"parameters.databaseFiling.database",defaultMessage:"Database"},newPageFromTemplateTemplateParameter:{id:"parameters.newPageFromTemplate.template",defaultMessage:"Template"},pageOrTopicPlaceholder:{id:"parameters.pageOrTopicPlaceholder.text",defaultMessage:"Select a page..."},templatePlaceholder:{id:"parameters.templatePlaceholder.text",defaultMessage:"Select a template..."},databasePlaceholder:{id:"parameters.databasePlaceholder.text",defaultMessage:"Select a database..."},languagePlaceholder:{id:"parameters.languagePlaceholder.text",defaultMessage:"Select a language..."},tonePlaceholder:{id:"parameters.tonePlaceholder.text",defaultMessage:"Select a tone..."},summarizeTranscriptTemplateParameter:{id:"parameters.summarizeTranscript.template",defaultMessage:"Template"}}),r=[{key:"english",name:i().VT.translateEnglish},{key:"korean",name:i().VT.translateKorean},{key:"chinese (simplified)",name:i().VT.translateChineseSimplified},{key:"chinese (traditional)",name:i().VT.translateChineseTraditional},{key:"japanese",name:i().VT.translateJapanese},{key:"spanish",name:i().VT.translateSpanish},{key:"russian",name:i().VT.translateRussian},{key:"french",name:i().VT.translateFrench},{key:"portuguese",name:i().VT.translatePortuguese},{key:"german",name:i().VT.translateGerman},{key:"italian",name:i().VT.translateItalian},{key:"dutch",name:i().VT.translateDutch},{key:"indonesian",name:i().VT.translateIndonesian},{key:"filipino",name:i().VT.translateFilipino},{key:"vietnamese",name:i().VT.translateVietnamese}];function l(e){return r.find((t=>t.key===e))}const c=[{key:"professional",name:i().VT.changeToneProfessional},{key:"casual",name:i().VT.changeToneCasual},{key:"straightforward",name:i().VT.changeToneStraightforward},{key:"confident",name:i().VT.changeToneConfident},{key:"friendly",name:i().VT.changeToneFriendly}];function d(e){return c.find((t=>t.key===e))}const u={search_qna:{},summarize:{pageOrTopic:{name:o.summarizePageParameter,type:"blockOrText",optional:!1,isUserVisible:!0,placeholder:o.pageOrTopicPlaceholder},summarizeMode:{name:o.summarizeModeParameter,type:"summarizeMode",optional:!1,isUserVisible:!1},summarizeStyle:{name:o.summarizeStyleParameter,type:"summarizeStyle",optional:!1,isUserVisible:!1}},chat_key_points:{pageOrTopic:{name:o.summarizePageParameter,type:"blockOrText",optional:!1,isUserVisible:!0,placeholder:o.pageOrTopicPlaceholder},summarizeMode:{name:o.summarizeModeParameter,type:"summarizeMode",optional:!1,isUserVisible:!1},summarizeStyle:{name:o.summarizeStyleParameter,type:"summarizeStyle",optional:!1,isUserVisible:!1}},chat_action_items:{},page_qna:{},fix_spelling_grammar:{},fill_title:{},add_summary:{},add_key_points:{},add_action_items:{},continue_writing:{},translate:{language:{name:o.translateLanguageParameter,type:"language",optional:!1,isUserVisible:!0,placeholder:o.languagePlaceholder}},translate_page:{language:{name:o.translateLanguageParameter,type:"fullPageTranslationLanguage",optional:!1,isUserVisible:!0,placeholder:o.languagePlaceholder}},improve_writing:{},improve_formatting:{},make_shorter:{},make_longer:{},change_tone:{tone:{name:o.changeToneToneParameter,type:"tone",optional:!1,isUserVisible:!0,placeholder:o.tonePlaceholder}},simplify_language:{},brainstorm_ideas:{},write_code:{},draft_outline:{},draft_template:{},draft_table:{},draft_diagram:{},draft_poem:{},draft_meeting_agenda:{},draft_email:{},custom:{name:{name:o.customNameParameter,type:"string",optional:!1,isUserVisible:!1},initialUserPrompt:{name:o.customInitialUserPromptParameter,type:"textValue",optional:!1,isUserVisible:!1},instructions:{name:o.customInstructionsParameter,type:"textValue",optional:!1,isUserVisible:!1}},explain_this:{},database_filing:{collection:{name:o.databaseFilingDatabaseParameter,type:"collection",optional:!1,isUserVisible:!0,placeholder:o.databasePlaceholder}},query_database:{collection:{name:o.databaseFilingDatabaseParameter,type:"collection",optional:!1,isUserVisible:!0,placeholder:o.databasePlaceholder}},new_page_from_template:{template:{name:o.newPageFromTemplateTemplateParameter,type:"block",optional:!1,isUserVisible:!0,placeholder:o.templatePlaceholder}},help_me_write:{},help_me_edit:{},help_me_draft:{},create_quiz:{},search_workspace:{},search_ai_knowledge:{},new_years_resolution:{},summarize_transcript:{template:{name:o.summarizeTranscriptTemplateParameter,type:"textValue",optional:!1,isUserVisible:!1,placeholder:o.templatePlaceholder}},alphabetize_list:{},reformat:{}};function p(e,t){return u[e][t]}const g={translate:{skillType:"translate",fillableParameter:"language",remainingParameters:{}},translate_page:{skillType:"translate_page",fillableParameter:"language",remainingParameters:{}},change_tone:{skillType:"change_tone",fillableParameter:"tone",remainingParameters:{}},summarize:{skillType:"summarize",fillableParameter:"pageOrTopic",remainingParameters:{summarizeMode:"chat",summarizeStyle:"prose"}},chat_key_points:{skillType:"chat_key_points",fillableParameter:"pageOrTopic",remainingParameters:{summarizeMode:"chat",summarizeStyle:"list"}},database_filing:{skillType:"database_filing",fillableParameter:"collection",remainingParameters:{}},query_database:{skillType:"query_database",fillableParameter:"collection",remainingParameters:{}},new_page_from_template:{skillType:"new_page_from_template",fillableParameter:"template",remainingParameters:{}},summarize_transcript:{skillType:"summarize_transcript",fillableParameter:"template",remainingParameters:{}}};function m(e){const t=g[e];return{...t,parameterDefinition:p(t.skillType,t.fillableParameter)}}function h(e){const{skillType:t,parameterValues:n}=e,a=g[t];return{type:p(a.skillType,a.fillableParameter).type,value:n[a.fillableParameter]}}function f(e,t){return{...g[e].remainingParameters,[g[e].fillableParameter]:t}}const y=["change_tone","custom","summarize","chat_key_points","translate","database_filing","query_database","new_page_from_template","translate_page","summarize_transcript"],v=["search_qna","chat_action_items","page_qna","fix_spelling_grammar","fill_title","add_summary","add_key_points","add_action_items","continue_writing","improve_writing","improve_formatting","make_shorter","make_longer","simplify_language","brainstorm_ideas","write_code","draft_outline","draft_template","draft_table","draft_diagram","draft_poem","draft_email","draft_meeting_agenda","explain_this","help_me_draft","help_me_edit","help_me_write","create_quiz","search_workspace","search_ai_knowledge","new_years_resolution","alphabetize_list","reformat"],S=["translate","change_tone","summarize","chat_key_points","database_filing","query_database","new_page_from_template","translate_page","summarize_transcript"],b=["summarize","chat_key_points"];function x(e){return!!(0,a().Xk)(y,e)}function I(e){return!!(0,a().Xk)(S,e)}function k(e){return!!(0,a().Xk)(b,e)}function w(e){return!!(0,a().Xk)(v,e)}function C(e){return(0,s().dc)(e).requiresInput??!1}},854227:(e,t,n)=>{n.d(t,{GU:()=>h,WD:()=>m,ge:()=>u,jg:()=>p,lB:()=>g});n(944114);var a=n.n(n(845732)),i=()=>n(700500),s=()=>n(911676),o=()=>n(945778),r=()=>n(201980),l=()=>n(463042),c=()=>n(812072);function d(e){return t=>{g(t),function(e,t){p({md:e,name:"user_mentions",regex:c().d$,createTokens(e,n){const a=e.slice(1),i=t.get(a);if(i)return[{type:"user_mention_open",tag:"a",level:n+1,attrs:{[s().lc[r().Ifu.User]]:i}},{type:"text",content:e},{type:"user_mention_close",tag:"/a",level:n}]}})}(t,e),m(t),h(t)}}function u(e){return{plugin:d(e)}}function p(e){const{md:t,name:n,regex:a,createTokens:i}=e,{arrayReplaceAt:s}=t.utils;function o(e,t,s){let o=0;const r=[];if(e.replace(a,(function(a){const c=Array.from(arguments);let d=c.length-1;"string"!=typeof c[d]&&(d-=1);const u=c[d],p=c[d-1];if(p>0&&(0,l().D$)(u[p-1]))return"";if(p+a.length<u.length&&(0,l().D$)(u[p+a.length]))return"";const g=i(a,t);if(!g)return"";if(p>o){const t=new s("text","",0);t.content=e.slice(o,p),r.push(t)}for(const{type:e,attrs:t,tag:i,level:o,content:l}of g){const a=new s(e,"",0);if(t)for(const[e,n]of Object.entries(t))a.attrPush([e,n]);i&&(a.tag=i,a.markup=n),void 0!==o&&(a.level=o),l&&(a.content=l),r.push(a)}return o=p+a.length,""})),o<e.length){const t=new s("text","",0);t.content=e.slice(o),r.push(t)}return r}t.core.ruler.after("linkify",n,(e=>{let t=0;const n=e.tokens;for(let i=0;i<n.length;i++){const r=n[i].children;if("inline"===n[i].type&&r)for(let l=r.length-1;l>=0;l--){const c=r[l];"link_open"!==c.type&&"link_close"!==c.type||"auto"===c.info&&(t-=c.nesting),"text"===c.type&&0===t&&a.test(c.content)&&(n[i].children=s(r,l,o(c.content,c.level,e.Token)))}}return!0}))}function g(e){p({md:e,name:"date_mentions",regex:/20\d\d-\d\d-\d\d/g,createTokens:(e,t)=>[{type:"date_mention_open",tag:"time",attrs:{datetime:e,[s().lc.dateFormat]:"relative"},level:t+1},{type:"text",content:e},{type:"date_mention_close",tag:"/time",level:t}]})}function m(e){const t=/^aside\s+(.*)$/,n={validate:e=>Boolean(e.trim().match(t)),render(n,a){if(1===n[a].nesting){const r=n[a].info.trim().match(t);let l=(null==r?void 0:r[1])??"";(0,o().A)(l)||(l="");const c="gray_background",d=function(e,t){const n=[];for(const[a,i]of t)n.push(`${a}="${e.utils.escapeHtml(i)}"`);return n.join(" ")}(e,[[s().lc[i().xd.callout],""],[s().lc.calloutBackground,c],[s().lc.calloutIcon,l]]);return`<div ${d}>`}return"</div>"}};e.use(a(),"callout_block",n)}function h(e){const t=/^\s+(.*)$/,n={validate:e=>Boolean(e.trim().match(t)),render(n,a){if(1===n[a].nesting){const i=n[a].info.trim().match(t),s=(null==i?void 0:i[1])??"";return`<details><summary>${e.utils.escapeHtml(s)}</summary>`}return"</details>"}};e.use(a(),"toggle_block",n)}},854992:(e,t,n)=>{n.d(t,{E:()=>i});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"2.27 4.37 15.46 11.25",svg:(0,n(474848).jsx)("path",{d:"M7 4.375a.625.625 0 1 0 0 1.25h10.1a.625.625 0 1 0 0-1.25zm0 5a.625.625 0 1 0 0 1.25h10.1a.625.625 0 1 0 0-1.25zM6.375 15c0-.345.28-.625.625-.625h10.1a.625.625 0 1 1 0 1.25H7A.625.625 0 0 1 6.375 15M2.9 9.375a.625.625 0 1 0 0 1.25h1.5a.625.625 0 1 0 0-1.25zM2.275 5c0-.345.28-.625.625-.625h1.5a.625.625 0 1 1 0 1.25H2.9A.625.625 0 0 1 2.275 5m.625 9.375a.625.625 0 1 0 0 1.25h1.5a.625.625 0 1 0 0-1.25z"})},i=(0,n(340498).wt)("listDash",a,"default")},856197:(e,t,n)=>{n.d(t,{z:()=>k});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(581454);var a=()=>n(764880),i=()=>n(584262),s=()=>n(713998),o=()=>n(869190),r=()=>n(604995),l=()=>n(663199),c=()=>n(683259),d=()=>n(128713),u=()=>n(792071),p=()=>n(142748),g=()=>n(96330),m=()=>n(179034),h=()=>n(201980),f=()=>n(931075);const y=o().ZF;function v(e){return(0,c().vy)({...e,fromString:e=>e}).join("")}function S(e){const{textValue:t}=e;if(t){const n=[];for(const a of t)h().bHQ(a)||n.push(v({...e,textValue:[a]}));return n.join(", ")}return""}const b={[h().Ifu.Page]:({annotation:e,exportArgs:t})=>{const{getExportedPathToPage:n}=t,a=h().v55(e),i=(0,c()._z)({intl:t.intl,blockId:a,getRecordValue:t.getRecordValue,userTimeZone:t.userTimeZone}),s=n({toPageId:a});if(i&&s)return`${i} (${s})`},[h().Ifu.Collection]:({annotation:e,exportArgs:t})=>{var a;const s=h().TSJ(e);if(!s)return;const o=(0,c().R7)({intl:t.intl,collectionId:s.id,getRecordValue:t.getRecordValue,userTimeZone:t.userTimeZone}),r=(0,c().oD)({collectionPointer:s,getRecordValue:t.getRecordValue});return`${o} (${(0,n(938379).C)({collectionId:s.id,spaceId:t.root.spaceId,spaceDomain:void 0,parentCvbId:null==r||null===(a=r.getParentPointer())||void 0===a?void 0:a.id,domainBaseUrl:t.baseUrl,pageVisitSource:i().y8.Export})})`},[h().Ifu.SlackSpecialMention]:({annotation:e})=>`@${h().p5C(e)}`,[h().Ifu.ChatSelectionContext]:({annotation:e})=>h().$sA(e).text,[h().Ifu.CustomEmoji]:({annotation:e,exportArgs:t})=>{const{getRecordValue:n}=t,a=h().qS0(e);if(!a)return;const i=u().b4_.fromGetRecordValueFn(n)(a);return i?i.getRenderTitle():void 0},[h().Ifu.Comment]:({annotation:e,exportArgs:t})=>{const{getRecordValue:a,baseUrl:s}=t,o=u().b4_.fromGetRecordValueFn(a),r=h().MdE(e);if(!r)return;const l=o(r);if(!l)return;const c=l.getParentId(),d=l.getParentPointer(),g=(0,p().NJ)((0,p().Yn)(d,a));if(!g)return;const m=o(d);let f;if(m){const e=o(m.getParentPointer());f=e&&"table_row"===e.getType()?e.getParentId():m.getParentId()}return(0,n(921940).A)({pageId:g.id,scrollToBlockId:f,pageValue:g,baseUrl:s,discussionId:c,pageVisitSource:i().y8.Export})},[h().Ifu.Link]:({annotation:e,exportArgs:t})=>{const{getExportedPathToFile:a,getExportedPathToPage:i,navigableBlockId:s,baseUrl:o,publicDomainName:r}=t,l=h().cQR(e),c=(0,n(777447).lX)({url:l,baseUrl:o,publicDomainName:r});return c?i({toPageId:c}):a({fromBlockId:s,toFileURI:l})},[h().Ifu.User]:({annotation:e,exportArgs:t})=>{const{intl:a}=t,i=h().NcG(e),s=t.getRecordValue({table:n(798880).oo,id:i});if(s)return`@${(0,n(695608).c6)(a,s)}`},[h().Ifu.Bot]:({annotation:e,exportArgs:t})=>{const a=h().vjW(e),i=t.getRecordValue({table:n(824862).GP,id:a});if(i)return`@${(0,n(799288).Hg)(i)}`},[h().Ifu.Group]:({annotation:e,exportArgs:t})=>{const n=(0,c().Pf)({annotation:e,exportArgs:t});if(n)return n},[h().Ifu.Team]:({annotation:e,exportArgs:t})=>{const n=(0,c().nZ)({annotation:e,exportArgs:t});if(n)return n},[h().Ifu.ExternalObjectInstance]:({annotation:e,exportArgs:t})=>{var n;const a=h().T$c(e);return null===(n=t.getRecordValue({table:m().ev,id:a,spaceId:t.root.spaceId}))||void 0===n||null===(n=n.format)||void 0===n?void 0:n.original_url},[h().Ifu.LinkMention]:({annotation:e,exportArgs:t})=>{const{href:n}=h().q1R(e);return n},[h().Ifu.Date]:({annotation:e,exportArgs:t})=>{const{date_format:n,time_format:a,...i}=h().K7D(e);return`@${(0,o().ZF)({value:i,date_format:n,time_format:a,userTimeZone:t.userTimeZone,allowRelativeDates:!1,intl:t.intl})}`},[h().Ifu.Equation]:({annotation:e,exportArgs:t})=>{const n=(0,d().TG)(e),a=(0,d().oV)(e,t.getExportedPathToPage,t);return`${n}${h().U35(e)}${a}`},[h().Ifu.Place]:({annotation:e})=>(0,g().X1)(h().nG4(e)),[h().Ifu.Bold]:c().if,[h().Ifu.Italic]:c().if,[h().Ifu.Strike]:c().if,[h().Ifu.Code]:c().if,[h().Ifu.Highlight]:c().if,[h().Ifu.Discussion]:c().if,[h().Ifu.Underline]:c().if,[h().Ifu.Inserted]:c().if,[h().Ifu.Deleted]:c().if,[h().Ifu.TemporaryComment]:c().if,[h().Ifu.TemporaryCursor]:c().if,[h().Ifu.DeletionMarker]:c().if,[h().Ifu.TemporaryEquation]:c().if,[h().Ifu.TemporaryPage]:c().if,[h().Ifu.TemporaryCollection]:c().if,[h().Ifu.TemporaryInput]:c().if,[h().Ifu.TemporarySelection]:c().if,[h().Ifu.TemporaryFindHighlight]:c().if,[h().Ifu.TemporarySelectedFindHighlight]:c().if,[h().Ifu.TemplateVariable]:c().if,[h().Ifu.FormulaPageProperty]:c().if,[h().Ifu.FormulaContextValue]:c().if,[h().Ifu.FormulaError]:c().if,[h().Ifu.Citation]:c().if,[h().Ifu.TemporaryCitation]:c().if,[h().Ifu.SuggestionInsertText]:c().if,[h().Ifu.SuggestionRemoveText]:c().if,[h().Ifu.SuggestionAnnotate]:c().if,[h().Ifu.SuggestionUnannotate]:c().if,[h().Ifu.TemporaryNativeMABFilter]:c().if,[h().Ifu.TemporaryDictation]:c().if,[h().Ifu.TemporaryHighlight]:c().if,[h().Ifu.AssistantInstructionsCollection]:c().if,[h().Ifu.TemporaryCommentHighlight]:c().if,[h().Ifu.TemporarySuggestionUnderline]:c().if,[h().Ifu.SearchFilterCreatedTime]:c().if,[h().Ifu.SearchFilterLastEditedTime]:c().if,[h().Ifu.TemporarySearchFilter]:c().if,[h().Ifu.TitleOnly]:c().if,[h().Ifu.Sort]:c().if};function x(){}function I(){return Promise.resolve(void 0)}const k={blockRenderers:{text:x,header:x,sub_header:x,sub_sub_header:x,header_4:x,quote:x,bulleted_list:x,toggle:x,to_do:x,numbered_list:x,code:x,page:x,image:x,video:x,embed:x,bookmark:x,file:x,temporary_ui:x,edit_reference:x,tweet:x,maps:x,gist:x,framer:x,invision:x,mixpanel:x,drive:x,figma:x,loom:x,pdf:x,typeform:x,codepen:x,audio:x,divider:x,equation:x,collection_view:x,collection_view_page:x,column_list:x,column:x,factory:x,copy_indicator:x,breadcrumb:x,link_to_collection:x,link_to_page:x,table_of_contents:x,callout:x,whimsical:x,miro:x,abstract:x,sketch:x,excalidraw:x,replit:x,alias:x,transclusion_container:x,transclusion_reference:x,external_object_instance:x,table:x,table_row:x,tab:x,hex:x,deepnote:x,external_object_instance_page:x,button:x,ai_block:x,drawing:x,slide:x,personal_home_page:x,home_shortcuts:x,form:x,post:x,workflow:x,transcription:x,mail:x},asyncBlockRenderers:{text:I,header:I,sub_header:I,sub_sub_header:I,header_4:I,quote:I,bulleted_list:I,toggle:I,to_do:I,numbered_list:I,code:I,page:I,image:I,video:I,embed:I,bookmark:I,temporary_ui:I,edit_reference:I,file:I,tweet:I,maps:I,gist:I,framer:I,invision:I,mixpanel:I,drive:I,figma:I,loom:I,pdf:I,typeform:I,codepen:I,audio:I,divider:I,equation:I,collection_view:I,collection_view_page:I,column_list:I,column:I,factory:I,copy_indicator:I,breadcrumb:I,link_to_collection:I,link_to_page:I,table_of_contents:I,callout:I,whimsical:I,miro:I,abstract:I,sketch:I,excalidraw:I,replit:I,alias:I,transclusion_container:I,transclusion_reference:I,external_object_instance:I,table:I,table_row:I,tab:I,hex:I,deepnote:I,external_object_instance_page:I,button:I,ai_block:I,drawing:I,slide:I,personal_home_page:I,home_shortcuts:I,form:I,post:I,workflow:I,transcription:I,mail:I},annotationRenderers:b,propertyRenderers:{title:e=>v(e),text:v,select:e=>{const{textValue:t,propertySchema:n}=e,a=n.options||[];return s().L3(t,a)},multi_select:e=>{const{textValue:t,propertySchema:n}=e,a=n.options||[],i=s().o2(t,a);return i.sort(),i.join(", ")},status:e=>{const{textValue:t,propertySchema:n}=e;return s().RZ(t,n)},relation:e=>{const{textValue:t,propertySchema:n,exportArgs:a}=e;if("relation"!==n.type)return;const i=s().bG({relationValue:s().n(t),getRecordModel:u().b4_.fromGetRecordValueFn(a.getRecordValue),propertySchema:n,includeNoAccess:!0}),o=s().Ap(i);return S({...e,textValue:o})},rollup:e=>{const t=e.exportArgs.getRecordValue,a=e.exportArgs.formulasModule,i=u().Bj6.fromValue(m().ev,e.block),s=u().b4_.fromGetRecordValueFn(t);return n(568063).I({...e,block:i,getRecordModel:s,collectionRequestContext:{userId:void 0,userTimeZone:e.exportArgs.userTimeZone,depth:0,intl:e.exportArgs.intl,visitedProperties:new Set,resultCache:e.exportArgs.resultCache,regExpCache:e.exportArgs.regExpCache,formatDateCache:e.exportArgs.formatDateCache,experimentService:e.exportArgs.experimentService,collectionFeatureGates:e.exportArgs.collectionFeatureGates,getRelationEdgeList:void 0},formulasModule:a,spaceIdCreator:e.exportArgs.spaceIdCreator})},url:({textValue:e})=>h().k4p(e),email:({textValue:e})=>h().k4p(e),phone_number:({textValue:e})=>h().k4p(e),checkbox:({textValue:e})=>(0,n(657970).w)(e)?"Yes":"No",person:({textValue:e,exportArgs:t,propertySchema:a,block:i})=>{const{intl:s,getRecordValue:o}=t,r=u().Bj6.fromBlock(i),l=u().b4_.fromGetRecordValueFn(o),c=(0,n(363170).e)({textValue:e,propertySchema:a,blockCreatorPointer:r.getCreatedByPointer(),convertGroupPointersToBeComposite:!0});return n(496603).oE(c.map((e=>{if("space_permission_group"===e.table){const t=l(e);return(0,n(914462).n)({intl:s,permissionGroupModel:t})}const t=o(e),a=t&&u().Bj6.fromValue(e.table,t);return null==a?void 0:a.getDisplayName(s)}))).join(", ")},number:({exportArgs:e,property:t,schema:a,textValue:i})=>{const s=a[t],o=n(302322).M(i);if(!(0,n(534177).O9)(o))return;let r=!0;var c;s&&(0,n(341136).A)(s)&&(r=(null===(c=s.show_as)||void 0===c?void 0:c.showValue)??!0);return r?(0,l().W)({intl:e.intl,propertySchema:s,value:o}):void 0},date:({textValue:e,propertySchema:t,...a})=>{const i=a.exportArgs.userTimeZone,s=(0,n(187696).b)(e),{date_format:r,time_format:l}=t;if(s)return(0,o().ZF)({allowRelativeDates:!1,value:s,date_format:r,time_format:l,userTimeZone:i,intl:a.exportArgs.intl,displayInUserTimezone:a.exportArgs.displayInUserTimezone??!1,alwaysIncludeTimezone:!0})},file:S,formula:e=>{const{property:t,schema:a,block:i,exportArgs:s}=e,{userTimeZone:o,getRecordValue:r,intl:c,resultCache:d,regExpCache:p,formatDateCache:g,formulasModule:m,spaceIdCreator:h}=s;if(!m)return;const f=a[t],v=m.primitiveFormulaValueFromPropertySchema({schema:a,property:t,blockModel:u().Bj6.fromBlock(i),getRecordModel:u().b4_.fromGetRecordValueFn(r),intl:c,userTimeZone:o,depth:0,resultCache:d,regExpCache:p,formatDateCache:g,experimentService:s.experimentService,collectionFeatureGates:s.collectionFeatureGates,spaceIdCreator:h,getRelationEdgeList:void 0});return"boolean"==typeof v?v?"Yes":"No":(0,n(720665).Et)(v)?(0,l().W)({intl:s.intl,propertySchema:f,value:v}):(0,n(597777).kC)(v)?y({value:v,userTimeZone:o,allowRelativeDates:!1,intl:s.intl}):v},created_time:e=>{const{block:t,exportArgs:n}=e,{userTimeZone:a}=n;if(t.created_time)return y({allowRelativeDates:!1,value:(0,r().KQ)(t.created_time,a),userTimeZone:a,intl:n.intl})},last_edited_time:e=>{const{block:t,exportArgs:n}=e,{userTimeZone:a}=n;if(t.last_edited_time)return y({allowRelativeDates:!1,value:(0,r().KQ)(t.last_edited_time,a),userTimeZone:a,intl:n.intl})},created_by:e=>{const{block:t,exportArgs:n}=e,{getRecordValue:i,intl:s}=n;if(t.created_by_table&&t.created_by_id){const e=(0,a().xC)({getRecordValue:i,pointer:{table:t.created_by_table,id:t.created_by_id,spaceId:t.space_id}});if(e.asActor)return(0,a().lR)(s,e)}},last_edited_by:e=>{const{block:t,exportArgs:n}=e,{getRecordValue:i,intl:s}=n;if(t.last_edited_by_table&&t.last_edited_by_id){const e=(0,a().xC)({getRecordValue:i,pointer:{table:t.last_edited_by_table,id:t.last_edited_by_id,spaceId:t.space_id}});if(e.asActor)return(0,a().lR)(s,e)}},button:e=>"",auto_increment_id:({textValue:e,block:t,exportArgs:a})=>{const i=s().On(e),{getRecordValue:o}=a;if(void 0!==i){const e=u().Bj6.fromBlock(t),a=e.getParentTable();if(a!==n(519831).Vl)return;const s=o((0,n(715913).a)({spaceId:e.getSpaceId(),parentTable:a,parentId:e.getParentId()}));return(0,n(716016).H4)(null==s?void 0:s.record_key,i)}},last_visited_time:e=>"",location:e=>"",verification:({textValue:e,exportArgs:t})=>{const n=f().U1(e);if(!n)return"";const a=f().B2(n);return t.intl.formatMessage(f().D6(a.type))},place:({textValue:e})=>{const t=(0,g().eC)(e);return t?(0,g().X1)(t):""}}}},856411:(e,t,n)=>{n.d(t,{c:()=>i});class a extends(()=>n(757695))().Store{setCurrentView(e){this.setState({currentView:e})}getCurrentView(){return this.state.currentView}getInitialState(){return{currentView:"helpOverflowMenu"}}}const i=new a;(0,n(852832).exposeDebugValue)("assistantOverflowMenuPopupRendererStore",i)},856499:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>a,personSmallIcon:()=>i});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"2.81 1.77 10.36 12.45",svg:(0,n(474848).jsx)("path",{d:"M8 1.775c-.947 0-1.717.392-2.237 1.04-.508.633-.747 1.47-.747 2.338s.239 1.704.747 2.337c.52.648 1.29 1.04 2.237 1.04s1.717-.392 2.237-1.04c.508-.633.748-1.47.748-2.337 0-.869-.24-1.705-.748-2.338-.52-.648-1.29-1.04-2.237-1.04M6.738 3.597c.28-.348.69-.572 1.262-.572s.983.224 1.263.572c.291.364.472.904.472 1.556 0 .651-.18 1.191-.472 1.555-.28.348-.69.572-1.263.572s-.982-.224-1.262-.572c-.292-.364-.472-.904-.472-1.555 0-.652.18-1.192.472-1.556M8 9.178c-2.196 0-4.166 1.07-5.007 2.713a1.48 1.48 0 0 0 .2 1.677c.356.413.91.657 1.487.657h6.64c.577 0 1.132-.244 1.486-.657a1.48 1.48 0 0 0 .201-1.677c-.84-1.643-2.81-2.713-5.007-2.713m-3.894 3.283c.583-1.14 2.062-2.033 3.894-2.033s3.311.893 3.895 2.033q.045.089.033.154a.27.27 0 0 1-.07.14.72.72 0 0 1-.538.22H4.68a.72.72 0 0 1-.537-.22.27.27 0 0 1-.07-.14.26.26 0 0 1 .033-.154"})},i=(0,n(340498).wt)("personSmall",a,"small")},859841:(e,t,n)=>{n.d(t,{A:()=>a});const a=new(n(118307).A)},860251:(e,t,n)=>{n.d(t,{Np:()=>a});const a=2},860814:(e,t,n)=>{n.d(t,{A:()=>I});n(898992),n(354520),n(581454);var a=n(296540),i=()=>n(590526),s=()=>n(401497),o=()=>n(127833),r=()=>n(30537),l=()=>n(420802),c=()=>n(807449),d=()=>n(546926),u=()=>n(631524),p=()=>n(160432),g=()=>n(890492),m=()=>n(81068),h=()=>n(663639),f=()=>n(736847),y=()=>n(452004),v=()=>n(69708),S=()=>n(56394),b=()=>n(385226),x=n(474848);function I({allOptions:e,selectedOptions:t,setSelectedOption:n,onMenuClose:I,pillIcon:k,setPillTitleStringToActiveSelection:w,getFormattedStringTitle:C,getFormattedStringCaption:A,getPillTitle:T}){const j=(0,i().uB)(void 0,y().$),M=(0,s().IS)((()=>({optionContainer:{display:"flex",flexDirection:"row",alignItems:"center"},optionAvatar:{marginInlineEnd:4},container:{padding:"6px 0 6px"},input:{margin:"4px auto",width:"95%"},footer:{paddingTop:8,paddingInlineEnd:8,paddingBottom:2,paddingInlineStart:8,justifyContent:"space-between",display:"flex",flexDirection:"row"}})),[]),[_,P]=(0,a.useState)(!1);function D(){P(!1),I&&I()}function E(){n&&n([])}function R(e){const a=t.includes(e)?[...t.filter((t=>t!==e))]:[...t,e];n&&n(a)}const B=(0,x.jsx)(S().A,{on:t.length>0,icon:(0,x.jsx)(c().I,{icon:k}),title:w&&t[0]?T(t):T([]),onClick:()=>P(!0),disabled:!n,hideChevron:!n});return n?(0,x.jsx)(b().A,{children:(0,x.jsx)(o().zD,{popupType:r().n.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",open:_,render:function(){const n={key:"menuOptions",items:Array.from(e).map((e=>({key:e,action:()=>R(e),render:n=>(0,x.jsx)(m().A,{...n,icon:(0,x.jsx)(l().S,{checked:t.includes(e),onClick:()=>R(e),size:16}),title:C(e),caption:A(e),shouldWrapCaption:!0})}))),render:e=>(0,x.jsx)(f().A,{...e,title:null,loading:!1})};return(0,x.jsxs)("div",{style:M.container,children:[(0,x.jsx)(g().A,{menuType:d().gu.Popup,header:null,maxHeight:250,width:300,children:(0,x.jsx)(h().A,{type:h().O.Vertical,store:j,initialFocus:0,sections:[n]})}),(0,x.jsxs)(f().A,{topBorder:!0,style:M.footer,children:[t.length>0?(0,x.jsx)(u().p,{onClick:E,children:(0,x.jsx)(v().sA,{id:"adminContentSearchTab.pagesTable.filters.audience.clearButton",defaultMessage:"Clear"})}):(0,x.jsx)("div",{}),(0,x.jsx)(p().A,{colorPalette:"blue",onClick:D,children:(0,x.jsx)(v().sA,{id:"adminContentSearchTab.pagesTable.filters.audience.doneButton",defaultMessage:"Done"})})]})]})},onDismiss:D,keepFocus:!0,origin:B,preventScaleTransition:!0,trapFocus:!0})}):B}},861243:(e,t,n)=>{n.d(t,{Y:()=>r});n(296540);var a=()=>n(690495),i=()=>n(391657),s=()=>n(832895),o=n(474848);function r(e){const{messageKey:t}=e,n={id:"",key:t,type:"static",category:a().lU[t].category,props:{}};return(0,o.jsx)(s().Ue,{children:(0,o.jsx)(i().g,{...e,message:n})})}},864896:(e,t,n)=>{n.d(t,{Y:()=>s});n(296540);var a=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"3.37 0.43 13.25 16.44",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M9.533.62a.625.625 0 0 1 .884 0l2.5 2.5a.625.625 0 1 1-.884.884l-1.408-1.408V11a.625.625 0 1 1-1.25 0V2.546L7.917 4.004a.625.625 0 1 1-.884-.883z"}),(0,a.jsx)("path",{d:"M8.125 5.125H5.5A2.125 2.125 0 0 0 3.375 7.25v7.5c0 1.174.951 2.125 2.125 2.125h9a2.125 2.125 0 0 0 2.125-2.125v-7.5A2.125 2.125 0 0 0 14.5 5.125h-2.625v1.25H14.5c.483 0 .875.392.875.875v7.5a.875.875 0 0 1-.875.875h-9a.875.875 0 0 1-.875-.875v-7.5c0-.483.392-.875.875-.875h2.625z"})]})},s=(0,n(340498).wt)("squareAndArrowUp",i,"default")},866894:(e,t,n)=>{n.r(t),n.d(t,{gridIcon:()=>s,iconDefinition:()=>i});n(296540);var a=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"1.23 -0.01 16.77 20.01",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("g",{className:"logo-light-mode",children:[(0,a.jsx)("path",{fill:"url(#paint0_linear_16020_542)",d:"M17.955 7.582c-.319 2.5-3.47 2.446-4.954 2.156-3.259-.634-5.389-2.445-8.864-4.327-4.143-2.24-4.733 6.306 4.1 9.342 1.276.422 2.616.613 3.959.566 2.957-.092 6.21-2.785 5.758-7.737"}),(0,a.jsx)("path",{fill:"#53D55E",d:"M11.855 16.05c-2.73.02-3.978-.065-4.86.633-.649.515-1.268 1.404-1.268 3.317 2.49 0 4.852-1.299 6.128-3.95"}),(0,a.jsx)("path",{fill:"url(#paint1_linear_16020_542)",d:"M17.747 6.444C17.122 3.911 15.48 1.86 14.29.937 13.25.128 11.95-.447 11.23.466c-.577.73-.33 2.398.248 3.72.506 1.148 1.17 2.902 1.43 4.736 1.279.258 4.598.445 4.838-2.478"}),(0,a.jsx)("path",{fill:"#5FCA9D",d:"M17.954 7.582c-.318 2.5-3.47 2.446-4.954 2.156.011.17.03 3.568-.8 5.58 2.952-.091 6.206-2.785 5.754-7.736"}),(0,a.jsxs)("defs",{children:[(0,a.jsxs)("linearGradient",{id:"paint0_linear_16020_542",x1:13.065,x2:6.272,y1:12.798,y2:8.077,gradientUnits:"userSpaceOnUse",children:[(0,a.jsx)("stop",{stopColor:"#89E291"}),(0,a.jsx)("stop",{offset:1,stopColor:"#53D55E"})]}),(0,a.jsxs)("linearGradient",{id:"paint1_linear_16020_542",x1:14.303,x2:11.748,y1:9.083,y2:2.983,gradientUnits:"userSpaceOnUse",children:[(0,a.jsx)("stop",{stopColor:"#77F2F2"}),(0,a.jsx)("stop",{offset:1,stopColor:"#3CB3CD"})]})]})]}),(0,a.jsxs)("g",{className:"logo-dark-mode",children:[(0,a.jsx)("path",{fill:"url(#paint0_linear_16020_548)",d:"M17.955 7.582c-.319 2.5-3.47 2.446-4.954 2.156-3.259-.634-5.389-2.445-8.864-4.327-4.143-2.24-4.733 6.306 4.1 9.342 1.276.422 2.616.613 3.959.566 2.957-.092 6.21-2.785 5.758-7.737"}),(0,a.jsx)("path",{fill:"#53D55E",d:"M11.855 16.05c-2.73.02-3.978-.065-4.86.633-.649.515-1.268 1.404-1.268 3.317 2.49 0 4.852-1.299 6.128-3.95"}),(0,a.jsx)("path",{fill:"url(#paint1_linear_16020_548)",d:"M17.747 6.444C17.122 3.911 15.48 1.86 14.29.937 13.25.128 11.95-.447 11.23.466c-.577.73-.33 2.398.248 3.72.506 1.148 1.17 2.902 1.43 4.736 1.278.258 4.598.445 4.838-2.478"}),(0,a.jsx)("path",{fill:"#5FCA9D",d:"M17.954 7.582c-.318 2.5-3.47 2.446-4.954 2.156.011.17.03 3.568-.8 5.58 2.952-.091 6.206-2.785 5.754-7.736"}),(0,a.jsxs)("defs",{children:[(0,a.jsxs)("linearGradient",{id:"paint0_linear_16020_548",x1:13.064,x2:6.272,y1:12.798,y2:8.077,gradientUnits:"userSpaceOnUse",children:[(0,a.jsx)("stop",{stopColor:"#89E291"}),(0,a.jsx)("stop",{offset:1,stopColor:"#53D55E"})]}),(0,a.jsxs)("linearGradient",{id:"paint1_linear_16020_548",x1:14.303,x2:11.748,y1:9.083,y2:2.983,gradientUnits:"userSpaceOnUse",children:[(0,a.jsx)("stop",{stopColor:"#77F2F2"}),(0,a.jsx)("stop",{offset:1,stopColor:"#3CB3CD"})]})]})]})]})},s=(0,n(340498).wt)("grid",i,"default")},870310:(e,t,n)=>{n.d(t,{A:()=>_});n(898992),n(354520),n(581454);var a=n(296540),i=()=>n(484714),s=()=>n(951500),o=()=>n(590526),r=()=>n(401497),l=()=>n(79926),c=()=>n(295633),d=()=>n(807449),u=()=>n(26697),p=()=>n(898244),g=()=>n(713998),m=()=>n(416504),h=()=>n(187174),f=()=>n(216128),y=()=>n(906380),v=()=>n(450648),S=()=>n(179034),b=()=>n(201980),x=()=>n(69708),I=()=>n(100622),k=()=>n(534177),w=()=>n(284371),C=()=>n(815585);const A={diffHelpers:new(l().O2)("async-diffs",(async()=>await Promise.all([n.e(16471),n.e(79254)]).then(n.bind(n,501770))))};var T=()=>n(462685),j=n(474848);const M=(0,x().YK)({intermediateChanges:{id:"editPropertyDiff.intermediateChanges",defaultMessage:"{count, plural, one {# change} other {# changes}}"}});function _(e){const t=p().QP(e.propertySchema);switch(t){case"text":return(0,j.jsx)(P,{...e});case"relation":return(0,j.jsx)(R,{propertySchema:e.propertySchema,beforeValue:e.beforeValue,afterValue:e.afterValue,rootStore:e.rootStore});case"arrow":return(0,j.jsx)(B,{...e});default:(0,k().HB)(t)}}function P(e){const t=(0,i().v3)(),n=(0,s().l)(E(e.beforeValue.value)),a=(0,s().l)(E(e.afterValue.value)),o=(0,l().fJ)(A.diffHelpers).value,[r]=(0,h().Yb)((async()=>{if(o)return await o.diffTextValueAsync({environment:t,from:"textPropertyDiff",before:n,after:a,insertionAnnotation:[b().Ifu.Inserted],deletionAnnotation:[b().Ifu.Deleted]})}),[t,n,a,o],{});if(void 0===r.value)return(0,j.jsx)(D,{});const c={value:r.value,spaceId:e.beforeValue.spaceId};return(0,j.jsx)(T().A,{value:c,propertySchema:e.propertySchema,rootStore:e.rootStore})}const D=a.memo((function(){return(0,j.jsx)(n(874832).P,{style:{display:"inline-block",verticalAlign:"baseline",width:"60%",height:14,borderRadius:4}})}));function E(e){return b().JG8(e,1e3,[b().Ey_("")])}function R(e){const{beforeValue:t,afterValue:n,propertySchema:a,rootStore:i}=e,s=(0,o().K8)((()=>g().tH({beforeValue:t.value,afterValue:n.value,propertySchema:a,getRecordModel:i.getRecordModel,getBlockTitle:e=>c().B.createChildStore(i,{table:S().ev,id:e.id}).getPropertyValue("title")})),[t,n,a,i]);return(0,j.jsx)(T().A,{value:{value:s,spaceId:t.spaceId},propertySchema:{type:"title",name:"Title"},rootStore:i})}function B(e){const t=(0,r().IS)((()=>({arrowDiffWrap:{display:"inline-flex",alignItems:"center",overflow:"hidden",flexWrap:"wrap",rowGap:6}})),[]),n=e.intermediateChanges&&e.intermediateChanges.length>0;return(0,j.jsxs)("div",{style:t.arrowDiffWrap,children:[(0,j.jsx)(T().A,{value:e.beforeValue,propertySchema:e.propertySchema,rootStore:e.rootStore}),n?(0,j.jsx)(N,{intermediateChanges:e.intermediateChanges,propertySchema:e.propertySchema,rootStore:e.rootStore,latestTimestamp:e.latestIntermediateTimestamp}):(0,j.jsx)(F,{}),(0,j.jsx)(T().A,{value:e.afterValue,propertySchema:e.propertySchema,rootStore:e.rootStore})]})}function F(){const e=(0,r().IS)((()=>({container:{padding:"0px 6px"}})),[]);return(0,j.jsx)("div",{style:e.container,children:(0,j.jsx)(d().I,{icon:y().arrowChevronSingleRightSmallIcon,size:"xs",colorVariant:"tertiary"})})}function N(e){const t=(0,x().tz)(),n=(0,r().IS)((()=>({container:{padding:"4px 8px"},tooltipContent:{display:"flex",flexDirection:"column",alignItems:"flex-start"},tooltipTitle:{fontWeight:500,maxWidth:264,...w().RC},tooltipBody:{color:I().Tj.text.secondary,display:"flex",flexDirection:"row"},tooltipSeperatorDot:{margin:"0px 4px"}})),[]),a=e=>{if(e)return(0,C().nl)(e,{useCompactFormat:!0})},i=(0,o().K8)((()=>{const n=(0,m().P)();return e.intermediateChanges.map((a=>{const i=(0,v().r4)({textValue:a.value.value,getRecordModel:e.rootStore.getRecordModel,userTimeZone:n,intl:t,disableAnnotationPrefix:!0,deterministic:!0});return"date"===e.propertySchema.type?i:i.replace(/,/g," / ")})).filter(Boolean).join(", ")||""}),[e.intermediateChanges,e.rootStore.getRecordModel,e.propertySchema.type,t]);return(0,j.jsx)(u().m,{placement:"top",renderTooltip:t=>(0,j.jsxs)("div",{...t,style:n.tooltipContent,children:[(0,j.jsx)("div",{style:n.tooltipTitle,children:i}),(0,j.jsxs)("div",{style:n.tooltipBody,children:[(0,j.jsx)(x().sA,{...M.intermediateChanges,values:{count:e.intermediateChanges.length}}),(0,j.jsx)("div",{style:n.tooltipSeperatorDot,children:""}),a(e.latestTimestamp)]})]}),render:e=>(0,j.jsx)("div",{...e,style:n.container,children:(0,j.jsx)(d().I,{icon:f().R,size:"xs",colorVariant:"tertiary"})})})}},874848:(e,t,n)=>{n.d(t,{L:()=>r});n(296540);var a=()=>n(699143),i=()=>n(381571),s=()=>n(556958),o=n(474848);function r({backgroundColor:e,children:t,...n}){const r=(0,i().B)(e),l={wrapper:{...r.wrapper,background:e?r.wrapper.background:"initial",height:"100%",padding:"20px 12px"}};return(0,o.jsx)(a().Y1,{style:l.wrapper,align:"center",children:(0,o.jsx)(s().r,{...n,direction:"vertical",overrideSize:()=>48,children:t})})}},877551:(e,t,n)=>{n.d(t,{a:()=>i});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"2.87 1.87 10.25 12.26",svg:(0,n(474848).jsx)("path",{d:"M3.5 1.875a.625.625 0 0 0-.625.625v3c0 .345.28.625.625.625h.875v.42c0 .768.537 1.43 1.289 1.59l4.414.934c.173.036.297.19.297.367v.439H9.5a.625.625 0 0 0-.625.625v3c0 .345.28.625.625.625h3c.345 0 .625-.28.625-.625v-3a.625.625 0 0 0-.625-.625h-.875v-.44c0-.767-.537-1.43-1.289-1.59l-4.414-.933a.375.375 0 0 1-.297-.367v-.42H6.5c.345 0 .625-.28.625-.625v-3a.625.625 0 0 0-.625-.625zm.625 3v-1.75h1.75v1.75zm6 8v-1.75h1.75v1.75z"})},i=(0,n(340498).wt)("connectionsSmall",a,"small")},879643:(e,t,n)=>{n.d(t,{A:()=>P,S:()=>E});n(898992),n(354520),n(430670),n(581454),n(737550);var a=n.n(n(844751)),i=(n(296540),()=>n(907258)),s=()=>n(17022),o=()=>n(484714),r=()=>n(590526),l=()=>n(295633),c=()=>n(732810),d=()=>n(81068),u=()=>n(449279),p=()=>n(663639),g=()=>n(736847),m=()=>n(902006),h=()=>n(416504),f=()=>n(187174),y=()=>n(179034),v=()=>n(519831),S=()=>n(69708),b=()=>n(496603),x=()=>n(534177),I=()=>n(987267),k=()=>n(305390),w=()=>n(106628),C=()=>n(255350),A=()=>n(371960),T=()=>n(163591),j=n(474848);const M=20,_=(0,S().YK)({everythingItemTitle:{id:"assistantScopedSearchMenu.everythingItem.title",defaultMessage:"All sources I can access"},webItemTitle:{id:"assistantScopedSearchMenu.webItem.label",defaultMessage:"Web"},workspaceFuzzyName:{id:"assistantScopedSearchMenu.workspaceItem.title",defaultMessage:"{workspaceName} workspace"},teamspaceFuzzyName:{id:"assistantScopedSearchMenu.teamspaceItem.label",defaultMessage:"Teamspace"},pageFuzzyName:{id:"assistantScopedSearchMenu.pageItem.label",defaultMessage:"Page"},databaseFuzzyName:{id:"assistantScopedSearchMenu.collectionItem.label",defaultMessage:"Database"},slackFuzzyName:{id:"assistantScopedSearchMenu.slackItem.label",defaultMessage:"Slack"},siteFuzzyName:{id:"assistantScopedSearchMenu.siteItem.label",defaultMessage:"Site"},aiKnowledgeFuzzyName:{id:"assistantScopedSearchMenu.aiKnowledgeItem.label",defaultMessage:"AI knowledge"},notionFuzzyName:{id:"assistantScopedSearchMenu.notionItem.label",defaultMessage:"Notion"}});function P(e){const{query:t,defaultMenuItems:n,teamSpaceMenuItems:a,menuListStore:s,onSelect:m,setIsLoading:h}=e,I=(0,o().v3)(),_=(0,S().tz)(),P=(0,r().O$)(i().AppStoreSidebarSpaceStore),[{value:R}]=(0,f().Yb)((async()=>{if(!P)return;h(!0);const e=await w().T.searchActions.load(),n=await e.searchPageIds({environment:I,query:t,limit:M,spaceId:P.id,requireEditPermissions:!1,excludeTemplates:!0,source:"assistant_scoped_search_menu",boostRecentlyViewedPages:!0,spaceStore:P,peopleBlocksToInclude:"none"});return h(!1),n.results.map((e=>l().B.createChildStore(P,{id:e,table:y().ev,spaceId:P.id}))).filter(C().JW)}),[t,I,P,h],{debounce:100}),B=(0,r().K8)((()=>{const e=D({intl:_,totalScopedMenuItems:n,userSearchQuery:t,sidebarSpaceStore:P}).map(((e,t)=>({key:E(e,t),render:t=>(0,j.jsx)(d().A,{...t,icon:(0,j.jsx)(A().Ay,{item:e}),title:(0,j.jsx)(T().A,{item:e})}),action:()=>{m(e)}})));if(e.length>0)return{key:"fuzzy default results",render:e=>(0,j.jsx)(g().A,{...e}),items:e}}),[n,_,t,m,P]),F=(0,r().K8)((()=>{const e=(0,b().hS)((R??[]).flatMap((e=>{var t;const n=e.isCollectionView()&&e.getCollectionPointers()?(null===(t=e.getCollectionPointers())||void 0===t?void 0:t.map((t=>({type:"collection",pageStore:e,collectionId:t.id}))))??[]:[{type:"page",pageStore:e}],a=n.length>1&&n.some((e=>"collection"===e.type));return n.map(((t,n)=>({key:E(t,n),render:n=>(0,j.jsx)(k().A,{...n,store:a&&"collectionId"in t?c().m.createChildStore(e,{id:t.collectionId,table:v().Vl,spaceId:e.getSpaceId()}):e}),action:()=>{m(t)}})))})),(e=>e.key));if(e.length>0)return{key:"search results",render:e=>(0,j.jsx)(g().A,{...e,title:(0,j.jsx)(S().sA,{id:"assistantScopedSearchQueryResults.pageResults.section.title",defaultMessage:"Pages"})}),items:e}}),[R,m]),N=[B,(0,r().K8)((()=>{const e=D({intl:_,totalScopedMenuItems:a,userSearchQuery:t,sidebarSpaceStore:P}).map(((e,t)=>({key:E(e,t),render:t=>(0,j.jsx)(k().A,{...t,store:e.teamStore}),action:()=>{m(e)}})));if(e.length>0)return{key:"fuzzy teamspace results",render:e=>(0,j.jsx)(g().A,{...e,title:(0,j.jsx)(S().sA,{id:"assistantScopedSearchQueryResults.teamResults.section.title",defaultMessage:"Teamspaces"})}),items:e}}),[a,_,t,m,P]),F].filter(x().O9);return 0===N.length?(0,j.jsx)(g().A,{children:(0,j.jsx)(u().u,{title:(0,j.jsx)(S().sA,{defaultMessage:"No results",id:"assistantScopeSearchQueryResults.noResults.label"})})}):(0,j.jsx)(p().A,{type:p().O.Vertical,initialFocus:Boolean(t)?0:void 0,sections:N,store:s})}function D(e){const{intl:t,totalScopedMenuItems:n,userSearchQuery:i,sidebarSpaceStore:o}=e;if(!i)return n;const r={extract:e=>s().e.withListenerIgnored((()=>{if("everything"===e.type)return t.formatMessage(_.everythingItemTitle);if("web"===e.type)return t.formatMessage(_.webItemTitle);if("workspace"===e.type){var n;const e=(null==o||null===(n=o.getModel())||void 0===n?void 0:n.getRenderTitle())??"";return t.formatMessage(_.workspaceFuzzyName,{workspaceName:e})}if("teamspace"===e.type){var a;return`${(null===(a=e.teamStore.getModel())||void 0===a?void 0:a.getRenderTitle())??""} ${t.formatMessage(_.teamspaceFuzzyName)}`}if("page"===e.type){var i;const{pageStore:n}=e;return`${null===(i=e.pageStore.getModel())||void 0===i?void 0:i.getRenderTitleWithPlaceholder({intl:t,userTimeZone:(0,h().P)(),getRecordModel:n.getRecordModel})} ${t.formatMessage(_.pageFuzzyName)}`}if("collection"===e.type){var s;const{pageStore:n}=e;return`${null===(s=e.pageStore.getModel())||void 0===s?void 0:s.getRenderTitleWithPlaceholder({intl:t,userTimeZone:(0,h().P)(),getRecordModel:n.getRecordModel})} ${t.formatMessage(_.databaseFuzzyName)}`}return"helpdocs"===e.type?t.formatMessage(_.slackFuzzyName):"ai-knowledge"===e.type?t.formatMessage(_.aiKnowledgeFuzzyName):"notion"===e.type?t.formatMessage(_.notionFuzzyName):"site"===e.type?t.formatMessage(_.siteFuzzyName):(0,m().SC)(e.type)?I().w0[e.type]:(0,x().HB)(e.type)}))};return a().filter(i,n,r).map((e=>e.original))}function E(e,t){return"everything"===e.type||"notion"===e.type||"workspace"===e.type||"helpdocs"===e.type||"ai-knowledge"===e.type||"web"===e.type||(0,m().SC)(e.type)?`${e.type}_${t.toString()}`:"teamspace"===e.type?`${e.type}_${e.teamStore.id}`:"page"===e.type?`${e.type}_${e.pageStore.id}`:"collection"===e.type?`${e.type}_${e.collectionId}`:"site"===e.type?`${e.type}_${e.siteStore.id}`:(0,x().HB)(e.type)}},879765:(e,t,n)=>{n.d(t,{$:()=>i});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"6.12 3.97 6.66 12.06",directional:!0,svg:(0,n(474848).jsx)("path",{d:"M6.308 9.558a.625.625 0 0 0 0 .884l5.4 5.4a.625.625 0 1 0 .884-.884L7.634 10l4.958-4.958a.625.625 0 1 0-.884-.884z"})},i=(0,n(340498).wt)("arrowChevronSingleLeft",a,"default")},892205:(e,t,n)=>{n.d(t,{FS:()=>ae,Jo:()=>te,tp:()=>ne,uU:()=>X,v8:()=>ee});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(581454);var a=n(296540),i=()=>n(664594),s=()=>n(907258),o=()=>n(484714),r=()=>n(590526),l=()=>n(401497),c=()=>n(849255),d=()=>n(350013),u=()=>n(498521),p=()=>n(127833),g=()=>n(30537),m=()=>n(420802),h=()=>n(396896),f=()=>n(807449),y=()=>n(546926),v=()=>n(631524),S=()=>n(160432),b=()=>n(302501),x=()=>n(890492),I=()=>n(81068),k=()=>n(663639),w=()=>n(736847),C=()=>n(452004),A=()=>n(784892),T=()=>n(187174),j=()=>n(101163),M=()=>n(835607),_=()=>n(253673),P=()=>n(96689),D=()=>n(848538),E=()=>n(798880),R=()=>n(695608),B=()=>n(69708),F=()=>n(100622),N=()=>n(763824),L=()=>n(534177),O=()=>n(165241),V=()=>n(603907),z=()=>n(56394),W=()=>n(187820),U=()=>n(453697),H=()=>n(484595),K=()=>n(881690),q=()=>n(297780),$=()=>n(698449),G=()=>n(118789),Y=()=>n(385226),Q=()=>n(169626),J=n(474848);const X=(0,B().YK)({usersPlaceholder:{id:"adminContentSearchTab.pagesTable.filters.users.usersPlaceholder",defaultMessage:"Search for users..."},usersAndGroupsPlaceholder:{id:"adminContentSearchTab.pagesTable.filters.users.usersAndGroupsPlaceholder",defaultMessage:"Search for users and groups..."},usersGroupsAndAgentsPlaceholder:{id:"adminContentSearchTab.pagesTable.filters.users.usersGroupsAndAgentsPlaceholder",defaultMessage:"Search for users, groups, and agents..."},untitledAgent:{id:"adminContentSearchTab.pagesTable.filters.users.untitledAgent",defaultMessage:"Untitled"}}),Z=10,ee={key:"no-results",action:()=>{},render:e=>(0,J.jsx)(b().A,{isSecondaryColor:!0,style:{width:"100%",margin:"8px 12px"},...e,children:(0,J.jsx)(B().sA,{id:"adminContentSearchTab.pagesTable.filters.users.noResultsMessage",defaultMessage:"No results found"})})};function te(e){const{title:t,selectedItems:n,setSelectedItems:l,onMenuClose:P,isMultiSelect:F,includePermissionGroups:te,includeGuests:oe,includeAgents:re=!1}=e,le=(0,B().tz)(),ce=(0,o().v3)(),de=(0,r().uB)(void 0,C().$),ue=se(),pe=(0,i().T)(),[ge,me]=(0,a.useState)(Z),[he,fe]=(0,a.useState)(!1),[ye,ve]=(0,a.useState)(""),Se=(0,r().O$)(s().AppStoreSidebarSpaceStore),be=(0,r().K8)((()=>O().i({userId:pe,spaceId:null==Se?void 0:Se.id,debugFrom:"UsersFilter"})),[pe,null==Se?void 0:Se.id]),xe=(0,G().n)({query:ye,filter:oe?void 0:D().v1,disable:!be}),{users:Ie,hasMore:ke}=(0,r().K8)((()=>({users:(null==xe?void 0:xe.rowsStore.state.rows)??[],hasMore:(null==xe?void 0:xe.rowsStore.state.hasMore)??!1})),[xe]),[{value:we}]=(0,T().Yb)((async()=>{if(!be)return e.userStores;if(!Se)return[];return await(0,N().lX)(Ie,Ie.length,(async e=>{const t=c().L.createChildStore(Se,{table:E().oo,id:e.id});return await t.load(),t}))}),[be,Se,Ie,e.userStores]),Ce=(0,a.useMemo)((()=>be?oe?new Set(Ie.filter((e=>"page_guest"===e.membership_type)).map((e=>e.id))):new Set:e.guestUserIdSet),[be,e.guestUserIdSet,Ie,oe]),Ae=(null==we?void 0:we.length)??0,Te=(0,a.useMemo)((()=>n.map((({id:e})=>e))),[n]),je=(0,r().K8)((()=>te?Q().h.getAllGroups():[]),[te]),Me=(0,r().K8)((()=>Se?n.filter((e=>"user"===e.type)).map((e=>c().L.createChildStore(Se,{table:E().oo,id:e.id}))).filter((e=>e.isReady())):[]),[n,Se]),_e=(0,r().K8)((()=>Te.map((e=>je.find((t=>t.group_id===e)))).filter(L().O9)),[Te,je]),Pe=(0,r().K8)((()=>{if(!re||!Se)return[];const e=V().j.getData(ce,{spaceId:Se.id,query:ye});return e?Object.entries(e.metaByWorkflowId).map((([e,t])=>({id:e,name:t.name??void 0,icon:t.icon??void 0}))):[]}),[re,Se,ye,ce]),De=(0,r().K8)((()=>Se?n.filter((e=>"agent"===e.type)).map((e=>d().N.createChildStore(Se,{table:"workflow",id:e.id,spaceId:Se.id}))).filter((e=>e.isReady())):[]),[n,Se]);function Ee(){be&&(null==xe||xe.refresh()),me(Z),fe(!1),ve(""),P()}function Re(){ve(""),l([])}function Be(e){be?e<5&&ke&&(null==xe||xe.loadMore()):e<5&&ge<Ae&&me(ge+Z)}function Fe(e){if(F){return Te.includes(e.id)?[...n.filter((({id:t})=>t!==e.id))]:[...n,e]}return Te.includes(e.id)?[]:[e]}function Ne(e){const t=Fe({id:e,type:"user"});l(t),ve("")}function Le(e){const t=Fe({id:e,type:"permission_group"});l(t),ve("")}function Oe(e){const t=Fe({id:e,type:"agent"});l(t),ve("")}const Ve=(0,a.useCallback)((e=>{ve(e.target.value)}),[]),ze=(0,r().K8)((()=>Me.map((e=>{const t=(0,R().c6)(le,e.getModel()),a=!!Ce&&Ce.has(e.id);return(0,J.jsx)(K().A,{isSingle:!0,format:A().NY.Inline,showRemoveButton:!0,onClickRemove:()=>{const t=n.filter((t=>t.id!==e.id));l(t)},style:a?ue.guestPillContainer:ue.pillContainer,value:(0,J.jsxs)(h().fI,{alignItems:"center",gap:4,children:[a?(0,J.jsx)(f().I,{icon:j().globeSmallIcon,size:"sm",colorPalette:"yellow",colorVariant:"accentPrimary"}):(0,J.jsx)(U().A,{userStore:e,size:16}),(0,J.jsx)(b().A,{children:t})]})},e.id)}))),[n,Me,l,Ce,ue,le]),We=(0,r().K8)((()=>_e.map((e=>{const t=$().Pf({intl:le,groupName:e.name});return(0,J.jsx)(K().A,{isSingle:!0,format:A().NY.Inline,showRemoveButton:!0,onClickRemove:()=>{const t=n.filter((t=>t.id!==e.group_id));l(t)},style:ue.pillContainer,value:(0,J.jsxs)("div",{style:ue.pillContents,children:[(0,J.jsx)(W().B6,{disabled:!0,icon:e.icon&&Se?{pointer:Se.pointer,icon:e.icon}:void 0,size:14,isEmptyPage:!1,title:t,defaultIcon:(0,J.jsx)(f().I,{icon:M().F,size:14})}),(0,J.jsx)(b().A,{style:ue.pillText,children:t})]})},e.id)}))),[n,_e,l,ue,Se,le]),Ue=(0,r().K8)((()=>De.map((e=>{const t=e.getName()||le.formatMessage(X.untitledAgent);return(0,J.jsx)(K().A,{isSingle:!0,format:A().NY.Inline,showRemoveButton:!0,onClickRemove:()=>{const t=n.filter((t=>t.id!==e.id));l(t)},style:ue.pillContainer,value:(0,J.jsxs)("div",{style:ue.pillContents,children:[(0,J.jsx)(W().B6,{disabled:!0,icon:e.getRawIcon()&&Se?{pointer:Se.pointer,icon:e.getRawIcon()??""}:void 0,size:14,isEmptyPage:!1,title:t,defaultIcon:(0,J.jsx)(f().I,{icon:M().F,size:14})}),(0,J.jsx)(b().A,{style:ue.pillText,children:t})]})},e.id)}))),[n,De,l,ue,Se,le]);const He=(0,J.jsx)(z().A,{on:Te.length>0,icon:(0,J.jsx)(f().I,{icon:_().personIcon}),title:t,onClick:()=>fe(!0)});return(0,J.jsx)(Y().A,{children:(0,J.jsx)(p().zD,{popupType:g().n.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",open:he,render:function(){const e=[];for(const n of we??[]){var t;const a=(0,R().c6)(le,n.getModel()),i=!!Ce&&Ce.has(n.id);(a.toLocaleLowerCase().includes(ye)||null!==(t=n.getEmail())&&void 0!==t&&t.toLocaleLowerCase().includes(ye))&&e.push({key:`user-${n.id}`,action:()=>Ne(n.id),render:e=>(0,J.jsx)(I().A,{...e,icon:F?(0,J.jsx)(m().S,{checked:Te.includes(n.id),onClick:()=>Ne(n.id),size:16}):(0,J.jsx)(H().A,{isSelected:Te.includes(n.id)}),focused:!1,title:(0,J.jsx)(ne,{userStore:n,isGuest:i})})})}const a=[];for(const n of je){$().Pf({intl:le,groupName:n.name}).toLocaleLowerCase().includes(ye)&&a.push({key:`group-${n.group_id}`,action:()=>Le(n.group_id),render:e=>(0,J.jsx)(I().A,{...e,icon:F?(0,J.jsx)(m().S,{checked:Te.includes(n.group_id),onClick:()=>Le(n.group_id),size:16}):(0,J.jsx)(H().A,{isSelected:Te.includes(n.group_id)}),focused:!1,title:(0,J.jsx)(ae,{group:n,spaceId:null==Se?void 0:Se.id})})})}const i=[];for(const n of Pe)i.push({key:`agent-${n.id}`,action:()=>Oe(n.id),render:e=>(0,J.jsx)(I().A,{...e,icon:F?(0,J.jsx)(m().S,{checked:Te.includes(n.id),onClick:()=>Oe(n.id),size:16}):(0,J.jsx)(H().A,{isSelected:Te.includes(n.id)}),focused:!1,title:(0,J.jsx)(ie,{agent:n,spaceId:null==Se?void 0:Se.id})})});let s=[];s=be?ke?[...e]:[...e,...a,...i]:[...e,...a,...i].slice(0,ge);const o={key:"userOptions",items:s.length>0?s:[ee],render:e=>(0,J.jsx)(w().A,{...e,title:null,loading:!1})};return(0,J.jsxs)("div",{style:ue.container,children:[(0,J.jsx)(q().A,{focus:!0,value:ye,style:ue.input,placeholder:le.formatMessage(re?X.usersGroupsAndAgentsPlaceholder:te?X.usersAndGroupsPlaceholder:X.usersPlaceholder),onChange:Ve,onRemoveLastToken:()=>{const e=n.slice(0,-1);l(e)},tokens:[...ze,...We,...Ue]}),(0,J.jsxs)(x().A,{menuType:y().gu.Popup,header:null,maxHeight:250,width:300,children:[(0,J.jsx)(k().A,{type:k().O.Vertical,store:de,initialFocus:0,sections:[o]}),(0,J.jsx)(u().A,{onChange:Be})]}),(0,J.jsxs)(w().A,{topBorder:!0,style:ue.footer,children:[(0,J.jsx)(v().p,{onClick:Re,children:(0,J.jsx)(B().sA,{id:"adminContentSearchTab.pagesTable.filters.users.clearButton",defaultMessage:"Clear"})}),(0,J.jsx)(S().A,{colorPalette:"blue",onClick:Ee,children:(0,J.jsx)(B().sA,{id:"adminContentSearchTab.pagesTable.filters.users.doneButton",defaultMessage:"Done"})})]})]})},onDismiss:Ee,keepFocus:!0,origin:He,preventScaleTransition:!0,originGap:8})})}function ne({userStore:e,isGuest:t}){const n=(0,B().tz)(),a=se(),i=(0,r().K8)((()=>e.getDisplayName(n)),[e,n]);return(0,J.jsxs)("div",{style:a.optionContainer,children:[(0,J.jsx)(U().A,{userStore:e,size:24,style:a.optionAvatar}),(0,J.jsxs)("div",{style:{paddingTop:4,paddingBottom:4},children:[(0,J.jsx)(b().A,{style:a.optionTitle,children:i}),(0,J.jsx)(b().A,{style:a.optionCaption,children:t?(0,J.jsx)(B().sA,{id:"adminContentSearchTab.pagesTable.filters.users.guestCaption",defaultMessage:"Guest"}):(0,J.jsx)(B().sA,{id:"adminContentSearchTab.pagesTable.filters.users.memberCaption",defaultMessage:"Member"})})]})]})}function ae({group:e,spaceId:t}){const n=se(),a=(0,B().tz)(),i=$().Pf({intl:a,groupName:e.name});return(0,J.jsxs)("div",{style:n.optionContainer,children:[(0,J.jsx)(W().B6,{disabled:!0,icon:e.icon&&t?{pointer:{id:t,table:P().NX},icon:e.icon}:void 0,size:22,isEmptyPage:!1,title:i,defaultIcon:(0,J.jsx)(f().I,{icon:M().F,size:22})}),(0,J.jsxs)("div",{style:{paddingTop:4,paddingBottom:4},children:[(0,J.jsx)(b().A,{style:n.optionTitle,children:i}),(0,J.jsx)(b().A,{style:n.optionCaption,children:(0,J.jsx)(B().sA,{id:"adminContentSearchTab.pagesTable.filters.users.groupCaption",defaultMessage:"Group"})})]})]})}function ie({agent:e,spaceId:t}){const n=(0,B().tz)(),a=se(),i=e.name||n.formatMessage(X.untitledAgent);return(0,J.jsxs)("div",{style:a.optionContainer,children:[(0,J.jsx)(W().B6,{disabled:!0,icon:e.icon&&t?{pointer:{id:t,table:P().NX},icon:e.icon}:void 0,size:22,isEmptyPage:!1,title:i,defaultIcon:(0,J.jsx)(f().I,{icon:M().F,size:22})}),(0,J.jsxs)("div",{style:{paddingTop:4,paddingBottom:4},children:[(0,J.jsx)(b().A,{style:a.optionTitle,children:i}),(0,J.jsx)(b().A,{style:a.optionCaption,children:(0,J.jsx)(B().sA,{id:"adminContentSearchTab.pagesTable.filters.users.agentCaption",defaultMessage:"Agent"})})]})]})}function se(){return(0,l().IS)((()=>({optionContainer:{display:"flex",flexDirection:"row",alignItems:"center",gap:8},optionAvatar:{marginInlineEnd:8},container:{padding:"6px 0 6px"},input:{margin:"4px auto",width:"95%",maxHeight:200,overflowY:"auto"},footer:{paddingTop:8,paddingInlineEnd:8,paddingBottom:2,paddingInlineStart:8,justifyContent:"space-between",display:"flex",flexDirection:"row"},pillContainer:{marginTop:0,marginInlineEnd:6,marginBottom:6,marginInlineStart:0,background:F().Tj.gray.background.secondaryTranslucent,height:20},guestPillContainer:{marginTop:0,marginInlineEnd:6,marginBottom:6,marginInlineStart:0,background:F().Tj.yellow.background.secondaryTranslucent,height:20},pillContents:{display:"inline-flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:8},pillText:{marginInlineStart:4},optionTitle:{display:"block"},optionCaption:{display:"block",color:F().Tj.text.secondary,fontSize:12,lineHeight:"15px"}})),[])}},893497:(e,t,n)=>{n.d(t,{L:()=>r});var a=n(296540),i=()=>n(756117),s=()=>n(401497),o=n(474848);function r(e){const{children:t,style:n,visible:r,onShow:l,onHide:c,...d}=e,u=(0,a.useCallback)((()=>{null==l||l()}),[l]),p=(0,a.useCallback)((()=>{r||null==c||c()}),[r,c]),g=(0,s().IS)((()=>({wrapper:{...n,position:"absolute",pointerEvents:r?"auto":"none",cursor:"default"}})),[n,r]);return(0,o.jsx)(i().A,{...d,visible:r,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onAnimationStart:u,onAnimationEnd:p,style:g.wrapper,children:t})}},895933:(e,t,n)=>{n.d(t,{A:()=>s});class a extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}setOriginComponent(e){this.setState({...this.state,originComponent:e})}}const i=new a,s=i;(0,n(852832).exposeDebugValue)("assistantScopedSearchMenuPopupStore",i)},895959:(e,t,n)=>{n.d(t,{aY:()=>M,so:()=>j});n(581454);var a=n(296540),i=()=>n(907258),s=()=>n(726637),o=()=>n(484714),r=()=>n(590526),l=()=>n(401497),c=()=>n(250910),d=()=>n(631524),u=()=>n(26697),p=()=>n(404931),g=()=>n(324254),m=()=>n(69708),h=()=>n(100622),f=()=>n(496603),y=()=>n(284371),v=()=>n(656134),S=()=>n(631611),b=()=>n(466088),x=()=>n(611947),I=()=>n(255350),k=()=>n(604018),w=()=>n(152870),C=()=>n(780175),A=n(474848);const T=(0,m().YK)({tooltip:{id:"assistantFindInSelector.tooltipNew",defaultMessage:"Find in connected apps, pages, more..."},writerTooltip:{id:"assistantFindInSelector.writerTooltip",defaultMessage:"Write using knowledge in..."},disabledTooltip:{id:"assistantFindInSelector.disabledTooltip",defaultMessage:"Search scope is tied to your selected skill."},default:{id:"assistantFindInSelector.default",defaultMessage:"All"},defaultVerbose:{id:"assistantFindInSelector.defaultVerbose",defaultMessage:"All sources"},scopeTitle:{id:"assistantFindInSelector.scopeTitle",defaultMessage:"In{spaceTokenPleaseIgnore}{scopeTitle}"},scopeTitleWithoutIn:{id:"assistantFindInSelector.scopeTitleWithoutIn",defaultMessage:"{scopeTitle}"}});function j(e){const{useVerboseTitle:t,showIcons:n,restoreLastHumanStep:a=!1}=e,f=(0,o().v3)(),k=(0,m().tz)(),w=(0,v().j)(),j=(0,S().jw)(),M=(0,r().O$)(i().AppStoreSidebarSpaceStore),_=(0,r().K8)((()=>(0,b().w)(f)),[f]),D=(0,C().wh)(),E=(0,C().CZ)(),R=(0,r().K8)((()=>{if(!E)return!1;const{selectedSkillFromStoreState:e}=E;if(!e)return!1;return(0,p().dc)(e.clientSkill.skillType).requiresInput&&!E.getHasCommittedHumanStep()}),[E]),B=(0,r().K8)((()=>{const e=(0,A.jsx)(m().sA,{...t?T.defaultVerbose:T.default});if(!M)return e;const{scopeTitle:n,dontShowPrepositionalCopy:a}=(0,I().tu)({environment:f,searchScope:D,spaceStore:M,intl:k});return n?a?(0,A.jsx)(m().sA,{...T.scopeTitleWithoutIn,values:{scopeTitle:n}}):(0,A.jsx)(m().sA,{...T.scopeTitle,values:{spaceTokenPleaseIgnore:" ",scopeTitle:n}}):e}),[D,M,k,t,f]),F=(0,l().IS)((()=>({buttonContainer:{display:"flex",gap:4,alignItems:"center",flexShrink:1,maxWidth:n?180:120,marginInlineStart:-6,borderRadius:6,...n?{height:28}:{}},scopeTitle:{fontSize:s().A.isMobile?14:12,color:h().Tj.text.tertiary,fontWeight:y().Wy.medium,...y().RC}})),[n]);return _?null:(0,A.jsx)(c().A,{popupType:w,disabled:R,placementToOrigin:"top",alignmentToOrigin:"start",onClick:()=>{x().dismissTutorial(f,"enhanced-qna-onboarding")},renderOrigin:e=>(0,A.jsx)(u().m,{placement:"top",alignment:"center",renderTooltip:()=>R?(0,A.jsx)(m().sA,{...T.disabledTooltip}):(0,A.jsx)(m().sA,{...j.isWriter?T.writerTooltip:T.tooltip}),render:t=>(0,A.jsxs)(d().p,{size:"xs",disabled:R,style:F.buttonContainer,...t,...e,iconTrailing:R?void 0:{icon:g().arrowChevronSingleDownSmallIcon,colorVariant:"tertiary",size:"sm"},children:[n?(0,A.jsx)(P,{}):void 0,(0,A.jsx)("div",{style:F.scopeTitle,children:B})]})}),render:e=>(0,A.jsx)(C().Ay,{buttonPopupParent:e,analyticsSource:"text_input",restoreLastHumanStep:a})})}function M(e){return e}const _=2;function P(){const e=(0,C().wh)(),t=(0,r().K8)(k().wd,[]),n=(0,a.useMemo)((()=>{if(0===t.length)return["notion"];const{type:n}=e;return"everything"===n?["notion",...t.map((e=>e))]:"notion"===n||"workspace"===n||"teamspace"===n||"collection"===n||"page"===n||"labeler"===n||"site"===n||"slackbot"===n||"universal-none"===n||"notion-none"===n||"universal-workspace"===n?["notion"]:[n]}),[e,t]),i=f().sb(n);return(0,A.jsx)(w().RH,{icons:i.slice(0,_),plusNBubble:i.length>_?i.length-_:void 0,iconSize:12,bubbleSize:20,marginLeft:-3})}},897526:(e,t,n)=>{n.d(t,{Z:()=>h});var a=n(296540),i=()=>n(907258),s=()=>n(60481),o=()=>n(17022),r=()=>n(484714),l=()=>n(590526),c=()=>n(232615),d=()=>n(534177),u=()=>n(486674),p=()=>n(466088),g=()=>n(206051),m=()=>n(525569);function h(e){const{assistantSurface:t}=e,n=(0,r().v3)(),h=(0,a.useMemo)((()=>o().e.withListenerIgnored((()=>{var e;return null===(e=i().default.state.currentUserSettingsStore)||void 0===e?void 0:e.getSettings()}))),[]);return(0,l().K8)((()=>{const e=(0,u().a)(),a=m().default.state;let i,r;if("assistantCompletionPopup"===a.type)if("textSelection"===a.context.type||"cursor"===a.context.type){if(i={mode:"editing",multiSelection:a.context.textSelection,forceExtendAnnotations:{}},"textSelection"===a.context.type)r={phase:s().o.Editing,stores:a.context.stores};else if("cursor"===a.context.type){const e=a.context.currentBlock?[a.context.currentBlock]:[];r={phase:s().o.Editing,stores:e}}}else"blockSelection"===a.context.type?(i={mode:"empty"},r={phase:s().o.Selected,stores:a.context.stores}):(0,d().HB)(a.context);else i=c().default.state,r=g().default.state;return o().e.withListenerIgnored((()=>t.surfaceSupportsContextWithSelection?{type:"assistant",surface:t.type,selectionState:r,textSelectionState:i,pageStore:e,userSettings:h,isMobile:t.isMobile,requestedOnPublicDomain:Boolean((0,p().w)(n))}:{type:"assistant",surface:t.type,pageStore:e,userSettings:h,isMobile:t.isMobile,requestedOnPublicDomain:Boolean((0,p().w)(n))}))}),[t,n,h])}},898615:(e,t,n)=>{n.d(t,{F:()=>s});n(296540);var a=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"2.37 3.13 15.26 14.86",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M9.533 5.813a.625.625 0 0 1 .884 0l2.5 2.5a.625.625 0 1 1-.884.884l-1.408-1.408v3.966a.625.625 0 1 1-1.25 0V7.739L7.917 9.197a.625.625 0 0 1-.884-.884z"}),(0,a.jsx)("path",{d:"M15.5 3.13c1.174 0 2.125.951 2.125 2.125v7.5A2.125 2.125 0 0 1 15.5 14.88h-4.935l-3.871 2.978a.625.625 0 0 1-1.006-.496V14.88H4.5a2.125 2.125 0 0 1-2.125-2.125v-7.5c0-1.174.951-2.125 2.125-2.125zm.875 2.125a.875.875 0 0 0-.875-.875h-11a.875.875 0 0 0-.875.875v7.5c0 .483.392.875.875.875h1.813c.345 0 .625.28.625.625v1.838l3.033-2.334a.63.63 0 0 1 .381-.13H15.5a.875.875 0 0 0 .875-.874z"})]})},s=(0,n(340498).wt)("commentArrowUp",i,"default")},899377:(e,t,n)=>{n.d(t,{lt:()=>Te,hM:()=>De,RK:()=>Pe});n(581454);var a=n(296540),i=()=>n(907258),s=()=>n(242422),o=()=>n(248140),r=()=>n(726637),l=()=>n(383036),c=()=>n(484714),d=()=>n(590526),u=()=>n(401497),p=()=>n(517415),g=()=>n(94484),m=()=>n(718827),h=()=>n(127833),f=()=>n(250910),y=()=>n(807449),v=()=>n(695115),S=()=>n(546926),b=()=>n(493552),x=()=>n(26697),I=()=>n(890492),k=()=>n(81068),w=()=>n(663639),C=()=>n(736847);const A=["notionSourceNumResults"];var T=()=>n(563217),j=()=>n(324254),M=()=>n(477336),_=()=>n(627503),P=()=>n(725900),D=()=>n(361173),E=()=>n(395546),R=()=>n(261403),B=()=>n(523389),F=()=>n(241863),N=()=>n(72563),L=()=>n(69708),O=()=>n(100622),V=()=>n(769864),z=()=>n(495262),W=(n(944114),n(964979),()=>n(755531)),U=()=>n(692031),H=()=>n(212497),K=()=>n(79926),q=()=>n(609679),$=()=>n(445770),G=()=>n(457726),Y=()=>n(869190),Q=()=>n(158115),J=()=>n(62900),X=()=>n(496603),Z=()=>n(973647),ee=()=>n(534177),te=()=>n(162437),ne=()=>n(483730),ae=()=>n(862292),ie=n(474848);const se="general_assistant";function oe(e){var t;const n=le(null==e?void 0:e.sessionId),a=ce(null==e?void 0:e.sessionId);return{...null==n?void 0:n.getInferenceInputForEval({skipLastAssistantStep:!1,appendPreviewingStepForDebug:a}),clientSteps:((e&&(null===(t=ne().default.getSessionContext(e.sessionId))||void 0===t?void 0:t.getCombinedSteps()))??[]).map((e=>(0,G().og)({step:e})))}}function re(e){const{buttonPopupParent:t}=e,n=(0,L().tz)(),i=(0,c().v3)(),{value:o}=(0,K().fJ)(ae().T.formulas),[r,u]=(0,a.useState)(void 0),p=(0,d().K8)((()=>function(e,t,n){const a=[];for(const[l,c]of(0,ee().WP)(ne().default.state.sessions)){var i,o,r;if(!c)continue;const d=null===(i=c.assistantConfigurationStore.state)||void 0===i?void 0:i.sessionStartTimestamp,u=Z().Q.unwrapOr((0,$().Bm)({intl:e,steps:X().oE([...c.evaluatorFromStoreState.getTranscript(),c.previewingStepFromStoreState]),experimentService:s().default,formulasModule:t,spaceIdCreator:n.idCreator.getSpaceIdCreatorSync((null===(o=(0,W().S)())||void 0===o?void 0:o.id)??"")}),void 0);a.push({sessionId:l.toString(),skillType:null==c||null===(r=c.selectedSkillFromStoreState)||void 0===r?void 0:r.clientSkill.skillType,timestamp:void 0!==d?(0,Y().jE)(d,q().locale,e):void 0,humanMessage:u})}return a}(n,o,i)),[n,o,i]),g=(0,a.useCallback)((async()=>{const e=le(null==r?void 0:r.sessionId),t=(null==e?void 0:e.getTranscript())??[],n=ce(null==r?void 0:r.sessionId);n&&t.push(n);const a=JSON.stringify(t),[s,o]=await Promise.all([(0,U().r)(),(0,H().jd)()]);o({environment:i,stringValue:a,copiedMessage:s.copiedToClipboard})}),[r,i]),m=(0,a.useCallback)((async()=>{const e=le(null==r?void 0:r.sessionId),t=ce(null==r?void 0:r.sessionId),n=null==e?void 0:e.getInferenceInputForEval({skipLastAssistantStep:!0,appendPreviewingStepForDebug:t}),a=JSON.stringify(n),[s,o]=await Promise.all([(0,U().r)(),(0,H().jd)()]);o({environment:i,stringValue:a,copiedMessage:s.copiedToClipboard})}),[r,i]),h=(0,a.useCallback)((()=>{const e=JSON.stringify(oe(r)),t=btoa(encodeURIComponent(e));window.open(`/design/aiJsonRenderer#jsonl=${t}`,"_blank")}),[r]),f=(0,a.useCallback)((()=>{const e=JSON.stringify(oe(r)),t=btoa(encodeURIComponent(e));window.open(`/design/inferenceEvals#jsonl=${t}`,"_blank")}),[r]),b=(0,a.useCallback)((()=>{if(void 0===(null==r?void 0:r.sessionId))return;const e=ne().default.getSessionContextOrThrow(null==r?void 0:r.sessionId),t=e.latestCommitInferenceIdFromStoreState;(0,te().$)({environment:i,inferenceId:t,type:"assistant_step",sessionId:e.sessionIdFromStoreState,source:void 0,debugShareWithSpace:!0});const n=`https://www.braintrust.dev/app/Notion/p/production-prompt-assistant/logs?r=${t}`;window.open(n,"_blank")}),[r,i]),A=(0,a.useCallback)((()=>{void 0!==(null==r?void 0:r.sessionId)&&window.open(`https://app.datadoghq.com/apm/traces?query=%40aiSessionId%3A${r.sessionId}`,"_blank")}),[r]),T={key:"debug-data",render:e=>(0,ie.jsx)(C().A,{...e,desktopTitleStyle:{alignItems:"center",paddingInlineStart:2,marginTop:0},title:(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(v().A,{icon:J().arrowStraightLeftSmallIcon,ariaLabel:n.formatMessage({id:"assistantDebugPopupMenu.backButton",defaultMessage:"Back button"}),onClick:()=>u(void 0)}),(null==r?void 0:r.skillType)??se]}),right:null==r?void 0:r.timestamp}),items:[{key:"copy-transcript",render:e=>(0,ie.jsx)(k().A,{...e,title:"Copy transcript"}),action:()=>{g(),t.close()}},{key:"copy-eval",render:e=>(0,ie.jsx)(k().A,{...e,title:"Copy as AssistantInferenceInput"}),action:()=>{m(),t.close()}},{key:"open-in-jsonl-viewer",render:e=>(0,ie.jsx)(k().A,{...e,title:"Open in JSONL viewer"}),action:()=>{h(),t.close()}},{key:"open-in-labeler",render:e=>(0,ie.jsx)(k().A,{...e,title:"Open in inferenceEvals"}),action:()=>{f(),t.close()}},{key:"share-braintrust-link",render:e=>(0,ie.jsx)(k().A,{...e,title:"Open in Braintrust"}),action:()=>{b(),t.close()}},{key:"find-datadog-traces",render:e=>(0,ie.jsx)(k().A,{...e,title:"Find Datadog traces"}),action:()=>{A(),t.close()}}]},j=p.map((e=>{const{sessionId:t,skillType:n,timestamp:a,humanMessage:i=""}=e,s={maxWidth:250,overflow:"hidden",textWrap:"wrap"};return{key:t,action:()=>{u(e)},render:e=>(0,ie.jsx)(x().m,{render:t=>(0,ie.jsx)(k().A,{...(0,l().A)(e,t),title:i?`${i}`:n??se,right:(0,ie.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[a,(0,ie.jsx)(y().I,{icon:Q().arrowChevronSingleRightFillSmallIcon,size:"xs"})]})}),renderTooltip:()=>(0,ie.jsx)("div",{style:s,children:i}),placement:"left"})}})),M={key:"sessions",render:e=>(0,ie.jsx)(C().A,{...e}),items:j},_={key:"empty",render:e=>(0,ie.jsx)(C().A,{...e}),items:[{key:"empty-item",action:()=>{},render:e=>(0,ie.jsx)(k().A,{...e,title:"No sessions found"})}]},P=r?T:j.length>0?M:_;return(0,ie.jsx)(I().A,{menuType:S().gu.Popup,width:300,children:(0,ie.jsx)(w().A,{type:w().O.Vertical,initialFocus:0,sections:[P]})})}function le(e){var t;if(e)return null===(t=ne().default.getSessionContext(e))||void 0===t?void 0:t.evaluatorFromStoreState}function ce(e){if(!e)return;const t=ne().default.getSessionContextOrThrow(e);return null==t?void 0:t.previewingStepFromStoreState}var de=()=>n(820559),ue=()=>n(631611),pe=()=>n(68465);n(898992),n(672577);class ge extends(()=>n(757695))().Store{getInitialState(){return{subTab:"by_topic",loadingState:{type:"loaded",pageId:void 0,lastFetched:void 0},topics:[],initialSuggestions:[]}}getSubTab(){return this.state.subTab}setSubTab(e){this.update((t=>({...t,subTab:e})))}createTopicCard(e){this.update((t=>({...t,topics:[...t.topics,{clientId:n(206267).JW(),title:e,loadingState:"initial",isExpanded:!0}]})))}setGroupIsExpanded(e,t){this.update((n=>({...n,initialSuggestions:n.initialSuggestions.map((n=>n.clientId===e?{...n,isExpanded:t}:n))})))}getTopicByClientId(e){return this.state.topics.find((t=>t.clientId===e))}setTopicIsExpanded(e,t){this.update((n=>({...n,topics:n.topics.map((n=>n.clientId===e?{...n,isExpanded:t}:n))})))}setTopicLoading(e,t){this.update((n=>({...n,topics:n.topics.map((n=>n.clientId===e?{...n,loadingState:t,clientId:e}:n))})))}setTopic(e,t){this.update((n=>({...n,topics:n.topics.map((n=>n.clientId===e?{...t,clientId:e}:n))})))}}const me=new ge,he=me;(0,n(852832).exposeDebugValue)("AiContextStore",me);var fe=()=>n(101927),ye=()=>n(770636);function ve(){const e=(0,c().v3)(),t=(0,u().IS)((()=>({button:{color:O().Tj.text.tertiary,padding:"0 2px"}})),[]),n=(0,d().K8)((()=>(0,fe().aD)(e)),[e]),i=(0,d().K8)((()=>{const t=(0,fe().DE)(e);return n.find((e=>e===t))}),[n,e]),s=(0,a.useCallback)((e=>{(0,fe().ie)(e)}),[]);return(0,ie.jsx)(f().A,{popupType:r().A.isMobile?f().z.SlideUp:f().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",renderOrigin:e=>(0,ie.jsx)(m().Ay,{style:t.button,...e,children:i??"Default model"}),render:e=>(0,ie.jsx)(I().A,{menuType:S().gu.Popup,width:350,children:(0,ie.jsx)(w().A,{type:w().O.Vertical,initialFocus:0,sections:[{key:"models",render:e=>(0,ie.jsx)(C().A,{...e}),items:n.map((t=>({key:t||"default",action:()=>{s(t),e.close()},render:e=>(0,ie.jsx)(k().A,{...e,title:t||"Default model",isChecked:t===i||!t&&!i,shouldWrapCaption:!0})})))}]})})})}var Se=()=>n(118307),be=()=>n(656134),xe=()=>n(195181);const Ie={mode:"default",name:"Default search",description:"Use the default search mode."},ke=[{mode:"notionOnly",name:"Notion Only",description:" Don't query universal search sources"},{mode:"esQueryNLastEdited200Pages",name:"Limited Q&A",description:"Limited Q&A on `es_query_n_last_edited_200_pages`"},{mode:"secondPage",name:"Second Page",description:"Consult the next page of search results."},{mode:"gpt4Rerank",name:"GPT-4 Rerank",description:"Uses GPT4 to classify search results into {relevant, not} and reranks them."},{mode:"firstResult",name:"First Result",description:"Only return the top result, for debugging."},{mode:"firstTwoResults",name:"Two Results",description:"Only return the two result, for debugging."}];function we(){const e=(0,d().K8)((()=>ne().default.getActiveSession()),[]),t=(0,d().K8)((()=>{var t,n;return e?null===(n=e.assistantConfigurationStore)||void 0===n?void 0:n.getSearchModeForNonRetry():null===(t=(0,fe().q$)({isWriter:!1,onPublicDomain:!1}).searchOverrides)||void 0===t?void 0:t.searchMode}),[e]),n=(0,a.useCallback)((t=>{de().A.setState({...de().A.state,searchOverrides:"default"===t?void 0:{searchMode:t}}),null==e||e.assistantConfigurationStore.setSearchMode(t)}),[e]),i=(0,u().IS)((()=>({button:{color:O().Tj.text.tertiary,padding:"0 2px"}})),[]),s=[Ie,...ke].find((({mode:e})=>e===t))??Ie;return(0,ie.jsx)(Ce,{renderOrigin:({buttonPopupEvents:e})=>(0,ie.jsx)(x().m,{renderTooltip:()=>(0,ie.jsx)("div",{children:s.description}),placement:"bottom",alignment:"center",render:t=>(0,ie.jsx)(m().Ay,{...(0,l().A)(e,t),style:i.button,children:s.name})}),onSelect:n})}function Ce(e){const{renderOrigin:t,onSelect:n,selectedModeForStyling:a}=e,i=(0,d().uB)(void 0,Se().A),s=(0,u().IS)((()=>({selectedMode:{backgroundColor:O().Tj.sidebarItemSelectedBackground}})),[]),o=(0,be().j)();return(0,ie.jsx)(f().A,{buttonPopupStore:i,popupType:o,placementToOrigin:"top",alignmentToOrigin:"center",renderOrigin:e=>t({buttonPopupEvents:e,onOpen:()=>{i.setState({open:!0})}}),render:e=>(0,ie.jsx)(I().A,{menuType:S().gu.Popup,width:350,children:(0,ie.jsx)(w().A,{type:w().O.Vertical,initialFocus:0,sections:[{key:"modes",render:e=>(0,ie.jsx)(C().A,{...e}),items:[Ie,...ke].map((({mode:t,name:i,description:o})=>({key:t,action:()=>{null==n||n(t),e.close()},render:e=>(0,xe().Bg)(t)?(0,ie.jsx)(x().m,{placement:"left",renderTooltip:()=>(0,ie.jsx)("div",{style:{whiteSpace:"pre",fontFamily:"monospace"},children:JSON.stringify(xe().BG[t],null,2)}),delayThreshold:0,render:n=>(0,ie.jsx)(k().A,{...n,...e,onMouseEnter:t=>{var a;null===(a=n.onMouseEnter)||void 0===a||a.call(n,t),e.onMouseEnter(t)},style:a===t?s.selectedMode:void 0,title:i,caption:o,shouldWrapCaption:!0})}):(0,ie.jsx)(k().A,{...e,title:i,style:a===t?s.selectedMode:void 0,caption:o,shouldWrapCaption:!0})})))}]})})})}var Ae=()=>n(758632);function Te(){const e=(0,u().IS)((()=>({wrap:{display:"flex",alignItems:"center",fontSize:r().A.isMobile?14:11,height:28,justifyContent:"space-between",padding:"0 8px",backgroundColor:O().Tj.popoverBackground,borderBottom:`1px solid ${O().Tj.border.secondaryTranslucent}`},sideWrap:{display:"flex",alignItems:"center",gap:8},title:{fontStyle:"italic",cursor:"default"}})),[]),t=(0,d().K8)((()=>(0,fe().NA)()),[]),n=(0,d().O$)(i().AppStoreSidebarSpaceStore);return(0,ie.jsxs)("div",{style:e.wrap,children:[(0,ie.jsxs)("div",{style:e.sideWrap,children:[t?void 0:(0,ie.jsx)("div",{style:e.title,children:"Debug Tools"}),(0,ie.jsx)(ve,{}),t?(0,ie.jsx)(we,{}):void 0]}),(0,ie.jsxs)("div",{style:e.sideWrap,children:[(0,ie.jsx)(De,{}),n?(0,ie.jsx)(Re,{currentSpaceStore:n}):void 0,(0,ie.jsx)(Ee,{}),(0,ie.jsx)(Pe,{}),(0,ie.jsx)(_e,{}),(0,ie.jsx)(Me,{}),(0,ie.jsx)(Be,{})]})]})}function je(e){return(0,ie.jsx)(x().m,{placement:"bottom",alignment:"center",delayThreshold:0,...e})}function Me(){const e=(0,L().tz)(),t=Ne();return(0,ie.jsx)(f().A,{popupType:r().A.isMobile?f().z.SlideUp:f().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",renderOrigin:n=>(0,ie.jsx)(je,{renderTooltip:()=>(0,ie.jsx)("div",{children:"Copy transcripts"}),render:a=>(0,ie.jsx)(v().A,{...(0,l().A)(n,a),style:t.iconButton,icon:_().a,ariaLabel:e.formatMessage({id:"assistant.debugBar.copyButton.label",defaultMessage:"Copy"})})}),render:e=>(0,ie.jsx)(re,{buttonPopupParent:e})})}function _e(){const e=(0,L().tz)(),t=Ne(),n=(0,d().K8)((()=>{var e;return(null===(e=de().A.state)||void 0===e?void 0:e.showSearchDebugPanel)??!1}),[]),a=(0,d().K8)((()=>()=>{var e;const t=!n;null===de().A||void 0===de().A||de().A.setState({...de().A.state,showSearchDebugPanel:t,searchOverrides:!1===t||null===(e=de().A.state)||void 0===e?void 0:e.searchOverrides})}),[n]);return(0,ie.jsx)(je,{renderTooltip:()=>(0,ie.jsx)("div",{children:`Toggle search debug mode [${n?"ON":"OFF"}]`}),render:i=>(0,ie.jsx)(v().A,{...i,style:t.iconButton,icon:n?D().infoCircleFillSmallIcon:E().infoCircleSmallIcon,onClick:a,ariaLabel:e.formatMessage({id:"assistant.debugBar.toggleSearchDebugModeButton.label",defaultMessage:"Toggle search debug mode"})})})}function Pe(){const e=(0,L().tz)(),t=Ne(),n=(0,d().K8)((()=>(0,pe().cJ)()),[]),i=(0,a.useCallback)((()=>{o().A.updateLocalOverrideGate("assistant-labeler-mode",!n)}),[n]);return(0,ie.jsx)(je,{renderTooltip:()=>(0,ie.jsx)("div",{children:`Toggle labeler mode [${n?"ON":"OFF"}]`}),render:a=>(0,ie.jsx)(v().A,{...a,style:t.iconButton,icon:n?N().priceTagFillIcon:F().priceTagIcon,onClick:i,ariaLabel:e.formatMessage({id:"assistant.debugBar.toggleLabelerModeButton.label",defaultMessage:"Toggle labeler mode"})})})}function De(){const e=(0,L().tz)(),t=Ne(),n=(0,c().v3)(),i=(0,ue().jw)(),s=(0,a.useCallback)((()=>{(0,fe().c6)(!1),(0,p().r)({item:{label:"Debug bar hidden",...i.isWriter?{durationMs:g().LX}:{}},undoFunc:()=>{z().tN({environment:n,preventSelectText:!0}),(0,fe().c6)(!0)}})}),[i,n]),o=e.formatMessage({id:"assistant.debugBar.hideButton.label",defaultMessage:"Hide debug helpers"});return(0,ie.jsx)(je,{renderTooltip:()=>(0,ie.jsx)("div",{children:o}),render:e=>(0,ie.jsx)(v().A,{...e,style:t.iconButton,icon:P().V,ariaLabel:o,onClick:s})})}function Ee(){const e=(0,L().tz)(),t=Ne(),n=(0,Ae().C)(),a=e.formatMessage({id:"assistant.debugBar.editLastStepButton.label",defaultMessage:"Edit last assistant step"});return(0,ie.jsx)(je,{renderTooltip:()=>(0,ie.jsx)("div",{children:a}),render:e=>(0,ie.jsx)(v().A,{...e,style:t.iconButton,icon:B().pencilLineSmallIcon,ariaLabel:a,onClick:n})})}function Re(e){const{currentSpaceStore:t}=e,n=(0,L().tz)(),i=Ne(),s=(0,d().K8)((()=>ne().default.getActiveSession()),[]),o=(0,ye().H)({sessionContext:s,currentSpaceStore:t}),r=(0,d().K8)((()=>"empty_state"===o.type&&"loading"===he.state.loadingState.type),[o.type]),l=(0,a.useCallback)((()=>{}),[]),c=n.formatMessage({id:"assistant.debugBar.reloadSuggestionsButton.label",defaultMessage:"Reload suggestions"});return r?null:(0,ie.jsx)(je,{renderTooltip:()=>(0,ie.jsx)("div",{children:c}),render:e=>(0,ie.jsx)(v().A,{...e,style:i.iconButton,icon:M().l,ariaLabel:c,onClick:l})})}function Be(){const e=(0,L().tz)(),t=(0,u().IS)((()=>({icon:{width:20,height:20},developerToolsDescription:{width:320,whiteSpace:"pre-wrap",padding:8}})),[]);return(0,ie.jsx)("div",{children:(0,ie.jsx)(f().A,{popupType:h().nl.Popup,renderOrigin:({onClick:n})=>(0,ie.jsx)(x().m,{renderTooltip:()=>(0,ie.jsxs)("div",{style:t.developerToolsDescription,children:["Deep Find developer tools",(0,ie.jsx)(b().D,{styleKey:"captionMedium",colorVariant:"secondary",children:"Updates are made to statsig server, reset any local overrides to keep server-side configs in sync. Changes will take a few seconds to propagate through statsig. If your change doesn't take effect after 10 seconds, try refreshing the page."})]}),render:a=>(0,ie.jsx)(v().A,{...a,style:t.icon,icon:R().R,onClick:n,ariaLabel:e.formatMessage({id:"assistant.debugBar.deepFindDeveloperToolsButton.label",defaultMessage:"Button to open developer tools"})})}),render:()=>(0,ie.jsx)("div",{style:{padding:8},children:A.map((e=>(0,ie.jsx)(Fe,{type:"dynamic",id:e},e)))})})})}function Fe(e){const{type:t,id:n}=e,i=(0,c().v3)(),[r,l]=(0,a.useState)(0),p=(0,u().IS)((()=>({sectionTitle:{display:"flex",marginBottom:4,alignItems:"center",gap:6,paddingInlineStart:14,paddingInlineEnd:14},buttonForButtonPopup:{paddingInlineStart:14,paddingInlineEnd:14,paddingTop:8,paddingBottom:8,borderRadius:8,width:"fit-content",display:"flex",gap:6,alignItems:"center"}})),[]),g=(0,d().K8)((()=>"experiment"===t?s().default.getEligibleGroup({experimentId:n}):"gate"===t?s().default.checkGate({gateName:n}).toString():s().default.getConfigKey("deep_find_config",n)),[n,t,r]),h="experiment"===t?(0,T().XZ)(n):"gate"===t?["true","false"]:[],v=(0,a.useCallback)((async()=>{await new Promise((e=>{setTimeout(e,5e3)}));const e=o().A.getStatsigClient();if(e){var t;const n=null===(t=e.getContext())||void 0===t?void 0:t.user;n&&(await e.updateUserAsync(n),o().A.emit(),l((e=>e+1)))}}),[]),x=(0,a.useCallback)((e=>{"experiment"===t?V().callApi({eventName:"setStatsigExperimentUserOverride",environment:i,data:{experimentName:n,group:e}}).then((()=>v())):"gate"===t&&V().callApi({eventName:"setStatsigGateUserOverride",environment:i,data:{gateName:n,enabled:"true"===e}}).then((()=>v()))}),[n,t,i,v]),A="dynamic"===t;return(0,ie.jsxs)("div",{children:[(0,ie.jsx)(b().D,{styleKey:"captionMedium",colorVariant:"tertiary",style:p.sectionTitle,children:n}),A?(0,ie.jsx)(b().D,{style:p.buttonForButtonPopup,styleKey:"bodyRegular",colorVariant:"primary",children:g}):void 0,A?void 0:(0,ie.jsx)(f().A,{popupType:f().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",renderOrigin:e=>(0,ie.jsxs)(m().Ay,{...e,style:p.buttonForButtonPopup,children:[(0,ie.jsx)(b().D,{styleKey:"bodyRegular",colorVariant:"primary",children:g}),(0,ie.jsx)(y().I,{icon:j().arrowChevronSingleDownSmallIcon,size:"sm"})]}),render:e=>(0,ie.jsx)(I().A,{menuType:S().gu.Popup,children:(0,ie.jsx)(w().A,{type:w().O.Vertical,initialFocus:0,sections:[{key:n,render:e=>(0,ie.jsx)(C().A,{...e,shouldShowBottomDivider:!0}),items:h.map((t=>({key:t,action:()=>{x(t),e.close()},render:e=>(0,ie.jsx)(k().A,{...e,title:(0,ie.jsx)(b().D,{colorVariant:"primary",styleKey:"bodyRegular",children:t}),isChecked:g===t})})))}]})})})]})}function Ne(){return(0,u().IS)((()=>({iconButton:{height:20,width:20}})),[])}},899483:(e,t,n)=>{n.d(t,{ts:()=>it,cE:()=>At,Mo:()=>et,Az:()=>tt,M9:()=>gt,ln:()=>xt,d4:()=>pt,G3:()=>jt,OB:()=>Dt,Ml:()=>Et,TG:()=>kt,CH:()=>Xe});n(18107),n(410838),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(967357),n(898992),n(354520),n(672577),n(803949),n(581454),n(814603),n(147566),n(198721);var a=n(296540),i=()=>n(564884),s=()=>n(907258),o=()=>n(755531),r=()=>n(726637),l=()=>n(381175),c=()=>n(484714),d=()=>n(943101),u=()=>n(590526),p=()=>n(401497),g=()=>n(79926),m=()=>n(295633),h=()=>n(699143),f=()=>n(996332),y=()=>n(127833),v=()=>n(30537),S=()=>n(680474),b=()=>n(807449),x=()=>n(695115),I=()=>n(265060),k=()=>n(631524),w=()=>n(493552),C=()=>n(26697),A=()=>n(902006),T=()=>n(241178),j=()=>n(203717),M=()=>n(584262),_=()=>n(457726),P=()=>n(252050),D=()=>n(172385),E=()=>n(239666),R=()=>n(869190),B=()=>n(626466),F=n(474848);const N={viewBox:"0 0 20 20",fittedViewBox:"3.72 6.12 12.56 7.16",svg:(0,F.jsx)("path",{d:"M10.619 6.381a.875.875 0 0 0-1.238 0l-5.4 5.4A.875.875 0 1 0 5.22 13.02L10 8.237l4.781 4.782a.875.875 0 1 0 1.238-1.238z"})},L=(0,n(340498).wt)("arrowChevronSingleUpFill",N,"fill");var O=()=>n(882262),V=()=>n(886358),z=()=>n(417104),W=()=>n(605777),U=()=>n(12193),H=()=>n(163749),K=()=>n(340266),q=()=>n(322972),$=()=>n(557943),G=()=>n(179034),Y=()=>n(620333),Q=()=>n(245241),J=()=>n(931075),X=()=>n(69708),Z=()=>n(100622),ee=()=>n(209199),te=()=>n(534177),ne=()=>n(284371),ae=()=>n(987267),ie=()=>n(933922),se=()=>n(107975),oe=()=>n(420802),re=()=>n(31511),le=()=>n(406094),ce=()=>n(160432);function de(e){const{isOpen:t,submit:n,setIsOpen:i}=e,[s,o]=(0,a.useState)(""),[r,l]=(0,a.useState)(""),[c,d]=(0,a.useState)(!0),[u,g]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1),f=(0,X().tz)(),y=(0,p().IS)((()=>({wrap:{display:"flex",flexDirection:"column",minHeight:128},modalWrap:{width:"32rem",padding:24,fontSize:14,maxWidth:"100%"},modalTitle:{fontSize:16,fontWeight:ne().Wy.medium},modalSubtitle:{fontSize:13,color:Z().Tj.text.tertiary},titleContainer:{marginBottom:12},buttonArea:{display:"flex",justifyContent:"flex-end",marginTop:18,gap:6},feedbackArea:{marginTop:17,padding:8},warningMessage:{color:Z().Tj.red.text.accentPrimary,marginTop:10},checkboxArea:{marginTop:12,display:"flex",gap:6,alignItems:"center",cursor:"pointer"}})),[]),v=(0,a.useCallback)((e=>{const t=e.target.value;o(t),""===t.trim()?(h(!0),g(!0)):(h(!1),g(!1))}),[]),S=(0,a.useCallback)((()=>{i(!1),o(""),l(""),d(!0),g(!1),h(!1)}),[i]),b=(0,a.useCallback)((()=>{if(""===s.trim())return h(!0),void g(!0);n({additionalInformation:s,desiredUrl:r,canFollowUpWithUser:c}),S()}),[s,r,c,n,S]),x=()=>{d(!c)};return(0,F.jsx)(se().a,{open:t,onDismiss:S,render:()=>(0,F.jsx)(ie().A,{capture:!0,allowUndo:!1,allowEsc:!0,allowTabUntab:!1,render:e=>(0,F.jsx)("div",{style:y.wrap,children:(0,F.jsxs)("div",{style:y.modalWrap,...e,children:[(0,F.jsxs)("div",{style:y.titleContainer,children:[(0,F.jsx)("div",{style:y.modalTitle,children:(0,F.jsx)(X().sA,{...ue.title})}),(0,F.jsx)("div",{style:y.modalSubtitle,children:(0,F.jsx)(X().sA,{...ue.subtitle})})]}),(0,F.jsx)(re().A,{placeholder:f.formatMessage(ue.additionalInformationPlaceholder),value:s,onChange:v,focusInitial:!0,inputStyle:{padding:8},style:y.feedbackArea,textarea:!0,"aria-label":f.formatMessage(ue.additionalInformationPlaceholder)}),m?(0,F.jsx)("div",{style:y.warningMessage,role:"alert",children:(0,F.jsx)(X().sA,{...ue.additionalInformationWarning})}):void 0,(0,F.jsx)(re().A,{placeholder:f.formatMessage(ue.urlPlaceholder),value:r,onChange:e=>l(e.target.value),style:y.feedbackArea,"aria-label":f.formatMessage(ue.urlPlaceholder)}),(0,F.jsxs)("div",{style:y.checkboxArea,children:[(0,F.jsx)(oe().S,{checked:c,size:12,onClick:x,"aria-label":f.formatMessage(ue.allowNotionToContactMeLabel)}),(0,F.jsx)(w().D,{styleKey:"bodySmRegular",colorVariant:"secondary",onClick:x,children:(0,F.jsx)(X().sA,{...ue.allowNotionToContactMeLabel})})]}),(0,F.jsxs)("div",{style:y.buttonArea,children:[(0,F.jsx)(le().A,{size:"lg",onClick:S,children:(0,F.jsx)(X().sA,{...ue.cancel})}),(0,F.jsx)(ce().A,{colorPalette:"blue",size:"lg",onClick:b,disabled:u,children:(0,F.jsx)(X().sA,{...ue.submit})})]})]})})})})}const ue=(0,X().YK)({title:{id:"UnifiedFindReportBadSearchModal.title",defaultMessage:"Give search feedback"},subtitle:{id:"UnifiedFindReportBadSearchModal.subtitle",defaultMessage:"The pages from the search results, the search query, and your feedback will be sent to Notion for quality improvement."},additionalInformationPlaceholder:{id:"UnifiedFindReportBadSearchModal.additionalInformationPlaceholder",defaultMessage:"What went wrong with this search? Please be as specific as possible."},urlPlaceholder:{id:"UnifiedFindReportBadSearchModal.urlPlaceholder",defaultMessage:"Link to the page you were searching for, if you have it."},allowNotionToContactMeLabel:{id:"UnifiedFindReportBadSearchModal.allowNotionToContactMeLabel",defaultMessage:"Allow Notion to contact me by email to follow up regarding this search"},cancel:{id:"UnifiedFindReportBadSearchModal.cancel",defaultMessage:"Cancel"},submit:{id:"UnifiedFindReportBadSearchModal.submit",defaultMessage:"Submit feedback"},additionalInformationWarning:{id:"UnifiedFindReportBadSearchModal.additionalInformationWarning",defaultMessage:"Please provide more information before submitting."}});n(944114);var pe=()=>n(249046),ge=()=>n(510818),me=()=>n(604995),he=()=>n(182183),fe=()=>n(837622),ye=()=>n(871830);function ve(e){const{hoverInfo:t,getPayloadDataForHref:n,useCompactWebPreview:i}=e,o=(0,ye().d)(),r=(0,ye().O)(),[l,c]=(0,a.useState)(!1),d=(0,u().O$)(s().AppStoreSidebarSpaceStore),p=(0,u().K8)((()=>n(t.href)),[t,n]),g=(0,a.useMemo)((()=>{var e;if(void 0===p||"webpage"!==p.type)return;const n=null!==(e=t.href)&&void 0!==e&&e.startsWith("webpage://?url=")?decodeURIComponent(t.href.split("webpage://?url=")[1]):t.href;return new URL(n??"https://www.notion.so").origin}),[p,t.href]),m=(0,a.useMemo)((()=>p?"webpage"===p.type?g:p.lastEdited!==me().Mb?p.lastEdited:void 0:void 0),[p,g]),h=(0,u().K8)((()=>{if(!p)return[];const{type:e,text:t}=p;if("slack"===e){if(void 0===p.threadMessages)return p.text.split("\n");const e=p.threadMessages.map((e=>n(e))),t=[];for(const n of e)"slack"===(null==n?void 0:n.type)&&n.text&&t.push(`${n.user}: ${n.text}`);return t}if("microsoft-teams"===e){if(void 0===p.threadMessages)return p.text.split("\n");const e=p.threadMessages.map((e=>n(e))),t=[];for(const n of e)"microsoft-teams"===(null==n?void 0:n.type)&&n.text&&t.push(`${n.user}: ${n.text}`);return t}return"webpage"===e||"helpdoc"===e||"helpdoc-section"===e||(0,A().SC)(e)?(0,ge().Mw)(t).split("\n").filter((e=>""!==e.trim())):"page"===e?[]:void(0,te().HB)(e)}),[p,n]);if(!p)return null;const{type:f,title:y}=p;if("helpdoc"===f||"helpdoc-section"===f)return null;const v="slack"===f?(0,F.jsx)(X().sA,{id:"slack.citation.preview.title",defaultMessage:"Thread in #{title}",values:{title:y}}):"github"===f?y:"jira"===f?(0,F.jsx)(X().sA,{id:"jira.citation.preview.title",defaultMessage:"#{title}",values:{title:y}}):"microsoft-teams"===f?(0,F.jsx)(X().sA,{id:"microsoftTeams.citation.preview.title",defaultMessage:"Thread in #{title}",values:{title:y}}):"discord"===f?(0,F.jsx)(X().sA,{id:"discord.citation.preview.title",defaultMessage:"Channel in #{title}",values:{title:y}}):"webpage"===f?y||(0,F.jsx)(X().sA,{id:"webpage.citation.preview.unknownTitle",defaultMessage:"Unknown webpage"}):"page"===f?y||(0,F.jsx)(X().sA,{id:"notion.citation.preview.unknownTitle",defaultMessage:"Unknown document"}):(0,A().SC)(f)?y||(0,F.jsx)(X().sA,{id:"connector.citation.preview.unknownTitle",defaultMessage:"Unknown document"}):(0,te().HB)(f),S=(0,A().SC)(f)?j().G[f]:"webpage"===f?U().globeIcon:"page"===f?he().notionTintableIcon:(0,te().HB)(f),b="custom"===f&&"iconUrl"in p&&p.iconUrl?(0,F.jsx)("img",{src:p.iconUrl,style:{width:24,height:24,borderRadius:4,objectFit:"cover"},alt:y}):"function"==typeof S?S({width:24,height:24}):(0,F.jsx)(I().Q,{iconGroup:S,variantName:"default",overrideSize:()=>24}),x="webpage"===f?`${g}/favicon.ico`:"";return i&&"webpage"===f?(0,F.jsx)(Se,{citationResultData:p,previewTitle:v,faviconUrl:x,errorState:l,setErrorState:c}):(0,F.jsxs)("div",{style:o.wrapper,children:["webpage"!==f||l?(0,F.jsx)("div",{style:{...o.coverContainer,marginInlineStart:"16px",marginTop:"21px"},children:b}):(0,F.jsx)("img",{style:{...o.coverContainer,height:"24px",width:"24px",marginInlineStart:"16px",marginTop:"21px"},onError:({currentTarget:e})=>{c(!0)},src:x,alt:"Favicon"}),(0,F.jsxs)(pe().wt,{gap:4,style:o.content,children:[(0,F.jsxs)(pe().wt,{gap:2,children:[m?(0,F.jsx)("div",{style:o.breadcrumb,children:m}):void 0,(0,F.jsx)("div",{style:o.pageTitleContainer,children:(0,F.jsx)("span",{style:o.pageTitle,children:v})})]}),d&&h.length>0?(0,F.jsxs)("div",{style:{...r.contentCover,height:"84px",pointerEvents:"none",overflow:"hidden",position:"relative"},children:[(0,F.jsx)("div",{style:{...r.rendererBlockStyle,color:"inherit",fill:"inherit",opacity:.8,pointerEvents:"none"},children:h.map(((e,t)=>(0,F.jsxs)(a.Fragment,{children:[(0,F.jsx)(fe().A,{textValue:[[e]],parentStore:d}),t<h.length-1?(0,F.jsx)("br",{}):void 0]},t)))}),(0,F.jsx)("div",{style:{...r.contentCoverFade,width:"100%",position:"absolute",bottom:0,insetInlineStart:0}})]}):(0,F.jsx)("div",{style:{height:"12px"}})]})]})}function Se({citationResultData:e,previewTitle:t,faviconUrl:n,errorState:i,setErrorState:s}){const o=(0,p().IS)((()=>({container:{padding:12,width:260,display:"flex",flexDirection:"column",gap:8},icon:{height:16,width:16,color:Z().Tj.icon.secondary},secondRow:{display:"flex",gap:8}})),[]),r=(0,a.useMemo)((()=>{if("webpage"===e.type)return kt(e.url)}),[e]);return(0,F.jsxs)("div",{style:o.container,children:[(0,F.jsx)(w().D,{styleKey:"bodySemibold",colorVariant:"primary",style:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:t}),(0,F.jsxs)("div",{style:o.secondRow,children:[i?(0,F.jsx)("div",{style:o.icon,children:(0,F.jsx)(b().I,{icon:U().globeIcon,size:"sm"})}):(0,F.jsx)("img",{style:o.icon,onError:({currentTarget:e})=>{s(!0)},src:n,alt:"Favicon"}),(0,F.jsx)(w().D,{styleKey:"captionMedium",colorVariant:"secondary",children:r})]})]})}var be=()=>n(244837),xe=()=>n(720128),Ie=()=>n(135221),ke=()=>n(187820),we=()=>n(16006),Ce=()=>n(768631),Ae=()=>n(877349),Te=()=>n(447587),je=()=>n(505121),Me=()=>n(631611),_e=()=>n(551345),Pe=()=>n(362976),De=()=>n(29554),Ee=()=>n(751380),Re=()=>n(492414),Be=()=>n(115512),Fe=()=>n(470928),Ne=()=>n(237321),Le=()=>n(295304),Oe=()=>n(10722),Ve=()=>n(140022),ze=()=>n(501305),We=()=>n(195181),Ue=()=>n(483730),He=()=>n(390109),Ke=()=>n(328729),qe=()=>n(32043),$e=()=>n(364294);const Ge=3,Ye=7,Qe=["notion",...A().fl,"webpage"];const Je={notion:{icon:n(558687).notionIcon,name:"Notion"},webpage:{icon:U().globeIcon,name:"Web"},helpdoc:{icon:W().bookIcon,name:"Notion Help"},"helpdoc-section":{icon:W().bookIcon,name:"Notion Help"}};function Xe(e){return(0,A().SC)(e)?{icon:j().G[e],name:ae().w0[e]}:Je[e]}function Ze(){const e=(0,Me().jw)();return(0,u().K8)((()=>{const t=Ue().default.getActiveAssistantConfigurationState();return Boolean(t&&(0,_e().pV)({assistantSurface:e,configurationState:t}))}),[e])}function et(e){var t;const{displayableCitations:n,databaseCitations:i,hoverStore:r,toggledStore:l,loadingState:d,hideEmptyDbCards:g=!0,isOnlyChatTurn:m,inferenceIdOfChatStep:h}=e,f=(0,c().v3)(),y=Ze(),v=y?Ye:Ge,S=g?i.length>0&&g:i.length>0,b=n.filter((e=>!S)),x=n.filter((e=>"notion"===e.type)),I=e.canExpand&&b.length>v,w=e.canExpand?e.expandedStore:void 0,C=(0,u().O$)(l),T=(0,a.useCallback)((e=>{const t=Ue().default.getActiveAssistantConfigurationState();t&&Ve().trackQnaCitationsToggle(f,{sessionId:t.sessionId,shown:e}),l.setState(e)}),[f,l]),j=(0,u().K8)((()=>!(0,te().O9)(w)||w.state),[w]),M=(0,a.useCallback)((e=>{(0,te().O9)(w)&&w.setState(e)}),[w]);(0,u().K8)((()=>{x.forEach((e=>e.store.getTitleValue()))}),[x]);const P=(0,p().IS)((()=>{const e={wrap:{position:"relative",marginInlineStart:4,marginBottom:8,display:"flex",flexDirection:"column",fontSize:Be().Kw},moreButton:{fontSize:y?Be().vQ:13,fontWeight:500,color:Z().Tj.text.secondary,gap:y?8:2,marginInlineStart:y?-8:-6,padding:y?"8px":"4px 6px",width:"fit-content",height:"auto",justifyContent:"start"},icon:{marginInlineEnd:y?4:2,padding:y?2:"0 1px",boxSizing:"content-box"},listWrap:{display:"flex",flexDirection:"column",flexGrow:1,gap:2,maxWidth:He().Qr}};return y?{...e,wrap:{...e.wrap,paddingInlineEnd:6,paddingBottom:C?8:void 0},listWrap:{...e.listWrap,maxWidth:void 0,width:"100%",gap:4}}:e}),[y,C]),D=(0,u().K8)((()=>Ue().default.getActiveSessionId()),[]),[E,R]=(0,a.useState)("notion"),B=(0,a.useMemo)((()=>b.filter((e=>"all"===E||e.type===E)).sort(((e,t)=>"all"!==E?0:"notion"===e.type&&"notion"!==t.type?-1:"notion"!==e.type&&"notion"===t.type?1:0))),[b,E]),N=y?B:b,L=j?N:N.slice(0,v),O=(0,u().K8)((()=>{var e,t,n,a,i;if(!y)return;const r=null===(e=s().default.state.currentUserStore)||void 0===e?void 0:e.id,l=null===(t=(0,o().S)())||void 0===t?void 0:t.id,c=null===(n=Ue().default.getActiveAssistantConfigurationState())||void 0===n?void 0:n.searchSessionId,u=null===(a=Ue().default.getActiveAssistantConfigurationState())||void 0===a?void 0:a.sessionId,p=null===(i=Ue().default.getActiveSession())||void 0===i?void 0:i.clientStepsFromStoreState.findLast(_().Hr),g=void 0===d||"isStreaming"in d&&d.isStreaming;return r&&l&&c&&u&&p&&g&&h&&0!==b.length?{user_id:r,space_id:l,results:b.map((e=>({id:"notion"===e.type?e.store.id:e.href,type:e.type}))),query:p.text,search_session_id:c,assistant_session_id:u,trace_id:h}:void 0}),[b,h,y,d]);return 0===i.length&&0===b.length?null:(0,F.jsxs)(F.Fragment,{children:[i.map(((e,t,{length:n})=>(0,F.jsx)(ct,{databaseCitation:e,hoverStore:r,assistantSessionId:D,onlyShowIfThereAreResults:g,isLastCitedDatabaseRowWithMoreCitationsBelow:t===n-1&&L.length>0},e.store.id))),(0,F.jsx)("div",{style:P.wrap,children:(0,F.jsxs)("div",{style:P.listWrap,children:[(0,F.jsx)(ot,{allPageAndUniversalCitations:b,store:null===(t=x.at(0))||void 0===t?void 0:t.store,loadingState:d,isDeepSearchPrototype:y,toggled:C,setToggled:T,hasDatabaseCitations:i.length>0,setExpanded:M,isOnlyChatTurn:m,deepFindFeedbackPayload:O,selectedDeepFindSource:E,setSelectedDeepFindSource:R}),C?L.map(((e,t)=>{const{type:n}=e;return"notion"===n?(0,F.jsx)(bt,{citation:e,hoverStore:r,position:t},e.store.id):"helpdoc"===n||"helpdoc-section"===n||"webpage"===n||(0,A().SC)(n)?(0,F.jsx)(ut,{citation:e,hoverStore:r,position:t},e.href):void(0,te().HB)(n)})):void 0,C?(0,F.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:I&&!j?(0,F.jsx)(k().p,{style:P.moreButton,iconLeading:{icon:V().arrowStraightDownFillSmallIcon,style:P.icon,size:y?"xs":"xxs",colorVariant:"secondary"},onClick:()=>{const e=Ue().default.getActiveAssistantConfigurationState();e&&Ve().trackQnaCitationsSeeMoreClick(f,{sessionId:e.sessionId}),M(!0)},children:(0,F.jsx)(X().sA,{id:"assistantCitationHelpers.more",defaultMessage:"More"})}):(0,F.jsx)("div",{})}):null]})})]})}function tt(e){const t=(0,X().tz)(),{deepFindFeedbackPayload:n}=e,[i,s]=(0,a.useState)(),o=(0,c().v3)(),[r,l]=(0,a.useState)(!1),d=(0,a.useCallback)((async()=>{s("thumbsUp"),await(0,Oe().SK)({environment:o,feedback:"thumbsUp",deepFindFeedbackPayload:n})}),[o,n]),u=(0,a.useCallback)((async()=>{s("thumbsDown"),await(0,Oe().SK)({environment:o,feedback:"thumbsDown",deepFindFeedbackPayload:n}),l(!0)}),[o,n]),p=(0,a.useCallback)((async e=>{await(0,Oe().I_)({environment:o,deepFindFeedbackPayload:{...n,additional_information:e.additionalInformation,desired_result_url:e.desiredUrl,can_followup_with_user:e.canFollowUpWithUser}})}),[o,n]);return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{style:{display:"flex",gap:4},children:[(0,F.jsx)(x().A,{icon:"thumbsUp"===i?()=>(0,F.jsx)(b().I,{icon:q().P,size:"sm",colorVariant:"secondary"}):()=>(0,F.jsx)(b().I,{icon:$().s,size:"sm",colorVariant:"secondary"}),ariaLabel:t.formatMessage({id:"assistantCitationHelpers.thumbsUp",defaultMessage:"Give thumbs up feedback"}),onClick:d,disabled:void 0!==i}),(0,F.jsx)(x().A,{icon:"thumbsDown"===i?()=>(0,F.jsx)(b().I,{icon:H().m,size:"sm",colorVariant:"secondary"}):()=>(0,F.jsx)(b().I,{icon:K().d,size:"sm",colorVariant:"secondary"}),ariaLabel:t.formatMessage({id:"assistantCitationHelpers.thumbsDown",defaultMessage:"Give thumbs down feedback"}),onClick:u,disabled:void 0!==i})]}),(0,F.jsx)(de,{isOpen:r,setIsOpen:l,submit:p})]})}const nt={helpdoc:W().bookIcon,"helpdoc-section":W().bookIcon,...j().G};function at(e){const{citation:t,size:n,style:a}=e,{store:i}=t,s=(0,u().K8)((()=>i.getIcon()),[i]),o=(0,u().K8)((()=>i.isEmptyPage()),[i]),r=(0,u().K8)((()=>(0,ke().Te)(i)),[i]);return(0,F.jsx)(ke().B6,{disabled:!0,icon:s,isEmptyPage:o,size:n,style:a,useInvertedColors:!1,iconRecordCategory:r})}function it(e){const{citation:t,size:n,style:i}=e,[s,o]=(0,a.useState)(!1),r=(0,p().IS)((()=>({icon:{height:n,width:n,...i}})),[n,i]);if("notion"===t.type)return(0,F.jsx)(at,{citation:t,size:n,style:i});if("webpage"===t.type)return s?(0,F.jsx)(b().I,{icon:U().globeIcon,style:r.icon}):(0,F.jsx)("img",{style:r.icon,src:`${new URL(t.url).origin}/favicon.ico`,onError:()=>o(!0)});{const e=nt[t.type];return"function"==typeof e?(0,F.jsx)(F.Fragment,{children:e(r.icon)}):(0,F.jsx)(I().Q,{iconGroup:e,variantName:"default",overrideSize:()=>n})}}function st(e){const{citations:t}=e,n=(0,p().IS)((()=>({iconWrap:{padding:3.5,width:24,height:24,borderRadius:999,border:`1.5px solid ${Z().Tj.border.primary}`,marginInlineStart:-9,background:Z().Tj.background.primary}})),[]);return t.length<3?null:(0,F.jsx)("div",{style:{display:"flex"},children:t.slice(0,3).map(((e,t)=>(0,F.jsx)("div",{style:{...n.iconWrap,zIndex:3-t,...0===t&&{marginInlineStart:0}},children:(0,F.jsx)(it,{citation:e,size:14})},"notion"===e.type?e.store.id:e.href)))})}function ot(e){var t;const{allPageAndUniversalCitations:n,store:i,loadingState:s,isDeepSearchPrototype:o,toggled:r,setToggled:l,setExpanded:d,hasDatabaseCitations:g,isOnlyChatTurn:m,deepFindFeedbackPayload:h,selectedDeepFindSource:f,setSelectedDeepFindSource:y}=e,v=(0,te().O9)(s),[S,x]=(0,a.useState)(!1),I=i,w=s&&!("isStreaming"in s)&&"assistantShowSearchResults"===(null===(t=s.loadingStep)||void 0===t?void 0:t.type)?s.loadingStep:void 0,C=w&&I?(0,F.jsx)(Ke().y,{clientStep:w,parentStore:I}):g?(0,F.jsx)(X().sA,{id:"assistantCitationHelpers.numPagesFound.withDatabaseCitations",defaultMessage:"{count, plural, one {{count} other result} other {{count} other results}}",values:{count:n.length}}):(0,F.jsx)(X().sA,{id:"assistantCitationHelpers.numPagesFound",defaultMessage:"{count, plural, one {{count} result} other {{count} results}}",values:{count:n.length}}),A=(0,p().IS)((()=>({messageWrap:{padding:"20px 12px",marginInlineStart:-8,display:"flex",color:Z().Tj.text.secondary,alignItems:"center",gap:4,height:44,width:"calc(100% + 20px)",borderRadius:6,justifyContent:"space-between",...S&&{cursor:"pointer",background:Z().Tj.buttonHoveredBackground}},messageContent:{display:"flex",alignItems:"center",gap:4,minWidth:0},messageWrapInner:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}})),[S]),T=(0,u().K8)((()=>{var e;return null===(e=Ue().default.getActiveSession())||void 0===e||null===(e=e.assistantConfigurationStore)||void 0===e?void 0:e.state.searchScope}),[]),j=(0,u().K8)((()=>{var e;return null===(e=Ue().default.getActiveSession())||void 0===e||null===(e=e.assistantConfigurationStore)||void 0===e?void 0:e.state.searchFilters}),[]),M=T??E().Wy,_=j??E().NH,P=(0,c().v3)(),D=(0,Me().jw)(),R=(0,a.useCallback)((async e=>{const{assistantSearchScope:t,searchFilters:n}=e;await(0,Oe().Ki)({searchScope:t,searchFilters:n,environment:P,assistantSurface:D})}),[D,P]);if(0===n.length)return null;const N=(O=Array.from(new Set(n.map((e=>e.type)))),["all",...Qe.filter((e=>O.includes(e)))]);var O;return(0,F.jsx)(rt,{enabled:!v,isLoading:Boolean(v),isDeepFindUxActive:o,open:r,onClick:o?void 0:()=>{l(!r),d(!1)},children:o?r&&m?(0,F.jsx)($e().g,{toggled:r,setToggled:l,setIsToggleHovered:x,deepFindFeedbackPayload:h,sources:N,selectedDeepFindSource:f,setSelectedDeepFindSource:y,assistantSearchScope:M,deepFindSearchFilters:_,searchAgainAndUpdateAssistantSearchScope:R,useWebSearch:!1}):(0,F.jsxs)(k().p,{style:A.messageWrap,onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),onClick:()=>{l(!r)},children:[(0,F.jsxs)("div",{style:A.messageContent,children:[(0,F.jsx)("div",{style:A.messageWrapInner,children:C}),(0,F.jsx)(st,{citations:n})]}),S?r?(0,F.jsx)(b().I,{icon:L,size:10,colorVariant:"tertiary"}):(0,F.jsx)(b().I,{icon:B().arrowChevronSingleDownFillIcon,size:10,colorVariant:"tertiary"}):null]}):C})}function rt(e){const{enabled:t,onClick:n,children:i,open:s,isLoading:o,isDeepFindUxActive:l}=e,[c,d]=(0,a.useState)(!1),u=function(e){const{hovered:t,enabled:n,open:a,isDeepSearchPrototype:i}=e;return(0,p().IS)((()=>{const e={wrap:{color:Z().Tj.text.secondary,fontWeight:500,fontSize:12,padding:"0px 0 2px",display:"flex",alignItems:"center"},content:{padding:"1px 2px",margin:"-1px -2px",cursor:!i&&n?"pointer":"default"},icon:{width:11,height:11,marginInlineStart:4,fill:Z().Tj.icon.secondary,transform:`rotateZ(${a?0:-90}deg)`,opacity:r().A.isMobile||t?1:0,transition:"opacity 0.2s ease, transform 200ms ease-out"},loadingDots:{marginInlineStart:8}};return i?{...e,wrap:{...e.wrap,width:"100%"},content:{...e.content,width:"100%"},loadingDots:{...e.loadingDots,marginInlineStart:20}}:e}),[n,a,t,i])}({hovered:c,enabled:t,open:s,isDeepSearchPrototype:l});return(0,F.jsxs)("div",{style:u.wrap,children:[(0,F.jsx)("div",{style:u.content,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),onClick:()=>{t&&(null==n||n())},children:i}),t&&!l?(0,F.jsx)(b().I,{icon:B().arrowChevronSingleDownFillIcon,size:10,colorVariant:"tertiary"}):void 0,o?(0,F.jsx)(Ie().A,{isTriColored:!0,styleParentContainer:u.loadingDots}):void 0]})}const lt=(0,X().YK)({expandDatabaseCitation:{id:"assistantCitationHelpers.expandDatabaseCitation",defaultMessage:"Open results"}});function ct(e){const{databaseCitation:t,hoverStore:n,assistantSessionId:i,onlyShowIfThereAreResults:s,isLastCitedDatabaseRowWithMoreCitationsBelow:o}=e,[l,c]=(0,a.useState)(!1),d=(0,p().eP)(),u=(0,p().IS)((()=>({textWrap:{fontSize:14,fontWeight:500,color:Z().Tj.text.secondary,display:"flex",alignItems:"center",overflow:"hidden"},citationMessage:{boxShadow:Z().Tj.shadowXS,background:"dark"===d?Z().Tj.background.secondaryTranslucent:Z().Tj.background.primary,borderRadius:12,padding:6,paddingBottom:8,paddingInlineStart:14,color:Z().Tj.text.primary,maxWidth:"min(100%, 640px)",fontSize:Be().vQ,whiteSpace:"pre-wrap",overflowWrap:"break-word",position:"relative",lineHeight:1.45,marginTop:He().ZQ,marginBottom:o?He().ZQ+5:He().ZQ,...l?{background:"light"===d?Z().Tj.cardHoveredBackground:Z().Tj.palette.translucentGray[100]}:{},transition:"all .2s ease",cursor:"pointer"}})),[l,o,d]),g=(0,a.useCallback)((()=>{if(r().A.isMobile)return;const e=t.queryDatabaseResultId;i&&Le().Vv(e,i)}),[i,t.queryDatabaseResultId]),m=(0,X().tz)(),h=(0,a.useCallback)((()=>{c(!0)}),[]),f=(0,a.useCallback)((()=>{c(!1)}),[]);return s&&!t.relatedPages.length?null:(0,F.jsxs)("div",{style:u.citationMessage,onClick:g,onMouseEnter:h,onMouseLeave:f,children:[(0,F.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,F.jsx)("div",{style:u.textWrap,children:(0,F.jsx)(X().sA,{defaultMessage:"<span>In{nbspThisIsASpacePleaseIgnore}</span>{database}",id:"assistantCitationHelpers.resultsFromDatabase",values:{nbspThisIsASpacePleaseIgnore:(0,F.jsx)("span",{children:""}),span:e=>(0,F.jsx)("span",{style:{display:"flex",flexShrink:0},children:e}),database:(0,F.jsx)(be().E,{size:14,collectionStore:t.store,pageVisitSource:M().y8.AIQna})}})}),r().A.isMobile?void 0:(0,F.jsx)(C().m,{renderTooltip:()=>m.formatMessage(lt.expandDatabaseCitation),render:e=>(0,F.jsx)(x().A,{ariaLabel:m.formatMessage(lt.expandDatabaseCitation),icon:O().m,...e})})]}),t.relatedPages.map((e=>(0,F.jsx)(dt,{citation:e,hoverStore:n},e.store.id)))]})}function dt(e){const{citation:t,hoverStore:n}=e,{store:i,inlineCitedBlockIds:s}=t,o=(0,u().K8)((()=>{var e;return"notion"===(null===(e=n.state)||void 0===e?void 0:e.citationType)&&n.state.pageId===i.id}),[n,i.id]),r=(0,a.useRef)(null),l=(0,a.useCallback)((e=>{if(e){if(!r.current)return;n.setState({type:"list",citationType:"notion",pageId:i.id,blockIds:s,node:r.current})}else n.setState(void 0)}),[n,s,i.id]),c=(0,p().IS)((()=>({wrap:{gap:4,color:Z().Tj.text.primary,fontWeight:ne().Wy.medium,paddingInlineStart:4,paddingInlineEnd:4,marginInlineStart:-4,height:24,maxWidth:"min(calc(100% - 12px), 512px)"}})),[]),d=(0,qe().mI)(i),g=(0,u().K8)((()=>i.getIcon()),[i]),m=(0,u().K8)((()=>i.isEmptyPage()),[i]),h=(0,u().K8)((()=>(0,ke().Te)(i)),[i]);return(0,F.jsx)("div",{children:(0,F.jsxs)(k().p,{href:d,style:c.wrap,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),ref:r,hovered:o,onClick:e=>{e.stopPropagation()},children:[(0,F.jsx)(ke().B6,{style:{minWidth:15},disabled:!0,icon:g,isEmptyPage:m,size:14,useInvertedColors:!1,iconRecordCategory:h}),(0,F.jsx)(we().A,{store:i})]})})}function ut(e){const{hoverStore:t,citation:n,position:s}=e,o=(0,c().v3)(),d=(0,u().K8)((()=>{var e;return"universal_search"===(null===(e=t.state)||void 0===e?void 0:e.citationType)&&t.state.href===n.href}),[t,n]),p=(0,a.useRef)(null),g=(0,a.useCallback)((e=>{if(e){if(!p.current)return;t.setState({type:"list",citationType:"universal_search",node:p.current,href:n.href})}else t.setState(void 0)}),[t,n]),m=Ze(),h=(0,u().K8)((()=>{var e;return null===(e=Ue().default.getActiveAssistantConfigurationState())||void 0===e?void 0:e.searchSessionId}),[]),y=It({hovered:d,isDeepFindUxActive:m});let v=null;"slack"===n.type?v=(0,F.jsx)(vt,{citation:n}):"microsoft-teams"===n.type?v=(0,F.jsx)(St,{citation:n}):"helpdoc"===n.type||"helpdoc-section"===n.type||"webpage"===n.type||(0,A().SC)(n.type)?v=(0,F.jsx)(ht,{citation:n}):(0,te().HB)(n.type);const S=(0,a.useMemo)((()=>"slack"===n.type?(0,T().mQ)({...n}):"helpdoc"===n.type||"helpdoc-section"===n.type||"webpage"===n.type||(0,A().SC)(n.type)?n.url:void(0,te().HB)(n.type)),[n]),b=yt(n.href);return(0,F.jsx)("div",{style:y.wrap,ref:p,children:(0,F.jsx)(f().Q,{href:S,metaHref:S,external:!0,style:y.linkBox,hovered:d,hoveredStyle:y.linkBoxHoveredStyle,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),onClick:e=>{const t=Ue().default.getActiveAssistantConfigurationState();m&&h&&(0,i().u)({environment:o,event:{eventName:"select_search_item",eventProperties:{sources:[Q().Ni.UniversalUnknown],localSources:void 0,context:"query_results",searchSource:"unified_find_deep_dive",searchSessionId:h,aiSessionId:(null==t?void 0:t.sessionId)??"",traceId:void 0,originalPosition:s,queryText:void 0,selectedSearchResultMetadata:{blockId:n.type,blockType:void 0},selectedItemIndex:s,isMobile:r().A.isMobile,isMetaClick:Boolean((0,l().V)(e)),searchSessionFlowNumber:-1,queryStringLength:0,totalSearchResultCount:0,numLocalResults:0,numTotalLocalResults:0,hasFilters:!1,verificationState:{type:"none"},numKeystrokes:void 0,hadMetaClick:!1,timeToSelectMs:-1,timeFromFirstKeyStrokeToSelectMs:void 0,timeToRenderResult:void 0}}}),Ve().trackQnaResultClicked(o,{configurationState:t,resultType:n.type,source:"citation_list"})},children:(0,F.jsxs)("div",{style:y.titleWrap,children:[(0,F.jsx)("div",{style:y.iconWrap,children:(0,F.jsx)(it,{citation:n,size:m?17:14,style:y.icon})}),m?(0,F.jsx)(pt,{citationText:null==b?void 0:b.text,titleElement:v}):v]})})},n.href)}function pt(e){const{citationText:t,titleElement:n,highlighter:a}=e;return(0,F.jsxs)("div",{style:{width:"100%",overflow:"hidden",minWidth:0},children:[n,(0,F.jsx)(gt,{citationText:t,highlighter:a})]})}function gt(e){const{citationText:t,highlighter:n}=e,a=(0,p().IS)((()=>({text:{marginTop:2,color:Z().Tj.text.secondary,fontWeight:400}})),[]);return(0,F.jsx)(Te().A,{maxLines:1,style:a.text,children:(0,F.jsx)(xe().A,{text:t??"",highlighter:n})})}function mt(e){return(0,p().IS)((()=>{const t={title:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}};return e?{...t,title:{...t.title,fontSize:14,fontWeight:600}}:t}),[e])}function ht(e){const{citation:t}=e,n=Ze(),a=yt(t.href),i=mt(n);return(0,F.jsx)("span",{style:i.title,children:null==a?void 0:a.title})}function ft(e){const t=Ue().default.getActiveSession();if(t)return t.evaluatorFromStoreState.state.getUniversalResultPayloadForHrefIfExists(e)}function yt(e){return(0,u().K8)((()=>ft(e)),[e])}function vt(e){const{citation:t}=e,n=mt(Ze()),i=yt(t.href),s=(0,a.useMemo)((()=>"slack"===(null==i?void 0:i.type)?(0,te().O9)(i.threadHref)?i.user:i.text.split(":")[0]:void 0),[i]);let o=null;return o=(0,te().O9)(null==i?void 0:i.title)?(0,te().O9)(s)?(0,F.jsx)(X().sA,{id:"SlackCitationTitle.title",defaultMessage:"{author} in #{title}",values:{title:null==i?void 0:i.title,author:s}}):(0,F.jsx)(X().sA,{id:"SlackCitationTitle.titleWithContentUnknown",defaultMessage:"Unknown author in #{title}",values:{title:null==i?void 0:i.title}}):(0,te().O9)(s)?(0,F.jsx)(X().sA,{id:"SlackCitationTitle.titleWithChannelUnknown",defaultMessage:"{author} in unknown channel",values:{author:s}}):(0,F.jsx)(X().sA,{id:"SlackCitationTitle.titleUnknown",defaultMessage:"Unknown content"}),(0,F.jsx)("span",{style:n.title,children:o})}function St(e){const{citation:t}=e,n=mt(Ze()),i=yt(t.href),s=(0,a.useMemo)((()=>"microsoft-teams"===(null==i?void 0:i.type)?(0,te().O9)(i.threadHref)?i.user:i.text.split(":")[0]:void 0),[i]);let o=null;return o=(0,te().O9)(null==i?void 0:i.title)?(0,te().O9)(s)?(0,F.jsx)(X().sA,{id:"MicrosoftTeamsCitationTitle.title",defaultMessage:"{author} in #{title}",values:{title:null==i?void 0:i.title,author:s}}):(0,F.jsx)(X().sA,{id:"MicrosoftTeamsCitationTitle.titleWithContentUnknown",defaultMessage:"Unknown author in #{title}",values:{title:null==i?void 0:i.title}}):(0,te().O9)(s)?(0,F.jsx)(X().sA,{id:"MicrosoftTeamsCitationTitle.titleWithChannelUnknown",defaultMessage:"{author} in unknown channel",values:{author:s}}):(0,F.jsx)(X().sA,{id:"MicrosoftTeamsCitationTitle.titleUnknown",defaultMessage:"Unknown content"}),(0,F.jsx)("span",{style:n.title,children:o})}function bt(e){const{citation:{store:t,inlineCitedBlockIds:n,id:s},hoverStore:o,position:d}=e,p=(0,c().v3)(),g=(0,u().K8)((()=>{const e=(0,Fe().Es)({blockStore:t}),n=t.getModel(),a=(0,J().sN)(n);return e&&a}),[t]),m=(0,u().K8)((()=>{var e;return"notion"===(null===(e=o.state)||void 0===e?void 0:e.citationType)&&o.state.pageId===t.id}),[o,t]),h=yt((0,P().ew)(s)),y="page"===(null==h?void 0:h.type)?h:void 0,v=Ze(),S=(0,u().K8)((()=>{var e;return null===(e=Ue().default.getActiveAssistantConfigurationState())||void 0===e?void 0:e.searchSessionId}),[]),x=It({hovered:m,isDeepFindUxActive:v}),I=(0,a.useRef)(null),k=(0,a.useCallback)((e=>{if(e){if(!I.current)return;o.setState({type:"list",citationType:"notion",pageId:t.id,blockIds:n,node:I.current})}else o.setState(void 0)}),[o,n,t.id]),w=(0,u().K8)((()=>p.RouterStore.state.route),[p]),{metaHref:C,href:A}=(0,u().K8)((()=>{const e=(0,Re().Ay)({store:t,fullyQualified:!1,pageVisitSource:M().y8.AIQna});return"page"===w.name||"nativeTab"===w.name&&"assistant"===w.tab||"quickSearch"===w.name?{metaHref:e,href:e}:"chat"===w.name?{metaHref:e,href:(0,D().EY)({currentRoute:w,pageId:t.id,pageVisitSource:M().y8.AIQna,isMobile:r().A.isMobile})}:{metaHref:void 0,href:void 0}}),[w,t]);return(0,F.jsx)("div",{style:x.wrap,ref:I,children:(0,F.jsx)(f().Q,{href:C,metaHref:A,style:x.linkBox,hovered:m,hoveredStyle:x.linkBoxHoveredStyle,onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),onClick:async e=>{p.device.isMobileBrowser&&await ze().closeAssistantRightHandSideMenu({environment:p}),Ne().A.setState({queryId:(0,Y().mk)({searchSessionId:S,searchSessionFlowNumber:0}),pageId:t.id,timeEntered:new Date});const n=Ue().default.getActiveAssistantConfigurationState();var a;v&&S&&(0,i().u)({environment:p,event:{eventName:"select_search_item",eventProperties:{sources:[Q().Ni.NotionUnknown],localSources:void 0,context:"query_results",searchSource:"unified_find_deep_dive",searchSessionId:S,aiSessionId:(null==n?void 0:n.sessionId)??"",traceId:void 0,originalPosition:d,selectedSearchResultMetadata:{blockId:t.id,blockType:null===(a=t.getModel())||void 0===a?void 0:a.getType()},selectedItemIndex:d,isMobile:r().A.isMobile,isMetaClick:Boolean((0,l().V)(e)),verificationState:(0,Fe().i1)(t),queryText:void 0,searchSessionFlowNumber:-1,queryStringLength:0,totalSearchResultCount:0,numLocalResults:0,numTotalLocalResults:0,hasFilters:!1,numKeystrokes:void 0,hadMetaClick:!1,timeToSelectMs:-1,timeFromFirstKeyStrokeToSelectMs:void 0,timeToRenderResult:void 0}}});Ve().trackQnaResultClicked(p,{clickedPageId:t.id,configurationState:n,resultType:"page",source:"citation_list"})},children:(0,F.jsxs)("div",{style:x.titleWrap,children:[(0,F.jsx)("div",{style:x.iconWrap,children:(0,F.jsx)(it,{citation:e.citation,size:v?20:14,style:x.icon})}),v?(0,F.jsx)(xt,{inlineCitedBlockIds:n,store:t,payloadData:y}):(0,F.jsx)(we().A,{store:t}),!v&&g?(0,F.jsx)("div",{style:x.verificationBadgeWrap,children:(0,F.jsx)(b().I,{icon:z().badgeCheckFillSmallIcon,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"})}):null]})})},t.id)}function xt(e){var t,n;const{inlineCitedBlockIds:a,store:i,payloadData:s}=e,o=(0,p().IS)((()=>({verificationBadgeWrap:{display:"flex",alignItems:"center",marginInlineStart:4},titleHighlighter:{color:Z().Tj.blue.text.accentPrimary,background:Z().Tj.blue.background.secondaryTranslucent},previewTextHighlighter:{color:Z().Tj.blue.text.accentPrimary,background:Z().Tj.blue.background.secondaryTranslucent}})),[]),r=null!=s&&null!==(t=s.highlight)&&void 0!==t&&t.text?s.highlight.text:void 0,l=(0,u().K8)((()=>{if(r)return r;if(a.length>0)return e=i,a.map((t=>m().B.createChildStore(e,{table:G().ev,id:t}))).map((e=>e.getTitleValue())).map((t=>(0,De().r4)(t,e))).join(" ");var e;const t=Pe().E(i);return t?(0,De().r4)(t,i):""}),[a,i,r]),c=(0,Ee().PO)({words:(0,Ee().oQ)(null==s||null===(n=s.highlight)||void 0===n?void 0:n.title),styleOverride:o.titleHighlighter}),d=(0,Ee().Ay)(l),g={tokenize:e=>(0,Ee().nB)(d),style:o.previewTextHighlighter},h=(0,u().K8)((()=>{const e=(0,Fe().Es)({blockStore:i}),t=i.getModel(),n=(0,J().sN)(t);return e&&n}),[i]);return(0,F.jsxs)("div",{style:{width:"100%",minWidth:0},children:[(0,F.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,F.jsx)(we().A,{store:i,style:{fontSize:14},highlighter:c}),h?(0,F.jsx)("div",{style:o.verificationBadgeWrap,children:(0,F.jsx)(b().I,{icon:z().badgeCheckFillSmallIcon,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"})}):null]}),(0,F.jsx)(gt,{citationText:l,highlighter:g})]})}function It(e){const{hovered:t,isDeepFindUxActive:n}=e;return(0,p().IS)((()=>{const e={wrap:{display:"flex",position:"relative"},linkBox:{display:"flex",alignItems:"center",gap:4,padding:"0 4px",borderRadius:6,fontWeight:500,fontSize:13,transition:"background 150ms",marginInlineStart:-6,maxWidth:"calc(100% + 8px)"},linkBoxHoveredStyle:{background:Z().Tj.buttonHoveredBackground},iconWrap:{position:"relative",marginInlineEnd:4,width:14,height:14,flexShrink:0},icon:{position:"absolute",insetInlineStart:0,top:0,transition:"opacity 150ms",opacity:1},number:{position:"absolute",insetInlineStart:0,top:0,opacity:t?1:0,transition:"opacity 150ms",zIndex:10},titleWrap:{display:"flex",alignItems:"center",padding:2,minWidth:50},verifiedBadgeIcon:{width:14,height:14,fill:Z().Tj.blue.icon.accentPrimary},verificationBadgeWrap:{marginInlineStart:6}};return n?{...e,wrap:{...e.wrap,width:"calc(100% + 20px)"},linkBox:{...e.linkBox,padding:8,width:"100%",marginInlineStart:-8},iconWrap:{...e.iconWrap,marginInlineEnd:12,marginTop:1,width:20,height:20},titleWrap:{...e.titleWrap,alignItems:"start",padding:void 0},number:{...e.number,opacity:0},icon:{...e.icon,opacity:1}}:e}),[t,n])}function kt(e){try{let t=e.replace(/^(https?:\/\/)/i,"");t=t.replace(/^www\./i,"");const n=t.match(/^([^/]+)/i);return n&&n[1]?n[1]:t}catch(t){return e}}const wt=24,Ct=6;function At(e){const t=Tt({...e,isSearchChat:e.isSearchChat??!1});if((0,te().O9)(t)){const{originRect:n,isFullTooltip:a,citationType:i}=t;let s;if("notion"===i){const{stores:e,isBlockLevelCitation:n,navigableBlockStore:i,discussionId:o}=t;if(t.snapshotTimestamp)s=(0,F.jsx)(_t,{snapshotTimestamp:t.snapshotTimestamp});else{const t=1!==e.length||o?"regular":"tall";s=a?n?(0,F.jsx)(Ae().y,{store:i,contentBlocks:e.slice(0,Ct),size:t,isDiscussion:Boolean(o)}):(0,F.jsx)(Ae().y,{store:i}):(0,F.jsx)(Mt,{store:i})}}else"universal_search"===i?s=(0,F.jsx)(ve,{hoverInfo:t,getPayloadDataForHref:e.getPayloadDataForHref??ft,useCompactWebPreview:e.useCompactWebPreview}):(0,te().HB)(i);return(0,F.jsx)(y().zD,{disableMouseCapture:!0,preventCaptureEsc:!0,preventScaleTransition:!0,preventOpacityTransition:!0,popupType:v().n.Popup,originGap:Boolean(e.isSearchChat)?4:a?wt:8,alignmentToOrigin:Boolean(e.isSearchChat)?"start":"center",open:!0,placementToOrigin:Boolean(e.isSearchChat)?"bottom":a?"left":"notion"===t.citationType&&t.snapshotTimestamp?"top":"bottom",originRect:n,lightBoxShadow:!a,render:()=>s,trapFocus:!1})}return null}function Tt(e){const{containerRef:t,hoverStore:n,parentStore:a,isSearchChat:i=!1}=e;return(0,u().K8)((()=>{if(!n.state||!t.current||r().A.isMobile)return;const e="notion"===n.state.citationType&&n.state.snapshotTimestamp,s=t.current.getBoundingClientRect(),o=(i||s.left>=Ce().k+wt)&&!e;let l;const c=n.state.node.getBoundingClientRect();if(i)l=c;else if(o)l=new DOMRect(s.x,c.y,s.width,c.height);else{if("token"!==n.state.type)return;if(e){const e=c.x+c.width/2;l=new DOMRect(e-s.width/2,c.y,s.width,c.height)}else l=c}const{type:d,citationType:u}=n.state;if("notion"===u){let e,t;return"token"===d?(e=n.state.blockId?[n.state.blockId]:[n.state.pageId],t=Boolean(n.state.blockId)):"list"===d?(e=n.state.blockIds.length>0?n.state.blockIds:[n.state.pageId],t=n.state.blockIds.length>0):(0,te().HB)(d),{citationType:u,stores:e.map((e=>m().B.createChildStore(a,{id:e,table:G().ev}))),originRect:l,isFullTooltip:o,isBlockLevelCitation:t,discussionId:n.state.discussionId,snapshotTimestamp:n.state.snapshotTimestamp,navigableBlockStore:m().B.createChildStore(a,{id:n.state.pageId,table:G().ev})}}if("universal_search"===u)return{citationType:u,originRect:l,isFullTooltip:o,href:n.state.href};(0,te().HB)(u)}),[t,a,n,i])}function jt(e){const t=Tt(e),n=(0,u().K8)((()=>{var e;return null===(e=Ue().default.getActiveAssistantConfigurationState())||void 0===e?void 0:e.searchDebugHits}),[]),a=(0,p().IS)((()=>({wrap:{fontSize:ne().J.UISmall.desktop,color:Z().Tj.text.secondary,fontWeight:ne().Wy.regular,fill:Z().Tj.icon.secondary,paddingTop:4,paddingInlineEnd:6,paddingBottom:4,paddingInlineStart:6,display:"flex",alignItems:"center",gap:2,marginInlineEnd:6}})),[]);if((0,te().O9)(t)){var i;const{originRect:e,isFullTooltip:s}=t;let o;"notion"===t.citationType?o=t.stores.map((e=>null==n?void 0:n.get(e.id))).find(te().O9):"universal_search"===t.citationType?o=null==n?void 0:n.get(t.href):(0,te().HB)(t);const r=o?{...o.result,...o.hit?Object.fromEntries(Object.entries(o.hit).filter((([e])=>We().Ue.includes(e)))):{},...null!==(i=o.hit)&&void 0!==i&&i.rankerInputs?Object.fromEntries(Object.entries(o.hit.rankerInputs).filter((([e])=>We().Ue.includes(e)))):{}}:{};return(0,F.jsx)(y().zD,{disableMouseCapture:!0,preventCaptureEsc:!0,preventScaleTransition:!0,preventOpacityTransition:!0,popupType:v().n.Popup,originGap:s?wt+Ce().k:8,alignmentToOrigin:"start",open:!0,placementToOrigin:s?"left":"bottom",originRect:e,lightBoxShadow:!s,render:()=>(0,F.jsx)("div",{style:a.wrap,children:(0,F.jsx)(je().Z,{data:r})})})}return null}function Mt(e){const{store:t}=e,n=(0,p().IS)((()=>({wrap:{fontSize:ne().J.UISmall.desktop,color:Z().Tj.text.secondary,fontWeight:ne().Wy.regular,fill:Z().Tj.icon.secondary,paddingTop:4,paddingInlineEnd:6,paddingBottom:4,paddingInlineStart:6,display:"flex",alignItems:"center",gap:2}})),[]),a=(0,u().K8)((()=>t.getIcon()),[t]),i=(0,u().K8)((()=>t.isEmptyPage()),[t]),s=(0,u().K8)((()=>(0,ke().Te)(t)),[t]);return(0,F.jsxs)("div",{style:n.wrap,children:[(0,F.jsx)(ke().B6,{disabled:!0,icon:a,isEmptyPage:i,size:14,useInvertedColors:!1,iconRecordCategory:s}),(0,F.jsx)(we().A,{store:t})]})}function _t(e){const{snapshotTimestamp:t}=e,n=(0,X().tz)(),a=(0,u().K8)((()=>{var e;return(null===(e=s().default.state.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.preferred_locale)??ee().q}),[]),i=(0,R().oo)(parseInt(t),a,n,!0),o=(0,C().n)(!1);return(0,F.jsx)("div",{style:o,children:i})}function Pt(e){const{children:t,visibleMarginBottom:n=0}=e,[i,s]=(0,a.useState)(!0),o=(0,a.useRef)(null),r=(0,d().wY)(o),{value:l}=(0,g().fJ)(S().fM);if(!l)return null;const{motion:c}=l;return i?(0,F.jsx)(c.div,{initial:{opacity:0,height:0,marginBottom:0},animate:{opacity:1,height:(null==r?void 0:r.height)??0,marginBottom:n},transition:{type:"keyframes",ease:[.25,.1,.35,1],duration:.2},onAnimationComplete:()=>s(!1),style:{overflow:"hidden"},children:(0,F.jsx)("div",{ref:o,children:t})}):(0,F.jsx)("div",{style:{marginBottom:n},children:t})}function Dt(e){const{shouldSlideUp:t,citationElement:n}=e;return t?(0,F.jsx)(Pt,{visibleMarginBottom:14,children:n}):(0,F.jsx)("div",{style:{marginBottom:14},children:n})}function Et(e){const{inferenceId:t}=e,n=(0,c().v3)(),[s,o]=(0,a.useState)(!1),r=(0,u().K8)((()=>Ue().default.getActiveSessionId()),[]),l=Ze();(0,a.useEffect)((()=>{r&&t&&(0,i().u)({environment:n,event:{eventName:"assistant_world_knowledge_citation_displayed",eventProperties:{session_id:r,inference_id:t}}})}),[r,t,n]);const d=(0,a.useCallback)((()=>{if(!r||!t)return;const e=!s;o(e),(0,i().u)({environment:n,event:{eventName:"assistant_world_knowledge_citation_toggled",eventProperties:{session_id:r,inference_id:t,is_expanded:e}}})}),[n,t,s,r]);return(0,F.jsxs)(h().Y1,{direction:"vertical",gap:2,padding:"0 0 0 4px",children:[(0,F.jsx)(rt,{enabled:!0,isLoading:!1,onClick:d,open:s,isDeepFindUxActive:l,children:(0,F.jsx)(X().sA,{id:"assistantCitationHelpers.worldKnowledgeMessage",defaultMessage:"AI knowledge"})}),s?(0,F.jsx)(w().D,{styleKey:"captionMedium",colorVariant:"tertiary",children:(0,F.jsx)(X().sA,{id:"assistantCitationHelpers.worldKnowledgeMoreInfo",defaultMessage:"Generated using knowledge from GPT-4 and Claude. Double-check for accuracy."})}):null]})}},901384:(e,t,n)=>{n.d(t,{w:()=>v});n(296540);var a=()=>n(907258),i=()=>n(484714),s=()=>n(590526),o=()=>n(401497),r=()=>n(970236),l=()=>n(69708),c=()=>n(100622),d=()=>n(284371),u=()=>n(219348),p=()=>n(35392),g=()=>n(46986),m=()=>n(996477),h=()=>n(383070),f=()=>n(379178),y=n(474848);function v({isAgentNewUserExperience:e}){const t=(0,i().v3)(),n=(0,g().i7)(),v=(0,s().K8)((()=>{var e;return null===(e=(0,m().fM)(t))||void 0===e||null===(e=e.getModel())||void 0===e?void 0:e.getRenderTitle()}),[t]),S=(0,s().O$)(a().AppStoreSidebarSpaceViewStore),b=(0,s().K8)((()=>{var e;return null==S||null===(e=S.getSettings())||void 0===e||null===(e=e.agent_personalization_settings)||void 0===e?void 0:e.name}),[S]),x=(0,u().DV)(S),I=(0,s().K8)((()=>{const e=(0,f().N)(x,b);return e||(h().zD.showAssistantNotionAiCopy()?(0,y.jsx)(l().sA,{defaultMessage:"Notion AI",id:"assistantOriginElement.notionAi.tooltipHeading"}):(0,y.jsx)(l().sA,{defaultMessage:"Ask AI",id:"assistantOriginElement.default.tooltipHeading"}))}),[b,x]),k=(0,s().K8)((()=>h().zD.showAssistantNotionAiCopy()?n&&!e?null:(0,y.jsx)(l().sA,{defaultMessage:"Ask, search, or make anything",id:"assistantOriginElement.assistantCaption.hoverTooltipBody"}):v?(0,y.jsx)(l().sA,{defaultMessage:"Find pages and get answers about anything in {sidebarSpaceName}",id:"assistantOriginElement.default.withSpace.hoverTooltipBody",values:{sidebarSpaceName:v}}):(0,y.jsx)(l().sA,{defaultMessage:"Find pages and get answers about anything in your workspace",id:"assistantOriginElement.default.withoutSpace.hoverTooltipBody"})),[v,n,e]),w=(0,o().IS)((()=>({tooltip:{maxWidth:280,minWidth:Boolean(k)?180:void 0,whiteSpace:"pre-wrap",width:"max-content"},tooltipShortcut:{display:"inline-flex",alignItems:"center",borderRadius:4,color:c().Tj.text.tertiary,fontSize:12,fontWeight:d().Wy.medium,marginInlineEnd:-2,background:c().Tj.background.secondary,padding:"0 4px"},tooltipBody:{fontSize:12,color:c().Tj.text.secondary}})),[k]);return(0,y.jsxs)("div",{style:w.tooltip,children:[(0,y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,y.jsx)("span",{children:I}),e?(0,y.jsx)(r().E,{color:"blue",content:(0,y.jsx)(l().sA,{defaultMessage:"Updated",id:"assistantOriginElement.notionAi.tooltipHeadingUpdatedBadge"})}):(0,y.jsx)("span",{style:w.tooltipShortcut,children:(0,y.jsx)(p().A,{name:"commandJ"})})]}),k?(0,y.jsx)("div",{style:w.tooltipBody,children:k}):void 0]})}},904671:(e,t,n)=>{n.d(t,{BX:()=>y,YL:()=>v,lE:()=>S});var a=()=>n(242422),i=()=>n(726637),s=()=>n(221844),o=()=>n(223116),r=()=>n(295633),l=()=>n(732810),c=()=>n(350013),d=()=>n(179034),u=()=>n(519831),p=()=>n(743246),g=()=>n(534177),m=()=>n(615623),h=()=>n(769864);async function f(e){const{environment:t,sudoModeStore:n,sidebarSpaceStore:s,targetPointer:r,isAlreadyLoaded:l,clearLoadedStore:c,buildStore:d,buildRequest:u}=e;if(i().A.isMobile||l||n.state.loading||n.state.error)return;await a().default.waitUntilStatsigReady();const p=s.isReady()&&s.canAdmin(),g=await function(e,t){return(0,m().S)(e,{name:"sudo_mode",spaceId:t,userId:e.currentUser.id})}(t,s.id);if(!r.id||!p||!g)return;n.setState({...n.state,loading:!0}),c();const f=u(r),y=await h().callApi({eventName:"getPrivateRecordInfo",environment:t,data:f});if("failed"===y.type)return void n.setState({...n.state,loading:!1,error:y.error});const v=d({environment:t,recordId:r.id,privateRecordCacheName:o().Rb,ancestorData:y.data,spaceId:s.id});return n.setState({...n.state,loading:!1,error:void 0}),v}async function y(e){const{environment:t,sudoModeStore:n,pageBlockId:a,sidebarSpaceStore:i}=e,s=n.state.privatePageStore&&n.state.privatePageStore.id===a;if(!a||!i)return;const o=await f({environment:t,sudoModeStore:n,sidebarSpaceStore:i,targetPointer:{id:a,table:d().ev,spaceId:i.id},isAlreadyLoaded:Boolean(s),clearLoadedStore:()=>n.setState({...n.state,privatePageStore:void 0}),buildStore:e=>S({...e,recordTable:d().ev}),buildRequest:e=>({recordPointer:e})});o&&n.setState({...n.state,privatePageStore:o})}async function v(e){const{environment:t,sudoModeStore:n,workflowId:a,sidebarSpaceStore:i}=e,s=n.state.privateWorkflowStore&&n.state.privateWorkflowStore.id===a;if(!a||!i)return;const o=await f({environment:t,sudoModeStore:n,sidebarSpaceStore:i,targetPointer:{id:a,table:p().C0,spaceId:i.id},isAlreadyLoaded:Boolean(s),clearLoadedStore:()=>n.setState({...n.state,privateWorkflowStore:void 0}),buildStore:e=>S({...e,recordTable:p().C0}),buildRequest:e=>({recordPointer:e})});o&&n.setState({...n.state,privateWorkflowStore:o})}function S(e){const{environment:t,recordId:n,recordTable:a,privateRecordCacheName:i,ancestorData:o,spaceId:m}=e,h=new(s().A)({name:i});for(const s of o)switch(s.table){case"block":case"collection":case"workflow":case"team":h.setRecord({pointer:{spaceId:m,table:s.table,id:s.value.id},userId:t.currentUser.id},{role:"editor",value:s.value})}let f;return a===d().ev?f=new(r().B)(t,{id:n,table:d().ev},{inMemoryRecordCache:h}):a===u().Vl?f=new(l().m)(t,{id:n,table:u().Vl},{inMemoryRecordCache:h}):a===p().C0?f=new(c().N)(t,{id:n,table:p().C0,spaceId:m},{inMemoryRecordCache:h}):(0,g().HB)(a),f.inMemoryRecordCache.addCacheFallback(t.defaultRecordCache.inMemoryRecordCache),f}},907487:(e,t,n)=>{n.d(t,{J:()=>i,X:()=>s});var a=()=>n(598101);const i=[function(e){var t,a;return(0,n(68465).ZE)(e.publicEditMode,1===(null===(t=e.blocks)||void 0===t?void 0:t.length)?e.blocks[0]:null===(a=e.pageContext)||void 0===a?void 0:a.pageStore)},n(158658).p,(0,a().A)(n(462580).J)],s=[...i,(0,a().A)(n(375308).v),(0,a().A)(n(275143).y),function(e){return e.blocks.length>0}]},911339:(e,t,n)=>{n.r(t),n.d(t,{AssistantWriterPopup:()=>me,assistantWriterActions:()=>a()});var a=()=>n(551414),i=(n(898992),n(354520),n(430670),n(581454),n(296540)),s=()=>n(907258),o=()=>n(726637),r=()=>n(484714),l=()=>n(590526),c=()=>n(401497),d=()=>n(79926),u=()=>n(711339),p=()=>n(201980),g=()=>n(69708),m=()=>n(100622),h=()=>n(534177),f=()=>n(177163),y=()=>n(150984),v=()=>n(501305),S=()=>n(42452),b=()=>n(154373),x=()=>n(977270),I=()=>n(949575),k=()=>n(945710),w=()=>n(383070),C=()=>n(715142),A=()=>n(631611),T=()=>n(525569),j=()=>n(295304),M=()=>n(260850),_=()=>n(547149),P=(n(737550),()=>n(402014)),D=()=>n(483730),E=n(474848);function R(e){const{loadingState:t,store:s,sessionId:d,hideFace:u,hideStopButton:g}=e,m=(0,r().v3)(),h=(0,A().jw)(),f=(0,l().K8)((()=>s.getValue()),[s]),y=(0,i.useMemo)((()=>!f||0===(0,p().AhH)(f)),[f]),S=(0,c().IS)((()=>({wrap:{flexGrow:1,minHeight:o().A.isMobile?42:36,marginTop:o().A.isMobile?0:3,marginBottom:o().A.isMobile?0:3,display:o().A.isMobile?"flex":void 0,alignItems:o().A.isMobile?"center":void 0},rightGutter:{marginTop:o().A.isMobile?"0px":"4px",marginBottom:o().A.isMobile?"0px":"4px",display:"flex",alignItems:"center",gap:4,cursor:"pointer"}})),[]),b=(0,l().K8)((()=>D().default.getSessionContext(d)),[d]),x=(0,l().K8)((()=>null==b||!b.temporaryClientStepsFromStoreState.some((e=>"groupedEditCard"===e.type))),[b]),I=(0,i.useCallback)((async e=>{await(0,P().s7)(e,P().y$.ButtonMouseDown,(async()=>{if(!b)return;const e=(0,n(515692).z$)({environment:m,store:s,sessionContext:b,assistantSurface:h});if(e&&e.sessionEnded)try{await(0,a().maybeNewAssistantWriterChat)({environment:m,assistantSurface:h}),(0,v().setPrimeTextInput)(e.lastHumanStepText)}catch(t){}}))}),[b,m,s,h]);return(0,E.jsxs)("div",{style:{display:"flex",flex:1,gap:8,alignItems:"center",justifyContent:"center"},children:[u?void 0:(0,E.jsx)(n(939584).p,{isMultiline:!1}),(0,E.jsx)("div",{style:S.wrap,children:(0,E.jsx)(n(709380).R,{loadingState:t,handleShowSearchResults:!0})}),x&&!g?(0,E.jsx)("div",{style:S.rightGutter,onClick:I,children:(0,E.jsx)(n(537525).I,{storeIsEmpty:y,handleClickEnter:()=>null,handleClickStop:()=>null,mode:{type:"inferencing"}})}):void 0]})}n(410838);var B=()=>n(611648),F=()=>n(457726),N=()=>n(376254),L=(n(18107),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(967357),n(823215),()=>n(150669)),O=()=>n(804339),V=()=>n(695115),z=()=>n(591779),W=()=>n(297813),U=()=>n(496603),H=()=>n(267271),K=()=>n(231536),q=()=>n(651196),$=()=>n(520937),G=()=>n(59822);const Y=(0,g().YK)({closeSubActionsAriaLabel:{id:"mobileAssistantWriterActions.closeSubActionsAriaLabel",defaultMessage:"Close sub-actions"}});function Q(e){const{sections:t,context:n}=e,a=(0,c().eP)(),s=(0,g().tz)(),[o,r]=(0,i.useState)(void 0),d=(0,z().ZC)(t),u=i.useMemo((()=>(o??t).flatMap((e=>e.actions.map((t=>function(e){const{themeMode:t,context:n,section:a,action:i,setSubActions:s}=e;if(i.subActions){const e=i.subActions(n);i.action=()=>{s(e)}}if(i.clientSkill){const e=(0,$().vJ)(i.clientSkill.category);return{...i,key:`${a.key}:${i.key}`,icon:i.clientSkill.icon,color:e.color(t).color}}const o=(0,U().LW)((0,H().R2)(i.key));let r,l;if(o&&(0,h().O)($().iS,o)){const e=$().iS[o],n=(0,$().vJ)(e.category);r=e.icon,l=n.color(t).color}else i.svg&&(r=i.svg,i.svgCustomFill&&(l=i.svgCustomFill()));return{...i,key:`${a.key}:${i.key}`,icon:r,color:l}}({section:e,themeMode:a,action:t,setSubActions:r,context:n}))))).filter((e=>!e.validators||e.validators.every((e=>e(n)))))),[n,a,t,o]);(0,i.useEffect)((()=>{if(u.length>0){const e=Array.from(new Set(u.flatMap((e=>e.lazyDependencyKeys??[]))));(0,K().G)(...e)}}),[u]);const p=(0,c().IS)((()=>({container:{display:"flex",marginInlineStart:-8,marginInlineEnd:-8},subActionsIconButton:{alignSelf:"center",padding:2,marginInlineStart:8,marginBottom:-8},subActionsCloseIconStyle:{fill:m().Tj.icon.secondary,width:24,height:24},scrollerContainer:{flex:1,overflow:"hidden",position:"relative"},scroller:{display:"flex",gap:8,padding:8,marginBottom:-8},leftOverlayOverride:{background:`linear-gradient(90deg, ${m().Tj.popoverWaxPaperBackground} 0%, ${m().Tj.contentBackgroundTransparent} 100%)`},rightOverlayOverride:{background:`linear-gradient(270deg, ${m().Tj.popoverWaxPaperBackground} 0%, ${m().Tj.contentBackgroundTransparent} 100%)`}})),[]),f=(0,l().uB)(void 0,L().A);return(0,i.useEffect)((()=>{var e,n,a;(a=d??[],(n=t).length===a.length&&n.every(((e,t)=>function(e,t){return e.key===(null==t?void 0:t.key)&&e.actions.length===t.actions.length&&e.actions.every(((e,n)=>{const a=t.actions[n];return e.key===a.key}))}(e,a.at(t)))))||(r(void 0),null===(e=f.state.elementRef)||void 0===e||null===(e=e.current)||void 0===e||e.scrollTo({top:0}))}),[t,d,f]),(0,i.useEffect)((()=>{var e;null===(e=f.state.elementRef)||void 0===e||null===(e=e.current)||void 0===e||e.scrollTo({top:0})}),[o,f]),(0,E.jsxs)("div",{style:p.container,children:[o?(0,E.jsx)(V().A,{ariaLabel:s.formatMessage(Y.closeSubActionsAriaLabel),icon:W().xMarkFillIcon,onMouseDown:e=>{e.preventDefault()},onClick:()=>{r(void 0)},style:p.subActionsIconButton,iconStyle:p.subActionsCloseIconStyle}):void 0,u.length>0?(0,E.jsxs)("div",{style:p.scrollerContainer,children:[(0,E.jsx)(O().f.Provider,{value:()=>{},children:(0,E.jsx)(N().H,{store:f,type:B().A.X,style:p.scroller,children:u.map((e=>(0,E.jsx)(q().Ay,{singleLineTitle:!0,variant:"tinted",title:e.displayName,icon:t=>{var n;return null===(n=e.icon)||void 0===n?void 0:n.call(e,{...t,...e.color&&{fill:e.color}})},onClick:()=>{e.action({...n,analyticsFrom:"mobile_assistant_writer_actions"})},onMouseDown:e=>{e.preventDefault()}},e.key)))})}),(0,E.jsx)(G().A,{store:f,leftOverlayStyle:p.leftOverlayOverride,rightOverlayStyle:p.rightOverlayOverride})]}):void 0]})}function J(e){const t=(0,g().tz)(),a=(0,l().O$)(s().AppStoreSidebarSpaceStore),r=(0,l().K8)((()=>(0,C().K1)()),[]),d=(0,l().K8)((()=>(0,n(68465).cJ)()),[]),u=(0,l().K8)((()=>{if(!r)return;const e=r.temporaryClientStepsFromStoreState.findLast((e=>"assistantChat"===e.type));return e&&!(0,n(996477).Cb)(e)?e:void 0}),[r],{useDeepEqual:!0}),p=(0,l().K8)((()=>{if(r)return r.clientStepsFromStoreState.findLast((e=>"assistantNoOperationsFromReplace"===e.type))}),[r],{useDeepEqual:!0}),h=(0,l().K8)((()=>{var e;return 0===(null==r?void 0:r.clientStepsFromStoreState.filter(F().Hr).length)?null==r||null===(e=r.selectedSkillFromStoreState)||void 0===e?void 0:e.clientSkill:void 0}),[r]),f=(0,l().K8)((()=>0===(null==r?void 0:r.clientStepsFromStoreState.filter(F().Hr).length)&&(null==h?void 0:h.assistantMessage)),[r,h]),y=(0,l().K8)((()=>null==r?void 0:r.sessionIdFromStoreState),[r]),v=(0,l().K8)((()=>(0,n(101927).N8)()),[]),S=(0,l().O$)(T().default),b=(0,l().O$)(n(661077).P),x=(0,l().K8)((()=>{if(!r||"assistantCompletionPopup"===S.type&&S.loading)return;const e=r.previewingStepObservationsFromStoreState.some(n(24279).XO),a=t.formatMessage({id:"AssistantWriterPopupRenderer.error",defaultMessage:"Im sorry, Im having trouble completing this request. Please click try again or type a new command."});return e?a:null}),[S,t,r]),I=(0,l().uB)(void 0,n(143016).D),k=(0,c().IS)((()=>({messageWrap:{fontSize:o().A.isMobile?15:14,borderRadius:12,fontWeight:500,marginTop:8,marginBottom:0,marginInlineStart:4,marginInlineEnd:4,...o().A.isMobile&&{maxHeight:200,paddingBottom:0}},error:{fontSize:14,color:m().Tj.red.text.accentPrimary,padding:8}})),[]),w=(0,i.useRef)(null);if(!a)return null;const A=(0,E.jsxs)(E.Fragment,{children:[v?(0,E.jsx)(n(899377).lt,{}):void 0,d&&r?(0,E.jsx)(n(771828).A,{}):void 0,f?(0,E.jsx)("div",{style:k.messageWrap,children:t.formatMessage(f)}):void 0,u?(0,E.jsx)("div",{ref:w,children:(0,E.jsx)(N().H,{style:k.messageWrap,type:B().A.Y,children:(0,E.jsx)(n(188158).X_,{clientStep:u,parentStore:a,searchResultsSteps:[],citationHoverStore:I,disableWrap:!0,wrapperRef:w,sessionId:y})})}):void 0,p?(0,E.jsx)(n(215103).w,{}):void 0,b&&x?(0,E.jsx)("div",{style:k.error,children:x}):void 0,(0,E.jsx)(n(401535).EC,{displayAsChatStep:!1,sessionId:y,requestedSkill:h}),o().A.isMobile&&e.mobileActionArgs?(0,E.jsx)(Q,{...e.mobileActionArgs}):void 0]});return(0,E.jsx)(n(758632).M,{origin:A})}n(16280);var X=()=>n(943290),Z=()=>n(662453),ee=()=>n(286088),te=()=>n(135168),ne=()=>n(221844),ae=()=>n(547033),ie=()=>n(165358),se=()=>n(44729),oe=()=>n(391214),re=()=>n(951177),le=()=>n(299545),ce=()=>n(250452),de=()=>n(836724),ue=()=>n(600881);function pe(e){const{environment:t,sessionId:s,assistantSurfaceType:o}=e,{value:r}=(0,d().fJ)(n(659602).g),{value:l}=(0,d().fJ)(n(335722).S),{value:c}=(0,d().fJ)(n(884107).R.clipboardActions),u=(0,i.useCallback)((async({exitType:e})=>{const n=T().default.state;"assistantCompletionPopup"!==n.type||"results"!==n.stage||n.loading||(Z().aiDependency.load().then((({aiAnalyticsActions:n})=>{n.trackAICompletionPopupClose(t,{session_id:s,inference_id:void 0,exit_type:e})})),await a().acceptCursorCompletionAssistant({environment:t,assistantSurfaceType:o}))}),[o,t,s]),p=(0,i.useCallback)((e=>{const i=T().default.state;"assistantCompletionPopup"!==i.type||"results"!==i.stage||i.loading||((0,ee().Ku)(t),Z().aiDependency.load().then((({aiAnalyticsActions:e})=>{e.trackAICompletionPopupClose(t,{session_id:s,inference_id:void 0,exit_type:"insert"})})),_().createAndCommit({userAction:"AssistantCompletionPopup.handleInsert",environment:t,canUndo:!0,perform:a=>{const s=i.sessionId;(0,n(499201).V)({environment:t,sessionId:s,transaction:a,chatStep:e.chatStep})}}),a().cancelCursorCompletionAssistant({environment:t}))}),[t,s]),g=(0,i.useCallback)((async({targetBlockStore:e})=>{const i=T().default.state;if("assistantCompletionPopup"!==i.type||"results"!==i.stage||i.loading||!e)return;const r=t.currentUser.id;if(!r)throw new Error("No current user.");(0,ee().Ku)(t),Z().aiDependency.load().then((({aiAnalyticsActions:e})=>{e.trackAICompletionPopupClose(t,{session_id:s,inference_id:void 0,exit_type:"insert"})}));const l=D().default.getSessionContextOrThrow(s);await(0,n(918678).o)({environment:t,sessionId:s,assistantSurfaceType:o,updater:l.createUpdater()});const{operationsToApply:c,executableOperationsToApply:d,editGroupsThatWereApplied:u}=function(e){const{sessionId:t}=e,n=D().default.getSessionContextOrThrow(t),a=n.uncommittedExecutableOperationsFromStoreState,i=a.flatMap((({operations:e})=>e)),s=(0,X().iL)(a);return{operationsToApply:i,executableOperationsToApply:a,editGroupsThatWereApplied:s}}({sessionId:s});(0,n(677590).U)({environment:t,sessionId:s});const p=e.getParentBlockStore();if(!p)return;const g=`assistant-${(0,n(925193).W7)("apply-uncommitted-")}`,{performResult:m}=await _().createAndCommitAsync({environment:t,undoCheckpoint:g,waitForServerCommit:!1,userAction:"AssistantCompletionPopup.handleInsertSuggestions",userId:r,perform:async n=>a().insertCursorCompletionAssistantSuggestionsBelow({environment:t,targetBlockStore:e,parentStore:p,operationsToApply:c,executableOperationsToApply:d,transaction:n})}),{evaluatorFromStoreState:h}=l,f=h.state;if(null!=m&&m.editedPageIds&&m.editedPageIds.size>0)for(const t of m.editedPageIds)f.getLoadedPageIds().includes(t)||await h.loadPageWithoutAssistantStep(t);return l.addExecutableOperationsToExecutedOperationMap(d),a().cancelCursorCompletionAssistant({environment:t}),{editGroupsThatWereApplied:u,undoCheckpointName:g}}),[o,t,s]),m=(0,i.useCallback)((async e=>{const i=T().default.state;if("assistantCompletionPopup"!==i.type||"results"!==i.stage||i.loading||!c)return;const o=i.sessionId,{chatStep:d}=e;(0,ee().Ku)(t),Z().aiDependency.load().then((({aiAnalyticsActions:e})=>{e.trackAICompletionPopupClose(t,{session_id:s,inference_id:void 0,exit_type:"replace"})}));const u=await n(862292).T.formulas.load();!function(e){const{environment:t,sessionId:n,chatStep:a,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:s,clipboardActions:o,formulasModule:r}=e,l=D().default.getSessionContextOrThrow(n).evaluatorFromStoreState.state.getAssistantSelectionIfExists();if(l&&(0,ue().Jw)({assistantSelection:l}))if("block"===l.type){const e=l.blockIds.at(-1);if(!e)return void ie().log({level:"info",from:"assistantResponseActions",type:"assistantSelectionNotReplaceable",error:{message:"[block] No lastSelectedBlockId."}});const n=de().T.findSelectablesFromIds(l.blockIds),i=n.at(-1);if(!i||i.props.store.id!==e)return void ie().log({level:"info",from:"assistantResponseActions",type:"assistantSelectionNotReplaceable",error:{message:"[block] No foundSelectable for last selection block."}});const s=i.props.store,o=s.getRecordStoreUIParent();if(!o||!(0,le().iU)(o))return void ie().log({level:"info",from:"assistantResponseActions",type:"assistantSelectionNotReplaceable",error:{message:"[block] No blockParentStore."}});const r=(0,y().generateBlockStoresForClientChatStep)({environment:t,clientStep:a,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,stripCitations:!0,isPreviewing:!1}).map((e=>e.cloneWithNewUIParent(o)));_().createAndCommit({userAction:"assistantActions.blockSelectionReplace",environment:t,canUndo:!0,perform:e=>{oe().LE({environment:t,blocksToInsert:r,target:[s],replaceEmptyTextBlock:!0,transaction:e});for(const t of n){const n=t.props.store,a=n.getRecordStoreUIParent();a&&se().zz({parentStore:a,childStore:n,transaction:e})}}})}else if("text"===l.type){const[e,n]=de().T.findSelectablesFromIds([l.start.blockId,l.end.blockId]);if(!e||!n)return void ie().log({level:"info",from:"assistantResponseActions",type:"assistantSelectionNotReplaceable",error:{message:"[text] No startSelectable or endSelectable."}});const c=e.props.store,d=n.props.store,u=(0,ce().aI)(c),p=(0,ce().aI)(d);if(!u||!p)return void ie().log({level:"info",from:"assistantResponseActions",type:"assistantSelectionNotReplaceable",error:{message:"[text] No startBlockEditTextStore or endBlockEditTextStore."}});(0,ae().setMultiSelection)({multiSelection:{start:{store:u,index:l.start.index},end:{store:p,index:l.end.index}}});const g=(0,y().generateBlockStoresForClientChatStep)({environment:t,clientStep:a,inMemoryRecordCache:new(ne().A)({name:"assistantActions.replaceSelection.text"}),stripCitations:!0,isPreviewing:!1}),m=(0,re().ZI)({rootBlock:{...g[0].pointer,spaceId:g[0].getSpaceId()},blockValues:g.map((e=>e.getValue())).filter(h().O9),getRecordValue:g[0].getRecordValue,isWindows:t.device.isWindows,markdownLinkifyIt:i,formulasModule:r,spaceIdCreator:t.idCreator.getSpaceIdCreatorSync(g[0].getSpaceId()??"")}).markdown??"";_().createAndCommit({userAction:"assistantActions.textSelectionReplace",environment:t,canUndo:!0,perform:e=>{o.pasteMarkdown({environment:t,spaceStore:(0,te().f)(c),text:m,transaction:e,disableEmbedMenu:!0,overwrite:!0,selectAll:!0,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:s})}})}else(0,h().HB)(l);else ie().log({level:"info",from:"assistantResponseActions",type:"assistantSelectionNotReplaceable",error:{message:"assistantSelection is not replaceable."}})}({environment:t,sessionId:o,chatStep:d,clipboardActions:c,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:l,formulasModule:u}),a().cancelCursorCompletionAssistant({environment:t})}),[t,r,s,l,c]);return(0,i.useMemo)((()=>({onAccept:u,onInsert:p,onReplace:m,onInsertBlockSuggestions:g})),[u,p,m,g])}const ge="notion-assistant-writer-ui",me=i.memo((function(e){const{completionState:t}=e,P=(0,i.useRef)(null),D=(0,l().K8)((()=>(0,C().K1)()),[]),B=(0,l().K8)((()=>null==D?void 0:D.assistantConfigurationStore),[null==D?void 0:D.assistantConfigurationStore]);(0,i.useEffect)((()=>()=>{x().assistantOriginElementStore.setAssistantLastViewedTime()}),[]);const F=(0,r().v3)(),N=(0,g().tz)(),L=(0,c().DP)(),O=(0,n(300474).r)(),V=(0,n(528093)._)({name:"ai_usage",spaceId:O,userId:F.currentUser.id,amount:"unknown"}),z=o().A.isMobile?A().wy.mobileWriter:A().wy.writer;(0,i.useEffect)((()=>{(0,y().submitVectorDbWarmUpQuery)({environment:F,assistantSurfaceType:"fullPage"})}),[F]);const W=(0,l().K8)((()=>{const e=null==B?void 0:B.state;return Boolean((null==e?void 0:e.sampling)||(null==e?void 0:e.evaluating))}),[B]),{store:U}=(0,n(483795).AI)({initialValue:t.prefilledValue?(0,p().x9d)(t.prefilledValue):void 0}),H=(0,l().K8)((()=>U.getValue()),[U]),K=(0,l().K8)((()=>(0,p().k4p)(H)),[H]),q=(0,i.useCallback)((async e=>{const{showDiscardModal:n,restoreSelection:i}=e;await(0,v().confirmAndDiscardPendingEditsIfApplicable)({environment:F,humanInput:H,assistantSurface:z,assistantInputTextStore:U,discardWithoutConfirmation:!n})&&("results"===t.stage&&a().cancelAssistantCompletion({environment:F,completionState:t}),(0,f().closeInitialPromptAndEndSession)(F,i))}),[F,t,H,U,z]),$=(0,i.useCallback)((async e=>{const{newValue:i}=e;if(!i)return;const o=u().default.DO_NOT_USE_markLegacy("assistant.writer_submit_lag");u().default.DO_NOT_USE_measureAfterNextFlushLegacy(o,{environment:F});const r=t.stage;T().default.setState({...t,stage:"results"});const{currentUserSettingsStore:l,currentUserStore:c,sidebarSpaceViewStore:d}=s().default.state;l&&(0,n(576590).setLastUsedAIWriterAtToCurrentTimestamp)(F,{userSettingsStore:l}),await a().refreshAssistantCompletion({environment:F,updater:T().default.createUpdater(),humanText:i,from:z.type});const p=(0,C().K1)(),g=null==p?void 0:p.selectedSkillFromStoreState,m="results"===r&&g&&(0,n(847832).yH)(g.clientSkill.skillType)&&p.getHasCommittedHumanStep();c&&d&&p&&("initialPrompt"===r||m)&&_().createAndCommit({userAction:"assistant.saveRecent",environment:F,canUndo:!0,perform:e=>(0,b().Wq)({environment:F,transaction:e,currentUserStore:c,currentSpaceViewStore:d,fromAssistantSurface:A().wy.writer.type,assistantSessionContext:p})})}),[t,F,z.type]);(0,i.useEffect)((()=>{W||(0,M().z)({store:U})}),[F,U,W]);const G=(0,i.useMemo)((()=>({environment:F,blocks:[],publicEditMode:void 0,analyticsFrom:"assistant_writer_menu",pageContext:void 0})),[F]);(0,l().K8)((()=>{W!==t.loading&&T().default.setState({...t,loading:W})}),[W,t]);const Y=pe({environment:F,sessionId:t.sessionId,assistantSurfaceType:z.type}),Q=(0,n(514624).T)(D),X=(0,i.useCallback)((async()=>{if(!D)return;D.setNextHumanStepAsRetry();const e=await(0,S().E)({environment:F,sessionId:D.sessionIdFromStoreState,assistantSurface:z});if(n(973647).Q.isSuccess(e)){const{textValue:t}=e.value;await n(908006).default.afterNextFlush(),U&&(_().createAndCommit({userAction:"AssistantWriterPopup.tryAgain",environment:F,canUndo:!0,perform:e=>{j().R9({environment:F,store:U,value:t,transaction:e})}}),(0,M().z)({store:U}))}else await(0,S().t)({environment:F,sessionId:D.sessionIdFromStoreState,assistantSurfaceType:z.type});x().assistantAnalyticsActions.trackUserClickedAssistantTryAgain(F,{sessionId:D.sessionIdFromStoreState,assistantSurfaceType:z.type})}),[D,F,U,z]),Z=(0,l().K8)((()=>w().zD.isNewWriterInputDesignEnabled(z)),[z]),ee=(0,n(84262).Pd)(V)?null==V?void 0:V.upsell:void 0,te=(0,l().K8)((()=>w().zD.isXMLAssistantEnabled()),[]),ne=(0,n(920198).L)(),ae=te?"ai_assistant_limit_in_app":"ai_qna_limit_in_app",{upgradeEligibility:ie,handleClick:se}=(0,n(408543).C)({upsell:ee,source:ae,spaceStore:ne}),oe=(0,n(59226).X)("upgrade_system_ai"),re=(0,n(604018).bp)(),le=(0,l().K8)((()=>w().zD.isLimitedQnaMode()&&!re&&"not_eligible"!==ie.status),[ie,re]),ce=(0,n(926974).ot)(),de=(0,l().K8)((()=>null!=ce&&ce.isCollectionView()?ce.getCollectionPointers():void 0),[ce]),ue=(0,l().K8)((()=>de?(0,I().clientSkillToAssistantSurfaceAction)(de.flatMap((e=>(0,k().getAllClientSkills)({currentPageRecordPointer:null==ce?void 0:ce.pointer,currentCollectionRecordPointer:e})))):(0,I().clientSkillToAssistantSurfaceAction)((0,k().getAllClientSkills)({currentPageRecordPointer:null==ce?void 0:ce.pointer,currentCollectionRecordPointer:void 0}))),[ce,de]),me=(0,n(897526).Z)({assistantSurface:z}),Se=(0,l().K8)((()=>{const e=(0,I().filterAssistantSurfaceActionsForContext)(ue,me);return(0,n(310770).d7)({assistantSuggestionContext:me,validatedActions:e}).filter(k().isAssistantSurfaceActionWithClientSkill).map((e=>({...e,isSuggested:!0})))}),[ue,me]),be=(0,l().K8)((()=>{var e;return 0===(null==D?void 0:D.clientStepsFromStoreState.length)?null==D||null===(e=D.selectedSkillFromStoreState)||void 0===e?void 0:e.clientSkill:void 0}),[D]),xe=(0,l().K8)((()=>{const e=s().default.state.sidebarSpaceViewStore,t=s().default.state.currentUserSettingsStore;return e&&"writer"===z.type&&t?(0,b().E4)({currentSpaceViewStore:e,currentUserSettingsStore:t,fromAssistantSurface:z}):[]}),[z]),Ie=(0,l().K8)((()=>{const e=s().default.state.sidebarSpaceViewStore;return e&&"writer"===z.type?(0,b().VP)({currentSpaceViewStore:e,fromAssistantSurface:z}).map((e=>e.getModel())).filter(h().O9):[]}),[z]),ke=(0,l().K8)((()=>{const{sidebarSpaceViewStore:e,currentUserStore:a,currentUserSettingsStore:i}=s().default.state;return ne&&e&&a&&i?(0,n(607833).x3)({assistantSurface:z,environment:F,intl:N,theme:L,filter:K,mockTextStore:U,state:t,from:t.from,context:G,completionResultInfo:{...Y,onRetry:X,onCancel:e=>q(e),onMoveToCorner:()=>{}},assistantConfigurationStore:B,shouldShowLimitedQnaUpsell:le,assistantSuggestionContext:me,suggestedSectionSkills:Se,currentPageStore:ce,requestedSkill:be,favorites:xe,recents:Ie,spaceStore:ne,currentSpaceViewStore:e,currentUserSettingsStore:i,currentUserStore:a,handleSubmit:$,aiUsageAvailability:V,upgradeEligibility:ie,upgradeAction:se,isUpgradeSystemEnabled:oe}):[]}),[z,F,N,L,K,U,t,G,Y,X,B,le,me,Se,ce,be,xe,Ie,$,V,q,ie,se,oe,ne]),we=ke.length>0,Ce=(0,l().uB)(void 0,n(452004).$),Ae=function(){const{isPhone:e}=(0,r().Y0)();return(0,c().IS)((()=>({wrap:{display:"flex",borderRadius:e?"12px 12px 0 0":12,background:m().Tj.popoverBackground,boxShadow:m().Tj.shadowMD,overflow:"hidden",isolation:"isolate",flexDirection:"column",gap:2,paddingTop:2,paddingBottom:2,paddingInlineStart:12,paddingInlineEnd:12},inputWrap:{width:"100%",minHeight:o().A.isMobile?50:42,padding:0,display:"flex",alignItems:"center",gap:8,fontSize:o().A.isMobile?16:14},inputOverrides:{padding:0,marginInlineStart:0,marginInlineEnd:0,boxShadow:"unset",borderRadius:0,backgroundColor:"unset"},textContainerOverrides:{paddingTop:8,paddingBottom:8,paddingInlineStart:2.5,paddingInlineEnd:2.5,marginInlineStart:-2.5,marginInlineEnd:-2.5,boxSizing:"content-box"},chatWrap:{padding:8,fontSize:o().A.isMobile?15:14},menuPopup:{marginTop:4,marginBottom:4,borderRadius:8,background:m().Tj.popoverBackground,boxShadow:m().Tj.shadowMD,width:o().A.isMobile?"100%":"fit-content",minWidth:o().A.isMobile?void 0:280,maxWidth:o().A.isMobile?void 0:320,overflow:"hidden",isolation:"isolate"},floatingNosy:{position:"absolute",top:"8px",insetInlineStart:"-40px"},agentWriterBanner:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginTop:6,padding:"8px 12px",borderRadius:8,backgroundColor:m().Tj.palette.translucentGray[100]},agentWriterBannerText:{flex:1,color:m().Tj.text.secondary,fontSize:13,lineHeight:"18px"}})),[e])}(),{value:Te}=(0,d().fJ)(n(680474).fM),je=(0,i.useMemo)((()=>null!=Te&&Te.cubicBezier?{duration:.2,delay:.05,ease:(0,Te.cubicBezier)(.25,.1,.25,1)}:void 0),[Te]);(0,n(248053).I)(F,U),(0,i.useEffect)((()=>{function e(e){return!!(e instanceof Element&&(e.closest(`.${ge}`)||e.closest(`.${n(882722).qZ1}`)||e.closest(`.${n(84671).u}`)||(0,n(253579).Rp)(e)))}function t(t){e(t.target)||"click"!==t.type&&"contextmenu"!==t.type||((0,h().O9)(D)&&D.getAllPendingNonCreateExecutableOperations().length>0&&(t.stopPropagation(),t.preventDefault()),q({showDiscardModal:!0}))}return window.addEventListener("click",t,!0),window.addEventListener("contextmenu",t,!0),()=>{window.removeEventListener("click",t,!0),window.removeEventListener("contextmenu",t,!0)}}),[q,D]);const Me=i.useMemo((()=>({sections:ke,context:G})),[ke,G]),_e=(0,i.useCallback)((()=>{q({showDiscardModal:!1})}),[q]),Pe=(0,i.useCallback)((()=>{"initialPrompt"===t.stage&&q({showDiscardModal:!1})}),[q,t.stage]),De=(0,i.useCallback)((()=>{if("spacebar"!==t.from||"initialPrompt"!==t.stage)return;q({showDiscardModal:!1,restoreSelection:!1});const e=t.context;"textSelection"!==e.type&&"cursor"!==e.type||_().createAndCommit({userAction:"insert_text",environment:F,canUndo:!0,perform:t=>{j().$D({environment:F,editorMode:"default",string:" ",transaction:t,disableSlashCommands:!0,disableEmojiCommands:!0,disableMentions:!0,multiSelection:e.textSelection})}})}),[q,F,t.from,t.context,t.stage]),Ee=(0,i.useCallback)((()=>{o().A.isMobile||"initialPrompt"!==t.stage||q({showDiscardModal:!1})}),[q,t.stage]);if(!Te)return null;const{motion:Re}=Te,Be={store:U,onSubmit:$,onEsc:_e,onBackspaceOnEmptyInput:Ee,onSpaceOnEmptyInput:De,inputContainerOverrideStyles:Ae.inputOverrides,textContainerOverrideStyles:Ae.textContainerOverrides,requestedSkill:void 0,assistantChatRenderState:he,isSampling:W,emptyStateResultsIsEmpty:!1,sessionId:t.sessionId};return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(n(782482).N,{capture:!0,onEsc:_e,debugName:"AssistantWriterPopup"}),(0,E.jsxs)(A().hP,{surface:z,children:[(0,E.jsx)(n(379018).F,{}),(0,E.jsxs)(Re.div,{style:Ae.wrap,initial:fe,animate:ye,transition:je,className:ge,children:[Z?(0,E.jsx)("div",{style:Ae.floatingNosy,children:(0,E.jsx)(n(783793).x,{variant:"small"})}):void 0,(0,E.jsx)(J,{mobileActionArgs:Me,mockTextStore:U}),Q?(0,E.jsx)(R,{sessionId:t.sessionId,loadingState:Q,store:U,hideFace:o().A.isMobile||Z,hideStopButton:o().A.isMobile}):void 0,!Q||o().A.isMobile?(0,E.jsx)("div",{style:Ae.inputWrap,ref:P,children:(0,E.jsx)(n(128555).U,{...Be,isYassified:Z,maybeRestoreLastHumanStepOnScopeChange:!0})}):void 0]}),!o().A.isMobile&&we?(0,E.jsx)(Re.div,{style:Ae.menuPopup,initial:fe,animate:ye,transition:je,className:ge,children:(0,E.jsx)(ve,{sections:ke,context:G,menuListStore:Ce,completionState:t,isInputEmpty:!K,onEmptyEnter:Pe,mockTextStore:U})}):void 0]})]})})),he={type:"chat"},fe={opacity:0,scale:.98,y:4},ye={opacity:1,scale:1,y:0};function ve(e){const{sections:t,context:a,menuListStore:s,completionState:o,isInputEmpty:d,onEmptyEnter:u,mockTextStore:g}=e,h=(0,r().v3)(),y=(0,i.useRef)(null),v=(0,l().K8)((()=>n(762771).A.state.open),[]),S=d&&"results"!==o.stage;(0,i.useCallback)((()=>{n(248140).A.updateLocalOverrideGate("agent_writer",!0);const e=g.getValue()??(0,p().x9d)("");(0,f().closeInitialPromptAndEndSession)(h,!1),T().default.setState({type:"agentCompletionPopup",stage:"initialPrompt",context:o.context,from:o.from,prefilledValue:e})}),[o.context,o.from,h,g]),(0,c().IS)((()=>({agentWriterPromoHeader:{display:"flex",backgroundColor:m().Tj.background.secondary,color:m().Tj.text.secondary,borderRadius:8,margin:8,padding:8,alignItems:"center"}})),[]);return(0,E.jsx)("div",{ref:y,children:(0,E.jsx)(n(890492).A,{menuType:n(546926).gu.Popup,width:"100%",maxHeight:"min(40vh, 320px)",maxWidth:"100%",header:void 0,children:(0,E.jsx)(n(636714).A,{keyboardPriority:1,disableKeyboard:v,menuListStore:s,sections:t,initialFocus:S?void 0:0,context:a,resetInitialFocusOnSectionChangeAlways:!0,onEmptyEnter:u,role:"toolbar"})})})}},912771:(e,t,n)=>{n.d(t,{q:()=>r});var a=()=>n(726637),i=()=>n(340498),s=()=>n(284371),o=()=>n(631611);function r(){const e=(0,o().jw)().isType("fullPage");return a().A.isMobile?{smallTextSize:s().J.UISmall.mobile,chatBodyTextSize:s().J.UIRegular.mobile,inputHeight:36,actionButtonLabelTextSize:s().J.UIRegular.mobile,actionIconSize:i().lD.default,actionButtonHeight:36,chatLineHeight:s().K_.UIRegular.mobile}:{smallTextSize:s().J.UISmall.desktop,chatBodyTextSize:e?16:s().J.UIRegular.desktop,inputHeight:36,actionButtonLabelTextSize:s().J.UIRegular.desktop,actionIconSize:i().Ev.default,actionButtonHeight:32,chatLineHeight:"1.5em"}}},918052:(e,t,n)=>{n.d(t,{s:()=>h});n(898992),n(354520),n(908872);var a=n(296540),i=()=>n(484714),s=()=>n(590526),o=()=>n(929219),r=()=>n(187174),l=()=>n(96689),c=()=>n(955104),d=()=>n(69708),u=()=>n(534177),p=()=>n(596120);const g=new(n(99895).G)((()=>0));async function m(e){const{environment:t,parentStore:n,workflowId:a,limit:i,cursor:s,types:r,userId:c,filter:d}=e;if(!o().A.state.online)return;const u=n.table===l().NX?n.id:n.getSpaceId();if(a){const e=await t.api.callCellCompatibleApi({eventName:"getInferenceTranscriptsForWorkflow",environment:t,cellNavigation:{spaceId:u},data:{workflowId:a,spaceId:u,userId:c,limit:i,cursor:s,filter:d}});if("failed"===e.type)return;return{transcripts:e.data.transcripts,nextCursor:e.data.nextCursor}}{const e=n.table===l().NX?{table:l().NX,id:n.id,spaceId:n.id}:n.getSpaceShardedPointer(),a=await t.api.callCellCompatibleApi({eventName:"getInferenceTranscriptsForUser",environment:t,cellNavigation:{spaceId:u},data:{threadParentPointer:e,limit:i,cursor:s,types:r}});if("failed"===a.type)return;return{transcripts:a.data.transcripts,nextCursor:a.data.nextCursor}}}function h(e){const{parentStore:t,threadStore:n,workflowId:o,enableInfiniteScroll:l=!1,pageSize:h,types:f,userId:y,filter:v}=e,S=e.isEnabled??!0,b=(0,i().v3)(),x=(0,d().tz)(),[I,k]=(0,a.useState)({}),[w,C]=(0,a.useState)({}),[A,T]=(0,a.useState)(void 0),[j,M]=(0,a.useState)(!1),[_,P]=(0,r().Yb)((async()=>{if(!S)return;if(!t)return;const e=await m({environment:b,parentStore:t,workflowId:o,limit:l?h:void 0,types:f,userId:y,filter:v});if(!e)return;const{transcripts:n,nextCursor:a}=e;l&&T(a);const i=n.reduce(((e,t)=>(e[t.id]=t,e)),{});return k(i),i}),[t,b,S,o,l,h,f,y,v]);(0,a.useEffect)((()=>{if(!o||!_.value)return;const e=g.get(o),t=Object.keys(I).length;e!==t&&(c().u4({name:"thread_history_loaded",args:{count:t}}),g.set(o,t))}),[o,I,_.value]);const D=(0,s().K8)((()=>n?function(e){const{threadStore:t,intl:n}=e,a=t.getDataStore(),i=t.getCreatedByStore();return{id:t.id,title:a.getKeyStore("title").getValue(),created_at:t.getCreatedTime(),updated_at:t.getUpdatedTime(),created_by_display_name:null==i?void 0:i.getDisplayName(n),trigger_id:void 0,run_id:void 0}}({threadStore:n,intl:x}):void 0),[n,x]),E=(0,a.useCallback)((async()=>{if(t&&l&&A&&!j){M(!0);try{const e=await m({environment:b,parentStore:t,workflowId:o,limit:h,cursor:A,types:f,userId:y,filter:v});if(e){const{transcripts:t,nextCursor:n}=e,a=t.reduce(((e,t)=>(e[t.id]=t,e)),{});k((e=>({...e,...a}))),T(n)}}finally{M(!1)}}}),[t,b,o,l,A,j,h,f,y,v]);(0,a.useEffect)((()=>{D&&C((e=>({...e,[D.id]:D})))}),[D]);const R=(0,a.useMemo)((()=>{const e={...I,...w};return Object.values(e).sort(((e,t)=>(0,p().X)({createdTime:e.created_at,updatedTime:e.updated_at},{createdTime:t.created_at,updatedTime:t.updated_at})))}),[w,I]);return(0,a.useMemo)((()=>{const e=Boolean(A);switch(_.status){case"pending":case"rejected":case"idle":return{..._,refetch:P,value:void 0,...l?{loadMore:E,hasMore:e,isLoadingMore:j}:{}};case"resolved":return{..._,refetch:P,value:R,...l?{loadMore:E,hasMore:e,isLoadingMore:j}:{}};default:(0,u().HB)(_)}}),[_,l,A,j,E,R,P])}},918678:(e,t,n)=>{n.d(t,{o:()=>l});var a=()=>n(206267),i=()=>n(483730),s=()=>n(259091),o=()=>n(50744),r=()=>n(808725);async function l(e){const{environment:t,sessionId:n,updater:l,assistantSurfaceType:c}=e,d=i().default.getSessionContextOrThrow(n);(0,s().x)(t);const{previewingStepFromStoreState:u}=d;if(!u)return[];const{observations:p}=await(0,r().T)({environment:t,step:u,commit:!0,isStreaming:!1,sessionId:n,inferenceId:d.latestCommitInferenceIdFromStoreState,updater:l});return l.write((()=>{d.commitPreviewingStep()})),p.length>0&&await(0,o().f)({environment:e.environment,inferenceId:a().JW(),sessionId:n,updater:l,assistantSurfaceType:c}),p}},922528:(e,t,n)=>{n.d(t,{m:()=>g});n(296540);var a=()=>n(484714),i=()=>n(590526),s=()=>n(849255),o=()=>n(424400),r=()=>n(798880),l=()=>n(695608),c=()=>n(69708),d=()=>n(453697),u=()=>n(650598),p=n(474848);function g({userId:e,role:t,isGuest:n}){const g=(0,c().tz)(),m=(0,a().v3)(),{userStore:h,userName:f}=(0,i().K8)((()=>{const t=new(s().L)(m,{table:r().oo,id:e}),n=(0,l().c6)(g,t.getModel());return{userStore:t,userName:n}}),[m,e,g]),y=(0,u().J)(g,t);return(0,p.jsx)(o().Ay,{desktopIconStyle:{alignSelf:"center",width:24},icon:(0,p.jsx)(d().A,{userStore:h,size:24}),title:f,caption:n?(0,p.jsx)(c().sA,{id:"adminContentSearchTab.pagesTable.sharedWithCell.guest",defaultMessage:"Guest{maybeRoleString}",values:{maybeRoleString:y?`  ${y}`:""}}):(0,p.jsx)(c().sA,{id:"adminContentSearchTab.pagesTable.sharedWithCell.member",defaultMessage:"Member{maybeRoleString}",values:{maybeRoleString:y?`  ${y}`:""}})})}},924102:(e,t,n)=>{n.d(t,{o:()=>o});var a=()=>n(680977),i=()=>n(680074),s=()=>n(547149);function o({environment:e,featureKey:t}){var n;const o=(0,i().R$)(e);if(!o)return;const r=null===(n=o.getSettings())||void 0===n?void 0:n.exposed_to_adoption_feature;s().createAndCommit({environment:e,userAction:"userSettingsActions.setAdoptionFeatureExposure",canUndo:!0,cellTarget:"main",perform:e=>{(0,a().m)({userSettingsStore:o,transaction:e,data:{exposed_to_adoption_feature:{...r,[t]:[...(null==r?void 0:r[t])??[],Date.now()]}}})}})}},926974:(e,t,n)=>{n.d(t,{LC:()=>m,MC:()=>p,h0:()=>g,ot:()=>d,tk:()=>u});n(18107),n(967357),n(898992),n(823215),n(354520),n(672577),n(581454),n(737550);var a=()=>n(590526),i=()=>n(295633),s=()=>n(943290),o=()=>n(179034),r=()=>n(496603),l=()=>n(534177),c=()=>n(525569);function d(){return(0,a().K8)((()=>{const e=c().default.state;if("assistantCompletionPopup"===e.type)return e.context.currentPage}),[])}function u(e){const{sessionContext:t,currentPageStore:n}=e;if(!n)return;const a=t.getAllPendingExecutableOperations();if(!p({executableOperations:a}))return;if(!m({pendingExecutableOperations:a,currentPageStore:n}))return;const s=g({operations:a});if(s.find((e=>"unknown-block"===e.tagName)))return;return s.map((e=>e.attributes.id)).map((e=>{if(n)return i().B.createChildStore(n,{id:e,table:o().ev})})).filter(l().O9).at(0)}function p(e){const{executableOperations:t}=e;return t.every((e=>"addBlockToPage"!==e.command&&"setBlockParent"!==e.command&&"moveBlock"!==e.command&&"insertOrMoveTableColumns"!==e.command&&"removeTableColumn"!==e.command&&("setBlockText"===e.command||"setBlockAttribute"===e.command||"setBlockProperty"===e.command||"setBlockTagName"===e.command||"removeBlock"===e.command||"createBlock"===e.command||"insertBlockAfter"===e.command||"insertBlockBefore"===e.command||void(0,l().HB)(e))))}function g(e){const{operations:t}=e,n=["createBlock","insertBlockAfter","insertBlockBefore"];return r().sb(t.filter((e=>!n.includes(e.command))).map(s().wF))}function m(e){var t;const{pendingExecutableOperations:n,currentPageStore:a}=e,s=g({operations:n});if(0===s.length)return!0;const l=(null===(t=s.at(0))||void 0===t||null===(t=t.parent)||void 0===t?void 0:t.attributes.id)??a.id;if(!r().Si(s,(e=>{var t;return r().n4(null===(t=e.parent)||void 0===t?void 0:t.attributes.id,l)})))return!1;return function(e,t){let n=t.indexOf(e[0]);if(-1===n)return!1;for(let a=1;a<e.length;a++){if(t.at(n+1)!==e[a])return!1;n+=1}return!0}(s.map((e=>e.attributes.id)),(l===a.id?a:i().B.createChildStore(a,{id:l,table:o().ev,spaceId:a.getSpaceId()})).getContentIds())}},931711:(e,t,n)=>{n.r(t),n.d(t,{SlackConnectionOptions:()=>V});n(944114),n(898992),n(354520),n(581454);var a=n(296540),i=()=>n(564884),s=()=>n(300474),o=()=>n(920198),r=()=>n(836095),l=()=>n(59226),c=()=>n(484714),d=()=>n(852507),u=()=>n(590526),p=()=>n(401497),g=()=>n(792057),m=()=>n(249046),h=()=>n(807449),f=()=>n(98126),y=()=>n(546926),v=()=>n(406094),S=()=>n(890492),b=()=>n(81068),x=()=>n(663639),I=()=>n(736847),k=()=>n(775842),w=()=>n(212727),C=()=>n(112886),A=()=>n(922189),T=()=>n(737693),j=()=>n(236262),M=()=>n(69708),_=()=>n(100622),P=()=>n(284371),D=()=>n(769864),E=()=>n(61958),R=()=>n(576590),B=()=>n(383070),F=()=>n(751699),N=()=>n(610083),L=n(474848);const O=(0,M().YK)({userOverwritePopupTitle:{id:"slackConnectionOptions.overwriteEmail.title",defaultMessage:"User Authorization"},enterpriseSearchSection:{id:"slackConnectionOptions.enterpriseSearch",defaultMessage:"Enterprise Search"},selectChannels:{id:"slackConnectionOptions.channelsConfigureAccess",defaultMessage:"Configure access"},customAgentsSectionViewAndPost:{id:"slackConnectionOptions.customAgentsViewAndPost",defaultMessage:"Custom Agents can{space}<b>view</b>{space}and{space}<b>post</b>{space}messages"},customAgentsSectionViewOnly:{id:"slackConnectionOptions.customAgentsViewOnly",defaultMessage:"Custom Agents can{space}<b>view</b>{space}messages"},configureAccess:{id:"slackConnectionOptions.configureAccess",defaultMessage:"Configure access"},disconnectSlack:{id:"slackConnectionOptions.disconnectSlack",defaultMessage:"Disconnect Slack"}});function V({parent:e,from:t}){var n;const s=(0,c().v3)(),[v,k]=(0,a.useState)(),A=(0,l().X)("ingestion_mapped_child_spaces"),F=(0,o().L)(),V=(0,p().IS)((()=>({privateConnectedLabel:{color:_().Tj.text.primary},caption:{color:_().Tj.text.tertiary,fontSize:12,textWrap:"wrap"},option:{paddingTop:4,paddingBottom:4},optionLabel:{fontSize:14,marginBottom:2},disabledOptionLabel:{color:_().Tj.text.tertiary,fontSize:14,marginBottom:2},iconWrapper:{paddingTop:4},menuSubtitle:{padding:"8px 12px"},disconnectIcon:{color:_().Tj.red.icon.accentPrimary},disconnectLabel:{fontSize:14,marginBottom:2,color:_().Tj.red.text.accentPrimary}})),[]),H=null==F?void 0:F.id,K=(0,u().K8)((()=>N().Rh.state.isPublicSync),[]),q=(0,u().K8)((()=>(null==F?void 0:F.canAdmin())??!1),[F]),$=(0,u().K8)((()=>N().Rh.state.isSyncCompleted),[]),G=(0,u().K8)((()=>N().Rh.state.sessionId),[]),Y=(0,u().O$)(N().Rh),[Q,J]=a.useState(!0),[X,Z]=a.useState([]),ee=(0,u().K8)((()=>N().Rh.state.isDisconnecting),[]),te=(0,u().K8)((()=>N().Rh.state.analyticsFrom),[]),ne=(0,u().K8)((()=>B().zD.state.isSlackV2AiConnectorEnabled()&&2===N().Rh.state.connectionVersion),[]),[ae,ie]=(0,a.useState)(!0),se=(0,u().K8)((()=>N().Rh.state.isSlackGridAiConnectorEnabled),[]),oe=(0,u().K8)((()=>N().Rh.state.writeAccessApproved),[]),re=(0,u().K8)((()=>B().zD.isSlackConnectorUnificationEnabled()),[]);(0,d().l)((async()=>{if(!H)return;if(A){const e=await D().callApi({eventName:"getMappedParentSpace",environment:s,data:{spaceId:H}});if("success"!==e.type)return;if(e.data.isMapped)return k(e.data),void J(!1)}"success"===(await(0,R().updateSlackConnectionStatus)({environment:s,spaceId:H})).status&&N().Rh.state.connectedApps&&Z(N().Rh.state.connectedApps),J(!1)}));const le=X.includes("slack-admin"),ce=X.includes("slack"),de={key:"slack-ingestion-admin-auth",label:z(X,$,K,se,V),caption:W(q,X,K,ee,$),icon:(0,L.jsx)(h().I,{icon:T().V}),disabled:!0,connected:le,hidden:!1,action:()=>{H&&((0,R().navigateToAIConnectorOnboarding)({analyticsFrom:t||"chat_menu",connector:"slack"}),(0,i().u)({environment:s,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"connect_public_slack",integration_type:"slack",setup_session_id:G,from:t||te}}}))}},ue=null!=v&&v.isMapped?[{key:"inherited-space",label:(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.connectionDisabled",defaultMessage:"Disabled"}),caption:(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.disabledDescription",defaultMessage:"Cannot connect Slack to this space. Slack connection is inherited from {parentSpaceName}",values:{parentSpaceName:(0,L.jsx)("u",{children:null===(n=v.spaceDetails)||void 0===n?void 0:n.spaceName})}}),icon:(0,L.jsx)(h().I,{icon:T().V}),disabled:!0,connected:!1,hidden:!1,action:()=>{}}]:[de,{key:"slack-overwrite-email",label:(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.overWriteEmail",defaultMessage:"Log in to Slack"}),caption:(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.overWriteEmailCaption",defaultMessage:"We couldnt verify your Slack e-mail. Click to authenticate."}),icon:(0,L.jsx)(h().I,{icon:C().keyFillSmallIcon,size:"sm"}),disabled:!1,connected:ce,hidden:!!se||(!$||ae),action:async()=>{if(!H)return;(0,i().u)({environment:s,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"connect_slack_user_mapping",integration_type:"slack",setup_session_id:G,from:t||te}}});const e=await D().callApi({eventName:"getSlackIngestionAuthorizeUrl",environment:s,data:{spaceId:H,isAdminAuth:!1,isDesktopApp:s.device.isElectron,isUserMapping:!0,sessionId:G}});"success"===e.type&&(s.device.isElectron?(0,r().P)(e.data.url):await E().P(s,{width:800,height:600,url:e.data.url,titleMessage:O.userOverwritePopupTitle}))}},{key:"slack-overwrite-email-logout",label:(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.overWriteEmailLogout",defaultMessage:"Disconnect your account"}),caption:(0,L.jsx)(L.Fragment,{}),icon:(0,L.jsx)(h().I,{icon:j().trashIcon,size:"sm"}),disabled:!1,connected:!1,hidden:!!se||!X.includes("slack-user-mapping"),action:async()=>{if(!H)return;null==e||e.close();const{accept:n}=await g().Gh({message:(0,L.jsxs)(m().wt,{gap:8,children:[(0,L.jsx)("div",{style:{fontWeight:P().Wy.semibold,fontSize:18},children:(0,L.jsx)(M().sA,{id:"universalQna.slackChannelSelection.disconnectOverwriteHeader",defaultMessage:"Are you sure?"})}),(0,L.jsx)("div",{style:{fontWeight:P().Wy.regular},children:(0,L.jsx)(M().sA,{id:"universalQna.slackChannelSelection.disconnectOverwriteNote1",defaultMessage:"Your Slack data will be permanently deleted from Notion."})}),(0,L.jsx)("div",{style:{fontWeight:P().Wy.regular},children:(0,L.jsx)(M().sA,{id:"universalQna.slackChannelSelection.disconnectOverwriteNote2",defaultMessage:"This process can take up to 3 hours, and youll only be able to reconnect after disconnecting is complete."})})]}),acceptLabel:(0,L.jsx)(M().sA,{id:"universalQna.slackChannelSelection.disconnectButtonLabel",defaultMessage:"Disconnect Slack"})});n&&((0,i().u)({environment:s,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"slack_user_mapping_disconnect",integration_type:"slack",setup_session_id:G,from:t||te}}}),await D().callApi({eventName:"disconnectSlackIngestion",environment:s,data:{spaceId:H,disconnectUserMapping:!0}}))}}],pe=[de,...U({environment:s,slackUniversalQnAConnectionStoreState:Y,styles:V,isGridEnabledSpace:se,spaceId:H,parent:e})],ge=re&&q?{key:"select-channels",action:()=>{H&&(N().Rh.setState({...N().Rh.state,currentScreen:"settings"}),null==e||e.close())},render:e=>(0,L.jsx)(b().A,{...e,title:(0,L.jsxs)(m().Ye,{gap:4,alignItems:"center",children:[(0,L.jsx)(h().I,{icon:w().gearIcon}),(0,L.jsx)("div",{style:V.option,children:(0,L.jsx)("div",{style:V.optionLabel,children:(0,L.jsx)(M().sA,{...O.selectChannels})})})]})})}:void 0,me=[{key:"enterprise-search-section",render:e=>(0,L.jsx)(I().A,{...e,title:re?(0,L.jsx)(M().sA,{...O.enterpriseSearchSection}):void 0}),items:[...ge?[ge]:[],...(ne?pe:ue).filter((e=>!e.hidden)).map((({key:t,label:n,caption:a,icon:i,disabled:s,connected:o,action:r})=>({key:t,action:async()=>{await r(),null==e||e.close()},render:e=>(0,L.jsx)(b().A,{...e,title:(0,L.jsxs)(m().Ye,{gap:4,children:[(0,L.jsx)("div",{style:V.iconWrapper,children:i}),(0,L.jsxs)("div",{style:V.option,children:[(0,L.jsx)("div",{style:s?V.disabledOptionLabel:V.optionLabel,children:n}),(0,L.jsx)("div",{style:V.caption,children:a})]})]}),isChecked:o,disabled:s})})))]}];return re&&q?(me.push({key:"custom-agents-section",render:e=>(0,L.jsx)(I().A,{...e,topBorder:!0,title:(0,L.jsx)(M().sA,{...oe?O.customAgentsSectionViewAndPost:O.customAgentsSectionViewOnly,values:{b:e=>(0,L.jsx)("b",{children:e}),space:(0,L.jsx)("span",{children:""})}})}),items:[{key:"configure-access",action:()=>{null==e||e.close(),N().Rh.setState({...N().Rh.state,currentScreen:"write-access-config"})},render:e=>(0,L.jsx)(b().A,{...e,title:(0,L.jsxs)(m().Ye,{gap:4,alignItems:"center",children:[(0,L.jsx)(h().I,{icon:w().gearIcon}),(0,L.jsx)("div",{style:V.option,children:(0,L.jsx)("div",{style:V.optionLabel,children:(0,L.jsx)(M().sA,{...O.configureAccess})})})]})})}]}),me.push({key:"disconnect-section",render:e=>(0,L.jsx)(I().A,{...e,topBorder:!0}),items:[{key:"disconnect",action:()=>{H&&(N().Rh.setState({...N().Rh.state,currentScreen:"settings-disconnect"}),null==e||e.close())},render:e=>(0,L.jsx)(b().A,{...e,title:(0,L.jsxs)(m().Ye,{gap:4,alignItems:"center",children:[(0,L.jsx)(h().I,{icon:j().trashIcon,style:V.disconnectIcon}),(0,L.jsx)("div",{style:V.option,children:(0,L.jsx)("div",{style:V.disconnectLabel,children:(0,L.jsx)(M().sA,{...O.disconnectSlack})})})]})})}]})):v||!X.includes("slack-admin")||!q||K||ee||me.push({key:"slack-settings-section",render:e=>(0,L.jsx)(I().A,{...e,topBorder:!0}),items:[{key:"slack-settings",action:()=>{H&&(N().Rh.setState({...N().Rh.state,currentScreen:"settings"}),null==e||e.close())},render:e=>(0,L.jsx)(b().A,{...e,title:(0,L.jsxs)(m().Ye,{gap:4,alignItems:"center",children:[(0,L.jsx)(h().I,{icon:w().gearIcon}),(0,L.jsx)("div",{style:V.option,children:(0,L.jsx)("div",{style:V.optionLabel,children:(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.settings",defaultMessage:"Settings"})})})]})})}]}),(0,L.jsx)(S().A,{menuType:y().gu.Popup,children:Q?(0,L.jsx)(m().Ye,{style:{padding:8,justifyContent:"center"},children:(0,L.jsx)(f().k,{})}):(0,L.jsx)(x().A,{type:x().O.Vertical,sections:me,initialFocus:void 0})})}function z(e,t,n,a,i){return n||t||!e.includes("slack-admin")?(0,L.jsx)("div",{style:null==i?void 0:i.privateConnectedLabel,children:(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.adminAuth",defaultMessage:"Public conversations"})}):a?(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.noWorkspacesSelected",defaultMessage:"No workspaces selected"}):(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.noChannelsSelected",defaultMessage:"No channels selected"})}function W(e,t,n,a,i){return e?a?(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.disconnectingPublicSlack",defaultMessage:"Disconnecting. This can take up to 3 hours."}):n?(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.connectingPublicSlack",defaultMessage:"Connecting. This can take up to 36 hours."}):t.includes("slack-admin")?i?(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.connectedByWorkspaceOwner",defaultMessage:"Connected by workspace owner"}):(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.selectChannels",defaultMessage:"Your workspace owner hasnt completed the setup."}):(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.connectSlackToEnhanceResults",defaultMessage:"Connect to enhance your AI results"}):t.includes("slack-admin")?i?(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.connectedByWorkspaceOwner",defaultMessage:"Connected by workspace owner"}):n?(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.connectingPublicSlack",defaultMessage:"Connecting. This can take up to 36 hours."}):(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.selectChannels",defaultMessage:"Your workspace owner hasnt completed the setup."}):(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackIngestion.contactAdmin",defaultMessage:"Contact your workspace owner to connect"})}function U(e){const{environment:t,slackUniversalQnAConnectionStoreState:n,styles:a,isGridEnabledSpace:s,spaceId:o,parent:r}=e,l=n.isSyncCompleted,c=n.sessionId,d=n.analyticsFrom,u=n.connectedApps??[],p=(null==u?void 0:u.includes("slack"))??!1;return[{key:"slack-ingestion-status-connecting",label:(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackAIIngestion.connecting",defaultMessage:"Connecting"}),caption:(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackAIIngestion.subtext",defaultMessage:"Your workspace owner is connecting Slack. This can take up to 36 hours"}),icon:(0,L.jsx)(h().I,{icon:k().a,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"}),disabled:!0,connected:!1,hidden:!0,action:()=>{}},{key:"slack-ingestion-user-auth",label:p?(0,L.jsx)("div",{style:a.privateConnectedLabel,children:(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackAIIngestion.personalSlack",defaultMessage:"Private conversations"})}):(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackAIIngestion.userAuth",defaultMessage:"Login for Private conversations"}),caption:p?(0,L.jsx)(H,{parent:r}):(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackAIIngestion.userCaption",defaultMessage:"Login to get access to DMs and private channels"}),icon:(0,L.jsx)(h().I,{icon:A().personCircleFillIcon}),disabled:!!p,connected:p,hidden:!!s||!l,action:async()=>{o&&(p||(await F().JR({environment:t,spaceId:o}),(0,i().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"connect_private_slack",integration_type:"slack",setup_session_id:c,from:d}}})))}}]}function H({parent:e}){const t=(0,p().IS)((()=>({disconnectedLabel:{color:_().Tj.text.primary,border:`1px solid ${_().Tj.border.primary}`,marginTop:4,width:"80%"}})),[]),n=(0,s().r)(),o=(0,c().v3)(),r=(0,u().K8)((()=>N().Rh.state.sessionId),[]),l=(0,u().K8)((()=>N().Rh.state.analyticsFrom),[]),[d,g]=(0,a.useState)(!1);return(0,L.jsxs)(m().wt,{children:[(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.slackAIIngestion.connectedByYou",defaultMessage:"Connected by you. Click below to disconnect"}),(0,L.jsx)(v().A,{style:t.disconnectedLabel,isLoading:d,onClick:async()=>{if(!n)return;g(!0);const t=await F().lx({environment:o,spaceId:n});g(!1),t&&(null==e||e.close()),(0,i().u)({environment:o,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"disconnect_private_slack",integration_type:"slack",setup_session_id:r,from:l}}})},children:(0,L.jsx)(M().sA,{id:"assistantOverflowMenu.ingestion.logged_in.disconnect",defaultMessage:"Disconnect"})})]})}},934215:(e,t,n)=>{n.d(t,{P:()=>i});var a=()=>n(662453);function i(e){return t=>{a().aiDependency.load().then((({aiAnalyticsActions:n})=>{n.trackAIAssistantEngineError(e,{errorType:t.type})}))}}},938108:(e,t,n)=>{n.d(t,{o7:()=>d,tD:()=>l});var a=()=>n(534177);const i=10,s=30,o=5,r=i+o;function l(e){const{step:t}=e;if("upload"===t){const t=c(i);return Math.round(e.progressPercentDecimal*t)}if("pre-security-scan"===t)return c(s);if("pdf-processing"===t){const t=c(s),n=c(r),a=t-n;return n+Math.round(e.progressPercentDecimal*a)}(0,a().HB)(t)}function c(e,t=o){const n=Math.max(0,e-t),a=Math.random()*t;return Math.round(n+a)}async function d(e){const{initialProgress:t,progressCallback:n,operation:a,estimatedDurationMs:i=3e3,maxProgress:s=90,initialDelayMs:o=100,updateFrequencyMs:r=150}=e,l=s-t,c=Math.floor(i/r),d=c>0?l/c:1;let u;const p=setTimeout((()=>{let e=t;n(e),u=setInterval((()=>{e>=s?u&&clearInterval(u):(e=Math.min(e+d,s),n(Math.round(e)))}),r)}),o);try{const e=await a;return clearTimeout(p),u&&clearInterval(u),e}catch(g){throw clearTimeout(p),u&&clearInterval(u),g}}},939584:(e,t,n)=>{n.d(t,{p:()=>f});n(296540);var a=()=>n(590526),i=()=>n(401497),s=()=>n(79926),o=()=>n(680474),r=()=>n(26697),l=()=>n(534177),c=()=>n(631611),d=()=>n(514624),u=()=>n(383070),p=()=>n(483730),g=()=>n(103975),m=n(474848);const h="small";function f(e){const{isMultiline:t,showEnterTransition:n,onClick:f,onMouseDown:y,tooltipOnHover:v}=e,S=(0,c().jw)(),b=(0,a().K8)((()=>p().default.getActiveSession()),[]),x=(0,d().T)(b),I=(0,a().K8)((()=>Boolean(null==b?void 0:b.getHasCommittedHumanStep())),[b]),k=(0,a().K8)((()=>{const{selectedSkillFromStoreState:e,selectedSuggestionGroupFromStoreState:t}=b??{};return!(x||I||e||t)}),[b,x,I]),w=(0,a().K8)((()=>{if(u().zD.isXMLAssistantEnabled())return S.isWriter?!t:!k}),[S,t,k]),{value:C}=(0,s().fJ)(o().fM),A=function(e){const{isClickable:t}=e;return(0,i().IS)((()=>({container:{paddingTop:4,paddingBottom:4,flexShrink:0,marginInlineStart:-2,marginInlineEnd:0,width:void 0,height:void 0,borderRadius:void 0,cursor:t?"pointer":"default",display:"grid",placeItems:"center"}})),[t])}({isMultiline:t,isClickable:Boolean(f)});if(!C)return null;const{motion:T}=C;return w?(0,m.jsx)(r().m,{placement:"left",disableTooltip:!(0,l().O9)(v),renderTooltip:()=>v,delayThreshold:0,render:e=>(0,m.jsx)(T.div,{style:A.container,initial:!!n&&{opacity:0,scale:.4,maxWidth:0},animate:{opacity:1,scale:1,maxWidth:36},transition:{scale:{type:"spring",stiffness:700,damping:30,mass:1},opacity:{duration:.4,ease:"linear"},maxWidth:{type:"spring",stiffness:740,damping:30,mass:1},delay:0},onClick:f,onMouseDown:y,...e,children:(0,m.jsx)(g().M,{variant:h,includeBoxShadow:!0})})}):null}},945710:(e,t,n)=>{n.r(t),n.d(t,{clientSkillHasFillableParameters:()=>y,clientSkillHasFreeformFillableParameter:()=>v,clientSkillHasParameters:()=>f,clientSkillIsType:()=>h,clientSkillWithParameterValuesIsFillable:()=>b,clientSkillWithParameterValuesIsType:()=>S,createClientGlobalSkill:()=>k,createClientParameterValuesSkill:()=>I,dangerouslyCreateClientSkillWithParameterValues:()=>x,getAllClientSkills:()=>j,getSearchScopeForSkill:()=>O,getSkillSectionColor:()=>P,globalChatSections:()=>L,isAssistantSurfaceActionWithClientSkill:()=>w,pageChatSections:()=>N,removeGlobalActionsWithParameterizedEquivalents:()=>V,skillSectionMessages:()=>M,skillSectionTypeGivenSkillCategory:()=>_});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(430670),n(581454),n(737550);var a=()=>n(907258),i=()=>n(732810),s=()=>n(404931),o=()=>n(847832),r=()=>n(105819),l=()=>n(751735),c=()=>n(100622),d=()=>n(496603),u=()=>n(183558),p=()=>n(534177),g=()=>n(486674),m=()=>n(520937);function h(e,t){return e.skillType===t}function f(e){return(0,o().SH)(e.skillType)?(e.skillType,!0):(e.skillType,!1)}function y(e){return!!(0,o().Gt)(e.skillType)&&(e.skillType,!0)}function v(e){return!!(0,o().M4)(e.skillType)&&(e.skillType,!0)}function S(e,t){return e.clientSkill.skillType===t}function b(e){return!!(0,p().Xk)(o().in,e.clientSkill.skillType)&&(e.clientSkill.skillType,!0)}function x(e){return{parameterValues:{},clientSkill:e}}function I(e,t){return{key:`${e}_${(0,u().Ay)()}`,type:"with_parameter_values",skillType:e,parameterValues:t,...m().iS[e]}}function k(e){return{key:e,type:"global",skillType:e,...m().iS[e]}}function w(e){return"clientSkill"===e.actionType}const C="c",A="d";const T={translate:[],translate_page:[],change_tone:[],summarize:[C],chat_key_points:[C],database_filing:[A],query_database:[A],new_page_from_template:[C],summarize_transcript:[]};function j(e){const{currentPageRecordPointer:t,currentCollectionRecordPointer:n,config:a,clientSkillOverrides:i}=e,r={...T,...a},l=s().$u.map((e=>({...k(e),...null==i?void 0:i[e]}))),c=d().oE(o().in.flatMap((e=>function(e,t){return e[t]}(r,e).map((a=>{let s=a;if(s===C){if(!t||n)return;s=t}else if(s===A){if(!n)return;s=n}return{...I(e,(0,o().b6)(e,s)),...null==i?void 0:i[e]}})))));return[...l,...c]}const M=(0,n(69708).YK)({suggestedSection:{defaultMessage:"Suggested",id:"skills.suggestedSection"},searchSection:{defaultMessage:"Find anything you can access",id:"skills.searchSection"},pageSection:{defaultMessage:"Write",id:"skills.pageSection"},writeSection:{defaultMessage:"Draft",id:"skills.writeSection"},writeSectionForGlobalChat:{defaultMessage:"Create and edit pages, tasks",id:"skills.writeSectionForGlobalChat"},editPageSection:{defaultMessage:"Write",id:"skills.editPageSection"},editSelectionSection:{defaultMessage:"Edit",id:"skills.editSelectionSection"},chatSection:{defaultMessage:"Think",id:"skills.chatSection"},createAndWriteIntroAssistantMessage:{defaultMessage:"I can help you create and edit anything, from notes to drafts to pages.",id:"skills.writeSectionIntroMessage"},chatIntroAssistantMessage:{defaultMessage:"What would you like to chat about?",id:"skills.chatSectionIntroMessage"},searchIntroAssistantMessage:{defaultMessage:"Ask me about anything in the workspace. Ill try to find an answer in the pages you have access to.",id:"skills.searchSectionIntroMessage"}});function _(e){switch(e){case"findSearch":return"search";case"create":return"create";case"thinkAskChat":case"custom":case"notionActions":case"recent":case"favorite":return"chat";case"writeInsert":return"page";case"edit":return"selection";default:(0,p().HB)(e)}}function P(e,t){let n;return"search"===e?n=c().Tj.palette.blue:"create"===e||"page"===e||"selection"===e?n=c().Tj.palette.purple:"chat"===e?n=c().Tj.palette.green:(0,p().HB)(e),{color:n[500],background:"dark"===t?(0,l().X4)(n[900],.1):(0,l().X4)(n[100],.4),hoveredBackground:"dark"===t?(0,l().X4)(n[900],.2):(0,l().X4)(n[100],.55),pressedBackground:n[100]}}function D(e){const t=new Set;return e.map((e=>{const n=e.skills.filter((e=>!t.has(e)));for(const a of e.skills)t.add(a);return{...e,skills:n}})).filter((e=>e.skills.length>0))}const E={key:"create",icon:r().pencilLineIcon,title:M.writeSectionForGlobalChat,introAssistantMessage:M.createAndWriteIntroAssistantMessage,skills:["draft_outline","draft_template","draft_table","draft_diagram","draft_poem","draft_email"]},R={key:"page",icon:r().pencilLineIcon,title:M.editPageSection,introAssistantMessage:M.createAndWriteIntroAssistantMessage,skills:["add_summary","add_key_points","add_action_items","translate","continue_writing"]},B={key:"chat",icon:n(49621).h,title:M.chatSection,introAssistantMessage:M.chatIntroAssistantMessage,skills:["search_qna","brainstorm_ideas","write_code"]},F={key:"search",icon:n(207207).magnifyingGlassIcon,title:M.searchSection,introAssistantMessage:M.searchIntroAssistantMessage,skills:["search_qna"]},N=D([F,R,B]),L=D([F,E,B]);function O(e){const{skill:t}=e,{skillType:n}=t.clientSkill;if("page_qna"===n){const e=(0,g().a)();if(!e)return;return{type:"page",pageId:e.id}}if("search_qna"===n||"explain_this"===n)return{type:"everything"};if("query_database"===n){var s,o;const{parameterValues:e}=t,n=null===(s=e.collection)||void 0===s?void 0:s.id,r=a().default.state.sidebarSpaceViewStore;if(!n||!r)return;const l=null===(o=i().m.createChildStore(r,{table:"collection",id:n}).getParentPointer())||void 0===o?void 0:o.id;if(!l)return;return{type:"collection",pageId:l,collectionId:n}}return"search_workspace"===n?{type:"notion"}:"search_ai_knowledge"===n?{type:"ai-knowledge"}:void 0}function V(e){const{actions:t}=e,n=[];for(const a of t)"arbitrary"===a.actionType?n.push(a):"clientSkill"===a.actionType?"global"===a.type?t.some((e=>e.actionType===a.actionType&&e.skillType===a.skillType&&"with_parameter_values"===e.type))||n.push(a):"with_parameter_values"===a.type?n.push(a):(0,p().HB)(a):"assistant_session_starter"===a.actionType||(0,p().HB)(a);return n}},946560:(e,t,n)=>{n.d(t,{g$:()=>K,ho:()=>O,wp:()=>L});var a=n(296540),i=()=>n(726637),s=()=>n(484714),o=()=>n(590526),r=()=>n(401497),l=()=>n(295633),c=()=>n(732810),d=()=>n(807449),u=()=>n(847832),p=()=>n(40457),g=()=>n(105819),m=()=>n(644161),h=()=>n(179034),f=()=>n(201980),y=()=>n(69708),v=()=>n(100622),S=()=>n(534177),b=()=>n(284371),x=()=>n(471415),I=()=>n(575143),k=()=>n(631611),w=()=>n(712030),C=()=>n(486674),A=()=>n(29554),T=()=>n(996477),j=()=>n(945710),M=()=>n(321701),_=(n(944114),n(581454),()=>n(902006)),P=()=>n(604018),D=()=>n(371960),E=n(474848);function R(){const e=(0,o().K8)((()=>(0,P().kB)()),[]),t=(0,o().K8)((()=>{const t=[...e,"notion","ai_knowledge"],n=[];for(const e of t)"jira"!==e&&n.push(e);return n}),[e]),n=[...t.slice(0,2).reverse()],a=t.length-2,i=(0,r().IS)((()=>({container:{display:"flex",alignItems:"center",flexDirection:"row-reverse"},remainderText:{marginInlineStart:4,fontSize:12,color:v().Tj.text.tertiary}})),[]);return(0,E.jsxs)("div",{style:i.container,children:[a>0?(0,E.jsx)("div",{style:i.remainderText,children:`${a}+`}):null,n.map((e=>(0,E.jsx)(B,{source:e},e)))]})}function B(e){const{source:t}=e,n=(0,a.useMemo)((()=>"notion"===t?{type:"workspace"}:"ai_knowledge"===t?{type:"ai-knowledge"}:(0,_().SC)(t)?{type:t}:(0,S().HB)(t)),[t]),i=(0,r().IS)((()=>({bubble:{boxShadow:v().Tj.shadow2XS,borderRadius:"100%",width:20,height:20,marginInlineEnd:void 0,backgroundColor:v().Tj.white,marginInlineStart:-2}})),[]);return(0,E.jsx)(D().Ay,{item:n,iconWrapStyles:i.bubble,iconSize:14})}const F=(0,y().YK)({thisPage:{id:"assistant.preFilledSkills.thisPage",defaultMessage:"this page"},thisDatabase:{id:"assistant.preFilledSkills.thisDatabase",defaultMessage:"this database"},untitledDatabase:{id:"assistant.preFilledSkills.untitledDatabase",defaultMessage:"Untitled database"},parameterValuesSkillTitle:{id:"assistant.skillMenuItem.parameterValues",defaultMessage:"{skillName} {parameterValue}"},backwardsCompatibleChinese:{id:"id.completions.translateChinese",defaultMessage:"Chinese"},languageUnknown:{id:"id.completions.languageUnknown",defaultMessage:"Unknown language"},toneUnknown:{id:"id.completions.toneUnknown",defaultMessage:"Unknown tone"}});function N(e){const{fillableParameter:t,sidebarSpaceStore:n,currentPageStore:a}=e;if("block"===t.type||"blockOrText"===t.type||"collection"===t.type){var i;if(Array.isArray(t.value))return t.value;if(t.value.table===h().ev){const e=l().B.createChildStore(n,t.value);return(null==a?void 0:a.id)===e.id?F.thisPage:e.getTitleValue()}const e=c().m.createChildStore(n,t.value),s=e.getName();return(null==a||null===(i=a.DANGEROUSLY_INCORRECT_getCollectionStore())||void 0===i?void 0:i.id)===e.id?F.thisDatabase:void 0===s?F.untitledDatabase:s}var s;if("tone"===t.type)return(null===(s=(0,u().H8)(t.value))||void 0===s?void 0:s.name)??F.toneUnknown;if("language"===t.type){var o;return(0,u().f3)(t.value)?(null===(o=(0,u().f3)(t.value))||void 0===o?void 0:o.name)??F.languageUnknown:"chinese"===t.value?F.backwardsCompatibleChinese:F.languageUnknown}return"fullPageTranslationLanguage"===t.type?(0,m().Bj)(t.value)??F.languageUnknown:"textValue"===t.type?t.value??[]:void(0,S().HB)(t)}function L(e){const{sidebarSpaceStore:t,environment:n,theme:a,intl:i,clientSkill:s}=e;if(!t)return null;if("global"===s.type||!(0,j().clientSkillHasFillableParameters)(s))return null;const o=(0,u().Yx)(s);if("tone"===o.type||"language"===o.type||"fullPageTranslationLanguage"===o.type)return null;if("block"===o.type||"blockOrText"===o.type||"collection"===o.type){const e=N({fillableParameter:o,sidebarSpaceStore:t,currentPageStore:(0,C().a)()});return Array.isArray(e)?(0,A().S5)({environment:n,textValue:{value:e,spaceId:t.id},parentStore:t,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!0,disabled:!0,theme:a,emojiType:(0,w().FN)(n),katex:n.KatexStore.getKatex(),formulaValueTypes:[]}):i.formatMessage(e)}if("textValue"===o.type)return o.value??[];(0,S().HB)(o)}function O(e){const{sidebarSpaceStore:t,environment:n,theme:a,intl:i,clientSkill:s,shouldHidePrePopulatedParameter:o,isSuggestion:r}=e;if(!t)return null;if("global"===s.type||!(0,j().clientSkillHasFillableParameters)(s)||o)return r&&s.suggestedDisplayName?i.formatMessage(s.suggestedDisplayName,{light:e=>(0,E.jsx)("span",{style:{color:v().Tj.text.secondary,fontWeight:b().Wy.medium},children:e})}):i.formatMessage(s.displayName);const l=N({fillableParameter:(0,u().Yx)(s),sidebarSpaceStore:t,currentPageStore:(0,C().a)()}),c=Array.isArray(l)?(0,A().S5)({environment:n,textValue:{value:l,spaceId:t.id},parentStore:t,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!0,disabled:!0,theme:a,emojiType:(0,w().FN)(n),katex:n.KatexStore.getKatex(),formulaValueTypes:[]}):i.formatMessage(l);return(0,E.jsx)(y().sA,{...F.parameterValuesSkillTitle,values:{skillName:i.formatMessage(s.displayName),parameterValue:(0,E.jsx)("span",{style:{display:"inline",color:a.text.secondary,fontWeight:b().Wy.medium,overflow:"auto",textOverflow:"ellipsis"},children:c})}})}function V(e){const{sidebarSpaceStore:t,clientSkill:n,isSuggestion:a}=e,i=(0,s().v3)(),l=(0,r().DP)(),c=(0,y().tz)(),d=(0,k().jw)().canUseUpdatedSkillDisplayFormat&&!a;return(0,o().K8)((()=>O({sidebarSpaceStore:t,clientSkill:n,environment:i,intl:c,theme:l,shouldHidePrePopulatedParameter:d,isSuggestion:a})),[n,t,i,c,l,d,a])}function z(e){const{assistantSurfaceAction:t,disableKeyboard:n,menuListItemRef:a,...s}=e,o=(0,r().eP)(),l=(0,r().IS)((()=>({actionItemButtonStyle:{marginBottom:"1px",marginTop:"1px",borderRadius:"100px",display:"flex",margin:0,justifyContent:"space-between",height:i().A.isMobile?36:32},actionItemDesktopIconStyle:{marginInlineStart:0},actionItemStyle:{minHeight:"unset",padding:"8px 12px",fontWeight:500,fontSize:i().A.isMobile?15:13},actionItemRightStyles:{marginInlineEnd:8}})),[]),c=(0,M()._)(t.category),d=function(e){const{assistantSurfaceAction:t,themeMode:n}=e;if("assistant_session_starter"===t.actionType){if("human_step_only"===t.data.type)return()=>U({themeMode:n});if("skill_only"===t.data.type||"skill_with_human_step"===t.data.type){return(0,j().createClientParameterValuesSkill)(t.data.skill.skillType,t.data.skill.parameterValues).icon}(0,S().HB)(t.data)}return t.icon}({assistantSurfaceAction:t,themeMode:o});return(0,E.jsx)(I().A,{ref:a,...s,svgCustomFill:()=>c.color(o).color,svg:d,buttonStyle:l.actionItemButtonStyle,desktopIconStyle:l.actionItemDesktopIconStyle,style:l.actionItemStyle,right:!e.focused||i().A.isMobile||n?void 0:(0,E.jsx)(W,{assistantSurfaceAction:t}),rightStyle:l.actionItemRightStyles})}function W(e){const{assistantSurfaceAction:t}=e;return(0,k().jw)().canUseUpdatedSkillDisplayFormat&&"clientSkill"===t.actionType&&"search_qna"===t.skillType?(0,E.jsx)(R,{}):(0,E.jsx)(d().I,{icon:p().arrowTurnDownLeftSmallIcon,size:"sm",colorVariant:"tertiary"})}function U(e){const{themeMode:t}=e,n=(0,M()._)("recent");return(0,E.jsx)(x().O1,{svg:g().pencilLineIcon,svgFill:n.color(t).color})}function H(e){const{clientSkill:t,isSuggestion:n}=e,a=(0,s().v3)(),i=V({sidebarSpaceStore:(0,o().K8)((()=>(0,T().fM)(a)),[a]),clientSkill:t,isSuggestion:n??!1});return i?(0,E.jsx)(z,{...e,title:i}):null}function K(e){const{assistantSurfaceAction:t}=e,n=(0,y().tz)(),a=(0,r().IS)((()=>({subtitle:{color:v().Tj.text.secondary}})),[]);if("clientSkill"===t.actionType){const n=t;return(0,E.jsx)(H,{...e,clientSkill:n})}if("arbitrary"===t.actionType){const i=(0,E.jsxs)(E.Fragment,{children:[n.formatMessage(t.title,t.title.values),t.subtitle?(0,E.jsxs)("span",{style:a.subtitle,children:["",t.subtitle]}):void 0]});return(0,E.jsx)(z,{...e,title:i})}if("assistant_session_starter"===t.actionType){if("human_step_only"===t.data.type)return(0,E.jsx)(z,{...e,title:(0,f().q4_)(t.data.initialHumanStep)});if("skill_only"===t.data.type){const{skillType:n,parameterValues:a}=t.data.skill,i=(0,j().createClientParameterValuesSkill)(n,a);return(0,E.jsx)(H,{...e,clientSkill:i})}if("skill_with_human_step"===t.data.type)return(0,E.jsx)(q,{...e,data:t.data});(0,S().HB)(t.data)}else(0,S().HB)(t)}function q(e){const{data:t,isSuggestion:n}=e,a=(0,s().v3)(),i=V({sidebarSpaceStore:(0,o().K8)((()=>(0,T().fM)(a)),[a]),clientSkill:(0,j().createClientParameterValuesSkill)(t.skill.skillType,t.skill.parameterValues),isSuggestion:n??!1}),r=(0,f().q4_)(t.initialHumanStep);return i?(0,E.jsxs)(E.Fragment,{children:[i,r]}):(0,E.jsx)(E.Fragment,{children:r})}U.displayName="RecentActionIcon"},948411:(e,t,n)=>{n.d(t,{Z:()=>c});n(944114),n(898992),n(354520),n(581454);var a=()=>n(510818),i=()=>n(496603),s=()=>n(383070),o=()=>n(483730),r=()=>n(587685);var l=()=>n(192962);async function c(e){const{environment:t,pageIds:n,sessionId:c,xmlEvaluatorState:d,updater:u}=e,p=o().default.getSessionContextOrThrow(c),g=i().sb(i().R9(n,p.evaluatorFromStoreState.state.getLoadedPageIds()));if(0===g.length)return;const m=g.map((e=>function(e){const{idMapper:t}=e;return`<load id="${t.mapKeyToCounter({type:"block",key:e.mappedPageId})}"/>`}({mappedPageId:e,assistantSessionContext:p,idMapper:d.getIdMapper()}))).join("");await(0,l().M)({environment:t,sessionId:c,commands:m,updater:u});const h=p.evaluatorFromStoreState.getTranscript(),f=s().zD.isDatabaseScopedSearchEnabled()||s().zD.isDatabaseQueryingEnabled(),y=(0,a().dR)({pageIds:g,evaluator:p.evaluatorFromStoreState,loadInlineDatabases:f});if("collection"===p.assistantConfigurationStoreState.searchScope.type){const e=p.assistantConfigurationStoreState.searchScope.collectionId;y.includes(e)||y.push(e)}if(y.length>0){const e=y.map((e=>(0,r().P)({mappedDatabaseId:e,assistantSessionContext:p,idMapper:d.getIdMapper()}))).join("");await(0,l().M)({environment:t,sessionId:c,commands:e,updater:u})}f||p.evaluatorFromStoreState.setTranscript(h.filter((e=>"observation"!==e.type||"database"!==e.observationType))),u.write((()=>{p.commitPreviewingStep()}))}},949575:(e,t,n)=>{n.r(t),n.d(t,{EXTRA_LONG_SELECTION_MIN_LENGTH:()=>h,SHORT_SELECTION_MAX_LENGTH:()=>m,SUGGESTED_ASSISTANT_ACTIONS_LIMIT:()=>g,allowedClientSkillsForAssistantEntrypoint:()=>R,allowedClientSkillsForAssistantSurface:()=>E,arbitraryNotionSkillToAssistantSurfaceAction:()=>_,areArbitrarySkillsAllowedForAssistantEntrypoint:()=>F,areArbitrarySkillsAllowedForAssistantSurface:()=>B,areAssistantSessionStarterAllowedForAssistantEntrypoint:()=>L,areAssistantSessionStarterAllowedForAssistantSurface:()=>N,assistantSessionStarterModelToAssistantSurfaceAction:()=>P,assistantSurfaceActionValidators:()=>j,clientSkillToAssistantSurfaceAction:()=>M,filterAndRankAssistantSurfaceActionsForContext:()=>H,filterAssistantSurfaceActionsForContext:()=>O,getScoreForBooster:()=>V,getScoreForBoosters:()=>z,rankAssistantSurfaceActionsForContext:()=>U,rankItemsForContext:()=>W});n(898992),n(823215),n(354520),n(581454),n(908872),n(737550);var a=()=>n(907258),i=()=>n(77311),s=()=>n(449412),o=()=>n(319625),r=()=>n(496603),l=()=>n(534177),c=()=>n(631611),d=()=>n(989616),u=()=>n(712453),p=()=>n(383070);const g=5,m=40,h=250;function f(e){return"selectionState"in e&&"textSelectionState"in e}function y(e,t=!1){const{selectionState:n,textSelectionState:a}=e;return"editing"===a.mode?(0,u().O)(a):(0,d().R)(n.stores,t)}function v(e){return!(!b(e)||"automationButtonEditor"!==e.entrypoint)}function S(e){return"assistant"===e.type}function b(e){return"entrypoint"===e.type}function x(e){return"pageStore"in e&&void 0!==e.pageStore&&!e.pageStore.isType("personal_home_page")}function I(e){return!f(e)||(0===e.selectionState.stores.length||("empty"===e.textSelectionState.mode?0===e.selectionState.stores.length:"editing"===e.textSelectionState.mode||"readOnly"===e.textSelectionState.mode?(0,i().k)(e.textSelectionState.multiSelection):(0,l().HB)(e.textSelectionState)))}function k(e){return x(e)&&!A(e)}function w(e){return x(e)&&!I(e)}function C(e,t,n=!1){if(!f(e))return!1;return y(e,n).length>t}function A(e){if(!("pageStore"in e))return!1;const t=e.pageStore;if(!t)return!1;const n=t.getContentStores();return 0===n.length||n.every((e=>e.isEmptyTitle()&&!e.hasContent()))}function T(e){if(!("pageStore"in e))return!1;const t=e.pageStore;if(!t)return!1;return t.getContentStores().length>10}const j={isWriterEntrypoint:function(e){return!!S(e)&&c().wy[e.surface].isWriter},isFullPageEntrypoint:function(e){return S(e)&&"fullPage"===e.surface},isCornerEntrypoint:function(e){return S(e)&&"corner"===e.surface},isEditingAutomationButton:v,isAssistantSurface:S,entrypointSupportsParameterization:function(e){return S(e)?c().wy[e.surface].surfaceSupportsParameterization:b(e)?v(e):void(0,l().HB)(e)},isCommandSearch:function(e){return S(e)&&"commandSearch"===e.surface},isRichTextMenuEntrypoint:function(e){return b(e)&&"richTextMenu"===e.entrypoint},isPageStartEntrypoint:function(e){return b(e)&&"pageStart"===e.entrypoint},isPageEndEntrypoint:function(e){return b(e)&&"pageEnd"===e.entrypoint},isBlockPasteMenuEntrypoint:function(e){return b(e)&&"blockPasteMenu"===e.entrypoint},isPageAvailable:x,isPageEditable:function(e){return"pageStore"in e&&void 0!==e.pageStore&&e.pageStore.canEdit()&&e.pageStore.getFormat().app_config_uri!==n(433337).pO},isSelectionEmpty:I,isSelectionShort:function(e){return!(!f(e)||!w(e))&&y(e).length<=m},isSelectedBlockEmpty:function(e){if(f(e))for(const t of e.selectionState.stores)if(!t.isEmptyTitle()||t.hasContent())return!1;return!0},isSelectionLong:function(e){return C(e,m)},isSelectionExtraLong:function(e){return C(e,h-1,!0)},isSelectionMultiline:function(e){return!!f(e)&&y(e).trim().includes("\n")},isPageTitleEmpty:function(e){if(!("pageStore"in e))return!1;const t=e.pageStore;return!!t&&t.isEmptyTitle()},isPageEmpty:A,isPageFilled:k,isPageShort:function(e){return x(e)&&!T(e)},isPageLong:T,isPageShortOrEmpty:function(e){return x(e)&&(A(e)||!T(e))},isCollection:function(e){var t;return!(!x(e)||!("pageStore"in e))&&Boolean(null===(t=e.pageStore)||void 0===t?void 0:t.isCollectionView())},hasSelection:w,hasContentfulPageOrSelection:function(e){return k(e)||w(e)},selectionContainsBlockType:function(e){return function(t){return!!f(t)&&t.selectionState.stores.some((t=>t.isType(e)))}},selectionIsEntirelyOfBlockType:function(e){return t=>{if(!f(t))return!1;const n=t.selectionState.stores;return 0!==n.length&&n.every((t=>t.isType(e)))}},isStudent:function(e){var t;const{currentUserStore:i}=a().default.state,s=null==i?void 0:i.getEmail(),o=null==s?void 0:s.split("@")[1];return!(!o||".edu"!==o.substring(o.length-4)&&"edu."!==o.substring(0,4)&&!o.includes(".edu."))||"student"===(null===(t=(0,n(756790).p)())||void 0===t?void 0:t.function)},isBetweenDates:function(e,t){return()=>{const n=new Date,a=new Date(e),i=new Date(t);return n>=a&&n<=i}},isMultiplayerSpace:function(e){const{sidebarSpaceStore:t}=a().default.state;return!!t&&(t.getMemberCountFromPublicSpaceData()??1)>1},assistantModeIsAtMost:function(e){return()=>p().zD.modeIsAtMost(e)},isAssistantMode:function(e){return()=>p().zD.isMode(e)},canUseDatabaseSkills:function(e){return p().zD.isDatabaseQueryingEnabled()},shouldShowFullPageTranslateSkill:function(e){return p().zD.isFullPageTranslateEnabled()},isDeviceMobile:function(e){return!v(e)&&e.isMobile},isTutorialBoosted:function(e){var t;return!(!S(e)||"corner"!==e.surface&&"fullPage"!==e.surface)&&void 0===(null===(t=e.userSettings)||void 0===t?void 0:t.ai_assistant_tutorial_dismissed_at)},surfaceSupportsTutorialAction:function(e){return S(e)?c().wy[e.surface].surfaceSupportsTutorialAction:!b(e)&&(0,l().HB)(e)},isFeatureGateEnabled:function(e){return t=>n(242422).default.checkGate({gateName:e})},and:function(...e){return t=>e.every((e=>e(t)))},or:function(...e){return t=>e.some((e=>e(t)))},not:function(e){return t=>!e(t)},never:function(e){return!1},always:function(e){return!0}};function M(e){function t(e){return{actionType:"clientSkill",...e}}return Array.isArray(e)?e.map(t):t(e)}function _(e){return{actionType:"arbitrary",...e}}function P(e){const{assistantSessionStarter:t,validators:n=[],boosters:a=[]}=e,i=t.getType();return"favorite"===i?{actionType:"assistant_session_starter",validators:n,boosters:a,category:"favorite",...t.getDataWithValueMetadata()}:"recent"===i?{actionType:"assistant_session_starter",validators:n,boosters:a,category:"recent",...t.getDataWithValueMetadata()}:void(0,l().HB)(i)}const D={custom:!0,summarize:!0,chat_key_points:!0,search_qna:!0,brainstorm_ideas:!0,write_code:!0,page_qna:!0,fix_spelling_grammar:!0,add_summary:!0,add_key_points:!0,add_action_items:!0,chat_action_items:!0,draft_outline:!0,draft_template:!0,draft_table:!0,draft_diagram:!0,draft_poem:!0,draft_email:!0,draft_meeting_agenda:!0,continue_writing:!0,translate:!0,translate_page:!0,improve_writing:!0,make_shorter:!0,make_longer:!0,fill_title:!0,change_tone:!0,simplify_language:!0,explain_this:!0,database_filing:!0,new_page_from_template:!0,improve_formatting:!0,help_me_edit:!0,help_me_write:!0,help_me_draft:!0,query_database:!0,create_quiz:!0,search_workspace:!0,search_ai_knowledge:!0,new_years_resolution:!0,summarize_transcript:!1,alphabetize_list:!0,reformat:!0},E={fullPage:{...D,search_workspace:!1,search_ai_knowledge:!1},corner:{...D},mobileNative:{...D,search_workspace:!1,search_ai_knowledge:!1},mobileNativeTab:{...D,search_workspace:!1,search_ai_knowledge:!1},mobileWeb:{...D,search_workspace:!1,search_ai_knowledge:!1},mobileSearch:{...D,search_workspace:!1,search_ai_knowledge:!1},writer:{...D,search_workspace:!1,search_ai_knowledge:!1},mobileWriter:{...D,search_workspace:!1,search_ai_knowledge:!1},searchPane:{...D,search_workspace:!1,search_ai_knowledge:!1},commandSearch:{...D,search_workspace:!1,search_ai_knowledge:!1},workflowEditor:{...D,search_workspace:!1,search_ai_knowledge:!1},inferenceTranscriptChatView:{...D,search_workspace:!1,search_ai_knowledge:!1}},R={pageStart:{...D},pageEnd:{...D},richTextMenu:{...D},automationButtonEditor:{...D},blockPasteMenu:{custom:!1,summarize:!1,chat_key_points:!1,search_qna:!1,brainstorm_ideas:!1,write_code:!1,page_qna:!1,fix_spelling_grammar:!1,add_summary:!1,add_key_points:!1,add_action_items:!1,chat_action_items:!1,draft_outline:!1,draft_template:!1,draft_table:!1,draft_diagram:!1,draft_poem:!1,draft_email:!1,draft_meeting_agenda:!1,continue_writing:!1,translate:!1,translate_page:!1,improve_writing:!1,make_shorter:!1,make_longer:!1,fill_title:!1,change_tone:!1,simplify_language:!1,explain_this:!1,database_filing:!1,new_page_from_template:!1,improve_formatting:!1,help_me_edit:!1,help_me_write:!1,help_me_draft:!1,query_database:!1,create_quiz:!1,search_workspace:!1,search_ai_knowledge:!1,new_years_resolution:!1,summarize_transcript:!1,alphabetize_list:!1,reformat:!1,reformat:!0,make_shorter:!0,improve_writing:!0,fix_spelling_grammar:!0}},B={fullPage:!0,corner:!0,mobileNative:!0,mobileNativeTab:!0,mobileWeb:!0,mobileSearch:!0,writer:!0,mobileWriter:!0,searchPane:!0,commandSearch:!0,workflowEditor:!0,inferenceTranscriptChatView:!1},F={pageStart:!0,pageEnd:!0,richTextMenu:!0,automationButtonEditor:!0,blockPasteMenu:!1},N={fullPage:!0,corner:!0,mobileNative:!0,mobileNativeTab:!0,mobileWeb:!0,mobileSearch:!0,writer:!0,mobileWriter:!0,searchPane:!0,commandSearch:!0,workflowEditor:!0,inferenceTranscriptChatView:!1},L={pageStart:!0,pageEnd:!0,richTextMenu:!0,automationButtonEditor:!0,blockPasteMenu:!0};function O(e,t){return"assistant"===t.type?e.filter((e=>{try{return function(e,t){if("clientSkill"===e.actionType)return E[t][e.skillType];if("arbitrary"===e.actionType)return B[t];if("assistant_session_starter"===e.actionType){if(!N[t])return!1;if("human_step_only"===e.data.type)return!0;if("skill_only"===e.data.type||"skill_with_human_step"===e.data.type)return E[t][e.data.skill.skillType];(0,l().HB)(e.data)}else(0,l().HB)(e)}(e,t.surface)&&e.validators.every((e=>e(t)))}catch(n){const a=(0,o().A)(n);return s().Fg("Validator checks failed",{level:"error",extra:{error:a,action:e,surface:t.surface}}),!1}})):"entrypoint"===t.type?e.filter((e=>{try{return function(e,t){if("clientSkill"===e.actionType)return R[t][e.skillType];if("arbitrary"===e.actionType)return F[t];if("assistant_session_starter"===e.actionType){if(!L[t])return!1;if("human_step_only"===e.data.type)return!0;if("skill_only"===e.data.type||"skill_with_human_step"===e.data.type)return R[t][e.data.skill.skillType];(0,l().HB)(e.data)}else(0,l().HB)(e)}(e,t.entrypoint)&&e.validators.every((e=>e(t)))}catch(n){const a=(0,o().A)(n);return s().Fg("Validator checks failed",{level:"error",extra:{error:a,action:e,entrypoint:t.entrypoint}}),!1}})):void(0,l().HB)(t)}function V(e){const{booster:t,context:n}=e,[a,i]="function"==typeof t?[t,1]:t;return a(n)?i:0}function z(e){const{boosters:t,context:n}=e;return t.reduce(((e,t)=>e+V({booster:t,context:n})),0)}function W(e){const{items:t,getBoosters:n,context:a}=e;return(0,r().My)(t,(e=>z({boosters:n(e),context:a})),["desc"])}function U(e,t){return W({items:e,getBoosters:e=>e.boosters??[],context:t})}function H(e,t){return U(O(e,t),t)}},960674:(e,t,n)=>{n.d(t,{D:()=>i,U:()=>a});const a={CREATE_OR_UPDATE_DRAFT:"mail-create_or_update_draft",CREATE_OR_UPDATE_GMAIL_DRAFT:"mail-create_or_update_gmail_draft",SEND_NEW_EMAIL:"mail-send_new_email",SEND_EXISTING_DRAFT:"mail-send_existing_draft",SEARCH_EMAILS:"mail-search_emails",GET_MAILBOX:"mail-get_mailbox",LIST_MAILBOX_VIEWS:"mail-list_mailbox_views",LIST_STATUS_PROPERTIES:"mail-list_status_properties",VIEW_THREAD_CONTENT:"mail-view_thread_content",SET_READ_STATUS:"mail-set_read_status",ARCHIVE_THREAD:"mail-archive_thread",TRASH_THREAD:"mail-trash_thread",MOVE_THREAD_TO_INBOX:"mail-move_thread_to_inbox",MARK_THREAD_SPAM:"mail-mark_thread_spam",STAR_THREAD:"mail-star_thread",UPDATE_STATUS:"mail-update_status",CREATE_STATUS_COLUMN:"mail-create_status_column",SET_REMINDER:"mail-set_reminder",UNSET_REMINDER:"mail-unset_reminder",BLOCK_SENDER:"mail-block_sender",UNBLOCK_SENDER:"mail-unblock_sender",UNSUBSCRIBE_SENDER:"mail-unsubscribe_sender",APPLY_USER_LABELS:"mail-apply_user_labels_with_lazy_create",CREATE_LABEL:"mail-create_label",HEALTH_CHECK:"mail-health_check",LIST_GMAIL_FILTERS:"mail-list_gmail_filters",CREATE_GMAIL_FILTER:"mail-create_gmail_filter",DELETE_GMAIL_FILTER:"mail-delete_gmail_filter",UPDATE_GMAIL_FILTER:"mail-update_gmail_filter"};function i(e){return e===a.CREATE_OR_UPDATE_DRAFT||e===a.CREATE_OR_UPDATE_GMAIL_DRAFT||e===a.SEND_NEW_EMAIL}},962874:(e,t,n)=>{n.d(t,{P:()=>l});var a=()=>n(920198),i=()=>n(320550),s=()=>n(590526),o=()=>n(979340),r=()=>n(69708);function l(){const e=(0,a().L)(),t=(0,r().tz)();return{isEnabled:(0,s().K8)((()=>{if(!e)return!1;const t=e.getSubscriptionTier();return(0,o().OX)(t)}),[e]),tooltipMessage:t.formatMessage(i().O.enterprise_only_feature)}}},975366:(e,t,n)=>{n.d(t,{h:()=>k});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);var a=n(296540),i=()=>n(920198),s=()=>n(884780),o=()=>n(450104),r=()=>n(590526),l=()=>n(401497),c=()=>n(295633),d=()=>n(100622),u=()=>n(188158),p=()=>n(899483),g=()=>n(143016),m=()=>n(485601),h=()=>n(655581),f=()=>n(43893),y=()=>n(428257),v=()=>n(827368),S=()=>n(181251),b=()=>n(305425),x=()=>n(980319),I=n(474848);function k(e){const t=(0,i().L)();return t?(0,I.jsx)(s().K,{from:"NotionFlavoredMarkdownChatRenderer",fallback:({error:e,errorId:t})=>(0,I.jsx)(o().LargeSurfaceRenderError,{error:e,errorId:t}),children:(0,I.jsx)(w,{...e,spaceStore:t})}):null}function w(e){const{markdown:t,spaceStore:n,citationContext:i,aiChatFeatureController:s,turnSteps:o,stepId:k,threadStore:w}=e,{shouldUseSidePeek:A,handleLinkClick:T}=(0,S().H)({aiChatFeatureController:s}),j=(0,b().nM)({markdown:t,spaceStore:n,citationFormat:"citation",citationContext:i,turnSteps:o,stepId:k,threadStore:w}),M=(0,x().be)({citationContext:i}),_=(0,a.useRef)(null),P=(0,r().uB)(void 0,g().D);(0,u().c2)({containerRef:_,citationHoverStore:P,parentStore:n,evaluatorState:void 0});const{bodyStyleKey:D}=(0,v().yq)(),E=(0,v().Cd)(D),R=(0,r().K8)((()=>null==j?void 0:j.getContentStore()),[j]),B=(0,r().K8)((()=>y().l.getSource()),[]),F="edit-reference"===(null==B?void 0:B.type)?B.sourceId:void 0,N=(0,l().IS)((()=>({activeEditReferenceHighlight:{background:d().Tj.blue.background.secondaryTranslucent},icon:{background:d().Tj.blue.background.tertiaryTranslucent}})),[]),L=(0,a.useMemo)((()=>F?(0,I.jsx)("style",{children:`\n\t\t\t/* Highlight the active edit reference annotation */\n\t\t\t[data-active-edit-reference-id="${F}"] .notion-edit-reference-annotation[data-edit-reference-id="${F}"] {\n\t\t\t\tbackground: ${N.activeEditReferenceHighlight.background};\n\t\t\t\tbox-shadow: 0 0 0 4px ${N.activeEditReferenceHighlight.background};\n\t\t\t}\n\n\t\t\t[data-active-edit-reference-id="${F}"] .notion-edit-reference-annotation[data-edit-reference-id="${F}"] .edit-reference-group__icon {\n\t\t\t\tbackground: ${N.icon.background} !important;\n\t\t\t}\n\t\t`}):null),[F,N.activeEditReferenceHighlight,N.icon]),O=(null==s?void 0:s.supportsMinimalTranscript())??!1,V=(0,r().K8)((()=>{if(!O||!R)return new Set;const e=new Set,t=R.getValue()??[];for(const a of t){"edit_reference"===c().B.createChildStore(R,{table:"block",id:a,spaceId:n.id}).getType()&&e.add(a)}return e}),[O,R,n.id]),z=(0,a.useCallback)(((e,t,n)=>{if(V.has(e))return null}),[V]);return R?(0,I.jsxs)(I.Fragment,{children:[L,(0,I.jsx)("div",{"data-active-edit-reference-id":F||"",onClickCapture:A?T:void 0,children:(0,I.jsx)(m().c,{displayName:"AIChatTranscript.MarkdownChatStep",disabled:!0,ref:_,style:E,children:(0,I.jsx)(h().Y,{threadStore:w,turnSteps:o,children:(0,I.jsx)(f().A,{store:R,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!1,overrideCanDrag:!0,overrideHeaderFontSizes:C,renderItem:O?z:void 0,renderItemFallbackToDefault:O})})})}),(0,I.jsx)(p().cE,{containerRef:_,hoverStore:P,parentStore:R,getPayloadDataForHref:M,useCompactWebPreview:!0,isSearchChat:(null==s?void 0:s.chonkyStyles)??!0})]}):null}const C={header:1.375,subHeader:1.25,subSubHeader:1.125,header4:1.0625}},975445:(e,t,n)=>{n.d(t,{N:()=>r});var a=()=>n(484714),i=()=>n(590526),s=()=>n(944584),o=()=>n(965454);function r(e){const{threadStore:t,spaceId:n}=e,r=(0,a().v3)(),l=(0,o().AD)();return(0,i().K8)((()=>{if(!n)return{aiSessionId:"unknown",aiInferenceId:"unknown",aiDraftInferenceId:"unknown",model:void 0};const e=l.getOrCreateThreadId({environment:r,spaceId:n,maybeThreadStore:t});return s().getSessionAndInferenceIdsFromEnvironment({environment:r,maybeThreadId:e})}),[r,t,l,n])}},977270:(e,t,n)=>{n.r(t),n.d(t,{AIConnectorSidebarNotification:()=>yd,AssistantFeatureGateStore:()=>h().zD,AssistantFullPageChat:()=>Vc,AssistantOriginElement:()=>on,AssistantRegistryStore:()=>g(),AssistantScopedSearchMenuPopup:()=>To().CP,AssistantShareModal:()=>nd,AssistantUnfurlingMenuWithAiSection:()=>cd,FileBlockAskAIActionBar:()=>kd,MobileAssistantPendingOperationsCollapsedElement:()=>Wc,ReportBadQnAForm:()=>Gc,agentActions:()=>i(),assistantActions:()=>a(),assistantAnalyticsActions:()=>o(),assistantChatActions:()=>d(),assistantEditActions:()=>s(),assistantMenuActions:()=>r(),assistantMenuStore:()=>u().P,assistantOriginElementStore:()=>p().O,assistantSurfaceValidators:()=>c(),clientSkillHelpers:()=>l(),executeAssistantSkillAction:()=>m().Nj,getCurrentQnaReminderUserSettings:()=>ht().IA,handleSubmitNewQuestion:()=>d().handleSubmitNewQuestion});var a=()=>n(761777),i=()=>n(295173),s=()=>n(830010),o=()=>n(140022),r=()=>n(501305),l=()=>n(945710),c=()=>n(949575),d=()=>n(150984),u=()=>n(263542),p=()=>n(302607),g=()=>n(483730),m=()=>n(471415),h=()=>n(383070),f=(n(18107),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(967357),n(898992),n(354520),n(581454),n(908872),n(737550),()=>n(203066)),y=()=>n(153321),v=n(296540),S=()=>n(564884),b=()=>n(664594),x=()=>n(300474),I=()=>n(907258),k=()=>n(59226),w=()=>n(242422),C=()=>n(726637),A=()=>n(383036),T=()=>n(484714),j=()=>n(590526),M=()=>n(401497),_=()=>n(543906),P=()=>n(79926),D=()=>n(929219),E=()=>n(711339),R=()=>n(882722),B=()=>n(232615),F=()=>n(718827),N=()=>n(127833),L=()=>n(250910),O=()=>n(118307),V=()=>n(493552),z=()=>n(26697),W=()=>n(847832),U=()=>n(700500),H=()=>n(898244),K=()=>n(713998),q=()=>n(917629),$=()=>n(706021),G=()=>n(201980),Y=()=>n(381414),Q=()=>n(69708),J=()=>n(100622),X=()=>n(534177),Z=()=>n(284371),ee=()=>n(720665),te=()=>n(384944),ne=()=>n(680977),ae=()=>n(219348),ie=()=>n(761894),se=()=>n(755531),oe=()=>n(574359),re=()=>n(148297),le=()=>n(970236),ce=()=>n(406094),de=()=>n(148307),ue=()=>n(191197),pe=()=>n(72234),ge=()=>n(300789),me=()=>n(51367),he=()=>n(46986),fe=n(474848);const ye=(0,Q().YK)({primedTextInput:{id:"assistant.universalQna.googleDriveConnectedNotificationTooltip.tryItPrimedInput",defaultMessage:"Find a Google Drive Doc/Sheet/Slide about: "}});function ve(e){const{origin:t}=e,n=(0,T().v3)(),a=(0,Q().tz)(),s="dark"===(0,M().eP)(),o=(0,j().K8)((()=>{const e=(0,se().S)();if(e)return(0,oe().G)(n,e)}),[n]),r=(0,M().IS)((()=>({tooltip:{width:250},headerWrapper:{display:"flex",flexDirection:"row",alignItems:"start"},googleDriveIcon:{width:20},betaBadge:{borderRadius:4,background:J().Tj.palette.translucentGray[300],color:"#7F7F7F",display:"inline-block",fontSize:11,fontWeight:500,padding:"2px 5px",marginInlineStart:6},content:{padding:"4px 0px"},tryIt:{border:s?`1px solid ${J().Tj.palette.gray[500]}`:`1px solid ${J().Tj.palette.gray[700]}`,marginTop:6,color:J().Tj.text.inversePrimary},tryItHovered:{border:`1px solid ${J().Tj.palette.gray[600]}`,backgroundColor:s?J().Tj.palette.gray[400]:J().Tj.palette.gray[800]}})),[s]);(0,v.useEffect)((()=>{pe().LH(n),ue().i(n,{from:"google_drive_qna_ai_notification"}),me().DL(n,{callout_key:"ai_google_drive_qna_notification_tooltip",placement_key:"Tooltip"})}),[n]);const l=(0,he().i7)(),c=(0,v.useCallback)((e=>{const{tryIt:t}=e;if(ge().a(n,"ai_google_drive_qna_notification_tooltip"),t){const e=a.formatMessage(ye.primedTextInput);l&&(0,i().openNewAgentSidebarFromMainBlock)({environment:n,primeTextInput:e}),me().Y5(n,{callout_key:"ai_google_drive_qna_notification_tooltip",click_type:"primary_cta",placement_key:"Tooltip"})}else ue().z(n,{from:"google_drive_qna_ai_notification"}),me().Sq(n,{callout_key:"ai_google_drive_qna_notification_tooltip",dismiss_type:"tooltip_dismiss",placement_key:"Tooltip"})}),[n,a,l]);return(0,X().O9)(o)?(0,fe.jsx)(re().k,{style:r.tooltip,pointerLength:25,pointerPosition:"90%",origin:t,placementToOrigin:"top",header:(0,fe.jsxs)("div",{style:r.headerWrapper,children:[(0,fe.jsx)("img",{src:de().A.images.googleDriveLogoPng,style:r.googleDriveIcon}),(0,fe.jsx)(le().E,{style:r.betaBadge,content:(0,fe.jsx)(Q().sA,{id:"AiGoogleDriveQnaNotificationTooltip.betaLabel",defaultMessage:"Beta"})})]}),content:(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)("div",{style:r.content,children:(0,fe.jsx)(Q().sA,{id:"AiGoogleDriveQnaNotificationTooltip.message",defaultMessage:"Notion AI can now find information from Google Drive. Your workspace owner has enabled this feature for you!"})}),(0,fe.jsx)(ce().A,{style:r.tryIt,hoveredStyle:r.tryItHovered,size:"sm",onClick:()=>c({tryIt:!0}),children:(0,fe.jsx)(Q().sA,{id:"AiGoogleDriveQnaNotificationTooltip.tryIt",defaultMessage:"Ask AI"})})]}),onCloseClick:()=>c({tryIt:!1})}):null}var Se=()=>n(547149);const be=(0,Q().YK)({salesAssistedAiNotificationHeader:{id:"AiSalesAssistedNotificationTooltip.header",defaultMessage:"You now have Notion AI"},salesAssistedAiNotificationContent:{id:"AiSalesAssistedNotificationTooltip.content",defaultMessage:"Ask for edits to pages, find answers, and chat about anything. Click here to see examples."}});function xe(e){const{origin:t}=e,n=(0,T().v3)(),a=(0,j().O$)(I().AppStoreCurrentUserSettingsStore);(0,v.useEffect)((()=>{a&&function(e,t){const{userSettingsStore:n}=t;Se().createAndCommit({environment:e,userAction:"AiSalesAssistedNotificationTooltip.setSalesAssistedNotificationSeenAtToCurrentTimestamp",canUndo:!0,perform:e=>{(0,ne().m)({userSettingsStore:n,transaction:e,data:{ai_sales_assisted_extra_notification_seen_at:Date.now()}})}})}(n,{userSettingsStore:a}),ue().i(n,{from:"sales_assisted_ai_notification"})}),[n,a]),(0,v.useEffect)((()=>{me().DL(n,{callout_key:"ai_sales_assisted_notification_tooltip",placement_key:"Tooltip"})}),[n]);const i=(0,v.useCallback)((()=>{ge().a(n,"ai_sales_assisted_notification_tooltip"),ue().z(n,{from:"sales_assisted_ai_notification"}),me().Sq(n,{callout_key:"ai_sales_assisted_notification_tooltip",dismiss_type:"tooltip_dismiss",placement_key:"Tooltip"})}),[n]);return(0,fe.jsx)(re().k,{style:{width:250},pointerLength:25,pointerPosition:"94%",origin:t,placementToOrigin:"top",header:(0,fe.jsx)(Q().sA,{...be.salesAssistedAiNotificationHeader}),content:(0,fe.jsx)(Q().sA,{...be.salesAssistedAiNotificationContent}),onCloseClick:i})}var Ie=()=>n(627637),ke=()=>n(866515),we=()=>n(576590);function Ce(e){const t=(0,T().v3)(),n=(0,j().O$)(I().AppStoreSidebarSpaceStore),a=(0,j().K8)((()=>h().zD.canUseAiConnectorSearchScope("google-drive")),[]),i=(0,v.useCallback)((async()=>{n&&await(0,we().updateGoogleDriveQnAConnectionState)({environment:t,spaceId:n.getSpaceId()})}),[n,t]);return(0,ke().n)(i,30*ee().Xb,a),null}function Ae(e){const t=(0,T().v3)(),n=(0,j().O$)(I().AppStoreSidebarSpaceStore),a=(0,v.useCallback)((async()=>{n&&await(0,we().updateSlackQnAConnectionState)({environment:t,spaceId:n.getSpaceId()})}),[n,t]);return(0,ke().n)(a,30*ee().Xb,!0),null}var Te=()=>n(555102),je=()=>n(557297),Me=()=>n(703748),_e=()=>n(770160),Pe=()=>n(981475),De=()=>n(254312),Ee=()=>n(680288),Re=()=>n(665638),Be=()=>n(78901),Fe=()=>n(631611),Ne=()=>n(526905),Le=()=>n(30154),Oe=()=>n(866805);const Ve=new(P().O2)("CurrentlyListeningTranscriptionBlockIndicator",(async()=>await Promise.all([n.e(75134),n.e(35530),n.e(9773),n.e(36556),n.e(55373),n.e(36192),n.e(40537),n.e(27992),n.e(63452),n.e(66249),n.e(92845),n.e(87249),n.e(79022),n.e(44854),n.e(87017),n.e(34877),n.e(46414),n.e(11676),n.e(61165),n.e(94522),n.e(44584),n.e(38293),n.e(40992),n.e(88455),n.e(52871),n.e(47160),n.e(49021),n.e(53697),n.e(26126),n.e(6039),n.e(71136),n.e(86341),n.e(29316),n.e(3101)]).then(n.bind(n,301578)))),ze=(0,P()._h)(Ve,(e=>e.CurrentlyListeningTranscriptionBlockIndicator));var We=()=>n(180252),Ue=()=>n(486674),He=()=>n(95286),Ke=()=>n(38554),qe=()=>n(782215),$e=()=>n(131448),Ge=()=>n(905487),Ye=()=>n(883497),Qe=()=>n(525569),Je=()=>n(638001),Xe=()=>n(528093),Ze=()=>n(545390),et=()=>n(215003),tt=()=>n(924102),nt=()=>n(340644);var at=()=>n(584774),it=()=>n(539092),st=()=>n(680074);function ot(e){const{environment:t}=e,n=(0,st().R$)(t);n&&Se().createAndCommit({environment:t,userAction:"userSettingsActions.setHasSeenNewUserOnboardingJoinerV2Experience",canUndo:!0,cellTarget:"main",perform:e=>{(0,ne().m)({userSettingsStore:n,transaction:e,data:{seen_new_user_onboarding_joiner_v2_experience:!0}})}})}var rt=()=>n(434990);function lt(e){const{environment:t}=e,n=(0,st().R$)(t);n&&Se().createAndCommit({environment:t,userAction:"userSettingsActions.setHasSeenNewUserOnboardingChecklistExperience",canUndo:!0,cellTarget:"main",perform:e=>{(0,ne().m)({userSettingsStore:n,transaction:e,data:{seen_new_user_onboarding_checklist_experience:!0}})}})}var ct=()=>n(838319);var dt=()=>n(759418),ut=()=>n(409268),pt=()=>n(687879),gt=()=>n(618571),mt=()=>n(996477),ht=()=>n(535358);const ft=new Set(["ai_google_drive_qna_notification_tooltip","ai_slack_qna_notification_tooltip","ai_sales_assisted_notification_tooltip"]);var yt=()=>n(63936),vt=(n(430670),()=>n(203913)),St=()=>n(396406),bt=()=>n(680474),xt=()=>n(206267),It=()=>n(651784),kt=()=>n(496603),wt=()=>n(552871),Ct=()=>n(309431),At=()=>n(715142);function Tt(e){const t=Dt(),n=Et(),{value:a}=(0,P().fJ)(bt().fM);if(!a||"none"===n.variant)return null;const{AnimatePresence:i}=a;let s;switch(n.variant){case"createdPage":s=(0,fe.jsx)(jt,{...e});break;case"pendingEdits":s=(0,fe.jsx)(Mt,{...e,operationGroups:t});break;default:(0,X().HB)(n.variant)}return(0,fe.jsx)(i,{children:s})}function jt(e){const t=(0,M().IS)((()=>({button:{paddingInlineStart:0,paddingInlineEnd:0}})),[]),{onChat:n}=e,a=(0,T().v3)();return(0,fe.jsxs)(Pt,{children:[(0,fe.jsx)("div",{children:(0,fe.jsx)(Q().sA,{id:"AssistantOriginElement.createdPageMeessage",defaultMessage:"Save page to edit it"})}),(0,fe.jsx)(vt().Ag,{onClick:()=>(0,s().saveAssistantCreatedPage)(a),style:t.button,children:(0,fe.jsx)(Q().sA,{id:"AssistantOriginElement.pendingEdits.savePage",defaultMessage:"Save"})}),(0,fe.jsx)(vt().Ag,{onClick:n,style:t.button,children:(0,fe.jsx)(Q().sA,{id:"AssistantOriginElement.createdPage.chat",defaultMessage:"Chat"})})]})}function Mt(e){const{onChat:t,operationGroups:n}=e,a=(0,T().v3)(),[i]=(0,v.useState)(xt().JW()),r=(0,v.useMemo)((()=>kt().cz(n.map((e=>e.groupedEdits.length)))),[n]),l=(0,v.useMemo)((()=>n.flatMap((e=>e.groupedEdits.flatMap((e=>e.operationIds))))),[n]),c=(0,Ct().e)({inferenceId:i,operationIds:l}),d=(0,Fe().jw)().type,u=(0,v.useCallback)((async()=>{const e=g().default.getActiveSession();e&&(await(0,s().rejectEdits)({environment:a,inferenceId:i,sessionContext:e,operationIds:l,assistantSurfaceType:d}),o().trackDiscardAllPill(a,{sessionId:e.sessionIdFromStoreState,from:d,inferenceId:i}))}),[d,a,i,l]),p=(0,v.useCallback)((async()=>{await c()}),[c]);return(0,fe.jsx)(_t,{pendingEdits:r,onAcceptEdits:p,onRejectEdits:u,onChat:t})}function _t(e){const{pendingEdits:t,onAcceptEdits:n,onRejectEdits:a,onChat:i}=e,s=(0,M().IS)((()=>({button:{paddingInlineStart:0,paddingInlineEnd:0}})),[]),o=(0,j().K8)((()=>{var e;return Boolean(null===(e=g().default.getActiveSession())||void 0===e?void 0:e.isStreaming())}),[]);return(0,fe.jsxs)(Pt,{children:[(0,fe.jsx)("div",{children:(0,fe.jsx)(Q().sA,{id:"AssistantOriginElement.aiPendingEdits",defaultMessage:"{numPendingEdits, plural, one {1 pending AI edit} other {{numPendingEdits} pending AI edits}}",values:{numPendingEdits:t}})}),(0,fe.jsx)(vt().Ag,{onClick:n,style:s.button,disabled:o,children:(0,fe.jsx)(Q().sA,{id:"AssistantOriginElement.pendingEdits.accept",defaultMessage:"Accept"})}),(0,fe.jsx)(vt().Ag,{onClick:a,style:s.button,disabled:o,children:(0,fe.jsx)(Q().sA,{id:"AssistantOriginElement.pendingEdits.discard",defaultMessage:"Discard"})}),(0,fe.jsx)(vt().Ag,{onClick:i,style:s.button,children:(0,fe.jsx)(Q().sA,{id:"AssistantOriginElement.pendingEdits.chat",defaultMessage:"Chat"})})]})}function Pt(e){const t=(0,wt().L)(),n=(0,M().IS)((()=>({outer:{position:"fixed",bottom:t,insetInlineStart:0,width:"100%",display:"flex",zIndex:1e6,padding:4,pointerEvents:"none"},inner:{background:J().Tj.background.accentPrimary,color:J().Tj.text.inversePrimary,borderRadius:8,padding:"11px 16px",boxShadow:J().Tj.shadowLG,margin:"0 auto",fontSize:14,display:"flex",alignItems:"center",pointerEvents:"auto",gap:10}})),[t]),{value:a}=(0,P().fJ)(bt().fM);if(!a)return null;const{motion:i}=a;return(0,fe.jsx)(St().O,{open:!0,zIndex:201,children:(0,fe.jsx)("div",{style:n.outer,children:(0,fe.jsx)(i.div,{"aria-live":"polite",style:n.inner,transition:{duration:.2},initial:{transform:"translateY(50px) scale(0.95)",opacity:0},animate:{transform:"translateY(0) scale(1)",opacity:1},exit:{opacity:0},children:(0,fe.jsx)(fe.Fragment,{children:e.children})})})})}function Dt(){const e=(0,T().v3)();return(0,j().K8)((()=>{const t=g().default.getActiveSession();if(!t)return[];const n=(0,It().hZ)(e.RouterStore.state.route);return t.groupedPendingOperations.state.filter((e=>"updatedPage"===e.type&&!e.didCreatePage)).filter((e=>n.includes(e.pageId)))}),[e])}function Et(){const e=(0,j().K8)((()=>!!I().default.state.mainEditorCurrentBlockStore&&(0,At().Fm)(I().default.state.mainEditorCurrentBlockStore)),[]),t=(0,j().K8)((()=>u().P.state.open),[]),n=Dt(),[a,i]=(0,v.useState)({variant:"none"});return(0,v.useEffect)((()=>{t?i({variant:"none"}):e?i({variant:"createdPage"}):kt().cz(n.map((e=>e.groupedEdits.length)))>0?i({variant:"pendingEdits"}):i({variant:"none"})}),[t,e,n]),a}n(823215);var Rt=()=>n(488814),Bt=()=>n(695115),Ft=()=>n(631524),Nt=()=>n(940563),Lt=()=>n(599813),Ot=()=>n(264300);function Vt(e){const{origin:t,messageConfig:n}=e,a=(0,T().v3)(),i=(0,Q().tz)(),s=(0,Rt().r)({getElement:()=>t.current}),o=(0,M().IS)((()=>({nudge:{maxWidth:200},calloutWrapper:{borderRadius:10,background:J().Tj.background.elevated,color:J().Tj.text.primary,boxShadow:J().Tj.shadowSM,padding:"6px 10px",fontSize:14,lineHeight:1.5,fontWeight:Z().Wy.regular,minWidth:150,maxWidth:280,whiteSpace:"pre-wrap",width:"max-content",transform:"translateY(-40px)"},calloutContent:{display:"flex",flexDirection:"row",alignItems:"center",gap:4,fontSize:14},calloutTitle:{fontWeight:Z().Wy.medium},calloutInner:{display:"flex",flexDirection:"column",padding:"0 2px"},calloutCloseButton:{alignSelf:"flex-start"},calloutCta:{marginTop:6,fontSize:14,fontWeight:Z().Wy.medium,width:"fit-content"},tooltip:{width:200,transform:"translateY(-40px)"},title:{fontSize:12,fontWeight:Z().Wy.medium},content:{padding:"4px 0px",fontSize:12},tooltipCta:{border:`1px solid ${J().Tj.border.strong}`,marginTop:6,color:J().Tj.text.inversePrimary,fontSize:12},tooltipCtaHovered:{backgroundColor:J().Tj.background.accentPrimary}})),[]),r=(0,v.useCallback)((e=>{ge().OX(a,n),"tooltip"===n.type&&"action"in n.props&&n.props.action&&("cta"===e&&(me().Y5(a,{callout_key:n.key,click_type:"primary_cta",placement_key:(0,Ot().Q3)(n)}),(0,qe().Wq)({action:n.props.action,environment:a,metadata:n.props.metadata})),"dismiss"===e&&me().Sq(a,{callout_key:n.key,dismiss_type:"tooltip_dismiss",placement_key:"Tooltip"}))}),[a,n]),l=(0,j().K8)((()=>{const e=(0,Ue().a)();if(!e)return!1;const t=e.getContentStores();return 0===t.length||t.every((e=>e.isEmptyTitle()&&!e.hasContent()))}),[]),c=(0,v.useRef)(!1);if((0,v.useEffect)((()=>{!(0,qe().Z2)(n)||l||c.current||(me().DL(a,{callout_key:n.key,placement_key:"Tooltip"}),c.current=!0)}),[a,n,l]),!(0,qe().Z2)(n))return null;if(l)return null;const d=n.props,u="tooltipType"in d?d.tooltipType:"callout",p="callToAction"in d,g="body"in d&&"string"==typeof d.body,m="title"in d,h="action"in d&&d.action;return"nudge"===u&&h&&p?(0,fe.jsx)(yt().A,{onClick:()=>r("cta"),onClose:()=>r("dismiss"),disableShimmerAnimation:!0,children:(0,fe.jsx)("div",{style:o.nudge,children:(0,fe.jsx)("div",{style:o.title,children:d.callToAction})})}):"speech_bubble"===u&&g?(0,fe.jsx)(z().m,{render:()=>null,placement:"left",alignment:"end",originGap:8,originRect:s,forceVisibleState:!0,allowHover:!0,isLightBackground:!0,style:o.calloutWrapper,renderTooltip:e=>(0,fe.jsxs)("div",{...e,children:[(0,fe.jsxs)("div",{style:o.calloutContent,children:[(0,fe.jsxs)("div",{style:o.calloutInner,children:[m?(0,fe.jsx)("div",{style:o.calloutTitle,children:d.title}):null,"string"==typeof d.body?(0,fe.jsx)("div",{children:d.body}):null]}),(0,fe.jsx)(Bt().A,{ariaLabel:i.formatMessage({id:"DynamicAiAssistantTooltip.closeButtonAriaLabel",defaultMessage:"Close"}),style:o.calloutCloseButton,icon:Lt().xMarkIcon,colorVariant:"primary",size:"xs",onClick:()=>r("dismiss")})]}),p?(0,fe.jsx)(Ft().p,{style:o.calloutCta,size:"sm",onClick:()=>r("cta"),iconTrailing:Nt().arrowStraightRightIcon,children:d.callToAction}):null]})}):m&&g&&"string"==typeof d.body?(0,fe.jsx)(re().k,{style:o.tooltip,pointerLength:25,pointerPosition:"90%",origin:t,alignmentToOrigin:"end",placementToOrigin:"left",header:d.title,showPointer:!1,content:(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)("div",{style:o.content,children:d.body}),p?(0,fe.jsx)(ce().A,{style:o.tooltipCta,hoveredStyle:o.tooltipCtaHovered,size:"sm",onClick:()=>r("cta"),children:d.callToAction}):null]}),onCloseClick:()=>r("dismiss")}):null}var zt=()=>n(901384),Wt=()=>n(807449),Ut=()=>n(552712),Ht=()=>n(160432),Kt=()=>n(637433),qt=()=>n(558687),$t=()=>n(944584);const Gt="https://apps.apple.com/us/app/notion-notes-tasks-ai/id1232780281",Yt="https://play.google.com/store/apps/details?id=notion.id&referrer=utm_source%3Dnone%26utm_medium%3Dnone%26utm_campaign%3Dnone%26utm_term%3Dnone%26utm_content%3Dnone%26referer%3D&pli=1",Qt="https://www.notion.com/mobile",Jt=(0,Q().YK)({title:{defaultMessage:"Get the Notion app",id:"mobile-agent-app-promo-sheet.title"},subtitle:{defaultMessage:"Download the Notion app to draft, edit, and brainstorm with AI",id:"mobile-agent-app-promo-sheet.subtitle"},cta:{defaultMessage:"Download Notion",id:"mobile-agent-app-promo-sheet.cta"},icon:{defaultMessage:"Notion app icon",id:"mobile-agent-app-promo-sheet.icon"}});function Xt({onClose:e}){const t=(0,T().v3)(),n=(0,Q().tz)(),{isIOS:a,isAndroid:i}=(0,T().Y0)(),s=(0,v.useMemo)((()=>a?Gt:i?Yt:Qt),[a,i]),o=(0,v.useCallback)((n=>{$t().trackMobileAgentAppPromoSheetDownloadClicked({environment:t}),e()}),[t,e]),r=(0,M().IS)((()=>({container:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center",padding:"20px 18px",justifyContent:"space-between",gap:32,userSelect:"none"},content:{display:"flex",flexDirection:"column",alignItems:"center",flex:1,justifyContent:"center",gap:8},appIconContainer:{width:120,height:120,borderRadius:24,background:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.12)",border:`1px solid ${J().Tj.border.primaryTranslucent}`},appIcon:{width:"85%",height:"85%",fill:J().Tj.icon.primary},downloadButton:{width:"100%",height:48,borderRadius:10},subtitle:{textAlign:"center"}})),[]);return(0,fe.jsxs)("div",{style:r.container,children:[(0,fe.jsx)(Zt,{onClick:e}),(0,fe.jsx)(Ut().N,{href:s,onClick:o,style:r.appIconContainer,external:!0,"aria-label":n.formatMessage(Jt.cta),children:(0,fe.jsx)(Wt().I,{icon:qt().notionIcon,size:"xl",style:r.appIcon,label:n.formatMessage(Jt.icon)})}),(0,fe.jsxs)("div",{style:r.content,children:[(0,fe.jsx)(V().D,{styleKey:"titleBold",children:(0,fe.jsx)(Q().sA,{...Jt.title})}),(0,fe.jsx)(V().D,{styleKey:"bodyRegular",style:r.subtitle,children:(0,fe.jsx)(Q().sA,{...Jt.subtitle})})]}),(0,fe.jsx)(Ut().N,{href:s,style:{width:"100%"},onClick:o,external:!0,"aria-label":n.formatMessage(Jt.cta),children:(0,fe.jsx)(Ht().A,{colorPalette:"blue",size:"lg",style:r.downloadButton,children:(0,fe.jsx)(V().D,{styleKey:"bodyBold",children:(0,fe.jsx)(Q().sA,{...Jt.cta})})})})]})}function Zt(e){const t=(0,Q().tz)(),n=(0,M().IS)((()=>({button:{position:"absolute",top:12,insetInlineEnd:12,display:"flex",alignItems:"center",justifyContent:"center",background:J().Tj.background.elevated},hover:{background:J().Tj.background.secondary},icon:{width:32,height:32}})),[]);return(0,fe.jsx)(Bt().A,{ariaLabel:t.formatMessage({id:"dismiss.dismissButton.label",defaultMessage:"Dismiss"}),size:"xl",hoveredStyle:n.hover,icon:Kt().xMarkCircleFillIcon,iconStyle:n.icon,onClick:e.onClick,style:n.button})}const en=2*ee().Xb,tn=(0,Q().YK)({agentSummarizeThisPage:{id:"assistant.originElement.agentSummarizeThisPage",defaultMessage:"Summarize this page"},agentFillDatabase:{id:"assistant.originElement.agentFillDatabase",defaultMessage:"Fill in the empty properties in this database"},fillDatabaseReminderLabel:{id:"AssistantOriginElement.fillDatabase",defaultMessage:"Fill empty properties"},dailyBriefReminderLabel:{id:"assistantOriginElement.dailyBriefReminderLabel",defaultMessage:"Help start my day"},notionAiAgentLabel:{id:"assistantOriginElement.notionAiAgentLabel",defaultMessage:"ai"}});function nn(){const{steps:e}=(0,De().q)("agent_new_user_onboarding"),t=(e??[]).filter((e=>e.completed)).length,n=(null==e?void 0:e.length)??0,a=n>0?t/n*100:0,i=(0,M().IS)((()=>({container:{display:"flex",flexDirection:"row",alignItems:"center",gap:8},filledColor:{backgroundColor:J().Tj.blue.text.accentPrimary},unfilledColor:{backgroundColor:J().Tj.blue.text.disabledTranslucent}})),[]);return n?(0,fe.jsxs)("div",{style:i.container,children:[(0,fe.jsx)(Be().z,{percentage:a,width:28,filledColor:i.filledColor.backgroundColor,unfilledColor:i.unfilledColor.backgroundColor}),(0,fe.jsx)(V().D,{styleKey:"captionRegular",colorVariant:"secondary",colorPalette:"blue",children:(0,fe.jsx)(Q().sA,{id:"assistant.originElement.agentNewUserOnboardingChecklistProgressIndicator",defaultMessage:"{completedSteps} of {numSteps}",values:{completedSteps:t,numSteps:n}})})]}):null}const an=!1;function sn(e,t){const n=(0,x().r)(),a=(0,b().T)(),i=(0,Xe()._)({name:"ai_usage",spaceId:n,userId:a,amount:1}),s=function(e){const{isShowingTooltips:t,disableReminder:n}=e,a=(0,j().O$)(I().AppStoreSidebarSpaceViewStore);return(0,j().K8)((()=>{var e;if(n||t)return!1;if(!(0,Oe().OE)())return!1;const i=null==a?void 0:a.getSettings(),s=null==i||null===(e=i.agent_personalization_settings)||void 0===e?void 0:e.daily_brief_prompt;if(!a||!i)return!1;const o=Ne().b9(Date.now());return i.user_daily_first_active_local_date_bucket===o&&((null==s||!s.tooltip_dismissed_at||Ne().b9(s.tooltip_dismissed_at)!==o)&&(!(null==s||!s.daily_brief_generated_at)&&(Ne().b9(s.daily_brief_generated_at)===o&&((null==s||!s.prompt_clicked_at||Ne().b9(s.prompt_clicked_at)!==o)&&(void 0!==i.user_daily_first_active_at_utc&&Date.now()-i.user_daily_first_active_at_utc<Oe().Ni*ee().pT)))))}),[n,t,a])}({isShowingTooltips:e,disableReminder:t});return(0,j().K8)((()=>{var t;const n=p().O.state;if(u().P.state.open||null!==(t=Ge().default.state)&&void 0!==t&&t.open)return{currentState:"default"};if(s)return{currentState:"dailyBriefReminder"};if(function({aiUsageFeatureAvailability:e,currentTooltipRemindersStateIsShowingTooltips:t}){var n;if(t)return!1;if(C().A.isMobile)return!1;const a=(0,ht().IA)();if(!a)return!1;const i=null===(n=a.qna_reminders_shown_at)||void 0===n?void 0:n.at(-1);if(i&&Date.now()-i<2*ee().pT)return!1;return(0,$().e2)(e)}({aiUsageFeatureAvailability:i,currentTooltipRemindersStateIsShowingTooltips:e})){if(function(){var e,t;const n=(0,ht().IA)();if(!n)return!1;const a=n.assistant_fill_database_shown??[];if(!an&&a.length>1)return!1;const{mainEditorCurrentBlockStore:i}=I().default.state;if(null==i||!i.isCollectionView())return!1;if(!an&&a.some((e=>e.collectionViewBlockId===i.id)))return!1;const s=a.at(-1);if(!an&&s&&Date.now()-s.timestamp<2*ee().nD)return!1;const o=Je().j.state;if(!o)return!1;if(i.id!==(null===(e=o.collectionViewBlockStore())||void 0===e?void 0:e.id))return!1;if("table"!==o.getViewType())return!1;if(i.isTypedCollectionViewBlock())return!1;if(1!==(null===(t=i.getCollectionStores())||void 0===t?void 0:t.length))return!1;const r=o.localResultStore.state;if(null!=r&&r.sizeHint&&r.sizeHint>15)return!1;const l=o.resultsInViewOrder(15);if(0===l.length)return!1;const c=(0,Ee().Kc)(o),d=i.getCollectionViewStores().at(0);if(!d)return!1;const u=o.getPropertyFormatKey();let p=[];u&&(p=(d.getPropertyFormatsStore(u).getValue()??[]).filter((e=>e.visible)).map((e=>e.property)));p.length<2&&(p=Object.keys(c));const g=Array.from(new Set(p.filter((e=>e!==H().rn&&void 0!==c[e]))));return 0!==g.length&&(!(g.reduce(((e,t)=>{const n=c[t];return n?!(0,K().Hz)(n)||(0,H().F_)(n.type)||(0,Y().QK)(n.type)?e:e+l.reduce(((e,n)=>{const a=n.getPropertyValue(t);return!a||(0,G().w9s)(a)?e+1:e}),0):e}),0)<3)&&"on"===w().default.getEligibleGroup({experimentId:"ai_product_adoption_nudge_database_fill",defaultGroup:"control"}))}())return{currentState:"fillDatabaseReminder"};if(function(){const e=(0,ht().IA)();if(!e)return!1;const{mainEditorCurrentBlockStore:t,currentUserStore:n}=I().default.state;if(!t||t.isType(U().xd.collectionView)||t.isType(U().xd.collectionViewPage)||(null==n?void 0:n.id)===t.getCreatedById())return!1;if(e.assistant_summarize_this_page_shown_at){if(e.assistant_summarize_this_page_shown_at.length>1)return!1;const t=1===e.assistant_summarize_this_page_shown_at.length?e.assistant_summarize_this_page_shown_at[0]:void 0;if(t&&Date.now()-t<2*ee().nD)return!1}return!((0,ut().s)(t)<500)&&h().zD.isAssistantSummarizeThisPageEnabledForUser()}())return{currentState:"summarizeReminder"}}return n}),[e,i,s])}function on(){const e=(0,T().v3)(),t=(0,Q().tz)(),n=(0,T().Y0)(),a=(0,v.useRef)(!1),i=(0,k().X)("agent_mobile_web_app_promo"),s=n.isPhone&&n.isMobileBrowser,o=i&&s,r=(0,k().X)("disable_ai_connector_connection_updaters"),l=(0,Ke().U)();!function(){const e=(0,T().v3)(),t=(0,j().O$)(I().AppStoreMainEditorCurrentBlockStore),n=(0,j().K8)((()=>{var t;return null===(t=(0,mt().fM)(e))||void 0===t?void 0:t.id}),[e]),a=(0,j().K8)((()=>{var e;return Boolean(null===(e=g().default.getActiveSession())||void 0===e?void 0:e.isCurrentlyCommittingHumanStepFromStoreState)}),[]),i=(0,j().K8)((()=>p().O.state.currentState),[]),s=(0,j().O$)(I().AppStoreCurrentUserSettingsStore);(0,v.useEffect)((()=>{let e;return"answerWaitingForUserClick"===i&&(e=setTimeout((()=>{"answerWaitingForUserClick"===p().O.state.currentState&&p().O.setState({...p().O.state,currentState:"default"})}),en)),()=>clearTimeout(e)}),[i]);const{lastStepLoadingCompletionUnixEpochMs:o,aiWindowLastSeenUnixEpochMs:r}=(0,j().O$)(p().O);(0,v.useEffect)((()=>{const e=p().O.state.currentState,t=o===-1/0||r>o;a||t||"answerLoading"!==e||o===-1/0?a||"answerLoading"!==e&&!t?a&&"default"===e&&p().O.setState({...p().O.state,currentState:"answerLoading"}):p().O.setState({...p().O.state,currentState:"default"}):p().O.setState({...p().O.state,currentState:"answerWaitingForUserClick"})}),[e,t,n,r,a,o,s])}();const c=(0,he().i7)(),m=(0,j().K8)((()=>{var e;return(null===(e=I().default.state.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.clicked_on_agent_corner_entry_point)??!1}),[]),y=c&&!m,B=(0,v.useRef)(null);!function(){const e=(0,T().v3)(),t=(0,j().K8)((()=>{var t;return null===(t=(0,mt().fM)(e))||void 0===t?void 0:t.id}),[e]),n=(0,j().K8)((()=>u().P.state.open),[]);(0,_().A)((()=>{(0,ge().wK)(e,["ai_assistant_origin_element_tooltip","ai_sales_assisted_notification_tooltip"])}),!n);const a=(0,j().K8)((()=>!n&&h().zD.canUseAiConnectorSearchScope("google-drive")),[n]);(0,_().A)((()=>{(0,ge().HH)(e,"ai_google_drive_qna_notification_tooltip")}),a),(0,v.useEffect)((()=>{n||(0,ge().HH)(e,"ai_slack_qna_notification_tooltip")}),[e,n,t])}(),(0,at().T)(),function(){const e=(0,T().v3)(),t=(0,x().r)(),n=(0,b().T)(),a=(0,Xe()._)({name:"ai_usage",spaceId:t,userId:n,amount:1});(0,j().K8)((()=>{const t=nt().Y.getVariant(),n=nt().Y.getExposedToExperiment();return!!(0,$().e2)(a)&&void 0!==t&&!n&&(w().default.getEligibleGroup({experimentId:"adoption_new_user_agent_onboarding_joiner_v2"}),(0,tt().o)({environment:e,featureKey:"adoption_new_user_agent_onboarding_joiner_v2"}),nt().Y.setState({...nt().Y.state,exposedToExperiment:!0}),!0)}),[e,a])}();const V=(0,j().K8)((()=>{const e=$e().default.getMessagesForPlacement("Tooltip");for(const t of e){const e=(0,q().h2)(t.key);if(e&&ft.has(e))return!0}return!1}),[]),W=(0,k().X)("adoption_show_ai_to_new_user_sidebar_open"),U=!(0,j().O$)(D().e),H=(0,x().r)(),K=(0,b().T)(),G=(0,j().K8)((()=>H&&K&&gt().zo.hasAccessRestrictionForWorkspace({userId:K,spaceId:H})),[H,K]),Y=sn(V,l),ee=(0,v.useCallback)((()=>{const t=$e().default.getMessagesForPlacement("Tooltip");for(const n of t){const t=(0,q().h2)(n.key);t&&ft.has(t)&&ge().a(e,t)}}),[e]),ne=(0,v.useCallback)((()=>{const t=I().default.state.mainEditorCurrentBlockStore||I().default.state.currentWorkflowStore,n=e.RouterStore.state.route,a=(0,_e().shouldAllowOpeningAgentOnSpecifiedRoute)(n);if(!t&&!a)return;je().nO.chatSidebarActions.load().then((n=>{n.openChatPanel({environment:e,store:t,chatPanelState:{isOpen:!0}})}))}),[e]),se=(0,v.useCallback)((()=>{if(!0!==c)return;const t=E().default.DO_NOT_USE_markLegacy("assistant.origin_element_click_lag");E().default.DO_NOT_USE_measureAfterNextFlushLegacy(t,{environment:e}),(0,d().prepareAssistantChatOpen)({environment:e,userAction:"AiQnaIntroModal.debug.clickTooltipClose",shouldPreloadChatHistory:!a.current,onPreloadChatHistoryCallback:()=>{a.current=!0}}),ne(),ee();const{currentUserSettingsStore:n}=I().default.state;!m&&n&&Se().createAndCommit({environment:e,userAction:"AssistantOriginElement.setClickedOnAgentCornerEntryPoint",canUndo:!1,perform:e=>{te().zv({store:n,data:{settings:{...n.getSettings(),clicked_on_agent_corner_entry_point:!0}},transaction:e})}})}),[e,ee,c,ne,m]),{variant:oe,exposedToExperiment:re}=(0,dt().V)(),{variant:le,hasSeenNewUserOnboardingChecklistExperience:ce}=(0,Ze().n)(),{variant:de,hasSeenNewUserOnboardingJoinerV2Experience:ue}=(0,et().C)(),pe="checklist_nudge"===le||"sidebar_nudge"===le||"sidebar_nudge"===de,me=function(e){const{environment:t}=e,{variant:n}=(0,Ze().n)();return(0,j().K8)((()=>{const e=(0,it().fw)({environment:t}),a=(0,it().yG)({environment:t}),i=(0,it().n5)({environment:t}),s=a||e||i;return s&&(rt()._.setState({shouldRenderTextPrompt:!0}),"sidebar_nudge"!==n&&lt({environment:t})),s}),[t,n])}({environment:e}),ye=function(e){const{environment:t}=e,{state:n}=(0,De().q)("agent_new_user_onboarding"),{variant:a}=(0,Ze().n)();return(0,j().K8)((()=>{if(n)return!0;const e=(0,it().yQ)({environment:t}),i=(0,it().xD)({environment:t}),s=(0,it().Xn)({environment:t}),o=e||i||s;return o&&(ct().AK({environment:t,checklistId:"agent_new_user_onboarding",state:"open"}),"checklist_nudge"!==a&&lt({environment:t})),o}),[t,n,a])}({environment:e}),ve=function(e){const{environment:t}=e,{variant:n}=(0,et().C)();return(0,j().K8)((()=>{const e=(0,it().MH)({environment:t}),a=(0,it().L9)({environment:t}),i=(0,it().Au)({environment:t}),s=a||e||i;return s&&(nt().Y.setState({...nt().Y.state,shouldRenderTextPrompt:!0}),"sidebar_nudge"!==n&&ot({environment:t})),s}),[t,n])}({environment:e});(0,v.useEffect)((()=>{(re&&oe&&"control"!==oe&&"ai_full_page_text"!==oe||me||ve||ye&&!ce)&&(("ai_sidebar_text"===oe||ye||me||ve)&&(0,Me().setChatPanelMode)({environment:e,chatPanelMode:"sidebar",trackAnalytics:!1,saveUserPreference:!0}),pe||(W?(ne(),ee()):se()))}),[e,oe,re,le,ne,ee,W,me,se,ce,ye,pe,ve]);const be="checklist_nudge"===le&&ye,xe="sidebar_nudge"===le&&me,Ie="sidebar_nudge"===de&&ve,ke=(0,v.useMemo)((()=>be&&!ce?{experiment:"checklist",variant:"checklist_nudge"}:xe&&!ce?{experiment:"checklist",variant:"sidebar_nudge"}:Ie&&!ue?{experiment:"joiner_v2",variant:"sidebar_nudge"}:void 0),[ce,be,xe,Ie,ue]),we=void 0!==ke,{completedAt:Te,state:Ee}=(0,De().q)("agent_new_user_onboarding"),Be=Boolean(void 0!==le&&"control"!==le)&&void 0===Te&&Boolean(Ee),{roundButtonStyle:Ne,buttonPositionStyle:Le}=(0,Re().$)({environment:e,rightEdgeDistance:16,isInPeekRenderer:!1,width:44,shouldShowAgentNewUserOnboardingChecklistProgressIndicator:Be}),Oe=(0,k().X)("top_corner_agent_entry_point"),Ve=(0,j().K8)((()=>Pe().globalChatPanelRuntimeStore.state.chatPanelMode),[]),Ue=(0,j().O$)(I().AppStoreSidebarSpaceViewStore),Je=(0,ae().DV)(Ue),st=(0,j().K8)((()=>Ye().A.state.open),[]),ut=(0,j().O$)((0,We().$o)(e)),pt=n.isPhone&&ut,[ht,yt]=(0,v.useState)(pt);(0,v.useEffect)((()=>{if(!pt){const e=setTimeout((()=>{yt(!1)}),500);return()=>clearTimeout(e)}yt(!0)}),[pt]);const vt=(0,M().IS)((()=>({button:{...Ne,...V?{boxShadow:"0 0 0 1px #2383e2, 0 0 0 3px #b6cce7"}:{},background:J().Tj.assistantCornerButtonBackground,...Oe&&"sidebar"===Ve||ht?{display:"none"}:{},transition:"transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1)",position:"relative"},hoveredButton:{background:J().Tj.assistantCornerButtonBackgroundHovered,transform:"scale(1.1)"},pressedButton:{background:J().Tj.assistantCornerButtonBackgroundPressed},cornerOriginContainer:{zIndex:111},tooltipWrapper:{borderRadius:10,background:J().Tj.background.elevated,color:J().Tj.text.primary,boxShadow:J().Tj.shadowSM,padding:"6px 10px",fontSize:14,lineHeight:1.5,fontWeight:Z().Wy.regular,marginInlineEnd:Je?42:void 0}})),[Ne,V,Oe,Ve,Je,ht]),St=(0,He().$8)(),bt=(0,j().uB)(void 0,O().A),xt=(0,v.useCallback)((e=>{!1!==c&&(e.preventDefault(),e.stopPropagation(),bt.setState({open:!0}))}),[bt,c]),It=(0,v.useCallback)((e=>{!1!==c&&(bt.setState({open:!1}),ne())}),[bt,ne,c]),kt=(0,v.useCallback)((e=>(0,fe.jsx)(F().Ay,{...e,ariaLabel:t.formatMessage(tn.notionAiAgentLabel),className:R().E4Q,style:vt.button,hoveredStyle:vt.hoveredButton,pressedStyle:vt.pressedButton,ref:B,children:(0,fe.jsx)(ie().x,{accessory:Je,variant:"medium_plus"})})),[Je,vt.button,vt.hoveredButton,vt.pressedButton,B,t]),[wt,Ct]=v.useState([]);(0,v.useEffect)((()=>{je().nO.chatSidebarModeButton.load().then((e=>{Ct(e.getChatSidebarModeOptions())}))}),[]);const At=(0,j().K8)((()=>{const e=$e().default.getMessagesForPlacement("Tooltip");for(const t of e)if((0,qe().Z2)(t))return!0;return!1}),[]),jt=(0,v.useMemo)((()=>o?(0,fe.jsxs)("div",{style:Le,children:[(0,fe.jsx)(ze,{}),(0,fe.jsx)(L().A,{buttonPopupStore:bt,popupType:N().nl.Popup,trapFocus:!0,alignmentToOrigin:"center",placementToOrigin:"top",isFullWidthOnMobile:!0,originGap:12,render:e=>(0,fe.jsx)(Xt,{onClose:e.close}),renderOrigin:kt})]}):(0,fe.jsxs)("div",{style:Le,children:[(0,fe.jsx)(ze,{}),(0,fe.jsx)(un,{enabled:!s,children:(0,fe.jsx)(L().A,{buttonPopupStore:bt,popupType:N().nl.Popup,alignmentToOrigin:"center",placementToOrigin:"top",style:{minWidth:190},originGap:8,render:e=>(0,fe.jsx)(je().wl,{parent:e,options:wt,onSelectMode:It}),renderOrigin:()=>At||we?(0,fe.jsxs)(F().Ay,{ariaLabel:t.formatMessage(tn.notionAiAgentLabel),className:R().E4Q,style:vt.button,hoveredStyle:vt.hoveredButton,pressedStyle:vt.pressedButton,ref:B,onContextMenu:xt,onClick:()=>{se(),ke&&((0,S().u)({environment:e,event:{eventName:"adoption_new_user_onboarding_checklist_nudge_open",eventProperties:{}}}),"checklist"===ke.experiment&&lt({environment:e}),"joiner_v2"===ke.experiment&&ot({environment:e}))},children:[ke?(0,fe.jsx)(pn,{copyVariant:ke}):null,(0,fe.jsx)(ie().x,{accessory:Je,variant:"medium_plus"})]}):(0,fe.jsx)(z().m,{originGap:Je?2:8,disableTooltip:V,renderTooltip:()=>(0,fe.jsx)(zt().w,{isAgentNewUserExperience:y}),placement:"top",alignment:"end",delayThreshold:100,isLightBackground:!0,style:vt.tooltipWrapper,preventScaleTransition:!1,preventOpacityTransition:!1,render:e=>kt((0,A().A)(e,{onContextMenu:xt,onClick:se}))})})}),Be?(0,fe.jsx)(nn,{}):null]})),[e,s,o,bt,Le,wt,xt,It,V,se,y,kt,vt.tooltipWrapper,vt.button,vt.hoveredButton,vt.pressedButton,Je,At,t,Be,ke,we]),Mt=(0,v.useMemo)((()=>{switch(Y.currentState){case"dailyBriefReminder":return(0,fe.jsx)(rn,{});case"fillDatabaseReminder":return(0,fe.jsx)(ln,{});case"summarizeReminder":return(0,fe.jsx)(cn,{});case"answerLoading":case"answerWaitingForUserClick":case"default":return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(dn,{origin:B}),jt]});default:(0,X().HB)(Y.currentState)}}),[jt,Y.currentState]),_t=(0,P().fJ)(je().nO.chatSidebarHelpers),Pt=(0,j().K8)((()=>{var t;return(null===(t=_t.value)||void 0===t?void 0:t.getIsChatPanelOpen(e))??!1}),[_t,e]),Dt=(0,j().K8)((()=>Ge().default.state.open||"assistantCompletionPopup"===Qe().default.state.type||Pt),[Pt]),Rt=Et(),Bt=(0,j().K8)((()=>{const t=e.RouterStore.state.route;return C().A.isMobile&&"agent"===t.name}),[e]);return St||Dt||n.isMobileNative&&"none"!==Rt.variant||st||Bt||U||G?null:(0,fe.jsx)(Fe().hP,{surface:Fe().wy.corner,children:(0,fe.jsxs)("div",{className:R().qZ1,style:vt.cornerOriginContainer,children:[r?void 0:(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(Ae,{}),(0,fe.jsx)(Ce,{})]}),(0,fe.jsx)(Tt,{onChat:se}),(0,fe.jsx)(f().N,{children:Mt})]})})}function rn(){const{handleDismissDailyBrief:e,handleOpenDailyBrief:t}=function(){const e=(0,T().v3)(),t=(0,he().i7)();return{handleDismissDailyBrief:(0,v.useCallback)((async()=>{await(0,Le().RV)({environment:e}),(0,S().u)({environment:e,event:{eventName:"agent_daily_brief_reminder_dismissed",eventProperties:{type:"corner"}}})}),[e]),handleOpenDailyBrief:(0,v.useCallback)((async()=>{if(!t)return;const n=await(0,Le().Pc)({environment:e,showChatSidebarSource:"daily_brief_reminder",navigationMethod:"panel"});n&&(0,S().u)({environment:e,event:{eventName:"agent_daily_brief_reminder_clicked",eventProperties:{ai_session_id:n.id,type:"corner"}}})}),[e,t])}}();return(0,fe.jsx)(yt().A,{onClick:t,onClose:e,disableShimmerAnimation:!0,variant:"dailyBrief",children:(0,fe.jsx)(Q().sA,{...tn.dailyBriefReminderLabel})})}function ln(){const e=(0,T().v3)(),t=(0,he().i7)(),n=(0,j().O$)(Te().bX),a=(0,j().O$)(Je().j),i=(0,Q().tz)(),s=(0,j().K8)((()=>"editing"===B().default.state.mode),[]),o=(0,v.useCallback)((t=>{const n=I().default.state.currentUserSettingsStore;n&&Se().createAndCommit({environment:e,userAction:"AssistantOriginElement.updateAssistantFillDatabaseDismissed",canUndo:!0,perform:e=>{var t,i;const s=[...(null===(t=n.getSettings())||void 0===t?void 0:t.assistant_fill_database_shown)??[]],o=null==a||null===(i=a.collectionViewBlockStore())||void 0===i?void 0:i.id;o&&s.push({collectionViewBlockId:o,timestamp:Date.now()}),(0,ne().m)({userSettingsStore:n,transaction:e,data:{assistant_fill_database_shown:s}})}}),t||(0,S().u)({environment:e,event:{eventName:"agent_fill_database_reminder_dismissed",eventProperties:{}}})}),[a,e]);(0,v.useEffect)((()=>{s&&o()}),[s,o]);const r=(0,v.useCallback)((async()=>{if(!t||null==n||!n.blockStore)return;const a=(0,Te().Kf)({environment:e,spaceStore:n.spaceStore,userStore:n.userStore,value:(0,G().x9d)(i.formatMessage(tn.agentFillDatabase))}),s=(0,Te().Xd)({environment:e,inferenceContext:n,addSteps:[a],surface:"fill_database_reminder",config:{type:"workflow",useReadOnlyMode:!1}}),r=(0,pt().addTranscriptToNewThreadAndRun)({environment:e,spaceStore:n.spaceStore,transcript:s}),{openChatPanel:l}=await je().nO.chatSidebarActions.load();l({environment:e,store:n.blockStore,chatPanelState:{isOpen:!0,threadId:r.id},source:"adoption_fill_database_reminder"}),(0,S().u)({environment:e,event:{eventName:"agent_fill_database_reminder_clicked",eventProperties:{ai_session_id:r.id}}}),o(!0)}),[e,n,i,t,o]);return(0,fe.jsx)(yt().A,{onClick:r,onClose:o,disableShimmerAnimation:!0,children:(0,fe.jsx)(Q().sA,{...tn.fillDatabaseReminderLabel})})}function cn(){const e=(0,T().v3)(),t=(0,he().i7)(),n=(0,j().O$)(Te().bX),a=(0,Q().tz)(),i=(0,j().K8)((()=>"editing"===B().default.state.mode),[]),s=(0,v.useCallback)((t=>{const n=I().default.state.currentUserSettingsStore;n&&Se().createAndCommit({environment:e,userAction:"AssistantOriginElement.updateAssistantSummarizeDismissed",canUndo:!0,perform:e=>{var t;(0,ne().m)({userSettingsStore:n,transaction:e,data:{assistant_summarize_this_page_shown_at:[...(null===(t=n.getSettings())||void 0===t?void 0:t.assistant_summarize_this_page_shown_at)??[],Date.now()]}})}}),t||(0,S().u)({environment:e,event:{eventName:"assistant_summarize_this_page_reminder_dismissed",eventProperties:{}}})}),[e]);(0,v.useEffect)((()=>{i&&s()}),[i,s]);const o=(0,Fe().jw)(),r=(0,j().K8)((()=>{var e;return null===(e=(0,Ue().a)())||void 0===e?void 0:e.pointer}),[]),c=(0,v.useCallback)((async()=>{if(!0===t){if(null==n||!n.blockStore)return;const t=(0,Te().Kf)({environment:e,spaceStore:n.spaceStore,userStore:n.userStore,value:(0,G().x9d)(a.formatMessage(tn.agentSummarizeThisPage))}),i=(0,Te().Xd)({environment:e,inferenceContext:n,addSteps:[t],surface:"summarize_this_page_reminder",config:{type:"workflow"}}),s=(0,pt().addTranscriptToNewThreadAndRun)({environment:e,spaceStore:n.spaceStore,transcript:i}),{openChatPanel:o}=await je().nO.chatSidebarActions.load();o({environment:e,store:n.blockStore,chatPanelState:{isOpen:!0,threadId:s.id}})}else{if(!r)return;const t=(0,l().createClientParameterValuesSkill)("chat_key_points",(0,W().b6)("chat_key_points",r));await(0,d().handleActivateNewSkill)({clientSkillWithParameterValues:{clientSkill:t,parameterValues:t.parameterValues},environment:e,assistantSurface:o})}(0,S().u)({environment:e,event:{eventName:"assistant_summarize_this_page_reminder_clicked",eventProperties:{}}}),s(!0)}),[o,r,e,n,t,s,a]);return(0,fe.jsx)(yt().A,{onClick:c,onClose:s,disableShimmerAnimation:!0,children:(0,fe.jsx)(Q().sA,{defaultMessage:"Summarize this page",id:"AssistantOriginELement.summarize"})})}function dn(e){const{origin:t}=e,n=(0,j().K8)((()=>u().P.state.open),[]),a=(0,j().K8)((()=>{const e=$e().default.getMessagesForPlacement("Tooltip");for(const t of e){if((0,qe().Z2)(t))return t;const e=(0,q().h2)(t.key);if(e&&ft.has(e))return t}}),[]);if(n)return null;if(!a)return null;if((0,qe().Z2)(a))return(0,fe.jsx)(Vt,{origin:t,messageConfig:a});switch((0,q().h2)(a.key)){case"ai_sales_assisted_notification_tooltip":return(0,fe.jsx)(xe,{origin:t});case"ai_slack_qna_notification_tooltip":return(0,fe.jsx)(Ie().x,{origin:t});case"ai_google_drive_qna_notification_tooltip":return(0,fe.jsx)(ve,{origin:t})}return null}function un({children:e,enabled:t=!0}){return t?(0,fe.jsx)(y().P.div,{initial:{opacity:0,y:25,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0},style:{willChange:"opacity, transform",width:"100%"},transition:{type:"spring",stiffness:450,damping:19,mass:.5},children:e}):e}function pn(e){const{copyVariant:t}=e;let n,a;return"checklist"===t.experiment?"checklist_nudge"===t.variant?(n=(0,fe.jsx)(Q().sA,{defaultMessage:"Finish setup",id:"assistant.originElement.assistantNewUserOnboardingChecklistExperienceNudge.checklist.title"}),a=(0,fe.jsx)(Q().sA,{defaultMessage:"Just 3 steps to build your workspace",id:"assistant.originElement.assistantNewUserOnboardingChecklistExperienceNudge.checklist.subtitle"})):(n=(0,fe.jsx)(Q().sA,{defaultMessage:"Set up a project tracker",id:"assistant.originElement.assistantNewUserOnboardingChecklistExperienceNudge.title"}),a=(0,fe.jsx)(Q().sA,{defaultMessage:"It only takes one click",id:"assistant.originElement.assistantNewUserOnboardingChecklistExperienceNudge.subtitle"})):(n=(0,fe.jsx)(Q().sA,{defaultMessage:"Catch up on this workspace",id:"assistant.originElement.assistantNewUserOnboardingChecklistExperienceNudge.joinerV2.title"}),a=(0,fe.jsx)(Q().sA,{defaultMessage:"It only takes one click",id:"assistant.originElement.assistantNewUserOnboardingChecklistExperienceNudge.joinerV2.subtitle"})),(0,fe.jsxs)("div",{style:{position:"absolute",display:"flex",flexDirection:"column",gap:8,width:232,padding:12,borderRadius:16,background:J().Tj.background.primary,bottom:48,insetInlineEnd:48,boxShadow:J().Tj.shadowMD},children:[(0,fe.jsx)(V().D,{styleKey:"bodyLgRegular",children:n}),(0,fe.jsx)(V().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:a})]})}var gn=()=>n(75435),mn=()=>n(918516),hn=()=>n(410690),fn=()=>n(72307),yn=()=>n(75600),vn=()=>n(926586),Sn=()=>n(817942),bn=()=>n(900652),xn=()=>n(869562),In=()=>n(370964),kn=(n(672577),()=>n(756117)),wn=()=>n(852507),Cn=()=>n(201794),An=()=>n(463086),Tn=()=>n(879765),jn=()=>n(526278),Mn=()=>n(107620),_n=()=>n(274570),Pn=()=>n(859384),Dn=()=>n(804059),En=()=>n(765974),Rn=()=>n(207207),Bn=()=>n(995847),Fn=()=>n(340498),Nn=()=>n(234459),Ln=()=>n(175947),On=()=>n(650829),Vn=()=>n(246686),zn=()=>n(166442),Wn=()=>n(639919),Un=(n(16280),()=>n(248140)),Hn=()=>n(890492),Kn=()=>n(81068),qn=()=>n(663639),$n=()=>n(736847),Gn=()=>n(563217),Yn=()=>n(349679),Qn=()=>n(101927),Jn=()=>n(781697);function Xn(e){const{currentMode:t,showsLimitedQnaLabel:n}=(0,j().K8)((()=>({currentMode:h().zD.getMode(),showsLimitedQnaLabel:h().zD.showsLimitedQnaLabel()})),[]),a=v.useCallback((e=>{const{buttonPopupParent:t,mode:n}=e;Un().A.updateLocalOverrideConfig("assistant_variant",n),t.close()}),[]),i=(0,M().IS)((()=>({buttonContainer:{...e.style},badge:{fontSize:C().A.isMobile?14:11,fontWeight:500,padding:"1px 4px",backgroundColor:J().Tj.cardHoveredBackground,color:J().Tj.text.tertiary,borderRadius:4,...Z().RC}})),[e.style]),s=(0,Jn().e)({width:C().A.isMobile?void 0:350}),o=(0,j().K8)((()=>h().zD.shouldShowAssistantBadge()),[]),r=(0,j().K8)((()=>!(0,Qn().ab)()),[]);return o&&"control"!==t?(0,fe.jsx)(L().A,{popupType:C().A.isMobile?L().z.SlideUp:L().z.Popup,disabled:r,placementToOrigin:"bottom",alignmentToOrigin:"start",renderOrigin:e=>(0,fe.jsx)(z().m,{renderTooltip:()=>(0,fe.jsx)("div",{children:"Select assistant variant"}),disableTooltip:r,placement:"bottom",alignment:"center",render:a=>(0,fe.jsx)(F().Ay,{...(0,A().A)(e,a),disabled:r,ignoreLocalHoverState:!0,style:i.buttonContainer,children:(0,fe.jsx)("div",{style:i.badge,children:(0,fe.jsx)(Zn,{mode:t,showsLimitedQnaLabel:n})})})}),render:e=>(0,fe.jsx)(Hn().A,{...s,children:(0,fe.jsx)(qn().A,{type:qn().O.Vertical,initialFocus:0,sections:[{key:"assistant_modes",render:e=>(0,fe.jsx)($n().A,{...e,title:"Mode for Dev",shouldShowBottomDivider:!0}),items:Gn().P7.map((n=>function(e){const{mode:t,buttonPopupParent:n,currentMode:a,onSelectMode:i}=e,s=(e,n)=>(0,fe.jsx)(Kn().A,{...e,ref:n,title:(0,fe.jsx)(ea,{mode:t}),right:t===a?(0,fe.jsx)(Wt().I,{icon:Yn().checkmarkSmallIcon,size:"xs"}):void 0,caption:(0,fe.jsx)(na,{mode:t}),shouldWrapCaption:!0});return{key:t,render:(e,t)=>s(e),action:()=>{i({buttonPopupParent:n,mode:t})}}}({buttonPopupParent:e,mode:n,currentMode:t,onSelectMode:a})))}]})})}):null}function Zn(e){const{mode:t,showsLimitedQnaLabel:n}=e;if(n)return(0,fe.jsx)(Q().sA,{id:"assistantMenu.header.limited.label",defaultMessage:"Free plan"});return(0,fe.jsx)(ta,{mode:t})}function ea(e){const{mode:t}=e;throw new Error("Should not show non-production data in production")}function ta(e){const{mode:t}=e;return"assistant_0.25_with_marketing"===t?null:"assistant_0.3"===t?(0,fe.jsx)(Q().sA,{id:"assistantMenu.header.assistant0_3.label",defaultMessage:"Alpha"}):"development"===t?(0,fe.jsx)(Q().sA,{id:"assistantMenu.header.Development.label",defaultMessage:"Development"}):"exploratory"===t?(0,fe.jsx)(Q().sA,{id:"assistantMenu.header.exploratory.label",defaultMessage:"Exploratory"}):(0,X().HB)(t)}function na(e){const{mode:t}=e;return"assistant_0.25_with_marketing"===t?(0,fe.jsx)(Q().sA,{id:"assistantMenu.header.Assistant0_25Withmarketing.caption",defaultMessage:" Assistant with AI writer including modals for the marketing launch"}):"assistant_0.3"===t?(0,fe.jsx)(Q().sA,{id:"assistantMenu.header.Assistant0_3.caption",defaultMessage:" Assistant with database querying, page creation and editing. Alpha is on this variant."}):"development"===t?(0,fe.jsx)(Q().sA,{id:"assistantMenu.header.Development.caption",defaultMessage:" New features were about to ship."}):"exploratory"===t?(0,fe.jsx)(Q().sA,{id:"assistantMenu.header.Exploratory.caption",defaultMessage:" Features still baking but want feedback on."}):(0,X().HB)(t)}var aa=()=>n(410930),ia=()=>n(863059),sa=()=>n(551345),oa=()=>n(279115),ra=()=>n(483795),la=()=>n(770906),ca=()=>n(441199),da=()=>n(440024),ua=()=>n(644914),pa=()=>n(749687),ga=()=>n(895933),ma=()=>n(77279),ha=()=>n(712505),fa=()=>n(260850),ya=()=>n(156008),va=()=>n(31278);function Sa(){const e=(0,j().K8)((()=>g().default.getActiveSession()),[]),t=(0,j().K8)((()=>Boolean(null==e?void 0:e.getHasCommittedHumanStep())),[e]),n=(0,j().K8)((()=>{var e;return null===(e=g().default.getActiveSession())||void 0===e?void 0:e.selectedSkillFromStoreState}),[]),a=(0,j().K8)((()=>va().zz.isAvailable()),[]),i=(0,j().K8)((()=>h().zD.isParameterizationAndEmptyStateEnabled()),[]),s=(0,j().K8)((()=>{var t;return null==e||null===(t=e.assistantConfigurationStoreState)||void 0===t?void 0:t.researchModeRequested}),[e]),o=(0,he().i7)();return(0,j().K8)((()=>{const e=u().P.state;return e.open&&"chat"===e.currentView}),[])?i&&!t?{type:"empty_state"}:{type:"chat"}:o?{type:"agent_popup"}:!t&&a?{type:"abandoned_search_reminder"}:s?{type:"research_mode_chat"}:t||n?{type:"chat"}:i?{type:"empty_state"}:{type:"chat"}}var ba=()=>n(859841),xa=()=>n(856411),Ia=()=>n(908006),ka=()=>n(363901),wa=()=>n(611648),Ca=()=>n(988083),Aa=()=>n(150669),Ta=()=>n(110750),ja=()=>n(552736),Ma=()=>n(591779),_a=()=>n(854705),Pa=()=>n(634877),Da=()=>n(186441),Ea=()=>n(376254),Ra=()=>n(611491),Ba=()=>n(68465),Fa=()=>n(255063),Na=()=>n(295304),La=()=>n(234637),Oa=()=>n(995277),Va=()=>n(912771),za=()=>n(248053),Wa=()=>n(297813),Ua=()=>n(321701),Ha=()=>n(651196),Ka=()=>n(128555),qa=()=>n(295633),$a=()=>n(732810),Ga=()=>n(98126),Ya=()=>n(187174),Qa=()=>n(40457),Ja=()=>n(179034),Xa=()=>n(519831),Za=()=>n(778078),ei=()=>n(575143),ti=()=>n(696746),ni=()=>n(106628),ai=()=>n(361330),ii=()=>n(534619),si=()=>n(968172),oi=()=>n(96689),ri=()=>n(854150),li=()=>n(187820),ci=()=>n(128295),di=()=>n(16006);const ui=v.forwardRef((function(e,t){const{store:a,caption:i,hoverIcon:s}=e,o=(0,M().IS)((()=>({rightIcon:{width:16,height:14,fill:J().Tj.icon.tertiary}})),[]),r=(0,j().K8)((()=>i?(0,fe.jsx)(gi,{caption:i}):!(a instanceof n(723085).h)&&(0,ci().a6)(a)&&(0,fe.jsx)(ci().Ay,{store:a,showFullPathInTooltip:!0})),[i,a]);return(0,fe.jsx)(Kn().A,{...e,right:s&&!C().A.isMobile?s({...o.rightIcon,...e.focused?{}:{visibility:"hidden"}}):null,ref:t,title:(0,fe.jsx)(di().A,{store:a,shouldWrap:!1}),icon:(0,fe.jsx)(pi,{store:a}),caption:r,className:"notranslate"})}));function pi({store:e}){const t=(0,T().v3)(),n=(0,j().K8)((()=>e.getIcon()),[e]),a=(0,j().K8)((()=>e instanceof qa().B&&e.isEmptyPage()),[e]),i=(0,j().K8)((()=>(0,li().Te)(e)),[e]),s=(0,j().K8)((()=>function(e,t){switch(e.table){case oi().NX:return(0,oe().G)(t,e);case ri().yK:return e.getName();default:return}}(e,t)),[t,e]);return(0,fe.jsx)(li().B6,{disabled:!0,icon:n,iconRecordCategory:i,isEmptyPage:a,title:s,size:C().A.isMobile?24:20})}function gi(e){const{caption:t}=e;return(0,fe.jsx)("div",{style:{display:"flex",fontSize:Z().J.UISmall.desktop,color:J().Tj.text.tertiary,overflow:"hidden",maxWidth:100},children:t})}const mi=(0,Q().YK)({currentPageLabel:{id:"action.currentPage.label",defaultMessage:"Current page"},noItemsAvailable:{id:"assistantTypeAheadHelpers.noItemsAvailable",defaultMessage:"No items available"}});function hi(e,t,n){const a=(0,Ya().Yb)((async()=>{if(0===e.length)return{type:"empty",query:e};const n=await t(e);return{type:"results",query:e,value:n}}),[e,t],{debounce:n}),[i]=a;if("idle"===i.status)return{type:"empty",query:e,loading:!1};if("rejected"===i.status)return{type:"error",query:e,loading:!1};const s=i.value??{type:"empty",query:e};return"pending"===i.status?{...s,loading:!0}:{...s,loading:!1}}function fi(e,t){if("error"===e.type&&"error"===t.type)return{serverResults:[],localResults:[]};const n="empty"===t.type||"error"===t.type?[]:t.value;if("empty"===e.type)return{serverResults:[],localResults:[]};if("error"===e.type)return{serverResults:n,localResults:[]};if("results"===e.type){const a=e.query!==t.query,i=0===e.value.length;return{serverResults:a&&!i?[]:n,localResults:e.value}}(0,X().HB)(e)}function yi(e){const{record:t,action:n,caption:a}=e;return{key:t.id,action:()=>n(t),render:(e,n)=>(0,fe.jsx)(ui,{...e,inline:!1,store:t,hoverIcon:Qa().arrowTurnDownLeftSmallIcon,caption:a})}}function vi(e){const{environment:t,store:n}=e;Se().createAndCommit({userAction:"assistant.clearInput",environment:t,canUndo:!0,perform:e=>Na().uD({transaction:e,store:n})})}function Si(e){const{query:t,currentPageStore:n,onSelectPage:a}=e,{sidebarSpaceStore:i,sidebarSpaceViewStore:s,currentUserSettingsStore:o,currentUserStore:r}=(0,j().K8)((()=>({sidebarSpaceStore:(0,se().S)(),sidebarSpaceViewStore:I().default.state.sidebarSpaceViewStore,currentUserSettingsStore:I().default.state.currentUserSettingsStore,currentUserStore:I().default.state.currentUserStore})),[]);if(!i||!s)throw new Error("Expected spaceStore and spaceViewStore to be defined");const l=(0,v.useMemo)((()=>G().q4_(t)),[t]),c=(0,T().v3)(),d=(0,v.useCallback)((e=>{a(e.pointer)}),[a]),u=(0,j().K8)((()=>{if(!i)return[];const e=si().A.get(i.id)??[];return kt().hS(kt().oE([n,...e.map((e=>e.store)).filter((e=>e.isType("page")))]),"id")}),[n,i]),p=(0,P().fJ)(ni().T.searchActions),g=(0,v.useCallback)((async e=>{if("resolved"!==p.status)return[];const t=p.value;return(await t.searchLocalNavigableBlocks({environment:c,searchQuery:e,sidebarSpaceStore:i,sidebarSpaceViewStore:s,blockTypes:["page"],limit:5,parentId:void 0,currentUserSettingsStore:o,currentUserStore:r})).map((e=>e.store))}),[i,s,c,p.status,p.value,o,r]),m=(0,v.useCallback)((async e=>{const t=await async function(e){const{environment:t,searchQuery:n,sidebarSpaceStore:a}=e;return(await(0,ii().searchMentionablePages)({nearBlock:void 0,environment:t,query:n,source:"assistant_mention_menu",limit:20})).map(((e,t)=>({...e,serverEventProperties:void 0,originalPosition:t,store:qa().B.createChildStore(a,{table:Ja().ev,id:e.id})})))}({environment:c,searchQuery:e,sidebarSpaceStore:i});return t.map((e=>e.store)).filter((e=>e.isType("page")))}),[i,c]),h=hi(l,g,ai().GR),f=hi(l,m,ai().ab);return{items:(0,v.useMemo)((()=>{if(0===l.length||"empty"===h.type||"results"===h.type&&0===h.value.length&&"empty"===f.type)return u.map((e=>yi({record:e,action:d,caption:e.id===(null==n?void 0:n.id)?(0,fe.jsx)(Q().sA,{...mi.currentPageLabel}):void 0})));const{localResults:e,serverResults:t}=fi(h,f);return kt().hS([...e,...t],"id").map((e=>yi({record:e,action:d})))}),[l.length,h,f,u,d,null==n?void 0:n.id]),isLoading:h.loading||f.loading}}const bi=v.forwardRef((function(e,t){const n=C().A.isMobile?24:20;return(0,fe.jsx)(ei().A,{ref:t,...e,svgContainerStyle:{width:n,height:n},right:C().A.isMobile?null:(0,fe.jsx)("span",{style:e.focused?{}:{visibility:"hidden"},children:(0,fe.jsx)(Wt().I,{icon:Qa().arrowTurnDownLeftSmallIcon,size:"sm",colorVariant:"tertiary"})})})}));function xi(e){const{clientSkill:t,onSelect:n,shouldAcceptText:a,textValue:i}=e,s=(0,Q().tz)(),o=(0,j().K8)((()=>{var e;return null===(e=(0,Ue().a)())||void 0===e?void 0:e.DANGEROUSLY_INCORRECT_getCollectionStore()}),[]),{items:r,isLoading:l}=function(e){const{query:t,onSelectCollection:n,currentCollectionStore:a}=e,{sidebarSpaceStore:i,sidebarSpaceViewStore:s,currentUserSettingsStore:o,currentUserStore:r}=(0,j().K8)((()=>({sidebarSpaceStore:(0,se().S)(),sidebarSpaceViewStore:I().default.state.sidebarSpaceViewStore,currentUserSettingsStore:I().default.state.currentUserSettingsStore,currentUserStore:I().default.state.currentUserStore})),[]);if(!i||!s)throw new Error("Expected spaceStore and spaceViewStore to be defined");const l=(0,T().v3)(),c=(0,v.useMemo)((()=>G().q4_(t)),[t]),d=(0,v.useCallback)((e=>{var t;(null===(t=e.getParentBlockStore())||void 0===t?void 0:t.pointer)&&n(e.pointer)}),[n]),u=(0,j().K8)((()=>{if(!i)return[];const e=si().A.get(i.id);if(!e)return[];const t=e.flatMap((e=>e.store.isType("collection_view_page")||e.store.isType("collection_view")?e.store.getCollectionStores():void 0));return kt().hS(kt().oE([a,...t]),"id")}),[a,i]),p=(0,P().fJ)(ni().T.searchActions),g=(0,v.useCallback)((async e=>{if("resolved"!==p.status)return[];const t=p.value,n=await t.searchLocalNavigableBlocks({environment:l,searchQuery:e,sidebarSpaceStore:i,sidebarSpaceViewStore:s,blockTypes:["collection_view_page","collection_view"],limit:5,parentId:void 0,currentUserSettingsStore:o,currentUserStore:r});return kt().hS(kt().oE(n.map((e=>e.store.DANGEROUSLY_INCORRECT_getCollectionStore()))),"id")}),[i,s,l,p.status,p.value,o,r]),m=(0,v.useCallback)((async e=>{const{results:t}=await(0,ii().searchCollections)(l,{query:e,limit:20,source:"assistant_search_databases",spaceStore:i,searchSessionId:void 0,peopleBlocksToInclude:"none"});return t.map((e=>$a().m.createChildStore(i,{table:Xa().Vl,id:e})))}),[i,l]),h=hi(c,g,ai().GR),f=hi(c,m,ai().ab);return{items:(0,v.useMemo)((()=>{if(0===c.length||"empty"===h.type||"results"===h.type&&0===h.value.length&&"empty"===f.type)return u.map((e=>yi({record:e,action:d,caption:e.id===(null==a?void 0:a.id)?(0,fe.jsx)(Q().sA,{...mi.currentPageLabel}):void 0})));const{localResults:e,serverResults:t}=fi(h,f);return kt().hS(kt().oE([...e,...t]),"id").map((e=>yi({record:e,action:d})))}),[c.length,h,f,u,d,null==a?void 0:a.id]),isLoading:h.loading||f.loading}}({query:i,onSelectCollection:n,currentCollectionStore:o}),c=r.length>0,d=(0,v.useMemo)((()=>{const e=[...r],o=G().q4_(i);if(e.length>0&&i&&o.length>0&&a){const a=`${s.formatMessage(t.displayName)} ${o}`;e.push({key:"freeform_activate",action:()=>n(i),render:e=>(0,fe.jsx)(ei().A,{...e,svg:t.icon,title:a})})}return e.length>0?[{key:"local",items:e,render:e=>(0,fe.jsx)($n().A,{title:(0,fe.jsx)(Q().sA,{id:"assistantTypeaheadHelpers.menuListSection.selectDatabase.title",defaultMessage:"Select a database"}),right:l?(0,fe.jsx)(Ga().k,{}):void 0,...e})}]:[]}),[r,i,a,s,t.displayName,t.icon,n,l]);return{sections:d,itemsAvailable:c}}var Ii=()=>n(30537),ki=()=>n(546926),wi=()=>n(452004),Ci=()=>n(474587),Ai=()=>n(185078),Ti=()=>n(190547);const ji=new(n(592328).A);var Mi=()=>n(120013);function _i(e){const{open:t,originRect:n,children:a,onDismiss:i}=e,s=(0,M().IS)((()=>({inputMenuStyles:{marginTop:4,marginBottom:6,borderRadius:6,background:J().Tj.popoverBackground,boxShadow:J().Tj.shadowMD,isolation:"isolate"}})),[]),[o,r]=(0,v.useState)(null==n?void 0:n.getBoundingClientRect());return(0,v.useEffect)((()=>{const e=kt().sg((()=>{r(null==n?void 0:n.getBoundingClientRect())}),300);return e(),ji.addListener(e),()=>ji.removeListener(e)}),[n]),(0,fe.jsx)(N().zD,{popupType:Ii().n.Popup,placementToOrigin:"top",alignmentToOrigin:"start",disableMouseCapture:!0,open:t,render:()=>(0,fe.jsx)(Hn().A,{menuType:ki().gu.Popup,width:"100%",maxHeight:144,minWidth:C().A.isMobile?220:280,maxWidth:C().A.isMobile?"calc(100vw - 32)":376,scrollerStyle:{paddingBottom:0},children:a}),onDismiss:i,keepFocus:!0,originRect:o,style:s.inputMenuStyles})}function Pi(e){const{clientSkill:t,store:n,onActivateSkill:a,originElement:i,onDismiss:s,inputHasFocus:o}=e;(0,wn().l)((()=>{Mi().A.reset()}));const r=(0,W().Bf)(t.skillType);return(0,fe.jsx)(Di,{inputStore:n,clientSkill:t,fillableParameter:r,onActivateSkill:a,originRect:i,onDismiss:s,inputHasFocus:o})}function Di(e){const{clientSkill:t,fillableParameter:n,inputStore:a,onActivateSkill:i,originRect:s,onDismiss:o,inputHasFocus:r}=e,{fillableParameter:l,remainingParameters:c,parameterDefinition:d}=n,u=(0,Q().tz)(),p=(0,k().X)("editor_basic_rtl"),g=(0,T().v3)(),{isMobileNative:m}=g.device,h=(0,Ti().v)(),f=m&&h,y=(0,j().K8)((()=>a.getValue()),[a]),S=(0,v.useCallback)((e=>{i({clientSkill:t,parameterValues:{...c,[l]:e}})}),[t,i,c,l]);if("blockOrText"===d.type)return(0,fe.jsx)(Ei,{onSelect:S,textValue:y,shouldAcceptText:!0,clientSkill:t,originRect:s,onDismiss:o,hidePopup:!r||f});if("block"===d.type)return(0,fe.jsx)(Ei,{onSelect:S,textValue:y,shouldAcceptText:!1,clientSkill:t,originRect:s,onDismiss:o,hidePopup:!r||f});if("collection"===d.type)return(0,fe.jsx)(Ri,{onSelect:S,textValue:y,shouldAcceptText:!1,clientSkill:t,originRect:s,onDismiss:o,hidePopup:!r||f});if("tone"===d.type)return(0,fe.jsx)(Bi,{list:W().oy,onSelectItem:S,textValue:y,clientSkill:t,originRect:s,onDismiss:o,hidePopup:!r||f});if("language"===d.type){const e=[...(0,Ci().fS)({includeRtlLanguages:p})].sort(((e,t)=>{const n=u.formatMessage(e.name),a=u.formatMessage(t.name);return n.localeCompare(a)}));return(0,fe.jsx)(Bi,{list:e,onSelectItem:S,textValue:y,clientSkill:t,originRect:s,onDismiss:o,hidePopup:!r||f})}if("fullPageTranslationLanguage"===d.type){const e=(0,Ai().vQ)({includeRtlLanguages:p}).sort(((e,t)=>{const n=u.formatMessage(e.name),a=u.formatMessage(t.name);return n.localeCompare(a)}));return(0,fe.jsx)(Bi,{list:e,onSelectItem:S,textValue:y,clientSkill:t,originRect:s,onDismiss:o,hidePopup:!r||f})}if("textValue"===d.type||"string"===d.type||"summarizeStyle"===d.type||"summarizeMode"===d.type||"user"===d.type)throw new Error("Not implemented yet");(0,X().HB)(d.type)}function Ei(e){const{onSelect:t,textValue:n,shouldAcceptText:a,clientSkill:i,originRect:s,onDismiss:o,hidePopup:r=!1}=e,l=(0,j().uB)(void 0,wi().$),{sections:c,itemsAvailable:d}=function(e){const{clientSkill:t,shouldAcceptText:n,onSelect:a,textValue:i}=e,s=(0,Q().tz)(),o=(0,j().K8)((()=>{const e=(0,Ue().a)();return(0,ti().Nh)(null==e?void 0:e.id)?void 0:e}),[]),{items:r,isLoading:l}=Si({query:i,currentPageStore:o,onSelectPage:a}),c=(0,v.useMemo)((()=>{const e=[...r];return e.length>0&&i&&G().q4_(i).length>0&&n&&e.push({key:"freeform_activate",action:()=>a(i),render:e=>(0,fe.jsx)(bi,{...e,svg:t.icon,title:`${s.formatMessage(t.displayName)} ${G().q4_(i)}`})}),e.length>0?[{key:"local",items:e,render:e=>(0,fe.jsx)($n().A,{right:l?(0,fe.jsx)(Ga().k,{}):void 0,...e})}]:[]}),[r,i,n,a,t.icon,t.displayName,s,l]);return{sections:c,itemsAvailable:r.length>0}}({clientSkill:i,shouldAcceptText:a,onSelect:t,textValue:n});return(0,v.useEffect)((()=>{Mi().A.setState({available:d})}),[d]),r?null:(0,fe.jsx)(_i,{open:d,onDismiss:o,originRect:s,children:(0,fe.jsx)(qn().A,{type:qn().O.Vertical,disableKeyboard:!1,store:l,sections:c,initialFocus:C().A.isMobile?void 0:0,resetInitialFocusOnSectionChangeAlways:!0})})}function Ri(e){const{onSelect:t,textValue:n,shouldAcceptText:a,clientSkill:i,onDismiss:s,originRect:o,hidePopup:r=!1}=e,l=(0,j().uB)(void 0,wi().$),{sections:c,itemsAvailable:d}=xi({clientSkill:i,shouldAcceptText:a,onSelect:t,textValue:n});return(0,v.useEffect)((()=>{Mi().A.setState({available:d})}),[d]),r?null:(0,fe.jsx)(_i,{open:d,onDismiss:s,originRect:o,children:(0,fe.jsx)(qn().A,{type:qn().O.Vertical,disableKeyboard:!1,store:l,sections:c,initialFocus:C().A.isMobile?void 0:0,resetInitialFocusOnSectionChangeAlways:!0})})}function Bi(e){const{list:t,onSelectItem:n,textValue:a,originRect:i,onDismiss:s,hidePopup:o=!1}=e,r=(0,j().uB)(void 0,wi().$),l=function(e){const{items:t,onSelect:n,textValue:a}=e,i=(0,Q().tz)(),s=(0,v.useMemo)((()=>t.map((e=>({...e,name:i.formatMessage(e.name)})))),[i,t]),o=(0,v.useMemo)((()=>{const e=G().q4_(a),t=(0,Za().Ay)(e,s,(e=>e.name)).map((e=>({key:e.key,action:()=>n(e.key),render:t=>(0,fe.jsx)(ei().A,{...t,title:e.name})}))),o=t.length>0;return[{key:"items",items:t,render:e=>(0,fe.jsx)($n().A,{title:o?void 0:i.formatMessage(mi.noItemsAvailable),...e})}]}),[i,s,n,a]);return o}({items:t,onSelect:n,textValue:a});return o?null:(0,fe.jsx)(_i,{open:!0,onDismiss:s,originRect:i,children:(0,fe.jsx)(qn().A,{type:qn().O.Vertical,disableKeyboard:!1,store:r,sections:l,initialFocus:C().A.isMobile?void 0:0,resetInitialFocusOnSectionChangeAlways:!0})})}function Fi(e){const{currentSkill:t,store:n,requestedSkill:a,originStyle:i,setRequestedSkill:s,onSubmit:o,activateSkill:r,onFocus:c,onBlur:d,...u}=e,p=(0,T().v3)(),[g,m]=(0,v.useState)(!0),h=(0,v.useRef)(null),f=(0,v.useCallback)((e=>{r(e),s(void 0),vi({environment:p,store:n})}),[r,p,s,n]),y=(0,v.useCallback)((()=>{"function"==typeof c&&c(),m(!0)}),[c]),S=(0,v.useCallback)((()=>{"function"==typeof d&&d(),m(!1)}),[d]);return(0,fe.jsxs)(fe.Fragment,{children:[a&&(0,l().clientSkillHasFillableParameters)(a)?(0,fe.jsx)(Pi,{clientSkill:a,store:n,onActivateSkill:f,originElement:h.current??void 0,onDismiss:()=>s(void 0),inputHasFocus:g}):null,(0,fe.jsx)("div",{ref:h,style:i,children:(0,fe.jsx)(Ni,{onFocus:y,onBlur:S,currentSkill:t,requestedSkill:a,setRequestedSkill:s,store:n,onActivateSkill:f,onSubmit:e=>{null==o||o(e),s(void 0)},...u})})]})}function Ni(e){const{currentSkill:t,setRequestedSkill:n,requestedSkill:a,store:i,onBackspaceOnEmptyInput:s,onClickInputBox:o,...r}=e,l=(0,T().v3)(),c=(0,v.useCallback)((()=>{vi({environment:l,store:i}),n(void 0),t&&(0,W().LP)(t.clientSkill.skillType)&&g().default.endCurrentSession()}),[t,l,n,i]),d={typeaheadSkillElement:a?(0,fe.jsx)(Li,{requestedSkill:a,onSkillClear:c}):null,onBackspaceOnEmptyInput:s,store:i,requestedSkill:a,onSkillClear:c,...r};return(0,fe.jsx)(Ka().U,{...d})}function Li(e){const{requestedSkill:t,onSkillClear:n}=e,[a,i]=(0,v.useState)(!1),s=(0,Ua()._)(t.category),o=(0,M().eP)(),r=(0,M().IS)((()=>({typeaheadStyles:{display:"flex",background:s.color(o).background,backgroundBlendMode:"multiply",borderRadius:100,paddingInlineStart:a?"3px":"6px",paddingInlineEnd:10,gap:2,maxHeight:C().A.isMobile?28:25,maxWidth:34,fontSize:12,marginBottom:void 0},iconStyles:{height:14,width:17,fill:s.color(o).color},closeIconStyles:{borderRadius:"100px",padding:"3px",fill:"rgba(145, 145, 142, 1)"},hoveredStyles:{background:s.color(o).background}})),[s,a,o]);return(0,fe.jsx)(Ha().Ay,{singleLineTitle:!0,title:"",style:r.typeaheadStyles,hoveredStyle:r.hoveredStyles,icon:()=>(0,fe.jsx)("div",{style:{padding:2.5},children:a?(0,fe.jsx)(F().Ay,{onClick:n,style:{borderRadius:"100px"},children:(0,fe.jsx)(Wt().I,{icon:Wa().xMarkFillIcon,style:r.closeIconStyles})}):t.icon(r.iconStyles)}),onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),onClick:n,variant:"tinted",disabled:!1})}const Oi=710,Vi=390,zi={not_so_chonky:70,chonky:88,extra_chonky:124};function Wi(e){const{heightVariant:t,...n}=e,a=(0,Fe().jw)(),i=zi[t],s=(0,X().O9)(n.requestedSkill),o=(0,v.useMemo)((()=>({isYassified:!0,isMultilineOverride:!s,containerDivOverrideStyles:{...e.containerDivOverrideStyles,flex:"0 1 auto",height:"auto",width:"100%"},inputContainerOverrideStyles:{paddingInlineStart:16,...e.inputContainerOverrideStyles,minHeight:s?void 0:i},textContainerWrapperOverrideStyles:{...e.textContainerWrapperOverrideStyles,alignItems:"flex-start",justifyContent:"start",minHeight:s||"extra_chonky"!==t?void 0:84},textContainerOverrideStyles:{...e.textContainerOverrideStyles,alignSelf:"flex-start",paddingTop:"extra_chonky"===t?8:4,paddingBottom:s?void 0:12,fontSize:a.isType("corner")?14:16}})),[a,i,t,s,e.inputContainerOverrideStyles,e.textContainerWrapperOverrideStyles,e.textContainerOverrideStyles,e.containerDivOverrideStyles]);return n.withTypeahead?(0,fe.jsx)(Fi,{...n,...o,originStyle:{width:"100%"}}):(0,fe.jsx)(Ka().U,{...n,...o})}var Ui=()=>n(771828),Hi=()=>n(379018),Ki=()=>n(396896),qi=()=>n(406533);function $i({}){const e=(0,T().v3)(),t=(0,Fe().jw)(),n=(0,j().K8)((()=>"ready"!==va().zz.state.type?[]:va().zz.state.questions),[]),a=(0,j().K8)((()=>t.type),[t.type]),i=(0,v.useCallback)((async t=>{await(0,d().handleSubmitNewQuestion)({newValue:[[t]],environment:e,currentClientSkillWithSettings:void 0,source:"abandoned_search_suggested_question",assistantSurfaceType:a}),va().zz.setState({type:"idle"})}),[a,e]),s=(0,M().IS)((()=>({container:{marginBottom:2},headerMessage:{fontSize:14,marginBottom:8}})),[]);return(0,fe.jsxs)("div",{style:s.container,children:[(0,fe.jsx)("div",{style:s.headerMessage,children:(0,fe.jsx)(Q().sA,{id:"assistant.failedSearchQnaReminder",defaultMessage:"Couldnt find something? Try asking me"})}),(0,fe.jsx)(Ki().VP,{gap:8,children:n.map((e=>(0,fe.jsx)(Ha().Ay,{title:e,icon:qi().questionMarkCircleIcon,onClick:()=>i(e),variant:"tinted"},e)))})]})}var Gi=()=>n(661077),Yi=()=>n(770636),Qi=()=>n(514624),Ji=()=>n(401535),Xi=()=>n(709380),Zi=()=>n(412412),es=()=>n(449268),ts=()=>n(17849);function ns(e){const{sessionContext:t}=e,n=(0,T().v3)(),i=(0,j().K8)((()=>{var e;return(null===(e=ts().c.state)||void 0===e?void 0:e.name)||""}),[]),s=(0,Fe().jw)(),{sampledSteps:o,previewingStep:r}=(0,j().K8)((()=>({sampledSteps:t.sampledStepsFromStoreState,previewingStep:t.previewingStepFromStoreState})),[t]),l=(0,v.useCallback)((async()=>{await a().commitPreviewAssistantStep({environment:n,sessionId:t.sessionIdFromStoreState,updater:t.createUpdater(),assistantSurfaceType:s.type})}),[s.type,n,t]),c=(0,v.useCallback)((async e=>{if(!e.inferenceId)throw new Error("No inference ID");await a().simulateOrCommitStep({environment:n,step:e,commit:!1,isStreaming:!1,sessionId:t.sessionIdFromStoreState,inferenceId:e.inferenceId,inferencingError:void 0,updater:t.createUpdater()})}),[n,t]),d=(0,v.useCallback)((async()=>{await a().sampleNextAssistantSteps({environment:n,sessionId:t.sessionIdFromStoreState,inferenceId:xt().JW(),updater:t.createUpdater(),assistantSurfaceType:s.type})}),[s.type,n,t]),u=(0,M().IS)((()=>({wrap:{display:"flex",alignItems:"center",gap:4,marginTop:8},tooltipInner:{width:400,whiteSpace:"pre-wrap"}})),[]),p=(0,v.useCallback)((e=>{const t=(0,Zi().BD)(e.value).map((e=>(0,Zi()._o)(e,!0))).join("\n").trim();return(0,fe.jsx)("div",{style:u.tooltipInner,children:t})}),[u.tooltipInner]),g=!i;return(0,fe.jsxs)("div",{style:u.wrap,children:[o.map(((e,t)=>(0,fe.jsx)(z().m,{renderTooltip:()=>p(e),placement:"top",alignment:"center",render:n=>(0,fe.jsx)(ce().A,{size:"lg",focused:r===e,onClick:()=>c(e),...n,children:t+1})},t))),(0,fe.jsx)("div",{style:{flexGrow:1}}),(0,fe.jsx)(ce().A,{size:"lg",onClick:d,iconLeading:es().C}),(0,fe.jsx)(z().m,{renderTooltip:()=>"Please fill task type to commit.",placement:"top",alignment:"center",disableTooltip:!g,render:e=>(0,fe.jsx)(ce().A,{size:"lg",colorPalette:"blue",onClick:l,disabled:g,...e,children:"Commit"})})]})}function as(e){const{sessionContext:t}=e,n=(0,j().K8)((()=>((null==t?void 0:t.sampledStepsFromStoreState.length)||0)>1),[t]);return(0,fe.jsx)(fe.Fragment,{children:n&&t?(0,fe.jsx)(ns,{sessionContext:t}):void 0})}var is=()=>n(488781),ss=()=>n(792057),os=()=>n(825237),rs=()=>n(864896),ls=()=>n(600881);const cs="first-step-with-skill",ds="last-chat-turn",us=(0,Q().YK)({shareTooltip:{id:"assistant.shareTooltip",defaultMessage:"Share"},elementNotFound:{id:"assistant.share.error.elementNotFound",defaultMessage:"Failed to find chat elements to share."},imageConversionError:{id:"assistant.share.error.imageConversionError",defaultMessage:"Failed to convert chat to image."}});function ps(e){const{chatStep:t}=e,n=(0,T().v3)(),a=(0,Q().tz)(),i=(0,M().eP)(),s=(0,j().K8)((()=>g().default.getActiveSessionId()),[]),r=(0,Fe().jw)(),l=(0,j().K8)((()=>{var e;return null===(e=g().default.getActiveSession())||void 0===e?void 0:e.selectedSkillFromStoreState}),[]),c=(0,j().K8)((()=>{var e;return(null===(e=g().default.getActiveSession())||void 0===e?void 0:e.getCombinedSteps())??[]}),[]),d=(0,j().K8)((()=>{const e=c.at(0);return l&&e&&"human"!==e.type?cs:ds}),[l,c]),u=v.useCallback((async()=>{const e=await async function(e){const{elementId:t,intl:n,currentUserId:a,themeMode:i}=e,s=await async function(e){const{elementId:t,currentUserId:n,themeMode:a}=e,i=document.getElementById(t);if(!i)return{error:"element_not_found"};let s,o;if("light"===a)s=de().A.images.assistantSourceNotFoundLightPng;else{if("dark"!==a)return(0,X().HB)(a);s=de().A.images.assistantSourceNotFoundDarkPng}try{o=await(0,is().$E)(i,{imagePlaceholder:s,filter:e=>{if(e instanceof HTMLImageElement){const t=e.src,a=(0,os().x8)({url:t,width:e.width,fullyQualified:!1,baseUrl:C().A.domainBaseUrl,userId:n});e.src=a}return!0}})}catch{return{error:"image_conversion_error"}}if(!o)return{error:"image_conversion_error"};return{value:o}}({elementId:t,currentUserId:a,themeMode:i});if(s.error){let e;if("element_not_found"===s.error)e=n.formatMessage(us.elementNotFound);else{if("image_conversion_error"!==s.error)return(0,X().HB)(s.error);e=n.formatMessage(us.imageConversionError)}return void ss().f1(e)}return s.value}({elementId:d,intl:a,currentUserId:n.currentUser.id,themeMode:i});e&&((0,ls().L_)({clientStep:t,imageSrc:e}),(0,o().trackAssistantFollowUpShareButtonClick)({environment:n,sessionId:s,assistantSurfaceType:r.type}))}),[t,n,s,r.type,d,a,i]),p=(0,M().IS)((()=>({shareButton:{height:32,width:32,borderRadius:"100%"},iconColor:{fill:J().Tj.icon.primary,height:Fn().Ev.default,width:Fn().Ev.default}})),[]);return(0,fe.jsx)(Ha().Ay,{style:{padding:0},disabled:!0,variant:"tinted",title:(0,fe.jsx)(z().m,{renderTooltip:()=>(0,fe.jsx)(Q().sA,{defaultMessage:"Share",id:"assistant.share"}),render:e=>(0,fe.jsx)(Bt().A,{...e,icon:rs().Y,style:p.shareButton,iconStyle:p.iconColor,onClick:u,ariaLabel:a.formatMessage(us.shareTooltip)})})})}var gs=()=>n(604018),ms=()=>n(390109),hs=()=>n(103975);function fs(){const e=(0,j().K8)((()=>g().default.getActiveSession()),[]),t=(0,Qi().T)(e),n=(0,j().K8)((()=>Boolean(null==e?void 0:e.getHasCommittedHumanStep())),[e]);return(0,j().K8)((()=>{const{selectedSkillFromStoreState:a,selectedSuggestionGroupFromStoreState:i}=e??{};return!(t||n||a||i)}),[e,t,n])?(0,fe.jsx)(vs,{}):null}function ys(){const e=(0,Q().tz)(),t=(0,j().K8)((()=>{var t;return null===(t=I().default.state.currentUserStore)||void 0===t?void 0:t.getDisplayName(e)}),[e]),n=(0,M().IS)((()=>({container:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:20}})),[]),{value:a}=(0,P().fJ)(bt().fM);if(!a)return null;const{motion:i}=a;return(0,fe.jsxs)("div",{style:n.container,children:[(0,fe.jsx)(i.div,{variants:bs,style:{marginBottom:4,padding:"4px 8px",transformOrigin:"center left"},initial:"hidden",animate:"visible",exit:"exit",transition:xs,children:(0,fe.jsx)(hs().M,{variant:"large",includeBoxShadow:!0})}),(0,fe.jsx)(V().D,{colorVariant:"primary",styleKey:"titleLgBold",children:e.formatMessage(Ss.assistantChatText,{firstName:t})})]})}function vs(){const{renderAsFullPage:e}=(0,Fe().jw)(),t=(0,T().v3)(),n=(0,Q().tz)(),a=(0,j().O$)(I().AppStoreMainEditorCurrentBlockStore),i=(0,j().K8)((()=>(0,mt().fM)(t)),[t]),s=(0,j().K8)((()=>{var e;return null===(e=I().default.state.currentUserStore)||void 0===e?void 0:e.getDisplayName(n)}),[n]),o=(0,j().K8)((()=>null==i?void 0:i.getName()),[i]),r=(0,j().K8)((()=>h().zD.isXMLAssistantEnabled()),[]),l=(0,j().K8)((()=>h().zD.isAiEnabled()),[]),c=(0,j().K8)((()=>h().zD.isLimitedQnaMode()),[]),d=(0,ms().Cp)({hovered:!1,isAssistantChat:!0}),u=(0,gs().bp)(),p=(0,M().IS)((()=>({message:{...d.baseMessage,...d.assistantMessage,marginBottom:0,padding:"0 8px",marginInlineStart:0,marginTop:8},messageWithBadge:{display:"flex",alignItems:"center",gap:8,...d.baseMessage,...d.assistantMessage,marginBottom:0,padding:"0 8px",marginInlineStart:0,marginTop:8}})),[d.assistantMessage,d.baseMessage]),{value:g}=(0,P().fJ)(bt().fM);if(!g)return null;const{motion:m}=g;if(!i||!o||!e&&!a||!s)return null;const f=n.formatMessage(Vl.assistantChatText,{firstName:s,workspaceName:o});return(0,fe.jsxs)("div",{style:{marginBottom:8},children:[l?(0,fe.jsx)(m.div,{variants:bs,style:{marginBottom:4,padding:e&&!C().A.isMobile?"16vh 8px 8px 8px":"4px 8px",transformOrigin:"center left"},initial:"hidden",animate:"visible",exit:"exit",transition:xs,children:(0,fe.jsx)(hs().M,{variant:e&&!C().A.isMobile?"large":"medium",includeBoxShadow:!0})}):void 0,(0,fe.jsxs)(m.div,{style:{...p.messageWithBadge,marginTop:12},initial:"hidden",animate:"visible",exit:"exit",transition:xs,children:[(0,fe.jsx)("span",{children:f}),(0,fe.jsx)(le().E,{color:"blue",content:n.formatMessage(Ss.finishSetUp)})]}),r||c?void 0:(0,fe.jsx)("p",{style:p.message,children:n.formatMessage(Vl.assistantBetaDisclaimerText)}),u?(0,fe.jsx)("p",{style:p.message,children:n.formatMessage(Vl.assistantBetaCurrentlyIndexingWorkspaceDisclaimerText)}):void 0]})}const Ss=(0,Q().YK)({assistantChatText:{id:"assistantChat.simpleWelcomeMessage.text",defaultMessage:"How can I help you today?"},finishSetUp:{id:"assistantChat.finishSetUp",defaultMessage:"Finish set up"}}),bs={hidden:{opacity:0,scale:.8,y:20},visible:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.6,y:0}},xs={opacity:{duration:.6,ease:"linear"},scale:{type:"spring",stiffness:220,damping:20,mass:1},y:{type:"spring",stiffness:220,damping:20,mass:1}};var Is=()=>n(757695),ks=()=>n(457726),ws=()=>n(680325),Cs=()=>n(605804),As=()=>n(143016),Ts=()=>n(533927),js=()=>n(820559);var Ms=()=>n(899483);function _s(e){const{parentStore:t,searchResultsSteps:n,queryDatabaseSteps:a,...i}=e,s=(0,j().K8)((()=>{var e;return null===(e=g().default.getActiveSession())||void 0===e?void 0:e.evaluatorFromStoreState.state}),[]),{displayableCitations:o,databaseCitations:r}=(0,j().K8)((()=>{var e;const i=null===(e=(0,Ue().a)())||void 0===e?void 0:e.id;return(0,ws().Gv)({searchResultsSteps:n,queryDatabaseSteps:a,clientStep:void 0,parentStore:t,evaluatorState:s,currentPageId:i})}),[t,s,n,a]);return(0,fe.jsx)(Ms().Mo,{displayableCitations:o,databaseCitations:r,...i})}function Ps(e){const{chatStep:t,parentStore:n,searchResultsSteps:a,queryDatabaseSteps:i,...s}=e,o=(0,j().K8)((()=>{var e;return null===(e=g().default.getActiveSession())||void 0===e?void 0:e.evaluatorFromStoreState.state}),[]),{displayableCitations:r,databaseCitations:l,numberOfCitedResults:c}=(0,j().K8)((()=>{var e;const s=null===(e=(0,Ue().a)())||void 0===e?void 0:e.id;return(0,ws().Gv)({searchResultsSteps:a,queryDatabaseSteps:i,clientStep:t,parentStore:n,evaluatorState:o,currentPageId:s})}),[t,n,o,a,i]),d=(0,Fe().jw)(),u=(0,j().K8)((()=>{const e=g().default.getActiveAssistantConfigurationState();return Boolean(e&&(0,sa().pV)({assistantSurface:d,configurationState:e}))}),[d]),p=0===r.length&&0===l.length,m=0===c,{uncited:h}=t,f=(0,fe.jsx)(Ms().Ml,{inferenceId:t.inferenceId});return(p||m)&&!u&&h?(0,fe.jsx)(Ms().OB,{citationElement:f,shouldSlideUp:!1}):(0,fe.jsx)(Ms().Mo,{displayableCitations:r,databaseCitations:l,...s})}function Ds(e){const{chatTurn:t,isLastChatTurn:n,isOnlyChatTurn:a,hoverStore:i,parentStore:s,expandedStore:o,toggledStore:r,loadingState:l,chatWrapperRef:c}=e,d=(0,j().K8)((()=>{var e;return(null===(e=g().default.getActiveSession())||void 0===e?void 0:e.isStreaming())??!1}),[]),u=(0,Fe().jw)().isQuickSearchMode,p=n?l??(d?{isStreaming:!0}:void 0):void 0,m=function(){const e=(0,j().K8)((()=>{var e;return(null===(e=g().default.getActiveSession())||void 0===e?void 0:e.isStreaming())??!1}),[]),t=(0,j().K8)((()=>{var e;return((null===(e=g().default.getActiveSession())||void 0===e?void 0:e.getPreviewingStepErrorObservations())??[]).length>0}),[]);return Boolean(t&&!e)}(),{chatStep:h,searchResultsSteps:f,queryDatabaseSteps:y}=(0,v.useMemo)((()=>({chatStep:kt().Uk(t,ks().ON),searchResultsSteps:t.filter(ks().uy),queryDatabaseSteps:t.filter(ks().h2)})),[t]),S=(0,j().K8)((()=>{var e;return null===(e=js().A.state)||void 0===e?void 0:e.showSearchDebugPanel}),[]),b={hoverStore:i,parentStore:s,expandedStore:o,canExpand:!0,toggledStore:r,loadingState:p,isOnlyChatTurn:a,inferenceIdOfChatStep:null==h?void 0:h.inferenceId};return m&&n?null:(0,fe.jsxs)(fe.Fragment,{children:[(0,X().O9)(h)?(0,fe.jsx)(Ps,{...b,chatStep:h,searchResultsSteps:f,queryDatabaseSteps:y}):(0,fe.jsx)(_s,{...b,searchResultsSteps:f,queryDatabaseSteps:y}),u?void 0:(0,fe.jsx)(Ms().cE,{containerRef:c,hoverStore:i,parentStore:s}),S?(0,fe.jsx)(Ms().G3,{containerRef:c,hoverStore:i,parentStore:s}):void 0]})}function Es(e){const{steps:t,...n}=e,a=(0,Cs().dF)(t);return(0,fe.jsx)(fe.Fragment,{children:a.map(((e,t)=>(0,fe.jsx)(Rs,{...n,chatTurn:e,isLastChatTurn:t===a.length-1,isFirstChatTurn:0===t,isOnlyChatTurn:1===a.length},t)))})}function Rs(e){const{currentSpaceStore:t,chatTurn:n,mockTextStore:a,loadingState:i,disabled:s,isLastChatTurn:o,isOnlyChatTurn:r}=e,l=(0,j().K8)((()=>g().default.getActiveAssistantConfigurationState()),[]),c=(0,Fe().jw)(),d=(0,j().K8)((()=>{var e;return null===(e=g().default.getActiveSession())||void 0===e?void 0:e.isStreaming()}),[]),u=(0,v.useMemo)((()=>Is().Store.createValue(!0)),[]),p=(0,v.useMemo)((()=>Is().Store.createValue(!1)),[]),m=n.find(ks().ON),{pageCitations:h,universalCitations:f,databaseCitations:y}=(0,j().K8)((()=>m?(0,ws().Q_)({clientStep:m,citationOrdering:void 0,parentStore:t}):{pageCitations:[],universalCitations:[],databaseCitations:[]}),[t,m]),S=(0,j().uB)(void 0,As().D),b=(0,j().K8)((()=>Boolean(l&&(0,sa().pV)({configurationState:l,assistantSurface:c}))),[l,c]);(0,v.useEffect)((()=>{(!o||!r&&b||!d&&(0,X().O9)(m)&&(0===h.length&&0===f.length||y.length>0)&&!b)&&u.setState(!1)}),[u,d,m,h,f,o,b,y,r]),(0,v.useEffect)((()=>{o&&i&&!b&&(p.setState(!1),u.setState(!0))}),[p,u,i,o,b,r]);const x=(0,v.useMemo)((()=>n.find(ks().ON)??n.at(-1)),[n]),I=(0,v.useRef)(null),k={chatTurn:n,isLastChatTurn:o,isOnlyChatTurn:r,hoverStore:S,parentStore:t,expandedStore:p,toggledStore:u,loadingState:i,chatWrapperRef:I},w={parentStore:t,parentSpaceId:null==t?void 0:t.id,latestStepCitationHoverStore:S,mockTextStore:a,disabled:s,shouldAssistantChatStepBeShimmering:r&&d&&b};return(0,fe.jsx)(fe.Fragment,{children:(0,fe.jsx)("div",{...o&&{id:ds},children:n.map(((e,t)=>{const n=e===x;return(0,fe.jsxs)("div",{children:[n&&b?(0,fe.jsx)(Ds,{...k}):void 0,n&&"assistantShowSearchResults"===e.type&&b&&r?(0,fe.jsx)("div",{style:{marginBottom:ms().ZQ},children:(0,fe.jsx)(Ts().wY,{})}):null,(0,fe.jsx)(Ts().x7,{clientStep:e,wrapperRef:n?I:void 0,...w}),n&&!b?(0,fe.jsx)(Ds,{...k}):void 0]},`${(null==l?void 0:l.sessionId)??""}-${t}`)}))})})}var Bs=()=>n(613601);const Fs=(0,Q().YK)({assistantErrorText:{id:"assistantChat.errorMessage",defaultMessage:"Im sorry, Im having trouble completing this request. Please click {tryAgainIcon} try again or type a new command."}});function Ns(){const e=(0,Q().tz)(),t=(0,j().K8)((()=>{const e=g().default.getActiveAssistantConfigurationState();return Boolean((null==e?void 0:e.sampling)||(null==e?void 0:e.evaluating))}),[]),n=(0,M().eP)(),a=(0,M().IS)((()=>({error:{fontSize:C().A.isMobile?16:14,color:"light"===n?J().Tj.palette.gray[600]:J().Tj.palette.translucentGray[700],fontWeight:500,padding:"2px 6px",marginInlineStart:-4,lineHeight:1.45},tryAgainIconWrapper:{display:"inline-flex",marginInlineEnd:2,alignItems:"center",verticalAlign:"middle",marginTop:-1}})),[n]),i=(0,j().K8)((()=>{var n;if(t)return;const i=null===(n=g().default.getActiveSession())||void 0===n?void 0:n.getPreviewingStepErrorObservations();return i&&i.length>0?e.formatMessage(Fs.assistantErrorText,{tryAgainIcon:(0,fe.jsx)("div",{style:a.tryAgainIconWrapper,children:(0,fe.jsx)(Wt().I,{icon:Bs().arrowUTurnUpLeftSmallIcon,size:"xs"})})}):void 0}),[e,t,a]);return i?(0,fe.jsx)("div",{style:a.error,children:i}):null}var Ls=()=>n(135168),Os=()=>n(933922),Vs=()=>n(231940),zs=()=>n(31511),Ws=()=>n(925193),Us=()=>n(132855),Hs=()=>n(454503),Ks=()=>n(29037),qs=()=>n(536583),$s=()=>n(35588),Gs=()=>n(109089),Ys=()=>n(105819),Qs=()=>n(134589),Js=()=>n(745875),Xs=()=>n(973647),Zs=()=>n(843014),eo=()=>n(71304),to=()=>n(466088),no=()=>n(860921),ao=()=>n(206051),io=()=>n(85207),so=()=>n(795901),oo=()=>n(918678),ro=()=>n(108181),lo=()=>n(168029),co=()=>n(162437),uo=()=>n(42452),po=()=>n(762771),go=()=>n(96563),mo=()=>n(663929);const ho=2,fo=(0,Q().YK)({connectApps:{id:"assistant.ConnectApps",defaultMessage:"Connect apps"}});function yo(e){const{chatStep:t,isDeepFindUxActive:n}=e,a=(0,T().v3)(),i=(0,Fe().jw)(),s=(0,x().r)(),o=(0,Xe()._)({name:"ai_connectors",spaceId:s,userId:a.currentUser.id}),r=(0,j().K8)((()=>g().default.getActiveSessionId()),[]),l=(0,j().K8)(gs().Nr,[]),c=v.useCallback((()=>{o&&(0,go().pp)({environment:a,connector:"generic",analyticsFrom:"ai_corner_chat_connectors_button",connectorsFeatureAvailability:o})}),[a,o]),d=!C().A.isMobile&&t.uncited&&l.length>0&&!n;if((0,wn().w)((()=>{d&&(0,S().u)({environment:a,event:{eventName:"assistant_show_connect_apps",eventProperties:{source:"follow_up_action",session_id:r,assistant_surface_type:i.type}}})})),!d||!l.length)return null;const u=(0,fe.jsx)("div",{style:{display:"flex",marginInlineEnd:4},children:(0,fe.jsx)(mo().hC,{connectors:l,maxBubbles:ho,iconSize:14})});return(0,fe.jsx)(Ha().Ay,{icon:u,onClick:c,title:(0,fe.jsx)(Q().sA,{...fo.connectApps}),variant:"tinted"})}var vo=()=>n(339780),So=()=>n(510818),bo=()=>n(148024),xo=()=>n(994877),Io=()=>n(876098),ko=()=>n(576727),wo=()=>n(732797);function Co(e){const{isEmptyState:t}=e,{isQuickSearchMode:n}=(0,Fe().jw)(),a=(0,j().K8)((()=>Ge().default.state.open),[]),{shouldShow:i,openSupportOneClick:s,aiDetectedSupportQuery:o}=(0,j().K8)((()=>{const e=g().default.getActiveSession();return t?{shouldShow:!n&&!a&&!C().A.isMobile,aiDetectedSupportQuery:!1,openSupportOneClick:!1}:{shouldShow:(null==e?void 0:e.showGetSupportPillFromStoreState)??!1,aiDetectedSupportQuery:!0,openSupportOneClick:(0,Io().Q)()&&ko().default.state.isZendeskEnabled}}),[a,n,t]);return i?(0,fe.jsx)(Ao,{openSupportOneClick:s,aiDetectedSupportQuery:o}):null}function Ao(e){const{openSupportOneClick:t,aiDetectedSupportQuery:n}=e,a=(0,T().v3)(),{isMobileNative:i}=(0,T().Y0)(),s=(0,j().K8)((()=>{var e;const t=null===(e=g().default.getActiveSession())||void 0===e?void 0:e.getCombinedSteps().reverse().find(ks().Hr),n=(0,se().S)();if(n)return(0,So().rf)({value:null==t?void 0:t.text,loadRecordModel:n.loadRecordModel})}),[]),l=(0,M().IS)((()=>({wrap:{display:"flex",gap:6}})),[]),c=(0,v.useCallback)((async()=>{const e=g().default.getActiveAssistantConfigurationState();if(e&&(bo().VX(a,{qnaSessionId:e.sessionId,from:"qna_modal_chat"}),n&&(0,o().trackAiDetectedGetSupportPillClick)(a,{sessionId:e.sessionId})),t)if(p().O.setState({...p().O.state,currentState:"default"}),r().closeAssistantRightHandSideMenu({environment:a,withoutDismissCheck:!0}),"undefined"!=typeof Forethought)Forethought("widget","clearLocalData"),Forethought("widget","show"),Forethought("widget","open");else{const e=await s;xo().SI({environment:a,from:"ai_assistant_pill",prepopulatedContent:e})}else i?wo().r.setState({...wo().r.state,open:!0,source:"assistantHelpRedirect"}):r().openCornerChatHelp()}),[n,a,i,t,s]);return(0,fe.jsx)("div",{style:l.wrap,children:(0,fe.jsx)(Ha().Ay,{icon:qi().questionMarkCircleIcon,onClick:c,title:(0,fe.jsx)(Q().sA,{defaultMessage:"Get Notion support",id:"AssistantChat.routeToNotionHelp"}),variant:"tinted"})})}var To=()=>n(780175),jo=()=>n(302501),Mo=()=>n(358296);function _o(e){const{title:t,assistantMessage:n,children:a}=e,i=(0,T().v3)(),s=(0,j().K8)((()=>(0,mt().fM)(i)),[i]),o=(0,Va().q)(),r=(0,M().IS)((()=>({SuggestionGroup:{width:"100%"},title:{paddingBottom:4,marginBottom:-6,fontSize:o.smallTextSize,fontWeight:500,color:J().Tj.text.secondary,display:"flex",alignItems:"center",justifyContent:"flex-start",gap:6},suggestions:{display:"flex",alignItems:"center",overflowX:"auto",flexDirection:"row",flexWrap:"wrap",whiteSpace:"nowrap",gap:6,rowGap:6,marginBottom:0,...C().A.isMobile&&{overflowX:"scroll",flexWrap:"nowrap",paddingBottom:8,marginBottom:-8,paddingInlineStart:16,paddingInlineEnd:16,marginInlineStart:-16,marginInlineEnd:-16}}})),[o]);return s?(0,fe.jsxs)("div",{style:r.SuggestionGroup,children:[t?(0,fe.jsx)(jo().A,{style:r.title,children:t}):void 0,n?(0,fe.jsx)(Mo().r,{text:n}):void 0,(0,fe.jsx)("div",{style:r.suggestions,children:a})]}):null}const Po=(0,Q().YK)({accept:{id:"assistant.acceptAllButton",defaultMessage:"Accept"},copy:{id:"assistant.copy",defaultMessage:"Copy"},reject:{id:"assistant.undoAllButton",defaultMessage:"Discard"},insert:{id:"assistant.insertButton",defaultMessage:"Insert"},savePage:{id:"assistant.savePage",defaultMessage:"Save page"},savePages:{id:"assistant.savePages",defaultMessage:"Save pages"},insertPage:{id:"assistant.insertPage",defaultMessage:"Insert page"},insertPages:{id:"assistant.insertPages",defaultMessage:"Insert pages"},saveToPrivateTooltip:{id:"assistant.saveToPrivateTooltip",defaultMessage:"Save to your private pages"},saveToDatabaseTooltip:{id:"assistant.saveToDatabaseTooltip",defaultMessage:"Save to {database}"},insertToPageTooltip:{id:"assistant.insertToPageTooltip",defaultMessage:"Insert into this page"},updateQuestion:{id:"assistant.updateQuestion",defaultMessage:"Update your question"},updateQuestionDescription:{id:"assistant.updateQuestion.description",defaultMessage:"Rephrase for better results."},searchAnotherSource:{id:"assistant.searchAnotherSource",defaultMessage:"Find in another source"},searchAnotherSourceDescription:{id:"assistant.searchAnotherSource.description",defaultMessage:"Choose a source for better results."}});function Do(e){const{sessionContext:t,renderState:n,mockTextStore:a}=e,i=n.type,s=(0,T().v3)(),r=(0,Fe().jw)(),{store:l}=(0,ra().AI)({initialValue:void 0,onChange:kt().D_}),c=(0,j().K8)((()=>(t&&(0,sa().pV)({configurationState:t.assistantConfigurationStoreState,assistantSurface:r}))??!1),[t,r]),u=r.renderAsFullPage,p=(0,j().K8)((()=>null==t?void 0:t.latestCommitInferenceIdFromStoreState),[t]),m=(0,j().O$)(Gi().P),f=(0,j().K8)((()=>h().zD.isXMLAssistantEnabled()),[]),y=(0,j().K8)((()=>{const e=ao().default.state.stores.at(0);return e?(0,Vs().N)(e):I().default.state.mainEditorCurrentBlockStore}),[]),S=(0,j().K8)((()=>{if(!y)return!1;if("page"!==y.getType())return!1;if("pages_created"!==n.type)return!1;const{groups:e}=n;return e.every((e=>e.pageId!==y.id))}),[y,n]),b=(0,j().K8)((()=>{var e;const t=null===(e=(0,ti().x$)(I().default.state.sidebarSpaceViewStore))||void 0===e?void 0:e.id,n=I().default.state.mainEditorCurrentBlockStore;return(null==n?void 0:n.id)===t}),[]),x=(0,j().K8)((()=>(0,Ba().lQ)()),[]),k=r.surfaceSupportsShareAnswerAction,w=(0,j().K8)((()=>{var e;return!!t&&(t.clientStepsFromStoreState.length>0&&"human"===(null===(e=t.clientStepsFromStoreState.at(-1))||void 0===e?void 0:e.type))}),[t]),A=(0,j().K8)((()=>null==t?void 0:t.sessionIdFromStoreState),[t]),M=(0,v.useCallback)((async e=>{if(!t||!A)return;t.setNextHumanStepAsRetry(),p&&((0,co().$)({environment:s,inferenceId:p,type:"assistant_retry",sessionId:A}),(0,Js().ox)(.01)&&po().A.update((()=>({open:!0,type:"slackbot_followup_feedback",traceId:p,thumbsUpOrDown:"retry",sessionId:A}))));const n=await(0,uo().E)({environment:s,sessionId:A,assistantSurface:r,searchScope:e});if(Xs().Q.isSuccess(n)){const t=n.value.textValue;if(t&&e)await Ia().default.afterNextFlush(),await(0,d().handleSubmitNewQuestion)({environment:s,currentClientSkillWithSettings:void 0,snapToBottom:()=>{},newValue:t,source:"search_scope_retry",assistantSurfaceType:r.type});else if(t){let e;if(c)e=l;else{if(!a)return;e=a}await Ia().default.afterNextFlush(),Se().createAndCommit({userAction:"AssistantFollowupActionBar.tryAgain",environment:s,canUndo:!0,perform:n=>{Na().R9({environment:s,store:e,value:t,transaction:n})}}),(0,fa().z)({store:e})}}else await uo().t({environment:s,sessionId:A,assistantSurfaceType:r.type});o().trackUserClickedAssistantTryAgain(s,{sessionId:A,assistantSurfaceType:r.type})}),[t,A,p,s,r,c,a,l]),_=(0,j().K8)((()=>{var e;return null===(e=(0,ro().N)())||void 0===e?void 0:e.primaryEditorStore}),[]),P=(0,j().K8)((()=>(0,Ls().f)(_)),[_]),D=(0,j().K8)((()=>null==_?void 0:_.isCollectionView()),[_]),E=(0,j().K8)((()=>(0,to().w)(s)),[s]),R=(0,j().K8)((()=>(null==t?void 0:t.assistantConfigurationStoreState.searchScope)??{type:"everything"}),[t]),B=(0,v.useCallback)((async()=>{const e=g().default.getActiveSessionId();if(!e)return;const t=`assistant-insert-into-${(0,Ws().W7)("insert-into-page-")}`;if(!_)return;const n=Se().createAndCommit({userAction:"assistant.insertIntoPage",environment:s,canUndo:!0,undoCheckpoint:t,perform:t=>(0,lo().p)({environment:s,pageStore:_,sessionId:e,transaction:t})}),a=g().default.getSessionContextOrThrow(e);await(0,oo().o)({environment:s,sessionId:e,updater:a.createUpdater(),assistantSurfaceType:r.type}),a.addClientStep({inferenceId:xt().JW(),type:"humanAction",action:"insert",undoCheckpointNames:[t],pageId:_.id,numberOfEdits:n.performResult}),o().trackInsertPill(s,{sessionId:e})}),[r.type,_,s]);return"empty_state"===i||"chat"===i&&void 0===n.chatStep?(0,fe.jsxs)(_o,{children:[(0,fe.jsx)(Co,{isEmptyState:!0}),m&&w?(0,fe.jsx)(Eo,{handleRetry:M}):void 0,(0,fe.jsx)(Lo,{})]}):(0,fe.jsxs)(_o,{children:["accept_edits"===n.type&&p?(0,fe.jsx)(Wo,{renderState:n,inferenceId:p}):void 0,"pages_created"===n.type&&p?(0,fe.jsx)(fe.Fragment,{children:t?(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(Oo,{renderState:n,inferenceId:p,sessionContext:t}),S?(0,fe.jsx)(Vo,{renderState:n,inferenceId:p,sessionContext:t}):void 0,(0,fe.jsx)(Ha().Ay,{icon:qs().d,onClick:()=>{(0,ls().xM)({environment:s,groups:n.groups,spaceStore:P})},title:(0,fe.jsx)(Q().sA,{...Po.copy}),variant:"tinted"})]}):void 0}):void 0,t&&x?(0,fe.jsx)(L().A,{popupType:C().A.isMobile?L().z.SlideUp:L().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"center",originGap:4,renderOrigin:e=>(0,fe.jsx)(Ha().Ay,{icon:$s()._,title:"Give feedback",variant:"tinted",...e}),render:e=>(0,fe.jsx)(zo,{buttonPopupParent:e,sessionContext:t})}):void 0,(0,fe.jsx)(Co,{isEmptyState:!1}),"actioned_edits"===i?null:void 0,"chat"===n.type||"search_result_chat"===n.type?(0,fe.jsxs)(fe.Fragment,{children:[n.chatStep?(0,fe.jsx)(Ha().Ay,{icon:qs().d,onClick:()=>{(0,ls().wj)({environment:s,clientStep:n.chatStep})},title:(0,fe.jsx)(Q().sA,{...Po.copy}),variant:"tinted"}):null,!f||b||u||D||E?null:(0,fe.jsx)(Ha().Ay,{icon:Gs().N,onClick:B,title:(0,fe.jsx)(Q().sA,{...Po.insert}),variant:"tinted"})]}):void 0,"search_result_chat"!==n.type&&"chat"!==n.type||!n.chatStep?void 0:(0,fe.jsx)(yo,{chatStep:n.chatStep,isDeepFindUxActive:c}),"actioned_edits"!==i?E?(0,fe.jsx)(Eo,{handleRetry:M}):!c&&(0,fe.jsx)(No,{handleRetry:M,searchScope:R}):void 0,p?(0,fe.jsx)(Ro,{inferenceId:p,handleRetry:M}):void 0,("search_result_chat"===n.type||"chat"===n.type)&&k&&n.chatStep?(0,fe.jsx)(ps,{chatStep:n.chatStep}):void 0,(0,fe.jsx)(Lo,{})]})}function Eo(e){const{handleRetry:t}=e;return(0,fe.jsx)(Ha().Ay,{icon:Hs().arrowUTurnUpLeftIcon,onClick:()=>{null==t||t()},title:(0,fe.jsx)(Q().sA,{defaultMessage:"Try again",id:"assistant.retryButton"}),variant:"tinted"})}function Ro(e){const{inferenceId:t,handleRetry:n}=e;return(0,j().K8)((()=>{var e,t;const n=Boolean(null===(e=(0,se().S)())||void 0===e?void 0:e.getSettings().enable_ai_training),a=g().default.getActiveSession();return"groupedEditCard"===(null==a||null===(t=a.getCombinedSteps())||void 0===t||null===(t=t.at(-1))||void 0===t?void 0:t.type)||h().zD.isAssistantThumbsUpDownFeedbackBarActionEnabled(n)}),[])?(0,fe.jsx)(Bo,{inferenceId:t,showTryAgain:!1,handleRetry:n}):null}function Bo(e){const{inferenceId:t,showTryAgain:n,handleRetry:a}=e,i=(0,M().IS)((()=>({actionButtonWrapper:{padding:"1px 6px",gap:2},thumbButton:{height:24,width:24,borderRadius:12},iconColor:{fill:J().Tj.icon.primary}})),[]),s=(0,Q().tz)().formatMessage({id:"assistant.retryButton.tooltip",defaultMessage:"Try again"});return(0,fe.jsx)(Ha().Ay,{style:i.actionButtonWrapper,disabled:!0,title:(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(vo().DS,{disableTooltip:!1,inferenceId:t,buttonStyle:i.thumbButton,iconStyle:i.iconColor}),(0,fe.jsx)(vo().gS,{disableTooltip:!1,inferenceId:t,buttonStyle:i.thumbButton,iconStyle:i.iconColor}),n?(0,fe.jsx)(z().m,{renderTooltip:()=>s,render:e=>(0,fe.jsx)(Bt().A,{...e,icon:Hs().arrowUTurnUpLeftIcon,style:i.thumbButton,iconStyle:i.iconColor,onClick:()=>{a()},ariaLabel:s})}):void 0]}),variant:"tinted"})}const Fo={OPEN_OPTIONS:"open_options",OPEN_SCOPE_PICKER:"open_scope_picker",CLOSED:"closed"};function No(e){const{handleRetry:t,searchScope:n}=e,[a,i]=(0,v.useState)(Fo.CLOSED),s=[{key:"update-question",render:e=>(0,fe.jsx)(Kn().A,{...e,shouldWrapCaption:!1,icon:(0,fe.jsx)(Wt().I,{icon:Ys().pencilLineIcon}),title:(0,fe.jsx)(Q().sA,{...Po.updateQuestion}),caption:(0,fe.jsx)(Q().sA,{...Po.updateQuestionDescription}),shouldWrapTitle:!1,dontShrinkTitle:!0}),action:()=>{i(Fo.CLOSED),t()}},{key:"search-another-source",render:e=>(0,fe.jsx)(Kn().A,{...e,shouldWrapCaption:!1,icon:(0,fe.jsx)(Wt().I,{icon:Rn().magnifyingGlassIcon}),title:(0,fe.jsx)(Q().sA,{...Po.searchAnotherSource}),caption:(0,fe.jsx)(Q().sA,{...Po.searchAnotherSourceDescription}),shouldWrapTitle:!1,dontShrinkTitle:!0}),action:()=>{i(Fo.OPEN_SCOPE_PICKER)}}];return(0,fe.jsx)(Ha().BW,{open:a!==Fo.CLOSED,onClick:()=>{i(Fo.OPEN_OPTIONS)},onClose:()=>{i(Fo.CLOSED)},actionIcon:Hs().arrowUTurnUpLeftIcon,buttonTitle:(0,fe.jsx)(Ha().LV,{titleMessage:(0,fe.jsx)(Q().sA,{defaultMessage:"Try again",id:"assistant.retryButton"})}),render:e=>a===Fo.OPEN_SCOPE_PICKER?(0,fe.jsx)(To().Qx,{currentSearchScope:n,onChangeSearchScope:e=>{i(Fo.CLOSED),t(e)},buttonPopupParent:e,analyticsSource:"search_results"}):(0,fe.jsx)(qn().A,{type:qn().O.Vertical,sections:[{key:"all",items:s,render:e=>(0,fe.jsx)($n().A,{...e,topBorder:!1,noTextOverflow:!0,style:{width:"100%"}})}],initialFocus:0})})}function Lo(){const e=(0,T().v3)(),t=(0,Q().tz)(),n=(0,M().IS)((()=>({limitedQnaUpgradeIcon:{fill:J().Tj.palette.uiBlue[600]}})),[]),a=(0,gs().bp)(),i=(0,x().r)(),s=(0,Xe()._)({name:"ai_usage",spaceId:i,userId:e.currentUser.id,amount:"unknown"}),o=(0,j().K8)((()=>!(0,$().e2)(s)&&h().zD.isLimitedQnaMode()&&!a),[s,a]),r=(0,j().K8)((()=>h().zD.isXMLAssistantEnabled()),[]),l=(0,j().K8)((()=>(0,to().w)(e)),[e]),c=(0,no().z)(),d=(0,v.useCallback)((()=>{switch(c){case"unavailable":return;case"requestAccess":case"requestAccessNoFreeCredits":case"upsell":return(0,io().RV)({environment:e,isAssistantEnabled:r,upsellType:c,aiUpsell:null==s?void 0:s.upsell});default:return c}}),[e,r,c,s]);return!o||"unavailable"===c||l?null:(0,fe.jsx)(Ha().Ay,{title:t.formatMessage("upsell"===c?Zs().D.getNotionAI:Ji().DZ.requestAccessButton),onClick:d,external:!0,variant:"tinted",icon:e=>(0,fe.jsx)(Wt().I,{icon:Us().arrowInCircleUpFillIcon,style:{...e,...n.limitedQnaUpgradeIcon}})},"limitedQnaUpsellButton")}function Oo(e){const{renderState:{groups:t},inferenceId:n,sessionContext:a}=e,i=(0,T().v3)(),r=(0,Fe().jw)(),l=(0,Q().tz)(),c=(0,Ct().e)({inferenceId:n,operationIds:t.flatMap((e=>e.operationIds))}),d=(0,v.useCallback)((e=>{const n=g().default.getActiveSession();n&&((0,s().openMoveToMenuAndAcceptPagesCreated)({environment:i,groups:t,sessionContext:n,originRectForMenu:e.currentTarget.getBoundingClientRect(),assistantSurfaceType:r.type}),o().trackSavePagePill(i,{sessionId:n.sessionIdFromStoreState}))}),[i,t,r.type]),u=t.length>1?l.formatMessage(Po.savePages):l.formatMessage(Po.savePage),p=(0,j().K8)((()=>{const e=t.map((e=>a.getCollectionTargetForPendingPage({environment:i,pageId:e.pageId})));return e.every((e=>!(0,X().O9)(e)))?l.formatMessage(Po.saveToPrivateTooltip):e.every(X().O9)&&e.length>0&&e.slice(1).every((t=>t.id===e[0].id))?l.formatMessage(Po.saveToDatabaseTooltip,{database:(0,eo().Qe)(e[0],l,i,!0)}):void 0}),[i,t,l,a]);return(0,fe.jsx)(z().m,{disableTooltip:!(0,X().O9)(p),renderTooltip:()=>p,render:e=>(0,fe.jsx)(Ha().Es,{title:u,icon:Qs().R,onDropdownClick:d,onClick:c,variant:"tinted",tooltipEvents:e})})}function Vo(e){const{renderState:{groups:t}}=e,n=(0,T().v3)(),a=(0,Q().tz)(),i=(0,Fe().jw)(),r=(0,j().K8)((()=>{const e=ao().default.state.stores.at(0);return e?(0,Vs().N)(e):I().default.state.mainEditorCurrentBlockStore}),[]),l=t.length>1?a.formatMessage(Po.insertPages):a.formatMessage(Po.insertPage),c=(0,j().K8)((()=>{if(!r)return;return"page"===r.getType()?a.formatMessage(Po.insertToPageTooltip):void 0}),[r,a]),d=(0,v.useCallback)((async()=>{const e=g().default.getActiveSession();e&&r&&(await(0,s().acceptPagesCreatedInCurrentBlockStore)({environment:n,groups:t,sessionContext:e,assistantSurfaceType:i.type}),o().trackSavePagePill(n,{sessionId:e.sessionIdFromStoreState}))}),[r,n,t,i.type]);return(0,fe.jsx)(z().m,{disableTooltip:!(0,X().O9)(c),renderTooltip:()=>c,render:e=>(0,fe.jsx)(Ha().Ay,{title:l,icon:Gs().N,onClick:d,variant:"tinted",tooltipEvents:e})})}function zo(e){const{buttonPopupParent:t,sessionContext:n}=e,a=(0,Fe().jw)(),i=(0,M().IS)((()=>({wrap:{display:"flex",margin:8,gap:8,width:400}})),[]),[s,o]=(0,v.useState)(""),r=(0,T().v3)(),l=(0,j().K8)((()=>n.sessionIdFromStoreState),[n]),c=(0,v.useCallback)((async()=>{t.close(),await(0,so().f)({environment:r,sessionId:l,feedback:s,assistantSurfaceType:a.type})}),[t,r,l,s,a.type]);return(0,fe.jsx)(Os().A,{capture:!0,render:e=>(0,fe.jsxs)("div",{style:i.wrap,...e,children:[(0,fe.jsx)(zs().A,{value:s,onChange:e=>o(e.target.value),placeholder:"Write your feedback here",textarea:!0,focus:!0,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),e.stopPropagation(),c())}}),(0,fe.jsx)(ce().A,{size:"lg",disabled:0===s.length,colorPalette:"blue",onClick:c,children:"Submit"})]})})}function Wo(e){const{renderState:t,inferenceId:n}=e,a=(0,T().v3)(),i=(0,Fe().jw)(),r=(0,Ct().e)({inferenceId:n,operationIds:t.operationIds}),l=(0,v.useCallback)((async()=>{const e=g().default.getActiveSession();e&&(await(0,s().rejectEdits)({environment:a,inferenceId:n,sessionContext:e,assistantSurfaceType:i.type}),o().trackDiscardAllPill(a,{sessionId:e.sessionIdFromStoreState,from:i.type,inferenceId:n}))}),[i,a,n]);return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(Ha().Ay,{icon:Ks().checkmarkIcon,onClick:r,title:(0,fe.jsx)(Q().sA,{...Po.accept}),variant:"tinted"}),(0,fe.jsx)(Ha().Ay,{icon:Lt().xMarkIcon,onClick:l,title:(0,fe.jsx)(Q().sA,{...Po.reject}),variant:"tinted"})]})}function Uo(e){const{sessionContext:t}=e,n=(0,j().K8)((()=>function(e){return!!Gi().P.state&&((!e||!function(e){const t=e.assistantConfigurationStoreState;return t.sampling||t.evaluating||e.isCurrentlyCommittingHumanStepFromStoreState}(e))&&((!e||!function(e){const t=e.selectedSuggestionGroupFromStoreState,n=void 0!==t,a=e.getHasCommittedHumanStep();return n&&!a}(e))&&(!e||!function(e){const t=e.selectedSkillFromStoreState,n=void 0!==(null==t?void 0:t.clientSkill.assistantMessage),a=e.getHasCommittedHumanStep();return n&&!a}(e))))}(t)),[t]);return n?(0,fe.jsx)(Do,{...e}):null}var Ho=()=>n(869190),Ko=()=>n(604995),qo=()=>n(416504);function $o(){const e=(0,Q().tz)(),t=(0,j().K8)((()=>{const e=g().default.getActiveSession();return!!e&&(e.clientStepsFromStoreState.length>0||(0,X().O9)(e.selectedSkillFromStoreState))}),[]),n=(0,j().K8)((()=>{var e;return null===(e=g().default.getActiveAssistantConfigurationState())||void 0===e?void 0:e.chatStartTimestamp}),[]),a=(0,v.useMemo)((()=>{if(!n)return;const t=(0,Ko().vF)({date:n,timezone:(0,qo().P)()});return[(0,Ho().Yq)({allowRelativeDates:!0,date:t,dateFormat:"relative",intl:e,shortenDate:!1}),t.toFormat("h:mm a")].join(" ")}),[n,e]),i=(0,M().IS)((()=>({date:{fontSize:12,color:J().Tj.text.tertiary},dateContainer:{display:"flex",justifyContent:"center",marginTop:6,marginBottom:6}})),[]);return a&&t?(0,fe.jsx)("div",{style:i.dateContainer,children:(0,fe.jsx)("div",{style:i.date,children:a})}):null}var Go=()=>n(606712),Yo=()=>n(404931),Qo=()=>n(62900),Jo=()=>n(644161);function Xo(e){const t=(0,Q().tz)(),{currentSkill:n,isUniformTitleVariant:a}=e,i=(0,j().O$)(I().AppStoreMainEditorCurrentBlockStore),s=(0,T().v3)(),o=(0,j().K8)((()=>(0,mt().fM)(s)),[s]),r=i||o,c=(0,M().IS)((()=>({parameterTitle:{display:"inline",...!a&&{color:J().Tj.text.secondary,fontWeight:Z().Wy.medium},textOverflow:"ellipsis"}})),[a]);return(0,j().K8)((()=>{if(!n||!r)return;const{displayName:e,suggestedDisplayName:a}=n.clientSkill;if(a)return(0,fe.jsx)(Q().sA,{...a,values:{light:e=>(0,fe.jsx)("span",{style:c.parameterTitle,children:e})}});if((0,l().clientSkillWithParameterValuesIsFillable)(n)){const a=(0,W().Yx)({skillType:n.clientSkill.skillType,parameterValues:n.parameterValues});if("blockOrText"===a.type||"block"===a.type||"textValue"===a.type){const n=a.value;if(Array.isArray(n))return(0,fe.jsx)(Q().sA,{id:"assistant.parameters.pill.textValue",defaultMessage:"{displayName}{nbspThisIsASpacePleaseIgnore}{topic}{nbspThisIsASpacePleaseIgnore}",values:{topic:(0,fe.jsx)("span",{style:c.parameterTitle,children:n}),displayName:t.formatMessage(e),nbspThisIsASpacePleaseIgnore:(0,fe.jsx)("span",{children:""})}});{const a=qa().B.createChildStore(r,{table:Ja().ev,id:n.id,spaceId:n.spaceId});return(0,fe.jsx)(Q().sA,{id:"assistant.parameters.pill.block",defaultMessage:"{displayName}{nbspThisIsASpacePleaseIgnore}{page}{nbspThisIsASpacePleaseIgnore}",values:{page:(0,fe.jsx)(di().A,{store:a,style:c.parameterTitle}),displayName:t.formatMessage(e),nbspThisIsASpacePleaseIgnore:(0,fe.jsx)("span",{children:""})}})}}if("collection"===a.type){const n=a.value,i=$a().m.createChildStore(r,{table:Xa().Vl,id:n.id,spaceId:n.spaceId});return(0,fe.jsx)(Q().sA,{id:"assistant.parameters.pill.collection",defaultMessage:"{displayName}{nbspThisIsASpacePleaseIgnore}{collection}{nbspThisIsASpacePleaseIgnore}",values:{collection:(0,fe.jsx)(di().A,{store:i,style:c.parameterTitle}),displayName:t.formatMessage(e),nbspThisIsASpacePleaseIgnore:(0,fe.jsx)("span",{children:""})}})}if("language"===a.type){var i;const n=a.value,s=null===(i=(0,W().f3)(n))||void 0===i?void 0:i.name;return s?(0,fe.jsx)(Q().sA,{id:"assistant.parameters.pill.language",defaultMessage:"{displayName}{nbspThisIsASpacePleaseIgnore}{language}{nbspThisIsASpacePleaseIgnore}",values:{language:t.formatMessage(s),displayName:t.formatMessage(e),nbspThisIsASpacePleaseIgnore:(0,fe.jsx)("span",{children:""})}}):(0,fe.jsx)(Q().sA,{...e})}if("fullPageTranslationLanguage"===a.type){const n=a.value,i=(0,Jo().Bj)(n);return i?(0,fe.jsx)(Q().sA,{id:"assistant.parameters.pill.language",defaultMessage:"{displayName}{nbspThisIsASpacePleaseIgnore}{language}{nbspThisIsASpacePleaseIgnore}",values:{language:t.formatMessage(i),displayName:t.formatMessage(e),nbspThisIsASpacePleaseIgnore:(0,fe.jsx)("span",{children:""})}}):(0,fe.jsx)(Q().sA,{...e})}if("tone"===a.type){var s;const n=a.value,i=null===(s=(0,W().H8)(n))||void 0===s?void 0:s.name;return i?(0,fe.jsx)(Q().sA,{id:"assistant.parameters.pill.tone",defaultMessage:"{displayName}{nbspThisIsASpacePleaseIgnore}{tone}{nbspThisIsASpacePleaseIgnore}",values:{tone:t.formatMessage(i),displayName:t.formatMessage(e),nbspThisIsASpacePleaseIgnore:(0,fe.jsx)("span",{children:""})}}):(0,fe.jsx)(Q().sA,{...e})}(0,X().HB)(a)}return(0,fe.jsx)(Q().sA,{...e})}),[n,t,r,c.parameterTitle])}function Zo(e){const{setRequestedSkill:t}=e,n=(0,j().K8)((()=>{var e;return null===(e=g().default.getActiveSession())||void 0===e?void 0:e.selectedSkillFromStoreState}),[]);return n&&n.clientSkill?(0,fe.jsx)(er,{currentSkillWithParameters:n,clientSkill:n.clientSkill,setRequestedSkill:t}):null}function er(e){const{setRequestedSkill:t,currentSkillWithParameters:n,clientSkill:a}=e,i=(0,Q().tz)(),s=(0,ms().Cp)({isAssistantChat:!1}),o=(0,Yo().dc)(a.skillType),r=(0,Ua()._)(a.category),l=(0,j().K8)((()=>{const e=g().default.getActiveSession();return!(!e||!o)&&(o.requiresInput?e.getHasCommittedHumanStep():e.getCombinedSteps().length>0)}),[o]),c=Xo({currentSkill:n}),d=(0,Va().q)(),u=(0,M().eP)(),p=(0,M().IS)((()=>({actionButtonWrapper:{display:"flex",flexDirection:"row",justifyContent:"flex-end"},actionIcon:{fill:r?r.color(u).color:void 0},backIcon:{background:J().Tj.background.secondaryTranslucent,fill:J().Tj.icon.primary,width:d.actionButtonHeight,height:d.actionButtonHeight,borderRadius:"100%",marginInlineEnd:6},hoveredBackIcon:{background:(0,Go().R)({color:J().Tj.background.secondaryTranslucent,mode:u})},pressedBackIcon:{background:(0,Go().y)({color:J().Tj.background.secondaryTranslucent,mode:u})}})),[r,d,u]),m=a.assistantMessage?i.formatMessage(a.assistantMessage):void 0,{icon:h}=a,f=i.formatMessage({id:"assistant.removeSelectedAction",defaultMessage:"Back to all actions"});return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsxs)("div",{style:p.actionButtonWrapper,children:[l?void 0:(0,fe.jsx)(z().m,{renderTooltip:()=>f,render:e=>(0,fe.jsx)(Bt().A,{...e,icon:Qo().arrowStraightLeftSmallIcon,style:p.backIcon,hoveredStyle:p.hoveredBackIcon,pressedStyle:p.pressedBackIcon,onClick:()=>{null==t||t(void 0),g().default.endCurrentSession()},ariaLabel:f})}),(0,fe.jsx)(Ha().Ay,{singleLineTitle:!0,title:c,style:{maxWidth:`calc(100% - ${s.humanMessage.marginInlineStart+s.wrap.gap}px)`,alignSelf:"flex-end"},icon:h,iconStyle:p.actionIcon,variant:"tinted",disabled:!0})]}),m?(0,fe.jsx)(Mo().r,{text:m}):void 0,"create_quiz"===a.skillType?(0,fe.jsx)("div",{style:{height:10}}):void 0]})}function tr(e){const{currentSpaceStore:t,mockTextStore:n,requestedSkill:a,setRequestedSkill:i}=e,s=(0,j().K8)((()=>g().default.getActiveSession()),[]),o=(0,j().K8)((()=>null==s?void 0:s.sessionIdFromStoreState),[s]),r=(0,j().O$)(Gi().P),l=(0,j().K8)((()=>h().zD.isXMLAssistantEnabled()),[]),c=(0,Yi().H)({sessionContext:s,currentSpaceStore:t}),d=(0,j().K8)((()=>(null==s?void 0:s.getCombinedSteps())??[]),[s]),u=(0,j().K8)((()=>(0,Ba().cJ)()),[]),p=(0,Qi().T)(s),m=(0,v.useCallback)((e=>{if(u)return!0;switch(e.type){case"human":case"assistantChat":case"assistantChatText":case"assistantSearch":case"assistantShowSearchResults":case"queryDatabase":case"assistantScopeChange":return!0;case"humanAction":case"groupedEditCard":case"assistantTransaction":case"assistantNoOperationsFromReplace":case"clientAssistantHumanAttachmentUpload":return l;case"assistantLimitReached":case"assistantLoadDatabase":case"assistantLoading":case"assistantLoadPage":case"assistantQueryingDatabase":case"assistantRetry":case"assistantSearchDatabases":case"assistantSearchPeople":case"assistantSelectEntity":case"assistantStartResearchMode":return!1;default:(0,X().HB)(e)}}),[u,l]),f=(0,Fe().jw)(),y=(0,j().K8)((()=>Boolean(s&&(0,sa().pV)({configurationState:s.assistantConfigurationStoreState,assistantSurface:f}))),[s,f]),S=(0,v.useMemo)((()=>{const e=d.filter(m);if(y){const t=e.findIndex((e=>"human"===e.type));return-1!==t?e.slice(t+1):e}return e}),[d,y,m]),b=(0,M().IS)((()=>({chatTurnsContainer:{display:"flex",flexDirection:"column",gap:12}})),[]);return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(fs,{}),y?void 0:(0,fe.jsx)($o,{}),(0,fe.jsxs)("div",{id:cs,style:b.chatTurnsContainer,children:[(0,fe.jsx)(Zo,{setRequestedSkill:i}),(0,fe.jsx)(Es,{...e,steps:S,loadingState:p})]}),(0,fe.jsx)(Xi().R,{loadingState:p,handleShowSearchResults:!1}),r?(0,fe.jsx)(Ns,{}):(0,fe.jsx)(Ji().EC,{sessionId:o,displayAsChatStep:!0,requestedSkill:a,chatStepProps:{parentStore:t,parentSpaceId:t.id}}),(0,fe.jsx)(Uo,{renderState:c,sessionContext:s,mockTextStore:n}),(0,fe.jsx)(as,{sessionContext:s})]})}var nr=()=>n(767499),ar=()=>n(425940),ir=()=>n(575157),sr=()=>n(37719),or=()=>n(877235),rr=()=>n(783793),lr=()=>n(624652),cr=()=>n(515692),dr=()=>n(356983),ur=()=>n(152870);const pr=(0,Q().YK)({createProjectKickoffPage:{defaultMessage:"Create a page for a project kickoff",id:"AssistantFullPageWelcome.createProjectKickoffPage"},analyzePdfsOrImages:{defaultMessage:"Analyze PDFs or images",id:"AssistantFullPageWelcome.analyzePdfsOrImages"},brainstormRecipeIdeas:{defaultMessage:"Brainstorm a list of recipe ideas",id:"AssistantFullPageWelcome.brainstormRecipeIdeas"},summarizeThisPage:{defaultMessage:"Summarize this page",id:"AssistantFullPageWelcome.summarizeThisPage"},findActionItems:{defaultMessage:"Find action items",id:"AssistantFullPageWelcome.findActionItems"},translateThisPage:{defaultMessage:"Translate this page",id:"AssistantFullPageWelcome.translateThisPage"},createRecurringStatusUpdate:{defaultMessage:"Create a recurring status update",id:"AssistantFullPageWelcome.createRecurringStatusUpdate"}});function gr(e){const t=(0,x().r)();return t?(0,fe.jsx)(mr,{...e,currentSpaceId:t}):null}function mr(e){const{richTextInputProps:t,isConnectorInfoLoading:n,currentSpaceId:a}=e,{onSubmit:i}=t,s=(0,Q().tz)(),o=(0,M().IS)((()=>({container:{display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"center",padding:16},faceAndIconsWrapper:{display:"flex",flexDirection:"column",justifyContent:"flex-end",paddingTop:"min(40px, max(0px, calc(61vh - 400px)))",paddingBottom:16,gap:12},actionSection:{height:140,width:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",marginBottom:16},actionSectionItem:{width:"100%",padding:"4px 0"}})),[]),r=(0,v.useCallback)(((e,t)=>{null==i||i({newValue:[[s.formatMessage(e)]],scopeOverride:t,actionCardIdForLogging:e.id})}),[i,s]),d=function(e){const t=(0,j().K8)((()=>g().default.getActiveSession()),[]),n=(0,Fe().jw)(),a=(0,j().K8)((()=>((null==t?void 0:t.assistantConfigurationStoreState)&&(0,sa().pV)({configurationState:t.assistantConfigurationStoreState,assistantSurface:n}))??!1),[n,t]),i=(0,cr().Kk)({assistantChatRenderState:e.assistantChatRenderState,requestedSkill:e.requestedSkill,isSampling:e.isSampling,emptyStateResultsIsEmpty:e.emptyStateResultsIsEmpty,isDeepFindActive:a,isDeepFindFollowupInput:e.isDeepFindFollowupInput??!1}),{canUpload:s}=(0,dr().W)({sessionContext:t,mode:i});return s}(t),u=function(e){const{launchMessage:t,isConnectorInfoLoading:n,isShowingAttachmentButton:a,currentSpaceId:i,requestSkill:s}=e,{actionCards:o}=(0,ur().fe)({analyticsFrom:"ai_corner_chat_welcome_connector_action_card",launchMessage:t,isConnectorInfoLoading:n,bubbleStyles:{bubbleSize:18,iconSize:14,marginLeft:-4}}),r=function(e){const{launchMessage:t,requestSkill:n,isShowingAttachmentButton:a,currentSpaceId:i}=e,s=(0,j().K8)((()=>{const e=(0,Ue().a)();if(void 0===e||e.isType("personal_home_page"))return!1;const t=e.getContentStores();return 0!==t.length&&t.some((e=>!e.isEmptyTitle()||e.hasContent()))}),[]),o=(0,j().K8)((()=>{const e=I().default.state.mainEditorCurrentBlockStore,t=null!=e&&e.isType("personal_home_page")?void 0:e;if(!t)return;return(0,c().clientSkillToAssistantSurfaceAction)((0,l().getAllClientSkills)({currentPageRecordPointer:null==t?void 0:t.pointer,currentCollectionRecordPointer:void 0})).filter((e=>{if("translate_page"===e.skillType&&"global"===e.type)return!0})).at(0)}),[]),r=(0,v.useCallback)((e=>{o&&n(o)}),[o,n]),d=(0,lr().U)({currentSpaceId:i}),u=(0,v.useCallback)((async()=>await d({files:void 0,method:"clicked_attachment_button"})),[d]),p=(0,ur().Bt)({iconWidthOverride:Fn().Ev.default,makeBlack:!0});let g;g=s?[{message:pr.summarizeThisPage,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:sr().P,style:p.assistSummarize})},{message:pr.findActionItems,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:ar().a,style:p.assistFindActionItems})},{message:pr.translateThisPage,handleClick:r,iconSection:(0,fe.jsx)(Wt().I,{icon:or().textTranslateIcon,style:p.translate})}]:[{message:pr.createProjectKickoffPage,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:ir().D,style:p.document})},a?{message:pr.analyzePdfsOrImages,handleClick:u,iconSection:(0,fe.jsx)(Wt().I,{icon:nr().B,style:p.arrowPageUp})}:{message:pr.createRecurringStatusUpdate,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:sr().P,style:p.assistSummarize})},{message:pr.brainstormRecipeIdeas,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:Ys().pencilLineIcon,style:p.pencil})}];return g}({launchMessage:t,requestSkill:s,isShowingAttachmentButton:a,currentSpaceId:i}),d=o.at(0),u=d?[d]:[];return(r.length<hr?[...u,...r]:r.length===hr?r:r.slice(0,hr)).map((e=>({key:e.message.id,action:()=>e.handleClick(e.message),render:t=>(0,fe.jsx)(fr,{actionData:e,menuListItemProps:t})})))}({launchMessage:r,isConnectorInfoLoading:n,isShowingAttachmentButton:d,currentSpaceId:a,requestSkill:t.setRequestedSkill}),p=[{key:"corner-chat-actions",items:u,render:e=>(0,fe.jsx)($n().A,{style:o.actionSectionItem,...e})}];return(0,fe.jsx)(Sn().Mx,{type:"chat",children:(0,fe.jsx)(Sn().vV,{children:(0,fe.jsxs)("div",{style:o.container,children:[(0,fe.jsxs)("div",{style:o.faceAndIconsWrapper,children:[(0,fe.jsx)(rr().x,{variant:"large",shadowVariant:"none"}),(0,fe.jsx)(ur().vU,{fontSize:18})]}),(0,fe.jsx)(Hn().A,{menuType:ki().gu.Popup,disableScroller:!0,height:"auto",maxHeight:220,width:"100%",children:(0,fe.jsx)(qn().A,{type:qn().O.Vertical,sections:p,initialFocus:void 0,disableInitialScroll:!0,resetFocusOnMouseOut:!0,style:o.actionSection})}),(0,fe.jsx)(Wi,{...t,withTypeahead:!0,heightVariant:"not_so_chonky"})]})})})}const hr=4;function fr(e){const{actionData:t,menuListItemProps:n}=e,[a,i]=(0,v.useState)(!1),s=(0,M().IS)((()=>({actionItemStyle:{width:"100%",minHeight:"unset",padding:"8px 8px",fontWeight:500,fontSize:13},actionItemButtonStyle:{marginBottom:"1px",marginTop:"1px",borderRadius:"6px",display:"flex",justifyContent:"space-between",height:32},actionItemRightStyles:{marginInlineEnd:8},title:{fontSize:14,fontWeight:400,color:J().Tj.primaryBlack}})),[]);return(0,fe.jsx)(Kn().A,{ref:n.ref,...e,onClick:()=>t.handleClick(t.message),title:(0,fe.jsx)("div",{style:s.title,children:(0,fe.jsx)(Q().sA,{...t.message})}),focused:n.focused,icon:t.iconSection,buttonStyle:s.actionItemButtonStyle,style:s.actionItemStyle,right:a||n.focused?(0,fe.jsx)(Wt().I,{icon:Qa().arrowTurnDownLeftSmallIcon,size:"sm",colorVariant:"tertiary"}):void 0,rightStyle:s.actionItemRightStyles,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1)})}var yr=()=>n(357927),vr=()=>n(29554),Sr=()=>n(806638),br=()=>n(246766),xr=()=>n(404141),Ir=()=>n(820579),kr=()=>n(689825),wr=()=>n(46124),Cr=()=>n(123382),Ar=()=>n(987267);const Tr=(0,Q().YK)({getHelp:{id:"assistantEmptyStateContent.getHelp.label",defaultMessage:"Get Notion support"},browseTemplates:{id:"assistantEmptyStateContent.browseTemplates.label",defaultMessage:"Browse templates"},import:{id:"assistantEmptyStateContent.import.label",defaultMessage:"Import"},askQuestionEarly:{id:"assistantEmptyStateContent.askQuestionEarly2.label",defaultMessage:"Ask {text}"},connectApps:{id:"assistantEmptyStateContent.connectApps.label",defaultMessage:"Connect apps"},watchDemoVideo:{id:"assistantEmptyStateContent.watchDemoVideo.label",defaultMessage:"What can Notion AI do?"}});function jr(e){const{submitText:t,inputText:n,callback:a}=e;return(0,c().arbitraryNotionSkillToAssistantSurfaceAction)({key:"askQuestionEarly",title:{...Tr.askQuestionEarly,values:{text:n}},icon:e=>(0,fe.jsx)(Wt().I,{icon:Rn().magnifyingGlassIcon,style:{...e}}),onClick:()=>{t(),null==a||a()},category:"findSearch",validators:[],boosters:[]})}const Mr="https://www.notion.com/product/ai/use-cases";function _r(e){const{environment:t,assistantSurface:n,sessionId:a,overrides:i}=e,s=(0,Io().Q)()&&ko().default.state.isZendeskEnabled;return function(e){const{onConnectAppsAction:t,onWatchDemoVideoAction:n,onGetHelpAction:a,onBrowseTemplatesAction:i,onImportAction:s,overrides:o}=e,r=(0,gs().Nr)().map((e=>Ar().w0[e])).join(", "),l={...t&&{connectApps:{key:"connectApps",category:"notionActions",title:Tr.connectApps,subtitle:r,icon:wr().L,onClick:t,validators:[c().assistantSurfaceActionValidators.not(c().assistantSurfaceActionValidators.isDeviceMobile),c().assistantSurfaceActionValidators.isMultiplayerSpace,c().assistantSurfaceActionValidators.not(c().assistantSurfaceActionValidators.isCommandSearch)],boosters:[]}},...n&&{watchDemoVideo:{key:"watchDemoVideo",category:"notionActions",title:Tr.watchDemoVideo,icon:kr().U,onClick:n,validators:[c().assistantSurfaceActionValidators.not(c().assistantSurfaceActionValidators.isCommandSearch)],boosters:[]}},...a&&{getHelp:{key:"getHelp",category:"notionActions",title:Tr.getHelp,icon:qi().questionMarkCircleIcon,onClick:a,validators:[c().assistantSurfaceActionValidators.not(c().assistantSurfaceActionValidators.isDeviceMobile),c().assistantSurfaceActionValidators.not(c().assistantSurfaceActionValidators.isCommandSearch)],boosters:[]}},...i&&{browseTemplates:{key:"browseTemplates",category:"notionActions",title:Tr.browseTemplates,icon:yr().templatesIcon,onClick:i,validators:[c().assistantSurfaceActionValidators.not(c().assistantSurfaceActionValidators.isDeviceMobile),c().assistantSurfaceActionValidators.not(c().assistantSurfaceActionValidators.isCommandSearch)],boosters:[c().assistantSurfaceActionValidators.isPageEmpty]}},...s&&{import:{key:"import",category:"notionActions",title:Tr.import,icon:Ir().arrowLineDownIcon,onClick:s,validators:[c().assistantSurfaceActionValidators.not(c().assistantSurfaceActionValidators.isDeviceMobile),c().assistantSurfaceActionValidators.not(c().assistantSurfaceActionValidators.isCommandSearch),c().assistantSurfaceActionValidators.not(c().assistantSurfaceActionValidators.isCornerEntrypoint)],boosters:[c().assistantSurfaceActionValidators.isPageEmpty]}}};return Cr()._h.map((e=>{if((0,X().O)(l,e)){const t=l[e];if(t)return{...t,...null==o?void 0:o[e]}}})).filter(X().O9)}({onConnectAppsAction:()=>{r().handleClickConnectApps({environment:t,sessionId:a,assistantSurfaceType:n.type,source:"empty_state"})},onWatchDemoVideoAction:()=>{(0,br().navigate)({environment:t,url:Mr,openInNew:"tab",makeTabActive:!0})},onGetHelpAction:()=>{s||r().openCornerChatHelp(),r().openNotionSupportChat({environment:t,from:"ai_assistant_empty_state"})},onBrowseTemplatesAction:()=>{(0,Sr().P)({environment:t})},onImportAction:()=>{xr().Ay.setState({...xr().Ay.state,open:!0,currentTab:"imports",highlightedSetting:void 0,defaultSubtab:void 0,openedFrom:"assistant"})},overrides:i})}var Pr=()=>n(154373),Dr=()=>n(310770),Er=()=>n(897526);function Rr(e){const{category:t,...n}=e,a=(0,Q().tz)(),i=(0,Ua()._)(t);return(0,fe.jsx)($n().A,{...n,desktopTitleStyle:{paddingInlineStart:8},mobileTitleStyle:{paddingInlineStart:8},title:a.formatMessage(i.label)})}var Br=()=>n(946560);const Fr=(0,Q().YK)({allSources:{id:"assistantEmptyStateContent.allSources",defaultMessage:"All sources I have access to"},table:{id:"assistantEmptyStateContent.table",defaultMessage:"Table"},flowchart:{id:"assistantEmptyStateContent.flowchart",defaultMessage:"Flowchart"},outline:{id:"assistantEmptyStateContent.outline",defaultMessage:"Outline"},askAbout:{id:"assistantEmptyStateContent.askAbout",defaultMessage:"Ask about"},templateGallery:{id:"assistantEmptyStateContent.templateGallery",defaultMessage:"Template gallery"},draftOutline:{id:"assistantEmptyStateContent.suggestedDisplayName.draftOutline",defaultMessage:"<light>Draft</light> outline"},draftTable:{id:"assistantEmptyStateContent.suggestedDisplayName.draftTable",defaultMessage:"<light>Draft</light> table"},askAboutThisPage:{id:"assistantEmptyStateContent.suggestedDisplayName.askAboutThisPage",defaultMessage:"Ask about <light>this page</light>"},anything:{id:"assistantEmptyStateContent.anything",defaultMessage:"Anything"},draftAnything:{id:"assistantEmptyStateContent.suggestedDisplayName.draftAnything",defaultMessage:"<light>Draft</light> anything"},draftFlowchart:{id:"assistantEmptyStateContent.suggestedDisplayName.draftFlowchart",defaultMessage:"<light>Draft</light> flowchart"}}),Nr={search_qna:{icon:n(922189).personCircleFillIcon,displayName:Fr.allSources},draft_table:{displayName:Fr.table,category:"create",suggestedDisplayName:Fr.draftTable},draft_diagram:{displayName:Fr.flowchart,category:"create",suggestedDisplayName:Fr.draftFlowchart},draft_outline:{icon:n(358359).L,displayName:Fr.outline,suggestedDisplayName:Fr.draftOutline},page_qna:{icon:n(683886).J,category:"thinkAskChat",displayName:Fr.askAbout,suggestedDisplayName:Fr.askAboutThisPage},database_filing:{category:"thinkAskChat"},query_database:{category:"thinkAskChat"},help_me_draft:{displayName:Fr.anything,suggestedDisplayName:Fr.draftAnything}},Lr={browseTemplates:{icon:yr().templatesIcon,title:Fr.templateGallery}};function Or(e){const{store:t,requestedSkill:n,setRequestedSkill:a,setEmptyStateResultsAvailable:i,handleTextSubmit:s,disableKeyboard:o}=e,r=(0,Q().tz)(),c=(0,T().v3)(),d=(0,Fe().jw)(),u=(0,j().uB)(void 0,wi().$),p=(0,j().K8)((()=>(0,mt().fM)(c)),[c]),g=(0,j().K8)((()=>t.getValue()),[t]),m=(0,j().K8)((()=>Vr(g,p)),[g,p]),f=(0,v.useRef)(g),y=(0,v.useRef)(m);void 0===n&&(f.current=g,y.current=m);const b=void 0===n?g:f.current,x=void 0===n?m:y.current,k=(0,Er().Z)({assistantSurface:d}),w=(0,j().K8)((()=>Boolean((0,to().w)(c))),[c]),A=zr(),M=(0,j().K8)((()=>(0,Dr().d7)({assistantSuggestionContext:k,validatedActions:A})),[A,k]);(0,_().A)((()=>{}),!0);const P=(0,j().K8)((()=>(0,Za().Ay)(x,M,(e=>function(e){const{action:t,intl:n}=e;if("clientSkill"===t.actionType)return n.formatMessage(t.displayName);if("arbitrary"===t.actionType){const e=t.subtitle??"";return`${n.formatMessage(t.title)} ${e}`}(0,X().HB)(t)}({intl:r,action:e})),{minScore:.1,getSortScore:({score:e})=>-e,normalizeFuzzyScore:!0})),[x,r,M]),D=(0,v.useMemo)((()=>(0,Za().Ay)(x,A,(e=>r.formatMessage("clientSkill"===e.actionType?e.displayName:e.title)),{minScore:.1,getSortScore:({score:e})=>-e,normalizeFuzzyScore:!0}).filter((e=>!P.some((t=>t.key===e.key))))),[P,x,r,A]),E=function(e){const{suggestedActions:t,allActions:n,onClientSkillSelect:a,onArbitrarySkillSelect:i,inputTextValue:s,handleTextSubmit:o,assistantSuggestionContext:r,disableKeyboard:c,sidebarSpaceStore:d,requestedOnPublicDomain:u}=e,p=(0,Fe().jw)(),g=(0,j().K8)((()=>{if(u)return[];if(!h().zD.sessionStartersEnabledInChat())return[];const e=I().default.state.sidebarSpaceViewStore;if(!e)return[];return(0,Pr().VP)({currentSpaceViewStore:e,fromAssistantSurface:p}).map((e=>{if(!e.isDefined())return;return{id:e.id,actionType:"assistant_session_starter",spaceId:e.getSpaceId(),userId:e.getUserId(),createdTime:e.getCreatedTime(),validators:[],category:"recent",type:"recent",data:e.getData()}})).filter(X().O9)}),[p,u]),m=(0,v.useCallback)(((e,t)=>{if("clientSkill"===e.actionType)return{key:e.key,action:()=>a(e),render:({ref:n,...a},i)=>(0,fe.jsx)(Br().g$,{...a,menuListItemRef:n,assistantSurfaceAction:e,disableKeyboard:c,isSuggestion:t})};if("arbitrary"===e.actionType)return{key:e.key,action:()=>{e.onClick(),i(e.key)},render:({ref:t,...n})=>(0,fe.jsx)(Br().g$,{...n,menuListItemRef:t,assistantSurfaceAction:e,disableKeyboard:c})};if("assistant_session_starter"===e.actionType)throw new Error("These actions do not yet render in empty state.");(0,X().HB)(e)}),[c,a,i]),f=(0,j().K8)((()=>u?[]:s&&(0,G().AhH)(s)>0?[...n,jr({submitText:()=>o(s),inputText:Vr(s,d)})]:n),[u,s,n,d,o]),y=(0,j().K8)((()=>(0,Dr().b$)({assistantSuggestionContext:r})),[r]);return(0,v.useMemo)((()=>{const e=[];if(t.length>0&&e.push({key:"suggestedSkills",items:t.map((e=>m(e,!0))),render:e=>(0,fe.jsx)($n().A,{desktopTitleStyle:{paddingInlineStart:8},mobileTitleStyle:{paddingInlineStart:8},title:(0,fe.jsx)(Q().sA,{...l().skillSectionMessages.suggestedSection}),...e})}),f.length>0){const t=f.reduce(((e,t)=>{var n;return e[t.category]??=[],null===(n=e[t.category])||void 0===n||n.push(m(t)),e}),{}),n=y.map((e=>{const n=t[e];if(n&&n.length>0)return{key:e,items:n,render:t=>(0,fe.jsx)(Rr,{...t,category:e})}})).filter(X().O9);e.push(...n)}return g.length>0&&e.push({key:"recents",items:g.map((e=>({key:e.id,action:()=>{},render:({ref:t,...n})=>(0,fe.jsx)(Br().g$,{...n,menuListItemRef:t,assistantSurfaceAction:e,disableKeyboard:c})}))),render:e=>(0,fe.jsx)($n().A,{desktopTitleStyle:{paddingInlineStart:8},mobileTitleStyle:{paddingInlineStart:8},title:(0,fe.jsx)(Q().sA,{id:"assistantEmptyStateConntent.section.recents",defaultMessage:"Recents"}),...e})}),e}),[t,f,g,m,y,c])}({suggestedActions:P,allActions:D,assistantSuggestionContext:k,onClientSkillSelect:e=>{vi({environment:c,store:t}),a(e),(0,S().u)({environment:c,event:{eventName:"assistant_inline_menu_option_click",eventProperties:{skill_type:e.skillType,from:d.type}}})},onArbitrarySkillSelect:e=>{a(void 0),vi({environment:c,store:t})},inputTextValue:b,handleTextSubmit:s,disableKeyboard:o,sidebarSpaceStore:p,requestedOnPublicDomain:w}),R=0===E.length||0===D.length&&0===P.length;return(0,v.useEffect)((()=>{i(!R)}),[R,i]),(0,fe.jsxs)("div",{style:{width:"calc(100% + 8px)"},children:[(0,fe.jsx)(fs,{}),(0,fe.jsx)(Hn().A,{menuType:ki().gu.Popup,disableScroller:!0,height:"auto",maxHeight:220,children:(0,fe.jsx)(qn().A,{type:qn().O.Vertical,store:u,sections:E,disableKeyboard:R||o,initialFocus:C().A.isMobile||o?void 0:0,disableInitialScroll:!0,resetInitialFocusOnSectionChangeAlways:!0,resetFocusOnMouseOut:!0})})]})}function Vr(e,t){return t?(0,vr().r4)(e,t):(0,G().q4_)(e)}function zr(){const e=function(){const e=(0,T().v3)(),t=(0,j().K8)((()=>(0,Ue().a)()),[]),n=(0,Fe().jw)(),a=(0,j().K8)((()=>g().default.getActiveSessionId()),[]),i=n.canUseUpdatedSkillDisplayFormat;return(0,j().K8)((()=>_r({environment:e,currentPageStore:t,assistantSurface:n,sessionId:a,overrides:i?Lr:{}})),[e,t,n,a,i]).map(c().arbitraryNotionSkillToAssistantSurfaceAction)}(),t=(0,j().K8)((()=>(0,Ue().a)()),[]),n=(0,Fe().jw)(),a=(0,Er().Z)({assistantSurface:n}),i=n.canUseUpdatedSkillDisplayFormat;return(0,j().K8)((()=>{var n;if(null!==(n=g().default.getActiveSession())&&void 0!==n&&null!==(n=n.getStagedAttachmentUploadStoreIfExists())&&void 0!==n&&n.hasTooManyAttachments())return[];const s=null!=t&&t.isType("personal_home_page")?void 0:t;let o;if(null!=t&&t.isCollectionView()){const e=t.getCollectionPointers()??[];o=(0,c().clientSkillToAssistantSurfaceAction)(e.flatMap((e=>(0,l().getAllClientSkills)({currentPageRecordPointer:null==s?void 0:s.pointer,currentCollectionRecordPointer:e,clientSkillOverrides:i?Nr:void 0}))))}else o=(0,c().clientSkillToAssistantSurfaceAction)((0,l().getAllClientSkills)({currentPageRecordPointer:null==s?void 0:s.pointer,currentCollectionRecordPointer:void 0,clientSkillOverrides:i?Nr:void 0}));const r=[...o,...e],d=(0,c().filterAssistantSurfaceActionsForContext)(r,a),u=d.map((e=>"clientSkill"===e.actionType?e.skillType:"arbitrary"===e.actionType?e.key:(0,X().HB)(e))),p=[],m=new Set;for(const e of u){if(m.has(e))continue;const t=d.filter((t=>"clientSkill"===t.actionType?t.skillType===e||t.skillType.startsWith(e):"arbitrary"===t.actionType?t.key===e:(0,X().HB)(t))),n=t.find((e=>{if("clientSkill"===e.actionType)return"with_parameter_values"===e.type})),a=t[0];n?p.push(n):a&&p.push(a),m.add(e)}return p}),[a,t,e,i])}var Wr=()=>n(741615),Ur=()=>n(874832),Hr=()=>n(902006),Kr=()=>n(123411),qr=()=>n(116089),$r=()=>n(469635),Gr=()=>n(421559),Yr=()=>n(795523),Qr=()=>n(12831),Jr=()=>n(560409),Xr=()=>n(763012),Zr=()=>n(273923),el=()=>n(1248),tl=()=>n(620090),nl=()=>n(377134);const al=(0,Q().YK)({draftAPageCard:{defaultMessage:"Draft a page for project planning",id:"AssistantFullPageWelcome.draftAPageCard"},summarizeProjectsCard:{defaultMessage:"Summarize the projects Im currently working on",id:"AssistantFullPageWelcome.summarizeProjectsCard"},createRankingTableCard:{defaultMessage:"Create a simple table ranking top movies",id:"AssistantFullPageWelcome.createRankingTableCard"},suggestReadingListCard:{defaultMessage:"Suggest a reading list of books, docs, or articles",id:"AssistantFullPageWelcome.suggestReadingListCard"},teamTopPriorities:{defaultMessage:"What are the teams top priorities this quarter?",id:"AssistantFullPageWelcome.draftAPageCardBusiness"},createWeeklyUpdatesPage:{defaultMessage:"Create a page for weekly project updates",id:"AssistantFullPageWelcome.createPageForWeeklyUpdates"},synthesizeCustomerFeedback:{defaultMessage:"Synthesize customer feedback from the last 3 months",id:"AssistantFullPageWelcome.synthesizeCustomerFeedback"},trendingTopicsInCompany:{defaultMessage:"What topics are currently trending at the company?",id:"AssistantFullPageWelcome.trendingTopicsInCompany"},planDinnerParty:{defaultMessage:"Draft a page for planning a dinner party",id:"AssistantFullPageWelcome.draftAPageCardPersonal"},outlineFactsAboutMars:{defaultMessage:"Outline lesser known facts about Mars",id:"AssistantFullPageWelcome.outlineFactsAboutMars"},personalityTestsPopular:{defaultMessage:"What are the most popular personality tests?",id:"AssistantFullPageWelcome.personalityTestsPopular"},createStudyPlan:{defaultMessage:"Create a structured study plan",id:"AssistantFullPageWelcome.draftAPageCardEducation"},createCourseScheduleTable:{defaultMessage:"Draft a simple table with my course schedule",id:"AssistantFullPageWelcome.createCourseScheduleTable"},brainstormEssayTopics:{defaultMessage:"Brainstorm interesting topics for essays",id:"AssistantFullPageWelcome.brainstormEssayTopics"},emergingEconomicTrends:{defaultMessage:"Tell me about emerging economic trends",id:"AssistantFullPageWelcome.emergingEconomicTrends"}}),il=168,sl=108,ol=12;function rl(e){const{richTextInputProps:t,isConnectorInfoLoading:n}=e,{onSubmit:a}=t,i=(0,Q().tz)(),s=(0,T().v3)(),o=(0,M().IS)((()=>({container:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",marginBottom:158},cardSection:{height:sl,width:"100%",maxWidth:Oi,minWidth:Vi,justifyContent:"center",alignItems:"center",marginTop:ol},layoutOverrides:{height:"100%",alignItems:"center",justifyContent:"center"}})),[]),r=(0,v.useCallback)(((e,t)=>{null==a||a({newValue:[[i.formatMessage(e)]],scopeOverride:t,actionCardIdForLogging:e.id})}),[a,i]),l=(0,j().uB)(void 0,tl().B),c=(0,j().uB)(void 0,el()._),d=(0,v.useMemo)((()=>({isHoveredOnPanelStore:l,sizeStore:c})),[l,c]),u=(0,v.useCallback)((()=>l.setState(!0)),[l]),p=(0,v.useCallback)((()=>l.setState(!1)),[l]),g=(0,j().K8)((()=>h().zD.isResearchModeWelcomePageAiEnabled()),[]),m=(0,v.useMemo)((()=>g?{inputContainerOverrideStyles:{...t.inputContainerOverrideStyles,paddingInlineStart:8},textContainerWrapperOverrideStyles:{...t.textContainerWrapperOverrideStyles,paddingInlineStart:8},actionsRowOverrideStyles:{...t.actionsRowOverrideStyles,minHeight:32},rightGutterOverrideStyles:{...t.rightGutterOverrideStyles,alignItems:"flex-end"}}:{}),[t,g]),[f,y]=(0,v.useState)("inactive"),S=(0,v.useCallback)((e=>{y((e=>"active"===e?"inactive":"active"))}),[]),b=(0,v.useCallback)((e=>{"active"===f&&e.newValue?Qr().rH({environment:s,query:e.newValue,intl:i}):null==a||a(e)}),[a,f,s,i]),I=function(e){const{launchMessage:t,isConnectorInfoLoading:n}=e,a=function(){const e=(0,x().r)(),t=(0,Wr().lh)({spaceId:e}),n=(0,Yr().AI)(t);if("free"===n||"plus"===n)return"default";if("personal"===n)return"personal";if("business"===n||"enterprise"===n)return"business";if("student"===n)return"education";(0,X().HB)(n)}(),{isConnected:i,actionCards:s}=(0,ur().fe)({analyticsFrom:"ai_corner_chat_welcome_connector_action_card",launchMessage:t,isConnectorInfoLoading:n,bubbleStyles:{bubbleSize:28,iconSize:20,marginLeft:-4}}),o=(0,To().wh)(),r=(0,ur().Bt)({});let l;"default"===a?l=[{message:al.draftAPageCard,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:ir().D,style:r.document})},{message:al.summarizeProjectsCard,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:sr().P,style:r.assistSummarize})},{message:al.createRankingTableCard,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:Gr().T,style:r.collectionTable})}]:"business"===a?l=[{message:al.teamTopPriorities,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:Kr().lightBulbBrightIcon,style:r.assistBrainstormIdeas})},{message:al.createWeeklyUpdatesPage,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:ir().D,style:r.aiFillTemplate})},{message:al.synthesizeCustomerFeedback,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:$r().t,style:r.aiMakeShorter})}]:"personal"===a?l=[{message:al.planDinnerParty,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:Ys().pencilLineIcon,style:r.pencil})},{message:al.outlineFactsAboutMars,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:qi().questionMarkCircleIcon,style:r.aiExplainThis})},{message:al.personalityTestsPopular,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:qr().x,style:r.magicWand})}]:"education"===a?l=[{message:al.createStudyPlan,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:ir().D,style:r.aiFillTemplate})},{message:al.createCourseScheduleTable,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:Gr().T,style:r.collectionTable})},{message:al.brainstormEssayTopics,handleClick:t,iconSection:(0,fe.jsx)(Wt().I,{icon:Kr().lightBulbBrightIcon,style:r.assistBrainstormIdeas})}]:(0,X().HB)(a);if((0,v.useMemo)((()=>{if("everything"===o.type)return!1;let e;return e=(0,Hr().SC)(o.type)?o.type:nl().x[o.type],!e||"notion"===e}),[o.type])){const e={default:{message:al.suggestReadingListCard,iconSection:(0,fe.jsx)(Wt().I,{icon:Kr().lightBulbBrightIcon,style:r.assistBrainstormIdeas})},business:{message:al.trendingTopicsInCompany,iconSection:(0,fe.jsx)(Wt().I,{icon:qi().questionMarkCircleIcon,style:r.aiExplainThis})},personal:{message:al.suggestReadingListCard,iconSection:(0,fe.jsx)(Wt().I,{icon:Kr().lightBulbBrightIcon,style:r.assistBrainstormIdeas})},education:{message:al.emergingEconomicTrends,iconSection:(0,fe.jsx)(Wt().I,{icon:qi().questionMarkCircleIcon,style:r.aiExplainThis})}};return[l[0],l[1],l[2],{handleClick:t,...e[a]}]}return i?[l[0],s[0],l[1],l[2]]:[s[0],l[0],l[1],l[2]]}({launchMessage:r,isConnectorInfoLoading:n});return(0,fe.jsx)(Sn().Mx,{type:"fullscreen-ai",style:o.layoutOverrides,children:(0,fe.jsx)(Sn().vV,{children:(0,fe.jsxs)("div",{style:o.container,children:[(0,fe.jsx)(rr().x,{variant:"large",shadowVariant:"none"}),(0,fe.jsx)("div",{style:{height:26}}),(0,fe.jsx)(ur().vU,{fontSize:30}),(0,fe.jsx)("div",{style:{height:46}}),(0,fe.jsx)(Wi,{...t,...m,withTypeahead:!1,heightVariant:"extra_chonky",showResearchModeButton:g,researchModeButtonState:f,onSubmit:b,onClickResearchModeButton:S}),(0,fe.jsx)("div",{style:o.cardSection,onMouseEnter:u,onMouseLeave:p,children:(0,fe.jsx)(Zr().R.Provider,{value:d,children:(0,fe.jsx)(Xr().A,{cardWidth:il,gapSizeOverride:ol,children:I.map((e=>(0,v.createElement)(ll,{...e,showLoadingShimmer:n,key:e.message.id})))})})})]})})})}function ll(e){const{message:t,iconSection:n,handleClick:a,showLoadingShimmer:i}=e,s=(0,T().v3)();(0,wn().w)((()=>{(0,o().trackFullPageWelcomePromptCardInteraction)({environment:s,interaction:"seen",promptId:t.id})}));const r=(0,v.useCallback)((()=>{(0,o().trackFullPageWelcomePromptCardInteraction)({environment:s,interaction:"clicked",promptId:t.id}),a(t)}),[s,a,t]),l=(0,M().IS)((()=>({container:{width:il,height:sl,display:"flex",flexDirection:"column",background:J().Tj.background.secondaryTranslucent,padding:i?void 0:"8px 12px 8px 12px"},hoveredColorOverride:{background:J().Tj.background.secondaryTranslucent},pressedColorOverride:{background:J().Tj.home.cards.background.pressed},message:{fontSize:"14px",fontWeight:500,flexGrow:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical"},loadingShimmer:{width:"100%",height:"100%"}})),[i]);return(0,fe.jsx)(Jr().A,{style:l.container,hoveredStyle:l.hoveredColorOverride,pressedStyle:l.pressedColorOverride,href:void 0,metaHref:void 0,borderRadiusVariant:"large",onClick:i?void 0:r,children:i?(0,fe.jsx)(Ur().P,{style:l.loadingShimmer}):(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)("div",{style:l.message,children:(0,fe.jsx)(Q().sA,{...t})}),(0,fe.jsx)("div",{children:n})]})})}var cl=()=>n(395361),dl=()=>n(755125),ul=()=>n(239666),pl=()=>n(450648),gl=()=>n(729368),ml=()=>n(366437),hl=()=>n(111043),fl=()=>n(473228),yl=()=>n(10722);function vl(e){const{styles:t,scrollerRef:n,scrollerStore:a,assistantChatRenderState:i,handleOnScroll:s,unsnap:o,scrollerContentRef:r,scrollerContent:l,isLabelerMode:c,sessionContext:u,snapToBottom:p}=e,g=(0,T().v3)(),m=(0,Q().tz)(),h=(0,v.useRef)(null),f=(0,j().K8)((()=>null==u?void 0:u.sessionIdFromStoreState),[u]),y=(0,ra().AI)({initialValue:[]}),S=(0,j().K8)((()=>e.deepFindInput??y),[y,e.deepFindInput]),{firstHumanMessage:b,firstHumanMessageTextValue:x}=(0,j().K8)((()=>{const e=(0,se().S)(),t=null==u?void 0:u.clientStepsFromStoreState.find((e=>"assistantStartResearchMode"===e.type)),n=null==u?void 0:u.clientStepsFromStoreState.find(ks().Hr);let a;return t?a=t.text??(0,G().x9d)(t.message):n&&(a=n.text),a&&e?{firstHumanMessageTextValue:a,firstHumanMessage:(0,pl().r4)({textValue:a,getRecordModel:e.getRecordModel,userTimeZone:(0,qo().P)(),intl:m})??""}:{firstHumanMessage:"",firstHumanMessageTextValue:[]}}),[m,u]),{store:I}=(0,ra().AI)({initialValue:[]}),k=(0,v.useRef)(null),[w,C]=(0,v.useState)(!1),[A,_]=(0,v.useState)(!1),P=(0,j().K8)((()=>void 0!==[...(null==u?void 0:u.clientStepsFromStoreState)??[],...(null==u?void 0:u.temporaryClientStepsFromStoreState)??[]].find(ks().ON)),[u]),D=b.length>30,E=(0,v.useCallback)((async e=>{const{newValue:t}=e;P&&t&&await(0,d().handleSubmitNewQuestion)({environment:g,currentClientSkillWithSettings:void 0,snapToBottom:p,newValue:t,source:"deep_find_followup",assistantSurfaceType:"fullPage"})}),[g,P,p]),R=(0,cl().Y)(C,50),B=(0,j().K8)((()=>{const e=S.store.getValue();return!e||0===(0,G().q4_)(e).trim().length}),[S.store]),F=(0,j().K8)((()=>{const e=S.store.getValue();if(!e)return!1;return(0,G().q4_)(e).trim()===b.trim()}),[S.store,b]),N=(0,v.useCallback)((e=>{!B&&F||S.setValue(x),(0,fl().J)(S.store)&&(0,dl().clear)({environment:g}),_(!1)}),[S,g,x,B,F]),L=(0,v.useCallback)((()=>{A||_(!0)}),[A]);(0,v.useEffect)((()=>{S.setValue(x)}),[S,x]);const O=w||A,V=(0,M().IS)((()=>({text:{width:"100%",transition:"box-shadow .125s ease",padding:4,borderRadius:6,...O&&{boxShadow:"0 0 0 2px #E3E2E080"}},placeholder:{color:J().Tj.pageTitlePlaceholderTextColor}})),[O]);return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(Ea().H,{ref:n,type:wa().A.Y,style:{...t.scroller,paddingBottom:12},onScroll:s,store:a,children:(0,fe.jsx)(Sn().Mx,{ref:r,type:"fullscreen-ai",children:(0,fe.jsxs)(Sn().vV,{children:[(0,fe.jsx)("div",{style:{width:"100%",marginBottom:20,marginTop:0},children:(0,fe.jsx)("div",{style:{width:"100%",margin:"auto",display:"flex",justifyContent:"space-between",gap:6,alignItems:D?"flex-start":"center"},ref:h,children:(0,fe.jsx)("div",{onMouseEnter:()=>R(!0),onMouseLeave:()=>R(!1),style:{width:"100%"},children:(0,fe.jsx)(gl().A,{disabled:!1,onFocus:L,onBlur:N,store:S.store,pasteBehavior:"inline",disableBrowserSpellcheck:!0,disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableMobileActionBar:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,onEnter:()=>{(0,yl().Ki)({environment:g,searchScope:{type:"everything"},searchFilters:ul().NH,assistantSurface:Fe().wy.fullPage,query:S.store.getValue()})},usePopupForMentionOnMobile:!0,placeholder:m.formatMessage({defaultMessage:"Search or ask anything",id:"assistant.deepFind.inputPlaceholder"}),placeholderStyle:V.placeholder,inPageFind:ml().Os.none,style:V.text,className:"tx-uititle-30-semibold",onEsc:N,disableMentions:!0})})})}),c?(0,fe.jsx)(Ui().A,{}):void 0,l]})})}),(0,fe.jsx)(Sn().Mx,{type:"fullscreen-ai",children:(0,fe.jsxs)(Sn().vV,{children:[(0,fe.jsxs)("div",{style:{display:"flex",margin:"auto",marginBottom:16,width:"100%",gap:6},ref:k,children:[(0,fe.jsx)(rr().x,{variant:"medium"}),f?(0,fe.jsx)(Ka().U,{store:I,requestedSkill:void 0,sessionId:f,isDeepFindFollowupInput:!0,onSubmit:E}):void 0]}),"empty_state"!==i.type&&o?(0,fe.jsx)(Sl,{scrollerRef:n,inputContainerRef:k,assistantChatStyles:t}):void 0]})})]})}function Sl(e){const{scrollerRef:t,inputContainerRef:n,assistantChatStyles:a}=e,i=(0,T().v3)(),s=(0,Q().tz)(),{isMobileNative:o}=i.device,[r,l]=(0,v.useState)(null),c=(0,hl().o)(),d=(0,M().eP)(),u=(0,M().IS)((()=>({overscrollIcon:{background:"dark"===d?"rgba(255, 255, 255, 0.05)":"rgba(255, 255, 255, 0.6)",backdropFilter:"blur(8px)",borderRadius:"100%",boxShadow:J().Tj.shadow2XS,width:C().A.isMobile?32:28,height:C().A.isMobile?32:28,marginInlineEnd:3,zIndex:2,position:"absolute",bottom:(r??0)+a.inputWrap.paddingBottom+24+(o?c:0)},hoveredOverscrollIcon:{background:"dark"===d?"rgba(255, 255, 255, 0.15)":"rgba(255, 255, 255, 0.8)"},pressedOverscrollIcon:{background:"dark"===d?"rgba(255, 255, 255, 0.3)":"rgba(255, 255, 255, 0.9)"}})),[o,c,r,a,d]);return(0,v.useEffect)((()=>{let e=null;const t=new ResizeObserver((e=>{const t=e[0];l(t.contentRect.height??null)}));return null!=n&&n.current&&(e=n.current,t.observe(n.current)),()=>{e&&t.unobserve(e)}}),[n]),null===r&&n?null:(0,fe.jsx)("div",{style:{display:"flex",justifyContent:"center",zIndex:2},children:(0,fe.jsx)(Bt().A,{icon:_a().arrowChevronSingleDownFillSmallIcon,style:u.overscrollIcon,hoveredStyle:u.hoveredOverscrollIcon,pressedStyle:u.pressedOverscrollIcon,onClick:()=>{var e;const n=null===(e=t.current)||void 0===e?void 0:e.getNode();n&&n.scrollTo({top:n.scrollHeight})},ariaLabel:s.formatMessage({id:"ChatOverscrollIndicator.scrollToBottom",defaultMessage:"Scroll to bottom"})})})}var bl=()=>n(520937),xl=()=>n(447587);const Il=150,kl=80,wl=12;function Cl(e){const{message:t,onClick:n}=e,a=(0,Q().tz)(),i=(0,M().IS)((()=>({container:{width:Il,height:kl,maxHeight:kl,overflow:"hidden",display:"flex",flexDirection:"column",padding:"12px",gap:5},hoveredColorOverride:{background:J().Tj.background.secondaryTranslucent},pressedColorOverride:{background:J().Tj.home.cards.background.pressed},placeholder:{width:20,height:20}})),[]);return(0,fe.jsxs)(Jr().A,{style:i.container,hoveredStyle:i.hoveredColorOverride,pressedStyle:i.pressedColorOverride,href:void 0,metaHref:void 0,borderRadiusVariant:"small",onClick:n,children:[e.icon?(0,fe.jsx)(Wt().I,{icon:e.icon,size:"sm",style:{color:e.color,fill:e.color}}):(0,fe.jsx)("div",{style:i.placeholder}),(0,fe.jsx)(xl().A,{maxLines:2,children:(0,fe.jsx)(V().D,{colorVariant:"primary",styleKey:"bodySemibold",children:a.formatMessage(t)})})]})}function Al(e){const{store:t,setRequestedSkill:n}=e,a=(0,T().v3)(),i=(0,M().eP)(),s=(0,Fe().jw)(),o=(0,Er().Z)({assistantSurface:s}),r=zr(),l=(0,j().K8)((()=>(0,Dr().d7)({assistantSuggestionContext:o,validatedActions:r})),[r,o]),c=(0,v.useMemo)((()=>l.filter(Tl).map((e=>{const o=(0,bl().vJ)(e.category);return{message:e.displayName,onClick:function(){vi({environment:a,store:t}),n(e),(0,S().u)({environment:a,event:{eventName:"assistant_inline_menu_option_click",eventProperties:{skill_type:e.skillType,from:s.type}}})},icon:e.icon,color:o.color(i).color}}))),[l,t,n,a,s,i]);return(0,fe.jsxs)("div",{style:{width:"calc(100% + 8px)",display:"flex",flexDirection:"column",alignItems:"center",gap:70,marginBottom:15},children:[(0,fe.jsx)(ys,{}),(0,fe.jsx)("div",{style:{width:"100%",WebkitOverflowScrolling:"touch",touchAction:"pan-x",overscrollBehaviorInline:"contain"},children:(0,fe.jsx)(Xr().A,{cardWidth:Il,gapSizeOverride:wl,preventScroll:!1,children:c.map((e=>(0,v.createElement)(Cl,{...e,key:e.message.id})))})})]})}function Tl(e){return"clientSkill"===e.actionType}const jl={isYassified:!0,isMultilineOverride:!0};function Ml(e){const{...t}=e,n=(0,Fe().jw)(),a=(0,X().O9)(t.requestedSkill),i=(0,j().K8)((()=>Ca().A.keyboardHeight()),[]),s=(0,M().eP)(),o=(0,M().IS)((()=>({containerDivOverrideStyles:{flex:"0 1 auto",height:"auto",width:"100%",...e.containerDivOverrideStyles},inputContainerOverrideStyles:{paddingInlineStart:16,paddingInlineEnd:12,borderStartStartRadius:20,borderStartEndRadius:20,borderEndEndRadius:0,borderEndStartRadius:0,boxShadow:"dark"!==s?["0 -4px 12px rgba(0, 0, 0, 0.02)","0 -8px 20px rgba(0, 0, 0, 0.015)","0 -16px 32px rgba(0, 0, 0, 0.01)","0 -24px 48px rgba(0, 0, 0, 0.005)","0 -25px 1px rgba(0, 0, 0, 0.0)"].join(", "):void 0,paddingBottom:i<100?"env(safe-area-inset-bottom)":10,...e.inputContainerOverrideStyles},textContainerWrapperOverrideStyles:{alignItems:"flex-start",justifyContent:"start",minHeight:a?void 0:44,...e.textContainerWrapperOverrideStyles},textContainerOverrideStyles:{alignSelf:"flex-start",paddingTop:8,paddingBottom:a?void 0:12,fontSize:n.isType("corner")?14:16,...e.textContainerOverrideStyles}})),[i,a,e.containerDivOverrideStyles,e.inputContainerOverrideStyles,e.textContainerWrapperOverrideStyles,e.textContainerOverrideStyles,n,s]);return t.withTypeahead?(0,fe.jsx)(Fi,{...jl,...t,...o,originStyle:{width:"100%"}}):(0,fe.jsx)(Ka().U,{...jl,...t,...o})}var _l=()=>n(68169),Pl=()=>n(484127),Dl=()=>n(155792),El=()=>n(83626),Rl=()=>n(600434),Bl=()=>n(717375),Fl=()=>n(594794),Nl=()=>n(147796);function Ll(e){const{threadId:t,assistantTranscript:n,idMapper:a,initialUserMessageText:i}=e,s=(0,T().v3)(),o=(0,Q().tz)(),r=(0,v.useRef)(!1);(0,v.useEffect)((()=>{r.current=!1}),[t]);const l=(0,j().K8)((()=>h().zD.isResearchModeWebSearchEnabled()),[]),c=(0,j().K8)((()=>(0,Qn().N8)()),[]),d=(0,j().O$)(Te().bX),u=(0,j().K8)((()=>(0,Bl().xm)({isResearchModeWebSearchEnabled:l,showSetupGenerator:h().zD.showSetupGenerator()})),[l]),p=(0,v.useMemo)((()=>{const e=u.find((e=>"researcher"===e.type));return e?{...e,useWebSearch:l}:{type:"researcher"}}),[l,u]),g=(0,j().K8)((()=>{if(!d||!a||!n)return[];const e=n.filter((e=>"observation"===e.type&&"search"===e.observationType)),t=[];for(let n=0;n<e.length;n++){const r=e[n],l=(0,Pl().ut)(r,a);if(0===l.length)continue;const c=(0,pl().r4)({textValue:i,getRecordModel:d.spaceStore.getRecordModel,userTimeZone:(0,qo().P)(),intl:o});t.push({id:(0,Fl().Z1)({environment:s,table:Dl().mS,spaceId:d.spaceStore.id}),type:"researcher-agent",value:{key:`unified-find-search-results-${n}`,agent:_l().RD,output:{artifacts:l,containsNonSpaceSharedResults:r.containsNonSpaceSharedResults??!1},timestampStartMs:0,status:"done",input:{key:`unified-find-search-results-${n}`,agent:_l().RD,question:c}}})}return t}),[n,s,a,i,o,d]),m=(0,j().K8)((()=>{if(d&&t)return An().E.createChildStore(d.spaceStore,{table:Nn().To,id:t,spaceId:d.spaceStore.id})}),[t,d]),f=(0,j().K8)((()=>!!m&&(m.isReady()&&!m.isDefined())),[m]);(0,v.useEffect)((()=>{(()=>{if(d&&m&&f&&e.initialUserMessageText&&!r.current){r.current=!0;const n=(0,Te().Kf)({environment:s,userStore:d.userStore,spaceStore:d.spaceStore,value:e.initialUserMessageText}),a=(0,Te().Xd)({environment:s,config:p,addSteps:[...g,n],inferenceContext:d,surface:"full_page_chat"});(0,pt().addTranscriptToNewThreadAndRun)({environment:s,spaceStore:d.spaceStore,transcript:a,threadId:t})}})()}),[t,m,e.initialUserMessageText,s,p,g,f,d]);const y=(0,Rl().K7)("research_mode");return m?(0,fe.jsx)(Nl().ng,{threadId:t,children:(0,fe.jsx)(El().Lm,{aiChatFeatureController:y,clientStore:zn().defaultClientAIChatStore,threadStore:m,config:p,preprocessTranscript:Fa().an,transcriptContainerStyle:{marginBottom:10,paddingInlineStart:0,paddingInlineEnd:0},showDebugOverride:c})}):(0,fe.jsx)("div",{children:"Something went wrong loading the chat store"})}function Ol(e){const{styles:t,scrollerRef:n,scrollerStore:a,assistantChatRenderState:i,threadId:s,handleOnScroll:o,snapToBottom:r,unsnap:l,sessionContext:c,scrollerContentRef:d,scrollerContent:u}=e,p=(0,T().v3)(),g=(0,Q().tz)(),m=(0,v.useRef)(null),f=(0,j().K8)((()=>h().zD.isResearchModeMultiturnEnabled()),[]),y=(0,j().K8)((()=>null==c?void 0:c.sessionIdFromStoreState),[c]),S=(0,j().K8)((()=>{const e=(0,se().S)(),t=null==c?void 0:c.clientStepsFromStoreState.find((e=>"assistantStartResearchMode"===e.type)),n=(null==t?void 0:t.text)??(0,G().x9d)(null==t?void 0:t.message);return n&&e?(0,pl().r4)({textValue:n,getRecordModel:e.getRecordModel,userTimeZone:(0,qo().P)(),intl:g})??"":""}),[g,c]),{store:b}=(0,ra().AI)({initialValue:[]}),x=(0,v.useRef)(null),k=S.length>30,w=(0,j().K8)((()=>{const{sidebarSpaceStore:e}=I().default.state;if(e&&s)return An().E.createChildStore(e,{table:Nn().To,id:s,spaceId:e.id})}),[s]),C=(0,j().K8)((()=>{const{sidebarSpaceStore:e}=I().default.state;if(e)return{table:oi().NX,id:e.id,spaceId:e.id}}),[]),A=zn().defaultClientAIChatStore,M=(0,j().K8)((()=>Boolean(void 0!==(null==w?void 0:w.getCurrentInferenceId())||(null==w?void 0:w.id)&&A.getOrCreateClientAIChatThreadStore(w.id).state.loading)),[w,A]),_=(0,v.useCallback)((e=>{const{newValue:t}=e,{sidebarSpaceStore:n,currentUserStore:a}=I().default.state;if(!(w&&s&&C&&n&&a&&t))return;const i=(0,Te().Kf)({environment:p,spaceStore:n,userStore:a,value:t});(0,pt().addStepsToExistingThreadAndRun)({environment:p,clientStore:A,spaceStore:n,userStore:a,threadStore:w,addSteps:[i],waitForServerCommit:!0,temporaryAiThreadManager:void 0}),null==r||r()}),[p,r,s,w,C,A]);return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(Ea().H,{ref:n,type:wa().A.Y,style:{...t.scroller,paddingBottom:12},onScroll:o,store:a,children:(0,fe.jsx)(Sn().Mx,{ref:d,type:"fullscreen-ai",children:(0,fe.jsxs)(Sn().vV,{children:[(0,fe.jsx)("div",{style:{width:"100%",marginBottom:20,marginTop:0},children:(0,fe.jsx)("div",{style:{width:"100%",margin:"auto",display:"flex",justifyContent:"space-between",gap:6,alignItems:k?"flex-start":"center"},ref:m,children:(0,fe.jsx)("div",{style:{width:"100%"},className:"tx-uititle-30-semibold",children:S})})}),u]})})}),(0,fe.jsx)(Sn().Mx,{type:"fullscreen-ai",children:(0,fe.jsxs)(Sn().vV,{children:[f?(0,fe.jsxs)("div",{style:{display:"flex",margin:"auto",marginBottom:16,width:"100%",gap:6},ref:x,children:[(0,fe.jsx)(rr().x,{variant:"medium"}),y?(0,fe.jsx)(Ka().U,{assistantChatRenderState:i,store:b,requestedSkill:void 0,sessionId:y,isDeepFindFollowupInput:!0,onSubmit:_,isSampling:M}):void 0]}):(0,fe.jsx)("div",{style:{margin:"auto",marginBottom:16,height:0,width:"100%"},ref:x}),"empty_state"!==i.type&&l?(0,fe.jsx)(Sl,{scrollerRef:n,inputContainerRef:x,assistantChatStyles:t}):void 0]})})]})}const Vl=(0,Q().YK)({qnaInputPlaceholder:{id:"assistantChat.qnaInputPlaceholder.text",defaultMessage:"Ask a question"},assistantInputPlaceholder:{id:"assistantChat.assistantShortInputPlaceholder.text",defaultMessage:"Ask AI anything"},qnaAssistantChatText:{id:"assistantChat.qnaWelcomeMessage.text",defaultMessage:"Hi {firstName}! Ask me about anything in {workspaceName}. Ill find an answer in the pages you have access to."},qnaEnhancedAssistantChatText:{id:"assistantChat.qnaEnhancedAssistantChatText.text",defaultMessage:"Hi {firstName}!{br}Q&A combines all of GPT-4s general knowledge with the unique context of your Notion workspace. Ask me about anything!"},assistantChatText:{id:"assistantChat.welcomeMessage.text",defaultMessage:"Hi {firstName}! How can I help you today?"},slackQnaAssistantChatText:{id:"assistantChat.slackQnaWelcomeMessage.textNoName",defaultMessage:"Hi {firstName}! Ask me about anything. Ill find an answer in the public Slack channels of your organization."},assistantBetaDisclaimerText:{id:"assistantChat.qnaWelcomeMessage.disclaimerText",defaultMessage:"Im still in Beta, so please use the   buttons to help me improve."},assistantBetaLimitedQnaDisclaimerText:{id:"assistantChat.qnaWelcomeMessage.limitedQnaDisclaimerText",defaultMessage:"Youre on the free plan, so keep in mind that AI responses can be limited."},assistantBetaCurrentlyIndexingWorkspaceDisclaimerText:{id:"assistantChat.qnaWelcomeMessage.currentlyIndexingWorkspaceText",defaultMessage:"Im still learning about your workspace. This can take up to 24 hours, but feel free to try asking me a question."}});function zl(e){const{onBackspaceOnEmptyInput:t}=e,n=(0,T().v3)(),a=(0,v.useRef)(null),i=(0,v.useRef)(null),r=(0,v.useRef)(null),l=(0,Fe().jw)(),{isMobileNative:c,isTablet:u}=(0,T().Y0)(),[p,m]=(0,v.useState)(),[f,y]=(0,v.useState)(!0),S=(0,j().K8)((()=>g().default.getActiveAssistantConfigurationState()),[]),b=(0,j().K8)((()=>"team"===n.RouterStore.state.route.name),[n]),x=(0,j().O$)(I().AppStoreMainEditorCurrentBlockStore),k=(0,j().K8)((()=>(0,mt().fM)(n)),[n]),w=(0,j().K8)((()=>(0,Ta().Xz)(n.TabbedRouterStore.state)),[n]),[A,_]=(0,v.useState)(!1),P=(0,j().K8)((()=>{var e;return null===(e=g().default.getActiveSession())||void 0===e?void 0:e.selectedSkillFromStoreState}),[]),{store:D}=(0,ra().AI)({initialValue:void 0,onChange:kt().D_}),R=Sa(),[B,F]=(0,v.useState)(!1),N=(0,j().K8)((()=>"empty_state"===R.type&&l.canShowNewFullPageWelcomeState&&h().zD.isNewFullPageWelcomeStateEnabled()),[R,l]),L=(0,j().K8)((()=>"empty_state"===R.type&&h().zD.isNewCornerChatWelcomeStateEnabled(l)),[R,l]),O=(0,j().K8)((()=>"empty_state"===R.type&&!N),[R,N]),V=(0,j().K8)((()=>h().zD.isNewLargerInputActive(l)||u),[l,u]),z=(0,j().K8)((()=>h().zD.isUpdatedMobileAssistantDesignEnabled()&&C().A.isMobile&&!u),[u]),U=(0,j().K8)((()=>Boolean(S&&(0,sa().pV)({assistantSurface:l,configurationState:S}))),[S,l]),H=(0,j().K8)((()=>Boolean(S&&(0,Fa().mG)({configurationState:S}))),[S]),K=C().A.isMobile&&!u||U,q=(0,v.useCallback)((()=>{if(a.current){const e=a.current.getNode();e&&e.scrollTo({top:e.scrollHeight}),_(!1)}}),[_]),$=(0,v.useCallback)((async e=>{await(0,d().handleActivateNewSkill)({clientSkillWithParameterValues:e,environment:n,snapToBottom:q,assistantSurface:l})}),[l,n,q]),Y=(0,v.useCallback)((e=>{e?(0,W().Gt)(e.skillType)&&"global"===e.type?m(e):(m(void 0),$({clientSkill:e,parameterValues:"with_parameter_values"===e.type?e.parameterValues:{}})):m(void 0),Ul(n,c,D)}),[n,$,D,c]),Q=(0,v.useCallback)((async e=>{m(void 0);const{newValue:t,source:a,scopeOverride:i,actionCardIdForLogging:s}=e;if(!t)return;const o=E().default.DO_NOT_USE_markLegacy("assistant.chat_submit_lag");if(E().default.DO_NOT_USE_measureAfterNextFlushLegacy(o,{environment:n}),U){const{sessionId:e}=await(0,Oa().p)({environment:n,deepFindRequested:!0,actionCardIdForLogging:s}),o=g().default.getSessionContext(e);if(!o)return;const r=null==S?void 0:S.searchScope;i?o.assistantConfigurationStore.setSearchScope(i):r&&o.assistantConfigurationStore.setSearchScope(r),await(0,La().b)({environment:n,sessionId:e,text:t,source:a,assistantSurfaceType:l.type})}else await(0,d().handleSubmitNewQuestion)({environment:n,currentClientSkillWithSettings:P,snapToBottom:q,newValue:t,source:a,assistantSurfaceType:l.type,scopeOverride:i,actionCardIdForLogging:s}),Se().createAndCommit({userAction:"AssistantRichTextInput.clear",environment:n,canUndo:!0,perform:e=>{Na().R9({environment:n,store:D,value:void 0,transaction:e})}});K&&(0,da().I)({environment:n})}),[K,n,U,null==S?void 0:S.searchScope,l.type,P,q,D]),ee=(0,v.useCallback)((()=>{const e=a.current;if(!e)return;const t=e.getNode();if(!t)return;const n=(0,ja().W)(t);Math.abs((0,ja().W)(t))<10||c&&(0,X().O9)(n)&&n<0?_(!1):_(!0)}),[_,c,a]);(0,v.useEffect)((()=>{_(!1)}),[N,U,L]);const te=(0,v.useCallback)(((e,t)=>{const i=a.current;if(!i)return;const s=i.getNode();s&&(ee(),C().A.isMobile&&"up"===t&&((0,ja().W)(s)??0)>0&&s.scrollTop<=0&&(0,da().I)({environment:n}))}),[n,ee]);(0,v.useEffect)((()=>{let e=null;const t=new ResizeObserver((e=>{ee()})),n=i.current;return n&&(e=n,t.observe(e)),()=>{e&&t.unobserve(e)}}),[a,ee]);const ne=(0,j().K8)((()=>(0,Ba().cJ)()),[]);(0,v.useEffect)((()=>{if(c){var e,t;Boolean("web"===w.type&&("nativeTab"===w.route.name&&"assistant"===w.route.tab||"nativeTab"===(null===(e=w.redirectedTo)||void 0===e?void 0:e.route.name)&&"assistant"===(null===(t=w.redirectedTo)||void 0===t?void 0:t.route.tab)))?Ul(n,c,D):(0,da().I)({environment:n})}}),[n,w,D,c]),(0,v.useEffect)((()=>{void 0===(null==S?void 0:S.sessionId)&&(vi({environment:n,store:D}),m(void 0))}),[null==S?void 0:S.sessionId,n,D]),(0,v.useEffect)((()=>{if(U)return;const e=setTimeout((()=>Ul(n,c,D)),200);return()=>clearTimeout(e)}),[n,D,U,c]),(0,v.useEffect)((()=>{"empty_state"===R.type&&Ul(n,c,D)}),[n,D,R.type,U,c]);const ae=(0,Ma().ZC)(null==S?void 0:S.sessionId);(0,v.useEffect)((()=>{ae===(null==S?void 0:S.sessionId)||void 0===ae||U||Ul(n,c,D)}),[null==S?void 0:S.sessionId,n,U,D,ae,c]);const{isLoading:ie}=(0,Pa().ts)();(0,za().I)(n,D);const se=(0,j().K8)((()=>{var e;return null===(e=g().default.getActiveSession())||void 0===e?void 0:e.clientStepsFromStoreState}),[]),oe=(0,j().K8)((()=>{var e;return null===(e=g().default.getActiveSession())||void 0===e?void 0:e.temporaryClientStepsFromStoreState}),[]),re=(0,j().K8)((()=>g().default.getActiveSession()),[]),le=(0,j().K8)((()=>null==re?void 0:re.sessionIdFromStoreState),[re]),ce=(0,j().K8)((()=>null==re?void 0:re.latestCommitInferenceIdFromStoreState),[re]),de=(null==S?void 0:S.evaluating)||(null==S?void 0:S.sampling)||(null==S?void 0:S.committing),ue=C().A.isMobile&&z,pe=(0,v.useCallback)((async()=>{re&&ce&&(await(0,s().rejectEdits)({environment:n,inferenceId:ce,sessionContext:re,assistantSurfaceType:l.type}),o().trackDiscardAllPill(n,{sessionId:re.sessionIdFromStoreState,from:l.type,inferenceId:ce}))}),[l.type,n,ce,re]);(0,v.useEffect)((()=>{const e=[...se??[],...oe??[]],t=!U||e.filter((e=>"human"===e.type)).length>1;if(!A&&"empty_state"!==R.type&&t){var n;const e=null===(n=a.current)||void 0===n?void 0:n.getNode();e&&e.scrollTo({top:e.scrollHeight})}}),[se,oe,A,R,U]);const ge=(0,v.useMemo)((()=>null==se?void 0:se.find((e=>"assistantStartResearchMode"===e.type))),[se]),me=(0,j().uB)(void 0,Aa().A),he=function(e){const{unsnap:t,isDeepFindActive:n,isResearchModeActive:a,isLegacyChatEmptyStateActive:i,isUpdatedMobileAssistantDesignActive:s,shouldSuppressMarginsOnLayout:o}=e,r=(0,Va().q)(),{renderAsFullPage:l}=(0,Fe().jw)();return(0,M().IS)((()=>({header:{display:"flex",justifyContent:"space-between",alignItems:"center",pointerEvents:"auto",paddingTop:8,paddingInlineStart:12,paddingInlineEnd:12,height:l?44:void 0},labeledInput:{display:"flex",gap:8,alignItems:"center"},reset:{color:J().Tj.icon.secondary},toggleSlackMode:{color:J().Tj.icon.secondary},closeButton:{borderRadius:"100%",marginInlineStart:4},input:{width:void 0,marginInlineStart:8,marginInlineEnd:8},scroller:{flexGrow:1,width:"100%",margin:"0 auto",display:"flex",flexDirection:"column",paddingTop:8,paddingBottom:8,WebkitMaskImage:t?C().A.isMobile?"linear-gradient(black calc(100% - 12px), transparent calc(100% - 4px))":"linear-gradient(black calc(100% - 32px), transparent calc(100% - 4px))":"none",justifyContent:!l||C().A.isMobile||i?"end":"start",scrollbarGutter:l?"stable both-edges":"unset"},samplesLabel:{fontSize:C().A.isMobile?14:12,marginTop:8,marginBottom:8},inputLabel:{fontSize:C().A.isMobile?16:14,color:J().Tj.text.secondary},previewLabel:{fontSize:C().A.isMobile?14:12},editLink:{fontSize:C().A.isMobile?16:14,color:J().Tj.text.secondary,textDecoration:"underline",paddingInlineStart:8,paddingInlineEnd:8},addCustomInstructionsIcon:{fill:J().Tj.purple.icon.accentPrimary},suggestionsLabel:{fontSize:r.smallTextSize,color:J().Tj.text.secondary,marginTop:18,marginBottom:12},emptyStateText:{marginTop:28,fontSize:16,color:J().Tj.text.primary,fontFamily:Z().Tf.serif},emptyStateWrap:{marginInlineStart:8,marginInlineEnd:8},inputWrap:{paddingTop:0,paddingBottom:n||a||C().A.isMobile&&s?0:8,paddingInlineStart:C().A.isMobile?0:void 0,paddingInlineEnd:C().A.isMobile?0:void 0,marginBottom:l&&!C().A.isMobile?12:s?0:8,marginInlineStart:C().A.isMobile?0:void 0,marginInlineEnd:C().A.isMobile?0:void 0,marginTop:4},contentWrap:{paddingBottom:0,display:"flex",flexDirection:"column",paddingInlineStart:o?15:void 0,paddingInlineEnd:o?15:void 0,gap:2},skillsCaption:{fontSize:r.smallTextSize,color:J().Tj.text.secondary,marginBottom:8},skillIcon:{fill:J().Tj.purple.icon.accentPrimary},skillsWrap:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:8},helpCenterBlueBar:{backgroundColor:J().Tj.blue.background.accentPrimary,fontSize:14,padding:"8px 16px",color:J().Tj.text.inversePrimary,display:"flex",justifyContent:"space-between",alignItems:"center"},helpCenterBlueBarCloseButton:{width:16,height:16,borderRadius:"100%"},helpCenterBlueBarCloseButtonIcon:{fill:J().Tj.text.inversePrimary}})),[o,l,t,r.smallTextSize,n,a,i,s])}({unsnap:A,isDeepFindActive:U,isResearchModeActive:H,isLegacyChatEmptyStateActive:O,isUpdatedMobileAssistantDesignActive:z,shouldSuppressMarginsOnLayout:ue}),ye=(0,ka().A)(C().A.isMobile),ve=(0,v.useMemo)((()=>C().A.isMobile&&!u||!l.renderAsFullPage?"narrowscreen-ai":"fullscreen-ai"),[u,l.renderAsFullPage]),be=(0,v.useMemo)((()=>({store:D,onSubmit:({newValue:e,scopeOverride:t,actionCardIdForLogging:n})=>Q({newValue:e,source:"chat",scopeOverride:t,actionCardIdForLogging:n}),onFocus:()=>{if((0,Da().w)(),y(!0),C().A.isMobile)"empty_state"!==R.type&&Ca().A.onShow(q);else if("empty_state"===R.type&&void 0===p){var e;null===(e=a.current)||void 0===e||null===(e=e.getNode())||void 0===e||e.scrollTo({top:0})}},onBlur:()=>{y(!1)},onBackspaceOnEmptyInput:async()=>{re&&re.hasPendingOperations()&&await pe(),p&&m(void 0),!P||!(0,W().LP)(P.clientSkill.skillType)||null!=se&&se.some((e=>"human"===e.type))?t&&t():g().default.endCurrentSession()},requestedSkill:p,assistantChatRenderState:R,isSampling:de,emptyStateResultsIsEmpty:!B,isDeepFindFollowupInput:!1,sessionId:le})),[D,p,R,de,B,le,Q,q,re,P,se,t,pe]),xe=(0,j().K8)((()=>{var e;return null==re||null===(e=re.evaluatorFromStoreState)||void 0===e?void 0:e.getTranscript()}),[re]),Ie=(0,j().K8)((()=>{var e;return null==re||null===(e=re.evaluatorFromStoreState)||void 0===e?void 0:e.state.getIdMapper()}),[re]);if(!k||!l.renderAsFullPage&&!x&&!b)return null;let ke;if("chat"===R.type)ke=(0,fe.jsx)(tr,{currentSpaceStore:k,handleTextSubmit:e=>Q({newValue:e,source:"suggested_question"}),requestedSkill:p,setRequestedSkill:Y,mockTextStore:D});else if("abandoned_search_reminder"===R.type)ke=(0,fe.jsx)($i,{});else if("empty_state"===R.type&&z)ke=(0,fe.jsx)(Al,{requestedSkill:p,setRequestedSkill:Y,store:D,handleTextSubmit:e=>Q({newValue:e,source:"chat"}),disableKeyboard:!f||void 0!==p,setEmptyStateResultsAvailable:F});else if("empty_state"===R.type)ke=(0,fe.jsx)(Or,{requestedSkill:p,setRequestedSkill:Y,store:D,setEmptyStateResultsAvailable:F,handleTextSubmit:e=>Q({newValue:e,source:"chat"}),disableKeyboard:!f||void 0!==p});else if("research_mode_chat"===R.type){const e=(null==ge?void 0:ge.text)??(0,G().x9d)(null==ge?void 0:ge.message);ke=ge?(0,fe.jsx)(Ll,{threadId:ge.threadId,initialUserMessageText:e,assistantTranscript:xe,entrypoint:ge.entrypoint,idMapper:Ie}):(0,fe.jsx)("div",{children:"Something went wrong loading the chat store"})}else"agent_popup"===R.type||(0,X().HB)(R);return(0,fe.jsxs)(Ra().N7,{xmlMode:!1,children:[(0,fe.jsx)(Hi().F,{}),U?(0,fe.jsx)(vl,{inputContainerRef:r,keepFocusEvents:ye,styles:he,scrollerRef:a,scrollerStore:me,assistantChatRenderState:R,handleOnScroll:te,handleRequestSkill:Y,isLabelerMode:ne,handleResetSessionAndUseNewSkill:$,currentSkill:P,unsnap:A,sessionContext:re,scrollerContentRef:i,commonAssistantChatProps:be,scrollerContent:ke,snapToBottom:q,deepFindInput:e.deepFindInput}):H?(0,fe.jsx)(Ol,{threadId:null==ge?void 0:ge.threadId,styles:he,scrollerRef:a,scrollerStore:me,assistantChatRenderState:R,handleOnScroll:te,unsnap:A,sessionContext:re,scrollerContentRef:i,scrollerContent:ke,snapToBottom:q}):N?(0,fe.jsx)(rl,{richTextInputProps:be,isConnectorInfoLoading:ie}):L?(0,fe.jsx)(gr,{richTextInputProps:{...be,setRequestedSkill:Y,activateSkill:$,currentSkill:P,maybeRestoreLastHumanStepOnScopeChange:!0},isConnectorInfoLoading:ie}):(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(Ea().H,{ref:a,type:wa().A.Y,style:he.scroller,onScroll:te,store:me,children:(0,fe.jsx)(Sn().Mx,{type:ve,suppressMargin:ue,children:(0,fe.jsx)(Sn().vV,{children:(0,fe.jsxs)("div",{ref:i,style:he.contentWrap,children:[ne?(0,fe.jsx)(Ui().A,{}):void 0,ke]})})})}),"empty_state"!==R.type&&A?(0,fe.jsx)(Wl,{scrollerRef:a,inputContainerRef:r,assistantChatStyles:he}):void 0,(0,fe.jsx)(Sn().Mx,{type:ve,suppressMargin:ue,children:(0,fe.jsx)(Sn().vV,{children:(0,fe.jsx)("div",{ref:r,style:he.inputWrap,...ye,children:C().A.isMobile&&z?(0,fe.jsx)(Ml,{...be,withTypeahead:!1,maybeRestoreLastHumanStepOnScopeChange:!0}):V?(0,fe.jsx)(Wi,{...be,withTypeahead:!1,heightVariant:l.canShowNewFullPageWelcomeState?"chonky":"not_so_chonky",maybeRestoreLastHumanStepOnScopeChange:!0}):(0,fe.jsx)(Fi,{...be,isYassified:!1,setRequestedSkill:Y,activateSkill:$,currentSkill:P,maybeRestoreLastHumanStepOnScopeChange:!0})})})})]})]})}function Wl(e){const{scrollerRef:t,inputContainerRef:n,assistantChatStyles:a}=e,i=(0,Q().tz)(),{isIOS:s,isAndroid:o}=(0,T().Y0)(),[r,l]=(0,v.useState)(null),c=(0,v.useMemo)((()=>(r??0)+(a.inputWrap.paddingTop||0)+(a.inputWrap.paddingBottom||0)+(a.inputWrap.marginTop||0)+(a.inputWrap.marginBottom||0)),[r,a]),d=s?20:o?50:0,u=(0,M().eP)(),p=(0,M().IS)((()=>({overscrollIcon:{background:"dark"===u?"rgba(255, 255, 255, 0.05)":"rgba(255, 255, 255, 0.6)",backdropFilter:"blur(8px)",borderRadius:"100%",boxShadow:J().Tj.shadow2XS,width:C().A.isMobile?32:28,height:C().A.isMobile?32:28,marginInlineEnd:3,zIndex:2,position:"absolute",bottom:c+d},hoveredOverscrollIcon:{background:"dark"===u?"rgba(255, 255, 255, 0.15)":"rgba(255, 255, 255, 0.8)"},pressedOverscrollIcon:{background:"dark"===u?"rgba(255, 255, 255, 0.3)":"rgba(255, 255, 255, 0.9)"}})),[c,d,u]);return(0,v.useEffect)((()=>{let e=null;const t=new ResizeObserver((e=>{const t=e[0];l(t.contentRect.height??null)}));return null!=n&&n.current&&(e=n.current,t.observe(n.current)),()=>{e&&t.unobserve(e)}}),[n]),null===r&&n?null:(0,fe.jsx)("div",{style:{display:"flex",justifyContent:"center",zIndex:2},children:(0,fe.jsx)(Bt().A,{icon:_a().arrowChevronSingleDownFillSmallIcon,style:p.overscrollIcon,hoveredStyle:p.hoveredOverscrollIcon,pressedStyle:p.pressedOverscrollIcon,onClick:()=>{var e;const n=null===(e=t.current)||void 0===e?void 0:e.getNode();n&&n.scrollTo({top:n.scrollHeight})},ariaLabel:i.formatMessage({id:"AssistantChat.scrollToBottom",defaultMessage:"Scroll to bottom"})})})}function Ul(e,t,n){t?Ia().default.afterNextFlush((()=>{setTimeout((()=>{const e="editing"===B().default.state.mode?B().default.state.multiSelection:void 0;(null==e?void 0:e.end.store)!==n&&(null==e?void 0:e.start.store)!==n&&(0,fa().z)({store:n})}),0)})):((0,da().I)({environment:e}),(0,fa().z)({store:n}))}var Hl=()=>n(103812),Kl=()=>n(899377),ql=()=>n(418135),$l=()=>n(269345),Gl=()=>n(976582),Yl=()=>n(573792),Ql=()=>n(200562),Jl=()=>n(614949),Xl=()=>n(224011),Zl=()=>n(374580),ec=()=>n(854992),tc=()=>n(173443),nc=()=>n(363497),ac=()=>n(415211),ic=()=>n(44971);const sc=(0,Q().YK)({assistantNewChatTitle:{id:"assistantMenu.header.newChat.label",defaultMessage:"New AI chat"},deepDiveNewSearchTitle:{id:"assistantMenu.header.deepDive.label",defaultMessage:"Search results"}});function oc(e){const{chatSessionId:t,chatStore:n}=e,a=(0,Q().tz)(),i=(0,T().v3)(),s=(0,j().K8)((()=>(0,to().w)(i)),[i]),o=function(e){const{chatStore:t,chatSessionId:n}=e,[{value:a}]=(0,Ya().Yb)((async()=>{if(t)return await(0,ya().IF)(t)}),[t]),i=(0,v.useMemo)((()=>{if(a)return(0,ac().P)(a.serializedTranscriptSteps)}),[a]);return Xo({currentSkill:(0,j().K8)((()=>{var e;return n&&(null===(e=g().default.getSessionContext(n))||void 0===e?void 0:e.selectedSkillFromStoreState)}),[n])??i,isUniformTitleVariant:!0})}({chatStore:n,chatSessionId:t});return(0,j().K8)((()=>{const e=null==n?void 0:n.getTitleOrFallback({intl:a,fallback:o});return o||(e||(s?"":a.formatMessage(sc.assistantNewChatTitle)))}),[n,o,a,s])}function rc(){const e=(0,T().v3)(),t=(0,Q().tz)(),n=(0,j().O$)(I().AppStoreSidebarSpaceStore),a=(0,j().K8)((()=>h().zD.showAssistantNotionAiCopy()),[]),i=(0,j().K8)((()=>g().default.getActiveSessionId()),[]),s=(0,j().K8)((()=>{if(!n)return;const e=ic().A.getSessionsForSpace(n.id).find((e=>e.id===i));return e?Zl().g.createChildStore(n,{id:e.id,table:nc().TF,spaceId:n.id}):void 0}),[n,i]),o=(0,j().K8)((()=>null==s?void 0:s.getImageIfExists()),[s]),l=(0,Fe().jw)(),c=l.isType("fullPage"),d=(0,j().K8)((()=>{if(!i)return!1;const e=g().default.getSessionContextOrThrow(i).assistantConfigurationStoreState;return e&&(0,sa().pV)({configurationState:e,assistantSurface:l})}),[l,i]),u=oc({chatSessionId:i,chatStore:s}),p=v.useMemo((()=>!!i&&l.shouldShowChatHistory),[l,i]),m=v.useCallback((()=>{(0,r().switchToChatHistory)({environment:e,currentSessionId:i,assistantSurface:l})}),[e,i,l]),f=function(e){const{assistantSurface:t}=e,n=t.isType("fullPage");return(0,M().IS)((()=>({headerContainer:{display:"flex",gap:4,alignItems:"center",flexShrink:1,maxWidth:"100%",...n?{paddingInlineStart:6}:{}},headerSparkles:{marginInlineEnd:C().A.isMobile?4:6,marginTop:C().A.isMobile?"-2px":void 0,flexShrink:0},headerLabel:{fontSize:C().A.isMobile?15:14,color:J().Tj.text.primary,fontWeight:Z().Wy.regular,...Z().RC},chevronIcon:{flexShrink:0},icon:{borderRadius:"100%",marginInlineEnd:C().A.isMobile?4:2,marginTop:C().A.isMobile?"-2px":void 0,flexShrink:0}})),[n])}({assistantSurface:l}),y=d?t.formatMessage(sc.deepDiveNewSearchTitle):u;if(!i||!y)return null;const S=(0,fe.jsxs)(fe.Fragment,{children:[d?(0,fe.jsx)("div",{style:f.headerSparkles,children:(0,fe.jsx)(Wt().I,{icon:ec().E,colorVariant:"primary",size:"sm",style:f.headerSparkles})}):o?(0,fe.jsx)(li().B6,{disabled:!0,isEmptyPage:!1,icon:o,size:C().A.isMobile?18:16,style:f.icon}):a?null:(0,fe.jsx)(Wt().I,{icon:tc().sparklesFillIcon,colorVariant:"primary",size:"sm",style:f.headerSparkles}),(0,fe.jsx)("div",{style:f.headerLabel,children:y})]});return c?(0,fe.jsx)("div",{style:f.headerContainer,children:S}):(0,fe.jsxs)(Ft().p,{style:f.headerContainer,onClick:m,disabled:!p||d,children:[S,p&&!d?(0,fe.jsx)("span",{style:f.chevronIcon,children:(0,fe.jsx)(Wt().I,{icon:_a().arrowChevronSingleDownFillSmallIcon,size:"xs",colorVariant:"tertiary"})}):void 0]})}function lc(){const e=(0,T().Y0)(),t=(0,Fe().jw)(),n=(0,j().O$)(pa().sidebarExpandedStore),a=(0,j().K8)((()=>ca().default.isVisible()&&("assistant"===ca().default.state.contentType||"inbox"===ca().default.state.contentType)),[]),i=(0,j().O$)(gn().b),s=v.useMemo((()=>t.isType("fullPage")&&!n&&!a&&!C().A.isMobile),[n,t,a]),o=(0,M().IS)((()=>({headerContainer:{display:"flex",flexDirection:"column",gap:2,overflow:"hidden",fontSize:C().A.isMobile?14:12,justifyContent:"flex-start",marginBottom:"auto"},wrap:{display:"flex",gap:2,alignItems:"center",overflow:"hidden"},headerSparkles:{width:C().A.isMobile?18:16,height:C().A.isMobile?18:16,marginInlineEnd:C().A.isMobile?4:6,color:J().Tj.icon.primary,marginTop:C().A.isMobile?"-2px":void 0,flexShrink:0},headerLabel:{fontSize:C().A.isMobile?15:13,color:J().Tj.text.primary,fontWeight:Z().Wy.medium,...Z().RC}})),[]),r=t.isType("fullPage")&&e.isElectron,l=function(){const e=(0,T().v3)(),t=(0,j().K8)((()=>(0,Jl().X)(e).shouldShowSidebar),[e]),n=(0,j().K8)((()=>(0,ua().KB)(e)),[e]),a=(0,j().K8)((()=>ca().default.isPanelPinnedState()),[]),i=(0,j().K8)((()=>Xl().A.state.isFullScreen),[]),s=(0,j().K8)((()=>gn().A.state.zoomFactor),[]);return(0,Yl().DW)({environment:e,isShowingTabBar:!1,shouldShowSidebar:t,isSidebarExpanded:n,isSecondarySidebarVisible:a,isBrowserFullScreen:i,zoom:s||ql().rx})}(),c=(0,Gl().m)({location:"AssistantMenuHeader"});return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(On().LazyAssistantScopedSearchMenuPopup,{}),(0,fe.jsx)("div",{style:o.headerContainer,children:(0,fe.jsxs)("div",{style:o.wrap,children:[function(){const n=!a&&!C().A.isMobile&&t.isType("fullPage");return e.isElectron&&!i&&s&&t.isType("fullPage")?(0,fe.jsxs)("div",{style:{...l},children:[(0,fe.jsx)("div",{style:{marginInlineEnd:4},children:(0,fe.jsx)(Ql().z,{})}),(0,fe.jsx)($l()._,{topbarFeatureController:c})]}):e.isElectron&&!i&&n?(0,fe.jsx)("div",{style:{...l},children:(0,fe.jsx)($l()._,{topbarFeatureController:c})}):s&&!r?(0,fe.jsx)(Ql().z,{}):null}(),(0,fe.jsx)("div",{style:{width:r?"fit-content":"100%",marginInlineStart:r&&!i?-10:void 0},children:(0,fe.jsx)(rc,{})})]})})]})}var cc=()=>n(240562),dc=()=>n(564627),uc=()=>n(906380),pc=()=>n(198630),gc=()=>n(130119),mc=(n(803949),()=>n(255350));function hc(){return function(e){const t=(0,Q().tz)(),n=(0,j().O$)(I().AppStoreSidebarSpaceStore),a=(0,T().v3)();return(0,j().K8)((()=>{var i;if(n)return null===(i=(0,mc().tu)({environment:a,searchScope:e,spaceStore:n,intl:t}))||void 0===i?void 0:i.scopeTitle}),[e,n,t,a])}((0,To().wh)())}function fc(){const e=hc();return(0,fe.jsx)(Ha().LV,{titleMessage:(0,fe.jsx)(Q().sA,{id:"assistantFeedback.actionButton.findIn",defaultMessage:"Find in"}),selectedOptionMessage:e})}function yc(e){const{closeParentPopup:t,onSelectSeeHistory:n,buttonPopupParent:a}=e,i=(0,T().v3)(),{isElectron:s,isPhone:o}=(0,T().Y0)(),l=(0,j().K8)((()=>g().default.getActiveSession()),[]),c=(0,Fe().jw)(),d=(0,v.useCallback)((async()=>{(!(l&&l.getAllPendingOperations().length>0)||await(0,r().confirmAndDiscardPendingEditsIfApplicable)({environment:i,assistantSurface:c}))&&((0,ya().Dd)({environment:i,source:"corner"}),a.close())}),[a,i,l,c]),u=(0,v.useCallback)((()=>{(0,Qn().c6)(!(0,Qn().N8)())||ss().f1((0,fe.jsx)(fe.Fragment,{children:"Failed to show the assistant debug bar because the change couldn't be saved to local storage. One possible cause is that you might have a 'notion_cookie_consent' cookie that doesn't allow 'preference' type storage."})),a.close()}),[a]),p={sections:[],nextSectionShouldHaveTopBorder:()=>p.sections.length>0,addSection(e){e&&this.sections.push(e)}};let m;return p.addSection(function(e){const{shouldShowTopBorder:t,closeParentPopup:n}=e,a=(0,T().v3)(),i=(0,j().K8)((()=>(0,to().w)(a)),[a]);if(i)return;const s=[];return s.push({key:"findIn",action:()=>{},render:e=>(0,fe.jsx)(Sc,{...e,closeParentPopup:n})}),s.length>0?{key:"findIn",render:e=>(0,fe.jsx)($n().A,{...e,topBorder:t}),items:s}:void 0}({shouldShowTopBorder:p.nextSectionShouldHaveTopBorder(),closeParentPopup:t,assistantSurface:c})),p.addSection(function(e){const{shouldShowTopBorder:t,onNewChatClick:n,onSeeHistoryClick:a}=e,i=(0,j().K8)((()=>g().default.getActiveSession()),[]),s=(0,Fe().jw)(),o=(0,T().v3)(),r=(0,j().K8)((()=>(0,to().w)(o)),[o]),l=[];if(r)return;i&&l.push({key:"new chat",action:()=>{n()},render:e=>(0,fe.jsx)(bc,{...e,disabled:!1})});s.shouldShowChatHistory&&l.push({key:"chat history",action:()=>{a()},render:e=>(0,fe.jsx)(xc,{...e})});if(0===l.length)return;return{key:"chat history",render:e=>(0,fe.jsx)($n().A,{...e,topBorder:t}),items:l}}({shouldShowTopBorder:p.nextSectionShouldHaveTopBorder(),onNewChatClick:d,onSeeHistoryClick:n})),p.addSection(function(e){const{shouldShowTopBorder:t,buttonPopupParent:n,isPhone:a}=e,i=(0,T().v3)(),s=(0,x().r)(),o=i.currentUser.id,r=(0,Xe()._)({name:"ai_connectors",spaceId:s,userId:o});if(!r||a)return;const l=[{key:"ai_settings",action:()=>{(0,go().pp)({environment:i,connector:"generic",analyticsFrom:"assistant_overflow_menu_add_connectors",connectorsFeatureAvailability:r}),n.close()},render:e=>(0,fe.jsx)(vc,{...e})}];"available"===r.type&&void 0!==r.expiry&&"sunset"===r.expiry.type&&l.push({key:"universal_qna_sunset",action:()=>{},render:e=>(0,fe.jsx)(pc().f,{sunsetCheckSource:"assistant_overflow_menu_add_connectors"})});return{key:"ai_settings_item",render:e=>(0,fe.jsx)($n().A,{...e,topBorder:t}),items:l}}({shouldShowTopBorder:p.nextSectionShouldHaveTopBorder(),buttonPopupParent:a,isPhone:o})),p.addSection(function(e){const{shouldShowTopBorder:t,onDebugClick:n}=e;if(!(0,j().K8)((()=>(0,Qn().ab)()),[]))return;const a=[{key:"debug",action:n,render:e=>(0,fe.jsx)(Ic,{...e})}];return{key:"debug",render:e=>(0,fe.jsx)($n().A,{topBorder:t,...e}),items:a}}({shouldShowTopBorder:p.nextSectionShouldHaveTopBorder(),onDebugClick:u})),m=o?{menuType:ki().gu.ActionSheet}:{menuType:ki().gu.Popup,minWidth:208},(0,fe.jsx)(Hn().A,{...m,children:(0,fe.jsx)(qn().A,{style:{...(0,gc().g)({noDrag:s}),whiteSpace:"nowrap"},type:qn().O.Vertical,initialFocus:void 0,sections:p.sections})})}function vc(e){const t=(0,M().IS)((()=>({rightWrapper:{display:"flex",alignItems:"center",gap:4}})),[]);return(0,fe.jsx)(Kn().A,{...e,icon:(0,fe.jsx)(Wt().I,{icon:wr().L,size:"sm"}),right:(0,fe.jsxs)("div",{style:t.rightWrapper,children:[(0,fe.jsx)(ur().RH,{icons:["slack","github","google-drive"],iconSize:14,bubbleSize:20,marginLeft:-4}),(0,fe.jsx)(Wt().I,{icon:uc().arrowChevronSingleRightSmallIcon,size:"sm",colorVariant:"tertiary"})]}),title:(0,fe.jsx)(Q().sA,{defaultMessage:"AI Connectors",id:"assistantOverflowMenu.openAiSettings.menuItem"})})}const Sc=v.forwardRef(((e,t)=>{const{closeParentPopup:n}=e,{isPhone:a}=(0,T().Y0)();return(0,fe.jsx)(L().A,{popupType:a?N().nl.SlideUp:N().nl.Popup,onClose:()=>{n&&n()},placementToOrigin:"left",alignmentToOrigin:"center",renderOrigin:n=>(0,fe.jsx)(Kn().A,{...e,...n,ref:t,icon:(0,fe.jsx)(Wt().I,{icon:Rn().magnifyingGlassIcon}),title:(0,fe.jsx)(fc,{}),right:(0,fe.jsx)(Wt().I,{icon:uc().arrowChevronSingleRightSmallIcon,size:"sm",colorVariant:"tertiary"})}),render:e=>(0,fe.jsx)(To().Ay,{buttonPopupParent:e,analyticsSource:"overflow_menu"})})}));Sc.displayName="FindInButton";const bc=v.forwardRef(((e,t)=>{const{disabled:n,...a}=e,i=(0,M().IS)((()=>({newChatText:{color:n?J().Tj.text.tertiary:J().Tj.text.primary}})),[n]);return(0,fe.jsx)(Kn().A,{...a,ref:t,isTokenTitle:!0,icon:(0,fe.jsx)(Wt().I,{icon:Pn().M,colorVariant:n?"secondary":"primary"}),title:(0,fe.jsx)("div",{style:i.newChatText,children:(0,fe.jsx)(Q().sA,{defaultMessage:"New AI chat",id:"helpButton.newChat.menuItem"})}),disabled:n})}));bc.displayName="ChatHistoryNewChatButton";const xc=v.forwardRef(((e,t)=>(0,fe.jsx)(Kn().A,{...e,ref:t,isTokenTitle:!0,icon:(0,fe.jsx)(Wt().I,{icon:_n().clockIcon}),title:(0,fe.jsx)(Q().sA,{defaultMessage:"View history",id:"helpButton.seeHistory.menuItem"})})));xc.displayName="ChatHistorySeeHistoryButton";const Ic=v.forwardRef(((e,t)=>{const a=(0,j().K8)((()=>(0,Qn().N8)()),[]);return(0,fe.jsx)(Kn().A,{...e,ref:t,isTokenTitle:!0,icon:(0,fe.jsx)(Wt().I,{icon:n(481721).codeIcon}),title:a?"Hide debug helpers":"Show debug helpers"})}));Ic.displayName="DebugMenuButton";v.forwardRef(((e,t)=>(0,fe.jsx)(Kn().A,{...e,ref:t,isTokenTitle:!0,icon:(0,fe.jsx)(Wt().I,{icon:n(40785).bubbleEllipsesIcon}),title:(0,fe.jsx)(Q().sA,{defaultMessage:"Get Notion support",id:"helpButton.getNotionSupport.menuItem"})}))).displayName="GetNotionSupportButton";v.forwardRef(((e,t)=>(0,fe.jsx)(Kn().A,{...e,ref:t,isTokenTitle:!0,icon:(0,fe.jsx)(Wt().I,{icon:qi().questionMarkCircleIcon}),title:(0,fe.jsx)(Q().sA,{defaultMessage:"More help",id:"helpButton.getMoreHelp.menuItem"})}))).displayName="GetMoreHelpButton";var kc=()=>n(418133);function wc(e){const{buttonPopupParent:t,onClickViewHistory:n}=e,a=(0,T().v3)(),i=(0,j().K8)((()=>xa().c.getCurrentView()),[]),s=(0,j().K8)((()=>g().default.getActiveSessionId()),[]),o=(0,v.useCallback)((()=>{n?(t.close(),n()):xa().c.setCurrentView("chatHistory"),s&&dc().G.setPreviouslyVisitedSession(s)}),[t,s,n]);switch(i){case"helpOverflowMenu":return(0,fe.jsx)(yc,{closeParentPopup:t.close,onSelectSeeHistory:o,buttonPopupParent:t});case"chatHistory":return(0,fe.jsx)(Ac,{buttonPopupParent:t});case"mainHelpMenu":return(0,fe.jsx)(cc().p,{fromForAnalytics:"ai_qna",hideSupportButton:!0,onAcceptMessageSupport:()=>{r().closeAssistantRightHandSideMenu({environment:a})}});default:throw(0,X().HB)(i)}}const Cc=375;function Ac(e){const{buttonPopupParent:t}=e;return(0,fe.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:Cc,transition:"height 200ms ease",minHeight:128},children:[(0,fe.jsx)("div",{style:{marginTop:"auto"}}),(0,fe.jsx)(kc().dX,{onRestoreChatSession:()=>t.close()})]})}var Tc=()=>n(758632);function jc(){const e=(0,M().IS)((()=>({wrap:{display:"flex",alignItems:"center",fontSize:C().A.isMobile?14:11,height:28,justifyContent:"space-between",padding:"0 8px",backgroundColor:J().Tj.popoverBackground,borderBottom:`1px solid ${J().Tj.border.secondaryTranslucent}`},sideWrap:{display:"flex",alignItems:"center",gap:8},title:{fontStyle:"italic",cursor:"default"}})),[]);return(0,fe.jsxs)("div",{style:e.wrap,children:[(0,fe.jsx)("div",{style:e.sideWrap,children:(0,fe.jsx)("div",{style:e.title,children:"Debug Tools"})}),(0,fe.jsxs)("div",{style:e.sideWrap,children:[(0,fe.jsx)(Kl().hM,{}),(0,fe.jsx)(Kl().RK,{})]})]})}const Mc=(0,Q().YK)({newChatAriaLabel:{id:"assistantMenu.newChat.ariaLabel",defaultMessage:"New AI chat"},newSearchButtonLabel:{id:"assistantMenu.newSearch.buttonLabel",defaultMessage:"New search"}}),_c=450,Pc=450;function Dc(e){const{onClose:t,fromSurface:n="corner"}=e,a=(0,T().v3)(),i=(0,j().O$)(I().AppStoreMainEditorCurrentBlockStore),s=(0,j().K8)((()=>null!=i&&i.isPersonalHomePage()?"home":"page"),[i]),r=(0,Fe().jw)(),{renderAsFullPage:l,isMobile:c}=r,d=v.useMemo((()=>!(0,Cn().T)("supportsHorizon1Navigation")&&r.isMobile),[r]);(0,wn().w)((()=>{$t().trackAiOpened({environment:a,agentEnabled:!1,surface:n,cornerSurface:s})}));const m=(0,j().K8)((()=>u().P.state.currentView),[]),f=(0,j().K8)((()=>(0,Qn().N8)()),[]),y=(0,j().K8)((()=>ha().default.isSidePeekOpen()),[]),[S,b]=v.useState(),x=(0,j().K8)((()=>bn().Z8()),[]),k=(0,j().K8)((()=>{const e=oa().Ay.state.open,t=yt().d;return e?oa().Ay.state.showReplaceInput?115+t:40+t:0}),[]),w=(0,j().K8)((()=>{const e=(0,Ln().ek)(a.device.isElectronMac);return 2*yt().d+e+k}),[a.device.isElectronMac,k]),C=v.useCallback((()=>{const e=(0,ua().R8)(a);b(e)}),[a]),A=(0,kt().sg)(C,100);v.useEffect((()=>(A(),ha().default.addListener(A),ca().default.addListener(A),pa().sidebarOpenStore.addListener(A),ma().default.addListener(A),a.WindowSizeStore.addListener(A),()=>{ha().default.removeListener(A),ca().default.addListener(A),pa().sidebarOpenStore.removeListener(A),ma().default.removeListener(A),a.WindowSizeStore.removeListener(A)})),[A,a.WindowSizeStore]);const _=(0,v.useCallback)((()=>{p().O.setAssistantLastViewedTime(),null==t||t();const e=g().default.getActiveSession();o().trackAssistantClosed(a,{sessionContext:e,from:"button"})}),[a,t]),P=Sa(),D="research_mode_chat"===P.type,E=(0,j().K8)((()=>"empty_state"===P.type&&h().zD.isNewCornerChatWelcomeStateEnabled(r)),[P,r]);(0,v.useEffect)((()=>()=>{u().P.setState({...u().P.state,open:!1})}),[]);const R=(0,M().IS)((()=>({wrap:{display:"flex",flexDirection:"column",transition:"max-height 200ms ease",minHeight:128,...l?c?{width:"100%",height:"100%",maxHeight:void 0}:y?{width:S?Math.max(_c,S):_c,height:"100%",maxHeight:void 0}:x>0?{width:`calc(100% - ${x}px)`,height:"100%",maxHeight:void 0}:{width:"100%",height:"100%",maxHeight:void 0}:{width:Pc,height:void 0,maxHeight:"empty_state"===P.type?E?void 0:"max(61vh, 365px)":`max(calc(100vh - ${w}px), 365px)`,minHeight:"agent_popup"===P.type?"min(70vh, 500px)":"min(61vh, 365px)"}}})),[y,x,l,c,S,P.type,w,E]),B=(0,v.useMemo)((()=>{const e={onClose:_,showCloseButton:Boolean(d)};return"chat"===m?(0,fe.jsx)(Ec,{...e}):"chatHistory"===m?(0,fe.jsx)(Lc,{...e}):void(0,X().HB)(m)}),[m,_,d]);return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(On().LazyAssistantShareModal,{}),(0,fe.jsx)(Tc().M,{origin:(0,fe.jsxs)(kn().A,{skip:!r.isType("fullPage"),style:R.wrap,animate:{width:R.wrap.width,translateX:r.isType("fullPage")?x:void 0},children:[f&&!D?(0,fe.jsx)(Kl().lt,{}):void 0,f&&D?(0,fe.jsx)(jc,{}):void 0,B]})})]})}function Ec(e){const{showCloseButton:t,onClose:n}=e,a=(0,j().K8)((()=>g().default.getActiveSession()),[]),i=(0,j().K8)((()=>null==a?void 0:a.sessionIdFromStoreState),[a]),s=(0,ra().AI)({initialValue:[]}),o=(0,M().IS)((()=>({unstableMessage:{width:"100%",backgroundColor:J().Tj.blue.background.primaryTranslucent,padding:12,display:"flex",alignItems:"center",gap:12},link:{textDecoration:"underline",display:"inline"},chatBodyContainer:{display:"flex",width:"100%",flex:1,overflow:"hidden"},chatContainer:{flexGrow:1,display:"flex",flexDirection:"column",minWidth:0}})),[]),r=(0,Fe().jw)(),l=(0,T().v3)(),c=(0,j().K8)((()=>{if(!i)return!1;const e=null==a?void 0:a.assistantConfigurationStoreState;return e&&(0,sa().pV)({configurationState:e,assistantSurface:r})}),[r,i,a]),d=(0,j().K8)((()=>(0,mt().fM)(l)),[l]),u=(0,j().K8)((()=>zn().defaultClientAIChatStore.state.isAIChatTranscriptSidePanelVisible),[]),p=(0,j().K8)((()=>{var e;return null===(e=g().default.getActiveSession())||void 0===e?void 0:e.clientStepsFromStoreState}),[]),m=(0,v.useMemo)((()=>null==p?void 0:p.find((e=>"assistantStartResearchMode"===e.type))),[p]),h=(0,j().K8)((()=>{if(d&&null!=m&&m.threadId)return An().E.createChildStore(d,{table:Nn().To,id:m.threadId,spaceId:d.id})}),[d,null==m?void 0:m.threadId]),f=(0,j().K8)((()=>Wn().R.isQnaDown()),[]),y=(0,v.useCallback)((()=>{s.setValue([]),(0,fa().z)({store:s.store})}),[s]);return(0,fe.jsxs)("div",{style:o.chatBodyContainer,children:[(0,fe.jsxs)("div",{style:o.chatContainer,children:[(0,fe.jsx)(Oc,{backButtonVariant:t?"closeChat":"none",onClose:n,extraRightAlignedContent:c?(0,fe.jsx)(Ft().p,{iconLeading:Rn().magnifyingGlassIcon,onClick:y,children:(0,fe.jsx)(Q().sA,{...Mc.newSearchButtonLabel})}):(0,fe.jsx)(Rc,{currentSessionId:i}),children:(0,fe.jsx)(lc,{})}),f?(0,fe.jsxs)("div",{style:o.unstableMessage,children:[(0,fe.jsx)(Wt().I,{icon:En().exclamationMarkTriangleFillIcon,colorPalette:"blue",colorVariant:"tertiary"}),(0,fe.jsx)(V().D,{styleKey:"bodyRegular",colorPalette:"blue",colorVariant:"accentPrimary",children:(0,fe.jsx)(Q().sA,{id:"assistantMenu.unstableMessage",defaultMessage:"Notion AI is experiencing issues. See our <link>status page</link> for more information.",values:{link:e=>(0,fe.jsx)(Ut().N,{href:"https://www.notion-status.com",external:!0,style:o.link,children:e})}})})]}):void 0,(0,fe.jsx)(zl,{deepFindInput:s})]}),(0,fe.jsx)(aa().z,{config:u?{mode:"resizable",min:300,max:900,defaultSize:380,userOverride:void 0}:{mode:"closed"},anchorToSide:"right",children:(0,fe.jsx)(Vn().s,{clientStore:zn().defaultClientAIChatStore,threadStore:h})})]})}function Rc(e){const{currentSessionId:t}=e,n=(0,T().v3)(),a=(0,Fe().jw)(),i=!!a.isType("fullPage")||!t&&a.shouldShowChatHistory,s=Boolean(t);return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(Xn,{style:{marginInlineEnd:2}}),(0,fe.jsx)(z().m,{render:e=>(0,fe.jsx)(Hl().cg,{tooltipEvents:e}),renderTooltip:()=>(0,fe.jsx)(Q().sA,{id:"assistantMenu.connectionStatus",defaultMessage:"View connection status"})}),s?(0,fe.jsx)(Bc,{}):null,i?(0,fe.jsx)(z().m,{render:e=>(0,fe.jsx)(Nc,{onClick:()=>{r().switchToChatHistory({environment:n,currentSessionId:t,assistantSurface:a})},tooltipEvents:e}),renderTooltip:()=>(0,fe.jsx)(Q().sA,{id:"assistantMenu.seeHistory",defaultMessage:"View history"})}):null,(0,fe.jsx)(Fc,{currentSessionId:t})]})}function Bc(e){const{iconButtonPropsOverride:t,iconButtonStyleOverrides:n}=e,a=(0,Q().tz)(),i=(0,T().v3)(),s=(0,Fe().jw)(),o=s.isType("fullPage"),r=(0,M().IS)((()=>{const{fill:e,...t}=n??{};return{button:{gap:8},iconContainerStyle:{...C().A.isMobile&&{borderRadius:"100%",width:28,height:28},...o&&{width:32,height:28}},iconStyle:{width:C().A.isMobile||o?Fn().Ev.default:Fn().Ev.sm,height:C().A.isMobile||o?Fn().Ev.default:Fn().Ev.sm,...null===e?{}:{fill:e??s.isType("fullPage")?J().Tj.icon.primary:J().Tj.icon.tertiary},...t}}}),[o,s,n]),l=v.useCallback((()=>{(0,d().maybeCreateNewChat)({environment:i,assistantSurface:s})}),[s,i]);return o&&!C().A.isMobile?(0,fe.jsx)(Ft().p,{style:r.button,iconLeading:{icon:Mn().y,size:"lg"},ariaLabel:a.formatMessage(Mc.newChatAriaLabel),onClick:l,children:(0,fe.jsx)(Q().sA,{...Mc.newChatAriaLabel})}):(0,fe.jsx)(z().m,{renderTooltip:()=>(0,fe.jsx)(Q().sA,{id:"assistantMenu.newChat.tooltip",defaultMessage:"New AI chat"}),render:e=>(0,fe.jsx)(Bt().A,{...e,icon:Pn().M,style:r.iconContainerStyle,iconStyle:r.iconStyle,ariaLabel:a.formatMessage(Mc.newChatAriaLabel),onClick:l,...t})})}function Fc(e){const t=(0,Q().tz)(),{currentSessionId:n}=e,a=(0,T().v3)(),{isPhone:i,isMobileNative:s}=(0,T().Y0)(),r=(0,Fe().jw)(),l=r.isType("fullPage"),c=(0,M().IS)((()=>({iconParentWrapper:{height:l?44:28,width:l?34:28,display:"flex",alignItems:"center",justifyContent:"center"},iconContainerStyle:{...i&&{borderRadius:"100%",width:28,height:28},...l&&{width:34,height:28}},iconStyle:{width:i||l?Fn().Ev.lg:Fn().Ev.default,height:i||l?Fn().Ev.lg:Fn().Ev.default,fill:r.isType("fullPage")?J().Tj.icon.primary:J().Tj.icon.tertiary}})),[l,i,r]),d=v.useMemo((()=>r.isType("fullPage")?"end":"start"),[r]),p=v.useMemo((()=>r.isType("fullPage")?"bottom":"left"),[r]),g=(0,v.useRef)(null);(0,v.useEffect)((()=>{ga().A.setOriginComponent(g.current??void 0)}),[]);const m=(0,v.useCallback)((()=>{r.isType("fullPage")?(0,la().ZT)({environment:a,contentType:"assistant"}):(u().P.setState({...u().P.state,currentView:"chatHistory"}),o().trackAiChatTranscriptHistoryOpenHistoryButtonSelected(a,{from:r.type}))}),[r,a]),h=t.formatMessage({id:"assistant.help",defaultMessage:"Manage chats, get help, more..."});return(0,fe.jsx)(L().A,{buttonPopupStore:ba().A,alignmentToOrigin:d,placementToOrigin:p,popupType:i?L().z.BottomSheet:L().z.Popup,onClick:()=>{s&&(0,da().I)({environment:a}),xa().c.setCurrentView("helpOverflowMenu"),o().trackOpeningThreeDotMenu(a,{sessionId:n})},renderOrigin:e=>(0,fe.jsx)("div",{ref:g,children:(0,fe.jsx)(z().m,{render:t=>(0,fe.jsx)("div",{style:c.iconParentWrapper,children:(0,fe.jsx)(Bt().A,{style:c.iconContainerStyle,iconStyle:c.iconStyle,icon:Dn().ellipsisFillIcon,ariaLabel:h,...t,...e})}),renderTooltip:()=>h})}),render:e=>(0,fe.jsx)(wc,{buttonPopupParent:e,onClickViewHistory:m})})}function Nc(e){const t=(0,Q().tz)(),{onClick:n,tooltipEvents:a}=e,i=(0,Fe().jw)().isType("fullPage"),s=(0,M().IS)((()=>({iconContainerStyle:{...C().A.isMobile&&{borderRadius:"100%",width:28,height:28},...i&&{height:28,width:34,display:"flex",alignItems:"center",justifyContent:"center"}},iconStyle:{width:C().A.isMobile?18:16,height:C().A.isMobile?18:16,fill:J().Tj.icon.tertiary}})),[i]);return(0,fe.jsx)(Bt().A,{...a,icon:i?()=>(0,fe.jsx)(Wt().I,{size:"lg",icon:_n().clockIcon}):_n().clockIcon,style:s.iconContainerStyle,iconStyle:s.iconStyle,ariaLabel:t.formatMessage({id:"assistantMenu.chatTranscriptHistoryButton.label",defaultMessage:"View chat history"}),onClick:n})}function Lc(e){const{showCloseButton:t,onClose:n}=e,a=(0,T().v3)(),i=(0,M().IS)((()=>({newChatButtonText:{color:J().Tj.text.tertiary,fontSize:13,display:"flex",alignItems:"center"},chatHistoryTitle:C().A.isMobile?{fontSize:15,fontWeight:Z().Wy.medium,display:"flex",alignItems:"center",textAlign:"center",paddingInlineStart:8,paddingInlineEnd:8,flex:1,justifyContent:"center",...Z().RC}:{fontSize:14,fontWeight:Z().Wy.medium,display:"flex",alignItems:"center",padding:"4px 12px"}})),[]);return(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(Oc,{backButtonVariant:t?"closeChat":"returnToChat",onClose:n,hideCloseButton:C().A.isMobile,extraRightAlignedContent:C().A.isMobile?(0,fe.jsx)(Bc,{iconButtonStyleOverrides:{fill:null},iconButtonPropsOverride:{disableBackground:!0}}):(0,fe.jsx)(Ft().p,{style:i.newChatButtonText,onClick:()=>{(0,ya().Dd)({environment:a,source:"corner"})},size:"sm",children:(0,fe.jsx)(Q().sA,{id:"searchAssistantPane.header.newChat.label",defaultMessage:"New AI chat"})}),children:(0,fe.jsx)("div",{style:i.chatHistoryTitle,children:(0,fe.jsx)(Q().sA,{id:"assistantMenu.allChats.askNotionAI.chatHistoryHeader",defaultMessage:"Chat history"})})}),(0,fe.jsx)(kc().dX,{})]})}function Oc(e){const{children:t,onClose:n,extraRightAlignedContent:a,backButtonVariant:i,hideCloseButton:s}=e,o=(0,Q().tz)(),r=(0,T().v3)(),{isElectron:l}=(0,T().Y0)(),c=(0,Fe().jw)(),d=c.isType("fullPage"),u=(0,j().O$)(gn().b),p=Boolean(a||!d),g=(0,Cn().T)("supportsHorizon1Navigation"),m=(0,ia().Nq)(),h=(0,T().Y0)().isElectron&&d&&!u,f=(0,M().IS)((()=>({wrap:{display:"flex",alignItems:"center",pointerEvents:"auto",paddingInlineStart:h?0:12,paddingInlineEnd:d?m:12,minHeight:C().A.isMobile?52:44,marginBottom:"auto"},leftContentWrap:{display:"flex",flexGrow:1,alignItems:"center",overflow:"hidden",marginInlineEnd:p?8:0},rightContentWrap:{display:"flex",flexDirection:"column",justifyContent:"flex-start"},rightContentRowWrap:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gap:C().A.isMobile?8:4,flexShrink:0},backwardButton:{marginInlineStart:4},backwardButtonIcon:{width:20,height:20},closeButton:{borderRadius:"100%",width:C().A.isMobile?28:22,height:C().A.isMobile?28:22,marginInlineStart:C().A.isMobile?void 0:2},closeButtonIconStyle:C().A.isMobile?{width:Fn().Ev.sm,height:Fn().Ev.sm}:{}})),[h,d,m,p]),y=d&&l&&!u,v=o.formatMessage({id:"assistantMenu.closeButton.label",defaultMessage:"Close"});return(0,fe.jsxs)("div",{className:y?R().sbV:void 0,style:f.wrap,children:[(0,fe.jsxs)("div",{style:f.leftContentWrap,children:["closeChat"===i?(0,fe.jsx)(Bt().A,{iconStyle:f.backwardButtonIcon,style:f.backwardButton,icon:Tn().$,onClick:n,disableBackground:!0,colorVariant:"primary",ariaLabel:v}):void 0,"returnToChat"===i?g?(0,fe.jsx)(Bt().A,{iconStyle:f.closeButtonIconStyle,style:f.closeButton,hovered:!0,icon:Tn().$,onClick:()=>{(0,ya().WX)({environment:r,assistantSurface:c})},ariaLabel:v,disableBackground:!0}):(0,fe.jsx)(Bt().A,{iconStyle:{width:Fn().Ev.default,height:Fn().Ev.default},style:f.backwardButton,icon:jn().arrowStraightLeftIcon,onClick:()=>{(0,ya().WX)({environment:r,assistantSurface:c})},ariaLabel:v,disableBackground:!0}):void 0,t]}),p?(0,fe.jsx)("div",{style:f.rightContentWrap,children:(0,fe.jsxs)("div",{style:f.rightContentRowWrap,children:[a,c.showCloseButton&&!s?(0,fe.jsx)(Bt().A,{iconStyle:f.closeButtonIconStyle,style:f.closeButton,hovered:!0,icon:Bn().xMarkSmallIcon,onClick:n,ariaLabel:v}):void 0]})}):null]})}function Vc(){const e=(0,T().v3)(),{isElectronWindows:t}=(0,T().Y0)(),n=(0,j().O$)(e.RouterStore),a=(0,j().O$)(gn().b),i=(0,j().K8)((()=>"quickSearch"===e.RouterStore.state.initialRoute.name),[e]),s=v.useCallback((()=>{(0,bn().du)()?(0,xn().closeAssistantChatHistoryIfTooNarrow)(e):i||(0,xn().openAssistantChatHistoryIfWideEnough)({environment:e,isResizing:!0})}),[e,i]);(0,In().J)(),(0,v.useEffect)((()=>(e.WindowSizeStore.addListener(s),()=>e.WindowSizeStore.removeListener(s))),[e.WindowSizeStore,s]),(0,v.useEffect)((()=>()=>{o().trackLeavingFullPageChat(e)}),[e]),(0,v.useEffect)((()=>{!function(e){const{environment:t}=e,n=performance.now();if(zc)return;const a=t.RouterStore.state,i=a.initialRoute.name;if("chat"!==i)return;E().default.DO_NOT_USE_measureFromPageOriginLegacy({metricName:"initial_assistant_full_page_chat_render",endTime:n},{environment:t,data:{profiling_tool:(0,mn().getProfilingToolForSession)(),time_origin_to_app_start:hn().getAppStartTime(),includes_page_origin_to_app_start:!0},shouldSendIfStatsigNotInitialized:!1}),zc=!0}({environment:e})}),[e]),(0,v.useEffect)((()=>{(0,d().submitVectorDbWarmUpQuery)({environment:e,assistantSurfaceType:"fullPage"})}),[e]);const r=(0,M().IS)((()=>({pageLayout:{order:fn().A.appCursorListener.aiChat,display:"flex",width:"100%"},layoutContent:{flex:1,height:"100%"}})),[]);return(0,fe.jsxs)(Fe().hP,{surface:Fe().wy.fullPage,children:[(0,fe.jsxs)(Sn().Mx,{type:"chat",style:r.pageLayout,children:[(0,fe.jsx)(Sn().vV,{style:r.layoutContent,children:(0,fe.jsx)(Dc,{preventAgent:!0})}),t&&!a?(0,fe.jsx)(vn().K,{}):void 0]}),C().A.isMobile||"nativeTab"===n.route.name?void 0:(0,fe.jsx)(yn().t,{})]})}let zc=!1;function Wc(){const e=(0,T().v3)(),t=v.useCallback((()=>{(0,r().openAssistantFromEdit)({environment:e})}),[e]);return(0,fe.jsx)(Fe().hP,{surface:Fe().wy.mobileNative,children:(0,fe.jsx)(Tt,{onChat:t})})}var Uc=()=>n(560729),Hc=()=>n(769864),Kc=()=>n(825972),qc=()=>n(240865),$c=()=>n(657349);function Gc(){const e=(0,j().K8)((()=>po().A.state.open),[]),t=(0,x().r)(),n=(0,T().v3)(),a=(0,Q().tz)(),i=(0,qc().V)()??1,s=(0,j().O$)(Kc().NK),o=(0,j().K8)((()=>s.slice(0,5).map((e=>(0,eo().Qe)(e.store,a,n,!1))).filter((e=>Boolean(e)))),[n,a,s]),r=(0,j().K8)((()=>(0,Ba().cJ)()),[]),l=(0,j().K8)((()=>!0===po().A.state.open&&"up"===po().A.state.thumbsUpOrDown),[]),c=(0,v.useCallback)((e=>{const{additionalComments:a,tags:s,routingLabels:l,filterTools:c}=e,d=po().A.state,u=t;if(!d.open||!u)return;const{traceId:p,type:g}=d;let m;"slackbot_followup_feedback"===g?m={type:g,id:p,notes:a||"",tags:s,routingLabels:l,isLabelerMode:r,filterTools:c,recentTitles:o,userMemberCount:i,space_id:u}:"find_related_content_thumbs_up"===g||"find_related_content_thumbs_down"===g?m={type:g,id:p,notes:a||"",space_id:u}:"ai_block_thumbs_down"===g||"ai_block_thumbs_up"===g||"ai_autofill_thumbs_down"===g||"ai_autofill_thumbs_up"===g?m={type:g,id:p,space_id:u,feedbackNote:a}:(0,X().HB)(g),Hc().callCellCompatibleApi({eventName:"saveAssistantFeedback",environment:n,data:m,cellNavigation:{spaceId:t}}),po().A.reset()}),[t,n,o,i,r]);if(!e)return null;let d;return d=r?"assistant-labeler":l?"feedback-positive":"feedback",(0,fe.jsx)(Uc().A,{onDismiss:Yc,style:C().A.isMobile?{maxHeight:"100%",display:"flex"}:{},render:()=>(0,fe.jsx)($c().O,{handleSubmit:c,mode:d,closeForm:Yc,threadStore:void 0}),isOpen:!0})}function Yc(){po().A.update((()=>({open:!1,traceId:void 0})))}var Qc=()=>n(692031),Jc=()=>n(675133),Xc=()=>n(128933),Zc=()=>n(699143),ed=()=>n(627503),td=()=>n(774111);function nd(){const e=(0,T().v3)(),t=(0,j().O$)(td().A),n=(0,j().K8)((()=>g().default.getActiveSessionId()),[]),a=(0,Fe().jw)(),i=v.useCallback((()=>{td().A.setState({isOpen:!1}),(0,o().trackAssistantShareModalDismiss)({environment:e,sessionId:n,assistantSurfaceType:a.type})}),[e,n,a.type]);return(0,fe.jsx)(Uc().A,{isOpen:t.isOpen,onDismiss:i,showCloseIcon:!0,style:C().A.isMobile?{maxHeight:"100%",display:"flex"}:{},render:()=>(0,fe.jsx)(ad,{...t,handleDismiss:i})})}function ad(e){const{handleDismiss:t,...n}=e,a=(0,T().v3)(),i=(0,v.useRef)(null),s=(0,j().K8)((()=>(0,mt().fM)(a)),[a]),r=(0,j().K8)((()=>g().default.getActiveSessionId()),[]),l=(0,Fe().jw)(),c=v.useCallback((async()=>{if(n.isOpen){const e=await async function(e){const{domRef:t}=e,n=t.current;try{if(!n)return{error:"Failed to find DOM element"};async function i(e){const t=await(0,is().$E)(e),n=await fetch(t);return await n.blob()}const s=new ClipboardItem({"image/png":i(n)});await navigator.clipboard.write([s]);const o=await(0,Qc().r)();return Xc().D6({label:Jc().A.formatMessage(o.copiedImageToClipboard)}),{value:{success:!0}}}catch(a){return{error:"Failed to copy image to clipboard."}}}({domRef:i});Xs().Q.isSuccess(e)?(0,o().trackAssistantShareModalCopyImageSuccess)({environment:a,sessionId:r,assistantSurfaceType:l.type}):(0,o().trackAssistantShareModalCopyImageFailure)({environment:a,sessionId:r,assistantSurfaceType:l.type})}}),[n,i,a,r,l.type]),d=(0,M().IS)((()=>({title:{fontWeight:Z().Wy.bold,fontSize:25,marginTop:20},shadowboxContainer:{background:J().Tj.white,borderRadius:6,maxWidth:450,boxShadow:J().Tj.shadowMD,marginTop:24,position:"relative",maxHeight:400},downloadContainer:{background:J().Tj.white,overflow:"hidden"},notionIcon:{fill:J().Tj.primaryBlack,height:20,width:20,position:"absolute",top:12,insetInlineStart:12},chatImage:{width:450,paddingTop:42,paddingInlineEnd:20,paddingBottom:8,paddingInlineStart:20},primaryButton:{width:"100%",fontWeight:Z().Wy.medium,display:"flex",alignItems:"center",justifyContent:"center",gap:8,marginTop:24},dismissButton:{width:"100%",color:J().Tj.text.tertiary,fontWeight:Z().Wy.medium,display:"flex",alignItems:"center",justifyContent:"center",marginTop:8}})),[]);return n.isOpen&&s?(0,fe.jsxs)(Zc().Y1,{direction:"vertical",align:"center",padding:24,children:[(0,fe.jsx)("div",{style:d.title,children:(0,fe.jsx)(Q().sA,{id:"assistantShareModal.title",defaultMessage:"Share this answer"})}),(0,fe.jsx)(Ea().H,{type:wa().A.Y,style:d.shadowboxContainer,children:(0,fe.jsxs)("div",{ref:i,style:d.downloadContainer,children:[(0,qt().notionIcon)(d.notionIcon),(0,fe.jsx)("img",{src:n.imageSrc,style:d.chatImage})]})}),(0,fe.jsxs)(Ht().A,{colorPalette:"blue",onClick:c,style:d.primaryButton,children:[(0,fe.jsx)(Wt().I,{icon:ed().a,size:"sm"}),(0,fe.jsx)(Q().sA,{id:"assistantShareModal.copyImageToShare",defaultMessage:"Copy image to share"})]}),(0,fe.jsx)(Ft().p,{onClick:t,style:d.dismissButton,children:(0,fe.jsx)(Q().sA,{id:"assistantShareModal.noThanks",defaultMessage:"No thanks"})})]}):null}var id=()=>n(617871),sd=()=>n(177163),od=()=>n(610083),rd=()=>n(911339),ld=()=>n(620791);function cd(e){const{renderMenu:t,url:n,integration:a,headerStyle:i,menuTextStyle:s,updateUnfurlingOptionType:r,handleDismiss:l}=e,c=(0,T().v3)(),d=(0,Q().tz)(),u=function({url:e,integration:t,menuTextStyle:n,headerStyle:a,onMouseEnter:i,handleDismiss:s}){const r=(0,T().v3)(),l=(null==t?void 0:t.id)===id().zG,c=(0,j().K8)((()=>!!(0,X().O9)(t)&&(0,ld().jw)(t.id).length>0),[t]),d=(0,j().K8)((()=>{const e=od().Rh.state;return h().zD.getUnfurlingMenuAiActionSectionVariant({device:r.device,slackUniversalQnAConnectionStoreState:e})}),[r]),u=(0,M().IS)((()=>({icon:{width:20,height:"auto"}})),[]),p=[{key:"summarize",titleMessage:dd.askAiSlackPasteMenuSummarizeAction}],{currentUserStore:g,currentSpaceStore:m}=(0,j().K8)((()=>({currentUserStore:I().default.state.currentUserStore,currentSpaceStore:(0,se().S)()})),[]),f=(0,Xe()._)({name:"ai_connectors",spaceId:null==m?void 0:m.id,userId:null==g?void 0:g.id}),y=(0,v.useCallback)((t=>{if((0,o().trackAssistantSlackUnfurlAiActionEvent)({environment:r,action:t.key,interaction:"clicked"}),"feature"===d){if(!e)return;(0,o().trackAssistantSlackUnfurlAiActionEvent)({environment:r,action:t.key,interaction:"triggered"}),async function(e){const{environment:t,url:n,prompt:a}=e;await(0,sd().toggleInitialPrompt)({from:"rich_text_menu",environment:t});const i=Qe().default.state;if("assistantCompletionPopup"!==i.type)return;Qe().default.setState({...i,stage:"results"});const{currentUserSettingsStore:s,currentUserStore:o,sidebarSpaceViewStore:r}=I().default.state;s&&(0,we().setLastUsedAIWriterAtToCurrentTimestamp)(t,{userSettingsStore:s});await rd().assistantWriterActions.refreshAssistantCompletion({environment:t,updater:Qe().default.createUpdater(),humanText:[[n,[["a",n]]],[` ${a}`]],from:Fe().wy.writer.type});const l=(0,At().K1)();o&&r&&l&&Se().createAndCommit({userAction:"assistant.saveRecent",environment:t,canUndo:!0,perform:e=>(0,Pr().Wq)({environment:t,transaction:e,currentUserStore:o,currentSpaceViewStore:r,fromAssistantSurface:Fe().wy.writer.type,assistantSessionContext:l})})}({environment:r,url:e,prompt:Jc().A.formatMessage(t.titleMessage)})}else"modal_onboarding"===d?f&&((0,o().trackAssistantSlackUnfurlAiActionEvent)({environment:r,action:t.key,interaction:"announcement_modal_opened"}),(0,go().pp)({environment:r,connector:"slack",analyticsFrom:"link_preview_unfurl_menu_ai_connector_action",connectorsFeatureAvailability:f})):"modal_in_progress"===d?((0,o().trackAssistantSlackUnfurlAiActionEvent)({environment:r,action:t.key,interaction:"progress_modal_opened"}),(0,we().openConnectorInProgressModal)({environment:r,connector:"slack",from:"slack_unfurl_ai_action"})):"hidden"===d||(0,X().HB)(d)}),[d,e,r,f]),S=p.map((e=>({key:e.key,action:()=>{(0,o().trackAssistantSlackUnfurlAiActionEvent)({environment:r,action:e.key,interaction:"clicked"}),y(e),s()},render:t=>(0,fe.jsx)(Kn().A,{...t,icon:(0,fe.jsx)("img",{src:de().A.images.externalIntegrations.slackIconPng,style:u.icon,alt:"slack icon"}),title:Jc().A.formatMessage(e.titleMessage),onMouseEnter:e=>{t.onMouseEnter(e),i(e)},style:n})})));if(!("hidden"!==d&&l&&e&&c&&f))return null;return{key:"skill_options",render:e=>(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(jo().A,{style:a,isSmall:!C().A.isMobile,isSecondaryColor:!C().A.isMobile,children:Jc().A.formatMessage(dd.askAiSlackPasteMenuSectionHeader)}),(0,fe.jsx)($n().A,{...e,topBorder:!1})]}),items:S}}({url:n,integration:a,headerStyle:i,menuTextStyle:s,onMouseEnter:e=>{r("preview",d,c)},handleDismiss:()=>{l("preview",c)}});return(0,wn().w)((()=>{Boolean(u)&&(0,o().trackAssistantSlackUnfurlAiActionEvent)({environment:c,action:"summarize",interaction:"seen"})})),t({maybeAiActionSection:u})}const dd=(0,Q().YK)({askAiSlackPasteMenuSectionHeader:{defaultMessage:"Ask AI",id:"unfurlingMenu.askAiSlackPasteMenuSectionHeader"},askAiSlackPasteMenuSummarizeAction:{defaultMessage:"Summarize this thread",id:"unfurlingMenu.askAiSlackPasteMenuSummarizeAction"}});var ud=()=>n(265060),pd=()=>n(203717),gd=()=>n(123423),md=()=>n(861243);const hd=(0,Q().YK)({outlookBodyWithAddOn:{defaultMessage:"Ask questions about your Outlook emails and more.",id:"AIConnectorSidebarNotification.outlookBodyWithAddOn"},outlookBodyWithoutAddOn:{defaultMessage:"Notion AI can now answer questions about your Outlook emails and more.",id:"AIConnectorSidebarNotification.outlookBodyWithoutAddOn"},"google-calendarBodyWithAddOn":{defaultMessage:"Ask questions about your Google Calendar events and more.",id:"AIConnectorSidebarNotification.google-calendarBodyWithAddOn"},"google-calendarBodyWithoutAddOn":{defaultMessage:"Notion AI can now answer questions about your Google Calendar events and more.",id:"AIConnectorSidebarNotification.google-calendarBodyWithoutAddOn"},asanaBodyWithAddOn:{defaultMessage:"Ask questions about your Asana tasks and projects and more.",id:"AIConnectorSidebarNotification.asanaBodyWithAddOn"},asanaBodyWithoutAddOn:{defaultMessage:"Notion AI can now answer questions about your Asana tasks and projects and more.",id:"AIConnectorSidebarNotification.asanaBodyWithoutAddOn"},boxBodyWithAddOn:{defaultMessage:"Ask questions about your Box files.",id:"AIConnectorSidebarNotification.boxBodyWithAddOn"},boxBodyWithoutAddOn:{defaultMessage:"Notion AI can now answer questions about your Box files.",id:"AIConnectorSidebarNotification.boxBodyWithoutAddOn"},salesforceBodyWithAddOn:{defaultMessage:"Ask questions about your Salesforce records.",id:"AIConnectorSidebarNotification.salesforceBodyWithAddOn"},salesforceBodyWithoutAddOn:{defaultMessage:"Notion AI can now answer questions about your Salesforce records.",id:"AIConnectorSidebarNotification.salesforceBodyWithoutAddOn"}}),fd=(0,Q().YK)({titleWithAddOn:{defaultMessage:"Get {connector} answers in Notion",id:"AIConnectorSidebarNotification.titleWithAddon"},titleWithoutAddOn:{defaultMessage:"Get {connector} answers in Notion",id:"AIConnectorSidebarNotification.titleWithoutAddon"},ctaButtonLabelWithAddOn:{defaultMessage:"Connect {connector}",id:"AIConnectorSidebarNotification.ctaButtonLabelWithAddon"}});function yd(e){const{connector:t}=e,n=(0,T().v3)(),a=(0,Q().tz)(),i=Ar().w0[t],s=(0,x().r)(),o=n.currentUser.id,r=(0,Xe()._)({name:"ai_connectors",spaceId:s,userId:o}),l=(0,v.useCallback)((()=>{(0,go().pp)({environment:n,connector:t,analyticsFrom:"ai_connector_sidebar_notification",connectorsFeatureAvailability:r})}),[t,r,n]),c=(0,Hr().q1)(t)||(0,$().e2)(r);return(0,fe.jsx)(md().Y,{messageKey:`ai_connector_${t}_sidebar_notification`,title:a.formatMessage(c?fd.titleWithAddOn:fd.titleWithoutAddOn,{connector:i}),heroElement:(0,fe.jsx)(ud().Q,{style:{marginInlineStart:4},overrideSize:()=>26,iconGroup:pd().G[t],variantName:"default"}),body:a.formatMessage(c?hd[`${t}BodyWithAddOn`]:hd[`${t}BodyWithoutAddOn`],{connector:i}),buttons:[{text:a.formatMessage(c?fd.ctaButtonLabelWithAddOn:Zs().D.getNotionAI,{connector:i}),onClick:l,rightIcon:gd().arrowStraightRightFillIcon}]})}var vd=()=>n(412237),Sd=()=>n(53436),bd=()=>n(326496),xd=()=>n(893497);const Id=(0,Q().YK)({askAIButtonLabel:{defaultMessage:"Ask AI",id:"fileBlock.askAI.button.label"},askAIAriaLabel:{defaultMessage:"Ask AI",id:"fileBlock.askAI.button.ariaLabel"}});function kd(e){const{visible:t,fileBlockStore:n}=e,s=(0,Q().tz)(),o=(0,T().v3)(),r=(0,j().O$)(Te().bX),l=(0,he().i7)(),c=!(0,j().O$)(D().e),d=(0,j().K8)((()=>(0,a().isSelectionValidAttachmentSelection)([n])),[n]),u=(0,v.useCallback)((e=>{if(l){if(!r)return;(0,i().openAgentSidebarFromAttachmentBlockSelection)({environment:o,selectedAttachmentStore:n,inferenceContext:r})}e.preventDefault(),e.stopPropagation()}),[o,n,r,l]),p=(0,M().IS)((()=>({wrapper:{position:"absolute",zIndex:1,top:0,insetInlineEnd:0}})),[]);return c?null:d?(0,fe.jsx)(xd().L,{visible:t,style:p.wrapper,children:(0,fe.jsx)(Sd().E,{"aria-label":s.formatMessage(Id.askAIAriaLabel),children:(0,fe.jsx)(bd().e,{"aria-label":s.formatMessage(Id.askAIAriaLabel),onClick:u,iconLeading:vd().aiFaceSmallIcon,children:(0,fe.jsx)(Q().sA,{...Id.askAIButtonLabel})})})}):null}},977680:(e,t,n)=>{n.d(t,{z:()=>d});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(581454);var a=n(296540),i=()=>n(300474),s=()=>n(59226),o=()=>n(484714),r=()=>n(110443);const l=5*n(615234).Xb,c={};function d(){const e=(0,o().v3)(),t=(0,i().r)(),n=(0,s().X)("workflows_mcp_server_module_available"),[d,u]=(0,a.useState)((()=>c.servers)),[p,g]=(0,a.useState)((()=>c.serverUrls??new Set)),[m,h]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{let a=!0;return n&&t?Boolean(c.servers&&c.serverUrls&&c.fetchedAt&&Date.now()-c.fetchedAt<l)?(u(c.servers),g(c.serverUrls??new Set),()=>{a=!1}):c.fetchPromise?(h(!0),c.fetchPromise.then((()=>{a&&c.servers&&c.serverUrls&&(u(c.servers),g(c.serverUrls)),a&&h(!1)})),()=>{a=!1}):(h(!0),c.fetchPromise=(async()=>{const n=await e.api.callApi({environment:e,eventName:"getPreconfiguredMcpServers",data:{spaceId:t}}),i=Date.now();"success"===n.type?(c.servers=n.data.servers,c.serverUrls=function(e){return new Set(e.map((e=>(0,r().Yl)(e.serverUrl))))}(c.servers)):(c.servers=[],c.serverUrls=new Set),c.fetchedAt=i,c.fetchPromise=void 0,a&&(u(c.servers),g(c.serverUrls),h(!1))})(),()=>{a=!1}):(u([]),g(new Set),()=>{a=!1})}),[e,n,t]),{servers:d,serverUrls:p,isLoading:m}}},979330:(e,t,n)=>{n.d(t,{n:()=>i});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"1.32 2.19 13.36 12.32",svg:(0,n(474848).jsx)("path",{d:"M13.425 7.883c0-2.294-1.961-4.31-5.116-4.434L8 3.444c-3.335 0-5.426 2.071-5.426 4.44l.005.207c.053 1.033.497 1.975 1.251 2.709a.63.63 0 0 1 .181.547 6 6 0 0 1-.603 1.84c.764-.138 1.466-.493 2.095-1.009l.063-.045a.63.63 0 0 1 .506-.072A7 7 0 0 0 8 12.322l.309-.005c3.154-.124 5.116-2.14 5.116-4.434m1.242.3c-.164 2.978-2.767 5.24-6.31 5.383L8 13.572a8.3 8.3 0 0 1-1.962-.229c-1.09.81-2.411 1.286-3.9 1.132a.625.625 0 0 1-.405-1.032c.537-.617.835-1.31.986-1.996a5.26 5.26 0 0 1-1.388-3.29l-.007-.274c0-3.226 2.832-5.69 6.676-5.69l.358.007c3.66.148 6.317 2.558 6.317 5.683z"})},i=(0,n(340498).wt)("chatBubbleSmall",a,"small")},980319:(e,t,n)=>{n.d(t,{iY:()=>F,$b:()=>V,w_:()=>N,dM:()=>L,eL:()=>O,be:()=>z});n(944114),n(898992),n(581454),n(737550);var a=n(296540),i=()=>n(907258),s=()=>n(806551),o=()=>n(933528),r=()=>n(902006),l=()=>n(203717),c=()=>n(682759),d=()=>n(822423);const u=(0,n(340498).xh)("link",{default:{loader:()=>n.e(80401).then(n.bind(n,742852))},small:{loader:()=>n.e(80401).then(n.bind(n,703778))},fill:{loader:()=>n.e(80401).then(n.bind(n,883422))},fillSmall:{loader:()=>n.e(80401).then(n.bind(n,517837))}},["hyperlink","connect","URL","join","network"]);var p=()=>n(374693),g=()=>n(499919),m=()=>n(498212),h=()=>n(534177),f=()=>n(716500),y=()=>n(255350),v=()=>n(699143),S=()=>n(81068),b=()=>n(241178),x=()=>n(510818),I=()=>n(813679),k=()=>n(996918),w=n(474848);function C(e,t,n){const a=function(e){const t=(0,o().f9)(e.id);if(!t||t.type!==e.searchSourceType)return;if("slack"===t.type)return(0,b().mQ)(t);return t.url}(e);if(a)return{key:`${e.searchSourceType}:${e.id}`,render:i=>(0,w.jsx)(A,{...i,result:e,href:a,hoverStore:t,showUsedByLLM:n}),action:()=>{}}}function A(e){const{result:t,href:n,hoverStore:a,showUsedByLLM:i,...s}=e,o=L(function(e){if("helpdocs"===e||"helpdoc-section"===e)return"helpdocs";return e}(t.searchSourceType)),l=function(e){if("slack"===e.searchSourceType)return(0,x().Mw)(e.text);return(0,x().Mw)(e.title)}(t),c=function(e){switch(e.searchSourceType){case"slack":return`#${e.channel}`;case"gmail":case"google-calendar":case"notion-calendar":case"notion-mail":return e.lastEdited;default:return e.path}}(t);return(0,w.jsx)(S().A,{...s,...(0,I().g$)(),onMouseEnter:e=>{a.setState({type:"list",node:e.currentTarget,citationType:"universal_search",href:(0,r().Ve)(t.id)})},onMouseLeave:()=>{a.reset()},title:(0,w.jsxs)(v().Y1,{direction:"horizontal",align:"center-left",gap:2,style:{minWidth:0,flexShrink:0},children:[(0,w.jsx)(I().hL,{children:l}),i?(0,w.jsx)(k().M,{}):void 0]}),href:n,icon:(0,w.jsx)(I().$x,{iconGroup:o??u,iconSize:"sm"}),right:(0,w.jsx)(I().FD,{caption:c}),external:!0})}function T(e){const{title:t,url:n,caption:a,showUsedByLLM:i,...s}=e;return(0,w.jsx)(S().A,{...s,...(0,I().g$)(),title:(0,w.jsxs)(v().Y1,{direction:"horizontal",align:"center-left",gap:2,style:{minWidth:0,flexShrink:0},children:[(0,w.jsx)(I().hL,{children:t}),i?(0,w.jsx)(k().M,{}):void 0]}),href:n,icon:(0,w.jsx)(I().$x,{iconGroup:c().s,iconSize:"sm"}),right:(0,w.jsx)(I().FD,{caption:a}),external:!0})}var j=()=>n(124972),M=()=>n(807449),_=()=>n(98126),P=()=>n(742852),D=()=>n(69708),E=()=>n(939768);function R(e){const{url:t,showUsedByLLM:n,...a}=e,i=[],s=(0,E().qh)(t);let o;return s&&i.push(`https://www.google.com/s2/favicons?domain=${s}&sz=64`),o=e.title?e.title:(0,w.jsx)(D().sA,{id:"WebpageSearchResultMenuItem.untitled",defaultMessage:"Untitled"}),(0,w.jsx)(S().A,{...a,...(0,I().g$)(),title:(0,w.jsxs)(v().Y1,{direction:"horizontal",align:"center-left",gap:2,style:{minWidth:0,flexShrink:0},children:[(0,w.jsx)(I().hL,{children:o}),n?(0,w.jsx)(k().M,{}):void 0]}),href:t,right:(0,w.jsx)(I().FD,{caption:s}),icon:(0,w.jsx)(B,{urls:i,alt:e.title}),external:!0})}function B(e){const{urls:t,alt:n}=e,[i,s]=(0,a.useState)(0),[o,r]=(0,a.useState)(!1),[l,c]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{const e=new Image;e.src=t[i],e.onload=()=>{r(!0)},e.onerror=()=>{t.length>i+1?s((e=>e+1)):(c(!0),r(!0))}}),[t,i]),o?l?(0,w.jsx)(M().I,{icon:P().linkIcon}):(0,w.jsx)("img",{src:t[i],alt:n,style:{borderRadius:4,width:20,height:20}}):(0,w.jsx)(_().A,{size:"sm"})}function F({isCohereRankingEnabled:e,resultStep:t,overrideResults:n}){const a=t.result??{},i=function(e){const t=new Map;for(const n of e){const e=n.searchSourceType,a=t.get(e)??[];a.push(n),t.set(e,a)}return t}(n??a.extractedResults??(0,s().S)(a)),o=e?function(e){for(const[t,n]of e)n.sort(((e,t)=>(t.score??0)-(e.score??0)));return e}(i):function(e){const t=Array.from(e.entries()).sort((([e,t],[n,a])=>a.length-t.length));return new Map(t)}(i),r=function(e){const t=Array.from(e.entries()).sort((([e,t],[n,a])=>{const i=Math.max(...t.map((e=>e.cohereRelevanceScoreForRanking??0)));return Math.max(...a.map((e=>e.cohereRelevanceScoreForRanking??0)))-i})).sort((([e,t],[n,a])=>{const i=t.some((e=>e.isPrimarySource));return i!==a.some((e=>e.isPrimarySource))?i?-1:1:0}));return new Map(t)}(o);return function(e){const t=Array.from(e.entries()).sort((([e,t],[n,a])=>{const i=t.some((e=>e.isPrimarySource)),s=a.some((e=>e.isPrimarySource)),o="google-calendar"===e||"notion-calendar"===e,r="google-calendar"===n||"notion-calendar"===n;return o===r?0:o&&!i?1:r&&!s?-1:0}));return new Map(t)}(r)}function N(e){const t=[];for(const n of e.values())t.push(...n);return t.sort(((e,t)=>(t.cohereRelevanceScoreForRanking??0)-(e.cohereRelevanceScoreForRanking??0))).slice(0,20)}function L(e){return"notion"===e?p()._:"webpage"===e?d().u:"helpdocs"===e||"helpdoc-section"===e?c().s:"top-results"!==e?(0,h().uv)(l().G).includes(e)?l().G[e]:u:void 0}function O(e){const{index:t,result:n,environment:a,spaceStore:i,hoverStore:s,threadStore:r,showUsedByLLM:l}=e;if("webpage"===n.searchSourceType)return function({index:e,id:t,title:n,showUsedByLLM:a}){var i;const s=null===(i=(0,o().OU)(t))||void 0===i?void 0:i.url;if(s)return{key:`web_result:${t}:${e}`,render:e=>(0,w.jsx)(R,{...e,id:t,title:n,url:s,showUsedByLLM:a}),action:()=>{}}}({index:t,id:n.id,title:n.title,showUsedByLLM:l});if("notion"===n.searchSourceType){if(n.isUser)return(0,j().h)({index:t,spaceStore:i,userId:(0,g().AF)({prefix:"user",id:n.id})});{const e=(0,m().uj)(n.id)?n.id:(0,g().AF)({prefix:"pageOrCollectionViewBlock",id:n.id});return(0,j().L)({index:t,blockId:e,environment:a,spaceStore:i,threadStore:r,showUsedByLLM:l})}}if("helpdocs"===n.searchSourceType||"helpdoc-section"===n.searchSourceType){const e=function(e){var t;const{index:n,result:a,showUsedByLLM:i}=e;if("helpdocs"!==a.searchSourceType&&"helpdoc-section"!==a.searchSourceType)return;const s=null===(t=(0,o().OU)(a.path))||void 0===t?void 0:t.url;return{key:`helpdoc:${a.id}:${n}`,render:e=>(0,w.jsx)(T,{...e,title:a.title,caption:a.path,url:s,showUsedByLLM:i}),action:()=>{}}}({index:t,result:n,environment:a,spaceStore:i,showUsedByLLM:l});return e}n.searchSourceType;return C(n,s,l)}function V({searchSourceType:e,environment:t,intl:n}){var a;const{sidebarSpaceStore:s}=i().default.state;if(!s)return;const o=function(e){switch(e){case"helpdoc-section":return{type:"helpdocs"};case"webpage":return{type:"web"};case"custom":return{type:"custom"};default:return{type:e}}}(e);return null===(a=(0,y().tu)({environment:t,searchScope:o,spaceStore:s,intl:n,showEverythingLabel:!0}))||void 0===a?void 0:a.scopeTitle}function z(e){const{citationContext:t}=e;return(0,a.useCallback)((e=>{const n=null==t?void 0:t[e];if(!n)return;const a=(0,o().f9)(n.id);if(a&&"block"!==a.type)if("helpdoc"===a.type){if("helpdocs"===n.searchSourceType)return{...a,type:"helpdoc",url:a.url,title:n.title,text:"",lastEdited:n.lastEdited,href:(0,r().h5)(a.href)}}else if("webpage"===a.type){if("webpage"===n.searchSourceType)return{...a,type:"webpage",url:a.url,title:n.title,text:"",lastEdited:n.lastEdited,href:(0,r().RW)(a.href)}}else{if("helpdoc-section"!==a.type){if("database_query_results"===a.type)return;if("citation_unsupported"===a.type)return;return(0,f().K)(a.type).getPayloadDataForHrefCallback({context:n,parsedData:a})}if("helpdoc-section"===n.searchSourceType)return{...a,type:"helpdoc-section",url:a.url,title:n.title,text:"",lastEdited:n.lastEdited,href:(0,r().w3)(a.href)}}}),[t])}},989616:(e,t,n)=>{n.d(t,{R:()=>s});n(581454);var a=()=>n(712453),i=()=>n(718957);function s(e,t=!1){if(t){const t=(0,i().BO)(e);if(t){const e={multiSelection:t,mode:"editing",forceExtendAnnotations:{}};return(0,a().O)(e)}}return e.map((e=>e.getTitleValue())).join("\n")}},989826:(e,t,n)=>{n.d(t,{v:()=>u});n(16280);var a=()=>n(726637),i=()=>n(68169),s=()=>n(938108),o=()=>n(319625),r=()=>n(973647);const l=(0,n(583835).Dv)("processAgentAttachment");var c=()=>n(357625);const d="user_upload";async function u(e){const{fileName:t,contentType:n,fileId:a,progressCallback:i}=e,o=(0,s().tD)({step:"pdf-processing",progressPercentDecimal:0}),r=await(0,s().o7)({initialProgress:o,estimatedDurationMs:1e4,progressCallback:e=>{i({fileName:t,progress:e,uniqueFileIdentifier:a,contentType:n})},operation:p(e)});return i({fileName:t,progress:100,uniqueFileIdentifier:a,contentType:n}),r}async function p(e){try{const{originalFileUrl:t,threadPointer:n,fileName:s,environment:o}=e,u={url:t,spaceId:n.spaceId,aiSessionPointer:n,source:d,clientVersion:a().A.version},p=(0,c().UT)(o,l,u,{spaceIds:[n.spaceId]}),g=["failure","timeout_before_execution","dead"];for await(const e of p){if(r().Q.isFail(e)||e.taskStatus in g)return r().Q.fail({code:"PROCESSING_FAILED",message:"Processing failed",error:new Error("Processing timed out or failed to complete.")});if("success"===e.taskStatus){const a=e.value.result;if("error"===a.type)return r().Q.fail(a.data);const o=a.data,l=n.id,c=(0,i().tX)({result:o,attachmentSource:d,fileName:s,originalFileUrl:t,threadId:l});return void 0===c?r().Q.fail({code:"UNSUPPORTED_CONTENT_TYPE",message:"Content type mismatch"}):r().Q.success(c)}}}catch(t){return r().Q.fail({code:"PROCESSING_FAILED",message:"Processing failed",error:(0,o().A)(t)})}return r().Q.fail({code:"PROCESSING_FAILED",message:"Failed to process the file",error:new Error("Processing timed out or failed to complete.")})}},995277:(e,t,n)=>{n.d(t,{p:()=>oe});n(16280),n(18107),n(944114),n(967357),n(898992),n(354520),n(672577),n(581454);var a=()=>n(907258),i=()=>n(755531),s=()=>n(624919),o=()=>n(675133),r=()=>n(792057),l=()=>n(849255),c=()=>n(457726),d=()=>n(24279),u=()=>n(832093),p=()=>n(353566),g=()=>n(691309),m=()=>n(436468),h=()=>n(706461),f=()=>n(153996),y=(n(430670),()=>n(416504)),v=()=>n(201980),S=()=>n(404931);function b(e){return e.split("\n").map((e=>e.trim())).join("\n").trim()}var x=()=>n(206267),I=()=>n(792071),k=()=>n(795727),w=()=>n(798880),C=()=>n(999752),A=()=>n(496603),T=()=>n(534177),j=()=>n(769864),M=()=>n(354785),_=()=>n(68465),P=()=>n(466088),D=()=>n(562031),E=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(823215),n(737550),()=>n(943290));class R{addUpdaterToEvaluatorStateCallbacks(){const e=this;this.write((()=>{e.getEvaluatorStateCallbacks().setUpdater(e)}))}async runTransaction(e,t){const n=this.getReadOnlySessionContext(),a=[...n.temporaryClientStepsFromStoreState],i=[...n.temporaryExecutableOperationsFromStoreState],s=this.getInternalTransactionController(),o=this;this.write((()=>{o.getEvaluatorStateCallbacks().setUpdater(o),s.clearTemporaryState(e)}));const r={revertToPreviousTemporaryState(){o.write((()=>{s.restoreTemporaryState({temporaryClientSteps:a,temporaryExecutableOperations:i})}))}};return await t(r)}}class B{constructor(e){this.assistantRuntimeStore=void 0,this.assistantConfigurationStore=void 0,this.sessionMetadata=void 0,this.caches=new(n(144391).au),this.urlAtStartOfSession=void 0,this.currentHumanStepSubmissionInfo=void 0,this.groupedPendingOperations=new(n(140934).ComputedStore)((()=>{const e=this.getAllPendingExecutableOperations();return(0,E().iL)(e)}),{debugName:"AssistantSessionContext.groupedPendingOperations"}),this.assistantRuntimeStore=e.assistantRuntimeStore,this.assistantConfigurationStore=e.assistantConfigurationStore,this.sessionMetadata=e.sessionMetadata,this.urlAtStartOfSession=e.urlAtStartOfSession}get assistantRuntimeStoreState(){return this.assistantRuntimeStore.state}get assistantConfigurationStoreState(){return this.assistantConfigurationStore.state}get sessionIdFromStoreState(){return this.assistantConfigurationStoreState.sessionId}getRuntimeStateUnsafeForTests(){return this.assistantRuntimeStoreState}get selectedSkillFromStoreState(){return this.assistantRuntimeStoreState.selectedSkill}get selectedSuggestionGroupFromStoreState(){return this.assistantRuntimeStoreState.selectedSuggestionGroup}get clientStepsFromStoreState(){return this.assistantRuntimeStoreState.clientSteps}get temporaryClientStepsFromStoreState(){return this.assistantRuntimeStoreState.temporaryClientSteps}get temporaryOperationsFromStoreState(){return this.assistantRuntimeStoreState.temporaryExecutableOperations.flatMap((({operations:e})=>e))}get temporaryExecutableOperationsFromStoreState(){return this.assistantRuntimeStoreState.temporaryExecutableOperations}get previewingStepFromStoreState(){return this.assistantRuntimeStoreState.previewingStep}get previewingStateFromStoreState(){return this.assistantRuntimeStoreState.previewingState}get previewingStepObservationsFromStoreState(){return this.assistantRuntimeStoreState.previewingStepObservations}get evaluatorFromStoreState(){return this.assistantRuntimeStoreState.evaluator}get showGetSupportPillFromStoreState(){return this.assistantRuntimeStoreState.showGetSupportPill}get isCurrentlyCommittingHumanStepFromStoreState(){return this.assistantRuntimeStoreState.isCurrentlyCommittingHumanStep}get loadedPageVariableCounterFromStoreState(){return this.assistantRuntimeStoreState.loadedPageVariableCounter}get didScrollToTemporaryEditFromStoreState(){return this.assistantRuntimeStoreState.didScrollToTemporaryEdit}get attributionActorFromStoreState(){return this.assistantRuntimeStoreState.attributionActor}get sampledStepsFromStoreState(){return this.assistantRuntimeStoreState.sampledSteps}get latestCommitInferenceIdFromStoreState(){return this.assistantRuntimeStoreState.latestCommitInferenceId}get uncommittedOperationsFromStoreState(){return this.assistantRuntimeStoreState.uncommittedExecutableOperations.flatMap((({operations:e})=>e))}get preventSelectionFromStoreState(){return this.assistantConfigurationStoreState.preventSelection}get actionCardIdForLoggingFromStoreState(){return this.assistantRuntimeStore.state.actionCardIdForLogging}hasPendingOperations(){return this.getAllPendingOperations().length>0}get uncommittedExecutableOperationsFromStoreState(){return this.assistantRuntimeStoreState.uncommittedExecutableOperations}get executedOperationsMapFromStoreState(){return this.assistantRuntimeStoreState.executedOperationsMap}getPreviewingStepErrorObservations(){return this.previewingStepObservationsFromStoreState.filter((e=>"error"===e.observationType))}hasPreviewingStepErrorObservations(){return this.getPreviewingStepErrorObservations().length>0}getCombinedSteps(){return[...this.assistantRuntimeStoreState.clientSteps||[],...this.assistantRuntimeStoreState.temporaryClientSteps||[]]}getCombinedStepsWithAssistantOutput(){return this.getCombinedSteps().filter((e=>c().xg[e.type]))}getLatestCachedID(){return this.assistantRuntimeStoreState.randomIdCache[this.assistantRuntimeStoreState.randomIdIndex]}getHasCommittedHumanStep(){return this.clientStepsFromStoreState.some((e=>"human"===e.type))||this.assistantRuntimeStoreState.isCurrentlyCommittingHumanStep}getAllPendingOperations(){return[...this.uncommittedOperationsFromStoreState,...this.temporaryOperationsFromStoreState]}getAllPendingExecutableOperations(){return[...this.uncommittedExecutableOperationsFromStoreState,...this.temporaryExecutableOperationsFromStoreState]}getAllPendingNonCreateExecutableOperations(){return this.groupedPendingOperations.state.filter(E().Wd)}isStreaming(){return Boolean(this.assistantConfigurationStoreState.evaluating||this.assistantConfigurationStoreState.sampling)}getAssistantResponseCategory(e){return this.assistantRuntimeStoreState.assistantResponseCategoryByInferenceId[e]}incrementRandomIDIndex(){this.assistantRuntimeStore.updateState({randomIdIndex:this.assistantRuntimeStore.state.randomIdIndex+1})}resetRandomIDIndex(){this.assistantRuntimeStore.updateState({randomIdIndex:0})}resetRandomIDCache(){this.assistantRuntimeStore.updateState({randomIdIndex:0,randomIdCache:[]})}addToRandomIDCache(e){this.assistantRuntimeStore.updateState({randomIdCache:[...this.assistantRuntimeStoreState.randomIdCache,e],randomIdIndex:this.assistantRuntimeStoreState.randomIdIndex+1})}setIsCurrentlyCommittingHumanStep(e){this.assistantRuntimeStore.updateState({isCurrentlyCommittingHumanStep:e})}clearPreviewingStep(){this.assistantRuntimeStore.updateState({sampledSteps:[],previewingStep:void 0,previewingStepIndex:void 0,previewingState:void 0,previewingStepObservations:[],temporaryExecutableOperations:[],temporaryClientSteps:[]})}setClientStepsAndClearPreviewingStep(e){this.assistantRuntimeStore.updateState({clientSteps:e}),this.clearPreviewingStep()}commitPreviewingStep(){this.setClientStepsAndClearPreviewingStep([...this.assistantRuntimeStoreState.clientSteps,...this.assistantRuntimeStoreState.temporaryClientSteps])}addClientStep(e,t){this.assistantRuntimeStore.updateState({clientSteps:[...this.assistantRuntimeStoreState.clientSteps,e]})}upsertClientStep(e){const{typeFilter:t,extraFilter:n,factory:a,stepIndex:i}=e;if(i<0)throw new Error("stepIndex must be >= 0");const s=this.assistantRuntimeStoreState.clientSteps,o=s.at(i),r=s.slice(0,i),l=s.slice(i+1);o&&t(o)&&(!n||n(o))?this.assistantRuntimeStore.updateState({clientSteps:[...r,a(o),...l]}):o&&this.assistantRuntimeStore.updateState({clientSteps:[...r,a(void 0),o,...l]})}removeClientStep(e){this.assistantRuntimeStore.updateState({clientSteps:this.assistantRuntimeStoreState.clientSteps.filter((t=>t!==e))})}addTemporaryClientStep(e){this.assistantRuntimeStore.updateState({temporaryClientSteps:[...this.assistantRuntimeStoreState.temporaryClientSteps,e]})}removeTemporaryClientStep(e){this.assistantRuntimeStore.updateState({temporaryClientSteps:this.assistantRuntimeStoreState.temporaryClientSteps.filter((t=>t!==e))})}addTemporaryGroupedEditCardClientStep(e){e.executableOperationIds&&this.clearGroupedEditCardStepsForExecutableOperationIds(e.executableOperationIds),this.assistantRuntimeStore.updateState({temporaryClientSteps:[...this.assistantRuntimeStoreState.temporaryClientSteps,e]})}addTemporaryExecutableOperation(e){this.assistantRuntimeStore.updateState({temporaryExecutableOperations:[...this.assistantRuntimeStoreState.temporaryExecutableOperations,e]})}clearGroupedEditCardStepsForExecutableOperationIds(e){const t=[],n=this.assistantRuntimeStoreState.clientSteps;for(const i of n)if("groupedEditCard"===i.type){var a;const n=(null===(a=i.executableOperationIds)||void 0===a?void 0:a.filter((t=>!e.includes(t))))??[];n.length>0&&t.push({...i,executableOperationIds:n})}else t.push(i);this.assistantRuntimeStore.updateState({clientSteps:t})}clearClientStepsIncludingTemporary(){this.assistantRuntimeStore.updateState({clientSteps:[],temporaryClientSteps:[]})}incrementLoadedPageVariableCounter(){this.assistantRuntimeStore.updateState({loadedPageVariableCounter:this.assistantRuntimeStoreState.loadedPageVariableCounter+1})}setSampledSteps(e){this.assistantRuntimeStore.updateState({sampledSteps:e})}setDidScrollToTemporaryEdit(e){this.assistantRuntimeStore.updateState({didScrollToTemporaryEdit:e})}replaceTemporaryState(e){this.assistantRuntimeStore.updateState({temporaryClientSteps:[],temporaryExecutableOperations:[],...e})}updatePreviewingStep(e){this.assistantRuntimeStore.updateState(e)}addTemporaryOperationsToUncommittedOperations(){this.assistantRuntimeStore.updateState({uncommittedExecutableOperations:[...this.assistantRuntimeStoreState.uncommittedExecutableOperations,...this.assistantRuntimeStoreState.temporaryExecutableOperations]})}setShowGetSupportPill(e){this.assistantRuntimeStore.updateState({showGetSupportPill:e})}setAssistantResponseCategory(e){const{inferenceId:t,category:n}=e;this.assistantRuntimeStore.update((e=>({...e,assistantResponseCategoryByInferenceId:{...e.assistantResponseCategoryByInferenceId??{},[t]:n}})))}addExecutableOperationsToExecutedOperationMap(e){for(const n of e){var t;const e=null===(t=(0,E().iL)([n]).at(0))||void 0===t?void 0:t.pageId;e&&this.assistantRuntimeStore.state.executedOperationsMap.set(e,[...this.assistantRuntimeStoreState.executedOperationsMap.get(e)||[],n])}}getFromExecutedOperationsMap(e){return this.assistantRuntimeStoreState.executedOperationsMap.get(e)}getAndDeleteFromExecutedOperationsMap(e,t){const n=this.assistantRuntimeStoreState.executedOperationsMap.get(e),a=null==n?void 0:n.filter((e=>t.includes(e.id))),i=null==n?void 0:n.filter((e=>!t.includes(e.id)));return i&&i.length>0?this.assistantRuntimeStore.state.executedOperationsMap.set(e,i):this.assistantRuntimeStore.state.executedOperationsMap.delete(e),a}getGroupedEditCardStepForGroup(e){const t=(0,E().qT)([e]),n=this.clientStepsFromStoreState.filter(c().XS).find((n=>n.pageId===e.pageId&&t.every((e=>{var t;return null===(t=n.executableOperationIds)||void 0===t?void 0:t.includes(e)}))));return{step:n,stepIndex:n?this.clientStepsFromStoreState.indexOf(n):-1}}getHumanActionCardInsertIndex(e,t){const{step:n,stepIndex:a}=this.getGroupedEditCardStepForGroup(e);if(!n||-1===a)return;const i=this.clientStepsFromStoreState.findIndex((e=>{var a;return"humanAction"===e.type&&e.action===t&&(null===(a=e.executableOperationIds)||void 0===a?void 0:a.every((e=>{var t;return null===(t=n.executableOperationIds)||void 0===t?void 0:t.includes(e)})))})),s=-1===i?a:i;return(0,T().O9)(s)&&s<0?void 0:s}clearExecutedOperationsMap(){this.assistantRuntimeStore.updateState({executedOperationsMap:new Map})}prependUncommittedOperations(e){this.assistantRuntimeStore.updateState({uncommittedExecutableOperations:[...e,...this.assistantRuntimeStoreState.uncommittedExecutableOperations]})}clearUncommittedOperations(e={}){const{onlyClearOperationIds:t}=e,n=(0,T().O9)(t)?new Set(t):void 0,a=this.assistantRuntimeStoreState.uncommittedExecutableOperations;return this.assistantRuntimeStore.updateState({uncommittedExecutableOperations:(0,T().O9)(n)?this.assistantRuntimeStoreState.uncommittedExecutableOperations.filter((e=>!n.has(e.id))):[]}),a.filter((e=>!(0,T().O9)(n)||n.has(e.id)))}setPendingStepValue(e){const{step:t}=e,n=this.assistantRuntimeStore.state.sampledSteps.map((e=>e.id===t.id?t:e));this.assistantRuntimeStore.updateState({sampledSteps:n})}selectSuggestionGroup(e){this.assistantRuntimeStore.updateState({selectedSuggestionGroup:e})}async runSerialized(e){return await this.assistantRuntimeStoreState.queue.enqueue(e)}getCollectionTargetForPendingPage(e){const{environment:t,pageId:a}=e,i=new(n(295633).B)(t,{id:a,table:n(179034).ev},{inMemoryRecordCache:this.caches.updatesCache}).getParentPointer();if((null==i?void 0:i.table)===n(519831).Vl)return new(n(732810).m)(t,i)}createUpdater(){const e=this;return new class extends R{constructor(...e){super(...e),this.valid=!0}write(t){this.valid&&t(e)}isValid(){return this.valid}invalidate(){this.valid=!1}getReadOnlySessionContext(){return e}getEvaluatorStateCallbacks(){return e.evaluatorFromStoreState.state.getEvaluatorStateCallbacks()}getInternalTransactionController(){return{clearTemporaryState(t){e.assistantRuntimeStore.updateState({temporaryExecutableOperations:[],temporaryClientSteps:[],latestCommitInferenceId:t})},restoreTemporaryState(t){e.assistantRuntimeStore.updateState(t)}}}}}maybeStopCurrentHumanStepSubmission(e){if(!this.currentHumanStepSubmissionInfo)return!1;const{updater:t,startState:n,startTranscript:a,startClientSteps:i}=this.currentHumanStepSubmissionInfo;t.invalidate();const s=e(n);return s.setTranscript(a),this.currentHumanStepSubmissionInfo=void 0,this.assistantRuntimeStore.updateState({evaluator:s,isCurrentlyCommittingHumanStep:!1,showGetSupportPill:!1,clientSteps:i}),this.assistantConfigurationStore.updateState({evaluating:!1,sampling:!1,committing:!1,retrying:!1}),this.clearPreviewingStep(),!0}async withCurrentHumanStepSubmission(e){const t=this.createUpdater(),n={updater:t,startTranscript:[...this.evaluatorFromStoreState.getTranscript()],startState:this.evaluatorFromStoreState.state,startClientSteps:[...this.getCombinedSteps()]};this.currentHumanStepSubmissionInfo=n,await e(t),this.currentHumanStepSubmissionInfo===n&&(this.currentHumanStepSubmissionInfo=void 0)}getTemporaryUserInputData(){return this.assistantConfigurationStoreState.temporaryUserInputData}setNextHumanStepAsRetry(){this.assistantConfigurationStore.updateState({...this.assistantConfigurationStoreState,temporaryUserInputData:{...this.assistantConfigurationStoreState.temporaryUserInputData,isRetrying:!0}})}clearTemporaryUserInputData(){this.assistantConfigurationStore.updateState({...this.assistantConfigurationStoreState,temporaryUserInputData:void 0})}getTemporaryAttachmentStagedDataOrInstantiate(){var e;if(null!==(e=this.assistantConfigurationStoreState.temporaryUserInputData)&&void 0!==e&&e.attachmentStagedData)return this.assistantConfigurationStoreState.temporaryUserInputData.attachmentStagedData;const t={stagedAttachmentUploadStore:new(n(74831).Gi),stagedClientSteps:[],stagedEngineSteps:[],stagedInferenceTranscriptSteps:[]};return this.assistantConfigurationStore.setState({...this.assistantConfigurationStore.state,temporaryUserInputData:{...this.assistantConfigurationStore.state.temporaryUserInputData,attachmentStagedData:t}}),t}getStagedAttachmentUploadStoreIfExists(){var e;return null===(e=this.assistantConfigurationStoreState.temporaryUserInputData)||void 0===e||null===(e=e.attachmentStagedData)||void 0===e?void 0:e.stagedAttachmentUploadStore}stageAttachmentClientStep(e){const t=this.getTemporaryAttachmentStagedDataOrInstantiate(),n={...t,stagedClientSteps:[...t.stagedClientSteps,e]};this.assistantConfigurationStore.setState({...this.assistantConfigurationStore.state,temporaryUserInputData:{...this.assistantConfigurationStore.state.temporaryUserInputData,attachmentStagedData:n}})}unstageAttachmentClientStep(e){var t;const n=null===(t=this.assistantConfigurationStoreState.temporaryUserInputData)||void 0===t?void 0:t.attachmentStagedData;if(!n)return;const a=n.stagedClientSteps.filter((t=>"clientAssistantHumanAttachmentUpload"!==t.type||t.fileData.originalFileUrl!==e));this.assistantConfigurationStore.setState({...this.assistantConfigurationStore.state,temporaryUserInputData:{...this.assistantConfigurationStore.state.temporaryUserInputData,attachmentStagedData:{...n,stagedClientSteps:a}}})}unstageAttachmentEngineStep(e){var t;const n=null===(t=this.assistantConfigurationStoreState.temporaryUserInputData)||void 0===t?void 0:t.attachmentStagedData;if(!n)return;const a=n.stagedEngineSteps.filter((t=>"observation"!==t.type||"attachment"!==t.observationType||t.fileUrl!==e));this.assistantConfigurationStore.setState({...this.assistantConfigurationStore.state,temporaryUserInputData:{...this.assistantConfigurationStore.state.temporaryUserInputData,attachmentStagedData:{...n,stagedEngineSteps:a}}})}stageAttachmentEngineStep(e){const t=this.getTemporaryAttachmentStagedDataOrInstantiate(),n={...t,stagedEngineSteps:[...t.stagedEngineSteps,e]};this.assistantConfigurationStore.setState({...this.assistantConfigurationStore.state,temporaryUserInputData:{...this.assistantConfigurationStore.state.temporaryUserInputData,attachmentStagedData:n}})}commitAndClearStagedAssistantAttachmentSteps(){var e;const t=null===(e=this.assistantConfigurationStore.state.temporaryUserInputData)||void 0===e?void 0:e.attachmentStagedData;if(!t)return;const{stagedClientSteps:n,stagedEngineSteps:a}=t;for(const i of n)this.addClientStep(i);for(const i of a)this.evaluatorFromStoreState.commitStepWithoutEvaluating(i);this.assistantConfigurationStore.setState({...this.assistantConfigurationStore.state,temporaryUserInputData:{...this.assistantConfigurationStore.state.temporaryUserInputData,attachmentStagedData:void 0}})}}var F=()=>n(101927),N=()=>n(358481),L=()=>n(945710),O=()=>n(535358),V=()=>n(195181),z=()=>n(383070),W=()=>n(483730),U=()=>n(17849),H=()=>n(814964),K=()=>n(371621),q=()=>n(677590),$=()=>n(415211),G=()=>n(839710),Y=()=>n(108181),Q=()=>n(934215),J=()=>n(587685),X=()=>n(383706),Z=()=>n(881480),ee=()=>n(763578),te=()=>n(948411),ne=()=>n(192962),ae=()=>n(808725);async function ie(e){const t=function(e){const{currentUserStore:t}=a().default.state;if(t)return t;{const t=(0,X()._)(e),n=a().default.state.mainEditorCurrentBlockStore;if(t&&n)return l().L.createChildStore(n,{table:w().oo,id:t})}throw new Error("No current user")}(e);await t.load();const n=t.getModel();if(!n)throw new Error("No current user value");const i=n.getFullName(o().A.getIntl());return{id:t.id,name:i||""}}async function se(e){const{environment:t,assistantSessionContext:n,clientSkillWithParameterValues:a,sessionId:s,xmlEvaluatorState:l,currentSelection:c,currentPageOverrideStore:u}=e,p=n.createUpdater(),g=z().zD.isXMLAssistantEnabled(),f=n.assistantConfigurationStoreState.currentUserInfo,k=n.assistantConfigurationStoreState.currentSpaceInfo,w=(0,G().A)({currentUserInfo:f,currentSpaceName:k.name,currentPageOverrideStore:u}),C=n.evaluatorFromStoreState.createContextStep(w),{observations:T}=await(0,ae().T)({environment:t,step:C,commit:!0,isStreaming:!1,inferenceId:x().JW(),sessionId:s,updater:p}),j=T.find(d().XO);if(j)throw r().rG({message:j.value}),new Error("Error simulating context step");const M=[],_=[];if(g&&a){const e=await async function(e){const{environment:t,assistantSessionContext:n,currentSelection:a,clientSkillWithParameterValues:s,sessionId:r,updater:l}=e,c=n.evaluatorFromStoreState,d=z().zD.getNamespace();let u=(0,S().yj)({skillType:s.clientSkill.skillType,parameterValues:s.parameterValues,selection:a,namespace:d})||"";if(!(0,i().S)())return;"string"==typeof u&&(u=(0,v().x9d)(b(u)));const p=(0,Z().g)(),g=I().h0Y.fromLoadRecordValueFn(p.loadRecordValue),f=await(0,m().om)({textValue:u,loadRecordModel:g,intl:o().A.getIntl(),currentTimeZone:(0,y().P)()}),k=n.evaluatorFromStoreState.state.getIdMapper(),w=k.mapNodeKeyToCounter(f),C=(0,h().sD)({node:w,selection:void 0,namespace:d}),A={type:s.clientSkill.skillType,settings:s.parameterValues},T=c.createInstructionsStep(A,C);return await(0,ae().T)({environment:t,step:T,commit:!0,isStreaming:!1,inferenceId:x().JW(),sessionId:r,updater:l}),T}({environment:t,assistantSessionContext:n,clientSkillWithParameterValues:a,currentSelection:c,sessionId:s,updater:p});if("custom"===a.clientSkill.skillType){const e=a.parameterValues.instructions;if(e){const t=v().moK(e);for(const e of t)"block"===e.table&&M.push(e.id)}}if(null!=e&&e.skillContext.settings){const t=Object.values(e.skillContext.settings);for(const e of t)Array.isArray(e)||"string"==typeof e||("object"==typeof e&&"block"===e.table&&M.push(e.id),"object"==typeof e&&"collection"===e.table&&_.push(e.id))}}const P=(0,Y().N)(u);P&&await(0,ee().q)({environment:t,currentPageInformation:P,xmlEvaluatorState:l,sessionId:s,updater:p}),M.length>0&&await(0,te().Z)({environment:t,pageIds:M,xmlEvaluatorState:l,sessionId:s,updater:p}),_.length>0&&await async function(e){const{environment:t,collectionIds:n,sessionId:a,xmlEvaluatorState:i,updater:s}=e,o=W().default.getSessionContextOrThrow(a),r=A().sb(A().R9(n,Array.from(o.evaluatorFromStoreState.state.getLoadedDatabaseIds())));if(0===r.length)return;const l=r.map((e=>(0,J().P)({mappedDatabaseId:e,assistantSessionContext:o,idMapper:i.getIdMapper()}))).join("");await(0,ne().M)({environment:t,sessionId:a,commands:l,updater:s}),s.write((()=>{o.commitPreviewingStep()}))}({environment:t,collectionIds:_,xmlEvaluatorState:l,sessionId:s,updater:p})}async function oe(e){const{environment:t,completionContext:n,limitEditsInsideBlockSubtree:a,preventSelection:o,clientSkillWithParameterValues:r,suggestionGroup:l,chatTranscriptStorageStep:d,chatStartTimestamp:m,cloneIdMapper:h,currentPageOverrideStore:y,temporaryUserInputData:v,actionCardIdForLogging:S,selectedSkillCategoryOverride:b}=e,I=(0,X()._)(t);if(!I)throw new Error("No valid user.");if((0,T().O9)(e.sessionId)&&W().default.getSessionContext(e.sessionId))throw new Error("Session already initialized!");const E=e.sessionId??(d?d.sessionId:W().default.getNextSessionIdAndIncrement());try{const R={id:I,table:w().oo};"local"==="production"&&setTimeout((()=>{var e;const t=null===(e=W().default.getSessionContext(pe.sessionId))||void 0===e?void 0:e.evaluatorFromStoreState;if(!t)return;t.getTranscript().find((e=>"human"===e.type))||(0,s().NK)("Warning: resetAndInitializeAssistantSession was called without committing a human step. Please only initialize a session when you are ready to sample from it.")}),1e3);const q=new(N().h)(R);let G;G=d?new(H().A)({contextOrState:d.serializedXMLEvaluatorState,environment:t,sessionId:E,assistantEvaluatorStateCallbacks:q}):new(H().A)({contextOrState:{...p().p$,...h?{idMapper:h.serialize()}:{}},assistantEvaluatorStateCallbacks:q,environment:t,sessionId:E});const Y=await ie(t),J=Boolean((0,P().w)(t)),X=function(){const e=(0,i().S)()??(0,D().nT)();if(!e)throw new Error("No current space");return{id:e.id,name:(null==e?void 0:e.getName())||""}}(),Z=V().ID.create({sessionId:E,sessionStartTimestamp:Date.now(),chatStartTimestamp:m??Date.now(),sampling:!1,evaluating:!1,committing:!1,retrying:!1,limitEditsInsideBlockSubtree:a,preventSelection:o??!1,searchCache:new(k().A),searchDebugHits:new Map,...(0,F().q$)({isWriter:(0,T().O9)(n),onPublicDomain:J}),currentUserInfo:Y,currentSpaceInfo:X,temporaryUserInputData:v,requestedOnPublicDomain:J,deepFindRequested:e.deepFindRequested??!1,researchModeRequested:e.researchModeRequested??!1,searchSessionId:e.searchSessionId,searchOpenTimestamp:e.searchOpenTimestamp});if(r){const e=(0,L().getSearchScopeForSkill)({skill:r});e&&Z.setSearchScope(e)}const ee=z().zD.getNamespace(),te=new(u().g)(G,{persistStates:(0,_().cJ)(),errorLogger:(0,Q().P)(t),namespace:ee}),ne=e=>G.getBlockFromBlockIdMapIfExists(e);let oe,re,le,ce;if(d){let e=d.serializedTranscriptSteps;const t=A().oE(d.messages.map((e=>"assistantClient"===e.type?(0,c().Hz)({serializedStep:e.message,getBlockById:ne,assistantLoggingData:G.assistantLoggingData}):void 0))),n=t.at(-1),a=e.at(-1);"assistantTransaction"===(null==n?void 0:n.type)&&d.operations.length>0&&"assistant"===(null==a?void 0:a.type)?(oe=t.slice(0,-1),re=[n],e=e.slice(0,-1),le=a):(oe=t,re=[]),te.setTranscript(d.serializedTranscriptSteps);const{serializedTranscriptSteps:i}=d;ce=(0,$().P)(i)}else oe=[],re=[];const de=U().i.create({queue:new(C().O)(1),clientSteps:oe,sampledSteps:[],isCurrentlyCommittingHumanStep:!1,previewingStep:le,previewingStepIndex:void 0,previewingStepObservations:[],previewingState:void 0,evaluator:te,uncommittedExecutableOperations:[],executedOperationsMap:new Map,temporaryExecutableOperations:[],temporaryClientSteps:re,didScrollToTemporaryEdit:!1,selectedSkill:ce??r,selectedSuggestionGroup:l,attributionActor:R,randomIdIndex:0,randomIdCache:[],loadedPageVariableCounter:0,latestCommitInferenceId:x().JW(),showGetSupportPill:!1,actionCardIdForLogging:S,assistantResponseCategoryByInferenceId:{}}),ue=new B({assistantRuntimeStore:de,assistantConfigurationStore:Z,sessionMetadata:{completionContext:n,clientSkillWithParameterValues:r,limitEditsInsideBlockSubtree:a,preventSelection:o,selectedSkillCategoryOverride:b},urlAtStartOfSession:window.location.href}),pe={sessionId:E,context:ue};e.makeActiveSession??!0?W().default.setNewActiveSession(pe):W().default.addNewSession(pe);const ge=(0,i().S)();if(ge&&j().callApi({eventName:"publishAiSession",environment:t,data:{id:E,inference_type:"assistant",spaceId:ge.id,metadata:{userId:Y.id,spaceId:ge.id}}}),!de.state||!Z.state)throw new Error("No state");const me="cursor"===(null==n?void 0:n.type)||"textSelection"===(null==n?void 0:n.type)?{type:"text",start:{blockId:n.textSelection.start.store.id,index:n.textSelection.start.index},end:{blockId:n.textSelection.end.store.id,index:n.textSelection.end.index}}:"blockSelection"===(null==n?void 0:n.type)?{type:"block",blockIds:n.stores.map((e=>e.id))}:void 0;G.setAssistantSelection(me),d||(ue.clearClientStepsIncludingTemporary(),await se({environment:t,assistantSessionContext:ue,clientSkillWithParameterValues:r,currentSelection:me,sessionId:E,xmlEvaluatorState:G,currentPageOverrideStore:y})),le&&await(0,ae().T)({environment:t,step:le,commit:!1,isStreaming:!1,inferenceId:x().JW(),sessionId:E,updater:ue.createUpdater()});const he=(null==d?void 0:d.assistantOperations.map((e=>(0,f().x)({serializedOperation:e,getBlockById:ne,assistantLoggingData:G.assistantLoggingData}))).filter(T().O9))??[];if(he.length>0){await(0,K().CD)({environment:t,assistantOperations:he}),ue.caches.ensureDefaultCacheOverride(t);const e=[];for(const n of he){const a=(0,K().r0)({environment:t,attributionActor:R,currentUserId:I,assistantOperation:n,caches:ue.caches});e.push({...n,operations:a,inferenceId:x().JW(),id:n.id??(0,g().Vg)(x().JW())})}ue.prependUncommittedOperations(e)}const fe=ue.getCombinedSteps().find((e=>"assistantStartResearchMode"===e.type));return void 0!==fe&&(Z.updateState({researchModeRequested:!0}),M().MU({environment:t,researchModeThreadId:fe.threadId,source:"chat_history"})),(0,O().NN)(t),{sessionId:E}}catch(R){throw(0,q().U)({environment:t,sessionId:E}),R}}},996918:(e,t,n)=>{n.d(t,{M:()=>o});n(296540);var a=()=>n(807449),i=()=>n(670371),s=n(474848);function o(){return(0,s.jsx)(a().I,{icon:i().eyeSmallIcon,size:"xs",colorVariant:"secondary",style:{marginInlineStart:6}})}}}]);