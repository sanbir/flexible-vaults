"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[87017],{87017:(e,t,o)=>{o.r(t),o.d(t,{duplicateBlocks:()=>w,duplicateBlocksWithMaybeConfirmation:()=>I,insertBlockAbove:()=>R,insertBlockAndEdit:()=>F,insertBlockBelow:()=>x,insertTextAbove:()=>E,insertTextBelow:()=>A});o(18107),o(944114),o(967357);var n=()=>o(135168),i=()=>o(908006),c=()=>o(905073),r=()=>o(206267),l=()=>o(496603),a=()=>o(855801),s=()=>o(669548),d=()=>o(822934),u=()=>o(391214),m=()=>o(838256),p=()=>o(962910),v=()=>o(807700),k=()=>o(920836),g=()=>o(3700),f=()=>o(799832),S=()=>o(516430),b=()=>o(471083),y=()=>o(518489),T=()=>o(836724),_=()=>o(206051),C=()=>o(77246),h=()=>o(957763),B=()=>o(547149);async function I(e){const{environment:t,blocks:o,duplicateOnlyCollectionSchema:c,callback:r,from:l}=e;if(!(0,h().E)(t,(0,n().f)(o[0])))return;const s=await a().VI.duplicateActions.load();let u=o;if(1===o.length){const e=await p().rW({environment:t,block:o[0],action:"duplicate"});if("user_canceled"===e)return void(null==r||r());u=e}const m=u.at(0);if(!m)return;const v=(0,f().U)(m);if(v&&(0,g().ls)(m,v))await k().un({blocks:u,environment:t,analyticsFrom:"subitem_duplication",callback:r,collectionContextStore:v});else{const{serverCommitResult:e}=B().createAndCommit({userAction:"actionRegistry.duplicateToSelection",environment:t,canUndo:!0,perform:e=>{w({environment:t,blocks:u,transaction:e,executionTarget:"local",duplicateOnlyCollectionSchema:c,duplicateActions:s,from:l})},transactionTooBigFallback:e=>{w({environment:t,blocks:u,transaction:e,executionTarget:"server",duplicateOnlyCollectionSchema:c,duplicateActions:s,from:l})}});e.then(r)}i().default.afterNextFlush((()=>{(0,d().B)({environment:t})}))}function w(e){const{environment:t,blocks:o,transaction:n,executionTarget:i,lastTopLevelBlockStore:c,preventSetSelection:r,duplicateOnlyCollectionSchema:a,duplicateActions:s,from:d}=e,m=l().$z(o,(e=>e.getFormat().app_id??e.id)),p=[];return l().jJ(m,(e=>{const o=e[0],{blockStores:c}=s.duplicateBlock({environment:t,stores:e,transaction:n,targetSpaceId:o.getSpaceId(),executionTarget:i,from:d,options:{addCopyName:!0,allowRedundancy:!1,deepCopyTransclusionContainers:!o.isTransclusionType(),resolveTemplateVariables:!(0,v().l)(o),duplicateOnlyCollectionSchema:a},skipUserFacingMessages:!1});p.push(...c)})),u().LE({blocksToInsert:p,target:c?[c]:o,environment:t,transaction:n,replaceEmptyTextBlock:!1,preventSetSelection:r}),p}function x(e){const{environment:t,createBlockItem:o,selection:i,transaction:c,analyticsFrom:r,preventSetSelection:l}=e,a=_().default.getCurrentRecordCache(),d=new(m().UF)({environment:t,userFlow:"page"===(null==o?void 0:o.blockType)?"user_flow_create_page":"user_flow_create_block",from:r,succeedOnEnqueue:!0});let p;if((0,h().E)(t,(0,n().f)(i[0]))&&o&&a){const e=s().w({environment:t,createBlockItem:o,transaction:c,inMemoryRecordCache:a,from:r,selection:i});d.track(e.pointer,c),p=u().LE({environment:t,blocksToInsert:[e],target:i,transaction:c,replaceEmptyTextBlock:!1,preventSetSelection:l})[0]}else d.fail("invalid_state");return p}function R(e){const{environment:t,createBlockItem:o,selection:i,transaction:c,analyticsFrom:r,preventSetSelection:l}=e,a=_().default.getCurrentRecordCache();let d;if((0,h().E)(t,(0,n().f)(i[0]))&&o&&a){const e=s().w({environment:t,createBlockItem:o,transaction:c,inMemoryRecordCache:a,from:r,selection:i});d=u().t1({environment:t,blocks:[e],selection:i,transaction:c,preventSetSelection:l})[0]}return d}function F(e){const{environment:t,selection:o,transaction:n}=e,i=x({...e,preventSetSelection:!0});if(i){var c;u().x5({environment:t,insertedStores:[i],isCreated:!0});const e=C().Uv.getMode(i);if("suggest"===e){const e=S().RR(t,n,i);S().tM(n,i,{id:r().JW(),type:"insert",discussionId:e.id}),S().c3({environment:t,transaction:n,discussionStore:e,addModifiedBlockIdsAfter:[i.id]})}"suggest"===e&&null!==(c=i.getNavigableBlockStore({skipCurrent:!0}))&&void 0!==c&&c.isCommentOnly()||u().um({transaction:n,blocks:o})}return i}function A(e){const{blocks:t,transaction:o,environment:n,skipAnalytics:r}=e,l=r?void 0:"text_insert_below",a=x({environment:n,selection:t,createBlockItem:b().ry.text,analyticsFrom:l,transaction:o});return a&&i().default.afterNextFlush((()=>{(0,c().z)({environment:n,blockStore:a,insertedTextBlockLocation:"below",editSelection:y().h,getRectFromStore:T().T.getRectFromStore.bind(T().T)})})),a}function E(e){const{blocks:t,transaction:o,environment:n,skipAnalytics:r}=e,l=r?void 0:"text_insert_below",a=R({environment:n,selection:t,createBlockItem:b().ry.text,analyticsFrom:l,transaction:o});return a&&i().default.afterNextFlush((()=>{(0,c().z)({environment:n,blockStore:a,insertedTextBlockLocation:"above",editSelection:y().h,getRectFromStore:T().T.getRectFromStore.bind(T().T)})})),a}},669548:(e,t,o)=>{o.d(t,{w:()=>m});o(16280),o(18107),o(967357),o(898992),o(737550);var n=()=>o(907258),i=()=>o(388821),c=()=>o(179034),r=()=>o(37450),l=()=>o(807700),a=()=>o(644854),s=()=>o(544198),d=()=>o(594794),u=()=>o(863168);function m(e){var t,o;const{environment:m,createBlockItem:p,from:v,inMemoryRecordCache:k,transaction:g,selection:f}=e;if(!p.templateRootBlockId||!p.createTemplate)throw new Error("Invalid createBlock item.");const S=(f.length>0?f[0].getSpaceId():void 0)??e.spaceId??(null===(t=n().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.getSpaceId()),b=S?m.idCreator.getSpaceIdCreatorSync(S):void 0,y=f.some((e=>(0,l().l)(e))),T=p.createTemplate(m),{targetBlockStore:_}=(0,a().initializeTemplate)({environment:m,sourceBlockId:p.templateRootBlockId,targetBlockPointer:(0,d().zP)({environment:m,table:c().ev,spaceId:S}),sourceBlockSubtree:(0,i().partialRecordMapToRecordMap)(T),targetRecordCache:k,transaction:g,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!y,spaceIdCreator:b});null===(o=p.postCreateCallback)||void 0===o||o.call(p,_,m,g);const[C]=f;if(u().eY({environment:m,store:_,transaction:g,previousStore:C}),v&&p.blockType){var h;const e=p.collectionViewType,t="full_page"===e,o=0!==f.length?null===(h=f[0])||void 0===h?void 0:h.getParentCollectionIdUpToTwoLevels():void 0;let n,i,c,l;if("chart"===e){var B,I;const e=null===(B=_.getCollectionViewStores())||void 0===B?void 0:B.at(0);n=null==e||null===(I=e.getChartConfig())||void 0===I?void 0:I.type,i=null==e?void 0:e.getChartPlaceholderType()}if("form_editor"===e){var w;const e=null===(w=_.getCollectionViewStores())||void 0===w?void 0:w.at(0),t=null==e?void 0:e.getFormBlockStore();c=null==t?void 0:t.id,l=null==e?void 0:e.id}const{collectionId:a,ownedCollectionCount:d,linkedCollectionCount:u}=(0,s().P)(_,{skipPages:!1}),k={from:v,collection_id:a,owned_collection_count:d,linked_collection_count:u,view_type:"inline"===e||"full_page"===e?"table":e,is_toggleable:p.isToggleable,automation_id:_.getAutomationId(),new_page_id:"page"===p.blockType?_.id:void 0,creating_block_id:_.id,parent_collection_id:o,is_full_screen:t,chart_type:"placeholder"===n?i:n,is_chart_placeholder:"placeholder"===n,form_id:c,view_id:l},g=p.blockType;r().tP(g)?r().vH(m,{...k,type:g,collection_id:a||""}):r().vH(m,{...k,type:g})}return _}},905073:(e,t,o)=>{o.d(t,{z:()=>s});var n=()=>o(564884),i=()=>o(757695),c=()=>o(755125),r=()=>o(301809),l=()=>o(206267),a=()=>o(683021);function s(e){const{environment:t,blockStore:o,insertedTextBlockLocation:s,editSelection:d,getRectFromStore:u}=e,m=a().Ay.state;if(d({environment:t,store:o}),(0,r().e)({store:o.getBlockTitleStore()}),!m.open&&!t.device.isPhone){const e=o.getBlockTitleStore(),d=u(o),m=l().JW();d&&(a().Ay.setState({id:m,open:!0,isAddMenu:!0,collapsed:!0,textStore:e,oldTextValue:e.getValue(),oldSelection:{startIndex:0,endIndex:0},selectionRect:d,lettersAtLastResult:0,filter:"",temporaryInputDataStore:i().Store.createValue(void 0,{name:"temporaryInputData"}),insertedTextBlockLocation:s}),(0,c().clear)({environment:t}),(0,r().e)({store:e}),(0,n().u)({environment:t,event:{eventName:"open_slash_menu",eventProperties:{id:m,source:"add_button"}}}))}}}}]);