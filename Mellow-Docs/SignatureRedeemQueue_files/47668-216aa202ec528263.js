"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[47668],{53592:(e,t,o)=>{o.r(t),o.d(t,{attemptServerBackedLocalDuplicate:()=>I,getDuplicateMethodFromLoadSource:()=>S,tryLoadLocalSubtreeWithServerFallback:()=>_});var r=()=>o(247584),a=()=>o(165358),n=()=>o(388821),c=()=>o(912720),i=()=>o(199378),s=()=>o(229833),l=()=>o(973647),d=()=>o(534177),p=()=>o(230554),u=()=>o(666144),m=()=>o(866654),g=()=>o(547149),f=()=>o(966152),v=()=>o(59110),y=()=>o(949653);function S(e){switch(e){case"in_memory":case"persisted":return"local_duplication";case"server":return"server_backed_local_duplication";default:(0,d().HB)(e)}}async function I(e){const{environment:t,sourceBlockPointer:o,targetBlockStore:r,options:n,templateInstallationMetadata:d,recordLimit:u=500,stopwatch:m,from:v}=e;null==m||m.mark("attempt_server_backed_local_duplicate_start"),(0,f().JW)({environment:t,type:"server_duplicate_attempt_server_backed_local_duplicate",data:{sourceBlockPointer:o,targetBlockStore:r,targetSpaceId:r.getSpaceId(),options:n}});const S=await _({environment:t,sourceBlockPointer:o,targetBlockStore:r,options:n,enableLegacyTransclusionFixing:true,recordLimit:u});if(null==m||m.mark("try_load_local_subtree_finished"),!S||!S.loadLocalSubtreeResult.recordMap)return l().Q.fail({});const{recordMap:I}=S.loadLocalSubtreeResult;if(p().Lw({sourceSpaceId:o.spaceId,targetSpaceId:r.getSpaceId(),sourceBlockSubtree:I}))return a().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"accessLockingWarning",data:{message:"Unable to perform local duplication",miscDataToConvertToString:{sourceBlockPointer:o,targetBlockPointer:{id:r.id,spaceId:r.getSpaceId(),type:r.getType()}}}}),null==m||m.mark("attempt_server_backed_local_duplicate_failure"),l().Q.fail({});for(const s of I.getTables())if(s===c().yB||s===i().SC)return a().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"invalidRecordType",data:{message:"Local duplication does not support automation tables",miscDataToConvertToString:{sourceBlockPointer:o,targetBlockPointer:{id:r.id,spaceId:r.getSpaceId(),type:r.getType()}}}}),null==m||m.mark("attempt_server_backed_local_duplicate_failure"),l().Q.fail({});try{(0,f().JW)({environment:t,type:"server_backed_duplicate_start_transaction",data:{message:"Starting transactionActions.createAndCommit for localDuplicate",sourceBlockPointer:o,targetBlockPointer:{id:r.id,spaceId:r.getSpaceId(),type:r.getType()}}});const{serverCommitResult:e}=g().createAndCommit({userAction:"server_backed_local_duplicate",environment:t,canUndo:!0,isTemplateInstantiationTransaction:Boolean(d),perform:e=>(0,y().localDuplicate)({environment:t,sourceBlockId:o.id,targetBlockPointer:r.pointer,sourceBlockSubtree:I,targetInMemoryRecordCache:r.inMemoryRecordCache,transaction:e,templateInstallationMetadata:d,stopwatch:m,options:{...n,preventLegacyTransclusions:true},from:v})});return await e,null==m||m.mark("server_backed_local_duplicate_finished"),(0,f().JW)({environment:t,type:"server_duplicate_attempt_server_backed_local_duplicate_success",data:{targetSpaceId:r.getSpaceId(),options:n}}),l().Q.success({size:null==I?void 0:I.getSize(),pageStore:r,transactionPromise:e})}catch(k){return a().log({level:"error",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadError",error:(0,s().convertErrorToLog)(k),data:{message:"Failed to load subtree",miscDataToConvertToString:{sourceBlockPointer:o,targetBlockPointer:{id:r.id,spaceId:r.getSpaceId(),type:r.getType()}}}}),l().Q.fail({})}}async function _(e){const{environment:t,sourceBlockPointer:o,targetBlockStore:c,options:i,enableLegacyTransclusionFixing:l,recordLimit:d}=e,p={environment:t,blockId:o.id,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,options:{allowCopyCollections:!0,requireFullSubtree:!0,skipTransclusionContainerChildren:!i.deepCopyTransclusionContainers,allowCopyExternalObjectInstances:!i.convertExternalObjectInstancesToPlaceholders,includeLegacyTransclusionBlockValues:l}};let g,y="in_memory";if(g=(0,v().loadLocalSubtree)(p),!g.recordMap){y="persisted";try{(0,f().JW)({environment:t,type:"performInexactPagePreload",data:{message:"No local subtree found, performing performInexactPagePreload",loadLocalSubtreeArgs:p}}),await(0,m().A$)(t,{table:"block",id:o.id,spaceId:o.spaceId}),g=(0,v().loadLocalSubtree)(p)}catch(S){a().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"persistedRecordCachePreloadError",error:(0,s().convertErrorToLog)(S),data:{message:"Failed to preload subtree from persisted record cache"}})}}if(g.recordMap||(y="server",(0,f().JW)({environment:t,type:"loadLocalSubtreeApi",data:{message:"No local subtree found from previous attempts, attemping API call to loadBlockSubtree",currentLocalSubtreeResponse:g}}),g=await async function(e){const{environment:t,sourceBlockPointer:o,recordLimit:c,targetBlockStore:i,loadLocalSubtreeArgs:l}=e;try{const e=await t.api.callCellCompatibleApi({eventName:"loadBlockSubtree",environment:t,data:{block:{id:o.id,spaceId:o.spaceId},shallow:!1,recordCountLimit:c},cellNavigation:{spaceId:o.spaceId}});if((0,f().JW)({environment:t,type:"loadBlockSubtreeApiResult",data:{message:"Result from loadBlockSubtree API call",subtreeResult:e,apiArgs:{block:{id:o.id,spaceId:o.spaceId},shallow:!1,recordCountLimit:c}}}),"success"===e.type){const o=n().RecordMapWithRole.create(e.data.subtreeRecordMap);return await u()._O({environment:t,inMemoryRecordCache:l.inMemoryRecordCache,recordMap:o,debugSource:"load_local_subtree_from_server"}),(0,v().loadLocalSubtree)(l)}{const t=(0,r().V4)(e);a().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"loadBlockSubtreeFailure",data:{message:"Error fetching subtree",miscDataToConvertToString:{error:t,sourceBlockPointer:o,cacheSize:i.inMemoryRecordCache.size,targetBlockPointer:{id:i.id,spaceId:i.getSpaceId(),type:i.getType()}}}})}}catch(S){a().log({level:"error",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadError",error:(0,s().convertErrorToLog)(S),data:{message:"Error loading subtree",miscDataToConvertToString:{sourceBlockPointer:o,cacheSize:i.inMemoryRecordCache.size,targetBlockPointer:{id:i.id,spaceId:i.getSpaceId(),type:i.getType()}}}})}}({environment:t,sourceBlockPointer:o,recordLimit:d,targetBlockStore:c,loadLocalSubtreeArgs:p})),g&&!g.recordMap&&a().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadFailure",data:{message:"Failed to load subtree",miscDataToConvertToString:{sourceBlockPointer:o,cacheSize:c.inMemoryRecordCache.size,reason:"error"===g.type?g.reason:void 0,targetBlockPointer:{id:c.id,spaceId:c.getSpaceId(),type:c.getType()},missingRecord:"error"===g.type?g.pointer:void 0}}}),g)return{loadLocalSubtreeResult:g,loadSource:y}}},266377:(e,t,o)=>{o.d(t,{Y:()=>d,G:()=>l});var r=()=>o(564884),a=()=>o(675133),n=()=>o(416845);class c extends n().WXf{constructor(e={}){super({level:"error",status:409,name:"RedundantDuplicationRequestError",message:"Duplication already in progress",data:e.data,error:e.error,clientData:{type:"redundant_duplication_request"}})}}c.type="RedundantDuplicationRequestError";n().WXf;var i=()=>o(621594),s=()=>o(812182);function l(e){const{onRetry:t,onDismiss:o,environment:n}=e,c="redundant_duplication_request_error",l=a().A.getIntl();s().Iz({id:c,title:l.formatMessage({defaultMessage:"You are already duplicating this item",id:"duplicationActions.redundantDuplicationError"}),message:l.formatMessage({defaultMessage:"Would you like to duplicate it again?",id:"duplicateActions.redundantDuplicationError.duplicateAgain"}),presentationType:"persistent",actions:{primary:{title:l.formatMessage({defaultMessage:"Proceed",id:"duplicateActions.redundantDuplicationError.proceed"}),onAction:()=>{(0,r().u)({environment:n,event:{eventName:"redundant_duplication_user_action",eventProperties:{action:"retry"}}}),t(),s().UW(c)}},secondary:{title:l.formatMessage({defaultMessage:"Dismiss",id:"duplicateActions.redundantDuplicationError.dismiss"}),onAction:()=>{(0,r().u)({environment:n,event:{eventName:"redundant_duplication_user_action",eventProperties:{action:"dismiss"}}}),null==o||o(),s().UW(c)}}},icon:i().exclamationMarkCircleSmallIcon,iconColorVariant:"inversePrimary",onUserDismiss:()=>{(0,r().u)({environment:n,event:{eventName:"redundant_duplication_user_action",eventProperties:{action:"dismiss"}}}),null==o||o()}})}function d(e){return(0,n().iDI)(e,c)||(0,n().pA8)(e)&&"redundant_duplication_request"===e.clientData.type}},375078:(e,t,o)=>{o.r(t),o.d(t,{maybeTurnCollectionViewIntoCollectionViewPage:()=>T,transformBlocks:()=>B,transformIntoColumnList:()=>M});o(898992),o(354520),o(581454);var r=()=>o(242422),a=()=>o(908006),n=()=>o(784326),c=()=>o(295633),i=()=>o(755125),s=()=>o(301809),l=()=>o(700500),d=()=>o(179034),p=()=>o(743246),u=()=>o(496603),m=()=>o(722101),g=()=>o(44729),f=()=>o(863168),v=()=>o(384944),y=()=>o(391214),S=()=>o(62287),I=()=>o(87017),_=()=>o(594794),k=()=>o(299545),h=()=>o(440024),b=()=>o(747674),C=()=>o(547149);function B(e){const{environment:t,blockType:o,transaction:n}=e,B=e.blocks.filter((e=>e.getParentTable()!==p().C0));if(0!==B.length)if(o!==l().xd.transclusionContainer)if(o===l().xd.callout&&r().default.checkGate({gateName:"create_v2_callouts"}))!function(e){const{environment:t,blocks:o,transaction:r}=e,a=o[0];if(!a)return;const n=a.getRecordStoreUIParent();if(!n||!(0,k().iU)(n))return;const s=n.getRecordStoreUIParent();if(!(s&&s instanceof c().B))return;const p=(0,_().Z1)({environment:t,table:d().ev,spaceId:s.getSpaceId()}),u=v().Wv({environment:t,id:p,type:l().xd.callout,inMemoryRecordCache:n.inMemoryRecordCache,transaction:r,spaceId:s.getSpaceId(),format:{callout_version:2}});g().NI({parentStore:n,childStore:u,after:a.id,transaction:r});w({newParentStore:u.getContentStore(),blocks:o,transaction:r}),f().s4({store:u,transaction:r}),(0,i().clear)({environment:t}),(0,h().I)({environment:t}),(0,b().t)({environment:t,stores:[u]})}({environment:t,blocks:B,transaction:n});else if(o!==l().xd.columnList)if(o!==l().xd.slide)if((0,l().ZK)(o)){const e=parseInt(o.replace("column","").replace("block","")),r=u().oE(u().Hn(e-1,(()=>I().insertTextBelow({environment:t,blocks:B,transaction:n})))),c=[...B,...r],i=M({environment:t,blocks:c,transaction:n});a().default.afterNextFlush((()=>{(0,s().e)({store:i[0].getBlockTitleStore()})}))}else for(const r of B)if(r.isCalloutV2()){const e=r.getParentBlockStore();if(e){const c=r.getContentStores();C().applyOperation({store:e,operation:{pointer:e.pointer,path:["content"],command:"insertChildrenAfter",args:{ids:c.map((e=>e.id)),after:r.id}},transaction:n}),g().zz({parentStore:e.getContentStore(),childStore:r,transaction:n});for(const e of c)S().pd({environment:t,block:e,blockType:o,transaction:n,isMultiBlockTransformation:B.length>1});a().default.afterNextFlush((()=>{y().dL(t,c.map((e=>e.id)))}))}}else S().pd({environment:t,block:r,blockType:o,transaction:n,isMultiBlockTransformation:B.length>1});else!function(e){const{environment:t,blocks:o,transaction:r}=e,a=o[0];if(!a)return;const n=a.getRecordStoreUIParent();if(!n||!(0,k().iU)(n))return;const s=n.getRecordStoreUIParent();if(!(s&&s instanceof c().B))return;const p=(0,_().Z1)({environment:t,table:d().ev,spaceId:s.getSpaceId()}),u=v().Wv({environment:t,id:p,type:l().xd.slide,inMemoryRecordCache:n.inMemoryRecordCache,transaction:r,spaceId:s.getSpaceId()});g().NI({parentStore:n,childStore:u,after:a.id,transaction:r});w({newParentStore:u.getContentStore(),blocks:o,transaction:r}),(0,i().clear)({environment:t}),(0,h().I)({environment:t}),(0,b().t)({environment:t,stores:[u]})}({environment:t,blocks:B,transaction:n});else M({environment:t,blocks:B,transaction:n});else!function(e){const{environment:t,blocks:o,transaction:r}=e,a=o[0];if(!a)return;const n=a.getRecordStoreUIParent();if(!n||!(0,k().iU)(n))return;const c=n.getRecordStoreUIParent();if(!c||!(0,k()._p)(c))return;if(!c.isDefined())return;const s=(0,_().Z1)({environment:t,table:d().ev,spaceId:c.getSpaceId()}),p=v().Wv({environment:t,id:s,type:l().xd.transclusionContainer,inMemoryRecordCache:n.inMemoryRecordCache,transaction:r,spaceId:c.getSpaceId()});m().WH({parentStore:n,insertStore:p,afterStore:a,transaction:r});w({newParentStore:p.getContentStore(),blocks:o,transaction:r}),(0,i().clear)({environment:t}),(0,h().I)({environment:t}),(0,b().t)({environment:t,stores:[p]})}({environment:t,blocks:B,transaction:n})}function T({environment:e,blocks:t,transaction:o}){(function(e){return 1===e.length&&"collection_view"===e[0].getType()})(t)&&B({environment:e,blocks:t,blockType:"collection_view_page",transaction:o})}function M(e){const{environment:t,blocks:o,transaction:r}=e,a=o[0];if(!a)return[];const c=a.recordStoreUIParentStore;if(null==c||!c.valueIs(n()._))return[];const i=(0,_().Z1)({environment:t,table:d().ev,spaceId:a.getSpaceId()}),s=v().Wv({environment:t,id:i,type:l().xd.columnList,inMemoryRecordCache:a.inMemoryRecordCache,transaction:r,spaceId:a.getSpaceId()}),{childStore:p}=m().nc({parentStore:c,insertStore:s,beforeStore:a,transaction:r});return o.map((e=>{const o=(0,_().Z1)({environment:t,table:d().ev,spaceId:a.getSpaceId()}),n=v().Wv({environment:t,id:o,type:l().xd.column,inMemoryRecordCache:a.inMemoryRecordCache,transaction:r,spaceId:a.getSpaceId()}),{childStore:i}=m().TF({parentStore:c,childToRemoveStore:e,transaction:r}),{childStore:s}=m().WH({parentStore:p.getContentStore(),insertStore:n,transaction:r}),{childStore:u}=m().WH({parentStore:s.getContentStore(),insertStore:i,transaction:r});return u}))}function w(e){const{newParentStore:t,blocks:o,transaction:r}=e;for(const a of o){const e=a.getRecordStoreUIParent();null!=e&&e.valueIs(n()._)&&(m().TF({parentStore:e,childToRemoveStore:a,transaction:r}),m().BC({parentStore:t,appendStore:a,transaction:r}))}}},450486:(e,t,o)=>{o.r(t),o.d(t,{moveToTeamImpl:()=>s});o(898992),o(672577);var r=()=>o(710515),a=()=>o(534177),n=()=>o(44729),c=()=>o(955930),i=()=>o(375078);function s(e){const{environment:t,transaction:o,teamStore:s,spaceViewStore:l,location:d,blocksToMove:p}=e,u=(0,r().r)(l),m=s.getTeamPagesStore();i().maybeTurnCollectionViewIntoCollectionViewPage({environment:t,blocks:p,transaction:o});for(const r of p){const e=u.find((e=>{const t=e.getTeamPagesStore().getValue();if(t)return t.includes(r.id)}));(null==e?void 0:e.id)!==s.id&&("append"===d.type?n().NI({parentStore:m,childStore:r,after:d.after,transaction:o}):"prepend"===d.type?n().Ti({parentStore:m,childStore:r,before:d.before,transaction:o}):(0,a().HB)(d),e&&c().Ex({teamStore:e,store:r,transaction:o}))}return s}},503388:(e,t,o)=>{o.d(t,{U8:()=>d,Yj:()=>p,d8:()=>m,dH:()=>u,uC:()=>g});o(16280),o(898992),o(354520),o(581454);var r=()=>o(700500),a=()=>o(179034),n=()=>o(534177),c=()=>o(769864),i=()=>o(723039),s=()=>o(384944),l=()=>o(103926);function d(e){const{environment:t,sourceBlocks:o,targetRecordCache:a,transaction:c,spaceId:i}=e,l=o.map(((e,o)=>s().Wv({environment:t,type:r().xd.copyIndicator,inMemoryRecordCache:a,transaction:c,spaceId:i})));if(l.length!==o.length)throw new Error("copyIndicators must be same length as source blocks");if(!(0,n().EI)(l))throw new Error("copyIndicators must cannot be empty");return l}function p(e){for(const t of e)l().n_(t.id)}function u(e){for(const t of e)l().L7(t.id)}function m(e){const{copyIndicatorIds:t,state:o}=e;for(const r of t)l().DW({state:o,targetRecordId:r})}function g(e){const{environment:t,copyIndicators:o}=e;c().callApi({eventName:"deleteContentRecords",environment:t,data:{records:o.filter((e=>e.isCrdtEnabled())).map((e=>e.getSpaceShardedPointer())),permanentlyDelete:!1}}),i().L({environment:t,stores:o.filter((e=>!e.isCrdtEnabled())),table:a().ev,from:"server_duplication_copy_indicators"})}},677733:(e,t,o)=>{o.r(t),o.d(t,{duplicateBlockWithQueueTask:()=>M,performServerDuplicate:()=>T,serverDuplicate:()=>C,shouldUseDuplicateAndTranslateTemplateBlock:()=>D,shouldUseDuplicateTemplateBlock:()=>w});o(16280),o(944114),o(581454);var r=()=>o(242422),a=()=>o(675133),n=()=>o(165358),c=()=>o(416504),i=()=>o(388821),s=()=>o(496603),l=()=>o(763824),d=()=>o(973647),p=()=>o(435345),u=()=>o(583835);const m=(0,u().Dv)("duplicateAndTranslateTemplateBlock"),g=(0,u().Dv)("duplicateTemplateBlock");var f=()=>o(230554),v=()=>o(769864),y=()=>o(357625),S=()=>o(811349),I=()=>o(360886),_=()=>o(503388),k=()=>o(966152),h=()=>o(761986),b=()=>o(266377);function C(e){const{environment:t,sourceBlocks:o,targetInMemoryRecordCache:r,transaction:a,options:n,targetSpaceId:c,stopwatch:i}=e,s=performance.now();null==i||i.mark("server_duplicate_start");const p=e.copyIndicators??(0,_().U8)({environment:t,sourceBlocks:o,targetRecordCache:r,transaction:a,spaceId:c});null==i||i.mark("create_copy_indicators");const u=l().yX();return a.postSubmitCallbacks.push((async o=>{if(null==i||i.mark("transaction_post_submit_callback"),o)return(0,k().P0)({environment:t,type:"server_duplicate_transaction_post_submit_callback_error",data:{copyIndicatorIds:p.map((e=>e.id)),error:o,targetSpaceId:c,options:n}}),void u.resolve(d().Q.fail(o));(0,_().Yj)(p),null==i||i.mark("initialize_copy_indicators_progress_state");const r=a.getUserActionForAnalyticsPurposesOnly();await B({serverDuplicateArgs:e,copyIndicators:p,userAction:r,deferred:u,isRetry:!1,startTime:s,onRedundantDuplicationError:e.onRedundantDuplicationError})})),d().Q.success({blockStores:p,onComplete:u.promise})}async function B(e){const{serverDuplicateArgs:t,copyIndicators:o,userAction:r,deferred:a,isRetry:n,startTime:c,onRedundantDuplicationError:s}=e,{environment:l,sourceBlocks:p,options:u,targetSpaceId:m,installationImprint:g,templateInstallationMetadata:f={},shouldUseSynchronousDuplicationAPI:v,stopwatch:y,from:S}=t,C=await T({environment:l,copyIndicators:o,sourceBlocks:p,targetSpaceId:m,options:u,templateInstallationMetadata:f,installationImprint:g,shouldUseSynchronousDuplicationAPI:v,stopwatch:y,userAction:r});if(null==y||y.mark("perform_server_duplicate_finished"),(0,k().JW)({environment:l,type:"server_duplicate_duplicate_block_iterator_success",data:{result:C,targetSpaceId:m,options:u}}),(0,_().dH)(o),d().Q.isFail(C))return(0,b().Y)(C.error)&&!n?((0,b().G)({onRetry:()=>{B({serverDuplicateArgs:{...t,options:{...t.options,allowRedundancy:!0}},copyIndicators:o,userAction:r,deferred:a,isRetry:!0,startTime:c,onRedundantDuplicationError:s})},onDismiss:()=>{(0,k().JW)({environment:l,type:"server_duplicate_redundant_duplication_error_dismissed",data:{copyIndicatorIds:o.map((e=>e.id))}}),(0,_().uC)({environment:l,copyIndicators:o}),a.resolve(d().Q.fail(new(h().sB)))},environment:l}),void(null==s||s())):((0,_().uC)({environment:l,copyIndicators:o}),(0,k().P0)({environment:l,type:"server_duplicate_iterator_error",data:{error:C.error}}),void a.resolve(C));n||(0,I().E)({environment:l,success:!0,time:performance.now()-c,user_action:r,is_duplication_local:!1,duplication_size:C.value.size,method:"server_duplication",from:S}),null==y||y.mark("server_duplicate_success"),a.resolve(d().Q.success({recordIdMap:C.value.recordIdMapJson?i().RecordMapPolymorphic.create(C.value.recordIdMapJson):void 0}))}async function T(e){const{environment:t,copyIndicators:o,sourceBlocks:r,targetSpaceId:a,options:n,templateInstallationMetadata:i,installationImprint:l,shouldUseSynchronousDuplicationAPI:u,stopwatch:f,userAction:y}=e,S=r[0].spaceId||a,I=r.map((e=>({...e,spaceId:e.spaceId||S}))),_=o.map((e=>({id:e.id,spaceId:e.getSpaceId()}))),k=!!n.resolveTemplateVariables&&{currentUserId:t.currentUser.id,currentTimeZone:(0,c().P)()},h={sourceBlocks:I,targetBlocks:_,addCopyName:n.addCopyName,deepCopyTransclusionContainers:n.deepCopyTransclusionContainers,convertExternalObjectInstancesToPlaceholders:n.convertExternalObjectInstancesToPlaceholders,duplicateOnlyCollectionSchema:n.duplicateOnlyCollectionSchema,isTemplateInstantiation:Boolean(i.source),resolveTemplateVariables:k,allowRedundancy:n.allowRedundancy,installationImprint:l,returnRecordIdMapJson:n.returnRecordIdMap,useSharedContext:n.useSharedContext},b=w(i.source),C=D(n.shouldTranslate,n.sourceLanguage,n.targetLanguage);let B;if(b){const e={...h,source:i.source,context:i.context,isEmailShared:i.isEmailShared,isFromDuplicateParam:i.isFromDuplicateParam,shouldTranslate:n.shouldTranslate,sourceLanguage:n.sourceLanguage,targetLanguage:n.targetLanguage};u?(B=await async function(e){const{environment:t,request:o,stopwatch:r}=e,a=await v().callApi({eventName:"duplicateTemplateBlockSynchronously",environment:t,data:o});if(null==r||r.mark("duplicate_template_synchronous_finished"),"failed"===a.type)return d().Q.fail(a.error);return d().Q.success({recordIdMapJson:a.data.recordIdMapJson,size:a.data.totalBlocks})}({environment:t,request:e}),null==f||f.mark("duplicate_template_synchronously_finished")):(B=await M({environment:t,eventName:g,request:e,spaceIds:[],copyIndicators:o,targetSpaceId:a,userAction:y}),null==f||f.mark("duplicate_template_finished"))}else C?(B=await M({environment:t,eventName:m,request:{...h,sourceLanguage:n.sourceLanguage,targetLanguage:n.targetLanguage},spaceIds:[],copyIndicators:o,targetSpaceId:a,userAction:y}),null==f||f.mark("duplicate_and_translate_template_finished")):u?(B=await async function(e){const{environment:t,request:o}=e,r=await v().callApi({eventName:"duplicateBlockSynchronously",environment:t,data:o});if("failed"===r.type)return d().Q.fail(r.error);return d().Q.success({recordIdMapJson:r.data.recordIdMapJson,size:r.data.size})}({environment:t,request:h}),null==f||f.mark("duplicate_block_synchronously_finished")):(B=await M({environment:t,eventName:p().w,request:h,spaceIds:(0,s().hS)([...I,..._],"spaceId").map((e=>e.spaceId)),copyIndicators:o,targetSpaceId:a,userAction:y}),null==f||f.mark("duplicate_block_finished"));return B}async function M(e){var t,o;const{environment:r,eventName:c,request:i,spaceIds:s,copyIndicators:l,targetSpaceId:p,userAction:u}=e,m=y().UT(r,c,i,{spaceIds:s});let g;try{for await(const e of m)(0,k().JW)({environment:r,type:"server_duplicate_duplicate_block_iterator",data:{response:e,targetSpaceId:p}}),(0,_().d8)({state:e,copyIndicatorIds:l.map((e=>e.id))}),f().$2(r,e),g=e}catch(v){}if(!g){const e=a().A.formatMessage(I().V.errorTitle);return d().Q.fail(new Error(e))}return g.error?(0,S().l)(g.error)&&(n().log({level:"warning",from:"serverDuplicate",type:"crossSpaceDuplication",data:{errorMessage:g.error.message,spaceIds:s,userAction:u}}),s.length>0)?M({environment:r,eventName:c,request:i,spaceIds:[],copyIndicators:l,targetSpaceId:p,userAction:u}):d().Q.fail(g.error):d().Q.success({recordIdMapJson:null===(t=g)||void 0===t?void 0:t.value.recordIdMapJson,size:(null===(o=g)||void 0===o?void 0:o.value.totalBlocks)??0})}function w(e){if(!e)return!1;const t=r().default.getConfigKey("enabled_installation_sources_for_duplicate_template_block",e);return Boolean(t)}function D(e,t,o){return Boolean(e&&t&&o)&&r().default.checkGate({gateName:"translate_template_top_bar"})}},723039:(e,t,o)=>{o.d(t,{E:()=>k,L:()=>_});o(581454);var r=()=>o(314529),a=()=>o(907258),n=()=>o(675133),c=()=>o(792057),i=()=>o(128933),s=()=>o(94484),l=()=>o(416845),d=()=>o(179034),p=()=>o(519831),u=()=>o(743246),m=()=>o(534177),g=()=>o(675925),f=()=>o(332690),v=()=>o(718807),y=()=>o(769864),S=()=>o(664713);const I=(0,o(69708).YK)({deletePageConfirmationMessage:{id:"trashActions.deletePagePermanentlyDialog.prompt",defaultMessage:"Are you sure you want to delete this page from Trash?"},deleteDataSourceConfirmationMessage:{id:"trashActions.deleteDataSourcePermanentlyDialog.prompt",defaultMessage:"Are you sure you want to delete this data source from Trash?"},deletePageConfirmationButton:{id:"trashActions.deletePagePermanentlyDialog.confirmDeleteButton.label",defaultMessage:"Delete page"},deleteDataSourceConfirmationButton:{id:"trashActions.deleteDataSourcePermanentlyDialog.confirmDeleteButton.label",defaultMessage:"Delete data source"},permanentlyDeleteFailedToast:{id:"trashActions.deletePagePermanentlyDialog.actionFailed.toast",defaultMessage:"Failed to delete, please try again later."},permanentlyDeletePermissionsFailure:{id:"trashActions.deleteContentPermanentlyDialog.actionFailed.permissions",defaultMessage:"You do not have sufficient permissions to delete this {contentLabel} from Trash."},deleteWorkflowConfirmationMessage:{id:"trashActions.deleteWorkflowConfirmationMessage",defaultMessage:"Are you sure? This agent will be permanently deleted and can no longer be restored."},deleteWorkflowConfirmationButton:{id:"trashActions.deleteWorkflowConfirmationButton",defaultMessage:"Yes, delete this agent"}});async function _(e){const{stores:t,environment:o,from:n}=e,{sidebarSpaceStore:c}=a().default.state,i=e.environment.currentUser.id;if(c&&i){await y().callApi({eventName:"deleteContentRecords",environment:e.environment,data:{records:t.map((e=>e.getSpaceShardedPointer())),permanentlyDelete:!0}}).then((e=>{if("failed"===e.type)throw h(e.body),e.error})),(0,r().DO_NOT_USE_trackLegacy)(o,"delete_trash_page",{from:n});for(const e of t)v().Ay.state.excludeRecords.add(e.id),v().Ay.emit();await S().Z({environment:o,spaceId:c.id,userId:i}),(0,f().V)({environment:e.environment,blocks:t})}}function k(e){const{environment:t,stores:o,table:l,handleSuccess:f,from:S}=e;let k,b,C;switch((0,r().DO_NOT_USE_trackLegacy)(t,"open_delete_trash_page_modal"),l){case d().ev:k=n().A.formatMessage(I.deletePageConfirmationMessage),b=n().A.formatMessage(I.deletePageConfirmationButton),C=async()=>{await(0,g().o)(t,{action:"delete_page_permanently",from:S,block_type:o[0].getType()},(async t=>{await _(e),null==f||f(o),t()}))};break;case p().Vl:k=n().A.formatMessage(I.deleteDataSourceConfirmationMessage),b=n().A.formatMessage(I.deleteDataSourceConfirmationButton),C=async()=>{var a;await(0,g().o)(t,{action:"delete_data_source_permanently",from:S,block_type:null===(a=o[0].getParentBlockStore())||void 0===a?void 0:a.getType()},(async t=>{await async function(e){const{environment:t,stores:o,from:a}=e;await y().callApi({eventName:"deleteContentRecords",environment:t,data:{records:o.map((e=>e.getSpaceShardedPointer())),permanentlyDelete:!0}}).then((e=>{if("failed"===e.type)throw h(e.body),e.error})),(0,r().DO_NOT_USE_trackLegacy)(t,"delete_trash_data_source",{from:a})}(e),null==f||f(o),t()}))};break;case u().C0:k=n().A.formatMessage(I.deleteWorkflowConfirmationMessage),b=n().A.formatMessage(I.deleteWorkflowConfirmationButton),C=async()=>{await(0,g().o)(t,{action:"delete_workflow_permanently",from:S,block_type:void 0},(async t=>{await async function(e){const{stores:t,environment:o}=e,{sidebarSpaceStore:c}=a().default.state;if(!c)return;const l=t.map((e=>e.getSpaceShardedPointer())),d=await y().callApi({environment:o,eventName:"deleteContentRecords",data:{records:l,permanentlyDelete:!0}});if("failed"===d.type)throw h(d.body),d.error;(0,r().DO_NOT_USE_trackLegacy)(o,"delete_trash_page");for(const r of t)v().Ay.state.excludeRecords.add(r.id),v().Ay.emit();return void i().D6({label:n().A.formatMessage(I.deleteWorkflowConfirmationMessage),durationMs:s().LX})}(e),null==f||f(o),t()}))};break;default:(0,m().HB)(l)}c().ui({message:k,showCancel:!0,keepFocus:!1,items:[{label:b,color:"red",onAccept:C}],handleCancel:()=>{(0,r().DO_NOT_USE_trackLegacy)(t,"cancel_delete_trash_page")}})}function h(e){let t=I.permanentlyDeleteFailedToast;(0,l().iDI)(e,l().qQk)&&(t=I.permanentlyDeletePermissionsFailure),i().D6({label:n().A.formatMessage(t),durationMs:s().LX})}},761986:(e,t,o)=>{o.d(t,{sB:()=>f,go:()=>v,V2:()=>S,x:()=>y});o(16280),o(581454);var r=()=>o(944949),a=()=>o(935432),n=()=>o(675133),c=()=>o(416845),i=(o(296540),o(474848));const s={viewBox:"0 0 16 17",fittedViewBox:"0.92 2.12 11.71 13.96",svg:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("path",{d:"M5.125 2.125a1.75 1.75 0 0 0-1.75 1.75v5.22a.075.075 0 0 0 .085.074 4 4 0 0 1 1.08 0 .075.075 0 0 0 .085-.074v-5.22a.5.5 0 0 1 .5-.5h2.604v1.831c0 .98.794 1.775 1.775 1.775h1.871v5.144a.5.5 0 0 1-.5.5H7.932a.075.075 0 0 0-.075.08 4 4 0 0 1-.069 1.08.075.075 0 0 0 .074.09h3.013a1.75 1.75 0 0 0 1.75-1.75V6.591c0-.464-.184-.91-.513-1.237L9.396 2.638a1.75 1.75 0 0 0-1.237-.513zm3.754 3.081V3.888l1.943 1.943H9.504a.625.625 0 0 1-.625-.625"}),(0,i.jsx)("path",{d:"M4 9.925q-.288 0-.564.052A3.076 3.076 0 1 0 4 9.925m-.425 1.409a.425.425 0 0 1 .85 0V13c0 .235-.19.425-.425.425H2.334a.425.425 0 0 1 0-.85H3.5a.075.075 0 0 0 .075-.075z"})]})},l=(0,o(340498).wt)("docBadgeClockSmall",s,"small");var d=()=>o(621594),p=()=>o(904691),u=()=>o(230554),m=()=>o(812182),g=()=>o(360886);class f extends Error{constructor(e){super(e),this.name="DuplicationCancelledError"}}class v extends Error{constructor(e){super(e),this.name="DuplicationMultipleSpacesError"}}function y(e){const{duplicateError:t,environment:o,blockStores:r,jobId:a}=e;if(t instanceof f)return;if(!u().Rk(t))return void function(e){const{environment:t,error:o,jobId:r}=e,a="duplicationError",{title:c,description:i,icon:s,variant:l}=S(o);let d;0;m().HK({id:a,title:c??n().A.getIntl().formatMessage(g().V.errorTitle),message:i,presentationType:"persistent",icon:s??p().xMarkCircleSmallIcon,actions:{primary:{title:n().A.getIntl().formatMessage(g().V.dismissButtonMessage),onAction:()=>m().UW(a)},secondary:d},variant:l??"error"})}({environment:o,error:t,jobId:a});const c=u().OR(t);r&&r.length>1?u().UK(o,{product:c}):u().yj({product:c})}function S(e){const t=n().A.getIntl();if((0,c().op4)(e)){const o=(0,r().D)(t,e);if(o)return{description:o}}else{if((0,c().pA8)(e))return{description:(0,a().A)(t,e)};if(e instanceof v)return{description:t.formatMessage(g().V.multipleSpacesErrorDescription)};if((0,c().iDI)(e,c().yI4))return{description:t.formatMessage(g().V.invalidErrorDescription)};if((0,c().iDI)(e,c().m_B,c().qQk))return{description:t.formatMessage(g().V.permissionErrorDescription)};if((0,c().iDI)(e,c().UlD))return{title:t.formatMessage(g().V.rateLimitErrorTitle),description:t.formatMessage(g().V.rateLimitErrorDescription),icon:l,variant:"default"};if((0,c().iDI)(e,c().iQE))return{title:t.formatMessage(g().V.sizeLimitErrorTitle),description:t.formatMessage(g().V.sizeLimitErrorDescription),icon:d().exclamationMarkCircleSmallIcon}}return{description:t.formatMessage(g().V.unknownErrorDescription)}}},811349:(e,t,o)=>{o.d(t,{l:()=>a});var r=()=>o(416845);function a(e){return(0,r().pA8)(e)&&"cross_space_duplication"===e.clientData.type}},930456:(e,t,o)=>{o.d(t,{J:()=>g});var r=()=>o(929345),a=()=>o(295633),n=()=>o(732810),c=()=>o(302996),i=()=>o(723085),s=()=>o(496603),l=()=>o(534177),d=()=>o(722101),p=()=>o(44729),u=()=>o(185544),m=()=>o(450486);function g(e){const{environment:t,sourceStores:o,transaction:g,destination:f,targetStores:v,appendWithoutAfter:y,targetSpaceViewStore:S}=e;let I={type:"append",after:y?o.length>1?o[0].id:void 0:o[o.length-1].id};const _=s().o8(v).reverse();if("team"===f.type){const e=new(i().h)(t,f.parent);(0,m().moveToTeamImpl)({environment:t,transaction:g,spaceViewStore:S,teamStore:e,blocksToMove:v,location:I})}else if("block"===f.type){const e=new(a().B)(t,f.parent);for(const t of _)p().NI({parentStore:e,childStore:t,transaction:g,after:I.after})}else if("space"===f.type){const e=new(c().SpaceStore)(t,f.parent);f.prepend&&(I={type:"prepend"});for(const o of _)u().yM({environment:t,spaceStore:e,spaceViewStore:S,pageStore:o,isPrivate:!0,location:I,transaction:g})}else if("collection"===f.type){const e=new(n().m)(t,f.parent);for(const t of _)p().X$({childStore:t,parentStore:e,transaction:g}),f.addToTemplates&&d().BC({parentStore:e.getTemplatePagesStore(),appendStore:t,transaction:g})}else if("automation_action"===f.type){const e=new(r().b)(t,f.parent);for(const t of _)p().NI({parentStore:e,childStore:t,transaction:g})}else"workflow"===f.type||(0,l().HB)(f)}},949653:(e,t,o)=>{o.r(t),o.d(t,{localDuplicate:()=>V,tryLocalDuplicateWithTransaction:()=>z,tryLocalOrServerBackedDuplicateTo:()=>O});o(16280),o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(581454);var r=()=>o(907258),a=()=>o(755531),n=()=>o(929219),c=()=>o(675133),i=()=>o(792057),s=()=>o(295633),l=()=>o(302996),d=()=>o(145455),p=()=>o(110192),u=()=>o(165358),m=()=>o(416845),g=()=>o(199378),f=()=>o(179034),v=()=>o(96689),y=()=>o(319625),S=()=>o(229833),I=()=>o(763824),_=()=>o(973647),k=()=>o(230554),h=()=>o(863168),b=()=>o(594794),C=()=>o(443002),B=()=>o(295304),T=()=>o(547149),M=()=>o(258044),w=()=>o(360886),D=()=>o(537012);function A(e){const{environment:t,recordMap:o,inMemoryRecordCache:r}=e,a=function(e){const t=e.getModelsByTable(g().SC),o=[];for(const r of t){const e=(0,D().Mn)({type:r.getType(),config:r.getConfig(),space_id:r.getSpaceId()});e&&o.push(...e.map((e=>e.pointer)))}return o}(o);for(const n of a)if(!r.hasRecord({pointer:n,userId:t.currentUser.id}))return!1;return!0}var P=()=>o(966152),R=()=>o(761986),L=()=>o(930456),E=()=>o(700280),x=()=>o(644854),U=()=>o(59110),W=()=>o(53592),F=()=>o(677733);function V(e){try{return N({...e,method:"local_duplication"})}catch(t){throw u().log({level:"error",from:"localDuplicate",type:"local_duplicate_error",error:(0,S().convertErrorToLog)(t),data:{sourceBlockId:e.sourceBlockId}}),e.skipUserFacingMessages||R().x({environment:e.environment,duplicateError:new(m().Bk6)}),t}}function N(e){var t,o,l;const{environment:m,sourceBlockId:g,targetBlockPointer:v,sourceBlockSubtree:y,targetInMemoryRecordCache:S,options:I,transaction:_,installationImprint:k,templateInstallationMetadata:h,stopwatch:b,method:C,from:T}=e,M=performance.now();null==b||b.mark("local_duplicate_start");const D=v.spaceId,A=null===(t=y.getModel({id:g,table:f().ev}))||void 0===t?void 0:t.spaceId,R=[],L=D??(null===(o=(0,a().S)())||void 0===o?void 0:o.id)??(null===(l=r().default.state.mainEditorCurrentBlockStore)||void 0===l?void 0:l.getSpaceId()),E=L?m.idCreator.getSpaceIdCreatorSync(L):void 0,{targetBlockStore:U,originalToDuplicate:W,subtreeSize:V}=(0,x().initializeTemplate)({environment:m,sourceBlockId:g,targetBlockPointer:v,sourceBlockSubtree:y,targetRecordCache:S,transaction:_,deepCopyTransclusionContainers:Boolean(I.deepCopyTransclusionContainers),resolveTemplateVariables:Boolean(I.resolveTemplateVariables),preventLegacyTransclusions:I.preventLegacyTransclusions,createLegacyTransclusionCopyIndicator:{onCreate(e){R.push(e)}},installationImprint:k,templateInstallationMetadata:h,isTemplateInstantiation:I.isTemplateInstantiation,spaceIdCreator:E,sourceBlockUpdateStrategy:I.sourceBlockUpdateStrategy??(I.appendContentOnly?"append_only":void 0)});return null==b||b.mark("local_duplicate_initialize_template_success"),(0,P().JW)({environment:m,type:"local_duplicate_initialize_template_success",data:{message:"Successful initialize template",targetSpaceId:D,sourceSpaceId:A,targetBlockStore:U,subtreeSize:V}}),D!==A&&u().log({level:"info",from:"localDuplicate",type:"local_duplicate_across_spaces",data:{sourceSpaceId:A,targetSpaceId:D,sourceBlockId:g,subTreeSize:y.getSize()}}),I.addCopyName&&U&&U.isNavigableBlock()&&(!function(e){const{environment:t,transaction:o,targetBlockStore:r}=e,a=r.getTitleStore();if(!a)return;const n=a.getValue(),c=(0,p().g)(n);B().R9({environment:t,store:a,value:c,transaction:o}),(0,P().JW)({environment:t,type:"local_duplicate_text_set_value",data:{value:c,titleStoreId:a.id,targetBlockId:r.id}})}({environment:m,transaction:_,targetBlockStore:U}),null==b||b.mark("local_duplicate_add_copy_name")),R.length&&(!function(e){const{environment:t,transaction:o,targetBlockStore:r,targetRecordCache:a,sourceSpaceId:l,legacyTransclusionCopyIndicators:p,options:u,templateInstallationMetadata:m,from:g}=e,v=!n().A.state.online;v&&i().f1(c().A.formatMessage(w().V.offlineError));for(const n of p){(0,P().JW)({environment:t,type:"local_duplicate_legacy_transclusion_copy_indicators",data:{message:"Iterating legacyTransclusionCopyIndicators",info:n}});const e=r.getSpaceId(),c=s().B.createChildStore(r,{table:f().ev,id:n.duplicateBlockId});(0,F().serverDuplicate)({environment:t,targetSpaceId:e,targetInMemoryRecordCache:a,transaction:o,sourceBlocks:[{id:n.sourceBlockId,spaceId:l}],copyIndicators:[c],options:{...u,addCopyName:!1,convertExternalObjectInstancesToPlaceholders:u.convertExternalObjectInstancesToPlaceholders??!1},templateInstallationMetadata:m,from:g})}d().hi(t,{offline:v,num_blocks_duplicated:p.length,user_action:o.getUserActionForAnalyticsPurposesOnly()})}({environment:m,transaction:_,targetBlockStore:U,targetRecordCache:S,sourceSpaceId:A,legacyTransclusionCopyIndicators:R,options:I,templateInstallationMetadata:h,from:T}),null==b||b.mark("local_duplicate_legacy_transclusion_fix")),(0,w().E)({environment:m,success:!0,time:performance.now()-M,user_action:_.getUserActionForAnalyticsPurposesOnly(),is_duplication_local:!0,duplication_size:V,method:C,from:T}),null==b||b.mark("local_duplicate_success"),{targetBlockStore:U,originalToDuplicate:W}}function z(e){const{environment:t,store:o,sourceSpaceId:r,targetSpaceId:a,transaction:n,options:c,installationImprint:i,templateInstallationMetadata:s,stopwatch:l,from:d}=e,p=(0,U().loadLocalSubtree)({environment:t,blockId:o.id,inMemoryRecordCache:o.inMemoryRecordCache,options:{allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!c.deepCopyTransclusionContainers,allowCopyExternalObjectInstances:!c.convertExternalObjectInstancesToPlaceholders,includeLegacyTransclusionBlockValues:true}}).recordMap;if(!p||!Q({environment:t,localSubtree:p,sourceSpaceId:r,targetSpaceId:a}))return;null==l||l.mark("load_local_subtree");const u=!0===o.inMemoryRecordCache.isTemporaryData?t.defaultRecordCache.inMemoryRecordCache:o.inMemoryRecordCache,{targetBlockStore:m}=N({environment:t,sourceBlockId:o.id,targetBlockPointer:(0,b().zP)({environment:t,table:f().ev,spaceId:a}),sourceBlockSubtree:p,targetInMemoryRecordCache:u,options:{...c,preventLegacyTransclusions:true},transaction:n,installationImprint:i,templateInstallationMetadata:s,stopwatch:l,from:d,method:"local_duplication"});return"ai_block"===m.getType()&&h().EF.setState(m.pointer.id),m}async function O(e){const{environment:t,sourceStores:o,destination:r,options:a,installationImprint:n,templateInstallationMetadata:c,from:i,appendWithoutAfter:d,navigateToTarget:p,useServerFallback:u,listener:m}=e,g=r.parent.spaceId,S=o[0].getSpaceId();if(!g||!S)return _().Q.success(void 0);if(1!==new Set(o.map((e=>e.getSpaceId()))).size)throw new Error("All source stores must be in the same space");const k=t.currentUser.id;if(!k)return _().Q.success(void 0);const B=(0,C().H)({spaceStore:new(l().SpaceStore)(t,{table:v().NX,id:g}),userId:k,environment:t});if(!B)return _().Q.success(void 0);const w=r.existingBlockIds,D=Array.isArray(w);if(D&&w.length!==o.length)throw new Error("existingBlockIds length must match sourceStores length");const A=new Map;function P(e,o){return!(!o||!Q({environment:t,localSubtree:o.recordMap,sourceSpaceId:S,targetSpaceId:g}))&&(A.set(e,o),!0)}const R=!0;if(u&&D)try{await(0,I().lX)(o,5,(async(e,o)=>{const r=await(0,W().tryLoadLocalSubtreeWithServerFallback)({environment:t,sourceBlockPointer:e.getSpaceShardedPointer(),targetBlockStore:new(s().B)(t,{table:f().ev,id:w[o],spaceId:g}),options:a,enableLegacyTransclusionFixing:R,recordLimit:500});let n;null!=r&&r.loadLocalSubtreeResult.recordMap&&(n={recordMap:r.loadLocalSubtreeResult.recordMap,loadSource:r.loadSource});if(!P(e.id,n))throw new Error(`Failed to load subtree for block ${e.id}`)}))}catch(O){return _().Q.success(void 0)}else for(const s of o){const e=(0,U().loadLocalSubtree)({environment:t,blockId:s.id,inMemoryRecordCache:s.inMemoryRecordCache,options:{allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!a.deepCopyTransclusionContainers,allowCopyExternalObjectInstances:!a.convertExternalObjectInstancesToPlaceholders,includeLegacyTransclusionBlockValues:R}}).recordMap,o=e?{recordMap:e,loadSource:"in_memory"}:void 0;if(!P(s.id,o))return _().Q.success(void 0)}await m({type:"started"});const x=T().createAndCommit({environment:t,userAction:`localDuplication.${i}`,isTemplateInstantiationTransaction:Boolean(c),canUndo:!0,suppressErrorDialogForStatuses:[413],perform:e=>{const s=[];for(let l=0;l<o.length;l++){const p=o[l],u=A.get(p.id);if(!u)continue;const m=D?{table:f().ev,id:w[l],spaceId:g}:(0,b().zP)({environment:t,table:f().ev,spaceId:g}),{targetBlockStore:v}=N({environment:t,sourceBlockId:p.id,targetBlockPointer:m,sourceBlockSubtree:u.recordMap,targetInMemoryRecordCache:p.inMemoryRecordCache,options:{...a,preventLegacyTransclusions:R},transaction:e,installationImprint:n,templateInstallationMetadata:c,from:i,method:(0,W().getDuplicateMethodFromLoadSource)(u.loadSource)});D||(0,L().J)({environment:t,sourceStores:[p],transaction:e,destination:r,targetStores:[v],targetSpaceViewStore:B,appendWithoutAfter:d}),"ai_block"===v.getType()&&h().EF.setState(v.pointer.id),s.push(v)}return s},transactionTooBigFallback:()=>{}}),F=x.performResult;if(void 0===F)return _().Q.success(void 0);let V;const z=window.location.href;F[0].isNavigableBlock()&&(V=F[0],p&&(0,E().F)({environment:t,blockStore:V,sourceBlockId:o[0].id}),await m({type:"page_navigable",navigableBlockStore:V}));try{await x.serverCommitResult,await m({type:"completed",createdBlocks:F,recordIdMap:void 0})}catch(O){return V&&(0,E().E)({environment:t,targetBlockId:V.id,originalUrl:z}),(0,M().A)(O)?_().Q.success(void 0):(await m({type:"error",error:(0,y().A)(O)}),_().Q.fail((0,y().A)(O)))}return _().Q.success(F)}function Q(e){const{environment:t,localSubtree:o,sourceSpaceId:r,targetSpaceId:a}=e;return!k().Lw({sourceSpaceId:r,targetSpaceId:a,sourceBlockSubtree:o})&&!(Array.from(o.getTables()).includes(g().SC)&&!A({environment:t,recordMap:o,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache}))}}}]);