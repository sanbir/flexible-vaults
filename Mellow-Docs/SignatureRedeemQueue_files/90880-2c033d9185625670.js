"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[90880],{105157:(e,t,n)=>{n.d(t,{A:()=>r});n(296540);var o=()=>n(284371),i=()=>n(422164),s=n(474848);function r(e){const{propertySchema:t,dontShowColon:n}=e,r=t.name;return(0,s.jsx)("div",{style:{display:"inline-flex",paddingTop:2},children:(0,s.jsxs)("div",{style:{display:"flex",alignItems:"start",lineHeight:"110%",minWidth:0,fontSize:13,fill:"dark"},children:[(0,s.jsx)(i().Rl,{iconStyle:{marginTop:1},propertySchema:t,iconSize:12}),(0,s.jsx)("div",{style:{...o().RC,marginInlineStart:4,maxWidth:100},children:(0,s.jsx)("span",{children:`${r}`})}),(0,s.jsx)("span",{style:{...o().RC,marginInlineEnd:4},children:n?null:":"})]})})}},143943:(e,t,n)=>{n.d(t,{C:()=>s});var o=()=>n(726637),i=()=>n(473975);function s(e){if(!o().A.isMobile)return!1;let t;if("discussionFormat"===e.type)t=e.format;else{if("discussionLocation"!==e.type)return!1;if("post_creator"===e.location||"mobile_post_creator"===e.location)return!1;t=(0,i().discussionLocationToDiscussionFormat)(e.location)}return t===i().DiscussionFormat.Menu||t===i().DiscussionFormat.Sidebar}},165492:(e,t,n)=>{n.d(t,{A:()=>f});n(814603),n(147566),n(198721);var o=n(296540),i=()=>n(401497),s=()=>n(718827),r=()=>n(150161),l=()=>n(807449),a=()=>n(26697),c=()=>n(100622),d=()=>n(284371),u=()=>n(496889),m=()=>n(473975),p=n(474848);function f({title:e,source:t,size:n,file:f,store:g,onClick:v,showBlockActionMenuButton:y}){(0,o.useEffect)((()=>()=>{"local"===(null==f?void 0:f.type)&&null!=f&&f.dataURL&&URL.revokeObjectURL(f.dataURL)}),[f]);const h=(0,i().IS)((()=>({justBackgroundHovered:{background:c().Tj.background.secondary},wrapper:{height:48,width:214,background:c().Tj.background.primary,border:`1px solid ${c().Tj.border.secondaryTranslucent}`,borderRadius:12,paddingTop:7,paddingInlineEnd:10,paddingBottom:8,paddingInlineStart:8,cursor:v?"pointer":"default"},wrapperHoveredStyle:{background:c().Tj.background.secondary},iconContainer:{height:32,width:32,minWidth:32,background:c().Tj.background.tertiaryTranslucent,borderRadius:6,display:"flex",justifyContent:"center",alignItems:"center"},fileName:{fontSize:14,fontWeight:d().Wy.medium,lineHeight:"18px",color:c().Tj.text.primary,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},fileSizeText:{fontSize:12,lineHeight:"15px",color:c().Tj.text.secondary},actionMenuHoveredStyle:{background:c().Tj.background.tertiaryTranslucent}})),[v]),S=(0,m().getIcon)(t);return(0,p.jsx)(s().Ay,{style:h.wrapper,hoveredStyle:g?h.wrapperHoveredStyle:h.justBackgroundHovered,pressedStyle:g?h.wrapperHoveredStyle:h.justBackgroundHovered,onClick:v,children:(0,p.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,p.jsx)("div",{style:h.iconContainer,children:(0,p.jsx)(l().I,{icon:S,size:"lg",colorVariant:"primary"})}),(0,p.jsx)("div",{style:{overflow:"hidden",flexGrow:1},children:(0,p.jsx)(a().m,{renderTooltip:()=>(0,p.jsx)("div",{children:e}),render:t=>(0,p.jsxs)("div",{style:{display:"flex",flexDirection:"column"},...t,children:[(0,p.jsx)("div",{style:h.fileName,children:e}),n?(0,p.jsx)("span",{style:h.fileSizeText,children:(0,m().formatFileSize)(n)}):void 0]})})}),g&&y?(0,p.jsx)(u().A,{store:g,fadeIn:!1,actionSectionGroupKey:"comment_media",hideFilterActionsInput:!0,style:{borderRadius:r().VJ.md},hoveredStyle:h.actionMenuHoveredStyle}):void 0]})})}},396933:(e,t,n)=>{n.d(t,{$:()=>r});var o=()=>n(230711),i=()=>n(590526),s=()=>n(617711);function r(e){const{spaceStore:t,viewedUserId:n}=e,r=(0,o().nB)(t),l=(0,o().V_)({spaceStore:t,userId:n});return(0,i().K8)((()=>(0,s().WG)({spaceStore:t,actorRole:r,viewedRole:l})),[t,r,l])}},457190:(e,t,n)=>{n.d(t,{v:()=>l});var o=()=>n(835338),i=()=>n(547149),s=()=>n(848259),r=()=>n(384944);function l(e){const{environment:t,key:n,selectedKey:l,following:a,followSettings:c,navigableBlockId:d,userId:u,spaceId:m,from:p}=e;i().createAndCommit({userAction:"UpdateSidebarFollowControl.setFollowing",environment:e.environment,canUndo:!1,perform:t=>{r().vt({environment:e.environment,table:o().Cy,args:{following:a,followSettings:c,navigableBlockId:d,userId:u,spaceId:m},inMemoryRecordCache:e.environment.defaultRecordCache.inMemoryRecordCache,transaction:t})}}),a?s().KN(t,{from:"page_updates"}):s().tm(t,{from:"page_updates"}),l!==n&&s().EV(t,{from:p,navigableBlockId:d,oldSetting:l,newSetting:n})}},473975:(e,t,n)=>{n.r(t),n.d(t,{DiscussionFormat:()=>j,anyDiscussionCommentsLoading:()=>H,commentComparator:()=>F,discussionLocationToDiscussionFormat:()=>V,formatFileSize:()=>O,getAndSortCommentStoresByTime:()=>N,getDiscussions:()=>R,getDiscussionsForSidebar:()=>B,getFirstComment:()=>L,getIcon:()=>A,getLatestRelevantComment:()=>_,getSetOfUsersInDiscussions:()=>G,hasCommentChanged:()=>z,inputIsEmpty:()=>K,isCommentAllEmojis:()=>W,lineClampForCommentCount:()=>D,sortDiscussionStoresByLatestComment:()=>P});n(898992),n(354520),n(803949),n(581454),n(737550);var o=()=>n(730240),i=()=>n(764880);n(296540);const s={viewBox:"0 0 20 20",fittedViewBox:"1.79 1.87 16.47 15.5",svg:(0,n(474848).jsx)("path",{d:"M9.66 1.977a.63.63 0 0 1 .785.08l2.647 2.647.08.097a.626.626 0 0 1-.866.867l-.098-.08-1.579-1.58v6.95l6.018 3.475-.577-2.155a.626.626 0 0 1 1.207-.324l.97 3.615.019.121a.625.625 0 0 1-.462.645l-3.614.967a.625.625 0 0 1-.325-1.207l2.158-.579-6.015-3.472-5.97 3.55 2.165.55.118.043a.626.626 0 0 1-.301 1.188l-.125-.02-3.627-.922a.625.625 0 0 1-.451-.76l.921-3.626a.625.625 0 0 1 1.212.308L3.4 14.52l5.98-3.554V4.008L7.8 5.588l-.099.08a.626.626 0 0 1-.786-.964l2.647-2.647z"})},r=(0,n(340498).wt)("arrow3D",s,"default");var l=()=>n(300985),a=()=>n(575157),c=()=>n(177148),d=()=>n(251254),u=()=>n(11356),m=()=>n(435644),p=()=>n(421559),f=()=>n(973231),g=()=>n(578717),v=()=>n(916813),y=()=>n(630417),h=()=>n(811563),S=()=>n(201980),b=()=>n(496603),x=()=>n(534177),w=()=>n(939768),k=()=>n(299545);const I=()=>n(43371),C={doc:a().D,docx:a().D,pages:a().D,md:a().D,txt:a().D,rtf:a().D,xls:p().T,xlsx:p().T,csv:p().T,tsv:p().T,ods:p().T,pdf:n(199103).H,pptx:u().G,ppt:u().G,zip:g().p,br:g().p,bz2:g().p,gz:g().p,"7z":g().p,dmg:g().p,pkg:g().p,jar:g().p,rar:g().p,tar:g().p,xar:g().p,stl:r,obj:r,fbx:r,amf:r,iges:r,mp3:f().$,m4a:f().$,wav:f().$,aac:f().$,ogg:f().$,flac:f().$,alac:f().$,wma:f().$,mp4:d().C,m4v:d().C,gifv:d().C,webm:d().C,mkv:d().C,mov:d().C,qt:d().C,avi:d().C,wmv:d().C,asf:d().C,flv:d().C,f4v:d().C,mpeg:d().C,amv:d().C,exe:n(465505).P,otf:m().a,ttf:m().a,woff:m().a,eof:m().a,py:l().Z,java:l().Z,js:l().Z,ts:l().Z,tsx:l().Z,c:l().Z,h:l().Z,cpp:l().Z,go:l().Z,rs:l().Z,css:l().Z,php:l().Z,swift:l().Z,kt:l().Z,lua:l().Z,m:l().Z,bash_profile:l().Z,bashrc:l().Z,zshrc:l().Z,vimrc:l().Z,vim:l().Z};function A(e){const t=function(e){if(!e)return"";const{pathname:t}=w().qg(e);if(!t)return"";const n=t.split(".");return n[n.length-1]}(e).toLowerCase();return C[t]??c().Y}let j=function(e){return e[e.Menu=0]="Menu",e[e.Page=1]="Page",e[e.Sidebar=2]="Sidebar",e[e.Margin=3]="Margin",e[e.Unfurl=4]="Unfurl",e}({});function _({recordStore:e,currentUserId:t,timestamp:n}){return E({recordStore:e,currentUserId:t,timestamp:n})||L(e)}const M=6,T=3;function D(e){return e>1?T:M}function R(e){return e?k().Bw(e,{recursivelyLoadAllDiscussions:!0,includeLoadingDiscussions:!0}):[]}function B({blockStore:e,currentUserId:t,ignoreAfterTime:n}){if(!e)return[];const o=k().Bw(e,{recursivelyLoadAllDiscussions:!0,includeLoadingDiscussions:!0,includePropertyDiscussions:!0}),i=new Map;return o.forEach((e=>{const o=_({recordStore:e,currentUserId:t,timestamp:n});i.set(e.id,o)})),o.sort(((e,t)=>{const n=i.get(e.id),o=i.get(t.id);return null!=n&&n.isDefined()?null!=o&&o.isDefined()?-(n.getCreatedTime()-o.getCreatedTime()):1:-1}))}function F(e,t){return e&&e.isDefined()?t&&t.isDefined()?e.getCreatedTime()-t.getCreatedTime():1:-1}function N(e){return k().wc(e).sort(((e,t)=>F(e,t)))}function L(e){return N(e)[0]}function U(e){return E({recordStore:e,currentUserId:void 0})}function E({recordStore:e,currentUserId:t,timestamp:n}){const o=k().wc(e).filter((e=>n?e.isDefined()&&e.getCreatedTime()<n:e.isDefined())).sort(((e,t)=>F(e,t)));return o[o.length-1]}function P(e){return e.sort(((e,t)=>F(U(e),U(t))))}function K(e){const t=e.state.textStore.getValue(),n=(e.state.files??[]).length>0,o=t&&t.length>0;return!n&&!o}function z(e,t){const n=e.state.textStore.getValue(),o=e.state.files;if(!t)return n&&0!==n.length||o&&o.length>0;const i=k().gp(t).getValue();return!b().n4(i,n)||function(e,t){const n=e.state.files,o=k().dd(t);if(o.length!==n.length)return!0;return o.some(((e,t)=>e.id!==n[t].id))}(e,t)}function H(e){if(e.some((e=>!e.isReady())))return!0;return!!e.map((e=>k().wc(e))).flat().some((e=>!e.isReady()||!e.getCreatedTime()))}function V(e){switch(e){case"block_menu":case"ai_reject_all_suggestions":case"reply_menu_mentions_comments":case"reply_menu_all_updates":case"reply_menu_archive":case"reply_menu_updates_sidebar":case"updates_menu_mentions_comments":case"updates_menu_all_updates":case"updates_menu_archive":return j.Menu;case"page_discussion":case"feed_item_top_level_discussion":return j.Page;case"updates_sidebar":return j.Sidebar;case"margin_comments":case"new_discussions_sheet":return j.Margin;case"comment_unfurl":return j.Unfurl;default:(0,x().HB)(e)}}function G(e){return b().hS(b().qI(e,(e=>k().wc(e).map((e=>({store:e,pointer:e.getCreatedByPointer()}))))),(e=>{var t;return null===(t=e.pointer)||void 0===t?void 0:t.id})).filter((e=>(0,x().O9)(e.pointer))).map((({store:e,pointer:t})=>(0,o().JQ)({parentStore:e,pointer:t}))).map((e=>e.getModel())).filter(x().O9).map((e=>e instanceof h().F?(0,i().A7)(e):e instanceof y().Hj?(0,i().qt)(e):e instanceof v().T?(0,i().Mq)(e):void(0,x().HB)(e))).filter(x().O9)}function W(e){for(const n of e){if(!n.length)return!1;if(!n[1]||!n[1].some(S().nNl)){var t;const e=n[0].trim(),o=I()();if((null===(t=e.match(o))||void 0===t?void 0:t.join(""))!==e)return!1}}return!0}function O(e){return((null==e?void 0:e.match(/[0-9.]+|[a-z]+/gi))??[]).join(" ")}},496889:(e,t,n)=>{n.d(t,{A:()=>v,X:()=>h});n(296540);var o=()=>n(726637),i=()=>n(383036),s=()=>n(882722),r=()=>n(677610),l=()=>n(718827),a=()=>n(807449),c=()=>n(589407),d=()=>n(126617),u=()=>n(100622),m=()=>n(901265),p=()=>n(970501),f=()=>n(206051),g=n(474848);const v=function({tooltipContent:e,fadeIn:t,style:o,hoveredStyle:i,store:s,onClick:r,extraAnalyticsData:l,hideFilterActionsInput:a,actionSectionGroupKey:c,onFocus:d,onBlur:u,iconStyle:v,isFromCollectionView:y,label:S,disabled:b,experimentGroup:x}){const w=(0,n(484714).v3)(),k=b||!s;function I(e){k||function(e,t,n,o,i,s,r,l){(0,p().L)({environment:n,store:t});const a=t.isInLibraryBlock();m().it({environment:n,stores:f().default.state.stores,left:e.clientX,top:e.clientY,showInput:!s,actionSectionGroupKey:a?"library":Boolean(l)?"block_in_collection":r||"default",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{isFromBulkActionsToolbar:i?i.isFromBulkActionsToolbar:void 0}}),null==o||o()}(e,s,w,r,l,a,c,y)}return e?(0,g.jsx)(n(26697).m,{renderTooltip:()=>e,delayThreshold:300,render:e=>(0,g.jsx)(h,{tooltipEvents:e,fadeIn:t,style:o,hoveredStyle:i,onClick:I,onFocus:d,onBlur:u,iconStyle:v,label:S,disabled:k,experimentGroup:x})}):(0,g.jsx)(h,{fadeIn:t,style:o,hoveredStyle:i,onClick:I,onFocus:d,onBlur:u,iconStyle:v,label:S,disabled:k,experimentGroup:x})};function y({style:e,isContentReskinV2:t}){return{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:t?24:26,height:t?24:26,fill:o().A.isMobile?u().Tj.icon.tertiary:u().Tj.icon.secondary,transition:"opacity 200ms ease-in",...e}}function h({tooltipEvents:e={},fadeIn:t,style:n,hoveredStyle:o,onClick:u,onFocus:m,onBlur:p,iconStyle:f,ariaLabel:v,label:h,disabled:S,experimentGroup:b}){const x=(0,r().y)();return(0,g.jsx)(l().Ay,{className:t?s().qGl:void 0,style:y({style:n,isContentReskinV2:x}),hoveredStyle:o,onClick:u,ariaLabel:v,disabled:S,disabledFeedback:S,...(0,i().A)(e,{onFocus:m,onBlur:p}),children:h?(0,g.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:4,width:"100%"},children:[(0,g.jsx)(a().I,{icon:c().ellipsisIcon,style:f}),(0,g.jsx)("div",{style:{fontSize:14},children:h})]}):"vertical_margin"===b||"vertical_2"===b?(0,g.jsx)(a().I,{icon:c().ellipsisIcon,style:f}):(0,g.jsx)(a().I,{icon:d().ellipsisSmallIcon,size:"sm",style:f})})}},518773:(e,t,n)=>{n.d(t,{A:()=>s});var o=()=>n(835338),i=()=>n(534177);function s(e,t){switch(e){case"all":return{following:!0,followSettings:{...(0,o().JY)({explicitly_set_by_user:!0}),feed_setting:t}};case"important":return{following:!0,followSettings:{...(0,o().gK)({explicitly_set_by_user:!0}),feed_setting:t}};case"comments":return{following:!0,followSettings:{...(0,o().lx)({explicitly_set_by_user:!0}),feed_setting:t}};case"none":return{following:!1,followSettings:{...(0,o().gU)({explicitly_set_by_user:!0}),feed_setting:t}};default:(0,i().HB)(e)}}},538075:(e,t,n)=>{n.d(t,{H8:()=>v,I7:()=>h,aE:()=>g});n(296540);var o=()=>n(907258),i=()=>n(517415),s=()=>n(433337),r=()=>n(69708),l=()=>n(534177),a=()=>n(267271),c=()=>n(457190),d=()=>n(495262),u=()=>n(575143),m=()=>n(518773),p=n(474848);const f=(0,r().YK)({repliesAndMentions:{id:"pageNotificationSettings.repliesAndMentions.displayName",defaultMessage:"Mentions"},comments:{id:"pageNotificationSettings.comments.displayName",defaultMessage:"Comments"},allUpdates:{id:"pageNotificationSettings.allUpdates.displayName",defaultMessage:"All"},importantUpdates:{id:"pageNotificationSettings.importantUpdates.displayName",defaultMessage:"Important"}});function g(e){switch(e){case"Mentions":return f.repliesAndMentions;case"Comments":return f.comments;case"All":return f.allUpdates;case"Important":return f.importantUpdates;default:return}}function v(e){const{followSettingsKey:t,environment:n,blockStore:o,from:i}=e,l=y({key:"none",selectedKey:t,title:(0,p.jsx)(r().sA,{id:"GetNotifiedDropdown.repliesAndMentions.label",defaultMessage:"Replies and @mentions"}),displayName:f.repliesAndMentions,environment:n,blockStore:o,from:i}),a=y({key:"comments",selectedKey:t,title:(0,p.jsx)(r().sA,{id:"GetNotifiedDropdown.allComments.label",defaultMessage:"All comments"}),displayName:f.comments,environment:n,blockStore:o,from:i}),c=y({key:"all",selectedKey:t,title:(0,p.jsx)(r().sA,{id:"GetNotifiedDropdown.allUpdates.label",defaultMessage:"All updates"}),caption:(0,p.jsx)(r().sA,{id:"GetNotifiedDropdown.simpleAllUpdates.caption",defaultMessage:"All comments and property changes"}),displayName:f.allUpdates,environment:n,blockStore:o,from:i}),d=o.getAssociatedCollectionStore();if(!d)return[a,l];const u=d.getDatabaseType();if(u===s().dC){return[c,y({key:"important",selectedKey:t,title:(0,p.jsx)(r().sA,{id:"GetNotifiedDropdown.importantUpdatesTasks.label",defaultMessage:"Important updates"}),caption:(0,p.jsx)(r().sA,{id:"GetNotifiedDropdown.importantUpdatesTasks.caption",defaultMessage:"All comments and changes to Status, Assignee, or Due Date"}),displayName:f.importantUpdates,environment:n,blockStore:o,from:i}),l]}if(u===s().Tw){return[c,y({key:"important",selectedKey:t,title:(0,p.jsx)(r().sA,{id:"GetNotifiedDropdown.importantUpdatesProjects.label",defaultMessage:"Important updates"}),caption:(0,p.jsx)(r().sA,{id:"GetNotifiedDropdown.importantUpdatesProjects.caption",defaultMessage:"All comments and changes to Status or Date"}),displayName:f.importantUpdates,environment:n,blockStore:o,from:i}),l]}return[c,y({key:"comments",selectedKey:t,title:(0,p.jsx)(r().sA,{id:"GetNotifiedDropdown.onlyCommentsAllComments.label",defaultMessage:"All comments"}),displayName:f.comments,environment:n,blockStore:o,from:i}),l]}function y(e){const{key:t,title:n,caption:s,selectedKey:r,environment:l,blockStore:f,from:g,displayName:v}=e,y=h({key:t,userSelectedKey:r}),b={icon:{width:14,height:14}};return{action:(0,a().Ls)({key:t,displayName:v,analyticsName:t,validators:[],closeParentMenu:!0,action:()=>{const{currentUserRootStore:e}=o().default.state;if(e){const{following:n,followSettings:o}=(0,m().A)(t),s=e.id,a=f.id,u=f.getSpaceId();c().v({environment:l,following:n,followSettings:o,navigableBlockId:a,spaceId:u,userId:s,from:g,key:t,selectedKey:r}),"inbox"!==g&&"more_menu"!==g||(0,i().r)({item:{label:S(t)},undoFunc:()=>{d().tN({environment:l,preventSelectText:!0});const{following:e,followSettings:n}=(0,m().A)(r);c().v({environment:l,following:e,followSettings:n,navigableBlockId:a,spaceId:u,userId:s,from:g,key:t,selectedKey:r})}})}},render:e=>(0,p.jsx)(u().A,{...e,title:n,caption:s,shouldWrapCaption:!0,isChecked:y,right:!y&&(0,p.jsx)("div",{style:b.icon})})}),title:n,isSelectedOption:y}}function h(e){const{key:t,userSelectedKey:n}=e;return"important"===n||"comments"===n?"important"===t||"comments"===t:t===n}function S(e){switch(e){case"none":return(0,p.jsx)(r().sA,{id:"GetNotifiedDropdown.subscribedRepliesAndMentionsSuccess.snackbarMessage",defaultMessage:"Subscribed to replies and @mentions"});case"comments":return(0,p.jsx)(r().sA,{id:"GetNotifiedDropdown.subscribedAllCommentsSuccess.snackbarMessage",defaultMessage:"Subscribed to all comments"});case"important":return(0,p.jsx)(r().sA,{id:"GetNotifiedDropdown.subscribedImportantUpdatesSuccess.snackbarMessage",defaultMessage:"Subscribed to important updates"});case"all":return(0,p.jsx)(r().sA,{id:"GetNotifiedDropdown.subscribedAllUpdatesSuccess.snackbarMessage",defaultMessage:"Subscribed to all updates"});default:(0,l().HB)(e)}}},686350:(e,t,n)=>{n.d(t,{V:()=>Y});n(898992),n(354520),n(803949),n(581454),n(814603),n(147566),n(198721);var o=n(296540),i=()=>n(726637),s=()=>n(484714),r=()=>n(590526),l=()=>n(401497),a=()=>n(882722),c=()=>n(301809),d=()=>n(843427),u=()=>n(232615),m=()=>n(69708),p=()=>n(496603),f=()=>n(284371),g=()=>n(878523),v=()=>n(892632),y=()=>n(692763),h=()=>n(295304),S=()=>n(260850),b=()=>n(547149),x=()=>n(473975),w=()=>n(763884);function k(e,t){return t?`UnsentDiscussion-${e}-${t}`:`UnsentDiscussion-${e}`}function I(e){const{blockId:t,parentStoreId:n,discussionId:i,discussionFormat:s,userId:r}=e,l=s===x().DiscussionFormat.Page,a=(0,o.useMemo)((()=>function(e){const{blockId:t,parentStoreId:n,discussionId:o,shouldOmitDiscussionId:i}=e;return{primaryKey:k(t,i?void 0:o),legacyKey:k(n,o)}}({blockId:t,parentStoreId:n,discussionId:i,shouldOmitDiscussionId:l})),[t,n,i,l]),c=(0,o.useCallback)((()=>{if(r)return function(e){const{userId:t,primaryKey:n,legacyKey:o}=e,i=w().K.get({userId:t,key:n});if(i)return i;const s=w().K.get({userId:t,key:o});return s?(w().K.set({userId:t,key:n,value:s}),w().K.remove({userId:t,key:o}),s):void 0}({userId:r,primaryKey:a.primaryKey,legacyKey:a.legacyKey})}),[r,a]),d=(0,o.useCallback)((e=>{r&&function(e){const{userId:t,primaryKey:n,legacyKey:o,value:i}=e;i?w().K.set({userId:t,key:n,value:i??null}):w().K.remove({userId:t,key:n}),o!==n&&w().K.remove({userId:t,key:o})}({userId:r,primaryKey:a.primaryKey,legacyKey:a.legacyKey,value:e})}),[r,a]);return(0,o.useMemo)((()=>({loadDraft:c,saveDraft:d})),[c,d])}var C=()=>n(363901),A=()=>n(695115),j=()=>n(26697),_=n(474848);const M=function(e){const{icon:t,onClick:n,tooltip:o,onMouseDown:s}=e,r=(0,C().A)(!0);return(0,_.jsx)(j().m,{renderTooltip:()=>o,render:e=>(0,_.jsx)(A().A,{ariaLabel:o,icon:t,iconStyle:{width:20,height:20},style:{marginInlineStart:i().A.isMobile?16:0},onClick:n,...e,...r,onMouseDown:s})})};const T=function(e){const t=(0,m().tz)(),o=(0,s().v3)(),{device:r}=o,l=(0,C().A)(!0),{canSend:a,canAttach:c,visible:d,onSend:u,onCancel:p,isEditing:f,animated:g,onMention:v,onAttach:y,sendTooltip:h}=e;return(0,_.jsx)(n(756117).A,{initial:{opacity:0},exit:{opacity:0,position:"absolute"},animate:{opacity:1},skip:!g,visible:d,style:{display:"flex",flexDirection:"column-reverse",alignItems:"end",pointerEvents:d?void 0:"none",width:"min-content"},children:(0,_.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:i().A.isMobile?16:6},children:[c?(0,_.jsx)(M,{icon:n(609616).o,onClick:y,tooltip:t.formatMessage({id:"discussionInput.uploadFile.button.tooltip",defaultMessage:"Attach file"}),onMouseDown:e=>{e.preventDefault()}}):void 0,r.isMobileBrowser?void 0:(0,_.jsx)(M,{icon:n(537193).b,onClick:e=>{e.preventDefault(),v()},tooltip:t.formatMessage({id:"discussionInput.insertMention.button.tooltip",defaultMessage:"Mention a person, page, or date"}),onMouseDown:e=>{e.preventDefault()}}),f?(0,_.jsx)("div",{style:{height:14},children:(0,_.jsx)(n(388926).A,{type:"vertical",size:1})}):void 0,f?(0,_.jsx)(A().A,{ariaLabel:t.formatMessage({id:"discussionInput.cancelButton.ariaLabel",defaultMessage:"Cancel editing comment"}),icon:n(637433).xMarkCircleFillIcon,colorPalette:"gray",colorVariant:"secondary",onClick:p,size:i().A.isMobile?"md":"sm",iconStyle:{height:i().A.isMobile?26:24,width:i().A.isMobile?26:24},...l}):null,f?(0,_.jsx)(A().A,{ariaLabel:t.formatMessage({id:"discussionInput.updateButton.ariaLabel",defaultMessage:"Update comment"}),icon:n(209969).checkmarkCircleFillIcon,onClick:u,colorPalette:a?"blue":void 0,colorVariant:a?"accentPrimary":"secondary",disabled:!a,size:i().A.isMobile?"md":"sm",iconStyle:{height:i().A.isMobile?26:24,width:i().A.isMobile?26:24},...l}):(0,_.jsx)(j().m,{disableTooltip:!(0,n(534177).O9)(h),renderTooltip:()=>(0,_.jsx)(_.Fragment,{children:h}),render:e=>(0,_.jsx)(A().A,{ariaLabel:t.formatMessage({id:"discussionInput.sendButton.ariaLabel",defaultMessage:"Send comment"}),icon:n(132855).arrowInCircleUpFillIcon,onClick:u,colorPalette:a?"blue":void 0,colorVariant:a?"accentPrimary":"secondary",disabled:!a,size:i().A.isMobile?"md":"sm",iconStyle:{height:i().A.isMobile?26:24,width:i().A.isMobile?26:24},...(0,n(383036).A)(l,e)})})]})})},D=(0,m().YK)({defaultPlaceholder:{defaultMessage:"Add a comment…",id:"discussionInput.defaultPlaceholder.addComment"},pasteFileIntoCommentNotAllowed:{id:"clipboardActions.pasteFileIntoCommentError.message",defaultMessage:"Sorry, you cannot paste files into a comment."},replyInputPlaceholder:{defaultMessage:"Reply...",id:"updateSidebar.placeholder.addComment"}});var R=()=>n(304740),B=()=>n(165492),F=()=>n(973753),N=()=>n(718827),L=()=>n(995847);function U({children:e,handleRemoveFileClicked:t}){const[n,s]=(0,o.useState)(!1),r=(0,m().tz)(),l=n||i().A.isMobile;return(0,_.jsxs)(N().Ay,{onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),style:P,hoveredStyle:K,pressedStyle:K,children:[e,l?(0,_.jsx)(A().A,{icon:L().xMarkSmallIcon,style:E,hasBackground:!0,colorVariant:"primary",hovered:!1,showShadow:!0,onClick:t,ariaLabel:r.formatMessage({id:"discussionInputAttachment.removeFileButton.label",defaultMessage:"Remove file"})}):void 0]})}const E={position:"absolute",top:-4,insetInlineEnd:-3,height:18,width:18,borderRadius:18},P={position:"relative",cursor:"pointer",width:"min-content",height:"min-content",background:"transparent"},K={background:"transparent"};var z=()=>n(79075),H=()=>n(738471),V=()=>n(360083);const G=function({file:e,isLarge:t}){const i=(0,o.useRef)(null),r=(0,s().v3)(),a=(0,l().IS)((()=>({imageThumbnail:{...{border:`1px solid ${n(100622).Tj.border.secondary}`,borderRadius:8,cursor:"zoom-in"},...t?{objectFit:"contain",width:"auto",height:"auto",maxWidth:120,maxHeight:120,minWidth:48,minHeight:48}:{width:48,height:48}}})),[t]),c=(0,o.useCallback)((()=>{var t;const n=null===(t=i.current)||void 0===t?void 0:t.getImageDimensions();if(!n)return;const{naturalHeight:o,naturalWidth:s}=n;return"local"===e.type?(0,_.jsx)(z().A,{url:e.dataURL,imageNaturalHeight:o,imageNaturalWidth:s}):(0,_.jsx)(V().A,{url:e.source,render:(e,t)=>(0,_.jsx)(z().A,{url:t,error:e,imageNaturalHeight:o,imageNaturalWidth:s}),isAuthenticated:!0,permissionRecord:e.store.pointer})}),[e]),d=(0,o.useCallback)((e=>{var t;e.stopPropagation();const o=null===(t=i.current)||void 0===t?void 0:t.getImageDimensions();o&&n(35622).o9({environment:r,renderFullScreenNode:c,fullScreenNodeRect:o.clientRect,contentAspectRatio:o.naturalWidth/o.naturalHeight})}),[c,r]);return"local"===e.type?(0,_.jsx)(H().A,{src:e.dataURL,style:a.imageThumbnail,placeholderStyle:a.imageThumbnail,onClick:d,ref:i}):(0,_.jsx)(V().A,{url:e.source,isAuthenticated:!0,permissionRecord:e.store.pointer,render:(e,t)=>(0,_.jsx)(H().A,{src:t,style:a.imageThumbnail,placeholderStyle:a.imageThumbnail,onClick:d,ref:i})})},W=3,O=3;function Z({files:e,onRemoveFile:t}){const{images:n,nonImages:o}=(0,r().K8)((()=>{const[t,n]=p().jB(e,(e=>function(e){if("local"===e.type){const t=e.file.type,[n]=t.split("/");if("image"===n)return!0}const t=(0,R().WT)({url:"local"===e.type?e.file.name:e.source,baseUrl:i().A.domainBaseUrl,publicDomainName:i().A.publicDomainName});return"image"===t}(e)&&"local"===e.type&&e.dataURL));return{images:t,nonImages:n}}),[e]);return(0,_.jsxs)("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:4,marginTop:4},children:[(0,_.jsx)($,{files:n,onRemoveFile:t}),(0,_.jsx)(J,{files:o,onRemoveFile:t})]})}function $(e){const{files:t,onRemoveFile:n}=e,o=(0,s().WS)(),i=(0,l().IS)((()=>({container:{display:"flex",flexDirection:"row",gap:4}})),[]);return 0===t.length?null:t.length<=W&&!o?(0,_.jsx)("div",{style:i.container,children:t.map((e=>(0,_.jsx)(U,{handleRemoveFileClicked:()=>n(e),children:(0,_.jsx)(G,{file:e,isLarge:!0})},e.id)))}):(0,_.jsx)(F().A,{children:t.map((e=>(0,_.jsx)(U,{handleRemoveFileClicked:()=>n(e),children:(0,_.jsx)(G,{file:e,isLarge:!1})},e.id)))})}function J({files:e,onRemoveFile:t}){if(0===e.length)return null;const n=e.map((e=>{const n=e.name??"",o="remote"===e.type?e.source:n,i=e.size??"";return(0,_.jsx)(U,{handleRemoveFileClicked:()=>t(e),children:(0,_.jsx)(B().A,{title:n,source:o,size:i,showBlockActionMenuButton:!1})},e.id)}));return e.length<=O?(0,_.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:n}):(0,_.jsx)(F().A,{children:n})}const q=p().sg((e=>{n(165358).log({level:"info",from:"DiscussionInput",type:"draftCommentCreated",data:{...e,timestamp:Date.now()}})}),1e3),Y=o.memo(o.forwardRef(X));function X(e,t){var y;const w=(0,m().tz)(),k=(0,s().v3)(),{device:C,currentUser:A}=k,j=(0,n(59226).X)("editor_basic_rtl"),{onFileUploaded:M}=e,[R,B,F]=(0,r().$y)(e.discussionInputStore),{textStore:N,files:L}=R,U=(0,r().K8)((()=>N.getValue()),[N]),[E,P]=(0,o.useState)(!1),K=(0,o.useRef)(null),{adjustWidthForDraftDiscussions:z,dontMoveCursorToInputEndOnFocus:H}=e,V=e.discussionFormat!==x().DiscussionFormat.Page;(0,o.useImperativeHandle)(t,(()=>({uploadFiles:re})));const G=(0,r().K8)((()=>(0,n(381678)._)(k)),[k]),W=(0,o.useRef)(null===(y=e.blockStore)||void 0===y?void 0:y.clone()),{loadDraft:O,saveDraft:$}=I({blockId:e.blockStore.id,parentStoreId:e.parentStore.id,discussionId:e.inReplyToDiscussionId,discussionFormat:e.discussionFormat,userId:A.id}),J=(0,r().K8)((()=>{const e=u().default.state;return"editing"===e.mode&&(0,d().K)(e.multiSelection)&&e.multiSelection.start.store===N}),[N]),{inputIsEmptyValue:Y,inputHasNewLineCharacter:X}=(0,r().K8)((()=>({inputIsEmptyValue:(0,x().inputIsEmpty)(F),inputHasNewLineCharacter:F.hasNewLineCharacter()})),[F]),oe=J||!Y,ie=(0,o.useCallback)((async()=>{const e=u().default.state;"editing"===e.mode&&(0,d().K)(e.multiSelection)&&e.multiSelection.start.store===N||((0,S().z)({store:N}),await n(908006).default.afterNextFlush())}),[N]),se=(0,r().K8)((()=>Boolean(e.blockStore&&(0,n(715142).dL)(e.blockStore))),[e.blockStore]),re=(0,o.useCallback)((async e=>{if(await ie(),L.length+e.length>10)return void n(792057).f1((0,_.jsx)(m().sA,{id:"discussionInput.uploadFile.tooManyFilesErrorMessage",defaultMessage:"You cannot upload more than {maxFiles} files per comment.",values:{maxFiles:10}}));const t=e.map(v().x9);B({...R,files:[...L,...t]}),null==M||M()}),[ie,L,B,R,M]),le=e.discussionFormat===x().DiscussionFormat.Margin,ae=e.discussionFormat===x().DiscussionFormat.Sidebar;(0,o.useEffect)((()=>{e.commentStore&&n(182034).e(F,e.commentStore)}),[F,e.commentStore]);const ce=(0,o.useRef)(!1),de=(0,o.useCallback)((t=>{$(t),t&&q({parent_id:e.parentStore.id,discussion_id:e.inReplyToDiscussionId,text_length:t.length})}),[$,e.inReplyToDiscussionId,e.parentStore.id]);(0,o.useEffect)((()=>{e.shouldSaveUnsentComments&&ce.current&&de(U),ce.current=!0}),[e.shouldSaveUnsentComments,de,U]);const ue=(0,o.useRef)(N);(0,o.useEffect)((()=>{if(!n(263711).g.state.isOpen&&e.shouldSaveUnsentComments){const e=O();e&&b().createAndCommit({userAction:"DiscussionInput.willMount",environment:k,canUndo:!0,perform:t=>{h().R9({environment:k,store:ue.current,value:e,transaction:t})}})}}),[k,O,e.shouldSaveUnsentComments]);const me=(0,o.useRef)(L);(0,o.useEffect)((()=>{me.current=L}),[L]),(0,o.useEffect)((()=>()=>{me.current&&me.current.forEach((e=>{"local"===e.type&&e.dataURL&&URL.revokeObjectURL(e.dataURL)}))}),[]);const pe=(0,o.useCallback)((({animate:e})=>{if(!W.current)return;const t=n(836724).T.findSelectableFromStore(W.current);t&&(0,n(453607).p)({environment:k,handle:t,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:e})}),[k]);(0,o.useEffect)((()=>{E&&pe({animate:!0})}),[E,pe]);const fe=(0,o.useCallback)((()=>{var e;return null===(e=K.current)||void 0===e?void 0:e.focus()}),[]),{autoFocus:ge=!1}=e;(0,n(852507).l)((()=>{ge&&fe()}));const ve=L&&L.length>0,ye=e.discussionFormat===x().DiscussionFormat.Menu&&e.inReplyToDiscussionId,he=!e.disableFocusRing&&!ye&&(ae||le&&!e.isNewComment),Se=void 0!==e.showCtaButtons?e.showCtaButtons:e.isEditingExistingComment||oe||E,be=!e.isMobileSlideUpMenu,xe=(le||ae)&&!e.isNewComment,we=(0,n(143943).C)({type:"discussionFormat",format:e.discussionFormat}),ke=(0,l().IS)((()=>{const e=we?f().J.UIRegular.mobile:f().J.UIRegular.desktop;return{inputWrapper:{display:"flex",width:z?"calc(100% + 6px)":void 0,flex:z?void 0:1,minWidth:0,fontSize:e,borderRadius:6,transition:"background 300ms ease",cursor:Se?"text":"pointer",alignSelf:"center",position:"relative",flexWrap:"wrap",justifyContent:"flex-end",background:"transparent",alignItems:"center",rowGap:4,columnGap:6,paddingTop:3.5,paddingInlineEnd:4,paddingBottom:3,paddingInlineStart:4,marginTop:-3.5,marginInlineEnd:-4,marginBottom:0,marginInlineStart:-4},textFieldStyle:{fontSize:e,maxHeight:C.isMobileNative?"50vh":"70vh",WebkitOverflowScrolling:"touch",userSelect:"auto",WebkitUserSelect:"auto",lineHeight:"20px",overflow:"auto",whiteSpace:"pre-wrap",padding:"2.5px",margin:"-2.5px"},textFieldWrapper:{flexGrow:1,display:"flex",minHeight:24,paddingTop:2,width:X||i().A.isMobile?"100%":""}}}),[z,Se,C.isMobileNative,X,we]),Ie=function(e){const{isEditing:t,onEditPreviousComment:n,textRef:o}=e;if(!t)return{};const i=e=>{"key"in e&&(e.metaKey||e.ctrlKey)&&o.current&&(0,c().e)({store:o.current.getProps().store})},s=e=>{"key"in e&&(e.metaKey||e.ctrlKey)&&o.current&&(0,S().z)({store:o.current.getProps().store})};return{onUp:n??i,onDown:s}}({isEditing:J,shouldTrapCursorInInput:V,onEditPreviousComment:(0,r().K8)((()=>0===(N.getValue()||[]).length),[N])?e.onEditPreviousComment:void 0,textRef:K}),Ce=()=>{de(void 0),e.onSubmit()},Ae=(0,_.jsx)(T,{visible:Se,onAttach:async()=>{const e=await v().dA({environment:k,supportsMobileNativeFileUpload:!0,multiple:!0});await re(e),g().Sd(k,{type:"file_picker"})},onMention:async()=>{var t;await ie(),n(829300).Gf({environment:k,spaceStore:null===(t=e.blockStore)||void 0===t?void 0:t.getSpaceStore(),mentionTypes:{page:!0,collection:!0,heading:!0,createPage:!1,user:!0,inviteUserToWorkspace:!0,inviteUserToPage:!0,bot:!0,date:!0,reminder:!1,templateVariable:!1,group:!0,team:!0,formulaContextVariable:!1,slackSpecialMention:!1,property:!1}})},canSend:!Y&&!se,canAttach:!0,onSend:Ce,onCancel:e.onCancel,isEditing:e.isEditingExistingComment||!1,animated:Boolean(le||i().A.isMobile),inline:!0,sendTooltip:se?(0,_.jsx)(m().sA,{id:"discussionInput.cannotSubmitBecauseOfAIEdits",defaultMessage:"Resolve pending edits before commenting"}):void 0});return(0,_.jsx)(n(782482).N,{debugName:"DiscussionInput",capture:J,onCommandEnter:p().D_,children:(0,_.jsx)(ne,{enabled:Boolean(W.current)&&Boolean(e.canDrop),store:W.current,onNativeDrop:async({files:e})=>{await re(e),g().Sd(k,{type:"drop"})},children:(0,_.jsx)("div",{className:e.isEditingExistingComment?a().d1T:a().rgg,style:{...Q,...e.containerStyle||{}},onFocus:t=>{const o=t.target;var i;o instanceof HTMLElement&&(0,n(819121).p)(o)&&(null===(i=e.onFocus)||void 0===i||i.call(e),P(!0))},onBlur:t=>{var n;null===(n=e.onBlur)||void 0===n||n.call(e),P(!1)},children:(0,_.jsxs)("div",{style:ee,children:[e.showAvatar?(0,_.jsx)(n(453697).A,{userStore:G,size:n(848565).eQ,avatarShouldShowShadow:!1,style:{...te,marginTop:0,marginInlineEnd:8}}):void 0,(0,_.jsxs)("div",{className:he?a().CCX:"",onClick:fe,style:ke.inputWrapper,tabIndex:-1,children:[(0,_.jsx)("div",{dir:j&&(0,n(209199).A1)()?"rtl":"auto",style:ke.textFieldWrapper,children:(0,_.jsx)(n(729368).A,{style:ke.textFieldStyle,store:N,parentStore:e.parentStore,disabled:!1,onChange:()=>{pe({animate:!1})},onEnter:()=>{if(!i().A.isMobile)return void Ce();const e="editing"===u().default.state.mode&&u().default.state.multiSelection;e&&b().createAndCommit({userAction:"DiscussionInput.handleEnter",environment:k,canUndo:!0,perform:t=>{h().$D({environment:k,editorMode:"default",string:"\n",multiSelection:e,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:t})}})},onCommandEnter:Ce,onPasteFiles:async e=>{await re(e.files),g().Sd(k,{type:"paste"})},onEsc:e.onCancel,...Ie,placeholder:w.formatMessage(xe?D.replyInputPlaceholder:D.defaultPlaceholder),ref:K,isDiscussionInput:!0,disableSlashCommands:!0,disableInsertText:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEmbedMenu:!0,disabledMentionTypes:{reminder:!0,property:!0},disableMobileActionBar:!0,disableStyleAnnotations:C.isMobileBrowser,disableInsertedDeletedAnnotations:C.isMobileBrowser,pasteBehavior:"inline",inPageFind:n(366437).Os.none,className:"discussion-input-text-block",disableMoveCursorToEndOnFocus:H,context:"comment-input"})}),ve?(0,_.jsx)(Z,{files:L,onRemoveFile:e=>{const t=F.state;F.setState({...t,files:t.files.filter((t=>t.id!==e.id))})}}):void 0,Ae]}),be?(0,_.jsx)(n(797324).A,{show:J,onDismiss:()=>(0,n(755125).clear)({environment:k})}):void 0]})})})})}const Q={display:"flex",flexDirection:"column",width:"100%",cursor:"pointer"},ee={display:"flex",alignItems:"center",flexGrow:1},te={flexShrink:0,flexGrow:0,marginInlineEnd:6,alignSelf:"flex-start",marginTop:6};function ne(e){const{enabled:t,children:n,store:o,onNativeDrop:i}=e;return t&&o?(0,_.jsx)(y().Ay,{store:o,analyticsName:"discussion_input",canNativeDropOnto:!0,onNativeDrop:i,keepTextSelectionOnDrop:!0,shouldShowDropZone:!0,children:n}):(0,_.jsx)(_.Fragment,{children:n})}},789557:(e,t,n)=>{n.d(t,{DZ:()=>L,E3:()=>R,JO:()=>N,L6:()=>F,QA:()=>T,Tu:()=>D,lV:()=>B});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(803949);var o=()=>n(908006),i=()=>n(295633),s=()=>n(86159),r=()=>n(103725),l=()=>n(453607),a=()=>n(292985),c=()=>n(785082),d=()=>n(451306),u=()=>n(496603),m=()=>n(878523),p=()=>n(182641),f=()=>n(722101),g=()=>n(384944),v=()=>n(255460),y=()=>n(892632),h=()=>n(279922),S=()=>n(299545),b=()=>n(154023),x=()=>n(295304),w=()=>n(547149),k=()=>n(374026),I=()=>n(807060),C=()=>n(337090),A=()=>n(855821),j=()=>n(741817),_=()=>n(725332),M=()=>n(301523);function T(e){var t,n;const{environment:o,store:i,text:s,files:r,transaction:l,discussionLocation:a,property_id:d,blockStore:u}=e,p=S().eK(i);if(!p)return;const{filesToCreate:f,fileStoresToDelete:g}=function(e,t){const n=[],o=new Set;t.forEach((e=>{"local"===e.type?n.push(e.file):o.add(e.id)}));const i=S().dd(e),s=i.filter((e=>e.getAlive()&&!o.has(e.id)));return{filesToCreate:n,fileStoresToDelete:s}}(i,r);F({commentStore:i,fileBlocks:g,transaction:l}),(0,A().t)({commentStore:i,files:f,environment:o,transaction:l});const v=S().gp(i);x().R9({environment:o,store:v,value:s,transaction:l}),(0,M().x)(i,l);const y=null==i||null===(t=i.getParentStore())||void 0===t?void 0:t.getParentStore(),b=c().eR.includes(a),w=null==p||null===(n=p.getParentStore())||void 0===n?void 0:n.getNavigableBlockStore(),{property_type:k,collection_id:C,collection_view_id:j,view_type:_,collection_view_block_id:T}=(0,I().q)(d,u);m().ZM(o,{from:a,comment_id:i.id,discussion_id:p.id,discussion_type:p.getType(),parent_block_id:p.getParentId(),parent_collection_id:null==y?void 0:y.getParentCollectionIdUpToTwoLevels(),...b&&{inbox_session_id:h().Ay.state.sessionId,notification_page_id:null==w?void 0:w.id},property_type:k,collection_id:C,collection_view_id:j,view_type:_,collection_view_block_id:T})}function D(e){var t,n;const{environment:o,commentStore:i,transaction:s,discussionLocation:r}=e,l=S().eK(i);if(!l)return;const a=S().uB(l),d=a.getValue();if(!d)return;F({commentStore:i,fileBlocks:S().dd(i),transaction:s}),g().zv({store:i,transaction:s,data:{alive:!1}}),w().applyOperation({store:a,operation:{pointer:a.pointer,path:a.path,command:"listRemove",args:{id:i.id}},transaction:s}),(0===d.length||1===d.length&&d[0]===i.id)&&(0,j().v)({environment:o,discussionStore:l,transaction:s}),(0,M().x)(i,s);const u=c().eR.includes(r),p=null==l||null===(t=l.getParentStore())||void 0===t?void 0:t.getNavigableBlockStore();m().gN(o,{from:e.discussionLocation,discussion_id:l.id,discussion_type:l.getType(),comment_id:i.id,parent_block_id:l.getParentId(),parent_collection_id:null===(n=l.getParentStore())||void 0===n?void 0:n.getParentCollectionIdUpToTwoLevels(),...u&&{inbox_session_id:h().Ay.state.sessionId,notification_page_id:null==p?void 0:p.id}})}function R(e){var t,n;const{environment:o,commentStore:i,discussionStore:s,transaction:r,discussionLocation:l}=e;g().zv({store:s,data:{resolved:!1},transaction:r}),(0,_().U)({transaction:r,discussionStore:s});const a=c().eR.includes(l),d=null==s||null===(t=s.getParentStore())||void 0===t?void 0:t.getNavigableBlockStore();m().Jg(o,{comment_id:i.id,discussion_id:s.id,from:e.discussionLocation,parent_block_id:s.getParentId(),parent_collection_id:null===(n=s.getParentStore())||void 0===n?void 0:n.getAssociatedCollectionId(),...a&&{inbox_session_id:h().Ay.state.sessionId,notification_page_id:null==d?void 0:d.id}})}function B(e){var t,n,o;const{environment:i,discussionStore:s,textValue:r,transaction:l,files:a,property_id:d,blockStore:p}=e,{id:f}=i.currentUser;if(!f)return;const g=y().JC(a);if(u().n4(r,[])&&0===g.length)return;const v=(0,C().G)({discussionStore:s,text:r,files:g,markDiscussionRead:!0,environment:i,transaction:l}),S=c().eR.includes(e.discussionLocation),x=null===(t=s.getParentStore())||void 0===t?void 0:t.getNavigableBlockStore(),{property_type:w,collection_id:k,collection_view_id:A,view_type:j,collection_view_block_id:_}=(0,I().q)(d,p),M=(0,b().B)(null==p||null===(n=p.getAssociatedCollectionStore())||void 0===n?void 0:n.getLayoutStore());m().mw(i,{from:e.discussionLocation,comment_id:v.id,discussion_id:s.id,discussion_type:s.getType(),parent_block_id:s.getParentId(),parent_collection_id:null==s||null===(o=s.getParentStore())||void 0===o?void 0:o.getParentCollectionIdUpToTwoLevels(),...S&&{inbox_session_id:h().Ay.state.sessionId,notification_page_id:null==x?void 0:x.id},property_type:w,collection_id:k,collection_view_id:A,view_type:j,collection_view_block_id:_,page_discussion_layout_location:M})}function F(e){const{commentStore:t,fileBlocks:n,transaction:o}=e,i=S().eP(t);n.forEach((e=>{g().zv({store:e,data:{alive:!1},transaction:o}),f().TF({parentStore:i,childToRemoveStore:e,transaction:o})}))}async function N(e){var t;const{discussionStore:n,currentBlockStore:s,environment:c,topOffset:u,animate:m}=e;if(!s)return null;if(!n.isDefined())return null;function p(e){const t=(0,k().S)({discussionId:n.id,blockId:e});if(!t)return;const o=document.getElementsByClassName((0,d().wV)({discussionId:n.id}))[0];let i;if(u){var s;const e=t.getScrollerContext(),n=null==e?void 0:e.verticalScroller,r=null==n?void 0:n.getNode(),l=null==n?void 0:n.getClientRect();if(i=o?o.getBoundingClientRect():null===(s=t.getNode())||void 0===s?void 0:s.getBoundingClientRect(),n&&r&&l&&i){const e=r.scrollTop+i.top,t=l.top;(0,a().V)({element:r,environment:c,options:{top:e-t-u,behavior:"smooth"}})}}else if(o)(0,r().h)({element:o,environment:c,scrollerContext:t.getScrollerContext(),vertical:{reveal:"top"},horizontal:{reveal:"closest"},animate:m}),i=o.getBoundingClientRect();else{var p;(0,l().p)({environment:c,handle:t,vertical:{reveal:"top"},horizontal:{reveal:"closest"},animate:m}),i=null===(p=t.getNode())||void 0===p?void 0:p.getBoundingClientRect()}return t.displaySelectionHalo(750),{selectable:t,rect:i}}const f=(null===(t=n.getRecordStoreUIParent())||void 0===t?void 0:t.id)??n.getParentId();let g=p(f);g||(await v().NH(c,s,[f]),await o().default.afterNextFlush(),g=p(f));return{scrollResult:g,blockStore:i().B.createChildStore(s,n.getParentPointer())}}async function L(e){const{discussionStore:t,currentBlockStore:n,environment:o,analyticsFrom:i,currentEl:r,shouldSetRect:l,animateScroll:a,discussionReadStatus:c}=e,d=await N({discussionStore:t,currentBlockStore:n,environment:o,animate:a});if(!d)return null;const{scrollResult:u,blockStore:m}=d,f=s().get(),g=null==f?void 0:f.commonAncestorContainer,v=!(null!=f&&f.collapsed)&&g&&(r===g||(null==r?void 0:r.contains(g)));p().B4({environment:o,blockStore:m||n,analyticsFrom:i,discussionIds:[t.id],shouldFocusDiscussion:!v,recursivelyLoadAllDiscussions:!1,rect:Boolean(l)?null==u?void 0:u.rect:void 0,discussionReadStatus:c})}},811879:(e,t,n)=>{n.d(t,{E:()=>f});n(296540);var o=()=>n(590526),i=()=>n(401497),s=()=>n(730240),r=()=>n(310442),l=()=>n(824862),a=()=>n(798880),c=()=>n(100622),d=()=>n(534177),u=()=>n(256863),m=()=>n(453697),p=n(474848);function f({authorStore:e,avatarSize:t,avatarStyle:n,hasTooltip:f=!0}){const g=(0,o().K8)((()=>(0,s().d5)(e)),[e]),v=(0,i().IS)((()=>({placeholder:{width:t,height:t,background:c().Tj.background.tertiaryTranslucent,borderRadius:t/2,flexShrink:0,...n}})),[t,n]);return g.asActor?g.table===a().oo?(0,p.jsx)(m().A,{hasPersonHoverCard:!0,hasTooltip:f,userValue:g.asActor,style:n,size:t,avatarShouldShowShadow:!1}):g.table===l().GP?(0,p.jsx)(u().A,{botValue:g,size:t,style:n}):g.table===r().yj?(0,p.jsx)("div",{style:v.placeholder}):void(0,d().HB)(g):(0,p.jsx)("div",{style:v.placeholder})}},846583:(e,t,n)=>{n.d(t,{A:()=>x,T:()=>w});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(296540);var o=()=>n(590526),i=()=>n(401497),s=()=>n(609679),r=()=>n(700500),l=()=>n(713998),a=()=>n(313028),c=()=>n(601813),d=()=>n(792071),u=()=>n(179034),m=()=>n(797809),p=()=>n(201980),f=()=>n(69708),g=()=>n(100622),v=()=>n(284371),y=()=>n(710648),h=()=>n(105157),S=n(474848);const b=new Set([r().xd.toggle,r().xd.bulletedList,r().xd.numberedList,r().xd.quote,r().xd.toDo,r().xd.code,r().xd.callout,r().xd.header,r().xd.subHeader,r().xd.subSubHeader,r().xd.tableRow]);function x(e){const t=(0,i().DP)(),n=(0,f().tz)(),g=(0,o().K8)((()=>{var t;return e.store.isDefined()?null===(t=e.store.getParentStore())||void 0===t?void 0:t.getValue():null}),[e.store]),x=(0,o().K8)((()=>e.blockStore.getSpaceId()),[e.blockStore]),k=(0,o().K8)((()=>{const t=e.store.getParentStore();if(null==t||!t.isType("alias"))return;const n=t.getAliasTargetStore();return(null==n?void 0:n.table)===u().ev&&n.isFormBlock()?{store:n,value:n.getValue()}:void 0}),[e.store]);let I=(0,o().K8)((()=>{if(!e.store.isDefined())return;const t=e.store.getContext(),o=t?(0,c().l8)({discussionContextData:t,discussionType:e.store.getType(),discussionId:e.store.id,intl:n}):void 0;if(!o)return;let i=p().JJ$(o,(t=>!p().iQL(t)||p().Orm(t)===e.store.id));return p().AhH(i)>50&&(i=p().JG8(i,50,[(0,p().Ey_)("…")])),i}),[e.store,n]);const C=(0,o().K8)((()=>{const t=e.blockStore.getAssociatedCollectionStore();if(!t||"collection"!==t.table)return;const n=t.getSchema(),o=e.store.getPropertyId();return void 0!==o?(0,l()._g)({schema:n,property:o}):void 0}),[e.blockStore,e.store]),A=({textValue:n,propertySchema:o,discussionParentValue:i})=>{const l=(0,S.jsx)("div",{style:{overflow:"hidden",lineHeight:"18px",maxHeight:72},children:(0,S.jsx)(y().vY,{value:{value:n,spaceId:x},propertySchema:o,labeled:!1,rootStore:e.blockStore,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!0})});if(!i)return l;const c=i.type;return c===r().xd.code?(0,S.jsx)(a().A,{title:(0,y().Ab)(i),theme:t,style:{marginTop:0,marginBottom:0},children:(0,S.jsx)("span",{style:{fontFamily:v().vc(s().locale).mono,fontSize:12,tabSize:2},children:l})}):(0,y().ux)(c)?(0,S.jsx)(a().A,{title:(0,y().ux)(c),theme:t,style:{marginTop:0,marginBottom:0},children:l}):l},j={display:"flex",width:"100%",marginTop:6,marginBottom:6,fontSize:13,color:t.text.secondary};function _(e){I||(I=[[""]]);const t=(0,m().RX)(n).title;return t?(0,S.jsx)("div",{style:j,children:(0,S.jsxs)("div",{style:{display:"flex",width:"100%"},children:[(0,S.jsx)(w,{}),C?(0,S.jsx)(h().A,{propertySchema:C,dontShowColon:""===I[0][0]}):void 0,A({textValue:I,discussionParentValue:e,propertySchema:t})]})}):null}if("updates_sidebar"===e.discussionLocation){if(!g)return null;if("text"!==g.type&&void 0===C){const t=null!=k&&k.value?k.value:g,n=null!=k&&k.store?k.store:e.blockStore;return(0,S.jsx)("div",{onClick:e.onClick,style:{display:"flex",cursor:d().Bj6.fromBlock(g).isType(r().Si)?"text":void 0},children:I&&b.has(g.type)?_(g):(0,S.jsxs)("div",{style:j,children:[(0,S.jsx)(w,{}),(0,S.jsx)(y().Ay,{blockValue:t,rootStore:n,blockPreviewLocation:"comments_sidebar"})]})})}}return(0,S.jsx)("div",{onClick:e.onClick,style:{cursor:"text"},children:_()})}function w(){const e=(0,i().eP)(),t=(0,i().IS)((()=>({bar:{width:2,marginInlineStart:1,borderRadius:4,marginInlineEnd:8,background:(0,g().eb)(e),flexShrink:0}})),[e]);return(0,S.jsx)("div",{style:t.bar})}},973753:(e,t,n)=>{n.d(t,{A:()=>k});var o=n(296540),i=()=>n(755877),s=()=>n(578510),r=()=>n(484714),l=()=>n(590526),a=()=>n(401497),c=()=>n(611648),d=()=>n(150669),u=()=>n(917150),m=()=>n(807449),p=()=>n(695115),f=()=>n(490969),g=()=>n(62900),v=()=>n(569397),y=()=>n(69708),h=()=>n(100622),S=()=>n(141333),b=n(474848);const x=.8,w=(0,y().YK)({scrollLeftButtonAriaLabel:{defaultMessage:"Scroll left",id:"FilmStrip.scrollLeftButtonAriaLabel"},scrollRightButtonAriaLabel:{defaultMessage:"Scroll right",id:"FilmStrip.scrollRightButtonAriaLabel"}});function k({children:e,shouldShowGrayFog:t}){const n=(0,y().tz)(),k=(0,o.useRef)(null),I=(0,r().v3)(),C=(0,l().uB)(void 0,d().A),A=(0,l().K8)((()=>C.state.elementRef),[C]),j=(0,S().HD)(A),_=(0,S().Xg)(A),M=(0,S().sj)(A),T=(0,o.useCallback)((()=>{var e;null===(e=k.current)||void 0===e||e.getClientRect()}),[]);(0,o.useEffect)((()=>((0,i().P)(window,"resize",T),()=>{(0,s().O)(window,"resize",T)})),[T]),(0,o.useEffect)((()=>{T()}),[T]);const D=M>0,R=Math.ceil(M+j)<_,B=(0,o.useCallback)((e=>{var t;e.stopPropagation(),(0,f().H)({element:null===(t=k.current)||void 0===t?void 0:t.getNode(),environment:I,options:{left:-x*j,behavior:"smooth"}})}),[j,I]),F=(0,o.useCallback)((e=>{var t;e.stopPropagation(),(0,f().H)({element:null===(t=k.current)||void 0===t?void 0:t.getNode(),environment:I,options:{left:x*j,behavior:"smooth"}})}),[j,I]),N=(0,a().IS)((()=>({scrollerWrapper:{display:"flex",position:"relative"},scroller:{overflow:"auto",display:"flex",gap:4,zIndex:0,paddingTop:6,marginTop:-6,paddingInlineEnd:4},commonArrowStyles:{position:"absolute",borderRadius:12,width:24,height:24,background:h().Tj.background.tertiaryTranslucent,top:12,boxShadow:"none"},iconHoveredStyle:{background:h().Tj.background.tertiaryTranslucent},leftArrowStyle:{insetInlineStart:0},rightArrowStyle:{insetInlineEnd:4},leftArrowContainer:{position:"absolute",height:"100%",width:30,background:`linear-gradient(to right, ${t?h().Tj.hoveredMarginDiscussionBackground:h().Tj.selectedMarginDiscussionBackground} 0px, ${h().Tj.contentBackgroundTransparent} 30px`},rightArrowContainer:{position:"absolute",height:"100%",width:30,insetInlineEnd:0,background:`linear-gradient(to left, ${t?h().Tj.hoveredMarginDiscussionBackground:h().Tj.selectedMarginDiscussionBackground} 0px, ${h().Tj.contentBackgroundTransparent} 30px`}})),[t]);return(0,b.jsxs)("div",{style:N.scrollerWrapper,children:[(0,b.jsx)(u()._,{ref:k,type:c().A.X,store:C,onScroll:T,style:N.scroller,children:e}),D?(0,b.jsx)("div",{style:N.leftArrowContainer,children:(0,b.jsx)(p().A,{icon:()=>(0,b.jsx)(m().I,{icon:g().arrowStraightLeftSmallIcon,size:"sm",colorVariant:"secondary"}),hovered:!1,showShadow:!0,onClick:B,ariaLabel:n.formatMessage(w.scrollLeftButtonAriaLabel),style:{...N.commonArrowStyles,...N.leftArrowStyle},hoveredStyle:N.iconHoveredStyle})}):void 0,R?(0,b.jsx)("div",{style:N.rightArrowContainer,children:(0,b.jsx)(p().A,{icon:()=>(0,b.jsx)(m().I,{icon:v().arrowStraightRightSmallIcon,size:"sm",colorVariant:"secondary"}),hovered:!1,showShadow:!0,onClick:F,ariaLabel:n.formatMessage(w.scrollRightButtonAriaLabel),style:{...N.commonArrowStyles,...N.rightArrowStyle},hoveredStyle:N.iconHoveredStyle})}):void 0]})}}}]);