"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[37759],{326887:(e,t,o)=>{o.d(t,{$X:()=>n,H8:()=>a,x2:()=>i});var r=()=>o(534177);function i(e){return"event"===e||"recurrence"===e}function n(e){const t=e.getTrigger();return(0,r().O9)(t)&&i(t.type)}function a(e){return"event"===e?"event":"recurrence"===e?"recurrence":void(0,r().HB)(e)}},422540:(e,t,o)=>{o.d(t,{$0:()=>_,Fx:()=>h,Ge:()=>g,I3:()=>d,Kj:()=>b,PP:()=>B,TK:()=>F,Yy:()=>p,aE:()=>k,cQ:()=>A,kH:()=>m,m7:()=>f,nq:()=>M,nv:()=>v,tj:()=>y});o(898992),o(354520),o(737550);var r=()=>o(496603),i=()=>o(534177),n=()=>o(381283),a=()=>o(898244),s=()=>o(651124),l=()=>o(349835),u=()=>o(390066);const c={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,place:!1},p={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function d(e){return Boolean(c[e.type]&&!(0,a().UU)(e)&&(!(0,a().$M)(e)||void 0===(0,a().om)(e)))}function f(e){const{collectionFormat:t,collectionSchema:o,filter:n,sort:l,sourcePropertyIds:c}=e,p=(c??(0,i().uv)(o)).filter(((t,r,i)=>{const s=o[t];return!(!s||!d(s))&&(("relation"!==s.type||!e.restrictCrossSpace||!(0,a().o2)(e.spaceId,s))&&(!n||n([t,s],r,o)))}));if(0===p.length)return[];if(!t||!1===l)return p;const f=(0,u().L)(t,o,void 0,s().jf.Page).collection_page_properties||[];return r().Ul(p,(e=>f.findIndex((t=>t.property===e))))}function g(e){const{collectionFormat:t,collectionSchema:o,sort:a}=e,l=(0,i().uv)(o).filter(((e,t,r)=>{const i=o[e];return!(!i||!(0,n().J)(i))}));if(0===l.length)return[];if(!t||!1===a)return l;const c=(0,u().L)(t,o,void 0,s().jf.Page).collection_page_properties||[];return r().Ul(l,(e=>c.findIndex((t=>t.property===e))))}function m(e){return e.type===l().M9.InvalidCharacter?{type:e.type,character:e.character}:e.type===l().M9.TokenExpected?{type:e.type,token:e.token}:e.type===l().uW.MissingSchemaPropertyOnThisRow||e.type===l().uW.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property,errorSource:e.errorSource}:e.type===l().uW.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection,errorSource:e.errorSource}:e.type===l().uW.MissingContextVariable?{type:e.type,valueId:e.valueId,errorSource:e.errorSource}:e.type===l().uW.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments,errorSource:e.errorSource}:e.type===l().uW.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex,errorSource:e.errorSource}:e.type===l().uW.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex,errorSource:e.errorSource}:e.type===l().uW.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer,node:e.node,errorSource:e.errorSource}:e.type===l().uW.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer,errorSource:e.errorSource}:e.type===l().uW.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection,errorSource:e.errorSource}:e.type===l().uW.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property,errorSource:e.errorSource}:e.type===l().uW.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType,errorSource:e.errorSource}:e.type===l().uW.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes,errorSource:e.errorSource}:e.type===l().uW.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name,errorSource:e.errorSource}:"errorSource"in e?{type:e.type,errorSource:e.errorSource}:{type:e.type}}const y={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,place:!1};function _(e){return Boolean(y[e.type])}function v(e){const{collectionFormat:t,collectionSchema:o,filter:n,sort:l}=e,c=(0,i().uv)(o).filter(((e,t,r)=>{var i;const s=o[e];return!(!s||!y[s.type])&&((!(0,a().$M)(s)||null===(i=(0,a().om)(s))||void 0===i||!i.auto_update_on_edit)&&(!n||n([e,s],t,o)))}));if(0===c.length)return[];if(!t||!1===l)return c;const p=(0,u().L)(t,o,void 0,s().jf.Page).collection_page_properties||[];return r().Ul(c,(e=>p.findIndex((t=>t.property===e))))}const T={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,place:!1};function M(e){return T[e.type]}const S={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,place:!1};function b(e){return S[e.type]}function A(e){return 0===e}function h(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function B(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function F(e){const{collectionSchema:t,property:o,type:r}=e,i=null==t?void 0:t[o];return!i||("action"===r?!d(i):!y[i.type])}function k({automationTrigger:e,collectionSchema:t}){if("event"===(null==e?void 0:e.type)){const{pagesAdded:o,pagePropertiesEdited:r,source:n}=e.event;if(void 0===n)return!1;const a="some"===r.type&&r.some,s="all"===r.type&&r.all;if((a||s||[]).some((e=>B({collectionSchema:t,property:e.property})||F({collectionSchema:t,property:e.property,type:"trigger"}))))return!1;const l="some"===r.type&&(!(0,i().O9)(r.some)||0===r.some.length),u="all"===r.type&&(!(0,i().O9)(r.all)||0===r.all.length);if(!o&&("none"===r.type||l||u))return!1}else{if("recurrence"!==(null==e?void 0:e.type))return!1;if(!e.recurrence)return!1}return!0}},546461:(e,t,o)=>{o.d(t,{K4:()=>S,To:()=>B,fi:()=>b,q8:()=>M,u:()=>T});o(16280),o(18107),o(967357);var r=o(296540),i=()=>o(484714),n=()=>o(792485),a=()=>o(590526),s=()=>o(79926),l=()=>o(140934),u=()=>o(322867),c=()=>o(69708),p=()=>o(534177),d=()=>o(813297),f=()=>o(326887),g=()=>o(862292),m=()=>o(190019),y=()=>o(76190),_=o(474848);const v=(0,r.createContext)({ancestors:[]});v.displayName="AutomationContext";v.Consumer;function T(e){const{automationStore:t,children:o,contextType:T,enableExistenceGuarantees:M}=e,S=(0,i().v3)(),b=(0,c().tz)(),{value:B}=(0,s().fJ)(g().T.formulas),{value:F}=(0,s().fJ)(d().QV.automationTypecheck),k=(0,y().n)(t),E=(0,n().S)(),I=(0,a().K8)((()=>{if(!B)return{error:new(u().N9)("Missing formulas dependency")};if(!F)return{error:new(u().N9)("Missing automation dependency")};const e=function(e){const{environment:t,automationStore:o,automationTypecheckModule:r,contextType:i,formulasModule:n,intl:a,isSubscribed:s,pageStore:u,enableExistenceGuarantees:c}=e,d=function(e,t){if(t)return A.get(e);return A.get(e)??h.get(e)}(o,c);if(d)return d;const g=new(l().ComputedStore)((()=>{const e=o.getTriggerType();let l=i;return(0,p().O9)(e)&&(0,f().x2)(e)&&(l=(0,f().H8)(e)),(0,m().Z)({environment:t,automationStore:o,automationTypecheckModule:r,contextType:l,formulasModule:n,intl:a,isSubscribed:s,pageStore:u,enableExistenceGuarantees:c})}),{debugName:"automationContextTypecheckResultCachedStore"});return function(e,t,o){o?(A.set(e,t),h.set(e,t)):h.set(e,t)}(o,g,c),g}({automationStore:t,automationTypecheckModule:F,contextType:T,environment:S,formulasModule:B,intl:b,isSubscribed:k,pageStore:"button_block"===T?null==E?void 0:E.pageStore:void 0,enableExistenceGuarantees:M});return e.state}),[S,t,F,T,B,b,k,null==E?void 0:E.pageStore,M]),P=(0,r.useContext)(v),H=(0,r.useMemo)((()=>0===P.ancestors.length?[{automationStore:t,contextType:T,typecheckResult:I}]:[...P.ancestors,{automationStore:t,contextType:T,typecheckResult:I}]),[P,t,T,I]),C=(0,r.useMemo)((()=>({ancestors:H,enableExistenceGuarantees:M})),[H,M]);return(0,_.jsx)(v.Provider,{value:C,children:o})}function M(){const e=(0,r.useContext)(v).ancestors.at(-1);if(!e)throw new Error("No automation context found!");return e}function S(){return(0,r.useContext)(v).ancestors.at(-1)}function b(){return(0,r.useContext)(v).enableExistenceGuarantees}const A=new WeakMap,h=new WeakMap;function B(e){var t;return null===(t=A.get(e))||void 0===t?void 0:t.state}},637759:(e,t,o)=>{o.d(t,{A8:()=>F,B0:()=>w,DW:()=>W,EN:()=>H,EZ:()=>V,Gz:()=>I,Qn:()=>h,RN:()=>C,TT:()=>E,_T:()=>R,aS:()=>x,bI:()=>B,iX:()=>N,l:()=>P,rc:()=>k});o(16280),o(898992),o(823215),o(354520),o(581454),o(737550);var r=o.n(o(844751)),i=()=>o(242422),n=()=>o(732810),a=()=>o(569797),s=()=>o(422540),l=()=>o(214388),u=()=>o(898244),c=()=>o(537012),p=()=>o(239381),d=()=>o(206267),f=()=>o(273900),g=()=>o(519831),m=()=>o(201980),y=()=>o(496603),_=()=>o(973647),v=()=>o(534177),T=()=>o(653417),M=()=>o(833106),S=()=>o(680288),b=()=>o(499764),A=()=>o(615623);function h(e){const{automationStore:t,collectionStore:o,typecheckResult:r}=e,i=o.getSchema(),n=t.getKeyStore("properties").getKeyStore("name").getValue();if(null==n||!n.trim())return!1;if(!(0,s().aE)({automationTrigger:t.getTrigger(),collectionSchema:i}))return!1;const a=t.getActionStores().filter((e=>e.isDefined()));return 0!==a.length&&a.every((e=>B({actionStore:e,collectionStore:o,typecheckResult:r})))}function B(e){const{actionStore:t,collectionStore:o,typecheckResult:r}=e;if((0,T().getValidationErrorsForAction)(r,t.id).length>0)return!1;if(t.isType("slack_notification"))return(0,v().O9)(t.getConfigStore().getKeyStore("external_bot_id").getValue())&&(0,v().O9)(t.getConfigStore().getKeyStore("target").getValue());if(t.isType("send_gmail_notification")){const e=t.getConfigStore(),o=e.getKeyStore("to").getValue(),r=e.getKeyStore("email_subject").getValue(),i=e.getKeyStore("email_body").getValue();return!(!r||!i||(0,m().w9s)(r.value)||(0,m().w9s)(i.value))&&!(!(o&&o.value&&o.value.value)||y().Im(o.value.value))}if(t.isType("update_pages")){const e=t.getConfigStore().getKeyStore("target").getValue(),i=t.getConfigStore().getKeyStore("properties").getValue()??[];if(!(0,v().O9)(e)||0===i.length)return!1;if("collection"===e.type){const t=n().m.createChildStore(o,e.collection).getSchema();if(i.some((e=>(0,s().PP)({property:e,collectionSchema:t})||(0,s().TK)({collectionSchema:t,property:e,type:"action"}))))return!1}else if("variable"===e.type){const n=(0,p().y5)(e.id);if("global"===n.source&&"button_page"===n.global){const e=o.getSchema();if(i.some((t=>(0,s().PP)({property:t,collectionSchema:e})||(0,s().TK)({collectionSchema:e,property:t,type:"action"}))))return!1}else{if(_().Q.isFail(r))return!1;const o=(0,p().IV)(r.value.valueTypes,e.id),n=o?F(o,t):void 0;if(!n)return!1;const a=n.getSchema();if(i.some((e=>(0,s().PP)({property:e,collectionSchema:a})||(0,s().TK)({collectionSchema:a,property:e,type:"action"}))))return!1}}else{if("page"===e.type)return!1;(0,v().HB)(e)}return!0}if(t.isType("create_page")){const e=t.getConfigStore().getKeyStore("collection").getValue();if(!(0,v().O9)(e))return!1;const r=n().m.createChildStore(o,e).getSchema();return!(t.getConfigStore().getKeyStore("properties").getValue()??[]).some((e=>(0,s().PP)({property:e,collectionSchema:r})||(0,s().TK)({collectionSchema:r,property:e,type:"action"})))}if(t.isType("send_in_app_notification")){const e=t.getConfigStore(),o=e.getKeyStore("target").getValue(),r=e.getKeyStore("notification_message").getValue();if(!o||!r||(0,m().w9s)(r.value))return!1;switch(o.type){case"property":if(!o.propertyId||!o.collectionPointer)return!1;break;case"formula":if(!o.value||!o.value.value||y().Im(o.value.value))return!1}return!0}if(t.isType("define_variables"))return!0;if(t.isType("http_request"))return!0;if(t.isType("publish_site")){const e=t.getConfigStore().getKeyStore("target").getValue();return!!(0,v().O9)(e)}if(t.isType("worker"))return!0;throw new Error(`isActionStoreComplete not implemented for ${t.getType()}`)}function F(e,t){let o;return"block"===e.type.type&&e.type.collection?o=n().m.createChildStore(t,e.type.collection):"array"===e.type.type&&"block"===e.type.of.type&&e.type.of.collection&&(o=n().m.createChildStore(t,e.type.of.collection)),o}async function k(e){const{collectionStore:t}=e;if(!t||(0,b().qe)(t)||(0,b().X6)(t))return!1;if(!(await(0,A().S)(t.environment,{name:"premium_automations",spaceId:t.getSpaceId(),userId:t.userId})))return!1;const o=t.pointer,r=t.getSpaceId();return(0,c().rM)({targetTriggerType:"event",targetParentPointer:o,targetSpaceId:r}).every((({pointer:e,minimumRequiredRole:o})=>{const r=t.getRecordRole(e);return!!r&&(0,f().q_)(r,o)}))}async function E(e){const{automationStore:t,actionStores:o,collectionStore:r}=e,i=t.getParentStore();if(!i||(0,b().qe)(i)||(0,b().X6)(r))return!1;const n=t.getMinimumFieldsForPermissions();if(!n)return!1;if(!o.every((e=>e.isDefined())))return!1;const a=o.some((e=>!e.isType("slack_notification")));if(!(await(0,A().S)(r.environment,{name:"premium_automations",spaceId:r.getSpaceId(),userId:r.userId}))&&a)return!1;return(0,c().Ls)({automationValue:n,actionValues:o.map((e=>({config:e.getConfig(),type:e.getType()})))}).every((({pointer:e,minimumRequiredRole:o})=>{const r=t.getRecordRole(e);return!!r&&(0,f().q_)(r,o)}))}function I(e){const{automationStore:t,collectionStore:o}=e,r=t.getParentStore();if(!r||(0,b().qe)(r)||(0,b().X6)(o))return!1;const i=t.getMinimumFieldsForPermissions();if(!i)return!1;return(0,c().yx)(i).every((({pointer:e,minimumRequiredRole:o})=>{const r=t.getRecordRole(e);return!!r&&(0,f().q_)(r,o)}))}function P(e){const{automationStore:t,collectionStore:o}=e;if(!t.isTriggerType("event"))return!1;const r=t.getEventConfiguration();if(!r||void 0===r.source||r.source.type===g().Vl||"filter"===r.source.type)return!1;const i=a().p.createChildStore(o,r.source.pointer);return function(e){const t=C(e),o=H(e);return(0,v().O9)(t)||(0,v().O9)(o)}({collectionSchema:o.getSchema(),collectionViewStore:i})}function H(e){var t;const{collectionViewStore:o,collectionSchema:r}=e,i=o.getPropertyFiltersStore().getValue()??[],n=null===(t=(0,M().$)({collectionViewStore:o,schema:r}))||void 0===t?void 0:t.filter,a={operator:"and",filters:(0,l().rg)({propertyFilters:i,combinatorFilter:n,schema:r})},s=(0,l().CU)(a,(e=>{if((0,l().yX)(e)){const t=r[e.property];return!!t&&(0,u().CH)(o.getSpaceId(),t,r)}return!1}));if(s)return(0,l().yX)(s)?s.property:void 0}function C(e){var t;const{collectionViewStore:o,collectionSchema:r}=e,i=o.getPropertyFiltersStore().getValue()??[],n=null===(t=(0,M().$)({collectionViewStore:o,schema:r}))||void 0===t?void 0:t.filter,a={operator:"and",filters:(0,l().rg)({propertyFilters:i,combinatorFilter:n,schema:r})},u=(0,l().CU)(a,(e=>{if((0,l().yX)(e)){const t=r[e.property];return!!t&&!(0,s().Kj)(t)}return!1}));if(u)return(0,l().yX)(u)?u.property:(0,l().LB)(u)?u.timestamp:void 0}function x(e){if("collectionTypedView"===e.contextTypeFromStoreState)return!1;const t=e.collectionStore();return!!t&&(!(t.isExternallyImportedAndSyncedCollection()||t.isSyncedCollection()&&!i().default.checkGate({gateName:"support_synced_database_automations"}))&&void 0===e.viewsModuleContextStore.state)}function N(e){const{collectionSchema:t,propertyIds:o,searchTerm:i}=e;if(!i)return o.slice(0);const n=new Map,a=o.map((e=>{const o=t[e],r=o?`${o.name} ${S().dC[o.type]}`:"";return n.set(e,r),r})),s=r().filter(i,a).map((({original:e})=>e));return o.filter((e=>s.includes(n.get(e)??"")))}function w(e){return{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:e.getSpaceShardedPointer(),type:g().Vl}}}function V(e){const{automationId:t,automationName:o,collectionStore:r,userId:i}=e;return function(e){const{actionIds:t,automationId:o,collectionStore:r,eventConfiguration:i,lastEditedTime:n,properties:a,userId:s}=e,l=Date.now();return{action_ids:t,alive:!0,created_by_id:s,created_by_table:"notion_user",created_time:l,id:o,last_edited_by_id:s,last_edited_by_table:"notion_user",last_edited_time:n??l,parent_id:r.id,parent_table:g().Vl,properties:a??{},space_id:r.getSpaceId(),status:"active",trigger:{event:i,id:d().JW(),type:"event"},version:1}}({actionIds:[],automationId:t,collectionStore:r,eventConfiguration:w(r),properties:{name:o},userId:i})}function R(e){const{tab:t}=e;return!!t&&("automationSettings"===t.type||"mobileCreateAutomation"===t.type||"mobileEditAutomation"===t.type||"mobileEditButtonAutomation"===t.type)}function W(e){const t=e.collectionStore();if(!t)return!1;return t.getAutomationStores().some((e=>{const t=e.getModel();return(null==t?void 0:t.isFailing())??!1}))}},653417:(e,t,o)=>{o.r(t),o.d(t,{TooltipWithSubtitle:()=>y,automationErrorMessages:()=>f,getErrorMessagesForActionValidationFailure:()=>g,getFormulaTokenVariant:()=>d,getValidationErrorsForAction:()=>_,useErrorComponentForAction:()=>m,useRequiresSubscriptionUpgradeError:()=>v});o(898992),o(354520),o(296540);var r=()=>o(590526),i=()=>o(401497),n=()=>o(236262),a=()=>o(69708),s=()=>o(100622),l=()=>o(973647),u=()=>o(534177),c=()=>o(546461),p=o(474848);function d(e){if(!e)return"default";const{parseErrors:t,typeErrors:o,typeWarnings:r}=e,i=(0,u().O9)(t)&&t.length>0,n=(0,u().O9)(o)&&o.length>0,a=(0,u().O9)(r)&&r.length>0;return i||n?"error":a?"warning":"default"}const f=(0,a().YK)({missingWorkerId:{id:"clientAutomationHelpers.errorMessages.missingWorkerId",defaultMessage:"Missing worker ID"},missingCapabilityKey:{id:"clientAutomationHelpers.errorMessages.missingCapabilityKey",defaultMessage:"Missing capability key"},workersNotEnabled:{id:"clientAutomationHelpers.errorMessages.workersNotEnabled",defaultMessage:"Workers are not enabled"},workerNotFound:{id:"clientAutomationHelpers.errorMessages.workerNotFound",defaultMessage:"Worker not found"},capabilityNotFound:{id:"clientAutomationHelpers.errorMessages.capabilityNotFound",defaultMessage:"Capability not found"},missingTargetDatabase:{id:"clientAutomationHelpers.errorMessages.missingTargetDatabase",defaultMessage:"Missing a target database"},missingNotificationCollectionPointer:{id:"clientAutomationHelpers.errorMessages.missingNotificationCollectionPointer",defaultMessage:"Missing database for property target"},missingNotificationTarget:{id:"clientAutomationHelpers.errorMessages.missingNotificationTarget",defaultMessage:"Missing notification recipients"},missingRecipients:{id:"clientAutomationHelpers.errorMessages.missingRecipients",defaultMessage:"Missing notification recipients"},missingEmailSubject:{id:"clientAutomationHelpers.errorMessages.missingEmailSubject",defaultMessage:"Missing email subject"},missingEmailBody:{id:"clientAutomationHelpers.errorMessages.missingEmailBody",defaultMessage:"Missing notification email body"},missingNotificationMessage:{id:"clientAutomationHelpers.errorMessages.missingNotificationMessage",defaultMessage:"Missing notification message"},missingNotificationPropertyId:{id:"clientAutomationHelpers.errorMessages.missingPropertyId",defaultMessage:"Missing target property"},missingNotificationFormulaValue:{id:"clientAutomationHelpers.errorMessages.missingFormulaValue",defaultMessage:"Missing recipients"},invalidNotificationFormulaValue:{id:"clientAutomationHelpers.errorMessages.invalidFormulaValue",defaultMessage:"Invalid recipients"},invalidNotificationPropertyId:{id:"clientAutomationHelpers.errorMessages.invalidPropertyId",defaultMessage:"Invalid property type"},deletedNotificationPropertyId:{id:"clientAutomationHelpers.errorMessages.deletedPropertyId",defaultMessage:"Property was deleted"},missingTargetPage:{id:"clientAutomationHelpers.errorMessages.missingTargetPage",defaultMessage:"Missing a target"},invalidTemplatePage:{id:"clientAutomationHelpers.errorMessages.invalidTemplatePage",defaultMessage:"Invalid template."},noActions:{id:"clientAutomationHelpers.errorMessages.noActions",defaultMessage:"This button has no actions"},createPageButtonError:{id:"clientAutomationHelpers.errorMessages.createPageButtonError",defaultMessage:"Add page is missing a target database"},collectionInTrashButtonError:{id:"clientAutomationHelpers.errorMessages.collectionInTrashButtonError",defaultMessage:"Target database is in trash"},collectionNotFoundButtonError:{id:"clientAutomationHelpers.errorMessages.collectionNotFoundButtonError",defaultMessage:"Target database not found"},blockInTrashButtonError:{id:"clientAutomationHelpers.errorMessages.blockInTrashButtonError",defaultMessage:"Target block is in trash"},createPageButtonTemplateError:{id:"clientAutomationHelpers.errorMessages.createPageWithTemplateError",defaultMessage:"Add page has an invalid template"},openPageOrUrlButtonError:{id:"clientAutomationHelpers.errorMessages.openPageFormOrUrlButtonError",defaultMessage:"Open page, form, or URL is missing a target"},updatePagesButtonError:{id:"clientAutomationHelpers.errorMessages.editPagesButtonError",defaultMessage:"Edit pages is missing a target database"},slackNotificationAuthenticationError:{id:"clientAutomationHelpers.errorMessages.slackNotificationError",defaultMessage:"Slack notification is missing an authentication."},slackNotificationTargetError:{id:"clientAutomationHelpers.errorMessages.slackNotificationTargetError",defaultMessage:"Slack notification is missing a target channel."},sendGmailNotificationMissingAuthenticationError:{id:"clientAutomationHelpers.errorMessages.sendGmailNotificationMissingAuthenticationError",defaultMessage:"Gmail notification is missing an authentication."},sendGmailNotificationInvalidAuthenticationError:{id:"clientAutomationHelpers.errorMessages.sendGmailNotificationInvalidAuthenticationError",defaultMessage:"Requires a re-authentication with Gmail"},missingRequiredRecordError:{id:"clientAutomationHelpers.errorMessages.missingRequiredRecordError",defaultMessage:"Action is missing access to a record"},invalidConfig:{id:"clientAutomationHelpers.errorMessages.invalidConfig",defaultMessage:"Unsupported settings"},invalidFormulaParseError:{id:"clientAutomationHelpers.errorMessages.invalidFormulaParseError",defaultMessage:"Formula contains a parsing error"},invalidFormulaTypeError:{id:"clientAutomationHelpers.errorMessages.invalidFormulaTypeError",defaultMessage:"Formula contains a type error"},invalidFormulaTypeWarning:{id:"clientAutomationHelpers.errorMessages.invalidFormulaTypeWarning",defaultMessage:"Formula contains a type warning"},invalidFormulaMissingReturnType:{id:"clientAutomationHelpers.errorMessages.invalidFormulaMissingReturnType",defaultMessage:"Formula does not have a return type"},invalidSendWebhookActionUrl:{id:"clientAutomationHelpers.errorMessages.invalidSendWebhookActionUrl",defaultMessage:"URL is invalid"},invalidSendWebhookActionCustomHeaderField:{id:"clientAutomationHelpers.errorMessages.invalidSendWebhookActionCustomHeaderField",defaultMessage:"Custom header field is invalid"},tooManyCustomHeaders:{id:"clientAutomationHelpers.errorMessages.tooManyCustomHeaders",defaultMessage:"Too many custom headers"},missingTargetVariable:{id:"clientAutomationHelpers.errorMessages.missingTargetVariable",defaultMessage:"Unable to find target variable"},crossSpaceRelation:{id:"clientAutomationHelpers.errorMessages.crossSpaceRelation",defaultMessage:"Cross-workspace features are restricted in automations and will not work"},crossSpacePropertyInFilter:{id:"clientAutomationHelpers.errorMessages.crossSpacePropertyInFilter",defaultMessage:"Filter contains a cross-workspace property"},invalidFormulaCrossSpace:{id:"clientAutomationHelpers.errorMessages.invalidFormulaCrossSpace",defaultMessage:"Cross-workspace features are restricted in automations and will not work"},requiresSubscription:{id:"clientAutomationHelpers.errorMessages.requiresSubscription",defaultMessage:"Upgrade plan or delete this step to enable the automation"},requiresSubscriptionButton:{id:"clientAutomationHelpers.errorMessages.requiresSubscriptionButton",defaultMessage:"Upgrade plan or delete connected steps to enable the button"},createPrivatePageAndPublishSite:{id:"clientAutomationHelpers.errorMessages.createPrivatePageAndPublishSite",defaultMessage:"Unable to create private page and publish site"},generalErrorMessage:{id:"clientAutomationHelpers.errorMessages.generalErrorMessage",defaultMessage:"Fix any errors or delete this step to enable this automation"},actionIncompleteErrorMessage:{id:"clientAutomationHelpers.errorMessages.actionIncompleteErrorMessage",defaultMessage:"Add a property to edit or delete this step to enable this automation"},destinationInTrashTooltip:{id:"clientAutomationHelpers.errorMessages.destinationInTrashTooltip",defaultMessage:"Restore destination or delete step to enable this automation"},destinationMissingTooltip:{id:"clientAutomationHelpers.errorMessages.destinationMissingTooltip",defaultMessage:"Add destination or delete step to enable this automation"},destinationNotFoundTooltip:{id:"clientAutomationHelpers.errorMessages.destinationNotFoundTooltip",defaultMessage:"Change destination or delete step to enable this automation"},notificationMissingCollectionPointer:{id:"clientAutomationHelpers.errorMessages.notificationMissingCollectionPointer",defaultMessage:"Change destination or delete step to enable this automation"},notificationMissingTarget:{id:"clientAutomationHelpers.errorMessages.notificationMissingTarget",defaultMessage:"Add a recipient or delete step to enable this automation"},notificationMissingRecipients:{id:"clientAutomationHelpers.errorMessages.notificationMissingRecipients",defaultMessage:"Add a recipient or delete step to enable this automation"},notificationMissingEmailSubject:{id:"clientAutomationHelpers.errorMessages.notificationMissingEmailSubject",defaultMessage:"Add an email subject or delete step to enable this automation"},notificationMissingEmailBody:{id:"clientAutomationHelpers.errorMessages.notificationMissingEmailBody",defaultMessage:"Add an email body or delete step to enable this automation"},notificationMissingMessage:{id:"clientAutomationHelpers.errorMessages.notificationMissingNotificationMessage",defaultMessage:"Add an email message or delete step to enable this automation"},notificationMissingPropertyId:{id:"clientAutomationHelpers.errorMessages.notificationMissingPropertyId",defaultMessage:"Change the target property or delete step to enable this automation"},notificationMissingFormulaValue:{id:"clientAutomationHelpers.errorMessages.notificationMissingFormulaValue",defaultMessage:"Add a recipient or delete step to enable this automation"},sendGmailMissingAccount:{id:"clientAutomationHelpers.errorMessages.sendGmailMissingAccount",defaultMessage:"Select an account to send from or delete step to enable this automation"},sendGmailMissingRecipients:{id:"clientAutomationHelpers.errorMessages.sendGmailMissingRecipients",defaultMessage:"Add recipients or delete step to enable this automation"},sendGmailMissingSubject:{id:"clientAutomationHelpers.errorMessages.sendGmailMissingSubject",defaultMessage:"Add email subject or delete step to enable this automation"},sendGmailMissingBody:{id:"clientAutomationHelpers.errorMessages.sendGmailMissingBody",defaultMessage:"Add email body or delete step to enable this automation"},templateInTrashTooltip:{id:"clientAutomationHelpers.errorMessages.templateInTrashTooltip",defaultMessage:"Restore template, select new template or delete step to enable this automation"},templateInTrashButtonError:{id:"clientAutomationHelpers.errorMessages.templateInTrashButtonError",defaultMessage:"Selected template is in trash"}});function g(e){const{failure:t}=e;if("create_page"===t.actionType){if("empty_config"===t.type)return{forAction:f.destinationMissingTooltip,forButtonTooltip:f.createPageButtonError};if("collection_not_found"===t.type)return{forAction:f.destinationNotFoundTooltip,forButtonTooltip:f.collectionNotFoundButtonError};if("missing_required_config"===t.type){if("collection"===t.key)return{forAction:f.destinationMissingTooltip,forButtonTooltip:f.createPageButtonError};(0,u().HB)(t)}else{if("invalid_optional_config"===t.type)return{forAction:f.invalidTemplatePage,forButtonTooltip:f.createPageButtonTemplateError};if("collection_in_trash"===t.type)return{forAction:f.destinationInTrashTooltip,forButtonTooltip:f.collectionInTrashButtonError,forActionIcon:n().trashIcon};if("template_in_trash"===t.type)return{forAction:f.templateInTrashTooltip,forButtonTooltip:f.templateInTrashButtonError,forActionIcon:n().trashIcon};if("invalid_formula_parse_error"===t.type)return{forAction:f.invalidFormulaParseError,forButtonTooltip:f.invalidFormulaParseError,forButtonSubtitleTooltip:void 0};if("invalid_formula_type_error"===t.type)return{forAction:f.invalidFormulaTypeError,forButtonTooltip:f.invalidFormulaTypeError,forButtonSubtitleTooltip:void 0};if("invalid_formula_type_warning"===t.type)return{forAction:f.invalidFormulaTypeWarning,forButtonTooltip:f.invalidFormulaTypeWarning,forButtonSubtitleTooltip:void 0};if("invalid_formula_missing_return_type"===t.type)return{forAction:f.invalidFormulaMissingReturnType,forButtonTooltip:f.invalidFormulaMissingReturnType,forButtonSubtitleTooltip:void 0};if("cross_space_relation"===t.type)return{forAction:f.crossSpaceRelation,forButtonTooltip:f.crossSpaceRelation,forButtonSubtitleTooltip:void 0};if("invalid_formula_cross_space"===t.type)return{forAction:f.invalidFormulaCrossSpace,forButtonTooltip:f.invalidFormulaCrossSpace,forButtonSubtitleTooltip:void 0};if("create_private_page_and_publish_site"===t.type)return{forAction:f.createPrivatePageAndPublishSite,forButtonTooltip:f.createPrivatePageAndPublishSite,forButtonSubtitleTooltip:void 0};(0,u().HB)(t)}}else if("update_pages"===t.actionType)if("missing_required_config"===t.type){if("target"===t.key)return{forAction:f.destinationMissingTooltip,forButtonTooltip:f.updatePagesButtonError};if("property"===t.key)return{forAction:f.actionIncompleteErrorMessage,forButtonTooltip:f.updatePagesButtonError};(0,u().HB)(t)}else{if("collection_in_trash"===t.type)return{forAction:f.destinationInTrashTooltip,forButtonTooltip:f.collectionInTrashButtonError,forActionIcon:n().trashIcon};if("block_in_trash"===t.type)return{forAction:f.blockInTrashButtonError,forButtonTooltip:f.blockInTrashButtonError};if("invalid_formula_parse_error"===t.type)return{forAction:f.invalidFormulaParseError,forButtonTooltip:f.invalidFormulaParseError,forButtonSubtitleTooltip:void 0};if("invalid_formula_type_error"===t.type)return{forAction:f.invalidFormulaTypeError,forButtonTooltip:f.invalidFormulaTypeError,forButtonSubtitleTooltip:void 0};if("invalid_formula_type_warning"===t.type)return{forAction:f.invalidFormulaTypeWarning,forButtonTooltip:f.invalidFormulaTypeWarning,forButtonSubtitleTooltip:void 0};if("invalid_formula_missing_return_type"===t.type)return{forAction:f.invalidFormulaMissingReturnType,forButtonTooltip:f.invalidFormulaMissingReturnType,forButtonSubtitleTooltip:void 0};if("missing_target_variable"===t.type)return{forAction:f.missingTargetVariable,forButtonTooltip:f.missingTargetVariable,forButtonSubtitleTooltip:void 0};if("cross_space_relation"===t.type)return{forAction:f.crossSpaceRelation,forButtonTooltip:f.crossSpaceRelation,forButtonSubtitleTooltip:void 0};if("invalid_formula_cross_space"===t.type)return{forAction:f.invalidFormulaCrossSpace,forButtonTooltip:f.invalidFormulaCrossSpace,forButtonSubtitleTooltip:void 0};if("cross_space_property_in_filter"===t.type)return{forAction:f.crossSpacePropertyInFilter,forButtonTooltip:f.crossSpacePropertyInFilter,forButtonSubtitleTooltip:void 0};(0,u().HB)(t)}else if("open_page"===t.actionType)if("missing_required_config"===t.type){if("target"===t.key)return{forAction:f.destinationNotFoundTooltip,forButtonTooltip:f.openPageOrUrlButtonError};(0,u().HB)(t)}else(0,u().HB)(t);else if("slack_notification"===t.actionType)if("missing_required_config"===t.type){if("external_bot_id"===t.key)return{forAction:f.slackNotificationAuthenticationError,forButtonTooltip:f.slackNotificationAuthenticationError};if("target"===t.key)return{forAction:f.slackNotificationTargetError,forButtonTooltip:f.slackNotificationTargetError};(0,u().HB)(t)}else if("missing_required_value"===t.type){if("external_bot_id"===t.key)return{forAction:f.slackNotificationAuthenticationError,forButtonTooltip:f.slackNotificationAuthenticationError};(0,u().HB)(t)}else{if("requires_subscription_upgrade"===t.type)return{forAction:f.requiresSubscription,forButtonTooltip:f.requiresSubscriptionButton};(0,u().HB)(t)}else if("send_in_app_notification"===t.actionType)if("missing_required_config"===t.type){if("target"===t.key)return{forAction:f.notificationMissingTarget,forButtonTooltip:f.missingNotificationTarget};if("notification_message"===t.key)return{forAction:f.notificationMissingMessage,forButtonTooltip:f.missingNotificationMessage};if("collectionPointer"===t.key)return{forAction:f.notificationMissingCollectionPointer,forButtonTooltip:f.missingNotificationCollectionPointer};if("propertyId"===t.key)return{forAction:f.notificationMissingPropertyId,forButtonTooltip:f.missingNotificationPropertyId};if("formulaValue"===t.key)return{forAction:f.notificationMissingFormulaValue,forButtonTooltip:f.missingNotificationFormulaValue};(0,u().HB)(t)}else if("invalid_required_config"===t.type){if("propertyId"===t.key)return{forAction:f.invalidNotificationPropertyId,forButtonTooltip:f.invalidNotificationPropertyId};if("formulaValue"===t.key)return{forAction:f.invalidNotificationFormulaValue,forButtonTooltip:f.invalidNotificationFormulaValue};(0,u().HB)(t)}else if("deleted_required_config"===t.type){if("propertyId"===t.key)return{forAction:f.notificationMissingPropertyId,forButtonTooltip:f.deletedNotificationPropertyId};(0,u().HB)(t)}else{if("invalid_formula_parse_error"===t.type)return{forAction:f.invalidFormulaParseError,forButtonTooltip:f.invalidFormulaParseError};if("invalid_formula_type_error"===t.type)return{forAction:f.invalidFormulaTypeError,forButtonTooltip:f.invalidFormulaTypeError};if("invalid_formula_type_warning"===t.type)return{forAction:f.invalidFormulaTypeWarning,forButtonTooltip:f.invalidFormulaTypeWarning};if("invalid_formula_missing_return_type"===t.type)return{forAction:f.invalidFormulaMissingReturnType,forButtonTooltip:f.invalidFormulaMissingReturnType};if("invalid_formula_cross_space"===t.type)return{forAction:f.invalidFormulaCrossSpace,forButtonTooltip:f.invalidFormulaCrossSpace,forButtonSubtitleTooltip:void 0};(0,u().HB)(t)}else if("send_gmail_notification"===t.actionType)if("missing_required_config"===t.type){if("to"===t.key)return{forAction:f.sendGmailMissingRecipients,forButtonTooltip:f.missingRecipients};if("email_subject"===t.key)return{forAction:f.sendGmailMissingSubject,forButtonTooltip:f.missingEmailSubject};if("email_body"===t.key)return{forAction:f.sendGmailMissingBody,forButtonTooltip:f.missingEmailBody};if("formulaValue"===t.key)return{forAction:f.missingNotificationFormulaValue,forButtonTooltip:f.missingNotificationFormulaValue};if("external_bot_id"===t.key)return{forAction:f.sendGmailMissingAccount,forButtonTooltip:f.sendGmailNotificationMissingAuthenticationError};(0,u().HB)(t)}else if("invalid_required_config"===t.type){if("to"===t.key)return{forAction:f.invalidNotificationFormulaValue,forButtonTooltip:f.invalidNotificationFormulaValue};if("cc"===t.key)return{forAction:f.invalidNotificationFormulaValue,forButtonTooltip:f.invalidNotificationFormulaValue};if("bcc"===t.key)return{forAction:f.invalidNotificationFormulaValue,forButtonTooltip:f.invalidNotificationFormulaValue};if("reply_to"===t.key)return{forAction:f.invalidNotificationFormulaValue,forButtonTooltip:f.invalidNotificationFormulaValue};if("external_bot_id"===t.key)return{forAction:f.sendGmailNotificationInvalidAuthenticationError,forButtonTooltip:f.sendGmailNotificationInvalidAuthenticationError};(0,u().HB)(t)}else{if("invalid_formula_parse_error"===t.type)return{forAction:f.invalidFormulaParseError,forButtonTooltip:f.invalidFormulaParseError};if("invalid_formula_type_error"===t.type)return{forAction:f.invalidFormulaTypeError,forButtonTooltip:f.invalidFormulaTypeError};if("invalid_formula_type_warning"===t.type)return{forAction:f.invalidFormulaTypeWarning,forButtonTooltip:f.invalidFormulaTypeWarning};if("invalid_formula_missing_return_type"===t.type)return{forAction:f.invalidFormulaMissingReturnType,forButtonTooltip:f.invalidFormulaMissingReturnType};if("invalid_formula_cross_space"===t.type)return{forAction:f.invalidFormulaCrossSpace,forButtonTooltip:f.invalidFormulaCrossSpace,forButtonSubtitleTooltip:void 0};if("requires_subscription_upgrade"===t.type)return{forAction:f.requiresSubscription,forButtonTooltip:f.requiresSubscriptionButton};(0,u().HB)(t)}else if("define_variables"===t.actionType){if("invalid_formula_parse_error"===t.type)return{forAction:f.invalidFormulaParseError,forButtonTooltip:f.invalidFormulaParseError,forButtonSubtitleTooltip:void 0};if("invalid_formula_type_error"===t.type)return{forAction:f.invalidFormulaTypeError,forButtonTooltip:f.invalidFormulaTypeError,forButtonSubtitleTooltip:void 0};if("invalid_formula_type_warning"===t.type)return{forAction:f.invalidFormulaTypeWarning,forButtonTooltip:f.invalidFormulaTypeWarning,forButtonSubtitleTooltip:void 0};if("invalid_formula_missing_return_type"===t.type)return{forAction:f.invalidFormulaMissingReturnType,forButtonTooltip:f.invalidFormulaMissingReturnType,forButtonSubtitleTooltip:void 0};if("invalid_formula_cross_space"===t.type)return{forAction:f.invalidFormulaCrossSpace,forButtonTooltip:f.invalidFormulaCrossSpace,forButtonSubtitleTooltip:void 0};(0,u().HB)(t)}else if("http_request"===t.actionType){if("invalid_url"===t.type)return{forAction:f.invalidSendWebhookActionUrl,forButtonTooltip:f.invalidSendWebhookActionUrl};if("empty_custom_header_field"===t.type)return{forAction:f.invalidSendWebhookActionCustomHeaderField,forButtonTooltip:f.invalidSendWebhookActionCustomHeaderField};if("requires_subscription_upgrade"===t.type)return{forAction:f.requiresSubscription,forButtonTooltip:f.requiresSubscriptionButton};if("too_many_custom_headers"===t.type)return{forAction:f.tooManyCustomHeaders,forButtonTooltip:f.tooManyCustomHeaders};(0,u().HB)(t)}else if("modal_confirmation"===t.actionType){if("invalid_formula_parse_error"===t.type)return{forAction:f.invalidFormulaParseError,forButtonTooltip:f.invalidFormulaParseError};if("invalid_formula_type_error"===t.type)return{forAction:f.invalidFormulaTypeError,forButtonTooltip:f.invalidFormulaTypeError};if("invalid_formula_type_warning"===t.type)return{forAction:f.invalidFormulaTypeWarning,forButtonTooltip:f.invalidFormulaTypeWarning};if("invalid_formula_missing_return_type"===t.type)return{forAction:f.invalidFormulaMissingReturnType,forButtonTooltip:f.invalidFormulaMissingReturnType};if("invalid_formula_cross_space"===t.type)return{forAction:f.invalidFormulaCrossSpace,forButtonTooltip:f.invalidFormulaCrossSpace,forButtonSubtitleTooltip:void 0};(0,u().HB)(t)}else if("publish_site"===t.actionType)if("missing_required_config"===t.type){if("target"===t.key)return{forAction:f.missingTargetDatabase,forButtonTooltip:f.updatePagesButtonError};(0,u().HB)(t)}else{if("missing_target_variable"===t.type)return{forAction:f.missingTargetVariable,forButtonTooltip:f.missingTargetVariable,forButtonSubtitleTooltip:void 0};if("invalid_context_value_type"===t.type)return{forAction:f.invalidFormulaTypeError,forButtonTooltip:f.invalidFormulaTypeError};(0,u().HB)(t)}else if("worker"===t.actionType)switch(t.type){case"missing_required_config":switch(t.key){case"workerId":return{forAction:f.missingWorkerId,forButtonTooltip:f.missingWorkerId};case"capabilityKey":return{forAction:f.missingCapabilityKey,forButtonTooltip:f.missingCapabilityKey};default:(0,u().HB)(t)}case"workers_not_enabled":return{forAction:f.workersNotEnabled,forButtonTooltip:f.workersNotEnabled};case"worker_not_found":return{forAction:f.workerNotFound,forButtonTooltip:f.workerNotFound};case"capability_not_found":return{forAction:f.capabilityNotFound,forButtonTooltip:f.capabilityNotFound};default:(0,u().HB)(t)}else(0,u().HB)(t)}function m(e){const{actionId:t,shouldShow:o,errorKey:i,errorKeys:n}=e,s=(0,c().K4)(),l=null==s?void 0:s.typecheckResult;return(0,r().K8)((()=>{if(!o||!l)return{errorMessage:void 0,errorIcon:void 0,errorMessageDescriptor:void 0};let e=_(l,t);(i||n)&&(e=e.filter((e=>"key"in e&&(e.key===i||(null==n?void 0:n.includes(e.key))))));const r=e[0];if(!r)return{errorMessage:void 0,errorIcon:void 0,errorMessageDescriptor:void 0};const s=g({failure:r});return{errorMessage:(0,p.jsx)(y,{content:(0,p.jsx)(a().sA,{...s.forAction})}),errorIcon:s.forActionIcon,errorMessageDescriptor:s.forAction}}),[o,l,t,i,n])}function y(e){const{content:t,subtitle:o}=e,r=(0,i().IS)((()=>({wrap:{display:"flex",flexDirection:"column",alignItems:"center"},subtitle:{color:s().Tj.text.inverseSecondary}})),[]);return(0,p.jsxs)("div",{style:r.wrap,children:[(0,p.jsx)("div",{children:t}),o?(0,p.jsx)("div",{style:r.subtitle,children:o}):void 0]})}function _(e,t){return l().Q.isFail(e)?[]:e.value.actionValidationFailures[t]??[]}function v(e){const{shouldShow:t,actionId:o}=e,i=(0,c().K4)(),n=null==i?void 0:i.typecheckResult;return(0,r().K8)((()=>{if(!t||!n)return;const e=_(n,o).filter((e=>"requires_subscription_upgrade"===e.type))[0];if(!e)return;const r=g({failure:e});return(0,p.jsx)(a().sA,{...r.forAction})}),[t,n,o])}}}]);