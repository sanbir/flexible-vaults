"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[68643],{68913:(e,t,o)=>{o.r(t),o.d(t,{alarmIcon:()=>a,iconDefinition:()=>n});o(296540);var i=o(474848);const n={viewBox:"0 0 20 20",fittedViewBox:"1.91 0.78 16.18 16.85",svg:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("path",{d:"M5.791 1.886a.625.625 0 1 0-.801-.96L2.138 3.31a.625.625 0 1 0 .802.96zm4.834 3.839a.625.625 0 1 0-1.25 0v3.65H6.4a.625.625 0 0 0 0 1.25H10c.345 0 .625-.28.625-.625z"}),(0,i.jsx)("path",{d:"M10 2.375a7.625 7.625 0 1 0 0 15.25 7.625 7.625 0 0 0 0-15.25M3.625 10a6.375 6.375 0 1 1 12.75 0 6.375 6.375 0 0 1-12.75 0M14.13 1.006a.625.625 0 0 0 .079.88l2.851 2.383a.625.625 0 1 0 .802-.96L15.01.927a.625.625 0 0 0-.88.079"})]})},a=(0,o(340498).wt)("alarm",n,"default")},108184:(e,t,o)=>{o.r(t),o.d(t,{COMPLETION_THROTTLE:()=>k,PREVIEW_STEP_DELAY:()=>I,maybeUpdateAIUsageEligibilityStoreV2:()=>j,maybeUpdateAiEligibility:()=>w,postProcessAICreatedStores:()=>M,showCompletionErrorWithCode:()=>C,wrapTemporaryBlocksInList:()=>T});o(18107),o(967357);var i=()=>o(242422),n=()=>o(675133),a=()=>o(128933),r=()=>o(770063),s=()=>o(878126),l=()=>o(165358),c=()=>o(179034),d=()=>o(427419),p=()=>o(720665),u=()=>o(769864),m=()=>o(722101),f=()=>o(384944),y=()=>o(274873),g=()=>o(412669),h=()=>o(556122),v=()=>o(594794),b=()=>o(668721),S=()=>o(685377),A=()=>o(661077),x=()=>o(96563);const k=300,I=250;function C(e){const t=n().A.getIntl();return 451===e?a().D6({label:t.formatMessage({id:"completionActions.moderationError",defaultMessage:"AI does not allow content that is harmful or illegal. Please revise your input and try again. (451)"})}):413===e?a().D6({label:t.formatMessage({id:"completionActions.promptOrAttachmentTooLarge",defaultMessage:"Query or attachment is too large. Please revise your input and try again. (413)"})}):502===e||503===e||504===e?a().D6({label:t.formatMessage({id:"completionActions.providerError",defaultMessage:"We’re experiencing issues with our AI provider. Try again in a few minutes. ({errorCode})"},{errorCode:e})}):void a().D6({label:t.formatMessage({id:"completionActions.genericError",defaultMessage:"AI is temporarily unavailable. Try again in a few minutes. ({errorCode})"},{errorCode:e})})}function M(e,t){for(const o of t)y().In({environment:e,blockStore:o})}async function w(e,t,o){let n;if(i().default.checkGate({gateName:"usage_based_pricing_pfa_checks_purchased_credits_enabled"}))return void(await j(e,t,o));i().default.checkGate({gateName:"usage_based_pricing_alpha_enabled"})&&j(e,t,o).catch((e=>{l().log({level:"error",from:"ai.completionActions",type:"maybeUpdateAIUsageEligibilityStoreV2Error",spaceId:t,error:e})}));const a=h().TI();if(a.debug)n=402!==a.showErrorCode;else{const i=b().o.getState();if(i&&i.isEligible&&"unlimited"===i.type&&!o){const e=i.lastUpdatedAt;if(Date.now()-e<10*p().Xb)return}const a=await u().callCellCompatibleApi({eventName:"getAIUsageEligibility",environment:e,data:{spaceId:t},cellNavigation:{cellId:void 0,spaceId:t}});if("success"===a.type){n=a.data.isEligible,n&&g().K.state&&g().K.setState(!1);const e=!1===(null==i?void 0:i.isEligible)&&(null==i?void 0:i.requestedAccess),t=a.data.researchModeUsage??0;b().o.setState({...a.data,lastUpdatedAt:Date.now(),researchModeUsage:t,...!1===a.data.isEligible&&{requestedAccess:e}})}}void 0!==n&&A().P.setState(n)}async function j(e,t,o){const i=await s().T.awaitData(e,{spaceId:t}),n=S().y.getData(e,{spaceId:t});if(i){if(n&&(0,d().Hg)(i)&&!o){const e=n.lastUpdatedAt;if(Date.now()-e<10*p().Xb)return}await(0,x().y3)(e,t)}}function T(e){var t;const{environment:o,stores:i,listId:n,inMemoryRecordCache:a,transaction:s}=e,l=(null===(t=i.at(0))||void 0===t?void 0:t.getSpaceId())??s.spaceId,d=new(r().pm)({environment:o,pointer:{table:c().ev,id:n||(0,v().Z1)({environment:o,table:c().ev,spaceId:l}),spaceId:l},recordStoreOptions:{inMemoryRecordCache:a,userId:o.currentUser.id},path:["content"]});for(const r of i)m().BC({parentStore:d,appendStore:r,transaction:s}),f().zv({store:r,data:{parent_id:d.id,parent_table:d.table,alive:!0},transaction:s});return d}},173868:(e,t,o)=>{o.d(t,{o:()=>l});o(944114),o(898992),o(354520),o(672577),o(581454);var i=()=>o(898244),n=()=>o(448801),a=()=>o(519831),r=()=>o(496603),s=()=>o(534177);function l(e){const{newOptions:t,collectionId:o,property:l,schema:c}=e,d=c[l];if(!d)return;if(!i().lx(d)&&"status"!==d.type)return;const p=d.options||[],u=[],m=r().Bq(t),f=p.map((e=>e.value)),{beforeOps:y}=(0,n().i)(f,m);for(const[i,n]of(0,s().WP)(y)){const e=p.find((e=>e.value===i));if(e)if(n){const t=p.find((e=>e.value===n));if(t){const i={pointer:{table:a().Vl,id:o},command:"keyedObjectListBefore",path:["schema",l,"options"],args:{value:e,before:{id:t.id}}};u.push(i)}}else{const t={pointer:{table:a().Vl,id:o},command:"keyedObjectListAfter",path:["schema",l,"options"],args:{value:e}};u.push(t)}}if("status"===d.type){const e=d.groups??[];for(const[i]of e.entries()){const e=t[i];if(!Array.isArray(e))return;const n=p.filter((t=>e.includes(t.value))).map((e=>e.id)),r={pointer:{table:a().Vl,id:o},command:"set",path:["schema",l,"groups",i,"optionIds"],args:n};u.push(r)}}return u.length>0?u:void 0}},389783:(e,t,o)=>{o.d(t,{Uk:()=>p,gc:()=>u,r$:()=>f});o(944114),o(898992),o(354520),o(672577),o(430670),o(581454);var i=()=>o(675133),n=()=>o(792057),a=()=>o(770063),r=()=>o(898244),s=()=>o(183558),l=()=>o(831566),c=()=>o(173868),d=()=>o(547149);function p(e){const{modification:t,property:o,propertySchema:c,options:p,groupIndex:u,environment:f,collectionStore:y}=e;let g,h;if("keyedObjectListRemove"===t.type)g={pointer:y.pointer,command:"keyedObjectListRemove",path:["schema",o,"options"],args:{remove:{id:t.id}}},void 0!==u&&"status"===c.type&&(h={pointer:y.pointer,command:"listRemove",path:["schema",o,"groups",u,"optionIds"],args:{id:t.id}});else{if(p){if(p.find((e=>e.value.toLowerCase()===t.newValue.toLowerCase())))return void n().f1(i().A.formatMessage(m.optionAlreadyExists))}if("keyedObjectListUpdate"===t.type)g={pointer:y.pointer,command:"keyedObjectListUpdate",path:["schema",o,"options"],args:{value:{...t.option,value:t.newValue}}};else{const e=c.options||[];let i=(0,r().Zd)(e);if("status"===c.type&&void 0!==u){var v;const e=null===(v=c.groups)||void 0===v||null===(v=v[u])||void 0===v?void 0:v.color;e&&(i=e)}const n={id:(0,s().Ay)(),value:t.newValue,color:i};if("autoSortInsert"===t.type){if(!(0,r().lx)(c))return;g=(0,r().og)({collectionId:y.id,property:o,propertySchema:c,newOption:n,isAscending:"alphabetical"===c.auto_sort_options})}else"keyedObjectListBefore"===t.type?(g={pointer:y.pointer,command:"keyedObjectListBefore",path:["schema",o,"options"],args:{value:n,before:t.beforeOption}},void 0!==u&&"status"===c.type&&(h={pointer:y.pointer,command:"listBefore",path:["schema",o,"groups",u,"optionIds"],args:{id:n.id}})):"keyedObjectListAfter"===t.type&&(g={pointer:y.pointer,command:"keyedObjectListAfter",path:["schema",o,"options"],args:{value:n,after:t.afterOption}},void 0!==u&&"status"===c.type&&(h={pointer:y.pointer,command:"listBefore",path:["schema",o,"groups",u,"optionIds"],args:{id:n.id}}))}}(0,l().p)({environment:f,collectionStore:y,performTransaction:e=>{if(d().applyOperation({store:y,operation:g,transaction:e}),h&&d().applyOperation({store:(0,a().v3)(y,h.pointer),operation:h,transaction:e}),"status"===c.type){const t=c.options??[],i=(c.groups??[]).flatMap((e=>e.optionIds)),n=t.filter((e=>!i.includes(e.id)));for(const r of n)d().applyOperation({store:(0,a().v3)(y,y.pointer),operation:{pointer:y.pointer,command:"listBefore",path:["schema",o,"groups",0,"optionIds"],args:{id:r.id}},transaction:e})}}})}function u(e){const{newValues:t,property:o,schema:i,collectionStore:n,environment:s}=e,p=i[o];let u;if("status"===(null==p?void 0:p.type)){u=[[]];for(const o of t)o.startsWith("group-header-")?u.push([]):u[u.length-1].push(o);const e=((null==p?void 0:p.options)??[]).filter((e=>!t.includes(e.value)));u[0].push(...e.map((e=>e.value)))}else u=t;const m=(0,c().o)({newOptions:u,collectionId:n.id,property:o,schema:i});if(m){if(p&&(0,r().lx)(p)){"manual"!==(p.auto_sort_options||"manual")&&m.push({pointer:n.pointer,command:"update",path:["schema",o],args:{auto_sort_options:"manual"}})}(0,l().p)({environment:s,collectionStore:n,performTransaction:e=>{for(const t of m)d().applyOperation({store:(0,a().v3)(n,t.pointer),operation:t,transaction:e})}})}}const m=(0,o(69708).YK)({deleteModalPrompt:{id:"database.selectPropertyOptionEditMenu.deleteModal.prompt",defaultMessage:"Are you sure you want to delete this option?"},acceptButtonLabel:{id:"database.selectPropertyOptionEditMenu.deleteModal.confirmButton",defaultMessage:"Delete"},preventDefaultStatusOptionDelete:{defaultMessage:"Cannot delete default option.",id:"database.editProperty.errorDialog.forbidDeleteDefaultOption.message"},optionAlreadyExists:{defaultMessage:"Option already exists.",id:"database.optionExistsAlreadyError.message"}});function f(e){const{option:t,propertySchema:o,property:a,collectionStore:s,statusGroup:l,environment:c,deleteMessage:d}=e;"status"!==o.type||t.value!==o.defaultOption?n().ui({showCancel:!0,keepFocus:!1,message:d??i().A.formatMessage(m.deleteModalPrompt),items:[{label:i().A.formatMessage(m.acceptButtonLabel),color:"red",onAccept:()=>{if((0,r().lx)(o)||"status"===o.type)if("status"===o.type&&l){const e=(o.groups??[]).findIndex((e=>e.id===l.id));p({modification:{type:"keyedObjectListRemove",id:t.id},property:a,propertySchema:o,environment:c,collectionStore:s,groupIndex:e})}else p({modification:{type:"keyedObjectListRemove",id:t.id},property:a,propertySchema:o,environment:c,collectionStore:s})}}]}):n().f1(i().A.formatMessage(m.preventDefaultStatusOptionDelete))}},539148:(e,t,o)=>{o.d(t,{S:()=>f});o(296540);var i=()=>o(726637),n=()=>o(401497),a=()=>o(718827),r=()=>o(807449),s=()=>o(26697),l=()=>o(879526),c=()=>o(69708),d=()=>o(554283),p=()=>o(206372),u=o(474848);const m=(0,c().YK)({addDescriptionTooltip:{id:"database.description.addDescriptionTooltip",defaultMessage:"Add description"},editDescriptionTooltip:{id:"database.description.editDescriptionTooltip",defaultMessage:"Edit description"}});function f({onClick:e,description:t,showTooltip:o,addDescriptionText:f,editDescriptionText:y,disabled:g}){const[h,v]=(0,d().B)(),b=(0,c().tz)(),S=(0,n().IS)((()=>({button:{flexShrink:0,flexGrow:0,borderRadius:i().A.isMobile?24:20,marginInlineStart:4}})),[]);return(0,u.jsx)(s().m,{renderTooltip:e=>(0,u.jsx)("div",{...e,children:Boolean(null==t?void 0:t.length)?t:f??b.formatMessage(m.addDescriptionTooltip)}),disableTooltip:!o||g,style:p().Q$,placement:"top",render:o=>(0,u.jsx)(a().Ay,{...o,ref:h,onClick:e,"aria-label":Boolean(null==t?void 0:t.length)?f:y??b.formatMessage(m.editDescriptionTooltip),style:S.button,disabled:g,disabledFeedback:g,children:(0,u.jsx)(r().I,{icon:l().infoCircleFillIcon,colorVariant:v&&!g?"primary":"secondary",fitToViewBox:"horizontal"})})})}},556122:(e,t,o)=>{o.d(t,{QJ:()=>m,TI:()=>c});o(944114),o(581454);var i=()=>o(726637),n=()=>o(763824);let a=0;const r="clipboard",s={debug:Boolean(i().A.isDevelopingInAirplaneMode),responseText:r,showErrorCode:!1,delayBetweenChunks:20,chunkSize:5,numLoremIpsums:3},l="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec porta auctor sem vel efficitur. Vivamus efficitur eros sed erat efficitur efficitur. Vivamus et augue vel est efficitur efficitur.";function c(){return s}function d(e){return{async*[Symbol.asyncIterator](){for(const t of e)await(0,n().wR)(s.delayBetweenChunks),yield t}}}function p(e,t){const o=Math.ceil(e.length/t),i=new Array(o);for(let n=0,a=0;n<o;++n,a+=t)i[n]=e.substr(a,t);return i}function u(e){return e.map((e=>({type:"success",p:"padding",completion:e,inferenceId:"mock"})))}async function m({environment:e,data:t}){console.log("Retrieving fake completion for data",t);const{context:o}=t,n=o.selectedText,c=[];let{responseText:m}=s;if(m===r&&(m=await async function(){try{return await navigator.clipboard.readText()}catch(e){return}}()??"Unable to retrieve clipboard text."),void 0===m&&(c.push({type:"success",p:"padding",completion:"\n",inferenceId:"mock"},{type:"success",p:"padding",completion:"this is ",inferenceId:"mock"},{type:"success",p:"padding",completion:"fake ",inferenceId:"mock"},{type:"success",p:"padding",completion:`streaming response ${a++}.`,inferenceId:"mock"}),i().A.isDevelopingInAirplaneMode&&c.push({type:"success",p:"padding",completion:"\n\nTo see a real AI response, run the server with `--airplaneMode=false`.",inferenceId:"mock"}),"string"==typeof n)){c.push({type:"success",p:"padding",completion:"\n\nHere is the text you selected:\n\n",inferenceId:"mock"});for(const e of p(n,s.chunkSize))c.push({type:"success",completion:e,p:"padding",inferenceId:"mock"})}if(s.showErrorCode)c.push({type:"error",message:"alas",errorCode:s.showErrorCode,isRetryable:!1});else if(void 0===m)for(let i=0;i<s.numLoremIpsums;i++)c.push(...u([`\n\n${i+1}. `,...p(l,0===s.delayBetweenChunks?l.length:s.chunkSize)]));else if(m.length>0){const e=p(m,s.chunkSize);c.push(...u(e))}return Promise.resolve({type:"success",data:d(c),status:200,headers:{}})}(0,o(852832).exposeDebugValue)("completionDebugSettings",s)},641078:(e,t,o)=>{o.d(t,{C:()=>w});var i=o(296540),n=()=>o(300474),a=()=>o(242422),r=()=>o(726637),s=()=>o(484714),l=()=>o(118884),c=()=>o(590526),d=()=>o(267956),p=()=>o(546926),u=()=>o(890492),m=()=>o(708685),f=()=>o(502856),y=()=>o(247331),g=()=>o(239381),h=()=>o(792071),v=()=>o(973647),b=()=>o(193722),S=()=>o(133518),A=()=>o(89053),x=()=>o(908201),k=()=>o(390650),I=()=>o(29554),C=()=>o(129574),M=o(474848);function w(e){var t,o,w,j;const{property:T,disabled:O,formulas:D,getRecordModel:_,propertySchema:B,collectionStore:E,handleSave:P,handleClose:L,blockStore:V,analyticsFrom:R}=e,K=(0,x().ET)(),F=(0,s().v3)(),[U,W]=(0,i.useState)(null==B||null===(t=B.formula2)||void 0===t?void 0:t.code),z=(0,i.useRef)(null===(o=B.formula2)||void 0===o?void 0:o.code),G=(0,i.useRef)(U),H=(0,i.useRef)(null==B||null===(w=B.formula2)||void 0===w?void 0:w.result_type),N=(0,i.useCallback)((e=>{G.current=e,W(e)}),[]),$=(0,i.useCallback)((e=>{H.current=e}),[]);(0,l().X)((()=>{const e=z.current,t=G.current,o=H.current;if(t!==e||void 0!==oe){P({newValue:t,newType:(0,m().removeFunctionsFromType)(o??{type:"unknown"}),propertySchema:B,collectionStore:E,property:T});const e=(0,I().r4)(t,E);(0,b().L)(F,{...(0,k().sl)(K),property_type:B.type,action:"formula_v2_edit",from:R,formula_char_count:e.length})}}));const Y=(0,c().K8)((()=>E.pointer),[E.pointer]),q=(0,i.useMemo)((()=>{const e={type:"block",collection:Y};return{kind:y().FormulaContextValueKind.ThisRow,type:e}}),[Y]),Q=(0,c().K8)((()=>d().A.state.publicPageData),[]),X=(0,n().r)(),Z=(0,c().K8)((()=>(0,A().i)()),[]),J=(0,c().K8)((()=>F.idCreator.getSpaceIdCreatorSync(X??"")),[F.idCreator,X]),ee=(0,S().i)(),te=(0,i.useMemo)((()=>{if(!X)return;const e=h().h0Y.fromGetRecordModelFn(_);return{guaranteedPropertyIds:ee,sourceProperty:T,valueTypes:[q],handleDataRequest:(0,f().MC)({collectionFeatureGates:Z,experimentService:a().default,getRecordModel:_,loadRecordModel:e,spaceIdCreator:J}),formulaPropertyNames:U&&(0,g().o2)(U),publicPageDataCollection:{id:null==Q?void 0:Q.collectionId,schema:null==Q?void 0:Q.collectionSchema},spaceId:X,restrictUnaccessibleProperties:"cross_space_only",featureGates:Z}}),[X,_,ee,T,q,Z,J,U,null==Q?void 0:Q.collectionId,null==Q?void 0:Q.collectionSchema]),oe=(0,c().K8)((()=>{if("v2"!==B.version&&B.formula)return D.convertCollectionFormulaToFormula2(B.formula,Y,E.getSchema())}),[Y,E,D,B.formula,B.version]),ie=(0,i.useRef)(!1);(0,i.useEffect)((()=>{!async function(){if(!oe||ie.current||!te)return;const e=await D.analyzeFormula(oe,te);let t;t=v().Q.isFail(e)?{type:"unknown"}:e.value.type??{type:"unknown"},ie.current=!0,N(oe),$(t)}()}),[E,D,N,$,T,B,oe,te]);const ne=(0,i.useMemo)((()=>{var e;const t="v2"===B.version?null===(e=B.formula2)||void 0===e?void 0:e.code:oe;return z.current=t,t}),[null===(j=B.formula2)||void 0===j?void 0:j.code,B.version,oe]);return te&&X?(0,M.jsx)(u().A,{menuType:r().A.isMobile?p().gu.Modal:p().gu.Popup,height:r().A.isMobile?"100%":void 0,hideMobileTopbar:!0,width:r().A.isMobile?void 0:740,disableBottomPadding:!0,maxHeight:"unset",disableHeaderBorder:!0,disableScroller:!0,children:(0,M.jsx)(C().v,{initialCode:ne,formulas:D,getRecordModel:_,disabled:O,parentSpaceId:X,typecheckContext:te,onCodeChange:N,onTypeChange:$,handleClose:L,parentCollectionStore:E,autosave:!0,formulaSchema:B,collectionStore:E,blockStore:V})}):null}},705602:(e,t,o)=>{o.d(t,{s:()=>u,y:()=>f});var i=o(296540),n=()=>o(726637),a=()=>o(401497),r=()=>o(736847),s=()=>o(69708),l=()=>o(100622),c=()=>o(419357),d=()=>o(206372),p=o(474848);const u=(0,s().YK)({descriptionHeader:{id:"database.viewSettings.propertyTab.description.title",defaultMessage:"Description"},addDescription:{id:"database.viewSettings.propertyTab.description.addDescription",defaultMessage:"Add a description..."}}),m=60;function f({initialDescription:e,handleSaveDescription:t,disableAutoSection:o}){const[f,y]=(0,i.useState)(e??""),g=(0,i.useRef)(f),h=(0,s().tz)(),v=(0,a().IS)((()=>({title:{display:"flex",alignItems:"center",gap:4,cursor:"default",color:l().Tj.text.secondary},descriptionInput:{lineHeight:"20px",fontSize:n().A.isMobile?14:13}})),[]),b=(0,i.useCallback)((()=>t(g.current)),[t]);(0,i.useEffect)((()=>()=>b()),[b]);const S=(0,i.useMemo)((()=>(0,p.jsx)(c().Ay,{value:f,onChange:e=>{y(e.target.value),g.current=e.target.value},onBlur:b,onSubmit:b,placeholder:h.formatMessage(u.addDescription),focusInitial:!0,disabled:!1,inputOuterStyle:v.descriptionInput,textarea:!0,textareaSubmitOnEnter:!0,maxlength:d().fy,autosize:!0,autosizeMaxHeight:m,showClearButton:!1})),[f,h,b,v.descriptionInput]);return n().A.isMobile&&!o?(0,p.jsx)(r().A,{topBorder:!0,isInput:!0,title:(0,p.jsx)("span",{style:v.title,children:h.formatMessage(u.descriptionHeader)}),children:S}):S}},814777:(e,t,o)=>{o.d(t,{h:()=>F});o(944114),o(898992),o(354520),o(672577),o(430670),o(581454);var i=o(296540),n=()=>o(726637),a=()=>o(484714),r=()=>o(590526),s=()=>o(792057),l=()=>o(245720),c=()=>o(127833),d=()=>o(30537),p=()=>o(546926),u=()=>o(890492),m=()=>o(663639),f=()=>o(736847),y=()=>o(784892),g=()=>o(396350),h=()=>o(748054),v=()=>o(236262),b=()=>o(519831),S=()=>o(69708),A=()=>o(100622),x=()=>o(496603),k=()=>o(284371),I=()=>o(901952),C=()=>o(193722),M=()=>o(389783),w=()=>o(539148),j=()=>o(705602),T=()=>o(828973),O=()=>o(480912),D=()=>o(908201),_=()=>o(390650),B=()=>o(838364),E=()=>o(575143),P=()=>o(419357),L=()=>o(893952),V=()=>o(399762),R=o(474848);const K=o(757695).Store.createClass(!1,{name:"ShowSelectDescriptionStore"});function F({onClose:e,collectionId:t,propertySchema:o,property:s,onChange:l,option:p,analyticsFrom:u,statusGroup:m,origin:f,open:y,alignmentToOrigin:g}){const h=(0,a().v3)(),v=(0,D().ET)(),b=(0,r().uB)(void 0,K),[S,A]=(0,i.useState)(""),x=(0,i.useRef)(y);(0,i.useEffect)((()=>{!x.current&&y&&A(p.value),x.current=y}),[y,p.value]);const k=(0,i.useCallback)((()=>(0,R.jsx)(U,{collectionContextStore:v,onClose:e,collectionId:t,propertySchema:o,property:s,onChange:l,option:p,analyticsFrom:u,statusGroup:m,renameInputValue:S,setRenameInputValue:A,showSelectDescriptionStore:b})),[v,e,t,o,s,l,p,u,m,S,A,b]),I=(0,i.useCallback)((()=>function(e,t,o,i,n,a,r,s,l,c){if(o(),c)return;W(e,t,i,n,a,r,s,l)}(h,v,e,t,o,s,l,p,S,n().A.isMobile)),[h,v,e,t,o,s,l,p,S]);return(0,R.jsx)(c().zD,{popupType:n().A.isMobile?d().n.BottomSheet:d().n.Popup,open:y,onDismiss:I,origin:f,render:k,alignmentToOrigin:g})}function U({collectionContextStore:e,onClose:t,collectionId:o,propertySchema:c,property:d,onChange:x,option:I,analyticsFrom:D,statusGroup:K,renameInputValue:F,setRenameInputValue:U,showSelectDescriptionStore:z}){const G=(0,S().tz)(),H=(0,a().v3)(),N=(0,r().K8)((()=>e.collectionStore()),[e]),$=(0,i.useCallback)((e=>function(e,t){const o=e.target.value.replace(/,/g,"");t(o)}(e,U)),[U]),Y=(0,i.useCallback)((i=>(i.stopPropagation(),function(e,t,o,i,n,a,r,s,l){o(),W(e,t,i,n,a,r,s,l)}(H,e,t,o,c,d,x,I,F))),[H,e,t,o,c,d,x,I,F]),q=(0,i.useCallback)((()=>{if(N)return function(e,t,o,i,n,a,r,s,l){M().r$({environment:e,option:t,property:n,propertySchema:i,collectionStore:r,statusGroup:s}),a(),(0,C().L)(e,{...(0,_().sl)(l),property_type:i.type,action:"select_delete_option",from:o})}(H,I,D,c,d,t,N,K,e)}),[H,I,N,D,c,d,t,K,e]),Q=(0,r().O$)(z),X=[];Q&&X.push({key:"description",render:e=>(0,R.jsx)(f().A,{...e,desktopStyle:{paddingTop:0},title:n().A.isMobile?G.formatMessage(j().s.descriptionHeader):void 0}),items:[{key:"description",render:e=>(0,R.jsx)(j().y,{...e,initialDescription:I.description,handleSaveDescription:e=>function(e,t,o,i,n,a,r,s){if(e===(s.description??""))return;const l={...s,description:e},c={pointer:{table:b().Vl,id:i},command:"keyedObjectListUpdate",path:["schema",n,"options"],args:{value:l}};o([c]),(0,C().L)(t,{property_type:a.type,action:"select_set_description",from:r})}(e,H,x,o,d,c,D,I),disableAutoSection:!0}),action:()=>{}}]});const Z={key:"action",render:e=>(0,R.jsx)(f().A,{...e}),items:[]};X.push(Z),Z.items.push({key:"delete",render:e=>(0,R.jsx)(E().A,{...e,title:(0,R.jsx)(S().sA,{id:"database.selectPropertyOptionEditMenu.deleteLabel",defaultMessage:"Delete"}),svg:v().trashIcon}),action:q}),K&&"status"===c.type&&(Z.items.push({key:"setAsDefault",render:e=>(0,R.jsx)(E().A,{...e,title:(0,R.jsx)(S().sA,{id:"database.selectPropertyOptionEditMenu.setAsDefault",defaultMessage:"Set as default"}),svg:h().M}),action:()=>async function(e,t,o,i,n,a,r,l,c){if("status"!==o.type||!c)return;if(a.value===o.defaultOption)return;if(void 0!==o.defaultOption){const{accept:e}=await s().Gh({mode:"wide",message:(0,R.jsx)(S().sA,{defaultMessage:"Change default to “{defaultValue}”?",id:"database.editProperty.setAsDefault.confirm.title",values:{defaultValue:a.value}}),description:(0,R.jsx)(S().sA,{defaultMessage:"New pages will start with {defaultValue} as the default status. Existing pages <b>without a status explicitly set</b> will switch to {defaultValue}.",id:"database.editProperty.setAsDefault.confirm.description",values:{defaultValue:a.value,b:e=>(0,R.jsx)("span",{style:{fontWeight:k().Wy.semibold},children:e})}}),acceptLabel:(0,R.jsx)(S().sA,{defaultMessage:"Continue",id:"database.editProperty.setAsDefault.confirm.continueButton"})});if(!e)return}const d={table:b().Vl,id:e},p=[],u={pointer:d,command:"update",path:["schema",t],args:{defaultOption:a.value}};p.push(u),i(p),r(),(0,C().L)(l,{property_type:o.type,action:"status_set_default",from:n,collection_id:e})}(o,d,c,x,D,I,t,H,K)}),Z.items.push({key:"Group",render:e=>(0,R.jsx)("div",{...e,children:(0,R.jsx)(T().A,{...e,title:(0,R.jsx)(S().sA,{id:"database.selectPropertyOptionEditMenu.Group",defaultMessage:"Group"}),selectedKey:K.name,options:(c.groups??[]).map((e=>({key:e.name,type:"button",title:O().OR[e.name]??e.name}))),icon:g().i,onChange:e=>{!function(e,t,o,i,n,a,r,s,l){if("status"!==r.type||!l)return;const c={table:b().Vl,id:t},d=[],p=r.groups??[],u=p.findIndex((e=>e.id===l.id)),m=p.findIndex((t=>t.name===e));if(u===m)return;const f={pointer:c,command:"listRemove",path:["schema",i,"groups",u,"optionIds"],args:{id:o.id}},y={pointer:c,command:"listAfter",path:["schema",i,"groups",m,"optionIds"],args:{id:o.id}};d.push(f,y);const g=r.options??[],h=p.flatMap((e=>{const t=e.optionIds??[],o=g.filter((e=>t.includes(e.id)));return o})),v={pointer:c,command:"set",path:["schema",i,"options"],args:h};d.push(v),n(d),(0,C().L)(s,{property_type:r.type,action:"status_set_default",from:a,collection_id:t})}(e,o,I,d,x,D,c,H,K)}})}),action:()=>{}}));const J=A().tS.map((e=>{const t={key:e,render:t=>(0,R.jsx)(L().A,{...t,color:e,isChecked:I.color===e}),action:()=>{!function(e,t,o,i,n,a,r,s){const l={...t,color:e},c={pointer:{table:b().Vl,id:o},command:"keyedObjectListUpdate",path:["schema",i,"options"],args:{value:l}};a([c]),(0,C().L)(s,{property_type:n.type,action:"select_change_color",from:r,collection_id:o})}(e,I,o,d,c,x,D,H)}};return t})),ee={key:"color",render:e=>(0,R.jsx)(f().A,{...e,title:(0,R.jsx)(S().sA,{id:"database.selectPropertyOptionEditMenu.colorsSection",defaultMessage:"Colors"}),topBorder:!0}),items:J};let te;return X.push(ee),te=n().A.isMobile?{menuType:p().gu.Modal,title:(0,R.jsx)(V().O,{format:y().NY.Large,value:I.value,color:I.color,showRemoveButton:!1,isSingle:!0}),right:(0,R.jsx)(S().sA,{...l().W.done}),onClickRight:Y,scrollerStyle:{paddingBottom:B().H}}:{menuType:p().gu.Popup,width:220},(0,R.jsxs)(u().A,{...te,children:[(0,R.jsx)(f().A,{isInput:!0,children:(0,R.jsx)(P().Ay,{focusInitial:!0,selectAll:!n().A.isMobile,value:F,maxlength:180,onChange:$,onSubmit:Y,showClearButton:!1,inputRight:(0,R.jsx)(w().S,{onClick:()=>z.setState(!Q),description:I.description,showTooltip:!Q})})}),(0,R.jsx)(m().A,{type:m().O.Vertical,disableKeyboard:!0,initialFocus:void 0,sections:X})]})}function W(e,t,o,i,n,a,r,l){const c=l,d=i.options||[],p=d.find((e=>e.id!==r.id&&e.value.trim().toLowerCase()===c.trim().toLowerCase()));if(r.value!==c)if(c)if(p)s().f1((0,R.jsx)(S().sA,{defaultMessage:"This select option already exists.",id:"database.editProperty.errorDialog.duplicateSelectValue.message"}));else{const s=d.find((e=>e.id===r.id));if(!s)return;const l=c.trim(),p={...s,value:l},u={pointer:{table:b().Vl,id:o},command:"keyedObjectListUpdate",path:["schema",n,"options"],args:{value:p}},m="status"===i.type&&r.value===i.defaultOption?{pointer:{table:b().Vl,id:o},command:"update",path:["schema",n],args:{defaultOption:l}}:void 0;a(x().oE([u,m])),(0,I().V)({environment:e,collectionContextStore:t,property:n,from:"view_settings",action:"select_rename_option",option_value_char_count:l.length})}else s().f1((0,R.jsx)(S().sA,{defaultMessage:"Please type a value.",id:"database.editProperty.errorDialog.missingSelectValue.message"}))}},828973:(e,t,o)=>{o.d(t,{A:()=>h});o(898992),o(672577),o(581454);var i=o(296540),n=()=>o(726637),a=()=>o(383036),r=()=>o(590526),s=()=>o(401497),l=()=>o(127833),c=()=>o(546926),d=()=>o(81068),p=()=>o(663639),u=()=>o(736847),m=()=>o(100622),f=()=>o(496603),y=()=>o(284371),g=o(474848);const h=function({icon:e,iconStyle:t,title:h,selectedKey:v,onChange:b,onClick:S,popupStyle:A,menuItemOptionsStyle:x,menuStyle:k,disabled:I,collectionContextStore:C,openButtonPopup:M,hideCheck:w,children:j,disableParentClose:T,inputPlaceholder:O,renderSelectedKey:D,variant:_,...B}){const E="options"in B?B.options:f().Bq(B.sections),P=E.find((e=>f().n4(e.key,v))),L=(0,r().uB)(void 0,o(118307).A),V=(0,r().O$)(L).open;(0,i.useEffect)((()=>{C&&M&&(L.setState({...L.state,open:M}),C.settingsStore.setState({...C.settingsStore.state,openButtonPopup:void 0})),P||o(165358).log({level:"error",from:"CollectionSettingsPickListMenuItem",type:"InvalidSelectedItem",error:(0,o(229833).convertErrorToLog)("Selected key is invalid.")})}));const R=(0,s().eP)(),K=(0,s().IS)((()=>({fullWidthButton:{backgroundColor:m().Tj.background.secondary,border:`1px solid ${m().Tj.gray.border.secondaryTranslucent}`,alignItems:"center",color:m().Tj.text.primary,fontWeight:y().Wy.regular},fullWidthButtonHover:{backgroundColor:(0,o(606712).R)({color:m().Tj.background.secondary,mode:R})},popupWrapper:{margin:"12px 16px"},heading:{fontSize:o(115512).Kw,fontWeight:y().Wy.medium,color:m().Tj.text.secondary,marginBottom:12}})),[R]),F=(0,g.jsx)(o(250910).A,{popupType:n().A.isMobile?l().nl.BottomSheet:l().nl.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",style:A,originGap:0,buttonPopupStore:L,disabled:I,onClick:S,renderOrigin:i=>{const n=function(e){const{renderSelectedKey:t,selectedKey:o,selectedOption:i}=e;return t?t(o):"input"===(null==i?void 0:i.type)?i.inputValue:"button"===(null==i?void 0:i.type)?i.title:void 0}({renderSelectedKey:D,selectedKey:v,selectedOption:P});return"fullWidth"===_?(0,g.jsx)(d().A,{icon:null==e?void 0:e({}),focused:!1,disabled:I,title:n,buttonStyle:{width:"100%",justifyContent:"space-between",...K.fullWidthButton},hoveredStyle:K.fullWidthButtonHover,right:I?void 0:(0,g.jsx)(o(807449).I,{icon:o(324254).arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"tertiary"}),...(0,a().A)(i,B)}):(0,g.jsx)(o(497222).A,{title:h,showChevron:!0,right:n,rotateChevron:V,disabled:I,icon:e,iconStyle:t,...(0,a().A)(i,B)})},render:e=>{let t;t=n().A.isMobile?{menuType:c().gu.ActionSheet}:{menuType:c().gu.Popup,width:250,...k};const i=(t,i)=>{if(t.hideOption)return null;let n;return n="input"===t.type?{key:i,render:i=>(0,g.jsx)(o(419357).Ay,{...i,style:{width:"100%",paddingTop:4,paddingBottom:4},value:t.inputValue??"",onChange:e=>{var o;null===(o=t.onChange)||void 0===o||o.call(t,e.target.value)},onSubmit:o=>{var i;null===(i=t.onSubmit)||void 0===i||i.call(t,t.key,e,t.inputValue),e.close()},placeholder:O,isChecked:!w&&f().n4(t.key,v)}),action:()=>{}}:{key:i,render:e=>(0,g.jsx)(d().A,{...e,disabled:!1,title:t.title,icon:t.icon,caption:t.caption,captionStyle:t.captionStyle,inline:t.captionInline,spacerStyle:t.inlineSpacerStyle,body:t.body,style:x,isChecked:!w&&f().n4(t.key,v)}),action:()=>{b(t.key,e),T||e.close()}},n},a="sections"in B?B.sections.map(((e,t)=>({key:t,render:e=>(0,g.jsx)(u().A,{enableActionSheetTitle:!0,topBorder:t>0,...e}),items:f().oE(e.map(i))}))):[{key:0,render:e=>(0,g.jsx)(u().A,{enableActionSheetTitle:!0,...e}),items:f().oE(E.map(i))}];return(0,g.jsxs)(o(890492).A,{...t,children:[(0,g.jsx)(p().A,{type:p().O.Vertical,sections:a,initialFocus:0,resetFocusOnMouseOut:!0}),j||null]})}});return"fullWidth"===_?(0,g.jsxs)("div",{style:K.popupWrapper,children:[(0,g.jsx)("div",{style:K.heading,children:h}),F]}):F}}}]);