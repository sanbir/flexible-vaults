"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[1947],{14959:(e,t,o)=>{o.d(t,{u:()=>r});var n=()=>o(751735);function r(e,t){const{r:o,g:r,b:i}=(null==e?void 0:e.info.accent_color)||{r:0,g:0,b:0},a=`rgba(${o},${r},${i},${"dark"===t?.6:1})`;return{background:a,hoveredBackground:(0,n().e$)(a,.4),pressedBackground:(0,n().e$)(a,.9)}}},66486:(e,t,o)=>{o.d(t,{W:()=>J,D:()=>Q});o(898992),o(672577),o(581454);var n=o(296540),r=()=>o(726637),i=()=>o(484714),a=()=>o(590526),l=()=>o(401497),s=()=>o(718827),c=()=>o(127833),d=()=>o(250910),p=()=>o(118307),u=()=>o(807449),g=()=>o(31511),m=()=>o(19238),y=()=>o(287188),f=()=>o(26697),S=()=>o(736847),h=()=>o(708685),v=()=>o(568063),x=()=>o(239381),b=()=>o(324254),C=()=>o(72135),A=()=>o(69708),j=()=>o(100622),w=()=>o(534177),T=()=>o(284371),M=()=>o(901952),P=()=>o(908201),k=()=>o(312296),I=()=>o(525955),_=()=>o(78901),R=()=>o(675133),B=()=>o(546926),O=()=>o(890492),D=()=>o(81068),F=()=>o(663639),K=()=>o(452004),V=()=>o(763884),N=()=>o(778078),z=()=>o(547149),E=()=>o(419357),W=o(474848);const q="LastUsedCurrency",U=o(757695).Store.createClass("",{name:"NumberFormatFilterStore"});function L(e){const{collectionContextStore:t,collectionStore:o,property:l,schema:s,onClose:c}=e,d=(0,i().v3)(),p=(0,A().tz)(),u=(0,a().uB)(void 0,K().$),g=(0,a().uB)(void 0,U),m=(0,n.useCallback)((e=>{g.setState(e.target.value),u.setState({...u.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[g,u]),y=(0,a().O$)(g),f=(0,a().K8)((()=>function(e){const{environment:t,collectionContextStore:o,collectionStore:n,property:r,schema:i,numberFormatFilterStore:a,onClose:l}=e,s=V().K.get({userId:t.currentUser.id,key:q}),c=(0,N().Ay)(a.state,(0,C().RQ)(s),(e=>e));return c.map((e=>{const a=(0,C().gL)(R().A.getIntl(),e),s=(0,C().D9)(e),c=s?`${a} (${s})`:a,d={key:e,render:e=>(0,W.jsx)(D().A,{...e,title:c}),action:()=>function(e){const{newFormat:t,collectionContextStore:o,collectionStore:n,property:r,schema:i,environment:a,onClose:l}=e,s=i[r];if(!s)return;if("number"!==s.type&&"formula"!==s.type)return;const c={...s,number_format:t,..."percent"===t&&void 0!==(null==s?void 0:s.show_as)?{show_as:{...null==s?void 0:s.show_as,maxValue:1}}:{}};"number"===s.type&&(0,C().SL)(t)&&V().K.set({userId:a.currentUser.id,key:q,value:t});z().createAndCommit({userAction:"NumberFormatMenu.handleNumberFormatChange",environment:a,canUndo:!0,perform:e=>{(0,k().F)({environment:a,collectionStore:n,update:{[r]:c},transaction:e})}}),(0,M().V)({environment:a,collectionContextStore:o,property:r,from:"view_settings",action:"number_change_format",number_format:t}),null==l||l()}({newFormat:e,collectionContextStore:o,collectionStore:n,property:r,schema:i,environment:t,onClose:l})};return d}))}({environment:d,collectionStore:o,collectionContextStore:t,property:l,schema:s,numberFormatFilterStore:g,onClose:c})),[t,d,o,l,s,g,c]);let h;h=r().A.isMobile?{menuType:B().gu.ActionSheet}:{menuType:B().gu.Popup};const v=!r().A.isMobile&&(0,W.jsx)(S().A,{isInput:!0,children:(0,W.jsx)(E().Ay,{value:y,onChange:m,focus:!0,focusAfterAnimation:!0,placeholder:p.formatMessage({defaultMessage:"Filter formats…",id:"blockPropertyValue.filterForNumberFormats.placeholder"}),preventCaptureDeleteWhenEmpty:!0,preventCaptureSpacebarWhenEmpty:!0})});return(0,W.jsx)(O().A,{...h,header:v,children:(0,W.jsx)(F().A,{type:F().O.Vertical,initialFocus:0,sections:[{key:0,render:e=>(0,W.jsx)(S().A,{...e}),items:f}],store:u})})}var H=()=>o(893952),G=()=>o(255824),$=()=>o(497222),Y=()=>o(828973);function J(e){const{collectionContextStore:t,property:o,source:r}=e,l=(0,i().v3)(),{propertySchema:s,numberFormat:c,numberPrecision:d}=(0,a().K8)((()=>{const e=t.collectionStore();if(!e)return{};const n=t.normalizedSchemaStore.state[o];if(!n)return{};const r=e.getSpaceId(),i=l.idCreator.getSpaceIdCreatorSync(r);if("number"===n.type)return{propertySchema:n,numberFormat:n.number_format??C().C4,numberPrecision:n.number_precision??C().pS};if("formula"===n.type)return"number"===(0,h().getFormulaPropertySchemaResultType)(n)?{propertySchema:n,numberFormat:n.number_format??C().C4,numberPrecision:n.number_precision??C().pS}:n.formula2&&"number"===(0,x().pg)(n.formula2.result_type).type?{propertySchema:n,numberFormat:n.number_format??C().C4,numberPrecision:C().pS}:{};if("rollup"===n.type){var a;if(n.aggregation&&"show_unique"!==n.aggregation){var s;const r=null===(s=(0,v().eY)({property:o,schema:t.normalizedSchemaStore.state,getRecordModel:e.getRecordModel,spaceIdCreator:i}))||void 0===s?void 0:s.targetPropertySchema;if(void 0===(null==r?void 0:r.type))return{};const a=(0,I().o_)(n.aggregation,(0,I().o_)(n.aggregation,"number_format"in r?r.number_format:void 0));return a?{propertySchema:n,numberFormat:a,numberPrecision:C().pS}:{}}const r=null===(a=(0,v().eY)({property:o,schema:t.normalizedSchemaStore.state,getRecordModel:e.getRecordModel,spaceIdCreator:i}))||void 0===a?void 0:a.targetPropertySchema;if("number"===(null==r?void 0:r.type)||"formula"===(null==r?void 0:r.type)&&"number"===(0,h().getFormulaPropertySchemaBaseResultType)(r))return{propertySchema:n,numberFormat:r.number_format??C().C4,numberPrecision:C().pS}}return{}}),[t,o,l]),p="rollup"!==(null==s?void 0:s.type),u=(0,n.useMemo)((()=>"formula"===(null==s?void 0:s.type)&&"number"!==(0,h().getFormulaPropertySchemaResultType)(s)),[s]),g="rollup"!==(null==s?void 0:s.type)&&!u;return s?(0,W.jsxs)(W.Fragment,{children:[p?(0,W.jsx)(X,{numberFormat:c,property:o}):void 0,g?(0,W.jsx)(Z,{numberPrecision:d,property:o}):void 0,(0,W.jsx)(ee,{property:o,propertySchema:s,numberFormat:c,source:r})]}):null}function X(e){const{numberFormat:t,property:o}=e,i=(0,A().tz)(),l=(0,P().ET)(),s=(0,a().uB)(void 0,p().A),u=(0,a().K8)((()=>l.collectionStore()),[l]),g=(0,a().O$)(l.normalizedSchemaStore),m=(0,n.useCallback)((e=>(0,W.jsx)($().A,{title:(0,W.jsx)(A().sA,{defaultMessage:"Number format",id:"database.viewSettings.numberOptions.numberFormat"}),right:(0,W.jsx)("span",{style:{...T().RC},children:(0,C().gL)(i,C().PA.find((e=>e===t))??C().C4)}),showChevron:!0,rotateChevron:s.state.open,...e})),[s,i,t]),y=(0,n.useCallback)((e=>u?(0,W.jsx)(L,{collectionContextStore:l,collectionStore:u,property:o,schema:g,onClose:e.close}):null),[l,u,o,g]);return(0,W.jsx)(d().A,{popupType:r().A.isMobile?c().nl.BottomSheet:c().nl.Popup,alignmentToOrigin:"end",bottomSheetInitialState:"half",renderOrigin:m,render:y,buttonPopupStore:s})}function Z(e){const{numberPrecision:t,property:o}=e,r=(0,A().tz)(),l=(0,i().v3)(),s=(0,P().ET)(),c=(0,a().K8)((()=>s.collectionStore()),[s]),d=(0,a().O$)(s.normalizedSchemaStore),p=(0,n.useMemo)((()=>{const e=d[o];if(!e)return;const t="formula"===e.type&&"number"===(0,h().getFormulaPropertySchemaResultType)(e);return"number"===e.type||t?e:void 0}),[o,d]),u=(0,n.useMemo)((()=>C().iv.map((e=>({key:e,type:"button",title:Q(r,e)})))),[r]),g=(0,n.useCallback)((e=>{if(!c||!p)return;const t={...p,number_precision:e};z().createAndCommit({userAction:"NumberFormatMenu.handleNumberPrecisionChange",environment:l,canUndo:!0,perform:e=>{(0,k().F)({environment:l,collectionStore:c,update:{[o]:t},transaction:e})}}),(0,M().V)({environment:l,collectionContextStore:s,property:o,from:"view_settings",action:"number_change_precision",number_precision:e})}),[s,c,l,o,p]),m=(0,n.useCallback)((()=>(0,W.jsx)(A().sA,{defaultMessage:"Round to a specified number of decimal places. The underlying remains unchanged.",id:"database.viewSettings.numberOptions.numberPrecision.tooltip"})),[]),y=(0,n.useCallback)((e=>(0,W.jsx)(Y().A,{...e,title:(0,W.jsx)(A().sA,{defaultMessage:"Decimal places",id:"database.viewSettings.numberOptions.numberPrecision"}),selectedKey:t,options:u,onChange:g})),[g,t,u]);return(0,W.jsx)(f().m,{placement:"right",textWrap:!0,renderTooltip:m,render:y})}function Q(e,t){switch(t){case"precision_uncapped":return e.formatMessage({id:"collection.numberFormat.precisionUncapped",defaultMessage:"Default"});case"precision_0":return e.formatMessage({id:"collection.numberFormat.precision0",defaultMessage:"0"});case"precision_1":return e.formatMessage({id:"collection.numberFormat.precision1",defaultMessage:"1"});case"precision_2":return e.formatMessage({id:"collection.numberFormat.precision2",defaultMessage:"2"});case"precision_3":return e.formatMessage({id:"collection.numberFormat.precision3",defaultMessage:"3"});case"precision_4":return e.formatMessage({id:"collection.numberFormat.precision4",defaultMessage:"4"});case"precision_5":return e.formatMessage({id:"collection.numberFormat.precision5",defaultMessage:"5"});default:(0,w().HB)(t)}}function ee(e){const{property:t,propertySchema:o,numberFormat:a,source:c}=e,{show_as:p}=o,f=(0,i().v3)(),h=(0,P().ET)(),v=(0,n.useRef)({color:(null==p?void 0:p.color)??"green",maxValue:(null==p?void 0:p.maxValue)??100,showValue:(null==p?void 0:p.showValue)??!0}),x=(0,G().a)(),C="tableHeaderMenu"===c,w={type:(null==p?void 0:p.type)??"number",color:(null==p?void 0:p.color)??v.current.color,maxValue:(null==p?void 0:p.maxValue)??v.current.maxValue,showValue:(null==p?void 0:p.showValue)??v.current.showValue},I=(0,l().IS)((()=>({card:{boxSizing:"content-box",height:36,flex:1,margin:1,boxShadow:`0 0 0 1px ${j().Tj.border.secondaryTranslucent}`,color:j().Tj.text.secondary,borderRadius:6,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",paddingInlineStart:12,paddingInlineEnd:12,paddingTop:6,paddingBottom:6,cursor:"pointer",background:x?j().Tj.background.elevated:void 0},cardHoveredStyle:{background:x?j().Tj.background.elevated:void 0},cardPressedStyle:{background:x?j().Tj.background.elevated:void 0},selectedCard:{boxShadow:`0 0 0 2px ${j().Tj.blue.border.accentPrimary}`,color:j().Tj.blue.text.accentPrimary},cardVisual:{height:20,marginBottom:4,width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},cardText:{lineHeight:1,fontSize:12},showAsTypeOption:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginInlineStart:x?12:C?8:16,marginInlineEnd:C?8:16,marginTop:6,gap:6},allExtraOptions:{backgroundColor:x?j().Tj.background.elevated:j().Tj.palette.gray[30],boxShadow:x?`0 0 0 1px ${j().Tj.border.secondaryTranslucent}`:void 0,borderRadius:5,marginTop:12,marginInlineStart:x?12:C?8:16,marginInlineEnd:C?8:16,paddingTop:12,paddingBottom:12,maxHeight:1e3,transition:"max-height 0.5s ease-in-out",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",gap:8},extraOptionStyle:{display:"flex",flexDirection:"row",alignItems:"center",paddingInlineStart:16,paddingInlineEnd:16,gap:16,height:28,width:"100%"},applyToAllViews:{marginTop:12,marginInlineStart:C?10:18,marginInlineEnd:C?10:18,fontSize:12,color:j().Tj.text.tertiary,paddingBottom:C?6:0}})),[x,C]),R=(0,n.useCallback)((e=>{const n=h.collectionStore();o&&n&&(z().createAndCommit({userAction:"CollectionSettingsProperty.handleNumberShowAsChange",environment:f,canUndo:!0,perform:r=>{(0,k().F)({environment:f,collectionStore:n,update:{[t]:{...o,show_as:e}},transaction:r})}}),(0,M().V)({environment:f,collectionContextStore:h,property:t,from:"view_settings",action:"number_change_show_as",number_show_as:(null==e?void 0:e.type)??"number"}))}),[h,f,t,o]),B=(0,n.useMemo)((()=>[{key:"number",visual:(0,W.jsx)("div",{style:{fontSize:16,fontWeight:T().Wy.medium},children:"42"}),text:(0,W.jsx)(A().sA,{defaultMessage:"Number",id:"database.viewSettings.numberOptions.showAsNumber"})},{key:"bar",visual:(0,W.jsx)(_().z,{percentage:50,filledColor:j().Tj["bar"===w.type?"blue":"gray"].background.accentPrimary,unfilledColor:j().Tj["bar"===w.type?"blue":"gray"].background.tertiaryTranslucent,style:{width:"100%"}}),text:(0,W.jsx)(A().sA,{defaultMessage:"Bar",id:"database.viewSettings.numberOptions.showAsBar"})},{key:"ring",visual:(0,W.jsx)(m().E,{size:20,progressPercentage:40,progressColor:"ring"===w.type?"blue":"gray",ringColor:"ring"===w.type?"blue":"gray",ringThickness:2}),text:(0,W.jsx)(A().sA,{defaultMessage:"Ring",id:"database.viewSettings.numberOptions.showAsRing"})}]),[w.type]),O=(0,W.jsx)("div",{style:I.showAsTypeOption,children:B.map((e=>{const t=w.type===e.key;return(0,W.jsxs)(s().Ay,{onClick:()=>{const t="number"===e.key?void 0:{type:e.key,color:w.color,maxValue:"percent"===a?1:w.maxValue,showValue:w.showValue};void 0!==t&&(v.current=t),R(t)},style:{...I.card,...t?I.selectedCard:{}},hoveredStyle:I.cardHoveredStyle,pressedStyle:I.cardPressedStyle,children:[(0,W.jsx)("div",{style:I.cardVisual,children:e.visual}),(0,W.jsx)("div",{style:I.cardText,children:e.text})]},e.key)}))}),D=e=>{const t="number"!==w.type?{...w,type:w.type,...e}:void 0;void 0!==t&&(v.current=t),R(t)},F="number"!==w.type?(0,W.jsxs)("div",{style:I.extraOptionStyle,children:[(0,W.jsx)("div",{style:{flex:6,fontSize:14},children:(0,W.jsx)(A().sA,{defaultMessage:"Color",id:"database.viewSettings.numberOptions.color"})}),(0,W.jsx)("div",{style:{display:"flex",flexWrap:"wrap",flex:6,gap:7},children:(0,W.jsx)(d().A,{popupType:r().A.isMobile?d().z.BottomSheet:d().z.Popup,bottomSheetInitialState:"half",renderOrigin:e=>(0,W.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"end"},...e,children:(0,W.jsx)(H().A,{color:w.color,focused:!1,buttonStyle:{width:"auto",marginInlineStart:0,marginInlineEnd:0,borderRadius:6,color:j().Tj.text.tertiary},style:{minHeight:36},right:(0,W.jsx)(u().I,{icon:b().arrowChevronSingleDownSmallIcon,size:"sm"})})}),render:e=>{const t=j().tS.map((t=>(0,W.jsx)(H().A,{color:t,isChecked:t===w.color,focused:!1,style:{width:"100%"},onClick:()=>{D({color:t}),e.close()}},t)));return(0,W.jsx)("div",{style:{minWidth:150,paddingTop:8,paddingBottom:8},children:t})}})})]}):null,K="number"!==w.type?"percent"!==a&&(0,W.jsxs)("div",{style:I.extraOptionStyle,children:[(0,W.jsx)("div",{style:{flex:6,fontSize:14},children:(0,W.jsx)(A().sA,{defaultMessage:"Divide by",id:"database.viewSettings.numberOptions.divideBy"})}),(0,W.jsx)("div",{style:{flex:6},children:(0,W.jsx)(g().A,{value:w.maxValue.toString(),onChange:e=>{const t=e.target.value.replace(/[^0-9]/g,""),o=parseFloat(t);!isNaN(o)&&o>0&&D({maxValue:o})},inputStyle:{textAlign:"end"}})})]}):null,V="number"!==w.type?(0,W.jsxs)("div",{style:I.extraOptionStyle,children:[(0,W.jsx)("div",{style:{flex:6,fontSize:14},children:(0,W.jsx)(A().sA,{defaultMessage:"Show number",id:"database.viewSettings.numberOptions.showValue"})}),(0,W.jsx)("div",{style:{flex:6,display:"flex",justifyContent:"flex-end"},children:(0,W.jsx)(y().A,{on:w.showValue,onClick:()=>{D({showValue:!w.showValue})},disabled:!1})})]}):null,N=Boolean(F||K||V)?(0,W.jsxs)("div",{style:I.allExtraOptions,children:[F,K,V]}):null;return(0,W.jsxs)(S().A,{title:(0,W.jsx)(A().sA,{defaultMessage:"Show as",id:"database.viewSettings.numberPercentOptions.showAs"}),topBorder:!0,disableMobileBorders:!0,children:[O,N,x?void 0:(0,W.jsx)("div",{style:I.applyToAllViews,children:(0,W.jsx)(A().sA,{id:"database.CollectionSettings.NumberOptions.applyAllViews",defaultMessage:"Changes apply to all views showing this property."})})]})}},73337:(e,t,o)=>{o.d(t,{P:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.12 16.79 14.42",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M18.507 11.112c.362 0 .655.293.655.656v4.369a.656.656 0 0 1-1.311 0V13.35l-4.997 4.997a.655.655 0 1 1-.927-.928l4.997-4.997h-2.786a.655.655 0 1 1 0-1.31z"}),(0,n.jsx)("path",{d:"M15.5 4.125c1.174 0 2.125.951 2.125 2.125v3.612h-1.25v-.987h-5.75v2.25h1.72a2 2 0 0 0-.103.448l-.01.195.01.195q.024.214.091.412h-1.708v2.25h2.33l-1.25 1.25H4.5a2.125 2.125 0 0 1-2.125-2.125v-7.5c0-1.174.951-2.125 2.125-2.125zM3.625 13.75c0 .483.392.875.875.875h4.875v-2.25h-5.75zm0-2.625h5.75v-2.25h-5.75zm.875-5.75a.875.875 0 0 0-.875.875v1.375h5.75v-2.25zm6.125 2.25h5.75V6.25a.875.875 0 0 0-.875-.875h-4.875z"})]})},i=(0,o(340498).wt)("collectionArrow",r,"default")},74519:(e,t,o)=>{o.d(t,{j:()=>i});var n=()=>o(79926);const r=new(n().O2)("CollectionSettingsTitlePropertyOptions",(async()=>o.e(37697).then(o.bind(o,312783)))),i=(0,n()._h)(r,(e=>e.CollectionSettingsTitlePropertyOptions))},109129:(e,t,o)=>{o.d(t,{V:()=>p});o(296540);var n=()=>o(484714),r=()=>o(665589),i=()=>o(69708),a=()=>o(901952),l=()=>o(312296),s=()=>o(547149),c=()=>o(35091),d=o(474848);function p({menuListProps:e,collectionContextStore:t,property:o,propertySchema:p}){const u=(0,n().v3)();return(0,d.jsx)(c().A,{title:(0,d.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:(0,d.jsx)(i().sA,{defaultMessage:"Show full URL",id:"database.viewSettings.propertyTab.toggleShowFullUrl"})}),icon:r().l,showChevron:!1,switcherProps:{on:Boolean(p.show_full_url),noColor:!1},...e,onClick:()=>function(e,t,o,n){const r=t.collectionStore();if(!n||!r||"url"!==n.type)return;const i=!Boolean(n.show_full_url);s().createAndCommit({userAction:"CollectionSettingsProperty.handleNumberShowAsChange",environment:e,canUndo:!0,perform:t=>{(0,l().F)({environment:e,collectionStore:r,update:{[o]:{...n,show_full_url:i}},transaction:t})}}),(0,a().V)({environment:e,collectionContextStore:t,property:o,from:"view_settings",action:i?"url_toggle_show_full_on":"url_toggle_show_full_off"})}(u,t,o,p)})}},115552:(e,t,o)=>{o.d(t,{A:()=>d});o(581454),o(296540);var n=()=>o(401497),r=()=>o(718827),i=()=>o(100622),a=()=>o(284371),l=()=>o(115512),s=o(474848);const c={tall:80,short:50};function d(e){const{disabled:t,options:o,selectedOption:d,onOptionSelected:p,height:u}=e,g=(0,n().eP)(),m=(0,n().IS)((()=>({cardContainer:{paddingInlineStart:8,paddingInlineEnd:8,display:"flex",justifyContent:"space-between",alignItems:"center",columnGap:8},cardUnselected:{display:"flex",flexDirection:"column",alignItems:"center",flexGrow:1,flexBasis:82,minWidth:0,color:i().Tj.palette.gray[500]},cardSelected:{display:"flex",flexDirection:"column",alignItems:"center",flexGrow:1,flexBasis:82,minWidth:0,color:i().Tj.palette.gray[500]},cardButtonBase:{height:c[u],width:"100%",borderRadius:6,borderStyle:"solid",transition:"border-color 0.3s, box-shadow 0.3s",display:"flex",justifyContent:"center",alignItems:"center",color:t?i().Tj.icon.tertiary:void 0,background:i().Tj.background.elevated},cardButtonHovered:{background:i().Tj.background.elevated,...(0,l().nl)({width:2,color:i().Tj.blue.border.strong})},cardButtonSelected:(0,l().nl)({width:2,color:i().Tj.blue.border.accentPrimary}),cardButtonUnselected:(0,l().nl)({width:1,color:"dark"===g?i().Tj.palette.gray[400]:i().Tj.palette.gray[100]}),cardLabelBase:{...a().RC,marginTop:6,fontSize:12,lineHeight:"14px",maxWidth:"100%",color:t?i().Tj.icon.tertiary:void 0},cardLabelSelected:{fontWeight:a().Wy.semibold,color:i().Tj.palette.gray[900]},iconBase:{height:24,width:24,color:t?void 0:i().Tj.icon.secondary},iconSelected:{color:i().Tj.blue.icon.accentPrimary,fill:i().Tj.blue.icon.accentPrimary},imageBase:{maxHeight:c[u],opacity:t?.5:1},imageSelected:{opacity:1}})),[t,u,g]),y=o.available.map((e=>{const n=o.appearance[e],i=e===d;return(0,s.jsxs)("div",{style:i?m.cardSelected:m.cardUnselected,children:[(0,s.jsx)(r().Ay,{style:{...m.cardButtonBase,...i?m.cardButtonSelected:m.cardButtonUnselected},hoveredStyle:m.cardButtonHovered,pressedStyle:m.cardButtonHovered,ignoreLocalHoverState:i,disabled:t,onClick:()=>{p(e)},children:n.icon?n.icon.function({...m.iconBase,height:n.icon.size,width:n.icon.size,...i?m.iconSelected:{}}):(0,s.jsx)("img",{src:n.image.src,style:{width:n.image.width,height:n.image.height,...m.imageBase,...i?m.imageSelected:{}}})}),(0,s.jsx)("div",{style:{...m.cardLabelBase,...i?m.cardLabelSelected:{}},children:n.label})]},e)}));return(0,s.jsx)("div",{style:m.cardContainer,children:y})}},120201:(e,t,o)=>{o.d(t,{e:()=>U});o(16280),o(898992),o(672577),o(737550);var n=o(296540),r=()=>o(383036),i=()=>o(484714),a=()=>o(590526),l=()=>o(401497),s=()=>o(128933),c=()=>o(350013),d=()=>o(250910),p=()=>o(388926),u=()=>o(396896),g=()=>o(695115),m=()=>o(546926),y=()=>o(406094),f=()=>o(160432),S=()=>o(493552),h=()=>o(26697),v=()=>o(890492),x=()=>o(81068),b=()=>o(663639),C=()=>o(736847),A=()=>o(819560),j=()=>o(721479),w=()=>o(743246),T=()=>o(905470),M=()=>o(711517),P=()=>o(69708),k=()=>o(100622),I=()=>o(496603),_=()=>o(388832),R=()=>o(58807),B=()=>o(815510),O=()=>o(35091),D=()=>o(212854),F=()=>o(784379),K=()=>o(724833),V=()=>o(463620),N=()=>o(834539),z=()=>o(921982),E=o(474848);const W={canSearchWorkspace:!0,canSearchWeb:!1};const q=(0,P().YK)({previewOptionFirstPage:{id:"propertyAgentAutofillMenu.preview.option.firstPage",defaultMessage:"First page"},previewOptionFirst5Pages:{id:"propertyAgentAutofillMenu.preview.option.first5Pages",defaultMessage:"First 5 pages"},previewOptionFirst10Pages:{id:"propertyAgentAutofillMenu.preview.option.first10Pages",defaultMessage:"First 10 pages"},previewOptionAllPages:{id:"propertyAgentAutofillMenu.preview.option.allPages",defaultMessage:"All pages in this view"},inputPlaceholder:{defaultMessage:"Add specific instructions for your agent, e.g., ‘Fill in the most recent company’.",id:"propertyAgentAutofillMenu.placeholder"},onPageCreation:{defaultMessage:"On page creation",id:"propertyAgentAutofillMenu.triggerOnCreate"},onPageUpdate:{defaultMessage:"On page update",id:"propertyAgentAutofillMenu.triggerOnUpdate"},searchWorkspace:{defaultMessage:"Other workspace pages",id:"propertyAgentAutofillMenu.searchWorkspace"},searchWeb:{defaultMessage:"Anything on the web",id:"propertyAgentAutofillMenu.searchWeb"},createAgent:{defaultMessage:"Create agent",id:"propertyAgentAutofillMenu.createAgent"},saveChanges:{defaultMessage:"Save changes",id:"propertyAgentAutofillMenu.saveChanges"},runAutoFill:{defaultMessage:"Run auto-fill now",id:"propertyAgentAutofillMenu.runAutoFill"},noConfig:{defaultMessage:"No agent configuration found.",id:"propertyAgentAutofillMenu.noConfig"},instructionsTitle:{defaultMessage:"Instructions",id:"propertyAgentAutofillMenu.instructions.title"},sourcesTitle:{defaultMessage:"Sources",id:"propertyAgentAutofillMenu.sources.title"},sourcesTooltip:{defaultMessage:"This agent only searches the selected sources",id:"propertyAgentAutofillMenu.sources.tooltip"},setAsDefault:{defaultMessage:"Set as default",id:"propertyAgentAutofillMenu.setAsDefault"},hasSelectOrMultiselectWithNoOptions:{defaultMessage:"All select and multi-select properties must have options",id:"propertyAgentAutofillMenu.hasSelectOrMultiselectWithNoOptions"},onPageCreationTooltip:{defaultMessage:"The agent automatically fills this property when new pages are created",id:"propertyAgentAutofillMenu.onPageCreationTooltip"},onPageUpdateTooltip:{defaultMessage:"The agent automatically fills this property when the page is updated",id:"propertyAgentAutofillMenu.onPageUpdateTooltip"},creatingAgent:{defaultMessage:"Creating agent...",id:"propertyAgentAutofillMenu.creatingAgent"},failedToStartFill:{defaultMessage:"Failed to start fill operation",id:"propertyAgentAutofillMenu.failedToStartFill"},failedToStartFillAll:{defaultMessage:"Failed to start fill all operation",id:"propertyAgentAutofillMenu.failedToStartFillAll"}});function U(e){const{collectionContextStore:t,collectionStore:o,handleCloseParent:U=(()=>{}),numWorkflowsForProperty:L=1,property:H,propertySchema:G,spaceId:$,workflowId:Y}=e,J=(0,i().v3)(),X=(0,P().tz)(),[Z,Q]=(0,n.useState)(!1),ee=(0,a().K8)((()=>{const e=o.getParentCollectionViewBlockStore();return e?c().N.createChildStore(e,{table:w().C0,id:Y,spaceId:$}):null}),[o,Y,$]),te=(0,a().K8)((()=>{const e=(null==ee?void 0:ee.getDraftDataStore())??(null==ee?void 0:ee.getDataStore()),t=null==e?void 0:e.getKeyStore("instructions"),o=null==t?void 0:t.getValue();if(void 0===o||(0,M().Zv)(o))return t}),[ee]),oe=(0,a().K8)((()=>{if(!ee)return D().W;const e=ee.getDraftData()??ee.getData();let t=!1,o=!1,n=!1;if(e){var r,i;a="notion.page.created",o=!(null==e||!e.triggers)&&e.triggers.some((e=>{var t;return(null===(t=e.state)||void 0===t?void 0:t.type)===a}));const l=null===(r=e.triggers)||void 0===r?void 0:r.find((e=>{var t;return"notion.page.updated"===(null===(t=e.state)||void 0===t?void 0:t.type)&&e.enabled}));l&&"notion.page.updated"===(null===(i=l.state)||void 0===i?void 0:i.type)&&(n=Boolean(l.state.propertyIds&&l.state.propertyIds.length>0),t=!l.state.shouldIgnorePageContentUpdates)}var a;return{shouldTriggerOnPageContentUpdate:t,shouldTriggerOnPageCreate:o,shouldTriggerOnPropertyUpdate:n}}),[ee]),ne=(0,a().K8)((()=>{var e,t;if(!ee)return W;const o=ee.getDraftData()??ee.getData(),n=null==o||null===(e=o.modules)||void 0===e?void 0:e.find((e=>"notion"===e.type));if(!n)return W;const r=null===(t=n.permissions)||void 0===t?void 0:t.some((e=>{var t;return"notion"===e.type&&"workspacePublic"===(null===(t=e.identifier)||void 0===t?void 0:t.type)}));return{canSearchWorkspace:Boolean(r),canSearchWeb:(0,T().qQ)(n.permissions)}}),[ee]),re=(0,a().K8)((()=>ee?(0,_().d_)(ee):[]),[ee]),ie=(0,a().K8)((()=>!!ee&&ee.hasBeenPublished()),[ee]),ae=(0,n.useCallback)(((e,t)=>{ee&&o&&B().gT({workflowStore:ee,currentCollectionStore:o,environment:J,spaceId:$,triggerStates:oe,triggerType:e,enabled:t})}),[J,ee,oe,o,$]),le=(0,n.useCallback)((e=>{if(!ee||!o)return;const t=function(e){const t=null==e?void 0:e.getParentCollectionViewBlockStore();if(t)return t.id}(o);if(!t)throw new Error("Collection must have a parent block to update permissions");B().$6({workflowStore:ee,environment:J,spaceId:$,newSearchStates:e,collectionViewBlockId:t})}),[J,ee,o,$]),se=(0,n.useCallback)((e=>{ee&&o&&B().r1({workflowStore:ee,collectionStore:o,environment:J,intl:X,spaceId:$,selectedProperties:e})}),[J,X,ee,o,$]),ce=(0,a().K8)((()=>o.getSchema()),[o]),de=(0,n.useCallback)((async()=>{ee&&(Q(!0),await B().D9({workflowStore:ee,environment:J,spaceId:$,intl:X}),Q(!1))}),[ee,J,$,Q,X]),pe=(0,l().IS)((()=>({container:{display:"flex",flexDirection:"column",height:"100%"},contentContainer:{flex:1,overflowY:"auto",paddingInlineStart:16,paddingInlineEnd:8},section:{paddingInlineEnd:8},toggleSection:{display:"flex",flexDirection:"column",gap:4},loadingText:{color:k().Tj.text.secondary,fontSize:14,padding:16},buttonContainer:{backgroundColor:k().Tj.background.primary,display:"flex",justifyContent:"center",paddingInline:16},buttonsContainer:{marginTop:12,marginBottom:16},buttonWidth:{width:"100%"},collectionSettingsSwitcherMenuItemStyle:{marginInlineStart:-4,marginInlineEnd:-4},divider:{marginBottom:8,marginTop:8,paddingInlineEnd:8},autofillIcons:{color:k().Tj.icon.tertiary},blueDot:{width:6,height:6,borderRadius:"50%",backgroundColor:k().Tj.blue.background.accentPrimary}})),[]),ue=(0,n.useCallback)((async e=>{if(!ee||!o)return void U();const n=(0,F().wv)(X);try{U(),await B().ay({n:e,collectionContextStore:t,workflowStore:ee,currentCollectionStore:o,environment:J,properties:re,spaceId:$,onEnqueueStart:n.onEnqueueStart,onEnqueueComplete:n.onEnqueueComplete})}catch(r){s().D6({label:X.formatMessage(q.failedToStartFill)})}}),[t,o,J,U,X,re,$,ee]),ge=(0,n.useCallback)((async()=>{if(!ee||!o)return void U();const e=(0,F().eX)(X);try{U(),await B().Xp({workflowStore:ee,currentCollectionStore:o,collectionContextStore:t,environment:J,spaceId:$,properties:re,onEnqueueStart:e.onEnqueueStart,onEnqueueComplete:e.onEnqueueComplete})}catch(n){s().D6({label:X.formatMessage(q.failedToStartFillAll)})}}),[ee,o,U,X,t,J,$,re]),me=(0,n.useCallback)((()=>{H&&ee&&B().XL({workflowId:Y,propertyId:H,collectionStore:o,workflows:[ee],environment:J})}),[H,ee,Y,o,J]),ye=(0,n.useMemo)((()=>!(!ee||!G)&&(0,R().DO)(ee.id,G)),[G,ee]),fe=(0,a().K8)((()=>!(!te||!ee)&&(ee.hasBeenPublished()?ee.hasChanges(!0):!!te.getValue()||(!(1===re.length&&(!H||re.includes(H)))||(!I().n4(oe,D().W)||!I().n4(ne,W))))),[te,H,ne,re,oe,ee]),Se=(0,a().K8)((()=>{var e;const t=null==ee||null===(e=ee.getDraftData())||void 0===e?void 0:e.paused_reason;return Boolean(null==t?void 0:t.reason)}),[ee]),[he,ve]=(0,n.useState)(!1),xe=(0,n.useCallback)((()=>{ve(!0)}),[]),be=(0,a().K8)((()=>null==te?void 0:te.getValue()),[te]),Ce=(0,a().K8)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getSchema();return!!o&&re.some((e=>{const t=o[e];if(("select"===(null==t?void 0:t.type)||"multi_select"===(null==t?void 0:t.type))&&0===(t.options||[]).length)return!0}))}),[t,re]),{propertySelectionDropdown:Ae}=(0,z().i)({schema:ce,selectedProperties:re,onSelectionChange:se});return(0,E.jsxs)("div",{style:pe.container,role:"presentation",children:[ee?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)("div",{style:pe.contentContainer,children:[Se?(0,E.jsx)(V().u,{workflowStore:ee,onRequestIncrease:xe,minified:!0}):void 0,(0,E.jsx)("div",{style:pe.section,children:te?(0,E.jsxs)(u().VP,{gap:8,children:[(0,E.jsxs)(u().fI,{gap:8,alignItems:"center",children:[(0,E.jsx)(S().D,{styleKey:"captionMedium",color:"gray",colorVariant:"secondary",children:(0,E.jsx)(P().sA,{...q.instructionsTitle})}),fe&&ie?(0,E.jsx)("div",{style:pe.blueDot}):void 0]}),(0,E.jsx)(N().c,{collectionStore:o,placeholder:X.formatMessage(q.inputPlaceholder),minHeight:80,workflowStore:ee})]}):void 0}),(0,E.jsx)("div",{style:{paddingBottom:4}}),Ae,(0,E.jsxs)("div",{style:pe.toggleSection,children:[(0,E.jsx)(h().m,{delayThreshold:1e3,render:e=>(0,E.jsx)(O().A,{...e,switcherProps:{on:oe.shouldTriggerOnPageCreate||!1},title:(0,E.jsx)(P().sA,{...q.onPageCreation}),onClick:()=>{ae("shouldTriggerOnPageCreate",!oe.shouldTriggerOnPageCreate)},buttonStyle:pe.collectionSettingsSwitcherMenuItemStyle}),renderTooltip:()=>X.formatMessage(q.onPageCreationTooltip)}),(0,E.jsx)(h().m,{delayThreshold:1e3,render:e=>(0,E.jsx)(O().A,{...e,switcherProps:{on:oe.shouldTriggerOnPageContentUpdate||!1},buttonStyle:pe.collectionSettingsSwitcherMenuItemStyle,title:(0,E.jsx)(P().sA,{...q.onPageUpdate}),onClick:()=>{ae("shouldTriggerOnPageContentUpdate",!oe.shouldTriggerOnPageContentUpdate)}}),renderTooltip:()=>X.formatMessage(q.onPageUpdateTooltip)})]}),(0,E.jsx)(p().A,{size:1,style:pe.divider,colorVariant:"secondary"}),(0,E.jsxs)(u().VP,{gap:8,children:[(0,E.jsxs)(u().fI,{gap:4,children:[(0,E.jsx)(S().D,{styleKey:"captionMedium",color:"gray",colorVariant:"secondary",children:(0,E.jsx)(P().sA,{...q.sourcesTitle})}),(0,E.jsx)(h().m,{renderTooltip:()=>(0,E.jsx)(P().sA,{...q.sourcesTooltip}),render:e=>(0,E.jsx)(g().A,{...e,size:"xxs",icon:j().questionMarkCircleSmallIcon,iconStyle:pe.autofillIcons,ariaLabel:X.formatMessage(q.sourcesTooltip)})})]}),(0,E.jsxs)("div",{style:pe.toggleSection,children:[(0,E.jsx)(O().A,{buttonStyle:pe.collectionSettingsSwitcherMenuItemStyle,switcherProps:{on:ne.canSearchWorkspace||!1},title:(0,E.jsx)(P().sA,{...q.searchWorkspace}),onClick:()=>{le({...ne,canSearchWorkspace:!ne.canSearchWorkspace})}}),(0,E.jsx)(O().A,{switcherProps:{on:ne.canSearchWeb||!1},buttonStyle:pe.collectionSettingsSwitcherMenuItemStyle,title:(0,E.jsx)(P().sA,{...q.searchWeb}),onClick:()=>{le({...ne,canSearchWeb:!ne.canSearchWeb})}})]})]})]}),(0,E.jsxs)("div",{style:pe.buttonsContainer,children:[ie?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(d().A,{popupType:d().z.Popup,popupWrapStyle:{width:288},alignmentToOrigin:"center",renderOrigin:e=>(0,E.jsx)(h().m,{disableTooltip:!Ce,renderTooltip:()=>(0,E.jsx)(P().sA,{...q.hasSelectOrMultiselectWithNoOptions}),render:t=>(0,E.jsx)("div",{style:pe.buttonContainer,children:(0,E.jsx)(y().A,{...(0,r().A)(e,t),size:"md",style:pe.buttonWidth,iconLeading:{icon:A().b,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"},disabled:Ce||fe,children:(0,E.jsx)(P().sA,{...q.runAutoFill})})})}),render:({close:e})=>(0,E.jsx)(v().A,{menuType:m().gu.Popup,children:(0,E.jsx)(b().A,{type:b().O.Vertical,sections:[{key:"preview-options",items:[{key:"first-page",action:()=>{ue(1),e()},render:e=>(0,E.jsx)(x().A,{...e,title:X.formatMessage(q.previewOptionFirstPage),buttonStyle:{width:"100%",justifyContent:"flex-start",textAlign:"start"}})},{key:"first-5-pages",action:()=>{ue(5),e()},render:e=>(0,E.jsx)(x().A,{...e,title:X.formatMessage(q.previewOptionFirst5Pages),buttonStyle:{width:"100%",justifyContent:"flex-start",textAlign:"start"}})},{key:"first-10-pages",action:()=>{ue(10),e()},render:e=>(0,E.jsx)(x().A,{...e,title:X.formatMessage(q.previewOptionFirst10Pages),buttonStyle:{width:"100%",justifyContent:"flex-start",textAlign:"start"}})},{key:"all-pages",action:()=>{e(),ge()},render:e=>(0,E.jsx)(x().A,{...e,title:X.formatMessage(q.previewOptionAllPages),buttonStyle:{width:"100%",justifyContent:"flex-start",textAlign:"start"}})}],render:e=>(0,E.jsx)(C().A,{...e})}],initialFocus:void 0})})}),(0,E.jsx)("div",{style:{marginTop:8}})]}):null,ie&&!ye&&H&&L>1?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{style:pe.buttonContainer,children:(0,E.jsx)(y().A,{size:"md",style:pe.buttonWidth,onClick:me,children:(0,E.jsx)(P().sA,{...q.setAsDefault})})}),(0,E.jsx)("div",{style:{marginTop:8}})]}):null,(0,E.jsx)("div",{style:pe.buttonContainer,children:(0,E.jsx)(f().A,{onClick:de,size:"md",style:pe.buttonWidth,colorPalette:"blue",disabled:!fe||!be,children:ie?(0,E.jsx)(P().sA,{...q.saveChanges}):(0,E.jsx)(P().sA,{...Z?q.creatingAgent:q.createAgent})})})]})]}):(0,E.jsx)("div",{style:pe.loadingText,children:(0,E.jsx)(P().sA,{...q.noConfig})}),he&&ee?(0,E.jsx)(K().h,{workflowStore:ee,isOpen:he,onClose:()=>ve(!1)}):void 0]})}},142110:(e,t,o)=>{o.d(t,{g:()=>a});var n=()=>o(675133),r=()=>o(792057),i=()=>o(302107);function a(e){const{collectionContextStore:t,propertyId:o,propertySchema:a,handlePropertyTypeChange:l}=e,s=t.collectionStore();if(s)if(a&&(0,i().dR)({propertyId:o,propertyType:a.type,permissionItems:s.getPermissionItems()})){const e=[{label:n().A.formatMessage(i().DZ.changePropertyTypeWarningButtonLabel),color:"red",onAccept:l}];r().ui({showCancel:!0,keepFocus:!1,message:n().A.formatMessage(i().DZ.changePropertyTypeWarningMessage),description:n().A.formatMessage(i().DZ.changePropertyTypeWarningDescription),mode:"wide",items:e})}else l()}},158797:(e,t,o)=>{o.d(t,{A:()=>Se});o(898992),o(672577);var n=o(296540),r=()=>o(135168),i=()=>o(726637),a=()=>o(484714),l=()=>o(590526),s=()=>o(401497),c=()=>o(365917),d=()=>o(792057),p=()=>o(631524),u=()=>o(736847),g=()=>o(617871),m=()=>o(14959),y=()=>o(69708),f=()=>o(100622),S=()=>o(534177),h=()=>o(510683),v=()=>o(374562),x=()=>o(895876),b=()=>o(132389),C=()=>o(817126),A=()=>o(176983),j=()=>o(221522),w=(o(944114),o(354520),o(430670),o(803949),o(581454),()=>o(675133)),T=()=>o(245720),M=()=>o(250910),P=()=>o(388926),k=()=>o(807449),I=()=>o(546926),_=()=>o(160432),R=()=>o(26697),B=()=>o(890492),O=()=>o(81068),D=()=>o(663639),F=()=>o(898244),K=()=>o(852424),V=()=>o(784892),N=()=>o(638681);const z={pull_request_review_edited:!0,pull_request_review_submitted:!0,pull_request_review_requested:!0,pull_request_review_request_removed:!0,pull_request_closed:!0,pull_request_opened:!0,pull_request_reopened:!0,pull_request_converted_to_draft:!0,pull_request_edited:!0,pull_request_assigned:!0,pull_request_labeled:!0,pull_request_unlabeled:!0},E={pull_request_review_comment_created:!0,issue_comment_created:!0},W={installation_deleted:!0,installation_suspend:!0,installation_unsuspend:!0,...z,...E},q={pull_request_opened:!0,pull_request_review_requested:!0,pull_request_review_submitted:!0,pull_request_closed:!0};N().literals(...(0,S().uv)({pull_request:!0,pull_request_review:!0,pull_request_review_comment:!0,installation:!0,issue_comment:!0})),N().literals(...(0,S().uv)(W)),N().literals(...(0,S().uv)(E));var U=()=>o(569397),L=()=>o(617668),H=()=>o(236262),G=()=>o(901952),$=()=>o(155269),Y=()=>o(113105),J=()=>o(908201),X=()=>o(312296),Z=()=>o(811979),Q=()=>o(399762),ee=()=>o(547149),te=()=>o(497222),oe=()=>o(35091),ne=o(474848);const re=14,ie=(0,y().YK)({autoUpdate:{defaultMessage:"Auto-update",id:"collectionSettingsGithubAutomationConfig.statusPicker.autoUpdate"},when:{defaultMessage:"when PR is",id:"collectionSettingsGithubAutomationConfig.statusPicker.when"},addStatusDescription:{defaultMessage:"Add a status property to set up automations.",id:"collectionSettingsGithubAutomationConfig.addStatusDescription"},addStatusButton:{defaultMessage:"Add status property",id:"collectionSettingsGithubAutomationConfig.statusPicker.addStatusButton"},newStatusPropertyButton:{defaultMessage:"New status",id:"collectionSettingsGithubAutomationConfig.statusPicker.newStatusPropertyButton"},pull_request_opened:{defaultMessage:"Opened",id:"collectionSettingsGithubAutomationConfig.pullRequestOpened"},pull_request_review_requested:{defaultMessage:"Review requested",id:"collectionSettingsGithubAutomationConfig.pullRequestReviewRequested"},pull_request_review_submitted:{defaultMessage:"Approved",id:"collectionSettingsGithubAutomationConfig.pullRequestApproved"},pull_request_closed:{defaultMessage:"Merged",id:"collectionSettingsGithubAutomationConfig.pullRequestMerged"},noAutomations:{defaultMessage:"None",id:"collectionSettingsGithubAutomationConfig.noAutomation"},removeStatusOption:{defaultMessage:"Clear",id:"collectionSettingsGithubAutomationConfig.removeStatusOption"},linkbackAndActivitySectionHeader:{defaultMessage:"Linkbacks & Activity",id:"collectionSettingsGithubAutomationConfig.linkbacksAndActivityHeading"},linkBacksToggle:{defaultMessage:"Linkbacks in GitHub",id:"collectionSettingsGithubAutomationConfig.linkBacksToggle"},linkBacksToggleDescription:{defaultMessage:"Enable linkback comments to the linked page on GitHub",id:"collectionSettingsGithubAutomationConfig.linkBacksToggleDescription"},activityCommentsToggle:{defaultMessage:"Activity Comments",id:"collectionSettingsGithubAutomationConfig.activityCommentsToggle"},activityCommentsToggleDescription:{defaultMessage:"Show GitHub activity as comments on the linked page",id:"collectionSettingsGithubAutomationConfig.activityCommentsToggleDescription"}}),ae={pull_request_opened:w().A.formatMessage(ie.pull_request_opened),pull_request_review_requested:w().A.formatMessage(ie.pull_request_review_requested),pull_request_review_submitted:w().A.formatMessage(ie.pull_request_review_submitted),pull_request_closed:w().A.formatMessage(ie.pull_request_closed)},le=w().A.formatMessage(ie.noAutomations),se={pull_request_opened:null,pull_request_review_requested:null,pull_request_review_submitted:null,pull_request_closed:null},ce={github_linkbacks:!0,activity_comments:!1};function de(e){const{gitHubProperty:t,selectedStatusProperty:o,setSelectedStatusProperty:r,intl:s}=e,c=(0,a().v3)(),d=(0,J().ET)(),p=me(),g=(0,l().K8)((()=>{const e=(0,Y().Jq)(d,t);if(e&&(0,F().UU)(e))return e}),[d,t]),m=(0,l().K8)((()=>{const e=d.normalizedSchemaStore.state;return(0,S().WP)(e).flatMap((([e,t])=>t&&(0,F().DD)(t)?[{id:e,schema:t}]:[]))}),[d.normalizedSchemaStore]),f=(0,l().K8)((()=>g&&(0,F().UU)(g)&&(0,S().O9)(g.connectedRelation.automationSettings)?g.connectedRelation.automationSettings:ce),[g]);(0,n.useEffect)((()=>{C(f)}),[f]),(0,n.useEffect)((()=>{if(!o&&m.length>0){if(null!=g&&g.connectedRelation.automation)for(const t of m)if(g.connectedRelation.automation[t.id])return void r(t);const e=m[0];r(e)}}),[m,g,o,r]);const[h,v]=(0,n.useState)(se),[x,C]=(0,n.useState)(ce),A=(0,n.useCallback)((e=>{const o=d.collectionStore();if(!o||!g||!(0,F().nC)(g))return;const n=g.connectedRelation;n.automationSettings=e;const r={...g,connectedRelation:{...n}};ee().createAndCommit({userAction:"CollectionSettingsConfigureGithubAutomation",environment:c,canUndo:!0,perform:e=>{(0,X().F)({environment:c,collectionStore:o,update:{[t]:r},transaction:e})}}),C(e)}),[d,c,t,g]);(0,n.useEffect)((()=>{var e,t;o&&g&&(0,F().UU)(g)&&null!==(e=g.connectedRelation.automation)&&void 0!==e&&e[o.id]?v(null===(t=g.connectedRelation.automation)||void 0===t?void 0:t[o.id]):v(se)}),[g,o]);const j=(0,n.useCallback)((e=>{const n=d.collectionStore();if(!(n&&o&&g&&(0,F().nC)(g)))return;const r=g.connectedRelation;if(!r||!o.id)return;r.automation={...r.automation,...e};const i={...g,connectedRelation:{...r}};(0,G().V)({environment:c,collectionContextStore:d,property:o.id,from:"github_pull_requests_property",action:"configure_github_pr_automation",githubAutomationConfigured:e}),ee().createAndCommit({userAction:"CollectionSettingsConfigureGithubAutomation",environment:c,canUndo:!0,perform:e=>{(0,X().F)({environment:c,collectionStore:n,update:{[t]:i},transaction:e})}})}),[d,o,g,c,t]),w=(0,n.useMemo)((()=>o&&o.schema.options?o.schema.options:[]),[o]),P=(0,n.useMemo)((()=>{const e={};return w.forEach((t=>{e[t.id]=t})),e}),[w]),_=(0,l().K8)((()=>{var e,t;const n=null==o||null===(e=o.schema)||void 0===e?void 0:e.groups,r=null==o||null===(t=o.schema)||void 0===t?void 0:t.options;return n&&r?n.map((e=>{const t=r.filter((t=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));if(0!==t.length)return{group:e,groupOptions:t}})).filter(S().O9):[]}),[o]);function K(e,t){const n=_.map((({group:t,groupOptions:n})=>{const r=n.map((n=>({key:n.id,render:e=>(0,ne.jsx)(O().A,{...e,focused:e.focused,isTokenTitle:!0,title:(0,ne.jsx)(Q().q,{format:V().NY.Small,value:n.value,color:n.color,showRemoveButton:!1,groupColor:t.color,isSingle:!0})}),action:()=>{const t={...h,[e]:n.id};o&&(j({[o.id]:t}),v(t))}}))).filter(S().O9);return{key:t.name,render:e=>(0,ne.jsx)(u().A,{...e,title:t.name,topBorder:e.index>0}),items:r}}));if(h[e]){function r(){const n={...h,[e]:null};o&&(j({[o.id]:n}),v(n)),t.close()}const i={key:"removeOptionSection",render:e=>(0,ne.jsx)(u().A,{...e,topBorder:!0}),items:[{key:"removeOptionButton",render:e=>(0,ne.jsx)(O().A,{...e,focused:!1,title:s.formatMessage(ie.removeStatusOption),left:(0,ne.jsx)(k().I,{icon:H().trashIcon,size:"xxs"}),onClick:r}),action:e=>{r()}}]};n.push(i)}return n}return(0,ne.jsxs)(ne.Fragment,{children:[o?(0,ne.jsx)(u().A,{topBorder:!1,disableDesktopPadding:!0,disableMobilePadding:!0,title:(0,ne.jsx)(ue,{selectedStatusProperty:o,setSelectedStatusProperty:r,existingStatusProperties:m,intl:s}),children:(0,S().uv)(q).map((e=>(0,ne.jsx)(Z().A,{focused:!1,placementToOrigin:"top",alignmentToOrigin:"end",popupType:i().A.isMobile?M().z.SlideUp:M().z.Popup,render:t=>{const o=i().A.isMobile?{menuType:I().gu.Modal,right:(0,ne.jsx)(y().sA,{...T().W.done}),onClickRight:t.close}:{menuType:I().gu.Popup,width:150};return(0,ne.jsx)(B().A,{...o,children:(0,ne.jsx)(D().A,{type:D().O.Vertical,sections:K(e,t),initialFocus:void 0,onAccept:t.close})})},renderOrigin:t=>{const n=h[e];let r=(0,ne.jsx)("div",{style:p.noneText,children:le});if(n){const e=P[n];if(e){var i;const t=null==o||null===(i=o.schema)||void 0===i||null===(i=i.groups)||void 0===i||null===(i=i.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(n)})))||void 0===i?void 0:i.color;r=(0,ne.jsx)(Q().q,{format:V().NY.Small,showRemoveButton:!1,isSingle:!0,value:e.value,color:e.color,groupColor:t})}}return(0,ne.jsx)(te().A,{...t,focused:!1,icon:()=>(0,ne.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"flex-start",whiteSpace:"nowrap"},children:[ae[e],(0,ne.jsx)(b().A,{size:8}),(0,ne.jsx)(k().I,{icon:U().arrowStraightRightSmallIcon,size:"xs",colorVariant:"tertiary"})]}),title:(0,ne.jsx)("div",{style:{width:"100%",display:"inline-flex",justifyContent:"flex-end"},children:r}),showChevron:!0,chevronStyle:{margin:0}})}},e)))}):(0,ne.jsx)(pe,{setSelectedStatusProperty:r,intl:s}),(0,ne.jsx)(u().A,{topBorder:!0,disableDesktopPadding:!0,disableMobilePadding:!0,title:s.formatMessage(ie.linkbackAndActivitySectionHeader),children:[(0,ne.jsx)(R().m,{renderTooltip:()=>s.formatMessage(ie.linkBacksToggleDescription),render:e=>(0,ne.jsx)(oe().A,{...e,title:s.formatMessage(ie.linkBacksToggle),onClick:()=>{A({...x,github_linkbacks:!x.github_linkbacks})},switcherProps:{on:x.github_linkbacks}})},"github_linkbacks"),(0,ne.jsx)(R().m,{renderTooltip:()=>s.formatMessage(ie.activityCommentsToggleDescription),render:e=>(0,ne.jsx)(oe().A,{...e,title:s.formatMessage(ie.activityCommentsToggle),onClick:()=>{A({...x,activity_comments:!x.activity_comments})},switcherProps:{on:x.activity_comments}})},"activity_comments")]})]})}function pe(e){const{setSelectedStatusProperty:t,intl:o}=e,n=(0,a().v3)(),r=(0,J().ET)(),i=me();return(0,ne.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,ne.jsx)(P().A,{size:"100%",innerStyle:i.addStatusDivider}),(0,ne.jsx)("div",{style:i.addStatusDescription,children:o.formatMessage(ie.addStatusDescription)}),(0,ne.jsx)(_().A,{colorPalette:"blue",iconLeading:L().plusIcon,style:i.addStatusButton,onClick:e=>{e.stopPropagation(),ge(n,r,t)},children:o.formatMessage(ie.addStatusButton)}),(0,ne.jsx)(b().A,{size:4})]})}function ue(e){const{selectedStatusProperty:t,setSelectedStatusProperty:o,existingStatusProperties:n,intl:r}=e,l=(0,a().v3)(),c=(0,J().ET)(),d=me(),p=(0,s().DP)(),g=n.map((e=>{const{id:t,schema:n}=e;return{key:t,action:()=>{o(e)},render:t=>(0,ne.jsx)(O().A,{...t,icon:(0,ne.jsx)(K().zB,{size:re,theme:p,icon:e&&e.schema.icon,type:"status"}),title:n.name})}})).filter(S().O9),m={key:"newStatusProperty",action:()=>{ge(l,c,o)},render:e=>(0,ne.jsx)(O().A,{...e,icon:(0,ne.jsx)(k().I,{icon:L().plusIcon}),title:r.formatMessage(ie.newStatusPropertyButton)})};return(0,ne.jsxs)("div",{style:d.statusPickerWrapper,children:[(0,ne.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[r.formatMessage(ie.autoUpdate),i().A.isMobile?(0,ne.jsx)(b().A,{size:4}):void 0,(0,ne.jsx)(M().A,{placementToOrigin:"bottom",alignmentToOrigin:"start",popupType:i().A.isMobile?M().z.SlideUp:M().z.Popup,renderOrigin:e=>(0,ne.jsx)(O().A,{...e,title:t.schema.name,focused:!1,style:d.statusPickerButtonCore,textWrapperStyle:d.statusPickerButtonTextWrapper,left:(0,ne.jsx)(K().zB,{size:re,theme:p,icon:t.schema.icon,type:"status"}),leftStyle:{marginInlineStart:2},showExtensionArrow:!0,extensionArrowStyle:d.statusPickerExtensionArrow}),render:e=>{const t=i().A.isMobile?{menuType:I().gu.ActionSheet}:{menuType:I().gu.Popup,width:150};return(0,ne.jsx)(B().A,{...t,children:(0,ne.jsx)(D().A,{type:D().O.Vertical,sections:[{key:0,render:e=>(0,ne.jsx)(u().A,{...e}),items:[...g,m]}],initialFocus:0,onAccept:e.close})})}})]}),i().A.isMobile?(0,ne.jsx)(b().A,{size:4}):void 0,r.formatMessage(ie.when)]})}function ge(e,t,o){const n=t.collectionStore();n&&ee().createAndCommit({userAction:"CollectionSettingsConfigureGithubAutomationCreateNewStatusProperty",environment:e,canUndo:!0,perform:r=>{const i=(0,$().createProperty)({environment:e,collectionStore:n,collectionViewArgs:void 0,propertyType:"status",transaction:r}),a=(0,Y().Jq)(t,i);a&&(0,F().DD)(a)&&o({id:i,schema:a})}})}function me(){return(0,s().IS)((()=>({addStatusDivider:{borderColor:f().Tj.border.primary},addStatusDescription:{width:"calc(100% - 24px)",padding:i().A.isMobile?"16px 8px":"14px 0px",fontSize:i().A.isMobile?16:12,color:f().Tj.text.tertiary},addStatusButton:{width:"calc(100% - 24px)",display:"inline-flex",alignItems:"center",justifyContent:"center"},noneText:{color:f().Tj.text.tertiary},automationMenuItemArrow:{width:12,fill:f().Tj.icon.tertiary,stroke:f().Tj.icon.tertiary,strokeOpacity:.5,strokeWidth:2},statusPickerWrapper:{display:"inline-flex",alignItems:"center",flexWrap:"wrap",rowGap:2,marginBottom:i().A.isMobile?10:void 0},statusPickerButtonTextWrapper:{margin:"0px 4px",fontSize:12},statusPickerButtonCore:{minHeight:i().A.isMobile?28:20,borderRadius:5,maxWidth:i().A.isMobile?150:100},statusPickerExtensionArrow:{transform:"rotate(180deg)",marginInlineEnd:2}})),[])}var ye=()=>o(283860);const fe=(0,y().YK)({connect:{defaultMessage:"Connect to GitHub (Workspace)",id:"database.viewSettings.githubConfigTab.connect"},connectDescriptionAdmin:{defaultMessage:"Ask your workspace admin to configure the GitHub (Workspace) connection.",id:"database.viewSettings.githubConfigTab.connectDescriptionAdmin"},authError:{defaultMessage:"Auth failed. Please try again or contact Notion support.",id:"database.viewSettings.githubConfigTab.authError"},tabDescriptionNoIdPrefix:{defaultMessage:"This feature requires a prefixed ID property to link GitHub PRs to Notion {pluralItemName}.",id:"database.viewSettings.githubConfigTab.tabDescriptionNoIdPrefix"},tabDescriptionNoStatus:{defaultMessage:"Link PRs by adding the {singleItemName} ID to the PR title.",id:"database.viewSettings.githubConfigTab.tabDescriptionNoStatus"},tabDescription:{defaultMessage:"Link PRs by adding the {singleItemName} ID to the PR title. Set up automated status updates in Notion based on PR status changes.",id:"database.viewSettings.githubConfigTab.tabDescription"}});function Se(e){const{collectionContextStore:t,property:o}=e,r=(0,y().tz)(),[i,a]=(0,n.useState)(void 0),s=(0,C().uF)({featureName:"collection_connected_property_github"}),d=(0,l().K8)((()=>{const e=c().A.bots.state.find((e=>e.integration_id===g().ob));return Boolean(e)}),[]);return null!=s&&s.isAvailable?d?(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(ve,{collectionContextStore:t}),(0,ne.jsx)(xe,{collectionContextStore:t,intl:r,selectedStatusProperty:i}),(0,ne.jsx)(be,{collectionContextStore:t}),(0,ne.jsx)(Ce,{collectionContextStore:t,selectedStatusProperty:i,setSelectedStatusProperty:a,property:o,intl:r})]}):(0,ne.jsx)(he,{collectionContextStore:t,intl:r}):null}function he({collectionContextStore:e,intl:t}){const o=Te(),{hoveredBackground:n,pressedBackground:i}=we(),s=(0,l().K8)((()=>(0,r().f)(e.collectionStore())),[e]),c=(0,A().J)(s),g=(0,a().v3)(),m=je(),y=null==s?void 0:s.id;return(0,ne.jsxs)(u().A,{disableMobileBorders:!0,mobileStyle:o.previewContentContainer,style:o.previewContentContainer,children:[(0,ne.jsx)("img",{src:"/images/external_integrations/github-icon.png",style:{width:36,height:36}}),(0,ne.jsx)("p",{style:o.connectDescription,children:c?(0,v().Jb)().description:t.formatMessage(fe.connectDescriptionAdmin)}),(0,ne.jsx)(p().p,{style:o.connectButton,hoveredStyle:{background:n},pressedStyle:{background:i},disabled:!c,disabledFeedback:!c,onClick:async e=>{if(e.preventDefault(),y&&m)try{await h().Jq({environment:g,spaceId:y,integration:m,from:"connected_relation_property_menu"})}catch(o){const e=t.formatMessage(fe.authError);d().f1(e)}},children:t.formatMessage(fe.connect)}),(0,ne.jsx)(b().A,{size:4})]})}function ve({collectionContextStore:e}){const t=Te(),o=Ae(e);return(0,ne.jsxs)(u().A,{disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,mobileStyle:t.previewContentContainer,style:t.previewContentContainer,children:[(0,ne.jsx)(b().A,{size:i().A.isMobile?16:8}),(0,ne.jsx)(ye().A,{width:"calc(100% - 24px)",uniqueIdPrefix:null==o?void 0:o.prefix})]})}function xe({collectionContextStore:e,intl:t,selectedStatusProperty:o}){const n=(0,l().K8)((()=>e.databaseTypeFromStoreState),[e]),r=Ae(e),i=Te(),a=(0,x().$O)(n),s=(0,x().oj)(n);let c;return c=r&&r.prefix?o?t.formatMessage(fe.tabDescription,{singleItemName:a}):t.formatMessage(fe.tabDescriptionNoStatus,{singleItemName:a}):t.formatMessage(fe.tabDescriptionNoIdPrefix,{pluralItemName:s}),(0,ne.jsx)(u().A,{disableMobileBorders:!0,disableMobilePadding:!0,mobileStyle:i.tabDescription,style:i.tabDescription,children:c})}function be({collectionContextStore:e}){const t=Ae(e);return t&&t.prefix?null:(0,ne.jsx)(j().A,{collectionContextStore:e,uniqueIdProperty:t&&{property:t.id,propertySchema:t.schema},prefixValue:null==t?void 0:t.prefix})}function Ce({collectionContextStore:e,selectedStatusProperty:t,setSelectedStatusProperty:o,property:n,intl:r}){const i=Ae(e);return i&&i.prefix?(0,ne.jsx)(de,{selectedStatusProperty:t,setSelectedStatusProperty:o,gitHubProperty:n,intl:r}):null}function Ae(e){return(0,l().K8)((()=>{var t,o;const n=null===(t=e.collectionStore())||void 0===t||null===(t=t.getRecordKeyStore())||void 0===t?void 0:t.getRecordKey(),r=null===(o=e.collectionStore())||void 0===o?void 0:o.getSchema(),i=r&&(0,S().WP)(r).find((([,e])=>e&&"auto_increment_id"===e.type));if(i){const[e,t]=i;if(t&&"auto_increment_id"===t.type)return{id:e,schema:t,prefix:n}}}),[e])}function je(){return(0,l().K8)((()=>c().A.integrations.state.find((e=>e.id===g().ob))),[])}function we(){const e=je(),t=(0,s().eP)();return(0,l().K8)((()=>(0,m().u)(e,t)),[e,t])}function Te(){const{background:e}=we();return(0,s().IS)((()=>({previewContentContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},connectButton:{fontSize:14,maxWidth:"calc(100% - 24px)",height:void 0,color:f().Tj.text.inversePrimary,background:e,whiteSpace:"normal",padding:8,textAlign:"center"},connectDescription:{maxWidth:"calc(100% - 24px)",color:f().Tj.text.tertiary,fontSize:14,textAlign:"center"},tabDescription:{padding:i().A.isMobile?18:14,fontSize:i().A.isMobile?16:12,color:f().Tj.text.tertiary}})),[e])}},208698:(e,t,o)=>{o.d(t,{$:()=>s});var n=o(296540),r=()=>o(484714),i=()=>o(69708),a=()=>o(383594),l=()=>o(486666);function s(e){const{iconButton:t,onDelete:o}=e,s=(0,r().v3)(),c=(0,i().tz)();return(0,n.useCallback)((e=>{if(!(t&&e.target instanceof Element))return;const{onSubmit:n,enforceIconColor:r}=t;a().W(s,{originRect:e.target.getBoundingClientRect(),originGap:3,popupHeight:l().GF,popupWidth:l().jv,showArrow:!0,title:c.formatMessage({defaultMessage:"Icon",id:"mediaPicker.tabs.icon"}),currentTab:"icon",tabs:[{type:"icon",enforceIconColor:r,onChange:(e,t)=>{n(e),t&&t.keepVisible||a().I()}}],onDelete:()=>{null==o||o(),n(),a().I()}})}),[s,t,c,o])}},221522:(e,t,o)=>{o.d(t,{A:()=>k});var n=o(296540),r=()=>o(395361),i=()=>o(484714),a=()=>o(590526),l=()=>o(401497),s=()=>o(929219),c=()=>o(792057),d=()=>o(98126),p=()=>o(160432),u=()=>o(302501);const g=new RegExp(`^${o(365541).xs}$`);var m=()=>o(69708);const y=(0,m().YK)({prefixInvalidError:{id:"collectionUniqueIdHelpers.prefixInvalidError",defaultMessage:"The prefix must start with a letter, followed by one or more (up to 9) alphanumeric characters or hyphens."}});var f=()=>o(187174),S=()=>o(617668),h=()=>o(519831),v=()=>o(100622),x=()=>o(284371),b=()=>o(901952),C=()=>o(769864),A=()=>o(155269),j=()=>o(419357),w=()=>o(16006),T=()=>o(547149),M=o(474848);const P=(0,m().YK)({autoIncrementIdPrefixPlaceholder:{defaultMessage:"Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixPlaceholder"},duplicatePrefixNameError:{defaultMessage:"{prefixName} isn’t available for use.",id:"database.viewSettings.propertyTab.duplicatePrefixNameError"}});function k(e){const t=(0,m().tz)(),{uniqueIdProperty:o,prefixValue:d,collectionContextStore:k}=e,_=(0,i().v3)(),R=(0,a().K8)((()=>k.collectionStore()),[k]),[B,O]=(0,n.useState)(d??""),[D,F]=(0,n.useState)(!0),[K,V]=(0,n.useState)(),N=!(0,a().O$)(s().e),z=(0,n.useCallback)((()=>{F(!0),V(void 0)}),[F,V]),E=(0,n.useCallback)((e=>{F(!0),V(t.formatMessage(P.duplicatePrefixNameError,{prefixName:`"${e}"`}))}),[t]),W=(0,n.useCallback)(((e,t,o)=>{const n=o.collectionStore();n&&(F(!1),C().callApi({eventName:"setRecordKey",environment:_,data:{spaceId:n.getSpaceId(),table:n.table,key:e,id:n.id}}).then((n=>{F(!0),200!==n.status?E(e):(0,b().V)({environment:_,collectionContextStore:o,property:t,from:"view_settings",action:"unique_id_change_collection_key"})})).catch((()=>E(e))))}),[_,E]),q=(0,n.useCallback)((async e=>{if(!R)return!1;const t=await C().callApi({eventName:"isRecordKeyAvailable",environment:_,data:{spaceId:R.getSpaceId(),table:R.table,key:e.trim()}});return"success"===t.type&&t.data.isAvailable}),[R,_]),U=(0,r().U)((e=>{q(e).then((t=>{t||E(e),F(!0)})).catch((()=>E(e)))}),500),[L]=(0,f().Yb)((async()=>{if(R)return C().callApi({eventName:"suggestRecordKey",environment:_,data:{spaceId:R.getSpaceId(),table:h().Vl,id:R.id,shouldSetSuccessfullySuggestedRecord:!1}})}),[R,_]);(0,n.useEffect)((()=>{var e;d||"resolved"!==L.status||"success"===(null===(e=L.value)||void 0===e?void 0:e.type)&&L.value.data&&(V(void 0),O(L.value.data.key))}),[d,L]),(0,n.useEffect)((()=>()=>{U.cancel()}),[U]);const H=(0,n.useCallback)((e=>{const o=e.target.value.toUpperCase();var n;O(o),z(),o&&o!==d&&(n=o,g.test(n)||V(t.formatMessage(y.prefixInvalidError)),F(!1),U(o))}),[z,d,U,t]),G=(0,n.useCallback)((()=>{U.flush()}),[U]),$=(0,n.useCallback)((e=>{const t=null==R?void 0:R.getRecordKeyStore();e!==d&&!K&&t&&R&&null!=o&&o.propertySchema?W(e,null==o?void 0:o.property,k):F(!0)}),[R,d,K,o,W,k]),Y=(0,n.useCallback)((()=>{const e=k.collectionStore();e&&T().createAndCommit({userAction:"CollectionSettingsAutoIncrementIdPropertyCreateNewIdProperty",environment:_,canUndo:!0,perform:t=>{const o=(0,A().createProperty)({environment:_,collectionStore:e,collectionViewArgs:void 0,propertyType:"auto_increment_id",transaction:t});W(B,o,k)}})}),[k,_,B,W]),J=(0,n.useCallback)((e=>{if(!R)return;const t=[{label:(0,M.jsx)(m().sA,{id:"database.viewSettings.propertyTab.autoIncrementIdPrefixSubmit",defaultMessage:"Update ID Prefix"}),color:"red",onAccept:()=>$(e)}];c().ui({message:(0,M.jsx)("span",{children:(0,M.jsx)(m().sA,{id:"database.viewSettings.propertyTab.changePrefixConfirmationMessage",defaultMessage:"Updating the prefix will stop 3rd party automations that rely on this ID (e.g., GitHub PR status automation).",values:{databaseName:(0,M.jsx)(w().A,{style:{display:"inline",fontWeight:x().Wy.medium},shouldWrap:!0,store:R})}})}),showCancel:!0,keepFocus:!0,items:t})}),[R,$]),X=(0,n.useCallback)((e=>{d?J(e):$(e)}),[d,$,J]),Z=(0,n.useCallback)((()=>o?o&&!d?(0,M.jsx)(m().sA,{defaultMessage:"Add ID prefix",id:"database.viewSettings.propertyTab.autoIncrementIdCreatePrefix"}):(0,M.jsx)(m().sA,{defaultMessage:"Update ID Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixSubmit"}):(0,M.jsx)(m().sA,{defaultMessage:"Add ID property",id:"database.viewSettings.propertyTab.autoIncrementIdCreateProperty"})),[d,o]),Q=(0,l().IS)((()=>({prefixInputOuterStyle:{color:void 0===d?v().Tj.text.tertiary:v().Tj.text.primary},actionButton:{display:"flex",justifyContent:"center",marginTop:8,padding:8},subtext:{paddingInlineStart:8}})),[d]);return(0,M.jsxs)(M.Fragment,{children:[N?void 0:(0,M.jsx)(j().Ay,{left:(0,M.jsx)(u().A,{children:(0,M.jsx)(m().sA,{defaultMessage:"Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefix"})}),value:B,inputOuterStyle:Q.prefixInputOuterStyle,style:{gap:18},onChange:H,onBlur:G,placeholder:P.autoIncrementIdPrefixPlaceholder.defaultMessage,onSubmit:()=>X(B.trim()),focusInitial:!1,selectAll:!1,disabled:!1}),(0,M.jsx)("div",{style:Q.subtext,children:K||!D?(0,M.jsx)(I,{prefixName:B,hasRequestCompleted:D,errorMessage:K}):N?(0,M.jsx)(u().A,{isSmall:!0,isSecondaryColor:!0,style:{marginTop:16,marginInlineStart:16},children:(0,M.jsx)(m().sA,{defaultMessage:"Prefix is not available offline.",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixOffline"})}):(0,M.jsx)(u().A,{isSmall:!0,isSecondaryColor:!0,children:(0,M.jsx)(m().sA,{defaultMessage:"{prefixWithHyphen}1, {prefixWithHyphen}2, {prefixWithHyphen}3, ...",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixPreview",values:{prefixWithHyphen:B?`${B}-`:""}})})}),(0,M.jsx)("div",{style:Q.actionButton,children:(0,M.jsx)(p().A,{colorPalette:"blue",size:"md",iconLeading:!o||o&&!d?S().plusIcon:void 0,style:{width:"100%"},onClick:()=>{o?X(B.trim()):Y()},disabled:B===d||Boolean(K)||!D||N,children:Z()})})]})}function I(e){const{errorMessage:t,hasRequestCompleted:o}=e;return(0,M.jsx)(u().A,{isMultiline:!0,style:{...o?{color:v().oZ.red}:{}},isSecondaryColor:!o,children:o&&t?t:(0,M.jsx)("div",{style:{paddingTop:3,paddingBottom:3},children:(0,M.jsx)(d().A,{legacySize:14})})})}},263527:(e,t,o)=>{o.d(t,{a:()=>s});o(944114);var n=()=>o(295633),r=()=>o(732810),i=()=>o(569797),a=()=>o(534177),l=()=>o(896628);function s(e){const{formatStore:t,formatKey:o,property:s,update:c,transaction:d}=e,p=[...t.getFormat()[o]||[]],u=p.findIndex((e=>e.property===s));-1!==u?p[u]={...p[u],...c}:p.push({property:s,...c}),l().zA({stores:t instanceof n().B||t instanceof r().m||t instanceof i().p?[t]:(0,a().HB)(t),update:{[o]:p},transaction:d})}},283860:(e,t,o)=>{o.d(t,{A:()=>p});o(296540);var n=()=>o(726637),r=()=>o(401497),i=()=>o(148307),a=()=>o(69708),l=()=>o(100622),s=()=>o(284371),c=()=>o(132389),d=o(474848);function p(e){const t=(0,a().tz)(),o=function(e){const t=n().A.isMobile?18:14,o=1,i=6,a=20,c=(0,r().eP)();return(0,r().IS)((()=>({githubContainer:{display:"flex",alignSelf:"center",flexDirection:"column",width:e||"90%",padding:a,border:`${o}px solid ${l().Tj.border.primary}`,borderRadius:i,borderEndEndRadius:6,cursor:"default"},githubPrTitleRow:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",width:`calc(100% + ${a}px)`,overflow:"hidden"},githubPrTitle:{display:"inline-flex",fontSize:t,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",background:l().Tj.whiteButtonBackground,padding:"2px 4px",borderStartStartRadius:5,borderEndStartRadius:5,borderInlineStart:`2px solid ${l().Tj.blue.border.accentPrimary}`,borderTop:`2px solid ${l().Tj.blue.border.accentPrimary}`,borderBottom:`2px solid ${l().Tj.blue.border.accentPrimary}`,width:"100%"},githubTask:{background:"light"===c?l().Tj.palette.blue[50]:l().Tj.palette.blue[400]},githubPrInfoRow:{display:"inline-flex"},githubPrInfoPill:{display:"flex",flexDirection:"row",alignItems:"center",width:"fit-content",padding:"4px 10px",borderRadius:"2em",background:"#238636",flexShrink:0,...s().RC},githubPrInfoOpenText:{color:"white",fontSize:t-2,fontWeight:500},githubPrInfoMergeInto:{display:"inline-flex",alignItems:"center",fontSize:t-2,color:l().Tj.text.tertiary,...s().RC},githubPrInfoMain:{padding:"0px 4px",fontFamily:s().Tf.githubMono,background:l().Tj.cardPressedBackground,borderRadius:i,color:l().Tj.text.primary,verticalAlign:"text-bottom",...s().RC}})),[t,e,c])}(e.width),p=(0,d.jsx)("div",{id:"github-preview-github-pr-title-row",style:o.githubPrTitleRow,children:(0,d.jsxs)("div",{id:"github-preview-github-pr-title-wrapper",style:o.githubPrTitle,children:[(0,d.jsx)(c().A,{size:2}),"[",(0,d.jsxs)("div",{id:"github-preview-github-pr-task",style:o.githubTask,children:[e.uniqueIdPrefix||t.formatMessage(u.idPrefix),e.uniqueIdValue?`-${e.uniqueIdValue}`:"-1"]}),"]",(0,d.jsx)(c().A,{size:2}),t.formatMessage(u.prTitle)]})}),g=(0,d.jsxs)("div",{id:"github-preview-github-pr-info-row",style:o.githubPrInfoRow,children:[(0,d.jsxs)("div",{id:"github-preview-github-open-pr-pill",style:o.githubPrInfoPill,children:[(0,d.jsx)("img",{src:i().A.images.externalIntegrations.githubPullOpenIconWhitePng,style:{width:16,height:16}}),(0,d.jsx)(c().A,{size:2}),(0,d.jsx)("div",{style:o.githubPrInfoOpenText,children:t.formatMessage(u.open)})]}),(0,d.jsx)(c().A,{size:8}),(0,d.jsx)("div",{id:"github-preview-github-merge-into-main",style:o.githubPrInfoMergeInto,children:(0,d.jsxs)("span",{style:o.githubPrInfoMergeInto,children:[t.formatMessage(u.mergeInto),(0,d.jsx)(c().A,{size:4}),(0,d.jsx)("span",{style:o.githubPrInfoMain,children:t.formatMessage(u.main)})]})})]});return(0,d.jsxs)("div",{id:"github-preview-github-container",style:o.githubContainer,children:[p,(0,d.jsx)(c().A,{size:12}),g]})}const u=(0,a().YK)({idPrefix:{defaultMessage:"TASK",id:"database.viewSettings.githubConfigTab.preview.idPrefix"},prTitle:{defaultMessage:"GitHub PR Title",id:"database.viewSettings.githubConfigTab.preview.prTitle"},open:{defaultMessage:"Open",id:"database.viewSettings.githubConfigTab.preview.open"},mergeInto:{defaultMessage:"Merge into",id:"database.viewSettings.githubConfigTab.preview.mergeInto"},main:{defaultMessage:"main",id:"database.viewSettings.githubConfigTab.preview.main"}})},332724:(e,t,o)=>{o.d(t,{W:()=>s});var n=()=>o(907258),r=()=>o(484714),i=()=>o(590526),a=()=>o(712505),l=()=>o(207214);function s(e){const{omitCurrentPage:t,includeCurrentPageId:o=!1}=e,s=(0,r().v3)(),c=(0,l().L)(s);return(0,i().K8)((()=>{const{sidebarSpaceStore:e,currentUserStore:r,sidebarSpaceViewStore:i,mainEditorCurrentBlockStore:l}=n().default.state;if(e&&r&&i)return{spaceStore:e,userStore:r,spaceViewStore:i,blockStore:t?void 0:l,peekStore:a().default.state.open?a().default.state.targetStore:void 0,workflowStore:c,currentPageId:!t&&o?null==l?void 0:l.id:void 0}}),[c,t,o])}},358993:(e,t,o)=>{o.d(t,{K$:()=>b,XA:()=>C});o(16280),o(410838),o(944114),o(898992),o(354520),o(672577),o(737550);var n=()=>o(799288),r=()=>o(728272),i=()=>o(234459),a=()=>o(201980),l=()=>o(534177),s=()=>o(910302),c=()=>o(354785),d=()=>o(680514),p=()=>o(29554),u=()=>o(594794),g=()=>o(77246),m=()=>o(547149),y=()=>o(687879),f=()=>o(791256),S=()=>o(555102),h=()=>o(57685),v=()=>o(140992),x=()=>o(65824);function b(e){const{mentions:t,threadStore:o,clientStore:n,environment:r,spaceStore:a}=e,{chatThreadStore:l}=function(e){const{threadStore:t,clientStore:o,environment:n,spaceId:r,threadId:a}=e;if(t)return{chatThreadStore:o.getOrCreateClientAIChatThreadStore(t.id),isNewThread:!1};const l=a??(0,u().Z1)({environment:n,table:i().To,spaceId:r});return{chatThreadStore:o.getOrCreateClientAIChatThreadStore(l),isNewThread:!0}}({threadStore:o,clientStore:n,environment:r,spaceId:a.id});l.setState({...l.state,stagedData:{...l.state.stagedData,mentionStagedData:t}})}async function C(e){const{agentChatIntegrations:t,aiChatFeatureController:o,args:i,clientStore:u,environment:b,hasAgentIntegrationsFeatureFlag:C,mainEditorCurrentBlockStore:A,peekViewBlockStore:j,inferenceContext:w,sourceIdForEventCorrelation:T,threadStore:M,parentPointer:P,invokedFromBlockId:k,temporaryAiThreadManager:I,sendPartialTranscript:_,sendPatchResponse:R,inputSurfaceOverride:B}=e,{prompt:O,config:D,prebuiltPrompt:F}=i,{promptWithoutSelectionContextTokens:K,hasSelectionContextTokens:V}=function(e){if(!e||0===e.length)return{promptWithoutSelectionContextTokens:e,hasSelectionContextTokens:!1};let t=!1;const o=a().RQ(e).filter((e=>!a().qXl(e)||(!a().uoE(a().uPN(e))||(t=!0,!1))));return{promptWithoutSelectionContextTokens:o.length>0?a().bBR(o):void 0,hasSelectionContextTokens:t}}(O),N=(null==F?void 0:F.displayText)??K;let z,E=M,W=!1;if(!w)throw new Error("No inference context");const{spaceStore:q,userStore:U,spaceViewStore:L}=w;if(!q)throw new Error("No space store");if(E){const e=(0,d().xX)({threadStore:E,environment:b,spaceStore:q,userStore:U});e&&e!==E&&(E=e,W=!0)}const H=(0,g().vE)([A,j].filter(l().O9));H&&s().DL({pageStore:H,environment:b,triggeredFrom:"agent"}),u.setState({...u.state,userSelectedConfig:!0}),function(e){const{environment:t,threadStore:o}=e;if(!o)return;const n=o.getTranscript().find((e=>"search"===e.type));n&&void 0===n.showResults&&(0,x().V)({environment:t,threadStore:o,stepId:n.id,traceId:n.traceId,showResults:!1})}({environment:b,threadStore:E});const G=I.getOrCreateThreadId({environment:b,spaceId:q.id,maybeThreadStore:E}),$=u.getOrCreateClientAIChatThreadStore(G);e.localMentions&&e.localMentions.size()>0&&!E&&$.setState({...$.state,stagedData:{...$.state.stagedData,mentionStagedData:e.localMentions}});const{preUserSteps:Y,stagedMentionStep:J,stagedAttachmentSteps:X}=function(e){const{chatThreadStore:t,environment:o,spaceId:n,selectedBlockStores:r=[],textSelection:i}=e,a=[],l=t.getStagedMentionPointers(),s=(0,S().BX)({environment:o,spaceId:n,pointers:l,selectedBlockStores:r,textSelection:i});s&&a.push(s);const c=t.getAndClearStagedAssistantAttachmentSteps();return c&&c.length&&a.push(...c),{preUserSteps:a,stagedMentionStep:s,stagedAttachmentSteps:c}}({chatThreadStore:$,environment:b,spaceId:q.id,selectedBlockStores:V?void 0:e.selectedBlockStores,textSelection:V?void 0:e.textSelection}),Z=X&&X.length>0;if(!(void 0!==N&&!(0,a().w9s)(N))&&!Z)return{didSubmit:!1,threadStore:E,didChangeThread:W};const Q=F?(0,S().Jv)({environment:b,spaceStore:q,userStore:U,value:F.displayText,locale:F.locale,promptType:F.type,args:F.args}):(0,S().Kf)({environment:b,spaceStore:q,userStore:U,value:O});if(E){const t=await async function(e){const{threadStore:t,environment:o,clientStore:i,inferenceSpaceStore:l,userStore:s,preUserSteps:c,userStep:d,chatThreadStore:p,clearLocalMentions:u,sendPatchResponse:g}=e;if(!(0,h().T)(t))return!1;const y=[...c,d],{serverCommitResult:f}=m().createAndCommit({userAction:"unifiedChatInputActions.persistMultiplayerThreadMessage",environment:o,canUndo:!1,perform:e=>{(0,v().Vn)({environment:o,spaceStore:l,threadStore:t,userStore:s,addSteps:y,transaction:e}),(0,v().Mi)({threadStore:t,transaction:e,updatedById:s.id,updatedByTable:"notion_user"})}});return a().jgW(d.value).some(n().ut)&&(await f,await(0,v().WE)({environment:o,clientStore:i,threadStore:t,sendPatchResponse:g,stepIdsToInclude:[d.id]})),p.setState({...p.state,stagedData:{...p.state.stagedData,mentionStagedData:new(r().d)}}),u&&u(),!0}({threadStore:E,environment:b,clientStore:u,inferenceSpaceStore:q,userStore:U,preUserSteps:Y,userStep:Q,chatThreadStore:$,clearLocalMentions:e.clearLocalMentions,sendPatchResponse:e.sendPatchResponse});if(t)return{didSubmit:!0,threadStore:E,didChangeThread:W}}if(!E||(0,f().av)(E)||void 0===E){const e=(0,f().hw)({config:D,hasAgentIntegrationsFeatureFlag:C})?await(0,f().oE)({agentChatIntegrations:t,environment:b,spaceStore:q,spaceViewStore:L}):void 0,n=(0,S().Xd)({environment:b,inferenceContext:w,config:D,addSteps:[e,...Y,Q],surface:B??o.contextStepSurface,invokedFromBlockId:k});let r;r=E?(0,y().addStepsToExistingThreadAndRun)({environment:b,clientStore:u,spaceStore:q,userStore:U,threadStore:E,addSteps:n,waitForServerCommit:!0,sendPartialTranscript:_,sendPatchResponse:R,temporaryAiThreadManager:I}):(0,y().addTranscriptToNewThreadAndRun)({environment:b,spaceStore:q,transcript:n,parentPointer:P,threadId:G}),W=!0,z=r,function(e){const{config:t,prompt:o,spaceStore:n,threadStore:r,environment:i,sourceEventId:a,suggestedQuery:l,attachmentCount:s=0}=e;if("researcher"!==t.type)return;const d=(0,p().r4)(o,n);c().uH({environment:i,researchModeThreadId:r.id,queryLength:d.length,queryWords:d.split(/\s+/).filter(Boolean).length,source:"welcome_page",searchSessionId:void 0,qnaSessionId:void 0,sourceEventId:a,suggestedQuery:l,attachmentCount:s})}({config:D,prompt:N,spaceStore:q,threadStore:r,environment:b,sourceEventId:T,suggestedQuery:!1,attachmentCount:(null==X?void 0:X.length)??0})}else{var ee,te;(0,v().kh)({threadStore:E,config:D,environment:b});const e=[],t=E.getTranscript().findLast((e=>"context"===e.type)),n=(null==t?void 0:t.value.collectionViewBlockId)??(null==t?void 0:t.value.blockId),r=null==t?void 0:t.value.peekBlockId;n===(null===(ee=w.blockStore)||void 0===ee?void 0:ee.id)&&r===(null===(te=w.peekStore)||void 0===te?void 0:te.id)||e.push((0,S().WM)({environment:b,inferenceContext:w,surface:B??o.contextStepSurface,config:D,invokedFromBlockId:k}));const i=L.getSettings(),a=null==i?void 0:i.agent_personalization_settings;(null==t?void 0:t.value.context_page_id)!==(null==a?void 0:a.context_page_id)&&e.push((0,S().WM)({environment:b,inferenceContext:w,surface:B??o.contextStepSurface,config:D,invokedFromBlockId:k})),null!=X&&X.length&&e.push(...X),J&&e.push(J),e.push(Q),(0,y().addStepsToExistingThreadAndRun)({environment:b,clientStore:u,spaceStore:q,userStore:U,threadStore:E,addSteps:e,waitForServerCommit:!0,sendPartialTranscript:_,sendPatchResponse:R,temporaryAiThreadManager:I}),m().createAndCommit({userAction:"unifiedChatInputActions.updateThreadUpdatedTime",environment:b,canUndo:!1,perform:e=>{(0,v().Mi)({threadStore:E,transaction:e,updatedById:U.id,updatedByTable:"notion_user"})}}),z=E}if($.setState({...$.state,stagedData:{...$.state.stagedData,mentionStagedData:new(r().d)}}),e.clearLocalMentions&&e.clearLocalMentions(),!z)throw new Error("Expected a thread store after submitting");return{didSubmit:!0,threadStore:z,didChangeThread:W}}},362683:(e,t,o)=>{o.r(t),o.d(t,{RollupPropertyMenu:()=>H});o(944114),o(898992),o(354520),o(803949);var n=o(296540),r=()=>o(59226),i=()=>o(726637),a=()=>o(383036),l=()=>o(484714),s=()=>o(590526),c=()=>o(732810),d=()=>o(245720),p=()=>o(127833),u=()=>o(250910),g=()=>o(118307),m=()=>o(807449),y=()=>o(546926),f=()=>o(26697),S=()=>o(890492),h=()=>o(81068),v=()=>o(663639),x=()=>o(736847),b=()=>o(952882),C=()=>o(67657),A=()=>o(898244),j=()=>o(713998),w=()=>o(568063),T=()=>o(324254),M=()=>o(955363),P=()=>o(688311),k=()=>o(585639),I=()=>o(69708),_=()=>o(100622),R=()=>o(496603),B=()=>o(534177),O=()=>o(314529);function D(e,t){(0,O().DO_NOT_USE_trackLegacy)(e,"configure_rollup_target_property",t)}var F=()=>o(680341),K=()=>o(422164),V=()=>o(314638),N=()=>o(787815),z=()=>o(497222),E=()=>o(908201),W=()=>o(525955),q=()=>o(390650),U=()=>o(981342),L=o(474848);function H({context:e,schema:t,property:o,parentStore:n,onDismiss:l,disabled:m,analyticsFrom:h,onChange:x}){const b=(0,s().uB)(void 0,g().A),C=(0,s().uB)(void 0,g().A),T=(0,s().uB)(void 0,g().A),B=(0,r().X)("rollup_on_person_property"),O=(0,U().o7)(),D=(0,s().K8)((()=>function({schema:e,property:t,parentStore:o,PeopleCollectionStore:n}){const r=e[t];if(!r)return;let i,a,l,s={};if("person"===r.rollup_type&&r.person_property){const t=e[r.person_property];if("person"===(null==t?void 0:t.type)&&(i=t),n&&(a=n,s=(0,w().U$)(A().Dp(n.getModel()))),r.target_property)if((0,w().cl)(r.target_property))l=(0,w().dk)(r.target_property);else if(s&&Object.keys(s).length>0){var d;l=s[(null===(d=a)||void 0===d?void 0:d.getMappedProperty(r.target_property))??r.target_property]}}else if(r.relation_property){const t=e[r.relation_property];if("relation"===(null==t?void 0:t.type)){var p;i=t;const e=A().Nv(t);a=e?c().m.createChildStore(o,e):void 0,s=A().Dp(null===(p=a)||void 0===p?void 0:p.getModel())}if(a&&r.target_property){var u;l=s[(null===(u=a)||void 0===u?void 0:u.getMappedProperty(r.target_property))??r.target_property]}}return{propertySchema:r,sourcePropertySchema:i,relatedCollectionStore:a,relatedCollectionSchema:s,targetPropertySchema:l}}({schema:t,property:o,parentStore:n,PeopleCollectionStore:O})),[t,o,n,O]),F=Boolean((null==D?void 0:D.propertySchema)&&(null==D?void 0:D.targetPropertySchema)&&(0,j().rl)(D.propertySchema,t)),V=Boolean((null==D?void 0:D.propertySchema.relation_property)||(null==D?void 0:D.propertySchema.person_property)),N=Boolean(V&&(null==D?void 0:D.propertySchema.target_property)),E=(0,s().K8)((()=>R().oE([Q({disabled:m||F,sourcePropertySchema:null==D?void 0:D.sourcePropertySchema,analyticsFrom:h,relationButtonPopupStore:T,canSelectPersonProperty:B,onChange:x,schema:t,property:o}),te({isEnabled:V,disabled:m||F,renderState:D,analyticsFrom:h,targetPropertyButtonPopupStore:C,onChange:x,schema:t,property:o,parentStore:n}),ne({isEnabled:N,disabled:m,renderState:D,analyticsFrom:h,aggregationButtonPopupStore:b,onChange:x,schema:t,property:o})])),[m,F,D,h,T,B,x,t,o,V,C,n,N,b]),W=(0,s().K8)((()=>b.state.open),[b]),q=(0,s().K8)((()=>T.state.open),[T]),H=(0,s().K8)((()=>C.state.open),[C]);if(!D)return null;if("bpvOverlay"===e){let e;return e=i().A.isMobile?{menuType:y().gu.Modal,title:D.propertySchema.name,right:(0,L.jsx)(I().sA,{...d().W.done}),onClickRight:l}:{menuType:y().gu.Popup},(0,L.jsx)(S().A,{...e,children:(0,L.jsx)(v().A,{type:v().O.Vertical,initialFocus:void 0,sections:E})})}return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(u().A,{popupType:i().A.isMobile?p().nl.BottomSheet:p().nl.Popup,alignmentToOrigin:"end",renderOrigin:e=>(0,L.jsx)(z().A,{icon:M().arrowDiagonalUpRightIcon,title:B?(0,L.jsx)(I().sA,{defaultMessage:"Source property",id:"database.viewSettings.rollupOptions.sourceProperty"}):(0,L.jsx)(I().sA,{defaultMessage:"Relation",id:"database.viewSettings.rollupOptions.relationProperty"}),disabled:m||F,showChevron:!0,rotateChevron:q,desktopTitleStyle:{flexShrink:0},rightStyle:{flexShrink:void 0},right:D.sourcePropertySchema?(0,L.jsx)(K().mA,{propertySchema:D.sourcePropertySchema,showIcon:!0}):(0,L.jsx)(I().sA,{id:"database.viewSettings.rollupOptions.selectRelation",defaultMessage:"Select"}),...e}),render:e=>(0,L.jsx)(Z,{parent:e,analyticsFrom:h,schema:t,property:o,onChange:x,canSelectPersonProperty:B}),buttonPopupStore:T}),(0,L.jsx)(f().m,{renderTooltip:()=>(0,L.jsx)($,{}),disableTooltip:V,render:e=>(0,L.jsx)(u().A,{popupType:i().A.isMobile?p().nl.BottomSheet:p().nl.Popup,alignmentToOrigin:"end",renderOrigin:t=>(0,L.jsx)(z().A,{icon:P().h,title:(0,L.jsx)("span",{style:{...!V&&{color:_().Tj.text.secondary}},children:(0,L.jsx)(I().sA,{id:"database.viewSettings.rollupOptions.targetProperty",defaultMessage:"Target property"})}),disabled:!V||m||F,showChevron:!0,rotateChevron:H,desktopTitleStyle:{flexShrink:0},rightStyle:{flexShrink:void 0},right:V&&D.targetPropertySchema?(0,L.jsx)(K().mA,{propertySchema:D.targetPropertySchema,showIcon:!0}):(0,L.jsx)(I().sA,{id:"database.viewSettings.rollupOptions.selectTargetProperty",defaultMessage:"Select"}),...(0,a().A)(e,t)}),render:e=>(0,L.jsx)(ee,{parent:e,analyticsFrom:h,schema:t,property:o,parentStore:n,onChange:x,renderState:D}),buttonPopupStore:C})}),(0,L.jsx)(f().m,{renderTooltip:()=>(0,L.jsx)(Y,{}),disableTooltip:N,render:e=>(0,L.jsx)(u().A,{popupType:i().A.isMobile?p().nl.BottomSheet:p().nl.Popup,alignmentToOrigin:"end",renderOrigin:t=>(0,L.jsx)(z().A,{icon:k().v,disabled:!N||m,title:(0,L.jsx)("span",{style:{...!N&&{color:_().Tj.text.secondary}},children:(0,L.jsx)(I().sA,{defaultMessage:"Calculate",id:"database.viewSettings.rollupOptions.calculate"})}),showChevron:!0,rotateChevron:W,desktopTitleStyle:{flexShrink:0},rightStyle:{flexShrink:void 0},right:N&&(0,L.jsx)(G,{renderState:D}),...(0,a().A)(e,t)}),render:e=>(0,L.jsx)(oe,{parent:e,analyticsFrom:h,onChange:x,renderState:D}),buttonPopupStore:b})})]})}function G({renderState:e}){return e?e.propertySchema.aggregation?(0,L.jsx)(L.Fragment,{children:W().zY[(0,C().ZP)(e.propertySchema.aggregation)]}):"person"===e.propertySchema.rollup_type&&(0,B().Xk)(w().$J,e.propertySchema.target_property)?(0,L.jsx)(I().sA,{id:"database.rollupProperty.aggregate.showValues",defaultMessage:"Show values"}):(0,L.jsx)(I().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}):null}function $(){return(0,L.jsx)(I().sA,{id:"database.rollupProperty.editProperty.tooltip",defaultMessage:"Select an existing relation first."})}function Y(){return(0,L.jsx)(I().sA,{id:"database.rollupProperty.editAggregate.tooltip",defaultMessage:"Select an existing relation and property first."})}function J(e){return e?void 0:(0,L.jsx)(m().I,{icon:T().arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"secondary"})}function X(e,t,o,n,r,i,a){const l=n[r],s=n[e];if(!l||!s||"relation"!==s.type&&"person"!==s.type)return;let c;"person"===s.type?c={...l,rollup_type:"person",person_property:e,relation_property:void 0,target_property:b().Ym,target_property_type:"text",aggregation:void 0}:(c={...l,rollup_type:"relation",relation_property:e,person_property:void 0,target_property:"title",target_property_type:"title",aggregation:void 0},function(e,t){(0,O().DO_NOT_USE_trackLegacy)(e,"configure_rollup_relation",t)}(t,{...(0,q().sl)(a),from:o})),null==i||i({propertySchema:c})}function Z({parent:e,analyticsFrom:t,schema:o,property:r,onChange:i,canSelectPersonProperty:a}){const s=(0,l().v3)(),c=(0,n.useCallback)((e=>X(e,s,t,o,r,i)),[s,t,o,r,i]),d=(0,n.useCallback)((e=>function(e,t){return Boolean("relation"===e.type||"person"===e.type&&t)}(e,a)),[a]);return(0,L.jsx)(N().A,{schema:o,isRelationProperty:!1,onAccept:c,onClose:e.close,allowProperty:d})}function Q({disabled:e,sourcePropertySchema:t,analyticsFrom:o,relationButtonPopupStore:n,canSelectPersonProperty:r,onChange:l,schema:s,property:c}){if(c&&s)return{key:0,render:e=>(0,L.jsx)(x().A,{...e,title:r?(0,L.jsx)(I().sA,{defaultMessage:"Source property",id:"database.viewSettings.rollupOptions.sourceProperty"}):(0,L.jsx)(I().sA,{defaultMessage:"Relation",id:"database.viewSettings.rollupOptions.relationProperty"})}),items:[{key:0,render:d=>(0,L.jsx)(u().A,{popupType:i().A.isMobile?p().nl.BottomSheet:p().nl.Popup,renderOrigin:o=>t?(0,L.jsx)(V().G,{...(0,a().A)(d,o),propertySchema:t,format:V().e.Name,right:J(e),disabled:e}):(0,L.jsx)(h().A,{...(0,a().A)(d,o),title:r?(0,L.jsx)(I().sA,{id:"database.rollupProperty.editSourceProperty.buttonTitle",defaultMessage:"Select a source property…"}):(0,L.jsx)(I().sA,{id:"database.rollupProperty.editRelation.buttonTitle",defaultMessage:"Select an existing relation…"}),right:J(e),style:{color:_().Tj.text.secondary},disabled:e}),render:e=>(0,L.jsx)(Z,{parent:e,analyticsFrom:o,schema:s,property:c,onChange:l,canSelectPersonProperty:r}),buttonPopupStore:n},d.key),action:()=>{n.setState({open:!0})}}]}}function ee({parent:e,analyticsFrom:t,schema:o,property:r,parentStore:i,onChange:a,renderState:s}){const c=(0,l().v3)(),d=(0,E().ET)(),p=(0,I().tz)(),u=(0,n.useCallback)((o=>{!function(e,t,o,n,r,i,a,l,s){if(!a||!a.propertySchema)return;const{propertySchema:c}=a;let d,p;if("person"===c.rollup_type){if((0,B().Xk)(w().$J,e))p=(0,w().dk)(e).type,d={...c,target_property:e,target_property_type:p,aggregation:void 0};else if(a.relatedCollectionSchema){const n=a.relatedCollectionSchema[e];n&&(p=n.type,d={...c,target_property:e,target_property_type:p,aggregation:void 0},D(t,{...(0,q().sl)(s),from:o,property_type:p}))}}else if("relation"===c.rollup_type||void 0===c.rollup_type){const n=a.relatedCollectionSchema[e];n&&(p=n.type,d={...c,target_property:e,target_property_type:n.type,aggregation:void 0},D(t,{...(0,q().sl)(s),from:o,property_type:n.type}))}d&&p&&(null==l||l({propertySchema:d}))}(o,c,t,0,0,0,s,a,d),e.close()}),[t,c,o,r,i,a,e,d,s]);if(!s)return null;if("person"===s.propertySchema.rollup_type){const e=[];return w().$J.forEach((t=>{e.push({key:`person_system_${t}`,render:e=>(0,L.jsx)(V().G,{...e,propertySchema:(0,w().dk)(t,p),format:V().e.Name}),action:()=>u(t)})})),s.relatedCollectionSchema&&Object.keys(s.relatedCollectionSchema).length>0&&Object.entries(s.relatedCollectionSchema).filter((([e,t])=>{if(!t)return!1;return"formula"!==t.type&&"rollup"!==t.type&&!(0,A().rK)(t.type)})).forEach((([t,o])=>{e.push({key:`people_collection_${t}`,render:e=>(0,L.jsx)(V().G,{...e,propertySchema:o,format:V().e.Name}),action:()=>u(t)})})),0===e.length?null:(0,L.jsx)(S().A,{menuType:y().gu.Popup,children:(0,L.jsx)(v().A,{type:v().O.Vertical,sections:[{key:"target_properties",items:e,render:e=>(0,L.jsx)(x().A,{...e})}],initialFocus:void 0})})}return!s.relatedCollectionSchema||"relation"!==s.propertySchema.rollup_type&&void 0!==s.propertySchema.rollup_type?null:(0,L.jsx)(N().A,{schema:s.relatedCollectionSchema,isRelationProperty:!1,onAccept:u,allowProperty:e=>"rollup"!==e.type&&!(0,A().rK)(e.type),onClose:e.close})}function te({isEnabled:e,disabled:t,renderState:o,analyticsFrom:n,targetPropertyButtonPopupStore:r,onChange:l,schema:s,property:c,parentStore:d}){if(o&&o.propertySchema&&s&&c&&d)return{key:1,render:e=>(0,L.jsx)(x().A,{...e,title:(0,L.jsx)(I().sA,{id:"database.rollupProperty.editProperty.title",defaultMessage:"Property"}),topBorder:!0}),items:[{key:0,render:g=>(0,L.jsx)(f().m,{renderTooltip:()=>(0,L.jsx)($,{}),disableTooltip:e,render:m=>(0,L.jsx)(u().A,{popupType:i().A.isMobile?p().nl.BottomSheet:p().nl.Popup,renderOrigin:n=>o.targetPropertySchema?(0,L.jsx)(V().G,{...g,propertySchema:o.targetPropertySchema,format:V().e.Name,right:J(!e||t),disabled:!e||t,disabledFeedback:!0}):(0,L.jsx)(h().A,{...g,...(0,a().A)(m,n),title:(0,L.jsx)(I().sA,{id:"database.rollupProperty.editProperty.buttonTitle",defaultMessage:"Select a property…"}),right:J(!e||t),disabled:!e||t,disabledFeedback:!0}),render:e=>(0,L.jsx)(ee,{parent:e,analyticsFrom:n,schema:s,property:c,parentStore:d,onChange:l,renderState:o}),buttonPopupStore:r})},g.key),action:()=>{r.setState({open:!0})}}]}}function oe({parent:e,analyticsFrom:t,onChange:o,renderState:r}){const i=(0,l().v3)(),a=(0,E().ET)(),s=(0,n.useCallback)((({aggregationType:e})=>{if(null!=r&&r.propertySchema)return function({aggregationType:e,environment:t,analyticsFrom:o,rollupPropertySchema:n,collectionContextStore:r,onChange:i}){const a={...n,aggregation:e,show_as:void 0};null==i||i({propertySchema:a});const l=e?(0,C().ZP)(e):void 0;!function(e,t){(0,O().DO_NOT_USE_trackLegacy)(e,"configure_rollup_aggregation",t)}(t,{...(0,q().sl)(r),from:o,aggregation:l})}({aggregationType:e,environment:i,analyticsFrom:t,rollupPropertySchema:r.propertySchema,collectionContextStore:a,onChange:o})}),[i,t,null==r?void 0:r.propertySchema,a,o]);if(r&&r.propertySchema.target_property){let t=r.relatedCollectionSchema;return"person"===r.propertySchema.rollup_type&&r.targetPropertySchema&&r.propertySchema.target_property&&(t={[r.propertySchema.target_property]:r.targetPropertySchema}),(0,L.jsx)(F().v,{property:r.propertySchema.target_property,schema:t,currentAggregation:r.propertySchema.aggregation?{aggregator:r.propertySchema.aggregation,property:r.propertySchema.target_property}:void 0,onChange:s,onClose:e.close,noneText:(0,L.jsx)(I().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),source:"rollupPropertyMenu"})}return null}function ne({isEnabled:e,disabled:t,renderState:o,analyticsFrom:n,aggregationButtonPopupStore:r,onChange:l,schema:s,property:c}){if(o&&c&&s)return{key:2,render:e=>(0,L.jsx)(x().A,{...e,title:(0,L.jsx)(I().sA,{id:"database.rollupProperty.editAggregate.title",defaultMessage:"Calculate"}),topBorder:!0}),items:[{key:0,render:s=>(0,L.jsx)(f().m,{renderTooltip:()=>(0,L.jsx)(Y,{}),disableTooltip:e,render:c=>e?(0,L.jsx)(u().A,{popupType:i().A.isMobile?p().nl.BottomSheet:p().nl.Popup,renderOrigin:e=>(0,L.jsx)(h().A,{...(0,a().A)(s,e),title:(0,L.jsx)(G,{renderState:o}),right:J(t),disabled:t}),render:e=>(0,L.jsx)(oe,{parent:e,analyticsFrom:n,onChange:l,renderState:o}),buttonPopupStore:r}):(0,L.jsx)(h().A,{...(0,a().A)(s,c),title:(0,L.jsx)(I().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),right:J(t),disabled:!0,disabledFeedback:!0})},s.key),action:()=>{r.setState({open:!0})}}]}}},363631:(e,t,o)=>{o.d(t,{A:()=>l});var n=o(296540),r=()=>o(69708),i=o(474848);function a({setAiInference:e,aiInference:t,disabled:a}){const l=(0,n.useRef)(o(206267).JW()),s=()=>{if(!t)return;const o={...t,add_options:!t.add_options};e(o)};return(0,i.jsx)(o(26697).m,{renderTooltip:()=>(0,i.jsx)(r().sA,{id:"collectionSettingsAiAutofillAddOptionsToggle.title.description",defaultMessage:"New options are created based on property name & page details"}),placement:"bottom",render:e=>(0,i.jsx)(o(497222).A,{title:(0,i.jsx)(r().sA,{id:"collectionSettingsAiAutofillAddOptionsToggle.title.text",defaultMessage:"Generate new options"}),showChevron:!1,right:(0,i.jsx)(o(287188).A,{inputId:l.current,on:Boolean(null==t?void 0:t.add_options),onClick:s,disabled:!1,noColor:!1}),onClick:s,disabled:Boolean(a),textWrapperStyle:{minWidth:"auto"},...e})})}const l=n.memo(a)},378711:(e,t,o)=>{o.d(t,{L:()=>f});var n=o(296540),r=()=>o(484714),i=()=>o(590526),a=()=>o(128933),l=()=>o(807449),s=()=>o(695115),c=()=>o(26697),d=()=>o(236262),p=()=>o(69708),u=()=>o(339798),g=()=>o(815510),m=o(474848);const y=(0,p().YK)({deleteLabel:{defaultMessage:"Delete agent",id:"collectionSettings.propertyAgentAutofill.deleteAgent.icon"},agentDeletedSuccessfully:{defaultMessage:"Agent deleted successfully",id:"database.collectionViewAgentsMenu.agentDeletedSuccessfully"}});function f(e){const{collectionSettingsStore:t,collectionStore:o,onDeleteAgent:f,spaceId:S,workflowStore:h}=e,v=(0,r().v3)(),x=(0,p().tz)(),b=(0,n.useCallback)((()=>{if(!S||!h||!o)return;const e=o.getParentCollectionViewBlockStore();g().MT({workflowStore:h,collectionStore:o,collectionViewBlockStore:e,environment:v,spaceId:S}),t&&u().os({collectionSettingsStore:t}),f&&f(),a().D6({label:x.formatMessage(y.agentDeletedSuccessfully)})}),[S,h,o,v,t,f,x]),C=(0,i().K8)((()=>null==h?void 0:h.canEdit()),[h]),A=(0,i().K8)((()=>!!h&&!1===h.getAlive()),[h]),j=(0,n.useMemo)((()=>!!(h&&o&&S&&C)&&!A),[o,C,A,S,h]);return{handleDeleteAgent:b,shouldShowDeleteButton:j,deleteButton:j?(0,m.jsx)(c().m,{renderTooltip:()=>(0,m.jsx)(p().sA,{...y.deleteLabel}),render:e=>(0,m.jsx)(s().A,{...e,size:"xxs",icon:()=>(0,m.jsx)(l().I,{icon:d().trashIcon,colorVariant:"tertiary"}),ariaLabel:x.formatMessage(y.deleteLabel),onClick:b})}):null}}},385685:(e,t,o)=>{o.d(t,{Ay:()=>P,GI:()=>T,Ve:()=>I,am:()=>M,jD:()=>k});var n=o(296540),r=()=>o(242422),i=()=>o(590526),a=()=>o(401497),l=()=>o(929219),s=()=>o(807449),c=()=>o(26697),d=()=>o(869190),p=()=>o(651124),u=()=>o(116089),g=()=>o(340498),m=()=>o(72135),y=()=>o(706021),f=()=>o(69708),S=()=>o(100622),h=()=>o(534177),v=()=>o(267271),x=()=>o(706654),b=()=>o(497222),C=()=>o(877568),A=()=>o(135221),j=o(474848);const w=36e5;function T({autofillFeatureAvailability:e}){const t=(0,j.jsx)(f().sA,{...x().fillAllPagesMessages.fillAllPagesAddAiMessage});return(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{style:{color:"white",fontWeight:500,wordWrap:"break-word",whiteSpace:"pre-wrap"},children:(0,j.jsx)(f().sA,{...x().fillAllPagesMessages.fillAllPagesTooltip})}),(0,y().e2)(e)?void 0:(0,j.jsx)("div",{style:{color:"#ACABA9",fontWeight:500},children:t})]})}function M({updateAiInferencesTaskStatus:e,iconStyle:t,progressIconStyle:o}){return(0,C()._)({taskRunningState:e})?(0,j.jsx)("div",{style:o,children:(0,j.jsx)(A().A,{colorPalette:"purple"})}):(0,j.jsx)("div",{style:{display:"flex",alignItems:"center",height:"100%"},children:(0,j.jsx)(s().I,{icon:u().x,style:t})})}function P({updateAiInferencesTaskStatus:e}){const t=(0,f().tz)(),o=(0,i().K8)((()=>r().default.checkGate({gateName:"autofill_all_pages_use_new_endpoint"})?(0,j.jsx)(f().sA,{defaultMessage:"Autofill this view",id:"aiAutofill.fillAllPagesInView.buttonTitle"}):(0,j.jsx)(f().sA,{defaultMessage:"Autofill all pages",id:"aiAutofill.fillAllPages.buttonTitle"})),[]),l=(0,n.useMemo)((()=>{switch(e.status){case"requested":return(0,j.jsx)(f().sA,{defaultMessage:"Requested Autofill",id:"AiAutofill.fillAllPages.requested"});case"notRunning":case"error":return o;case"running":const n=0!==e.lastEditedTime&&Date.now()-e.lastEditedTime>w;return e.numPagesFilled>=e.numPagesRequested||n?o:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",gap:"4px"},children:[(0,j.jsx)(f().sA,{defaultMessage:"{numPagesRequested, plural, one {Autofilling {numPagesFilled} of {numPagesRequested} page} other {Updating {numPagesFilled} of {numPagesRequested} pages}}",id:"aiAutofill.fillallPages.updatingAllPagesWithProgress",values:{numPagesFilled:(0,m().ZV)(e.numPagesFilled,"compact",t),numPagesRequested:(0,m().ZV)(e.numPagesRequested,"compact",t)}}),0!==e.lastEditedTime?(0,j.jsx)("div",{style:{fontSize:"12px"},children:(0,j.jsx)(f().sA,{defaultMessage:"Last edited: {lastEditedTime}",id:"aiAutofill.fillallPages.lastEditedTime",values:{lastEditedTime:(0,d().W_)(e.lastEditedTime,"month_day_time",t.locale)}})}):void 0]});default:(0,h().HB)(e)}}),[o,t,e]),s=(0,a().IS)((()=>({textWrapper:{display:"flex",alignItems:"center",overflow:"hidden"}})),[]);return(0,j.jsx)("div",{style:s.textWrapper,children:l})}function k({updateAiInferencesTaskStatus:e}){const t=(0,a().IS)((()=>({inner:{background:S().Tj.palette.purple[400],height:"100%",transition:"width .5s"},outer:{background:S().Tj.palette.gray[100],height:3,borderRadius:2,minWidth:120,overflow:"hidden",marginTop:8}})),[]);switch(e.status){case"notRunning":case"requested":case"error":return null;case"running":break;default:(0,h().HB)(e)}const{numPagesFilled:o,numPagesRequested:n}=e;return 0===n||o===n?null:(0,j.jsx)("div",{style:t.outer,role:"progressbar",children:(0,j.jsx)("div",{style:{...t.inner,width:100*Math.min(o/n,1)+"%"}})})}function I(e){const{environment:t,collectionContextStore:o,property:r,propertySchema:a,autofillFeatureAvailability:s,isAutofillSetupEnabled:d}=e,u=!(0,i().O$)(l().e),m=(0,i().K8)((()=>{const e=o.collectionStore();return e?(0,p().Ts)(e.getFormat(),r):{status:"notRunning"}}),[o,r]),S=(0,n.useCallback)((async e=>{const n=o.collectionStore(),i=o.collectionViewStore();n&&a&&i&&((0,y().e2)(e)?await x().autofillPropertyForCollection({environment:t,collectionStore:n,propertySchema:a,property:r,collectionViewStore:i}):x().triggerAiAutofillUpsell({environment:t,from:"ai_autofill_fill_all_pages",upsell:e.upsell,store:n}))}),[t,a,r,o]),h=(0,C()._)({taskRunningState:m});return(0,j.jsx)(c().m,{disableTooltip:(0,y().e2)(s),renderTooltip:()=>u?(0,j.jsx)(f().sA,{...v().AY.aiUnavailableOfflineTooltip}):(0,j.jsx)(T,{autofillFeatureAvailability:s}),render:e=>(0,j.jsx)(b().A,{icon:e=>(0,j.jsx)(M,{updateAiInferencesTaskStatus:m,iconStyle:e,progressIconStyle:{width:g().Ev.sm,marginTop:4,marginInlineStart:4,marginInlineEnd:2}}),title:(0,j.jsx)(P,{updateAiInferencesTaskStatus:m}),caption:h&&"requested"!==m.status&&(0,j.jsx)(k,{updateAiInferencesTaskStatus:m}),focused:!1,onClick:()=>S(s),disabled:h||!d||u,...e})})}},422068:(e,t,o)=>{o.d(t,{u:()=>s});var n=o(296540),r=()=>o(807449),i=()=>o(69708),a=o(474848);const l=(0,i().YK)({displayAsLabel:{id:"database.viewSettings.statusOptions.displayAs",defaultMessage:"Display as"},statusCheckboxLabel:{id:"database.viewSettings.statusOptions.showAs.checkbox",defaultMessage:"Checkbox"},statusSelectLabel:{id:"database.viewSettings.statusOptions.showAs.selectOptionLabel",defaultMessage:"Select"}}),s=n.memo((function(e){const{collectionContextStore:t,property:s,disabled:c}=e,d=(0,o(484714).v3)(),p=(0,i().tz)(),{propertySchema:u,showAs:g}=(0,o(590526).K8)((()=>{var e;const o=t.normalizedSchemaStore.state[s];return{propertySchema:o&&"status"===o.type?o:void 0,showAs:(null===(e=t.getPropertyFormat(s))||void 0===e?void 0:e.statusShowAs)??"select"}}),[t,s]),m=(0,n.useCallback)((e=>{const n=t.formatStore();if(!n)return;const r=t.getPropertyFormatKey();r&&(o(547149).createAndCommit({userAction:"CollectionSettingsStatusOptions.handleShowAsChange",environment:d,canUndo:!0,perform:t=>{(0,o(263527).a)({formatStore:n,formatKey:r,property:s,update:{statusShowAs:e,visible:!0},transaction:t})}}),(0,o(901952).V)({environment:d,collectionContextStore:t,property:s,from:"view_settings",action:"status_change_format"}))}),[t,d,s]),y=(0,o(401497).IS)((()=>({popup:{minWidth:190}})),[]),f=(0,n.useMemo)((()=>[{key:"checkbox",type:"button",title:p.formatMessage(l.statusCheckboxLabel),icon:(0,a.jsx)(r().I,{icon:o(396350).i})},{key:"select",type:"button",title:p.formatMessage(l.statusSelectLabel),icon:(0,a.jsx)(r().I,{icon:o(430401).b})}]),[p]);return u?(0,a.jsx)(o(828973).A,{icon:o(89849).eyeIcon,title:p.formatMessage(l.displayAsLabel),selectedKey:g,popupStyle:y.popup,options:f,onChange:m,disabled:c}):null}))},653259:(e,t,o)=>{o.d(t,{A:()=>l});o(296540);var n=()=>o(302501),r=()=>o(69708),i=()=>o(100622),a=o(474848);function l(e){return(0,a.jsx)(n().A,{isMultiline:!0,style:{paddingTop:8,marginInlineStart:16,marginInlineEnd:16,color:i().oZ.red,...e.styles},children:(0,a.jsx)(r().sA,{id:"database.viewSettings.propertyTab.duplicatePropertyNameError",defaultMessage:"A property named {propertyName} already exists in this database.",values:{propertyName:e.propertyName}})})}},656704:(e,t,o)=>{o.d(t,{y:()=>i});var n=()=>o(597777);const r=(0,o(69708).YK)({none:{defaultMessage:"None",id:"dateFormatHelpers.reminderMenuItems.none"},onTheDay:{defaultMessage:"On day of event {formattedTimeText}",id:"dateFormatHelpers.reminderMenuItems.onTheDayOfEvent"},hoursBefore:{defaultMessage:"{numberOfHours, plural, one {{numberOfHours} hour before} other {{numberOfHours} hours before}}",id:"dateFormatHelpers.reminderMenuItems.hoursBefore"},minutesBefore:{defaultMessage:"{numberOfMinutes, plural, one {{numberOfMinutes} minute before} other {{numberOfMinutes} minutes before}}",id:"dateFormatHelpers.reminderMenuItems.minutesBefore"},yearsBefore:{defaultMessage:"{numberOfYears, plural, one {{numberOfYears} year before {formattedTimeText}} other {{numberOfYears} years before {formattedTimeText}}}",id:"dateFormatHelpers.reminderMenuItems.yearsBefore"},daysBefore:{defaultMessage:"{numberOfDays, plural, one {{numberOfDays} day before {formattedTimeText}} other {{numberOfDays} days before {formattedTimeText}}}",id:"dateFormatHelpers.reminderMenuItems.daysBefore"},monthsBefore:{defaultMessage:"{numberOfMonths, plural, one {{numberOfMonths} month before {formattedTimeText}} other {{numberOfMonths} months before {formattedTimeText}}}",id:"dateFormatHelpers.reminderMenuItems.monthsBefore"},weeksBefore:{defaultMessage:"{numberOfWeeks, plural, one {{numberOfWeeks} week before {formattedTimeText}} other {{numberOfWeeks} weeks before {formattedTimeText}}}",id:"dateFormatHelpers.reminderMenuItems.weeksBefore"},atTimeOf:{defaultMessage:"At time of event",id:"dateFormatHelpers.reminderMenuItems.atTimeOfEvent"}});function i(e){const{reminder:t,shouldShowTime:o,intl:i,formatTime:a}=e;if(n().DG(t)){if(n().fc(t)){const{unit:e,value:n,time:l}=t,s=a({start_time:l,time_format:"LT",humanReadable:!0,intl:i}),c=o?`(${s})`:"";return 0===n?i.formatMessage(r.onTheDay,{formattedTimeText:c}):"day"===e?i.formatMessage(r.daysBefore,{formattedTimeText:c,numberOfDays:n}):"year"===e?i.formatMessage(r.yearsBefore,{formattedTimeText:c,numberOfYears:n}):"month"===e?i.formatMessage(r.monthsBefore,{formattedTimeText:c,numberOfMonths:n}):i.formatMessage(r.weeksBefore,{formattedTimeText:c,numberOfWeeks:n})}{const{unit:e,value:o}=t;return 0===o?i.formatMessage(r.atTimeOf):"hour"===e?i.formatMessage(r.hoursBefore,{numberOfHours:o}):i.formatMessage(r.minutesBefore,{numberOfMinutes:o})}}return i.formatMessage(r.none)}},673099:(e,t,o)=>{o.d(t,{b:()=>g,p:()=>u});o(296540);var n=()=>o(552712),r=o(474848);const i={viewBox:"0 0 16 16",fittedViewBox:"2.37 1.59 12.03 12.03",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"m14.2 2.781-.517.518-.977-.976.525-.524a.69.69 0 0 1 .97 0 .69.69 0 0 1 0 .97zM7.052 9.93l5.998-5.998-.977-.977L6.07 8.948a1 1 0 0 0-.208.347l-.254.82c-.046.173.116.335.277.277l.82-.254a.8.8 0 0 0 .347-.208"}),(0,r.jsx)("path",{d:"M3.625 5c0-.76.616-1.375 1.375-1.375h3a.625.625 0 1 0 0-1.25H5A2.625 2.625 0 0 0 2.375 5v6A2.625 2.625 0 0 0 5 13.625h6A2.625 2.625 0 0 0 13.625 11V8a.625.625 0 1 0-1.25 0v3c0 .76-.616 1.375-1.375 1.375H5c-.76 0-1.375-.616-1.375-1.375z"})]})},a=(0,o(340498).wt)("composeSmall",i,"small");var l=()=>o(69708),s=()=>o(95441),c=()=>o(497222);const d="https://www.notion.com/help/salesforce",p="https://www.notion.so/notion/21fefdeead0580808823c9d0dede7495";function u(){return(0,r.jsx)(s().A,{href:d,title:(0,r.jsx)(l().sA,{defaultMessage:"Learn about Salesforce",id:"database.viewSettings.propertyTab.salesforceRelation.learnMoreButton.title"}),analyticsFrom:"view_settings_property_salesforce_relation"})}function g(){return(0,r.jsx)(n().N,{href:p,onClick:()=>{},external:!0,children:(0,r.jsx)(c().A,{icon:a,title:(0,r.jsx)(l().sA,{defaultMessage:"Provide feedback",id:"database.viewSettings.propertyTab.salesforceRelation.feedbackButton.title"}),isGray:!0})})}},716025:(e,t,o)=>{o.d(t,{n:()=>le});var n=o(296540),r=()=>o(907258),i=()=>o(59226),a=()=>o(804773),l=()=>o(726637),s=()=>o(383036),c=()=>o(484714),d=()=>o(590526),p=()=>o(401497),u=()=>o(929219),g=()=>o(807449),m=()=>o(546926),y=()=>o(26697),f=()=>o(890492),S=()=>o(81068),h=()=>o(663639),v=()=>o(736847),x=()=>o(529099),b=()=>o(212727),C=()=>o(45313),A=()=>o(877235),j=()=>o(402390),w=()=>o(201980),T=()=>o(69708),M=()=>o(267271),P=()=>o(358993),k=()=>o(600434),I=()=>o(332724),_=()=>o(166442),R=()=>o(703748),B=()=>o(965454),O=()=>o(339798),D=()=>o(662971),F=()=>o(22673),K=()=>o(622936),V=()=>o(934257),N=()=>o(233692),z=()=>o(844317),E=(o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(581454),o(737550),()=>o(664594)),W=()=>o(350013),q=()=>o(396896),U=()=>o(695115),L=()=>o(31511),H=()=>o(493552),G=()=>o(526278),$=()=>o(617668),Y=()=>o(743246),J=()=>o(100622),X=()=>o(388832),Z=()=>o(58807),Q=()=>o(815510),ee=()=>o(330863),te=()=>o(378711),oe=()=>o(120201),ne=o(474848);const re=(0,T().YK)({back:{defaultMessage:"Back",id:"databaseAgentsManagementMenu.back"},agentName:{defaultMessage:"Agent name",id:"databaseAgentsManagementMenu.agent.name"}});function ie({isForCurrentProperty:e,associatedPropertyNames:t,agentDescription:o,isDefault:n}){const r=(0,p().IS)((()=>({captionContainer:{display:"flex",flexDirection:"column",gap:4,overflow:"hidden"},propertyNames:{color:J().Tj.text.secondary,fontSize:12},descriptionText:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},defaultBadge:{fontSize:11,padding:"2px 6px",borderRadius:4,background:J().Tj.background.secondary,color:J().Tj.text.secondary,fontWeight:400}})),[]),i=!e&&t.length>0,a=Boolean(o),l=n;return(0,ne.jsxs)("div",{style:r.captionContainer,children:[i?(0,ne.jsx)("div",{children:(0,ne.jsx)("span",{style:r.propertyNames,children:t.join(", ")})}):void 0,a?(0,ne.jsx)("div",{style:r.descriptionText,title:o,children:o}):void 0,l?(0,ne.jsx)("div",{children:(0,ne.jsx)("span",{style:r.defaultBadge,children:(0,ne.jsx)(T().sA,{defaultMessage:"Default",id:"database.databaseAgentsManagementMenu.defaultBadge"})})}):void 0]})}function ae(e){const{collectionContextStore:t,collectionSettingsStore:o,collectionStore:r,mainMenuParent:i,onMouseEnter:a,onWorkflowClick:s,parent:u,property:y,propertySchema:b,spaceId:C}=e,A=(0,T().tz)(),j=(0,c().v3)(),w=(0,E().T)(),{getWorkflowsForProperty:M}=(0,ee().i)(r,C),P=(0,d().K8)((()=>M(y)),[M,y]),[k,I]=(0,n.useState)(1===P.length?P[0].id:void 0),_=l().A.isMobile?{menuType:m().gu.Modal,title:A.formatMessage({defaultMessage:"Agents for {propertyName}",id:"database.databaseAgentsManagementMenu.title"},{propertyName:b.name})}:{menuType:m().gu.Popup,width:320},R=(0,n.useCallback)((async()=>{const e=await Q().GK({environment:j,collectionStore:r,intl:A,propertyId:y,propertySchema:b,workflows:P,collectionContextStore:t});e&&I(e)}),[j,r,A,y,b,P,t,I]),B=(0,d().K8)((()=>{const e=[],t=[],o=[];for(const r of P)r.getCreatedById()===w?t.push(r):o.push(r);const n=e=>{u.close(),s(e)},i=e=>e.map((e=>{const t=function(e,t,o,n,r){var i;const a=e.getDraftData()??e.getData(),l=(0,Z().DO)(e.id,o),s=(null==a?void 0:a.name)||r.formatMessage({defaultMessage:"Unnamed agent",id:"database.databaseAgentsManagementMenu.unnamedAgent"}),c=null==a?void 0:a.description,d=(null==a||null===(i=a.modules)||void 0===i?void 0:i.some((e=>{var o;return"notion"===e.type&&(null===(o=e.state)||void 0===o||null===(o=o.ownedByDatabasePropertyIds)||void 0===o?void 0:o.includes(t))})))??!1,p=new Set((0,X().d_)(e)),u=n.getSchema(),g=[];for(const y of p){var m;const e=null===(m=u[y])||void 0===m?void 0:m.name;e&&g.push(e)}return{workflowStore:e,agentName:s,agentDescription:c,isDefault:l,isForCurrentProperty:d,associatedPropertyNames:g}}(e,y,b,r,A);return function(e,t,o,n){const{workflowStore:r,agentName:i,agentDescription:a,isDefault:l,isForCurrentProperty:s,associatedPropertyNames:c}=e,d=!s&&c.length>0,p=Boolean(a),u=d||p||l;return{key:`workflow-${r.id}`,action:()=>{n(r.id)},render:e=>(0,ne.jsx)(S().A,{...e,title:i,caption:u?(0,ne.jsx)(ie,{isForCurrentProperty:s,associatedPropertyNames:c,agentDescription:a,isDefault:l}):void 0,icon:(0,ne.jsx)(g().I,{icon:x().aiFaceIcon}),showExtensionArrow:!1,onClick:e=>{e.stopPropagation(),n(r.id)}})}}(t,0,l().A.isMobile,n)}));return t.length>0&&e.push({key:"my-agents",render:e=>(0,ne.jsx)(v().A,{...e,title:(0,ne.jsx)(T().sA,{defaultMessage:"Created by me",id:"database.databaseAgentsManagementMenu.createdByMe"})}),items:i(t)}),o.length>0&&e.push({key:"other-agents",render:e=>(0,ne.jsx)(v().A,{...e,title:(0,ne.jsx)(T().sA,{defaultMessage:"Agents in this database",id:"database.databaseAgentsManagementMenu.agentsInDatabase"}),topBorder:t.length>0}),items:i(o)}),e.push({key:"new-agent",render:e=>(0,ne.jsx)(v().A,{...e,topBorder:!0}),items:[{key:"new-agent-item",action:R,render:e=>(0,ne.jsx)(S().A,{...e,title:(0,ne.jsx)(T().sA,{defaultMessage:"New agent",id:"database.databaseAgentsManagementMenu.newAgent"}),icon:(0,ne.jsx)(g().I,{icon:$().plusIcon}),onClick:R})}]}),e}),[r,w,R,A,i,s,u,y,b,P]),O=(0,d().K8)((()=>{if(!C||!r||!k)return;const e=r.getParentCollectionViewBlockStore();return e?W().N.createChildStore(e,{table:Y().C0,id:k,spaceId:C}):null}),[r,k,C]),D=(0,p().IS)((()=>({arrowButton:{marginInlineEnd:8,marginInlineStart:-2,height:22},arrowIcon:{width:16,height:16},header:{paddingTop:14,paddingInlineStart:12,paddingInlineEnd:16,paddingBottom:14,width:"100%"}})),[]),F=(0,n.useCallback)((()=>{P.length>1?I(void 0):u.close()}),[u,P,I]),K=(0,n.useCallback)((()=>{i&&i.close()}),[i]),V=(0,d().K8)((()=>{if(!O)return;const e=O.getDraftData();if(e)return e.name;const t=O.getData();return t?t.name:""}),[O]),N=(0,n.useCallback)((e=>{O&&Q().wm({workflowStore:O,environment:j,spaceId:C,newName:e.target.value})}),[O,j,C]),{deleteButton:z}=(0,te().L)({collectionSettingsStore:o,collectionStore:r,spaceId:C,workflowStore:O}),J=O?(0,ne.jsx)(q().fI,{alignItems:"center",gap:4,children:z}):null;return(0,ne.jsx)(f().A,{..._,onMouseEnter:a,children:k&&O?(0,ne.jsx)("div",{onClick:e=>e.stopPropagation(),role:"presentation",children:(0,ne.jsxs)(q().VP,{children:[(0,ne.jsxs)("div",{style:D.header,children:[P.length>1?(0,ne.jsxs)(q().fI,{alignItems:"center",justifyContent:"space-between",children:[(0,ne.jsx)(U().A,{icon:G().arrowStraightLeftIcon,style:D.arrowButton,iconStyle:D.arrowIcon,onClick:F,ariaLabel:A.formatMessage(re.back)}),J]}):null,(0,ne.jsxs)(q().VP,{gap:8,children:[(0,ne.jsxs)(q().fI,{alignItems:"center",justifyContent:"space-between",children:[(0,ne.jsx)(H().D,{styleKey:"captionMedium",color:"gray",colorVariant:"secondary",children:(0,ne.jsx)(T().sA,{...re.agentName})}),1===P.length?J:null]}),(0,ne.jsx)(L().A,{value:V,onChange:N})]})]}),(0,ne.jsx)(oe().e,{collectionContextStore:t,collectionStore:r,handleCloseParent:K,numWorkflowsForProperty:P.length,property:y,propertySchema:b,spaceId:C,workflowId:k})]})}):(0,ne.jsx)(h().A,{type:h().O.Vertical,initialFocus:0,sections:B})})}function le(e){const{collectionContextStore:t,collectionSettingsStore:o,property:E,propertySchema:W,workflowsForProperty:q,spaceId:U,mainMenuParent:L,onClickConfigure:H,variant:G,onFocus:$,focused:Y,...J}=e,X=(0,i().X)("database_agent_agentic_setup_flow"),Z=!(0,d().O$)(u().e),Q=(0,c().v3)(),ee=(0,T().tz)(),te=(0,k().K7)("agent"),oe=(0,I().W)({omitCurrentPage:!1}),re=(0,B().AD)(),ie=(0,d().K8)((()=>t.collectionStore()),[t]),le=q.length>0,se=q.length>1,ce=1===q.length,de=q[0],pe=(0,d().K8)((()=>{if(ce)return(0,N().m)(de)}),[ce,de]),ue=(0,p().IS)((()=>({truncatedName:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}})),[]),ge=X&&!le,me=(0,n.useCallback)((e=>{null==L||L.close(),"collectionLevelConfigurationMenu"===G&&O().os({collectionSettingsStore:o}),H(e)}),[o,L,H,G]),ye=(0,n.useCallback)((()=>{(0,F().Op)({environment:Q,setupMethod:"manual"}),me(void 0)}),[Q,me]),fe=(0,n.useCallback)((()=>{if((0,F().Op)({environment:Q,setupMethod:"translate"}),null==L||L.close(),"collectionLevelConfigurationMenu"===G&&O().os({collectionSettingsStore:o}),!oe||!ie)return;const e=(0,V().CN)("translate_database_agent"),t=(0,j().H)(ee),n=(0,w().x9d)(ee.formatMessage(e.message));(async()=>{const e=await(0,P().XA)({agentChatIntegrations:[],aiChatFeatureController:te,args:{prompt:n,config:(0,z().getWorkflowAgentConfig)({}),prebuiltPrompt:{type:"translate_database_agent",displayText:n,locale:t,args:{type:"translate_database_agent",propertyNames:[W.name],collectionId:ie.id}}},clientStore:_().defaultClientAIChatStore,environment:Q,hasAgentIntegrationsFeatureFlag:!1,inferenceContext:oe,mainEditorCurrentBlockStore:r().default.state.mainEditorCurrentBlockStore,peekViewBlockStore:void 0,threadStore:void 0,temporaryAiThreadManager:re,sendPartialTranscript:!1,sendPatchResponse:!1,inputSurfaceOverride:"database_agent"});e.didChangeThread&&e.threadStore&&(re.reset(),(0,R().openChatPanel)({environment:Q,store:r().default.state.mainEditorCurrentBlockStore,chatPanelState:{isOpen:!0,threadId:e.threadStore.id},source:"programmatic"}))})()}),[Q,L,G,o,oe,ie,ee,te,re,W.name]),Se=(0,n.useCallback)((()=>{if((0,F().Op)({environment:Q,setupMethod:"summarize"}),null==L||L.close(),"collectionLevelConfigurationMenu"===G&&O().os({collectionSettingsStore:o}),!oe||!ie)return;const e=(0,V().CN)("summarize_database_agent"),t=(0,j().H)(ee),n=(0,w().x9d)(ee.formatMessage(e.message));(async()=>{const e=await(0,P().XA)({agentChatIntegrations:[],aiChatFeatureController:te,args:{prompt:n,config:(0,z().getWorkflowAgentConfig)({}),prebuiltPrompt:{type:"summarize_database_agent",displayText:n,locale:t,args:{type:"summarize_database_agent",propertyNames:[W.name],collectionId:ie.id}}},clientStore:_().defaultClientAIChatStore,environment:Q,hasAgentIntegrationsFeatureFlag:!1,inferenceContext:oe,mainEditorCurrentBlockStore:r().default.state.mainEditorCurrentBlockStore,peekViewBlockStore:void 0,threadStore:void 0,temporaryAiThreadManager:re,sendPartialTranscript:!1,sendPatchResponse:!1,inputSurfaceOverride:"database_agent"});e.didChangeThread&&e.threadStore&&(re.reset(),(0,R().openChatPanel)({environment:Q,store:r().default.state.mainEditorCurrentBlockStore,chatPanelState:{isOpen:!0,threadId:e.threadStore.id},source:"programmatic"}))})()}),[L,G,o,oe,ie,ee,te,Q,re,W.name]),he=(0,n.useCallback)((()=>{if((0,F().Op)({environment:Q,setupMethod:"ai"}),null==L||L.close(),"collectionLevelConfigurationMenu"===G&&O().os({collectionSettingsStore:o}),!oe||!ie)return;const e=(0,V().CN)("create_database_agent"),t=(0,j().H)(ee),n=(0,w().x9d)(ee.formatMessage(e.message));(async()=>{const e=await(0,P().XA)({agentChatIntegrations:[],aiChatFeatureController:te,args:{prompt:n,config:(0,z().getWorkflowAgentConfig)({}),prebuiltPrompt:{type:"create_database_agent",displayText:n,locale:t,args:{type:"create_database_agent",propertyNames:[W.name],collectionId:ie.id}}},clientStore:_().defaultClientAIChatStore,environment:Q,hasAgentIntegrationsFeatureFlag:!1,inferenceContext:oe,mainEditorCurrentBlockStore:r().default.state.mainEditorCurrentBlockStore,peekViewBlockStore:void 0,threadStore:void 0,temporaryAiThreadManager:re,sendPartialTranscript:!1,sendPatchResponse:!1,inputSurfaceOverride:"database_agent"});e.didChangeThread&&e.threadStore&&(re.reset(),(0,R().openChatPanel)({environment:Q,store:r().default.state.mainEditorCurrentBlockStore,chatPanelState:{isOpen:!0,threadId:e.threadStore.id},source:"programmatic"}))})()}),[L,G,o,oe,ie,ee,te,Q,re,W.name]),ve=(0,n.useCallback)((()=>{de&&(0,F().tH)({environment:Q,workflowId:de.id,origin:"property_header"}),me(null==de?void 0:de.id)}),[Q,de,me]),xe=(0,n.useMemo)((()=>[{key:"setup-options",render:e=>(0,ne.jsx)(v().A,{...e}),items:[{key:"setup-manually",action:ye,render:e=>(0,ne.jsx)(S().A,{...e,title:(0,ne.jsx)(T().sA,{defaultMessage:"Set up manually",id:"database.agentAutofill.setupManually"}),icon:(0,ne.jsx)(g().I,{icon:b().gearIcon})})},{key:"setup-with-ai",action:he,render:e=>(0,ne.jsx)(S().A,{...e,title:(0,ne.jsx)(T().sA,{defaultMessage:"Set up with AI",id:"database.agentAutofill.setupWithAI"}),icon:(0,ne.jsx)(g().I,{icon:x().aiFaceIcon})})},{key:"translate",action:fe,render:e=>(0,ne.jsx)(S().A,{...e,title:(0,ne.jsx)(T().sA,{defaultMessage:"Translate",id:"database.agentAutofill.translate"}),icon:(0,ne.jsx)(g().I,{icon:A().textTranslateIcon})})},{key:"summarize",action:Se,render:e=>(0,ne.jsx)(S().A,{...e,title:(0,ne.jsx)(T().sA,{defaultMessage:"Summarize",id:"database.agentAutofill.summarize"}),icon:(0,ne.jsx)(g().I,{icon:C().d})})}]}]),[ye,he,fe,Se]),be=(0,n.useMemo)((()=>l().A.isMobile?{menuType:m().gu.Modal}:{menuType:m().gu.Popup,width:200}),[]),Ce=(0,n.useCallback)(((e,n)=>ge?(0,ne.jsx)(f().A,{...be,...e,children:(0,ne.jsx)(h().A,{type:h().O.Vertical,initialFocus:0,sections:xe})}):se&&ie&&U?(0,ne.jsx)(ae,{collectionContextStore:t,collectionSettingsStore:o,collectionStore:ie,mainMenuParent:L,onWorkflowClick:me,parent:n,property:E,propertySchema:W,spaceId:U,...e}):null),[t,o,ie,me,se,L,be,E,W,xe,ge,U]),Ae="tableHeader"===G&&ge||se,je=le&&!se||!le&&!X||"collectionLevelConfigurationMenu"===G&&ge,we="tableHeader"===G&&void 0===ie||Z,Te=(0,a().e)(),Me="collectionLevelConfigurationMenu"!==G&&(Y??!1),Pe="collectionLevelConfigurationMenu"===G?()=>{}:$??(()=>{});return(0,ne.jsx)(D().A,{...J,focused:Me,onFocus:Pe,disableCloseOnEnter:!0,alignmentToOrigin:"start",renderOrigin:(e,t)=>(0,ne.jsx)(y().m,{placement:"left",renderTooltip:()=>Z?(0,ne.jsx)(T().sA,{...M().AY.aiUnavailableOfflineTooltip}):null,disableTooltip:!Z,render:o=>{const n=je?ve:e.onClick;return(0,ne.jsx)(S().A,{...(0,s().A)(e,o),ref:"collectionLevelConfigurationMenu"===G?Te.itemRef:t,disabled:we,disabledFeedback:we,title:pe?(0,ne.jsx)("span",{style:ue.truncatedName,children:pe.name}):(0,ne.jsx)(T().sA,{defaultMessage:"Auto-fill with agent",id:"database.tableHeaderCell.autofillWithAgent"}),icon:pe?(0,ne.jsx)(K().AgentIcon,{agentIcon:pe.icon,workflowStore:de,size:18}):(0,ne.jsx)(g().I,{icon:x().aiFaceIcon}),showExtensionArrow:Ae,..."collectionLevelConfigurationMenu"===G&&{onMouseEnter:void 0,onClick:n,onKeyDown:Te.onKeyDown,disallowTabbing:!Te.isTabbable},..."tableHeader"===G&&je&&{onClick:ve}})}}),renderExtension:Ce})}},750294:(e,t,o)=>{o.d(t,{oX:()=>lo,t_:()=>qt,lI:()=>po});o(16280),o(944114),o(898992),o(672577);var n=o(296540),r=()=>o(59226),i=()=>o(726637),a=()=>o(484714),l=()=>o(590526),s=()=>o(401497),c=()=>o(929219),d=()=>o(770063),p=()=>o(118307),u=()=>o(807449),g=()=>o(26697),m=()=>o(736847);const y="usersOnly";var f=()=>o(898244),S=()=>o(713998),h=()=>o(158115),v=()=>o(104077),x=()=>o(105819),b=()=>o(69708),C=()=>o(100622),A=()=>o(534177),j=()=>o(59400),w=()=>o(901952),T=()=>o(272200),M=()=>o(799829);function P(e,t,o){return(0,M().e0)(e,t,o)}var k=()=>o(362683),I=()=>o(330863),_=()=>o(831566),R=()=>o(312296),B=()=>o(680288),O=()=>o(716025),D=()=>o(495159),F=()=>o(68465),K=()=>o(148307),V=()=>o(965134),N=()=>o(284371),z=()=>o(115552),E=()=>o(547149),W=()=>o(33218),q=()=>o(937199),U=o(474848);function L(){const{layoutStore:e,currentModuleSelection:t,collectionStore:n}=(0,q().LH)(),r=(0,l().K8)((()=>{if("existing_module"===(null==t?void 0:t.type))return e.getModuleById(t.moduleId)}),[t,e]),i=(0,l().K8)((()=>{if((0,o(778781).gx)(r))return null==n?void 0:n.getSchemaStore().getKeyStore(r.propertyId).getValue()}),[n,r]);if(!r||!i)return null;switch(r.type){case"property_person":case"property_created_by":case"property_last_edited_by":return(0,U.jsx)(Y,{module:r,options:H,heightVariant:"tall"});case"property_formula":return(0,o(708685).isNumberFormulaPropertySchema)(i)?(0,U.jsx)(Y,{module:r,options:$,heightVariant:"short"}):null;case"property_number":return(0,U.jsx)(Y,{module:r,options:$,heightVariant:"short"});case"property_file":return(0,U.jsx)(Y,{module:r,options:G,heightVariant:"short"});case"property_place":return(0,U.jsx)(Y,{module:r,options:J,heightVariant:"short"});default:return null}}const H={available:["large","compact"],appearance:{compact:{label:(0,U.jsx)(b().sA,{id:"PropertyTypeSpecificModuleConfiguration.person.display.compact",defaultMessage:"Compact"}),image:{src:K().A.images.layouts.configuration.personCompactPng,width:100,height:41}},large:{label:(0,U.jsx)(b().sA,{id:"PropertyTypeSpecificModuleConfiguration.person.display.large",defaultMessage:"Large"}),image:{src:K().A.images.layouts.configuration.personMediumPng,width:82,height:56}}}},G={available:["landscape","portrait","square"],appearance:{landscape:{label:(0,U.jsx)(b().sA,{id:"PropertyTypeSpecificModuleConfiguration.file.display.landscape",defaultMessage:"Landscape"}),image:{src:K().A.images.layouts.configuration.fileLandscapePng,width:192,height:128}},portrait:{label:(0,U.jsx)(b().sA,{id:"PropertyTypeSpecificModuleConfiguration.file.display.portrait",defaultMessage:"Portrait"}),image:{src:K().A.images.layouts.configuration.filePortraitPng,width:192,height:128}},square:{label:(0,U.jsx)(b().sA,{id:"PropertyTypeSpecificModuleConfiguration.file.display.square",defaultMessage:"Square"}),image:{src:K().A.images.layouts.configuration.fileSquarePng,width:192,height:128}}}},$={available:["large","small"],appearance:{large:{label:(0,U.jsx)(b().sA,{id:"PropertyTypeSpecificModuleConfiguration.number.display.large",defaultMessage:"Large"}),icon:{function:V().i,size:42}},small:{label:(0,U.jsx)(b().sA,{id:"PropertyTypeSpecificModuleConfiguration.number.display.small",defaultMessage:"Small"}),icon:{function:V().i,size:22}}}};function Y({module:e,options:t,heightVariant:o}){const r=(0,a().v3)(),{layoutStore:i}=(0,q().LH)(),l=(0,n.useCallback)((t=>{const o=i.getModel(),n=null==o?void 0:o.getPageModuleAreaById(e.id);if(!n||!o)return;const a={...e,style:t};E().createAndCommit({environment:r,perform(e){(0,W().UQ)({environment:r,transaction:e,layoutStore:i,position:{area:n,moduleId:a.id},updatedModule:a})},canUndo:!0,userAction:"BuilderLayoutModules.setDisplayStyle"})}),[r,i,e]),c=(0,s().IS)((()=>({container:{margin:"10px 8px"},label:{fontSize:N().J.UISmall.desktop,fontWeight:N().Wy.medium,marginTop:0,marginInlineEnd:8,marginBottom:6,marginInlineStart:8,color:C().Tj.text.secondary}})),[]);return(0,U.jsxs)("div",{style:c.container,children:[(0,U.jsx)("p",{style:c.label,children:(0,U.jsx)(b().sA,{id:"PropertyTypeSpecificModuleConfiguration.person.display.title",defaultMessage:"Style"})}),(0,U.jsx)(z().A,{disabled:!1,options:t,selectedOption:e.style,onOptionSelected:l,height:o})]})}const J={available:["map","text"],appearance:{map:{label:(0,U.jsx)(b().sA,{id:"PropertyTypeSpecificModuleConfiguration.place.display.map",defaultMessage:"Map"}),image:{src:K().A.images.blocks.mapsPng,width:40,height:40}},text:{label:(0,U.jsx)(b().sA,{id:"PropertyTypeSpecificModuleConfiguration.place.display.text",defaultMessage:"Text"}),image:{src:K().A.images.blocks.textPng["en-US"],width:40,height:40}}}};var X=()=>o(255824),Z=()=>o(619206),Q=()=>o(339798),ee=()=>o(527438),te=()=>o(206372),oe=(o(18107),o(967357),()=>o(127833)),ne=()=>o(497222);const re=n.memo((function({collectionContextStore:e,collectionSettingsStore:t,property:r}){const s=(0,a().v3)(),c=(0,l().uB)(void 0,p().A),d=(0,n.useCallback)((n=>{const i=e.collectionStore();if(!i)return null;const a=e.normalizedSchemaStore.state[r];if("formula"!==(null==a?void 0:a.type))return;const l=Boolean(i.getDatabaseType()&&i.isTypedProperty(r)),c=t.getState().fromBlockStore??e.resultsInViewOrder(1).at(0);return(0,U.jsx)(o(79926).u2,{dependency:o(862292).T.formulas,children:e=>(0,U.jsx)(o(641078).C,{handleClose:n.close,property:r,getRecordModel:i.getRecordModel,propertySchema:a,collectionStore:i,handleSave:e=>function(e,t){const{newValue:o,newType:n,propertySchema:r,property:i,collectionStore:a}=e,l=o?{...r,formula2:{code:o,result_type:n},version:"v2"}:{...r,formula2:void 0,version:"v2"};E().createAndCommit({userAction:"CollectionFormulaOptions.handleFormulaChange",environment:t,canUndo:!0,perform:e=>{(0,R().F)({environment:t,collectionStore:a,update:{[i]:l},transaction:e})}})}(e,s),formulas:e,disabled:l,blockStore:c,analyticsFrom:"view_settings"})})}),[e,t,s,r]);return(0,U.jsx)(o(250910).A,{popupType:i().A.isMobile?oe().nl.BottomSheet:oe().nl.Popup,alignmentToOrigin:"end",renderOrigin:e=>(0,U.jsx)(ne().A,{title:(0,U.jsx)(b().sA,{defaultMessage:"Edit formula",id:"database.viewSettings.formulaOptions.title"}),showChevron:!0,icon:x().pencilLineIcon,rotateChevron:c.state.open,...e}),render:d,buttonPopupStore:c})}));var ie=()=>o(66486),ae=()=>o(363631),le=()=>o(221522),se=(o(581454),()=>o(907258)),ce=()=>o(242422),de=()=>o(609679),pe=()=>o(656704),ue=()=>o(597777),ge=()=>o(869190),me=()=>o(971404),ye=()=>o(68913),fe=()=>o(274570),Se=()=>o(42583),he=()=>o(680977),ve=()=>o(147294),xe=()=>o(828973);function be({collectionContextStore:e,property:t}){const o=(0,b().tz)(),n=(0,a().v3)(),r=(0,l().K8)((()=>Ce(e,t)),[e,t]),i=(0,l().K8)((()=>e.getPropertyFormat(t)),[e,t]),s=(0,l().K8)((()=>"date"===(null==r?void 0:r.type)&&ce().default.checkGate({gateName:"adoption_reminder_collection_default"})),[null==r?void 0:r.type]),c=function(){const e=(0,ve().oG)("collection_property_reminder"),t=(0,l().K8)((()=>{var e;return Boolean(null===(e=se().default.state.currentUserSettingsStore)||void 0===e?void 0:e.hasClickedCollectionPropertyReminderButton())}),[]);return e&&!t}();if(!r)return null;const d=s&&"date"===r.type,p=(null==i?void 0:i.date_format)||r.date_format||ue().vz,u=function(e){const t=Ae();for(const o in t)if(t[o]===e)return o;return"12h"}((null==i?void 0:i.time_format)||r.time_format||ue().CE),m="date"===r.type?function(e,t){if(void 0!==(null==t?void 0:t.default_reminder))return t.default_reminder;if(void 0!==e.default_reminder)return e.default_reminder;return}(r,i):void 0;return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(xe().A,{icon:Se().D,title:(0,U.jsx)(b().sA,{defaultMessage:"Date format",id:"database.viewSettings.dateOptions.dateFormat"}),selectedKey:p,popupStyle:{minWidth:190},options:ue().wJ.map((e=>({key:e,type:"button",title:o.formatMessage(ue().xz[e])}))),onChange:o=>function(e,t,o,n){const r=o.collectionStore(),i=Ce(o,n);if(!r||!i)return;const a={...i,date_format:e};E().createAndCommit({userAction:"CollectionSettingsDateOptions.handleDateFormatChange",environment:t,canUndo:!0,perform:e=>{(0,R().F)({environment:t,collectionStore:r,update:{[n]:a},transaction:e})}}),(0,w().V)({environment:t,collectionContextStore:o,property:n,from:"view_settings",action:"date_change_format"})}(o,n,e,t)}),(0,U.jsx)(xe().A,{icon:fe().clockIcon,title:(0,U.jsx)(b().sA,{defaultMessage:"Time format",id:"database.viewSettings.dateOptions.timeFormat"}),selectedKey:u,popupStyle:{minWidth:190},options:ue().ZD.map((e=>({key:e,type:"button",title:o.formatMessage(ue().px[e])}))),onChange:o=>function(e,t,o,n){const r=Ae()[e],i=o.collectionStore(),a=Ce(o,n);if(!i||!a)return;const l={...a,time_format:r};E().createAndCommit({userAction:"CollectionSettingsDateOptions.handleClockFormatChange",environment:t,canUndo:!0,perform:e=>{(0,R().F)({environment:t,collectionStore:i,update:{[n]:l},transaction:e})}}),(0,w().V)({environment:t,collectionContextStore:o,property:n,from:"view_settings",action:"date_change_time_format"})}(o,n,e,t)}),d?(0,U.jsx)(xe().A,{icon:ye().alarmIcon,title:(0,U.jsx)(g().m,{placement:"right",disableTooltip:!c,renderTooltip:()=>(0,U.jsx)("div",{style:{whiteSpace:"pre-wrap"},children:(0,U.jsx)(b().sA,{defaultMessage:"Default reminders for new dates",id:"database.viewSettings.dateOptions.reminderTooltip"})}),render:e=>c?(0,U.jsxs)("div",{...e,style:{display:"flex",alignItems:"center",gap:4},children:[(0,U.jsx)(b().sA,{defaultMessage:"Notifications",id:"database.viewSettings.dateOptions.reminder"}),(0,U.jsx)(ve().Ee,{newBadgeKey:"collection_property_reminder",didUserEngage:!c,keyType:"date",style:{marginInlineStart:2}})]}):(0,U.jsx)(b().sA,{defaultMessage:"Notifications",id:"database.viewSettings.dateOptions.reminder"})}),selectedKey:m,renderSelectedKey:e=>(0,pe().y)({reminder:e,shouldShowTime:!1,intl:o,formatTime:ge().fU}),popupStyle:{minWidth:190},options:ue().vK.map((e=>{const t=(0,pe().y)({reminder:e,shouldShowTime:!0,intl:o,formatTime:ge().fU});return{key:(0,ue().Mb)(e)?void 0:e,type:"button",title:t}})),onChange:o=>{!function(e,t,o,n){const r=o.collectionStore(),i=Ce(o,n);if(!r||!i)return;const a={...i,default_reminder:e};E().createAndCommit({userAction:"CollectionSettingsDateOptions.handleDefaultDateTimeReminderChange",environment:t,canUndo:!0,perform:e=>{(0,R().F)({environment:t,collectionStore:r,update:{[n]:a},transaction:e})}}),(0,w().V)({environment:t,collectionContextStore:o,property:n,from:"view_settings",action:"date_change_reminder_default"})}(o,n,e,t)},onClick:()=>{!function(e){const{environment:t}=e,{currentUserSettingsStore:o}=se().default.state;if(!o)return;const n=e=>{(0,he().m)({userSettingsStore:o,transaction:e,data:{collection_property_reminder_button_clicked_at:Date.now()}})};E().createAndCommit({environment:t,userAction:"userClickedCollectionPropertyReminderButton",canUndo:!1,cellTarget:"main",perform:e=>n(e)})}({environment:n})}}):null]})}function Ce(e,t){const o=e.normalizedSchemaStore.state[t];if(o)return"date"===o.type||"created_time"===o.type||"last_edited_time"===o.type||"last_visited_time"===o.type?o:void 0}function Ae(){return(0,me().X)(de().locale).time}var je=()=>o(360576),we=()=>o(788621);function Te(e){const{collectionContextStore:t,property:o,propertySchema:r}=e,i=(0,a().v3)(),l=(0,n.useCallback)((e=>{const n={...r,default:"created_by"===e?"created_by":void 0},a=t.collectionStore();a&&((0,_().p)({environment:i,collectionStore:a,performTransaction:t=>{E().applyOperation({store:(0,d().v3)(a,a.pointer),operation:{pointer:a.pointer,command:"update",path:["schema",o],args:{default:e}},transaction:t})}}),E().createAndCommit({userAction:"CollectionSettingsDefaultPersonPicker.handleChange",environment:i,canUndo:!0,perform:e=>{(0,R().F)({environment:i,collectionStore:a,update:{[o]:n},transaction:e})}}))}),[t,i,o,r]);return(0,U.jsx)(xe().A,{icon:we().personCircleIcon,title:(0,U.jsx)(b().sA,{defaultMessage:"Default",id:"CollectionSettingsDefaultPersonPicker.default.title"}),selectedKey:r.default?"created_by":"no_default",popupStyle:{minWidth:190},options:[{key:"no_default",type:"button",title:(0,U.jsx)(b().sA,{defaultMessage:"No default",id:"CollectionSettingsDefaultPersonPicker.options.noDefault"})},{key:"created_by",type:"button",title:(0,U.jsx)(b().sA,{defaultMessage:"Created by",id:"CollectionSettingsDefaultPersonPicker.options.creator"}),icon:(0,U.jsx)(u().I,{icon:je().personFillSmallIcon,size:"sm"})}],onChange:l})}var Me=()=>o(546926),Pe=()=>o(764781),ke=()=>o(798880),Ie=()=>o(436696),_e=()=>o(770703),Re=()=>o(999140),Be=()=>o(232930),Oe=()=>o(95441),De=()=>o(35091);const Fe=n.memo((function(e){const{environment:t,property:n,propertySchema:r,collectionContextStore:i,collectionStore:a}=e,s=(0,l().K8)((()=>null==a?void 0:a.getSpaceId()),[a]),c=(0,o(528093)._)({name:"collection_property_autofill",spaceId:s,userId:t.currentUser.id,amount:"unknown"}),d=(0,l().K8)((()=>{const e=i.collectionStore();return e&&(0,F().jq)(Z().A.getMode(t,e,e.getSpaceStore()),e)}),[t,i]);return(0,l().K8)((()=>(0,f().lx)(r)&&r.select_ai_inference),[r])&&c?(0,U.jsx)(o(385685).Ve,{environment:t,collectionContextStore:i,collectionStore:a,property:n,propertySchema:r,autofillFeatureAvailability:c,isAutofillSetupEnabled:Boolean(d)}):null}));var Ke=()=>o(895876);o(354520);function Ve(e){const{collectionContextStore:t,formatKey:o,property:n}=e,r=Ne({formatKey:o,collectionContextStore:t});return r&&0!==r.length?r.filter((e=>e.visible)).findIndex((e=>e.property===n)):-1}function Ne(e){const{formatKey:t,collectionContextStore:o}=e;if(!t)return[];var n;if("collection_page_properties"===t)return(null===(n=o.collectionStore())||void 0===n?void 0:n.getFormat().collection_page_properties)??[];return o.normalizedFormatStore.state[t]||[]}const ze=n.memo((function(e){const{isRequiredTypedProperty:t,databaseType:r,collectionContextStore:l,property:c,collectionSettingsStore:d,formatKey:p}=e,m=(0,s().DP)(),y=(0,a().v3)(),f=(0,n.useCallback)((async()=>{const e=l.normalizedSchemaStore.state,t=l.collectionStore(),n=(0,S()._g)({schema:e,property:c}),r=!!n&&(0,o(102897).J)(n);await o(828661).q({environment:y,collectionContextStore:l,property:c,handleDeleteAccept:function(){n&&(t&&E().createAndCommitAsync({environment:y,userAction:"CollectionSettingsProperty.handleDeleteAccept",waitForServerCommit:!1,perform:async n=>{await(0,o(30244).P)({environment:y,collectionStore:t,schema:e,property:c,transaction:n,permanentlyDelete:r});const i=Ve({property:c,formatKey:p,collectionContextStore:l});_e().sp({environment:y,collectionContextStore:l,currentIndex:i,entrypoint:"CollectionSettingsProperty",transaction:n,propertyAction:"delete"})}}),Q().yl({collectionSettingsStore:d}),(0,Ie().X)({environment:y,collectionContextStore:l,action:"delete_property",property_type:null==n?void 0:n.type}),(0,o(966759).i)({environment:y,collectionContextStore:l,property_type:n.type,from:"view_settings",property:c}))},theme:m,from:"view_settings",isPermanentlyDelete:r})}),[l,d,y,p,c,m]),h=(0,n.useCallback)((e=>(0,Ke().eF)(r,e)),[r]),v=(0,n.useCallback)((e=>t?(0,U.jsx)("div",{...e,style:{display:"inline-flex"},children:(0,U.jsx)(u().I,{icon:o(471095).lockFillIcon})}):(0,U.jsx)(u().I,{icon:o(236262).trashIcon})),[t]),x=(0,n.useCallback)((e=>(0,U.jsx)(ne().A,{...e,isRedOnHover:!0,disabled:t,onClick:f,icon:()=>v(e),title:(0,U.jsx)(b().sA,{defaultMessage:"Delete property",id:"database.viewSettings.propertyTab.deleteButton.title"}),caption:i().A.isMobile&&t?(0,Ke().eF)(r):void 0})),[r,f,v,t]);return(0,U.jsx)(g().m,{disableTooltip:!t,placement:"left",renderTooltip:h,render:x})}));var Ee=()=>o(673099);const We=n.memo((function(e){const{collectionContextStore:t,property:o,extraPadding:n}=e,r=(0,l().O$)(t.normalizedSchemaStore)[o];return(0,S().di)(r)?(0,U.jsx)(m().A,{extraPadding:n,topBorder:!0,children:(0,U.jsx)(Oe().A,{href:(0,Be().x)("guides.githubRelation"),title:(0,U.jsx)(b().sA,{defaultMessage:"Learn about GitHub Pull Requests",id:"database.viewSettings.propertyTab.githubPrRelation.learnMoreButton.title"}),analyticsFrom:"view_settings_property_github_pr_relation"})}):(0,S().V5)(r)?(0,U.jsxs)(m().A,{extraPadding:n,topBorder:!0,children:[(0,U.jsx)(Ee().p,{}),(0,U.jsx)(Ee().b,{})]}):(0,U.jsx)(m().A,{extraPadding:n,topBorder:!0,children:(0,U.jsx)(Oe().A,{href:(0,Be().x)("guides.relations"),title:(0,U.jsx)(b().sA,{defaultMessage:"Learn about relations",id:"database.viewSettings.propertyTab.relations.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"})})})),qe=n.memo((function(e){const{propertySchema:t,propertyFormat:r,isRequiredTypedProperty:i,databaseType:s,collectionContextStore:c,formatKey:d,property:p,collectionSettingsStore:u,wrapProperty:g}=e,y=(0,a().v3)(),h=(0,Me().Tf)(),v=(0,n.useCallback)((()=>function(e,t,o,n,r){const i=function(e){const{collectionContextStore:t,formatKey:o,property:n}=e,r=Ne({formatKey:o,collectionContextStore:t});return r&&0!==r.length?r.find((e=>e.property===n)):-1}({property:n,formatKey:o,collectionContextStore:t}),a=t.collectionViewStore(),l=t.normalizedFormatStore.state,s=(0,ee().Jq)({collectionContextStore:t,property:n});if(!(i&&a&&o&&s))return;_e().Nv({currentValue:r,environment:e,property:n,collectionViewStore:a,format:l,formatKey:o}),(0,Ie().X)({environment:e,collectionContextStore:t,action:"toggle_property_wrap",original_view_type:a.getType(),property_type:s.type})}(y,c,d,p,g)),[y,c,d,p,g]),x=(0,l().K8)((()=>c.collectionStore()),[c]),C=(0,l().K8)((()=>c.getViewType()),[c]),j=(0,X().a)(),w=(0,l().K8)((()=>P(s,c.normalizedSchemaStore.state,p)),[s,c,p]),T=(0,l().K8)((()=>!!C&&(d&&(0,Re().hc)({viewType:C,property:p}))),[d,p,C]),M=(0,l().K8)((()=>u.state.hideDuplicatePropertyOption),[u]),k=(0,f().vB)(t)&&Boolean(x)&&!j&&"form_editor"!==C&&!M,I=f().cN.includes(t.type)&&x&&!j&&"form_editor"!==C,_="form_editor"===C;return T||k||I||_?(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(m().A,{topBorder:!0,disableMobilePadding:!h,extraPadding:!0,children:[T&&r?(0,U.jsx)(De().A,{icon:o(871114).o,title:(0,U.jsx)(b().sA,{defaultMessage:"Wrap content",id:"database.viewSettings.propertyTab.wrapContentButton.title"}),switcherProps:{on:g,disallowTabbing:!0},onClick:v}):void 0,"status"===t.type?(0,U.jsx)(o(422068).u,{collectionContextStore:c,property:p,disabled:w}):void 0,x?(0,U.jsx)(Fe,{environment:y,collectionStore:x,collectionContextStore:c,property:p,propertySchema:t}):void 0,k?(0,U.jsx)(ne().A,{icon:Pe().V,title:(0,U.jsx)(b().sA,{defaultMessage:"Duplicate property",id:"database.viewSettings.propertyTab.duplicateButton.title"}),onClick:()=>async function(e,t,n,r,i){const a=Ne({formatKey:i,collectionContextStore:n}),l=n.normalizedSchemaStore.state,s=n.collectionStore(),c=null==s?void 0:s.getSpaceId();if(!s||!c)return;const d=(0,S()._g)({schema:l,property:t});if(!d)return;const p=s.getNormalizedPropertyGroups(),u=await(0,Re().W4)({environment:e,schema:l,property:t,properties:a,propertyGroups:p,parentStore:s,spaceId:c});if(!u)return;const g=e.currentUser.id,m=g?{id:g,table:ke().oo}:void 0,y=n.collectionViewStore();E().createAndCommit({userAction:"CollectionSettingsProperty.handleDuplicateClick",environment:e,canUndo:!0,perform:r=>{(0,A().O9)(u.automationUpdate)&&(0,o(324587).duplicateAutomation)({actorPointer:m,environment:e,sourceAutomationStore:u.automationUpdate.sourceAutomationStore,targetAutomationId:u.automationUpdate.targetAutomationId,transaction:r});const a={...l,[u.newProperty]:u.newPropertySchema},c={...s.getFormat(),collection_page_properties:u.newProperties,property_groups:u.newPropertyGroups};(0,o(797535).I)({environment:e,collectionStore:s,update:{schema:a,format:c},transaction:r});const d=Ve({property:t,formatKey:i,collectionContextStore:n});_e().sp({environment:e,collectionContextStore:n,currentIndex:d,entrypoint:"CollectionSettingsProperty",transaction:r,propertyAction:"duplicate"}),i&&y&&o(896628).zA({stores:[y],update:{[i]:u.newProperties},transaction:r})}}),Q().os({collectionSettingsStore:r}),(0,Ie().X)({collectionContextStore:n,environment:e,action:"duplicate_property",original_view_type:null==y?void 0:y.getType(),property_type:d.type})}(y,p,c,u,d)}):void 0,I?(0,U.jsx)(ze,{collectionContextStore:c,property:p,collectionSettingsStore:u,formatKey:d,isRequiredTypedProperty:i,databaseType:s}):void 0,_?(0,U.jsx)(Oe().A,{href:(0,Be().x)("guides.databaseProperties"),title:(0,U.jsx)(b().sA,{defaultMessage:"Learn about properties",id:"database.viewSettings.propertiesTab.learnMoreButton.title"}),analyticsFrom:"view_settings_properties"}):void 0]}),"formula"===t.type?(0,U.jsx)(m().A,{topBorder:!0,children:(0,U.jsx)(Oe().A,{href:(0,Be().x)("guides.formulas"),title:(0,U.jsx)(b().sA,{defaultMessage:"Learn about formulas",id:"database.viewSettings.propertyTab.formulas.learnMoreButton.title"}),analyticsFrom:"view_settings_property_formula"})}):void 0,"relation"===t.type?(0,U.jsx)(We,{collectionContextStore:c,property:p,extraPadding:!0}):void 0,"rollup"===t.type?(0,U.jsx)(m().A,{topBorder:!0,children:(0,U.jsx)(Oe().A,{href:(0,Be().x)("guides.relations"),title:(0,U.jsx)(b().sA,{defaultMessage:"Learn about rollups",id:"database.viewSettings.propertyTab.rollups.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"})}):void 0]}):null}));var Ue=()=>o(158797),Le=()=>o(283860),He=()=>o(992307),Ge=()=>o(913687),$e=()=>o(113105),Ye=(o(737550),()=>o(564884)),Je=()=>o(98126),Xe=()=>o(617871),Ze=()=>o(449268),Qe=()=>o(202017),et=()=>o(462853),tt=()=>o(817126),ot=()=>o(534239);const nt=(0,b().YK)({databaseActionsTitle:{defaultMessage:"Database actions",id:"database.viewSettings.connectedRelationSettings.databaseActions"},addPropertiesTitle:{defaultMessage:"Add properties",id:"database.viewSettings.connectedRelationSettings.addPropertiesTitle"},databaseActionsDisabledWhileSyncing:{defaultMessage:"Cannot edit while syncing",id:"database.viewSettings.connectedRelationSettings.databaseActionsDisabledWhileSyncing"},syncInProgress:{defaultMessage:"Sync in progress",id:"database.viewSettings.salesforceConfigTab.syncInProgress"},syncInProgressDescription:{defaultMessage:"Fetching the latest data from Salesforce…",id:"database.viewSettings.salesforceConfigTab.syncInProgressDescription"},linkPreviewTitle:{defaultMessage:"Preview",id:"database.viewSettings.salesforceConfigTab.linkPreviewTitle"},featureUnavailableTooltip:{defaultMessage:"{upsellTier, select, plus {Plus} business {Business} enterprise {Enterprise} other {}} plan is required to access this feature",id:"database.viewSettings.collectionSettingsDatabaseActionsConfig.featureUnavailableTooltip"}});function rt(e){const t=(0,et().l)(e.integrationId);return t?(0,U.jsx)(it,{...e,featureName:t}):(0,U.jsx)(at,{...e,upsellInfo:void 0})}function it(e){const{featureName:t,collectionContextStore:o,...n}=e,r=(0,l().K8)((()=>o.collectionStore()),[o]),i=(0,tt().uF)({featureName:t,collectionStore:r});return(0,U.jsx)(at,{...n,collectionContextStore:o,upsellInfo:i})}function at(e){const{collectionContextStore:t,property:o,connectedRelationPatternName:r,integrationId:i,propertySchema:a,environment:s,upsellInfo:c}=e,d=(0,b().tz)(),p=(0,l().K8)((()=>{if(a&&(0,f().UU)(a)&&a.connectedRelation.integration_id===Xe().mn)return a.collection_pointer}),[a]),{format:u,loading:g}=(0,ot().e8)(p,{debugName:"CollectionSettingsDatabaseActionsConfig"}),m=(0,n.useMemo)((()=>{var e;return!!u&&Boolean(null===(e=u.sync_state)||void 0===e?void 0:e.syncing)}),[u]),y=c&&!c.isAvailable;return(0,U.jsxs)(U.Fragment,{children:[m?(0,U.jsx)(st,{}):(0,U.jsx)(lt,{}),g?(0,U.jsx)(Je().k,{}):(0,U.jsx)(ct,{disabled:m||y,disabledTooltipMessage:y?d.formatMessage(nt.featureUnavailableTooltip,{upsellTier:null==c?void 0:c.upsellTier}):void 0,collectionContextStore:t,property:o,connectedRelationPatternName:r,integrationId:i,propertySchema:a,environment:s})]})}function lt(){const e=dt();return(0,U.jsx)(m().A,{disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,mobileStyle:e.previewContentContainer,title:(0,U.jsx)(b().sA,{...nt.linkPreviewTitle}),children:(0,U.jsx)("div",{children:(0,U.jsx)("img",{src:K().A.images.externalIntegrations.salesforceLinkpreviewPng,style:e.previewContentContainer,alt:"Paste Salesforce URLs to create a Salesforce property."})})})}function st(){const e=(0,s().IS)((()=>({borderedContainer:{borderRadius:6,borderStyle:"solid",borderWidth:1,borderColor:C().Tj.border.secondary,paddingTop:16,paddingInlineEnd:12,paddingBottom:16,paddingInlineStart:12,gap:6,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",margin:"8px"},header:{fontWeight:N().Wy.medium,color:C().Tj.text.primary,fontSize:N().J.UIRegular.desktop},captionText:{fontSize:N().J.UISmall.desktop,color:C().Tj.text.secondary,fontWeight:N().Wy.regular,textAlign:"center"},iconGroup:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gridColumnGap:10,height:36,width:36}})),[]);return(0,U.jsxs)(m().A,{style:e.borderedContainer,children:[(0,U.jsx)("div",{style:e.iconGroup,children:(0,U.jsx)(u().I,{icon:Ze().C,size:"xl",colorVariant:"secondary"})}),(0,U.jsx)("div",{style:e.header,children:(0,U.jsx)(b().sA,{...nt.syncInProgress})}),(0,U.jsx)("div",{style:e.captionText,children:(0,U.jsx)(b().sA,{...nt.syncInProgressDescription})})]})}function ct({collectionContextStore:e,property:t,connectedRelationPatternName:o,integrationId:n,propertySchema:r,environment:i,disabled:a,disabledTooltipMessage:s}){const c=dt(),d=(0,b().tz)(),p=e.settingsStore,u=(0,l().K8)((()=>{var t;const o=null==e||null===(t=e.collectionStore())||void 0===t?void 0:t.getSchema();return o&&Object.values(o).some((e=>e&&"url"===e.type))}),[e]);return(0,U.jsx)(m().A,{disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,mobileStyle:c.previewContentContainer,title:(0,U.jsx)(b().sA,{...nt.databaseActionsTitle}),children:(0,U.jsx)(g().m,{disableTooltip:!a,renderTooltip:e=>(0,U.jsx)("div",{...e,style:te().Q$,children:s||d.formatMessage(nt.databaseActionsDisabledWhileSyncing)}),render:l=>(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(ne().A,{...l,showChevron:!0,title:(0,U.jsx)(b().sA,{...nt.addPropertiesTitle}),icon:Qe().n,disabled:a,onClick:()=>{const a=e.collectionStore();(0,Ye().u)({environment:i,event:{eventName:"salesforce_actions",eventProperties:{actionType:"add_properties_clicked",collectionId:null==a?void 0:a.id,integrationId:n,details:{source:"edit_property"}}}}),Q().a2({collectionSettingsStore:p,item:{type:"connectedRelationDatabaseActions",source:"connectedRelationAddProperties",rootPropertyId:t,connectedRelationPatternName:o,integrationId:n,rootPropertySchema:r,eventSource:"edit_property"}})}}),(0,U.jsx)(ne().A,{...l,showChevron:!0,title:(0,U.jsx)(b().sA,{defaultMessage:"Populate property",id:"database.viewSettings.salesforceConfigTab.populateProperty"}),icon:Pe().V,disabled:a,onClick:()=>{Q().a2({collectionSettingsStore:p,item:{type:"connectedRelationDatabaseActions",source:"connectedRelationCopyUrl",rootPropertyId:t,connectedRelationPatternName:o,integrationId:n,rootPropertySchema:r}});const a=e.collectionStore();(0,Ye().u)({environment:i,event:{eventName:"salesforce_actions",eventProperties:{actionType:"navigate_to_copy_url",collectionId:null==a?void 0:a.id,integrationId:n,details:{source:"edit_property",isCopyUrlDisabled:!u}}}})}})]})})})}function dt(){return(0,s().IS)((()=>({previewContentContainer:{display:"flex",alignSelf:"center",flexDirection:"column",width:"100%",paddingInlineStart:8,paddingInlineEnd:8,cursor:"default"},tabDescription:{padding:i().A.isMobile?18:10,fontSize:i().A.isMobile?16:12,color:C().Tj.text.tertiary}})),[])}var pt=()=>o(838038),ut=()=>o(896427);function gt(e){const{collectionContextStore:t,property:o,targetCollectionStore:r}=e,i=(0,a().v3)(),s=(0,b().tz)(),c=(0,l().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.id}),[t]),d=(0,l().K8)((()=>t.contextTypeFromStoreState),[t]),[p,u]=(0,n.useState)(void 0),g=Boolean(r&&c===r.id),m=(0,n.useCallback)((()=>{if(!p)return;const{hasInverseRelation:e,inverseName:n,autoRelate:r}=p;E().createAndCommit({userAction:"CollectionSettingsRelationOptions.handleEditRelation",environment:i,canUndo:!0,perform:a=>{pt().Go({environment:i,collectionContextStore:t,property:o,hasInverseRelation:e,inverseName:n,autoRelate:r,intl:s,transaction:a})}}),(0,w().V)({environment:i,collectionContextStore:t,property:o,from:"collectionPage"===d?"page_properties":"view_settings",action:"relation_edit",is_self_relation:g,has_inverse:e,auto_relate:null==r?void 0:r.enabled}),u(void 0)}),[p,i,t,o,d,g,s]);return(0,U.jsx)(ut().Ay,{collectionContextStore:t,targetCollectionStore:r,property:o,temporaryInverseState:p,setTemporaryInverseState:u,onSubmit:m})}var mt=()=>o(860037);function yt(e){const{collectionContextStore:t,property:o}=e,n=(0,a().v3)(),r=(0,l().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.id}),[t]),i=(0,l().K8)((()=>$e().Jq(t,o)),[t,o]),s=(0,l().K8)((()=>{const e=t.collectionViewBlockStore();return(0,ee().k7)(e,i)}),[t,i]),c=Boolean(s&&r===s.id),d=i&&(0,f().UU)(i)?i.connectedRelation:void 0,{isConnectedRelationDatabaseActionsSupported:p,connectedRelationPatternName:u,integrationId:g}=(0,l().K8)((()=>{const e=t.normalizedSchemaStore.state[o],n=null==e?void 0:e.name,r=(0,S().Dz)(e);return{isConnectedRelationDatabaseActionsSupported:(0,S().Mn)(r),connectedRelationPatternName:n,integrationId:r}}),[t,o]);if(!s)return null;const m=i&&!(0,S().H6)(i)&&!(0,S().KF)(i);return(0,U.jsxs)(U.Fragment,{children:[!d&&m?(0,U.jsx)(mt().A,{isSelfRelation:c,collectionStore:s,showAs:"link",disabled:!0}):void 0,m?(0,U.jsx)(He().Z,{collectionContextStore:t,propertySchema:i,property:o}):void 0,p&&u&&g?(0,U.jsx)(rt,{collectionContextStore:t,property:o,connectedRelationPatternName:u,integrationId:g,propertySchema:i,environment:n}):void 0,Boolean(d)?void 0:(0,U.jsx)(gt,{collectionContextStore:t,property:o,targetCollectionStore:s})]})}var ft=()=>o(782482),St=()=>o(695115),ht=()=>o(81068),vt=()=>o(582684),xt=()=>o(617668),bt=()=>o(389783),Ct=()=>o(480912),At=()=>o(173868),jt=()=>o(419357),wt=()=>o(271205),Tt=()=>o(784892),Mt=()=>o(908201),Pt=()=>o(814777),kt=()=>o(399762);function It(e){var t;const o=(0,a().v3)(),r=(0,s().DP)(),{property:c,option:u,statusGroup:m,propertySchema:y,isDefault:f,disabled:S}=e,h=(0,Mt().ET)(),v=(0,l().K8)((()=>{var e;return null===(e=h.collectionStore())||void 0===e?void 0:e.id}),[h]),x=(0,l().uB)(void 0,p().A),C=(0,l().K8)((()=>x.state.open),[x]),A=(0,n.useCallback)((()=>{x.setState({open:!0})}),[x]),j=(0,n.useCallback)((()=>{x.setState({open:!1})}),[x]),w=(0,n.useCallback)((e=>{const t=h.collectionStore();t&&(0,_().p)({environment:o,collectionStore:t,performTransaction:o=>{for(const n of e)E().applyOperation({store:(0,d().v3)(t,n.pointer),operation:n,transaction:o})}})}),[h,o]),T=(0,s().IS)((()=>({defaultText:{fontSize:12,fontWeight:500,textTransform:"uppercase"}})),[]);return v?(0,U.jsx)(Pt().h,{open:C,origin:(0,U.jsx)(g().m,{renderTooltip:e=>(0,U.jsxs)("div",{...e,style:te().Q$,children:[(0,U.jsx)("div",{children:u.value}),(0,U.jsx)("div",{style:{color:r.text.inverseSecondary},children:u.description})]}),placement:"left",disableTooltip:!(null!==(t=u.description)&&void 0!==t&&t.length),render:t=>{var o,n;return(0,U.jsx)(ne().A,{desktopTitleStyle:{marginInlineStart:-2},...t,showDragHandle:!i().A.isMobile,showChevron:!0,disabled:S,rotateChevron:C,reducedPadding:e.reducedPadding,title:"status"===y.type?(0,U.jsx)(kt().q,{format:i().A.isMobile?Tt().NY.Large:Tt().NY.Medium,value:u.value,color:u.color,hideTooltip:Boolean(null===(o=u.description)||void 0===o?void 0:o.length),tooltipPlacement:"left",showRemoveButton:!1,isSingle:!0,groupColor:null==m?void 0:m.color}):(0,U.jsx)(kt().O,{format:i().A.isMobile?Tt().NY.Large:Tt().NY.Medium,value:u.value,color:u.color,hideTooltip:Boolean(null===(n=u.description)||void 0===n?void 0:n.length),tooltipPlacement:"left",showRemoveButton:!1,isSingle:!0}),right:f?(0,U.jsx)("span",{style:T.defaultText,children:(0,U.jsx)(b().sA,{id:"database.statusProperty.default",defaultMessage:"Default"})}):void 0,onClick:A})}}),option:u,property:c,propertySchema:y,statusGroup:m,collectionId:v,analyticsFrom:"view_settings",alignmentToOrigin:"end",onChange:w,onClose:j}):null}const _t=o(757695).Store.createClass(void 0,{name:"InputGroupIndexStore"});function Rt(e){const{collectionContextStore:t,property:o,disabled:r,aIAutofillOption:i}=e,s=(0,a().v3)(),c=(0,l().uB)(void 0,_t),[p,u]=(0,n.useState)({inputValue:"",focus:!1}),g=(0,l().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getSchema()}),[t]),m=(0,l().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[t]),y=(0,l().K8)((()=>Ot(t,o)),[t,o]),S=(0,l().O$)(c);if(!g||!y)return null;if("status"===y.type){const e=y.groups??[];if(0===e.length)return null;const n=y.options??[],i=e.map((e=>{const t=n.filter((t=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return{group:e,groupOptions:t}})),a=y.defaultOption,l=[...i[0].groupOptions.map((e=>e.value))];for(const{group:t,groupOptions:o}of i.slice(1))l.push({key:`group-header-${t.name}`,draggable:!1}),l.push(...o.map((e=>e.value)));const d=P(m,g,o)?{tooltipCaption:(0,U.jsx)(b().sA,{defaultMessage:"These options are core to the property and cannot be changed.",id:"database.viewSettings.selectOptions.disabledGroupMessage"})}:void 0,f=(l,s)=>{if(l.startsWith("group-header-")){const e=l.substring(13),n=i.findIndex((({group:t})=>t.name===e)),{group:a,groupOptions:s}=i[n];return(0,U.jsxs)(Bt,{title:(0,U.jsx)(Ct().RS,{disableGroup:d,group:a,showIcon:!1}),right:(0,U.jsx)(Dt,{collectionContextStore:t,property:o,onClick:e=>Kt(u,c,n),isVisible:!p.focus}),disabled:r,children:[S===n?(0,U.jsx)(Vt,{collectionContextStore:t,property:o,input:p,setInput:u,inputGroupIndexStore:c}):void 0,(0,U.jsx)(Nt,{setInput:u,inputGroupIndexStore:c,groupIndex:n,visible:!p.focus&&0===s.length})]})}{const t=n.find((e=>e.value===l));if(!t)return null;const i=e.find((e=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return(0,U.jsx)(It,{option:t,statusGroup:i,propertySchema:y,property:o,isDefault:t.value===a,disabled:r},t.value)}};return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(Bt,{title:(0,U.jsx)(Ct().RS,{disableGroup:d,group:i[0].group}),right:(0,U.jsx)(Dt,{collectionContextStore:t,property:o,onClick:()=>Kt(u,c,0),isVisible:!p.focus}),disabled:r,children:[0===S?(0,U.jsx)(Vt,{collectionContextStore:t,property:o,input:p,setInput:u,inputGroupIndexStore:c}):void 0,(0,U.jsx)(Nt,{setInput:u,inputGroupIndexStore:c,groupIndex:0,visible:!p.focus&&0===i[0].groupOptions.length})]}),(0,U.jsx)(wt().Ay,{direction:"vertical",keys:l,renderKey:f,onDrop:e=>Ft(e,s,o,t),disabled:r})]})}{const e=y.options??[],n=e.map((e=>e.value)),a=y.auto_sort_options||"manual";return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(xe().A,{icon:vt().arrowUpDownIcon,title:(0,U.jsx)(b().sA,{defaultMessage:"Sort",id:"database.viewSettings.selectOptions.autoSort"}),selectedKey:a,options:[{key:"manual",type:"button",title:(0,U.jsx)(b().sA,{defaultMessage:"Manual",id:"database.viewSettings.selectOptions.autoSort.none"})},{key:"alphabetical",type:"button",title:(0,U.jsx)(b().sA,{defaultMessage:"Alphabetical",id:"database.viewSettings.selectOptions.autoSort.alphabetical"})},{key:"reverse_alphabetical",type:"button",title:(0,U.jsx)(b().sA,{defaultMessage:"Reverse alphabetical",id:"database.viewSettings.selectOptions.autoSort.reverseAlphabetical"})}],onChange:e=>function(e,t,o,n){const r=o.collectionStore(),i=o.normalizedSchemaStore.state,a=Ot(o,n);if(!r||!a)return;if(!(0,f().lx)(a))return;const l=[{pointer:r.pointer,command:"update",path:["schema",n],args:{auto_sort_options:e}}];"alphabetical"!==e&&"reverse_alphabetical"!==e||l.push(...function(e){const{collectionId:t,property:o,propertySchema:n,schema:r,isAscending:i}=e,a=n.options||[],l=[...a].map((e=>e.value)).sort(((e,t)=>e.localeCompare(t,void 0,{sensitivity:"base"})*(i?1:-1)));return(0,At().o)({newOptions:l,collectionId:t,property:o,schema:r})}({collectionId:r.id,property:n,propertySchema:a,schema:i,isAscending:"alphabetical"===e})||[]);(0,_().p)({environment:t,collectionStore:r,performTransaction:e=>{for(const t of l)E().applyOperation({store:(0,d().v3)(r,t.pointer),operation:t,transaction:e})}}),(0,w().V)({environment:t,collectionContextStore:o,property:n,from:"view_settings",action:"select_change_auto_sort_options"})}(e,s,t,o),popupStyle:{minWidth:190}},"autoSortMenuItem"),i,(0,U.jsxs)(Bt,{topBorder:!0,overrideStyle:{marginTop:4,marginInlineStart:-4,width:"calc(100% + 8px)"},title:(0,U.jsx)(b().sA,{defaultMessage:"Options",id:"database.viewSettings.selectOptions.title"}),right:(0,U.jsx)("div",{style:{marginInlineEnd:-2},children:(0,U.jsx)(Dt,{collectionContextStore:t,property:o,onClick:()=>Kt(u,c),isVisible:!p.focus&&n.length>0})}),disabled:r,children:[(0,U.jsx)(Vt,{collectionContextStore:t,property:o,input:p,setInput:u,inputGroupIndexStore:c}),(0,U.jsx)(Nt,{setInput:u,inputGroupIndexStore:c,visible:!p.focus&&0===n.length})]},"sectionHeader"),n.length>0?(0,U.jsx)(wt().Ay,{style:{marginBottom:2},direction:"vertical",keys:n,renderKey:t=>{const n=e.find((e=>e.value===t));return n?(0,U.jsx)(It,{option:n,property:o,propertySchema:y,isDefault:!1,statusGroup:void 0,disabled:r,reducedPadding:!0},n.value):null},onDrop:e=>Ft(e,s,o,t)}):void 0]})}}function Bt({title:e,right:t,children:o,disabled:n,overrideStyle:r,topBorder:i}){const a=(0,Me().Tf)(),l=(0,s().IS)((()=>({desktop:{width:"100%",paddingBottom:0,...r},desktopTitle:{height:20},mobile:{...a&&{borderRadius:0}},mobileTitle:{...a&&{paddingTop:12,paddingBottom:4,minHeight:44}}})),[a,r]);return(0,U.jsx)(m().A,{title:e,right:!n&&t,style:l.desktop,desktopTitleStyle:l.desktopTitle,mobileStyle:l.mobile,mobileTitleStyle:l.mobileTitle,disableMobilePadding:!!a||void 0,topBorder:i,children:n?void 0:o})}function Ot(e,t){const o=e.normalizedSchemaStore.state[t];if(o&&((0,f().lx)(o)||"status"===o.type))return o}function Dt({onClick:e,collectionContextStore:t,property:o,isVisible:n}){const r=(0,b().tz)();return(0,l().K8)((()=>Ot(t,o)),[t,o])?(0,U.jsx)(St().A,{icon:xt().plusIcon,size:"md",onClick:e,style:{width:20,height:20,visibility:n?void 0:"hidden"},disabled:!n,ariaLabel:r.formatMessage({defaultMessage:"Add an option",id:"database.viewSettings.selectOptions.addOption"})}):null}function Ft(e,t,o,n){const r=n.normalizedSchemaStore.state,i=n.collectionStore();i&&(bt().gc({newValues:e,property:o,schema:r,collectionStore:i,environment:t}),(0,w().V)({environment:t,collectionContextStore:n,property:o,from:"view_settings",action:"select_options_reorder"}))}function Kt(e,t,o){e({focus:!0,inputValue:""}),void 0!==o&&t.setState(o)}function Vt({collectionContextStore:e,property:t,input:o,setInput:r,inputGroupIndexStore:l}){const c=(0,a().v3)(),d=(0,b().tz)(),p=(0,n.useCallback)((n=>{null==n||n.stopPropagation(),function(e,t,o,n,r,i){const a=t.collectionStore(),l=Ot(t,o);if(!l||!a)return;const s=l.options||[],c=n.inputValue.trim();if(c)if("status"===l.type){const t=i.state;let n;if(void 0!==t&&(n=s.find((e=>{var o;return null===(o=l.groups)||void 0===o||null===(o=o[t].optionIds)||void 0===o?void 0:o.includes(e.id)}))),void 0===t||void 0!==n)bt().Uk({modification:{type:"keyedObjectListBefore",beforeOption:n,newValue:c},property:o,propertySchema:l,options:s,environment:e,collectionStore:a,groupIndex:t});else{let n;for(let e=t-1;e>=0;e--){var d;const t=null===(d=l.groups)||void 0===d?void 0:d[e];if(t&&(n=s.find((e=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)})),void 0!==n))break}bt().Uk({modification:{type:"keyedObjectListAfter",afterOption:n,newValue:c},property:o,propertySchema:l,options:s,environment:e,collectionStore:a,groupIndex:t})}}else!(0,f().lx)(l)||"alphabetical"!==l.auto_sort_options&&"reverse_alphabetical"!==l.auto_sort_options?bt().Uk({modification:{type:"keyedObjectListBefore",newValue:c},property:o,propertySchema:l,options:s,environment:e,collectionStore:a}):bt().Uk({modification:{type:"autoSortInsert",newValue:c},property:o,propertySchema:l,options:s,environment:e,collectionStore:a});r({focus:!0,inputValue:""}),(0,w().V)({environment:e,collectionContextStore:t,property:o,from:"view_settings",action:"select_add_option",option_value_char_count:c.length})}(c,e,t,o,r,l)}),[c,e,t,o,r,l]),u=(0,n.useCallback)((e=>function(e,t){t({focus:!0,inputValue:e.target.value.replace(/,/g,"")})}(e,r)),[r]),g=(0,n.useCallback)((()=>function(e,t,o){o({focus:!1,inputValue:i().A.isMobile?t.inputValue:""})}(0,o,r)),[c,o,r]),m=(0,X().a)(),y=(0,s().IS)((()=>({inputOuterStyle:m?{backgroundColor:C().Tj.background.primary}:{},inputMenuItem:{marginTop:2,marginBottom:8}})),[m]);return o.focus?(0,U.jsx)(ft().N,{debugName:"CollectionSettingsSelectOptions",capture:!0,onEsc:g,children:(0,U.jsx)(jt().Ay,{value:o.inputValue,focus:!0,placeholder:d.formatMessage({defaultMessage:"Type a new option…",id:"database.viewSettings.selectOptions.newSelectOption.inputPlaceholder"}),style:y.inputMenuItem,inputOuterStyle:y.inputOuterStyle,onChange:u,onBlur:g,onSubmit:p,mobileKeyboardOnDismiss:p})}):null}function Nt({groupIndex:e,setInput:t,inputGroupIndexStore:o,visible:n}){return(0,U.jsx)(ht().A,{icon:(0,U.jsx)(u().I,{icon:xt().plusIcon}),focused:!1,title:(0,U.jsx)(b().sA,{defaultMessage:"Add an option",id:"database.viewSettings.selectOptions.noOptions"}),buttonStyle:{...n?{}:{display:"none"}},style:{width:"100%"},onClick:()=>Kt(t,o,e)})}var zt=()=>o(74519),Et=()=>o(491761),Wt=()=>o(109129);const qt=n.memo((function(e){const t=(0,b().tz)(),{collectionContextStore:r,collectionSettingsStore:i,formatKey:c,property:d,selectNameInitial:u,titleOverride:g}=e,[y,h]=(0,n.useState)(!1),[v,x]=(0,n.useState)(""),C=(0,a().v3)(),A=(0,n.useRef)(null),T=(0,s().DP)(),M=(0,s().eP)(),{collectionStore:P,isMultiSourceView:k}=(0,l().K8)((()=>({collectionStore:r.collectionStore(),isMultiSourceView:"collectionTypedView"===r.contextTypeFromStoreState})),[r]),I=(0,l().O$)(r.normalizedSchemaStore),{isTypedProperty:_,databaseType:O}=(0,l().K8)((()=>P?{isTypedProperty:P.isTypedProperty(d),databaseType:P.getDatabaseType()}:{isTypedProperty:!1,databaseType:void 0}),[P,d]),D=(0,l().K8)((()=>(0,S()._g)({schema:I,property:d})),[d,I]),F=(0,l().K8)((()=>Lt({property:d,formatKey:c,collectionContextStore:r})),[r,c,d]),K=(0,l().K8)((()=>(0,B().fE)({property:d,collectionContextStore:r,newValue:v})),[r,v,d]),V=(0,l().K8)((()=>{var e;const t=null===(e=r.collectionViewBlockStore())||void 0===e?void 0:e.id;return!!t&&(0,o(696746).Nh)(t)}),[r]),N=(0,l().K8)((()=>void 0!==P&&void 0!==O&&(0,o(671793).j)((0,o(413955).appConfigs)(),O,d,P)),[P,O,d]),z=(0,l().K8)((()=>{var e;const t=r.collectionViewStore();return!!t&&("timeline"!==t.getType()&&Boolean((null===(e=Lt({property:d,formatKey:c,collectionContextStore:r}))||void 0===e?void 0:e.wrap)||t.getFormat().table_wrap))}),[r,c,d]),W=(0,l().uB)(void 0,p().A),q=(0,X().a)();(0,n.useEffect)((()=>{!function(e,t,n){const r=t.collectionViewStore();if(!r||"table"!==r.getType())return;const i=o(344482).A.findTableHeaderCell(t,e);if(!i)return;const a=i.getNode();if(!a||!n)return;const l=(0,o(887957).T8)(a);if(!l)return;const s=n.getBoundingClientRect(),c=a.getBoundingClientRect().right+20-s.left;l.scrollLeft=l.scrollLeft+c}(d,r,A.current),D&&x(D.name||"")}),[r,d,D]);const H=(0,n.useCallback)((e=>{(0,ee().Fc)({collectionContextStore:r,environment:C,inputValue:v,name:e,property:d})}),[r,C,v,d]),G=(0,n.useCallback)((e=>{h(!y),e.stopPropagation()}),[y]),$=(0,n.useCallback)((e=>{!function(e){var t;const{description:o,environment:n,collectionContextStore:r,property:i}=e,a=r.collectionStore(),l=null==a||null===(t=a.getSchema())||void 0===t?void 0:t[i];if(!a||void 0===l||o===l.description)return;E().createAndCommit({userAction:"CollectionSettingsProperty.handleDescriptionChange",environment:n,canUndo:!0,perform:e=>{(0,R().F)({environment:n,collectionStore:a,update:{[i]:{...l,description:o}},transaction:e})}}),(0,w().V)({environment:n,collectionContextStore:r,property:i,from:"view_properties",action:"set_description"})}({collectionContextStore:r,description:e,environment:C,property:d})}),[r,C,d]),Y=(0,n.useCallback)((e=>{x(e)}),[]);if(!D)return null;const J=!(0,f().sl)(D),Z=!(0,f().UU)(D),Q=k,oe=k||(0,S().Jf)({property:d,propertySchema:D,isTypedProperty:_,schema:I}),ne=D.description;return(0,U.jsxs)(o(735695).A,{...e,title:g||(P?(0,U.jsx)(b().sA,{defaultMessage:"Edit property",id:"database.viewSettings.propertyTab.title"}):(0,U.jsx)(b().sA,{defaultMessage:"View property",id:"database.viewSettings.propertyTab.title.viewProperty"})),footer:J?(0,U.jsx)(qe,{collectionContextStore:r,formatKey:c,property:d,collectionSettingsStore:i,wrapProperty:z,propertySchema:D,propertyFormat:F,isRequiredTypedProperty:N,databaseType:O}):void 0,ref:A,children:[(0,U.jsxs)(m().A,{isInput:!0,style:q?{margin:"0 2px"}:void 0,children:[(0,U.jsx)(o(755735).B,{disabled:Q,initialValue:D.name||"",placeholder:t.formatMessage(Ge().A.inputPlaceholder),onBlur:H,onSubmit:H,focusInitial:u,selectAll:u,iconButton:{icon:e=>(0,U.jsx)(o(852424).zB,{type:D.type,icon:D.icon,size:o(340498).Ev.sm,theme:T,style:e}),iconStyle:{fill:o(278238).l8[M].gray},...q?{hasBackground:!0}:void 0,enforceIconColor:"gray",onSubmit:e=>function(e,t,n,r){const i=n.collectionStore();if(!i)return;(0,o(54653).y)({environment:e,collectionStore:i,collectionContextStore:n,property:t,icon:r,from:"view_settings"})}(C,d,r,e)},inputOuterStyle:q?{backgroundColor:T.white}:void 0,inputRightButton:V?null:(0,U.jsx)(o(539148).S,{description:ne,showTooltip:!y,onClick:G,addDescriptionText:t.formatMessage(te().Mo.addPropertyDescriptionTooltip),editDescriptionText:t.formatMessage(te().Mo.editPropertyDescriptionTooltip)}),onChange:Y}),K?(0,U.jsx)(o(653259).A,{propertyName:v}):void 0]}),y?(0,U.jsx)(o(705602).y,{initialDescription:ne,handleSaveDescription:$}):void 0,(0,U.jsx)(no,{collectionStore:P,property:d,propertySchema:D}),J?(0,U.jsxs)(m().A,{extraPadding:!0,children:[Z?(0,U.jsx)(j().Dy,{disabled:oe,isTypedProperty:_,collectionUri:O,collectionContextStore:r,formatKey:c,propertyTypeButtonPopupStore:W,property:d}):void 0,"button"===D.type?(0,U.jsx)(j().nR,{collectionSettingsStore:i,collectionContextStore:r,property:d,source:"collectionSettingsMenu"}):void 0,k?(0,U.jsxs)(U.Fragment,{children:["status"===D.type?(0,U.jsx)(Ht,{collectionSettingsStore:i,collectionContextStore:r,property:d}):void 0,"date"===D.type||"created_time"===D.type||"last_edited_time"===D.type?(0,U.jsx)($t,{collectionContextStore:r,property:d}):void 0]}):(0,U.jsx)(po,{collectionContextStore:r,property:d,propertySchema:D,source:"collectionSettingsMenu"})]}):void 0,q?(0,U.jsx)(L,{}):void 0]})}));function Ut(e){const t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}function Lt(e){const{collectionContextStore:t,formatKey:o,property:n}=e,r=function(e){const{formatKey:t,collectionContextStore:o}=e;return t?"collection_page_properties"===t?(null===(n=o.collectionStore())||void 0===n?void 0:n.getFormat().collection_page_properties)??[]:o.normalizedFormatStore.state[t]||[]:[];var n}({formatKey:o,collectionContextStore:t});return null==r?void 0:r.find((e=>e.property===n))}function Ht({collectionSettingsStore:e,collectionContextStore:t,property:o}){const n=(0,l().K8)((()=>{var e;return P(null===(e=t.collectionStore())||void 0===e?void 0:e.getDatabaseType(),t.normalizedSchemaStore.state,o)}),[t,o]);return(0,U.jsx)(Rt,{collectionSettingsStore:e,collectionContextStore:t,property:o,disabled:n,aIAutofillOption:null})}function Gt({collectionContextStore:e,collectionSettingsStore:t,property:o}){return(0,U.jsx)(re,{collectionContextStore:e,collectionSettingsStore:t,property:o})}function $t({collectionContextStore:e,property:t}){return(0,U.jsx)(be,{collectionContextStore:e,property:t})}function Yt({collectionContextStore:e,property:t}){const o=(0,l().K8)((()=>{const o=e.normalizedSchemaStore.state[t];return o&&(0,f().UU)(o)}),[e,t]),n=(0,l().K8)((()=>{const o=e.normalizedSchemaStore.state[t];return(0,S().di)(o)}),[e,t]),r=(0,l().K8)((()=>{var t;const o=e.collectionStore();return null==o||null===(t=o.getRecordKeyStore())||void 0===t?void 0:t.getRecordKey()}),[e]),i=n?(0,U.jsx)(Ue().A,{collectionContextStore:e,property:t}):(0,U.jsx)(yt,{collectionContextStore:e,property:t}),a=n?(0,U.jsx)(Le().A,{width:"100%",uniqueIdPrefix:r}):void 0,s=o?(0,U.jsx)(Et().J,{collectionContextStore:e,property:t,compact:!0,children:a}):null;return(0,U.jsxs)(U.Fragment,{children:[s,i]})}function Jt({collectionContextStore:e,property:t,source:o}){const n=(0,l().K8)((()=>(0,ee().Jq)({collectionContextStore:e,property:t})),[e,t]);return n&&("number"===n.type||"formula"===n.type||"rollup"===n.type)?(0,U.jsx)(ie().W,{collectionContextStore:e,property:t,source:o}):null}function Xt({collectionContextStore:e,property:t}){const o=(0,l().K8)((()=>(0,ee().Jq)({collectionContextStore:e,property:t})),[e,t]),n=(0,l().K8)((()=>e.collectionStore()),[e]);return o&&"url"===o.type&&n?(0,U.jsx)(Wt().V,{collectionContextStore:e,property:t,propertySchema:o}):null}function Zt({collectionContextStore:e,property:t}){const o=(0,l().K8)((()=>(0,ee().Jq)({collectionContextStore:e,property:t})),[e,t]);return o&&"person"===o.type?(0,U.jsx)(Te,{collectionContextStore:e,propertySchema:o,property:t}):null}function Qt({collectionContextStore:e,property:t}){const o=(0,a().v3)(),r=(0,b().tz)(),i=(0,l().K8)((()=>{const o=(0,ee().Jq)({collectionContextStore:e,property:t});return"person"===(null==o?void 0:o.type)?o:void 0}),[e,t]),s=(0,l().K8)((()=>e.collectionStore()),[e]),c=(0,l().K8)((()=>{if(i)return function(e){return e.notifications??y}(i)}),[i]),d=(0,n.useCallback)((e=>{s&&i&&E().createAndCommit({userAction:"PersonNotificationOptions.handlePersonNotificationChange",environment:o,canUndo:!0,perform:n=>{(0,R().F)({environment:o,collectionStore:s,update:{[t]:{...i,notifications:e}},transaction:n})}})}),[o,s,t,i]);return c?(0,U.jsx)(xe().A,{icon:v().r,title:(0,U.jsx)(b().sA,{defaultMessage:"Notifications",id:"database.personProperty.notifications"}),selectedKey:c,options:[{key:"usersAndGroups",type:"button",title:r.formatMessage(Ge().A.usersAndGroups)},{key:"usersOnly",type:"button",title:r.formatMessage(Ge().A.usersOnly)},{key:"none",type:"button",title:r.formatMessage(Ge().A.none)}],onChange:d}):null}function eo({collectionContextStore:e,property:t}){const o=(0,l().K8)((()=>(0,ee().Jq)({collectionContextStore:e,property:t})),[e,t]);return o&&"button"===o.type?(0,U.jsx)(j().m4,{collectionContextStore:e,propertySchema:o,property:t}):null}function to({collectionContextStore:e,property:t}){const o=(0,l().K8)((()=>(0,ee().Jq)({collectionContextStore:e,property:t})),[e,t]);return o?(0,U.jsx)(He().Z,{collectionContextStore:e,propertySchema:o,property:t}):null}function oo({collectionContextStore:e,property:t}){const o=(0,l().K8)((()=>(0,ee().Jq)({collectionContextStore:e,property:t})),[e,t]),n=(0,l().K8)((()=>{var t;const o=null===(t=e.collectionStore())||void 0===t?void 0:t.getRecordKeyStore();return null==o?void 0:o.getRecordKey()}),[e]);return o&&"auto_increment_id"===o.type?(0,U.jsx)(le().A,{uniqueIdProperty:{property:t,propertySchema:o},prefixValue:n,collectionContextStore:e}):null}function no({collectionStore:e,property:t,propertySchema:n}){const r=(0,o(763870).i)({collectionStore:e,property:t,propertySchema:n,blockStore:void 0}),a=(0,l().K8)((()=>{if(!r)return null;const{role:e}=r,t=n.name;return(0,o(115314).v)(e,t)}),[r,n.name]),c=(0,s().IS)((()=>({rowPermissionBannerWrapperStyle:{padding:i().A.isMobile?void 0:"0 4px"}})),[]);return r?(0,U.jsx)(m().A,{extraPadding:!0,children:(0,U.jsx)("div",{style:c.rowPermissionBannerWrapperStyle,children:(0,U.jsx)(o(179030).l,{display:"inline-compact",staticIcon:o(112886).keyFillSmallIcon,label:a,tint:"gray"})})}):null}function ro({collectionContextStore:e,property:t}){return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(to,{collectionContextStore:e,property:t}),(0,U.jsx)(Zt,{collectionContextStore:e,property:t}),(0,U.jsx)(Qt,{collectionContextStore:e,property:t})]})}function io(e){const{environment:t,property:o,propertySchema:i,collectionSettingsStore:a,collectionContextStore:s,collectionStore:c,buttonPopupParent:p}=e,y=(0,l().K8)((()=>(0,f().om)(i)),[i]),S=(0,r().X)("database_agents"),v=Boolean(y),x=(0,l().K8)((()=>(0,F().jq)(Z().A.getMode(t,c,c.getSpaceStore()),c)),[t,c]),A=(0,n.useMemo)((()=>{const e=i.name.trim(),t=B().dC[i.type],o=new RegExp(`${t}(?:\\s?\\d+)?`);return!e||o.test(e)}),[i.name,i.type]),j=(0,n.useCallback)((()=>{if(!c||!i||!(0,f().lx)(i))return;const e=(0,f().RM)(i);if(!e)return;const n=[];if(y)T().trackAiAutofillSettingsAction(t,{type:"remove_ai_inference",ai_inference_type:y.type,collection_id:c.id}),n.push({pointer:c.pointer,command:"set",path:["schema",o,e],args:void 0});else{const r={type:i.type,auto_update_on_edit:!1,add_options:!1};T().trackAiAutofillSettingsAction(t,{type:"set_ai_inference",ai_inference_type:r.type,collection_id:c.id}),n.push({pointer:c.pointer,command:"set",path:["schema",o,e],args:r})}(0,_().p)({environment:t,collectionStore:c,performTransaction:e=>{for(const t of n)E().applyOperation({store:(0,d().v3)(c,t.pointer),operation:t,transaction:e})}})}),[y,c,t,o,i]),w=(0,n.useCallback)((e=>{if(!i||!c||!(0,f().$M)(i))return;const n=(0,f().RM)(i);if(!n)return;const r={pointer:c.pointer,command:"set",path:["schema",o,n],args:e};(0,_().p)({environment:t,collectionStore:c,performTransaction:e=>{E().applyOperation({store:(0,d().v3)(c,r.pointer),operation:r,transaction:e})}})}),[c,t,o,i]),M=(0,l().K8)((()=>Ut(s)),[s]);return x&&"form_editor"!==M&&(!S||v)?(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(m().A,{topBorder:!0,style:{marginTop:4,paddingTop:0,marginInlineStart:-4,width:"calc(100% + 8px)"}},"aiSectionHeader"),(0,U.jsx)(g().m,{disableTooltip:!A,placement:"left",renderTooltip:e=>(0,U.jsx)(b().sA,{...e,defaultMessage:"Update the property name to use AI autofill",id:"database.collectionsettings.autofilloptions.disableswitch.tooltip",description:"User needs to change the property name from the default name to turn on autofill"}),render:e=>(0,U.jsx)(De().A,{...e,title:(0,U.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:(0,U.jsx)(b().sA,{defaultMessage:"AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.open"})}),showChevron:!1,switcherProps:{on:Boolean(y),noColor:!1},onClick:j,disabled:!x||A}),style:{whiteSpace:"break-spaces"}}),!y||A||"select"!==y.type&&"multi_select"!==y.type?void 0:(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(ae().A,{setAiInference:w,aiInference:y,disabled:!x}),(0,U.jsx)(ne().A,{title:(0,U.jsxs)("div",{style:{display:"flex",alignItems:"center",lineHeight:1.2,color:C().oZ.uiGray,gap:4},children:[(0,U.jsx)(b().sA,{id:"database.collectionsettings.aiAutofillOptions.more",defaultMessage:"More"}),(0,U.jsx)(u().I,{icon:h().arrowChevronSingleRightFillSmallIcon,size:"xs",colorVariant:"tertiary"})]}),disabled:!1,onClick:()=>{null==p||p.close(),Q().a2({collectionSettingsStore:a,item:{type:"propertyAiAutofill",propertySchema:i,property:o}})}})]})]}):null}function ao({propertySchema:e,collectionSettingsStore:t,collectionContextStore:o,property:n,buttonPopupParent:r}){const i=(0,a().v3)(),s=(0,l().K8)((()=>o.collectionStore()),[o]);return s?(0,U.jsx)(Rt,{collectionSettingsStore:t,collectionContextStore:o,property:n,disabled:!1,aIAutofillOption:(0,U.jsx)(io,{environment:i,collectionStore:s,collectionSettingsStore:t,collectionContextStore:o,property:n,propertySchema:e,buttonPopupParent:r})}):null}function lo({collectionContextStore:e,property:t,collectionSettingsStore:o,source:n}){const i=(0,b().tz)(),a=(0,r().X)("database_agents"),s=(0,l().K8)((()=>(0,ee().Jq)({collectionContextStore:e,property:t})),[e,t]),d=(0,l().K8)((()=>Ut(e)),[e]),p=!(0,l().O$)(c().e);if(!s||"text"!==s.type||"form_editor"===d)return null;const u=(0,f().om)(s),g=Boolean(u);if(a&&!g)return null;let m;return u&&(0,f().UH)(u.type)?"summarize"===u.type?m=D().VT.autofillSummary:"extract"===u.type?m=D().VT.autofillExtract:"custom"===u.type?m=D().VT.autofillCustom:"translate"===u.type?m=D().VT.autofillTranslate:(0,A().HB)(u):m=Ge().A.autofillOffLabel,(0,U.jsx)(ne().A,{title:(0,U.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:(0,U.jsx)(b().sA,{defaultMessage:"AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.open"})}),source:n,icon:x().pencilLineIcon,showChevron:!0,right:i.formatMessage(m),onClick:()=>function(e,t,o){const n=(0,ee().Jq)({collectionContextStore:t,property:o});t.collectionStore()&&n&&Q().a2({collectionSettingsStore:e,item:{type:"propertyAiAutofill",propertySchema:n,property:o}})}(o,e,t),disabled:p})}function so({collectionContextStore:e,collectionSettingsStore:t,property:i,propertySchema:s,buttonPopupParent:c}){const d=(0,r().X)("database_agents"),p=(0,r().X)("custom_agent_page_instructions"),u=(0,a().v3)(),g=(0,b().tz)(),m=(0,l().K8)((()=>e.collectionStore()),[e]),y=(0,l().K8)((()=>null==m?void 0:m.getSpaceId()),[m]),{getWorkflowsForProperty:S}=(0,I().i)(m,y),h=(0,l().K8)((()=>S(i)),[S,i]),v=Boolean((0,f().YE)(s)),x=(0,n.useCallback)((async t=>{const{triggerDatabaseAgentModal:n}=await Promise.all([o.e(75134),o.e(71562),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(46414),o.e(11676),o.e(61165),o.e(94522),o.e(44584),o.e(67494),o.e(3651),o.e(40992),o.e(88455),o.e(64556),o.e(33893),o.e(91793),o.e(55162),o.e(36437),o.e(50363),o.e(42660),o.e(44590),o.e(55113),o.e(85071),o.e(7914),o.e(25588),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(52871),o.e(29351),o.e(18825),o.e(71853),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(34281),o.e(48376),o.e(35279),o.e(80229),o.e(77754),o.e(71309),o.e(47160),o.e(14699),o.e(21627),o.e(57924),o.e(77777),o.e(23493),o.e(51240),o.e(81803),o.e(42810),o.e(20741),o.e(33695),o.e(86730)]).then(o.bind(o,825547));m&&await n({collectionContextStore:e,collectionId:m.id,createInstructionsPageEnabled:p,environment:u,intl:g,propertyId:i,propertySchema:s,workflowId:t})}),[e,m,p,u,g,i,s]);return d&&!v&&m?(0,U.jsx)(O().n,{collectionContextStore:e,collectionSettingsStore:t,property:i,propertySchema:s,workflowsForProperty:h,spaceId:y,mainMenuParent:c,onClickConfigure:x,variant:"collectionLevelConfigurationMenu"}):null}function co({property:e,collectionContextStore:t}){const o=(0,a().v3)(),n=(0,l().K8)((()=>t.collectionStore()),[t]),r=(0,l().K8)((()=>(0,B().Kc)(t)),[t]),i=(0,l().K8)((()=>Boolean((null==n?void 0:n.getDatabaseType())&&(null==n?void 0:n.isTypedProperty(e)))),[n,e]);return n?(0,U.jsx)(k().RollupPropertyMenu,{disabled:i,context:"viewSettings",property:e,schema:r,analyticsFrom:"view_settings",parentStore:n,onChange:n=>function(e,t,o,n){const r=n.collectionStore();r&&E().createAndCommit({userAction:"CollectionSettingsProperty.handleRollupPropertyMenuChange",environment:t,canUndo:!0,perform:n=>{(0,R().F)({environment:t,collectionStore:r,update:{[o]:e.propertySchema},transaction:n})}})}(n,o,e,t)}):null}function po({property:e,propertySchema:t,collectionContextStore:o,source:r,buttonPopupParent:i,hideDatabaseAgentConfiguration:a}){const l=o.settingsStore;return(0,n.useMemo)((()=>"button"===t.type),[t.type])?null:(0,U.jsxs)(U.Fragment,{children:["text"===t.type?(0,U.jsx)(lo,{collectionContextStore:o,property:e,collectionSettingsStore:l,source:r}):void 0,"title"===t.type?(0,U.jsx)(zt().j,{collectionContextStore:o}):void 0,(0,f().Ky)(t)&&!a?(0,U.jsx)(so,{collectionContextStore:o,collectionSettingsStore:l,property:e,propertySchema:t,buttonPopupParent:i}):void 0,(0,f().lx)(t)?(0,U.jsx)(ao,{collectionSettingsStore:l,collectionContextStore:o,property:e,propertySchema:t,buttonPopupParent:i}):void 0,"status"===t.type?(0,U.jsx)(Ht,{collectionSettingsStore:l,collectionContextStore:o,property:e}):void 0,"formula"===t.type?(0,U.jsx)(Gt,{collectionContextStore:o,collectionSettingsStore:l,property:e}):void 0,"rollup"===t.type?(0,U.jsx)(co,{property:e,collectionContextStore:o}):void 0,"date"===t.type||"created_time"===t.type||"last_edited_time"===t.type?(0,U.jsx)($t,{collectionContextStore:o,property:e}):void 0,"relation"===t.type?(0,U.jsx)(Yt,{collectionContextStore:o,property:e}):void 0,"person"===t.type?(0,U.jsx)(ro,{collectionContextStore:o,property:e}):void 0,(0,U.jsx)(Jt,{collectionContextStore:o,property:e,source:r}),(0,U.jsx)(Xt,{collectionContextStore:o,property:e}),"auto_increment_id"===t.type?(0,U.jsx)(oo,{collectionContextStore:o,property:e}):void 0,"button"===t.type?(0,U.jsx)(eo,{collectionContextStore:o,property:e}):void 0]})}},755735:(e,t,o)=>{o.d(t,{B:()=>s});var n=o(296540),r=()=>o(69708),i=()=>o(419357),a=o(474848);const l=(0,r().YK)({changeIcon:{id:"collectionSettingsNameInput.iconButton.ariaLabel",defaultMessage:"Change icon"}}),s=n.forwardRef((function(e,t){const{placeholder:s,focusInitial:c,selectAll:d,disabled:p,inputOuterStyle:u,iconButton:g,inputRightButton:m,initialValue:y,onBlur:f,onSubmit:S,onChange:h,maxLength:v,textWrapperStyle:x,textarea:b}=e,C=(0,r().tz)(),[A,j]=(0,n.useState)((()=>y||"")),w=(0,n.useCallback)((()=>{f(A)}),[A,f]),T=(0,n.useCallback)((()=>{S(A)}),[A,S]),M=(0,n.useCallback)((e=>{const t=e.target.value;j(t),null==h||h(t)}),[h]),P=(0,o(208698).$)({iconButton:g}),k=(0,o(336811).O)();(0,n.useEffect)((()=>()=>{k.current&&y!==A&&f(A)}),[y,A,k,f]);const I=(0,o(401497).IS)((()=>({iconButton:{opacity:p?.4:void 0},textWrapper:{opacity:p?.4:void 0,...x}})),[p,x]);return(0,a.jsx)(i().Ay,{ref:t,focusInitial:c,autoFocus:!!c||void 0,selectAll:d,value:A,onChange:M,onBlur:w,onSubmit:T,placeholder:s,disabled:p,textWrapperStyle:I.textWrapper,maxlength:v,inputOuterStyle:u,left:g?(0,a.jsx)(i().KF,{icon:g.icon,iconStyle:g.iconStyle,onClick:P,disabled:p,style:I.iconButton,hasBackground:g.hasSolidBackground,ariaLabel:C.formatMessage(l.changeIcon)}):null,showClearButton:!1,inputRight:m,textarea:b})}))},784379:(e,t,o)=>{o.d(t,{eX:()=>d,wv:()=>c});o(296540);var n=()=>o(128933),r=()=>o(98126),i=o(474848);const a=(0,o(69708).YK)({gettingStarted:{defaultMessage:"Getting started...",id:"agentSnackbarHelpers.gettingStarted"},startedFillingNRows:{defaultMessage:"Started filling {n, plural, one {# row} other {# rows}}",id:"agentSnackbarHelpers.startedFillingNRows"},startedFillingAllRows:{defaultMessage:"Started filling all rows in this view",id:"agentSnackbarHelpers.startedFillingAllRows"}});function l({intl:e}){return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)(r().k,{size:"xxs",onDarkBackground:!0}),(0,i.jsx)("span",{children:e.formatMessage(a.gettingStarted)})]})}function s(e){n().D6({label:(0,i.jsx)(l,{intl:e}),durationMs:"keep"})}function c(e){return{onEnqueueStart:()=>{s(e)},onEnqueueComplete:t=>{!function(e,t){n().D6({label:e.formatMessage(a.startedFillingNRows,{n:t})})}(e,t)}}}function d(e){return{onEnqueueStart:()=>{s(e)},onEnqueueComplete:()=>{!function(e){n().D6({label:e.formatMessage(a.startedFillingAllRows)})}(e)}}}},788621:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>r,personCircleIcon:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.26 15.25",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M7.755 6.169C8.277 5.519 9.05 5.125 10 5.125s1.723.393 2.245 1.044c.51.635.75 1.474.75 2.346s-.24 1.71-.75 2.346c-.522.65-1.294 1.044-2.245 1.044-.95 0-1.723-.394-2.245-1.044-.51-.635-.75-1.474-.75-2.346s.24-1.711.75-2.346m.975.782c-.293.365-.475.909-.475 1.564s.182 1.198.475 1.564c.281.35.694.576 1.27.576s.989-.226 1.27-.576c.294-.366.475-.909.475-1.564s-.181-1.199-.475-1.564c-.281-.35-.693-.576-1.27-.576-.576 0-.989.225-1.27.576"}),(0,n.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 0 0-4.087 11.267c.789-1.397 2.333-2.33 4.087-2.33s3.298.933 4.087 2.33A6.375 6.375 0 0 0 10 3.625M13.049 15.6c-.547-1.049-1.697-1.789-3.05-1.789-1.351 0-2.501.74-3.048 1.789a6.35 6.35 0 0 0 3.049.775 6.34 6.34 0 0 0 3.049-.775"})]})},i=(0,o(340498).wt)("personCircle",r,"default")},819560:(e,t,o)=>{o.d(t,{b:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.95 1.95 12.11 12.11",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M8 14.05a6.05 6.05 0 1 1 0-12.1 6.05 6.05 0 0 1 0 12.1m-.837-3.765 3.067-1.79a.574.574 0 0 0 0-.99l-3.067-1.79a.574.574 0 0 0-.863.496v3.578c0 .443.48.719.863.496"})},r=(0,o(340498).wt)("arrowTriangleRightCircleFillSmall",n,"fillSmall")},834539:(e,t,o)=>{o.d(t,{c:()=>A});o(898992),o(354520),o(672577),o(737550);var n=o(296540),r=()=>o(484714),i=()=>o(590526),a=()=>o(401497),l=()=>o(396896),s=()=>o(493552),c=()=>o(247331),d=()=>o(239381),p=()=>o(756005),u=()=>o(519831),g=()=>o(142918),m=()=>o(69708),y=()=>o(100622),f=()=>o(496603),S=()=>o(259869),h=()=>o(547149),v=()=>o(362452),x=()=>o(595743),b=()=>o(260917),C=o(474848);function A(e){const{collectionStore:t,disabled:o=!1,minHeight:A,onHandlePeek:j,showFocus:w=!1,workflowStore:T}=e,[M,P]=(0,n.useState)(!1),k=(0,r().v3)(),I=(0,a().IS)((()=>({container:{display:"flex",flexDirection:"column",width:"100%",minHeight:A??56,cursor:"text",background:y().Tj.background.secondary,borderRadius:6,boxShadow:M&&w?`0 0 0 2px ${y().Tj.blue.border.accentPrimary}`:y().Tj.shadow.outline.sm,boxSizing:"border-box",padding:2,position:"relative"}})),[A,M,w]),_=(0,i().K8)((()=>({table:u().Vl,id:t.id,spaceId:t.getSpaceId()})),[t]),R=(0,n.useMemo)((()=>{if(!_)return[];return[{id:(0,d().QF)(`collection_${_.id}`),kind:c().FormulaContextValueKind.ContextValue,name:"Current page",type:{type:"block",collection:_}}]}),[_]),B=(0,n.useMemo)((()=>(0,p().Yz)({page:!1,createPage:!0,collection:!0,user:!0,inviteUserToWorkspace:!0,inviteUserToPage:!0,date:!1,reminder:!0,bot:!0,heading:!0,group:!0,team:!0,templateVariable:!0,slackSpecialMention:!0,formulaContextVariable:!0,property:!1})),[]),O=(0,n.useRef)(null),D=(0,i().uB)(void 0,b().K),F=(0,i().K8)((()=>D.hasError("instructions")),[D]),K=(0,n.useMemo)((()=>({collectionStore:t,disabledMentionTypes:B,formulaValueTypes:R,mentionSectionOrdering:["property"]})),[t,R,B]),{autoGrantOperations:V}=(0,x().B)({workflowStore:T}),N=(0,n.useRef)();return(0,n.useEffect)((()=>{var e,t;if(f().n4(V,N.current))return;if(1!==V.length)return;const[o]=V;if(!o||"keyedObjectListUpdate"!==o.command||!o.args||!o.args.value)return;const n=o.args.value,r=n.permissions??[],i=(null===(e=T.getDraftDataStore())||void 0===e||null===(e=e.getKeyStore("modules"))||void 0===e?void 0:e.getValue())??(null===(t=T.getDataStore())||void 0===t||null===(t=t.getKeyStore("modules"))||void 0===t?void 0:t.getValue()),a=null==i?void 0:i.find((e=>e.id===n.id));if(!a)return;const l=a.permissions??[],s=r.filter((e=>!l.some((t=>f().n4(e.identifier,t.identifier)))));if(0===s.length)return;const c=[...l,...s],d=Object.assign({},n,{permissions:c}),p=(0,g().xb)({pointer:T.pointer,module:d});N.current=V,h().createAndCommit({userAction:"DatabaseAgentTextInput.autoGrantPermissions",environment:k,canUndo:!0,perform:e=>{h().applyOperation({store:T,operation:p,transaction:e})}})}),[V,T,k]),(0,C.jsxs)(l().VP,{children:[(0,C.jsx)("div",{style:I.container,role:"textbox",ref:O,onFocusCapture:()=>P(!0),onBlurCapture:e=>{const t=e.relatedTarget;t&&e.currentTarget.contains(t)||P(!1)},children:(0,C.jsx)(S().S,{value:K,children:(0,C.jsx)(v().G,{disableCollapsing:!0,disabled:o,isCompact:!0,minHeight:A??56,onHandlePeek:j,workflowStore:T,workflowValidationErrorStore:D})})}),F?(0,C.jsx)(s().D,{colorPalette:"red",colorVariant:"accentPrimary",styleKey:"captionRegular",children:(0,C.jsx)(m().sA,{defaultMessage:"This field is required",id:"databaseAgentTextInput.requiredErrorLabel"})}):void 0]})}},860037:(e,t,o)=>{o.d(t,{A:()=>v});o(296540);var n=()=>o(484714),r=()=>o(590526),i=()=>o(401497),a=()=>o(996332),l=()=>o(26697),s=()=>o(584262),c=()=>o(73337),d=()=>o(69708),p=()=>o(100622),u=()=>o(284371),g=()=>o(187820),m=()=>o(16006),y=()=>o(492414),f=()=>o(263711),S=()=>o(497222),h=o(474848);function v(e){const{isSelfRelation:t,collectionStore:o,showAs:v,disabled:x,onClick:b}=e,C=(0,r().K8)((()=>Boolean(o)),[o]),A=(0,r().K8)((()=>null==o?void 0:o.getIcon()),[o]),j=(0,r().K8)((()=>{if(t)return;const e=null==o?void 0:o.getParentBlockStore();return e&&(0,y().Ay)({store:e,pageVisitSource:s().y8.LinkInPage})}),[o,t]),w=(0,n().Y0)(),T=(0,i().IS)((()=>({linkBox:{display:"flex",alignItems:"center",gap:4},linkTitle:{color:p().Tj.text.primary,fontWeight:u().Wy.semibold,fontSize:14,marginInlineStart:4*(w.isRetina?.5:1),wordBreak:"break-word",...u().RC},chevronTitle:{display:"inline",wordBreak:"break-word",...u().RC}})),[w]),M=(0,r().K8)((()=>f().g.state.isOpen&&"layout-editor"===f().g.state.mode),[]),P=(0,h.jsx)(g().B6,{icon:A,iconRecordCategory:"collection",isEmptyPage:!1,size:20,disabled:!0}),k=(0,h.jsx)(S().A,{icon:c().P,title:(0,h.jsx)(d().sA,{defaultMessage:"Related to",id:"database.viewSettings.editRelation.targetLink.title"}),showChevron:"chevron"===v,onClick:b,disabled:x,right:t?(0,h.jsx)(d().sA,{defaultMessage:"This database",id:"database.viewSettings.editRelation.selfRelationTarget.title"}):"link"===v&&j?(0,h.jsxs)(a().Q,{external:M,href:j,innerStyle:T.linkBox,children:[P,(0,h.jsx)(m().A,{store:o,underline:!0,style:T.linkTitle,maxLength:15})]}):C?(0,h.jsxs)(h.Fragment,{children:[P,(0,h.jsx)(m().A,{store:o,style:T.chevronTitle})]}):(0,h.jsx)(d().sA,{defaultMessage:"No target",id:"database.viewSettings.editRelation.noTarget.title"}),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0}});return x?(0,h.jsx)(l().m,{disableTooltip:!1,placement:"top",renderTooltip:()=>(0,h.jsx)(d().sA,{defaultMessage:"The related database cannot be changed after creation",id:"database.viewSettings.editRelation.disabledTooltip"}),render:e=>(0,h.jsx)("div",{...e,children:k})}):k}},877568:(e,t,o)=>{o.d(t,{_:()=>r});var n=()=>o(534177);function r(e){const{taskRunningState:t}=e;switch(t.status){case"requested":return!0;case"running":return t.numPagesFilled<t.numPagesRequested;case"error":case"notRunning":return!1;default:(0,n().HB)(t)}}},896427:(e,t,o)=>{o.d(t,{EB:()=>R,Ay:()=>_,DZ:()=>O});var n=o(296540),r=()=>o(726637),i=()=>o(484714),a=()=>o(590526),l=()=>o(401497),s=()=>o(250910),c=()=>o(118307),d=()=>o(807449),p=()=>o(160432),u=()=>o(26697),g=()=>o(681748),m=()=>o(302501),y=()=>o(736847),f=()=>o(665589),S=()=>o(721479),h=()=>o(68263),v=()=>o(69708),x=()=>o(496603),b=()=>o(901952),C=()=>o(113105),A=()=>o(562969),j=()=>o(811979),w=()=>o(419357),T=()=>o(16006),M=()=>o(574036),P=o(474848);function k(e){const{temporaryAutoRelateState:t,handleAutoRelateToggle:o,collectionStore:n,targetCollectionStore:i,autoRelate:s}=e,c=(0,a().K8)((()=>(null==n?void 0:n.getFormat().bot_id)||i.getFormat().bot_id),[n,i]),p=!!c,g=(0,l().IS)((()=>({helpIcon:{marginInlineStart:6}})),[]),m=(0,P.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"},children:[(0,P.jsx)(v().sA,{defaultMessage:"Automatically Relate",id:"database.viewSettings.setupRelationTab.autoRelate.title"}),r().A.isMobile?void 0:(0,P.jsx)(u().m,{render:e=>(0,P.jsx)("div",{...e,style:g.helpIcon,children:(0,P.jsx)(d().I,{icon:S().questionMarkCircleSmallIcon,size:"sm",colorVariant:"tertiary"})}),style:{width:200},placement:"bottom",textWrap:!0,renderTooltip:()=>(0,P.jsx)(v().sA,{defaultMessage:"Relations will automatically populate based on links found in page properties.",id:"database.viewSettings.setupRelationTab.autoRelateTooltip"})})]});return p?(0,P.jsx)(M().A,{title:m,on:t?t.enabled:!!s&&(null==s?void 0:s.enabled),focused:!1,onClick:()=>o(c),textWrapperStyle:{opacity:1}}):null}var I=()=>o(497222);function _(e){const{collectionContextStore:t,property:o,targetCollectionStore:y,temporaryInverseState:f,setTemporaryInverseState:x,mode:w="edit",onSubmit:_,shouldEnforceTwoWayRelation:D}=e,F=(0,i().v3)(),K=(0,v().tz)(),V=(0,a().uB)(void 0,c().A),N=(0,a().K8)((()=>o?C().Jq(t,o):void 0),[t,o]),z=(0,a().K8)((()=>t.collectionStore()),[t]),E=(0,a().K8)((()=>t.contextTypeFromStoreState),[t]),W=Boolean((null==z?void 0:z.id)===y.id),q=(0,a().K8)((()=>Boolean(o?C().D5(t,o,y):void 0)),[t,o,y]),U=(0,a().K8)((()=>{if("relation"!==(null==N?void 0:N.type))return"";const e=N.property;if(!e||e===o)return"";const t=y.getRole();if(!t||!h().Tt(t))return"";const n=y.getSchema()[e];return(null==n?void 0:n.name)||""}),[y,o,N]),L=(0,a().K8)((()=>"relation"===(null==N?void 0:N.type)&&N.autoRelate?N.autoRelate:{enabled:!1}),[N]),H=(0,a().K8)((()=>Boolean(C().uf(y))),[y]),G=(0,a().K8)((()=>Boolean((null==z?void 0:z.getDatabaseType())&&o&&(null==z?void 0:z.isTypedProperty(o)))),[z,o]),$=(0,n.useMemo)((()=>f?f.hasInverseRelation:q),[f,q]),Y=(0,n.useMemo)((()=>f?f.inverseName:U),[f,U]),J=(0,n.useMemo)((()=>f?f.autoRelate:L),[f,L]),X=(0,n.useCallback)((()=>{o&&(0,b().V)({environment:F,collectionContextStore:t,property:o,from:"collectionPage"===E?"page_properties":"view_settings",action:$?"relation_toggle_inverse_off":"relation_toggle_inverse_on",is_self_relation:W})}),[o,t,F,E,W,$]),Z=(0,n.useCallback)((()=>null!=z&&z.isSyncedCollection()?J:$?{enabled:!1}:J),[z,J,$]),Q=(0,n.useCallback)((()=>{x({hasInverseRelation:!0,inverseName:Y,autoRelate:Z()}),X()}),[x,Y,X,Z]),ee=(0,n.useCallback)((()=>{x({hasInverseRelation:!1,inverseName:void 0,autoRelate:Z()}),X()}),[x,X,Z]),te=Boolean(!H||G||D),oe=(0,n.useCallback)((e=>{x({hasInverseRelation:!0,inverseName:e.target.value,autoRelate:J})}),[x,J]),ne=(0,n.useCallback)((e=>{const n=null!=J&&J.enabled?{enabled:!1}:{enabled:!0,bot_id:e};x({hasInverseRelation:$,inverseName:Y,autoRelate:n}),o&&(0,b().V)({environment:F,collectionContextStore:t,property:o,from:"collectionPage"===E?"page_properties":"view_settings",action:n.enabled?"auto_relation_toggle_on":"auto_relation_toggle_off"})}),[o,x,t,E,Y,$,J,F]),re=(0,l().IS)((()=>({container:{width:r().A.isMobile?"100%":250,paddingBottom:r().A.isMobile?16:8,paddingInlineStart:r().A.isMobile?8:4,paddingInlineEnd:r().A.isMobile?8:4,marginTop:8},helpIcon:{marginInlineStart:6},disabled:{opacity:.5,pointerEvents:"none"},menuTitle:{display:"flex",alignItems:"center",whiteSpace:"pre"}})),[]),ie=(0,a().uB)(void 0,g().A),ae=(0,A().useCollectionNameOrDefault)(y),le=(0,n.useMemo)((()=>!H||G?K.formatMessage(O.errors.cannotEditTargetDatabase,{databaseName:ae}):W?K.formatMessage(O.tooltips.selfRelationInverseTooltip):K.formatMessage(O.tooltips.inverseRelationTooltip,{databaseName:(0,P.jsx)(T().A,{shouldWrap:!0,style:{display:"inline"},store:y})})),[H,G,K,W,y,ae]),se=(0,n.useMemo)((()=>r().A.isMobile?(0,P.jsx)("div",{style:re.menuTitle,children:K.formatMessage(O.generic.title)}):(0,P.jsx)(u().m,{placement:"bottom",alignment:"center",textWrap:!0,style:{width:200},store:ie,render:e=>(0,P.jsxs)("div",{...e,style:re.menuTitle,children:[K.formatMessage(O.generic.title),(0,P.jsx)("div",{style:re.helpIcon,children:(0,P.jsx)(d().I,{icon:S().questionMarkCircleSmallIcon,size:"sm",colorVariant:"tertiary"})})]}),renderTooltip:()=>le})),[K,re.menuTitle,re.helpIcon,le,ie]);return z?(0,P.jsxs)(P.Fragment,{children:["create"===w?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(R,{currentInverseState:$,disableInverseRelation:ee,enableInverseRelation:Q,handleAutoRelateToggle:ne,temporaryInverseState:f,collectionStore:z,targetCollectionStore:y,isTwoWayToggleDisabled:te,isNameDisabled:te,menuTitle:se,autoRelate:L,isSelfRelation:W,inverseRelationName:U,handleInverseNameChange:oe}),(0,P.jsx)(p().A,{colorPalette:"blue",style:{display:"flex",marginTop:6,marginInlineEnd:12,marginBottom:0,marginInlineStart:12},onClick:_,children:K.formatMessage(O.create.addRelation)})]}):void 0,"edit"===w?(0,P.jsx)(j().A,{focused:!1,disabled:te,popupType:r().A.isMobile?s().z.SlideUp:s().z.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",isFullWidthOnMobile:!0,buttonPopupStore:V,onClose:_,renderOrigin:e=>(0,P.jsx)(I().A,{...e,showChevron:!0,rotateChevron:V.state.open,title:se,disabled:te,right:$?K.formatMessage(O.generic.on):K.formatMessage(O.generic.off)}),render:e=>(0,P.jsxs)("div",{style:re.container,children:[(0,P.jsx)(M().A,{textWrapperStyle:{overflow:"hidden",display:"inline-flex"},focused:!1,disabled:te,on:$,title:K.formatMessage(O.edit.enable),titleStyle:{display:"inline-flex"},onClick:e=>{$?ee():Q()}}),(0,P.jsxs)("div",{style:$?void 0:re.disabled,children:[(0,P.jsx)(k,{handleAutoRelateToggle:ne,temporaryAutoRelateState:null==f?void 0:f.autoRelate,collectionStore:z,autoRelate:L,targetCollectionStore:y}),(0,P.jsx)(B,{collectionStore:z,targetCollectionStore:y,isSelfRelation:W,temporaryInverseState:f,inverseRelationName:U,disabled:te,onChange:oe,title:(0,P.jsx)(m().A,{isSecondaryColor:!0,isSmall:!0,children:K.formatMessage(O.edit.propertyNameLabel)})})]})]})}):void 0]}):null}function R(e){const{currentInverseState:t,disableInverseRelation:o,enableInverseRelation:n,handleAutoRelateToggle:r,temporaryInverseState:i,collectionStore:a,targetCollectionStore:l,isTwoWayToggleDisabled:s,isNameDisabled:c,menuTitle:p,autoRelate:u,isSelfRelation:g,inverseRelationName:y,handleInverseNameChange:S}=e,h=(0,v().tz)();return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(M().A,{icon:(0,P.jsx)(d().I,{icon:f().l}),textWrapperStyle:{overflow:"hidden",display:"inline-flex"},focused:!1,on:t,disabled:s,title:p,titleStyle:{display:"inline-flex"},onClick:()=>{t?o():n()}}),t?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(k,{handleAutoRelateToggle:r,temporaryAutoRelateState:null==i?void 0:i.autoRelate,collectionStore:a,autoRelate:u,targetCollectionStore:l}),(0,P.jsx)(B,{collectionStore:a,targetCollectionStore:l,isSelfRelation:g,temporaryInverseState:i,inverseRelationName:y,disabled:c,onChange:S,title:(0,P.jsx)(m().A,{isSmall:!0,isSecondaryColor:!0,children:g?h.formatMessage(O.create.selfRelationPropertyNameHeader):h.formatMessage(O.create.relationPropertyNameHeader)})})]}):void 0]})}function B(e){const{collectionStore:t,targetCollectionStore:o,isSelfRelation:n,temporaryInverseState:r,inverseRelationName:i,disabled:l,onChange:s,title:c}=e,d=(0,v().tz)(),p=(0,a().K8)((()=>null!=t&&t.isDefined()?C().zF(d,{sourceCollection:t.getModel(),isSelfRelation:n,targetCollectionStore:o,createUnique:!0}):d.formatMessage(O.placeholders.relatedToTarget)),[t,d,n,o]);return(0,P.jsx)(y().A,{title:c,noTextOverflow:!0,children:(0,P.jsx)(w().Ay,{value:(null==r?void 0:r.inverseName)||i,placeholder:p,onChange:s,onBlur:x().D_,onSubmit:x().D_,focusInitial:!0,selectAll:!1,disabled:l})})}const O={generic:(0,v().YK)({on:{id:"database.viewSettings.setupRelationTab.generic.on",defaultMessage:"On"},off:{id:"database.viewSettings.setupRelationTab.generic.off",defaultMessage:"Off"},title:{id:"database.viewSettings.setupRelationTab.generic.title",defaultMessage:"Two-way relation"}}),create:(0,v().YK)({addRelation:{id:"database.viewSettings.setupRelationTab.create.relation.add",defaultMessage:"Add relation"},addRelationInverse:{id:"database.viewSettings.setupRelationTab.create.relation.inverse.add",defaultMessage:"Show on {databaseName}"},addSelfRelationInverse:{id:"database.viewSettings.setupRelationTab.addSelfRelationInverse",defaultMessage:"Separate directions {icon}"},relationPropertyNameHeader:{id:"database.viewSettings.setupRelationTab.create.relation.inverse.propertyNameHeader",defaultMessage:"Related property name"},selfRelationPropertyNameHeader:{id:"database.viewSettings.setupRelationTab.create.selfRelation.inverse.propertyNameHeader",defaultMessage:"Inverse related property name"}}),edit:(0,v().YK)({modalTitle:{id:"database.viewSettings.setupRelationTab.edit.relation.inverse.modalTitle",defaultMessage:"Related property settings"},enable:{id:"database.viewSettings.setupRelationTab.edit.relation.inverse.enable",defaultMessage:"Enable"},propertyNameLabel:{id:"database.viewSettings.setupRelationTab.edit.relation.inverse.propertyNameLabel",defaultMessage:"Related property name"},addRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.relation.inverse.add",defaultMessage:"Show on {databaseName}"},editRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.relation.inverse.edit",defaultMessage:"Edit relation on {databaseName}"},saveRelationInverse:{id:"database.viewSettings.setupRelationTab.relation.inverse.save",defaultMessage:"Save"},removeRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.relation.inverse.remove",defaultMessage:"Remove property"},addSelfRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.selfRelation.inverse.add",defaultMessage:"Add inverse property"},editSelfRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.selfRelation.inverse.edit",defaultMessage:"Edit inverse property"},renameSelfRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.selfRelation.inverse.rename",defaultMessage:"Rename"},saveSelfRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.selfRelation.inverse.save",defaultMessage:"Save"},removeSelfRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.selfRelation.inverse.remove",defaultMessage:"Remove property"}}),tooltips:(0,v().YK)({inverseRelationTooltip:{id:"database.viewSettings.setupRelationTab.relation.inverse.tooltip",defaultMessage:"Manage property on {databaseName} showing backlinks to the current database"},selfRelationInverseTooltip:{id:"database.viewSettings.setupRelationTab.selfRelation.inverse.tooltip",defaultMessage:"Manage separate properties for each direction of a two-way relation. Useful for modeling Parent task/Sub-tasks, Blocked by/Blocking, and more."},disabledTwoWayRelationTooltip:{id:"database.viewSettings.setupRelationTab.relation.inverse.disabled.tooltip",defaultMessage:"Two-way relations cannot be enabled when share settings are inherited through this relation."}}),errors:(0,v().YK)({cannotEditTargetDatabase:{id:"database.viewSettings.setupRelationTab.inverseDisabledWarning.title",defaultMessage:"Cannot edit {databaseName}."}}),placeholders:(0,v().YK)({relatedToTarget:{id:"database.viewSettings.setupRelationTab.relation.inverse.placeholder",defaultMessage:"Related to target"}})}},921982:(e,t,o)=>{o.d(t,{i:()=>b});o(944114),o(898992),o(354520),o(581454);var n=o(296540),r=()=>o(401497),i=()=>o(250910),a=()=>o(420802),l=()=>o(807449),s=()=>o(546926),c=()=>o(890492),d=()=>o(81068),p=()=>o(663639),u=()=>o(736847),g=()=>o(898244),m=()=>o(852424),y=()=>o(906380),f=()=>o(69708),S=()=>o(100622),h=()=>o(534177),v=o(474848);const x=(0,f().YK)({selectProperties:{id:"collectionSettings.propertySelection.selectProperties",defaultMessage:"Select"},moreCount:{id:"collectionSettings.propertySelection.moreCount",defaultMessage:"{count, plural, one {# more} other {# more}}"}});function b({disabled:e,icon:t,marginBlock:o,onSelectionChange:b,schema:C,selectedProperties:A,width:j}){const w=(0,f().tz)(),T=(0,r().IS)((()=>({buttonContent:{width:j??"100%",marginInlineStart:-4,marginInlineEnd:-4,marginBlock:o??4,opacity:e?.4:1},fillDataLabel:{fontSize:14,color:S().Tj.text.primary},propertyLabel:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:200,fontSize:14,color:S().Tj.text.secondary},dropdownIcon:{color:S().Tj.text.tertiary,flexShrink:0,marginInlineStart:4},checkbox:{marginInlineEnd:8,flexShrink:0},leftIcon:{height:20,width:20},iconsContainer:{display:"flex",alignItems:"center"}})),[e,o,j]),M=(0,r().DP)(),P=n.useMemo((()=>Object.keys(C).filter((e=>C[e]&&"title"!==C[e].type&&!g().rb.has(C[e].type)))),[C]),k=(0,n.useCallback)((e=>{const t=[...A],o=t.indexOf(e);o>-1?t.splice(o,1):t.push(e),t.length>0&&b(t)}),[A,b]),I=(0,n.useCallback)((()=>{if(0===A.length)return w.formatMessage(x.selectProperties);const e=A.map((e=>{var t;return null===(t=C[e])||void 0===t?void 0:t.name})).filter((e=>!!(0,h().O9)(e)));if(0===e.length)return w.formatMessage(x.selectProperties);const t=new Intl.ListFormat(w.locale,{style:"long",type:"conjunction"});if(e.length>2){const o=e.slice(0,2),n=e.length-2,r=w.formatMessage(x.moreCount,{count:n});return t.format([...o,r])}return t.format(e)}),[A,C,w]),_=(0,v.jsx)(c().A,{menuType:s().gu.Popup,minWidth:200,maxHeight:360,children:(0,v.jsx)(p().A,{type:p().O.Vertical,sections:[{key:"properties",items:P.map((e=>({key:e,action:({event:t})=>{var o;null===(o=t.preventDefault)||void 0===o||o.call(t),"stopPropagation"in t&&t.stopPropagation(),k(e)},render:t=>{var o,n,r;return(0,v.jsx)(d().A,{...t,role:"menuitemcheckbox",title:(null===(o=C[e])||void 0===o?void 0:o.name)||e,left:(0,v.jsxs)("div",{style:T.iconsContainer,children:[(0,v.jsx)("div",{style:T.checkbox,children:(0,v.jsx)(a().S,{checked:A.includes(e),size:16,onClick:()=>k(e)})}),(0,v.jsx)(m().zB,{icon:null===(n=C[e])||void 0===n?void 0:n.icon,type:null===(r=C[e])||void 0===r?void 0:r.type,size:16,theme:M})]})})}}))),render:e=>(0,v.jsx)(u().A,{...e})}],initialFocus:void 0})}),R=(0,v.jsx)(i().A,{alignmentToOrigin:"end",popupType:i().z.Popup,stopClickPropagation:!0,renderOrigin:o=>(0,v.jsx)(d().A,{...o,disabled:e,focused:!1,icon:t?t(T.leftIcon):void 0,buttonStyle:T.buttonContent,title:(0,v.jsx)("span",{style:T.fillDataLabel,children:(0,v.jsx)(f().sA,{defaultMessage:"Can only fill data in",id:"collectionSettings.propertyAgentAutofill.fillDataTitle"})}),right:(0,v.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,v.jsx)("span",{style:T.propertyLabel,children:I()}),(0,v.jsx)(l().I,{icon:y().arrowChevronSingleRightSmallIcon,size:"xxs",style:T.dropdownIcon})]})}),render:()=>_});return{getSelectionLabel:I,propertySelectionDropdown:R,propertySelectionMenu:_}}},992307:(e,t,o)=>{o.d(t,{Z:()=>m,o:()=>y});var n=o(296540),r=()=>o(484714),i=()=>o(898244),a=()=>o(965134),l=()=>o(69708),s=()=>o(901952),c=()=>o(102897),d=()=>o(312296),p=()=>o(547149),u=()=>o(828973),g=o(474848);function m(e){const{property:t,propertySchema:o,collectionContextStore:a}=e,l=(0,r().v3)(),c=(0,n.useCallback)((e=>{const n=a.collectionStore();if(!n||!(0,i().sO)(o))return;const r={...o,limit:Number(e)?1:void 0};p().createAndCommit({userAction:"CollectionSettingsLimitOptions.handleLimitChange",environment:l,canUndo:!0,perform:e=>{(0,d().F)({environment:l,collectionStore:n,update:{[t]:r},transaction:e})}});const c=Number(e)?`${o.type}_toggle_limit_on`:`${o.type}_toggle_limit_off`;(0,s().V)({environment:l,collectionContextStore:a,property:t,from:"view_settings",action:c})}),[a,l,t,o]);return(0,i().sO)(o)?"relation"===o.type&&o.connectedRelation?(0,g.jsx)(y,{propertyType:o.type,connectedRelation:!0,selectedKey:o.limit?"1":"no_limit",onChange:c}):(0,g.jsx)(y,{propertyType:o.type,selectedKey:o.limit?"1":"no_limit",onChange:c}):null}function y(e){const{propertyType:t,selectedKey:o,connectedRelation:n,onChange:r}=e;return(0,g.jsx)(u().A,{icon:a().i,title:(0,g.jsx)(l().sA,{defaultMessage:"Limit",id:"database.viewSettings.collectionPropertyLimitHelpers.limit"}),selectedKey:o,popupStyle:{minWidth:190},options:[(0,c().Q)("1",t,n),(0,c().Q)("no_limit",t)],onChange:r})}}}]);