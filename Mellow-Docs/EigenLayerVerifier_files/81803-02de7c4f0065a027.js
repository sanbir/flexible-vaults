"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[81803],{670:(e,t,o)=>{o.d(t,{Lr:()=>i,PM:()=>r,Ur:()=>a});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698);class n extends(()=>o(757695))().Store{getInitialState(){return{duplicatingWorkflowIds:new Set,isDuplicating:!1}}}const r=new n;function a(e){r.update((t=>{const o=new Set(t.duplicatingWorkflowIds);return o.add(e),{duplicatingWorkflowIds:o,isDuplicating:o.size>0}}))}function i(e){r.update((t=>{if(!t.duplicatingWorkflowIds.has(e))return t;const o=new Set(t.duplicatingWorkflowIds);return o.delete(e),{duplicatingWorkflowIds:o,isDuplicating:o.size>0}}))}},58807:(e,t,o)=>{function n(e,t){return t.default_workflow_id===e}function r(e){const{collectionPointer:t,propertyId:o,workflowId:n}=e;return{pointer:t,command:"set",path:["schema",o,"default_workflow_id"],args:n}}function a(e){const{collectionPointer:t,propertyId:o}=e;return{pointer:t,command:"set",path:["schema",o,"default_workflow_id"],args:void 0}}o.d(t,{DO:()=>n,Eq:()=>r,rK:()=>a})},156145:(e,t,o)=>{o.d(t,{S:()=>r});class n extends(()=>o(757695))().Store{getInitialState(){return{statuses:new Map}}getStatus(e){return this.state.statuses.get(e)}updateStatus(e,t){const o={success:Math.max(0,t.success),in_progress:Math.max(0,t.in_progress),failure:Math.max(0,t.failure),cancelled:Math.max(0,t.cancelled),skipped:Math.max(0,t.skipped)},n=new Map(this.state.statuses);n.set(e,o),this.setState({statuses:n})}initializeStatus(e,t){const o=new Map(this.state.statuses);o.set(e,{success:0,in_progress:t,failure:0,cancelled:0,skipped:0}),this.setState({statuses:o})}}const r=new n},212854:(e,t,o)=>{o.d(t,{W:()=>m,e:()=>g});o(16280),o(944114);var n=()=>o(770063),r=()=>o(792071),a=()=>o(179034),i=()=>o(798880),s=()=>o(743246),l=()=>o(201980),c=()=>o(905470),d=()=>o(498212),p=()=>o(769864),u=()=>o(547149);const f=(0,o(69708).YK)({autofillSingleProperty:{id:"createClientDbAgentWithTriggers.autofillSingleProperty",defaultMessage:"Autofill {property1}"},fillPropertyInstruction:{id:"createClientDbAgentWithTriggers.fillPropertyInstruction",defaultMessage:"Fill in the {propertyName} property in this database."}}),m={shouldTriggerOnPageContentUpdate:!1,shouldTriggerOnPageCreate:!0,shouldTriggerOnPropertyUpdate:!1,shouldTriggerOnRecurrence:!1,recurrenceConfig:void 0};async function g(e){var t,o;const{environment:g,collectionStore:w,intl:v,propertyId:I,propertySchema:y,collectionContextStore:h,includeInstructions:k=!1,shouldPublishAgent:S=!1}=e,b=w.getSpaceId(),A=w.id,C=g.currentUser.id;if(!C)throw new Error("User ID is required to create agent");const P=await g.idCreator.idWithSpaceId(b,s().C0),D=w.getParentId();if(w.getParentTable()!==a().ev||!D)throw new Error("Collection must have a parent block to attach agent");const M=D,_={table:a().ev,id:M,spaceId:b},T=v.formatMessage(f.autofillSingleProperty,{property1:y.name}),O={type:"notion",id:(0,d().Ay)(),name:T,version:c().IN.latestVersion,permissions:[{moduleType:"notion",type:"notion",identifier:{type:"pageOrCollectionViewBlock",blockId:M},actions:["read_and_write"]},{moduleType:"notion",type:"notion",identifier:{type:"workspacePublic"},actions:["reader"]},{moduleType:"notion",type:"search",identifier:{type:"web"},actions:["allow"]}],state:{ownedByDatabasePropertyIds:[I]}},B=(null===(t=h.remoteResultStore.state)||void 0===t?void 0:t.sizeHint)??1e3,x={name:T,triggers:[],instructions:k?(0,l().x9d)(v.formatMessage(f.fillPropertyInstruction,{propertyName:y.name})):[],modules:[O],usage_limit:{type:"runLimit",maximum:Math.max(5*B,1e3)}},{operations:U,model:N}=r().Bgh.create({id:P,parentPointer:_,space_id:b,data:x,createdByPointer:{table:i().oo,id:C},permissions:[{type:"space_permission",role:"read_and_write"}]}),W=[],V=function(e){const{collectionId:t,shouldTriggerOnPageContentUpdate:o,shouldTriggerOnPageCreate:n,shouldTriggerOnRecurrence:r,recurrenceConfig:a}=e,i=[{id:(0,d().Ay)(),name:"Database agent manually triggered",moduleId:void 0,enabled:!0,state:{type:"notion.button.pressed"}}];if(o){const e={id:(0,d().Ay)(),name:"Page Updated",moduleId:void 0,enabled:!0,state:{type:"notion.page.updated",collectionId:t,shouldIgnorePageContentUpdates:!o}};i.push(e)}if(n){const e={id:(0,d().Ay)(),name:"Page Created",moduleId:void 0,enabled:!0,state:{type:"notion.page.created",collectionId:t}};i.push(e)}if(r&&a){const e={id:(0,d().Ay)(),name:"Recurring Schedule",moduleId:void 0,enabled:!0,state:{type:"recurrence",...a}};i.push(e)}return i}({...m,collectionId:A});for(const n of V){const e={pointer:N.pointer,command:"keyedObjectListAfter",path:["data","triggers"],args:{value:n}};W.push(e)}const R={command:"listAfter",path:["format","database_agent_ids"],pointer:_,args:{id:N.id}},E=w.getParentStore();if(!E)throw new Error("Collection must have a parent store");const F=[...W,R],z=w.pointer;if(void 0===(null===(o=w.getSchema()[I])||void 0===o?void 0:o.default_workflow_id)){const e={pointer:z,command:"update",path:["schema",I,"default_workflow_id"],args:P};F.push(e)}const{serverCommitResult:q}=u().createAndCommit({userAction:"TableHeaderCellMenu.createClientDbAgentWithTriggers",environment:g,canUndo:!1,perform:e=>{for(const t of U)u().applyOperation({store:(0,n().v3)(E,t.pointer),operation:t,transaction:e});for(const t of F)u().applyOperation({store:(0,n().v3)(E,t.pointer),operation:t,transaction:e})}}),j=[...U,...F];return await q,S&&await p().callApi({eventName:"publishCustomAgentVersion",environment:g,data:{workflowId:P,spaceId:b}}),{workflowId:P,operations:j}}},435386:(e,t,o)=>{o.d(t,{w:()=>r});var n=()=>o(651784);function r({url:e,config:t}){const o=(0,n().parseRoute)({url:e,baseUrl:t.domainBaseUrl,publicDomainName:t.publicDomainName,isMobile:!1,protocol:t.protocol,currentUrl:void 0});return"page"===o.name?o.blockId:"team"===o.name?o.peekViewBlockId:void 0}},445560:(e,t,o)=>{o.d(t,{X:()=>n});const n=o(757695).Store.createValue({shouldReset:!1},{name:"MobileAssistantMenuStore"})},607567:(e,t,o)=>{o.d(t,{Z:()=>a});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.12 16.74 14.99",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M4.5 4.125A2.125 2.125 0 0 0 2.375 6.25v7.5c0 1.174.951 2.125 2.125 2.125h5.702a4.7 4.7 0 0 1-.2-1.25H4.5a.875.875 0 0 1-.875-.875V7.5h12.75v2.535a4.7 4.7 0 0 1 1.25.684V6.25A2.125 2.125 0 0 0 15.5 4.125zm.758 1.684a.625.625 0 1 1-1.25 0 .625.625 0 0 1 1.25 0m1.375-.625a.625.625 0 1 1 0 1.25.625.625 0 0 1 0-1.25m2.625.625a.625.625 0 1 1-1.25 0 .625.625 0 0 1 1.25 0"}),(0,n.jsx)("path",{d:"M17.7 16.607a3.625 3.625 0 1 0-.893.878l1.223 1.427a.625.625 0 0 0 .94-.823zM12.375 14.5a2.375 2.375 0 1 1 4.75 0 2.375 2.375 0 0 1-4.75 0"})]})},a=(0,o(340498).wt)("browserMagnifyingGlass",r,"default")},619553:(e,t,o)=>{o.d(t,{B:()=>i});var n=()=>o(459621),r=()=>o(59145),a=()=>o(441748);function i({openInNew:e,url:t,makeTabActive:o,position:i,isNewPage:s,environment:l}){"tab"===e&&o?(0,r().x)(l,{url:t,position:i,makeTabActive:o,isNewPage:s}):"tab"!==e||o?"window"===e&&(0,a().E)(t):(0,n().x)(l,{url:t,position:i})}},815510:(e,t,o)=>{o.d(t,{$6:()=>N,D9:()=>_,GK:()=>D,MT:()=>R,XL:()=>M,Xp:()=>x,ay:()=>B,deleteDatabaseAgentsFromProperty:()=>E,gT:()=>U,nw:()=>T,r1:()=>V,wm:()=>W});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(803949),o(581454),o(737550);var n=o.n(o(794148)),r=()=>o(128933),a=()=>o(295633),i=()=>o(350013),s=()=>o(898244),l=()=>o(134025),c=()=>o(179034),d=()=>o(743246),p=()=>o(201980),u=()=>o(142918),f=()=>o(498212),m=()=>o(877661),g=()=>o(769864),w=()=>o(357625),v=()=>o(388832),I=()=>o(58807),y=()=>o(212854),h=()=>o(156145),k=()=>o(250064),S=()=>o(295304),b=()=>o(547149),A=()=>o(687879),C=()=>o(22673);const P=(0,o(69708).YK)({autofillProperties:{id:"collectionSettingsPropertyAgentAutofillActions.autofillProperties",defaultMessage:"Autofill {propertyList}"},instructionsPageTitle:{id:"collectionSettingsPropertyAgentAutofillActions.instructionsPageTitle",defaultMessage:"Auto-fill {propertyName} Instructions"},fillPropertyInstruction:{id:"collectionSettingsPropertyAgentAutofillActions.fillPropertyInstruction",defaultMessage:"Fill in the {propertyName} property in this database."}});async function D(e){const{environment:t,collectionStore:o,intl:n,propertyId:r,propertySchema:a,workflows:s,collectionContextStore:l,includeInstructions:c=!1,shouldPublishAgent:u=!1,createInstructionsPage:f=!1}=e,m=await(0,y().e)({environment:t,collectionStore:o,intl:n,propertyId:r,propertySchema:a,collectionContextStore:l,includeInstructions:c,shouldPublishAgent:u});!a.default_workflow_id&&m.workflowId&&M({workflowId:m.workflowId,propertyId:r,collectionStore:o,workflows:s,environment:t});if(c&&f&&m.workflowId){const e=o.getParentCollectionViewBlockStore()??l.collectionViewBlockStore(),r=o.getSpaceId();if(e&&r){const o=i().N.createChildStore(e,{table:d().C0,id:m.workflowId,spaceId:r});await A().ensureInstructionsPage({workflowStore:o,environment:t,title:n.formatMessage(P.instructionsPageTitle,{propertyName:a.name}),draftInstructions:(0,p().x9d)(n.formatMessage(P.fillPropertyInstruction,{propertyName:a.name}))}),await _({environment:t,hideSnackbar:!0,spaceId:r,workflowStore:o,intl:n})}}return m.workflowId&&(0,C().Ye)({environment:t,workflowId:m.workflowId}),m.workflowId}function M(e){const{workflowId:t,propertyId:o,collectionStore:n,workflows:r,environment:a}=e,i=n.pointer;b().createAndCommit({userAction:"AgentsSubmenu.setDefaultWorkflow",environment:a,canUndo:!0,perform:e=>{const a=(0,I().Eq)({collectionPointer:i,propertyId:o,workflowId:t});b().applyOperation({store:n,operation:a,transaction:e});const s=r.find((e=>e.id===t));if(s){const r=s.getDraftData()??s.getData();if(null!=r&&r.modules){const a=r.modules.map((e=>{if("notion"===e.type){var t;const n=(null===(t=e.state)||void 0===t?void 0:t.ownedByDatabasePropertyIds)??[];if(!n.includes(o))return{...e,state:{...e.state,ownedByDatabasePropertyIds:[...n,o]}}}return e}));if(a.some(((e,t)=>{var o;return e!==(null===(o=r.modules)||void 0===o?void 0:o[t])}))){const o=n.getSpaceId(),r={command:"set",path:["data","modules"],args:a,pointer:{id:t,table:d().C0,spaceId:o}};b().applyOperation({store:s,operation:r,transaction:e})}}}}})}async function _(e){const{workflowStore:t,environment:o,spaceId:n,hideSnackbar:a=!1,intl:i}=e;a||r().D6({label:i.formatMessage({defaultMessage:"Saving agent...",id:"publishDBAgent.savingProgress"}),durationMs:"keep"});const s="success"===(await g().callApi({eventName:"publishCustomAgentVersion",environment:o,data:{workflowId:t.id,spaceId:n}})).type;return a||(r().N2(),s?r().D6({label:i.formatMessage({defaultMessage:"Agent published successfully",id:"publishDBAgent.publishSuccess"})}):r().D6({label:i.formatMessage({defaultMessage:"Failed to publish agent",id:"publishDBAgent.publishFail"})})),s&&(0,C().j3)({environment:o,workflowId:t.id}),{success:s}}function T(e){const{blockStore:t,property:o,environment:n}=e;b().createAndCommit({userAction:"WorkflowAutofillButton.clearCellValue",environment:n,canUndo:!1,perform:e=>{"title"===o?S().R9({environment:t.environment,store:t.getPropertyStore(o),value:(0,p().x9d)(""),transaction:e}):b().applyOperation({store:t,operation:l().op.set({pointer:t.pointer,path:["properties",o],args:(0,p().x9d)("")}),transaction:e})}})}function O(e){const{environment:t,collectionContextStore:o,n,spaceId:r,blockIds:i}=e;if(i&&i.length>0){return Array.from(new Set(i)).slice(0,n).map((e=>new(a().B)(t,{table:c().ev,id:e,spaceId:r})))}const s=o.resultsInViewOrder(n);return s.length>0?s.slice(0,n):Array.from(o.resultSetStore.state.blockIds).map((e=>new(a().B)(t,{table:c().ev,id:e,spaceId:r}))).slice(0,n)}async function B(e){const{n:t,collectionContextStore:o,workflowStore:n,currentCollectionStore:a,environment:i,properties:s,spaceId:l,onEnqueueStart:p,onEnqueueComplete:u,blockIds:f}=e,g=O({collectionContextStore:o,environment:i,n:t,spaceId:l,blockIds:f});if(0===g.length)return{firstNWorkflowAutomationRunIds:[],totalBlocks:0};g.forEach((e=>{s.forEach((t=>{T({blockStore:e,property:t,environment:i})}))})),g.forEach((e=>{F({blockStore:e,propertyIds:s,environment:i})}));const v=g.map((e=>e.id));p(),await Promise.resolve();const I=(0,w().UT)(i,m().m,{type:"blockFill",workflowPointer:{table:d().C0,id:n.id,spaceId:l},collectionId:a.id,blockIds:v.map((e=>({table:c().ev,id:e,spaceId:l}))),propertyIds:s},{spaceIds:[l]});let y=!1,k=[],S=g.length;for await(const c of I){var b,A;if("failure"===c.taskStatus)return r().D6({label:"Failed to trigger agent for selected rows"}),{firstNWorkflowAutomationRunIds:[],totalBlocks:0};"value"in c&&null!==(b=c.value)&&void 0!==b&&b.groupId&&!y&&(S=c.value.totalBlocks??g.length,h().S.initializeStatus(c.value.groupId,S),y=!0),"value"in c&&null!==(A=c.value)&&void 0!==A&&A.workflowAutomationRunIds&&(k=c.value.workflowAutomationRunIds)}return u(S),(0,C().YH)({environment:i,workflowId:n.id,rowCount:t,origin:"modal"}),{firstNWorkflowAutomationRunIds:k,totalBlocks:S}}async function x(e){var t;const{workflowStore:o,currentCollectionStore:n,collectionContextStore:a,environment:i,spaceId:l,properties:c,onEnqueueStart:p,onEnqueueComplete:u}=e,f=n.id,g=null===(t=a.collectionViewStore())||void 0===t?void 0:t.id;if(!g)return r().D6({label:"Failed to start fill all operation"}),{success:!1,firstNWorkflowAutomationRunIds:[],totalBlocks:0};p();const v=O({collectionContextStore:a,environment:i,n:s().mz,spaceId:l});if(0===v.length)return{success:!0,firstNWorkflowAutomationRunIds:[],totalBlocks:0};v.forEach((e=>{c.forEach((t=>{T({blockStore:e,property:t,environment:i})}))})),v.forEach((e=>{F({blockStore:e,propertyIds:c,environment:i})}));const I=(0,w().UT)(i,m().m,{type:"viewFill",workflowPointer:{table:d().C0,id:o.id,spaceId:l},collectionId:f,...g&&{viewId:g},propertyIds:c},{spaceIds:[l]});let y=!1,k=!1,S=[],b=v.length;for await(const r of I){var A,P,D;if("failure"===r.taskStatus){y=!1;break}"value"in r&&null!==(A=r.value)&&void 0!==A&&A.groupId&&!k&&(b=r.value.totalBlocks??v.length,h().S.initializeStatus(r.value.groupId,b),k=!0),"value"in r&&null!==(P=r.value)&&void 0!==P&&P.workflowAutomationRunIds&&(S=r.value.workflowAutomationRunIds),"success"===r.taskStatus&&"value"in r&&null!==(D=r.value)&&void 0!==D&&D.success&&(y=!0)}return y?(u(b),(0,C().YH)({environment:i,workflowId:o.id,rowCount:"all",origin:"modal"})):r().D6({label:"Failed to start fill all operation"}),{success:y,firstNWorkflowAutomationRunIds:S,totalBlocks:b}}function U(e){const{workflowStore:t,currentCollectionStore:o,environment:n,spaceId:r,triggerStates:a,triggerType:i,enabled:s}=e,l=o.id;b().createAndCommit({userAction:"CollectionSettingsPropertyAgentAutofill.updateTriggers",environment:n,canUndo:!0,perform:e=>{var o,n,c,p;const u=t.getDraftData()??t.getData(),m=(null==u?void 0:u.triggers)??[],g=e=>m.find((t=>{var o;return(null===(o=t.state)||void 0===o?void 0:o.type)===e})),w=e=>{const{existing:t,defaultName:o,enabled:n,state:r}=e;return{...t??{},id:(null==t?void 0:t.id)??(0,f().lZ)(),name:(null==t?void 0:t.name)??o,moduleId:null==t?void 0:t.moduleId,enabled:n,state:r}},v={...a,[i]:s},I=[],y=g("notion.button.pressed"),h="notion.button.pressed"===(null==y||null===(o=y.state)||void 0===o?void 0:o.type)?y.state:{type:"notion.button.pressed"};I.push(w({existing:y,defaultName:"Database agent manually triggered",enabled:!0,state:h}));const k=g("notion.page.updated"),S="notion.page.updated"===(null==k||null===(n=k.state)||void 0===n?void 0:n.type)?k.state:void 0,A=v.shouldTriggerOnPageContentUpdate||v.shouldTriggerOnPropertyUpdate;(A||k)&&I.push(w({existing:k,defaultName:"Page Updated",enabled:A,state:{...S??{},type:"notion.page.updated",collectionId:l,...A&&{shouldIgnorePageContentUpdates:v.shouldTriggerOnPropertyUpdate&&!v.shouldTriggerOnPageContentUpdate}}}));const C=g("notion.page.created"),P="notion.page.created"===(null==C||null===(c=C.state)||void 0===c?void 0:c.type)?C.state:void 0;(v.shouldTriggerOnPageCreate||C)&&I.push(w({existing:C,defaultName:"Page Created",enabled:v.shouldTriggerOnPageCreate,state:{...P??{},type:"notion.page.created",collectionId:l}}));const D=g("recurrence"),M="recurrence"===(null==D||null===(p=D.state)||void 0===p?void 0:p.type)?D.state:void 0;if(v.shouldTriggerOnRecurrence&&v.recurrenceConfig||D){const e=M&&"recurrence"===M.type?{...M,...v.recurrenceConfig??{},collectionId:l}:v.recurrenceConfig?{type:"recurrence",collectionId:l,...v.recurrenceConfig}:void 0;I.push(w({existing:D,defaultName:"Recurring Schedule",enabled:Boolean(v.shouldTriggerOnRecurrence&&v.recurrenceConfig),state:e}))}const _={command:"update",path:["data"],args:{triggers:I},pointer:{id:t.id,table:d().C0,spaceId:r}};b().applyOperation({store:t,operation:_,transaction:e})}})}function N(e){const{workflowStore:t,environment:o,spaceId:n,newSearchStates:r,collectionViewBlockId:a}=e;b().createAndCommit({userAction:"CollectionSettingsPropertyAgentAutofill.updateSearchPermissions",environment:o,canUndo:!0,perform:e=>{const o=t.getDraftData()??t.getData();if(null==o||!o.modules)return;const i=o.modules.find((e=>"notion"===e.type));if(!i||"notion"!==i.type)return;const s=function(e){const{searchStates:t,collectionViewBlockId:o}=e,n=[];return n.push({moduleType:"notion",type:"notion",identifier:{type:"pageOrCollectionViewBlock",blockId:o},actions:["read_and_write"]}),t.canSearchWorkspace&&n.push({moduleType:"notion",type:"notion",identifier:{type:"workspacePublic"},actions:["reader"]}),t.canSearchWeb&&n.push({moduleType:"notion",type:"search",identifier:{type:"web"},actions:["allow"]}),n}({searchStates:r,collectionViewBlockId:a}),l={command:"set",path:["data","modules"],args:o.modules.map((e=>"notion"===e.type?{...e,permissions:s}:e)),pointer:{id:t.id,table:d().C0,spaceId:n}};b().applyOperation({store:t,operation:l,transaction:e})}}),(0,C().G1)({environment:o,workflowId:t.id,canSearchWorkspace:r.canSearchWorkspace,canSearchWeb:r.canSearchWeb})}function W(e){const{workflowStore:t,environment:o,spaceId:n,newName:r}=e;b().createAndCommit({userAction:"CollectionSettingsPropertyAgentAutofill.updateName",environment:o,canUndo:!0,perform:e=>{const o=t.getDraftData()??t.getData();if(null==o||!o.modules)return;const a={command:"set",path:["data","name"],args:r,pointer:{id:t.id,table:d().C0,spaceId:n}};b().applyOperation({store:t,operation:a,transaction:e})}})}function V(e){const{workflowStore:t,collectionStore:o,environment:n,intl:r,spaceId:a,selectedProperties:i}=e,s=t.getDraftData()??t.getData();b().createAndCommit({userAction:"CollectionSettingsPropertyAgentAutofill.updateSelectedProperties",environment:n,canUndo:!0,perform:e=>{var n;if(null==s||!s.modules)return;const l=s.modules.find((e=>"notion"===e.type)),c="notion"===(null==l?void 0:l.type)?(null===(n=l.state)||void 0===n?void 0:n.ownedByDatabasePropertyIds)??[]:[],p=c.filter((e=>!i.includes(e))),f=i.filter((e=>!c.includes(e))),m=o.getSchema();for(const r of p){const n=null==m?void 0:m[r];if(n&&n.default_workflow_id===t.id){const t=(0,I().rK)({collectionPointer:o.pointer,propertyId:r});b().applyOperation({store:o,operation:t,transaction:e})}}for(const r of f){const n=null==m?void 0:m[r];if(n&&!n.default_workflow_id){const n=(0,I().Eq)({collectionPointer:o.pointer,propertyId:r,workflowId:t.id});b().applyOperation({store:o,operation:n,transaction:e})}}const g={command:"set",path:["data","modules"],args:s.modules.map((e=>"notion"===e.type?{...e,state:{...e.state,ownedByDatabasePropertyIds:i}}:e)),pointer:{id:t.id,table:d().C0,spaceId:a}};b().applyOperation({store:t,operation:g,transaction:e});const w=function(e){const{selectedPropertyIds:t,collectionSchema:o,intl:n}=e;if(!o||0===t.length)return"";const r=[];for(const s of t){var a;const e=null===(a=o[s])||void 0===a?void 0:a.name;e&&r.push(e)}if(0===r.length)return"";const i=(0,k().l)(r);return n.formatMessage(P.autofillProperties,{propertyList:i})}({selectedPropertyIds:i,collectionSchema:m,intl:r});if(w){const o=(0,u().i)({pointer:{id:t.id,table:d().C0,spaceId:a},name:w});b().applyOperation({store:t,operation:o,transaction:e})}}}),(0,C().H)({environment:n,workflowId:t.id,numProperties:i.length})}function R(e){const{workflowStore:t,collectionStore:o,collectionViewBlockStore:n,environment:r,spaceId:a}=e;n&&a&&(b().createAndCommit({environment:r,userAction:"CollectionViewAgentsMenu.deleteAgent",canUndo:!0,perform:e=>{b().applyOperation({store:t,transaction:e,operation:{pointer:t.pointer,command:"set",path:["alive"],args:!1}});const r=n.getFormat()||{},i="database_agent_ids"in r&&r.database_agent_ids||[],s=i.filter((e=>e!==t.id));i.length!==s.length&&b().applyOperation({store:n,transaction:e,operation:{pointer:{id:n.id,table:c().ev,spaceId:a},command:"set",path:["format","database_agent_ids"],args:s}});const l=o.getSchema();if(l)for(const[n,a]of Object.entries(l))if((null==a?void 0:a.default_workflow_id)===t.id){const t=(0,I().rK)({collectionPointer:o.pointer,propertyId:n});b().applyOperation({store:o,transaction:e,operation:t})}}}),(0,C().dQ)({environment:r,workflowId:t.id}))}function E(e){const{collectionStore:t,environment:o,property:r}=e,a=t.getSpaceId(),i=t.getParentCollectionViewBlockStore();n().ok(i);const s=(0,v().so)({collectionStore:t,spaceId:a});n().ok(!s.error);const l=(0,v().gY)({workflowsData:s.value,collectionViewBlockStore:i,currentCollectionStore:t,property:r,spaceId:a});for(const n of l)R({workflowStore:n,collectionStore:t,collectionViewBlockStore:i,environment:o,spaceId:a})}function F(e){const{blockStore:t,propertyIds:o,environment:n}=e;0!==o.length&&b().createAndCommit({userAction:"agentWorkflowCreatingTask",environment:n,canUndo:!1,perform:e=>{o.map((e=>l().op.update({pointer:t.pointer,path:["format","agent_workflow_status"],args:{[e]:{type:"creatingTask",createdAtMs:Date.now()}}}))).forEach((o=>{b().applyOperation({store:t,operation:o,transaction:e})}))}})}},877661:(e,t,o)=>{o.d(t,{m:()=>n});const n=(0,o(583835).Dv)("triggerAgentOverCollectionTask")},916275:(e,t,o)=>{o.d(t,{P:()=>a});o(16280),o(898992),o(354520),o(672577),o(737550);var n=()=>o(449412);class r extends(()=>o(62175))().U{isModelAvailable(e,t,o){const n=this.getData(e,{spaceId:t});return!!n&&n.some((e=>e.model===o))}isModelDisabled(e,t,o){const n=this.getData(e,{spaceId:t});if(!n)return!1;const r=n.find((e=>e.model===o));return(null==r?void 0:r.isDisabled)??!1}getModelsForMode(e,t,o){const n=this.getData(e,{spaceId:t});if(n)return n.filter((e=>"markdown-chat"===o?void 0!==e.markdownChat:void 0!==e.workflow))}}const a=new r(((e,{spaceId:t})=>`${e.currentUser.id}:${t}`),(async(e,{spaceId:t})=>{const r=e.currentUser.id;try{const a=await e.api.callCellCompatibleApi({eventName:"getAvailableModels",environment:e,cellNavigation:{spaceId:t},data:{spaceId:t}});if("failed"===a.type){const e=(0,o(247584).V4)(a);return void n().O8(new Error(`Failed to fetch available models: ${e}`),{from:"AvailableModelsStore.fetch",type:"api_failed_response",data:{spaceId:t,userId:r,errorMessage:e}})}return 0===a.data.models.length&&n().O8(new Error("Received empty model list from server"),{from:"AvailableModelsStore.fetch",type:"empty_response",data:{spaceId:t,userId:r}}),a.data.models}catch(a){return void n().O8(a,{from:"AvailableModelsStore.fetch",type:"error",data:{spaceId:t,userId:r}})}}),{dontCacheUndefined:!0});(0,o(852832).exposeDebugValue)("availableAiModelsStore",a)}}]);