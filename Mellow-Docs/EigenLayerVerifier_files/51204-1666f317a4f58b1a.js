"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[51204],{61384:(e,t,n)=>{n.d(t,{DF:()=>r,sU:()=>c,zb:()=>l});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);var i=()=>n(891317),o=()=>n(792057),s=()=>n(45331),a=()=>n(769864);async function r(e){const{environment:t,spaceId:n,operations:r,allowListEnabled:l}=e,c={integrationId:s().A,spaceId:n,...void 0!==r?{operations:r}:{},...void 0!==l?{allowListEnabled:l}:{}},d=await a().callApi({eventName:"updateMcpPermissions",environment:t,data:c});"success"===d.type?d.data.mcp_config&&i().bM.updateMcpConfig(d.data.mcp_config):o().Qg(d)}async function l(e){const{environment:t,spaceId:n,clientId:s,displayName:r,iconEmoji:l}=e,c={...void 0!==r?{displayName:r}:{},...void 0!==l?{iconEmoji:l}:{}};if(0===Object.keys(c).length)return;const d=await a().callApi({eventName:"updateMcpClientConfig",environment:t,data:{spaceId:n,clientId:s,...c}});if("success"===d.type){var g;const e=i().bM.getMcpConfig(),t=null===(g=e.clients)||void 0===g?void 0:g[s];t&&i().bM.updateMcpConfig({...e,clients:{...e.clients,[s]:{...t,details:{...t.details,...void 0!==r&&{displayName:r},...void 0!==l&&{iconEmoji:l}}}}})}else o().Qg(d)}async function c(e){const{environment:t,spaceId:n,redirectUrl:i}=e,o=await a().callApi({eventName:"checkMcpClientAllowed",environment:t,data:{spaceId:n,redirectUrl:i}});return"success"===o.type?o.data:{allowed:!0,displayName:void 0,isTrustedClient:!1,isInWorkspaceAllowlist:!1}}},452745:(e,t,n)=>{n.r(t),n.d(t,{checkmarkShieldFillSmallIcon:()=>o,iconDefinition:()=>i});n(296540);const i={viewBox:"0 0 16 16",fittedViewBox:"2.85 2.2 10.29 11.6",svg:(0,n(474848).jsx)("path",{d:"M7.755 2.26a.55.55 0 0 1 .49 0l.962.482a7.3 7.3 0 0 0 3.277.774h.11c.302 0 .547.244.547.547v4.333a4.92 4.92 0 0 1-2.983 4.524l-1.943.833a.55.55 0 0 1-.43 0l-1.943-.833A4.92 4.92 0 0 1 2.86 8.396V4.062c0-.302.245-.546.547-.546h.11c1.138 0 2.26-.265 3.277-.774zm2.567 4.123a.55.55 0 0 0-.944-.566L7.371 9.163 6.268 7.875a.55.55 0 1 0-.836.716l1.6 1.867a.55.55 0 0 0 .89-.075z"})},o=(0,n(340498).wt)("checkmarkShieldFillSmall",i,"fillSmall")},483979:(e,t,n)=>{n.d(t,{Ay:()=>kn,s_:()=>_n,mX:()=>Dn});n(944114),n(898992),n(354520),n(581454),n(908872);var i=n(296540),o=()=>n(564884),s=()=>n(907258),a=()=>n(59226),r=()=>n(726637),l=()=>n(484714),c=()=>n(590526),d=()=>n(401497),g=()=>n(365917),p=()=>n(891317),u=()=>n(457205),m=()=>n(849255),h=()=>n(741615),f=()=>n(388926),y=()=>n(807449),b=()=>n(416783),x=()=>n(463438),v=()=>n(302501),S=()=>n(148307),A=()=>n(529099),j=()=>n(452745),I=()=>n(617668),C=()=>n(388693),M=()=>n(558687),w=()=>n(824862),k=()=>n(798880),T=()=>n(322769),B=()=>n(795523),P=()=>n(84262),N=()=>n(979340),_=()=>n(20498),D=()=>n(69708),E=()=>n(100622),L=()=>n(496603),O=()=>n(534177),z=()=>n(284371),R=()=>n(209660),W=()=>n(384944),K=()=>n(663929);const U=n.p+"ce499dd1f3aabcfa.png";var V=()=>n(604018),F=()=>n(974679),q=()=>n(949734),Y=()=>n(702723),H=()=>n(310001),$=()=>n(709062),G=()=>n(232930),X=()=>n(477293),Z=()=>n(919960),J=()=>n(752860),Q=()=>n(305448),ee=()=>n(457063),te=()=>n(644914),ne=()=>n(888526),ie=()=>n(963186),oe=()=>n(955054),se=()=>n(404141),ae=()=>n(528093),re=()=>n(303470),le=()=>n(547149),ce=()=>n(396896),de=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),()=>n(699143)),ge=()=>n(250910),pe=()=>n(546926),ue=()=>n(160432),me=()=>n(493552),he=()=>n(373009),fe=()=>n(890492),ye=()=>n(81068),be=()=>n(663639),xe=()=>n(736847),ve=()=>n(324254),Se=()=>n(29037),Ae=()=>n(173614),je=()=>n(817087),Ie=()=>n(85314),Ce=()=>n(61384),Me=()=>n(394888),we=()=>n(249046),ke=()=>n(89002),Te=()=>n(31511),Be=()=>n(450424),Pe=()=>n(344417),Ne=()=>n(858141),_e=()=>n(241021),De=()=>n(838239),Ee=n(474848);function Le(e){const{icon:t,badge:n,size:i=48,borderRadius:o=8,showBorder:s=!0,backgroundColor:a,badgeBackgroundColor:r=E().Tj.blue.background.primary,badgeSize:l=16,badgePosition:c="bottom-right",badgeOffset:g=-4,opacity:p}=e,u=(0,d().IS)((()=>{const e=function(e,t){switch(e){case"bottom-right":return{bottom:t,insetInlineEnd:t};case"bottom-left":return{bottom:t,insetInlineStart:t};case"top-right":return{top:t,insetInlineEnd:t};case"top-left":return{top:t,insetInlineStart:t}}}(c,g);return{container:{width:i,height:i,borderRadius:o,border:s?`1px solid ${E().Tj.border.primary}`:void 0,backgroundColor:a,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",flexShrink:0,opacity:p},badge:{position:"absolute",...e,width:l,height:l,borderRadius:"50%",backgroundColor:r,display:"flex",alignItems:"center",justifyContent:"center"}}}),[i,o,s,a,r,l,c,g,p]);return(0,Ee.jsxs)("div",{style:u.container,children:[t,(0,Ee.jsx)("div",{style:u.badge,children:n})]})}const Oe=(0,D().YK)({modalTitle:{id:"approveExternalAgentsModal.title",defaultMessage:"Approve external AI tools"},modalDescription:{id:"approveExternalAgentsModal.description",defaultMessage:"Search to add more, or connect a new app to auto-approve"},modalSearchPlaceholder:{id:"approveExternalAgentsModal.searchPlaceholder",defaultMessage:"Search external AI tools"},modalSelectedCount:{id:"approveExternalAgentsModal.selectedCount",defaultMessage:"{count, plural, one {# external AI tool selected} other {# external AI tools selected}}"},modalAlreadyAdded:{id:"approveExternalAgentsModal.alreadyAdded",defaultMessage:"Already added"},modalApproveButton:{id:"approveExternalAgentsModal.approveButton",defaultMessage:"Approve external AI tools"},modalCancelButton:{id:"approveExternalAgentsModal.cancelButton",defaultMessage:"Cancel"},modalError:{id:"approveExternalAgentsModal.error",defaultMessage:"Failed to approve external AI tools. Please try again."},noSearchResults:{id:"approveExternalAgentsModal.noSearchResults",defaultMessage:"No external AI tools found"}});function ze(e){const{open:t,onDismiss:n,onApprove:o,availableClients:s}=e,a=(0,D().tz)(),[r,l]=(0,i.useState)(""),[c,g]=(0,i.useState)(new Set),[p,u]=(0,i.useState)(!1),[m,h]=(0,i.useState)(),f=(0,i.useCallback)((e=>{g((t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n}))}),[]),b=(0,i.useCallback)((async()=>{h(void 0),u(!0);try{await o(Array.from(c)),g(new Set),l("")}catch{h(a.formatMessage(Oe.modalError))}finally{u(!1)}}),[o,c,a]),x=(0,i.useCallback)((()=>{g(new Set),l(""),h(void 0),n()}),[n]),v=s.filter((e=>e.displayName.toLowerCase().includes(r.toLowerCase()))),S=(0,d().IS)((()=>({agentList:{width:"100%",overflowY:"auto",maxHeight:300}})),[]);return(0,Ee.jsx)(Me().s,{isOpen:t,onDismiss:x,showCloseIcon:!1,ariaLabel:a.formatMessage(Oe.modalTitle),areaConstraint:{width:{type:"range",min:580,max:720},height:{type:"range",min:400,max:720}},render:()=>(0,Ee.jsx)(ke().t,{header:(0,Ee.jsxs)(ce().VP,{gap:16,children:[(0,Ee.jsx)(De().Y,{iconAndTitle:(0,Ee.jsxs)(de().Y1,{align:"top-center",gap:9,children:[(0,Ee.jsx)(Le,{icon:(0,Ee.jsx)(y().I,{icon:Ne().squareGrid2X2Icon,size:"lg"}),badge:(0,Ee.jsx)(y().I,{icon:Be().checkmarkCircleFillSmallIcon,size:"default",colorVariant:"accentPrimary",colorPalette:"blue"})}),(0,Ee.jsx)(me().D,{styleKey:"titleSmSemibold",colorVariant:"primary",style:{lineHeight:"32px"},children:(0,Ee.jsx)(D().sA,{...Oe.modalTitle})})]}),description:(0,Ee.jsx)(D().sA,{...Oe.modalDescription})}),(0,Ee.jsx)(Te().A,{format:"default",value:r,onChange:e=>l(e.target.value),placeholder:a.formatMessage(Oe.modalSearchPlaceholder),icon:(0,Ee.jsx)(y().I,{icon:Pe().magnifyingGlassSmallIcon,size:"sm"}),style:{height:32}})]}),footer:(0,Ee.jsx)(_e().a,{layout:"vertical",primaryButtons:[{buttonType:"primary",label:(0,Ee.jsx)(D().sA,{...Oe.modalApproveButton}),onClick:b,isDisabled:0===c.size,isLoading:p}],secondaryButtons:[{buttonType:"plain",label:(0,Ee.jsx)(me().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:(0,Ee.jsx)(D().sA,{...Oe.modalCancelButton})}),onClick:x}]}),children:(0,Ee.jsxs)(we().wt,{gap:8,style:S.agentList,children:[m?(0,Ee.jsx)(me().D,{styleKey:"captionMedium",colorPalette:"red",children:m}):null,c.size>0?(0,Ee.jsx)(me().D,{styleKey:"captionMedium",colorVariant:"secondary",children:(0,Ee.jsx)(D().sA,{...Oe.modalSelectedCount,values:{count:c.size}})}):null,0===v.length&&r?(0,Ee.jsx)(me().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,Ee.jsx)(D().sA,{...Oe.noSearchResults})}):null,v.map((e=>(0,Ee.jsx)(Re,{clientId:e.clientId,clientIcon:e.clientIcon,displayName:e.displayName,description:e.description,isSelected:c.has(e.clientId),isDisabled:e.isAlreadyAdded,onToggle:f},e.clientId)))]})})})}function Re(e){const{clientId:t,clientIcon:n,displayName:o,description:s,isSelected:a,isDisabled:r,onToggle:l}=e,c=(0,D().tz)(),g=(0,i.useCallback)((()=>{r||l(t)}),[r,l,t]),p=(0,i.useCallback)((e=>{r||"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),l(t))}),[r,l,t]),u=(0,d().IS)((()=>({wrapper:{width:"100%",cursor:r?"default":"pointer",borderRadius:8,border:a&&!r?`2px solid ${E().Tj.blue.border.accentPrimary}`:`1px solid ${E().Tj.border.secondary}`,boxShadow:E().Tj.shadow.outline.sm,padding:a&&!r?11:12},alreadyAddedLabel:{whiteSpace:"nowrap",flexShrink:0,alignSelf:"center"}})),[a,r]);return(0,Ee.jsx)("div",{style:u.wrapper,onClick:g,role:"button",tabIndex:r?-1:0,onKeyDown:p,"aria-selected":a,"aria-disabled":r,children:(0,Ee.jsxs)(de().Y1,{direction:"horizontal",gap:12,align:"top-left",children:[n,(0,Ee.jsxs)(ce().VP,{grow:1,minWidth:0,children:[(0,Ee.jsx)(me().D,{styleKey:"bodyLgSemibold",colorVariant:"primary",children:o}),(0,Ee.jsx)(me().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:s})]}),r?(0,Ee.jsx)(me().D,{styleKey:"bodySmRegular",colorVariant:"tertiary",style:u.alreadyAddedLabel,children:c.formatMessage(Oe.modalAlreadyAdded)}):null]})})}function We(e){const{size:t,icon:n,backgroundColor:i,border:o,borderRadius:s,boxShadow:a,opacity:r}=e,l=(0,d().IS)((()=>({container:{display:"flex",alignItems:"center",justifyContent:"center",width:t,height:t,backgroundColor:i,border:o,borderRadius:s,boxShadow:a,flexShrink:0,opacity:r}})),[t,i,o,s,a,r]);return(0,Ee.jsx)("div",{style:l.container,children:(0,Ee.jsx)(y().I,{icon:n,size:"default"})})}var Ke=()=>n(756123),Ue=()=>n(465505),Ve=()=>n(212727),Fe=()=>n(340498),qe=()=>n(718827),Ye=()=>n(383594),He=()=>n(486666),$e=()=>n(663173);const Ge=(0,D().YK)({pickerTitle:{id:"emojiPickerButton.title",defaultMessage:"Pick an emoji"},emojiTab:{id:"emojiPickerButton.emojiTab",defaultMessage:"Emoji"}});function Xe({emoji:e,onChange:t,defaultIcon:n,size:o,buttonSize:s=36,showBorder:a=!0,ariaLabel:r}){const g=(0,l().v3)(),p=(0,D().tz)(),u=(0,i.useRef)(null),m=(0,c().uB)(void 0,$e().A),h=(0,d().IS)((()=>({button:{display:"flex",alignItems:"center",justifyContent:"center",width:s,height:s,flexShrink:0,borderRadius:6,...a&&{boxShadow:`inset 0 0 0 1px ${E().Tj.border.secondary}`}}})),[s,a]),f=(0,i.useCallback)((()=>{const e=u.current;if(!e)return;const n=e.getBoundingClientRect();Ye().W(g,{originGap:4,originRect:n,popupWidth:He().jv,isSmallWidth:!1,title:p.formatMessage(Ge.pickerTitle),currentTab:"emoji",tabs:[{type:"emoji",title:p.formatMessage(Ge.emojiTab),onChange:e=>{Ye().I(),m.reset(),t(e)},tabHeight:He().cx}],hideCustomEmoji:!0})}),[g,p,t,m]);return(0,Ee.jsx)(qe().Ay,{ref:u,style:h.button,onClick:f,ariaLabel:r,children:e?(0,Ee.jsx)(Ke().A,{size:o,emoji:e}):n})}const Ze=(0,D().YK)({title:{id:"editExternalAgentModal.title",defaultMessage:"Rename External AI Tool"},subtitle:{id:"editExternalAgentModal.subtitle",defaultMessage:"Customize the name and icon for this external AI tool connection"},iconAndNameLabel:{id:"editExternalAgentModal.iconAndNameLabel",defaultMessage:"Icon & name"},cancel:{id:"editExternalAgentModal.cancel",defaultMessage:"Cancel"},saveChanges:{id:"editExternalAgentModal.saveChanges",defaultMessage:"Save changes"}});function Je({isOpen:e,onClose:t,clientId:n,initialDisplayName:o,initialIcon:s,onSave:a}){const[r,l]=(0,i.useState)(o),[c,d]=(0,i.useState)(s??""),[g,p]=(0,i.useState)(!1);(0,i.useEffect)((()=>{e&&(l(o),d(s??""))}),[e,o,s]);const u=r!==o||c!==(s??""),m=(0,i.useCallback)((async()=>{p(!0);try{await a({clientId:n,displayName:r,iconEmoji:c})}finally{p(!1)}}),[n,r,c,a]),h=(0,i.useCallback)((()=>{t()}),[t]),f=(0,i.useCallback)((e=>{d(e??"")}),[d]);return(0,Ee.jsx)(Me().s,{isOpen:e,onDismiss:h,onClosed:h,areaConstraint:{width:{type:"fixed",length:420}},render:()=>(0,Ee.jsx)(ke().t,{showDismissButton:!1,gap:24,header:(0,Ee.jsx)(De().Y,{iconAndTitle:(0,Ee.jsxs)(de().Y1,{align:"top-center",gap:9,children:[(0,Ee.jsx)(y().I,{icon:Ve().gearIcon,colorVariant:"secondary",size:Fe().Ev.xl}),(0,Ee.jsx)("div",{style:{lineHeight:"32px",textAlign:"center"},children:(0,Ee.jsx)(me().D,{styleKey:"titleSmSemibold",colorVariant:"primary",children:(0,Ee.jsx)(D().sA,{...Ze.title})})})]}),description:(0,Ee.jsx)("div",{style:{lineHeight:"18px",textAlign:"center"},children:(0,Ee.jsx)(me().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,Ee.jsx)(D().sA,{...Ze.subtitle})})})}),footer:(0,Ee.jsx)(_e().a,{layout:"vertical",primaryButtons:[{label:(0,Ee.jsx)(D().sA,{...Ze.saveChanges}),onClick:m,isDisabled:g||!u||!r.trim(),isLoading:g}],secondaryButtons:[{buttonType:"dismiss",label:(0,Ee.jsx)(D().sA,{...Ze.cancel})}]}),children:(0,Ee.jsxs)(de().Y1,{gap:8,children:[(0,Ee.jsx)(me().D,{styleKey:"captionMedium",colorVariant:"secondary",children:(0,Ee.jsx)(D().sA,{...Ze.iconAndNameLabel})}),(0,Ee.jsxs)(de().Y1,{direction:"horizontal",align:"center-left",gap:8,children:[(0,Ee.jsx)(Xe,{emoji:c||void 0,onChange:f,defaultIcon:(0,Ee.jsx)(y().I,{icon:Ue().P,colorVariant:"secondary"}),size:20}),(0,Ee.jsx)(de().Y1,{width:"fill",children:(0,Ee.jsx)(Te().A,{value:r,onChange:e=>l(e.target.value),placeholder:o,focus:!0,style:{height:32}})})]})]})})})}var Qe=()=>n(107975),et=()=>n(27455),tt=()=>n(629928),nt=()=>n(227358);const it=(0,D().YK)({removeConfirmTitle:{id:"removeExternalAgentModal.title",defaultMessage:"Remove this external AI tool?"},removeConfirmMessage:{id:"removeExternalAgentModal.message",defaultMessage:"Members who are already connected will lose access to this external AI tool"},removeConfirmButton:{id:"removeExternalAgentModal.confirmButton",defaultMessage:"Remove & disconnect"},cancelButton:{id:"removeExternalAgentModal.cancelButton",defaultMessage:"Cancel"}});function ot(e){const{open:t,onDismiss:n,onConfirm:i,displayName:o,description:s,clientIcon:a}=e,r=(0,D().tz)(),l=(0,d().IS)((()=>({checkmarkWrapper:{alignSelf:"center"}})),[]);return(0,Ee.jsx)(Qe().a,{open:t,onDismiss:n,showCloseIcon:!1,transitionAppearance:"none",ariaLabel:r.formatMessage(it.removeConfirmTitle),innerStyle:{width:450},render:()=>(0,Ee.jsx)(ke().t,{header:(0,Ee.jsx)(De().Y,{iconAndTitle:(0,Ee.jsx)(nt().Z,{iconGroup:tt().t,iconColorPalette:"red",iconColorVariant:"accentPrimary",title:(0,Ee.jsx)(D().sA,{...it.removeConfirmTitle})}),description:(0,Ee.jsx)(D().sA,{...it.removeConfirmMessage})}),footer:(0,Ee.jsx)(_e().a,{layout:"vertical",primaryButtons:[{buttonType:"destructive",label:(0,Ee.jsx)(D().sA,{...it.removeConfirmButton}),onClick:i}],secondaryButtons:[{buttonType:"plain",label:(0,Ee.jsx)(me().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:(0,Ee.jsx)(D().sA,{...it.cancelButton})}),onClick:n}]}),children:(0,Ee.jsx)(et().Zp,{borderVariant:"primary",padding:"sm",borderRadius:"sm",children:(0,Ee.jsxs)(ce().fI,{gap:12,alignItems:"flex-start",minHeight:28,children:[a,(0,Ee.jsxs)(ce().VP,{grow:1,minWidth:0,gap:2,children:[(0,Ee.jsx)(me().D,{styleKey:"bodyMedium",colorVariant:"primary",children:o}),(0,Ee.jsx)(me().D,{styleKey:"captionRegular",colorVariant:"secondary",children:s})]}),(0,Ee.jsx)("div",{style:l.checkmarkWrapper,children:(0,Ee.jsx)(y().I,{icon:Se().checkmarkIcon,colorVariant:"secondary",size:"lg"})})]})})})})}var st=()=>n(34303),at=()=>n(970236),rt=()=>n(695115),lt=()=>n(98126),ct=()=>n(26697),dt=()=>n(73956),gt=()=>n(589407),pt=()=>n(158661),ut=()=>n(361173),mt=()=>n(600329),ht=()=>n(236262);const ft=(0,D().YK)({connectedStatus:{id:"externalAgentRow.connectedStatus",defaultMessage:"Connected"},blockedStatus:{id:"externalAgentRow.blockedStatus",defaultMessage:"Blocked"},notInstalled:{id:"externalAgentRow.notInstalled",defaultMessage:"Not connected"},moreOptionsAriaLabel:{id:"externalAgentRow.moreOptions.ariaLabel",defaultMessage:"More options"},renameOption:{id:"externalAgentRow.menu.rename",defaultMessage:"Rename"},removeOption:{id:"externalAgentRow.menu.remove",defaultMessage:"Remove"},approvedOnByInline:{id:"externalAgentRow.approvedOnByInline",defaultMessage:"Approved on {date} by {user}"},lastConnectedTooltip:{id:"externalAgentRow.lastConnectedTooltip",defaultMessage:"Last connected by {user} on {date}"},developerWebsiteOption:{id:"externalAgentRow.menu.developerWebsite",defaultMessage:"Visit website"},customBadge:{id:"externalAgentRow.customBadge",defaultMessage:"Custom"},notConnectedTooltip:{id:"externalAgentRow.notConnectedTooltip",defaultMessage:"This tool is not connected by anyone in your workspace"}});function yt(e){const{row:t,showConnectionStatus:n=!1,showApprovalInfo:o=!1,onRename:a,onRemove:l,isLoading:g=!1}=e,p=(0,D().tz)(),u=(0,c().O$)(s().AppStoreSidebarSpaceStore),h=(0,d().IS)((()=>({connectionCell:{minWidth:0},noShrink:{flexShrink:0},statusCell:{minWidth:160,justifyContent:"flex-end"}})),[]),f=(0,c().K8)((()=>{if(u&&t.approvedByUserId&&o)return m().L.createChildStore(u,{table:k().oo,id:t.approvedByUserId,spaceId:u.id})}),[u,t.approvedByUserId,o]),b=(0,c().K8)((()=>{if(null!=f&&f.isReady())return f.getName()}),[f]),x=(0,c().K8)((()=>{if(u&&t.lastConnectedByUserId&&n)return m().L.createChildStore(u,{table:k().oo,id:t.lastConnectedByUserId,spaceId:u.id})}),[u,t.lastConnectedByUserId,n]),v=(0,c().K8)((()=>{if(null!=x&&x.isReady())return x.getName()}),[x]),S=(0,i.useMemo)((()=>{if(!n||!t.lastConnectedOn)return;const e=p.formatDate(t.lastConnectedOn,{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",timeZoneName:"short"}),i=v??"—";return p.formatMessage(ft.lastConnectedTooltip,{date:e,user:i})}),[n,t.lastConnectedOn,v,p]),A=(0,i.useCallback)((()=>{null==a||a({clientId:t.clientId,displayName:t.displayName,iconEmoji:t.iconEmoji})}),[a,t.clientId,t.displayName,t.iconEmoji]),j=(0,i.useCallback)((()=>{null==l||l({clientId:t.clientId,displayName:t.displayName,description:t.description,iconEmoji:t.iconEmoji,clientIcon:t.clientIcon})}),[l,t.clientId,t.displayName,t.description,t.iconEmoji,t.clientIcon]),I=(0,i.useMemo)((()=>{const e=[];return t.isCustomClient&&a&&e.push({key:"rename-section",items:[{key:"rename",icon:(0,Ee.jsx)(y().I,{icon:mt().r,size:"default"}),label:p.formatMessage(ft.renameOption),action:A}]}),t.developerWebsiteUrl&&e.push({key:"links-section",items:[{key:"developer-website",label:p.formatMessage(ft.developerWebsiteOption),action:()=>{window.open(t.developerWebsiteUrl,"_blank","noopener,noreferrer")}}]}),l&&e.push({key:"remove-section",items:[{key:"remove",icon:(0,Ee.jsx)(y().I,{icon:ht().trashIcon,size:"default"}),label:p.formatMessage(ft.removeOption),action:j,isDestructive:!0}]}),e}),[p,A,j,t.isCustomClient,t.developerWebsiteUrl,a,l]),C=(0,i.useMemo)((()=>{if(!o)return;const e=t.approvedOn?p.formatDate(t.approvedOn,{month:"short",day:"numeric",year:"numeric"}):"—",n=b??"—";return p.formatMessage(ft.approvedOnByInline,{date:e,user:n})}),[o,t.approvedOn,b,p]),M=I.length>0;return(0,Ee.jsx)(et().Zp,{borderVariant:"primary",borderRadius:"sm",children:(0,Ee.jsxs)(de().Y1,{direction:"horizontal",align:"center-left",gap:14,padding:"14px 16px",children:[t.clientIcon,(0,Ee.jsx)(de().Y1,{width:"fill",style:h.connectionCell,children:(0,Ee.jsxs)(de().Y1,{gap:2,children:[(0,Ee.jsxs)(de().Y1,{direction:"horizontal",align:"center-left",gap:6,children:[(0,Ee.jsx)(me().D,{styleKey:"bodyMedium",colorVariant:"primary",children:t.displayName}),t.isCustomClient?(0,Ee.jsx)(at().E,{content:p.formatMessage(ft.customBadge),color:"gray"}):void 0]}),(0,Ee.jsx)(ct().m,{placement:"top",alignment:"start",renderTooltip:()=>t.description,render:e=>(0,Ee.jsx)(me().D,{styleKey:"bodySmRegular",colorVariant:"secondary",textOverflow:"ellipsis",...e,children:t.description})})]})}),(0,Ee.jsxs)(de().Y1,{direction:"horizontal",align:"center-right",gap:10,style:h.noShrink,children:[n?(0,Ee.jsx)(de().Y1,{direction:"horizontal",align:"center-right",style:h.statusCell,children:(()=>{if(n){if(t.isConnected&&!t.isBlocked){const e=(0,Ee.jsxs)(de().Y1,{direction:"horizontal",align:"center-right",gap:6,children:[(0,Ee.jsx)(y().I,{icon:dt().checkmarkFillSmallIcon,size:"sm",colorPalette:"blue",colorVariant:"secondary"}),(0,Ee.jsx)(me().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,Ee.jsx)(D().sA,{...ft.connectedStatus})})]});return S?(0,Ee.jsx)(ct().m,{renderTooltip:()=>S,render:t=>(0,Ee.jsx)("div",{...t,children:e})}):e}if(t.isBlocked){const e=(0,Ee.jsxs)(de().Y1,{direction:"horizontal",align:"center-right",gap:6,children:[(0,Ee.jsx)(y().I,{icon:pt().exclamationMarkTriangleFillSmallIcon,size:"sm",colorPalette:"yellow",colorVariant:"secondary"}),(0,Ee.jsx)(me().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,Ee.jsx)(D().sA,{...ft.blockedStatus})})]});return S?(0,Ee.jsx)(ct().m,{renderTooltip:()=>S,render:t=>(0,Ee.jsx)("div",{...t,children:e})}):e}return(0,Ee.jsx)(ct().m,{renderTooltip:()=>p.formatMessage(ft.notConnectedTooltip),render:e=>(0,Ee.jsxs)(de().Y1,{direction:"horizontal",align:"center-right",gap:6,...e,children:[(0,Ee.jsx)(y().I,{icon:ut().infoCircleFillSmallIcon,size:"sm",colorVariant:"secondary"}),(0,Ee.jsx)(me().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,Ee.jsx)(D().sA,{...ft.notInstalled})})]})})}})()}):void 0,C?(0,Ee.jsx)(me().D,{styleKey:"bodySmRegular",colorVariant:"secondary",style:{whiteSpace:"nowrap"},children:C}):void 0,(0,Ee.jsx)(de().Y1,{direction:"horizontal",align:"center",width:36,children:g?(0,Ee.jsx)(lt().k,{}):M?(0,Ee.jsx)(ge().A,{popupType:r().A.isMobile?ge().z.BottomSheet:ge().z.Popup,borderRadius:10,popupWrapStyle:{padding:4},renderOrigin:e=>(0,Ee.jsx)(rt().A,{...e,icon:gt().ellipsisIcon,size:"lg",ariaLabel:p.formatMessage(ft.moreOptionsAriaLabel)}),render:e=>(0,Ee.jsx)(fe().A,{menuType:r().A.isMobile?pe().gu.Modal:pe().gu.Popup,minWidth:147,children:(0,Ee.jsx)(be().A,{type:be().O.Vertical,sections:I.map(((t,n)=>({key:t.key,render:e=>(0,Ee.jsx)(xe().A,{...e,topBorder:n>0,hideTitle:!0}),items:t.items.map((t=>({key:t.key,action:()=>{t.action(),e.close()},render:e=>(0,Ee.jsx)(ye().A,{...e,title:t.label,icon:t.icon,style:t.isDestructive?{color:E().Tj.red.text.accentPrimary}:void 0})})))}))),initialFocus:void 0})})}):void 0})]})]})})}const bt=40,xt=20,vt=8;function St(e){const{iconEmoji:t,fallbackIcon:n}=e;return t?(0,Ee.jsx)(Ke().A,{size:bt,emojiSize:xt,emoji:t,backgroundColor:E().Tj.white,borderRadius:vt,boxShadow:E().Tj.shadow.outline.sm}):(0,Ee.jsx)(We,{size:bt,icon:n,backgroundColor:E().Tj.white,borderRadius:vt,boxShadow:E().Tj.shadow.outline.sm})}const At=(0,D().YK)({unknownClient:{id:"adminExternalAgentsTable.unknownClient",defaultMessage:"Unknown"},filterAllConnectors:{id:"adminExternalAgentsTable.filter.allConnectors",defaultMessage:"All AI tools"},filterListed:{id:"adminExternalAgentsTable.filter.listed",defaultMessage:"Listed"},filterCustom:{id:"adminExternalAgentsTable.filter.custom",defaultMessage:"Custom"},addApprovedAgent:{id:"adminExternalAgentsTable.addButton",defaultMessage:"Add approved AI tools"},allExternalAgentsFilter:{id:"adminExternalAgentsTable.filter.allExternalAgents",defaultMessage:"All AI tools"},noSearchResults:{id:"adminExternalAgentsTable.noSearchResults",defaultMessage:"No AI tools found"}});function jt(e){const{viewMode:t="connected"}=e,n=(0,l().v3)(),o=(0,D().tz)(),a=(0,c().O$)(s().AppStoreSidebarSpaceStore),d=(0,c().K8)((()=>null==a?void 0:a.id),[a]),g=(0,c().K8)((()=>p().bM.getMcpConfig()),[]),[u,m]=(0,i.useState)("all"),[h,f]=(0,i.useState)(""),[b,x]=(0,i.useState)({isOpen:!1,clientId:"",displayName:"",iconEmoji:void 0}),[v,S]=(0,i.useState)({isOpen:!1,clientId:"",displayName:"",description:"",iconEmoji:void 0,clientIcon:null}),[A,j]=(0,i.useState)(!1),[I,C]=(0,i.useState)(void 0),[M,w]=(0,i.useState)(void 0),k=(0,i.useCallback)((e=>{f(e??"")}),[]),T=(0,i.useCallback)((e=>{m(e)}),[]),B=(0,i.useMemo)((()=>{switch(u){case"all":return"approved"===t?o.formatMessage(At.allExternalAgentsFilter):o.formatMessage(At.filterAllConnectors);case"listed":return o.formatMessage(At.filterListed);case"custom":return o.formatMessage(At.filterCustom)}}),[u,o,t]),P=(0,i.useCallback)((e=>{x({isOpen:!0,clientId:e.clientId,displayName:e.displayName,iconEmoji:e.iconEmoji})}),[]),N=(0,i.useCallback)((()=>{x({isOpen:!1,clientId:"",displayName:"",iconEmoji:void 0})}),[]),_=(0,i.useCallback)((async e=>{if(d){C(e.clientId);try{await Ce().zb({environment:n,spaceId:d,clientId:e.clientId,displayName:e.displayName,iconEmoji:e.iconEmoji}),N()}finally{C(void 0)}}}),[n,d,N]),E=(0,i.useCallback)((e=>{S({isOpen:!0,clientId:e.clientId,displayName:e.displayName,description:e.description,iconEmoji:e.iconEmoji,clientIcon:e.clientIcon})}),[]),L=(0,i.useCallback)((()=>{S({isOpen:!1,clientId:"",displayName:"",description:"",iconEmoji:void 0,clientIcon:null})}),[]),O=(0,i.useCallback)((async()=>{if(d&&v.clientId){w(v.clientId),L();try{await Ce().DF({environment:n,spaceId:d,operations:[{op:"remove",clientId:v.clientId}]})}finally{w(void 0)}}}),[n,d,v.clientId,L]),z=(0,i.useCallback)((()=>{j(!0)}),[]),R=(0,i.useCallback)((()=>{j(!1)}),[]),W=(0,i.useCallback)((async e=>{if(!d||0===e.length)return;const t=e.map((e=>({op:"add",clientId:e})));try{await Ce().DF({environment:n,spaceId:d,operations:t})}finally{R()}}),[n,d,R]),K=o.formatMessage(At.unknownClient),U=(0,c().K8)((()=>{const{connectedClientIds:e=[],allowListedClientIds:n=[],allowListEnabled:i,clients:o}=g;let s;if("approved"===t)s=n;else{const t=new Set([...e,...i?n:[]]);s=Array.from(t)}return s.filter((e=>void 0!==o[e])).map((e=>{var t,n,i,s;const a=o[e],r=(0,Ie().UM)(e),l=a.details.iconEmoji,c=a.details.displayName??K,d=a.details.descriptionShort??a.details.description??"",g=St({iconEmoji:l,fallbackIcon:(null==r?void 0:r.icon)??Ae().c});return{clientId:e,displayName:c,description:d,iconEmoji:l,isCustomClient:a.isCustomClient,isConnected:a.isConnected,isBlocked:a.isBlocked,clientIcon:g,approvedOn:null===(t=a.allowListModification)||void 0===t?void 0:t.timestamp,approvedByUserId:null===(n=a.allowListModification)||void 0===n||null===(n=n.actor)||void 0===n?void 0:n.id,lastConnectedOn:null===(i=a.connectionModification)||void 0===i?void 0:i.timestamp,lastConnectedByUserId:null===(s=a.connectionModification)||void 0===s||null===(s=s.actor)||void 0===s?void 0:s.id,developerWebsiteUrl:a.details.developerWebsiteUrl}})).sort(((e,t)=>e.displayName.localeCompare(t.displayName)))}),[g,K,t]),V=(0,i.useMemo)((()=>{let e=U;if("listed"===u?e=e.filter((e=>!e.isCustomClient)):"custom"===u&&(e=e.filter((e=>e.isCustomClient))),h.trim()){const t=h.toLowerCase().trim();e=e.filter((e=>e.displayName.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)))}return e}),[U,u,h]),F=(0,i.useMemo)((()=>{const{allowListedClientIds:e=[],clients:t}=g,n=new Set(e);return Object.entries(t).map((([e,t])=>{const i=(0,Ie().UM)(e),o=t.details.iconEmoji;return{clientId:e,displayName:t.details.displayName??K,description:t.details.description??"",clientIcon:St({iconEmoji:o,fallbackIcon:(null==i?void 0:i.icon)??Ae().c}),isAlreadyAdded:n.has(e)}})).sort(((e,t)=>e.isAlreadyAdded!==t.isAlreadyAdded?e.isAlreadyAdded?-1:1:e.displayName.localeCompare(t.displayName)))}),[g,K]);return(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)(de().Y1,{direction:"vertical",gap:16,children:[(0,Ee.jsxs)(ce().fI,{justifyContent:"space-between",alignItems:"center",minHeight:36,children:[(0,Ee.jsx)(ce().fI,{gap:8,alignItems:"center",children:(0,Ee.jsx)(ge().A,{popupType:r().A.isMobile?ge().z.BottomSheet:ge().z.Popup,borderRadius:10,popupWrapStyle:{padding:4},renderOrigin:e=>(0,Ee.jsx)(he().E,{...e,iconLeading:{icon:je().squareGrid2X2SmallIcon,size:"sm"},iconTrailing:{icon:ve().arrowChevronSingleDownSmallIcon,size:"xs"},size:"md",shape:"pill",colorPalette:"blue",children:B}),render:e=>(0,Ee.jsx)(fe().A,{menuType:r().A.isMobile?pe().gu.ActionSheet:pe().gu.Popup,width:159,children:(0,Ee.jsx)(be().A,{type:be().O.Vertical,sections:[{key:"filters",render:e=>(0,Ee.jsx)(xe().A,{...e,hideTitle:!0}),items:[{key:"all",action:()=>{T("all"),e.close()},render:e=>(0,Ee.jsx)(ye().A,{...e,title:"approved"===t?o.formatMessage(At.allExternalAgentsFilter):o.formatMessage(At.filterAllConnectors),right:"all"===u?(0,Ee.jsx)(y().I,{icon:Se().checkmarkIcon,size:"default"}):void 0})},{key:"listed",action:()=>{T("listed"),e.close()},render:e=>(0,Ee.jsx)(ye().A,{...e,title:o.formatMessage(At.filterListed),right:"listed"===u?(0,Ee.jsx)(y().I,{icon:Se().checkmarkIcon,size:"default"}):void 0})},{key:"custom",action:()=>{T("custom"),e.close()},render:e=>(0,Ee.jsx)(ye().A,{...e,title:o.formatMessage(At.filterCustom),right:"custom"===u?(0,Ee.jsx)(y().I,{icon:Se().checkmarkIcon,size:"default"}):void 0})}]}],initialFocus:void 0})})})}),(0,Ee.jsxs)(ce().fI,{gap:8,alignItems:"center",children:[(0,Ee.jsx)(ce().fI,{alignItems:"center",children:(0,Ee.jsx)(st().A,{handleSearchQueryChange:k,isSearchBarAlwaysOpen:!1,buttonSize:32})}),"approved"===t?(0,Ee.jsx)(ue().A,{colorPalette:"blue",onClick:z,children:(0,Ee.jsx)(D().sA,{...At.addApprovedAgent})}):void 0]})]}),0!==V.length?(0,Ee.jsx)(de().Y1,{direction:"vertical",gap:8,children:V.map((e=>(0,Ee.jsx)(yt,{row:e,showConnectionStatus:"connected"===t,showApprovalInfo:"approved"===t,onRename:e.isCustomClient?P:void 0,onRemove:"approved"===t?E:void 0,isLoading:I===e.clientId||M===e.clientId},e.clientId)))}):void 0,0===V.length&&h?(0,Ee.jsx)(me().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,Ee.jsx)(D().sA,{...At.noSearchResults})}):void 0]}),(0,Ee.jsx)(Je,{isOpen:b.isOpen,onClose:N,clientId:b.clientId,initialDisplayName:b.displayName,initialIcon:b.iconEmoji,onSave:_}),(0,Ee.jsx)(ot,{open:v.isOpen,onDismiss:L,onConfirm:O,displayName:v.displayName,description:v.description,clientIcon:v.clientIcon}),(0,Ee.jsx)(ze,{open:A,onDismiss:R,onApprove:W,availableClients:F})]})}function It({title:e,description:t}){return(0,Ee.jsxs)(de().Y1,{gap:4,children:[(0,Ee.jsx)(me().D,{styleKey:"titleSmSemibold",colorVariant:"primary",children:e}),t?(0,Ee.jsx)(me().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:t}):void 0]})}const Ct=(0,D().YK)({title:{id:"adminApprovedExternalAgents.title",defaultMessage:"Approved External AI Tools"},description:{id:"adminApprovedExternalAgents.description",defaultMessage:"Manage which MCP clients and AI tools members can connect to"}});function Mt(){return(0,Ee.jsxs)(ce().VP,{gap:32,paddingTop:32,paddingBottom:24,paddingInlineStart:40,paddingInlineEnd:40,children:[(0,Ee.jsx)(It,{title:(0,Ee.jsx)(D().sA,{...Ct.title}),description:(0,Ee.jsx)(D().sA,{...Ct.description})}),(0,Ee.jsx)(jt,{viewMode:"approved"})]})}var wt=()=>n(127833),kt=()=>n(30537),Tt=()=>n(631524),Bt=(n(737550),()=>n(242422)),Pt=()=>n(929219),Nt=()=>n(93676),_t=()=>n(424400),Dt=()=>n(617871),Et=()=>n(289106);var Lt=()=>n(332393),Ot=()=>n(498212),zt=()=>n(769864),Rt=()=>n(251126),Wt=()=>n(824160),Kt=()=>n(187820),Ut=()=>n(320865),Vt=()=>n(361330);function Ft(e){const{query:t}=e,n=(0,l().v3)(),o=(0,c().O$)(s().AppStoreSidebarSpaceStore),a=(0,c().K8)((()=>null==o?void 0:o.getBotSettingsStore().getValue()),[o]),r="approved_or_built_by_notion"===(null==a?void 0:a.integration_restrictions),d=(0,i.useMemo)((()=>null!=a&&a.integration_approval_statuses?Object.keys(a.integration_approval_statuses):[]),[a]),g=(0,c().K8)((()=>Object.keys(Dt().Nu).map((e=>{const t=null==o?void 0:o.getRecordModel({id:e,table:Lt().Li});if((0,O().O9)(t)){var n;if("published"===t.status)return{id:e,name:t.name,status:"published"};if(null!=o&&o.id&&"external"===t.type&&function(e){const{integrationId:t,integrationExtraTestingSpaceIds:n,spaceId:i,experimentService:o}=e,s=(null==n?void 0:n.includes(i))??!1;if(t===Dt().mn||t===Dt().Iy){if(s)return!0;try{return o.checkGate({actor:Et().S,gateName:"salesforce_extra_test_spaces_enabled",customIDs:{spaceId:i}})}catch(a){return!1}}return s}({integrationId:t.id,integrationExtraTestingSpaceIds:null===(n=t.getInfo())||void 0===n?void 0:n.extra_testing_space_ids,spaceId:o.id,experimentService:Bt().default}))return{id:e,name:t.name,status:"test"}}})).filter(O().O9)),[o]),p=(0,i.useMemo)((()=>g.some((e=>e.id===Dt().Hd))),[g]),u=(0,c().K8)((()=>g.filter((e=>!d.includes(e.id))).filter((e=>"published"===e.status)).map((e=>e.id)).slice(0,5)),[d,g]);return(0,Ee.jsx)(fe().A,{menuType:pe().gu.Popup,width:255,header:Ht({query:t,hasDefaultResults:!r&&u.length>0}),children:(0,Ee.jsx)(Rt().A,{request:t,performRequest:e=>async function(e){const{query:t,integrationType:n,environment:i,spaceId:o,approvedIntegrationIds:s,popularIntegrationIds:a,autoApproveBuiltByNotion:r}=e;if(!Pt().A.state.online||!o)return[];if((0,Ot().uj)(t)||(0,Ot().c_)(t))return[t];if(""===t&&!r)return a;const l=await zt().callApi({eventName:"searchIntegrations",environment:i,data:{query:t,type:n,spaceId:o}});if("success"===l.type){const e=l.data.integrationIds.filter((e=>!s.includes(e)));if(!r){return e.sort(((e,t)=>(0,Dt().CX)({integrationId:e})===(0,Dt().CX)({integrationId:t})?0:(0,Dt().CX)({integrationId:e})?-1:1)).slice(0,5)}return e.filter((e=>!(0,Dt().CX)({integrationId:e}))).slice(0,5)}if("failed"===l.type)throw l.error;return(0,O().HB)(l)}({query:e,environment:n,spaceId:null==o?void 0:o.id,approvedIntegrationIds:d,popularIntegrationIds:u,autoApproveBuiltByNotion:r}),debounce:Vt().tu,render:(i,s,r)=>{if(!s||!r)return(0,Ee.jsx)(xe().A,{children:(0,Ee.jsx)(Ut().A,{})});const l=C().Gw.filter((e=>t&&e.name.toLowerCase().includes(t.toLowerCase())&&!d.includes(e.id)&&(e.id!==C().IQ||!p))),c=g.filter((e=>"test"===e.status)).filter((e=>{const n=e.name.toLowerCase(),i=t.toLowerCase(),o=!d.includes(e.id);return n.includes(i)&&o})).map((e=>e.id)),u=[];if(0===s.length&&0===l.length&&0===c.length)u.push({key:"no_results",render:()=>(0,Ee.jsx)(v().A,{isSmall:!0,style:{marginInlineStart:8},children:(0,Ee.jsx)(D().sA,{id:"adminIntegrationSettings.search.label.noResults",defaultMessage:"No results"})}),action:()=>{}});else{const t=[...c,...s].map((t=>{const i={table:Lt().Li,id:t};if(!o)return;const s=Nt().C.createChildStore(o,i);if("internal"===s.getType())return;const r=s.getInfo(),l=null==r?void 0:r.icon;return{key:`${t}`,render:e=>(0,Ee.jsx)(ye().A,{...e,title:(0,Ee.jsx)(v().A,{style:{fontWeight:z().Wy.semibold},children:s.getName()}),icon:l&&(0,Ee.jsx)(Kt().B6,{disabled:!0,icon:{pointer:i,icon:l},isEmptyPage:!1,size:20}),style:l?{paddingBottom:12}:{paddingInlineStart:30,paddingBottom:12},shouldWrapCaption:!0,caption:(0,Ee.jsx)($t,{tagline:null==r?void 0:r.tagline,isNotionIntegration:(0,Dt().CX)({integrationId:s.id})}),className:"notranslate"}),action:()=>{e.closeDropdown(),Yt({environment:n,currentSpaceStore:o,botSettings:a,integrationId:t})}}})).filter(O().O9),i=l.map((t=>{const i=t.info;return{key:`${t.id}`,render:e=>(0,Ee.jsx)(ye().A,{...e,title:(0,Ee.jsx)(v().A,{style:{fontWeight:z().Wy.semibold},children:t.name}),icon:(0,Ee.jsx)("img",{src:i.icon,style:{height:20}}),caption:i.tagline,style:{paddingBottom:12},shouldWrapCaption:!0,className:"notranslate"}),action:()=>{e.closeDropdown(),Yt({environment:n,currentSpaceStore:o,botSettings:a,integrationId:t.id})}}})).filter(O().O9);u.push(...t,...i)}return(0,Ee.jsx)(be().A,{type:be().O.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,Ee.jsx)(xe().A,{...e}),items:u}]})}})})}function qt(e){const t=(0,D().tz)(),{query:n}=e,i=(0,l().v3)(),o=(0,c().O$)(s().AppStoreSidebarSpaceStore);return o?(0,Ee.jsx)(fe().A,{menuType:pe().gu.Popup,width:255,header:Ht({query:n,hasDefaultResults:!1}),children:(0,Ee.jsx)(Rt().A,{request:n,performRequest:e=>async function(e){const{query:t,environment:n,spaceId:i}=e;if(!Pt().A.state.online||!i)return[];if((0,Ot().uj)(t)||(0,Ot().c_)(t))return[t];const o=await zt().callApi({eventName:"searchIntegrations",environment:n,data:{query:t,type:"compliance",spaceId:i}});if("success"===o.type)return o.data.integrationIds;if("failed"===o.type)throw o.error;return(0,O().HB)(o)}({query:e,environment:i,spaceId:null==o?void 0:o.id}),debounce:Vt().tu,render:(n,i,s)=>{if(!i||!s)return(0,Ee.jsx)(xe().A,{children:(0,Ee.jsx)(Ut().A,{})});const a=[];if(0===i.length)a.push({key:"no_results",render:()=>(0,Ee.jsx)(v().A,{isSmall:!0,style:{marginInlineStart:8},children:(0,Ee.jsx)(D().sA,{id:"adminIntegrationSettings.search.label.noResults",defaultMessage:"No results"})}),action:()=>{}});else{const n=ne().A.state.loaded&&g().A.state.loaded?ne().A.state.webhookSubscriptions.map((e=>{var t;return null===(t=g().A.getBotsAsRecordMap().getValue({table:w().GP,id:e.bot_id}))||void 0===t?void 0:t.integration_id})):[],s=i.map((i=>{var s;const a=Nt().C.createChildStore(o,{id:i,table:Lt().Li});if(n.includes(i))return;const r={table:Lt().Li,id:i},l=Nt().C.createChildStore(o,r),c=null===(s=l.getInfo())||void 0===s?void 0:s.icon,d=(0,_().Hr)(l.id);return{key:`${i}`,render:e=>(0,Ee.jsx)(ye().A,{...e,title:(0,Ee.jsxs)("div",{style:{display:"flex",float:"inline-start",alignItems:"center"},children:[(0,Ee.jsx)(v().A,{style:{fontWeight:z().Wy.semibold},children:l.getName()}),null!=d&&d.type?(0,Ee.jsx)("div",{style:{marginInlineStart:4},children:(0,Ee.jsx)(Wt().A,{children:d.type})}):void 0]}),icon:c&&(0,Ee.jsx)(Kt().B6,{disabled:!0,icon:{pointer:r,icon:c},isEmptyPage:!1,size:20}),style:null!=d&&d.icon?{paddingBottom:12}:{paddingInlineStart:30,paddingBottom:12},shouldWrapCaption:!0,caption:(0,Ee.jsx)($t,{tagline:null!=d&&d.tagline?t.formatMessage(null==d?void 0:d.tagline):"A SIEM or DLP partner",isNotionIntegration:!1})}),action:()=>{var t;e.closeDropdown();a.getModel()&&(null!=d&&null!==(t=d.oauth)&&void 0!==t&&t.accountInfoPropertyNames||"dlp"===(null==d?void 0:d.type))?oe().A.setState({open:!0,integrationId:l.id}):ie().A.setState({open:!0,integrationId:l.id})}}})).filter(O().O9);a.push(...s)}return(0,Ee.jsx)(be().A,{type:be().O.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,Ee.jsx)(xe().A,{...e}),items:a}]})}})}):null}function Yt(e){const{environment:t,currentSpaceStore:n,botSettings:i,integrationId:o}=e;if(n&&!(0,_().NV)(o)){const e={...null==i?void 0:i.integration_approval_statuses,[o]:{type:"integration",status:"approved"}};le().createAndCommit({userAction:"AdminIntegrationSettingsSearchResults.handleIntegrationSelection",environment:t,canUndo:!0,perform:t=>{W().zv({store:n,data:{bot_settings:{...i,integration_approval_statuses:e}},transaction:t})}})}}function Ht({query:e,hasDefaultResults:t}){return!e&&t&&(0,Ee.jsx)(_t().Ay,{title:(0,Ee.jsx)(v().A,{isSmall:!0,style:{marginTop:4,fontWeight:z().Wy.medium},children:(0,Ee.jsx)(D().sA,{defaultMessage:"Popular integrations",id:"adminIntegrationSettings.search.title.popularIntegrations"})})})}function $t(e){const{tagline:t,isNotionIntegration:n}=e,i=n?{}:{maxHeight:52,overflow:"auto"};return t?(0,Ee.jsxs)("div",{style:i,children:[t,n?(0,Ee.jsxs)("div",{style:{display:"flex",alignItems:"center",marginTop:8,gap:2},children:[(0,Ee.jsx)(D().sA,{defaultMessage:"Developed by Notion",id:"adminIntegrationSettings.search.subtitle.notionBuilt"}),(0,Ee.jsx)(y().I,{icon:j().checkmarkShieldFillSmallIcon,size:"sm",colorPalette:"green",colorVariant:"accentPrimary"})]}):void 0]}):null}const Gt=(0,D().YK)({searchInputPlaceholder:{id:"adminConnectionsSettings.search.input.placeholder",defaultMessage:"Add by name or integration ID"},complianceIntegrationSearchInputPlaceholder:{id:"adminConnectionsSettings.search.input.complianceIntegrationPlaceholder",defaultMessage:"Add by name"}});function Xt(){const e=(0,D().tz)(),t=(0,l().WS)(),[n,o]=(0,i.useState)(!0),[s,a]=(0,i.useState)(!1),[r,c]=(0,i.useState)(""),d=(0,i.useRef)(null);return n?(0,Ee.jsx)(Tt().p,{iconLeading:I().plusIcon,colorPalette:"blue",onClick:()=>{o(!1)},children:(0,Ee.jsx)(D().sA,{id:"adminConnectionsSettings.search.button.label",defaultMessage:"Add approved connection"})}):(0,Ee.jsx)(wt().zD,{alignmentToOrigin:"start",keepFocus:t,onDismiss:()=>{var e;const t=null===(e=window)||void 0===e?void 0:e.document.activeElement;d.current&&t===d.current&&d.current.blur(),o(!0),a(!1)},origin:(0,Ee.jsx)(Te().A,{type:"text",style:{width:255},ref:d,value:r,onFocus:()=>{a(!0)},placeholder:e.formatMessage(Gt.searchInputPlaceholder),onChange:e=>c(e.target.value)}),open:s,popupType:kt().n.Popup,style:{width:255},render:()=>(0,Ee.jsx)(Ft,{query:r,closeDropdown:()=>a(!1)})})}function Zt(){const e=(0,D().tz)(),t=(0,l().WS)(),[n,o]=(0,i.useState)(!0),[s,a]=(0,i.useState)(!1),[r,c]=(0,i.useState)(""),d=(0,i.useRef)(null);return n?(0,Ee.jsx)(Tt().p,{colorPalette:"blue",iconLeading:I().plusIcon,onClick:()=>{var e;o(!1),null===(e=d.current)||void 0===e||e.focus()},children:(0,Ee.jsx)(D().sA,{id:"adminConnectionsSettingsAddComplianceMenu.search.button.label",defaultMessage:"Add connection"})}):(0,Ee.jsx)(wt().zD,{alignmentToOrigin:"start",keepFocus:t,onDismiss:()=>{var e;const t=null===(e=window)||void 0===e?void 0:e.document.activeElement;d.current&&t===d.current&&d.current.blur(),o(!0),a(!1)},origin:(0,Ee.jsx)(Te().A,{type:"text",style:{width:255},focus:!0,ref:d,value:r,onFocus:()=>{a(!0)},placeholder:e.formatMessage(Gt.complianceIntegrationSearchInputPlaceholder),onChange:e=>c(e.target.value)}),open:s,popupType:kt().n.Popup,style:{width:255},render:()=>(0,Ee.jsx)(qt,{query:r,closeDropdown:()=>{o(!0),a(!1)}})})}var Jt=()=>n(731297);const Qt=(0,D().YK)({title:{id:"adminConnectionsSettings.externalAgents.title",defaultMessage:"External AI Tools"},description:{id:"adminConnectionsSettings.externalAgents.description",defaultMessage:"Let AI tools outside Notion securely access your workspace through Notion MCP. Members can connect AI tools to search, view, and use their Notion."}});function en(){return(0,Ee.jsxs)(de().Y1,{direction:"vertical",gap:28,children:[(0,Ee.jsx)(It,{title:(0,Ee.jsx)(D().sA,{...Qt.title}),description:(0,Ee.jsx)(D().sA,{...Qt.description})}),(0,Ee.jsx)(jt,{})]})}var tn=()=>n(406094),nn=()=>n(906380);const on=36,sn=6,an=12,rn=58,ln=18,cn=(on+rn)/2,dn=[!0,!1,!0],gn=[!1,!0,!1],pn=[1],un=[0],mn=(0,D().YK)({manageApprovedAgentsTitle:{id:"adminPermissionsSettings.manageApprovedAgents.title",defaultMessage:"Manage approved external AI tools"},manageApprovedAgentsDescription:{id:"adminPermissionsSettings.manageApprovedAgents.description",defaultMessage:"Manage which external AI tools members can connect to"},manageApprovedListButton:{id:"adminPermissionsSettings.manageApprovedAgents.manageListButton",defaultMessage:"Manage approved list"},approvedCount:{id:"adminPermissionsSettings.manageApprovedAgents.approvedCount",defaultMessage:"{count} approved"}});function hn(){return(0,Ee.jsxs)(ce().VP,{gap:2,children:[(0,Ee.jsx)(me().D,{styleKey:"bodyMedium",colorVariant:"primary",children:(0,Ee.jsx)(D().sA,{...mn.manageApprovedAgentsTitle})}),(0,Ee.jsx)(me().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,Ee.jsx)(D().sA,{...mn.manageApprovedAgentsDescription})})]})}function fn(e){const{approvedCount:t,onManageClick:n}=e;return t?(0,Ee.jsx)(xn,{approvedCount:t,onManageClick:n}):(0,Ee.jsx)(bn,{onManageClick:n})}function yn(){const e=(0,d().IS)((()=>({container:{flexShrink:0,marginInlineEnd:-on/2},row2Offset:{marginInlineStart:cn}})),[]),t=(0,i.useMemo)((()=>{const e=(0,Ie().wr)().filter((e=>!e.hidden&&e.icon)).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).slice(0,6).map((e=>e.icon));return{row1:e.slice(0,3),row2:e.slice(3,6)}}),[]),n=(0,i.useCallback)((e=>{const{icon:t,index:n,fadedPattern:i,checkmarkIndices:o}=e;if(!t)return;const s=i[n],a=o.includes(n);return(0,Ee.jsx)(Le,{icon:t({width:Fe().Ev.default,height:Fe().Ev.default}),badge:a?(0,Ee.jsx)(y().I,{icon:Be().checkmarkCircleFillSmallIcon,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"}):void 0,size:on,borderRadius:sn,showBorder:!1,backgroundColor:E().Tj.background.tertiary,badgeBackgroundColor:E().Tj.white,badgeSize:ln,opacity:s?.2:void 0},n)}),[]);return(0,Ee.jsxs)(de().Y1,{direction:"vertical",gap:an,width:"hug",height:"hug",style:e.container,children:[(0,Ee.jsx)(de().Y1,{direction:"horizontal",gap:rn,children:t.row1.map(((e,t)=>n({icon:e,index:t,fadedPattern:dn,checkmarkIndices:pn})))}),(0,Ee.jsx)(de().Y1,{direction:"horizontal",gap:rn,style:e.row2Offset,children:t.row2.map(((e,t)=>n({icon:e,index:t,fadedPattern:gn,checkmarkIndices:un})))})]})}function bn(e){const{onManageClick:t}=e,n=(0,d().IS)((()=>({container:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",height:148,paddingInlineStart:28,paddingInlineEnd:et().v3.none,paddingTop:22,paddingBottom:22,borderRadius:et().fT.lg,border:`1px solid ${E().Tj.border.secondary}`,background:`linear-gradient(90deg, ${E().Tj.background.primary} 0%, ${E().Tj.gray.background.primary} 100%)`,overflow:"hidden"}})),[]),o=(0,i.useCallback)((()=>{null==t||t()}),[t]);return(0,Ee.jsxs)(de().Y1,{direction:"horizontal",gap:"auto",align:"center",style:n.container,children:[(0,Ee.jsxs)(ce().VP,{gap:16,children:[(0,Ee.jsx)(hn,{}),(0,Ee.jsx)(tn().A,{onClick:o,iconLeading:Ve().gearIcon,size:"lg",style:{background:E().Tj.background.tertiary,width:"fit-content"},children:(0,Ee.jsx)(D().sA,{...mn.manageApprovedListButton})})]}),(0,Ee.jsx)(de().Y1,{width:"fill",align:"center-right",children:(0,Ee.jsx)(yn,{})})]})}function xn(e){const{approvedCount:t,onManageClick:n}=e,o=(0,D().tz)(),s=(0,d().IS)((()=>({container:{display:"flex",justifyContent:"space-between",width:"100%",height:"auto",paddingTop:14,paddingBottom:14,paddingInlineStart:et().v3.md,paddingInlineEnd:et().v3.md,borderRadius:et().fT.sm,border:`1px solid ${E().Tj.border.primaryTranslucent}`,boxShadow:E().Tj.shadow.base.sm},containerHovered:{background:E().Tj.background.tertiary}})),[]),a=(0,i.useCallback)((()=>{null==n||n()}),[n]);return(0,Ee.jsxs)(Tt().p,{onClick:a,style:s.container,hoveredStyle:{...s.container,...s.containerHovered},children:[(0,Ee.jsx)(hn,{}),(0,Ee.jsxs)(ce().fI,{alignItems:"center",gap:12,children:[(0,Ee.jsx)(me().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:o.formatMessage(mn.approvedCount,{count:t})}),(0,Ee.jsx)(rt().A,{icon:nn().arrowChevronSingleRightSmallIcon,size:"xs",shape:"pill",variant:"tint",colorVariant:"secondary",ariaLabel:o.formatMessage(mn.manageApprovedAgentsTitle)})]})]})}const vn=(0,D().YK)({externalAgentsTitle:{id:"adminPermissionsSettings.externalAgents.title",defaultMessage:"External AI Tools"},externalAgentsDescription:{id:"adminPermissionsSettings.externalAgents.description",defaultMessage:"Control how members can connect external AI tools to this workspace"},restrictExternalAgentsTitle:{id:"adminPermissionsSettings.restrictExternalAgents.title",defaultMessage:"Restrict members from adding external AI tools"},restrictExternalAgentsCaption:{id:"adminPermissionsSettings.restrictExternalAgents.caption",defaultMessage:"Workspace members can only install external agents pre-approved by workspace owners."},noRestrictionsOption:{id:"adminPermissionsSettings.connectionRestrictions.off.title",defaultMessage:"No restrictions"},noRestrictionsCaption:{id:"adminPermissionsSettings.connectionRestrictions.off.caption",defaultMessage:"Workspace members can install any connection."},onlyFromApprovedListOption:{id:"adminPermissionsSettings.connectionRestrictions.allowList.title",defaultMessage:"Only from approved list"},onlyFromApprovedListCaption:{id:"adminPermissionsSettings.connectionRestrictions.allowList.caption",defaultMessage:"Workspace members can only install connections pre-approved by a workspace owner."},connectionRestrictionsInfo:{id:"adminPermissionsSettings.connectionRestrictions.info.title",defaultMessage:"Workspace owners can always install and approve new connections."}});function Sn(e){const{onNavigateToApprovedAgents:t}=e;return(0,Ee.jsx)(An,{onNavigateToApprovedAgents:t})}function An(e){const{onNavigateToApprovedAgents:t}=e,n=(0,c().K8)((()=>p().bM.getMcpConfig().allowListEnabled),[]),i=(0,c().K8)((()=>{var e;return(null===(e=p().bM.getMcpConfig().allowListedClientIds)||void 0===e?void 0:e.length)??0}),[]);return(0,Ee.jsxs)(de().Y1,{direction:"vertical",gap:16,children:[(0,Ee.jsx)(It,{title:(0,Ee.jsx)(D().sA,{...vn.externalAgentsTitle}),description:(0,Ee.jsx)(D().sA,{...vn.externalAgentsDescription})}),(0,Ee.jsxs)(de().Y1,{direction:"vertical",gap:12,children:[(0,Ee.jsx)(jn,{}),n?(0,Ee.jsx)(fn,{approvedCount:i,onManageClick:t}):void 0]})]})}function jn(){const e=(0,l().v3)(),t=(0,c().O$)(s().AppStoreSidebarSpaceStore),n=(0,c().K8)((()=>p().bM.getMcpConfig().allowListEnabled?"allow_list":"any_integrations"),[]),o=(0,c().K8)((()=>null==t?void 0:t.id),[t]),a=(0,i.useCallback)((async n=>{if(!t||!o)return;const i="allow_list"===n;await Ce().DF({environment:e,spaceId:o,allowListEnabled:i})}),[e,t,o]);return(0,Ee.jsx)(Y().A,{spaceStore:t,title:(0,Ee.jsx)(D().sA,{...vn.restrictExternalAgentsTitle}),titleStyleKey:"bodyMedium",caption:"allow_list"===n?(0,Ee.jsx)(D().sA,{...vn.restrictExternalAgentsCaption}):(0,Ee.jsx)(D().sA,{...vn.noRestrictionsCaption}),type:"dropdown",currentOption:n,options:[{key:"any_integrations",label:(0,Ee.jsx)(D().sA,{...vn.noRestrictionsOption}),caption:(0,Ee.jsx)(D().sA,{...vn.noRestrictionsCaption})},{key:"allow_list",label:(0,Ee.jsx)(D().sA,{...vn.onlyFromApprovedListOption}),caption:(0,Ee.jsx)(D().sA,{...vn.onlyFromApprovedListCaption})}],onSelectOption:a,buttonStyle:{border:`1px solid ${E().Tj.outlineButtonBorder}`},info:[{key:"learn_more",label:(0,Ee.jsx)(D().sA,{...vn.connectionRestrictionsInfo})}]})}const In=["member_connections","workspace_connections","external_agents","permissions","approved_external_agents"],Cn=["external_agents","permissions","approved_external_agents"],Mn=["approved_external_agents"],wn=(0,D().YK)({aiSettingsCardName:{id:"AdminConnectionsSettings.aiSettingsCardName",defaultMessage:"Notion AI Connectors"},aiSettingsCardCaption:{id:"AdminConnectionsSettings.aiSettingsCardCaption",defaultMessage:"Get search results, AI answers, summaries and more without leaving Notion."},mcpSettingsCardName:{id:"AdminConnectionsSettings.mcpSettingsCardName",defaultMessage:"Notion MCP"},mcpSettingsCardCaption:{id:"AdminConnectionsSettings.mcpSettingsCardCaption",defaultMessage:"Connect Notion to your AI tools to summarize, search, and move faster."},memberConnectionsTab:{id:"admin.connections.tabs.member_connections",defaultMessage:"Member{numberOfIntegrations}"},workspaceConnectionsTab:{id:"admin.connections.tabs.workspace_connections",defaultMessage:"Workspace{numberOfIntegrations}"},externalAgentsTab:{id:"admin.connections.tabs.external_agents",defaultMessage:"External AI Tools{count}"},permissionsTab:{id:"admin.connections.tabs.permissions",defaultMessage:"Permissions"},breadcrumbConnections:{id:"admin.connections.breadcrumb.connections",defaultMessage:"Connections"},breadcrumbApprovedAgents:{id:"admin.connections.breadcrumb.approvedAgents",defaultMessage:"Manage approved external AI tools"}});function kn(e){var t;const n=(0,l().v3)(),{guestBotIds:o,organizationOverrides:y,onBreadcrumbViewChange:b}=e,S=(0,c().O$)(s().AppStoreSidebarSpaceStore),A=(0,c().K8)((()=>null==S?void 0:S.id),[S]),j=(0,c().K8)((()=>ne().A.webhookSubscriptions.state.reduce(((e,t)=>{const n=t.getBotId();return n&&(e[n]=t.id),e}),{})),[]),I=(0,a().X)("webhooks_beta"),M=(0,D().tz)(),T=(0,c().K8)((()=>(0,V().kB)()),[]),R=(0,c().K8)((()=>_n({intl:M,environment:n,from:"workspace_connections_settings",enabledConnectors:T})),[T,n,M]),W=(0,c().K8)((()=>S?(0,L().sb)([...o,...g().A.bots.state.map((e=>e.id))]).map((e=>{const t=u().v.createChildStore(S,{table:w().GP,id:e,spaceId:S.id});return t.getAlive()?t:void 0})).filter(O().O9):[]),[S,o]),K=(0,c().K8)((()=>(0,H().Mo)(W)),[W]),U=(0,c().K8)((()=>function(e){return e.filter((e=>e.isInternalBot())).map((e=>e.id))}(W)),[W]),Y=(0,c().K8)((()=>function(e,t,n){if(!t)return{};const i=(0,L().$z)(e.filter((e=>e.getCreatedById())),(e=>e.getIntegrationId()||e.id));return Object.entries(i).reduce(((e,[n,i])=>{var o;const s=null===(o=i[0])||void 0===o?void 0:o.getCreatedById();let a;return s&&(a=m().L.createChildStore(t,{table:k().oo,id:s})),e[n]={firstUserStore:a,totalUserCount:i.length},e}),{})}(W,S)),[W,S,M]),$=(0,c().K8)((()=>null==S?void 0:S.getBotSettingsStore().getValue()),[S]),G=Object.keys(K.nonCompliance).length+U.length,X=Object.values(K.compliance).flat().length,Z=null!=$&&$.integration_approval_statuses?Object.keys($.integration_approval_statuses).length+U.length:U.length,te=(0,c().K8)((()=>p().bM.getMcpConfig().isAllowlistFeatureEnabled),[]),le=(0,c().K8)((()=>{const e=p().bM.getMcpConfig(),{clients:t}=e;return Object.values(t).filter((e=>e.isConnected&&!e.isBlocked)).length}),[]),ce=(0,i.useMemo)((()=>{let e=[...In];return te||(e=e.filter((e=>!Cn.includes(e)))),e.filter((e=>!Mn.includes(e)))}),[te]),de=(0,c().K8)((()=>"integrations"===se().Ay.state.currentTab?se().Ay.state.defaultSubtab:void 0),[]),ge=(0,c().K8)((()=>ne().A.integrations.state),[]),[pe,ue]=(0,i.useState)((()=>{const e=de||"member_connections";return Cn.includes(e)&&!te?"member_connections":e})),me=(0,i.useCallback)((e=>{ue(ce[e])}),[ce]),he=(0,i.useCallback)((()=>{ue("permissions"),null==b||b(!1)}),[b]),fe=(0,i.useCallback)((()=>{ue("approved_external_agents"),null==b||b(!0)}),[b]),ye=(0,h().lh)({spaceId:A}),be="enterprise"===(0,B().AI)(ye),xe=(0,ae()._)({name:"manage_integration_permissions",spaceId:A,userId:null===(t=n.currentUser)||void 0===t?void 0:t.id}),ve=null==xe?void 0:xe.upsell,Se=Boolean(y.integration_restrictions),Ae=Boolean(y.disallow_webhook_automation_action),je=(0,d().IS)((()=>({connectedSection:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative"},connectedSectionDescription:{fontSize:14,marginInlineEnd:8,color:E().Tj.text.tertiary,fontWeight:400,marginBottom:12},addMenu:{position:"absolute",insetInlineEnd:0,top:0},discoverSectionUpsell:{backgroundColor:E().Tj.palette.uiBlue[100],padding:16,paddingBottom:8,borderRadius:6},discoverSectionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},discoverSectionTitle:{fontSize:16,fontWeight:510},tabBadge:{marginInlineStart:6}})),[]),Ie={member_connections:(0,Ee.jsx)(D().sA,{...wn.memberConnectionsTab,values:{numberOfIntegrations:0!==G&&(0,Ee.jsx)(v().A,{isSecondaryColor:!0,style:je.tabBadge,children:G+C().Ei.length})}}),workspace_connections:(0,Ee.jsx)(D().sA,{...wn.workspaceConnectionsTab,values:{numberOfIntegrations:0!==X&&(0,Ee.jsx)(v().A,{isSecondaryColor:!0,style:je.tabBadge,children:X})}}),external_agents:(0,Ee.jsx)(D().sA,{...wn.externalAgentsTab,values:{count:0!==le&&(0,Ee.jsx)(v().A,{isSecondaryColor:!0,style:je.tabBadge,children:le})}}),permissions:(0,Ee.jsx)(D().sA,{...wn.permissionsTab}),approved_external_agents:null},Ce={member_connections:()=>(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(Tn,{isIntegrationRestrictionsControlledByOrganization:Se}),null!=$&&$.integration_restrictions?(0,Ee.jsx)("div",{style:{marginTop:"19px"},children:(0,Ee.jsx)(Bn,{isIntegrationRestrictionsControlledByOrganization:Se})}):void 0,(0,Ee.jsx)("div",{style:{marginTop:"19px"},children:(0,Ee.jsx)(Pn,{isDisallowWebhookAutomationsControlledByOrganization:Ae})}),(0,Ee.jsx)(En,{}),(0,Ee.jsx)(f().A,{size:r().A.isMobile?32:18,isHidden:!r().A.isMobile}),Boolean(null==$?void 0:$.integration_restrictions)?(0,Ee.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:19},children:[(0,Ee.jsx)(v().A,{style:{fontWeight:z().Wy.medium,display:"flex",alignItems:"center",height:28},children:(0,Ee.jsx)(D().sA,{id:"adminConnectionsSettings.table.allowIntegrations.title",defaultMessage:"Approved connections{numberOfIntegrations}",values:{numberOfIntegrations:0!==Z&&(0,Ee.jsx)(v().A,{isSecondaryColor:!0,style:{marginInlineStart:6},children:Z})}})}),(0,Ee.jsx)(Xt,{})]}):(0,Ee.jsx)(v().A,{style:{fontWeight:z().Wy.medium,display:"flex",height:28,alignItems:"center",marginBottom:"19px"},children:(0,Ee.jsx)(D().sA,{id:"adminConnectionsSettings.table.default.title",defaultMessage:"All connections{numberOfIntegrations}",values:{numberOfIntegrations:0!==G&&(0,Ee.jsx)(v().A,{isSecondaryColor:!0,style:{marginInlineStart:6},children:G+C().Ei.length})}})}),(0,Ee.jsx)(Jt().Ay,{integrationIdToBotIds:K.nonCompliance,internalIntegrationIds:U,integrationIdToUserSummaries:Y}),(0,Ee.jsx)("div",{style:{marginTop:16,marginBottom:32,display:"grid",gridTemplateColumns:"1fr",gap:4},children:(0,Ee.jsx)(q().W,{})})]}),workspace_connections:()=>{const e=Object.keys(K.compliance),t=e.length>0,i=function(e){const{allIntegrations:t,connectedIntegrationIds:n,isEnterprise:i}=e,o=[];for(const s of t)if(!n.includes(s.id)){const e=(0,_().Hr)(s.id);if(!e)continue;if("internal"===s.type)continue;o.push({id:s.id,appName:s.name,account:void 0,caption:s.getInfo().tagline,logo:s.getInfo().icon,shouldHideInDiscover:!1,shouldShowNewBadge:!1,shouldHideConnectAccount:!0,shouldShowUpsell:!i,integrationTypes:[e.type],capabilities:void 0,canSelectPageAccess:!1,onConnect:()=>{var t;null!=e&&null!==(t=e.oauth)&&void 0!==t&&t.accountInfoPropertyNames||"dlp"===(null==e?void 0:e.type)||"ediscovery"===(null==e?void 0:e.type)?oe().A.setState({open:!0,integrationId:s.id}):ie().A.setState({open:!0,integrationId:s.id})},onDisconnect:()=>{}})}return o}({allIntegrations:ge,connectedIntegrationIds:e,isEnterprise:be});be&&i.unshift(...R);const o=i.length>0||R.length>0;return I?(0,Ee.jsxs)(Ee.Fragment,{children:[t?(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)("span",{style:je.connectedSectionDescription,children:(0,Ee.jsx)(D().sA,{id:"admin.connections.tab.workspace_connections.description",defaultMessage:"These integrations connect your workspace to external apps, or improve security and compliance. Only workspace owners can install them"})}),(0,Ee.jsxs)("div",{style:je.connectedSection,children:[(0,Ee.jsx)("div",{style:je.addMenu,children:(0,Ee.jsx)(Zt,{})}),(0,Ee.jsx)(Jt().KM,{botIdToWebhookSubscriptionId:j,complianceIntegrationsIdToBotIds:K.compliance})]})]}):void 0,o?(0,Ee.jsx)("div",{children:(0,P().wy)(ve)?(0,Ee.jsx)(re().w,{upsell:ve,source:"workspace_connections",spaceStore:S,title:(0,Ee.jsx)(D().sA,{id:"adminConnectionsSettings.discoverNewConnectionsSection.title",defaultMessage:"Customize Notion with advanced integrations"}),description:(0,Ee.jsx)(D().sA,{id:"adminConnectionsSettings.discoverNewConnectionsSection.description",defaultMessage:"Get the {planName} plan to keep information flowing in and out of Notion",values:{planName:(0,N().u2)({product:ve.product,intl:M})}}),onClickLearnMore:()=>{(0,J().L)({environment:n,url:"https://www.notion.so/integrations/collections/security-and-compliance"})},icons:zn}):(0,Ee.jsx)("div",{style:{...be?{}:je.discoverSectionUpsell,marginTop:t?32:void 0},children:(0,Ee.jsx)(F().A,{apps:i,numberOfConnectedApps:e.length,numberOfDisplayRows:2,title:(0,Ee.jsx)("div",{style:je.discoverSectionHeader,children:(0,Ee.jsx)("div",{style:je.discoverSectionTitle,children:be?(0,Ee.jsx)(D().sA,{id:"connectionsSettings.discoverNewConnectionsSection.title",defaultMessage:"Discover new connections"}):(0,Ee.jsx)(D().sA,{id:"connectionsSettings.discoverNewConnectionsSection.titleUpsell",defaultMessage:"Upgrade to Enterprise to use these connections"})})})})})}):void 0]}):null},external_agents:()=>(0,Ee.jsx)(en,{}),permissions:()=>(0,Ee.jsx)(Sn,{onNavigateToApprovedAgents:fe}),approved_external_agents:()=>{const e=[{message:(0,Ee.jsx)(D().sA,{...wn.breadcrumbConnections}),onClick:he},{message:(0,Ee.jsx)(D().sA,{...wn.breadcrumbApprovedAgents})}];return(0,Ee.jsx)(Q().D,{breadcrumbs:e,children:(0,Ee.jsx)(Mt,{})})}},Me=e=>Ce[e],we="approved_external_agents"!==pe,ke=ce.map((e=>Ie[e])).filter(O().O9),Te=ce.indexOf(pe),Be=-1===Te?0:Te;return I?(0,Ee.jsxs)(Ee.Fragment,{children:[we?te?(0,Ee.jsx)(ee().I,{tabs:ke,selectedIndex:Be,onChange:me,marginBottom:16,tabGap:4}):(0,Ee.jsx)(x().LZ,{tabs:ke,selectedIndex:Be,onChange:me}):null,Me(pe)()]}):Me("member_connections")()}function Tn({isIntegrationRestrictionsControlledByOrganization:e}){var t;const n=(0,l().v3)(),i=(0,c().O$)(s().AppStoreSidebarSpaceStore),o=(0,c().K8)((()=>null==i?void 0:i.id),[i]),a=(0,c().K8)((()=>null==i?void 0:i.getBotSettingsStore().getValue()),[i]),r=(0,ae()._)({name:"manage_integration_permissions",spaceId:o,userId:null===(t=n.currentUser)||void 0===t?void 0:t.id}),d=null==r?void 0:r.upsell;return(0,Ee.jsx)(Y().A,{spaceStore:i,isLocked:e,lockedTooltip:(0,$().C_)(),title:(0,Ee.jsx)(D().sA,{id:"adminConnectionsSettings.requireApprovalSetting.title",defaultMessage:"Restrict members from adding connections"}),caption:(0,T().az)(a)?(0,Ee.jsx)(D().sA,{id:"adminConnectionsSettings.requireApprovalSetting.allowList.workspaceOwner.caption",defaultMessage:"Workspace members can only install connections pre-approved by workspace owners."}):(0,Ee.jsx)(D().sA,{id:"adminConnectionsSettings.requireApprovalSetting.off.caption",defaultMessage:"Workspace members can install any new connection."}),upsellOptions:d?{upsell:d,analyticsName:"integration_settings",customMessages:Ln}:void 0,type:"dropdown",currentOption:(0,T().az)(a)?"allow_list":"any_integrations",options:[{key:"any_integrations",label:(0,Ee.jsx)(D().sA,{id:"adminIntegrationSettings.integrationRestrictions.off.title",defaultMessage:"No restrictions"}),caption:(0,Ee.jsx)(D().sA,{id:"adminConnectionsSettings.connectionRestrictions.off.caption",defaultMessage:"Workspace members can install any connection."})},{key:"allow_list",label:(0,Ee.jsx)(D().sA,{id:"adminIntegrationSettings.integrationRestrictions.allowList.title",defaultMessage:"Only from approved list"}),caption:(0,Ee.jsx)(D().sA,{id:"adminConnectionsSettings.connectionRestrictions.allowList.caption",defaultMessage:"Workspace members can only install connections pre-approved by a workspace owner."})}],onSelectOption:t=>{e||function(e){const{environment:t,spaceStore:n,botSettings:i,setting:o}=e;if(n){if("allow_list"===o&&(0,T().az)(i))return;const e="allow_list"===o?"approved_only":void 0;le().createAndCommit({userAction:"AdminIntegrationSettings.handleIntegrationRestrictionSelect",environment:t,canUndo:!0,perform:t=>{W().zv({store:n,data:{bot_settings:{...i,integration_restrictions:e}},transaction:t})}})}}({environment:n,spaceStore:i,botSettings:a,setting:t})},info:[{key:"learn_more",label:(0,Ee.jsx)(D().sA,{id:"adminConnectionsSettings.connectionRestrictions.info.title",defaultMessage:"Workspace owners can always install and approve new connections."})}]})}function Bn(e){var t;const{isIntegrationRestrictionsControlledByOrganization:n}=e,i=(0,l().v3)(),o=(0,c().O$)(s().AppStoreSidebarSpaceStore),a=(0,c().K8)((()=>null==o?void 0:o.id),[o]),r=(0,c().K8)((()=>null==o?void 0:o.getBotSettingsStore().getValue()),[o]),g=(0,d().IS)((()=>({builtbynotion:{color:E().Tj.green.text.accentPrimary,marginInlineEnd:2,marginInlineStart:2,gap:2,display:"flex",alignItems:"center"}})),[]),p=(0,ae()._)({name:"manage_integration_permissions",spaceId:a,userId:null===(t=i.currentUser)||void 0===t?void 0:t.id}),u=null==p?void 0:p.upsell;return(0,Ee.jsx)(Y().A,{spaceStore:o,title:(0,Ee.jsx)(D().sA,{id:"adminConnectionsSettings.autoApproveBuiltByNotion.title",defaultMessage:"Auto-approve <builtbynotion>Built by Notion</builtbynotion> connections",values:{builtbynotion:e=>(0,Ee.jsxs)("span",{style:g.builtbynotion,children:[(0,Ee.jsx)(y().I,{icon:j().checkmarkShieldFillSmallIcon,size:"sm"}),e]})}}),caption:(0,Ee.jsx)(D().sA,{defaultMessage:"Toggle this on to approve all workspace members to install connections <helpcenterlink>built by Notion</helpcenterlink>.",id:"adminConnectionsSettings.autoApproveBuiltByNotion.caption",values:{helpcenterlink:e=>(0,Ee.jsx)(b().V,{href:(0,G().x)("guides.enterpriseIntegrationSettings"),children:e})}}),upsellOptions:u?{upsell:u,analyticsName:"integration_settings"}:void 0,type:"toggle",isOn:"approved_or_built_by_notion"===(null==r?void 0:r.integration_restrictions),onToggle:()=>{n||function(e){const{environment:t,spaceStore:n,botSettings:i}=e;if(n){const e="approved_or_built_by_notion"===(null==i?void 0:i.integration_restrictions)?"approved_only":"approved_or_built_by_notion";le().createAndCommit({userAction:"AdminIntegrationSettings.handleAutoApproveBuiltByNotionToggle",environment:t,canUndo:!0,perform:t=>{W().zv({store:n,data:{bot_settings:{...i,integration_restrictions:e}},transaction:t})}})}}({environment:i,spaceStore:o,botSettings:r})},isLocked:n,lockedTooltip:(0,$().C_)()})}function Pn({isDisallowWebhookAutomationsControlledByOrganization:e}){var t;const n=(0,l().v3)(),o=(0,c().O$)(s().AppStoreSidebarSpaceStore),a=(0,c().K8)((()=>null==o?void 0:o.id),[o]),r=(0,ae()._)({name:"manage_integration_permissions",spaceId:a,userId:null===(t=n.currentUser)||void 0===t?void 0:t.id}),d=null==r?void 0:r.upsell,g=(0,c().K8)((()=>Boolean(null==o?void 0:o.getSettingsStore().getKeyStore("disallow_webhook_automation_action").getValue())),[o]),p=!g,u=(0,i.useCallback)((()=>{o&&!e&&le().createAndCommit({userAction:"AdminIntegrationSettings.handleAutoApproveBuiltByNotionToggle",environment:n,canUndo:!0,perform:e=>{W().zv({store:o.getSettingsStore(),data:{disallow_webhook_automation_action:!g},transaction:e})}})}),[o,g,n,e]);return(0,Ee.jsx)(Y().A,{spaceStore:o,isLocked:e,lockedTooltip:(0,$().C_)(),title:(0,Ee.jsx)(D().sA,{id:"adminConnectionsSettings.allowWebRequestsInAutomations.title",defaultMessage:"Allow webhooks in automations"}),caption:(0,Ee.jsx)(D().sA,{defaultMessage:"Allow webhooks to third-party tools in database automations and buttons.",id:"adminConnectionsSettings.allowWebRequestsInAutomations.caption"}),upsellOptions:d?{upsell:d,analyticsName:"integration_settings",customMessages:On}:void 0,type:"toggle",isOn:p,onToggle:u})}function Nn(e){const{mainIcon:t,connectors:n}=e;return(0,Ee.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center",paddingTop:8,paddingBottom:12},children:[(0,Ee.jsx)(y().I,{icon:t}),(0,Ee.jsx)(y().I,{icon:I().plusIcon,size:"xxs",colorVariant:"secondary"}),(0,Ee.jsx)(K().hC,{connectors:n,maxBubbles:6,iconSize:14})]})}function _n(e){const{intl:t,environment:n,from:i,enabledConnectors:s}=e;return[{id:"ai_settings_link",appName:t.formatMessage(wn.aiSettingsCardName),caption:t.formatMessage(wn.aiSettingsCardCaption),account:void 0,shouldShowNewBadge:!0,canSelectPageAccess:!1,onConnect(){R().Ow({currentTab:"ai",subtab:"ai_connectors"}),(0,o().u)({environment:n,event:{eventName:"open_settings",eventProperties:{tab:"ai",from:i,...(0,te().hX)({environment:n})}}})},onDisconnect(){},logo:s.length>0?Nn({mainIcon:A().aiFaceIcon,connectors:s}):U,width:"auto",capabilities:(0,Ee.jsx)("div",{style:{display:"none"}}),showExploreButton:!0}]}function Dn(e){const{intl:t,setPage:n}=e;return[{id:"mcp_settings_link",appName:t.formatMessage(wn.mcpSettingsCardName),caption:t.formatMessage(wn.mcpSettingsCardCaption),account:void 0,canSelectPageAccess:!1,onConnect(){n("mcp_settings")},onDisconnect(){},logo:Nn({mainIcon:M().notionIcon,connectors:["cursor","claude","chatgpt"]}),width:"auto",capabilities:(0,Ee.jsx)("div",{style:{display:"none"}}),showExploreButton:!0}]}function En(){const e=(0,X().r)("settings_connections_consultant_callout");return"control"===e?null:(0,Ee.jsx)("div",{style:{marginTop:"19px"},children:(0,Ee.jsx)(Z().c,{type:e,placement:"connections-settings"})})}const Ln=(0,D().YK)({eligible_to_purchase:{id:"adminConnectionsSettings.connectionUpgradeMessages.eligibleToPurchase",defaultMessage:"<highlight>Upgrade</highlight> to control what workspace members can install"},eligible_for_trial:{id:"adminConnectionsSettings.connectionUpgradeMessages.eligibleForTrial",defaultMessage:"<highlight>Start trial</highlight> to control what workspace members can install"},sales_eligible:{id:"adminConnectionsSettings.connectionUpgradeMessages.salesEligible",defaultMessage:"<highlight>Contact sales</highlight> to control what workspace members can install"},sales_assisted:{id:"adminConnectionsSettings.connectionUpgradeMessages.salesAssisted",defaultMessage:"<highlight>Contact sales</highlight> to control what workspace members can install"},eligible_to_request:{id:"adminConnectionsSettings.connectionUpgradeMessages.eligibleToRequest",defaultMessage:"<highlight>Request access</highlight> to control what workspace members can install"},not_eligible:{id:"adminConnectionsSettings.connectionUpgradeMessages.notEligible",defaultMessage:"<highlight>Upgrade</highlight> to control what workspace members can install"},request_pending:{id:"adminConnectionsSettings.connectionUpgradeMessages.requestPending",defaultMessage:"<highlight>Requested</highlight> to control what workspace members can install"}}),On=(0,D().YK)({eligible_to_purchase:{id:"adminConnectionsSettings.webhookUpgradeMessages.eligibleToPurchase",defaultMessage:"<highlight>Upgrade</highlight> to disable webhooks to third-party tools in database automations and buttons"},eligible_for_trial:{id:"adminConnectionsSettings.webhookUpgradeMessages.eligibleForTrial",defaultMessage:"<highlight>Start trial</highlight> to disable webhooks to third-party tools in database automations and buttons"},sales_eligible:{id:"adminConnectionsSettings.webhookUpgradeMessages.salesEligible",defaultMessage:"<highlight>Contact sales</highlight> to disable webhooks to third-party tools in database automations and buttons"},sales_assisted:{id:"adminConnectionsSettings.webhookUpgradeMessages.salesAssisted",defaultMessage:"<highlight>Contact sales</highlight> to disable webhooks to third-party tools in database automations and buttons"},eligible_to_request:{id:"adminConnectionsSettings.webhookUpgradeMessages.eligibleToRequest",defaultMessage:"<highlight>Request access</highlight> to disable webhooks to third-party tools in database automations and buttons"},not_eligible:{id:"adminConnectionsSettings.webhookUpgradeMessages.notEligible",defaultMessage:"<highlight>Upgrade</highlight> to disable webhooks to third-party tools in database automations and buttons"},request_pending:{id:"adminConnectionsSettings.webhookUpgradeMessages.requestPending",defaultMessage:"<highlight>Requested</highlight> to disable webhooks to third-party tools in database automations and buttons"}}),zn=[{src:S().A.images.externalIntegrations.pantherLogoPng,isSquare:!0,width:20,height:20},{src:S().A.images.externalIntegrations.nightfallLogoSvg},{src:S().A.images.externalIntegrations.datadogLogoPng,isSquare:!0,width:28,height:28},{src:S().A.images.externalIntegrations.sumoLogicLogoJpeg},{src:S().A.images.externalIntegrations.splunkLogoJpeg},{src:S().A.images.externalIntegrations.polymerLogoJpeg}]},534842:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>i,sparklesFillSmallIcon:()=>o});n(296540);const i={viewBox:"0 0 16 16",fittedViewBox:"1.25 1.61 13.5 12.78",svg:(0,n(474848).jsx)("path",{d:"M5.201 2.236a.625.625 0 1 0-1.25 0c0 .389-.249.914-.705 1.37s-.981.705-1.37.705a.625.625 0 0 0 0 1.25c.389 0 .914.25 1.37.706s.705.98.705 1.37a.625.625 0 0 0 1.25 0c0-.39.25-.915.706-1.37s.981-.706 1.37-.706a.625.625 0 1 0 0-1.25c-.389 0-.914-.249-1.37-.705S5.2 2.625 5.2 2.236m5.495 3.42a.625.625 0 0 0-1.25 0c0 .854-.403 1.715-1.058 2.37-.656.656-1.517 1.059-2.37 1.059a.625.625 0 1 0 0 1.25c.853 0 1.714.402 2.37 1.058.655.656 1.058 1.517 1.058 2.37a.625.625 0 0 0 1.25 0c0-.853.402-1.714 1.058-2.37s1.517-1.058 2.37-1.058a.625.625 0 0 0 0-1.25c-.853 0-1.714-.403-2.37-1.058-.656-.656-1.058-1.517-1.058-2.37"})},o=(0,n(340498).wt)("sparklesFillSmall",i,"fillSmall")},600329:(e,t,n)=>{n.d(t,{r:()=>o});n(296540);const i={viewBox:"0 0 20 20",fittedViewBox:"4.19 4.19 11.62 11.62",svg:(0,n(474848).jsx)("path",{d:"m15.543 5.75-.684.684-1.288-1.289.692-.69a.91.91 0 0 1 1.28 0c.35.35.35.93 0 1.28zM6.11 15.183l7.914-7.914-1.289-1.29-7.92 7.909a1.3 1.3 0 0 0-.275.457l-.335 1.082c-.061.228.152.442.366.366l1.082-.336q.251-.068.457-.274"})},o=(0,n(340498).wt)("pencil",i,"default")},731297:(e,t,n)=>{n.d(t,{KM:()=>st,Ay:()=>ot,de:()=>it});n(944114),n(898992),n(354520),n(430670),n(581454);var i=n(296540),o=()=>n(907258),s=()=>n(755531),a=()=>n(484714),r=()=>n(590526),l=()=>n(401497),c=()=>n(891317),d=()=>n(609679),g=()=>n(457205),p=()=>n(574359),u=()=>n(807449),m=()=>n(98126),h=()=>n(26697),f=()=>n(302501),y=()=>n(764880),b=()=>n(869190),x=()=>n(617871),v=()=>n(452745),S=()=>n(158661),A=()=>n(388693),j=()=>n(45331),I=()=>n(824862),C=()=>n(332393),M=()=>n(798880),w=()=>n(606219),k=()=>n(534177);var T=()=>n(20498),B=()=>n(69708),P=()=>n(100622),N=()=>n(676510),_=()=>n(284371),D=()=>n(824160),E=()=>n(187820),L=()=>n(566468),O=()=>n(453697),z=()=>n(692031),R=()=>n(212497),W=()=>n(726637),K=()=>n(312788),U=()=>n(757695),V=()=>n(107975),F=()=>n(250910),q=()=>n(118307),Y=()=>n(546926),H=()=>n(406094),$=()=>n(160432),G=()=>n(890492),X=()=>n(81068),Z=()=>n(663639),J=()=>n(736847),Q=()=>n(799288),ee=()=>n(187174),te=()=>n(427704),ne=()=>n(498212),ie=()=>n(559926),oe=()=>n(908928),se=()=>n(723786);function ae({shouldCollectData:e,environment:t,sidebarSpaceStore:n,sidebarSpaceViewStore:i,botStore:o}){const[s,a]=(0,ee().Yb)((async()=>e&&n&&o?await oe().GO({environment:t,spaceStore:n,botIds:[o.id]}):{bots:{},integrationManagementPermissions:{}}),[e,t,n,o]),l=(0,r().K8)((()=>e?(null==i?void 0:i.getSharedPageIds())??[]:[]),[e,i]),d=(0,r().K8)((()=>o?o.getIntegrationManagementPermissions():(0,c().RV)()),[o]),g=(0,se().g)({pageIdsSharedWithUser:e?l:[],spaceViewStore:i,spaceStore:n}),p=(0,r().K8)((()=>{var t;return e&&"resolved"===s.status?(null===(t=s.value)||void 0===t||null===(t=t.bots)||void 0===t||null===(t=t[(null==o?void 0:o.id)||""])||void 0===t?void 0:t.pageIds)??[]:[]}),[e,s.status,s.value,null==o?void 0:o.id]);if(e)return{userSharedPageIds:l,pageSelectionData:g,status:s.status,pageIdsAlreadySharedWithBot:p,integrationManagementPermissions:d,refetchBotSharedPages:a}}var re=()=>n(593781),le=()=>n(911706),ce=()=>n(378765),de=n(474848);const ge=(0,B().YK)({manageIntegrationLabel:{id:"spaceIntegrationSettings.actionMenu.manageIntegration.label",defaultMessage:"Manage in developer portal"},deleteIntegrationButtonLabel:{id:"spaceIntegrationSettings.actionMenu.deleteIntegrationButton.label",defaultMessage:"Delete {integrationName}"},managePageAccess:{id:"spaceIntegrationSettings.actionMenu.managePageAccess.label",defaultMessage:"Manage page access"},removeIntegrationModalTitle:{id:"spaceIntegrationSettings.actionMenu.removeIntegration.modal.label.title",defaultMessage:"Delete {integrationName} in workspace"},removeIntegrationModalCaption:{id:"spaceIntegrationSettings.actionMenu.removeIntegration.modal.label.caption",defaultMessage:"Revoke access for {integrationName} in workspace"},removeIntegrationCancelButton:{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.cancel",defaultMessage:"Cancel"},deleteIntegrationModalButton:{id:"spaceIntegrationSettings.actionMenu.deleteIntegration.modal.button.delete",defaultMessage:"Delete"},copyInternalIntegrationTokenButtonLabel:{id:"spaceIntegrationSettings.actionMenu.copyInternalIntegrationTokenButton.label",defaultMessage:"Copy internal integration token"}});function pe(e){const{botId:t}=e,[,,n]=(0,r().$y)(void 0,q().A),i=(0,r().O$)(o().AppStoreSidebarSpaceStore),s=(0,r().O$)(o().AppStoreSidebarSpaceViewStore);return i&&s?(0,de.jsx)(F().A,{popupType:W().A.isMobile?F().z.SlideUp:F().z.Popup,buttonPopupStore:n,renderOrigin:e=>(0,de.jsx)(le().A,{isMobile:W().A.isMobile,...e,style:{marginInlineStart:8,marginInlineEnd:8}}),render:()=>(0,de.jsx)(ue,{botId:t,sidebarSpaceStore:i,sidebarSpaceViewStore:s})}):null}function ue(e){const{botId:t,sidebarSpaceStore:n,sidebarSpaceViewStore:o}=e,{navigate:s}=(0,i.useContext)(K().E),l=(0,a().v3)(),[c,d]=(0,i.useState)(!1),[p,u]=(0,i.useState)(!1),m=(0,r().K8)((()=>g().v.createChildStore(n,{table:I().GP,id:t,spaceId:n.id})),[t,n]),h=(0,r().K8)((()=>(0,Q().Hg)(null==m?void 0:m.getModel())),[m]),y=ae({shouldCollectData:Boolean(m),environment:l,sidebarSpaceStore:n,sidebarSpaceViewStore:o,botStore:m}),[{value:b}]=(0,ee().Yb)((async()=>{if(m){return await oe().dA({environment:l,botId:null==m?void 0:m.id})}}),[l,m]);return m?(0,de.jsxs)(de.Fragment,{children:[(0,de.jsx)(G().A,{menuType:W().A.isMobile?Y().gu.ActionSheet:Y().gu.Popup,children:(0,de.jsx)(Z().A,{type:Z().O.Vertical,sections:[{key:"integration options",render:e=>(0,de.jsx)(J().A,{...e}),items:[...b?[me({environment:l,botToken:b})]:[],...y?[he({onShowModal:()=>u(!0)})]:[],{key:"manage",action:()=>s({environment:l,url:`${te().JZ.creatorProfileIntegrations}/internal/${ne().Xw(t)}`,openInNew:"tab"}),render:e=>(0,de.jsx)(X().A,{title:(0,de.jsx)(B().sA,{...ge.manageIntegrationLabel}),...e})},{key:"delete",action:()=>d(!0),render:e=>(0,de.jsx)(X().A,{title:(0,de.jsx)(B().sA,{...ge.deleteIntegrationButtonLabel,values:{integrationName:h}}),style:{color:P().oZ.red},...e})}]}],initialFocus:void 0})}),(0,de.jsx)(V().a,{open:c,onDismiss:()=>{d(!1)},transitionAppearance:"none",render:()=>(0,de.jsxs)("div",{style:{padding:20,width:333},children:[(0,de.jsx)(f().A,{isMultiline:!0,style:{marginBottom:8,fontWeight:_().Wy.semibold},children:(0,de.jsx)(B().sA,{...ge.removeIntegrationModalTitle,values:{integrationName:h}})}),(0,de.jsx)(f().A,{isMultiline:!0,isSecondaryColor:!0,style:{marginBottom:8},children:(0,de.jsx)(B().sA,{...ge.removeIntegrationModalCaption,values:{integrationName:h}})}),(0,de.jsxs)("div",{style:{display:"flex",marginTop:12},children:[(0,de.jsx)(H().A,{style:{width:140,marginInlineEnd:9},size:"lg",onClick:()=>d(!1),children:(0,de.jsx)(f().A,{children:(0,de.jsx)(B().sA,{...ge.removeIntegrationCancelButton})})}),(0,de.jsx)($().A,{style:{width:140},size:"lg",colorPalette:"red",onClick:async()=>{d(!1),await oe().KA({environment:l,botId:m.id,onSuccess:()=>{ie().hs(l,{type:"internal"})}})},children:(0,de.jsx)(B().sA,{...ge.deleteIntegrationModalButton})})]})]})}),(0,de.jsx)(fe,{pageAccessModalOpen:p,onClose:()=>u(!1),pageAccessData:y,sidebarSpaceStore:n,botStore:m})]}):null}function me(e){const{botToken:t,environment:n}=e;return{key:"copy bot token",action:async()=>{const[e,i]=await Promise.all([(0,z().r)(),(0,R().jd)()]);i({environment:n,stringValue:t,copiedMessage:e.copiedLinkToClipboard}),ie().Er(n,{from:"integration-settings",table:I().GP})},render:e=>(0,de.jsx)(X().A,{title:(0,de.jsx)(B().sA,{...ge.copyInternalIntegrationTokenButtonLabel}),...e})}}function he(e){const{onShowModal:t}=e;return{key:"page-access",action:t,render:e=>(0,de.jsx)(X().A,{title:(0,de.jsx)(B().sA,{...ge.managePageAccess}),...e})}}function fe(e){const{pageAccessModalOpen:t,onClose:n,pageAccessData:o,sidebarSpaceStore:s,botStore:a}=e,[r]=(0,i.useState)((()=>U().Store.createValue({})));if((0,i.useEffect)((()=>{if(!o)return;const e={};for(const t of o.pageIdsAlreadySharedWithBot)e[t]=!0;r.setState(e)}),[o,r]),!o||!s||!a)return null;const l="resolved"===o.status||"rejected"===o.status;return(0,de.jsx)(ce().A,{loaded:l,showSpinnerTimeout:0,children:(0,de.jsx)(re().r,{isOpen:t,onClose:n,pageIdsAlreadySharedWithBot:o.pageIdsAlreadySharedWithBot,teamPagesByTeam:o.pageSelectionData.teamPagesByTeam,allTeams:o.pageSelectionData.allTeams,privatePages:o.pageSelectionData.allPrivatePages,pagesSharedWithUser:o.pageSelectionData.allSharedPages,workspacePages:o.pageSelectionData.allWorkspacePages,spaceId:s.id,botStore:a,spaceStore:s,refetchBotSharedPages:o.refetchBotSharedPages,selectedBlockIdsStore:r,pagePickerLocation:"internal_integration_page_picker",integrationManagementPermissions:o.integrationManagementPermissions})})}var ye=()=>n(317182),be=()=>n(882462),xe=(n(672577),n(908872),()=>n(128933)),ve=()=>n(770063),Se=()=>n(849255),Ae=()=>n(127833),je=()=>n(322769),Ie=()=>n(778078),Ce=()=>n(763824),Me=()=>n(424400),we=()=>n(433847),ke=()=>n(583690);function Te(e){const{capabilities:t}=e,n=(0,B().tz)(),i=(0,we().MD)(t),o=(0,we().kL)(t),s=(0,we().KI)(e.capabilities),a=[...(0,ke().I2)(i),...(0,ke().YC)(o),...(0,ke().AC)(s)];return(0,de.jsx)(Me().Ay,{...e,title:n.formatMessage((0,we().sK)(i,void 0).label),shouldWrapCaption:!0,style:W().A.isMobile?{padding:"12px 4px"}:{padding:4,marginTop:2,marginBottom:2},captionStyle:{marginTop:4},caption:(0,de.jsx)("div",{children:a})})}var Be=()=>n(419357),Pe=()=>n(994006),Ne=()=>n(232930),_e=()=>n(752860),De=()=>n(963186),Ee=()=>n(547149);const Le=(0,B().YK)({userSearchPlaceholder:{id:"integrationInstallerFilter.userSearch.placeholder",defaultMessage:"Filter by user"},revokeUserAccess:{id:"spaceIntegrationSettings.actionMenu.revokeUserAccess.label",defaultMessage:"Disconnect user"},visitDeveloperWebsite:{id:"spaceIntegrationSettings.actionMenu.visitDeveloperWebsite.label",defaultMessage:"Visit developer website"},contactDeveloperSupport:{id:"spaceIntegrationSettings.actionMenu.contactDeveloperSupport.label",defaultMessage:"Contact support"},disconnectAllUsers:{id:"spaceIntegrationSettings.actionMenu.disconnectAll.label",defaultMessage:"Disconnect all users"},removeFromApprovedList:{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.label",defaultMessage:"Remove from approved list"},selectPageAccess:{id:"spaceIntegrationSettings.actionMenu.selectPageAccess.label",defaultMessage:"Select page access"},cancelButton:{id:"spaceIntegrationSettings.admin.actionMenu.removeIntegrationApproval.modal.button.cancel",defaultMessage:"Cancel"},disconnectButton:{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.disconnect",defaultMessage:"Disconnect"},removeButton:{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.remove",defaultMessage:"Remove"},disapproveModalTitle:{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.title",defaultMessage:"Remove {integrationName} from approved integrations"},disapproveModalCaption:{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.caption",defaultMessage:"Prevent members from installing {integrationName}."},disapproveAndDisconnectCaption:{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApprovalAndDisconnectAll.caption",defaultMessage:"Revoke access for {integrationName} for all users in this workspace and prevent members from installing {integrationName}."},disconnectAllModalTitle:{id:"spaceIntegrationSettings.actionMenu.disconnectAll.modal.label",defaultMessage:"Disconnect {integrationName} for all users in workspace"},disconnectAllModalCaption:{id:"spaceIntegrationSettings.actionMenu.disconnectAll.modal.caption",defaultMessage:"Revoke access for {integrationName} for all users in this workspace."},disconnectUserModalTitle:{id:"spaceIntegrationSettings.actionMenu.disconnectUser.modal.label",defaultMessage:"Disconnect {integrationName}?"},disconnectUserModalCaption:{id:"spaceIntegrationSettings.actionMenu.disconnectUser.modal.caption",defaultMessage:"Revoke access for {integrationName} for {userName}"},complianceManage:{id:"complianceIntegrationSettings.actionMenu.manage",defaultMessage:"Manage"},complianceLearnMore:{id:"complianceIntegrationSettings.actionMenu.learnMore",defaultMessage:"Learn more"},complianceDisconnect:{id:"complianceIntegrationSettings.actionMenu.disconnect",defaultMessage:"Disconnect"},complianceDisconnectModalTitle:{id:"complianceIntegrationSettings.disconnectModal.title",defaultMessage:"Disconnect {integrationName}?"},complianceDisconnectModalSubtitle:{id:"complianceIntegrationSettings.disconnectModal.subtitle",defaultMessage:"Revoke {integrationName}’s access to this workspace. Workspace events will no longer be sent to {integrationName}."},complianceDisconnectSnackbar:{id:"complianceIntegrationSettings.snackbar.title",defaultMessage:"Disconnected {integrationName} from your workspace"}});function Oe(e){const{botIds:t,isLegacy:n,integrationId:i,integrationTable:s,disableDisallow:a}=e,l=(0,r().O$)(o().AppStoreSidebarSpaceStore),c=(0,r().O$)(o().AppStoreSidebarSpaceViewStore),d=tt();return(0,r().K8)((()=>{if(t&&t.length>0)return!0;if(n)return!0;if(l&&s===C().Li&&!(0,x().CX)({integrationId:i})){const t=l.getRecordModel({table:s,id:i});if(t){var e,o;const n=t;if(Boolean((null==n||null===(e=n.getInfo())||void 0===e?void 0:e.website_url)||(null==n||null===(o=n.getInfo())||void 0===o?void 0:o.email)))return!0}}if(l&&!a){const e=l.getBotSettings();if((0,je().az)(e))return!0}return!1}),[l,t,n,i,s,a])&&l&&c?(0,de.jsx)(F().A,{popupType:W().A.isMobile?F().z.BottomSheet:F().z.Popup,renderOrigin:e=>(0,de.jsx)(le().A,{...e,isMobile:W().A.isMobile,style:d.actionMenuButton}),render:()=>(0,de.jsx)(ze,{...e,sidebarSpaceStore:l,sidebarSpaceViewStore:c})}):null}function ze(e){const{integrationId:t,integrationTable:n,isLegacy:o,disableDisconnectUser:s,disableDisconnectAll:l,disableDisallow:c,botIds:d,sidebarSpaceStore:p,sidebarSpaceViewStore:u}=e,m=(0,a().v3)(),h=(0,B().tz)(),f=tt(),[y,b]=(0,i.useState)(void 0),[v,S]=(0,i.useState)(!1),[j,w]=(0,i.useState)(!1),[T,P]=(0,i.useState)(!1),[N,_]=(0,i.useState)(void 0),[D,E]=(0,i.useState)(!1),L=(0,r().K8)((()=>!o&&n===C().Li&&!(0,x().CX)({integrationId:t})),[o,n,t]),O=(0,r().K8)((()=>p&&n?(0,ve().v3)(p,{table:n,id:t}):void 0),[p,t,n]),z=(0,r().K8)((()=>{if(o){const e=A().Gw.find((e=>e.id===t));return{name:null==e?void 0:e.name,url:(0,Ne().x)("guides.connectedApps")}}if(p&&n){const o=p.getRecordModel({table:n,id:t});if(n===C().Li&&!(0,x().CX)({integrationId:t})){var e,i;const t=o;return{name:null==o?void 0:o.name,url:null==t||null===(e=t.getInfo())||void 0===e?void 0:e.website_url,email:null==t||null===(i=t.getInfo())||void 0===i?void 0:i.email}}return{name:null==o?void 0:o.name}}}),[p,t,n,o]),R=(0,r().K8)((()=>d&&!s?d.map((e=>p&&O?g().v.createChildStore(O,{table:I().GP,id:e,spaceId:p.id}):void 0)):[]),[p,d,O,s]).filter(k().O9),K=(0,r().K8)((()=>R.filter((e=>e.getAlive()))),[R]),F=(0,r().K8)((()=>L&&K.length>0?K[0]:void 0),[L,K]),[q]=(0,i.useState)((()=>U().Store.createValue({}))),H=L&&Boolean(F),$=ae({shouldCollectData:H,environment:m,sidebarSpaceStore:p,sidebarSpaceViewStore:u,botStore:F});(0,i.useEffect)((()=>{if(!$||"resolved"!==$.status&&"rejected"!==$.status)return;const e={};for(const t of $.pageIdsAlreadySharedWithBot)e[t]=!0;q.setState(e)}),[$,q]);const X=H&&$&&p&&F,Q=(0,r().K8)((()=>{if(p&&K&&!s){return K.map((e=>e.getCreatedById())).filter(k().O9).map((e=>Se().L.createChildStore(p,{table:M().oo,id:e}))).filter((e=>e.isDefined()))}return[]}),[K,p,s]),ee=(0,r().K8)((()=>null==p?void 0:p.getBotSettingsStore().getValue()),[p]),te=(0,r().K8)((()=>null==K?void 0:K.reduce(((e,t)=>{const n=Q.find((e=>e.id===t.getCreatedById()));return e[t.id]={userStore:n,botCapabilities:t.getCapabilities()},e}),{})),[K,Q]),ne=(0,r().K8)((()=>y?(0,Ie().Ay)(y,Object.entries(te),(([,{userStore:e}])=>e.getSearchName(h))):Object.entries(te)),[te,y,h]),ie=!s&&(null==d?void 0:d.length)&&(0,de.jsx)(J().A,{isInput:!0,style:{padding:8},children:(0,de.jsx)(Be().Ay,{textWrapperStyle:{margin:0},focus:!W().A.isMobile||void 0,focusAfterAnimation:!0,value:y||"",onChange:e=>b(e.target.value),placeholder:h.formatMessage(Le.userSearchPlaceholder)})}),oe=ne.length?[{key:"disconnect user section",render:e=>(0,de.jsx)(J().A,{...e}),items:We({users:ne,disableDisconnectUser:s,showDisplayModal:()=>w(!0),setSelectedUser:_,intl:h})}]:[],se=(null==z?void 0:z.url)||(null==z?void 0:z.email),le=Boolean(null==d?void 0:d.length)||(0,je().az)(ee)&&!c,ce=(0,de.jsxs)(de.Fragment,{children:[H?(0,de.jsx)(J().A,{topBorder:Boolean(ne.length),children:(0,de.jsx)(Ye,{onShowModal:()=>E(!0)})},"page-access"):void 0,se?(0,de.jsxs)(J().A,{topBorder:Boolean(ne.length||H),children:[null!=z&&z.url?(0,de.jsx)(Ue,{environment:m,developerWebsite:z.url}):void 0,null!=z&&z.email?(0,de.jsx)(Ve,{environment:m,developerEmail:z.email}):void 0]},"app-links"):void 0,le?(0,de.jsxs)(J().A,{topBorder:Boolean(ne.length||se||H),children:[Boolean(null==d?void 0:d.length)?(0,de.jsx)(Fe,{showDisplayModal:()=>P(!0)}):void 0,(0,je().az)(ee)&&!c?(0,de.jsx)(qe,{showDisplayModal:()=>S(!0)}):void 0]}):void 0]});return(se||le||H)&&z?(0,de.jsxs)(de.Fragment,{children:[(0,de.jsx)(G().A,{menuType:W().A.isMobile?Y().gu.ActionSheet:Y().gu.Popup,header:!s&&ie,footer:ce,width:230,children:(0,de.jsx)(Z().A,{type:Z().O.Vertical,sections:oe,initialFocus:void 0})}),(0,de.jsx)(V().a,{open:!s&&j,onDismiss:()=>{w(!1)},transitionAppearance:"none",showCloseIcon:!0,innerStyle:f.innerModal,render:()=>(0,de.jsx)(He,{title:(0,de.jsx)(Je,{integrationName:z.name}),caption:(0,de.jsx)(Qe,{integrationName:z.name,userName:null==N?void 0:N.userName}),type:"disconnect",handleCancel:()=>{w(!1),_(void 0)},handleConfirmation:async()=>{N&&(await Re({botIds:[N.botId],environment:m}),_(void 0)),w(!1)}})}),(0,de.jsx)(V().a,{open:!l&&T,onDismiss:()=>{P(!1)},transitionAppearance:"none",showCloseIcon:!0,innerStyle:f.innerModal,render:()=>(0,de.jsx)(He,{title:(0,de.jsx)(Xe,{integrationName:z.name}),caption:(0,de.jsx)(Ze,{integrationName:z.name}),type:"disconnect",handleCancel:()=>P(!1),handleConfirmation:async()=>{await Re({botIds:d,environment:m}),P(!1)}})}),(0,de.jsx)(V().a,{open:!c&&v,onDismiss:()=>{S(!1)},transitionAppearance:"none",showCloseIcon:!0,innerStyle:f.innerModal,render:()=>(0,de.jsx)(He,{title:(0,de.jsx)($e,{integrationName:z.name}),caption:(0,de.jsx)(Ge,{integrationName:z.name,disableDisconnectAll:l}),type:"disapprove",handleCancel:()=>S(!1),handleConfirmation:async()=>{!function(e){const{sidebarSpaceStore:t,environment:n,integrationId:i}=e;t&&Ee().createAndCommit({userAction:"AdminIntegrationSettingsActionMenu.handleDisapproveIntegration",environment:n,canUndo:!0,perform:e=>{Ee().applyOperation({store:t,operation:{pointer:t.pointer,path:["bot_settings","integration_approval_statuses"],command:"update",args:{[i]:null}},transaction:e})}})}({sidebarSpaceStore:p,environment:m,integrationId:t}),l||await Re({botIds:d,environment:m}),S(!1)}})}),X?(0,de.jsx)(re().r,{isOpen:D,onClose:()=>E(!1),pageIdsAlreadySharedWithBot:$.pageIdsAlreadySharedWithBot,teamPagesByTeam:$.pageSelectionData.teamPagesByTeam,allTeams:$.pageSelectionData.allTeams,privatePages:$.pageSelectionData.allPrivatePages,pagesSharedWithUser:$.pageSelectionData.allSharedPages,workspacePages:$.pageSelectionData.allWorkspacePages,spaceId:p.id,botStore:F,spaceStore:p,refetchBotSharedPages:$.refetchBotSharedPages,selectedBlockIdsStore:q,pagePickerLocation:"public_integration_page_picker",integrationManagementPermissions:$.integrationManagementPermissions}):void 0]}):null}async function Re({botIds:e,environment:t}){e&&await(0,Ce().lX)(e,5,(async e=>oe().KA({environment:t,botId:e,onSuccess:()=>{ie().hs(t,{type:"public"})}})))}function We(e){const{intl:t,disableDisconnectUser:n,users:i,showDisplayModal:o,setSelectedUser:s}=e;return n?[]:i.map((([e,{userStore:n,botCapabilities:i}])=>({key:n.id,render:a=>(0,de.jsx)(Ke,{buttonMenuProps:a,userStore:n,botCapabilities:i,selectAction:()=>{o(),s({botId:e,userName:n.getDisplayName(t)})}}),action:()=>{o(),s({botId:e,userName:n.getDisplayName(t)})}})))}function Ke(e){const{buttonMenuProps:t,userStore:n,botCapabilities:o,selectAction:s}=e,[a,r]=(0,i.useState)(!1);return(0,de.jsx)(Ae().zD,{popupType:W().A.isMobile?F().z.BottomSheet:F().z.Popup,placementToOrigin:"right",open:a,onDismiss:()=>r(!1),origin:(0,de.jsx)(X().A,{...t,title:(0,de.jsx)("div",{style:{display:"flex",alignContent:"center",justifyContent:"space-between"},children:(0,de.jsx)(Pe().A,{userStore:n,avatarSize:18,inline:!0,avatarShouldShowShadow:!0,style:{flexShrink:1},hasPersonHoverCard:!1})}),textWrapperStyle:{marginInlineStart:12,marginInlineEnd:12},focused:!1,onClick:()=>r(!0)}),render:()=>(0,de.jsx)(G().A,{width:240,menuType:W().A.isMobile?Y().gu.ActionSheet:Y().gu.Popup,header:(0,de.jsx)("div",{style:{padding:2,marginTop:4,marginBottom:4},children:(0,de.jsx)(Te,{capabilities:o})}),children:(0,de.jsx)(Z().A,{type:Z().O.Vertical,sections:[{key:"integration capabilities",render:e=>(0,de.jsx)(J().A,{...e,topBorder:!0}),items:[{key:"remove",render:e=>(0,de.jsx)(X().A,{...e,focused:!1,title:(0,de.jsx)("div",{style:{color:P().oZ.red},children:(0,de.jsx)(B().sA,{...Le.revokeUserAccess})})}),action:s}]}],initialFocus:void 0})})})}function Ue({environment:e,developerWebsite:t}){return(0,de.jsx)(X().A,{onClick:()=>{(0,_e().L)({environment:e,url:t}),ie().Vk(e,{href:t,from:"integration-settings"})},title:(0,de.jsx)(B().sA,{...Le.visitDeveloperWebsite}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginInlineStart:12,marginInlineEnd:12}})}function Ve({environment:e,developerEmail:t}){return(0,de.jsx)(X().A,{onClick:()=>{(0,_e().L)({environment:e,url:`mailto:${t}`}),ie().z$(e,{from:"integration-settings"})},title:(0,de.jsx)(B().sA,{...Le.contactDeveloperSupport}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginInlineStart:12,marginInlineEnd:12}})}function Fe({showDisplayModal:e}){return(0,de.jsx)(X().A,{onClick:e,title:(0,de.jsx)(B().sA,{...Le.disconnectAllUsers}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginInlineStart:12,marginInlineEnd:12,color:P().oZ.red}})}function qe({showDisplayModal:e}){return(0,de.jsx)(X().A,{onClick:e,title:(0,de.jsx)(B().sA,{...Le.removeFromApprovedList}),focused:!1,textWrapperStyle:{marginInlineStart:12,marginInlineEnd:12,color:P().oZ.red}})}function Ye({onShowModal:e}){return(0,de.jsx)(X().A,{onClick:e,title:(0,de.jsx)(B().sA,{...Le.selectPageAccess}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginInlineStart:12,marginInlineEnd:12}})}function He({title:e,caption:t,handleConfirmation:n,handleCancel:o,type:s}){const[a,r]=(0,i.useState)(!1);return(0,de.jsxs)("div",{style:{padding:20,width:333},children:[(0,de.jsx)(f().A,{isMultiline:!0,style:{marginBottom:8,fontWeight:_().Wy.semibold,paddingInlineEnd:30},children:e}),(0,de.jsx)(f().A,{isMultiline:!0,isSecondaryColor:!0,style:{marginBottom:8},children:t}),(0,de.jsxs)("div",{style:{display:"flex",marginTop:12},children:[(0,de.jsx)(H().A,{style:{width:140,marginInlineEnd:9},size:"lg",onClick:o,disabled:a,children:(0,de.jsx)(f().A,{children:(0,de.jsx)(B().sA,{...Le.cancelButton})})}),(0,de.jsx)($().A,{style:{width:140},size:"lg",onClick:async()=>await n(r),colorPalette:"red",disabled:a,children:(0,de.jsxs)(de.Fragment,{children:["disconnect"===s&&!0===a?(0,de.jsx)(m().A,{onDarkBackground:!0}):void 0,"disconnect"===s&&!1===a?(0,de.jsx)(B().sA,{...Le.disconnectButton}):void 0,"disapprove"===s?(0,de.jsx)(B().sA,{...Le.removeButton}):void 0]})})]})]})}function $e({integrationName:e}){return(0,de.jsx)(B().sA,{...Le.disapproveModalTitle,values:{integrationName:e}})}function Ge({integrationName:e,disableDisconnectAll:t}){return t?(0,de.jsx)(B().sA,{...Le.disapproveModalCaption,values:{integrationName:e}}):(0,de.jsx)(B().sA,{...Le.disapproveAndDisconnectCaption,values:{integrationName:e}})}function Xe({integrationName:e}){return(0,de.jsx)(B().sA,{...Le.disconnectAllModalTitle,values:{integrationName:e}})}function Ze({integrationName:e}){return(0,de.jsx)(B().sA,{...Le.disconnectAllModalCaption,values:{integrationName:e}})}function Je({integrationName:e}){return(0,de.jsx)(B().sA,{...Le.disconnectUserModalTitle,values:{integrationName:e}})}function Qe({integrationName:e,userName:t}){return(0,de.jsx)(B().sA,{...Le.disconnectUserModalCaption,values:{integrationName:e,userName:t}})}function et(e){const{adminIntegrationConfig:t,botId:n,maybeWebhookSubscriptionId:s}=e,l=(0,a().v3)(),[c,d]=(0,i.useState)(!1),g=tt(),p=(0,r().O$)(o().AppStoreSidebarSpaceStore),u=(0,r().K8)((()=>{const e=null==p?void 0:p.getRecordModel({table:I().GP,id:n});return null==e?void 0:e.getCapabilities()}),[p,n]),m=t.developer_name;if(!m)return null;const h=new(q().A),f={key:"manage",action:()=>{De().A.setState({open:!0,integrationId:t.id,webhookSubscriptionId:s}),h.setState({open:!1})},render:e=>(0,de.jsx)(X().A,{...e,title:(0,de.jsx)(B().sA,{...Le.complianceManage})})},y={key:"learn more",action:()=>{(0,_e().L)({environment:l,url:t.integrationGalleryUrl})},render:e=>(0,de.jsx)(X().A,{...e,title:(0,de.jsx)(B().sA,{...Le.complianceLearnMore})})},b={key:"disconnect",action:()=>{h.setState({open:!1}),d(!0)},render:e=>(0,de.jsx)(X().A,{...e,title:(0,de.jsx)("span",{style:g.disconnect,children:(0,de.jsx)(B().sA,{...Le.complianceDisconnect})})})},x=[...t.oauth||(0,Q().qs)(u)||(0,T().jl)(t.id)?[]:[f],...t.oauth||(0,Q().qs)(u)?[y]:[],b];return(0,de.jsxs)(de.Fragment,{children:[(0,de.jsx)(F().A,{popupType:W().A.isMobile?F().z.BottomSheet:F().z.Popup,renderOrigin:e=>(0,de.jsx)(le().A,{...e,isMobile:W().A.isMobile,style:{marginInlineStart:8,marginInlineEnd:8}}),buttonPopupStore:h,render:()=>(0,de.jsx)(G().A,{menuType:W().A.isMobile?Y().gu.ActionSheet:Y().gu.Popup,width:230,children:(0,de.jsx)(Z().A,{type:Z().O.Vertical,sections:[{key:"options",render:e=>(0,de.jsx)(J().A,{...e}),items:x}],initialFocus:void 0})})}),(0,de.jsx)(V().a,{open:c,onDismiss:()=>d(!1),transitionAppearance:"none",showCloseIcon:!0,innerStyle:g.innerModal,render:()=>(0,de.jsx)(He,{title:(0,de.jsx)(B().sA,{...Le.complianceDisconnectModalTitle,values:{integrationName:m}}),caption:(0,de.jsx)(B().sA,{...Le.complianceDisconnectModalSubtitle,values:{integrationName:m}}),type:"disconnect",handleCancel:()=>d(!1),handleConfirmation:async()=>{await oe().KA({environment:l,botId:n,onSuccess:()=>{}}),ie().kV(l,{integration_id:t.id}),xe().D6({label:(0,de.jsx)(B().sA,{...Le.complianceDisconnectSnackbar,values:{integrationName:m}})})}})})]})}function tt(){return(0,l().IS)((()=>({disconnect:{color:P().oZ.red},innerModal:{borderRadius:10},actionMenuButton:{marginInlineStart:8,marginInlineEnd:8}})),[])}const nt=(0,B().YK)({integrationTypePillAutomationAction:{id:"spaceIntegrationSettings.integrationTable.pillLabel.automation_action",defaultMessage:"Automation Action"},integrationTypePillInternal:{id:"spaceIntegrationSettings.integrationTable.pillLabel.internal",defaultMessage:"Internal"},integrationTypePillSync:{id:"spaceIntegrationSettings.integrationTable.pillLabel.sync",defaultMessage:"Sync"},integrationTypePillLinkPreview:{id:"spaceIntegrationSettings.integrationTable.pillLabel.preview",defaultMessage:"Link Preview"},integrationTypePillImporter:{id:"spaceIntegrationSettings.integrationTable.pillLabel.importer",defaultMessage:"Importer"},integrationTypePillDlp:{id:"spaceIntegrationSettings.integrationTable.pillLabel.dlp",defaultMessage:"DLP"},integrationTypePillSiem:{id:"spaceIntegrationSettings.integrationTable.pillLabel.siem",defaultMessage:"SIEM"},integrationTypePillEDiscovery:{id:"spaceIntegrationSettings.integrationTable.pillLabel.ediscovery",defaultMessage:"eDiscovery"},integrationTypePillAiConnector:{id:"spaceIntegrationSettings.integrationTable.pillLabel.aiConnector",defaultMessage:"AI connector"},connectionsColumnTitle:{id:"spaceConnectionsSettings.connectionsTable.connectionsColumn.title",defaultMessage:"Connection"},creationInfoColumnTitle:{id:"spaceConnectionsSettings.connectionsTable.creationInfoColumn.title",defaultMessage:"Users and access"},integrationTableEmptyMessage:{id:"spaceIntegrationSettings.integrationTable.emptyTable.message",defaultMessage:"No integration installed"},complianceConnectionsColumnTitle:{id:"spaceConnectionsSettings.complianceConnectionsTable.connectionsColumn.title",defaultMessage:"Connection"},complianceIntegrationEditorColumnTitle:{id:"spaceConnectionsSettings.complianceConnectionsTable.integrationEditorColumn.title",defaultMessage:"Edited by"},complianceIntegrationDateLastEditedTitle:{id:"spaceConnectionsSettings.complianceConnectionsTable.integrationDateLastEdited.title",defaultMessage:"Edited on"},installerInfoLegacy:{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.legacy",defaultMessage:"Notion Connected App"},webhookError:{id:"workspaceIntegrationSettings.integrationTable.titleColumn.webhookError",defaultMessage:"Webhook error"},betaBadgeLabel:{id:"betaBadgeComponentInAdminSettings.label",defaultMessage:"Beta"},installerInfoNotion:{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.notionLabel",defaultMessage:"Notion{nbsp}{icon}"},installerInfoNotionTooltip:{id:"spaceIntegrationSettings.integrationTable.installerInfo.notion.tooltip",defaultMessage:"Developed by Notion"},unverifiedDeveloper:{id:"spaceIntegrationSettings.integrationTable.label.unverifiedDeveloper",defaultMessage:"Unverified developer"},installerInfoAnyone:{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.anyoneInSpace",defaultMessage:"Anyone in{nbsp}{spaceName}"},installerInfoNoUsers:{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.noUsers",defaultMessage:"No users"},installerInfoListOfUsers:{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.listOfUsers",defaultMessage:"{remainingCount, plural, =0 {{firstUser}} one {{firstUser} +{remainingCount}} other {{firstUser} +{remainingCount}}}"}}),it={automation_action:(0,de.jsx)(B().sA,{...nt.integrationTypePillAutomationAction}),internal:(0,de.jsx)(B().sA,{...nt.integrationTypePillInternal}),databaseSync:(0,de.jsx)(B().sA,{...nt.integrationTypePillSync}),linkPreview:(0,de.jsx)(B().sA,{...nt.integrationTypePillLinkPreview}),importer:(0,de.jsx)(B().sA,{...nt.integrationTypePillImporter}),dlp:(0,de.jsx)(B().sA,{...nt.integrationTypePillDlp}),siem:(0,de.jsx)(B().sA,{...nt.integrationTypePillSiem}),ediscovery:(0,de.jsx)(B().sA,{...nt.integrationTypePillEDiscovery}),aiConnector:(0,de.jsx)(B().sA,{...nt.integrationTypePillAiConnector})};function ot(e){const{integrationIdToBotIds:t,internalIntegrationIds:n,integrationIdToUserSummaries:s}=e,a=(0,r().O$)(o().AppStoreSidebarSpaceStore),l=(0,r().K8)((()=>null==a?void 0:a.getBotSettingsStore().getValue()),[a]),d="approved_or_built_by_notion"===(null==l?void 0:l.integration_restrictions),g=(0,r().K8)((()=>(0,be().yP)()),[]),p=Boolean(null==l?void 0:l.integration_restrictions),u=(0,i.useMemo)((()=>null!=l&&l.integration_approval_statuses?Object.keys(l.integration_approval_statuses):[]),[l]),m=u.filter((e=>!Object.keys(t).includes(e)&&!A().Ei.includes(e)&&e!==j().A)),h=(0,r().K8)((()=>null==a?void 0:a.id),[a]),y=(0,r().K8)((()=>c().bM.getMcpConfig().isAllowlistFeatureEnabled),[]),b=(0,i.useMemo)((()=>t?Object.entries(t).filter((([e])=>!(y&&e===j().A))).map((([e,t])=>at({integrationPointer:{table:C().Li,id:e},userSummary:s[e],botIds:t,autoApproveBuiltByNotion:d}))):[]),[t,s,d,y]),x=h?n.map((e=>at({integrationPointer:{table:I().GP,id:e,spaceId:h},userSummary:s[e],botIds:[e]}))):[],v=p?m.map((e=>at({integrationPointer:{table:C().Li,id:e},userSummary:void 0,botIds:[],autoApproveBuiltByNotion:d}))):[],S=(0,r().K8)((()=>{if(y)return!1;const e=!Object.keys(t).includes(j().A),n=u.includes(j().A),i=!(null!=l&&l.integration_restrictions),o=null==a?void 0:a.getRecordModel({table:C().Li,id:j().A});return e&&(d||n||i)&&o}),[a,t,d,u,null==l?void 0:l.integration_restrictions,y])?[rt({autoApproveBuiltByNotion:d,userSummary:s[j().A]})]:[],M=A().Gw.filter((e=>u.includes(e.id)&&e.id===A().Jc&&g)).map((e=>function(e){const{legacyIntegration:t}=e,{id:n,name:i,info:o}=t;return{key:n,columns:[(0,de.jsxs)("div",{style:{display:"flex",alignItems:"center",maxWidth:300},children:[(0,de.jsx)("img",{src:o.icon,style:{height:28}}),(0,de.jsxs)("div",{style:{minWidth:0,marginInlineStart:15},children:[(0,de.jsx)("div",{style:{display:"flex"},children:(0,de.jsx)(f().A,{children:i})}),(0,de.jsx)(f().A,{isSmall:!0,style:{display:"flex"},children:(0,de.jsx)(B().sA,{...nt.installerInfoLegacy})})]})]},0),(0,de.jsx)(mt,{userSummary:void 0,displayUsers:!1},1),(0,de.jsx)("div",{children:(0,de.jsx)(Oe,{integrationId:n,isLegacy:!0,disableDisconnectAll:!0,disableDisconnectUser:!0})},2)]}}({botSettings:l,legacyIntegration:e}))),w=b.length+x.length+v.length+S.length+M.length;return(0,de.jsxs)(de.Fragment,{children:[(0,de.jsx)(ye().A,{columns:[{key:"integration",header:(0,de.jsx)(B().sA,{...nt.connectionsColumnTitle}),style:{width:"40%"}},{key:"added_by",header:(0,de.jsx)(B().sA,{...nt.creationInfoColumnTitle})},{key:"more",header:void 0,style:{width:"5%"}}],rows:[...b,...x,...v,...S,...M]}),0===w?(0,de.jsx)("div",{style:{height:120,width:"100%",fontSize:12,color:P().Tj.text.tertiary,display:"flex",alignItems:"center",justifyContent:"center",borderBottom:`1px solid ${P().Tj.border.secondaryTranslucent}`},children:(0,de.jsx)(B().sA,{...nt.integrationTableEmptyMessage})}):void 0]})}function st(e){const{botIdToWebhookSubscriptionId:t,complianceIntegrationsIdToBotIds:n}=e,i=(0,l().IS)((()=>({emptyTable:{height:120,width:"100%",fontSize:12,color:P().Tj.text.tertiary,display:"flex",alignItems:"center",justifyContent:"center",borderBottom:`1px solid ${P().Tj.border.secondaryTranslucent}`}})),[]),s=(0,r().O$)(o().AppStoreSidebarSpaceStore),a=(0,r().K8)((()=>{if(!s)return[];return Object.entries(n).flatMap((([e,n])=>n.map((n=>{const i=g().v.createChildStore(s,{table:I().GP,id:n,spaceId:s.id});return{integrationPointer:{table:C().Li,id:e},botId:n,lastEditedAt:Number(i.getLastEditedAt()),lastEditedByPointer:i.getLastEditedByPointer(),webhookSubscriptionId:t[n]}})))).filter(k().O9)}),[t,s,n]).map((e=>function(e){const{integrationPointer:t,lastEditedAt:n,lastEditedByPointer:i,botId:o,webhookSubscriptionId:s}=e,a=t.id,r=(0,T().Q2)(a);if(!r)return;const l=T().lW[r];if(!l)return;return{key:`${a}:${o}`,columns:[(0,de.jsx)(lt,{integrationTable:C().Li,integrationId:a,maybeWebhookSubscriptionId:s},"integration-title"),(0,de.jsx)(pt,{editedByPointer:i},"integration-edited-by"),(0,de.jsx)(ut,{lastEditedOn:n},"integration-last-edited-on"),(0,de.jsx)(et,{adminIntegrationConfig:l,maybeWebhookSubscriptionId:s,botId:o},"integration-menu")]}}(e))).filter(k().O9);return(0,de.jsxs)(de.Fragment,{children:[(0,de.jsx)(ye().A,{columns:[{key:"integration",header:(0,de.jsx)(B().sA,{...nt.complianceConnectionsColumnTitle}),style:{width:"30%"}},{key:"integration-edited-by",header:(0,de.jsx)(B().sA,{...nt.complianceIntegrationEditorColumnTitle}),style:{width:"30%"}},{key:"integration-edited-on",header:(0,de.jsx)(B().sA,{...nt.complianceIntegrationDateLastEditedTitle})},{key:"more",header:void 0,style:{width:"5%"}}],rows:a,tableStyle:{borderTop:"none"}}),0===a.length?(0,de.jsx)("div",{style:i.emptyTable,children:(0,de.jsx)(B().sA,{...nt.integrationTableEmptyMessage})}):void 0]})}function at(e){const{integrationPointer:t,userSummary:n,botIds:i,autoApproveBuiltByNotion:o}=e;if(t.table===C().Li){const e=t.id,s=(0,x().CX)({integrationId:e})&&!(0,j().Y)(e);return{key:e,columns:[(0,de.jsx)(lt,{integrationTable:C().Li,integrationId:e},"integration-title"),(0,de.jsx)(mt,{userSummary:n,displayUsers:!s},"integration-installer-info"),(0,de.jsx)(Oe,{integrationId:e,integrationTable:C().Li,botIds:i,disableDisconnectUser:s||void 0,disableDisallow:s&&o},"admin-integration-settings-menu")]}}if(t.table===I().GP)return{key:t.id,columns:[(0,de.jsx)(lt,{integrationTable:I().GP,integrationId:t.id},"integration-title"),(0,de.jsx)(mt,{userSummary:n,displayUsers:!1},"integration-installer-info"),(0,de.jsx)(pe,{botId:t.id},"integration-settings-menu")]};(0,k().HB)(t)}function rt(e){const{autoApproveBuiltByNotion:t,userSummary:n}=e;return{key:j().A,columns:[(0,de.jsx)(lt,{integrationTable:C().Li,integrationId:j().A},"integration-title"),(0,de.jsx)(mt,{userSummary:n,displayUsers:!0},"integration-installer-info"),(0,de.jsx)(Oe,{integrationId:j().A,integrationTable:C().Li,botIds:[],disableDisconnectUser:void 0,disableDisallow:t},"admin-integration-settings-menu")]}}function lt(e){const{integrationId:t,integrationTable:n,maybeWebhookSubscriptionId:i}=e,s=(0,r().O$)(o().AppStoreSidebarSpaceStore),a=(0,r().K8)((()=>{if(s)return s.getRecordModel({table:n,id:t})}),[s,t,n]),l=(0,r().K8)((()=>{var e;if(s&&i)return null===(e=s.getRecordModel({table:w().TF,id:i,spaceId:s.id}))||void 0===e?void 0:e.getHealth()}),[s,i]),[c,d,g,p,h]=(0,r().K8)((()=>{if(!a)return[];let e,i=!1;const o=[];let s;if(n===I().GP){const i=a;i.icon&&(e={pointer:{table:n,id:t},icon:i.icon}),o.push("internal"),s=(0,de.jsx)(ct,{botId:i.id})}else if(n===C().Li){const r=a,l=r.getInfo();l.icon&&(e={pointer:{table:n,id:t},icon:l.icon}),(0,A().Hy)(r)&&(o.push("linkPreview"),(0,A().Z1)(r)&&o.push("databaseSync")),(0,x().MF)(r)&&(i=!0),s=(0,T().NV)(r.id)?null:(0,de.jsx)(dt,{integrationId:r.id})}else(0,k().HB)(n);return[null==a?void 0:a.name,i,e,o,s]}),[n,t,a]);if(!a||!p)return(0,de.jsx)(m().k,{});let y=null;var b;return b=l,(0,k().O9)(b)&&"active"!==b.status&&(y=(0,de.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:3},children:[(0,de.jsx)(u().I,{icon:S().exclamationMarkTriangleFillSmallIcon,size:"sm",colorPalette:"red",colorVariant:"accentPrimary"}),(0,de.jsx)(f().A,{isSmall:!0,style:{color:N().$.light.red[500]},children:(0,de.jsx)(B().sA,{...nt.webhookError})})]})),(0,de.jsxs)("div",{style:{display:"flex",alignItems:"center",maxWidth:300},children:[(0,de.jsx)(E().B6,{disabled:!0,icon:g,iconRecordCategory:"workspace",title:c,isEmptyPage:!1,size:28,isLarge:!0,useInvertedColors:!0}),(0,de.jsxs)("div",{style:{minWidth:0,marginInlineStart:15},children:[(0,de.jsxs)("div",{style:{display:"flex",marginInlineEnd:16,overflow:"hidden"},children:[(0,de.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,de.jsx)(f().A,{children:c}),y]}),d?(0,de.jsx)(D().A,{desktopStyle:{marginInlineStart:4},innerStyle:{color:P().Tj.blue.text.accentPrimary},children:(0,de.jsx)(B().sA,{...nt.betaBadgeLabel})}):void 0,p.map((e=>e&&(0,de.jsx)(D().A,{desktopStyle:{marginInlineStart:4},children:it[e]},e)))]}),h]})]})}function ct({botId:e}){const t=(0,r().O$)(o().AppStoreSidebarSpaceStore),n=(0,B().tz)(),i=(0,r().K8)((()=>null==t?void 0:t.getRecordModel({table:I().GP,id:e})),[t,e]),s=(0,r().K8)((()=>{if(!t||!i)return;const e=t.getRecordModel(i.getCreatedByPointer());return(0,y().lR)(n,e)}),[t,i,n]);return s?(0,de.jsx)(f().A,{className:"notranslate",isSmall:!0,children:s}):(0,de.jsx)(gt,{})}function dt({integrationId:e}){const t=(0,r().O$)(o().AppStoreSidebarSpaceStore),n=(0,r().K8)((()=>{const n=null==t?void 0:t.getRecordModel({table:C().Li,id:e});if("internal"!==(null==n?void 0:n.type))return null==n?void 0:n.getInfo().developer_name}),[t,e]);return(0,x().CX)({integrationId:e})?(0,de.jsx)(f().A,{isSmall:!0,style:{display:"flex",alignItems:"center"},children:(0,de.jsx)(B().sA,{...nt.installerInfoNotion,values:{nbsp:(0,de.jsx)(de.Fragment,{children:" "}),icon:(0,de.jsx)(h().m,{renderTooltip:()=>(0,de.jsx)("div",{children:(0,de.jsx)(B().sA,{...nt.installerInfoNotionTooltip})}),placement:"right",render:e=>(0,de.jsx)("div",{...e,children:(0,de.jsx)(u().I,{icon:v().checkmarkShieldFillSmallIcon,size:"sm",colorPalette:"green",colorVariant:"accentPrimary"})})})}})}):n?(0,de.jsx)(f().A,{className:"notranslate",isSmall:!0,children:n}):(0,de.jsx)(gt,{})}function gt(){return(0,de.jsx)(f().A,{isSmall:!0,children:(0,de.jsx)(B().sA,{...nt.unverifiedDeveloper})})}function pt(e){const{editedByPointer:t}=e,n=(0,B().tz)(),i=(0,r().K8)((()=>{const e=(0,s().S)();if(e&&t)return e.getRecordModel(t)}),[t]),o=(0,r().K8)((()=>{if(i)return(0,y().lR)(n,i)}),[i,n]),a=(null==i?void 0:i.table)===M().oo;return o?(0,de.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",gap:8,alignItems:"center",width:"100%"},children:[a&&i?(0,de.jsx)(O().A,{userStore:i,size:18}):null,(0,de.jsx)(f().A,{children:o})]}):null}function ut(e){const{lastEditedOn:t}=e;return void 0===t?null:(0,de.jsx)(L().s7,{useThinTitle:!0,title:(0,b().W_)(t,"long",d().locale)})}function mt(e){const{userSummary:t,displayUsers:n}=e,i=(0,B().tz)(),s=(0,r().O$)(o().AppStoreSidebarSpaceStore),l=(0,a().v3)(),c=(0,r().K8)((()=>{if(s)return(0,p().G)(l,s)}),[l,s]),d=null==t?void 0:t.totalUserCount,g=null==t?void 0:t.firstUserStore,u=(0,r().K8)((()=>null==g?void 0:g.getDisplayName(i)),[g,i]);return n&&void 0!==d?g?(0,de.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,de.jsx)(O().A,{userStore:g,avatarShouldShowShadow:!0,style:{marginInlineEnd:8},size:28}),(0,de.jsx)(f().A,{children:(0,de.jsx)(B().sA,{...nt.installerInfoListOfUsers,values:{firstUser:u,remainingCount:d?d-1:0}})})]}):(0,de.jsx)(f().A,{isSecondaryColor:!0,style:{display:"flex",alignItems:"center"},children:(0,de.jsx)(B().sA,{...nt.installerInfoNoUsers})}):(0,de.jsx)(f().A,{style:{display:"flex",alignItems:"center"},children:(0,de.jsx)(B().sA,{...nt.installerInfoAnyone,values:{nbsp:(0,de.jsx)(de.Fragment,{children:" "}),spaceName:(0,de.jsx)(f().A,{style:{fontWeight:_().Wy.medium},children:c})}})})}},817087:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>i,squareGrid2X2SmallIcon:()=>o});n(296540);const i={viewBox:"0 0 16 16",fittedViewBox:"1.77 2.57 12.46 10.86",svg:(0,n(474848).jsx)("path",{d:"M3.2 2.575c-.787 0-1.425.638-1.425 1.425v2c0 .787.638 1.425 1.425 1.425H6c.787 0 1.425-.638 1.425-1.425V4c0-.787-.638-1.425-1.425-1.425zM3.025 4c0-.097.079-.175.175-.175H6c.097 0 .175.078.175.175v2A.175.175 0 0 1 6 6.175H3.2A.175.175 0 0 1 3.025 6zM10 2.575c-.787 0-1.425.638-1.425 1.425v2c0 .787.638 1.425 1.425 1.425h2.8c.787 0 1.425-.638 1.425-1.425V4c0-.787-.638-1.425-1.425-1.425zM9.825 4c0-.097.078-.175.175-.175h2.8c.097 0 .175.078.175.175v2a.175.175 0 0 1-.175.175H10A.175.175 0 0 1 9.825 6zM3.2 8.575c-.787 0-1.425.638-1.425 1.425v2c0 .787.638 1.425 1.425 1.425H6c.787 0 1.425-.638 1.425-1.425v-2c0-.787-.638-1.425-1.425-1.425zM3.025 10c0-.097.079-.175.175-.175H6c.097 0 .175.078.175.175v2a.175.175 0 0 1-.175.175H3.2A.175.175 0 0 1 3.025 12zM10 8.575c-.787 0-1.425.638-1.425 1.425v2c0 .787.638 1.425 1.425 1.425h2.8c.787 0 1.425-.638 1.425-1.425v-2c0-.787-.638-1.425-1.425-1.425zM9.825 10c0-.097.078-.175.175-.175h2.8c.097 0 .175.078.175.175v2a.175.175 0 0 1-.175.175H10A.175.175 0 0 1 9.825 12z"})},o=(0,n(340498).wt)("squareGrid2X2Small",i,"small")},888526:(e,t,n)=>{n.d(t,{A:()=>a});var i=()=>n(140934);class o extends(()=>n(757695))().Store{constructor(...e){super(...e),this.integrations=new(i().ComputedStore)((()=>{const e=this.state;return e.loaded?e.integrations:[]}),{debugName:"ComplianceIntegrationStore.integrations"}),this.webhookSubscriptions=new(i().ComputedStore)((()=>{const e=this.state;return e.loaded?e.webhookSubscriptions:[]}),{debugName:"ComplianceIntegrationStore.webhookSubscriptions"})}getInitialState(){return{loaded:!1,loading:!1}}}const s=new o;(0,n(852832).exposeDebugValue)("ComplianceIntegrationStore",s);const a=s},949734:(e,t,n)=>{n.d(t,{W:()=>f});n(296540);var i=()=>n(59226),o=()=>n(484714),s=()=>n(699143),a=()=>n(552712),r=()=>n(631524),l=()=>n(663247),c=()=>n(721479),d=()=>n(534842),g=()=>n(427704),p=()=>n(69708),u=()=>n(559926),m=()=>n(232930),h=n(474848);function f(){const e=(0,o().v3)(),t=(0,i().X)("notion_ai_workspace_settings");return(0,h.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[(0,h.jsx)(a().N,{style:{display:"flex",marginInlineStart:-6},className:"notion-print-ignore",href:`${g().JZ.integrations}/all`,external:!0,onClick:()=>{u().j5(e,{from:"integration-settings",href:`${g().JZ.integrations}/all`})},children:(0,h.jsx)(r().p,{iconLeading:l().arrowDiagonalUpRightFillIcon,size:"sm",colorVariant:"tertiary",children:(0,h.jsx)(p().sA,{id:"connectionsSettingsLinks.connectionsGallery",defaultMessage:"Browse connections in Gallery"})})}),(0,h.jsx)(a().N,{style:{display:"flex",marginInlineStart:-6},className:"notion-print-ignore",href:g().JZ.creatorProfileIntegrations,external:!0,onClick:()=>{u().yQ(e,{from:"integration-settings",href:g().JZ.creatorProfileIntegrations})},children:(0,h.jsx)(r().p,{iconLeading:l().arrowDiagonalUpRightFillIcon,size:"sm",colorVariant:"tertiary",children:(0,h.jsx)(s().Y1,{direction:"horizontal",width:"hug",children:(0,h.jsx)(p().sA,{id:"connectionsSettingsLinks.manageConnections",defaultMessage:"Develop or manage integrations"})})})}),(0,h.jsx)(a().N,{style:{display:"flex",marginInlineStart:-6},className:"notion-print-ignore",href:(0,m().x)("guides.publicAPI"),external:!0,children:(0,h.jsx)(r().p,{iconLeading:c().questionMarkCircleSmallIcon,size:"sm",colorVariant:"tertiary",children:(0,h.jsx)(p().sA,{id:"connectionsSettingsLinks.helpCenter",defaultMessage:"Learn more about connections"})})}),t?void 0:(0,h.jsx)(a().N,{style:{display:"flex",marginInlineStart:-6},className:"notion-print-ignore",href:(0,m().x)("guides.aiConnectors"),external:!0,children:(0,h.jsx)(r().p,{iconLeading:d().sparklesFillSmallIcon,size:"sm",colorVariant:"tertiary",children:(0,h.jsx)(p().sA,{id:"connectionsSettingsLinks.aiConnectorsHelpCenter",defaultMessage:"Notion AI connectors"})})})]})}},955054:(e,t,n)=>{n.d(t,{A:()=>o});class i extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}}const o=new i},960521:(e,t,n)=>{n.d(t,{e:()=>Ve,s:()=>Ye});n(944114),n(898992),n(354520),n(672577),n(581454);var i=n(296540),o=()=>n(907258),s=()=>n(242422),a=()=>n(484714),r=()=>n(590526),l=()=>n(611648),c=()=>n(442610),d=()=>n(365917),g=()=>n(891317),p=()=>n(792057),u=()=>n(457205),m=()=>n(983610),h=()=>n(98126),f=()=>n(148307),y=()=>n(799288),b=()=>n(617871),x=()=>n(187174),v=()=>n(388693),S=()=>n(45331),A=()=>n(824862),j=()=>n(96689),I=()=>n(322769),C=()=>n(20498),M=()=>n(69708),w=()=>n(496603),k=()=>n(534177),T=()=>n(559926),B=()=>n(908928),P=()=>n(566254),N=()=>n(510683),_=()=>n(483979),D=()=>n(604018);n(737550);var E=()=>n(310001),L=()=>n(272509),O=()=>n(726637),z=()=>n(651784),R=()=>n(939768),W=()=>n(496414),K=()=>n(61958),U=()=>n(725951);const V=new(n(118307).A),F=(0,M().YK)({authenticatingWithAsana:{id:"asanaActions.authenticatingWithAsana.loadingMessage",defaultMessage:"Authenticating with Asana…"},titleMessage:{defaultMessage:"Asana login",id:"asanaActions.loginWithAsanaPopupModal.title"}});var q=()=>n(137432),Y=()=>n(755934),H=()=>n(964556),$=()=>n(251126),G=()=>n(974679),X=()=>n(949734),Z=()=>n(376254),J=()=>n(8178),Q=(n(430670),()=>n(564884)),ee=()=>n(401497),te=()=>n(699143),ne=()=>n(807449),ie=()=>n(695115),oe=()=>n(416783),se=()=>n(493552),ae=()=>n(879765),re=()=>n(116089),le=()=>n(85314),ce=()=>n(100622),de=()=>n(284371),ge=()=>n(968021),pe=()=>n(232930),ue=()=>n(752860);const me={currentPage:"home",setPage:()=>{}},he=(0,i.createContext)(me);he.displayName="UserConnectionsSettingsPageContext";var fe=n(474848);const ye=(0,M().YK)({mcpSettingsTitle:{id:"userConnectionsSettings.mcpSettingsTitle",defaultMessage:"Notion MCP"},connectMcpTitle:{id:"userConnectionsSettings.connectMcpTitle",defaultMessage:"External AI tools"},connectMcpDescription:{id:"userConnectionsSettings.connectMcpDescription",defaultMessage:"Use Notion MCP to connect Notion to your favorite AI tools to search, write, and keep everything up to date. <learnmore>Learn more</learnmore>"},otherCardName:{id:"userConnectionsSettings.otherCardName",defaultMessage:"Other AI tools"},otherCardCaption:{id:"userConnectionsSettings.otherCardCaption",defaultMessage:"Search and update Notion via AI tools using authenticated MCP"}});function be(e,t){(0,Q().u)({environment:e,event:{eventName:"mcp_connection_settings_app_clicked",eventProperties:{mcp_client:t}}})}function xe(e){const{icon:t,title:n}=e;return(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[(0,fe.jsx)(ne().I,{icon:t}),(0,fe.jsx)("div",{style:{fontSize:ge().Mi,fontWeight:de().Wy.medium},children:n})]})}function ve(){const{setPage:e}=(0,i.useContext)(he),t=(0,a().v3)(),n=(0,M().tz)(),o=function(e,t){const n=(0,le().wr)().flatMap((n=>{if(n.hidden)return[];const{connectUrl:i,captionMessageId:o,icon:s,trackingId:a}=n,r=o&&void 0!==le().mh[o];if(!(i&&a&&s&&r))return[];const l=t.formatMessage(le().mh[o]);return[{id:`mcp_${a}`,caption:l,account:void 0,canSelectPageAccess:!1,onConnect(){be(e,a),(0,ue().L)({environment:e,url:i})},onDisconnect(){},logo:(0,fe.jsx)(xe,{icon:n.icon??re().x,title:n.displayName}),width:"auto",capabilities:(0,fe.jsx)("div",{style:{display:"none"}})}]}));return n.push({id:"mcp_other",caption:t.formatMessage(ye.otherCardCaption),account:void 0,canSelectPageAccess:!1,onConnect(){be(e,"other"),(0,ue().L)({environment:e,url:(0,pe().x)("guides.mcpConnect")})},onDisconnect(){},logo:(0,fe.jsx)(xe,{icon:re().x,title:t.formatMessage(ye.otherCardName)}),width:"auto",showExploreButton:!0,capabilities:(0,fe.jsx)("div",{style:{display:"none"}})}),n}(t,n),s=(0,ee().IS)((()=>({pageHeader:{marginBottom:24},backButton:{marginInlineEnd:6},connectionsSectionTitle:{marginBottom:6},connectionsSectionSubtitle:{marginBottom:24,color:ce().Tj.text.secondary,fontSize:13}})),[]);return(0,fe.jsxs)(te().Y1,{height:"fill",direction:"vertical",padding:"36px 60px",children:[(0,fe.jsxs)(J().A,{large:!O().A.isMobile,divider:"full",fontSize:16,fontWeight:de().Wy.medium,style:s.pageHeader,children:[(0,fe.jsx)(ie().A,{ariaLabel:n.formatMessage({id:"userConnectionsSettingsPageHeader.back",defaultMessage:"Back"}),icon:ae().$,style:s.backButton,onClick:()=>e("home")}),n.formatMessage(ye.mcpSettingsTitle)]}),(0,fe.jsx)(G().A,{apps:o,numberOfConnectedApps:o.length,numberOfDisplayRows:2,title:(0,fe.jsx)(J().A,{style:s.connectionsSectionTitle,children:(0,fe.jsx)(M().sA,{...ye.connectMcpTitle})}),subtitle:(0,fe.jsx)(se().D,{style:s.connectionsSectionSubtitle,children:(0,fe.jsx)(M().sA,{...ye.connectMcpDescription,values:{learnmore:e=>(0,fe.jsx)(oe().V,{href:(0,pe().x)("guides.mcpHelp"),external:!0,onClick:e=>e.stopPropagation(),children:e})}})})})]})}n(803949);var Se=()=>n(302501),Ae=()=>n(187820),je=()=>n(317182),Ie=()=>n(757695),Ce=()=>n(250910),Me=()=>n(546926),we=()=>n(890492),ke=()=>n(81068),Te=()=>n(663639),Be=()=>n(736847),Pe=()=>n(593781),Ne=()=>n(723786),_e=()=>n(923455),De=()=>n(911706);function Ee(e){const{botId:t,canSelectPageAccess:n,onConnect:s,onDisconnect:l,botSharedPagesStore:c}=e,[d]=(0,i.useState)(Ie().Store.createValue({})),p=(0,r().O$)(o().AppStoreSidebarSpaceStore),m=(0,a().v3)(),[h,f]=(0,i.useState)(!1),y=(0,_e().Rx)(),{allSharedPagesStores:b=[]}=y??{},x=(0,r().O$)(o().AppStoreSidebarSpaceViewStore),v=(0,r().K8)((()=>{var e;const n={};return((null===(e=c.state.result)||void 0===e||null===(e=e[t])||void 0===e?void 0:e.pageIds)??[]).forEach((e=>{n[e]=!0})),n}),[c,t]);(0,i.useEffect)((()=>{n&&p&&d.setState(v)}),[n,p,v,d]);const{teamPagesByTeam:S,allTeams:j,allPrivatePages:I,allWorkspacePages:C}=(0,Ne().g)({spaceViewStore:x,spaceStore:p,pageIdsSharedWithUser:b.map((e=>e.id))}),w=p?u().v.createChildStore(p,{table:A().GP,id:t}):null,k=(0,r().K8)((()=>w?w.getIntegrationManagementPermissions():(0,g().RV)()),[w]),T=[];n&&p&&k.userCanModifyPageAccess&&T.push({key:"actions for user guest connections",render:e=>(0,fe.jsx)(Be().A,{...e}),items:[{key:"update selected pages",render:(e,t)=>(0,fe.jsx)(ke().A,{...e,title:(0,fe.jsx)("div",{children:(0,fe.jsx)(M().sA,{id:"userConnectionsSettings.actionMenu.selectPagesNewPagePicker.label",defaultMessage:"Select page access"})})}),action:()=>{f(!0)}}]});const P=[];s&&P.push({key:"connect account",render:e=>(0,fe.jsx)(ke().A,{...e,title:(0,fe.jsx)(M().sA,{id:"userConnectionsSettings.actionMenu.connectAccount.label",defaultMessage:"Connect another account"}),onClick:s}),action:s}),P.push({key:"disconnect account",render:e=>(0,fe.jsx)(ke().A,{...e,title:(0,fe.jsx)("div",{style:{color:ce().oZ.red},children:(0,fe.jsx)(M().sA,{id:"userConnectionsSettings.actionMenu.disconnectAccount.label",defaultMessage:"Disconnect account"})}),onClick:()=>{l()}}),action:()=>l()}),T.push({key:"actions for all user connections",render:e=>(0,fe.jsx)(Be().A,{...e}),items:P});const N=i.useCallback((async()=>{if(!p)return;const e=await B().GO({environment:m,spaceStore:p,botIds:[t]});return null!=e&&e.bots&&c.update((t=>({...t,result:{...t.result??{},...e.bots}}))),e}),[m,p,t,c]);return p&&w?(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(Ce().A,{popupType:O().A.isMobile?Ce().z.BottomSheet:Ce().z.Popup,renderOrigin:e=>(0,fe.jsx)(De().A,{...e,isMobile:O().A.isMobile}),render:e=>(0,fe.jsx)(we().A,{menuType:O().A.isMobile?Me().gu.Modal:Me().gu.Popup,children:(0,fe.jsx)(Te().A,{type:Te().O.Vertical,sections:T,initialFocus:void 0,onAccept:()=>e.close()})})}),(0,fe.jsx)(Pe().r,{isOpen:h,teamPagesByTeam:S,pageIdsAlreadySharedWithBot:Object.keys(v),spaceId:p.id,onClose:()=>f(!1),allTeams:j,privatePages:I,workspacePages:C,pagesSharedWithUser:b,botStore:w,spaceStore:p,refetchBotSharedPages:N,selectedBlockIdsStore:d,pagePickerLocation:"public_integration_page_picker",integrationManagementPermissions:k})]}):null}const Le=28;function Oe(e){const{userConnections:t,botSharedPagesStore:n}=e;return(0,fe.jsx)(je().A,{columns:[{key:"connection",header:(0,fe.jsx)(M().sA,{id:"userConnectionsSettings.connectionsTable.connectionsColumn.title",defaultMessage:"Connection"}),style:{width:"40%"}},{key:"access",header:(0,fe.jsx)(M().sA,{id:"userConnectionsSettings.connectionsTable.accessColumn.title",defaultMessage:"Access"}),style:{width:"40%"}},{key:"more",header:void 0,style:{width:"5%"}}],rows:ze(t,n)})}function ze(e,t){const n=[];return e.forEach((e=>{const{account:i,onDisconnect:o}=e;if(Array.isArray(i)){const s=i.map((n=>Re({connection:{...e,onDisconnect:()=>{o(n)}},account:n,botSharedPagesStore:t})));n.push(...s)}else n.push(Re({connection:e,account:i,botSharedPagesStore:t}))})),n}function Re(e){const{account:t,connection:{id:n,appName:i,canSelectPageAccess:o,capabilities:s,logo:a,onConnect:r,onDisconnect:l},botSharedPagesStore:c}=e,d=void 0!==t&&"string"!=typeof t,g=d?t.accountName:t,p=d?t.accountId:n;return{key:`${p}-${g}`,columns:[(0,fe.jsx)(We,{accountName:g,connectionLogo:a,connectionName:i??""},"connection-title"),s,(0,fe.jsx)(Ee,{botId:p,canSelectPageAccess:o,connectionName:i??"",onConnect:r,onDisconnect:l,botSharedPagesStore:c},"connection-action-menu")]}}function We(e){const{accountName:t,connectionLogo:n,connectionName:i}=e;return(0,fe.jsxs)("div",{style:{display:"flex",alignItems:"center",marginInlineEnd:12},children:["string"==typeof n?(0,fe.jsx)("img",{src:n,style:{height:Le,maxWidth:Le}}):n&&"object"==typeof n&&"icon"in n?(0,fe.jsx)(Ae().B6,{disabled:!0,icon:n,title:i,isEmptyPage:!1,size:Le,isLarge:!0,useInvertedColors:!0}):null,(0,fe.jsxs)("div",{style:{marginInlineStart:15},children:[(0,fe.jsx)(Se().A,{children:i}),t?(0,fe.jsx)(Se().A,{isSmall:!0,children:t}):void 0]})]})}const Ke={height:"100%",padding:"36px 60px"},Ue={alignItems:"center",display:"flex",flexDirection:"column",flex:1,height:"100%",justifyContent:"center"};function Ve({location:e,spaceStore:t}){const[n,o]=(0,i.useState)("home");return(0,fe.jsx)(he.Provider,{value:{currentPage:n,setPage:o},children:(0,fe.jsx)(Fe,{location:e,spaceStore:t})})}function Fe({location:e,spaceStore:t}){const{currentPage:n}=(0,i.useContext)(he);switch(n){case"home":return(0,fe.jsx)(qe,{location:e,spaceStore:t});case"mcp_settings":return(0,fe.jsx)(ve,{})}}function qe({location:e,spaceStore:t}){const n=(0,a().v3)(),i=(0,r().uB)(void 0,c().A);return(0,fe.jsx)($().A,{request:n,performRequest:()=>async function(e){const{environment:t,spaceStore:n}=e;return{guestBotIds:await Ze({environment:t,spaceStore:n}),connectionStatus:await P()._s(t,n.id)}}({environment:n,spaceStore:t}),requestStore:i,render:(n,o)=>null!=o&&o.connectionStatus?(0,fe.jsx)(Qe,{location:e,requestStore:i,spaceStore:t,guestBotIds:o.guestBotIds}):(0,fe.jsx)("div",{style:Ue,children:(0,fe.jsx)(h().k,{})})})}function Ye(e){const t=[];return null!=e&&e.read_content&&t.push((0,fe.jsx)(M().sA,{id:"userConnectionsSettings.connectionsTable.botAccess.readContent",defaultMessage:"view"})),null!=e&&e.insert_content&&t.push((0,fe.jsx)(M().sA,{id:"userConnectionsSettings.connectionsTable.botAccess.insertContent",defaultMessage:"insert"})),null!=e&&e.update_content&&t.push((0,fe.jsx)(M().sA,{id:"userConnectionsSettings.connectionsTable.botAccess.updateContent",defaultMessage:"update"})),t}function He(e){const t=[];return(0,v().v_)(e)&&t.push((0,fe.jsx)(M().sA,{id:"userConnectionsSettings.connectionsTable.botAccess.previewLinks",defaultMessage:"preview links"},"previewLinks")),function(e){return e.id===b().mn||e.id===b().Iy||!!e.info.original_url_patterns&&e.info.original_url_patterns.some((e=>{var t;return null===(t=e.additional_types)||void 0===t?void 0:t.collection}))}(e)&&t.push((0,fe.jsx)(M().sA,{id:"userConnectionsSettings.connectionsTable.botAccess.syncDatabases",defaultMessage:"sync databases"},"syncedDatabase")),(0,v().mt)(e)&&t.push((0,fe.jsx)(M().sA,{id:"userConnectionsSettings.connectionsTable.botAccess.automationAction",defaultMessage:"run automations"},"automationAction")),t}function $e(e){return{display:"flex",flexDirection:"column",height:"100%",width:"sidebar-modal"===e?"100%":"auto"}}function Ge(e){const{guestBotIds:t,environment:n,spaceStore:i}=e;if(!i||(0,L().I)(i))return[];const o=g().bM.getMcpConfig().isAllowlistFeatureEnabled;return t.map((e=>{const t=u().v.createChildStore(i,{table:A().GP,id:e}),s=t.getName();if(!t.getAlive()||!s||t.isInternalBot())return;const a=t.getIntegrationId();if(o&&a&&(0,S().Y)(a))return;const r=t.getIntegrationPointer(),l=t.getIcon(),c=l&&r?{pointer:r,icon:l}:void 0,d=!(a&&(0,S().Y)(a));return{id:t.id,appName:s,caption:void 0,account:void 0,logo:c,capabilities:(0,fe.jsx)(M().sA,{id:"userConnectionsSettings.connectionsTable.accessColumn.userGuest",defaultMessage:"Can {capabilities} content",values:{capabilities:(0,fe.jsx)(M().dT,{value:Ye(t.getCapabilities()),type:"conjunction"})}}),canSelectPageAccess:d,onDisconnect:async()=>{const{accept:e}=await p().Gh({message:(0,fe.jsx)("span",{children:(0,fe.jsx)(M().sA,{id:"userConnectionsSettings.deleteExternalAuthorization.withoutAccountName.confirmationMessage",defaultMessage:"Revoke access for this account?"})}),acceptLabel:(0,fe.jsx)(M().sA,{id:"userConnectionsSettings.deleteExternalAuthorization.confirmDelete.label",defaultMessage:"Yes"})});e&&await B().KA({environment:n,botId:t.id,onSuccess:()=>{}})}}})).filter(k().O9)}function Xe(e){const{environment:t,spaceStore:n}=e;if(!n.canEdit())return[];const i=n.getBotSettingsStore().getValue(),o=n.id,{integrations:{state:s},bots:{state:a},externalAuthentications:{state:r}}=d().A,l=n.canAdmin(),c=[];c.push(b().mn);const g=a.find((e=>e.integration_id===b().mn));g&&r.find((e=>e.parent_id===g.id))&&c.push(b().Iy);const m=(0,E().Yn)(l);s.sort(((e,t)=>(m[e.id]??1/0)-(m[t.id]??1/0)));const h=[b().ob,b().F6,b().mn];return s.map((e=>{var s;if(!e.info.icon)return;if(!l&&h.includes(e.id))return;if((0,C().Hr)(e.id))return;const d=a.filter((t=>t.integration_id===e.id)),g=w().oE(d.map((e=>{const t=r.find((t=>t.parent_id===e.id));if(t)return{accountId:e.id,accountName:t.account_name}}))),m=(0,I().nH)({spaceBotSettings:i,integrationId:e.id}),f=g.length>0;if(!m&&!f)return;if(!f&&e.id===b().io)return;const x=!m,S=He(e),j=!w().Im(S)&&(0,fe.jsx)(M().sA,{id:"userConnectionsSettings.connectionsTable.accessColumn.external",defaultMessage:"Can {capabilities}",values:{capabilities:(0,fe.jsx)(M().dT,{value:S,type:"conjunction"})}}),k=(0,y().qs)(e.capabilities),P=null===(s=e.capabilities)||void 0===s?void 0:s.inherit_creator_permissions,_=k&&!P,D=[];return(0,v().Hy)(e)&&D.push("linkPreview"),(0,v().Z1)(e)&&D.push("databaseSync"),(0,v().mt)(e)&&D.push("automation_action"),{id:e.id,appName:e.name,caption:e.info.tagline,logo:e.info.icon,account:g,shouldHideConnectAccount:x,shouldHideInDiscover:c.includes(e.id),shouldShowNewBadge:!e.info.hide_new_badge,shouldShowBetaBadge:(0,b().MF)(e),integrationTypes:D,capabilities:(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)("div",{children:j}),k?(0,fe.jsx)("div",{children:(0,fe.jsx)(M().sA,{id:"userConnectionsSettings.connectionsTable.accessColumn.externalWithCapabilities",defaultMessage:"Can {capabilities} content",values:{capabilities:(0,fe.jsx)(M().dT,{value:Ye(e.capabilities),type:"conjunction"})}})}):null]}),canSelectPageAccess:_,onConnect:async()=>{await N().Jq({environment:t,integration:e,spaceId:o,from:"connected_apps_settings"}),H().refreshExternalIntegrationStore({environment:t})},onDisconnect:async i=>{const o=a.find((e=>e.id===(null==i?void 0:i.accountId)));if(o){const s=u().v.createChildStore(n,{table:A().GP,id:o.id,spaceId:o.space_id}),a=null!=i&&i.accountName?(0,fe.jsx)(M().sA,{id:"connectedAppSettings.deleteExternalAuthorization.withAccountName.confirmationMessage",defaultMessage:"Revoke access for “{accountName}”?",values:{accountName:i.accountName}}):(0,fe.jsx)(M().sA,{id:"connectedAppSettings.deleteExternalAuthorization.withoutAccountName.confirmationMessage",defaultMessage:"Revoke access for this account?"}),{accept:r}=await p().Gh({message:(0,fe.jsx)("span",{children:a}),acceptLabel:(0,fe.jsx)(M().sA,{id:"connectedAppSettings.deleteExternalAuthorization.confirmDelete.label",defaultMessage:"Yes"})});r&&(await B().KA({environment:t,botId:s.id,onSuccess:()=>{}}),T().hy(t,{integrationId:e.id}))}}}})).filter(k().O9)}async function Ze(e){const{environment:t,spaceStore:n}=e,{currentUserStore:i}=o().default.state;if(!n||!i||!m().subscriptionDataStoreInstance.state)return[];return(await B().Ju({environment:t,table:j().NX,id:n.id,type:"guest"})).botIds.filter((e=>u().v.createChildStore(n,{table:A().GP,id:e}).getCreatedById()===i.id))}function Je(e){var t;const{environment:n,intl:i,requestStore:o,spaceStore:s}=e,a=null===(t=o.state.result)||void 0===t?void 0:t.connectionStatus,r=(0,fe.jsx)(M().sA,{id:"userConnectionsSettings.connectionsTable.accessColumn.legacyImporter",defaultMessage:"Can only add pages"});return[{id:"evernote",appName:"Evernote",caption:i.formatMessage({id:"connectedAppsSettings.evernote.caption",defaultMessage:"Import notebooks."}),logo:f().A.images.import.evernotePng,account:null==a?void 0:a.evernote,capabilities:r,shouldHideInDiscover:!0,canSelectPageAccess:!1,integrationTypes:["importer"],onConnect:()=>q().J({environment:n,requestStore:o}),onDisconnect:()=>P().rA(n,o)},{id:"trello",appName:"Trello",caption:i.formatMessage({id:"connectedAppsSettings.trello.caption",defaultMessage:"Import your boards."}),logo:f().A.images.import.trelloPng,shouldHideInDiscover:!0,account:null==a?void 0:a.trello,capabilities:r,integrationTypes:["importer"],canSelectPageAccess:!1,onConnect:()=>Y().P({environment:n,requestStore:o}),onDisconnect:()=>P().x_(n,o)},{id:"asana",appName:"Asana",caption:i.formatMessage({id:"connectedAppsSettings.asana.caption",defaultMessage:"Import tasks from boards and lists."}),logo:f().A.images.import.asanaPng,shouldHideInDiscover:!0,integrationTypes:["importer"],account:null==a?void 0:a.asana,capabilities:r,canSelectPageAccess:!1,onConnect:()=>async function(e){const{environment:t,requestStore:n}=e,i=(0,U().LX)(t);let o=(0,z().Rq)(O().A.domainBaseUrl,{authType:i,userId:t.currentUser.id});o=i.redirectToAuth?o:await(0,U().YN)(t,o);const s=await K().P(t,{width:580,height:800,url:o,titleMessage:F.titleMessage});if(!s)return;const a=R().qg(s);if(!a.query.code||!a.query.state)return;W().m({message:F.authenticatingWithAsana});const r=await t.api.callApi({eventName:"authWithAsana",environment:t,data:{code:a.query.code,encryptedState:a.query.state}});"failed"===r.type?(console.error(r.error),p().Qg(r),W().V()):(T().mu(t,{integration_name:"asana"}),await n.refresh(),V.setState({open:!0}),W().V())}({environment:n,requestStore:o}),onDisconnect:()=>P().HC(n,o)},...s.canRead()?[{id:"confluence",appName:"Confluence",caption:i.formatMessage({id:"connectedAppsSettings.confluence.caption",defaultMessage:"Import Spaces from Confluence."}),logo:f().A.images.import.confluencePng,shouldHideInDiscover:!0,account:null==a?void 0:a.confluence,capabilities:r,integrationTypes:["importer"],canSelectPageAccess:!1,onDisconnect:()=>P().Pz(n,o,s.id)}]:[]]}function Qe({guestBotIds:e,location:t,requestStore:n,spaceStore:o}){const d=(0,a().v3)(),p=(0,M().tz)(),u=(0,r().K8)((()=>(0,D().kB)()),[]),{setPage:m}=(0,i.useContext)(he),{connected:h,discover:f}=(0,r().K8)((()=>function(e){const{guestBotIds:t,environment:n,intl:i,requestStore:o,enabledConnectors:a,setPage:r,spaceStore:l}=e;let c;c=s().default.checkGate({gateName:"notion_ai_workspace_settings"})?(0,_().s_)({intl:i,environment:n,from:"my_connections_settings",enabledConnectors:a}):[];const d=g().bM.getMcpConfig().isAllowlistFeatureEnabled?[]:(0,_().mX)({intl:i,setPage:r}),p=w().$z([...c,...d,...Xe({environment:n,spaceStore:l}),...Je({environment:n,intl:i,requestStore:o,spaceStore:l})],(e=>e.account&&e.account.length>0?"connected":"discover"));return{connected:[...Ge({guestBotIds:t,environment:n,spaceStore:l}),...p.connected||[]],discover:p.discover||[]}}({guestBotIds:e,environment:d,intl:p,requestStore:n,enabledConnectors:u,setPage:m,spaceStore:o})),[e,d,p,n,u,m,o]),y=(0,r().uB)(void 0,c().A);(0,x().Yb)((async()=>{y.update((e=>({...e,loading:!0,ready:!1,result:void 0})));const e=h.filter((e=>e.canSelectPageAccess)).map((e=>e.id)),t=o.canRead()?await B().GO({environment:d,spaceStore:o,botIds:e}):void 0;y.update((e=>({...e,loading:!1,ready:!0,result:null==t?void 0:t.bots})))}),[d,o,h,y]);const b=h.length>0;return(0,fe.jsx)("div",{style:$e(t),children:(0,fe.jsxs)(Z().H,{style:Ke,type:l().A.Y,children:[b?(0,fe.jsxs)(fe.Fragment,{children:[(0,fe.jsx)(J().A,{large:!0,divider:"full",style:{borderBottom:"none",marginBottom:0},children:(0,fe.jsx)(M().sA,{id:"connectionsSettings.connectionsSection.title",defaultMessage:"My connections"})}),(0,fe.jsx)(Oe,{userConnections:h,botSharedPagesStore:y})]}):void 0,(0,fe.jsx)("div",{style:{marginTop:b?32:void 0},children:(0,fe.jsx)(G().A,{apps:f,numberOfConnectedApps:h.length,title:(0,fe.jsx)("div",{style:{display:"flex",justifyContent:"space-between",minHeight:28,fontSize:16,fontWeight:510},children:(0,fe.jsx)(M().sA,{id:"connectionsSettings.discoverNewConnectionsSection.title",defaultMessage:"Discover new connections"})})})}),(0,fe.jsx)("div",{style:{marginTop:20},children:(0,fe.jsx)(X().W,{})})]})})}},963186:(e,t,n)=>{n.d(t,{A:()=>o});class i extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}}const o=new i},974679:(e,t,n)=>{n.d(t,{A:()=>M});n(898992),n(354520),n(581454);var i=n(296540),o=()=>n(484714),s=()=>n(401497),a=()=>n(718827),r=()=>n(807449),l=()=>n(631524),c=()=>n(373009),d=()=>n(90907),g=()=>n(69708),p=()=>n(100622),u=()=>n(534177),m=()=>n(284371),h=()=>n(559926),f=()=>n(731297),y=()=>n(13898),b=()=>n(824160),x=()=>n(187820),v=()=>n(8178),S=n(474848);const A=2,j=1,I=3,C=36;function M(e){const{apps:t,numberOfConnectedApps:n,title:s,subtitle:a,numberOfDisplayRows:r}=e,c=(0,o().v3)(),[d,p]=(0,i.useState)(!1),m=(r||j)*I,f=t.filter((e=>!e.shouldHideInDiscover)),y=f.length>m&&!d,b=d?f:f.slice(0,m);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(v().A,{large:!0,divider:"none",children:[s,a]}),(0,S.jsx)("div",{style:{maxHeight:d?600:void 0,overflowY:d?"auto":void 0},children:(0,S.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gridAutoRows:"minmax(min-content, auto)",gap:16},children:b.map((e=>{var t;return e.onConnect&&(0,S.jsx)(w,{appName:e.appName,caption:e.caption,shouldShowNewBadge:e.shouldShowNewBadge,shouldShowBetaBadge:e.shouldShowBetaBadge,shouldShowUpsell:e.shouldShowUpsell,logo:e.logo,width:e.width,integrationTypes:null===(t=e.integrationTypes)||void 0===t?void 0:t.slice(0,A),showExploreButton:e.showExploreButton,onConnect:e.onConnect},e.id)})).filter((e=>(0,u().O9)(e)))})}),y?(0,S.jsx)(l().p,{style:{marginTop:10,gap:10,marginInlineStart:-8},colorPalette:"gray",onClick:()=>{d||(p(!0),h().PR(c,{numberOfConnectedApps:n}))},children:(0,S.jsx)(g().sA,{id:"connectedAppsSettings.discoverNewAppSection.seeAll.label",defaultMessage:"See all"})}):void 0]})}function w(e){const{appName:t,caption:n,logo:o,shouldShowUpsell:l,shouldShowBetaBadge:u,integrationTypes:h,onConnect:v,width:A,showExploreButton:j}=e,I=(0,s().IS)((()=>({card:{display:"flex",flexDirection:"column",justifyContent:"space-between",borderRadius:8,border:`1px solid ${p().Tj.border.primary}`,padding:12,minHeight:"100%",minWidth:120,gap:12,maxWidth:256},upsellCard:{backgroundColor:p().Tj.whiteButtonBackground},connectedAppIcon:{width:A||C,height:C,padding:4,borderRadius:6},titleAndNewBadgeContainer:{alignItems:"center",display:"flex",marginInlineStart:2,marginBottom:4,gap:6},title:{fontWeight:m().Wy.medium,fontSize:14,lineHeight:1.3},caption:{marginInlineStart:2,marginInlineEnd:2,fontWeight:m().Wy.regular,color:p().Tj.text.secondary,fontSize:12,lineHeight:1.5,display:"-webkit-box",WebkitLineClamp:4,WebkitBoxOrient:"vertical",overflow:"hidden"},pillContainer:{marginTop:8,marginBottom:6,fontSize:12,color:p().Tj.text.tertiary,display:"flex",gap:4,fontWeight:500},logoTitleContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:8}})),[A]),M=(0,S.jsxs)("div",{children:[(0,S.jsxs)("div",{style:I.logoTitleContainer,children:["string"==typeof o?(0,S.jsx)("img",{src:o,style:I.connectedAppIcon}):i.isValidElement(o)?o:o&&"object"==typeof o&&"icon"in o?(0,S.jsx)(x().B6,{disabled:!0,icon:o,title:t,isEmptyPage:!1,size:C,isLarge:!0,useInvertedColors:!0,style:I.connectedAppIcon}):null,t?(0,S.jsxs)("div",{style:I.titleAndNewBadgeContainer,children:[(0,S.jsx)("div",{style:I.title,children:t}),u?(0,S.jsx)(y().A,{}):void 0,l?(0,S.jsx)("span",{style:{marginInlineStart:6},children:(0,S.jsx)(r().I,{icon:d().lockIcon,colorVariant:"secondary"})}):void 0]}):void 0]}),(0,S.jsx)("div",{style:I.caption,children:n}),(0,S.jsx)("div",{style:I.pillContainer,children:null==h?void 0:h.map((e=>e&&(0,S.jsx)(b().A,{children:f().de[e]},e)))})]});return l?(0,S.jsx)("div",{style:{...I.card,...I.upsellCard},children:M}):(0,S.jsxs)(a().Ay,{onClick:v,style:I.card,children:[M,(0,S.jsx)(c().E,{colorPalette:"blue",onClick:v,children:j?(0,S.jsx)(g().sA,{id:"adminConnectionsSettings.aiSettingsCard.actionButtonLabel",defaultMessage:"Explore"}):(0,S.jsx)(g().sA,{id:"connectedAppSettingsDiscoverItem.connectButton.label",defaultMessage:"Connect"})})]})}}}]);