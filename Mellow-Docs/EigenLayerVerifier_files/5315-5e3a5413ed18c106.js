"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[5315,20370,92821],{7667:(e,t,o)=>{o.d(t,{A:()=>m});o(898992),o(737550),o(296540);var n=()=>o(484714),i=()=>o(590526),r=()=>o(792057),l=()=>o(69708),a=()=>o(534177),s=()=>o(908201),c=()=>o(254497),d=()=>o(312296),u=()=>o(999140),p=()=>o(547149),g=o(474848);function m(){const e=(0,s().Ks)(),t=(0,n().v3)(),o=(0,i().K8)((()=>null==e?void 0:e.settingsStore),[e]);return function(n){if(!o||!n||!e)return;const i=e.collectionStore();if((0,a().O9)(i)){const e=u().KA({deletedSchema:i.getDeletedSchema(),property:n});if(e){var s;if("verification"===(null===(s=i.getDeletedSchema()[n])||void 0===s?void 0:s.type)){const e=i.getSchema(),t=Object.keys(e).some((t=>{var o;return"verification"===(null===(o=e[t])||void 0===o?void 0:o.type)}));if(t)return void r().ui({message:(0,g.jsx)(l().sA,{id:"deletedPropertyMenu.cannotRestoreDuplicateProperty.modal.verification",defaultMessage:"You can only have one verification property."}),showCancel:!1,keepFocus:!0,items:[{label:(0,g.jsx)(l().sA,{id:"deletedPropertyMenu.cannotRestoreDuplicateProperty.modal.dismissButton",defaultMessage:"Dismiss"}),onAccept:()=>{}}]})}p().createAndCommit({userAction:"deletedPropertyMenu.handleRestoreDeletedPropertyClick",environment:t,canUndo:!0,perform:o=>{(0,d().F)({environment:t,collectionStore:i,update:e.updateSchema,transaction:o}),(0,c().E)({collectionStore:i,update:e.updateDeletedSchema,transaction:o})}})}}}}},18953:(e,t,o)=>{o.d(t,{H:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"4.53 2.55 11.03 14.94",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M13.105 4.184a1.475 1.475 0 1 1-2.934-.309 1.475 1.475 0 0 1 2.934.309m-5.297 7.25-.753 2.994-2.334 2.101a.55.55 0 0 0 .737.817l2.582-2.325.72-2.864-.662-.476a2.3 2.3 0 0 1-.29-.247"}),(0,n.jsx)("path",{d:"M11.681 8.169q.127.206.208.442l.567 1.67a.55.55 0 0 0 .66.354l2.032-.527a.55.55 0 1 0-.276-1.065l-1.539.4-.403-1.186a3.296 3.296 0 0 0-3.278-2.232l-3.02.145a.55.55 0 0 0-.513.438l-.501 2.42a.55.55 0 0 0 1.077.223l.415-2.002 1.654-.08-.03.294-.603 2.18a1.45 1.45 0 0 0 .516 1.537l3.05 2.335-2.08 1.51a.55.55 0 1 0 .647.89l2.579-1.873a.64.64 0 0 0 .013-1.026l-2.168-1.659z"})]})},r=(0,o(340498).wt)("figureRun",i,"default")},38e3:(e,t,o)=>{o.d(t,{$:()=>p,Q:()=>g});o(16280);var n=()=>o(675133),i=()=>o(569797),r=()=>o(179034),l=()=>o(869558),a=()=>o(44729),s=()=>o(384944),c=()=>o(594794),d=()=>o(547149),u=()=>o(435930);function p(e){const{environment:t,layoutStore:o,transaction:n,options:i}=e,{inMemoryRecordCache:r}=o,l=o.getSpaceId(),c=o.getParentPointer();if(!c||"collection"!==c.table)throw new Error("Invalid state: no collection pointer");if(!l)throw new Error("Cannot add collection view to views main module -- Invalid state: no space id");const d=s().Wv({environment:t,type:"collection_view",inMemoryRecordCache:r,transaction:n});a().NI({childStore:d,parentStore:o,transaction:n});const{collectionViewStore:u}=g({environment:t,transaction:n,layoutStore:o,collectionViewBlockStore:d,options:i});return{collectionViewStore:u,collectionViewBlockStore:d}}function g(e){const{environment:t,transaction:o,layoutStore:a,collectionViewBlockStore:p,options:g}=e,{inMemoryRecordCache:m}=a,S=a.getParentPointer();if(!S||"collection"!==S.table)throw new Error("Invalid state: no collection pointer");const y=a.getSpaceId();if(!y)throw new Error("Cannot add collection view to views main module -- Invalid state: no space id");const f=(0,c().JH)({environment:t,table:l().Gy,spaceId:y}),h={id:f.id,type:"page",parent_id:p.pointer.id,parent_table:r().ev,space_id:y,alive:!0,name:n().A.formatMessage(u().s.editor),format:{collection_pointer:S,hide_linked_collection_name:!0}};return null!=g&&g.viewsTabId&&(h.format={...h.format,page_layout_pointer:{...a.pointer,views_main_tab_id:g.viewsTabId}}),s().eC({environment:t,table:l().Gy,value:h,inMemoryRecordCache:m,transaction:o}),d().applyOperation({store:p,operation:{pointer:p.pointer,path:["view_ids"],command:"listBefore",args:{id:f.id}},transaction:o}),{collectionViewStore:i().p.createChildStore(p,f)}}},48382:(e,t,o)=>{o.d(t,{z:()=>p});o(296540);var n=()=>o(614525),i=()=>o(364871),r=()=>o(590526),l=()=>o(69708),a=()=>o(436696),s=()=>o(873864),c=o(474848);const d=function({collectionContextStore:e,collectionSettingsStore:t}){const n=(0,o(484714).v3)(),i=(0,l().tz)(),d=(0,r().O$)(e.permissionScopesStore),u=(0,r().K8)((()=>!d.canConfigureBlock||"collectionTypedView"===e.contextTypeFromStoreState),[e,d]),{viewName:p,viewType:g}=(0,r().K8)((()=>{var t,o;return{viewName:null===(t=e.collectionViewStore())||void 0===t?void 0:t.getName(),viewType:null===(o=e.collectionViewStore())||void 0===o?void 0:o.getType()}}),[e]),m=!(0,r().O$)(o(929219).e);if(u||!g)return null;let S=(0,c.jsx)(l().sA,{defaultMessage:"Duplicate view",id:"database.viewSettings.mainTab.duplicateButton.title"});return"chart"===g?S=(0,c.jsx)(l().sA,{defaultMessage:"Duplicate chart",id:"database.viewSettings.mainTab.duplicateButton.title.chart"}):p&&(S=(0,c.jsx)(l().sA,{defaultMessage:"Duplicate {viewName}",id:"database.viewSettings.mainTab.duplicateButton.title.viewName",values:{viewName:p}})),(0,c.jsx)(o(497222).A,{icon:o(764781).V,title:S,onClick:()=>function(e,t,o,n){const i=t.collectionViewStore();i&&((0,s().v)({environment:e,collectionContextStore:t,collectionViewStore:i,collectionSettingsStore:o,intl:n,from:"view_settings_duplicate"}),(0,a().X)({environment:e,collectionContextStore:t,action:"click_duplicate",original_view_type:i.getType()}))}(n,e,t,i),disabled:m})};var u=()=>o(448701);function p({collectionContextStore:e,collectionSettingsStore:t}){return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(u().z,{collectionContextStore:e}),(0,c.jsx)(n().A,{collectionContextStore:e}),(0,c.jsx)(d,{collectionContextStore:e,collectionSettingsStore:t}),(0,c.jsx)(i().A,{collectionContextStore:e,collectionSettingsStore:t})]})}},58488:(e,t,o)=>{o.d(t,{I:()=>s});o(296540);var n=()=>o(590526),i=()=>o(348241),r=()=>o(908201),l=()=>o(937199),a=o(474848);function s(e){const{children:t}=e,o=(0,r().ET)(),s=(0,n().O$)(o.formsBaseLayoutEditorContextValueStore),c=(0,n().O$)(o.formsSpecificLayoutEditorContextValueStore);return s&&c?(0,a.jsx)(l().Op.Provider,{value:s,children:(0,a.jsx)(i().zi.Provider,{value:c,children:t})}):null}},63667:(e,t,o)=>{o.d(t,{k:()=>m});o(296540);var n=()=>o(383036),i=()=>o(590526),r=()=>o(401497),l=()=>o(26697),a=()=>o(713998),s=()=>o(852424),c=()=>o(340498),d=()=>o(680288),u=()=>o(937199),p=()=>o(478573),g=o(474848);function m(e){const{propertyId:t}=e,{collectionStore:o}=(0,u().LH)(),m=(0,r().DP)(),S=(0,i().K8)((()=>{if(!o)return;const e=o.getSchema();return(0,a()._g)({schema:e,property:t})}),[o,t]);if(!S)return null;const y=S.type;return(0,g.jsx)(l().m,{textWrap:!0,placement:"left",renderTooltip:()=>e.tooltip,disableTooltip:!e.tooltip,render:t=>(0,g.jsx)(p().A,{...(0,n().A)(t,e),icon:(0,g.jsx)(s().zB,{size:c().Ev.sm,theme:m,icon:S.icon,type:y}),name:S.name,subText:d().dC[y],disabled:e.disabled})})}},80659:(e,t,o)=>{o.d(t,{$:()=>i});var n=()=>o(433337);function i(e){return e!==n().Lu}},83486:(e,t,o)=>{o.d(t,{Y:()=>y});o(898992),o(354520),o(737550),o(296540);var n=()=>o(484714),i=()=>o(590526),r=()=>o(736847),l=()=>o(187174),a=()=>o(212727),s=()=>o(936802),c=()=>o(69708),d=()=>o(436696),u=()=>o(859236),p=()=>o(339798),g=()=>o(647702),m=()=>o(497222),S=o(474848);function y(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,y=(0,n().v3)(),f=(0,i().K8)((()=>{const e=t.permissionScopesStore.state;return!(0,g().K)({collectionContextStore:t,permissionScopes:e})}),[t]),[{status:h,value:x}]=(0,l().Yb)((async()=>{const e=t.collectionStore(),o=null==e?void 0:e.getSpaceId();return o?await(0,u().g)({environment:y,spaceId:o}):[]}),[t,y]),v="resolved"===h&&x&&x.length>0,b=(0,i().K8)((()=>{const e=t.collectionStore();if(!e)return;const o=e.getSchema(),n=(0,s().up)();return Object.keys(o).filter((e=>n.some((t=>t.id===e)))).length}),[t]);return v?(0,S.jsx)(r().A,{title:(0,S.jsx)(c().sA,{defaultMessage:"SCIM properties",id:"database.viewSettings.mainTab.editScimPropertiesSection.title"}),topBorder:!0,extraPadding:!0,children:(0,S.jsx)(m().A,{icon:a().gearIcon,title:(0,S.jsx)(c().sA,{defaultMessage:"Edit SCIM properties",id:"database.viewSettings.mainTab.editScimPropertiesButton.title"}),right:b,disabled:f,showChevron:!f,onClick:()=>{(0,d().X)({environment:y,collectionContextStore:t,action:"click_edit_scim_properties"}),p().a2({collectionSettingsStore:o,item:{type:"editScimProperties"}})}})},"edit-scim-properties"):null}},95347:(e,t,o)=>{o.d(t,{Dj:()=>T,NE:()=>P,Ro:()=>_,hw:()=>M,rD:()=>I});o(944114),o(898992),o(672577),o(581454),o(737550);var n=o(296540),i=()=>o(907258),r=()=>o(484714),l=()=>o(590526),a=()=>o(401497),s=()=>o(94484),c=()=>o(489242),d=()=>o(455348),u=()=>o(496603),p=()=>o(154017),g=()=>o(845147),m=()=>o(413955),S=()=>o(374562),y=()=>o(235059),f=()=>o(652079),h=()=>o(969956),x=()=>o(377093),v=()=>o(339798),b=()=>o(557336),C=()=>o(180762),j=()=>o(547149),w=()=>o(455338),A=()=>o(234675);function I(e){return(0,l().K8)((()=>{var t;if(!e)return;const o=null===(t=e.collectionStore())||void 0===t?void 0:t.getDatabaseType();return o?(0,y().l)((0,m().appConfigs)(),o):void 0}),[e])}function _(e,t){return(0,l().K8)((()=>{const o=e.collectionStore(),n=e.collectionViewBlockStore(),i=[],r=[];if(!o||!n)return{addedFeatures:i,suggestedFeatures:r};for(const l of t)l.isFeatureAdded(l,e)?i.push(l):r.push(l);return{addedFeatures:i,suggestedFeatures:r}}),[t,e])}function T(e){const{collectionContextStore:t,feature:o,appConfig:n}=e;if((0,A().l)(o))return o.isFeatureAdded(o,t);if((0,f().l)(o)||(0,h().u)(o))return k({collectionContextStore:t,feature:o});const i=function(e,t){return u().oE(e.variants.map((e=>{const o=null==t?void 0:t.find((t=>t.uri===e));if(o&&(0,f().l)(o))return o})))}(o,null==n?void 0:n.allFeatures);return i.some((e=>k({collectionContextStore:t,feature:e})))}function k(e){const{collectionContextStore:t,feature:o}=e,n=t.collectionStore();if(o.uri===(0,S().md)().uri)return Boolean(t.currentSubitemFormatStoreForCollectionStore.state);if(o.uri===(0,S().J4)().uri){const e=(0,b().QZ)({feature:"timeline_arrows_by",collectionContextStore:t});return Boolean(e)}const i=d().u9.derivePropertyUris((null==n?void 0:n.getSchema())??{},null==n?void 0:n.getPropertyMapping());return o.dependencies.some((e=>{const o="property"===e.type&&function(e){var t;const{collectionContextStore:o,dependency:n,propertyUris:i}=e,r=null===(t=o.collectionStore())||void 0===t?void 0:t.getDatabaseType();if(n.collectionUri===r)return(0,c().LE)(n.uri)&&i.has(n.uri);if((0,c().XA)(n.collectionUri))return(0,c().M7)(n.uri)&&i.has(n.uri);return!1}({dependency:e,collectionContextStore:t,propertyUris:i}),n="collection_view"===e.type&&function(e){var t;const{collectionContextStore:o,dependency:n}=e,i=o.collectionViewBlockStore(),r=null===(t=o.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.app_config_uri;if(!i||!r)return!1;var l,a;return n.collectionUri===r?n.collectionViewBlockUri===i.getFormat().app_config_uri&&n.uri in((null===(l=i.getFormat())||void 0===l?void 0:l.app_uri_map)??{}):!!(0,c().XA)(n.collectionUri)&&n.uri in((null===(a=i.getFormat())||void 0===a?void 0:a.app_uri_map)??{})}({dependency:e,collectionContextStore:t});return o||n}))}function M(e,t){const o=(0,r().v3)(),a=function(e){const t=(0,r().v3)(),o=I(e),a=(0,l().O$)(i().AppStoreSidebarSpaceViewStore),s=(0,l().K8)((()=>e.collectionViewBlockStore()),[e]);return(0,n.useCallback)(((n,i)=>{if(!s||!o||!a)return;const r=s.getParentStore();if(!r||"block"!==r.table&&"space"!==r.table&&"team"!==r.table)return;if(1!==n.dependencies.length)return;const l=n.dependencies[0];j().createAndCommit({userAction:"CollectionViewSuggestedViews.createView",environment:t,canUndo:!0,perform:c=>{var d;g().applyTypedFeatures({environment:t,spaceViewStore:a,appParentStore:r,appUri:o.uri,features:[{type:"simple",featureUri:n.uri}],appCollectionViewBlockStores:[s],createOrModify:"modify",transaction:c});const u=((null===(d=s.getFormat())||void 0===d?void 0:d.app_uri_map)??{})[l.uri];(0,C().t)({environment:t,collectionContextStore:e,collectionViewId:u,isFullScreen:e.isFullScreenStore.state,isRootChild:e.isRootChildStore.state,isInPeekRenderer:e.isInPeekRendererStore.state}),(0,p().b)({environment:t,collectionContextStore:e,view_type:l.value.type,view_config_uri:n.uri,feature:{id:u,from:i,type:n.uri},from:"addButton"})}})}),[s,o,a,t,e])}(e),c="more_settings";return(0,n.useCallback)((async n=>{if(n.uri===(0,S().md)().uri)v().a2({collectionSettingsStore:t,item:{type:"subitemV2",from:c}});else if(n.uri===(0,S().J4)().uri)v().a2({collectionSettingsStore:t,item:{type:"dependencies",from:c}});else{const t=n.dependencies[0];"collection_view"===t.type||"collection_view_block"===t.type||"sub_external_collection"===t.type?(a(n,c),s().Ay.setState({...s().Ay.state,shouldReset:!1}),(0,w().t)({featureName:n.name})):(await x().h3({environment:o,feature:n,collectionContextStore:e,addFeatureFrom:c}),(0,w().t)({featureName:n.name}))}}),[o,e,t,a,c])}function P(){return(0,a().IS)((()=>({featureIconWrapper:{height:28,width:28,padding:"6px 0px",borderRadius:4},featureIcon:{width:16,height:16,alignItems:"center",margin:"auto"}})),[])}},106261:(e,t,o)=>{o.d(t,{B:()=>u});var n=o(296540),i=()=>o(560533),r=()=>o(577914),l=()=>o(546926),a=()=>o(890492),s=()=>o(69708),c=()=>o(534177),d=o(474848);function u(e){const{children:t,title:o,displayMode:u,showDismissButtonBackground:p}=e,g=(0,n.useContext)(i().e);switch(u){case"phone":return(0,d.jsx)(a().A,{menuType:l().gu.Modal,onClickRight:g,title:o,whiteBackground:!0,disableBottomPadding:!0,right:g?(0,d.jsx)(s().sA,{defaultMessage:"Done",id:"appearanceSettings.modal.done"}):null,children:t});case"desktop":return(0,d.jsxs)(d.Fragment,{children:[t,(0,d.jsx)(r().R,{showBackground:p})]});default:(0,c().HB)(u)}}},131849:(e,t,o)=>{o.d(t,{a:()=>l});var n=()=>o(484714),i=()=>o(590526),r=()=>o(290247);function l(e){const t=(0,n().v3)();return(0,i().K8)((()=>{if(t.currentUser.id&&e)return e.isMemberOrGuest(t.currentUser.id,r()._.getSpacePermissionGroupIds({userId:t.currentUser.id,spaceId:e.getSpaceId()}))}),[t.currentUser.id,e])}},147361:(e,t,o)=>{o.d(t,{r:()=>P});o(581454);var n=o(296540),i=()=>o(401497),r=()=>o(451306),l=()=>o(100622),a=()=>o(496603),s=()=>o(534177),c=()=>o(378518),d=()=>o(323550);o(16280);class u{constructor(){this.stiffness=50,this.damping=10,this.precision=.001,this.currentValue=0,this.endValue=0,this.velocity=0}isAtRest(){return Math.abs(this.endValue-this.currentValue)<=this.precision}setEndValue(e){this.endValue=e;const t=this.isAtRest();return t&&this.setAtRest(),t}jumpToEnd(){this.currentValue=this.endValue}step(e){let t=e;do{let e;t>u.timestep?(t-=u.timestep,e=u.timestep):(e=t,t=0);const[o,n]=this.rk4(this.currentValue,this.velocity,e);this.velocity=n,this.currentValue=o}while(t>0);const o=this.isAtRest();return o&&this.setAtRest(),o}setAtRest(){this.currentValue=this.endValue,this.velocity=0}rk4(e,t,o){const n=e,i=t,r=this.computeAccel(n,i,0),l=e+.5*i*o,a=t+.5*r*o,s=this.computeAccel(l,a,o/2),c=e+.5*a*o,d=t+.5*s*o,u=this.computeAccel(c,d,o/2),p=e+d*o,g=t+u*o;return[e+o/6*(i+2*a+2*d+g),t+o/6*(r+2*s+2*u+this.computeAccel(p,g,o))]}computeAccel(e,t,o){return this.stiffness*u.stiffnessMultiplier*(this.endValue-e)-this.damping*u.dampingMultiplier*t}}u.stiffnessMultiplier=1e-5,u.dampingMultiplier=.005,u.timestep=1e3/60;const p=u;function*g(e,t){const o=new p;for(o.currentValue=e,o.endValue=t,o.stiffness=35;;){const e=yield o.currentValue;if(o.step(e)){yield o.currentValue;break}}}function*m(e,t,o){let n=0;for(;n<o;){n+=(yield e+n/o*(t-e))}}function*S(e){for(const[t,o]of a().yU(e,e.slice(1)))(0,s().O9)(t)&&(0,s().O9)(o)&&(yield*g(t,o))}function*y(e,t){let o=0;for(;!(0,s().O9)(t)||o<t;){o+=(yield e)}}function*f(e){let t=0;for(;;){const o={};for(const n of(0,s().uv)(e)){const i=e[n].next(t);if(i.done)return;o[n]=i.value}t=yield o}}var h=()=>o(402838),x=o(474848);const v="inactive-task-filter",b="active-task-filter",C="mouse-cursor-filter",j=80,w=24,A=8,I=10,_=264,T=110,k=j/2;function*M(e){yield*f({x:e,opacity:y(1)})}function P(e){const{mode:t}=e,o=(0,i().IS)((()=>({wrap:{margin:"0px 10px",border:`1px solid ${l().Tj.border.secondaryTranslucent}`,borderRadius:6,alignItems:"center",position:"relative",height:T+2}})),[1]),r=(0,n.useRef)(null),a=(0,h().s)(r),s=a?a.width-2:_;return(0,x.jsx)("div",{style:o.wrap,ref:r,children:(0,x.jsx)(B,{mode:t,sceneWidth:s})})}function B(e){const{mode:t,sceneWidth:o}=e,u=(0,i().IS)((()=>({svgArrowTheme:{stroke:l().Tj.collectionValidDependencyArrow,strokeWidth:c().cC},invalidArrow:{stroke:l().Tj.red.icon.accentPrimary},svgContainer:{position:"absolute",width:"100%",height:"100%",backgroundColor:l().Tj.palette.gray[30]}})),[]),p=(0,n.useMemo)((()=>({*none(){for(;;)yield*M(S([o/2,o/2+j/2+j/4,o/2-j/2-j/4,o/2]))},*preserve_gap(){for(;;)yield*M(S([o/2,o/2+j/2,o/2-j/2,o/2]))},*consume_gap(){for(;;){yield*M(S([o/2,o/2-j/2,o/2+j/2,o/2+j]));const e=500;yield*f({x:y(o/2+j),opacity:m(1,0,e)}),yield*f({x:y(o/2),opacity:m(0,1,e)})}}})),[o]),{x:g,opacity:h}=function(e){const t=(0,n.useMemo)((()=>e()),[e]),[o,i]=(0,n.useState)((()=>{const e=t.next(0);if(e.done)throw new Error("Generator must provide at least one result");return e.value}));return(0,n.useEffect)((()=>{const e=t.next(0);e.done||i(e.value);let o=Date.now(),n=0;return n=requestAnimationFrame((function e(){n=requestAnimationFrame(e);const r=Date.now(),l=r-o;o=r;const a=t.next(l);a.done||i(a.value)})),()=>cancelAnimationFrame(n)}),[t]),o}(p[t??"none"]),v={x:o/2-2*j,y:I},b={x:g-j/2,y:I+w+A},C={x:o/2+j,y:I+2*(w+A)},_={x:b.x+j/2,y:b.y+w/2};return(0,s().O9)(t)&&("consume_gap"===t?(v.x=Math.min(v.x,b.x-j),C.x=Math.max(C.x,b.x+j)):"preserve_gap"===t?(v.x=v.x+g-o/2,C.x=C.x+g-o/2):(0,s().HB)(t)),(0,x.jsxs)("svg",{style:u.svgContainer,children:[a().y1(o/2-2*j,o,k).map(((e,t)=>(0,x.jsx)(F,{startPoint:{x:e,y:0},endPoint:{x:e,y:T}},t))),(0,x.jsx)(d().A,{startPoint:{x:b.x+j,y:b.y+w/2},endPoint:{x:C.x-2,y:C.y+w/2},...(0,r().ow)(u.svgArrowTheme,b.x+j>C.x?u.invalidArrow:void 0,{opacity:h}),showArrowHead:!0}),(0,x.jsx)(d().A,{startPoint:{x:v.x+j,y:v.y+w/2},endPoint:{x:b.x-2,y:b.y+w/2},...(0,r().ow)(u.svgArrowTheme,b.x<v.x+j?u.invalidArrow:void 0,{opacity:h}),showArrowHead:!0}),(0,x.jsx)(V,{point:v,opacity:h}),(0,x.jsx)(V,{point:b,active:!0,opacity:h}),(0,x.jsx)(V,{point:C,opacity:h}),(0,x.jsx)(D,{point:_,opacity:h}),(0,x.jsx)(E,{})]})}function V(e){const{point:t,active:o,opacity:n}=e,r=(0,i().eP)(),a=o?"dark"===r?"#28456C":"#E7F3F8":l().Tj.background.elevated;return(0,x.jsx)("g",{transform:`translate(${t.x-4},${t.y-2})`,opacity:n,children:(0,x.jsx)("rect",{filter:`url(#${o?b:v})`,width:j,height:w,x:"4",y:"2",fill:a,rx:"3"})})}function F(e){const{startPoint:t,endPoint:o}=e,n="dark"===(0,i().eP)()?l().Tj.palette.gray[300]:"#E3E2E0";return(0,x.jsx)("line",{x1:t.x,y1:t.y,x2:o.x,y2:o.y,stroke:n,strokeDasharray:"3 4"})}function D(e){const{point:t,opacity:o}=e;return(0,x.jsxs)("g",{filter:`url(#${C})`,transform:`translate(${t.x},${t.y})`,opacity:o,children:[(0,x.jsx)("path",{fill:"#32302C",d:"M14 12.25h-3.334l2.193 5.294-2.309.956-2.194-5.294L6 15.563l-.75-.75V3.94l1.06-.44L14 11.19v1.06z"}),(0,x.jsx)("path",{stroke:"#fff",fill:"#32302C",strokeWidth:"0.5",d:"M14 12.5h.25v-1.413l-.073-.073-7.69-7.69-.12-.12-.154.065-1.059.44L5 3.775v11.142l.073.073.75.75.177.177.177-.177 2.092-2.091 2.05 4.948.096.23.23-.095 2.31-.956.231-.096-.096-.231-2.05-4.948H14z"})]})}function E(){return(0,x.jsxs)("defs",{children:[(0,x.jsxs)("filter",{id:v,width:j+8,height:w+8,x:"0",y:"0",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,x.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,x.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,x.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_637_7659"}),(0,x.jsx)("feOffset",{}),(0,x.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,x.jsx)("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),(0,x.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_7659"}),(0,x.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,x.jsx)("feOffset",{dy:"2"}),(0,x.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,x.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,x.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,x.jsx)("feBlend",{in2:"effect1_dropShadow_637_7659",result:"effect2_dropShadow_637_7659"}),(0,x.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_637_7659",result:"shape"})]}),(0,x.jsxs)("filter",{id:b,width:j+8,height:w+8,x:"0",y:"0",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,x.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,x.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,x.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_637_5084"}),(0,x.jsx)("feOffset",{}),(0,x.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,x.jsx)("feColorMatrix",{values:"0 0 0 0 0.2 0 0 0 0 0.494118 0 0 0 0 0.662745 0 0 0 0.2 0"}),(0,x.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_5084"}),(0,x.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,x.jsx)("feOffset",{dy:"2"}),(0,x.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,x.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,x.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,x.jsx)("feBlend",{in2:"effect1_dropShadow_637_5084",result:"effect2_dropShadow_637_5084"}),(0,x.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_637_5084",result:"shape"})]}),(0,x.jsxs)("filter",{id:C,width:"17.75",height:"24.244",x:"0.75",y:"0.91",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,x.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,x.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,x.jsx)("feOffset",{dy:"2"}),(0,x.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,x.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,x.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.2 0"}),(0,x.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_4925"}),(0,x.jsx)("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_637_4925",result:"shape"})]})]})}},148079:(e,t,o)=>{o.d(t,{A:()=>p});o(296540);var n=()=>o(484714),i=()=>o(590526),r=()=>o(401497),l=()=>o(807449),a=()=>o(349679),s=()=>o(69708),c=()=>o(100622),d=()=>o(314638),u=o(474848);function p(e){const{menuProps:t,property:o,defaultProperty:n,isChecked:r,propertySchema:l,collectionContextStore:a,handleDefaultPropertySelect:s,handlePropertySelect:c,...p}=e,m=(0,i().O$)(a.canConfigureBlockStore);return(0,u.jsx)(d().G,{...t,disabled:!m,propertySchema:l,format:d().e.Name,onClick:()=>s(o),right:(0,u.jsx)(g,{property:o,isChecked:o===n,collectionContextStore:a,defaultProperty:void 0})})}function g(e){const{property:t,defaultProperty:o,isChecked:d,collectionContextStore:p}=e,g=(0,n().WS)(),m=(0,i().K8)((()=>{var e;return null===(e=p.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString()}),[p]),S=(0,r().IS)((()=>({defaultText:{color:c().Tj.text.secondary,fontSize:12,fontWeight:500,textTransform:"uppercase",marginInlineEnd:4}})),[]);return(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,u.jsx)("div",{style:{...S.defaultText},children:t===o?(0,u.jsx)(s().sA,{defaultMessage:"Default",id:"database.viewSettings.setViewPropertyDefault.defaultProperty.tag",values:{databaseName:m}}):void 0}),d?(0,u.jsx)("div",{style:{...g?{marginInlineStart:"auto",marginInlineEnd:20,minWidth:0,flexShrink:0}:{marginInlineStart:"auto",marginInlineEnd:12,minWidth:0,flexShrink:0},flexShrink:0},children:(0,u.jsx)(l().I,{icon:a().checkmarkSmallIcon,size:"sm"})}):void 0]})}},167068:(e,t,o)=>{o.d(t,{A:()=>l});var n=o(296540),i=o(474848);function r({...e}){const t=(0,o(69708).tz)(),n=(0,o(401497).IS)((()=>({buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,height:24,width:24}})),[]),r=t.formatMessage({defaultMessage:"View options",id:"PersonalHomePanel.moreDropdownButton.tooltip"});return(0,i.jsx)(o(718827).Ay,{ariaLabel:r,style:n.buttonStyle,...e,children:(0,i.jsx)(o(807449).I,{icon:o(126617).ellipsisSmallIcon,size:"sm",colorVariant:"secondary"})})}const l=n.memo(r)},174826:(e,t,o)=>{o.d(t,{Jy:()=>r,NC:()=>l,XK:()=>a});o(898992),o(908872);var n=()=>o(564884);function i(e){const t=e.collectionViewStore(),o=null==t?void 0:t.getDashboardLayoutStore();return((null==o?void 0:o.getDashboardModules())??[]).reduce(((e,t)=>e+t.modules.length),0)}function r(e){const{environment:t,action:o,entrypoint:i,dashboardViewId:r,widgetViewId:l,widgetCount:a}=e;(0,n().u)({environment:t,event:{eventName:"dashboard_customization",eventProperties:{action:o,entrypoint:i,dashboard_view_id:r,widget_view_id:l,widget_count:a}}})}function l(e){const{environment:t,collectionContextStore:o}=e,n=o.collectionViewStore(),l=null==n?void 0:n.id;l&&r({environment:t,action:"build_mode",entrypoint:"header",dashboardViewId:l,widgetCount:i(o)})}function a(e){const{environment:t,collectionContextStore:o}=e,n=o.collectionViewStore(),l=null==n?void 0:n.id;l&&r({environment:t,action:"exit_build_mode",entrypoint:"header",dashboardViewId:l,widgetCount:i(o)})}},197730:(e,t,o)=>{o.d(t,{Sk:()=>l,we:()=>r,yQ:()=>i});var n=()=>o(534177);const i=["small","medium","large","extra_large"];function r(e){switch(e){case"small":return 300;case"medium":return 400;case"large":return 600;case"extra_large":return 800;default:(0,n().HB)(e)}}function l(e,t){var o;if(null!=e&&null!==(o=e.map_config)&&void 0!==o&&o.height)return e.map_config.height;switch(t){case"full_page":return"large";case"inline":case"unknown":return"medium"}}},203941:(e,t,o)=>{o.d(t,{GS:()=>qt,gt:()=>$t,CJ:()=>Qt,Ct:()=>Zt});o(16280),o(898992),o(354520);var n=o(296540),i=()=>o(564884),r=()=>o(907258),l=()=>o(59226),a=()=>o(726637),s=()=>o(312788),c=()=>o(484714),d=()=>o(590526),u=()=>o(401497),p=()=>o(929219),g=()=>o(324826),m=()=>o(406094),S=()=>o(631524),y=()=>o(736847),f=()=>o(584262),h=()=>o(743472),x=()=>o(651124),v=()=>o(187174),b=()=>o(47218),C=()=>o(582684),j=()=>o(202017),w=()=>o(89849),A=()=>o(566910),I=()=>o(200582),_=()=>o(406533),T=()=>o(871151),k=()=>o(969523),M=()=>o(69708),P=()=>o(100622),B=()=>o(496603),V=()=>o(208459),F=()=>o(436696),D=()=>o(989992),E=()=>o(837570),O=()=>o(206267),R=()=>o(896628),K=()=>o(35091),N=()=>o(48382),z=()=>o(547149),L=()=>o(535959),U=o(474848);function W({collectionContextStore:e,collectionSettingsStore:t}){const o=(0,c().v3)(),i=(0,d().O$)(e.canConfigureBlockStore),{isSupported:r,isLoading:l}=(0,L().G)(),a=(0,d().K8)((()=>e.collectionViewStore()),[e]),s=(0,d().K8)((()=>{if(!a)return!0;return a.getFormatStore().getKeyStore("show_widget_view_icon").getValue()??!1}),[a]),u=(0,n.useRef)(O().JW()),p=(0,n.useCallback)((()=>{a&&i&&(z().createAndCommit({userAction:"DashboardSettingsMain.handleToggleShowViewIcons",environment:o,canUndo:!0,perform:e=>{R().zA({stores:[a],update:{show_widget_view_icon:!s},transaction:e})}}),(0,F().X)({environment:o,collectionContextStore:e,action:"toggle_show_widget_view_icon"}))}),[e,a,o,s,i]);return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(y().A,{extraPadding:!0,topBorder:!1,children:a?(0,U.jsx)(K().A,{title:(0,U.jsx)(M().sA,{defaultMessage:"Show view icons",id:"database.dashboardSettings.showViewIcons"}),showChevron:!1,switcherProps:{inputId:u.current,on:s,noColor:!1},onClick:p,disabled:!i||!l&&!r}):null}),(0,U.jsx)(y().A,{extraPadding:!1,topBorder:!0,children:(0,U.jsx)(N().z,{collectionContextStore:e,collectionSettingsStore:t})})]})}var H=()=>o(127833),$=()=>o(284371),G=()=>o(339798),Q=()=>o(497222),q=()=>o(908201);const Y=n.memo((function({handleAddItemClick:e,store:t,disableTemplatesDropdown:i}){const r=(0,q().ET)(),l=(0,d().K8)((()=>r.settingsStore),[r]),s=(0,c().v3)(),p=(0,n.useRef)(null),g=(0,n.useCallback)((t=>{G().Ub({environment:s,handleAddItemClick:e,buttonRef:p,event:t})}),[s,e,p]),m=(0,u().IS)((()=>({newPageIcon:{fill:P().Tj.blue.icon.accentPrimary},desktopTitle:{color:P().Tj.blue.text.accentPrimary,fontWeight:$().Wy.medium}})),[]),S=(0,n.useCallback)((t=>{i?g(t):e(t),G().os({collectionSettingsStore:l})}),[i,g,e,l]);return(0,U.jsx)(o(776547).m,{store:t,popupType:a().A.isMobile?H().nl.BottomSheet:H().nl.Popup,renderOrigin:e=>(0,U.jsx)(o(718827).Ay,{ref:p,ignoreLocalHoverState:!0,children:(0,U.jsxs)(y().A,{children:[(0,U.jsx)(Q().A,{icon:o(480034).q,iconStyle:m.newPageIcon,title:(0,U.jsx)(M().sA,{defaultMessage:"New page",id:"database.collectionViewAddItemButton.newPageButton.title"}),showChevron:!1,desktopTitleStyle:m.desktopTitle,onClick:S}),i?void 0:(0,U.jsx)(Q().A,{icon:o(920495).pageIcon,title:(0,U.jsx)(M().sA,{defaultMessage:"Page templates",id:"database.collectionViewAddItemButton.pageTemplatesButton.title"}),showChevron:!0,onClick:e.onClick})]})}),placementToOrigin:"left"})}));var X=()=>o(654062),J=()=>o(637558),Z=()=>o(680288),ee=()=>o(152077),te=()=>o(635462),oe=()=>o(492414),ne=()=>o(267584),ie=()=>o(957606),re=()=>o(988291),le=()=>o(287940),ae=()=>o(955450),se=()=>o(379547),ce=()=>o(162674),de=()=>o(944027),ue=()=>o(885749),pe=()=>o(696746),ge=()=>o(665579),me=()=>o(610101),Se=()=>o(468397),ye=()=>o(619206),fe=()=>o(559378),he=()=>o(637759),xe=()=>o(969318),ve=()=>o(647702),be=()=>o(65402),Ce=()=>o(719889),je=()=>o(807449),we=()=>o(302501),Ae=()=>o(642557),Ie=()=>o(916727);function _e(e){const{style:t}=e,o=(0,c().WS)(),n=(0,U.jsx)("div",{style:{marginTop:1,marginInlineEnd:6},children:(0,U.jsx)(je().I,{icon:Ae().lockSmallIcon,size:"sm"})}),i=(0,U.jsx)(we().A,{style:{color:P().Tj.text.primary,lineHeight:$().K_.UISmall.desktop},isSmall:!0,children:(0,U.jsx)(M().sA,{defaultMessage:"Youâ€™re a content editor",id:"database.viewSettings.mainTab.contentOnlyEditorPill.title"})});return(0,U.jsx)(Ie().F,{icon:n,title:i,style:o?{backgroundColor:P().Tj.background.secondary,boxShadow:P().Tj.shadow2XS,margin:void 0,borderRadius:void 0,...t}:{background:"rgba(196, 196, 196, 0.13)",margin:"8px 14px",...t},showCloseButton:!1,children:(0,U.jsx)(we().A,{style:{marginInlineStart:22},isSmall:!0,isMultiline:!0,children:(0,U.jsx)(M().sA,{defaultMessage:"Content editors can edit pages, but cannot change view and database settings.",id:"database.viewSettings.mainTab.contentOnlyEditorPill.subtitle"})})})}var Te=()=>o(705602),ke=()=>o(735695),Me=()=>o(635019),Pe=()=>o(751704),Be=()=>o(459004),Ve=()=>o(812480),Fe=()=>o(614525),De=()=>o(364871),Ee=()=>o(704640),Oe=()=>o(395859),Re=()=>o(542984),Ke=()=>o(785285),Ne=()=>o(933152),ze=()=>o(680977),Le=()=>o(370493),Ue=()=>o(147294);function We(e){const{collectionContextStore:t,collectionSettingsStore:o,disabled:l=!1}=e,a=(0,c().v3)(),s=(0,d().K8)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()}),[t]),p=(0,d().K8)((()=>t.normalizedFormatStore.state.conditional_color_rules),[t.normalizedFormatStore]),g=(0,d().O$)(t.canConfigureBlockStore),m=function(){const e=(0,Ue().oG)("conditional_color_feature"),t=(0,d().K8)((()=>{var e;return Boolean(null===(e=r().default.state.currentUserSettingsStore)||void 0===e?void 0:e.hasClickedConditionalColorButton())}),[]);return e&&!t}(),S=(0,n.useCallback)((()=>{!function(e){const{environment:t}=e,{currentUserSettingsStore:o}=r().default.state;if(!o)return;z().createAndCommit({environment:t,userAction:"userClickedConditionalColorButton",canUndo:!1,cellTarget:"main",perform:e=>(0,ze().m)({userSettingsStore:o,transaction:e,data:{collection_conditional_color_button_clicked_at:Date.now()}})})}({environment:a});const e=p&&p.length>0;G().a2({collectionSettingsStore:o,item:e?{type:"conditionalColors"}:{type:"createConditionalColor"}}),(0,i().u)({environment:a,event:{eventName:"conditional_color_menu_click",eventProperties:(0,Le().JO)({collectionContextStore:t})}})}),[t,o,p,a]),y=(0,u().IS)((()=>({titleContainer:{display:"flex",alignItems:"center",gap:6}})),[]);return s&&(0,Ke().fu)(s)?(0,U.jsx)(Q().A,{icon:Ne().M,title:(0,U.jsxs)("div",{style:y.titleContainer,children:[(0,U.jsx)(M().sA,{defaultMessage:"Conditional color",id:"database.viewSettings.mainTab.colorButton.title"}),(0,U.jsx)(Ue().Ee,{newBadgeKey:"conditional_color_feature",keyType:"date",didUserEngage:!m})]}),showChevron:!0,onClick:S,disabled:l||!g}):null}var He=()=>o(83486),$e=()=>o(536583),Ge=()=>o(594952),Qe=()=>o(617668),qe=()=>o(236262),Ye=()=>o(84262),Xe=()=>o(232930),Je=()=>o(937199),Ze=()=>o(3197),et=()=>o(528093),tt=()=>o(704658),ot=()=>o(95441),nt=()=>o(58488);function it(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,n=(0,l().X)("forms_apply_template"),i=(0,d().K8)((()=>t.collectionViewStore()),[t]),r=(0,d().K8)((()=>{if(!i)throw new Error("No CollectionViewStore found");return i.getFormBlockStore()}),[i]),a=(0,d().K8)((()=>{const e=t.collectionViewBlockStore();return!!e&&e.getCollectionViewIds().length>1}),[t]);return i&&r?(0,U.jsxs)(nt().I,{children:[(0,U.jsxs)(y().A,{children:[(0,U.jsx)(rt,{}),(0,U.jsx)(qt,{collectionSettingsStore:o,collectionContextStore:t}),(0,U.jsx)(lt,{collectionSettingsStore:o,collectionContextStore:t}),n?(0,U.jsx)(at,{collectionSettingsStore:o}):void 0]}),(0,U.jsx)(y().A,{extraPadding:!0,topBorder:!0,children:(0,U.jsx)(Re().Q,{collectionContextStore:t,collectionSettingsStore:o,disabled:!0})}),(0,U.jsxs)(y().A,{topBorder:!0,children:[a?(0,U.jsx)(st,{collectionSettingsStore:o,collectionContextStore:t,collectionViewStore:i,formBlockStore:r}):void 0,(0,U.jsx)(ct,{})]})]}):null}function rt(){const{canEditLayout:e}=(0,Je().LH)(),t=(0,Ze().t)({area:"form_layout_schema"});return(0,U.jsx)(Q().A,{icon:Qe().plusIcon,title:(0,U.jsx)(M().sA,{id:"formEditSettings.newQuestion.title",defaultMessage:"New question"}),onClick:t,disabled:!e})}function lt({collectionSettingsStore:e,collectionContextStore:t}){const{userId:o,spaceId:n,spaceStore:i}=(0,d().K8)((()=>{var e,o,n;return{userId:null===(e=r().default.state.currentUserStore)||void 0===e?void 0:e.id,spaceId:null===(o=t.collectionStore())||void 0===o?void 0:o.getSpaceId(),spaceStore:null===(n=t.collectionStore())||void 0===n?void 0:n.getSpaceStore()}}),[t]),l=(0,et()._)({name:"form_customization",spaceId:n,userId:o}),a="unavailable"===(null==l?void 0:l.type)&&(0,Ye().wy)(l.upsell);return(0,U.jsx)(Q().A,{onClick:()=>{G().a2({collectionSettingsStore:e,item:{type:"formCustomizeSettings"}})},icon:Ge().I,title:(0,U.jsxs)("div",{style:{display:"flex",alignItems:"center",height:20,gap:5},children:[(0,U.jsx)(M().sA,{defaultMessage:"Submit screen",id:"formEditSettings.customizeForm.title"}),a?(0,U.jsx)(tt().UpgradeButton,{display:"icon",upsell:l.upsell,source:"forms_customize_settings",showPlanName:!0,spaceStore:i}):void 0]}),showChevron:!0})}function at({collectionSettingsStore:e}){return(0,U.jsx)(Q().A,{onClick:()=>{G().a2({collectionSettingsStore:e,item:{type:"formSelectTemplate"}})},icon:$e().d,title:(0,U.jsx)(M().sA,{defaultMessage:"Select template",id:"formEditSettings.selectTemplate.title"}),showChevron:!0})}function st({collectionContextStore:e,collectionSettingsStore:t,collectionViewStore:o,formBlockStore:i}){const{canEditLayout:r}=(0,Je().LH)(),l=(0,c().v3)(),a=(0,M().tz)(),s=(0,n.useCallback)((async()=>{await G().nl({intl:a,environment:l,collectionContextStore:e,collectionViewStore:o,collectionSettingsStore:t,additionalBlocksToDelete:[i],from:"view_settings"})}),[a,l,e,o,t,i]);return(0,U.jsx)(Q().A,{icon:qe().trashIcon,title:(0,U.jsx)(M().sA,{id:"formEditSettings.deleteForm.title",defaultMessage:"Delete form"}),onClick:s,disabled:!r})}function ct(){return(0,U.jsx)(ot().A,{title:(0,U.jsx)(M().sA,{defaultMessage:"Learn about forms",id:"formEditSettings.learnAboutForms.title"}),href:(0,Xe().x)("guides.forms"),analyticsFrom:"form_edit_settings"})}var dt=()=>o(448701),ut=()=>o(62616),pt=()=>o(810521);function gt({collectionContextStore:e}){const t=(0,c().v3)(),o=(0,n.useMemo)((()=>O().JW()),[]),i=(0,U.jsx)(M().sA,{defaultMessage:"Manage data sources",id:"database.viewSettings.mainTab.manageDataSources.title"}),r=(0,n.useCallback)((()=>{var n;(0,pt().trackManageDataSources)(t,{data_source_session_id:o,collection_view_block_id:null===(n=e.collectionViewBlockStore())||void 0===n?void 0:n.id}),G().a2({collectionSettingsStore:e.settingsStore,item:{type:"manageDataSources",analytics:{dataSourceSessionId:o,dataSourceFrom:"manage_data_sources"}}})}),[t,o,e]);return(0,U.jsx)(Q().A,{showChevron:!0,icon:ut().c,title:i,onClick:r})}o(581454);var mt=()=>o(197730);const St=(0,M().YK)({small:{defaultMessage:"Small",id:"database.viewSettings.layoutTab.mapHeight.small"},medium:{defaultMessage:"Medium",id:"database.viewSettings.layoutTab.mapHeight.medium"},large:{defaultMessage:"Large",id:"database.viewSettings.layoutTab.mapHeight.large"},extra_large:{defaultMessage:"Extra large",id:"database.viewSettings.layoutTab.mapHeight.extra_large"}}),yt=(0,M().YK)({mapStyle:{defaultMessage:"Style",id:"database.viewSettings.mapTab.mapStyle.title"}}),ft=n.memo((function({collectionSettingsStore:e}){const t=(0,c().v3)(),o=(0,M().tz)(),i=(0,q().ET)(),l=(0,d().K8)((()=>i.collectionViewStore()),[i]),a=(0,d().O$)(i.isInHomeWidgetStore),s=(0,d().K8)((()=>{var e;const t=null===(e=i.collectionViewBlockStore())||void 0===e?void 0:e.id;return!!t&&(0,te().s)(t)}),[i]),p=(0,n.useMemo)((()=>s?{feature:"tasks",from:"tasks_more_menu"}:{feature:"custom_db",from:"custom_db_more_menu"}),[s]),g=(0,n.useCallback)((()=>{r().default.state.sidebarSpaceViewStore&&de().WO({environment:t,currentSpaceViewStore:r().default.state.sidebarSpaceViewStore,...p})}),[t,p]),m=!(0,d().O$)(i.canConfigureBlockStore),S=(0,u().IS)((()=>({layoutSection:{paddingTop:0,paddingBottom:4},heightSection:{paddingTop:4},heightSectionMobile:{boxShadow:"none"},titleStyle:{opacity:m?.4:void 0}})),[m]),f=(0,d().K8)((()=>i.isPeopleCollection()),[i]);return l?(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(y().A,{extraPadding:!0,style:S.layoutSection,children:(0,U.jsx)(Zt,{collectionContextStore:i,collectionSettingsStore:e})}),(0,U.jsx)(y().A,{extraPadding:!0,topBorder:!0,style:S.heightSection,title:o.formatMessage(yt.mapStyle),mobileStyle:S.heightSectionMobile,desktopTitleStyle:S.titleStyle,mobileTitleStyle:S.titleStyle,children:(0,U.jsx)(xt,{collectionContextStore:i,disabled:m})}),(0,U.jsx)(ht,{collectionContextStore:i,collectionSettingsStore:e,disabled:m}),(0,U.jsxs)(y().A,{extraPadding:!0,topBorder:!0,children:[(0,U.jsx)(N().z,{collectionContextStore:i,collectionSettingsStore:e}),a?(0,U.jsx)(Q().A,{icon:A().e,title:o.formatMessage(ue().u.hide),showChevron:!1,onClick:g}):null]}),f?(0,U.jsx)(He().Y,{collectionContextStore:i,collectionSettingsStore:e}):void 0]}):null}));function ht(e){const{collectionContextStore:t,collectionSettingsStore:o,disabled:n}=e;return(0,U.jsxs)(y().A,{extraPadding:!0,topBorder:!0,children:[(0,U.jsx)(Re().Q,{collectionContextStore:t,collectionSettingsStore:o,disabled:n}),(0,U.jsx)(Ee().A,{collectionContextStore:t,collectionSettingsStore:o,disabled:n}),(0,U.jsx)(We,{collectionContextStore:t,collectionSettingsStore:o,disabled:n})]})}function xt({collectionContextStore:e,disabled:t}){const i=(0,c().v3)(),r=(0,M().tz)(),l=(0,o(943666).N)(e),a=(0,d().K8)((()=>(0,mt().Sk)(e.normalizedFormatStore.state,l)),[e,l]),s=(0,n.useCallback)((t=>{const o=e.collectionViewStore();o&&z().createAndCommit({userAction:"MapSettingsMain.handleMapHeightChange",environment:i,canUndo:!0,perform:e=>{R().zA({stores:[o],update:{map_config:{height:t}},transaction:e})}})}),[e,i]),u=(0,n.useMemo)((()=>mt().yQ.map((e=>({key:e,type:"button",title:r.formatMessage(St[e])})))),[r]);return(0,U.jsx)(o(828973).A,{title:(0,U.jsx)(M().sA,{defaultMessage:"Height",id:"database.viewSettings.layoutTab.mapHeight.title"}),collectionContextStore:e,selectedKey:a,popupStyle:{minWidth:190},options:u,onChange:s,disabled:t})}o(944114),o(737550);var vt=()=>o(245720),bt=()=>o(250910),Ct=()=>o(118307),jt=()=>o(546926),wt=()=>o(890492),At=()=>o(663639),It=()=>o(3284),_t=()=>o(457056),Tt=()=>o(589407),kt=()=>o(18953),Mt=()=>o(173614),Pt=()=>o(167170),Bt=()=>o(374562),Vt=()=>o(811979),Ft=()=>o(739222),Dt=()=>o(95347),Et=()=>o(499764),Ot=()=>o(447934),Rt=()=>o(400851),Kt=()=>o(527438);function Nt(e){const{collectionContextStore:t,collectionSettingsStore:o,isConfiguringViewsMainModule:n}=e,i=!(0,d().O$)(p().e),r=function({collectionContextStore:e}){return(0,d().K8)((()=>{const t=e.permissionScopesStore.state;if(!(t.canConfigureCollection||t.canConfigureBlock))return!0;const o=e.collectionStore();return!o||((0,Et().qe)(o)||(0,Et().X6)(o))}),[e])}({collectionContextStore:t})||i,l=(0,d().uB)(void 0,Ct().A),s=(0,d().O$)(l).open,c=(0,U.jsx)(M().sA,{defaultMessage:"More settings",id:"database.viewSettings.mainTab.moreSettingsButton.title"});return(0,U.jsx)(Vt().A,{focused:!1,buttonPopupStore:l,alignmentToOrigin:"end",placementToOrigin:"bottom",popupType:a().A.isMobile?bt().z.BottomSheet:bt().z.Popup,bottomSheetInitialState:"half",renderOrigin:e=>(0,U.jsx)(Q().A,{...e,icon:Tt().ellipsisIcon,title:c,showChevron:!0,rotateChevron:s,disabled:r}),render:e=>(0,U.jsx)(zt,{title:c,collectionContextStore:t,collectionSettingsStore:o,onClose:e.close,isConfiguringViewsMainModule:n})})}function zt({title:e,collectionContextStore:t,collectionSettingsStore:o,onClose:i,isConfiguringViewsMainModule:r}){const l=function({collectionContextStore:e,collectionSettingsStore:t,onClose:o,isConfiguringViewsMainModule:i}){const r=(0,c().v3)(),l=(0,Dt().rD)(e),a=(0,Bt().md)(),s=(0,Bt().J4)(),{canHaveSprints:u,canTurnIntoTasks:p}=(0,d().K8)((()=>({canHaveSprints:(0,Ft().cM)(e),canTurnIntoTasks:(0,Ft().Y7)(e,l)})),[e,l]),g=(0,d().K8)((()=>(0,Ft().YQ)(Ft().YX,e)),[e]),m=(0,d().K8)((()=>{var t;if(!p)return!1;const o=null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.getOwnedCollectionStores().some((e=>e.isTypedCollection()));return!(!g&&o)}),[e,p,g]),S=(0,d().K8)((()=>{var t;return null===(t=e.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.subitem_property}),[e]),y=(0,d().K8)((()=>(0,Kt().jx)({collectionContextStore:e})),[e]),f=(0,Dt().hw)(e,t),x=Wt({collectionContextStore:e,from:"customize_database_button_in_more_settings_menu"}),v=(0,n.useCallback)((()=>{G().a2({collectionSettingsStore:t,item:{type:"sprintSettings",from:"more_settings"}})}),[t]),b=(0,n.useMemo)((()=>g?(0,Ft().tQ)({environment:r,collectionContextStore:e}):()=>(0,Ft().$M)({environment:r,collectionContextStore:e})),[g,r,e]),C=(0,n.useCallback)((t=>(0,Dt().Dj)({collectionContextStore:e,feature:t,appConfig:l})?(0,U.jsx)(M().sA,{defaultMessage:"On",id:"database.viewSettings.mainTab.featureStatusLabel.on"}):null),[e,l]),j=(0,n.useMemo)((()=>({key:"sprints",render:e=>(0,U.jsx)(Q().A,{icon:kt().H,title:Ft().RH.name,right:C(Ft().RH),showChevron:!0,menuListItemProps:e}),action:v})),[v,C]),w=(0,n.useMemo)((()=>({key:"tasks",render:e=>(0,U.jsx)(Q().A,{icon:It().arrowSquarePathUpDownIcon,title:g?(0,U.jsx)(M().sA,{defaultMessage:"Undo Task database",id:"database.viewSettings.mainTab.undoTaskDatabaseButton.title"}):(0,U.jsx)(M().sA,{defaultMessage:"Turn into Tasks",id:"database.viewSettings.mainTab.turnIntoTasksButton.title"}),showChevron:!0,menuListItemProps:e}),action:()=>{b(),o()}})),[b,g,o]),A=(0,n.useMemo)((()=>({key:"subItems",render:t=>(0,U.jsx)(Be().I,{collectionContextStore:e,right:C(a),onClick:()=>f(a),menuListItemProps:t}),action:()=>f(a)})),[e,C,f,a]),I=(0,n.useMemo)((()=>({key:"dependencies",render:e=>(0,U.jsx)(Q().A,{icon:_t().o,title:s.name,right:C(s),showChevron:!0,menuListItemProps:e}),action:()=>f(s)})),[s,C,f]),_=(0,n.useMemo)((()=>({key:"connections",render:o=>(0,U.jsx)(Ut,{collectionContextStore:e,collectionSettingsStore:t,menuListItemProps:o}),action:()=>G().a2({collectionSettingsStore:t,item:{type:"connectionFeatures"}})})),[e,t]),T=(0,n.useMemo)((()=>({key:"customizeLayout",render:t=>(0,U.jsx)(Lt,{collectionContextStore:e,menuListItemProps:t}),action:x})),[e,x]),k=(0,n.useMemo)((()=>{const e=[I];return!S&&(0,h().BF)(y)&&e.unshift(A),u&&e.push(j),i||(e.push(_),e.push(T),m&&e.push(w)),e}),[u,m,_,T,I,i,j,A,S,w,y]);return k}({collectionContextStore:t,collectionSettingsStore:o,onClose:i,isConfiguringViewsMainModule:r}),s=(0,n.useMemo)((()=>[{key:"moreSettings",render:e=>(0,U.jsx)(y().A,{...e}),items:l}]),[l]),u=(0,n.useMemo)((()=>a().A.isMobile?{title:e,menuType:jt().gu.Modal,right:(0,U.jsx)(M().sA,{...vt().W.done}),onClickRight:i}:{menuType:jt().gu.Popup,width:250}),[e,i]);return(0,U.jsx)(wt().A,{...u,children:(0,U.jsx)(At().A,{type:At().O.Vertical,sections:s,initialFocus:void 0,resetFocusOnMouseOut:!0})})}function Lt({collectionContextStore:e,menuListItemProps:t}){const o=(0,c().v3)(),n=(0,d().K8)((()=>e.collectionViewBlockStore()),[e]),i=Wt({collectionContextStore:e,from:"customize_database_button_in_customize_menu"}),r=(0,Rt().X)({environment:o,blockStore:n,from:"collectionSettingsMenu"});return n&&r?(0,U.jsx)(Q().A,{icon:Pt()._,onClick:i,showChevron:!0,title:(0,U.jsx)(M().sA,{defaultMessage:"Customize page layout",id:"database.viewSettings.customizeMenu.customizeLayout"}),menuListItemProps:t}):null}function Ut(e){const{collectionContextStore:t,collectionSettingsStore:o,menuListItemProps:n}=e,i=(0,Ft().ph)(t),{addedFeatures:r}=(0,Dt().Ro)(t,i),l=r.length;return(0,U.jsx)(Q().A,{icon:Mt().c,onClick:()=>G().a2({collectionSettingsStore:o,item:{type:"connectionFeatures"}}),right:l>0?l:void 0,showChevron:!0,title:(0,U.jsx)(M().sA,{defaultMessage:"Connections",id:"database.viewSettings.customizeMenu.connections.title"}),menuListItemProps:n})}function Wt({collectionContextStore:e,from:t}){const o=(0,c().v3)();return(0,n.useCallback)((()=>{const n=e.collectionStore(),i=e.collectionViewBlockStore();i&&n&&(0,Ot().nh)({environment:o,blockStore:i,collectionStore:n,collectionViewStore:e.collectionViewStore(),from:t})}),[e,o,t])}const Ht=o(757695).Store.createClass(!1,{name:"ShowViewDescriptionStore"});function $t(e){const{collectionContextStore:t,collectionViewStore:o,selectViewNameInitial:i,collectionSettingsStore:r,handleAddItemClick:s}=e,u=(0,c().v3)(),p=(0,d().uB)(void 0,Ht),g=(0,d().O$)(t.isInHomeWidgetStore),m=(0,d().K8)((()=>t.isInLibraryBlock()),[t]),S=(0,ee().lU)(),f="PersonalHome"===S||"TeamHome"===S,h=(0,d().K8)((()=>{var e;const o=null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id;return!!o&&(0,te().s)(o)}),[t]),x=(0,n.useCallback)((e=>function(e,t,o,n){const i=null==n?void 0:n.getFormat().description;if(!n||e===i)return;z().createAndCommit({userAction:"CollectionSettingsViewMain.handleDescriptionChange",environment:t,canUndo:!0,perform:t=>{(0,X().F)({collectionViewStore:n,update:{format:{...n.getFormat(),description:e}},transaction:t})}}),(0,F().X)({environment:t,collectionContextStore:o,action:"set_description"})}(e,u,t,o)),[u,t,o]),v=(0,d().K8)((()=>t.collectionViewBlockStore()),[t]),b=(0,d().K8)((()=>o.isDefined()),[o]),C=(0,d().K8)((()=>o.getFormat().description),[o]),j=(0,d().K8)((()=>o.getType()),[o]),w=(0,d().O$)(p),A=(0,d().K8)((()=>"viewsMain"===t.viewsModuleContextStore.getViewModuleType()),[t]),I=(0,d().K8)((()=>t.collectionViewBlockStore()),[t]),_=(0,d().K8)((()=>{const e=r.state.showAddItemButton;return!!(s&&e&&I)}),[s,r,I]),T=(0,d().K8)((()=>t.isMultiSourceViewFromStoreState),[t]),k=(0,l().X)("db_page_view"),P=(0,re().X)(t);if(!b||!v)return null;const B=m?null:(0,U.jsx)(Oe().A,{collectionViewStore:o,collectionContextStore:t,showViewDescriptionStore:p,selectViewNameInitial:i,topBorder:_,sectionStyle:{marginTop:_&&!T?5:void 0}});if("page"===j)return!k||A?(0,U.jsxs)(ke().A,{...e,title:(0,U.jsx)(M().sA,{...fo.viewSettings}),children:[B,w?(0,U.jsx)(Te().y,{initialDescription:C,handleSaveDescription:x}):void 0]}):(0,U.jsxs)(ke().A,{...e,title:(0,U.jsx)(M().sA,{...fo.viewSettings}),children:[B,w?(0,U.jsx)(Te().y,{initialDescription:C,handleSaveDescription:x}):void 0,(0,U.jsx)(y().A,{style:{paddingBottom:12},children:(0,U.jsx)(Me().f,{collectionContextStore:t,collectionSettingsStore:r})})]});let V;if("chart"===j)V=(0,U.jsx)(Ce().X,{collectionSettingsStore:r});else if("map"===j)V=(0,U.jsx)(ft,{collectionSettingsStore:r});else if("dashboard"===j)V=(0,U.jsx)(W,{collectionContextStore:t,collectionSettingsStore:r});else if("form_editor"===j)V=(0,U.jsx)(it,{collectionContextStore:t,collectionSettingsStore:r});else{if(f)return(0,U.jsx)(mo,{collectionContextStore:t,collectionSettingsStore:r});if(h)V=(0,U.jsx)(ao,{collectionContextStore:t,collectionSettingsStore:r,inHomeWidget:g});else{if(g)return(0,U.jsx)(go,{collectionContextStore:t,collectionSettingsStore:r,viewNameInput:B,addItemSection:_&&s&&I?(0,U.jsx)(Y,{handleAddItemClick:s,store:I,disableTemplatesDropdown:T}):void 0});V=P?(0,U.jsx)(co,{collectionContextStore:t,collectionSettingsStore:r}):m?(0,U.jsx)(so,{collectionContextStore:t,collectionSettingsStore:r}):(0,U.jsx)(po,{collectionContextStore:t,collectionSettingsStore:r,isConfiguringViewsMainModule:A})}}let D=fo.viewSettings;return"form_editor"===j?D=fo.formSettings:a().A.isMobile&&(D=fo.mobileSettings),(0,U.jsxs)(ke().A,{...e,title:(0,U.jsx)(M().sA,{...D}),hideDesktopHeader:_,desktopTitleType:"chart"===j||"map"===j||"form_editor"===j?"mainTitle":"sectionHeader",children:[(0,U.jsx)(Qt,{collectionContextStore:t}),_&&s&&I?(0,U.jsx)(Y,{handleAddItemClick:s,store:I,disableTemplatesDropdown:T}):void 0,B,w?(0,U.jsx)(Te().y,{initialDescription:C,handleSaveDescription:x}):void 0,V]})}function Gt(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}function Qt({collectionContextStore:e}){return(0,d().K8)((()=>{const t=e.collectionViewBlockStore();return t&&"content_only_editor"!==t.getRole()}),[e])?null:(0,U.jsx)(_e,{})}function qt({collectionContextStore:e,collectionSettingsStore:t}){const o=(0,c().v3)(),n=(0,d().K8)((()=>(0,he().aS)(e)),[e]),i=(0,d().O$)(e.aliveAutomationCountStore),r=(0,d().K8)((()=>e.collectionStore()),[e]),[{value:l}]=(0,v().Yb)((async()=>await(0,he().rc)({collectionStore:r})),[r]),a=!(0,d().O$)(p().e),s=0===i&&a;return n?(0,U.jsx)(Q().A,{icon:I().m,onClick:()=>{const n=V().H(t);!l||i>0?G().a2({collectionSettingsStore:t,item:{source:"collection_view_settings",type:"automationSettings",from:n}}):E().h({environment:o,mode:"create_automation",collectionContextStore:e,collectionSettingsStore:t,from:n})},right:i>0?i:void 0,showChevron:!0,title:(0,U.jsx)(M().sA,{defaultMessage:"Automations",id:"database.viewSettings.mainTab.automations.title"}),disabled:s}):null}function Yt(e){const{collectionContextStore:t,collectionSettingsStore:o,disabled:n=!1}=e,i=(0,c().v3)(),r=(0,d().K8)((()=>Gt(t)),[t]),l="board"===r?{groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}:{groupByKey:"collection_group_by",groupsFormatKey:"collection_groups"},a=(0,d().O$)(t.normalizedSchemaStore),s=(0,d().O$)(t.normalizedFormatStore)[l.groupByKey],u=(0,d().O$)(t.permissionScopesStore);return!("calendar"===r||"feed"===r)?(0,U.jsx)(Q().A,{icon:"board"===r?k().q:T().p,title:(0,U.jsx)(M().sA,{defaultMessage:"Group",id:"database.viewSettings.mainTab.groupButton.title"}),showChevron:!0,right:(0,U.jsx)(Ve().dU,{groupByPropertySchema:s?a[s.property]:void 0}),onClick:()=>{var e;(0,F().X)({environment:i,collectionContextStore:t,action:"click_group",original_view_type:r,property_type:s?null===(e=a[s.property])||void 0===e?void 0:e.type:void 0}),t.isLoadingStore.state||t.loadingDetailsStore.setState({type:"load_groups_menu"}),G().a2({collectionSettingsStore:o,item:s?{type:"group",...l}:{type:"groupByProperty",...l}})},disabled:n||!s&&!u.canConfigureBlock}):null}function Xt(e){const{collectionContextStore:t,collectionSettingsStore:o,disabled:n=!1}=e,i=(0,c().v3)(),r=(0,d().K8)((()=>Gt(t)),[t]),l=(0,d().O$)(t.normalizedSchemaStore),a=(0,d().O$)(t.normalizedFormatStore).collection_group_by,s={groupByKey:"collection_group_by",groupsFormatKey:"collection_groups"},u=(0,d().O$)(t.permissionScopesStore);return"board"===r?(0,U.jsx)(Q().A,{icon:T().p,title:(0,U.jsx)(M().sA,{defaultMessage:"Sub-group",id:"database.viewSettings.mainTab.subGroupButton.title"}),showChevron:!0,right:(0,U.jsx)(Ve().dU,{groupByPropertySchema:a?l[a.property]:void 0}),onClick:()=>{var e;(0,F().X)({environment:i,collectionContextStore:t,action:"click_subgroup",original_view_type:r,property_type:a?null===(e=l[a.property])||void 0===e?void 0:e.type:void 0}),t.isLoadingStore.state||t.loadingDetailsStore.setState({type:"load_groups_menu"}),G().a2({collectionSettingsStore:o,item:a?{type:"group",...s}:{type:"groupByProperty",...s}})},disabled:n||!a&&!u.canConfigureBlock}):null}const Jt="layout";function Zt(e){const{collectionContextStore:t,collectionSettingsStore:o,disabled:n=!1}=e,i=(0,c().v3)(),{collectionViewStore:r,collectionViewType:l}=(0,d().K8)((()=>{const e=t.collectionViewStore();return{collectionViewStore:e,collectionViewType:null==e?void 0:e.getType()}}),[t]);return r&&l?(0,U.jsx)(Q().A,{disabled:n,icon:Z().ZU[l],title:(0,U.jsx)(M().sA,{defaultMessage:"Layout",id:"database.viewSettings.mainTab.layoutButton.title"}),showChevron:!0,right:Z().to[l],onClick:()=>{(0,F().X)({environment:i,collectionContextStore:t,action:"click_layout",from:"collection_view_more_menu"}),G().a2({collectionSettingsStore:o,item:{type:Jt}})}}):null}function eo(e){const{collectionContextStore:t,collectionSettingsStore:o,disabled:n=!1}=e,i=(0,c().v3)(),r=(0,d().O$)(t.normalizedFormatStore),l=(0,d().K8)((()=>Gt(t)),[t]),a=(0,d().K8)((()=>(0,x().u9)(l)),[l]);if("chart"===l||"map"===l||"form_editor"===l)return(0,U.jsx)(U.Fragment,{});const s=((a?r[a]:void 0)||[]).filter((e=>Boolean(e.visible))).length;return(0,U.jsx)(Q().A,{icon:j().n,disabled:n,title:(0,U.jsx)(M().sA,{defaultMessage:"Properties",id:"database.viewSettings.mainTab.propertiesButton.title"}),showChevron:!0,right:(0,U.jsx)(M().sA,{defaultMessage:"{propertiesShown} shown",id:"database.viewSettings.mainTab.propertiesButton.propertiesShown.title",values:{propertiesShown:s}}),onClick:()=>{(0,F().X)({environment:i,collectionContextStore:t,action:"click_properties"}),G().a2({collectionSettingsStore:o,item:{type:"properties",timelineViewTab:"timeline"}})}})}function to(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,n=(0,c().v3)(),i=(0,d().O$)(t.normalizedFormatStore),r=(0,d().K8)((()=>Gt(t)),[t]),l=(0,d().K8)((()=>(0,x().u9)(r)),[r]);if("chart"===r||"map"===r||"form_editor"===r)return null;const a=((l?i[l]:void 0)??[]).filter((e=>Boolean(e.visible))).length;return(0,U.jsx)(Q().A,{icon:w().eyeIcon,title:(0,U.jsx)(M().sA,{defaultMessage:"Property visibility",id:"database.viewSettings.mainTab.propertyVisibilityButton.title"}),showChevron:!0,right:a,onClick:()=>{(0,F().X)({environment:n,collectionContextStore:t,action:"click_show_hide_properties",from:"collection_view_more_menu"}),G().a2({collectionSettingsStore:o,item:{type:"propertyVisibility",timelineViewTab:"timeline"}})}})}function oo(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,n=(0,c().v3)(),i=(0,d().K8)((()=>{const e=t.permissionScopesStore.state;return!(0,ve().K)({collectionContextStore:t,permissionScopes:e})}),[t]);return(0,U.jsx)(Q().A,{icon:j().n,title:(0,U.jsx)(M().sA,{defaultMessage:"Edit properties",id:"database.viewSettings.mainTab.editPropertiesButton.title"}),disabled:i,showChevron:!i,onClick:()=>{(0,F().X)({environment:n,collectionContextStore:t,action:"click_edit_properties"}),G().a2({collectionSettingsStore:o,item:{type:"editProperties",timelineViewTab:"timeline"}})}})}function no({collectionContextStore:e,collectionSettingsStore:t}){const o=(0,c().v3)(),i=(0,d().O$)(e.normalizedSchemaStore),r=(0,d().O$)(e.currentSortsStore),l=(0,n.useCallback)((()=>{(0,F().X)({environment:o,collectionContextStore:e,action:"click_sort"}),0===r.length?G().a2({collectionSettingsStore:t,item:{type:"createSort"}}):G().a2({collectionSettingsStore:t,item:{type:"sort"}})}),[e,o,t,r.length]);return(0,U.jsx)(Q().A,{icon:C().arrowUpDownIcon,title:(0,U.jsx)(M().sA,{...be().D.sortTitle}),showChevron:!0,right:(0,U.jsx)(J().v,{currentSorts:r,schema:i}),onClick:l})}function io(e){const t=(0,c().v3)(),o=(0,d().K8)((()=>{const e=r().default.state.mainEditorCurrentBlockStore;return Boolean(e&&(0,te().s)(e.id))}),[]),n=(0,d().K8)((()=>{if(!(0,ie().$H)())return!1;const t=e.collectionContextStore.collectionViewBlockStore();return!(!t||!(0,te().s)(t.id))}),[e.collectionContextStore]),i=(0,u().IS)((()=>({icon:ro().iconStyles,title:ro().menuItemStyles})),[]);if(!n)return null;const l=o?"home_tasks":"home_tile_tasks";return(0,U.jsx)(Q().A,{showChevron:!1,icon:_().questionMarkCircleIcon,iconStyle:i.icon,title:(0,U.jsx)(M().sA,{defaultMessage:"Donâ€™t see your tasks?",id:"tasksEmptyState.noDatabases.title"}),textWrapperStyle:i.title,onClick:()=>{me().A.setState({isOpen:!0,from:l}),(0,ce().bS)({environment:t,from:l})}})}function ro(){const e=(0,ge().EI)();return{menuItemStyles:{color:e.text},iconStyles:{fill:e.icon}}}function lo({collectionContextStore:e}){const[t,o]=(0,n.useState)(!1),l=(0,M().tz)(),a=(0,c().v3)(),s=(0,d().K8)((()=>{var t;return null===(t=e.collectionViewStore())||void 0===t?void 0:t.id}),[e]),p=(0,d().K8)((()=>{const e=r().default.state.currentUserSettingsStore;if(void 0===e||!e.isDefined())return!0;return!!e&&void 0!==e.getSettingsStore().getKeyStore("personal_home_my_tasks_settings_callout_dismissed_at").getValue()}),[]);(0,n.useEffect)((()=>{t||p||!s||(o(!0),(0,i().u)({environment:a,event:{eventName:"my_tasks_limited_settings_callout_impression",eventProperties:{collection_view_id:s}}}))}),[t,a,s,p]);const y=(0,n.useCallback)((()=>{(0,se()._)({environment:a,collectionViewId:s,dismissedBy:"dismiss_button_clicked"})}),[a,s]),f=(0,n.useCallback)((()=>{(0,Se().q)(a,e)}),[a,e]),h=(0,u().IS)((()=>({container:{margin:"8px 14px 10px"},button:{color:P().Tj.text.secondary}})),[]);if(p)return null;const x=[{isCustom:!0,render:()=>(0,U.jsx)(m().A,{onClick:f,style:h.button,children:l.formatMessage(ho.configure)})},{isCustom:!0,render:()=>(0,U.jsx)(S().p,{style:h.button,href:pe().hI,external:!0,children:l.formatMessage(ho.learnMore)})}];return(0,U.jsx)("div",{style:h.container,children:(0,U.jsx)(g().l,{display:"inline",tint:"gray",label:l.formatMessage(ho.title),description:l.formatMessage(ho.body),actions:x,onDismiss:y})})}function ao({collectionContextStore:e,collectionSettingsStore:t,inHomeWidget:o}){const n=(0,d().K8)((()=>{var t;return null===(t=e.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.subitem_property}),[e]),i=(0,d().K8)((()=>Gt(e)),[e]);return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(lo,{collectionContextStore:e}),(0,U.jsxs)(y().A,{extraPadding:!0,children:[(0,U.jsx)(Zt,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(to,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Ee().A,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(no,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Yt,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Xt,{collectionContextStore:e,collectionSettingsStore:t}),n&&(0,h().BF)(i)?(0,U.jsx)(Be().I,{collectionContextStore:e,onClick:()=>G().a2({collectionSettingsStore:t,item:{type:"subitemV2",from:"view_settings"}})}):null,(0,U.jsx)(Fe().A,{collectionContextStore:e})]}),(0,U.jsx)(y().A,{title:(0,U.jsx)(M().sA,{...fo.dataSourceSettings}),topBorder:!0,extraPadding:!0,children:(0,U.jsx)(Pe().S,{collectionContextStore:e})}),(0,U.jsxs)(y().A,{extraPadding:!0,topBorder:!0,children:[(0,U.jsx)(dt().z,{collectionContextStore:e}),o?(0,U.jsx)(So,{collectionContextStore:e}):void 0,(0,U.jsx)(io,{collectionContextStore:e})]})]})}function so({collectionContextStore:e,collectionSettingsStore:t}){const o=(0,d().K8)((()=>e.getLibraryViewName()),[e]);return(0,U.jsxs)(y().A,{extraPadding:!0,style:{paddingTop:0},children:[(0,U.jsx)(to,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Ee().A,{collectionContextStore:e,collectionSettingsStore:t}),"recents"!==o?(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(no,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Yt,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Xt,{collectionContextStore:e,collectionSettingsStore:t})]}):null,(0,U.jsx)(We,{collectionContextStore:e,collectionSettingsStore:t})]})}function co({collectionContextStore:e,collectionSettingsStore:t}){return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(y().A,{extraPadding:!0,style:{paddingTop:0},children:[(0,U.jsx)(to,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Ee().A,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(no,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Yt,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Xt,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(We,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Fe().A,{collectionContextStore:e})]}),(0,U.jsx)(yo,{collectionContextStore:e,collectionSettingsStore:t})]})}function uo(e){const{collectionContextStore:t,collectionSettingsStore:o,isConfiguringViewsMainModule:n}=e,i=(0,d().K8)((()=>!t.isPeopleCollection()),[t]),r=(0,d().K8)((()=>{const e=t.collectionStore();if(!e)return!0;const o=e.getFormat();return!((null==o?void 0:o.external_collection_type)===x().uO.Jira&&!(0,ne().qU)())}),[t]);return i?(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(Re().Q,{collectionContextStore:t,collectionSettingsStore:o,disabled:n}),(0,U.jsx)(oo,{collectionContextStore:t,collectionSettingsStore:o}),(0,U.jsx)(qt,{collectionContextStore:t,collectionSettingsStore:o}),r?(0,U.jsx)(Nt,{collectionContextStore:t,collectionSettingsStore:o,isConfiguringViewsMainModule:n}):null]}):(0,U.jsx)(oo,{collectionContextStore:t,collectionSettingsStore:o})}function po({collectionContextStore:e,collectionSettingsStore:t,isConfiguringViewsMainModule:o}){const n=function(e){const t=(0,d().K8)((()=>{var t;return null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.isCollectionViewPageWithContent()}),[e]),o=(0,d().K8)((()=>{var t;return null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.hasAnySyncedCollection()}),[e]),n=(0,d().K8)((()=>Boolean(e.isDashboardWidget())),[e]),i=(0,d().K8)((()=>Boolean(e.isEditableHomeCollectionStore.state)),[e]);if(!(t||o||n||i))return(0,U.jsx)(gt,{collectionContextStore:e})}(e),i=(0,dt().R)({collectionContextStore:e}),r=function(e){const t=(0,ae().K)({collectionContextStore:e}),o=(0,l().X)("notion_calendar_db_integration_non_time_views"),n=(0,l().X)("notion_calendar_db_integration_view_settings_entrypoint");return t&&o&&n?(0,U.jsx)(le().A,{collectionContextStore:e,entrypoint:"view_settings"},"openInCalendarAction"):null}(e),a=(0,B().oE)([n,i,r]),s=(0,d().K8)((()=>e.isPeopleCollection()),[e]),c=!o&&a.length>0&&!s,u=(0,d().K8)((()=>{var t;return null===(t=e.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.subitem_property}),[e]),p=(0,d().K8)((()=>Gt(e)),[e]);return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(y().A,{extraPadding:!0,style:{paddingTop:0},children:[(0,U.jsx)(Zt,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(to,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Ee().A,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(no,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Yt,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Xt,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(We,{collectionContextStore:e,collectionSettingsStore:t}),u&&(0,h().BF)(p)?(0,U.jsx)(Be().I,{collectionContextStore:e,onClick:()=>G().a2({collectionSettingsStore:t,item:{type:"subitemV2",from:"view_settings"}})}):null,(0,U.jsx)(Fe().A,{collectionContextStore:e})]}),(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(y().A,{title:(0,U.jsx)(M().sA,{...fo.dataSourceSettings}),topBorder:!0,extraPadding:!0,style:{marginTop:4},desktopTitleStyle:{paddingTop:4},children:(0,U.jsx)(uo,{collectionContextStore:e,collectionSettingsStore:t,isConfiguringViewsMainModule:o})}),(0,U.jsx)(yo,{collectionContextStore:e,collectionSettingsStore:t}),c?(0,U.jsx)(y().A,{topBorder:!0,extraPadding:!0,style:{marginTop:4},children:a}):void 0,s?(0,U.jsx)(He().Y,{collectionContextStore:e,collectionSettingsStore:t}):void 0]})]})}function go({collectionContextStore:e,collectionSettingsStore:t,viewNameInput:o,addItemSection:n}){const i=(0,u().IS)((()=>({container:{minWidth:xe().vE},nameInput:{paddingBottom:0}})),[]);return(0,U.jsxs)("div",{style:i.container,children:[n,(0,U.jsx)(y().A,{style:i.nameInput,children:o}),(0,U.jsx)(y().A,{children:(0,U.jsx)(Zt,{collectionContextStore:e,collectionSettingsStore:t})}),(0,U.jsxs)(y().A,{topBorder:!0,children:[(0,U.jsx)(eo,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Ee().A,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(no,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Yt,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(Xt,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(We,{collectionContextStore:e,collectionSettingsStore:t})]}),(0,U.jsxs)(y().A,{topBorder:!0,children:[(0,U.jsx)(Re().Q,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(De().A,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(So,{collectionContextStore:e}),(0,U.jsx)(io,{collectionContextStore:e})]})]})}function mo({collectionContextStore:e,collectionSettingsStore:t}){const o=(0,u().IS)((()=>({container:{minWidth:xe().vE}})),[]);return(0,U.jsx)("div",{style:o.container,children:(0,U.jsxs)(y().A,{topBorder:!0,children:[(0,U.jsx)(Ee().A,{collectionContextStore:e,collectionSettingsStore:t}),(0,U.jsx)(no,{collectionContextStore:e,collectionSettingsStore:t})]})})}function So({collectionContextStore:e}){const t=(0,M().tz)(),o=(0,c().v3)(),n=(0,d().K8)((()=>{var t;const o=null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.id;return!!o&&(0,te().s)(o)}),[e]);return(0,U.jsx)(Q().A,{icon:A().e,title:t.formatMessage(ue().u.hide),showChevron:!1,onClick:()=>{r().default.state.sidebarSpaceViewStore&&de().WO({environment:o,currentSpaceViewStore:r().default.state.sidebarSpaceViewStore,...n?{feature:"tasks",from:"tasks_more_menu"}:{feature:"custom_db",from:"custom_db_more_menu"}})}})}function yo({collectionContextStore:e,collectionSettingsStore:t}){const{navigate:o}=(0,n.useContext)(s().E),{isPhone:i}=(0,c().Y0)(),r=(0,c().v3)(),l=(0,d().K8)((()=>Gt(e)),[e]),a=(0,d().K8)((()=>e.collectionViewBlockStore()),[e]),u=(0,n.useCallback)((()=>{var n,i;if(!a)return;const s=(0,oe().Ay)({store:a,fullyQualified:!1,pageVisitSource:f().y8.Expand,demoSettingsStore:fe().A});(0,D().p)(r,{view_type:l,collection_id:null===(n=e.collectionStore())||void 0===n?void 0:n.id,collection_view_id:null===(i=e.collectionViewStore())||void 0===i?void 0:i.id,collection_view_block_id:a.id}),G().os({collectionSettingsStore:t}),o({environment:r,url:s})}),[a,r,l,t,e,o]),p=(0,d().O$)(e.isFullScreenStore),g=(0,d().K8)((()=>a&&"view"===ye().A.getMode(r,a,a.getSpaceStore()).permission),[r,a]);return p||g||!i?null:(0,U.jsx)(y().A,{children:(0,U.jsx)(Q().A,{icon:b().arrowExpandDiagonalBottomLeftToTopRightIcon,title:(0,U.jsx)(M().sA,{...be().D.openFullscreenButton}),onClick:u})})}const fo=(0,M().YK)({dataSourceSettings:{defaultMessage:"Data source settings",id:"database.viewSettings.mainTab.dataSourceSectionTitle"},formSettings:{defaultMessage:"Form settings",id:"database.viewSettings.formTab.title"},viewSettings:{defaultMessage:"View settings",id:"database.viewSettings.mainTab.viewSectionTitle"},mobileSettings:{defaultMessage:"Settings",id:"database.viewSettings.mainTab.mobileTitle"}}),ho=(0,M().YK)({title:{defaultMessage:"Customize My tasks",id:"database.viewSettings.myTasksSettingsBanner.title"},body:{defaultMessage:"You can now choose which databases feed into My tasks",id:"database.viewSettings.myTasksSettingsBanner.body"},configure:{defaultMessage:"Configure",id:"database.viewSettings.myTasksSettingsBanner.configure"},learnMore:{defaultMessage:"Learn",id:"database.viewSettings.myTasksSettingsBanner.learnMore"}})},234675:(e,t,o)=>{o.d(t,{R:()=>n,l:()=>i});const n="custom_component";function i(e){return!("dependencies"in e)&&e.collectionUri===n}},252107:(e,t,o)=>{o.d(t,{g:()=>l});var n=()=>o(907258),i=()=>o(590526),r=()=>o(789586);function l(e){const t=(0,i().K8)((()=>e.collectionViewBlockStore()),[e]),o=(0,i().K8)((()=>null==t?void 0:t.getSpaceStore()),[t]),{spaceId:l,userId:a}=(0,i().K8)((()=>{var e;return{spaceId:null==o?void 0:o.id,userId:null===(e=n().default.state.currentUserStore)||void 0===e?void 0:e.id}}),[o]);return{hasAIAccessInWorkspace:(0,r().P)({name:"ai_usage",spaceId:l,userId:a,amount:"unknown"})??!1,isAiEnabledInWorkspace:(0,i().K8)((()=>(null==o?void 0:o.isAiEnabledOnSpace())??!1),[o])}}},267654:(e,t,o)=>{o.d(t,{g:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.75 13.75",svg:(0,o(474848).jsx)("path",{d:"M3.75 3.125c.345 0 .625.28.625.625v6.595l3.017-2.64.097-.07a.626.626 0 0 1 .756.098l3.035 3.037 4.442-4.442.098-.08a.626.626 0 0 1 .866.866l-.08.099-4.883 4.883a.626.626 0 0 1-.884 0L7.774 9.03l-3.399 2.975v2.745c0 .483.392.875.875.875h11l.126.013a.625.625 0 0 1 0 1.224l-.126.013h-11a2.125 2.125 0 0 1-2.125-2.125v-11c0-.345.28-.625.625-.625"})},i=(0,o(340498).wt)("chartLine",n,"default")},343630:(e,t,o)=>{o.d(t,{k:()=>l});o(296540);var n=()=>o(69708),i=()=>o(534177),r=o(474848);function l({canAddCollectionResult:e}){if(!e||e.canAddView)return null;switch(e.reason){case"tooManyViews":return(0,r.jsx)(n().sA,{defaultMessage:"You are at the maximum number of views for this database.",id:"collectionTabBar.newDataSource.tooltip.tooManyViews"});case"tooManyCollections":return(0,r.jsx)(n().sA,{defaultMessage:"You are at the maximum number of data sources for this database.",id:"collectionTabBar.newDataSource.tooltip.tooManyDataSources"});default:throw(0,i().HB)(e.reason)}}},364871:(e,t,o)=>{o.d(t,{A:()=>d});o(296540);var n=()=>o(590526),i=()=>o(69708),r=()=>o(436696),l=()=>o(899725),a=()=>o(547149),s=()=>o(339798),c=o(474848);const d=function({collectionContextStore:e,collectionSettingsStore:t}){const d=(0,i().tz)(),u=(0,o(484714).v3)(),{collectionViewBlockStore:p,permissionScopes:g,viewType:m,viewName:S}=((0,o(792485).S)(),(0,n().K8)((()=>{var t,o;return{collectionViewBlockStore:e.collectionViewBlockStore(),permissionScopes:e.permissionScopesStore.state,viewType:null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType(),viewName:null===(o=e.collectionViewStore())||void 0===o?void 0:o.getName()}}),[e])),y=(0,n().K8)((()=>{if(e.dashboardWidgetStore.state)return!g.canConfigureBlock;const t=1===(null==p?void 0:p.getCollectionViewIds().length),o=e.isEditableHomeCollectionStore.state;return!g.canConfigureBlock||"collectionTypedView"===e.contextTypeFromStoreState||t&&!o}),[e,p,g.canConfigureBlock]);if(!p||y||!m)return null;let f=(0,c.jsx)(i().sA,{defaultMessage:"Delete view",id:"database.viewSettings.mainTab.deleteTheOnlyViewButton.title"});return"chart"===m?f=(0,c.jsx)(i().sA,{defaultMessage:"Delete chart",id:"database.viewSettings.mainTab.deleteButton.title.chart"}):S&&(f=(0,c.jsx)(i().sA,{defaultMessage:"Delete {viewName}",id:"database.viewSettings.mainTab.deleteButton.title.viewName",values:{viewName:S}})),(0,c.jsx)(o(497222).A,{icon:o(236262).trashIcon,title:f,isRedOnHover:!0,onClick:()=>function(e,t,o,n,i){const c=o.collectionViewStore();c&&(o.isDashboardWidget()?(a().createAndCommit({environment:t,userAction:"dashboard.deleteWidget",canUndo:!0,perform:e=>{(0,l().T)({transaction:e,collectionContextStore:o,viewId:c.id})}}),s().os({collectionSettingsStore:n})):s().nl({intl:e,environment:t,collectionContextStore:o,collectionViewStore:c,collectionSettingsStore:n,from:"view_settings"}),(0,r().X)({environment:t,collectionContextStore:o,action:"click_delete",original_view_type:c.getType()}))}(d,u,e,t)})}},370493:(e,t,o)=>{o.d(t,{$Y:()=>m,JO:()=>S,V_:()=>y,bP:()=>p,jc:()=>f});o(898992),o(823215),o(354520);var n=()=>o(726637),i=()=>o(148307),r=()=>o(214388),l=()=>o(748580),a=()=>o(898244),s=()=>o(206267),c=()=>o(534177),d=()=>o(649746),u=()=>o(390650);function p(e){const{propertyId:t,schema:o,getRecordModel:n,spaceIdCreator:i}=e,a=(0,d().SN)({property:t,schema:o,getRecordModel:n,spaceIdCreator:i}),c=o[t],u=c&&function(e){if(!(0,l().ry)(e))return!1;const t=(0,l().IS)(e),o=(0,r().U6)({filterValueType:t});return r().wh.every((e=>o.includes(e)))}(c.type)?{operator:"is_not_empty",value:void 0}:a,p=c&&g(c);return{id:(0,s().JW)(),conditional_filter:{property:t,filter:u},properties_to_color:{type:"all"},background:p?{type:"match_property_value"}:{type:"custom",color:"teal_background"}}}function g(e){return a().DD(e)||a().P8(e)||a().Ou(e)}function m(e,t){return!(!e||!t)&&(!!g(e)&&"is_empty"!==t.operator)}function S({collectionContextStore:e,conditionalColorRule:t}){var o,n,i,r,l;const a=(0,u().sl)(e),s=e.normalizedFormatStore.state.conditional_color_rules,c=null==s?void 0:s.length,d=null==t?void 0:t.conditional_filter,p=null==d?void 0:d.property;if(!t||!p)return{total_rules:c,...a??{}};const g=null===(o=e.normalizedSchemaStore.state[p])||void 0===o?void 0:o.type;return{rule_id:null==t?void 0:t.id,property_id:p,property_type:g,filter_operator:null===(n=d.filter)||void 0===n?void 0:n.operator,background_type:null==t||null===(i=t.background)||void 0===i?void 0:i.type,background_color:"custom"===(null==t||null===(r=t.background)||void 0===r?void 0:r.type)?null==t||null===(l=t.background)||void 0===l?void 0:l.color:void 0,total_rules:c,...a??{}}}function y({collectionViewType:e,isDarkMode:t}){switch(e){case"calendar":return t?i().A.images.tooltips.collectionSettings.conditionalColorCalendarDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorCalendarLightPreviewSvg;case"board":return t?i().A.images.tooltips.collectionSettings.conditionalColorBoardDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorBoardLightPreviewSvg;case"gallery":return t?i().A.images.tooltips.collectionSettings.conditionalColorGalleryDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorGalleryLightPreviewSvg;case"list":return t?i().A.images.tooltips.collectionSettings.conditionalColorListDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorListLightPreviewSvg;case"table":return t?i().A.images.tooltips.collectionSettings.conditionalColorTableDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorTableLightPreviewSvg;case"timeline":return t?i().A.images.tooltips.collectionSettings.conditionalColorTimelineDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorTimelineLightPreviewSvg;case"feed":return t?i().A.images.tooltips.collectionSettings.conditionalColorFeedDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorFeedLightPreviewSvg;case"map":return t?i().A.images.tooltips.collectionSettings.conditionalColorMapDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorMapLightPreviewSvg;case"page":case"chart":case"form_editor":case"chat":case"custom":case"dashboard":case"teamspace_directory":case"library_external_pages":return;default:(0,c().HB)(e)}}function f(e){return n().A.isMobile&&e?"bodyMedium":"bodyRegular"}},379547:(e,t,o)=>{o.d(t,{_:()=>a});var n=()=>o(564884),i=()=>o(680977),r=()=>o(680074),l=()=>o(547149);function a(e){const{environment:t,collectionViewId:o,dismissedBy:a}=e,s=(0,r().R$)(t);if(!s)return;const c=void 0!==s.getSettingsStore().getKeyStore("personal_home_my_tasks_main_callout_dismissed_at").getValue(),d=void 0!==s.getSettingsStore().getKeyStore("personal_home_my_tasks_settings_callout_dismissed_at").getValue();if(c&&d)return;const u={};c||(u.personal_home_my_tasks_main_callout_dismissed_at=Date.now(),o&&(0,n().u)({environment:t,event:{eventName:"my_tasks_limited_main_callout_dismissed",eventProperties:{collection_view_id:o,dismissed_by:a}}})),d||(u.personal_home_my_tasks_settings_callout_dismissed_at=Date.now(),o&&(0,n().u)({environment:t,event:{eventName:"my_tasks_limited_settings_callout_dismissed",eventProperties:{collection_view_id:o,dismissed_by:a}}})),l().createAndCommit({environment:t,userAction:"dismissMyTasksLimitsCallouts",canUndo:!0,cellTarget:"main",perform:e=>{(0,i().m)({userSettingsStore:s,transaction:e,data:u})}})}},379830:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){return{isModalOpen:!1,collectionContextStore:void 0}}}const i=new n},384100:(e,t,o)=>{o.d(t,{z:()=>r});var n=()=>o(849255),i=()=>o(798880);function r(e){const{userId:t,spaceStore:o}=e;return n().L.createChildStore(o,{table:i().oo,id:t})}},390518:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=()=>o(98126),i=o(474848);function r(){return(0,i.jsx)("div",{style:{alignItems:"center",display:"flex",justifyContent:"center",minHeight:200,overflow:"hidden"},children:(0,i.jsx)(n().k,{})})}},395859:(e,t,o)=>{o.d(t,{A:()=>h,X:()=>y});o(296540);var n=()=>o(590526),i=()=>o(148307),r=()=>o(201980),l=()=>o(69708),a=()=>o(436696),s=()=>o(896628),c=()=>o(654062),d=()=>o(943919),u=()=>o(403905),p=()=>o(635462),g=()=>o(295304),m=()=>o(547149),S=o(474848);const y=(0,l().YK)({viewNamePlaceholderMessage:{defaultMessage:"View name",id:"database.viewSettings.mainTab.viewNamePlaceholder.title"},formNamePlaceholderMessage:{defaultMessage:"Form name",id:"database.viewSettings.mainTab.formNamePlaceholder.title"},addDescriptionTooltip:{defaultMessage:"Add view description",id:"database.viewSettings.mainTab.addDescriptionTooltip.title"},editDescriptionTooltip:{defaultMessage:"Edit view description",id:"database.viewSettings.mainTab.editDescriptionTooltip.title"}});function f(e,t,o,n){const i=n.collectionViewBlockStore(),l=n.collectionViewStore();if(!i||!l||!l.isDefined())return;const s=(0,p().s)(i.id),d=(0,u().V)(e,l.getType(),o);l.getName()!==d&&m().createAndCommit({userAction:"CollectionSettingsViewMain.handleViewNameSubmit",environment:t,canUndo:!0,perform:t=>{if((0,c().F)({collectionViewStore:l,update:{name:d},transaction:t}),s){const o=(0,r().x9d)(e);g().R9({environment:i.environment,store:i.getBlockTitleStore(),value:o,transaction:t})}}}),(0,a().X)({environment:t,collectionContextStore:n,action:"rename",original_view_type:l.getType()})}const h=function(e){const{collectionViewStore:t,collectionContextStore:r,selectViewNameInitial:c,showViewDescriptionStore:u,topBorder:g,sectionStyle:h}=e,x=(0,o(484714).v3)(),v=(0,l().tz)(),b=(0,o(401497).eP)(),C=(0,n().K8)((()=>t.getType()),[t]),j=(0,n().K8)((()=>{var e;return null===(e=t.getCollectionSource())||void 0===e?void 0:e.type}),[t]),w=(0,n().K8)((()=>t.getName()),[t]),A=(0,n().K8)((()=>{var e;if(!r.isDashboardWidget())return!0;const t=null===(e=r.dashboardWidgetStore.state)||void 0===e?void 0:e.dashboardViewStore;return!!t&&(t.getFormatStore().getKeyStore("show_widget_view_icon").getValue()??!1)}),[r]),{description:I,collection_view_icon:_}=(0,n().K8)((()=>t.getFormat()),[t]),T=(0,n().O$)(u),k=(0,n().O$)(r.canConfigureBlockStore),M=(0,n().O$)(r.isEditableHomeCollectionStore),P=(0,n().K8)((()=>t.getAppConfigUri()),[t]),B=!P||(0,o(80659).$)(P);return(0,S.jsx)(o(736847).A,{topBorder:g,style:h,children:(0,S.jsx)("div",{style:{marginTop:g?5:void 0},children:(0,S.jsx)(o(755735).B,{initialValue:w||"",placeholder:v.formatMessage("form_editor"===C?y.formNamePlaceholderMessage:y.viewNamePlaceholderMessage),onBlur:e=>f(e,x,v,r),onSubmit:e=>f(e,x,v,r),focusInitial:c,selectAll:c,disabled:!k||!B,iconButton:A?{icon:e=>(0,S.jsx)(o(745266).h,{color:"gray",viewIcon:_,viewType:C}),iconStyle:{fill:o(278238).l8[b].gray},enforceIconColor:"gray",onSubmit:e=>function(e,t,o){const n=t.collectionViewStore(),r=t.collectionViewBlockStore();if(!r||!n||!n.isDefined())return;const l=(0,p().s)(r.id);m().createAndCommit({userAction:"CollectionSettingsViewMain.handleViewIconSubmit",environment:e,canUndo:!0,perform:e=>{if(l){const t=o||i().A.images.appPackages.taskDbIconSvg;(0,d().o)({collectionViewStore:n,icon:t,transaction:e}),s().zA({stores:[r],update:{page_icon:t},transaction:e})}else(0,d().o)({collectionViewStore:n,icon:o,transaction:e})}}),(0,a().X)({environment:e,collectionContextStore:t,action:"change_icon",icon:o})}(x,r,e)}:void 0,inputRightButton:M||"form_editor"===C||"myMeetings"===j?null:(0,S.jsx)(o(539148).S,{description:I,showTooltip:!T,onClick:()=>u.setState(!T),addDescriptionText:v.formatMessage(y.addDescriptionTooltip),editDescriptionText:v.formatMessage(y.editDescriptionTooltip),disabled:!k})})})})}},396223:(e,t,o)=>{o.d(t,{Ay:()=>x,CL:()=>b,bL:()=>v});var n=o(296540),i=()=>o(726637),r=()=>o(484714),l=()=>o(590526),a=()=>o(250910),s=()=>o(546926),c=()=>o(81068),d=()=>o(835195),u=()=>o(69708),p=()=>o(436696),g=()=>o(755022),m=()=>o(787815),S=()=>o(933117),y=()=>o(272630),f=()=>o(55043),h=o(474848);const x=function({schema:e,sort:t,disabled:o,onChange:i,index:r,collectionViewType:l,collectionContextStore:a}){const s=e[t.property];return s?(0,h.jsxs)(n.Fragment,{children:[(0,h.jsx)(j,{disabled:o,schema:e,sort:t,onChange:i,index:r,collectionViewType:l,collectionContextStore:a,propertySchema:s}),(0,h.jsx)(C,{sort:t,index:r,onChange:i,collectionViewType:l,collectionContextStore:a,disabled:o})]}):null},v={ascending:(0,h.jsx)(u().sA,{defaultMessage:"Ascending",id:"collectionSortMenuRow.sortDirectionSelectMenu.ascending"}),descending:(0,h.jsx)(u().sA,{defaultMessage:"Descending",id:"collectionSortMenuRow.sortDirectionSelectMenu.descending"})},b=(0,u().YK)({menuTitle:{id:"collectionSortMenuRow.sortDirectionSelectMenu.title",defaultMessage:"Sort"},emptyPlaceholder:{id:"collectionSortMenuRow.sortDirectionSelectMenu.placeholder",defaultMessage:"Empty"}});function C({sort:e,index:t,onChange:o,collectionViewType:n,collectionContextStore:i,disabled:l}){const a=(0,r().v3)(),m=(0,u().tz)(),f=e.direction,x={menuTitle:m.formatMessage(b.menuTitle),items:[...d().FU],getKey:e=>e,selectedItem:f,disabled:l,onSelect:r=>{const l={...e,direction:r};o(t,l),i?(0,p().X)({environment:a,action:"set_sort_direction",sort_direction:r,collectionContextStore:i}):n&&(0,g().D)(a,{view_type:n,action:"set_sort_direction"})},renderItem:e=>(0,h.jsx)(c().A,{title:v[e.value],...e}),renderOrigin:e=>(0,h.jsx)(y().A,{...e,placeholder:m.formatMessage(b.emptyPlaceholder),title:f&&v[f],disabled:l,desktopStyle:{opacity:1}})};return(0,h.jsx)(S().A,{...x,menuTypeOverride:(0,s().PK)()},"direction")}function j({propertySchema:e,disabled:t,schema:o,sort:n,onChange:s,index:c,collectionViewType:u,collectionContextStore:S}){const y=(0,r().v3)(),x=(0,l().K8)((()=>{var e;return null==S||null===(e=S.collectionViewStore())||void 0===e?void 0:e.getCollectionSource()}),[S]);return(0,h.jsx)(a().A,{popupType:i().A.isMobile?a().z.SlideUp:a().z.Popup,renderOrigin:o=>(0,h.jsx)(f().A,{...o,propertySchema:e,disabled:t,textWrapperStyle:{opacity:1}}),render:e=>(0,h.jsx)(m().A,{isRelationProperty:!1,schema:o,onAccept:e=>function(e,t,o,n,i,r,l){n(i,{...o,property:e}),l?(0,p().X)({environment:t,action:"set_sort_property",collectionContextStore:l}):r&&(0,g().D)(t,{view_type:r,action:"set_sort_property"})}(e,y,n,s,c,u,S),onClose:e.close,allowProperty:e=>(0,d().oH)(e,x)}),disabled:t})}},401634:(e,t,o)=>{o.d(t,{i:()=>h});o(296540);var n=()=>o(782482),i=()=>o(726637),r=()=>o(401497),l=()=>o(394888),a=()=>o(882722),s=()=>o(245720),c=()=>o(807449),d=()=>o(546926),u=()=>o(890492),p=()=>o(526278),g=()=>o(69708),m=()=>o(534177),S=o(474848);const y=(0,g().YK)({createTitle:{id:"automations.builderModal.createTitle",defaultMessage:"Create automation"},updateTitle:{id:"automations.builderModal.updateTitle",defaultMessage:"Edit automation"},saveButton:{id:"automations.builderModal.saveButton",defaultMessage:"Save"}}),f=88;function h(e){const{children:t,handleOnDismiss:o,canSave:h,handleOnSave:x,mode:v}=e,b=(0,g().tz)(),C=(0,r().IS)((()=>({container:{padding:i().A.isMobile?0:"12px 16px",display:"flex",flexDirection:"column",overflow:"hidden",...i().A.isMobile?{}:{flexGrow:1}}})),[]);if(i().A.isMobile){let e;return"create"===v?e=b.formatMessage(y.createTitle):"update"===v||"button_property"===v?e=b.formatMessage(y.updateTitle):"loading"===v?e=null:(0,m().HB)(v),(0,S.jsx)(u().A,{menuType:d().gu.Modal,whiteBackground:!0,title:e,left:(0,S.jsx)(c().I,{icon:p().arrowStraightLeftIcon,colorVariant:"secondary"}),onClickLeft:o,rightDisabled:!h,right:"button_property"===v?(0,S.jsx)(g().sA,{...s().W.done}):(0,S.jsx)(g().sA,{...y.saveButton}),onClickRight:x,children:(0,S.jsx)("div",{style:C.container,className:a().sux,children:t})})}return(0,S.jsx)(l().s,{anchor:"top",minimumOutsideSpacing:{type:"axes",vertical:f},areaConstraint:{width:{type:"fixed",length:500},height:{type:"min",length:600,scroll:"disallow"}},allowDismissByEscape:!1,isOpen:!0,render:()=>(0,S.jsxs)("div",{style:C.container,className:a().sux,children:[t,(0,S.jsx)(n().N,{debugName:"AutomationBuilderModal",capture:!0,onEsc:e=>{o()}})]})})}},409198:(e,t,o)=>{o.r(t),o.d(t,{ChartSettingsMain:()=>j().X,CollectionEditButtonAutomationOption:()=>Y,CollectionSettings:()=>n()._,CollectionSettingsButtonOptions:()=>b,CollectionSettingsPropertyTypeMenuItem:()=>G});var n=()=>o(523118),i=o(296540),r=()=>o(590526),l=()=>o(736847),a=()=>o(912720),s=()=>o(69708),c=()=>o(384944),d=()=>o(813297),u=()=>o(390518),p=()=>o(546461),g=()=>o(911724),m=()=>o(840094),S=()=>o(845715),y=()=>o(633904),f=()=>o(419357),h=()=>o(969318),x=o(474848);const v=(0,s().YK)({inputPlaceholder:{defaultMessage:"Type a name for this button...",id:"database.buttonProperty.label.inputPlaceholder"}});function b(e){const{collectionContextStore:t,propertySchema:o}=e,n=(0,r().K8)((()=>t.collectionStore()),[t]),l=(0,r().K8)((()=>null==n?void 0:n.getSpaceId()),[n]),s=(0,i.useMemo)((()=>{const e=o.automation_id;if(e&&l)return{id:e,spaceId:l,table:a().yB}}),[o.automation_id,l]);return(0,S().K)(n,s)?(0,x.jsx)(C,{...e}):(0,x.jsx)(u().A,{})}function C(e){const t=(0,s().tz)(),{collectionContextStore:o,propertySchema:n,property:a}=e,[u,S]=(0,i.useState)([]),b=(0,r().K8)((()=>o.permissionScopesStore.state.canConfigureCollection),[o.permissionScopesStore]),C=(0,r().K8)((()=>o.collectionStore()),[o]),j=(0,r().K8)((()=>null==C?void 0:C.getSpaceId()),[C]),{maybePersistedAutomationStore:w,maybePersistedTransactionActions:A}=(0,y().t)({automationId:n.automation_id,spaceId:j,defaultValue:void 0,persist:!0}),I=(0,r().K8)((()=>null==w?void 0:w.getTrigger()),[w]),_=(0,m().Qj)({automationStore:w,property:a,propertySchema:n,collectionContextStore:o}),T=(0,r().K8)((()=>{var e;return"sufficient"===(null==_||null===(e=_.state)||void 0===e?void 0:e.executionPermissionStatus)}),[_]),k=(0,r().K8)((()=>(null==w?void 0:w.getNameStore().getValue())??""),[w]),M=(0,i.useCallback)((e=>{if(!w)return;const t=e.currentTarget.value;A.createAndCommit({userAction:"CollectionSettingsButtonOptions.setName",perform:e=>{c().KY({store:w.getNameStore(),transaction:e,value:t})}})}),[w,A]),P=(0,i.useCallback)((e=>{S((t=>[...t,e.id]))}),[]);return C&&w&&I&&"button"===I.type?(0,x.jsx)(p().u,{automationStore:w,contextType:"button_property",enableExistenceGuarantees:!0,children:(0,x.jsxs)(g().v,{value:{collectionStore:C,disabled:!T,editorPlacement:{type:"inline"},editorWidth:h().vE,maybePersistedTransactionActions:A,onActionAdded:P,suppressActionErrors:u,hideDragHandle:!1},children:[(0,x.jsx)(l().A,{topBorder:!0,title:(0,x.jsx)(s().sA,{id:"database.buttonProperty.label",defaultMessage:"Label"}),children:(0,x.jsx)(f().Ay,{disabled:!b,placeholder:t.formatMessage(v.inputPlaceholder),value:k,onChange:M})}),(0,x.jsx)(l().A,{style:{paddingInline:12},children:(0,x.jsx)(d().U3,{areActionsEditable:!0,areTriggersEditable:!1})})]})}):null}var j=()=>o(719889),w=()=>o(484714),A=()=>o(401497),I=()=>o(807449),_=()=>o(26697),T=()=>o(898244),k=()=>o(713998),M=()=>o(3284),P=()=>o(338862),B=()=>o(100622),V=()=>o(284371),F=()=>o(901952),D=()=>o(895876),E=()=>o(377093),O=()=>o(907808),R=()=>o(142110),K=()=>o(680288),N=()=>o(187820),z=()=>o(16006),L=()=>o(132389),U=()=>o(547149),W=()=>o(339798),H=()=>o(527438),$=()=>o(497222);function G(e){const{collectionContextStore:t,collectionUri:o,disabled:n,formatKey:l,isTypedProperty:a,property:c,propertyTypeButtonPopupStore:d}=e,u=(0,w().v3)(),p=(0,r().K8)((()=>t.collectionViewBlockStore()),[t]),g=(0,r().K8)((()=>(0,H().Jq)({property:c,collectionContextStore:t})),[t,c]),m=(0,r().K8)((()=>(0,H().k7)(p,g)),[p,g]),S=(0,r().K8)((()=>null==m?void 0:m.getIcon()),[m]),y=t.settingsStore,f=(0,i.useCallback)((e=>{const o=t.collectionStore();o&&((0,F().V)({environment:u,collectionContextStore:t,property:c,new_property_type:(0,T().v2)(e),from:"view_settings",action:"change_type"}),"relation"===e?W().a2({collectionSettingsStore:y,item:{type:"selectRelationSource",property:c,formatKey:l}}):(U().createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyTypeAccept",environment:u,canUndo:!0,perform:t=>{(0,O().H)({environment:u,collectionStore:o,property:c,type:e,transaction:t})}}),W().yl({collectionSettingsStore:y}),(0,T().hN)(e)&&E().pG({propertyType:e,propertyId:c,collectionContextStore:t}),d.reset()))}),[t,y,u,l,c,d]),h=(0,i.useCallback)((e=>{const{propertyType:o}=e;R().g({environment:u,collectionContextStore:t,propertyId:c,propertySchema:g,handlePropertyTypeChange:()=>f(o)})}),[u,c,g,f,t]),v=(0,i.useCallback)((()=>{if(!g)return;t.collectionStore()&&W().a2({collectionSettingsStore:y,item:{type:"propertyType",propertySchema:g,onAccept:h}})}),[t,y,h,g]),b=(0,k().H6)(g)||(0,k().KF)(g),C=(0,A().IS)((()=>({container:{color:n?B().Tj.darkTextColor:void 0,display:"flex",alignItems:"center"},title:{display:"inline",wordBreak:"break-word",...V().RC},typeText:{color:n?B().Tj.darkTextColor:void 0}})),[n]),j=(0,i.useCallback)((e=>g?a&&o?(0,x.jsx)(s().sA,{...e,defaultMessage:"{type} type is required for this property in {databaseType}.",id:"database.viewSettings.propertyTab.restrictedProperty",description:"A tooltip to educate the users on why they can't change the type of this property.",values:{type:K().dC[g.type],databaseType:(0,D()._V)(o)}}):(0,x.jsx)(s().sA,{...e,defaultMessage:"This propertyâ€™s type cannot be changed.",id:"database.viewSettings.propertyTab.untypedRestrictedProperty",description:"A tooltip to educate the users on why they can't change the type of this property."}):null),[o,a,g]);return g?(0,x.jsx)(_().m,{placement:"left",disableTooltip:!n,renderTooltip:j,render:e=>(0,x.jsx)($().A,{...e,disabled:n,rotateChevron:d.state.open,icon:M().arrowSquarePathUpDownIcon,title:(0,x.jsx)(s().sA,{defaultMessage:"Type",id:"database.viewSettings.propertyTab.propertyType"}),showChevron:!0,right:(0,x.jsxs)(x.Fragment,{children:[n?(0,x.jsx)("div",{...e,children:(0,x.jsx)(I().I,{icon:P().lockFillSmallIcon,size:"sm",colorVariant:"secondary"})}):void 0,(0,x.jsx)(L().A,{size:4}),b?(0,x.jsxs)("div",{style:C.container,children:[(0,x.jsx)(N().B6,{icon:S,iconRecordCategory:"collection",isEmptyPage:!1,size:20,disabled:!0}),(0,x.jsx)(z().A,{store:m,style:C.title})]}):(0,x.jsx)("span",{style:C.typeText,children:K().dC[g.type]})]}),onClick:v})}):null}var Q=()=>o(105819),q=()=>o(837570);function Y(e){const{menuListProps:t,collectionSettingsStore:o,collectionContextStore:n,property:i,source:l}=e,a=(0,w().v3)(),c=(0,r().K8)((()=>(0,H().Jq)({collectionContextStore:n,property:i})),[n,i]);return(0,x.jsx)($().A,{title:(0,x.jsx)("div",{style:{display:"flex",justifyContent:"space-between"},children:(0,x.jsx)(s().sA,{id:"database.collectionsettings.button.editAutomationLabel",defaultMessage:"Edit automation"})}),disabled:!1,source:l,showChevron:!0,icon:Q().pencilLineIcon,...t,onClick:()=>{c&&"button"===c.type&&q().h({environment:a,mode:"edit_button_property",collectionSettingsStore:o,collectionContextStore:n,property:i,propertySchema:c})}})}},444091:(e,t,o)=>{o.d(t,{A:()=>ee,a:()=>Z});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(581454);var n=o(296540),i=()=>o(692031),r=()=>o(212497),l=()=>o(383036),a=()=>o(484714),s=()=>o(590526),c=()=>o(401497),d=()=>o(611648),u=()=>o(365917),p=()=>o(792057),g=()=>o(807449),m=()=>o(98126),S=()=>o(160432),y=()=>o(26697),f=()=>o(81068),h=()=>o(663639),x=()=>o(736847),v=()=>o(187174),b=()=>o(513416),C=()=>o(395546),j=()=>o(344417),w=()=>o(84262),A=()=>o(462853),I=()=>o(69708),_=()=>o(100622),T=()=>o(778078),k=()=>o(534177),M=()=>o(939768),P=()=>o(559926),B=()=>o(769864),V=()=>o(56394),F=()=>o(390650),D=()=>o(419357),E=()=>o(376254),O=()=>o(817126),R=()=>o(964556),K=()=>o(620791),N=()=>o(339798),z=()=>o(302501),L=()=>o(284371),U=o(474848);function W(e){const{onClick:t,integration:o,accountName:n}=e,i=(0,c().IS)((()=>({accountSelection:{padding:"8px",borderTop:`1px solid ${_().Tj.border.secondaryTranslucent}`,cursor:"pointer"},accountSelectionLabel:{fontWeight:L().Wy.medium,paddingInlineStart:4,paddingTop:4}})),[]);return(0,U.jsx)("div",{style:i.accountSelection,children:(0,U.jsxs)("div",{onClick:t,children:[(0,U.jsx)(z().A,{isSecondaryColor:!0,isSmall:!0,style:i.accountSelectionLabel,children:(0,U.jsx)(I().sA,{id:"collectionSettingsCreateExternalViewPicker.currentAccountSection.label",defaultMessage:"Connected to {integration}",values:{integration:o.name}})}),(0,U.jsx)(y().m,{renderTooltip:()=>(0,U.jsx)("span",{children:n}),placement:"left",textWrap:!0,render:t=>(0,U.jsx)(f().A,{showExtensionArrow:!0,focused:!1,...(0,l().A)(t||{},e),title:n,icon:(0,U.jsx)("img",{style:{width:18},src:o.info.icon})})})]})})}var H=()=>o(300474),$=()=>o(631524),G=()=>o(14959),Q=()=>o(510683),q=()=>o(187820),Y=()=>o(448421),X=()=>o(735695);function J(e){const{collectionContextStore:t,integration:o}=e,n=(0,c().eP)(),i=(0,s().K8)((()=>t.collectionStore()),[t]),r=(0,s().K8)((()=>null==i?void 0:i.getIcon()),[i]),l=(0,a().v3)(),d=(0,H().r)(),u=(0,c().IS)((()=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",paddingTop:8,paddingInlineEnd:16,paddingBottom:16,paddingInlineStart:8},authenticationBody:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",paddingTop:0,paddingInlineEnd:16,paddingBottom:16,paddingInlineStart:16,textAlign:"center"},settingsMenuSubHeading:{display:"inline",fontSize:14,marginTop:4,marginInlineEnd:20,marginBottom:20,marginInlineStart:20,color:_().Tj.text.secondary,textAlign:"center"},settingsMenuAuthenticationButton:{fontSize:14,height:32,color:_().Tj.text.inversePrimary}})),[]),{background:p,hoveredBackground:g,pressedBackground:m}=(0,G().u)(o,n);return(0,U.jsx)(X().A,{...e,title:(0,U.jsx)(I().sA,{defaultMessage:"Connect to {integration}",id:"collectionSettingsCreateExternalViewPicker.authenticateHeader.title",values:{integration:o.name}}),children:(0,U.jsx)("div",{style:u.settingsMenu,children:(0,U.jsxs)("div",{style:u.authenticationBody,children:[(0,U.jsx)(q().B6,{disabled:!0,bucket:"secure",store:i,icon:r,iconRecordCategory:"collection",size:40,isEmptyPage:!1,style:{marginBottom:6}}),(0,U.jsx)("div",{style:u.settingsMenuSubHeading,children:(0,U.jsx)(I().sA,{defaultMessage:"Link your {integration} account for richer content previews and seamless imports.",id:"collectionSettingsCreateExternalViewPicker.authenticateBody.title",values:{integration:o.name}})}),(0,U.jsx)($().p,{onClick:()=>{d&&(Q().Jq({environment:l,integration:o,spaceId:d,from:"placeholder_root_external_collection_view_block"}),Y().A.reset())},style:{background:p,...u.settingsMenuAuthenticationButton},hoveredStyle:{background:g},pressedStyle:{background:m},children:(0,U.jsx)(I().sA,{defaultMessage:"Connect to {integration}",id:"collectionSettingsCreateExternalViewPicker.authenticateButton.title",values:{integration:o.name}})})]})})})}function Z(e){const{collectionSettingsStore:t,collectionContextStore:o,externalAuthentication:n}=e,i=(0,s().K8)((()=>o.collectionStore()),[o]),r=(0,s().K8)((()=>{if(!i)return;const e=i.getFormat().integration_id;return u().A.integrations.state.find((t=>t.id===e))}),[i]),l=(0,s().K8)((()=>!!r&&(0,K().jw)(r.id).length>0),[r]),a=(0,s().K8)((()=>{var e;return null==i||null===(e=i.getSpaceStore())||void 0===e?void 0:e.canEdit()}),[i]);if(!r)return null;if(!i)return null;if(!a)return null;const c=l?(0,U.jsx)(ne,{...e,collectionContextStore:o,collectionSettingsStore:t,integration:r,externalAuthentication:n}):(0,U.jsx)(J,{...e,collectionContextStore:o,collectionSettingsStore:t,integration:r}),d=(0,A().l)(null==r?void 0:r.id);return d?(0,U.jsx)(ee,{featureName:d,collectionStore:i,children:c}):c}function ee(e){const{children:t,featureName:o,collectionStore:n}=e,i=(0,O().G9)({featureName:o,collectionStore:n});return(0,w().e2)(i)?t:null}function te(e){var t;return null===(t=e.integration.info)||void 0===t||null===(t=t.original_url_patterns)||void 0===t?void 0:t.filter((e=>{var t;return null===(t=e.additional_types)||void 0===t?void 0:t.collection})).find((({regex:t})=>new RegExp(t).test(e.url)))}const oe=(0,I().YK)({all:{id:"collectionSettingsCreateExternalViewPicker.filters.all",defaultMessage:"All"},issues:{id:"collectionSettingsCreateExternalViewPicker.filters.issues",defaultMessage:"Issues"},pull_requests:{id:"collectionSettingsCreateExternalViewPicker.filters.pullRequests",defaultMessage:"Pull Requests"},board:{id:"collectionSettingsCreateExternalViewPicker.filters.boards",defaultMessage:"Boards"},project:{id:"collectionSettingsCreateExternalViewPicker.filters.projects",defaultMessage:"Projects"},Releases:{id:"collectionSettingsCreateExternalViewPicker.filters.releases",defaultMessage:"Releases"},"Pull Request":{id:"collectionSettingsCreateExternalViewPicker.filters.PullRequests",defaultMessage:"Pull Requests"},Issues:{id:"collectionSettingsCreateExternalViewPicker.filters.Issues",defaultMessage:"Issues"}});function ne(e){const t=(0,I().tz)(),{integration:o,collectionContextStore:w,collectionSettingsStore:A,externalAuthentication:O}=e,[z,L]=(0,n.useState)(""),H=(0,s().K8)((()=>{const e=u().A.state;return e.loaded?e.externalAuthentications.filter((e=>e.integration_id===o.id)):[]}),[o]),$=(0,s().K8)((()=>O||(H.length?H[0]:null)),[H,O]),[G,Q]=(0,n.useState)(!1),[q,Y]=(0,n.useState)(null),Z=(0,c().IS)((()=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px"},settingsMenuSearchBox:{background:_().Tj.background.primary,marginBottom:10},syncSourceButton:{width:"100%",display:"flex",justifyContent:"center"},noResults:{width:"100%",paddingBottom:10,display:"flex",justifyContent:"center",fontSize:14,color:_().Tj.text.secondary},suggestionBox:{display:"flex",alignItems:"center",fontSize:12,color:_().oZ.white,background:_().oZ.blue,borderRadius:6,padding:10,boxShadow:_().Tj.shadowMD,alignSelf:"center",maxWidth:"80%",gap:6},errorMessage:{alignSelf:"center",padding:10,fontSize:14,color:_().Tj.red.text.accentPrimary},syncingData:{width:"100%",paddingBottom:10,display:"flex",justifyContent:"center",fontSize:14,color:_().Tj.text.secondary},filterContainer:{position:"relative",flexGrow:0,overflow:"hidden"},filterContainerScroller:{display:"flex",alignItems:"center",padding:"8px 12px"}})),[]),ee=(0,s().K8)((()=>w.collectionStore()),[w]),ne=(0,s().K8)((()=>w.collectionViewBlockStore()),[w]),ie=(0,a().v3)(),[{value:re,status:le}]=(0,v().Yb)((async()=>{if(!$)return;const e=$.parent_id;return B().callApi({eventName:"listExternalCollections",environment:ie,data:{bot_id:e}})}),[ie,$]),ae="success"===(null==re?void 0:re.type)&&"data"in re.data?re.data.data:[],se="success"===(null==re?void 0:re.type)&&"error"in re.data?re.data.error:null,ce=ae.filter((e=>!q||e.type===q)),de=ce.length?(0,T().Ay)(z,ce,(e=>e.title)):[],ue=Array.from(new Set(ae.map((e=>e.type)))),pe=te({integration:o,url:z}),ge=async e=>{if(Q(!0),!ee||!ne)return;const t=e||z,n=te({integration:o,url:t});if(!n)return Q(!1),void p().ui({items:[{label:(0,U.jsx)(I().sA,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.copyDebuggingInformation",defaultMessage:"Copy debugging information"}),color:"blue",onAccept:async()=>{const[e,o]=await Promise.all([(0,i().r)(),(0,r().jd)()]);o({environment:ie,stringValue:JSON.stringify({botId:null==$?void 0:$.parent_id,url:t},null,2),copiedMessage:e.copiedToClipboard})}},{label:(0,U.jsx)(I().sA,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.closeButton",defaultMessage:"Close"}),onAccept:()=>{}}],showCancel:!1,keepFocus:!1,message:(0,U.jsx)(I().sA,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.title",defaultMessage:"This source is currently not supported. Please try a different source."})});const l=(0,K().jw)(o.id);await R().startUnfurlRequestForCollection({environment:ie,url:t,botIds:l.map((e=>e.id)),externalCollectionStore:ee,externalCollectionViewBlockStore:ne,integrationId:o.id});const{host:a}=(0,M().qg)(t);P().lR(ie,{...(0,F().sl)(w),integrationId:o.id,type:"collection",entity:n.name,domain:a||"",from:"external_picker_settings"}),N().R8({collectionSettingsStore:A,item:{type:"shareSyncedView",integrationName:o.name,integrationIcon:o.info.icon}}),Q(!1)};if(!ee||!ne)return null;const me=ue.length>1?(0,U.jsx)("div",{style:Z.filterContainer,children:(0,U.jsxs)(E().H,{type:d().A.X,style:Z.filterContainerScroller,children:[(0,U.jsx)(V().A,{title:(0,U.jsx)("span",{children:t.formatMessage(oe.all)}),on:!(0,k().Pe)(q),hideChevron:!0,onClick:()=>{Y(null)}},"all"),ue.map((e=>(0,U.jsx)(V().A,{title:(0,U.jsx)("span",{children:t.formatMessage(oe[e])}),on:q===e,hideChevron:!0,onClick:()=>{Y((t=>t===e?null:e))}},e)))]})}):null,Se=pe?(0,U.jsx)("div",{style:Z.syncSourceButton,children:(0,U.jsx)(S().A,{colorPalette:"blue",size:"lg",onClick:()=>{ge()},disabled:!1,children:(0,U.jsx)(I().sA,{id:"collectionSettingsCreateExternalViewPicker.syncSourceButton.label",defaultMessage:"Sync Source"})})}):null,ye=pe||ae.length&&de.length?null:(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)("div",{style:Z.noResults,children:(0,U.jsx)(I().sA,{id:"collectionSettingsCreateExternalViewPicker.noResults.text",defaultMessage:"No results"})}),(0,U.jsxs)("div",{style:Z.suggestionBox,children:[(0,U.jsx)(g().I,{icon:C().infoCircleSmallIcon,size:"sm"}),(0,U.jsx)(I().sA,{defaultMessage:"Try different search or paste any {integration} URL",id:"collectionSettingsCreateExternalViewPicker.noResults.help",values:{integration:o.name}})]})]}),fe=ae.length&&de.length?(0,U.jsx)(h().A,{type:h().O.Vertical,initialFocus:0,sections:[{key:"collections",items:de.map((e=>{const t={key:e.url,render:t=>(0,U.jsx)(y().m,{renderTooltip:()=>(0,U.jsx)("span",{children:e.title}),placement:"left",textWrap:!0,render:o=>(0,U.jsx)(f().A,{...(0,l().A)(o||{},t),title:e.title,icon:(0,U.jsx)("img",{style:{width:18},src:e.icon}),caption:e.parent.title})}),action:t=>{"stopPropagation"in t.event&&t.event.stopPropagation(),ge(e.url)}};return t})),render:e=>(0,U.jsx)(x().A,{...e,disableMobilePadding:!0})}]}):null,he="pending"===le||"idle"===le||G;if(!$||se&&(se.status===b().nG.UNAUTHORIZED||se.status===b().nG.FORBIDDEN))return(0,U.jsx)(J,{collectionContextStore:w,collectionSettingsStore:A,integration:o});const xe="rejected"===le||"failed"===(null==re?void 0:re.type)||se,ve=(0,U.jsx)(W,{onClick:()=>{N().a2({collectionSettingsStore:A,item:{type:"selectAccountForExternalSource",integration:o,onAccountSelect:e=>{N().a2({collectionSettingsStore:A,item:{type:"createSyncedViewSource",externalAuthentication:e}})}}})},integration:o,accountName:$.account_name});return(0,U.jsx)(X().A,{...e,footer:Se||G?null:ve,title:(0,U.jsx)(I().sA,{defaultMessage:"Select from {integration}",id:"collectionSettingsCreateExternalViewPicker.title",values:{integration:o.name}}),header:!he&&"resolved"===le&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(D().Ay,{inputLeft:(0,U.jsx)(D().Zf,{icon:j().magnifyingGlassSmallIcon}),onSubmit:()=>{pe&&ge()},style:Z.settingsMenuSearchBox,focusInitial:!0,value:z,onChange:e=>{L(e.target.value)},placeholder:"Search source or paste a link..."}),pe?null:me]}),children:(0,U.jsxs)("div",{style:Z.settingsMenu,children:[xe?(0,U.jsx)("div",{style:Z.errorMessage,children:(0,U.jsx)(I().sA,{id:"collectionSettingsCreateExternalViewPicker.error.unknown",defaultMessage:"Something went wrong.",values:{integration:o.name}})}):void 0,he?G?(0,U.jsxs)("div",{style:Z.syncingData,children:[(0,U.jsx)("span",{children:(0,U.jsx)(I().sA,{id:"collectionSettingsCreateExternalViewPicker.settingUpSync",defaultMessage:"Setting up sync..."})}),(0,U.jsx)(m().A,{style:{alignSelf:"center"}})]}):(0,U.jsxs)("div",{style:Z.syncingData,children:[(0,U.jsx)("span",{children:(0,U.jsx)(I().sA,{id:"collectionSettingsCreateExternalViewPicker.loadingData",defaultMessage:"Loading available sources..."})}),(0,U.jsx)(m().A,{style:{alignSelf:"center"}})]}):void 0,he||"resolved"!==le?void 0:(0,U.jsxs)(U.Fragment,{children:[Se,ye,fe]})]})})}},448701:(e,t,o)=>{o.d(t,{R:()=>S,z:()=>y});var n=o(296540),i=()=>o(484714),r=()=>o(590526),l=()=>o(26697),a=()=>o(90907),s=()=>o(701751),c=()=>o(436696),d=()=>o(222299),u=()=>o(527438),p=()=>o(497222),g=o(474848);function m({collectionContextStore:e}){const t=e.collectionViewBlockStore(),o=void 0!==e.viewsModuleContextStore.state,n=Boolean(e.isDashboardWidget());return!(o||n||!t)&&(null==t?void 0:t.canEditCollection())}function S({collectionContextStore:e}){if((0,r().K8)((()=>m({collectionContextStore:e})),[e]))return(0,g.jsx)(y,{collectionContextStore:e},"lockAction")}function y({collectionContextStore:e}){const t=(0,i().v3)(),o=(0,r().K8)((()=>e.collectionViewBlockStore()),[e]),c=(0,r().K8)((()=>null==o?void 0:o.isLocked()),[o]),d=(0,r().K8)((()=>m({collectionContextStore:e})),[e]),S=(0,r().K8)((()=>null==o?void 0:o.isCollectionViewPageWithContent()),[o]),y=(0,r().K8)((()=>{if(o)return 0===o.getOwnedCollectionStores().length?"linkedOnly":null!=o&&o.hasSingleSourceAndNoLinkedCollections()?"singleSourceAndNoLinked":"multiSourceOrMixedSource"}),[o]),h=(0,n.useMemo)((()=>c?s().p:a().lockIcon),[c]);if(!o||!y||!d)return null;const{label:x,tooltip:v}=(0,u().nH)({collectionViewBlockSourceType:y,isCollectionViewPageWithContent:S,locked:c});return v?(0,g.jsx)(l().m,{renderTooltip:()=>v,render:o=>(0,g.jsx)(p().A,{...o,icon:h,title:x,onClick:()=>f(t,e)}),placement:"left"}):(0,g.jsx)(p().A,{icon:h,title:x,onClick:()=>f(t,e)})}function f(e,t){const o=t.collectionViewBlockStore();o&&(d().X6({environment:e,store:o,lock:!o.isLocked()}),(0,c().X)({environment:e,collectionContextStore:t,action:"click_toggle_lock"}))}},455338:(e,t,o)=>{o.d(t,{G:()=>a,t:()=>s});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(581454);var n=o.n(o(844751)),i=(o(296540),()=>o(128933)),r=()=>o(69708),l=o(474848);function a(e,t){const o=new Map,i=t.map((e=>{const t=[e.name,e.description].join(" ");return o.set(e.name,t),t})),r=new Set(n().filter(e,i).map((({original:e})=>e)));return t.filter((e=>{const t=o.get(e.name);return t&&r.has(t)}))}function s(e){const{featureName:t}=e;i().D6({label:(0,l.jsx)(r().sA,{id:"database.viewSettings.customizeMenu.successToastAfterFeatureAddition",defaultMessage:"Added {featureName} to this database.",values:{featureName:t}})})}},459004:(e,t,o)=>{o.d(t,{I:()=>d});o(296540);var n=()=>o(590526),i=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"2.16 3.72 15.57 12.55",svg:(0,i.jsx)("path",{d:"M9.5 9.374a.625.625 0 1 0 0 1.25h7.6a.625.625 0 1 0 0-1.25zm-2-5a.625.625 0 1 0 0 1.25H17a.625.625 0 1 0 0-1.25zM10.876 15c0-.346.28-.626.625-.626h5.6a.625.625 0 1 1 0 1.25h-5.6a.625.625 0 0 1-.625-.625M2.215 4.263c-.148-.237.035-.535.33-.535h2.287c.294 0 .477.298.33.535L4.016 6.094a.395.395 0 0 1-.658 0zm2.329 4.465c-.294 0-.477.298-.329.535l1.144 1.831a.395.395 0 0 0 .658 0l1.144-1.831c.148-.237-.035-.535-.329-.535zm1.671 5.535c-.148-.237.035-.535.33-.535h2.287c.294 0 .477.298.33.535l-1.145 1.831a.395.395 0 0 1-.658 0z"})},l=(0,o(340498).wt)("listToggleIndent",r,"default");var a=()=>o(69708),s=()=>o(69267),c=()=>o(497222);function d(e){const{collectionContextStore:t,right:o,onClick:r,menuListItemProps:d}=e,u=(0,n().K8)((()=>t.databaseTypeFromStoreState),[t]);return(0,i.jsx)(c().A,{icon:l,title:(0,i.jsx)(a().sA,{...(0,s().mv)({feature:"subitem",databaseType:u})}),right:o,showChevron:!0,onClick:r,menuListItemProps:d})}},478573:(e,t,o)=>{o.d(t,{A:()=>s});var n=o(296540),i=()=>o(401497),r=()=>o(249046),l=()=>o(100622),a=o(474848);const s=n.forwardRef(((e,t)=>{const{icon:n,name:s,subText:c,disabled:d,...u}=e,p=(0,i().eP)(),g=(0,i().IS)((()=>({iconContainer:{background:"light"===p?l().Tj.white:l().Tj.palette.translucentGray[100],borderWidth:1,borderStyle:"solid",borderColor:"light"===p?l().Tj.palette.gray[100]:l().Tj.palette.translucentGray[300],minWidth:32,width:32,height:32,borderRadius:4,overflow:"hidden"},buttonMenuItem:{padding:6},subText:{color:l().Tj.text.tertiary,fontSize:12}})),[p]);return(0,a.jsx)(o(81068).A,{...u,disabled:d,disabledFeedback:d,buttonStyle:{margin:0,width:"100%"},style:g.buttonMenuItem,itemMarginLeft:0,ref:t,title:(0,a.jsxs)(r().Ye,{gap:8,alignItems:"center",children:[(0,a.jsx)(r().Ye,{style:g.iconContainer,alignItems:"center",justifyContent:"center",children:n}),(0,a.jsxs)(r().wt,{children:[(0,a.jsx)("span",{children:s}),c?(0,a.jsx)("span",{style:g.subText,children:c}):null]})]})})}));s.displayName="AddPageLayoutModuleMenuButton"},523118:(e,t,o)=>{o.d(t,{_:()=>iy});var n=o(296540),i=()=>o(782482),r=()=>o(402014),l=()=>o(484714),a=()=>o(121924),s=()=>o(590526),c=()=>o(611648),d=()=>o(31511),u=()=>o(498212),p=()=>o(314529);function g(e,t){(0,p().DO_NOT_USE_trackLegacy)(e,"view_settings",t)}var m=()=>o(896628),S=()=>o(546754),y=(o(898992),o(354520),o(672577),o(581454),()=>o(564884)),f=()=>o(726637),h=()=>o(401497),x=()=>o(736847),v=()=>o(69708),b=()=>o(534177),C=()=>o(735695),j=()=>o(44935),w=()=>o(271205),A=()=>o(547149),I=()=>o(370493),_=()=>o(250910),T=()=>o(546926),k=()=>o(406094),M=()=>o(160432),P=()=>o(493552),B=()=>o(890492),V=()=>o(785285),F=()=>o(863330),D=()=>o(340498),E=()=>o(992437),O=()=>o(100622),R=()=>o(339798),K=()=>o(380468);function N(e){var t,o,n,i;const{conditionalColorRule:r,collectionContextStore:l,transaction:a,newColorRule:s,environment:c}=e,d=l.collectionViewStore(),u=l.normalizedFormatStore.state.conditional_color_rules;if(!d||!u)return;const p=[...u],g=p.findIndex((e=>e.id===r.id));-1!==g&&(p[g]={...p[g],...s},m().zA({stores:[d],update:{conditional_color_rules:p},transaction:a}),(0,y().u)({environment:c,event:{eventName:"conditional_color_rule_updated",eventProperties:{...(0,I().JO)({collectionContextStore:l,conditionalColorRule:r}),new_filter_operator:null===(t=s.conditional_filter)||void 0===t||null===(t=t.filter)||void 0===t?void 0:t.operator,new_background_type:null===(o=s.background)||void 0===o?void 0:o.type,new_background_color:"custom"===(null===(n=s.background)||void 0===n?void 0:n.type)?null===(i=s.background)||void 0===i?void 0:i.color:void 0}}}))}var z=o(474848);function L({collectionContextStore:e,collectionSettingsStore:t}){const o=(0,s().O$)(e.normalizedSchemaStore),i=(0,s().O$)(e.normalizedFormatStore),r=(0,l().v3)(),a=!i.conditional_color_rules||0===i.conditional_color_rules.length,c=(0,s().K8)((()=>e.collectionViewStore()?(0,V().Mz)({schema:o}):[]),[e,o]),d=(0,n.useCallback)((n=>{var i,l;if(!n)return;const s=(null===(i=e.collectionViewBlockStore())||void 0===i?void 0:i.getRecordModel)??E().b.constant(void 0),c=(0,I().bP)({propertyId:n,schema:o,getRecordModel:s,spaceIdCreator:r.idCreator.getSpaceIdCreatorSync((null===(l=e.collectionStore())||void 0===l?void 0:l.getSpaceId())??"")});c&&(a&&function(e){R().dP({collectionSettingsStore:e,item:{type:"conditionalColors"}})}(t),A().createAndCommit({userAction:"AddConditionalColorRuleButton.handlePropertyAccept",environment:r,canUndo:!0,perform:t=>{!function(e){const{collectionContextStore:t,conditionalColorRule:o,transaction:n,environment:i}=e,r=t.collectionViewStore();if(!r)return;const l=[...t.normalizedFormatStore.state.conditional_color_rules??[],o];m().zA({stores:[r],update:{conditional_color_rules:l},transaction:n}),(0,y().u)({environment:i,event:{eventName:"conditional_color_rule_created",eventProperties:(0,I().JO)({collectionContextStore:t,conditionalColorRule:o})}})}({collectionContextStore:e,conditionalColorRule:c,transaction:t,environment:r})}}))}),[e,t,r,a,o]),u=(0,h().IS)((()=>({button:{width:"100%",justifyContent:"center",padding:"6px 12px",...!a&&{borderColor:O().Tj.border.secondary},...f().A.isMobile&&{height:"48px",borderRadius:12},...f().A.isMobile&&!a&&{backgroundColor:O().Tj.background.primary,border:"none"}}})),[a]),p=a?(0,z.jsx)(v().sA,{defaultMessage:"New color setting",id:"database.viewSettings.createConditionalColorTab.newColorSetting"}):(0,z.jsx)(v().sA,{defaultMessage:"Add another",id:"database.viewSettings.conditionalColorsTab.addAnother"}),g=(0,n.useCallback)((e=>(0,z.jsx)(K().A,{schema:o,format:i,getProperties:()=>c,onAccept:t=>{d(t),e.close()}})),[o,i,c,d]);return(0,z.jsx)(_().A,{popupType:f().A.isMobile?_().z.BottomSheet:_().z.Popup,bottomSheetInitialState:"half",sameWidthAsOrigin:!0,originGap:4,renderOrigin:e=>{const t={...e,iconLeading:f().A.isMobile&&a?void 0:{icon:F().plusSmallIcon,size:f().A.isMobile?D().lD.default:D().Ev.sm},style:u.button};return a?(0,z.jsx)(M().A,{...t,colorPalette:"blue",children:(0,z.jsx)(P().D,{styleKey:(0,I().jc)(a),colorVariant:"inversePrimary",children:p})}):(0,z.jsx)(k().A,{...t,children:(0,z.jsx)(P().D,{styleKey:(0,I().jc)(a),colorVariant:"primary",children:p})})},render:e=>f().A.isMobile?(0,z.jsx)(B().A,{menuType:T().gu.Modal,title:(0,z.jsx)(v().sA,{defaultMessage:"Select property",id:"createConditionalColorTab.addConditionalColorRule.selectProperty"}),children:g(e)}):(0,z.jsx)(B().A,{menuType:T().gu.Popup,children:g(e)})})}var U=()=>o(59226),W=()=>o(395361),H=()=>o(807449),$=()=>o(81068),G=()=>o(656214),Q=()=>o(236262),q=()=>o(360843),Y=()=>o(554283),X=()=>o(118307),J=()=>o(854705);function Z({conditionalColorRule:e,handleChangeForApplyTo:t}){const o=(0,s().uB)(void 0,X().A),n=e.properties_to_color.type;return(0,z.jsx)(_().A,{popupType:_().z.Popup,buttonPopupStore:o,bottomSheetInitialState:"half",renderOrigin:e=>(0,z.jsx)(te,{...e,applyTo:n,buttonPopupStore:o}),render:e=>(0,z.jsx)(oe,{applyTo:n,handleChangeForApplyTo:t,parent:e})})}function ee({applyTo:e}){return"all"===e?(0,z.jsx)(v().sA,{defaultMessage:"Entire row",id:"CollectionSettingsViewConditionalColorRule.ApplyToMenu.applyToAll"}):(0,z.jsx)(v().sA,{defaultMessage:"This property",id:"CollectionSettingsViewConditionalColorRule.ApplyToMenu.applyToProperty"})}function te({applyTo:e,buttonPopupStore:t,...o}){const n=(0,s().K8)((()=>t.state.open),[t]),i=(0,h().IS)((()=>({applyToMenuButton:{display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",gap:4,height:24,marginInlineStart:"auto"},chevronIcon:{transform:n?void 0:"rotate(calc(var(--direction, 1) * -90deg))",transition:"transform 0.2s ease"}})),[n]);return(0,z.jsxs)("div",{...o,style:i.applyToMenuButton,children:[(0,z.jsx)(P().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,z.jsx)(ee,{applyTo:e})}),(0,z.jsx)(H().I,{icon:J().arrowChevronSingleDownFillSmallIcon,size:"sm",colorVariant:"tertiary",style:i.chevronIcon})]})}function oe({applyTo:e,handleChangeForApplyTo:t,parent:o}){return(0,z.jsx)(x().A,{children:["all","filtered_property_only"].map((n=>(0,z.jsx)($().A,{title:(0,z.jsx)(ee,{applyTo:n}),isChecked:e===n,onClick:()=>t(n,o),focused:!1},n)))})}o(944114);var ne=()=>o(388926),ie=()=>o(287188),re=()=>o(424400),le=()=>o(663639),ae=()=>o(898244),se=()=>o(906380),ce=()=>o(933152),de=()=>o(491073),ue=()=>o(27178);function pe({conditionalColorRule:e,onColorChange:t,propertySchema:o}){const n=(0,s().uB)(void 0,X().A),i=e.background,r="match_property_value"===(null==i?void 0:i.type),l="custom"===(null==i?void 0:i.type)?i.color:"default_background",a=!!o&&ae().Ou(o);return(0,z.jsx)(_().A,{popupType:f().A.isMobile?_().z.BottomSheet:_().z.Popup,buttonPopupStore:n,bottomSheetInitialState:"half",renderOrigin:e=>f().A.isMobile?(0,z.jsx)(Se,{...e,isMultiSelectProperty:a,isMatchPropertyValue:r,backgroundCustomColor:l}):(0,z.jsx)(me,{...e,isMultiSelectProperty:a,isMatchPropertyValue:r,backgroundCustomColor:l,buttonPopupStore:n}),render:n=>f().A.isMobile?(0,z.jsx)(fe,{isMultiSelectProperty:a,conditionalColorRule:e,propertySchema:o,onColorChange:e=>{t(e,n)},backgroundCustomColor:l,isMatchPropertyValue:r}):(0,z.jsx)(ye,{isMultiSelectProperty:a,conditionalColorRule:e,propertySchema:o,onColorChange:e=>{t(e,n)},backgroundCustomColor:l,isMatchPropertyValue:r})})}function ge({isMultiSelectProperty:e}){return e?(0,z.jsx)(v().sA,{defaultMessage:"Match first option",id:"CollectionSettingsViewConditionalColorRule.matchFirstOption"}):(0,z.jsx)(v().sA,{defaultMessage:"Match option",id:"CollectionSettingsViewConditionalColorRule.matchOption"})}function me({isMultiSelectProperty:e,isMatchPropertyValue:t,backgroundCustomColor:o,buttonPopupStore:n,...i}){const r=(0,s().K8)((()=>n.state.open),[n]),l=(0,h().IS)((()=>({colorMenuButton:{display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",gap:4,height:24,marginInlineStart:"auto"},colorDisplayContainer:{display:"flex",alignItems:"center",gap:8},chevronIcon:{transform:r?void 0:"rotate(calc(var(--direction, 1) * -90deg))",transition:"transform 0.2s ease"}})),[r]);return(0,z.jsxs)("div",{...i,style:l.colorMenuButton,children:[t?(0,z.jsx)(P().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,z.jsx)(ge,{isMultiSelectProperty:e})}):(0,z.jsxs)("div",{style:l.colorDisplayContainer,children:[(0,z.jsx)(de().Kc,{color:o,isHovered:!1,selected:!1,overrideStyles:{width:16,height:16,borderRadius:4}}),(0,z.jsx)(P().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,ue().ZN)(o)})]}),(0,z.jsx)(H().I,{icon:J().arrowChevronSingleDownFillSmallIcon,size:"sm",colorVariant:"tertiary",style:l.chevronIcon})]})}function Se({isMultiSelectProperty:e,isMatchPropertyValue:t,backgroundCustomColor:o,...n}){return(0,z.jsx)($().A,{...n,focused:!1,icon:t?(0,z.jsx)(H().I,{icon:ce().M}):(0,z.jsx)(de().Kc,{color:o,isHovered:!1,selected:!1,overrideStyles:{width:22,height:22,borderRadius:6,margin:0}}),title:t?(0,z.jsx)(ge,{isMultiSelectProperty:e}):(0,z.jsx)(v().sA,{...(0,ue().qo)(o)}),right:(0,z.jsx)(H().I,{icon:se().arrowChevronSingleRightSmallIcon,size:"sm",colorVariant:"secondary"})})}function ye({isMultiSelectProperty:e,conditionalColorRule:t,onColorChange:o,propertySchema:n,backgroundCustomColor:i,isMatchPropertyValue:r}){const l=(0,h().IS)((()=>({container:{padding:4},matchOptionContainer:{display:"flex",alignItems:"center",alignSelf:"stretch",gap:8,padding:"4px 8px"},matchOptionToggle:{marginInlineStart:"auto"},colorGrid:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",columnGap:4,rowGap:8,padding:"8px"},divider:{padding:"4px 8px"}})),[]);return(0,z.jsxs)("div",{style:l.container,children:[(0,I().$Y)(n,t.conditional_filter.filter)?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)("div",{style:l.matchOptionContainer,children:[(0,z.jsx)(P().D,{styleKey:"bodyRegular",colorVariant:"primary",children:(0,z.jsx)(ge,{isMultiSelectProperty:e})}),(0,z.jsx)("div",{style:l.matchOptionToggle,children:(0,z.jsx)(ie().A,{on:r,onClick:()=>{o(r?"default_background":"match_property_value")}})})]}),(0,z.jsx)(ne().A,{size:1,colorVariant:"secondary",type:"horizontal",style:l.divider})]}):null,(0,z.jsx)("div",{style:l.colorGrid,children:O().AQ.map((e=>{const t=e===i&&!r;return(0,z.jsx)(de().Ay,{color:e,style:{width:"100%"},iconStyle:{opacity:r?.4:1},onClick:()=>{o(e)},focused:t,selected:t,shouldShowUpdatedColorPicker:!0},e)}))})]})}function fe({isMultiSelectProperty:e,conditionalColorRule:t,onColorChange:o,propertySchema:n,backgroundCustomColor:i,isMatchPropertyValue:r}){const l=[];return(0,I().$Y)(n,t.conditional_filter.filter)&&l.push({key:"match-option",render:e=>(0,z.jsx)(x().A,{...e}),items:[{key:"match-property-toggle",render:t=>(0,z.jsx)(re().Ay,{...t,icon:(0,z.jsx)(H().I,{icon:ce().M,size:"lg"}),title:(0,z.jsx)(ge,{isMultiSelectProperty:e}),right:(0,z.jsx)(ie().A,{on:r})}),action:()=>{o(r?"default_background":"match_property_value")}}]}),l.push({key:"background-colors",render:e=>(0,z.jsx)(x().A,{...e,children:e.children}),items:O().AQ.map((e=>({key:e,action:()=>{o(e)},render:t=>{const o=e===i&&!r;return(0,z.jsx)(de().Ay,{...t,color:e,selected:o,focused:o,shouldShowUpdatedColorPicker:!1,iconStyle:{opacity:r?.4:1,width:22,height:22}})}})))}),(0,z.jsx)(B().A,{menuType:T().gu.Modal,title:(0,z.jsx)(v().sA,{defaultMessage:"Select color",id:"ConditionalColorRuleColorMenu.selectColorTitle"}),children:(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:0,sections:l})})}var he=()=>o(631524),xe=()=>o(352321),ve=()=>o(335452),be=()=>o(478367),Ce=()=>o(214388),je=()=>o(249947),we=()=>o(713998),Ae=()=>o(784892),Ie=()=>o(480912),_e=()=>o(704452),Te=()=>o(132389),ke=()=>o(990736),Me=()=>o(399762);function Pe({propertyFilter:e,schema:t,parentStore:o,onDelete:i,onChange:r,onChangeDebounced:l}){const a=t[e.property],s=(0,v().tz)(),c=(0,h().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:1,width:"100%",padding:4},plainButton:{height:"100%",paddingInlineStart:4,paddingInlineEnd:4,transition:"none",paddingBottom:4},plainButtonHovered:{background:"none"},plainButtonPressed:{background:"none"},tokenWrap:{paddingTop:2},tokenRight:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20},tokenInput:{pointerEvents:"none",minHeight:30}})),[]),d=(0,n.useMemo)((()=>{if(!(0,b().O9)(a))return!1;const t=e.filter;return((0,Ce().v0)(t)||(0,Ce().as)(t)||(0,Ce().H$)(t)||(0,ve().n)(t)||(0,be().I)(t)||(0,Ce().Ui)(t)||(0,Ce().Pq)(t))&&(0,Ce().gc)(t)}),[e.filter,a]),u=(0,n.useCallback)((n=>{const i=function({propertyFilter:e,schema:t,parentStore:o,relatedCollectionAppConfigUri:n}){const{filter:i}=e,r=t[e.property];if(!(0,b().O9)(r)||!(0,Ce().gc)(i)||(0,Ce().t_)(e))return[];if((0,Ce().v0)(i)||(0,Ce().as)(i)){if("select"!==r.type&&"multi_select"!==r.type)return[];const e=((0,Ce().v0)(i)?(0,Ce().Zl)(i):(0,Ce().SM)(i)).map((({value:e})=>{var t;return null===(t=r.options)||void 0===t?void 0:t.find((t=>t.value===e))})).filter(b().O9);return e.map((t=>(0,z.jsx)(Me().O,{value:t.value,color:t.color,format:Ae().NY.Small,showRemoveButton:!1,isSingle:1===e.length,hideTooltip:!1,description:t.description},t.id)))}if((0,Ce().H$)(i)){if("status"!==r.type)return[];const e=(0,Ce().V6)(i),t=r.options??[],o=r.groups??[];return e.map((({value:n,type:i})=>{if(n&&i){if("is_group"===i){const t=o.find((e=>e.name===n));return t?(0,z.jsx)("div",{style:{margin:1===e.length?0:"0 6px 6px 0",height:"20px",lineHeight:"20px"},children:(0,z.jsx)(Ie().RS,{group:t,showIcon:!0,showColor:!0})},t.id):void 0}if("is_option"===i){const i=(0,we().jy)(t,n);if(!i)return;const r=o.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(i.id)}));return(0,z.jsx)(Me().q,{format:Ae().NY.Medium,isSingle:1===e.length,value:i.value,color:i.color,showRemoveButton:!1,groupColor:null==r?void 0:r.color},i.id)}(0,b().HB)(i)}})).filter(b().O9)}if((0,Ce().Pq)(i)){if("relation"!==r.type)return[];const e=(0,Ce().Rh)(i);return e.map(((t,i)=>{if(!t.value)return null;const r={format:f().A.isMobile?Ae().NY.Large:Ae().NY.Small,shouldWrap:!1,showRemoveButton:!1,isSingle:1===e.length,shouldShrink:!0};return(0,z.jsx)(ke().g,{value:t,tokenProps:r,parentStore:o,relatedCollectionAppConfigUri:n},i)}))}const l=(0,z.jsx)(_e().C3,{propertyFilter:e,schema:t,parentStore:o,relatedCollectionAppConfigUri:n}),a=(0,Ce().Cw)(i)?(0,z.jsx)(_e().tl,{propertyFilter:e}):null;return[a,a?(0,z.jsx)(Te().A,{size:4},"spacer"):void 0,l]}({propertyFilter:e,schema:t,parentStore:o});return(0,z.jsx)(he().p,{onClick:()=>n.onClick(),style:c.plainButton,hoveredStyle:c.plainButtonHovered,pressedStyle:c.plainButtonPressed,children:(0,z.jsx)(xe().Ay,{format:xe().le.FilterValue,tokens:i,placeholder:s.formatMessage({id:"collectionConditionalColor.filterDropdown.placeholder",defaultMessage:"Select..."}),onChange:()=>{},value:"",onRemoveLastToken:()=>{},hideInput:i.length>0,showBorder:!0,tokenWrapStyle:c.tokenWrap,style:c.tokenInput,right:(0,z.jsx)(H().I,{icon:J().arrowChevronSingleDownFillSmallIcon,size:"sm",colorVariant:"tertiary"}),rightWrapStyle:c.tokenRight})})}),[c,e,t,o,s]),p=(0,n.useCallback)((n=>(0,z.jsx)(je().td,{propertyFilter:e,schema:t,parentStore:o,userCanConfigureFilters:!0,allowRelativeDateFilter:!0,allowRelativePersonFilter:!0,context:je().mL.ConditionalColorRule,hideTopActions:!0,onChange:r,onChangeDebounced:l,onClose:n.close})),[e,t,o,r,l]);return d?(0,z.jsxs)("div",{style:c.container,children:[(0,z.jsx)(je().Ti,{propertyFilter:e,onChange:r,schema:t,parentStore:o,userCanConfigureFilters:!0,onDelete:i,context:je().mL.ConditionalColorRule}),(0,z.jsx)(x().A,{children:(0,z.jsx)(_().A,{popupType:_().z.Popup,placementToOrigin:"bottom",sameWidthAsOrigin:!0,originGap:4,borderRadius:8,disabled:!1,renderOrigin:u,render:p})})]}):(0,z.jsx)(je().td,{propertyFilter:e,schema:t,parentStore:o,userCanConfigureFilters:!0,allowRelativeDateFilter:!0,allowRelativePersonFilter:!0,context:je().mL.ConditionalColorRule,onDelete:i,onChange:r,onChangeDebounced:l})}function Be(e){const{collectionContextStore:t,conditionalColorRule:o}=e,[i,r]=(0,Y().B)(),[a,c]=(0,Y().B)(),d=(0,s().O$)(t.normalizedSchemaStore),u=(0,s().K8)((()=>t.collectionViewStore()),[t]),p=(0,l().v3)(),g=(0,s().K8)((()=>t.getViewType()),[t]),S=(0,U().X)("collection_view_conditional_colors_property_level"),x=(0,n.useCallback)((()=>{A().createAndCommit({userAction:"CollectionSettingsViewConditionalColorRule.handleDeleteConditionalColorRule",environment:p,canUndo:!0,perform:e=>{!function(e){const{conditionalColorRule:t,collectionContextStore:o,transaction:n,environment:i}=e,r=o.collectionViewStore(),l=o.normalizedFormatStore.state.conditional_color_rules;if(!r||!l)return;const a=l.filter((e=>e.id!==t.id));m().zA({stores:[r],update:{conditional_color_rules:a},transaction:n}),(0,y().u)({environment:i,event:{eventName:"conditional_color_rule_deleted",eventProperties:(0,I().JO)({collectionContextStore:o,conditionalColorRule:t})}})}({collectionContextStore:t,conditionalColorRule:o,transaction:e,environment:p})}})}),[t,p,o]),b=(0,n.useCallback)((e=>{var n;const i={conditional_filter:{property:o.conditional_filter.property,filter:e}},r="match_property_value"===(null===(n=o.background)||void 0===n?void 0:n.type),l="is_empty"===e.operator;r&&l&&(i.background={type:"custom",color:"default_background"}),A().createAndCommit({userAction:"CollectionSettingsViewConditionalColorRule.handleFilterValueChange",environment:p,canUndo:!0,perform:e=>{N({collectionContextStore:t,conditionalColorRule:o,transaction:e,newColorRule:i,environment:p})}})}),[t,p,o]),C=(0,W().Y)(b,250),j=(0,n.useCallback)(((e,n)=>{n.close();const i={background:"match_property_value"===e?{type:"match_property_value"}:{type:"custom",color:e}};A().createAndCommit({userAction:"CollectionSettingsViewConditionalColorRule.handleColorChange",environment:p,canUndo:!0,perform:e=>{N({collectionContextStore:t,conditionalColorRule:o,transaction:e,newColorRule:i,environment:p})}})}),[t,p,o]),w=(0,n.useCallback)(((e,n)=>{n.close();const i={properties_to_color:{type:e}};A().createAndCommit({userAction:"CollectionSettingsViewConditionalColorRule.handleColorChange",environment:p,canUndo:!0,perform:e=>{N({collectionContextStore:t,conditionalColorRule:o,transaction:e,newColorRule:i,environment:p})}})}),[t,p,o]),_="board"===g||"gallery"===g?(0,z.jsx)(v().sA,{defaultMessage:"Card background",id:"CollectionSettingsViewConditionalColorRule.cardBackground"}):(0,z.jsx)(v().sA,{defaultMessage:"Page background",id:"CollectionSettingsViewConditionalColorRule.pageBackground"}),T=(0,h().IS)((()=>({container:{background:O().Tj.background.secondary,display:"flex",flexDirection:"column",alignItems:"stretch",borderRadius:10,border:`1px solid ${O().Tj.background.secondary}`,width:"100%",position:"relative"},row:{display:"flex",alignItems:"center",paddingTop:0,paddingInlineEnd:12,paddingBottom:8,paddingInlineStart:12},dragHandle:{position:"absolute",insetInlineStart:-11,top:4,justifyContent:"center",alignItems:"center",padding:2,opacity:r?1:0,visibility:r?"visible":"hidden",transition:"opacity 0.2s ease, visibility 0.2s ease",zIndex:1,background:O().Tj.background.secondary,borderRadius:6,cursor:"grab"},dragHandleIconContainer:{display:"flex",width:12,padding:4,justifyContent:"center",alignItems:"center",borderRadius:4,background:c?O().Tj.background.tertiary:void 0},dragHandleIcon:{fill:O().Tj.icon.secondary}})),[r,c]);return d&&u?f().A.isMobile?(0,z.jsx)(Ve,{conditionalColorRule:o,schema:d,collectionContextStore:t,collectionViewStore:u,viewType:g,onColorChange:j,onFilterChange:b,onDelete:x}):(0,z.jsxs)("div",{style:T.container,ref:i,children:[(0,z.jsx)("div",{style:T.dragHandle,ref:a,children:(0,z.jsx)("div",{style:T.dragHandleIconContainer,children:(0,z.jsx)(H().I,{icon:G().N,size:"xs",style:{fill:T.dragHandleIcon.fill}})})}),(0,z.jsx)(Pe,{propertyFilter:o.conditional_filter,schema:d,parentStore:u,onDelete:x,onChange:b,onChangeDebounced:C}),(0,z.jsxs)("div",{style:T.row,children:[(0,z.jsx)(P().D,{styleKey:"bodyRegular",colorVariant:"primary",style:{flex:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:_}),(0,z.jsx)(pe,{conditionalColorRule:o,onColorChange:j,propertySchema:d[o.conditional_filter.property]})]}),"table"===g&&S?(0,z.jsxs)("div",{style:T.row,children:[(0,z.jsx)(P().D,{styleKey:"bodyRegular",colorVariant:"primary",children:(0,z.jsx)(v().sA,{defaultMessage:"Apply to",id:"CollectionSettingsViewConditionalColorRule.applyTo"})}),(0,z.jsx)(Z,{conditionalColorRule:o,handleChangeForApplyTo:w})]}):void 0]}):null}function Ve(e){const{conditionalColorRule:t,schema:o,collectionContextStore:i,collectionViewStore:r,viewType:l,onFilterChange:a,onDelete:c,onColorChange:d}=e,{propertySchema:u,ruleIndex:p}=(0,s().K8)((()=>{const e=(i.normalizedFormatStore.state.conditional_color_rules||[]).findIndex((e=>e.id===t.id));return{propertySchema:null==o?void 0:o[t.conditional_filter.property],ruleIndex:e}}),[o,t,i]),g=(0,n.useCallback)(((e,t)=>{a(t.filter)}),[a]);return o&&l&&r&&u?(0,z.jsxs)(x().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Color setting {index}",id:"database.conditionalColorMenu.ruleIndex",values:{index:p+1}}),mobileStyle:{marginBottom:8},children:[(0,z.jsx)(q().A,{index:p,propertyFilter:t.conditional_filter,schema:o,filterOperator:null,parentStore:r,onChange:g,collectionContextStore:i,collectionViewType:l,collectionViewId:r.id,disablePropertyChange:!0},p),(0,z.jsx)(pe,{conditionalColorRule:t,onColorChange:d,propertySchema:u}),(0,z.jsx)($().A,{focused:!1,icon:(0,z.jsx)(H().I,{icon:Q().trashIcon}),onClick:c,title:(0,z.jsx)(v().sA,{defaultMessage:"Delete color setting",id:"conditionalColorMenu.deleteColorSetting.title"}),isRedOnHover:!0})]}):null}function Fe(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,i=(0,l().v3)(),r=(0,s().K8)((()=>t.normalizedFormatStore.state.conditional_color_rules),[t.normalizedFormatStore]),a=(0,h().IS)((()=>({container:{padding:"12px 16px",display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",gap:12},draggableList:{width:"100%"}})),[]),c=(0,n.useCallback)((e=>{const o=t.collectionViewStore();o&&(A().createAndCommit({userAction:"CollectionSettingsViewConditionalColors.handleColorRuleDrop",environment:i,canUndo:!0,perform:t=>{m().zA({stores:[o],update:{conditional_color_rules:e.map((e=>null==r?void 0:r.find((t=>t.id===e)))).filter(b().O9)},transaction:t})}}),(0,y().u)({environment:i,event:{eventName:"conditional_color_rules_reordered",eventProperties:(0,I().JO)({collectionContextStore:t})}}))}),[i,t,r]);return(0,z.jsx)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Conditional color",id:"database.viewSettings.conditionalColorsTab.title"}),children:f().A.isMobile?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(j().i,{children:r&&r.length>0?r.map((e=>(0,z.jsx)(Be,{conditionalColorRule:e,collectionContextStore:t},e.id))):null}),(0,z.jsx)(x().A,{topBorder:!0,children:(0,z.jsx)(L,{collectionContextStore:t,collectionSettingsStore:o})})]}):(0,z.jsxs)("div",{style:a.container,children:[r&&r.length>0?(0,z.jsx)(w().Ay,{shouldAnimateDrop:!0,direction:"vertical",keys:r.map((e=>e.id)),style:a.draggableList,gap:12,renderKey:(e,o)=>(0,z.jsx)(Be,{collectionContextStore:t,conditionalColorRule:r[o]},e),onDrop:c}):null,(0,z.jsx)(L,{collectionContextStore:t,collectionSettingsStore:o})]})})}function De(e){const{collectionSettingsStore:t,collectionContextStore:o}=e,n=(0,s().K8)((()=>o.getViewType()),[o]),i="dark"===(0,h().eP)(),r=(0,h().IS)((()=>({descriptionContainer:{margin:f().A.isMobile?"24px 0":"16px 0"},container:{display:"flex",flexDirection:"column",margin:"12px 16px"},previewImage:{maxWidth:"100%",height:"128px",borderRadius:10,...!f().A.isMobile&&{border:`1px solid ${O().Tj.border.secondary}`}}})),[]);return n?(0,z.jsx)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Conditional color",id:"database.viewSettings.createConditionalColorTab.title"}),children:(0,z.jsxs)("div",{style:r.container,children:[(0,z.jsx)("img",{src:(0,I().V_)({collectionViewType:n,isDarkMode:i}),style:r.previewImage,alt:"Conditional color preview image for the collection view type "}),(0,z.jsx)("div",{style:r.descriptionContainer,children:(0,z.jsx)(P().D,{styleKey:"captionRegular",colorVariant:"secondary",children:(0,z.jsx)(v().sA,{defaultMessage:"Customize page colors to easily distinguish categories, highlight overdue events, and bring clarity to your work.",id:"database.viewSettings.createConditionalColorTab.description"})})}),(0,z.jsx)(L,{collectionContextStore:o,collectionSettingsStore:t})]})}):null}var Ee=()=>o(79926);const Oe=new(Ee().O2)("database-automations",(()=>Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(62475),o.e(3151),o.e(98629),o.e(45158),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(44854),o.e(87017),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(44584),o.e(24587),o.e(67494),o.e(3651),o.e(38293),o.e(40992),o.e(88455),o.e(64556),o.e(33893),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(68637),o.e(74562),o.e(39986),o.e(47431),o.e(76677),o.e(68609),o.e(15553),o.e(77345),o.e(67720),o.e(37759),o.e(41423),o.e(21627),o.e(77777),o.e(3261),o.e(81803),o.e(32625),o.e(11424),o.e(46162),o.e(79665)]).then(o.bind(o,940169)))),Re=(0,Ee()._h)(Oe,(e=>e.CollectionSettingsAutomationsView)),Ke=new(Ee().O2)("ConnectionsSettings",(()=>o.e(10049).then(o.bind(o,738745)))),Ne=(0,Ee()._h)(Ke,(e=>e.ConnectionsSettings));var ze=()=>o(907258),Le=()=>o(388693),Ue=()=>o(769145),We=()=>o(284371),He=()=>o(994641),$e=(o(16280),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(823215),o(908872),o(737550),()=>o(242422)),Ge=()=>o(365917),Qe=()=>o(874832),qe=()=>o(420802),Ye=()=>o(26697),Xe=()=>o(302501),Je=()=>o(852424),Ze=()=>o(165358),et=()=>o(187174),tt=()=>o(940563),ot=()=>o(361173),nt=()=>o(778078),it=()=>o(973647),rt=()=>o(803074),lt=()=>o(183558),at=()=>o(312296);var st=()=>o(79650),ct=()=>o(718827),dt=()=>o(98126),ut=()=>o(206372);function pt(e){const{title:t,items:o,handleSelect:i,isSelectAll:r,sectionCallout:l,selectAllTooltipContent:a,isSectionItemsLoading:s,disableSelectAll:c}=e,[d,u]=n.useState(!0),p=e.disableCollapse??!1,g=(0,h().IS)((()=>({sectionMargin:{paddingTop:4,paddingInlineEnd:6,paddingBottom:4,paddingInlineStart:6},sectionTitleContainer:{display:"flex",padding:"4px",borderRadius:6,gap:4,alignItems:"center"},sectionMenuDesktopTitleStyle:{padding:0,margin:0,alignItems:"center"},arrow:{transition:"transform 200ms ease-out",transform:`rotateZ(${d?0:-90}deg)`,fill:"inherit",opacity:1,marginTop:2},menuList:{paddingTop:0,paddingBottom:0}})),[d]);return o.length?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(x().A,{style:{...g.sectionMargin},desktopTitleStyle:g.sectionMenuDesktopTitleStyle,title:(0,z.jsxs)(ct().Ay,{style:g.sectionTitleContainer,onClick:()=>u(!d),disabled:p,children:[t,p?void 0:(0,z.jsx)(H().I,{icon:J().arrowChevronSingleDownFillSmallIcon,style:g.arrow,size:"xxs"}),s?(0,z.jsx)(dt().A,{style:{alignSelf:"right"}}):void 0]}),right:!c&&o.length&&d&&!s&&(0,z.jsx)(Ye().m,{renderTooltip:e=>(0,z.jsx)("div",{...e,style:ut().Q$,children:a}),render:e=>(0,z.jsx)("div",{...e,children:(0,z.jsx)(gt,{onClick:i,isSelectAll:r})}),disableTooltip:!a})}),d?(0,z.jsxs)(z.Fragment,{children:[l,(0,z.jsx)(le().A,{style:g.menuList,type:le().O.Vertical,initialFocus:0,disableInitialScroll:!0,sections:[{key:"collapsableSectionMenuList",render:e=>(0,z.jsx)(x().A,{topBorder:!1,...e}),items:o}]})]}):void 0]}):null}function gt(e){return(0,z.jsx)(he().p,{size:"sm",shouldShrink:!0,colorPalette:"blue",style:{fontSize:We().J.UISmall.desktop,height:"fit-content",padding:"4px"},onClick:e.onClick,children:e.isSelectAll?(0,z.jsx)(v().sA,{id:"database.viewSettings.collapsableSection.selectAll",defaultMessage:"Select all"}):(0,z.jsx)(v().sA,{id:"database.viewSettings.collapsableSection.unselectAll",defaultMessage:"Unselect all"})})}var mt=()=>o(419357),St=()=>o(757695),yt=()=>o(206267);class ft extends St().Store{getInitialState(){return{flowId:void 0,type:"connected_properties_setup",collectionsProperties:{}}}createNewFlowId(){const e=(0,yt().JW)();return this.setState({...this.state,flowId:e}),e}getFlowId(){return this.state.flowId?this.state.flowId:this.createNewFlowId()}addCollectionProperties(e,t){const o=this.state.collectionsProperties[e],n=o?{...o,...t}:t;this.setState({...this.state,collectionsProperties:{...this.state.collectionsProperties,[e]:n}})}removeCollectionProperties(e,t){const o=this.state.collectionsProperties[e];if(!o)return;const n=Object.fromEntries(Object.entries(o).filter((([e])=>!t.has(e))));if(0===Object.keys(n).length){const{[e]:t,...o}=this.state.collectionsProperties;this.setState({...this.state,collectionsProperties:o})}else this.setState({...this.state,collectionsProperties:{...this.state.collectionsProperties,[e]:n}})}}const ht=new ft;(0,o(852832).exposeDebugValue)("ConnectedPropertiesSyncStore",ht);var xt=()=>o(732810),vt=()=>o(617871),bt=(o(803949),()=>o(638681)),Ct=()=>o(527328);const jt={name:"User",regex:"^(https?:\\/\\/)?(?<instanceUrl>[a-z0-9-]+\\.[\\w.]+\\.force\\.com)\\/lightning\\/r\\/User\\/(?<recordId>[a-zA-Z0-9]+)\\/(?<action>[a-zA-Z0-9_]+)?(\\?(?<queryParams>[^\\s#]*))?$",sample_urls:["https://notion.lightning.force.com/lightning/r/User/0055b00000MWTaJAAX/view","https://notion.lightning.force.com/lightning/r/user/0055b00000MWTaJAAX/view"],additional_types:{connectedRelation:!0},attributes:Ct().eV.attributes,connected_relation_properties:{title:{name:"Name",type:"title"},Id:{name:"Id",type:"text"},CreatedDate:{name:"Created Date",type:"date"},LastModifiedDate:{name:"Last Modified Date",type:"date"},Email:{name:"Email",type:"email"},SmallPhotoUrl:{name:"Avatar URL",type:"url"},NotionUser:{name:"Notion User",type:"relation",uri:"notion://user-defined-collection/salesforce:User"}},connected_relation_sub_schemas:{"notion://user-defined-collection/salesforce:User":{title:{name:"Name",type:"title"}}}},wt={name:"Report",regex:"^(https?:\\/\\/)?(?<instanceUrl>[a-z0-9-]+\\.[\\w.]+\\.force\\.com)\\/lightning\\/r\\/Report\\/(?<recordId>[a-zA-Z0-9]+)\\/(?<action>[a-zA-Z0-9_]+)?(\\?(?<queryParams>[^\\s#]*))?$",sample_urls:["https://notionlabs-dev-ed.develop.lightning.force.com/lightning/r/Report/00O5b000000Xr5jEAC/view","https://notionlabs-abc-dev-ed.develop.lightning.force.com/lightning/r/Report/00O5b000000Xr5jEAC/view?queryParamsAny=test"],attributes:Ct().eV.attributes},At=[{name:"Account",regex:"^(https?:\\/\\/)?(?<instanceUrl>[a-z0-9-]+\\.[\\w.]+\\.force\\.com)\\/lightning\\/r\\/Account\\/(?<recordId>[a-zA-Z0-9]+)\\/(?<action>[a-zA-Z0-9_]+)",sample_urls:["https://notionlabs-dev-ed.develop.lightning.force.com/lightning/r/Account/001bm000004etjTAAQ/view","https://notionlabs-dev-ed.develop.lightning.force.com/lightning/r/Account/001bm000004euUDAAY/view"],attributes:Ct().eV.attributes,additional_types:{connectedRelation:!0},connected_relation_properties:{...Ct().eV.connected_relation_properties,Type:{name:"Type",type:"text"},AccountNumber:{name:"Account Number",type:"text"},AnnualRevenue:{name:"Annual Revenue",type:"number"},Website:{name:"Website",type:"url"},Phone:{name:"Phone",type:"phone_number"},Description:{name:"Description",type:"text"},ParentId:{uri:"notion://user-defined-collection/salesforce:Account",name:"Parent Account",type:"relation"},OwnerId:{uri:"notion://user-defined-collection/salesforce:User",name:"Account Owner",type:"relation"},mapped_OwnerId:{name:"Mapped Account Owner",uri:"notion://user-defined-collection/salesforce:User",type:"person",source_property_id:"Email"}},connected_relation_sub_schemas:Ct().eV.connected_relation_sub_schemas},{name:"Contact",regex:"^(https?:\\/\\/)?(?<instanceUrl>[a-z0-9-]+\\.[\\w.]+\\.force\\.com)\\/lightning\\/r\\/Contact\\/(?<recordId>[a-zA-Z0-9]+)\\/(?<action>[a-zA-Z0-9_]+)",sample_urls:["https://notionlabs-dev-ed.develop.lightning.force.com/lightning/r/Contact/003bm000004etjTAAQ/view","https://notionlabs-dev-ed.develop.lightning.force.com/lightning/r/Contact/003bm000004euUDAAY/view"],attributes:Ct().eV.attributes,additional_types:{connectedRelation:!0},connected_relation_properties:{...Ct().eV.connected_relation_properties,Phone:{name:"Phone",type:"phone_number"},Email:{name:"Email",type:"email"},AccountId:{uri:"notion://user-defined-collection/salesforce:Account",name:"Account",type:"relation"}},connected_relation_sub_schemas:Ct().eV.connected_relation_sub_schemas},{name:"Opportunity",regex:"^(https?:\\/\\/)?(?<instanceUrl>[a-z0-9-]+\\.[\\w.]+\\.force\\.com)\\/lightning\\/r\\/Opportunity\\/(?<recordId>[a-zA-Z0-9]+)\\/(?<action>[a-zA-Z0-9_]+)",sample_urls:["https://notionlabs-dev-ed.develop.lightning.force.com/lightning/r/Opportunity/006bm000004etjTAAQ/view","https://notionlabs-dev-ed.develop.lightning.force.com/lightning/r/Opportunity/006bm000004euUDAAY/view"],attributes:Ct().eV.attributes,additional_types:{connectedRelation:!0},connected_relation_properties:{...Ct().eV.connected_relation_properties,Amount:{name:"Amount",type:"number"},CloseDate:{name:"Close Date",type:"date"},StageName:{name:"Stage",type:"text"},AccountId:{uri:"notion://user-defined-collection/salesforce:Account",name:"Account",type:"relation"},OwnerId:{name:"Owner",uri:"notion://user-defined-collection/salesforce:User",type:"relation"},mapped_OwnerId:{name:"Mapped Opportunity Owner",uri:"notion://user-defined-collection/salesforce:User",type:"person",source_property_id:"Email"}},connected_relation_sub_schemas:Ct().eV.connected_relation_sub_schemas},jt],It=(Ct().eV,At.map((e=>({name:e.name,additional_types:e.additional_types,connected_relation_properties:e.connected_relation_properties,connected_relation_sub_schemas:e.connected_relation_sub_schemas}))),bt().string());bt().object({required:{Name:bt().string(),Id:It,CreatedById:It},optional:{UserName:bt().string(),SmallPhotoUrl:bt().nullable(bt().string()),Alias:bt().nullable(bt().string()),Email:bt().nullable(bt().string()),IsActive:bt().boolean(),ProfileId:bt().nullable(It),UserType:bt().nullable(bt().string())}}),bt().union([bt().object({required:{scope:bt().string(),signature:bt().string(),access_token:bt().string(),instance_url:bt().string(),id:bt().string(),token_type:bt().string(),issued_at:bt().string()},optional:{id_token:bt().string(),refresh_token:bt().nullable(bt().string()),state:bt().string()}})]),bt().object({required:{sub:bt().string(),user_id:bt().string(),organization_id:bt().string(),preferred_username:bt().string(),name:bt().string(),email:bt().string()},optional:{nickname:bt().string(),email_verified:bt().boolean(),given_name:bt().string(),family_name:bt().string(),zoneinfo:bt().string(),photos:bt().object({optional:{},required:{picture:bt().string(),thumbnail:bt().string()}}),profile:bt().string(),picture:bt().string(),address:bt().object({optional:{country:bt().string()},required:{}}),urls:bt().record(bt().string(),bt().string()),active:bt().boolean(),user_type:bt().string(),language:bt().string(),locale:bt().string(),utcOffset:bt().number(),updated_at:bt().string()}});var _t=()=>o(583835);const Tt=(0,_t().Dv)("resyncExternalCollection");var kt=()=>o(769864),Mt=()=>o(357625),Pt=()=>o(377093);async function Bt(e){const{environment:t,objectName:o,objectLabel:n,collectionContextStore:i,intl:r}=e,l=Ge().A.state;if(!l.loaded)return it().Q.fail("Integration state not loaded");const a=null==i?void 0:i.collectionStore(),s=null==a?void 0:a.getSpaceId();if(!s)return it().Q.fail("Space ID not found");const c=null==a?void 0:a.getSpacePointer();Ze().log({level:"info",from:"salesforceConnectedRelationActions",type:"createSalesforceConnectedRelationProperty",data:{message:"Received request to create Salesforce connected relation property",miscDataToConvertToString:{objectName:o,objectLabel:n,spaceId:s,collectionPointer:c}}});const d=l.integrations.find((e=>e.id===vt().mn));if(!d)return it().Q.fail("Integration not found");const u=Ge().A.bots.state.find((e=>e.integration_id===vt().mn));if(!u)return it().Q.fail("Bot not found");const p=u.id;let g;if($e().default.checkGate({gateName:"salesforce_use_minimal_schema"}))g=function(e){const{objectName:t}=e;return{value:{name:t,regex:(0,Ct().fh)(t),attributes:Ct().eV.attributes,additional_types:{connectedRelation:!0},connected_relation_properties:Ct().eV.connected_relation_properties,connected_relation_sub_schemas:Ct().eV.connected_relation_sub_schemas}}}({objectName:o});else{var m;const e=await kt().callApi({eventName:"describeSalesforceObject",environment:t,data:{spaceId:s,objectName:o,botId:p}});if("success"!==(null==e?void 0:e.type))return Ze().log({level:"error",from:"salesforceConnectedRelationActions",type:"createSalesforceConnectedRelationProperty",data:{message:"Describe Salesforce object failed while creating Salesforce connected relation property",miscDataToConvertToString:{objectName:o,objectLabel:n,spaceId:s,collectionPointer:c,error:e.error}}}),(0,y().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{integrationId:vt().mn,actionType:"create_connected_relation_property",status:"failed",collectionId:null==a?void 0:a.id,flowId:He().A.getFlowId()}}}),it().Q.fail(e.error.name);if((null===(m=e.data)||void 0===m?void 0:m.responseStatus)===Le().qh.NOT_FOUND)return Ze().log({level:"info",from:"salesforceConnectedRelationActions",type:"createSalesforceConnectedRelationProperty",data:{message:"Describe Salesforce object failed while creating Salesforce connected relation property, admin service account does not have access to the object",miscDataToConvertToString:{objectName:o,objectLabel:n,spaceId:s,collectionPointer:c,error:Le().qh.NOT_FOUND}}}),(0,y().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{integrationId:vt().mn,actionType:"create_connected_relation_property",status:"failed",collectionId:null==a?void 0:a.id,details:{error:Le().qh.NOT_FOUND,objectName:o}}}}),it().Q.fail(Le().qh.NOT_FOUND);g=function(e){const{describeObjectResponse:t,objectName:o}=e;let n={},i={};return t.forEach((e=>{if("Name"!==e.name){if("created_by"!==e.type&&"last_edited_by"!==e.type&&"created_time"!==e.type&&"last_edited_time"!==e.type&&"rollup"!==e.type&&"formula"!==e.type)if("relation"===e.type){if(e.referenceTo){var t;const o=e.referenceTo,r=e.custom?e.label:e.relationshipName||e.label;n[e.name]={name:r,type:e.type,uri:`notion://user-defined-collection/salesforce:${o}`},"User"!==o&&"Group"!==o||(n[`mapped_${e.name}`]={name:`${r} (Notion User)`,type:"person",uri:"notion://user-defined-collection/salesforce:User",source_property_id:"Email"}),null!==(t=Ct().eV.connected_relation_sub_schemas)&&void 0!==t&&t[`notion://user-defined-collection/salesforce:${o}`]||(i[`notion://user-defined-collection/salesforce:${o}`]={title:{name:"Name",type:"title"}})}}else if("select"===e.type||"multi_select"===e.type){var o;n[e.name]={name:e.label,type:e.type,options:null===(o=e.picklistValues)||void 0===o?void 0:o.map((e=>({id:e.label,value:e.value})))}}else"person"===e.type?n[e.name]={name:e.label,type:e.type,uri:"notion://user-defined-collection/salesforce:User",source_property_id:"Email"}:n[e.name]={name:e.label,type:e.type}}else n.title={name:e.label,type:"title"}})),n={...Ct().eV.connected_relation_properties,...n},i={...Ct().eV.connected_relation_sub_schemas,...i},{value:{name:o,regex:(0,Ct().fh)(o),attributes:Ct().eV.attributes,additional_types:{connectedRelation:!0},connected_relation_properties:n,connected_relation_sub_schemas:i}}}({describeObjectResponse:e.data.properties,objectName:o})}if(it().Q.isFail(g))return Ze().log({level:"error",from:"salesforceConnectedRelationActions",type:"createSalesforceConnectedRelationProperty",data:{message:"Failed to get connected relation pattern while creating Salesforce connected relation property",miscDataToConvertToString:{objectName:o,objectLabel:n,spaceId:s,collectionPointer:c,error:g.error}}}),(0,y().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{integrationId:vt().mn,actionType:"create_connected_relation_property",status:"failed",collectionId:null==a?void 0:a.id,flowId:He().A.getFlowId()}}}),it().Q.fail(g.error);const S={name:`${d.id===vt().mn?vt().Aj:d.name} ${n}`,pattern:g.value,integration:d};return await Pt().XO({environment:t,connectedRelationProperty:S,collectionContextStore:i,intl:r,from:"new_property",propertyGroupId:void 0,propertyLimit:"no_limit",skipDatabaseActions:!0}),Ze().log({level:"info",from:"salesforceConnectedRelationActions",type:"createSalesforceConnectedRelationProperty",data:{message:"Successfully created Salesforce connected relation property",miscDataToConvertToString:{objectName:o,objectLabel:n,spaceId:s,collectionPointer:c}}}),(0,y().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{integrationId:vt().mn,actionType:"create_connected_relation_property",details:{objectName:o},status:"success",collectionId:null==a?void 0:a.id,flowId:He().A.getFlowId()}}}),it().Q.success(!0)}async function Vt(e){const{environment:t,collectionStore:o,propertiesToBeAdded:n,propertiesToBeDeleted:i,collectionViewId:r,integrationId:l,rootPropertyId:a,rootPropertySchema:s,skipResyncCollection:c}=e,d=(0,ae().Nv)(s);if(d&&l===vt().mn&&(n.length||i.length)){var u;const e=Ge().A.bots.state.find((e=>e.integration_id===l));if(!e)return;const s=new(xt().m)(t,d);await s.load();const p=null===(u=s.getFormat())||void 0===u?void 0:u.pattern_name;if(!p)return;const g={};for(const t of n)g[t.metadata.name]=t.metadata;const m=(0,Mt().UT)(t,Tt,{spaceId:o.getSpaceId(),botId:e.id,integrationId:l,key:null==p?void 0:p.toLowerCase(),metadata:g,externalCollectionId:s.id,skipMetadataUpdate:!1,skipResyncCollection:c,source:"add_properties",propertiesToBeAdded:n,propertiesToBeDeleted:i,collectionViewId:r,rootPropertyId:a},{spaceIds:[]});for await(const t of m)break}}var Ft=()=>o(254526),Dt=()=>o(534239),Et=()=>o(249046),Ot=()=>o(532940),Rt=()=>o(673099);const Kt=(0,v().YK)({genericErrorTitle:{defaultMessage:"Failed to load",id:"GenericErrorComponentForConnectedRelation.errorLoading"}});function Nt(e){const{collectionSettingsStore:t,title:o,children:n}=e;return(0,z.jsx)(C().A,{...e,title:o,handleClose:()=>{R().os({collectionSettingsStore:t})},menuScrollerStyle:{paddingBottom:6},footer:(0,z.jsxs)(x().A,{extraPadding:!0,topBorder:!0,children:[(0,z.jsx)(Rt().p,{}),(0,z.jsx)(Rt().b,{})]}),children:n})}function zt(){const e=(0,h().IS)((()=>({button:{marginTop:6,paddingTop:4,paddingBottom:4,paddingInlineStart:12,paddingInlineEnd:12,gap:4,borderRadius:6,borderWidth:1,border:"1px solid rgba(84, 72, 49, 0.15)",textAlign:"center"}})),[]);return(0,z.jsx)(Et().Ye,{justifyContent:"center",children:(0,z.jsx)(ct().Ay,{style:e.button,onClick:()=>{},children:(0,z.jsx)(P().D,{styleKey:"bodyRegular",children:(0,z.jsx)(v().sA,{defaultMessage:"Try again",id:"GenericErrorComponentForConnectedRelation.tryAgain"})})})})}function Lt(e){const{title:t,description:o,showTryAgain:n=!1}=e,i=(0,v().tz)(),r=(0,h().IS)((()=>({wrapper:{borderRadius:6,borderStyle:"solid",borderWidth:1,borderColor:O().Tj.border.secondary,paddingTop:16,paddingInlineEnd:12,paddingBottom:16,paddingInlineStart:12,gap:6,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},header:{fontWeight:We().Wy.medium,color:O().Tj.text.primary,fontSize:We().J.UIRegular.desktop,textAlign:"center"},description:{fontSize:We().J.UISmall.desktop,color:O().Tj.text.secondary,fontWeight:We().Wy.regular,textAlign:"center"},iconGroup:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gridColumnGap:10,height:36,width:36},icon:{height:29,width:30}})),[]);return(0,z.jsxs)("div",{style:r.wrapper,children:[(0,z.jsx)("div",{style:r.iconGroup,children:(0,z.jsx)(H().I,{icon:Ot().exclamationMarkTriangleIcon,colorVariant:"secondary",style:r.icon})}),(0,z.jsx)("div",{style:r.header,children:t||i.formatMessage(Kt.genericErrorTitle)}),(0,z.jsx)("div",{style:r.description,children:o}),n?(0,z.jsx)(zt,{}):void 0]})}var Ut=()=>o(988536);function Wt(e){const{from:t,bot:o,spaceStore:n,isAdminReAuth:i}=e,r=(0,h().IS)((()=>({authStatus:{paddingTop:0,paddingInlineEnd:16,paddingBottom:12,paddingInlineStart:16},headline:{marginInlineStart:12,fontSize:f().A.isMobile?We().J.UISmall.mobile:We().J.UISmall.desktop,color:O().Tj.text.secondary}})),[]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(x().A,{disableMobileBorders:!0,children:(0,z.jsx)("p",{style:r.headline,children:i?(0,z.jsx)(v().sA,{defaultMessage:"To add Salesforce objects or properties, please contact your admin to re-authenticate their account",id:"database.viewSettings.salesforceConnectedRelationAdminReAuth.description"}):(0,z.jsx)(v().sA,{defaultMessage:"To add Salesforce objects or properties, authenticate with your Salesforce account",id:"database.viewSettings.salesforceConnectedRelationReAuth.description"})})}),(0,z.jsx)(x().A,{disableMobileBorders:!0,style:r.authStatus,children:(0,z.jsx)(Ut().C,{captionText:i?(0,z.jsx)(v().sA,{defaultMessage:"Please contact your admin to re-authenticate Salesforce for this workspace",id:"database.viewSettings.salesforceConnectedRelationAdminReAuth.captionText"}):(0,z.jsx)(v().sA,{defaultMessage:"Link your Salesforce account to add Salesforce objects and properties to your database",id:"database.viewSettings.salesforceConnectedRelationReAuth.captionText"}),integrationIcon:(0,Ue().salesforceIcon)({width:48,height:48}),spaceStore:n,forceReauthForBot:o,from:t})})]})}const Ht=(0,v().YK)({inputPlaceholder:{defaultMessage:"Search property",id:"database.viewSettings.ConnectedRelationActionsAddProperties.inputPlaceholder"},addColumn:{defaultMessage:"Add properties",id:"database.viewSettings.ConnectedRelationActionsAddProperties.addColumn"},Next:{defaultMessage:"Next",id:"database.viewSettings.ConnectedRelationActionsAddProperties.Next"},addProperties:{defaultMessage:"Add properties",id:"ConnectedRelationActionsAddProperties.addProperties"},genericErrorDescription:{defaultMessage:"Unable to connect to Salesforce. Please try again.",id:"ConnectedRelationActionsAddProperties.genericErrorDescription"},noUserAPIAccessDescription:{defaultMessage:"Looks like you donâ€™t have API access. Please reach out to your Salesforce admin.",id:"ConnectedRelationActionsAddProperties.noUserAPIAccessDescription"},spaceBotNoAPIAccessDescription:{defaultMessage:"Looks like your Admin Service Account doesnâ€™t have API access. Please reach out to your Salesforce admin.",id:"ConnectedRelationActionsAddProperties.spaceBotNoAPIAccessDescription"},spaceBotNoFieldAccessTooltip:{defaultMessage:"This field canâ€™t be accessed with the Service Account. Please contact your Salesforce admin.",id:"ConnectedRelationActionsAddProperties.spaceBotNoFieldAccessTooltip"}}),$t=[64,51,73,95,45,67,45,91,52];function Gt(e){const{collectionSettingsStore:t,collectionContextStore:o,rootPropertySchema:i,rootPropertyId:r,integrationId:a,skipDatabaseActions:c,eventSource:d}=e,[u,p]=n.useState(""),[g,S]=n.useState([]),f=(0,s().K8)((()=>{var e;return null==o||null===(e=o.collectionStore())||void 0===e?void 0:e.getSpaceId()}),[o]),b=(0,s().K8)((()=>{const e=Ge().A.state;if(e.loaded)return(0,Ft().OB)(e,a)}),[a]),j=(0,s().K8)((()=>{var e;return null==o||null===(e=o.collectionStore())||void 0===e?void 0:e.getSpacePointer()}),[o]),w=(0,h().DP)(),I=(0,l().v3)(),_=(0,v().tz)(),T=(0,h().IS)((()=>({shimmerRow:{display:"flex",cursor:"pointer",alignItems:"center",gap:6,height:24,marginTop:4,marginInlineStart:16,borderRadius:4},leftShimmer:{height:14,width:14,borderRadius:6},rightShimmer:{height:14,borderRadius:6}})),[]),k=(0,s().O$)(ze().AppStoreSidebarSpaceStore),M=(0,s().K8)((()=>{if(i&&(0,ae().UU)(i))return i.collection_pointer}),[i]),P=(0,s().K8)((()=>{var e;const t=null==o||null===(e=o.collectionStore())||void 0===e?void 0:e.getSchema();return t&&Object.values(t).some((e=>e&&"url"===e.type))}),[o]),{format:B,loading:V}=(0,Dt().e8)(M,{debugName:"ConnectedRelationActionsAddProperties"}),F=null==B?void 0:B.pattern_name,[{status:E,value:O,error:K}]=(0,et().Yb)((async()=>{var e;if(!(f&&F&&b&&b.bot))return null;const t=F,n=await rt().Nf({environment:I,objectName:t,spaceId:f,bot:null==b?void 0:b.bot,connected_relation_properties:null==b||null===(e=b.integration.info.original_url_patterns)||void 0===e||null===(e=e.find((e=>e.name===F)))||void 0===e?void 0:e.connected_relation_properties});if(it().Q.isFail(n))throw new Error(n.error);const i=n.value,l=o.collectionStore();if(l&&i){const e=Qt({collectionStore:l,rootPropertyId:r}).map((e=>e.attributeName));return{properties:i.map((t=>({...t,isSelected:!!e.includes(t.id)}))),patternName:F}}}),[I,f,F,o,r,b]);(0,n.useEffect)((()=>{"resolved"===E&&O&&S(O.properties)}),[E,O]);const N=(0,s().K8)((()=>(0,Ft().Rg)({experimentStore:$e().default,integrationId:a})),[a]),L=(0,n.useMemo)((()=>g.filter((e=>e.isAlreadySynced||e.isSelected)).reduce(((e,t)=>{var o,n;return e+=1,"relation"!==t.type||"User"!==(null===(o=t.metadata)||void 0===o?void 0:o.referenceTo)&&"Group"!==(null===(n=t.metadata)||void 0===n?void 0:n.referenceTo)||(e+=1),e}),0)+1),[g]),U=g.length?(0,nt().Ay)(u,g,(e=>e.name)):[],W=(0,n.useCallback)(((e,t="toggle")=>{S((o=>o.map((o=>e.includes(o.id)?{...o,isSelected:"toggle"===t?!o.isSelected:"selectAll"===t}:o))))}),[]),H=(0,n.useCallback)((e=>({key:e.id,render:t=>(0,z.jsx)(Ye().m,{placement:"left",textWrap:!0,style:{maxWidth:240},disableTooltip:!e.isAdminNotAccessible,renderTooltip:e=>(0,z.jsx)("div",{...e,children:(0,z.jsx)(v().sA,{...Ht.spaceBotNoFieldAccessTooltip})}),render:o=>(0,z.jsx)("div",{...o,children:(0,z.jsx)($().A,{...t,focused:t.focused,disabled:e.isAdminNotAccessible,disabledFeedback:e.isAdminNotAccessible,onClick:()=>{e.isAdminNotAccessible||W([e.id])},title:(0,z.jsx)("div",{style:{textTransform:"capitalize"},children:e.name}),left:(0,z.jsx)("div",{children:(0,z.jsx)(qe().S,{size:14,checked:e.isSelected,onClick:()=>{e.isAdminNotAccessible||W([e.id])},style:{borderRadius:2}})}),icon:(0,z.jsx)(Je().zB,{type:e.type??"text",icon:void 0,size:D().Ev.sm,theme:w})})})}),action:()=>{}})),[W,w]),G=U.filter((e=>e.isAlreadySynced)).slice(0,50),Q=U.filter((e=>!e.metadata.custom)),q=U.filter((e=>e.metadata.custom)),Y=g.filter((e=>e.isSelected)).length,X=(0,s().K8)((()=>{const e=null==o?void 0:o.collectionStore();if(!e)return Y;const t=Qt({collectionStore:e,rootPropertyId:r}).map((e=>e.attributeName));return g.filter((e=>e.isSelected&&!t.includes(e.id))).length}),[g,o,r,Y]),J=(0,n.useCallback)((async e=>{if(e.stopPropagation(),!i||!(0,ae().UU)(i))return;const n=o.collectionStore(),l=o.collectionViewStore(),s=null==l?void 0:l.id;if(!n)return;const u=function(e){const{environment:t,collectionContextStore:o,allProperties:n,rootPropertyId:i,patternName:r,integrationId:l,eventSource:a,selectedPropertiesCount:s,selectedPlusSyncedPropertiesCount:c}=e,d=o.collectionStore();if(!d)return;const u=o.collectionViewStore(),p=o.getPropertyFormatKey();if(!p)return;const g=n.filter((e=>e.isSelected)),S=Qt({collectionStore:d,rootPropertyId:i}),f=S.map((e=>e.attributeName)),h=g.filter((e=>!f.includes(e.id))),x=S.filter((e=>!g.some((t=>t.id===e.attributeName))));!h.length&&!x.length||$e().default.checkGate({gateName:"salesforce_use_minimal_schema"})||A().createAndCommit({userAction:"CollectionSettingsConnectedRelationActionsAddProperties",environment:t,canUndo:!0,perform:e=>{if(h.length&&function(e){const{environment:t,collectionStore:o,transaction:n,propertiesToBeAdded:i,collectionViewArgs:r,rootPropertyId:l,integrationId:a}=e,s={},c=[],d=Ge().A.state;if(!d.loaded)return;const u=d.integrations.find((e=>e.id===a));if(u){for(const e of i){const t={name:e.name,type:"rollup",relation_property:l,target_property:` ${e.id}`,target_property_type:e.type,icon:u.info.icon},o=(0,lt().Ay)();s[o]=t,c.push(o)}if(r){const{format:e,formatKey:t,collectionViewStore:o}=r,i=[...e[t]||[],...c.map((e=>({property:e,visible:!0})))];m().zA({stores:[o],update:{[t]:i},transaction:n})}(0,at().F)({environment:t,collectionStore:o,update:s,transaction:n})}}({environment:t,collectionStore:d,transaction:e,propertiesToBeAdded:h,collectionViewArgs:u?{collectionViewStore:u,format:u.getFormat(),formatKey:p}:void 0,rootPropertyId:i,integrationId:l}),x.length){const o=d.getSchema();for(const n of x)(0,st().B)({environment:t,transaction:e,collectionStore:d,schema:o,property:n.id})}}});return Ze().log({level:"info",from:"ConnectedRelationActionsAddProperties",type:"updateCollectionSchema",data:{miscDataToConvertToString:{propertiesToBeAddedCount:h.length,propertiesToBeDeletedCount:x.length,collectionPointer:d.getSpacePointer(),rootPropertyId:i,totalProperties:n.length}}}),(0,y().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{integrationId:l,actionType:"added_properties_for_connected_relation",flowId:He().A.getFlowId(),details:{patternName:r,properties:h.map((e=>({fieldName:e.name,propertyType:e.type})))},source:a,collectionId:d.id,dbPropertiesCount:s,workspacePropertiesCount:c}}}),{propertiesToBeAdded:h,propertiesToBeDeleted:x}}({environment:I,collectionContextStore:o,patternName:F??void 0,allProperties:g,rootPropertyId:r,integrationId:a,eventSource:d,selectedPropertiesCount:Y,selectedPlusSyncedPropertiesCount:L});if(function(e){const{environment:t,collectionStore:o,patternName:n,integrationId:i,propertyCountLimits:r,selectedPropertiesCount:l,selectedPlusSyncedPropertiesCount:a}=e;l+1>=r.singleDatabaseLimit&&(0,y().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{integrationId:i,actionType:"add_properties_single_database_limit_reached",flowId:He().A.getFlowId(),details:{limit:r.singleDatabaseLimit,patternName:n},collectionId:o.id}}});a+1>=r.workspaceLimit&&(0,y().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{integrationId:i,actionType:"add_properties_workspace_limit_reached",flowId:He().A.getFlowId(),details:{limit:r.workspaceLimit,patternName:n},collectionId:o.id}}})}({environment:I,collectionStore:n,patternName:F??void 0,integrationId:a,propertyCountLimits:N,selectedPropertiesCount:Y,selectedPlusSyncedPropertiesCount:L}),c)u&&(u.propertiesToBeAdded.length||u.propertiesToBeDeleted.length)&&await Vt({environment:I,collectionStore:n,propertiesToBeAdded:u.propertiesToBeAdded,propertiesToBeDeleted:u.propertiesToBeDeleted,rootPropertyId:r,collectionViewId:s,integrationId:a,skipResyncCollection:!0,rootPropertySchema:i}),R().a2({collectionSettingsStore:t,item:{type:"connectedRelationDatabaseActions",source:"connectedRelationCopyUrl",rootPropertyId:r,integrationId:a,rootPropertySchema:i}}),(0,y().u)({environment:I,event:{eventName:"salesforce_actions",eventProperties:{actionType:"navigate_to_copy_url",collectionId:null==n?void 0:n.id,integrationId:a,flowId:He().A.getFlowId(),details:{source:"first_time_setup",isCopyUrlDisabled:!P}}}});else if(R().os({collectionSettingsStore:t}),u&&(u.propertiesToBeAdded.length||u.propertiesToBeDeleted.length)){const e=Qt({collectionStore:n,rootPropertyId:r}),t=[r,...e.map((e=>e.id))],o=Object.fromEntries(t.map((e=>[e,"Loading"])));ht.addCollectionProperties(n.id,o);try{await Vt({environment:I,collectionStore:n,propertiesToBeAdded:u.propertiesToBeAdded,propertiesToBeDeleted:u.propertiesToBeDeleted,collectionViewId:s,rootPropertyId:r,integrationId:a,rootPropertySchema:i,skipResyncCollection:!1})}catch(p){Ze().log({level:"error",from:"ConnectedRelationActionsAddProperties",type:"updateConnectedRelationFieldSelectionFailed",data:{miscDataToConvertToString:{error:p,rootPropertyId:r,integrationId:a,collectionPointer:j,syncProperties:t}}})}finally{ht.removeCollectionProperties(n.id,new Set(t))}}}),[g,o,j,t,I,a,F,r,i,c,L,N,Y,d,P]);if(!k)return null;const Z=Xt(K,Le().oA.USER),ee=Xt(K,Le().oA.ADMIN);if(Z||ee){const t=Z&&ee||Z?null==b?void 0:b.bot:null==b?void 0:b.spaceBot;return(0,z.jsx)(Nt,{...e,title:_.formatMessage(Ht.addProperties),children:(0,z.jsx)(Wt,{spaceStore:k,from:"collection_settings_property_type",bot:t,isAdminReAuth:ee})})}return Yt(K,Le().oA.USER)||Yt(K,Le().oA.ADMIN)?(0,z.jsx)(Nt,{...e,title:_.formatMessage(Ht.addProperties),children:(0,z.jsx)(x().A,{extraPadding:!0,disableMobileBorders:!0,children:(0,z.jsx)("div",{style:{padding:"0px 4px"},children:(0,z.jsx)(Lt,{description:Yt(K,Le().oA.USER)?_.formatMessage(Ht.noUserAPIAccessDescription):_.formatMessage(Ht.spaceBotNoAPIAccessDescription),showTryAgain:!1})})})}):K?(0,z.jsx)(Nt,{...e,title:_.formatMessage(Ht.addProperties),children:(0,z.jsx)(x().A,{extraPadding:!0,disableMobileBorders:!0,children:(0,z.jsx)("div",{style:{padding:"0px 4px"},children:(0,z.jsx)(Lt,{description:_.formatMessage(Ht.genericErrorDescription)})})})}):(0,z.jsx)(C().A,{...e,title:_.formatMessage(Ht.addProperties),header:(0,z.jsx)(qt,{inputValue:u,integrationName:"Salesforce",onChange:p}),footer:"resolved"===E&&O&&(0,z.jsx)(Jt,{colorPalette:"blue",selectedPropertiesCount:Y,totalPropertiesCount:L,newPropertiesCount:X,patternName:F,propertyCountLimits:N,onClick:J,iconTrailing:c?tt().arrowStraightRightIcon:void 0,children:c?(0,z.jsx)(v().sA,{...Ht.Next}):(0,z.jsx)(v().sA,{...Ht.addColumn})}),handleClose:()=>{R().os({collectionSettingsStore:t})},menuScrollerStyle:{paddingBottom:6,flexGrow:1},fullHeight:e.fullHeight,children:(0,z.jsxs)("div",{style:{height:"100%",flexGrow:1},children:[V||"pending"===E?(0,z.jsx)("div",{children:(0,z.jsx)("div",{children:$t.map(((e,t)=>(0,z.jsxs)("div",{style:{...T.shimmerRow},children:[(0,z.jsx)(Qe().P,{style:{...T.leftShimmer}}),(0,z.jsx)(Qe().P,{style:{...T.rightShimmer,width:e}})]},t)))})}):void 0,"resolved"===E?(0,z.jsxs)(z.Fragment,{children:[G.length>5?(0,z.jsx)(pt,{title:(0,z.jsx)(v().sA,{defaultMessage:"Suggested properties",id:"database.viewSettings.ConnectedRelationActionsAddProperties.suggestedPropertiesTitle"}),disableSelectAll:!1,isSelectAll:G.every((e=>e.isSelected)),handleSelect:()=>{G.every((e=>e.isSelected))?W(G.map((e=>e.id)),"deselectAll"):W(G.map((e=>e.id)),"selectAll")},items:G.map(H)},"Suggested Properties"):void 0,(0,z.jsx)(pt,{title:(0,z.jsx)(v().sA,{defaultMessage:"{propertyCount, plural, one {{propertyCount} standard property} other {{propertyCount} standard properties}}",id:"database.viewSettings.ConnectedRelationActionsAddProperties.standardPropertiesTitle",values:{propertyCount:Q.length}}),disableSelectAll:!0,items:Q.map(H)},"Standard Properties"),(0,z.jsx)(pt,{title:(0,z.jsx)(v().sA,{defaultMessage:"{propertyCount, plural, one {{propertyCount} custom property} other {{propertyCount} custom properties}}",id:"database.viewSettings.ConnectedRelationActionsAddProperties.OptionalPropertiesTitle",values:{propertyCount:q.length}}),disableSelectAll:!0,items:q.map(H)},"Custom Properties")]}):void 0]})})}function Qt(e){const{collectionStore:t,rootPropertyId:o}=e,n=t.getSchema(),i=[];for(const c in n){var r;if("rollup"===(null===(r=n[c])||void 0===r?void 0:r.type)){var l,a;if((null===(l=n[c])||void 0===l?void 0:l.relation_property)===o)i.push({id:c,attributeName:null===(a=n[c])||void 0===a||null===(a=a.target_property)||void 0===a?void 0:a.trim()})}else{var s;const e=null===(s=n[c])||void 0===s?void 0:s.derived_property_record_metadata;(null==e?void 0:e.pointer_property_uri)===o&&i.push({id:c,attributeName:null==e?void 0:e.external_object_attribute})}}return i}function qt(e){const t=(0,v().tz)();return(0,z.jsxs)(x().A,{children:[(0,z.jsx)(Xe().A,{isSecondaryColor:!0,isMultiline:!0,style:{marginInlineStart:12,marginBottom:12,fontSize:f().A.isMobile?We().J.UISmall.mobile:We().J.UISmall.desktop},children:(0,z.jsx)(v().sA,{defaultMessage:"Add {integrationName} properties as a column directly to this database",id:"database.viewSettings.ConnectedRelationActionsAddProperties.description",values:{integrationName:e.integrationName}})}),(0,z.jsx)(mt().Ay,{focusInitial:!0,value:e.inputValue,onChange:t=>{e.onChange(t.target.value)},placeholder:t.formatMessage(Ht.inputPlaceholder)})]})}function Yt(e,t){return(null==e?void 0:e.message)===`${Le().qh.NO_USER_API_ACCESS}:${t}`}function Xt(e,t){return(null==e?void 0:e.message)===`${Le().qh.REAUTHENTICATION_REQUIRED}:${t}`}function Jt({totalPropertiesCount:e,newPropertiesCount:t,selectedPropertiesCount:o,patternName:n,propertyCountLimits:i,children:r,...l}){const a=(0,h().IS)((()=>({buttonWrapper:{borderColor:"none",borderTop:"1px solid rgba(227, 226, 224, 0.5)",background:O().Tj.background.primary,borderTopWidth:1,paddingTop:12,paddingInlineEnd:14,paddingBottom:12,paddingInlineStart:14,gap:8,boxShadow:"inset 0px 1px 0px -1px rgba(15, 15, 15, 0.05)"},button:{width:"100%",border:"none",height:32,fontWeight:We().Wy.medium,paddingInlineEnd:12,paddingInlineStart:12,gap:4},limitExceededErrorMessage:{marginTop:4,fontSize:We().J.UISmall.desktop,color:O().Tj.yellow.text.secondary,textAlign:"center",fontWeight:We().Wy.regular},selectedPropertiesCountMessage:{fontSize:We().J.UIRegular.desktop,color:O().Tj.text.secondary,textAlign:"center",fontWeight:We().Wy.regular,marginBottom:8},selectedPropertiesCountWarning:{display:"inline-flex",alignItems:"start",gap:4,fontSize:We().J.UISmall.desktop,color:O().Tj.text.secondary,textAlign:"start",fontWeight:We().Wy.regular,backgroundColor:O().Tj.background.secondary,borderRadius:6,padding:8,marginBottom:4},infoIconStyle:{color:O().Tj.text.secondary,marginTop:2}})),[]),s=e>=i.workspaceLimit,c=o>=i.singleDatabaseLimit;return(0,z.jsxs)("div",{style:a.buttonWrapper,children:[t>0&&!s&&!c?(0,z.jsx)("div",{style:a.selectedPropertiesCountMessage,children:(0,z.jsx)("div",{children:(0,z.jsx)(v().sA,{defaultMessage:"{newPropertiesCount, plural, one {{newPropertiesCount} new property will be added} other {{newPropertiesCount} new properties will be added}}",id:"ConnectedRelationActionsAddProperties.newPropertiesCountMessage",values:{newPropertiesCount:t}})})}):void 0,!s&&!c&&o>i.warningThreshold?(0,z.jsxs)("div",{style:a.selectedPropertiesCountWarning,children:[(0,z.jsx)(H().I,{icon:ot().infoCircleFillSmallIcon,size:14,style:a.infoIconStyle}),(0,z.jsx)(v().sA,{defaultMessage:"Choose fewer than {limit} properties for the best performance",id:"ConnectedRelationActionsAddProperties.tooManyPropertiesWarning",values:{limit:i.warningThreshold}})]}):void 0,(0,z.jsx)(M().A,{style:a.button,disabled:s||c,...l,children:r}),c&&n?(0,z.jsx)("div",{style:a.limitExceededErrorMessage,children:(0,z.jsx)("div",{children:(0,z.jsx)(v().sA,{defaultMessage:"This database has reached the <bold>maximum of {limit}</bold> synced properties",id:"ConnectedRelationActionsAddProperties.salesforceDbMaxPropertiesReached",values:{limit:i.singleDatabaseLimit,bold:e=>(0,z.jsx)("strong",{children:e})}})})}):void 0,s&&n?(0,z.jsx)("div",{style:a.limitExceededErrorMessage,children:(0,z.jsx)("div",{children:(0,z.jsx)(v().sA,{defaultMessage:"Your workspace has reached the <bold>maximum of {limit}</bold> synced properties for {object}",id:"ConnectedRelationActionsAddProperties.workspaceMaxPropertiesReached",values:{limit:Le().rM,bold:e=>(0,z.jsx)("strong",{children:e}),object:n}})})}):void 0]})}var Zt=()=>o(148307),eo=()=>o(123423);const to=(0,_t().Dv)("bulkCreateConnectedProperty");var oo=()=>o(828973);const no=(0,v().YK)({copyColumn:{defaultMessage:"Populate property",id:"ConnectedRelationActionsCopyUrl.populateProperty"},skipStep:{defaultMessage:"Skip step",id:"ConnectedRelationActionsCopyUrl.skipStep"}});function io(e){const{collectionSettingsStore:t,collectionContextStore:o,integrationId:i}=e,[r,a]=(0,n.useState)(null),c=(0,l().v3)(),d=(0,v().tz)(),{urlProperties:u,allProperties:p}=(0,s().K8)((()=>{var e;const t=null==o||null===(e=o.collectionStore())||void 0===e?void 0:e.getSchema();if(!t)return{urlProperties:[],allProperties:[],propertyName:void 0};const n=[];for(const[o,r]of Object.entries(t)){r&&"url"===r.type&&n.push({id:o,...r})}const i=Object.entries(t).filter((([,e])=>"text"===(null==e?void 0:e.type)||"title"===(null==e?void 0:e.type))).map((([e,t])=>({id:e,...t})));return{urlProperties:n,allProperties:[...n,...i]}}),[o]);(0,n.useEffect)((()=>{var e;a((null===(e=u[0])||void 0===e?void 0:e.id)||null)}),[u]);const g=(0,h().IS)((()=>({buttonWrapper:{borderColor:"none",borderTop:"1px solid rgba(227, 226, 224, 0.5)",background:O().Tj.background.primary,borderTopWidth:1,paddingTop:12,paddingInlineEnd:16,paddingBottom:12,paddingInlineStart:16,gap:8,boxShadow:"0px 0px 0px 1px #0F0F0F0D, 0px 3px 6px 0px #0F0F0F1A, 0px 9px 24px 0px #0F0F0F33",display:"flex",flexDirection:"column"},button:{width:"100%",height:32,border:"none",fontWeight:We().Wy.medium,paddingInlineStart:12,gap:4,paddingInlineEnd:12},skipStepButton:{width:"100%",height:32,fontWeight:We().Wy.medium,backgroundColor:"transparent",borderColor:O().Tj.lightGrayButtonBackground,borderWidth:1,borderStyle:"solid",color:O().Tj.text.secondary,background:"transparent",border:"1px solid rgba(84, 72, 49, 0.15)",gap:6},skipStepButtonHovered:{background:O().Tj.lightGrayButtonBackground}})),[]);return(0,z.jsxs)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Populate property",id:"ConnectedRelationActionsCopyUrl.titleForCopyUrlTab"}),header:(0,z.jsx)(lo,{}),handleClose:()=>{R().os({collectionSettingsStore:t})},menuScrollerStyle:{paddingBottom:6,flexGrow:1},fullHeight:e.fullHeight,footer:(0,z.jsxs)("div",{style:g.buttonWrapper,children:[(0,z.jsx)(M().A,{colorPalette:"blue",style:g.button,disabled:null===r,iconTrailing:{icon:eo().arrowStraightRightFillIcon,size:"sm"},onClick:async n=>{n.stopPropagation(),R().os({collectionSettingsStore:t});const l=o.collectionStore();if(!l)return;(0,y().u)({environment:c,event:{eventName:"salesforce_actions",eventProperties:{actionType:"copy_url_clicked",collectionId:null==l?void 0:l.id,integrationId:i,flowId:He().A.getFlowId()}}});const a=Ge().A.bots.state.find((e=>e.integration_id===i));if(!a)return;const s=a.id,d=(0,Ft().K6)({collectionStore:l,rootPropertyId:e.property}),u=[e.property,...d.map((e=>e.id))],p=Object.fromEntries(u.map((e=>[e,"Loading"])));ht.addCollectionProperties(l.id,p);try{const t=r&&l?(0,Mt().UT)(c,to,{spaceId:l.getSpaceId(),botId:s,collectionId:l.id,integrationId:e.integrationId,sourceColumnId:r,destinationColumnId:e.property},{spaceIds:[]}):null;if(t)for await(const o of t)"in_progress"!==o.taskStatus&&"success"!==o.taskStatus&&("failure"!==o.taskStatus&&"dead"!==o.taskStatus&&"timeout_before_execution"!==o.taskStatus&&"retryable_failure"!==o.taskStatus||o.error&&Ze().log({level:"error",from:"ConnectedRelationActionsCopyUrl",type:"bulkCreateConnectedPropertyFailed",data:{miscDataToConvertToString:{error:o.error,spaceId:l.getSpaceId(),botId:s,collectionId:l.id,integrationId:e.integrationId,sourceColumnId:r,destinationColumnId:e.property,taskStatus:o.taskStatus}}}))}catch(g){Ze().log({level:"error",from:"ConnectedRelationActionsCopyUrl",type:"bulkCreateConnectedPropertyFailed",data:{miscDataToConvertToString:{error:g,spaceId:l.getSpaceId(),botId:s,collectionId:l.id,integrationId:e.integrationId,sourceColumnId:r,destinationColumnId:e.property,syncProperties:u}}})}finally{ht.removeCollectionProperties(l.id,new Set(u))}},children:d.formatMessage(no.copyColumn)}),(0,z.jsx)(M().A,{style:g.skipStepButton,hoveredStyle:{...g.skipStepButton,...g.skipStepButtonHovered},onClick:e=>{e.stopPropagation(),R().os({collectionSettingsStore:t})},children:d.formatMessage(no.skipStep)})]}),children:[(0,z.jsx)(x().A,{extraPadding:!0,children:(0,z.jsx)(oo().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Copy from",id:"ConnectedRelationActionsCopyUrl.copyFromProperty"}),selectedKey:r??"__placeholder__",popupStyle:{minWidth:190},options:[{key:"__placeholder__",type:"button",title:(0,z.jsx)(v().sA,{defaultMessage:"Select property",id:"ConnectedRelationActionsCopyUrl.selectPropertyPlaceholder"}),hideOption:!0},...p.map((e=>({key:e.id,type:"button",title:e.name})))],onChange:a})}),(0,z.jsx)(ro,{})]})}function ro(){const e=(0,h().IS)((()=>({previewContentContainer:{display:"flex",alignSelf:"center",flexDirection:"column",width:"100%",cursor:"default",paddingInlineStart:8,paddingInlineEnd:8},previewContentImage:{display:"flex",alignSelf:"center",flexDirection:"column",width:"100%",cursor:"default"}})),[]);return(0,z.jsx)(x().A,{extraPadding:!0,disableMobileBorders:!0,children:(0,z.jsx)("div",{style:e.previewContentContainer,children:(0,z.jsx)("img",{src:Zt().A.images.externalIntegrations.salesforceCopyUrlPng,style:e.previewContentImage,alt:"Salesforce Copy URL"})})})}function lo(){return(0,z.jsx)(x().A,{extraPadding:!0,children:(0,z.jsx)(Xe().A,{isSecondaryColor:!0,isMultiline:!0,style:{paddingInlineStart:8,paddingInlineEnd:8,fontSize:f().A.isMobile?We().J.UISmall.mobile:We().J.UISmall.desktop},children:(0,z.jsx)(v().sA,{defaultMessage:"Use an existing URL or text column to auto-convert values into the Salesforce property",id:"database.viewSettings.ConnectedRelationActionsCopyUrl.description.selectUrl"})})})}var ao=()=>o(383036),so=()=>o(497222);const co=(0,v().YK)({inputPlaceholder:{defaultMessage:"Search object",id:"database.viewSettings.ConnectedRelationActionsObjectSelection.inputPlaceholder"},filterSalesforceObjects:{defaultMessage:"Salesforce",id:"ConnectedRelationActionsObjectSelection.filterObjects"},genericErrorDescription:{defaultMessage:"Unable to connect to Salesforce. Please try again.",id:"ConnectedRelationActionsObjectSelection.genericErrorDescription"},noUserAPIAccessDescription:{defaultMessage:"Looks like you donâ€™t have API access. Please reach out to your Salesforce admin.",id:"ConnectedRelationActionsObjectSelection.noUserAPIAccessDescription"},spaceBotNoUserAPIAccessDescription:{defaultMessage:"Looks like your Salesforce admin doesnâ€™t have API access. Please reach out to your Salesforce admin.",id:"ConnectedRelationActionsObjectSelection.spaceBotNoUserAPIAccessDescription"}});function uo(e){const{collectionSettingsStore:t,collectionContextStore:o}=e,[i,r]=n.useState(""),a=(0,l().v3)(),c=(0,v().tz)(),d=(0,h().DP)(),u=(0,s().K8)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getSpaceId()}),[o]),p=(0,s().K8)((()=>{const e=Ge().A.state;if(!e.loaded)return;const t=e.integrations.find((e=>e.id===vt().mn));return t?t.info.icon:void 0}),[]),g=(0,s().K8)((()=>{const e=Ge().A.state;if(e.loaded)return(0,Ft().OB)(e,vt().mn)}),[]),m=null==g?void 0:g.bot,S=null==g?void 0:g.spaceBot,f=(0,h().IS)((()=>({shimmerRow:{display:"flex",cursor:"pointer",alignItems:"center",gap:6,height:24,marginTop:4,marginInlineStart:16,borderRadius:4},leftShimmer:{height:14,width:14,borderRadius:6},rightShimmer:{height:14,borderRadius:6}})),[]),[{status:b,value:j,error:w}]=(0,et().Yb)((async()=>{if(!u||!m)throw new Error("Not loaded");const e=await async function(e){const{environment:t,spaceId:o,botId:n}=e,i=await kt().callApi({eventName:"listSalesforceObjects",environment:t,data:{spaceId:o,botId:n}});return i&&"success"===(null==i?void 0:i.type)?{value:null==i?void 0:i.data}:{error:null==i?void 0:i.error}}({environment:a,spaceId:u,botId:m.id});if(it().Q.isFail(e))throw e.error;const t=e.value;if(t.responseStatus===Le().qh.REAUTHENTICATION_REQUIRED||t.responseStatus===Le().qh.NO_USER_API_ACCESS)throw new Error(`${t.responseStatus}:${t.userType}`);if(t.sObjects.length>0)return t.sObjects.map((e=>({name:e.name,label:e.label,isAdminNotAccessible:Boolean(e.isAdminNotAccessible)})))}),[u,a,m]),[{status:A,value:I}]=(0,et().Yb)((async()=>{var e;const t=null===(e=o.collectionStore())||void 0===e?void 0:e.getSchema(),n=new Map;if(t)for(const[o,l]of Object.entries(t)){var i;if(l&&(0,ae().UU)(l)&&(null===(i=l.connectedRelation)||void 0===i?void 0:i.integration_id)===vt().mn){var r;const e=(0,ae().Nv)(l);if(!e)continue;const t=new(xt().m)(a,e);await t.load();const i=null==t||null===(r=t.getFormat())||void 0===r?void 0:r.pattern_name;i&&n.set(i,{property:l,id:o})}}return n}),[a,o]),_=(0,s().O$)(ze().AppStoreSidebarSpaceStore);if(!_)return null;const T=Xt(w,Le().oA.USER),k=Xt(w,Le().oA.ADMIN);if(T||k)return(0,z.jsx)(Nt,{...e,title:c.formatMessage(co.filterSalesforceObjects),children:(0,z.jsx)(Wt,{spaceStore:_,from:"collection_settings_property_type",bot:T?m:S,isAdminReAuth:k})});const M=Yt(w,Le().oA.USER),P=Yt(w,Le().oA.ADMIN);return M||P?(0,z.jsx)(Nt,{...e,title:c.formatMessage(co.filterSalesforceObjects),children:(0,z.jsx)(x().A,{extraPadding:!0,disableMobileBorders:!0,children:(0,z.jsx)("div",{style:{padding:"0px 4px"},children:(0,z.jsx)(Lt,{description:M?c.formatMessage(co.noUserAPIAccessDescription):c.formatMessage(co.spaceBotNoUserAPIAccessDescription),showTryAgain:!1})})})}):"rejected"===b||"rejected"===A?(0,z.jsx)(Nt,{...e,title:c.formatMessage(co.filterSalesforceObjects),children:(0,z.jsx)(x().A,{extraPadding:!0,disableMobileBorders:!0,children:(0,z.jsx)("div",{style:{padding:"0px 4px"},children:(0,z.jsx)(Lt,{description:c.formatMessage(co.genericErrorDescription)})})})}):(0,z.jsxs)(C().A,{...e,title:c.formatMessage(co.filterSalesforceObjects),header:(0,z.jsx)(po,{inputValue:i,integrationName:"Salesforce",onChange:r}),handleClose:()=>{R().os({collectionSettingsStore:t})},menuScrollerStyle:{paddingBottom:6},children:["pending"===b||"pending"===A||"Not loaded"===(null==w?void 0:w.message)?[64,51,73,95,45,67,45,91,52].map(((e,t)=>(0,z.jsxs)("div",{style:{...f.shimmerRow},children:[(0,z.jsx)(Qe().P,{style:{...f.leftShimmer}}),(0,z.jsx)(Qe().P,{style:{...f.rightShimmer,width:e}})]},t))):void 0,"resolved"===b&&"resolved"===A&&j?(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:0,sections:[{key:"objects",render:e=>(0,z.jsx)(x().A,{...e,title:"Salesforce objects"}),items:j.filter((e=>e.label.toLowerCase().includes(i.toLowerCase()))).sort(((e,t)=>I.has(e.name)&&!I.has(t.name)?-1:!I.has(e.name)&&I.has(t.name)?1:0)).map((e=>({key:e.name,render:t=>(0,z.jsx)(Ye().m,{placement:"left",textWrap:!0,style:{maxWidth:240},disableTooltip:!(I.has(e.name)||e.isAdminNotAccessible),renderTooltip:()=>I.has(e.name)?(0,z.jsx)(v().sA,{defaultMessage:"This object is already connected to a property in this collection.",id:"ConnectedRelationActionsObjectSelection.alreadyConnected"}):(0,z.jsx)(v().sA,{defaultMessage:"This object canâ€™t be accessed with the Service Account. Please contact your Salesforce admin.",id:"ConnectedRelationActionsObjectSelection.notConnected"}),render:o=>(0,z.jsx)(so().A,{...(0,ao().A)(t,o),showChevron:!0,title:e.label,disabled:e.isAdminNotAccessible,icon:()=>(0,z.jsx)(Je().zB,{type:"text",icon:p,size:D().Ev.sm,theme:d})})}),action:async()=>{if(I.has(e.name)){var t;const n=o.collectionStore(),i=null==n?void 0:n.getSchema(),r=I.get(e.name),l=null==r||null===(t=r.property)||void 0===t||null===(t=t.connectedRelation)||void 0===t?void 0:t.integration_id,s=null==r?void 0:r.id;if(!s)return;const c=null==i?void 0:i[s];R().a2({collectionSettingsStore:o.settingsStore,item:{type:"connectedRelationDatabaseActions",source:"connectedRelationAddProperties",rootPropertyId:s,integrationId:vt().mn,rootPropertySchema:c,skipDatabaseActions:!1,eventSource:"existing_object_selection_click"}}),(0,y().u)({environment:a,event:{eventName:"salesforce_actions",eventProperties:{actionType:"add_properties_clicked",details:{source:"existing_object_selection_click"},integrationId:l,flowId:He().A.getFlowId(),collectionId:null==n?void 0:n.id}}})}else{const t=await Bt({environment:a,objectName:e.name,objectLabel:e.label,collectionContextStore:o,intl:c});it().Q.isFail(t)&&R().a2({collectionSettingsStore:o.settingsStore,item:{type:"connectedRelationDatabaseActions",source:"connectedRelationActionsFailure",integrationId:vt().mn,error:t.error}})}}})))}]}):void 0]})}function po(e){const t=(0,v().tz)();return(0,z.jsx)(x().A,{children:(0,z.jsx)(mt().Ay,{focusInitial:!0,value:e.inputValue,onChange:t=>{e.onChange(t.target.value)},placeholder:t.formatMessage(co.inputPlaceholder)})})}function go(e){const{collectionSettingsStore:t,collectionContextStore:o,tabSettings:{source:n,rootPropertyId:i,rootPropertySchema:r,integrationId:a,skipDatabaseActions:c,error:d,eventSource:u}}=e,p=(0,s().O$)(ze().AppStoreSidebarSpaceStore),g=(0,Ut().j)({spaceStore:p}),m=(0,s().K8)((()=>null==o?void 0:o.collectionStore()),[o]),S=(0,l().v3)();if("connected"!==g.status)return p&&m?(0,z.jsx)(So,{collectionSettingsStore:t,integrationId:a,spaceStore:p,collectionStore:m,environment:S}):null;if("connectedRelationAddProperties"===n&&i&&r)return(0,z.jsx)(Gt,{...e,rootPropertyId:i,integrationId:a,rootPropertySchema:r,skipDatabaseActions:c,eventSource:u});if("ConnectedRelationObjectSelection"===n)return(0,z.jsx)(uo,{...e,integrationId:a});if("connectedRelationCopyUrl"===n&&i)return(0,z.jsx)(io,{...e,integrationId:a,property:i});if("connectedRelationActionsFailure"===n){const t=function(e){return e===Le().qh.NOT_FOUND}(d)?(0,z.jsx)(v().sA,{...mo.NoSpaceBotAccess}):(0,z.jsx)(v().sA,{...mo.CreateConnectedRelationPropertyFailure});return(0,z.jsx)(Nt,{...e,title:(0,z.jsx)(v().sA,{...mo.Salesforce}),children:(0,z.jsx)(x().A,{disableMobileBorders:!0,children:(0,z.jsx)(Lt,{description:t,showTryAgain:!1,title:(0,z.jsx)(v().sA,{...mo.somethingWentWrong})})})})}return null}const mo=(0,v().YK)({Salesforce:{defaultMessage:"Salesforce",id:"ConnectedRelationActionsFailure.salesforce"},NoSpaceBotAccess:{defaultMessage:"The selected object isnâ€™t accessible with the Admin service account. Please contact your Salesforce admin to request access.",id:"ConnectedRelationActionsFailure.NoSpaceBotAccess"},CreateConnectedRelationPropertyFailure:{defaultMessage:"Unable to create Salesforce connected relation.",id:"ConnectedRelationActionsFailure.CreateConnectedRelationPropertyFailure"},somethingWentWrong:{defaultMessage:"Something went wrong",id:"ConnectedRelationActionsFailure.somethingWentWrong"}});function So(e){const{spaceStore:t,collectionSettingsStore:o}=e,n=(0,s().K8)((()=>He().A.getFlowId()),[]),i=(0,h().IS)((()=>({headline:{fontSize:f().A.isMobile?We().J.UISmall.mobile:We().J.UISmall.desktop,color:O().Tj.text.secondary}})),[]);return(0,z.jsx)(C().A,{...e,collectionSettingsStore:o,title:(0,z.jsx)(v().sA,{defaultMessage:"Salesforce Authentication",id:"database.viewSettings.salesforceAuth.title"}),handleClose:()=>{R().os({collectionSettingsStore:o})},menuScrollerStyle:{paddingBottom:6},footer:(0,z.jsxs)(x().A,{topBorder:!0,children:[(0,z.jsx)(Rt().b,{}),(0,z.jsx)(Rt().p,{})]}),children:(0,z.jsxs)("div",{style:{padding:"0px 12px"},children:[(0,z.jsx)(x().A,{disableMobileBorders:!0,children:(0,z.jsx)("div",{style:i.headline,children:(0,z.jsx)(v().sA,{defaultMessage:"To add Salesforce objects or properties, authenticate with your Salesforce account",id:"database.viewSettings.salesforceAuth.description"})})}),(0,z.jsx)(ne().A,{size:4,isHidden:!0}),(0,z.jsx)(x().A,{disableMobileBorders:!0,children:(0,z.jsx)(Ut().C,{captionText:(0,z.jsx)(v().sA,{defaultMessage:"Link your Salesforce account to add Salesforce objects and properties to your database",id:"database.viewSettings.salesforceAuth.captionText"}),integrationIcon:(0,Ue().salesforceIcon)({width:48,height:48}),spaceStore:t,flowId:n,from:"collection_settings_property_type"})})]})})}var yo=()=>o(128933),fo=()=>o(30537),ho=()=>o(324254),xo=()=>o(94701),vo=()=>o(282883),bo=()=>o(527438),Co=()=>o(267584),jo=()=>o(666803);function wo(e){return[30,90,180,270,365,vo().$O].includes(e)}function Ao(e){const{collectionSettingsStore:t,collectionContextStore:o,action:i,selectedProjectKeys:r,selectedProperties:a}=e,c=(0,l().v3)(),d=(0,s().K8)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getFormat()}),[o]),{isSetupComplete:u,botId:p,spaceId:g,collectionStore:m,syncWindow:S}=(0,s().K8)((()=>{var e,t;const n=o.collectionStore(),i=(null==n||null===(e=n.getFormat())||void 0===e||null===(e=e.sync_state)||void 0===e||null===(e=e.filter_config)||void 0===e?void 0:e.sync_window)??365;return{isSetupComplete:Boolean(null==n||null===(t=n.getFormat())||void 0===t||null===(t=t.sync_state)||void 0===t?void 0:t.last_synced_at),botId:null==n?void 0:n.getFormat().bot_id,spaceId:null==n?void 0:n.getSpaceId(),collectionStore:n,syncWindow:wo(i)?i:365}}),[o]),[b,j]=(0,n.useState)(S),w=(0,U().X)("jira_sync_any_time_filter"),A=(0,n.useMemo)((()=>{var e;return b!==S||!(null!=d&&null!==(e=d.sync_state)&&void 0!==e&&null!==(e=e.filter_config)&&void 0!==e&&e.sync_window)}),[b,S,d]),I=!u,k=(0,s().K8)((()=>{var e;const t=null==m?void 0:m.getFormat(),n=null==m?void 0:m.getSchema(),i=o.collectionViewBlockStore();return"notion://projects_collection"===(null==t?void 0:t.app_config_uri)?null===(e=(0,bo().k7)(i,null==n?void 0:n["notion://projects/project_to_task_relation"]))||void 0===e?void 0:e.id:null==m?void 0:m.id}),[o,m]),M=(0,s().K8)((()=>{var e;return null==m||null===(e=m.getFormat())||void 0===e?void 0:e.synced_collection_external_url}),[m]),P=(0,s().O$)(jo().Ay),V=(0,s().K8)((()=>{const e=P.flowId||yt().JW();return P.flowId||jo().Ay.setState({...P,flowId:e}),e}),[P]),F=(0,s().K8)((()=>Boolean(Ge().A.externalAuthentications.state.find((e=>e.id===p&&e.user_id===c.currentUser.id)))),[p,c]),D=(0,h().IS)((()=>({snackbarCta:{color:O().Tj.text.inversePrimary,marginInlineStart:16},titleContainer:{display:"flex",flexDirection:"row",gap:"8px"},stepText:{color:O().Tj.text.secondary},filterContainer:{padding:12,marginBottom:12},dropdownLabel:{color:O().Tj.text.secondary,fontSize:We().J.UISmall.desktop,fontWeight:We().Wy.medium,marginBottom:8},dropdownButton:{width:"100%",padding:"6px 8px",color:O().Tj.text.primary,fontSize:We().J.UIRegular.desktop,display:"inline-flex",justifyContent:"space-between",alignItems:"center",borderRadius:4,border:`1px solid ${O().Tj.border.secondary}`},checkIcon:{width:14},infoLabel:{color:O().Tj.text.tertiary,marginTop:8,marginBottom:12,fontSize:f().A.isMobile?We().J.UISmall.mobile:We().J.UISmall.desktop}})),[]),E=(0,n.useMemo)((()=>{const e=[{key:30,name:"In the last month"},{key:90,name:"In the last 3 months"},{key:180,name:"In the last 6 months"},{key:270,name:"In the last 9 months"},{key:365,name:"In the last year"}];return w?[...e,{key:vo().$O,name:"Any time"}]:e}),[w]);return(0,z.jsx)(C().A,{...e,title:(0,z.jsxs)("div",{style:D.titleContainer,children:[I?(0,z.jsx)("div",{style:D.stepText,children:(0,z.jsx)(v().sA,{defaultMessage:"Step 3",id:"database.viewSettings.collectionSettingsExternalListFilters.step3Title"})}):void 0,(0,z.jsx)(v().sA,{defaultMessage:"Filter issues",id:"database.viewSettings.collectionSettingsExternalListFilters.title"})]}),header:(0,z.jsx)(Io,{}),handleClose:()=>{R().os({collectionSettingsStore:t})},footer:(0,z.jsx)(_o,{onSubmit:async()=>{if(!(m&&p&&g))return;const{projectCollectionPointer:e,taskCollectionPointer:o}=(0,Co().Be)(m);if(!e||!o)return;const n=t.state.stack.find((e=>"externalProjectsSyncSettings"===e.type&&"external_list_projects"===e.source));yo().D6({label:(0,z.jsx)(v().sA,{defaultMessage:"Started syncing from Jira. Youâ€™ll be notified when the sync is complete",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.snackbar.title"}),right:(0,z.jsx)(he().p,{onClick:yo().N2,style:D.snackbarCta,children:(0,z.jsx)(v().sA,{defaultMessage:"Close",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.snackbar.close"})}),position:"bottom"}),await kt().callApi({eventName:"syncJiraProjects",environment:c,data:{botId:p,projectKeys:r,spaceId:g,properties:a,projectCollectionPointer:e,taskCollectionPointer:o,onlyUpdateProperties:!n,flowId:V,filterConfig:{syncWindow:b}}}),n?(0,y().u)({environment:c,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:"jira",actionType:"sync_projects_and_properties",flowId:V,identifier:M,botId:p,collectionId:k,isSyncOwner:F}}}):(0,y().u)({environment:c,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:"jira",actionType:"sync_properties",flowId:V,identifier:M,botId:p,collectionId:k,isSyncOwner:F}}}),jo().Ay.setState({...jo().Ay.state,flowId:void 0}),R().os({collectionSettingsStore:t})},action:i,isSetupComplete:u,hasTimeFilterChanged:A}),fullHeight:!0,desktopWidth:320,menuScrollerStyle:{paddingBottom:6},children:(0,z.jsxs)("div",{style:D.filterContainer,children:[(0,z.jsx)(Xe().A,{style:D.dropdownLabel,children:(0,z.jsx)(v().sA,{defaultMessage:"Issues created or modified",id:"database.viewSettings.collectionSettingsExternalListFilters.timeWindowLabel"})}),(0,z.jsx)(_().A,{popupType:f().A.isMobile?fo().n.BottomSheet:fo().n.Popup,renderOrigin:e=>{var t;return(0,z.jsx)(he().p,{...e,style:D.dropdownButton,iconTrailing:{icon:ho().arrowChevronSingleDownSmallIcon,colorVariant:"tertiary",size:"xs"},children:null===(t=E.find((e=>e.key===b)))||void 0===t?void 0:t.name})},render:e=>{const t=[{key:"time-window-section",render:e=>(0,z.jsx)(x().A,{...e}),items:E.map((t=>({key:t.key,action:()=>{wo(t.key)&&j(t.key),e.close()},render:e=>(0,z.jsx)($().A,{...e,title:t.name,right:b===t.key?(0,z.jsx)("div",{style:D.checkIcon,children:(0,z.jsx)(H().I,{icon:xo().checkmarkFillIcon})}):void 0})})))}];return(0,z.jsx)(B().A,{menuType:T().gu.Popup,width:200,children:(0,z.jsx)(le().A,{type:le().O.Vertical,sections:t,initialFocus:void 0})})}}),(0,z.jsx)(Xe().A,{isMultiline:!0,style:D.infoLabel,children:(0,z.jsx)(v().sA,{defaultMessage:"If an issue in this timeframe has a parent outside it, weâ€™ll still sync the parent.",id:"database.viewSettings.collectionSettingsExternalListFilters.infoLabel"})})]})})}function Io(){const e=(0,h().IS)((()=>({description:{marginInlineStart:8,fontSize:f().A.isMobile?We().J.UISmall.mobile:We().J.UISmall.desktop,marginBottom:-4}})),[]);return(0,z.jsx)(x().A,{children:(0,z.jsx)(Xe().A,{isSecondaryColor:!0,isMultiline:!0,style:e.description,children:(0,z.jsx)(v().sA,{defaultMessage:"Select a timeframe to sync issues that were created or modified during that period.",id:"database.viewSettings.collectionSettingsExternalListFilters.description"})})})}function _o(e){const t=(0,h().IS)((()=>({wrapper:{padding:12},button:{width:"100%",border:"none",fontWeight:We().Wy.medium,padding:16},buttonWrapper:{width:"100%"},insetDividerContainer:{marginBottom:8,marginInlineStart:12,marginInlineEnd:12}})),[]),o=e.action===ae().Sh.SyncProjects?(0,z.jsx)("div",{style:t.buttonWrapper,children:(0,z.jsx)(M().A,{colorPalette:"blue",style:t.button,onClick:e.onSubmit,children:e.isSetupComplete?(0,z.jsx)(v().sA,{defaultMessage:"Sync projects",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.syncProjectsButton"}):(0,z.jsx)(v().sA,{defaultMessage:"Start Jira sync",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.startJiraSyncButton"})})}):(0,z.jsx)("div",{style:t.buttonWrapper,children:(0,z.jsx)(M().A,{colorPalette:"blue",style:t.button,onClick:e.onSubmit,disabled:!e.hasTimeFilterChanged,children:(0,z.jsx)("div",{style:{textOverflow:"ellipsis",overflow:"hidden"},children:(0,z.jsx)(v().sA,{defaultMessage:"Sync filtered issues",id:"database.viewSettings.collectionSettingsExternalListFilters.syncFilteredIssues"})})})});return(0,z.jsxs)("div",{style:t.wrapper,children:[(0,z.jsx)("div",{style:t.insetDividerContainer,children:(0,z.jsx)(ne().A,{size:1})}),o]})}var To=()=>o(792057),ko=()=>o(457205),Mo=()=>o(483226),Po=()=>o(552712),Bo=()=>o(484392),Vo=()=>o(278238),Fo=()=>o(569397),Do=()=>o(207207),Eo=()=>o(721479),Oo=()=>o(824862),Ro=()=>o(496603),Ko=()=>o(763824),No=()=>o(510683),zo=()=>o(635676),Lo=()=>o(232930),Uo=()=>o(115512),Wo=()=>o(404141);const Ho=(0,v().YK)({inputPlaceholder:{defaultMessage:"Search for a project",id:"database.viewSettings.collectionSettingsExternalListProjects.inputPlaceholder"},fetchingProjects:{defaultMessage:"Loading projects from Jira...",id:"database.viewSettings.collectionSettingsExternalListProjects.fetchingProjects"},fetchingProjectsFailed:{defaultMessage:"Weâ€™re experiencing temporary issues with Jiraâ€™s APIs. Please try again in a sometime.",id:"database.viewSettings.collectionSettingsExternalListProjects.fetchingProjectsFailed"},defaultLoadingMessage:{defaultMessage:"Loading...",id:"database.viewSettings.collectionSettingsExternalListProjects.loading"},somethingWentWrong:{defaultMessage:"Something went wrong. Please try again!",id:"database.viewSettings.collectionSettingsExternalListProjects.somethingWentWrong"},authInProgress:{defaultMessage:"Authenticating with Jira...",id:"database.viewSettings.collectionSettingsExternalListProjects.authInProgress"},authFailed:{defaultMessage:"Authentication failed, try again!",id:"database.viewSettings.collectionSettingsExternalListProjects.authFailed"},noAccessToSite:{defaultMessage:"If you have multiple Jira sites, make sure youâ€™re authenticating into {site}",id:"database.viewSettings.collectionSettingsExternalListProjects.noAccessToSite"}});function $o(e){switch(e){case"fetchingProjects":return Ho.fetchingProjects;case"somethingWentWrong":return Ho.somethingWentWrong;case"fetchingProjectsFailed":return Ho.fetchingProjectsFailed;case"authFailed":return Ho.authFailed;case"authInProgress":return Ho.authInProgress;case"noAccessToSite":return Ho.noAccessToSite;default:return Ho.defaultLoadingMessage}}function Go(e){const t=(0,v().tz)(),{collectionContextStore:o,collectionSettingsStore:i}=e,[r,a]=n.useState(""),[c,d]=n.useState(!1),[u,p]=n.useState([]),[g,m]=n.useState(!1),[S,f]=n.useState(0),[x,b]=n.useState(!1),[j,w]=n.useState([]),[A,I]=n.useState([]),[_,T]=n.useState([]),[M,P]=n.useState({show:!1}),[B,V]=n.useState(!1),[F,D]=n.useState({show:!1}),[E,K]=n.useState(""),N=(0,l().v3)(),L=(0,s().K8)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getSpaceId()}),[o]),U=(0,s().O$)(ze().AppStoreSidebarSpaceStore),W=(0,s().K8)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getFormat().bot_id}),[o]),[{value:G}]=(0,et().Yb)((async()=>{if(W&&L)return kt().callApi({eventName:"getExternalConnectionMetaInfo",environment:N,data:{botId:W,spaceId:L}})}),[N,W,L]);(0,n.useEffect)((()=>{"success"===(null==G?void 0:G.type)&&"data"in G&&K(G.data.email)}),[G]);const Q=(0,s().K8)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getFormat().synced_collection_external_url}),[o]),q=(0,s().K8)((()=>{var e;return(null===(e=o.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.synced_collection_instance_type)??"Cloud"}),[o]),Y="DataCenter"===q?"jira-dc":"jira",X=(0,s().K8)((()=>{var e;return null===(e=o.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.external_collection_type}),[o]),J=(0,s().K8)((()=>{var e,t;const n=null===(e=o.collectionStore())||void 0===e?void 0:e.getFormat();return Boolean(null==n||null===(t=n.sync_state)||void 0===t?void 0:t.last_synced_at)}),[o]),Z=(0,s().O$)(jo().Ay),{projectCollectionPointer:ee,taskCollectionPointer:te}=(0,s().K8)((()=>(0,Co().Be)(o.collectionStore())),[o]),oe=(0,s().K8)((()=>{if(W&&U){return ko().v.createChildStore(U,{table:Oo().GP,id:W,spaceId:U.id}).getLastEditedById()}return null}),[W,U]),ie=(0,s().K8)((()=>(null==U?void 0:U.userId)===oe),[oe,U]),re=(0,s().K8)((()=>{const e=jo().Ay.state.flowId||yt().JW();return jo().Ay.setState({...jo().Ay.state,flowId:e}),e}),[]),le=(0,s().K8)((()=>Z.projectKeys),[Z]),[{value:se}]=(0,et().Yb)((async()=>L&&W&&ee?(P({show:!0,type:"fetchingProjects"}),"DataCenter"===q&&(0,Co().ru)()?kt().callStreamApi({eventName:"streamProjectsForJiraSite",environment:N,data:{botId:W,spaceId:L,projectCollectionPointer:ee}}):kt().callApi({eventName:"getProjectsForJiraSite",environment:N,data:{botId:W,spaceId:L,projectCollectionPointer:ee}})):null),[N,ee,L,W,q]),ce=(0,s().K8)((()=>Mo().dL()),[]);(0,n.useEffect)((()=>{ce&&S>100?(m(!0),(0,y().u)({environment:N,event:{eventName:"external_sync_setup_action",eventProperties:{integration:Y,actionType:"issues_free_limit_exceeded",flowId:re,issueCount:S,isSyncOwner:ie}}})):m(!1)}),[N,re,ce,S,ie,Y]);const de=(0,n.useCallback)((e=>{const{jiraProjects:t,permittedProjects:o,existingImportedProjectKeys:n}=e;T(n);const i=o.map((e=>e.key));w(i);const r=[...t.filter((({isPrivate:e})=>!e)).sort(((e,t)=>{var o,n;return t.insight&&e.insight?null!==(o=t.insight)&&void 0!==o&&o.lastIssueUpdateTime&&null!==(n=e.insight)&&void 0!==n&&n.lastIssueUpdateTime?new Date(t.insight.lastIssueUpdateTime).getTime()-new Date(e.insight.lastIssueUpdateTime).getTime():t.insight.totalIssueCount-e.insight.totalIssueCount:1})),...t.filter((({isPrivate:e})=>e)).sort(((e,t)=>{const o=i.includes(e.key),n=i.includes(t.key);return o&&n?0:o?-1:1}))];let l=0;r.forEach((e=>{var t;n.includes(e.key)&&(l+=(null===(t=e.insight)||void 0===t?void 0:t.totalIssueCount)??0)})),I(r),f(l);const a=Ro().sb([...n,...le||[]]);n.length&&d(!0),a&&p(a)}),[le]),ue=(0,n.useCallback)((async e=>{const{response:t}=e;let o=!1;try{for await(const e of t){if("error"===e.type){if(P({show:!1}),V(!1),"code"in e){if(!("SITE_NOT_FOUND"!==e.code&&"NO_USER_BOT_FOUND"!==e.code&&"INVALID_BOT"!==e.code||ie))return void b(!0);if("TOKEN_EXPIRED"===e.code)return void R().yl({collectionSettingsStore:i})}return void D({show:!0,type:"fetchingProjectsFailed"})}if(!o){d(!0),T(e.existingImportedProjectKeys);const t=Ro().sb([...e.existingImportedProjectKeys,...le||[]]);p(t),o=!0,P({show:!1})}I((t=>Ro().Mp([...t,...e.permittedProjects],((e,t)=>e.key===t.key)))),w((t=>Ro().sb([...t,...e.permittedProjects.map((e=>e.key))])))}}finally{V(!1)}}),[le,ie,i]);(0,n.useEffect)((()=>{if("success"!==(null==se?void 0:se.type)&&"failed"!==(null==se?void 0:se.type)||("Cloud"!==q&&(0,Co().ru)()||P({show:!1}),"failed"===(null==se?void 0:se.type)&&D({show:!0,type:"fetchingProjectsFailed"})),"success"===(null==se?void 0:se.type)&&"data"in se&&"object"==typeof se.data)if("code"in se.data){if("TOKEN_EXPIRED"===se.data.code)R().yl({collectionSettingsStore:i});else if(!ie){const{code:e}=se.data;"SITE_NOT_FOUND"===e?(b(!0),D({show:!0,type:"noAccessToSite"})):"NO_USER_BOT_FOUND"!==e&&"INVALID_BOT"!==e||b(!0),(0,y().u)({environment:N,event:{eventName:"external_sync_auth",eventProperties:{integration:Y,actionType:"member_auth_render",flowId:re}}})}}else{const e=se.data;Symbol.asyncIterator in e?(V(!0),ue({response:e})):de(e)}}),[se,ie,de,ue,N,re,q,Y,i]);const pe=X?zo().l[X]:"",ge=(0,s().K8)((()=>{const e=jo().Ay.state;return e.isMemberAuthSuccessForDataCenter&&!e.open&&"DataCenter"===e.instanceValue&&e.site&&"dc-auth"===e.type}),[]);(0,et().Yb)((async()=>{if(!ie&&ee&&L&&W&&ge&&(0,Co().Zf)()&&(0,Co().ru)()){b(!1),P({show:!0,type:"fetchingProjects"}),I([]),V(!0);try{const e=await kt().callStreamApi({eventName:"streamProjectsForJiraSite",environment:N,data:{botId:W,spaceId:L,projectCollectionPointer:ee}});"success"===e.type&&"data"in e&&"object"==typeof e.data&&await ue({response:e.data})}catch(e){V(!1),D({show:!0,type:"fetchingProjectsFailed"})}}}),[W,L,ee,N,ue,ge,ie]);const me=(0,h().IS)((()=>({fetchingProjects:{width:"100%",paddingInlineStart:12,paddingInlineEnd:12,paddingTop:6,paddingBottom:12,display:"flex",flexDirection:"column",gap:12,color:O().Tj.text.secondary},loadingLabel:{fontSize:14},skeletonRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:10,marginInlineStart:2,marginInlineEnd:2},skeletonCircle:{width:20,height:20,borderRadius:10},skeletonLine:{height:14,borderRadius:6,width:"70%"},projectIcon:{width:20,height:20,borderRadius:4},connectAccountWrapper:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",margin:12,padding:12,flexDirection:"column",gap:8},connectAccountCTA:{borderRadius:6},connectAccountDescription:{fontSize:We().J.UIRegular.desktop,textAlign:"center",color:O().Tj.text.secondary},errorMessage:{display:"flex",justifyContent:"center",alignItems:"center",textAlign:"center",height:"100%",color:O().oZ.red,paddingInlineStart:8,paddingInlineEnd:8,fontSize:We().J.UIRegular.desktop},authErrorMessage:{fontSize:We().J.UIRegular.desktop,color:O().Tj.text.secondary,marginBottom:12,textAlign:"center"},permittedProjectItemTitle:{fontSize:We().J.UISmall.desktop,fontWeight:We().Wy.medium},permittedProjectItemCaption:{fontSize:We().J.UISmall.desktop,color:Vo().l8.dark.gray,fontWeight:We().Wy.regular},disabledItem:{color:O().Tj.text.secondary,fill:O().Tj.icon.secondary,opacity:.4},privateProjectCallout:{width:"-webkit-fill-available",padding:"0px 16px",color:O().Tj.text.secondary,marginInlineStart:4,marginInlineEnd:4},helpIcon:{display:"inline-block"},menuListItem:{paddingTop:"0px",paddingBottom:"0px"},insetDividerContainer:{marginTop:8,marginBottom:8,marginInlineStart:12,marginInlineEnd:12},leftCheckboxWrapper:{display:"flex",alignItems:"center",marginTop:4},checkBox:{borderRadius:2,alignSelf:"center"},deskTopIcon:{alignSelf:"flex-start",marginTop:4},stepText:{color:O().Tj.text.secondary},titleContainer:{display:"flex",flexDirection:"row",gap:"8px"}})),[]);if(!W||!L)return null;const Se=A.length?(0,nt().Ay)(r,A,(e=>e.name)):[],ye=e=>{const t=e.key;var o,n;u.includes(t)?(p(u.filter((e=>e!==t))),f(S-((null===(o=e.insight)||void 0===o?void 0:o.totalIssueCount)??0))):(p([...u,t]),f(S+((null===(n=e.insight)||void 0===n?void 0:n.totalIssueCount)??0)))},fe=e=>j.includes(e),xe=Q&&(0,Bo().A)((0,Co().ay)(Q)),ve=Se.map((e=>({key:e.id,render:()=>(0,z.jsx)(Ye().m,{disableTooltip:fe(e.key),renderTooltip:e=>(0,z.jsx)("div",{...e,style:ut().Q$,children:Ae}),render:t=>(0,z.jsx)($().A,{...t,style:me.menuListItem,focused:!1,buttonStyle:fe(e.key)?{}:me.disabledItem,disabled:!fe(e.key),onClick:()=>{ye(e)},title:(0,z.jsx)("div",{style:{textTransform:"capitalize"},children:e.name}),left:(0,z.jsx)("div",{style:me.leftCheckboxWrapper,children:(0,z.jsx)(qe().S,{size:14,disabled:!fe(e.key),checked:u.includes(e.key),onClick:()=>{ye(e)},style:me.checkBox})}),icon:(0,z.jsx)("img",{src:e.avatarUrls["48x48"],style:me.projectIcon,alt:e.name}),desktopIconStyle:me.deskTopIcon,caption:e.insight&&(0,z.jsx)("div",{children:e.isPrivate?(0,z.jsx)(v().sA,{defaultMessage:"{issues, plural, one {{issues} issue} other {{issues} issues}} (Private)",id:"database.viewSettings.collectionSettingsExternalListProjects.allProjectsIssueCountPrivate",values:{issues:e.insight.totalIssueCount}}):(0,z.jsx)(v().sA,{defaultMessage:"{issues, plural, one {{issues} issue} other {{issues} issues}}",id:"database.viewSettings.collectionSettingsExternalListProjects.allProjectsIssueCountNotPrivate",values:{issues:e.insight.totalIssueCount}})})})}),action:()=>{}}))),be=Se.filter((e=>_.includes(e.key))).map((e=>({key:e.id,render:()=>(0,z.jsx)(Ye().m,{disableTooltip:fe(e.key),renderTooltip:e=>(0,z.jsx)("div",{...e,style:ut().Q$,children:Ae}),render:t=>(0,z.jsx)($().A,{...t,style:me.menuListItem,focused:!1,buttonStyle:fe(e.key)?{}:me.disabledItem,disabled:!fe(e.key),onClick:()=>{ye(e)},title:(0,z.jsx)("div",{style:{textTransform:"capitalize"},children:e.name}),left:(0,z.jsx)("div",{style:me.leftCheckboxWrapper,children:(0,z.jsx)(qe().S,{size:14,disabled:!fe(e.key),checked:u.includes(e.key),onClick:()=>{ye(e)},style:me.checkBox})}),icon:(0,z.jsx)("img",{src:e.avatarUrls["48x48"],style:me.projectIcon,alt:e.name}),desktopIconStyle:me.deskTopIcon,caption:e.insight&&(0,z.jsx)("div",{children:e.isPrivate?(0,z.jsx)(v().sA,{defaultMessage:"{issues, plural, one {{issues} issue} other {{issues} issues}} (Private)",id:"database.viewSettings.collectionSettingsExternalListProjects.syncedProjectsIssueCountPrivate",values:{issues:e.insight.totalIssueCount}}):(0,z.jsx)(v().sA,{defaultMessage:"{issues, plural, one {{issues} issue} other {{issues} issues}}",id:"database.viewSettings.collectionSettingsExternalListProjects.syncedProjectsIssueCountNotPrivate",values:{issues:e.insight.totalIssueCount}})})})}),action:()=>{}}))),Ce=Se.filter((e=>!_.includes(e.key))).map((e=>({key:e.id,render:()=>(0,z.jsx)(Ye().m,{disableTooltip:fe(e.key),renderTooltip:e=>(0,z.jsx)("div",{...e,style:ut().Q$,children:Ae}),render:t=>(0,z.jsx)($().A,{...t,style:me.menuListItem,focused:!1,buttonStyle:fe(e.key)?{}:me.disabledItem,disabled:!fe(e.key),onClick:()=>{ye(e)},title:(0,z.jsx)("div",{style:{textTransform:"capitalize"},children:e.name}),left:(0,z.jsx)("div",{style:me.leftCheckboxWrapper,children:(0,z.jsx)(qe().S,{size:14,disabled:!fe(e.key),checked:u.includes(e.key),onClick:()=>{ye(e)},style:me.checkBox})}),desktopIconStyle:me.deskTopIcon,icon:(0,z.jsx)("img",{src:e.avatarUrls["48x48"],style:me.projectIcon,alt:e.name}),caption:e.insight&&(0,z.jsx)("div",{children:e.isPrivate?(0,z.jsx)(v().sA,{defaultMessage:"{issues, plural, one {{issues} issue} other {{issues} issues}} (Private)",id:"database.viewSettings.collectionSettingsExternalListProjects.unsyncedProjectsIssueCountPrivate",values:{issues:e.insight.totalIssueCount}}):(0,z.jsx)(v().sA,{defaultMessage:"{issues, plural, one {{issues} issue} other {{issues} issues}}",id:"database.viewSettings.collectionSettingsExternalListProjects.unsyncedProjectsIssueCountNotPrivate",values:{issues:e.insight.totalIssueCount}})})})}),action:()=>{}}))),je=(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{style:me.permittedProjectItemTitle,children:(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.userTooltipTitleForPrivatePages",defaultMessage:"Only some private projects can be synced to Notion"})}),(0,z.jsx)("div",{style:me.permittedProjectItemCaption,children:ie?(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.owner.userTooltipCaptionForPrivatePages",defaultMessage:"{site} sync was set up with the Jira account {email}. You can only sync projects they have access to. Click to view the help center",values:{email:E,site:xe||"This"}}):(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.member.userTooltipCaptionForPrivatePages",defaultMessage:"{site} sync was set up with the Jira account {email}. You can only sync projects that both have access to. Click to view the help center",values:{email:E,site:xe||"This"}})})]}),we=()=>(0,z.jsx)(Ye().m,{renderTooltip:e=>(0,z.jsx)("div",{...e,style:ut().Q$,children:je}),render:e=>(0,z.jsx)(he().p,{...e,style:me.privateProjectCallout,children:(0,z.jsxs)(Po().N,{className:"notion-print-ignore",href:(0,Lo().x)("guides.externalImportAndSync"),external:!0,children:[(0,z.jsx)("span",{style:{...me.helpIcon,marginInlineEnd:6},children:(0,z.jsx)(H().I,{icon:Eo().questionMarkCircleSmallIcon,size:"xs"})}),(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects..privateProjectNotFound",defaultMessage:"Canâ€™t find a private project?"})]})})}),Ae=ie?(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.tooltipMessageForPrivatePages",defaultMessage:"You donâ€™t have access to this project in Jira"}):je;async function Ie(){D({show:!1});const e="DataCenter"===q?vt().Fv:vt().me,t=Ge().A.integrations.state.find((({id:t})=>t===e));if(!t||!L)return;(0,y().u)({environment:N,event:{eventName:"external_sync_auth",eventProperties:{integration:Y,actionType:"member_auth_initiated",flowId:re}}}),e===vt().Fv&&jo().Ay.setState({...jo().Ay.state,site:Q});const o=N.device.isElectron?await async function(e,t){const o=await No().Jq({environment:N,integration:e,spaceId:t,from:"connected_apps_settings"});P({show:!0,type:"authInProgress"});const n=Ge().A.externalAuthentications.state,i=performance.now()+6e4,r=Ko().yX(),l=setInterval((()=>{const e=performance.now();i<e?r.resolve(void 0):Ge().A.externalAuthentications.state.length>n.length&&r.resolve("success")}),1e3);return await r.promise,clearInterval(l),P({show:!1}),o}(t,L):await No().Jq({environment:N,integration:t,spaceId:L,from:"connected_apps_settings"});if("DataCenter"!==q||ie)if(b(!1),o&&it().Q.isSuccess(o)){if(!W||!ee)return;if((0,y().u)({environment:N,event:{eventName:"external_sync_auth",eventProperties:{integration:Y,flowId:re,status:"success",actionType:"member_auth_status"}}}),P({show:!0,type:"fetchingProjects"}),"DataCenter"===q&&(0,Co().ru)()&&ie){I([]);try{const e=await kt().callStreamApi({eventName:"streamProjectsForJiraSite",environment:N,data:{botId:W,spaceId:L,projectCollectionPointer:ee}});"success"===e.type&&"data"in e&&"object"==typeof e.data&&(V(!0),ue({response:e.data}))}catch(r){D({show:!0,type:"fetchingProjectsFailed"})}}else{var n;const e=await kt().callApi({eventName:"getProjectsForJiraSite",environment:N,data:{botId:W,spaceId:L,projectCollectionPointer:ee,userBotId:null===(n=o.value)||void 0===n||null===(n=n.externalAuthentication)||void 0===n?void 0:n.id}});P({show:!1}),"success"===e.type?"code"in e.data?"SITE_NOT_FOUND"===e.data.code?(b(!0),To().ui({message:(0,z.jsx)(Yo,{site:Q,integrationIconUrl:pe,connectAccount:Ie}),showCancel:!1,keepFocus:!0,innerStyle:{width:320,padding:18},items:[]}),(0,y().u)({environment:N,event:{eventName:"external_sync_auth",eventProperties:{integration:Y,actionType:"member_auth_render",flowId:re}}})):"NO_USER_BOT_FOUND"===e.data.code?(b(!0),D({type:"somethingWentWrong",show:!0}),(0,y().u)({environment:N,event:{eventName:"external_sync_auth",eventProperties:{integration:Y,actionType:"member_auth_render",flowId:re}}})):"TOKEN_EXPIRED"===e.data.code?R().yl({collectionSettingsStore:i}):D({type:"fetchingProjectsFailed",show:!0}):de(e.data):D({type:"fetchingProjectsFailed",show:!0})}}else b(!0),D({type:"authFailed",show:!0}),(0,y().u)({environment:N,event:{eventName:"external_sync_auth",eventProperties:{integration:Y,flowId:re,status:"failed",actionType:"member_auth_status"}}})}return(0,z.jsx)(C().A,{...e,title:(0,z.jsxs)("div",{style:me.titleContainer,children:[J?void 0:(0,z.jsx)("div",{style:me.stepText,children:(0,z.jsx)(v().sA,{defaultMessage:"Step 1",id:"database.viewSettings.collectionSettingsExternalListProjects.step1Title"})}),(0,z.jsx)(v().sA,{defaultMessage:"{title}",id:"database.viewSettings.collectionSettingsExternalListProjects.title",values:{title:J?"Synced projects":"Select projects"}})]}),header:!x&&!F.show&&(0,z.jsx)(Qo,{inputValue:r,onChange:a}),handleClose:()=>{jo().Ay.setState({...Z,projectKeys:[],site:void 0,isMemberAuthSuccessForDataCenter:!1}),R().os({collectionSettingsStore:i})},footer:!M.show&&!x&&!F.show&&(0,z.jsx)(qo,{onActionButtonClick:()=>{const e={};A.forEach((t=>{var o;t.insight&&(u.includes(t.key)&&(e[t.key]=(null===(o=t.insight)||void 0===o?void 0:o.totalIssueCount)??0))})),R().a2({collectionSettingsStore:i,item:{type:"externalProjectsSyncSettings",source:"external_list_task_properties",action:ae().Sh.SyncProjects,selectedProjectKeys:u,projectIssueCounts:e}}),jo().Ay.setState({...jo().Ay.state,projectKeys:[]}),(0,y().u)({environment:N,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:Y,actionType:"select_properties_cta_click",flowId:re,identifier:Q,botId:W,collectionId:null==te?void 0:te.id,isSyncOwner:ie}}})},disabled:!c&&0===u.length,selectedProjectKeysLength:u.length,isSetupComplete:J,shouldShowUpgradePlan:g,flowId:re,isSyncOwner:ie,integrationType:Y}),fullHeight:!1,menuScrollerStyle:{paddingBottom:6,...x||F.show?{height:"100%"}:{}},desktopWidth:320,children:function(){if(M.show){const e=(0,Co().pu)();return(0,z.jsxs)("div",{style:me.fetchingProjects,children:[(0,z.jsx)("div",{style:me.loadingLabel,children:t.formatMessage($o(M.type))}),Array.from({length:Co().O1}).map(((t,o)=>(0,z.jsxs)("div",{style:me.skeletonRow,children:[(0,z.jsx)(Qe().P,{style:me.skeletonCircle}),(0,z.jsx)(Qe().P,{style:{...me.skeletonLine,width:e[o%e.length]}})]},o)))]})}return x?(0,z.jsxs)("div",{style:me.connectAccountWrapper,children:[F.show?(0,z.jsx)("div",{style:me.authErrorMessage,children:t.formatMessage($o(F.type),{site:(0,vo().nH)(Q||"")})}):void 0,(0,z.jsxs)(k().A,{size:"lg",onClick:Ie,style:me.connectAccountCTA,children:[(0,z.jsx)("img",{style:{width:14,height:15,marginInlineEnd:8},src:pe,alt:Y}),(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.connectAccountCTA",defaultMessage:"Authenticate your access"})]}),(0,z.jsx)("div",{style:me.connectAccountDescription,children:(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.connectAccountDescription",defaultMessage:"Connect your Jira account to view and sync projects"})})]}):F.show?(0,z.jsx)("div",{style:me.errorMessage,children:t.formatMessage($o(F.type))}):c?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(pt,{title:(0,z.jsx)(v().sA,{defaultMessage:"Synced projects ({existingSyncedProjectsCount})",id:"database.viewSettings.collectionSettingsExternalListProjects.syncedProjectsTitle",values:{existingSyncedProjectsCount:_.length}}),isSectionItemsLoading:B,disableSelectAll:!0,items:be},"syncedProjects"),(0,z.jsx)("div",{style:me.insetDividerContainer,children:(0,z.jsx)(ne().A,{size:1})}),(0,z.jsx)(pt,{title:(0,z.jsx)(v().sA,{defaultMessage:"All projects ({unsyncedProjectsCount})",id:"database.viewSettings.collectionSettingsExternalListProjects.unsyncedProjectsTitle",values:{unsyncedProjectsCount:A.length-_.length}}),isSectionItemsLoading:B,disableSelectAll:!0,items:Ce},"unsyncedProjects"),we()]}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(pt,{title:(0,z.jsx)(v().sA,{defaultMessage:"{buttonText}",id:"database.viewSettings.collectionSettingsExternalListProjects.selectedProjectsTitleForInitialSync",values:{buttonText:u.length===A.length?`All ${A.length} Projects`:`${u.length.toString()} of ${A.length.toString()} projects`}}),isSectionItemsLoading:B,disableSelectAll:!0,items:ve,disableCollapse:!0},"allProjects"),we()]})}()})}function Qo(e){const t=(0,v().tz)();return(0,z.jsxs)(x().A,{children:[(0,z.jsx)(Xe().A,{isSecondaryColor:!0,isMultiline:!0,style:{marginInlineStart:8,marginInlineEnd:8,marginBottom:12,fontSize:f().A.isMobile?We().J.UISmall.mobile:We().J.UISmall.desktop,lineHeight:"16px",fontWeight:We().Wy.medium},children:(0,z.jsx)(v().sA,{defaultMessage:"Synced projects are visible to anyone with database access. For privacy, restrict database permissions.",id:"database.viewSettings.collectionSettingsExternalListProjects.description"})}),(0,z.jsx)(mt().Ay,{focusInitial:!0,value:e.inputValue,onChange:t=>{e.onChange(t.target.value)},placeholder:t.formatMessage(Ho.inputPlaceholder),inputLeft:(0,z.jsx)(mt().Zf,{icon:Do().magnifyingGlassIcon})})]})}function qo(e){const t=(0,l().v3)(),o=(0,h().IS)((()=>({wrapper:{padding:12},wrapperInner:{borderColor:"none"},button:{width:"100%",border:"none",fontWeight:We().Wy.medium,padding:16},syncDescription:{fontSize:We().J.UISmall.desktop,color:O().Tj.text.secondary,marginBottom:8,textAlign:"center"},error:{color:"#D44C47"},insetDividerContainer:{marginBottom:8,marginInlineStart:12,marginInlineEnd:12}})),[]);return(0,z.jsxs)("div",{style:o.wrapper,children:[(0,z.jsx)("div",{style:o.insetDividerContainer,children:(0,z.jsx)(ne().A,{size:1})}),(0,z.jsx)("div",{style:o.wrapperInner,children:e.shouldShowUpgradePlan?(0,z.jsxs)("div",{children:[(0,z.jsx)("div",{style:{...o.syncDescription,...o.error},children:(0,z.jsx)(v().sA,{defaultMessage:"Your Free Notion plan allows up to 100 synced issues. Choose fewer projects or upgrade to sync unlimited issues.",id:"database.viewSettings.collectionSettingsExternalListProjects.upgradePlanContext"})}),(0,z.jsx)(M().A,{colorPalette:"blue",style:o.button,onClick:()=>{Wo().Ay.setState({open:!0,openedFrom:"jira_sync_2",currentTab:"plans",defaultSubtab:void 0,highlightedSetting:void 0}),(0,y().u)({environment:t,event:{eventName:"external_sync_setup_action",eventProperties:{integration:e.integrationType,actionType:"plan_upgrade_cta_click",flowId:e.flowId,isSyncOwner:e.isSyncOwner}}})},disabled:e.disabled,children:(0,z.jsx)(v().sA,{defaultMessage:"Upgrade",id:"database.viewSettings.collectionSettingsExternalListProjects.Upgrade"})})]}):(0,z.jsxs)(z.Fragment,{children:[e.isSetupComplete?void 0:(0,z.jsx)("div",{style:o.syncDescription,children:(0,z.jsx)(v().sA,{defaultMessage:"{projects, plural, one {{projects} project will be synced} other {{projects} projects will be synced}}",id:"database.viewSettings.collectionSettingsExternalListProjects.projectsToBeSynced",values:{projects:e.selectedProjectKeysLength}})}),(0,z.jsxs)(M().A,{colorPalette:"blue",style:o.button,onClick:e.onActionButtonClick,disabled:e.disabled,children:[(0,z.jsx)("div",{style:{textOverflow:"ellipsis",overflow:"hidden",marginInlineEnd:6},children:(0,z.jsx)(v().sA,{defaultMessage:"Select properties",id:"database.viewSettings.collectionSettingsExternalListProjects.selectProperties"})}),(0,z.jsx)(H().I,{icon:Fo().arrowStraightRightSmallIcon,size:"sm"})]})]})})]})}function Yo(e){const t=(0,h().IS)((()=>({title:{fontWeight:We().Wy.medium,marginInlineEnd:4,marginBottom:6},caption:{marginBottom:24},siteButtonContainer:{gap:2,borderRadius:6,borderStyle:"solid",borderWidth:1,borderColor:O().Tj.border.secondary,marginBottom:24},siteButton:{paddingTop:4,paddingInlineEnd:30,paddingBottom:4,paddingInlineStart:8,borderRadius:6,gap:8,display:"flex"},siteButtonTextContainer:{gap:8,display:"flex"},siteNameText:{fontSize:Uo().vQ,fontWeight:We().Wy.regular,lineHeight:"18px",letterSpacing:"0.15px",color:O().Tj.text.primary},siteNameSecondaryText:{fontSize:Uo().Kw,color:O().Tj.text.secondary,fontWeight:We().Wy.regular,textAlign:"start",lineHeight:f().A.isMobile?We().K_.UISmall.mobile:We().K_.UISmall.desktop},logo:{width:20,height:20,marginTop:6},siteWrapper:{display:"flex",flexFlow:"column",gap:1,alignItems:"flex-start"}})),[]);return(0,z.jsxs)("div",{children:[(0,z.jsx)("div",{style:t.title,children:(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.siteMismatchPopup.title",defaultMessage:"Authentication Failed"})}),(0,z.jsx)(Xe().A,{isSecondaryColor:!0,isMultiline:!0,style:t.caption,children:(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.siteMismatchPopup.description",defaultMessage:"If you have multiple Jira sites, make sure youâ€™re authenticating into this one:"})}),(0,z.jsx)("div",{style:t.siteButtonContainer,children:(0,z.jsx)(ct().Ay,{style:t.siteButton,disallowTabbing:!0,disabled:!0,children:(0,z.jsxs)("div",{style:t.siteButtonTextContainer,children:[(0,z.jsx)("img",{style:t.logo,src:e.integrationIconUrl,alt:e.site}),(0,z.jsxs)("div",{style:t.siteWrapper,children:[(0,z.jsx)("span",{style:t.siteNameText,children:(0,Bo().A)((0,Co().ay)(e.site||""))}),(0,z.jsx)("span",{style:t.siteNameSecondaryText,children:e.site})]})]})})}),(0,z.jsx)(M().A,{colorPalette:"blue",style:{width:"100%",marginBottom:8},onClick:()=>{e.connectAccount(),To().zw()},children:(0,z.jsx)(v().sA,{defaultMessage:"Try again",id:"database.viewSettings.collectionSettingsExternalListProjects.siteMismatchPopup.tryAgainCTA"})}),(0,z.jsx)(he().p,{onClick:()=>{To().zw()},style:{width:"100%",justifyContent:"center"},children:(0,z.jsx)(Xe().A,{isSecondaryColor:!0,children:(0,z.jsx)(v().sA,{defaultMessage:"Cancel",id:"database.viewSettings.collectionSettingsExternalListProjects.siteMismatchPopup.cancenCTA"})})})]})}var Xo=()=>o(24123);const Jo=(0,v().YK)({inputPlaceholder:{defaultMessage:"Search for a property...",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.inputPlaceholder"},fetchingProperties:{defaultMessage:"Loading properties from Jira...",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.fetchingProperties"}}),Zo=o(488173).UY,en=["attachment","issuetype"],tn=["description","comment"],on=["updated","labels","issuelinks","creator","subtasks","reporter","watches","created"],nn=new Map([["user","person"],["attachment","file"],["array","multi_select"],["option","select"],["option-with-child","select"],["number","number"],["datetime","date"],["date","date"],["priority","select"],["issuetype","select"],["string","text"],["default","text"]]),rn=100;function ln(e){const{collectionSettingsStore:t,collectionContextStore:o,action:i,selectedProjectKeys:r}=e,[a,c]=n.useState(""),[d,p]=n.useState([]),g=(0,h().DP)(),[m,S]=n.useState(!1),f=(0,l().v3)(),x=(0,s().K8)((()=>o.collectionStore()),[o]),b=(0,s().K8)((()=>null==x?void 0:x.getFormat()),[x]),j=(0,s().K8)((()=>null==x?void 0:x.getSchema()),[x]),w=(0,s().K8)((()=>{const e=o.collectionViewBlockStore();return"notion://projects_collection"===(null==b?void 0:b.app_config_uri)?(0,bo().k7)(e,null==j?void 0:j["notion://projects/project_to_task_relation"]):x}),[o,j,b,x]),A=(0,s().K8)((()=>null==w?void 0:w.getSchema()),[w]),I=(0,s().K8)((()=>null==w?void 0:w.id),[w]),_=(0,s().K8)((()=>null==x?void 0:x.getSpaceId()),[x]),T=(0,s().K8)((()=>{var e;return null==x||null===(e=x.getFormat())||void 0===e?void 0:e.synced_collection_external_url}),[x]),k=(0,s().K8)((()=>null==x?void 0:x.getFormat().bot_id),[x]),M=d.filter((e=>e.isSelected)).length,P=(0,s().K8)((()=>{var e;const t=null==x?void 0:x.getFormat();return Boolean(null==t||null===(e=t.sync_state)||void 0===e?void 0:e.last_synced_at)}),[x]),B=(0,s().O$)(jo().Ay),V=(0,s().K8)((()=>{const e=B.flowId||yt().JW();return B.flowId||jo().Ay.setState({...B,flowId:e}),e}),[B]),F=(0,s().K8)((()=>Boolean(Ge().A.externalAuthentications.state.find((e=>e.id===k&&e.user_id===f.currentUser.id)))),[k,f]),E=(0,n.useCallback)((e=>{const t=d.map((t=>{const o=e.find((e=>e.id===t.id));var n;return o&&!tn.includes(o.id)?{...t,isProjectLevel:"PROJECT"===(null===(n=o.scope)||void 0===n?void 0:n.type)}:t})),o=e.filter((e=>!t.find((t=>t.id===e.id))&&!tn.includes(e.id))).filter((({schema:e})=>Boolean(e))).map((e=>{var t;const o=en.includes(e.id),n=(0,u().gB)(`${I}:${e.id}`),i=Boolean(null==A?void 0:A[n]);return{id:e.id,name:e.name,isSelected:o||i,isRequired:o,currentlySyncing:o||i,type:(r=null==e?void 0:e.schema,r?"watches"===r.type||"array"===r.type&&"user"===r.items?"person":"array"===r.type&&"attachment"===r.items?"file":nn.get((null==r?void 0:r.type)??"default"):"text"),isProjectLevel:"PROJECT"===(null===(t=e.scope)||void 0===t?void 0:t.type),isPopular:on.includes(e.id)};var r}));return[...t,...o]}),[d,I,A]),K=(0,n.useCallback)((e=>{p(e);e.filter((e=>e.isSelected)).length>100&&(0,y().u)({environment:f,event:{eventName:"external_sync_setup_action",eventProperties:{integration:"jira",actionType:"properties_limit_exceeded",flowId:V,identifier:T,botId:k,collectionId:I,isSyncOwner:F}}})}),[f,T,k,I,V,F]),[{value:N}]=(0,et().Yb)((async()=>_&&T&&k?await kt().callApi({eventName:"getFieldsForJiraIssues",environment:f,data:{spaceId:_,site:T,botId:k}}):null),[f,_,T,k]);(0,n.useEffect)((()=>{if(!m&&"success"===(null==N?void 0:N.type)&&"data"in N)if("code"in N.data)"TOKEN_EXPIRED"===N.data.code&&R().yl({collectionSettingsStore:t});else{const e=E(N.data.fields.sort(((e,t)=>{var o,n,i,r,l;return en.includes(e.id)&&!en.includes(t.id)?-1:!en.includes(e.id)&&en.includes(t.id)?1:en.includes(e.id)&&en.includes(t.id)||null!==(o=e.schema)&&void 0!==o&&o.customId&&null!==(n=t.schema)&&void 0!==n&&n.customId||!(null!==(i=e.schema)&&void 0!==i&&i.customId||null!==(r=t.schema)&&void 0!==r&&r.customId)?e.name.toLocaleLowerCase()>t.name.toLocaleLowerCase()?1:-1:null!==(l=e.schema)&&void 0!==l&&l.customId?1:-1})));S(!0),K(e)}}),[N,m,K,E,t]),(0,n.useEffect)((()=>{const e=[];A&&Object.entries(A).forEach((([t,o])=>{if(("relation"!==(null==o?void 0:o.type)||null==o||!o.connectedRelation)&&(null!=o&&o.derived_property_record_metadata||Zo.has(t))){var n;const i="title"===t?"Task Name (Summary)":(null==o?void 0:o.name)??Zo.get(t)??"",r=(null==o||null===(n=o.derived_property_record_metadata)||void 0===n?void 0:n.external_object_attribute)??Zo.get(t)??"";e.push({id:r,name:i,isSelected:!0,currentlySyncing:!0,isRequired:Zo.has(t)||en.includes(r),type:null==o?void 0:o.type})}})),p((t=>Ro().hS([...t,...e],"id")))}),[A]);const L=(0,h().IS)((()=>({disabledItem:{color:O().Tj.text.secondary,fill:O().Tj.icon.secondary,opacity:.4},snackbarCta:{color:O().Tj.text.inversePrimary,marginInlineStart:16},titleContainer:{display:"flex",flexDirection:"row",gap:"8px"},stepText:{color:O().Tj.text.secondary},fetchingProperties:{width:"100%",paddingInlineStart:12,paddingInlineEnd:12,paddingTop:6,paddingBottom:12,display:"flex",flexDirection:"column",gap:12,color:O().Tj.text.secondary},loadingLabel:{fontSize:14},skeletonRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:10,marginInlineStart:2,marginInlineEnd:2},skeletonCircle:{width:20,height:20,borderRadius:10},skeletonLine:{height:14,borderRadius:6,width:"70%"},insetDividerContainer:{marginTop:8,marginBottom:8,marginInlineStart:12,marginInlineEnd:12}})),[]),U=d.length?(0,nt().Ay)(a,d,(e=>e.name)):[],W=e=>{K(d.map((t=>t.id===e.id?{id:e.id,name:e.name,isRequired:e.isRequired,isSelected:!e.isSelected,currentlySyncing:e.currentlySyncing,type:e.type,isPopular:e.isPopular,isProjectLevel:e.isProjectLevel}:t)))},H=U.filter((e=>e.isRequired||e.isPopular)).map((e=>({key:e.id,render:()=>(0,z.jsx)($().A,{focused:!1,style:e.isRequired?L.disabledItem:{},onClick:()=>{W(e)},disabled:e.isRequired,title:(0,z.jsx)("div",{style:{textTransform:"capitalize"},children:e.name}),left:(0,z.jsx)("div",{children:(0,z.jsx)(qe().S,{size:14,checked:e.isSelected,disabled:e.isRequired,onClick:()=>{W(e)},style:{borderRadius:2}})}),icon:(0,z.jsx)(Xo().B,{type:e.type??"text",icon:void 0,size:D().Ev.sm,theme:g,propertyId:e.id})}),action:()=>{}}))),G=U.filter((e=>!(e.isRequired||e.isPopular))).map((e=>({key:e.id,render:()=>(0,z.jsx)($().A,{focused:!1,onClick:()=>{W(e)},title:(0,z.jsx)("div",{style:{textTransform:"capitalize"},children:e.name}),left:(0,z.jsx)("div",{children:(0,z.jsx)(qe().S,{size:14,checked:e.isSelected,disabled:e.isRequired,onClick:()=>{W(e)},style:{borderRadius:2}})}),icon:(0,z.jsx)(Xo().B,{type:e.type??"text",icon:void 0,size:D().Ev.sm,theme:g,propertyId:e.id})}),action:()=>{}})));return(0,z.jsx)(C().A,{...e,title:(0,z.jsx)("div",{style:L.titleContainer,children:P?(0,z.jsx)(v().sA,{defaultMessage:"Synced properties",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.titleForSyncedPropertiesTab"}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{style:L.stepText,children:(0,z.jsx)(v().sA,{defaultMessage:"Step 2",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.step2Title"})}),(0,z.jsx)(v().sA,{defaultMessage:"Select properties",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.titleForSelectPropertiesTab"})]})}),header:(0,z.jsx)(an,{inputValue:a,onChange:c}),handleClose:()=>{R().os({collectionSettingsStore:t})},footer:(0,z.jsx)(sn,{action:i,onSubmit:async()=>{if(!(x&&k&&_))return;const{projectCollectionPointer:o,taskCollectionPointer:n}=(0,Co().Be)(x);if(!o||!n)return;const i=t.state.stack.find((e=>"externalProjectsSyncSettings"===e.type&&"external_list_projects"===e.source)),l=d.filter((e=>e.isSelected)).map((e=>e.id));if(en.forEach((e=>{l.includes(e)||l.push(e)})),!P)return R().a2({collectionSettingsStore:t,item:{type:"externalProjectsSyncSettings",source:"external_list_filters",action:ae().Sh.SyncProjects,selectedProjectKeys:r,selectedProperties:l}}),void(0,y().u)({environment:f,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:"jira",actionType:"select_filters_cta_click",flowId:V,botId:k,collectionId:I,isSyncOwner:F}}});yo().D6({label:(0,z.jsx)(v().sA,{defaultMessage:"Started syncing from Jira. Youâ€™ll be notified when the sync is complete",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.snackbar.title"}),right:(0,z.jsx)(he().p,{onClick:yo().N2,style:L.snackbarCta,children:(0,z.jsx)(v().sA,{defaultMessage:"Close",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.snackbar.close"})}),position:"bottom"}),await kt().callApi({eventName:"syncJiraProjects",environment:f,data:{botId:k,projectKeys:r,projectIssueCounts:e.projectIssueCounts,spaceId:_,properties:l,projectCollectionPointer:o,taskCollectionPointer:n,onlyUpdateProperties:!i,flowId:V}}),i?(0,y().u)({environment:f,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:"jira",actionType:"sync_projects_and_properties",flowId:V,identifier:T,botId:k,collectionId:I,isSyncOwner:F}}}):(0,y().u)({environment:f,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:"jira",actionType:"sync_properties",flowId:V,identifier:T,botId:k,collectionId:I,isSyncOwner:F}}}),jo().Ay.setState({...jo().Ay.state,flowId:void 0}),R().os({collectionSettingsStore:t})},isSetupComplete:P,selectedPropertiesCount:M}),fullHeight:!1,menuScrollerStyle:{paddingBottom:6},desktopWidth:320,children:m?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(pt,{title:(0,z.jsx)(v().sA,{defaultMessage:"Standard properties ({standardPropertyCount})",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.standardPropertiesTitle",values:{standardPropertyCount:d.filter((e=>e.isRequired||e.isPopular)).length}}),disableSelectAll:!0,items:H,isSectionItemsLoading:!m},"requiredProperties"),(0,z.jsx)("div",{style:L.insetDividerContainer,children:(0,z.jsx)(ne().A,{size:1})}),(0,z.jsx)(pt,{title:(0,z.jsx)(v().sA,{defaultMessage:"All properties ({siteLevelPropertiesCount})",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.siteLevelPropertiesTitle",values:{siteLevelPropertiesCount:d.filter((e=>!(e.isRequired||e.isPopular))).length}}),items:G,disableSelectAll:!0,isSectionItemsLoading:!m},"allOptionalProperties")]}):(()=>{const e=(0,Co().pu)();return(0,z.jsxs)("div",{style:L.fetchingProperties,children:[(0,z.jsx)("div",{style:L.loadingLabel,children:(0,z.jsx)(v().sA,{...Jo.fetchingProperties})}),Array.from({length:Co().O1}).map(((t,o)=>(0,z.jsxs)("div",{style:L.skeletonRow,children:[(0,z.jsx)(Qe().P,{style:L.skeletonCircle}),(0,z.jsx)(Qe().P,{style:{...L.skeletonLine,width:e[o%e.length]}})]},o)))]})})()})}function an(e){const t=(0,v().tz)();return(0,z.jsxs)(x().A,{children:[(0,z.jsx)(Xe().A,{isSecondaryColor:!0,isMultiline:!0,style:{marginInlineStart:12,marginBottom:12,fontSize:f().A.isMobile?We().J.UISmall.mobile:We().J.UISmall.desktop},children:(0,z.jsx)(v().sA,{defaultMessage:"Select which Jira properties will be synced as Notion properties in the issues database",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.description"})}),(0,z.jsx)(mt().Ay,{focusInitial:!0,value:e.inputValue,onChange:t=>{e.onChange(t.target.value)},placeholder:t.formatMessage(Jo.inputPlaceholder),inputLeft:(0,z.jsx)(mt().Zf,{icon:Do().magnifyingGlassIcon})})]})}function sn(e){const t=(0,h().IS)((()=>({wrapper:{padding:12},buttonWrapper:{borderColor:"none"},button:{width:"100%",border:"none",fontWeight:We().Wy.medium,padding:16},syncDescription:{paddingTop:8,fontSize:We().J.UISmall.desktop,color:O().Tj.text.secondary,marginBottom:8,textAlign:"center"},error:{color:"#D44C47"},insetDividerContainer:{marginBottom:8,marginInlineStart:12,marginInlineEnd:12}})),[]),o=e.selectedPropertiesCount>rn,n=e.action===ae().Sh.SyncProjects?(0,z.jsx)("div",{style:t.buttonWrapper,children:(0,z.jsx)(M().A,{colorPalette:"blue",style:t.button,onClick:e.onSubmit,disabled:o,children:e.isSetupComplete?(0,z.jsx)(v().sA,{defaultMessage:"Sync projects",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.syncProjectsButton"}):(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,z.jsx)(v().sA,{defaultMessage:"Select issue filters",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.selectIssueFiltersButton"}),(0,z.jsx)(H().I,{icon:eo().arrowStraightRightFillIcon,size:"sm",style:{marginInlineStart:6}})]})})}):(0,z.jsx)("div",{style:t.buttonWrapper,children:(0,z.jsx)(M().A,{colorPalette:"blue",style:t.button,onClick:e.onSubmit,disabled:o,children:(0,z.jsx)("div",{style:{textOverflow:"ellipsis",overflow:"hidden"},children:(0,z.jsx)(v().sA,{defaultMessage:"Sync additional properties",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.syncAdditionalProperties"})})})});return(0,z.jsxs)("div",{style:t.wrapper,children:[(0,z.jsx)("div",{style:t.insetDividerContainer,children:(0,z.jsx)(ne().A,{size:1})}),e.isSetupComplete||o?void 0:(0,z.jsx)("div",{style:t.syncDescription,children:(0,z.jsx)(v().sA,{defaultMessage:"{propertiesCount, plural, one {{propertiesCount} property will be synced} other {{propertiesCount} properties will be synced}}",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.selectProperties",values:{propertiesCount:e.selectedPropertiesCount}})}),o?(0,z.jsx)("div",{style:{...t.syncDescription,...t.error},children:(0,z.jsx)(v().sA,{defaultMessage:"You selected {selectedProperties} properties. The maximum allowed is 100",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.propertiesLimit",values:{selectedProperties:e.selectedPropertiesCount}})}):void 0,n]})}var cn=()=>o(609679),dn=()=>o(373009),un=()=>o(433337),pn=()=>o(869190),gn=()=>o(775842),mn=()=>o(663640),Sn=()=>o(202017),yn=()=>o(396350),fn=()=>o(170350),hn=()=>o(508485),xn=()=>o(706021),vn=()=>o(485444),bn=()=>o(491761),Cn=()=>o(736767),jn=()=>o(16006),wn=()=>o(974591),An=()=>o(574036);function In({taskCollectionStore:e,projectCollectionStore:t,externalSyncStore:o,spaceStore:n,isActiveSync:i,isSyncing:r,openedFrom:a="external_source_settings"}){var c;const d="enterprise"===(0,s().K8)((()=>{if(n)return n.getSubscriptionTier()}),[n]),u=(0,s().K8)((()=>null==e?void 0:e.getFormat()),[e]),p=Boolean(null==u||null===(c=u.sync_state)||void 0===c?void 0:c.enable_two_way_sync),g=Boolean(null==u?void 0:u.error),m=function(e){const{isSyncing:t,isActiveSync:o,isFailedSync:n}=e;if(!o)return(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalSource.twoWaySync.tooltip.inactive",defaultMessage:"Cannot be edited for inactive sync"});if(t)return(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalSource.twoWaySync.tooltip.syncing",defaultMessage:"Cannot be edited while sync is in progress"});if(n)return(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalSource.twoWaySync.tooltip.failed",defaultMessage:"Cannot be edited for failed sync"});return(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalSource.twoWaySync.tooltip.generic",defaultMessage:"Allows 2-way editing and syncing"})}({isSyncing:r,isActiveSync:i,isFailedSync:g}),S=(0,l().v3)(),y=(0,h().IS)((()=>({textWrapper:{fontFamily:We().vc(cn().locale).sans,opacity:1}})),[]),f=()=>{wn().toggleTwoWaySyncOnCollection({environment:S,taskCollectionStore:e,projectCollectionStore:t,openedFrom:a})};return d?(0,z.jsx)(Ye().m,{renderTooltip:e=>(0,z.jsx)("div",{...e,style:ut().Q$,children:m}),render:e=>(0,z.jsx)(An().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"2-way sync",id:"database.viewSettings.collectionSettingsExternalSource.twoWaySync.switchName"}),caption:(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalSource.twoWaySync.caption",defaultMessage:"Allows 2-way editing and syncing"}),on:p,focused:!1,onClick:f,disabled:r||!i||g,textWrapperStyle:y.textWrapper})}):null}var _n=()=>o(416783),Tn=()=>o(132855),kn=()=>o(991249);function Mn({integrationIconUrl:e,currentSpaceStore:t}){const o=(0,l().v3)(),n=(0,h().IS)((()=>({container:{marginInlineStart:8,marginInlineEnd:8,marginTop:6,marginBottom:6,padding:0},description:{marginTop:-6,marginBottom:-2},buttonRow:{display:"flex",alignItems:"center",gap:8},upgradeButton:{width:"100%",gap:4,fontWeight:We().Wy.medium,padding:16},learnMore:{marginTop:12,color:O().Tj.text.secondary,display:"inline-flex",alignItems:"center",gap:4,marginInlineStart:24},helpIcon:{alignSelf:"center"}})),[]);return"enterprise"===(0,s().K8)((()=>{if(t)return t.getSubscriptionTier()}),[t])?null:(0,z.jsxs)("div",{style:n.container,children:[(0,z.jsx)("div",{style:n.description,children:(0,z.jsx)(P().D,{as:"p",styleKey:"bodyRegular",colorVariant:"secondary",children:(0,z.jsx)(v().sA,{defaultMessage:"Unlock Jira 2-way sync with the Enterprise plan to keep your Notion database up to date",id:"database.viewSettings.collectionSettingsExternalSource.jiraTwoWayUpsellDescription"})})}),(0,z.jsx)("div",{style:n.buttonRow,children:(0,z.jsx)(k().A,{shape:"default",size:f().A.isMobile?"lg":"md",iconLeading:{icon:Tn().arrowInCircleUpFillIcon,colorPalette:"blue",colorVariant:"accentPrimary"},onClick:()=>{(0,kn().K)(o,{from:"workspace_connections",upsell:{type:"product",product:"enterprise",limit:{type:"none"},trialability:"none"},spaceStore:t})},style:n.upgradeButton,children:(0,z.jsx)(v().sA,{defaultMessage:"Upgrade now",id:"database.viewSettings.collectionSettingsExternalSource.upgradeNow"})})}),(0,z.jsxs)(_n().V,{href:(0,Lo().x)("guides.externalImportAndSync"),external:!0,hoverColor:"blue",disableUnderline:!0,style:n.learnMore,children:[(0,z.jsx)(H().I,{icon:Eo().questionMarkCircleSmallIcon,size:"sm",colorPalette:"gray",colorVariant:"accentPrimary",style:n.helpIcon}),(0,z.jsx)(P().D,{as:"span",styleKey:"bodyRegular",colorVariant:"secondary",children:(0,z.jsx)(v().sA,{defaultMessage:"Learn more about Jira 2-way sync",id:"database.viewSettings.collectionSettingsExternalSource.learnMoreAboutJiraTwoWaySync"})})]})]})}var Pn=()=>o(62368),Bn=()=>o(252833),Vn=()=>o(817126),Fn=()=>o(528093),Dn=()=>o(859004);const En=(0,v().YK)({SourceHeading:{defaultMessage:"Source",id:"database.viewSettings.collectionSettingsExternalSource.sourceHeading"},CollectionSettingsExternalSourceTitle:{defaultMessage:"Jira sync",id:"database.viewSettings.collectionSettingsExternalSource.tabTitle"},JiraSyncExternalSourceDescription:{id:"database.viewSettings.collectionSettingsExternalSource.description",defaultMessage:"To set up a Jira synced database, youâ€™ll need to choose projects and properties to sync"},importInProgressToolTip:{id:"database.viewSettings.collectionSettingsExternalSource.tooltipForInProgressImport",defaultMessage:"Cannot be edited while sync is in progress"},accountDisconnectedTooltip:{id:"database.viewSettings.collectionSettingsExternalSource.accountDisconnectedTooltip",defaultMessage:"Account has been disconnected"},jiraSyncSourceDisabledTooltip:{id:"database.viewSettings.collectionSettingsExternalSource.sourceDisabledTooltip",defaultMessage:"Workspace owner has disabled edits for this Jira site"},featureUnavailableTooltip:{defaultMessage:"{upsellTier, select, plus {Plus} business {Business} enterprise {Enterprise} other {}} plan is required to access this feature",id:"database.viewSettings.collectionSettingsExternalSource.featureUnavailableTooltip"},collectionSettingsExternalSourceLastSynced:{defaultMessage:"Last synced - {lastSyncedAt}",id:"database.viewSettings.collectionSettingsExternalSource.lastSynced"},collectionSettingsSyncFailed:{defaultMessage:"Sync has failed please re-authenticate",id:"database.viewSettings.collectionSettingsExternalSource.syncFailed"},collectionSettingsSyncInProgress:{defaultMessage:"{integration} sync in progress...",id:"database.viewSettings.collectionSettingsExternalSource.syncInProgress"},collectionSettingsSyncFailedNoPermissionToGetUser:{defaultMessage:"The connected Jira account {jiraAccountName} doesnâ€™t have permission to load users. Please update the token permissions and try again",id:"database.viewSettings.collectionSettingsExternalSource.syncFailedNoPermissionToGetUser"},collectionSettingsSyncFailedNoPermissionToGetProjects:{defaultMessage:"The connected Jira account {jiraAccountName} doesnâ€™t have permission to load some projects. Please update the token permissions and try again",id:"database.viewSettings.collectionSettingsExternalSource.syncFailedNoPermissionToGetProjects"},collectionSettingsSyncFailedNoPermissionToRegisterWebhook:{defaultMessage:"The connected Jira account {jiraAccountName} doesnâ€™t have permission to register a webhook. Please update the token permissions and try again",id:"database.viewSettings.collectionSettingsExternalSource.syncFailedNoPermissionToRegisterWebhook"},collectionSettingsSyncFailedJiraCloudSubscriptionExpired:{defaultMessage:"The Jira Cloud subscription for {jiraAccountName} has expired. Please renew your subscription and try again",id:"database.viewSettings.collectionSettingsExternalSource.syncFailedJiraCloudSubscriptionExpired"},collectionSettingsJiraSyncHelpLink:{id:"jiraSync.helpCenter",defaultMessage:"Learn about Jira sync"},reconnectButtonText:{id:"database.viewSettings.collectionSettingsExternalSource.reconnectButtonText",defaultMessage:"Re-authenticate Jira"},propertyLimitWarning:{defaultMessage:"{propertyNames} hit the 1,000-option limit. New options wonâ€™t sync. Reduce options or unsync the {fieldFields} to resolve",id:"database.viewSettings.collectionSettingsExternalSource.propertyLimitWarning"},collectionSettingsSyncFailedNoTimeFilter:{defaultMessage:"To ensure accurate data syncing, please set a time filter for your Jira sync. If no time filter is configured by <bold>{deadline}</bold>, a <bold>{timeFilter}</bold> will automatically be applied.",id:"database.viewSettings.collectionSettingsExternalSource.syncFailedNoTimeFilter"},collectionSettingsSyncFailedTemporary:{defaultMessage:"Last sync encountered a temporary issue. Your data will sync automatically on the next run.",id:"database.viewSettings.collectionSettingsExternalSource.syncFailedTemporary"},scopedTokenNoLiveUpdates:{defaultMessage:"Live updates are not supported for scoped tokens.",id:"database.viewSettings.collectionSettingsExternalSource.scopedTokenNoLiveUpdates"}}),On=12;function Rn(e){const{collectionContextStore:t,openedFrom:o}=e,{collectionFormat:i,propertySchema:r,externalCollectionType:l,currentCollectionStore:a}=(0,s().K8)((()=>{var e;const o=t.collectionStore();return{collectionFormat:null==o?void 0:o.getFormat(),propertySchema:null==o?void 0:o.getSchema(),externalCollectionType:null==o||null===(e=o.getFormat())||void 0===e?void 0:e.external_collection_type,currentCollectionStore:o}}),[t]),c=(0,s().O$)(t.externalSyncStore),d=(0,n.useMemo)((()=>"Salesforce"===l?Kn:Nn),[l]);return i&&r&&l&&a&&c&&function(e){return void 0!==(null==e?void 0:e.external_collection_type)}(i)?(0,z.jsx)(d,{...e,externalCollectionFormat:i,propertySchema:r,externalCollectionType:l,currentCollectionStore:a,externalSyncStore:c,openedFrom:o}):null}function Kn(e){var t;const o=(0,v().tz)(),i=(0,l().v3)(),{collectionSettingsStore:r,externalCollectionFormat:a,currentCollectionStore:c,externalCollectionType:d,collectionContextStore:u}=e,p=$n(),g=(0,s().O$)(ze().AppStoreSidebarSpaceStore),m=(0,s().K8)((()=>(0,Pn().p)(g)),[g]),{flowId:S,report_sync_state:f}=(0,s().K8)((()=>({flowId:He().A.getFlowId(),report_sync_state:"report"===He().A.state.type?He().A.state:void 0})),[]),h=(0,Fn()._)({name:"collection_synced_database_salesforce_workspace",spaceId:null==g?void 0:g.id,userId:i.currentUser.id}),b=(0,n.useMemo)((()=>h&&!(0,xn().e2)(h)),[h]),j=d?zo().l[d]:"",w=(0,s().K8)((()=>{const e=(0,Ft().q3)(a.error,m);return e?{title:o.formatMessage(e.title),description:o.formatMessage(e.description)}:null}),[a,o,m]);return(0,z.jsxs)(C().A,{...e,title:d,handleClose:()=>{R().os({collectionSettingsStore:r})},children:[b?(0,z.jsx)(x().A,{disableMobileBorders:!0,extraPadding:!0,disableDesktopPadding:!0,children:(0,z.jsx)(bn().z,{featureName:"collection_synced_database_salesforce_workspace",source:"collection_synced_database",collectionContextStore:u})}):w?(0,z.jsx)(x().A,{disableMobileBorders:!0,extraPadding:!0,disableDesktopPadding:!0,children:(0,z.jsx)("div",{style:p.menuItemDefaultPadding,children:(0,z.jsx)(Lt,{...w})})}):void 0,(0,z.jsxs)(x().A,{disableMobileBorders:!0,disableDesktopPadding:!0,extraPadding:!0,title:(0,z.jsx)(v().sA,{...En.SourceHeading}),children:[(0,z.jsx)("div",{style:p.menuItemDefaultPadding,children:(0,z.jsx)(Ut().C,{integrationIconUrl:j,spaceStore:g,flowId:S,captionText:(0,z.jsx)(v().sA,{defaultMessage:"Link your Salesforce account to continue",id:"database.viewSettings.collectionSettingsExternalSource.connectToSalesforce.description"}),renderActions:e=>{var t;if("connected"===e)return(0,z.jsx)(M().A,{colorPalette:"blue",style:{marginTop:8,marginInlineEnd:0,marginBottom:8,marginInlineStart:0,width:"100%"},onClick:()=>{R().os({collectionSettingsStore:r}),(0,y().u)({environment:i,event:{eventName:"salesforce_actions",eventProperties:{integrationId:vt().mn,actionType:"salesforce_manual_report_sync",collectionId:null==c?void 0:c.id,flowId:S}}}),Dn().X9({environment:i,collectionStore:c,from:"collection_settings_external_source"})},disabled:!(null!=a&&a.synced_collection_external_url)||!0===(null==a||null===(t=a.sync_state)||void 0===t?void 0:t.syncing)||"in_progress"===(null==f?void 0:f.status)||b,children:(0,z.jsx)(v().sA,{defaultMessage:"Sync now",id:"database.viewSettings.collectionSettingsExternalSource.syncNow"})})},from:"collection_settings_external_source"})}),null!=a&&null!==(t=a.sync_state)&&void 0!==t&&t.last_synced_at?(0,z.jsx)(Cn().A,{style:{margin:0},caption:(0,z.jsx)(v().sA,{...En.collectionSettingsExternalSourceLastSynced,values:{lastSyncedAt:`${(0,pn().jE)(a.sync_state.last_synced_at,cn().locale,o)}`}})}):void 0]}),(0,z.jsxs)(x().A,{topBorder:!0,extraPadding:!0,children:[(0,z.jsx)(Rt().p,{}),(0,z.jsx)(Rt().b,{})]})]})}function Nn(e){var t,o,i,r,a,c,d,u,p;const{collectionSettingsStore:g,collectionContextStore:m,externalCollectionFormat:S,propertySchema:f,externalCollectionType:h,currentCollectionStore:b,externalSyncStore:j,openedFrom:w}=e,{bot_id:A}=S,I=(0,v().tz)(),_=$n(),T=(0,l().v3)(),k=(0,s().O$)(ze().AppStoreSidebarSpaceStore),M="DataCenter"===((null==S?void 0:S.synced_collection_instance_type)??"Cloud")?"jira-dc":"jira",P="jira-dc"===M?"collection_synced_database_jira_datacenter":"collection_synced_database_jira",B=(0,Vn().uF)({featureName:P,collectionStore:b}),V=(0,s().K8)((()=>b.getSchema()),[b]),F=h?zo().l[h]:"",D=(0,s().K8)((()=>{const e=m.collectionViewBlockStore();return(0,bo().k7)(e,(0,Co().UJ)(null==S?void 0:S.app_config_uri)?null==f?void 0:f[un().K4.ProjectToTaskRelation]:null==f?void 0:f[un().yx.TaskToProjectRelation])}),[m,f,S]),E=(0,s().K8)((()=>jo().Ay.getFlowId()),[]),O=(0,s().K8)((()=>Boolean(Ge().A.externalAuthentications.state.find((e=>e.id===(null==S?void 0:S.bot_id)&&e.user_id===T.currentUser.id)))),[S,T]),K=(0,s().K8)((()=>{const e=Ge().A.externalAuthentications.state.find((e=>e.id===A));return null==e?void 0:e.account_name}),[A]),N=(0,s().K8)((()=>(0,Bn().fo)({collectionStore:b})),[b]),L=(0,s().K8)((()=>{if(A&&k){const e=ko().v.createChildStore(k,{table:Oo().GP,id:A,spaceId:k.id});return!e.isDefined()||Boolean(e.getAlive())}return!0}),[A,k]),W=L&&(null==S||null===(t=S.error)||void 0===t?void 0:t.status_code),$=(0,n.useMemo)((()=>{var e;switch(null==S||null===(e=S.error)||void 0===e||null===(e=e.metadata)||void 0===e?void 0:e.reason){case"NO_PERMISSION_TO_GET_USER":return(0,z.jsx)(v().sA,{...En.collectionSettingsSyncFailedNoPermissionToGetUser,values:{jiraAccountName:K}});case"NO_PERMISSION_TO_GET_ISSUES":case"NO_PERMISSION_TO_GET_PROJECTS":return(0,z.jsx)(v().sA,{...En.collectionSettingsSyncFailedNoPermissionToGetProjects,values:{jiraAccountName:K}});case"NO_PERMISSION_TO_REGISTER_SYSTEM_WEBHOOK":return(0,z.jsx)(v().sA,{...En.collectionSettingsSyncFailedNoPermissionToRegisterWebhook,values:{jiraAccountName:K}});case"JIRA_CLOUD_SUBSCRIPTION_EXPIRED":return(0,z.jsx)(v().sA,{...En.collectionSettingsSyncFailedJiraCloudSubscriptionExpired,values:{jiraAccountName:K}});default:return(0,z.jsx)(v().sA,{...En.collectionSettingsSyncFailedTemporary})}}),[S,K]),G=(0,s().K8)((()=>{var e;if(null==S||null===(e=S.sync_state)||void 0===e||!e.last_synced_at)return null;const t=function(e){var t;const o={},n=(null===(t=$e().default.getConfig({configName:"jira_properties_options_limit"}))||void 0===t?void 0:t.optionsLimit)??1e3;for(const[r,l]of Object.entries(e))if(l&&("select"===l.type||"multi_select"===l.type)){var i;((null===(i=l.options)||void 0===i?void 0:i.length)??0)>=n&&(o[r]=l.name??r)}return o}(V);if(0===Object.keys(t).length)return null;const o=Object.values(t);return(0,z.jsx)(Gn,{propertyNames:o,styles:_.syncFailedText})}),[null==S||null===(o=S.sync_state)||void 0===o?void 0:o.last_synced_at,V,_.syncFailedText]),{site:Q,associatedBotId:q}=(0,s().K8)((()=>({site:null==S?void 0:S.synced_collection_external_url,associatedBotId:null==S?void 0:S.bot_id})),[S]),Y=(0,s().K8)((()=>{var e;if(!A||!L||!Ge().A.getState().loaded)return!1;const t=Ge().A.externalEntitiesStore.state.find((e=>e.getBotId()===A));return!0===(null==t||null===(e=t.getMetainfo())||void 0===e?void 0:e.isScopedToken)}),[A,L]),X=(0,s().K8)((()=>{var e;return(null===(e=$e().default.getConfig({configName:"jira_sync_time_filter_warning_deadline"}))||void 0===e?void 0:e.deadline)??"September 30, 2025"}),[]),J=(0,U().X)("jira_sync_show_filter_warning"),Z=(0,s().K8)((()=>{var e;return!J||null!=S&&null!==(e=S.sync_state)&&void 0!==e&&e.filter_config?null:(0,z.jsxs)("div",{style:_.syncFailedText,children:[(0,z.jsx)(v().sA,{...En.collectionSettingsSyncFailedNoTimeFilter,values:{deadline:X,timeFilter:"default one-year time filter",bold:e=>(0,z.jsx)("span",{style:{fontWeight:We().Wy.semibold},children:e})}}),(0,z.jsx)(dn().E,{colorPalette:"blue",onClick:()=>{R().a2({collectionSettingsStore:g,item:{type:"externalProjectsSyncSettings",source:"external_list_filters",action:ae().Sh.SyncAdditionalProperties,selectedProjectKeys:[],selectedProperties:[]}}),(0,y().u)({environment:T,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:M,actionType:"select_filters_cta_click",flowId:E,identifier:Q,botId:q,collectionId:b.id,isSyncOwner:O}}})},style:_.addFilterButton,iconLeading:fn().filterIcon,children:(0,z.jsx)(v().sA,{defaultMessage:"Add Filter",id:"database.viewSettings.collectionSettingsExternalSource.addFilters"})})]})}),[J,null==S||null===(i=S.sync_state)||void 0===i?void 0:i.filter_config,_.syncFailedText,Q,q,b.id,O,g,E,T,M,_.addFilterButton,X]);if(!D)return null;const ee=(0,Co().UJ)(null==S?void 0:S.app_config_uri),te=Boolean((null==S?void 0:S.sync_state)&&(null==S||null===(r=S.sync_state)||void 0===r?void 0:r.last_synced_at));return(0,z.jsxs)(C().A,{...e,title:I.formatMessage(En.CollectionSettingsExternalSourceTitle),desktopWidth:320,fullHeight:!0,handleClose:()=>{jo().Ay.setState({...jo().Ay.state,projectKeys:[]}),R().os({collectionSettingsStore:g})},children:[(0,z.jsxs)("div",{style:{padding:"0px 4px"},children:[(0,z.jsx)(bn().z,{featureName:P,source:"collection_synced_database",collectionContextStore:m}),N?(0,z.jsxs)(z.Fragment,{children:[null!=B&&B.isAvailable&&!B.expirationDate?(0,z.jsx)(Mn,{integrationIconUrl:F,currentSpaceStore:k}):null,(0,z.jsx)(In,{taskCollectionStore:ee?D:b,projectCollectionStore:ee?b:D,externalSyncStore:j,spaceStore:k,isActiveSync:L,isSyncing:Boolean(null==S||null===(a=S.sync_state)||void 0===a?void 0:a.syncing),openedFrom:w})]}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(x().A,{disableMobileBorders:!0,children:(0,z.jsx)("div",{style:_.collectionSettingsExternalSourceTitle,children:(0,z.jsx)(v().sA,{...En.JiraSyncExternalSourceDescription})})}),(0,z.jsx)("div",{style:_.preview,children:zn({projectCollectionStore:ee?b:D,taskCollectionStore:ee?D:b,integrationIconUrl:F})})]})]}),(0,z.jsx)("div",{style:_.insetDividerContainer,children:(0,z.jsx)(ne().A,{size:1})}),(0,z.jsxs)(x().A,{title:(0,z.jsx)(v().sA,{...En.SourceHeading}),children:[(0,z.jsx)("div",{style:_.siteButtonContainer,children:(0,z.jsx)(ct().Ay,{style:_.siteButton,disallowTabbing:!0,disabled:!0,children:(0,z.jsxs)("div",{style:_.siteButtonTextContainer,children:[(0,z.jsx)("img",{style:_.siteIcon,src:F,alt:""}),(0,z.jsxs)("div",{style:_.siteTextColumn,children:[(0,z.jsx)("span",{style:_.siteNameText,children:(0,Bo().A)((0,Co().ay)((null==S?void 0:S.synced_collection_external_url)||""))}),(0,z.jsx)("span",{style:_.siteNameSecondaryText,children:null==S?void 0:S.synced_collection_external_url})]})]})})}),!(L&&null!=B&&B.isAvailable&&null!=S&&null!==(c=S.sync_state)&&void 0!==c&&c.last_synced_at)||null!=S&&null!==(d=S.sync_state)&&void 0!==d&&d.syncing||null!=S&&null!==(u=S.error)&&void 0!==u&&null!==(u=u.metadata)&&void 0!==u&&u.reason?void 0:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{style:{..._.lastSyncText,marginInlineStart:8},children:(0,z.jsx)(v().sA,{...En.collectionSettingsExternalSourceLastSynced,values:{lastSyncedAt:`${(0,pn().jE)(S.sync_state.last_synced_at,cn().locale,I)}`}})}),G,Z]}),L&&null!=S&&null!==(p=S.sync_state)&&void 0!==p&&p.syncing?(0,z.jsx)("div",{style:{..._.lastSyncText,marginInlineStart:8},children:(0,z.jsx)(v().sA,{...En.collectionSettingsSyncInProgress,values:{integration:(0,Bo().A)(null==S?void 0:S.external_collection_type)}})}):void 0,W?(0,z.jsxs)("div",{style:_.syncFailedRow,children:[(0,z.jsx)(Un,{hasSyncFailed:!0,isSyncing:!1,integrationIconSrcUrl:F}),(0,z.jsx)("div",{style:_.syncFailedTextInRow,children:$})]}):void 0,Y?(0,z.jsx)("div",{style:_.syncFailedRow,children:(0,z.jsx)("div",{style:_.syncFailedTextInRow,children:(0,z.jsx)(v().sA,{...En.scopedTokenNoLiveUpdates})})}):null,L?void 0:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)("div",{style:_.syncFailedRow,children:[(0,z.jsx)(H().I,{icon:mn().i,colorPalette:"yellow",colorVariant:"accentPrimary"}),(0,z.jsx)("div",{style:_.reauthSyncFailedText,children:(0,z.jsx)(v().sA,{...En.collectionSettingsSyncFailed})})]}),(0,z.jsx)(dn().E,{colorPalette:"blue",onClick:()=>{vn().j({environment:T,from:"collection_settings_external_source",action:"add_account"})},style:_.reconnectButton,children:(0,z.jsx)(v().sA,{...En.reconnectButtonText})})]})]}),(0,z.jsx)("div",{style:_.insetDividerContainer,children:(0,z.jsx)(ne().A,{size:1})}),(0,z.jsx)(Wn,{taskCollectionStore:ee?D:b,collectionSettingsStore:g,isSetupComplete:te,flowId:E,isSyncOwner:O,isActiveSync:L,upsellInfo:B}),(0,z.jsx)("div",{style:{marginTop:12,marginInlineStart:12,marginInlineEnd:12},children:(0,z.jsx)(ne().A,{size:1})}),(0,z.jsx)(Po().N,{style:{display:"flex",marginInlineStart:4,marginInlineEnd:4},className:"notion-print-ignore",href:(0,Lo().x)("guides.externalImportAndSync"),external:!0,onClick:()=>{(0,y().u)({environment:T,event:{eventName:"external_sync_setup_action",eventProperties:{integration:M,actionType:"learn_more_cta_click",flowId:E,collectionId:ee?D.id:b.id,botId:null==S?void 0:S.bot_id,identifier:null==S?void 0:S.synced_collection_external_url,isSyncOwner:O}}})},children:(0,z.jsx)(he().p,{iconLeading:{icon:Eo().questionMarkCircleSmallIcon,size:"sm"},colorPalette:"gray",style:_.learnMoreText,children:(0,z.jsx)(v().sA,{...En.collectionSettingsJiraSyncHelpLink})})})]})}function zn(e){const{projectCollectionStore:t,taskCollectionStore:o,integrationIconUrl:n}=e,i=(0,h().eP)(),r=(0,h().IS)((()=>({iconContainer:{display:"flex",alignItems:"center"},sourceIcon:{width:26,height:26,padding:5,borderRadius:6,gap:10,borderColor:O().Tj.border.primary,borderStyle:"solid",borderWidth:1,boxShadow:"0px 2px 4px 0px #161D1B05",..."dark"!==i&&{background:`linear-gradient(0deg, ${O().Tj.text.inversePrimary}, ${O().Tj.text.inversePrimary})`}},taskArrow:{width:87,height:26,top:26},projectArrow:{width:87,height:26,top:2,border:1},arrowContainer:{display:"flex",flexFlow:"column",justifyContent:"center"},collectionIconContainer:{display:"flex",flexFlow:"column",justifyContent:"space-around",gap:12},collectionIcon:{width:88,paddingTop:4,paddingInlineEnd:6,paddingBottom:6,paddingInlineStart:6,borderRadius:6,gap:6,display:"flex",alignItems:"center",borderColor:O().Tj.border.primary,borderWidth:1,borderStyle:"solid",..."dark"!==i&&{background:`linear-gradient(0deg, ${O().Tj.text.inversePrimary}, ${O().Tj.text.inversePrimary})`}},title:{fontSize:On,fontWeight:We().Wy.medium,lineHeight:"16px",letterSpacing:0,color:O().Tj.text.primary}})),[i]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{style:r.iconContainer,children:Ln({iconStyle:r.sourceIcon,srcUrl:n})}),(0,z.jsxs)("div",{style:r.arrowContainer,children:[Ln({iconStyle:r.projectArrow,srcUrl:Zt().A.images.externalIntegrations.externalAppToProjectsArrowPng}),Ln({iconStyle:r.taskArrow,srcUrl:Zt().A.images.externalIntegrations.externalAppToTasksArrowPng})]}),(0,z.jsxs)("div",{style:r.collectionIconContainer,children:[(0,z.jsxs)("div",{style:r.collectionIcon,children:[Hn(hn().R,n),(0,z.jsx)(jn().A,{store:t,style:r.title})]}),(0,z.jsxs)("div",{style:r.collectionIcon,children:[Hn(yn().i,n),(0,z.jsx)(jn().A,{store:o,style:r.title})]})]})]})}function Ln(e){const{iconStyle:t,srcUrl:o,altString:n}=e;return(0,z.jsx)("img",{style:t,src:o,alt:n})}function Un(e){const{hasSyncFailed:t,isSyncing:o,integrationIconSrcUrl:n,altString:i}=e,r=(0,h().IS)((()=>({syncIcon:{display:"block",position:"relative",alignSelf:"flex-start",color:t?O().Tj.yellow.icon.accentPrimary:O().Tj.blue.icon.accentPrimary}})),[t]);return t?(0,z.jsx)(H().I,{icon:mn().i,style:r.syncIcon}):o?(0,z.jsx)(H().I,{icon:gn().a,style:r.syncIcon}):(0,z.jsx)("img",{style:r.syncIcon,src:n,alt:i})}function Wn({taskCollectionStore:e,collectionSettingsStore:t,isSetupComplete:o,flowId:n,isSyncOwner:i,isActiveSync:r,upsellInfo:a}){const c=(0,l().v3)(),d=(0,v().tz)(),u=(0,s().K8)((()=>e.getSchema()),[e]),p=(0,s().K8)((()=>{var t;return null===(t=e.getFormat().sync_state)||void 0===t?void 0:t.syncing}),[e]),g=(0,s().O$)(ze().AppStoreSidebarSpaceStore),m=(0,s().K8)((()=>e.getFormat().bot_id),[e]),S=(0,s().K8)((()=>e.getFormat().synced_collection_external_url),[e]),f=(0,s().K8)((()=>(0,Pn().p)(g)),[g]),h=(0,s().K8)((()=>(0,Co().Zf)()),[]),b=(0,s().K8)((()=>(0,Co().X7)()),[]),C=(0,s().K8)((()=>e.getFormat().synced_collection_instance_type),[e]),j="DataCenter"===C?"jira-dc":"jira",w=!(null!=a&&a.isAvailable),A=(0,s().K8)((()=>{var t;return null===(t=e.getFormat().sync_state)||void 0===t?void 0:t.filter_config}),[e]),I=(0,s().K8)((()=>(0,Co().yX)()),[])&&!f&&"Cloud"===C||"DataCenter"===C&&(!b||!f&&!h);let _=0;for(const l in u){var T;null!==(T=u[l])&&void 0!==T&&T.derived_property_record_metadata&&_++}let k=d.formatMessage(En.accountDisconnectedTooltip);return Boolean(p)?k=d.formatMessage(En.importInProgressToolTip):I?k=d.formatMessage(En.jiraSyncSourceDisabledTooltip):w&&null!=a&&a.upsellTier&&(k=d.formatMessage(En.featureUnavailableTooltip,{upsellTier:a.upsellTier})),o?(0,z.jsx)(x().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Data synced from Jira",id:"database.viewSettings.collectionSettingsExternalSource.titleStringForSyncedData"}),children:(0,z.jsx)(Ye().m,{disableTooltip:!Boolean(p)&&r&&!I&&!w,renderTooltip:e=>(0,z.jsx)("div",{...e,style:ut().Q$,children:k}),render:o=>(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(so().A,{...o,icon:hn().R,disabled:Boolean(p)||!r||I||w,onClick:()=>{R().a2({collectionSettingsStore:t,item:{type:"externalProjectsSyncSettings",source:"external_list_projects"}}),(0,y().u)({environment:c,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:j,actionType:"select_projects_cta_click",flowId:n,identifier:S,botId:m,collectionId:e.id,isSyncOwner:i}}})},showChevron:!0,title:(0,z.jsx)(v().sA,{defaultMessage:"Projects",id:"database.viewSettings.collectionSettingsExternalSource.projects"})}),(0,z.jsx)(so().A,{...o,icon:Sn().n,disabled:Boolean(p)||!r||I||w,onClick:()=>{R().a2({collectionSettingsStore:t,item:{type:"externalProjectsSyncSettings",source:"external_list_task_properties",action:ae().Sh.SyncAdditionalProperties,selectedProjectKeys:[],projectIssueCounts:{}}}),(0,y().u)({environment:c,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:j,actionType:"select_properties_cta_click",flowId:n,identifier:S,botId:m,collectionId:e.id,isSyncOwner:i}}})},right:(0,z.jsx)(v().sA,{id:"database.viewSettings.collectionSettingsExternalSource.syncedPropertiesCount",defaultMessage:"{syncedPropertiesCountString}",values:{syncedPropertiesCountString:_.toString()}}),showChevron:!0,title:(0,z.jsx)(v().sA,{defaultMessage:"Task Properties",id:"database.viewSettings.collectionSettingsExternalSource.taskProperties"})}),A?(0,z.jsx)(so().A,{...o,icon:fn().filterIcon,disabled:Boolean(p)||!r||I||w,onClick:()=>{R().a2({collectionSettingsStore:t,item:{type:"externalProjectsSyncSettings",source:"external_list_filters",action:ae().Sh.SyncAdditionalProperties,selectedProjectKeys:[],selectedProperties:[]}}),(0,y().u)({environment:c,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:j,actionType:"select_filters_cta_click",flowId:n,identifier:S,botId:m,collectionId:e.id,isSyncOwner:i}}})},showChevron:!0,title:(0,z.jsx)(v().sA,{defaultMessage:"Filters",id:"database.viewSettings.collectionSettingsExternalSource.filters"})}):void 0]})})}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(x().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Step 1",id:"database.viewSettings.collectionSettingsExternalSource.setupProjects"}),children:(0,z.jsx)("div",{style:{margin:"6px 14px 0px"},children:(0,z.jsx)(M().A,{colorPalette:"blue",style:{width:"100%"},onClick:()=>{R().a2({collectionSettingsStore:t,item:{type:"externalProjectsSyncSettings",source:"external_list_projects"}}),(0,y().u)({environment:c,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:j,actionType:"select_projects_cta_click",flowId:n,identifier:S,botId:m,collectionId:e.id,isSyncOwner:i}}})},disabled:I,children:(0,z.jsx)(v().sA,{defaultMessage:"Select projects to sync",id:"database.viewSettings.collectionSettingsExternalSource.syncProjectsButton"})})})}),(0,z.jsx)(x().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Step 2",id:"database.viewSettings.collectionSettingsExternalSource.setupProperties"}),children:(0,z.jsx)("div",{style:{margin:"6px 14px 0px"},children:(0,z.jsx)(M().A,{colorPalette:"blue",style:{width:"100%"},disabled:!0,children:(0,z.jsx)(v().sA,{defaultMessage:"Select properties to sync",id:"database.viewSettings.collectionSettingsExternalSource.syncPropertiesButton"})})})})]})}function Hn(e,t){const o=(0,h().eP)(),n=(0,h().IS)((()=>({sourceIcon:{width:10,height:10,padding:2,borderRadius:3,gap:10,position:"absolute",borderColor:O().Tj.border.primary,borderStyle:"solid",borderWidth:1,insetInlineEnd:-3,bottom:-3,boxShadow:"0px 2px 4px 0px #161D1B05",..."light"===o&&{background:`linear-gradient(0deg, ${O().Tj.text.inversePrimary}, ${O().Tj.text.inversePrimary})`},display:"flex",alignItems:"center",justifyContent:"center"},baseIcon:{height:D().Ev.sm,width:D().Ev.sm,color:O().Tj.icon.secondary},overlayIntegrationIcon:{height:5,width:5}})),[o]);return(0,z.jsxs)("div",{style:{position:"relative"},children:[e(n.baseIcon,void 0,void 0,"all"),(0,z.jsx)("div",{style:n.sourceIcon,children:Ln({iconStyle:n.overlayIntegrationIcon,srcUrl:t})})]})}function $n(){return(0,h().IS)((()=>({collectionSettingsExternalSourceTitle:{fontSize:f().A.isMobile?14:12,color:O().Tj.text.secondary},preview:{paddingTop:12,paddingInlineEnd:36,paddingBottom:12,paddingInlineStart:30,background:O().Tj.background.secondary,display:"flex",justifyContent:"flex-start",marginInlineStart:14,marginInlineEnd:14,borderRadius:6,marginBottom:24},container:{marginInlineStart:12,marginInlineEnd:12},insetDividerContainer:{marginTop:12,marginBottom:12,marginInlineStart:12,marginInlineEnd:12},lastSyncText:{fontSize:f().A.isMobile?14:12,color:O().Tj.text.secondary,fontWeight:We().Wy.regular,textAlign:"start",lineHeight:"16px",marginTop:6},syncFailedRow:{display:"flex",alignItems:"center",gap:8,marginInlineStart:8,marginTop:6},syncFailedText:{fontSize:f().A.isMobile?14:12,fontWeight:We().Wy.regular,textAlign:"start",marginInlineStart:8,lineHeight:"16px",marginBottom:6,marginTop:6,color:O().Tj.yellow.icon.accentPrimary},syncFailedTextInRow:{fontSize:f().A.isMobile?14:12,fontWeight:We().Wy.regular,textAlign:"start",marginInlineStart:0,lineHeight:"16px",color:O().Tj.yellow.icon.accentPrimary},reauthSyncFailedText:{fontSize:f().A.isMobile?14:12,fontWeight:We().Wy.regular,textAlign:"start",marginInlineStart:0,lineHeight:"16px",marginBottom:6,marginTop:6,color:O().Tj.yellow.icon.accentPrimary},reconnectButton:{width:"-webkit-fill-available",marginInlineStart:8,marginInlineEnd:8,marginTop:8,gap:4,fontWeight:We().Wy.medium,padding:16},addFilterButton:{width:"-webkit-fill-available",marginTop:8,gap:4},captionText:{fontSize:f().A.isMobile?14:12,color:O().Tj.text.secondary,fontWeight:We().Wy.regular,textAlign:"start"},sourceSectionTitle:{textAlign:"start",color:O().Tj.text.secondary,paddingTop:0,paddingInlineStart:4,paddingInlineEnd:4},siteButtonContainer:{margin:"0px 8px",gap:2,borderRadius:6,borderStyle:"solid",borderWidth:1,borderColor:O().Tj.border.secondary},siteButton:{padding:"8px",borderRadius:6,display:"flex",width:"100%"},siteButtonTextContainer:{gap:8,display:"flex",alignItems:"flex-start"},siteTextColumn:{display:"flex",flexFlow:"column",gap:1,flex:1,minWidth:0},siteIcon:{width:20,height:20,display:"block",alignSelf:"flex-start",padding:2},siteNameText:{fontSize:f().A.isMobile?16:14,fontWeight:We().Wy.medium,lineHeight:"20px",letterSpacing:"0.15px",color:O().Tj.text.primary,paddingTop:1},siteNameSecondaryText:{fontSize:f().A.isMobile?14:12,color:O().Tj.text.secondary,fontWeight:We().Wy.regular,textAlign:"start",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",lineHeight:f().A.isMobile?"20px":"16px"},lockedIcon:{width:14,height:14,color:O().Tj.icon.secondary},emptyViewWrap:{paddingBlockEnd:42,paddingInline:12},wrap:{display:"flex",flexDirection:"column"},showMoreButtonContainer:{marginInlineStart:12,marginBottom:12,marginInlineEnd:"auto"},showMoreButtonContent:{fontSize:12},noResultsTitle:{color:O().Tj.text.secondary,fontSize:12,margin:0},learnMoreText:{width:"100%",paddingInlineStart:8,paddingInlineEnd:8,color:O().Tj.text.secondary,paddingTop:16,paddingBottom:16,marginTop:4,marginBottom:4},menuItemDefaultPadding:{paddingInlineStart:8,paddingInlineEnd:8}})),[])}function Gn({propertyNames:e,styles:t}){let o="";return o=1===e.length?e[0]:`${e[0]} and ${e.length-1} other`,(0,z.jsx)("div",{style:t,children:(0,z.jsx)(v().sA,{...En.propertyLimitWarning,values:{propertyNames:o,fieldFields:1===e.length?"field":"fields"}})})}function Qn(e){const{collectionSettingsStore:t,collectionContextStore:o,tabSettings:n}=e;if("external_source"===n.source)return(0,z.jsx)(Rn,{...e,collectionSettingsStore:t,collectionContextStore:o,openedFrom:n.openedFrom});if("external_list_projects"===n.source)return(0,z.jsx)(Go,{collectionSettingsStore:t,collectionContextStore:o});if("external_list_task_properties"===n.source){const{action:e,selectedProjectKeys:i,projectIssueCounts:r}=n;return(0,z.jsx)(ln,{collectionSettingsStore:t,collectionContextStore:o,action:e,selectedProjectKeys:i,projectIssueCounts:r})}if("external_list_filters"===n.source){const{action:e,selectedProjectKeys:i,selectedProperties:r}=n;return(0,z.jsx)(Ao,{collectionSettingsStore:t,collectionContextStore:o,action:e,selectedProjectKeys:i,selectedProperties:r})}return null}var qn=()=>o(906745),Yn=()=>o(127833),Xn=()=>o(443191),Jn=()=>o(274570),Zn=()=>o(62616),ei=()=>o(675326),ti=()=>o(18953),oi=()=>o(406533);const ni={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.76 13.75",svg:(0,z.jsx)("path",{d:"M3.75 13.136c.345 0 .625.28.625.625v.989c0 .483.392.875.875.875h.99a.625.625 0 1 1 0 1.25h-.99a2.125 2.125 0 0 1-2.125-2.125v-.99c0-.344.28-.624.625-.624m7.24 2.489a.625.625 0 0 1 0 1.25H9.01a.625.625 0 1 1 0-1.25zm5.26-2.489c.345 0 .625.28.625.625v.989a2.125 2.125 0 0 1-2.125 2.125h-.99a.625.625 0 0 1 0-1.25h.99a.875.875 0 0 0 .875-.875v-.99c0-.344.28-.624.625-.624m-4.446-5.797a.625.625 0 0 1 1.072.642l-3 5a.626.626 0 0 1-1.01.085l-2-2.333a.625.625 0 0 1 .948-.813l1.436 1.675zM3.75 8.386c.345 0 .625.28.625.625v1.978a.625.625 0 0 1-1.25 0V9.011c0-.345.28-.625.625-.625m12.5 0c.345 0 .625.28.625.625v1.978a.625.625 0 0 1-1.25 0V9.011c0-.345.28-.625.625-.625M6.24 3.125a.625.625 0 1 1 0 1.25h-.99a.875.875 0 0 0-.875.875v.99a.625.625 0 1 1-1.25 0v-.99c0-1.174.951-2.125 2.125-2.125zm8.51 0c1.174 0 2.125.951 2.125 2.125v.99a.625.625 0 1 1-1.25 0v-.99a.875.875 0 0 0-.875-.875h-.99a.625.625 0 0 1 0-1.25zm-3.76 0a.625.625 0 0 1 0 1.25H9.01a.625.625 0 1 1 0-1.25z"})},ii=(0,D().wt)("squareDashedCheck",ni,"default");var ri=()=>o(42583),li=()=>o(781697),ai=()=>o(916727),si=()=>o(295633),ci=()=>o(799829),di=()=>o(179034),ui=()=>o(950914),pi=()=>o(201980),gi=()=>o(634054),mi=()=>o(778708);var Si=()=>o(96689),yi=()=>o(854150),fi=()=>o(235059),hi=()=>o(601734);const xi="https://www.notion.so/help/sprints",vi=[1,2,3,4,5,6,7,8],bi={1:{key:"one_week",value:1},2:{key:"two_weeks",value:2},3:{key:"three_weeks",value:3},4:{key:"four_weeks",value:4},5:{key:"five_weeks",value:5},6:{key:"six_weeks",value:6},7:{key:"seven_weeks",value:7},8:{key:"eight_weeks",value:8}},Ci={MO:"Monday",TU:"Tuesday",WE:"Wednesday",TH:"Thursday",FR:"Friday",SA:"Saturday",SU:"Sunday"},ji=(0,v().YK)({sprintsMenuTitle:{id:"sprintSettingsMenu.label",defaultMessage:"Sprints"},setupSprintsTitle:{id:"sprintSettingsMenu.setupSprints.label",defaultMessage:"Set up sprints"},setupSprintsCaption:{id:"sprintSettingsMenu.setupSprints.caption",defaultMessage:"Use sprints to regularly tackle a group of tasks in a recurring, set amount of time."},setupSprintsTeamspaceStatement:{id:"sprintSettingsMenu.setupSprintsTeamspaceStatement.caption",defaultMessage:"Weâ€™ll also add to your teamspace:"},setupSprintsSprintBoardPageStatement:{id:"sprintSettingsMenu.setupSprintsSprintBoardPageStatement.caption",defaultMessage:"<bold>Sprint board</bold>: To manage tasks and plan your work"},setupSprintsSprintsDatabaseStatement:{id:"sprintSettingsMenu.setupSprintsSprintsDatabaseStatement.caption",defaultMessage:"<bold>Sprints database</bold>: To keep a historical record of what you accomplished"},manual:{id:"sprintSettingsMenu.manual.label",defaultMessage:"Manual"},automatic:{id:"sprintSettingsMenu.automatic.label",defaultMessage:"Auto"},off:{id:"sprintSettingsMenu.off.label",defaultMessage:"Off"},completeSprintNextSprintActionMenuOptionText:{id:"sprintSettingsMenu.remainingTasks.moveToNextSprintOption.label",defaultMessage:"Move to next sprint"},completeSprintNextSprintActionSelectedText:{id:"sprintSettingsMenu.remainingTasks.moveToNextSprintOption.selected.label",defaultMessage:"Next sprint"},completeSprintBacklogActionMenuOptionText:{id:"sprintSettingsMenu.remainingTasks.moveToBacklogOption.label",defaultMessage:"Move to backlog"},completeSprintBacklogActionSelectedText:{id:"sprintSettingsMenu.remainingTasks.moveToBacklogOption.selected.label",defaultMessage:"Backlog"},completeSprintKeepInCurrentSprintActionMenuOptionText:{id:"sprintSettingsMenu.remainingTasks.keepInCurrentSprint.label",defaultMessage:"Keep in current sprint"},completeSprintKeepInCurrentSprintActionSelectedText:{id:"sprintSettingsMenu.remainingTasks.keepInCurrentSprint.selected.label",defaultMessage:"Current sprint"},automatedSprintsToggleTitle:{id:"sprintSettingsMenu.automatedSprintsToggle.label",defaultMessage:"Automated sprints"},automatedSprintsToggleCaption:{id:"sprintSettingsMenu.automatedSprintsToggle.caption",defaultMessage:"Sprints complete automatically before the start of the next sprint."},duration:{id:"sprintSettingsMenu.duration.label",defaultMessage:"Duration"},durationMenuOptionText:{id:"sprintSettingsMenu.duration.option.label",defaultMessage:"{durationValue, plural, one {1 week} other {{durationValue} weeks}}"},startOn:{id:"sprintSettingsMenu.startOn.label",defaultMessage:"Start on"},weekdayOption:{id:"sprintSettings.weekdayOption.label",defaultMessage:"{weekdayName}s"},incompleteTasks:{id:"sprintSettingsMenu.incompleteTasks.label",defaultMessage:"Incomplete tasks"},turnOnSprints:{id:"sprintSettingsMenu.turnOnSprints.button.label",defaultMessage:"Turn on sprints"},turnOffSprints:{id:"sprintSettingsMenu.turnOffSprints.button.label",defaultMessage:"Turn off sprints"},turnOffSprintsModalTitle:{id:"sprintSettingsMenu.turnOffSprints.modal.title.label",defaultMessage:"Turn off sprints?"},turnOffSprintsModalNoSprintBoardsDescription:{id:"sprintSettingsMenu.turnOffSprints.modal.default.description",defaultMessage:"This will delete your sprints database and its linked views."},turnOffSprintsModalWithSprintBoardsDescription:{id:"sprintSettingsMenu.turnOffSprints.modal.withSprintBoards.description",defaultMessage:"This will delete your sprint board(s), sprints database and its linked views."},turnOffAndDeleteModalButton:{id:"sprintSettingsMenu.turnOffAndDeleteModal.button.label",defaultMessage:"Turn off and delete"},learnSprintsTitle:{id:"sprintSettingsMenu.learnSprints.button.label",defaultMessage:"Learn about sprints"},manageSprintFromThisView:{id:"sprintSettingsMenu.manageSprintFromThisView.label",defaultMessage:"Manage sprint from this view"},manageSprintFromThisViewModalTitle:{id:"sprintSettingsMenu.manageSprintFromThisView.modal.title.label",defaultMessage:"Manage sprint from this view?"},manageSprintFromThisViewModalButton:{id:"sprintSettingsMenu.manageSprintFromThisView.button.label",defaultMessage:"Update view"},manageSprintFromThisViewModalAutomaticSprintCompletionDescription:{id:"sprintSettingsMenu.manageSprintFromThisView.modal.automaticSprintCompletion.description",defaultMessage:"The view will be updated with filters for the current sprint."},manageSprintFromThisViewModalManualSprintCompletionDescription:{id:"sprintSettingsMenu.manageSprintFromThisView.modal.manualSprintCompletion.description",defaultMessage:"The view will be updated with filters for the current sprint and a button to complete sprints will be displayed."},sprintStartDateToday:{id:"sprintSettingsMenu.sprintStartDateToday",defaultMessage:"Next sprint starts <time>today</time>}"},sprintStartDateFuture:{id:"sprintSettingsMenu.sprintStartDateFuture",defaultMessage:"Next sprint starts in {days} {days, plural, one {day} other {days}} <time>({formattedDate}</time>)"},sprintStartDateShouldStartPast:{id:"sprintSettingsMenu.sprintStartDateShouldStartPast",defaultMessage:"Next sprint should have started {days} {days, plural, one {day} other {days}} ago <time>({formattedDate})</time>"},sprintStartDateShouldStartToday:{id:"sprintSettingsMenu.sprintStartDateShouldStartToday",defaultMessage:"Next sprint should start <time>today</time>"},sprintStartDateShouldStartFuture:{id:"sprintSettingsMenu.sprintStartDateShouldStartFuture",defaultMessage:"Next sprint should start in {days} {days, plural, one {day} other {days}} <time>({formattedDate})</time>"}}),wi={complete_sprint_and_move_incomplete_tasks_to_next_sprint:{menuOptionText:ji.completeSprintNextSprintActionMenuOptionText,selectedText:ji.completeSprintNextSprintActionSelectedText},complete_sprint_and_move_incomplete_tasks_to_backlog:{menuOptionText:ji.completeSprintBacklogActionMenuOptionText,selectedText:ji.completeSprintBacklogActionSelectedText},complete_sprint:{menuOptionText:ji.completeSprintKeepInCurrentSprintActionMenuOptionText,selectedText:ji.completeSprintKeepInCurrentSprintActionSelectedText}};function Ai(e){return(0,z.jsx)(v().sA,{...wi[e.completeSprintAction].menuOptionText})}function Ii(e){return(0,z.jsx)(v().sA,{...wi[e.completeSprintAction].selectedText})}function _i(e){const{weekday:t}=e;return(0,z.jsx)(v().sA,{...ji.weekdayOption,values:{weekdayName:Ci[t]}})}function Ti(e){return bi[e]}function ki(e){const{sprintDurationValue:t}=e;return(0,z.jsx)(v().sA,{...ji.durationMenuOptionText,values:{durationValue:bi[t].value}})}function Mi(e){const{numOfSprintBoards:t}=e;return t>0?(0,z.jsx)(v().sA,{...ji.turnOffSprintsModalWithSprintBoardsDescription}):(0,z.jsx)(v().sA,{...ji.turnOffSprintsModalNoSprintBoardsDescription})}function Pi(e){const{automaticSprintCompletionEnabled:t}=e;return t?(0,z.jsx)(v().sA,{...ji.manageSprintFromThisViewModalAutomaticSprintCompletionDescription}):(0,z.jsx)(v().sA,{...ji.manageSprintFromThisViewModalManualSprintCompletionDescription})}function Bi(e){const{collectionContextStore:t,collectionSettingsStore:o,from:i}=e,{sprintSettingsConfig:r,currentSprintDateRange:a,sprintSettingsPermissionsContext:c,sprintSettingsConfigUpdater:d,turnOffSprints:u,turnOnSprints:p,automaticSprintCompletionEnabled:g,canManageSprintFromThisView:m,manageSprintFromThisView:S}=function(e){var t;const{collectionContextStore:o,from:i}=e,r=(0,l().v3)(),a=(0,s().K8)((()=>o.sprintSettingsContextStore.state),[o.sprintSettingsContextStore]),c=null==a?void 0:a.permissionsContext,d=(0,s().K8)((()=>{var e;return Boolean(null==a||null===(e=a.automationContext)||void 0===e?void 0:e.automationStore.isActive())}),[null==a||null===(t=a.automationContext)||void 0===t?void 0:t.automationStore]),u=(0,s().K8)((()=>{var e;return o.collectionStore()===(null==a?void 0:a.taskCollectionStore)&&(null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri)!==un().Lu}),[o,null==a?void 0:a.taskCollectionStore]),[p,g]=(0,n.useState)(void 0);(0,n.useEffect)((()=>{!async function(){if(g(void 0),!a)return;const{sprintCollectionViewBlockStore:e,sprintCollectionStore:t}=a;if(!e||!t)return;const o=t.getSchema(),n=ci().n$[un().av].current.reducer,i=await gi().mA(r,{source:"automation",parentRecordStore:e,collectionPointer:t.getSpaceShardedPointer(),filter:n.getCombinatorFilter(o),limit:1});it().Q.isFail(i)||g(i.value.blockIds[0])}()}),[r,a]);const m=(0,s().K8)((()=>{const e=null==a?void 0:a.sprintCollectionViewBlockStore;if(e&&p)return si().B.createChildStore(e,{id:p,table:di().ev,spaceId:e.getSpaceId()})}),[p,null==a?void 0:a.sprintCollectionViewBlockStore]),S=(0,s().K8)((()=>{if(!m)return;const e=m.getPropertyValue(un().Hx.Dates);if(!e)return;const t=(0,pi().Cok)(e)[0];return t&&"daterange"===t.type?t:void 0}),[m]),y=(0,s().K8)((()=>{var e,t,o;if(!a)return;const n=(null===(e=a.automationContext)||void 0===e||null===(e=e.automationActionStore.getConfig())||void 0===e?void 0:e.complete_sprint_action)??ui().AL.actionConfig.complete_sprint_action,i=Boolean(null===(t=a.automationContext)||void 0===t?void 0:t.automationStore.isActive()),r=null===(o=a.automationContext)||void 0===o?void 0:o.automationStore.getRecurrence();return{autoCompleteSprints:i,actionConfig:{complete_sprint_action:n},recurrenceConfig:{interval:(null==r?void 0:r.interval)??ui().AL.recurrenceConfig.interval,weekdays:(null==r?void 0:r.weekdays)??ui().AL.recurrenceConfig.weekdays}}}),[a]),f=(0,s().K8)((()=>(0,b().O9)(m)&&(0,b().O9)(y)),[m,y]),h=n.useCallback((e=>{f&&A().createAndCommit({userAction:"useSprintSettings.updateSprintSettingsConfig",environment:r,canUndo:!0,perform:t=>{a&&a.sprintCollectionStore&&a.automationContext&&m&&mi().e_({environment:r,transaction:t,automationStore:a.automationContext.automationStore,currentSprintBlockStore:m,newDuration:e})}})}),[f,m,r,a]),x=n.useCallback((e=>{f&&A().createAndCommit({userAction:"useSprintSettings.updateSprintSettingsConfig",environment:r,canUndo:!0,perform:t=>{a&&a.sprintCollectionStore&&a.automationContext&&m&&mi().g4({environment:r,transaction:t,automationStore:a.automationContext.automationStore,currentSprintBlockStore:m,newWeekday:e})}})}),[f,m,r,a]),v=n.useCallback((e=>{f&&A().createAndCommit({userAction:"useSprintSettings.updateSprintSettingsConfig",environment:r,canUndo:!0,perform:t=>{a&&a.sprintCollectionStore&&a.automationContext&&m&&mi().U2({environment:r,transaction:t,automationStore:a.automationContext.automationStore,actionStore:a.automationContext.automationActionStore,currentSprintBlockStore:m,newAutocompleteStatus:e})}})}),[f,m,r,a]),C=n.useCallback((e=>{f&&A().createAndCommit({userAction:"useSprintSettings.updateSprintSettingsConfig",environment:r,canUndo:!0,perform:t=>{a&&a.sprintCollectionStore&&a.automationContext&&mi().qy({transaction:t,actionStore:a.automationContext.automationActionStore,newRemainingTasksBehavior:e})}})}),[f,r,a]),j=n.useCallback((async()=>{await mi().c({environment:r,collectionContextStore:o,from:i})}),[r,o,i]),w=n.useCallback((async e=>{a&&await mi().eN({environment:r,collectionContextStore:o,sprintSettingsContext:a,sprintBoardViewBlockIds:e})}),[o,r,a]),I=n.useCallback((()=>{a&&mi().Zk({environment:r,collectionContextStore:o,currentViewBlockStore:a.currentCollectionViewBlockStore,taskCollectionViewBlockStore:a.taskCollectionViewBlockStore})}),[o,r,a]);return{sprintSettingsConfig:y,sprintSettingsPermissionsContext:c,turnOnSprints:j,turnOffSprints:w,automaticSprintCompletionEnabled:d,canManageSprintFromThisView:u,currentSprintDateRange:S,manageSprintFromThisView:I,sprintSettingsConfigUpdater:{canUpdateSprintSettingsConfig:f,handleSprintDurationChange:h,handleSprintStartWeekdayChange:x,handleSprintAutoCompleteChange:v,handleSprintRemainingTasksBehaviorChange:C}}}({collectionContextStore:t,collectionSettingsStore:o,from:i});if(!c||!c.canEdit||!r)return null;let y;return y=c.sprintsEnabled?(0,z.jsx)(Vi,{...e,updateSprintSettingsConfig:d,onTurnOffSprints:u,automaticSprintCompletionEnabled:g,currentSprintDateRange:a,canManageSprintFromThisView:m,onManageSprintFromThisView:S,sprintSettingsConfig:r}):(0,z.jsx)(Fi,{...e,onTurnOnSprints:p}),y}function Vi(e){const{sprintSettingsConfig:t,automaticSprintCompletionEnabled:o,currentSprintDateRange:n,canManageSprintFromThisView:i,updateSprintSettingsConfig:r,collectionContextStore:l,onTurnOffSprints:a,onManageSprintFromThisView:s}=e,c=[];return c.push((0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(x().A,{topBorder:!0,disableMobileBorders:!0,children:[i?(0,z.jsx)(zi,{automaticSprintCompletionEnabled:o,manageSprintFromThisView:s}):void 0,(0,z.jsx)(Ni,{turnOffSprints:a,collectionContextStore:l})]},"turn-off-sprints-section"),(0,z.jsx)(x().A,{topBorder:!0,children:(0,z.jsx)(Po().N,{href:xi,external:!0,children:(0,z.jsx)(so().A,{icon:oi().questionMarkCircleIcon,title:(0,z.jsx)(v().sA,{...ji.learnSprintsTitle}),isGray:!0})})})]})),(0,z.jsxs)(C().A,{...e,title:(0,z.jsx)(v().sA,{...ji.sprintsMenuTitle}),footer:c,children:[(0,z.jsx)(Di,{automaticSprintCompletionEnabled:o,currentSprintDateRange:n}),(0,z.jsxs)(x().A,{children:[(0,z.jsx)(Ui,{onChange:r.handleSprintDurationChange,disabled:!r.canUpdateSprintSettingsConfig,sprintSettingsConfig:t}),(0,z.jsx)(Wi,{onChange:r.handleSprintStartWeekdayChange,disabled:!r.canUpdateSprintSettingsConfig,sprintSettingsConfig:t}),(0,z.jsx)(Hi,{onChange:r.handleSprintRemainingTasksBehaviorChange,disabled:!r.canUpdateSprintSettingsConfig,sprintSettingsConfig:t})]}),(0,z.jsx)(x().A,{topBorder:!0,children:(0,z.jsx)(Li,{onChange:r.handleSprintAutoCompleteChange,sprintSettingsConfig:t})})]})}function Fi(e){const{onTurnOnSprints:t}=e,o=Qi(),n=[];return n.push((0,z.jsx)(x().A,{disableMobileBorders:!0,children:(0,z.jsx)("div",{style:o.buttonWrap,children:(0,z.jsx)(M().A,{colorPalette:"blue",style:o.button,onClick:async()=>{await t()},size:"lg",children:(0,z.jsx)(v().sA,{...ji.turnOnSprints})})})},"turn-on-sprints-section")),(0,z.jsx)(C().A,{...e,title:(0,z.jsx)(v().sA,{...ji.setupSprintsTitle}),footer:n,children:(0,z.jsxs)(x().A,{disableMobileBorders:!0,children:[(0,z.jsx)(Ei,{}),(0,z.jsx)(Oi,{}),(0,z.jsx)(Ri,{})]})})}function Di(e){const{automaticSprintCompletionEnabled:t,currentSprintDateRange:o}=e,n=Qi();if(!o)return null;const i=qn().DateTime.fromISO(o.end_date).plus({days:1});return(0,z.jsx)(ai().F,{style:n.sprintStartDateHeader,children:(0,z.jsx)(Gi,{nextSprintStartDate:i,automaticSprintCompletionEnabled:t})})}function Ei(){const e=Qi();return(0,z.jsx)("div",{style:{...e.menuDescriptionContainer,...e.menuDescriptionText},children:(0,z.jsx)(v().sA,{...ji.setupSprintsCaption})})}function Oi(){const e=Qi();return(0,z.jsx)("div",{style:e.mediaWrap,children:(0,z.jsx)("img",{src:Zt().A.images.appPackages.sprintsTurnOnPreviewPng,style:e.media})})}function Ri(){const e=Qi(),t=t=>(0,z.jsx)("span",{style:e.boldText,children:t});return(0,z.jsxs)("div",{style:e.disclaimerWrap,children:[(0,z.jsx)("div",{children:(0,z.jsx)(v().sA,{...ji.setupSprintsTeamspaceStatement})}),(0,z.jsx)(Ki,{text:(0,z.jsx)(v().sA,{...ji.setupSprintsSprintBoardPageStatement,values:{bold:t}}),icon:ti().H}),(0,z.jsx)(Ki,{text:(0,z.jsx)(v().sA,{...ji.setupSprintsSprintsDatabaseStatement,values:{bold:t}}),icon:Zn().c})]})}function Ki(e){const{text:t,icon:o}=e,n=Qi();return(0,z.jsxs)("div",{style:n.disclaimerSubitem,children:[(0,z.jsx)("div",{children:o(n.disclaimerSubitemIcon)}),(0,z.jsx)("div",{children:t})]})}function Ni(e){const{collectionContextStore:t,turnOffSprints:o}=e,n=(0,l().v3)(),i=(0,s().K8)((()=>t.sprintSettingsContextStore.state),[t.sprintSettingsContextStore]),[{value:r}]=(0,et().Yb)((async()=>{if(null==i||!i.taskCollectionStore||null==i||!i.taskCollectionViewBlockStore)return;const e=await async function(e){var t;const{environment:o,collectionStore:n,collectionViewBlockStore:i}=e,{appConfigs:r}=await hi().Aw.load(),l=i.getSpaceId(),a=i.getParentStore(),s=null===(t=n.getFormat())||void 0===t?void 0:t.app_config_uri,c=s&&(0,fi().l)(r(),s);if(!a||a.table!==Si().NX&&a.table!==di().ev&&a.table!==yi().yK||!c)return;const d=await kt().callApi({eventName:"getSprintBoardViewBlocks",environment:o,data:{spaceId:l,taskCollectionId:n.id,parentId:a.id,parentTable:a.table}});return"success"===(null==d?void 0:d.type)?d.data.result:[]}({environment:n,collectionStore:i.taskCollectionStore,collectionViewBlockStore:i.taskCollectionViewBlockStore});return e}),[n,null==i?void 0:i.taskCollectionStore,null==i?void 0:i.taskCollectionViewBlockStore]),a=Qi();return(0,z.jsx)(so().A,{icon:Q().trashIcon,title:(0,z.jsx)(v().sA,{...ji.turnOffSprints}),isRedOnHover:!0,onClick:()=>{To().ui({description:(0,z.jsx)(Mi,{numOfSprintBoards:r?r.length:0}),message:(0,z.jsx)("div",{style:a.modalTitle,children:(0,z.jsx)(v().sA,{...ji.turnOffSprintsModalTitle})}),innerStyle:a.modalInnerStyle,showCancel:!0,keepFocus:!0,items:[{label:(0,z.jsx)(v().sA,{...ji.turnOffAndDeleteModalButton}),color:"red",onAccept:async()=>{await o(r??[])}}]})}})}function zi(e){const{automaticSprintCompletionEnabled:t,manageSprintFromThisView:o}=e,n=Qi();return(0,z.jsx)(so().A,{icon:ei().S,title:(0,z.jsx)(v().sA,{...ji.manageSprintFromThisView}),onClick:()=>{To().ui({description:(0,z.jsx)(Pi,{automaticSprintCompletionEnabled:t}),message:(0,z.jsx)("div",{style:n.modalTitle,children:(0,z.jsx)(v().sA,{...ji.manageSprintFromThisViewModalTitle})}),innerStyle:n.modalInnerStyle,showCancel:!0,keepFocus:!0,items:[{label:(0,z.jsx)(v().sA,{...ji.manageSprintFromThisViewModalButton}),color:"blue",onAccept:o}]})}})}function Li(e){const{onChange:t,sprintSettingsConfig:o}=e;return(0,z.jsx)(An().A,{title:(0,z.jsx)(v().sA,{...ji.automatedSprintsToggleTitle}),caption:(0,z.jsx)(v().sA,{...ji.automatedSprintsToggleCaption}),focused:!1,on:o.autoCompleteSprints,onClick:()=>{t(!o.autoCompleteSprints)},style:{alignItems:void 0},icon:(0,z.jsx)(H().I,{icon:Xn().J}),shouldWrapCaption:!0})}function Ui(e){const{onChange:t,sprintSettingsConfig:o,disabled:n}=e,i=Ti(o.recurrenceConfig.interval),r=vi.map((e=>Ti(e)));return(0,z.jsx)($i,{title:(0,z.jsx)(v().sA,{...ji.duration}),right:(0,z.jsx)(ki,{sprintDurationValue:i.value}),icon:Jn().clockIcon,getMenuItems:e=>r.map((o=>{const r={key:o.key,render:e=>(0,z.jsx)($().A,{...e,disabled:n,title:(0,z.jsx)(ki,{sprintDurationValue:o.value}),isChecked:o.key===i.key}),action:()=>{t(o.value),e.close()}};return r})),showChevron:!0})}function Wi(e){const{onChange:t,sprintSettingsConfig:o,disabled:n}=e,i=o.recurrenceConfig.weekdays[0],r=["SU","MO","TU","WE","TH","FR","SA"];return(0,z.jsx)($i,{title:(0,z.jsx)(v().sA,{...ji.startOn}),icon:ri().D,right:(0,z.jsx)(_i,{weekday:i}),getMenuItems:e=>r.map((o=>{const r={key:o,render:e=>(0,z.jsx)($().A,{...e,disabled:n,title:(0,z.jsx)(_i,{weekday:o}),isChecked:o===i}),action:()=>{t(o),e.close()}};return r})),showChevron:!0})}function Hi(e){const{onChange:t,sprintSettingsConfig:o,disabled:n}=e,i=o.actionConfig.complete_sprint_action,r=["complete_sprint_and_move_incomplete_tasks_to_next_sprint","complete_sprint_and_move_incomplete_tasks_to_backlog","complete_sprint"];return(0,z.jsx)($i,{title:(0,z.jsx)(v().sA,{...ji.incompleteTasks}),right:(0,z.jsx)(Ii,{completeSprintAction:i}),icon:ii,getMenuItems:e=>r.map((o=>{const r={key:o,render:e=>(0,z.jsx)($().A,{...e,disabled:n,title:(0,z.jsx)(Ai,{completeSprintAction:o}),isChecked:o===i}),action:()=>{t(o),e.close()}};return r})),showChevron:!0})}function $i(e){const{getMenuItems:t}=e,o=(0,li().e)({width:250});return(0,z.jsx)(_().A,{popupType:f().A.isMobile?Yn().nl.SlideUp:Yn().nl.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",renderOrigin:t=>(0,z.jsx)(so().A,{...e,...t}),render:e=>(0,z.jsx)(B().A,{...o,children:(0,z.jsx)(le().A,{type:le().O.Vertical,sections:[{key:0,render:e=>(0,z.jsx)(x().A,{enableActionSheetTitle:!0,...e}),items:t(e)}],initialFocus:0})})})}function Gi(e){const{nextSprintStartDate:t,automaticSprintCompletionEnabled:o}=e,n=qn().DateTime.local().startOf("day"),i=t.diff(n,"days").days,r=t.toLocaleString({weekday:"short",month:"short",day:"numeric"}),l=e=>(0,z.jsx)("time",{dateTime:t.toISODate(),children:e});return o?0===i?(0,z.jsx)("div",{children:(0,z.jsx)(v().sA,{...ji.sprintStartDateToday,values:{time:l}})}):(0,z.jsx)("div",{children:(0,z.jsx)(v().sA,{...ji.sprintStartDateFuture,values:{time:l,days:i,formattedDate:r}})}):i<0?(0,z.jsx)("div",{children:(0,z.jsx)(v().sA,{...ji.sprintStartDateShouldStartPast,values:{time:l,days:Math.abs(i),formattedDate:r}})}):0===i?(0,z.jsx)("div",{children:(0,z.jsx)(v().sA,{...ji.sprintStartDateShouldStartToday,values:{time:l}})}):(0,z.jsx)("div",{children:(0,z.jsx)(v().sA,{...ji.sprintStartDateShouldStartFuture,values:{time:l,days:i,formattedDate:r}})})}function Qi(){return(0,h().IS)((()=>({menuDescriptionContainer:{margin:"0px 12px"},menuDescriptionText:{fontSize:f().A.isMobile?We().J.UISmall.mobile:We().J.UISmall.desktop,color:O().Tj.text.secondary,fontWeight:We().Wy.regular,marginInlineStart:14},button:{width:"100%"},buttonWrap:{margin:"0px 12px"},disclaimerWrap:{margin:"0px 12px",fontSize:Uo().vQ,color:O().Tj.text.secondary,fontWeight:We().Wy.regular},disclaimerSubitem:{display:"flex",margin:"8px 0px",gap:8},disclaimerSubitemIcon:{color:O().Tj.icon.tertiary,width:20,height:20,marginTop:f().A.isMobile?3:1},boldText:{color:O().Tj.text.primary,fontWeight:We().Wy.semibold},mediaWrap:{margin:"0px 12px"},media:{marginTop:15,marginInlineEnd:0,marginBottom:10,marginInlineStart:0,width:"100%",border:`1px solid ${O().Tj.border.secondaryTranslucent}`,borderRadius:"5px"},mediaIcon:{width:40,height:40,color:O().Tj.icon.tertiary},modalTitle:{fontWeight:We().Wy.semibold,fontSize:18},modalInnerStyle:{textAlign:"center"},modalReferencedPageName:{color:O().Tj.darkTextColor,fontWeight:We().Wy.semibold},sprintStartDateHeader:{color:O().Tj.text.secondary,background:O().Tj.background.secondary}})),[])}class qi extends St().Store{getInitialState(){return{pageId:void 0}}}const Yi=new qi,Xi=new(Ee().O2)("WorkflowSettingsConfirmAddTemplate",(async()=>await Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(44854),o.e(87017),o.e(46414),o.e(61165),o.e(47668),o.e(24587),o.e(67494),o.e(3651),o.e(48486),o.e(92924),o.e(71481)]).then(o.bind(o,960127)))),Ji=(0,Ee()._h)(Xi,(e=>e.WorkflowSettingsConfirmAddTemplate)),Zi=new(Ee().O2)("WorkflowSettingsLinkedCollections",(async()=>await Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(44854),o.e(87017),o.e(46414),o.e(61165),o.e(47668),o.e(24587),o.e(67494),o.e(3651),o.e(48486),o.e(92924),o.e(71481)]).then(o.bind(o,765556)))),er=(0,Ee()._h)(Zi,(e=>e.WorkflowSettingsLinkedCollections)),tr=new(Ee().O2)("WorkflowSettingsViews",(async()=>await Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(44854),o.e(87017),o.e(46414),o.e(61165),o.e(47668),o.e(24587),o.e(67494),o.e(3651),o.e(48486),o.e(92924),o.e(71481)]).then(o.bind(o,216304)))),or=(0,Ee()._h)(tr,(e=>e.WorkflowSettingsViews));o(18107),o(967357);var nr=()=>o(908006),ir=()=>o(187881),rr=()=>o(176412),lr=()=>o(395546),ar=()=>o(708830),sr=()=>o(69267),cr=()=>o(920836),dr=()=>o(3700),ur=()=>o(999140);var pr=()=>o(998391),gr=()=>o(564787),mr=()=>o(743472),Sr=()=>o(436696),yr=()=>o(263527),fr=()=>o(113105),hr=()=>o(908201),xr=()=>o(251846),vr=()=>o(989184),br=()=>o(585930),Cr=()=>o(177148),jr=()=>o(253673),wr=()=>o(56394),Ar=()=>o(606273);function Ir(){return(0,h().IS)((()=>({togglePreviewOutsideBorder:{margin:f().A.isMobile?0:"0 12px",border:`1px solid ${O().Tj.gray.border.secondary}`,borderRadius:4,alignItems:"center",fontWeight:We().Wy.medium,backgroundColor:O().Tj.background.primary,padding:"9px 0"},card:{border:`1px solid ${O().Tj.gray.border.secondary}`,margin:"8px 16px",borderRadius:4,padding:"8px 2px"},cardFilterPill:{marginInlineStart:8},cardSubitemsContainer:{display:"flex",margin:"0px 8px",padding:2,gap:6},description:{margin:f().A.isMobile?"8px 0":"8px 12px",fontSize:Uo().Kw,fontWeight:We().Wy.regular,color:O().Tj.text.secondary}})),[])}function _r(e){const{propertyName:t,subitemsDisplayMode:o,inversePropertyName:n,collectionViewType:i}=e,r=Ir(),l=(0,v().tz)();let a;return"disabled"===o?a=l.formatMessage(zr.disabled):"show"===o&&(0,pr().r)(i)&&(a=l.formatMessage(zr.showParentsCard)),(0,z.jsxs)(x().A,{disableMobileBorders:!0,children:[(0,z.jsx)("div",{style:r.togglePreviewOutsideBorder,children:(e=>{if("disabled"===e)switch(i){case"board":case"calendar":case"gallery":return(0,z.jsx)(Tr,{propertyName:t,inversePropertyName:n,displayMode:e});default:return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Er,{itemEmoji:Ur,title:n}),(0,z.jsx)(Er,{itemEmoji:Wr,title:t}),(0,z.jsx)(Er,{itemEmoji:Wr,title:t,isLast:!0})]})}if("flattened"===e)switch(i){case"board":case"calendar":case"gallery":return(0,z.jsx)(Tr,{propertyName:t,inversePropertyName:n,displayMode:e});default:return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Er,{itemEmoji:Ur,title:n}),(0,z.jsx)(Er,{itemEmoji:Wr,title:t}),(0,z.jsx)(Er,{itemEmoji:Wr,title:t,isLast:!0})]})}if("hidden"===e)return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Er,{itemEmoji:Ur,title:n,right:(0,z.jsx)(Kr,{count:2})}),(0,z.jsx)(Er,{itemEmoji:Hr,title:n}),(0,z.jsx)(Er,{itemEmoji:$r,title:n,right:(0,z.jsx)(Kr,{count:1}),isLast:!0})]});if("show"===e)switch(i){case"board":case"calendar":case"gallery":return(0,z.jsx)(Tr,{propertyName:t,displayMode:e,inversePropertyName:n});default:return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Er,{itemEmoji:Ur,title:n,left:(0,z.jsx)(Or,{isIndented:!1,isOpen:!0})}),(0,z.jsx)(Er,{itemEmoji:Wr,title:t,left:(0,z.jsx)(Or,{isIndented:!0,isOpen:!1})}),(0,z.jsx)(Er,{itemEmoji:Wr,title:t,left:(0,z.jsx)(Or,{isIndented:!0,isOpen:!1}),isLast:!0})]})}})(o)}),a?(0,z.jsx)("div",{style:r.description,children:a}):void 0]})}function Tr({propertyName:e,inversePropertyName:t,displayMode:o}){const n=(0,v().tz)(),i=Ir();return"flattened"===o||"disabled"===o?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Mr,{children:(0,z.jsx)(Er,{itemEmoji:Ur,title:t})}),(0,z.jsx)(Mr,{children:(0,z.jsx)(Er,{itemEmoji:Wr,title:e})}),(0,z.jsx)(Mr,{children:(0,z.jsx)(Er,{itemEmoji:Wr,title:e})})]}):(0,z.jsx)(Mr,{children:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Er,{itemEmoji:Ur,title:t}),(0,z.jsxs)("div",{style:i.cardSubitemsContainer,children:[(0,z.jsx)(kr,{title:`${e} 1`,left:(0,z.jsx)(Pr,{iconFn:Cr().Y}),isFiltered:!0}),(0,z.jsx)(kr,{title:`${e} 2`,left:(0,z.jsx)(Pr,{iconFn:Cr().Y}),isFiltered:!0})]}),(0,z.jsx)(Er,{title:n.formatMessage(zr.peopleProperty),left:(0,z.jsx)(Pr,{iconFn:jr().personIcon}),isFiltered:!0}),(0,z.jsx)(Er,{title:n.formatMessage(zr.statusProperty),left:(0,z.jsx)(Pr,{iconFn:br().a}),isFiltered:!0})]})})}function kr({title:e,left:t,isFiltered:o}){const n=(0,h().IS)((()=>({cardSubitemPreview:{display:"flex",alignItems:"center",gap:4,fontSize:We().J.UISmall.desktop,fontWeight:We().Wy.medium,color:O().Tj.text.secondary,opacity:o?.5:1}})),[o]);return(0,z.jsxs)("div",{style:n.cardSubitemPreview,children:[t,e]})}function Mr({children:e}){const t=Ir();return(0,z.jsx)("div",{style:t.card,children:e})}function Pr({iconFn:e,size:t=14}){const{iconStyle:o}=(0,h().IS)((()=>({iconStyle:{marginInlineEnd:2}})),[]);return(0,z.jsx)("div",{style:o,children:e({width:t,height:t})})}function Br(e){const{subitemFilterScope:t,propertyName:o}=e,n=(0,v().tz)();return"parents"===t||void 0===t?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Rr,{}),(0,z.jsx)(Er,{itemEmoji:Ur,title:n.formatMessage(zr.notionOneProperty),left:(0,z.jsx)(Or,{isIndented:!1,isOpen:!0})}),(0,z.jsx)(Er,{itemEmoji:Wr,title:o,left:(0,z.jsx)(Or,{isIndented:!0,isOpen:!1}),isFiltered:!0}),(0,z.jsx)(Er,{itemEmoji:Wr,title:o,left:(0,z.jsx)(Or,{isIndented:!0,isOpen:!1}),isFiltered:!0}),(0,z.jsx)(Er,{itemEmoji:Ur,title:n.formatMessage(zr.notionTwoProperty),left:(0,z.jsx)(Or,{isIndented:!1,isOpen:!1})}),(0,z.jsx)(Er,{itemEmoji:Ur,title:n.formatMessage(zr.notionThreeProperty),left:(0,z.jsx)(Or,{isIndented:!1,isOpen:!1})})]}):"parents_and_subitems"===t?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Rr,{}),(0,z.jsx)(Er,{itemEmoji:Ur,title:n.formatMessage(zr.notionOneProperty),left:(0,z.jsx)(Or,{isIndented:!1,isOpen:!0})}),(0,z.jsx)(Er,{itemEmoji:Ur,title:n.formatMessage(zr.springProperty),left:(0,z.jsx)(Or,{isIndented:!1,isOpen:!1}),isFiltered:!0}),(0,z.jsx)(Er,{itemEmoji:Wr,title:n.formatMessage(zr.notionCalendarProperty),left:(0,z.jsx)(Or,{isIndented:!0,isOpen:!1})}),(0,z.jsx)(Er,{itemEmoji:Ur,title:n.formatMessage(zr.notionThreeProperty),left:(0,z.jsx)(Or,{isIndented:!1,isOpen:!1})})]}):"subitems"===t?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Rr,{}),(0,z.jsx)(Er,{itemEmoji:Ur,title:n.formatMessage(zr.springProperty),isFiltered:!0,left:(0,z.jsx)(Or,{isIndented:!1,isOpen:!1})}),(0,z.jsx)(Er,{itemEmoji:Wr,title:n.formatMessage(zr.notionCalendarProperty),left:(0,z.jsx)(Or,{isIndented:!0,isOpen:!1})}),(0,z.jsx)(Er,{itemEmoji:Ur,title:n.formatMessage(zr.summerProperty),isFiltered:!0,left:(0,z.jsx)(Or,{isIndented:!1,isOpen:!1})}),(0,z.jsx)(Er,{itemEmoji:Wr,title:n.formatMessage(zr.notionMailProperty),left:(0,z.jsx)(Or,{isIndented:!0,isOpen:!1})})]}):void(0,b().HB)(t)}function Vr(e){const{subitemFilterScope:t,inversePropertyName:o}=e,n=(0,v().tz)();return"parents"===t||void 0===t?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Rr,{}),(0,z.jsx)(Er,{itemEmoji:Ur,title:n.formatMessage(zr.notionOneProperty),right:(0,z.jsx)(Kr,{count:5})}),(0,z.jsx)(Er,{itemEmoji:Ur,title:n.formatMessage(zr.notionTwoProperty),right:(0,z.jsx)(Kr,{count:12})}),(0,z.jsx)(Er,{itemEmoji:Ur,title:n.formatMessage(zr.notionThreeProperty),right:(0,z.jsx)(Kr,{count:8})})]}):"parents_and_subitems"===t?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Rr,{}),(0,z.jsx)(Er,{itemEmoji:Ur,title:n.formatMessage(zr.notionOneProperty)}),(0,z.jsx)(Er,{itemEmoji:Ur,title:n.formatMessage(zr.springProperty),isFiltered:!0}),(0,z.jsx)(Er,{itemEmoji:Wr,title:n.formatMessage(zr.notionCalendarProperty),right:(0,z.jsx)(Nr,{parentPropertyName:o})}),(0,z.jsx)(Er,{itemEmoji:Ur,title:n.formatMessage(zr.notionThreeProperty)})]}):"subitems"===t?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Rr,{}),(0,z.jsx)(Er,{itemEmoji:Ur,title:"Spring",isFiltered:!0}),(0,z.jsx)(Er,{itemEmoji:Wr,title:"Notion Calendar",right:(0,z.jsx)(Nr,{parentPropertyName:o})}),(0,z.jsx)(Er,{itemEmoji:Ur,title:"Summer",isFiltered:!0}),(0,z.jsx)(Er,{itemEmoji:Wr,title:"Notion Mail",right:(0,z.jsx)(Nr,{parentPropertyName:o})})]}):void(0,b().HB)(t)}function Fr(e){const{subitemFilterScope:t,inversePropertyName:o}=e,n=Ir(),i=(0,v().tz)();return"parents"===t||void 0===t?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{style:n.cardFilterPill,children:(0,z.jsx)(Rr,{})}),(0,z.jsx)(Mr,{children:(0,z.jsx)(Er,{itemEmoji:Ur,title:i.formatMessage(zr.notionOneProperty),bottom:(0,z.jsx)(Kr,{count:5})})}),(0,z.jsx)(Mr,{children:(0,z.jsx)(Er,{itemEmoji:Ur,title:i.formatMessage(zr.notionTwoProperty),bottom:(0,z.jsx)(Kr,{count:12})})})]}):"parents_and_subitems"===t?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{style:n.cardFilterPill,children:(0,z.jsx)(Rr,{})}),(0,z.jsx)(Mr,{children:(0,z.jsx)(Er,{itemEmoji:Ur,title:i.formatMessage(zr.notionOneProperty)})}),(0,z.jsx)(Mr,{children:(0,z.jsx)(Er,{itemEmoji:Wr,title:i.formatMessage(zr.notionCalendarProperty),top:(0,z.jsx)(Nr,{parentPropertyName:o})})}),(0,z.jsx)(Mr,{children:(0,z.jsx)(Er,{itemEmoji:Wr,title:i.formatMessage(zr.notionMailProperty),top:(0,z.jsx)(Nr,{parentPropertyName:o})})})]}):"subitems"===t?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{style:n.cardFilterPill,children:(0,z.jsx)(Rr,{})}),(0,z.jsx)(Mr,{children:(0,z.jsx)(Er,{itemEmoji:Wr,title:i.formatMessage(zr.notionCalendarProperty),top:(0,z.jsx)(Nr,{parentPropertyName:o})})}),(0,z.jsx)(Mr,{children:(0,z.jsx)(Er,{itemEmoji:Wr,title:i.formatMessage(zr.notionMailProperty),top:(0,z.jsx)(Nr,{parentPropertyName:o})})})]}):void(0,b().HB)(t)}function Dr(e){const{propertyName:t,inversePropertyName:o,subitemFilterScope:n,displayMode:i,collectionViewType:r}=e,l=Ir(),a=function(e){const{displayMode:t,subitemFilterScope:o,collectionViewType:n}=e,i=(0,v().tz)();if(!o||"disabled"===t)return;if("flattened"===t)return i.formatMessage(Lr.flattened[o]);const r="show"===t&&(0,gr().qS)(n);if(r)return i.formatMessage(Lr.nested[o])}({displayMode:i,subitemFilterScope:n,collectionViewType:r}),s=((e,n,i)=>{if("show"===e)switch(i){case"board":case"calendar":case"gallery":return;default:return(0,z.jsx)(Br,{subitemFilterScope:n,propertyName:t})}if("flattened"===e)switch(i){case"board":case"calendar":case"gallery":return(0,z.jsx)(Fr,{subitemFilterScope:n,inversePropertyName:o});default:return(0,z.jsx)(Vr,{subitemFilterScope:n,inversePropertyName:o})}})(i,n,r);return(0,z.jsxs)(x().A,{disableMobileBorders:!0,children:[s?(0,z.jsx)("div",{style:l.togglePreviewOutsideBorder,children:s}):void 0,a?(0,z.jsx)("div",{style:l.description,children:a}):void 0]})}function Er({itemEmoji:e,title:t,left:o,right:n,top:i,bottom:r,isLast:l,isFiltered:a}){const s=(0,h().IS)((()=>({previewItem:{padding:2,margin:"0px 8px",display:"flex",fontSize:Uo().Kw,fontWeight:We().Wy.medium,alignItems:"center",color:O().Tj.text.secondary,opacity:a?.5:1}})),[a]);return(0,z.jsxs)(z.Fragment,{children:[i,(0,z.jsxs)("div",{style:s.previewItem,children:[o,e?(0,z.jsx)("span",{style:{marginInlineEnd:"5px"},children:e}):void 0,(0,z.jsx)("span",{style:We().RC,children:t}),n]}),r]})}function Or({isIndented:e,isOpen:t}){return(0,z.jsx)(Ar().f,{isSidebar:!1,open:t,fill:!0,onClick:()=>{},style:{color:O().Tj.icon.secondary,marginInlineStart:e?"12px":void 0,height:20},disabled:!0})}function Rr(){const e=(0,v().tz)(),t=(0,h().IS)((()=>({wrapStyle:{marginInlineStart:0,transform:"scale(0.9)",marginBottom:4,pointerEvents:"none"},innerStyle:{fontSize:We().J.UISmall.desktop,gap:4}})),[]);return(0,z.jsx)(wr().A,{icon:(0,z.jsx)(H().I,{icon:fn().filterIcon,size:"xxs"}),title:e.formatMessage(zr.previewFilterName),on:!0,hideChevron:!1,wrapStyle:t.wrapStyle,innerStyle:t.innerStyle})}function Kr({count:e}){const t=(0,h().IS)((()=>({subitemCountIndicator:{display:"inline-flex",alignItems:"center",gap:4,paddingInlineStart:8,paddingInlineEnd:4,verticalAlign:"text-top"},innerText:{color:O().Tj.text.tertiary,fontWeight:We().Wy.medium,fontSize:We().J.UISmall.desktop}})),[]);return(0,z.jsxs)("span",{style:t.subitemCountIndicator,children:[(0,z.jsx)(H().I,{icon:xr().F,size:"sm",colorVariant:"secondary"}),(0,z.jsx)("span",{style:t.innerText,children:e})]})}function Nr({parentPropertyName:e}){const t=(0,h().IS)((()=>({parentWrapper:{paddingInlineStart:8,display:"inline-flex",alignItems:"center",gap:4},parentTitle:{textOverflow:"ellipsis",overflow:"hidden",color:O().Tj.text.tertiary,fontWeight:We().Wy.medium,fontSize:We().J.UISmall.desktop,whiteSpace:"nowrap"}})),[]);return(0,z.jsxs)("span",{style:t.parentWrapper,children:[(0,z.jsx)(H().I,{icon:vr().Z,size:"sm",colorVariant:"secondary"}),(0,z.jsx)("span",{style:t.parentTitle,children:e})]})}const zr=(0,v().YK)({previewFilterName:{id:"collectionSettings.subitemsPreviews.previewFilterName",defaultMessage:"Name: Contains Notion"},peopleProperty:{id:"collectionSettings.subitemsPreviews.peopleProperty",defaultMessage:"People"},statusProperty:{id:"collectionSettings.subitemsPreviews.statusProperty",defaultMessage:"Status"},notionOneProperty:{id:"collectionSettings.subitemsPreviews.notionOneProperty",defaultMessage:"Notion 1"},notionTwoProperty:{id:"collectionSettings.subitemsPreviews.notionTwoProperty",defaultMessage:"Notion 2"},notionThreeProperty:{id:"collectionSettings.subitemsPreviews.notionThreeProperty",defaultMessage:"Notion 3"},notionCalendarProperty:{id:"collectionSettings.subitemsPreviews.notionCalendarProperty",defaultMessage:"Notion Calendar"},notionMailProperty:{id:"collectionSettings.subitemsPreviews.notionMailProperty",defaultMessage:"Notion Mail"},springProperty:{id:"collectionSettings.subitemsPreviews.springProperty",defaultMessage:"Spring"},summerProperty:{id:"collectionSettings.subitemsPreviews.summerProperty",defaultMessage:"Summer"},showParentsNested:{id:"collectionSettings.subitemsPreview.show.nested.parents",defaultMessage:"Any parents that match the filters will show up, with their sub-items nested."},showParentsAndSubitemsNested:{id:"collectionSettings.subitemsPreview.show.nested.parentsAndSubitems",defaultMessage:"All parents and sub-items that match the filters will show up."},showSubitemsNested:{id:"collectionSettings.subitemsPreview.show.nested.subitems",defaultMessage:"Only parents with sub-items that match the filter will show up."},showParentsCard:{id:"collectionSettings.subitemsPreview.show.card.parents",defaultMessage:"Parents that match the filter will show up, with their sub-items listed on each card."},flattenedParents:{id:"collectionSettings.subitemsPreview.flattened.parents",defaultMessage:"Any parents that match the filters will show up, with an indicator of how many sub-items each parent has."},flattenedParentsAndSubitems:{id:"collectionSettings.subitemsPreview.flattened.parentsAndSubitems",defaultMessage:"Any parents and sub-items that match the filters will show up."},flattenedSubitems:{id:"collectionSettings.subitemsPreview.flattened.subitems",defaultMessage:"Only sub-items that match the filters will show up."},disabled:{id:"collectionSettings.subitemsPreview.disabled",defaultMessage:"All items will be treated as top-level items."}}),Lr={nested:{parents:zr.showParentsNested,parents_and_subitems:zr.showParentsAndSubitemsNested,subitems:zr.showSubitemsNested},flattened:{parents:zr.flattenedParents,parents_and_subitems:zr.flattenedParentsAndSubitems,subitems:zr.flattenedSubitems}};const Ur="ðŸ”",Wr="ðŸ£",Hr="ðŸ®",$r="ðŸ·";var Gr=()=>o(424097),Qr=()=>o(926203),qr=()=>o(557336);function Yr(e){const{feature:t,databaseType:o}=e,n=(0,h().IS)((()=>({description:{marginInlineEnd:12,fontSize:f().A.isMobile?We().J.UISmall.mobile:We().J.UISmall.desktop,color:O().Tj.text.secondary,fontWeight:We().Wy.regular,marginInlineStart:14}})),[]),i=(0,sr().I_)({feature:t,databaseType:o});return(0,z.jsx)(x().A,{disableMobileBorders:!0,children:(0,z.jsx)("div",{style:{...n.description},children:(0,z.jsx)(v().sA,{...i})})})}const Xr="subitem";function Jr(e){const{collectionSettingsStore:t,collectionContextStore:o,onTurnOnSubitems:i}=e,r=(0,v().tz)(),a=(0,l().v3)(),{collectionStore:c,collectionViewStore:d,databaseType:u}=(0,s().K8)((()=>({collectionStore:o.collectionStore(),collectionViewStore:o.collectionViewStore(),databaseType:o.databaseTypeFromStoreState})),[o]),p=(0,s().K8)((()=>(null==d?void 0:d.getType())??"table"),[d]),g=(0,qr().lk)({collectionContextStore:o,feature:Xr}),S=null==g?void 0:g.property,y=(0,s().O$)(o.permissionScopesStore),f=(0,s().O$)(o.normalizedSchemaStore),b=(0,s().K8)((()=>{var e;return S&&(null===(e=f[S])||void 0===e?void 0:e.name)}),[f,S]),C=(0,s().K8)((()=>null==d?void 0:d.getFormat()),[d]),j=(null==C?void 0:C.subitem_display_mode)??"show",w=(0,s().K8)((()=>o.normalizedFormatStore.state.subitem_filter_scope),[o]),I=(0,s().K8)((()=>{const e=S&&f[S];if(e&&"relation"===e.type){var t;const o=e.property;return o?null===(t=f[o])||void 0===t?void 0:t.name:void 0}}),[S,f]),_=(0,s().K8)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?fr().zF(r,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:Xr}):r.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[o,r]),T=(0,s().uB)(void 0,X().A),k=(0,n.useCallback)((e=>{e&&T.setState({open:!1})}),[T]),{initialPropertyName:M}=(0,qr().Me)({collectionContextStore:o,feature:Xr}),P=(0,qr().Tv)({collectionContextStore:o,onPropertySelect:k,feature:Xr}),{handleDefaultPropertySelect:B,clearCollectionViewSubitemConfig:V}=P,F=void 0!==w&&"hidden"===j,D="chart"===p&&"show"===j;(0,n.useEffect)((()=>{d&&(F||D)&&A().createAndCommit({userAction:"actionRegistry.updateCollectionViewSubitemFilterScope",environment:a,canUndo:!0,perform:e=>{m().zA({stores:[d],update:{subitem_display_mode:"flattened",subitem_filter_scope:"parents"},transaction:e})}})}),[F,D,d,a]);const E=(0,h().IS)((()=>({subitemsPreviewContainer:{marginBottom:6,marginInlineStart:2}})),[]),O=(0,n.useMemo)((()=>{const e=function(e){const{intl:t,collectionViewType:o,subitemDisplayMode:n}=e,i="show"===n&&(0,pr().r)(o);return ol.map((e=>({key:e,hideOption:i&&"parents"!==e,type:"button",title:nl({intl:t,subitemFilterScope:e})})))}({intl:r,collectionViewType:p,subitemDisplayMode:j});return e.filter((e=>!e.hideOption))}),[r,p,j]),R="disabled"!==j&&O.length>1&&(0,mr()._Q)(p),K=()=>{if(!(0,mr().BF)(p))return;const e=(0,z.jsx)("div",{style:E.subitemsPreviewContainer,children:(0,z.jsx)(_r,{propertyName:b||M,inversePropertyName:I||_,subitemsDisplayMode:j,collectionViewType:p})});return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(il,{permissionScopes:y}),e]})};return c?g?(0,z.jsxs)(x().A,{disableMobileBorders:!0,extraPadding:!0,children:[K(),R?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(rl,{permissionScopes:y,availableFilterScopeOptions:O}),(0,z.jsx)(Dr,{propertyName:b||M,inversePropertyName:I||_,displayMode:j,subitemFilterScope:w,collectionViewType:p})]}):void 0,(0,mr()._Q)(p)?(0,z.jsx)(ne().A,{size:12,style:{marginTop:4,marginBottom:4}}):void 0,(0,z.jsx)(Qr().Eg,{collectionSettingsStore:t,feature:Xr,permissionScopes:y}),(0,z.jsx)(Qr().Xm,{feature:Xr,databaseType:u,permissionScopes:y,propertyName:b,relationPropertyId:S,collectionContextStore:o,collectionSettingsStore:t,handleDefaultPropertySelect:B,inversePropertyName:I,clearCollectionViewSubitemConfig:V})]}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Yr,{feature:Xr,databaseType:u}),(0,z.jsx)(_r,{propertyName:b||M,inversePropertyName:I||_,subitemsDisplayMode:j,collectionViewType:p}),(0,z.jsx)(Qr().pz,{feature:Xr,permissionScopes:y,databaseType:u,handleAddRelation:i})]}):null}function Zr(e){const{subitemDisplayMode:t,collectionViewType:o,intl:n}=e;if("show"===t||void 0===t)switch(o){case"board":case"calendar":case"gallery":return n.formatMessage({id:"getTitleForSubitemDisplayModeMenuItem.onCard",defaultMessage:"Card property"});case"table":case"list":case"timeline":case"page":return n.formatMessage({id:"getTitleForSubitemDisplayModeMenuItem.nestedInToggle",defaultMessage:"Nested in toggle"});default:return n.formatMessage({id:"getTitleForSubitemDisplayModeMenuItem.default",defaultMessage:"Default view"})}else{if("hidden"===t)return n.formatMessage({id:"subitemDisplayModeMenuItemTitle.hideSubitems",defaultMessage:"Parents only"});if("flattened"===t)return n.formatMessage({id:"subitemDisplayModeMenuItemTitle.flattenedList",defaultMessage:"Flattened list"});if("disabled"===t)return n.formatMessage({id:"subitemDisplayModeMenuItemTitle.disabled",defaultMessage:"Disabled"});(0,b().HB)(t)}}const el=["show","hidden","flattened","disabled"];function tl(e){const{intl:t,collectionViewType:o}=e;return el.map((e=>({key:e,hideOption:"hidden"===e,type:"button",title:Zr({intl:t,collectionViewType:o,subitemDisplayMode:e})})))}const ol=["parents","parents_and_subitems","subitems"];function nl(e){const{subitemFilterScope:t,intl:o}=e;switch(t){case"parents":return o.formatMessage({id:"subitemFilterScopeMenuItemTitle.parents",defaultMessage:"Parents only"});case"parents_and_subitems":return o.formatMessage({id:"subitemFilterScopeMenuItemTitle.parentsAndSubitems",defaultMessage:"Parents and sub-items"});case"subitems":return o.formatMessage({id:"subitemFilterScopeMenuItemTitle.subitems",defaultMessage:"Sub-items only"});default:(0,b().HB)(t)}}function il(e){const{permissionScopes:t}=e,o=(0,v().tz)(),i=(0,hr().ET)(),r=(0,l().v3)(),a=(0,s().K8)((()=>i.collectionViewStore()),[i]),c=(0,s().K8)((()=>null==a?void 0:a.getFormat()),[a]),d=(null==c?void 0:c.subitem_display_mode)??"show",u=(0,s().K8)((()=>(null==a?void 0:a.getType())??"table"),[a]),p=(0,s().K8)((()=>i.normalizedFormatStore.state.subitem_filter_scope),[i]),g=n.useCallback((e=>{const t=i.getPropertyFormatKey(),o=(0,dr().r6)(i),n=null==o?void 0:o.property,l=null==o?void 0:o.inverse;if(!(a&&t&&n&&l&&e!==d))return;const s=(null==c?void 0:c.property_filters)||[];let g;g="disabled"===d?null==c?void 0:c.subitem_filter_scope:p;const S=(0,gr().Hl)({subitemDisplayMode:e,subitemFilterScope:g,collectionViewType:u}),y=(0,gr().OB)({subitemDisplayMode:e,subitemFilterScope:g}),f=(0,pr().r)(u);A().createAndCommit({userAction:"actionRegistry.updateCollectionViewSubitemDisplayMode",environment:r,canUndo:!0,perform:o=>{f&&(0,yr().a)({formatStore:a,formatKey:t,property:n,update:{visible:"show"===e},transaction:o});const i=(0,Gr().Y)({propertyFilters:s,subitemInverseProperty:l,shouldShowParentsOnly:S,shouldShowSubitemsOnly:y});"show"===e&&f&&m().zA({stores:[a],update:{subitem_filter_scope:"parents"},transaction:o}),m().zA({stores:[a],update:{subitem_display_mode:e,property_filters:i},transaction:o})}}),(0,Sr().X)({environment:r,collectionContextStore:i,action:"set_subitem_display_mode",new_subitem_display_mode:e,old_subitem_display_mode:d})}),[i,a,r,c,d,p,u]);return(0,mr().BF)(u)?(0,z.jsx)(oo().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Display options",id:"SubitemDisplayModeMenuItem.menuItemTitleV2"}),collectionContextStore:i,selectedKey:d,options:tl({collectionViewType:u,intl:o}),onChange:e=>g(e),disabled:!t.canConfigureBlock,variant:"fullWidth"}):null}function rl(e){const{permissionScopes:t,availableFilterScopeOptions:o}=e,i=(0,l().v3)(),r=(0,hr().ET)(),a=(0,s().K8)((()=>r.normalizedFormatStore.state.subitem_filter_scope),[r]),c=(0,s().K8)((()=>{const e=r.collectionViewStore();return(null==e?void 0:e.getFormat().subitem_display_mode)??"show"}),[r]),d=(0,n.useCallback)((e=>{const t=r.collectionViewStore(),o=(0,dr().r6)(r),n=null==o?void 0:o.inverse;if(!t||!n||e===a)return;const l=t.getFormat(),s=(null==l?void 0:l.property_filters)||[],d=(0,gr().Hl)({subitemDisplayMode:c,subitemFilterScope:e,collectionViewType:t.getType()??"table"}),u=(0,gr().OB)({subitemDisplayMode:c,subitemFilterScope:e});A().createAndCommit({userAction:"actionRegistry.updateCollectionViewSubitemFilterScope",environment:i,canUndo:!0,perform:o=>{const i=(0,Gr().Y)({propertyFilters:s,subitemInverseProperty:n,shouldShowParentsOnly:d,shouldShowSubitemsOnly:u});m().zA({stores:[t],update:{property_filters:i,subitem_filter_scope:e},transaction:o})}}),(0,Sr().X)({environment:i,collectionContextStore:r,action:"set_subitem_filter_scope",new_subitem_filter_scope:e,old_subitem_filter_scope:a})}),[r,i,a,c]);return void 0===a||o.length<=1?null:(0,z.jsx)(oo().A,{title:"flattened"===c?(0,z.jsx)(v().sA,{defaultMessage:"Include",id:"SubitemFilterScopeMenuItem.menuItemTitle.flattened"}):(0,z.jsx)(v().sA,{defaultMessage:"Filter options",id:"SubitemFilterScopeMenuItem.menuItemTitle.default"}),collectionContextStore:r,selectedKey:a,options:o,onChange:d,disabled:!t.canConfigureBlock,variant:"fullWidth"})}var ll=()=>o(147361);function al(e){const{collectionContextStore:t,collectionSettingsStore:o,feature:i,from:r}=e,l=(0,s().O$)(t.normalizedSchemaStore),a=(0,s().K8)((()=>t.databaseTypeFromStoreState),[t]),c=(0,s().K8)((()=>t.collectionStore()),[t]),d=(0,qr().lk)({collectionContextStore:t,feature:i}),u=null==d?void 0:d.property,p=(0,n.useMemo)((()=>ur().HG(l)),[l]),g=(0,s().O$)(t.permissionScopesStore),m=(0,s().K8)((()=>{var e;return u&&(null===(e=l[u])||void 0===e?void 0:e.name)}),[l,u]),S=(0,s().K8)((()=>{const e=u&&l[u];if(e&&"relation"===e.type){var t;const o=e.property;return o?null===(t=l[o])||void 0===t?void 0:t.name:void 0}}),[u,l]),y=(0,s().K8)((()=>Boolean(c&&function(e){const{collectionContextStore:t,collectionStore:o}=e,n=o.getFormat().collection_default_arrows_by,i=t.currentArrowsByFormatStore.state;return!(0,b().O9)(i)||i===n}({collectionContextStore:t,collectionStore:c}))),[t,c]),f=(0,s().uB)(void 0,X().A),h=(0,n.useCallback)((e=>{e&&f.setState({open:!1})}),[f]),j=(0,qr().Tv)({collectionContextStore:t,onPropertySelect:h,feature:i}),{handleAddRelation:w,handleDefaultPropertySelect:A,setSubitemFilterScope:I}=j;if(!c)return null;let _;if("subitem"===i){const e=()=>{w({featureType:"subitem",from:r}),I({subitemFilterScope:"parents"}),nr().default.afterNextFlush((()=>{const e=t.subitemTreeStore.getState(),o=t.resultsInViewOrder(1).at(0),n=(0,ar().Qe)(e.children,(e=>e.value.store===o));if(n){const e=n.map((e=>e.value.store.pointer)),o=(0,dr().kY)(e);cr().QK({collectionContextStore:t,pathKey:o})}}))};_=(0,z.jsx)(Jr,{collectionSettingsStore:o,collectionContextStore:t,onTurnOnSubitems:e})}else"timeline_arrows_by"===i?_=d?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Yr,{feature:i,databaseType:a}),y?(0,z.jsx)(cl,{collectionContextStore:t,firstDatePropertyId:p,permissionScopes:g}):(0,z.jsx)(sl,{collectionContextStore:t,databaseType:a}),(0,z.jsxs)(x().A,{topBorder:!0,children:[(0,z.jsx)(Qr().Eg,{collectionSettingsStore:o,feature:i,permissionScopes:g}),(0,z.jsx)(ul,{feature:i,databaseType:a,featuredRelationProperty:d,actions:j,permissionScopes:g}),(0,z.jsx)(Qr().Xm,{feature:i,databaseType:a,permissionScopes:g,relationPropertyId:u,propertyName:m,inversePropertyName:S,collectionContextStore:t,collectionSettingsStore:o,handleDefaultPropertySelect:A})]})]}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Yr,{feature:i,databaseType:a}),(0,z.jsx)(dl,{databaseType:a,collectionContextStore:t,firstDatePropertyId:p,handleAddRelation:w,permissionScopes:g,from:r})]}):(0,b().HB)(i);const T=(0,sr().mv)({feature:i,databaseType:a});return(0,z.jsx)(C().A,{...e,title:(0,z.jsx)(v().sA,{...T}),children:_})}function sl(e){const{collectionContextStore:t,databaseType:o}=e,n=(0,l().WS)(),i=(0,h().IS)((()=>({wrap:{boxShadow:O().Tj.shadow2XS,...n?{backgroundColor:O().Tj.background.secondary,margin:void 0,borderRadius:void 0}:{background:"rgba(196, 196, 196, 0.13)",marginTop:14,marginBottom:20}},iconWithMessage:{display:"flex",gap:8}})),[n]),r=(0,s().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getNormalizedDependencyDateShiftingConfig()}),[t]),a=(0,sr().qC)({currentDateShiftConfig:r,databaseType:o});return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(x().A,{title:(0,z.jsx)(v().sA,{...sr().Ic.dateShiftingSectionCaption}),children:(0,z.jsx)(ll().r,{mode:null==r?void 0:r.mode})}),(0,z.jsx)(ai().F,{style:i.wrap,showCloseButton:!1,children:(0,z.jsxs)("div",{style:i.iconWithMessage,children:[(0,z.jsx)(H().I,{icon:lr().infoCircleSmallIcon,size:"sm",colorVariant:"secondary"}),(0,z.jsx)(Xe().A,{isSmall:!0,isMultiline:!0,children:(0,z.jsx)(v().sA,{...a})})]})})]})}function cl(e){const{collectionContextStore:t,firstDatePropertyId:o,permissionScopes:i}=e,r=(0,l().v3)(),a=(0,v().tz)(),c=(0,s().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getNormalizedDependencyDateShiftingConfig()}),[t]),d=(0,n.useCallback)((e=>{const o=t.collectionStore();o&&A().createAndCommit({userAction:"FeatureEnabledDependenciesSection.handleConfigChange",environment:r,canUndo:!0,perform:t=>{(0,Qr().Wf)({collectionStore:o,environment:r,intl:a,newConfig:e,transaction:t})}})}),[t,r,a]),u=(0,n.useMemo)((()=>({configWithoutDates:c,...c?{datePropertyId:c.date_property,endDatePropertyId:c.end_date_property}:{datePropertyId:o}})),[c,o]);return(0,z.jsx)(Qr().aH,{collectionContextStore:t,currentConfig:u,disabled:!i.canConfigureBlock||!i.canConfigureCollection,onConfigChange:d})}function dl(e){const{collectionContextStore:t,handleAddRelation:o,firstDatePropertyId:i,permissionScopes:r,databaseType:l,from:a}=e,[c,d]=(0,n.useState)({datePropertyId:i,configWithoutDates:{mode:Qr().qd,avoid_weekends:Qr().$g}}),u=(0,s().K8)((()=>t.settingsStore),[t]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Qr().aH,{collectionContextStore:t,currentConfig:c,disabled:!r.canConfigureBlock||!r.canConfigureCollection,onConfigChange:d}),(0,z.jsx)(Qr().pz,{feature:"timeline_arrows_by",permissionScopes:r,databaseType:l,handleAddRelation:()=>{o({featureType:"timeline_arrows_by",dateShiftingConfig:c,from:a}),R().yl({collectionSettingsStore:u})}})]})}function ul(e){const{feature:t,featuredRelationProperty:o,actions:n,permissionScopes:i,databaseType:r}=e;if(!o.supportedInView)return null;const l=o.enabledOnView,a=o.isVisibleInView,s=a?rr().L:ir().eyeFillIcon;return(0,z.jsx)(so().A,{icon:s,onClick:()=>{n.handlePropertySelect(l?void 0:o.property)},title:(0,z.jsx)(v().sA,{...(0,sr().WI)({feature:t,isOn:a,databaseType:r})}),disabled:!i.canConfigureBlock})}var pl=()=>o(762631),gl=()=>o(770703),ml=()=>o(878665);const Sl="box1-filter",yl="box2-filter";function fl(e){const{propertyName:t,inversePropertyName:o}=e,n=(0,h().IS)((()=>({svgWrap:{margin:"0px 12px",border:`1px solid ${O().Tj.border.secondaryTranslucent}`,borderRadius:6,alignItems:"center",position:"relative",height:112,backgroundColor:O().Tj.palette.gray[30],display:"flex",justifyContent:"center"}})),[]);return(0,z.jsx)(x().A,{disableMobileBorders:!0,children:(0,z.jsx)("div",{style:n.svgWrap,children:(0,z.jsxs)("svg",{width:"266",height:"116",fill:"none",children:[(0,z.jsx)("path",{stroke:"#DFAF49",strokeWidth:"2",d:"M124 20h.426c7.703 0 17.307-.002 25.029 1.93 3.979.994 8.078 2.638 11.248 5.575C164.082 30.635 166 34.868 166 40c0 8.001-6.095 12.917-11.524 15.932-5.553 3.086-12.74 5.481-19.23 7.644l-.349.116c-6.919 2.307-13.074 4.381-17.546 6.866C112.655 73.166 112 75 112 76c0 1.868.582 2.885 1.453 3.692 1.08 1.001 2.981 1.982 6.002 2.737C125.59 83.963 132.773 84 141 84"}),(0,z.jsx)("path",{stroke:"#E3E2E0",strokeWidth:"2",d:"M125 32c8.227 0 15.41.037 21.545 1.57 3.021.756 4.922 1.737 6.002 2.738.871.807 1.453 1.824 1.453 3.692 0 .999-.655 2.834-5.351 5.443-4.472 2.484-10.627 4.558-17.546 6.865l-.349.116c-6.49 2.163-13.677 4.558-19.23 7.644C106.095 63.084 100 67.998 100 76c0 5.132 1.918 9.365 5.297 12.495 3.17 2.937 7.269 4.581 11.248 5.576C124.267 96 133.871 96 141.574 96H142"}),(0,z.jsx)("path",{fill:O().Tj.palette.gray[30],d:"M157 27h16v18h-16zM92 70h16v18H92z"}),(0,z.jsx)("path",{stroke:"#DFAF49",strokeWidth:"2",d:"M136 88l5-4-5-4"}),(0,z.jsx)("path",{stroke:"#E3E2E0",strokeWidth:"2",d:"M130 36l-5-4 5-4"}),(0,z.jsxs)("g",{filter:`url(#${Sl})`,children:[(0,z.jsx)("rect",{width:"100",height:"28",x:"24",y:"12",fill:O().Tj.background.elevated,rx:"3"}),(0,z.jsx)("text",{x:"67",y:"31",fill:"#000",children:"ðŸŒ±"})]}),(0,z.jsxs)("g",{filter:`url(#${yl})`,children:[(0,z.jsx)("rect",{width:"100",height:"28",x:"142",y:"76",fill:O().Tj.background.elevated,rx:"3"}),(0,z.jsx)("text",{x:"185",y:"95",fill:"#000",children:"ðŸŒ³"})]}),(0,z.jsx)(hl,{x:"161",y:"26",width:"100",height:"16",textStyles:{fontSize:12,fontWeight:590,color:O().Tj.text.primary},children:t}),(0,z.jsx)(hl,{x:"15",y:"69",width:"90",height:"16",textStyles:{color:O().Tj.text.tertiary,fontSize:12,fontWeight:500,textAlign:"end"},children:o}),(0,z.jsxs)("defs",{children:[(0,z.jsxs)("filter",{id:Sl,width:"108",height:"36",x:"20",y:"10",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,z.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,z.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,z.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_1034_52436"}),(0,z.jsx)("feOffset",{}),(0,z.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,z.jsx)("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),(0,z.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_1034_52436"}),(0,z.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,z.jsx)("feOffset",{dy:"2"}),(0,z.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,z.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,z.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,z.jsx)("feBlend",{in2:"effect1_dropShadow_1034_52436",result:"effect2_dropShadow_1034_52436"}),(0,z.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_1034_52436",result:"shape"})]}),(0,z.jsxs)("filter",{id:yl,width:"108",height:"36",x:"138",y:"74",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,z.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,z.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,z.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_1034_52436"}),(0,z.jsx)("feOffset",{}),(0,z.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,z.jsx)("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),(0,z.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_1034_52436"}),(0,z.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,z.jsx)("feOffset",{dy:"2"}),(0,z.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,z.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,z.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,z.jsx)("feBlend",{in2:"effect1_dropShadow_1034_52436",result:"effect2_dropShadow_1034_52436"}),(0,z.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_1034_52436",result:"shape"})]})]})]})})})}function hl(e){const{children:t,textStyles:o,...n}=e;return(0,z.jsx)("foreignObject",{...n,children:(0,z.jsx)("div",{style:{...We().RC,...n.width?{width:Number(n.width)}:{},...o},children:t})})}var xl=()=>o(554840);function vl(e){var t;const{collectionContextStore:o,feature:i}=e,r=(0,v().tz)(),l=(0,s().K8)((()=>o.collectionStore()),[o]),a=(0,s().O$)(o.normalizedSchemaStore),c=(0,s().O$)(o.permissionScopesStore),d=null===(t=(0,qr().lk)({collectionContextStore:o,feature:i}))||void 0===t?void 0:t.property,u=(0,s().K8)((()=>{var e;return d&&(null===(e=a[d])||void 0===e?void 0:e.name)}),[d,a]),p=(0,s().K8)((()=>{var e;return"table"===(null===(e=o.collectionViewStore())||void 0===e?void 0:e.getType())}),[o]),g=(0,s().K8)((()=>{const e=d&&a[d];if(e&&"relation"===e.type){var t;const o=e.property;return o?null===(t=a[o])||void 0===t?void 0:t.name:void 0}}),[d,a]),m=(0,s().K8)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?fr().zF(r,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:i}):r.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[o,r,i]),S=(0,s().uB)(void 0,X().A),{initialPropertyName:y}=(0,qr().Me)({collectionContextStore:o,feature:i}),f=(0,n.useCallback)((e=>{e&&S.setState({open:!1})}),[S]),j=(0,h().IS)((()=>({previewContainer:{marginInlineStart:2}})),[]);if(!l)return null;let w;return"subitem"===i?w=(0,z.jsx)(_r,{propertyName:u||y,inversePropertyName:g||m,subitemsDisplayMode:"show"}):"timeline_arrows_by"===i?w=(0,z.jsx)(fl,{propertyName:u||y,inversePropertyName:g||m}):(0,b().HB)(i),(0,z.jsxs)(C().A,{...e,title:(0,z.jsx)(v().sA,{...sr().Ic.advancedSettings}),children:[(0,z.jsx)("div",{style:j.previewContainer,children:w}),(0,z.jsxs)(x().A,{disableMobileBorders:!0,children:[(0,z.jsx)(xl().a,{currentPropertyId:d,feature:i,onPropertySelect:f,buttonPopupStore:S,collectionContextStore:o,permissionScopes:c,disabled:!c.canConfigureCollection}),"subitem"===i&&p?(0,z.jsx)(bl,{collectionContextStore:o,permissionScopes:c}):void 0]})]})}function bl(e){const{collectionContextStore:t,permissionScopes:o}=e,i=(0,v().tz)(),r=(0,l().v3)(),a=(0,s().K8)((()=>"title"===t.normalizedFormatStore.state.table_subitem_toggle_column),[t]),c=!o.canConfigureBlock,d=(0,n.useCallback)((()=>{const e=t.collectionViewStore();e&&(gl().jP({environment:r,collectionViewStore:e,currentValue:t.normalizedFormatStore.state.table_subitem_toggle_column}),(0,Sr().X)({environment:r,collectionContextStore:t,action:"toggle_table_subitem_toggle_on_title"}))}),[t,r]);return(0,z.jsx)(ml().d,{showImage:o.canConfigureBlock,caption:i.formatMessage(sr().Ic.toggleNestingOnTitleMenuItemTooltip),tooltipImage:Zt().A.images.tooltips.collectionSettings.subitemsToggleOnTitlePng,tooltipImageScale:.3,render:e=>(0,z.jsx)(so().A,{...e,icon:()=>(0,z.jsx)(H().I,{icon:pl().U,size:"sm",style:{marginInlineStart:4,marginInlineEnd:2}}),onClick:d,title:(0,z.jsx)(v().sA,{defaultMessage:"Show nesting toggle on title",id:"database.viewSettings.layoutTab.tableSubitemToggleOnTitle"}),right:(0,z.jsx)(ie().A,{disallowTabbing:!0,on:a,disabled:c,onClick:d}),disabled:c})})}var Cl=()=>o(261503),jl=()=>o(617668);function wl(e){const{integration:t,collectionSettingsStore:o,collectionContextStore:n,onAccountSelect:i}=e,r=(0,h().IS)((()=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",paddingTop:8,paddingInlineEnd:16,paddingBottom:16,paddingInlineStart:8}})),[]),a=(0,l().v3)(),c=(0,s().K8)((()=>{var e;return null===(e=n.collectionStore())||void 0===e?void 0:e.getSpaceId()}),[n]),d=(0,s().K8)((()=>{const e=Ge().A.state;return e.loaded?e.externalAuthentications.filter((e=>e.integration_id===t.id)):[]}),[t]);return t&&c?(0,z.jsx)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Choose an account",id:"collectionSettingsAccountPicker.title"}),footer:Al({environment:a,integration:t,spaceId:c}),children:(0,z.jsx)("div",{style:r.settingsMenu,children:(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:0,sections:[{key:"externalAuthentications",items:d.map((e=>{const n={key:e.id,render:o=>(0,z.jsx)(Ye().m,{renderTooltip:()=>(0,z.jsx)("span",{children:e.account_name}),placement:"left",textWrap:!0,render:n=>(0,z.jsx)($().A,{...(0,ao().A)(n||{},o),title:e.account_name,icon:(0,z.jsx)("img",{style:{width:18},src:t.info.icon}),focused:o.focused})}),action:()=>{R().yl({collectionSettingsStore:o}),i(e)}};return n})),render:e=>(0,z.jsx)(x().A,{...e})}]})})}):null}function Al(e){const t=e.environment.device.isMobileBrowser;return(0,z.jsx)(x().A,{topBorder:!0,children:t?void 0:Il(e)})}function Il(e){return(0,z.jsx)(so().A,{...e,icon:jl().plusIcon,title:(0,z.jsx)(v().sA,{id:"collectionSettingsAccountPicker.addAccount",defaultMessage:"Connect another account"}),isGray:!0,onClick:async()=>{await No().Jq({...e,from:"source_picker_connect_another_account"})}})}var _l=()=>o(444091),Tl=o.n(o(844751)),kl=()=>o(430171),Ml=()=>o(95441);const Pl=(0,v().YK)({searchPlaceholder:{defaultMessage:"Search for a property...",id:"database.viewSettings.databaseProperties.searchPlaceholder"}}),Bl=St().Store.createClass("",{name:"InputStore"});function Vl(e){const t=(0,v().tz)(),{collectionContextStore:o,collectionSettingsStore:i}=e,r=(0,l().v3)(),a=(0,h().DP)(),c=(0,s().O$)(o.normalizedSchemaStore),d=(0,s().O$)(o.permissionScopesStore),u=(0,s().uB)(void 0,Bl),p=(0,s().O$)(u),g=(0,n.useMemo)((()=>{const e=p.toLowerCase();return e?Object.entries(c).filter((([t,o])=>!!o&&Tl().test(e,o.name.toLowerCase()))):Object.entries(c)}),[c,p]),m=(0,U().X)("jira_notion_only_properties"),S=d.canConfigureCollection&&(!d.isExternallyImportedAndSyncedCollection||m),y=(0,n.useCallback)((()=>{(0,kl().c)({environment:r,collectionContextStore:o})}),[r,o]),f=(0,n.useCallback)((e=>{R().a2({collectionSettingsStore:i,item:{type:"property",property:e,formatKey:void 0}})}),[i]),b=(0,h().IS)((()=>({title:{display:"flex",alignItems:"center"},propertiesContainer:{paddingTop:8,paddingBottom:8},propertyIcon:{fill:O().Tj.icon.primary}})),[]);return(0,z.jsx)(C().A,{...e,title:(0,z.jsx)("div",{style:b.title,children:(0,z.jsx)(v().sA,{defaultMessage:"Properties",id:"database.viewSettings.databaseProperties.title"})}),header:(0,z.jsx)(x().A,{children:(0,z.jsx)(mt().Ay,{placeholder:t.formatMessage(Pl.searchPlaceholder),value:p,onChange:e=>u.setState(e.target.value)})}),footer:(0,z.jsxs)(x().A,{topBorder:!0,children:[S?(0,z.jsx)(so().A,{icon:jl().plusIcon,title:(0,z.jsx)(v().sA,{defaultMessage:"New property",id:"database.viewSettings.databaseProperties.newProperty"}),isGray:!0,onClick:y}):void 0,(0,z.jsx)(Ml().A,{href:(0,Lo().x)("guides.databaseProperties"),title:(0,z.jsx)(v().sA,{defaultMessage:"Learn about properties",id:"database.viewSettings.databaseProperties.learnMoreButton.title"}),analyticsFrom:"database_settings_properties"})]}),children:(0,z.jsx)("div",{style:b.propertiesContainer,children:g.map((([e,t])=>t?(0,z.jsx)(so().A,{icon:e=>(0,z.jsx)(Je().zB,{type:t.type,icon:t.icon,size:D().Ev.sm,style:{...e,...b.propertyIcon},theme:a}),title:t.name,onClick:()=>f(e),showChevron:!0},e):null))})})}var Fl=()=>o(695115),Dl=()=>o(589407),El=()=>o(745266),Ol=()=>o(31902);function Rl(e){return(0,z.jsx)(Kl,{...e})}function Kl(e){const t=(0,s().K8)((()=>{const t=e.collectionContextStore.collectionViewBlockStore();if(!t)return;const o=e.collectionContextStore.collectionStore();if(!o)return;const n=o.getSchemaStore().getValue(),i=t.getCollectionViewStores().filter((e=>{var t;return(null===(t=e.getCollectionStore())||void 0===t?void 0:t.id)===o.id})),r=o.getAutomationStores(),l=o.getParentId()===t.id;return{collectionViewBlockStore:t,collectionStore:o,schema:n,views:i,automations:r,isSourceDatabase:l}}),[e.collectionContextStore]);return t?(0,z.jsxs)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Settings",id:"databaseSettingsV2.title"}),children:[(0,z.jsx)(x().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Views",id:"databaseSettingsV2.viewSection.title"}),children:t.views.map((e=>(0,z.jsx)(Nl,{collectionViewStore:e},e.id)))}),(0,z.jsx)(zl,{collectionStore:t.collectionStore,collectionContextStore:e.collectionContextStore})]}):null}function Nl({collectionViewStore:e}){const{viewName:t,viewType:o,viewIcon:n}=(0,s().K8)((()=>({viewName:e.getName(),viewType:e.getType(),viewIcon:e.getFormat().collection_view_icon})),[e]);if(!o)throw new Error(`View type not found for ${e.id}`);return(0,z.jsx)(so().A,{title:(0,z.jsx)(Ol().A,{collectionViewType:o,collectionViewName:t}),icon:()=>(0,z.jsx)(El().h,{color:"regular",viewType:o,viewIcon:n}),onClick:()=>{const{mainEditorCurrentBlockStore:e}=ze().default.state;if(!e||!e.isCollectionView())throw new Error("Main editor current block store is not a collection view")}})}function zl(e){const t=(0,v().tz)(),{collectionStore:o,collectionContextStore:i}=e,r=(0,l().v3)(),a=(0,s().K8)((()=>{var e;const t=(null===(e=o.getModel())||void 0===e?void 0:e.getNormalizedSchema())??{};return Object.entries(t).filter((e=>void 0!==e[1]))}),[o]),c=(0,h().DP)(),d=(0,h().IS)((()=>({sectionTitleContainer:{display:"flex",alignItems:"center",gap:4},propertyItem:{height:36,paddingTop:8,paddingBottom:8,paddingInlineStart:12,display:"flex",alignItems:"center",justifyContent:"flex-start",gap:8},expandButtonIcon:{minWidth:18,minHeight:18,width:18,height:18,color:O().Tj.icon.secondary},expandButtonText:{color:O().Tj.text.secondary}})),[]),u=(0,n.useCallback)((()=>{R().a2({collectionSettingsStore:i.settingsStore,item:{type:"propertyType",onAccept:e=>{const{propertyType:t,isSuggestedProperty:o,propertyName:n,propertyIcon:l,selectOptions:a}=e;Pt().nZ({environment:r,collectionContextStore:i,propertyType:t,isSuggestedProperty:o,propertyName:n,propertyIcon:l,selectOptions:a,from:"database_settings"})}}})}),[i,r]),p=(0,n.useCallback)((e=>{R().a2({collectionSettingsStore:i.settingsStore,item:{type:"property",property:e,formatKey:void 0}})}),[i]),[g,m]=(0,n.useState)(!1),S=g?a:a.slice(0,5),y=g||S.length===a.length?null:(0,z.jsx)($().A,{title:(0,z.jsx)(v().sA,{id:"WorkflowEditorDatabase.DatabaseProperties.expand",defaultMessage:"{count, plural, one {# more property} other {# more properties}}",values:{count:a.length-5}}),icon:(0,z.jsx)(H().I,{icon:Dl().ellipsisIcon}),focused:!1,onClick:()=>m(!0),style:d.propertyItem,desktopIconStyle:d.expandButtonIcon,desktopTitleStyle:d.expandButtonText});return(0,z.jsx)(x().A,{title:(0,z.jsxs)("div",{style:d.sectionTitleContainer,children:[(0,z.jsx)(v().sA,{id:"WorkflowEditorDatabase.DatabaseDetails.properties",defaultMessage:"Properties"}),(0,z.jsx)(Fl().A,{icon:F().plusSmallIcon,ariaLabel:t.formatMessage({id:"WorkflowEditorDatabase.DatabaseDetails.access.add",defaultMessage:"Add"}),onClick:u,style:{width:20,height:20}})]}),children:(0,z.jsxs)("div",{children:[S.map((([e,t],o)=>(0,z.jsx)(so().A,{icon:e=>(0,z.jsx)(Je().zB,{type:t.type,icon:t.icon,size:18,theme:c,style:{fill:c.icon.primary}}),title:t.name,onClick:()=>p(e)},e))),y]})})}var Ll=()=>o(594013),Ul=()=>o(901610),Wl=()=>o(519831),Hl=()=>o(720665),$l=()=>o(384944),Gl=()=>o(833106);function Ql(e){var t,o,n;const{collectionContextStore:i,collectionStore:r,transaction:l}=e,a=i.collectionViewStore();if(!a||!r.isDefined())return;const s=ur().e2(r),c=null===(t=r.getFormat())||void 0===t?void 0:t.collection_default_arrows_by,d=i.collectionStore(),u=(null==d?void 0:d.pointer.id)!==r.pointer.id,p=r.getSchema();let g=a.getChartConfig();u&&"chart"===a.getType()&&g&&"placeholder"!==g.type&&(g=function({chartConfig:e,collectionSchema:t}){return(0,Ul().m)(e)?(0,Ll().EZ)({collectionSchema:t,axisChartType:e.type}):"donut"===e.type?(0,Ll().ZS)({collectionSchema:t}):(0,Ll().EZ)({collectionSchema:t,axisChartType:"column"})}({chartConfig:g,collectionSchema:p}));const m={table_properties:null==s||null===(o=s.getFormat())||void 0===o?void 0:o.table_properties,collection_pointer:{table:Wl().Vl,id:r.id,spaceId:r.getSpaceId()},chart_config:g,timeline_arrows_by:c?{property:c}:void 0,table_subitem_toggle_column:"title"},S=null==i?void 0:i.normalizedSchemaStore.state;$l().zv({store:a,data:(0,Hl().g_)({format:m,query2:{sort:s?null===(n=(0,Gl().$)({collectionViewStore:s,schema:S}))||void 0===n?void 0:n.sort:void 0}}),transaction:l})}function ql(e){const{environment:t,collectionContextStore:o,transaction:n,source:i}=e,r=o.collectionViewStore(),l=o.collectionViewBlockStore();if(r&&l&&(m().zA({stores:[r],update:{collection_view_source:i},transaction:n}),"collection"===i.type)){const e=xt().m.createChildStore(r,{table:Wl().Vl,id:i.id,spaceId:i.spaceId});if(!e.isDefined())return;Ql({collectionContextStore:o,collectionStore:e,transaction:n}),(0,y().u)({environment:t,event:{eventName:"add_linked_source",eventProperties:{source_collection_id:i.id,source_has_row_based_permissions:e.getPropertyPermissionItems().validItems.length>0,collection_view_id:r.id,collection_view_block_id:l.id}}})}}var Yl=()=>o(498521),Xl=()=>o(452004),Jl=()=>o(821062),Zl=()=>o(768627),ea=(o(430670),()=>o(675133)),ta=()=>o(591779),oa=()=>o(245241),na=()=>o(305390),ia=()=>o(135599),ra=()=>o(106628),la=()=>o(361330);function aa({numShimmers:e=5}){const t=(0,h().IS)((()=>({container:{maxHeight:253},shimmerContainer:{height:45,marginTop:0,marginInlineEnd:14,marginBottom:0,marginInlineStart:18,display:"flex",alignItems:"center"},circleContainer:{display:"flex",alignItems:"center",justifyContent:"center",marginInlineEnd:5,marginTop:5,alignSelf:"flex-start"},circle:{width:16,height:16,borderRadius:12,backgroundColor:O().Tj.background.tertiaryTranslucent},sourceContainer:{flex:"1 1 auto",marginTop:6,marginInlineStart:8,alignSelf:"flex-start"},title:{height:9,width:"40%",borderRadius:8,backgroundColor:O().Tj.background.tertiaryTranslucent},location:{marginTop:9,height:9,width:"60%",borderRadius:8,backgroundColor:O().Tj.background.tertiaryTranslucent},showMoreContainer:{marginTop:-2,marginInlineEnd:14,marginBottom:0,marginInlineStart:18,display:"flex",alignItems:"center"},showMore:{marginTop:3,height:9,width:"40%",borderRadius:8,backgroundColor:O().Tj.background.tertiaryTranslucent}})),[]),o=Ro().Hn(e,(e=>(0,z.jsxs)("div",{style:t.shimmerContainer,children:[(0,z.jsx)("div",{style:t.circleContainer,children:(0,z.jsx)(Qe().P,{style:t.circle})}),(0,z.jsxs)("div",{style:t.sourceContainer,children:[(0,z.jsx)(Qe().P,{style:t.title}),(0,z.jsx)(Qe().P,{style:t.location})]})]},e))),n=(0,z.jsxs)("div",{style:t.showMoreContainer,children:[(0,z.jsx)("div",{style:t.circleContainer,children:(0,z.jsx)(Qe().P,{style:t.circle})}),(0,z.jsx)("div",{style:t.sourceContainer,children:(0,z.jsx)(Qe().P,{style:t.showMore})})]});return(0,z.jsxs)("div",{style:t.container,children:[o,n]})}var sa=()=>o(562969);function ca({collectionContextStore:e,suggestionConfig:t,inputValue:o}){const n=(0,v().tz)(),i=(0,s().K8)((()=>function({collectionContextStore:e,suggestionConfig:t}){if("noSuggestions"===t.type)return[];const o="viewModuleTab"===t.type?t.collectionParentCollectionViewBlockStore:null==e?void 0:e.collectionViewBlockStore();if(!o)return[];if(o.getCollectionPointerIfSingleSource())return[];return o.getOwnedAndLinkedCollectionStores()}({collectionContextStore:e,suggestionConfig:t})),[e,t]),r=(0,s().K8)((()=>function({suggestedCollections:e,inputValue:t,suggestionConfig:o,intl:n}){const i=e.filter((e=>e.id!==function(e){switch(e.type){case"sourceView":case"relation":return e.currentValue;case"viewModuleTab":case"newView":case"noSuggestions":return;default:(0,b().HB)(e)}}(o))).filter((e=>e.canRead()));return(0,nt().Ay)(t,i,(e=>(0,sa().getCollectionNameOrDefault)({collectionStore:e,intl:n})),{minScore:nt().qR})}({suggestedCollections:i,inputValue:o,suggestionConfig:t,intl:n})),[i,o,t,n]);return r}const da=5,ua=20,pa=20;function ga(e){const{input:t,handleAcceptExistingCollection:o,hideSearchTitle:i,collectionContextStore:r,collectionStore:a,parentStore:c,context:d,peopleBlocksToInclude:u,suggestionConfig:p,searchResultsItemsLimit:g=ua,isSearchSurfacesHookEnabled:m=!1,showLoadMoreResultsButton:S=!1,requireEditPermissions:v=!1}=e,b=ca({collectionContextStore:r,suggestionConfig:p,inputValue:t}),C=(0,l().v3)(),[j,w]=(0,n.useState)(da),A=(0,n.useRef)(!1);(0,ta().ZC)(t)!==t&&(A.current=!1),(0,n.useEffect)((()=>{m||(t.length>0&&j===da?w(ua):0===t.length&&j===ua&&w(da))}),[t.length,m,j]);const{results:I,isResultsLoading:_,searchSessionId:T,fetchAdditionalServerResultsOnChange:k,hasMoreResults:M,searchSessionFlowNumber:P}=(0,ia().W)({query:t,limit:g,source:"collection_settings_source",type:oa().Vz.CollectionsInSpace,options:{disable:!m},peopleBlocksToInclude:"all"}),B=(0,n.useRef)(0),V=P+B.current,[F]=(0,et().Yb)((async()=>{if(m)return;const e=await ya({query:t,limit:j,parentStore:c,environment:C,searchSessionId:T,peopleBlocksToInclude:u,collectionContextStore:r,requireEditPermissions:v});return B.current+=1,e}),[m,t,j,c,C,T,r,v,u],{debounce:la().tu}),D=(0,h().IS)((()=>({showMoreButton:{color:O().Tj.text.secondary,fill:O().Tj.icon.secondary}})),[]),E=(0,s().K8)((()=>F&&"pending"===F.status||_),[_,F]),{resultsSectionItems:R,hasResults:K}=(0,s().K8)((()=>{if("rejected"===F.status)return{resultsSectionItems:[],hasResults:!1};const{results:e,showMore:n}=F.value??{results:[],showMore:0},i=m?I.flatMap((e=>e.store.getOwnedCollectionStores())):e.map((e=>xt().m.createChildStore(c,{table:Wl().Vl,id:e}))),l=new Set(b.map((e=>e.id))),s=(0,Ro().oE)(i).filter((e=>{if(l.has(e.id))return!1;if(d===ha.Source){if(e.id===(null==a?void 0:a.id))return!1;const t=e.getParentBlockStore();return(null==t?void 0:t.id)!==c.id}return!v||e.canEditCollection()})),u=s.map(((e,n)=>({key:e.id,render:t=>(0,z.jsx)(ma,{...t,itemCollectionStore:e,selfCollectionStore:a,collectionContextStore:r,context:d}),action:i=>{o(e),(0,y().u)({environment:C,event:{eventName:"source_collection_search_item_click",eventProperties:{index:b.length+n,search_session_id:T,source:"source",using_secondary_search_surfaces_hook:m,query_length:t.length,reciprocal_rank:1/(n+1),search_session_flow_number:V,total_results:b.length+s.length}}})}})));if(E&&u.push({key:"loading",render:e=>(0,z.jsx)("div",{style:{paddingTop:f().A.isMobile?10:0},children:(0,z.jsx)(aa,{numShimmers:Math.min(g,5)})}),action:()=>{}}),!m&&n>0&&!E){const e={key:"showMore",render:e=>(0,z.jsx)($().A,{...e,buttonStyle:D.showMoreButton,icon:(0,z.jsx)(H().I,{icon:Dl().ellipsisIcon}),title:ea().A.formatMessage(fa.showMore,{showMore:n})}),action:()=>w((e=>e+pa))};u.push(e)}else if(m&&(0===t.length||S)&&!E&&!A.current&&M&&k){const e={key:"showMore",render:e=>(0,z.jsx)($().A,{...e,buttonStyle:D.showMoreButton,icon:(0,z.jsx)(H().I,{icon:Dl().ellipsisIcon}),title:ea().A.formatMessage(fa.showMoreWithoutCount)}),action:()=>{k(g),A.current=!0}};u.push(e)}return u.length>0?{resultsSectionItems:u,hasResults:!0}:{resultsSectionItems:[{key:"noResults",render:e=>(0,z.jsx)(Cn().A,{caption:ea().A.formatMessage(fa.noResults),style:{marginInlineStart:1},...e}),action:()=>{}}],hasResults:!1}}),[F.status,F.value,m,I,b,E,t.length,S,M,k,c,d,v,a,r,o,C,T,V,g,D.showMoreButton]),N=b.map(((e,n)=>({key:`suggested-${e.id}`,render:t=>(0,z.jsx)(ma,{...t,itemCollectionStore:e,selfCollectionStore:a,collectionContextStore:r,context:d}),action:()=>{o(e),(0,y().u)({environment:C,event:{eventName:"source_collection_search_item_click",eventProperties:{index:n,search_session_id:T,source:"source",using_secondary_search_surfaces_hook:m,query_length:t.length,reciprocal_rank:1/(n+1),search_session_flow_number:V,total_results:b.length+R.length}}})}}))),L=(0,n.useMemo)((()=>N.length>0?{key:"suggested",items:N,render:e=>(0,z.jsx)(x().A,{title:ea().A.formatMessage(fa.suggestedDatabases),...e})}:void 0),[N]),U=(0,n.useMemo)((()=>({key:"results",items:R,render:e=>(0,z.jsx)(x().A,{title:!i&&ea().A.formatMessage(fa.existingDataSources),...e})})),[i,R]);return{suggestedSection:L,resultsSection:U,fetchMoreResults:!E&&k?k:void 0,searchSessionFlowNumber:V,searchSessionId:T,hasResults:K}}const ma=n.forwardRef((function(e,t){const{itemCollectionStore:o,selfCollectionStore:n,collectionContextStore:i,context:r,...l}=e,a=(0,s().K8)((()=>{var e;if(r===ha.Relation)return(null==n?void 0:n.id)??(null==i||null===(e=i.collectionViewStore())||void 0===e||null===(e=e.getCollectionStore())||void 0===e?void 0:e.id)}),[r,n,i]);return(0,z.jsx)(na().A,{...l,store:o,right:a===o.id?(0,z.jsx)(Sa,{}):void 0})}));function Sa(){const e=(0,v().tz)();return(0,z.jsx)(Ye().m,{renderTooltip:()=>e.formatMessage(fa.thisDatabase),render:e=>(0,z.jsx)(H().I,{icon:lr().infoCircleSmallIcon,size:"sm",...e})})}async function ya(e){const{query:t,limit:o,environment:n,parentStore:i,searchSessionId:r,peopleBlocksToInclude:l,collectionContextStore:a,requireEditPermissions:s}=e,{sidebarSpaceStore:c}=ze().default.state,d=null==a?void 0:a.collectionViewBlockStore(),u=await ra().T.searchActions.load(),p=await u.searchCollectionsWithRecents({environment:n,collectionViewBlockStore:d,parentStore:i,spaceStore:c,query:t,limit:o,requireEditPermissions:s,searchSessionId:r,peopleBlocksToInclude:l});return{results:p.results,showMore:Math.max(0,p.total-p.results.length)}}const fa=(0,v().YK)({showMore:{defaultMessage:"Show {showMore} more",id:"database.viewSettings.searchCollections.showMore.title"},noResults:{defaultMessage:"No results",id:"database.viewSettings.searchCollections.noResults.title"},existingDataSources:{defaultMessage:"Existing data sources",id:"database.viewSettings.createViewTab.existingDataSources"},suggestedDatabases:{defaultMessage:"Suggested",id:"database.viewSettings.searchCollections.suggestedDatabases"},showMoreWithoutCount:{defaultMessage:"Show more",id:"database.viewSettings.searchCollections.showMore.titleWithoutCount"},thisDatabase:{defaultMessage:"This database",id:"database.viewSettings.searchCollections.thisDatabase.tooltip"}});let ha=function(e){return e[e.Source=0]="Source",e[e.Relation=1]="Relation",e}({});const xa=(0,v().YK)({linkedInputPlaceholder:{defaultMessage:"Link to a data sourceâ€¦",id:"database.viewSettings.searchCollections.linkedInputPlaceholder"},linkedOrSourceInputPlaceholder:{defaultMessage:"Link or create a data sourceâ€¦",id:"database.viewSettings.searchCollections.linkedOrSourceInputPlaceholder"}}),va=St().Store.createClass("",{name:"InputStore"}),ba=n.memo((function(e){const{collectionContextStore:t,context:o,parentStore:i,onAccept:r,inputStore:a,requireEditPermissions:c,collectionStore:d,suggestionConfig:u}=e,p=(0,l().v3)(),g=(0,v().tz)(),m=(0,s().uB)(a,va),S=(0,s().uB)(void 0,Xl().$),h=(0,n.useRef)(0),C=(0,s().O$)(m),{suggestedSection:j,resultsSection:w,fetchMoreResults:A,searchSessionId:I,searchSessionFlowNumber:_}=ga({input:C,handleAcceptExistingCollection:r,collectionContextStore:t,parentStore:i,context:o,requireEditPermissions:c,collectionStore:d,suggestionConfig:u,peopleBlocksToInclude:"none"});(0,n.useEffect)((()=>{h.current=_}),[_]);const T=(0,s().K8)((()=>"on"===$e().default.getEligibleGroup({experimentId:"search_surfaces_collection_search",defaultGroup:"unassigned"})),[]);(0,n.useEffect)((()=>((0,y().u)({environment:p,event:{eventName:"source_collection_search_open",eventProperties:{search_session_id:I,using_secondary_search_surfaces_hook:T,source:"relation"}}}),()=>{(0,y().u)({environment:p,event:{eventName:"source_collection_search_close",eventProperties:{search_session_id:I,source:"relation",using_secondary_search_surfaces_hook:T,search_session_flow_number:h.current}}})})),[p,T,I]);const k="uninitialized"===(0,s().K8)((()=>null==t?void 0:t.getCollectionViewBlockSourceState()),[t])?xa.linkedOrSourceInputPlaceholder:xa.linkedInputPlaceholder;return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(x().A,{isInput:!0,children:(0,z.jsx)(mt().Ay,{focusInitial:!f().A.isMobile||void 0,value:C,onChange:e=>{m.setState(e.target.value),S.setState({focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})},placeholder:g.formatMessage(k),showClearButton:!0})}),(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:0,sections:[j,w].filter(b().O9),store:S}),T?(0,z.jsx)(Yl().A,{onChange:(e,t)=>{A&&e<Zl().A.incrementScrollOffset&&A()}}):null]})}),Jl().A);var Ca=()=>o(212497),ja=()=>o(187820);const wa=2e4,Aa=100;var Ia=()=>o(792071),_a=()=>o(979340);var Ta=()=>o(158661),ka=()=>o(72135);const Ma={type:"aggregation",filter:void 0,aggregation:{aggregator:"count",property:"title"}};function Pa({collectionContextStore:e}){const t=(0,v().tz)(),i=(0,h().IS)((()=>({menuItem:{color:O().Tj.text.secondary,paddingInlineStart:f().A.isMobile?4:8}})),[]),r=(0,s().K8)((()=>{var t;return"row_limit_exceeded"===(null===(t=e.collectionStore())||void 0===t||null===(t=t.getFormatStore())||void 0===t?void 0:t.getKeyStore("sync_state").getKeyStore("syncing").getValue())}),[e]),l=(0,s().O$)(ze().AppStoreSidebarSpaceStore),a=(0,s().K8)((()=>function(e){if(!e)return wa;const t=Ia().Bj6.fromSpace(e),o=t.getSetting("database_sync_row_limit");return void 0!==o?o:(0,_a().dL)(t.getSubscriptionTier())?Aa:wa}(null==l?void 0:l.getModel())),[l]),c=(0,s().K8)((()=>(0,_a().dL)(null==l?void 0:l.getSubscriptionTier())),[l]),d=(0,n.useMemo)((()=>(0,z.jsx)(o(101981).A,{id:"table:uncategorized:title:count",collectionContextStore:e,reducer:Ma,render:e=>{const o=e.state;if(!o||"aggregation"!==o.type)return;if("number"!==o.aggregationResult.type)return;const n={...o.aggregationResult,value:o.aggregationResult.value&&Math.min(a,o.aggregationResult.value)};return(0,ka().ZV)(n.value,"number_with_commas",t)}})),[e,t,a]);return(0,z.jsx)(re().Ay,{title:(0,z.jsxs)("span",{style:{display:"inline-flex",alignItems:"center"},children:[r&&l&&c?(0,z.jsx)(Ye().m,{placement:"left",alignment:"center",renderTooltip:()=>(0,z.jsx)(v().sA,{id:"database.viewSettings.syncedSourceTab.limitFree.toolTip",defaultMessage:"Free Plans are limited to 1 synced database with up to 100 rows."}),render:e=>(0,z.jsx)("div",{...e,children:(0,z.jsx)(H().I,{icon:Ta().exclamationMarkTriangleFillSmallIcon,size:"xs",colorPalette:"orange",colorVariant:"accentPrimary"})})}):void 0,(0,z.jsx)(v().sA,{defaultMessage:"Limit",id:"database.viewSettings.syncedSourceTab.limit"})]}),right:(0,z.jsx)(v().sA,{defaultMessage:"{value}/{limit} rows",id:"database.viewSettings.syncedSourceTab.limitRows",values:{value:d,limit:(0,ka().ZV)(a,"number_with_commas",t)}}),style:i.menuItem})}const Ba=n.memo(Pa,Jl().A);var Va=()=>o(929219),Fa=()=>o(763884),Da=()=>o(815585),Ea=()=>o(198491);function Oa({collectionContextStore:e}){const t=(0,s().K8)((()=>e.collectionStore()),[e]),[n,i]=(0,s().K8)((()=>{const e=null==t?void 0:t.getFormatStore();return[null==e?void 0:e.getKeyStore("uri").getValue(),null==e?void 0:e.getKeyStore("bot_id").getValue()]}),[t]),r=(0,s().O$)(ze().AppStoreSidebarSpaceStore),l=(0,s().K8)((()=>{var e;if(!n||!r)return;const t=null===(e=(0,Bn().cl)(n,r.getSpaceId()))||void 0===e?void 0:e.id;if(!t)return;const i=(0,o(462853).l)(t);return i||void 0}),[n,r]);return l?(0,z.jsx)(Ra,{collectionContextStore:e,uri:n,botId:i,featureName:l}):(0,z.jsx)(Ka,{collectionContextStore:e,uri:n,botId:i,upsellInfo:void 0})}function Ra({collectionContextStore:e,uri:t,botId:o,featureName:n}){const i=(0,s().K8)((()=>null==e?void 0:e.collectionStore()),[e]),r=(0,Vn().uF)({featureName:n,collectionStore:i});return(0,z.jsx)(Ka,{collectionContextStore:e,uri:t,botId:o,upsellInfo:r})}function Ka({collectionContextStore:e,uri:t,botId:o,upsellInfo:i}){const r=(0,l().v3)(),a=(0,h().IS)((()=>({menuItem:{color:O().Tj.text.secondary,paddingInlineStart:f().A.isMobile?4:8}})),[]),c=!(0,s().O$)(Va().e),d=c||i&&!i.isAvailable,u=(0,s().K8)((()=>e.collectionStore()),[e]),p=(0,s().O$)(ze().AppStoreSidebarSpaceStore),g=(0,s().K8)((()=>{var t;const o=e.numberChildrenUnfurledStore.state,n=e.numberChildrenReceivedStore.state,i=o/n,r=!0===(null===(t=e.collectionStore())||void 0===t||null===(t=t.getFormat().sync_state)||void 0===t?void 0:t.syncing),l=o&&n&&i<1&&!f().A.isMobile,a=r&&f().A.isMobile;return l||a}),[e]),m=(0,s().K8)((()=>{const e=p&&(0,_a().dL)(p.getSubscriptionTier());return{defaultMessage:e?"Clear and sync database":"Sync database",description:e?"Clears and refreshes the database ":"Refreshes the synced database."}}),[p]),[S,y]=(0,n.useState)(void 0);(0,n.useEffect)((()=>{if(t&&o){const e=`${o}:${t}`,n=Fa().K.get({userId:r.currentUser.id,key:e});y(n)}}),[o,r,t]);const x=!S||S<Date.now();return t&&o?g?(0,z.jsx)(re().Ay,{title:(0,z.jsx)(v().sA,{defaultMessage:"Syncing",id:"database.viewSettings.syncedSourceTab.isSyncing"}),icon:(0,z.jsx)(H().I,{icon:gn().a,className:"sync-spinner"}),style:a.menuItem}):x?(0,z.jsx)(Ye().m,{renderTooltip:()=>c?(0,z.jsx)(v().sA,{defaultMessage:"Unavailable offline",id:"database.viewSettings.syncedSourceTab.syncNow.offlineTooltip"}):null!=i&&i.upsellTier?(0,z.jsx)(Ea().A,{upsellTier:i.upsellTier,expirationDate:i.expirationDate}):null,placement:"left",disableTooltip:!d,render:e=>(0,z.jsx)(so().A,{isGray:!0,title:(0,z.jsx)(v().sA,{defaultMessage:"{message}",id:"database.viewSettings.syncedSourceTab.syncNow",values:{message:m.defaultMessage,description:m.description}}),icon:gn().a,onClick:async()=>{const e=null==u?void 0:u.id,n=!0===(null==u?void 0:u.getFormat().stale);e&&await R().cJ({environment:r,uri:t,botId:o,collectionId:e,nextSync:S,setNextSync:y,isStale:n})},disabled:d,...e})}):(0,z.jsx)(re().Ay,{title:(0,z.jsx)(v().sA,{defaultMessage:"Sync available in {timeToNextSync}",id:"database.viewSettings.syncedSourceTab.syncNow.disabled",values:{timeToNextSync:(0,Da().OH)(Date.now(),S)}}),icon:(0,z.jsx)(H().I,{icon:mn().i}),style:a.menuItem}):null}const Na=n.memo(Oa,Jl().A);function za({collectionContextStore:e}){var t;const n=(0,l().v3)(),i=(0,h().IS)((()=>({menuItemTitle:{paddingInlineStart:f().A.isMobile?4:8},menuItemIcon:{height:16,width:16,marginInlineEnd:2}})),[]),r=(0,s().K8)((()=>e.collectionStore()),[e]),[a,c,d]=(0,s().K8)((()=>{const e=null==r?void 0:r.getFormatStore();return[null==e?void 0:e.getKeyStore("uri").getValue(),null==e?void 0:e.getKeyStore("bot_id").getValue(),null==e?void 0:e.getKeyStore("original_url").getValue()]}),[r]),u=null==r||null===(t=r.pointer)||void 0===t?void 0:t.spaceId,p=(0,s().K8)((()=>(0,Bn().fH)(d,u)),[u,d]),g=(0,s().K8)((()=>e.collectionViewBlockStore()),[e]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(x().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Source database",id:"database.viewSettings.syncedSourceTab.sourceDatabase"}),children:(0,z.jsx)(Ye().m,{placement:"left",alignment:"center",renderTooltip:()=>g&&(0,z.jsx)(o(706965).A,{store:g,compactFormat:!0}),render:e=>(0,z.jsx)(re().Ay,{...e,title:p,icon:(0,z.jsx)(ja().B6,{disabled:!0,icon:null==r?void 0:r.getIcon(),iconRecordCategory:"collection",isEmptyPage:!1,size:20,style:i.menuItemIcon}),style:i.menuItemTitle})}),style:{paddingBottom:0}}),(0,z.jsx)(x().A,{children:(0,z.jsx)(Ba,{collectionContextStore:e})}),(0,z.jsxs)(x().A,{topBorder:!0,children:[(0,z.jsx)(Na,{collectionContextStore:e}),(0,z.jsx)(so().A,{isGray:!0,title:(0,z.jsx)(v().sA,{defaultMessage:"Copy debugging information",id:"database.viewSettings.syncedSourceTab.copyDebugging"}),icon:o(536583).d,onClick:async()=>{const[e,t]=await Promise.all([(0,o(692031).r)(),(0,Ca().jd)()]),i={uri:a,botId:c,spaceId:u};t({environment:n,stringValue:JSON.stringify(i,null,2),copiedMessage:e.copiedToClipboard})}}),(0,z.jsx)(Po().N,{href:`${f().A.domainBaseUrl}?target=connected_apps`,children:(0,z.jsx)(so().A,{icon:o(212473).arrowUpRightSquareIcon,title:(0,z.jsx)(v().sA,{defaultMessage:"Manage my connections",id:"database.viewSettings.syncedSourceTab.manageConnections"}),isGray:!0})}),(0,z.jsx)(Ml().A,{href:(0,Lo().x)("guides.syncedDatabases"),title:(0,z.jsx)(v().sA,{defaultMessage:"Learn about synced databases",id:"database.viewSettings.syncedSourceTab.learnMoreButton.title."}),analyticsFrom:"view_settings_source"})]})]})}const La=n.memo(za,Jl().A);function Ua(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,i=(0,l().v3)(),{collectionViewBlockStore:r,collectionStore:a,shouldRenderSyncedSourceTab:c}=(0,s().K8)((()=>{const e=t.collectionViewBlockStore(),o=t.collectionStore(),n=(null==o?void 0:o.getParentId())===(null==e?void 0:e.id),i=(null==o?void 0:o.isSyncedCollection())||(null==o?void 0:o.isExternalSyncedCollection());return{collectionViewBlockStore:e,collectionStore:o,shouldRenderSyncedSourceTab:n&&i}}),[t]),d=(0,n.useMemo)((()=>St().Store.createValue("")),[]),u=(0,s().K8)((()=>{var e;return{type:"sourceView",currentValue:null===(e=t.collectionStore())||void 0===e?void 0:e.id}}),[t]);return r?(0,z.jsx)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Source",id:"database.viewSettings.sourceTab.title"}),handleClose:()=>R().os({collectionSettingsStore:o}),children:c?(0,z.jsx)(La,{collectionContextStore:t}):(0,z.jsx)(ba,{collectionContextStore:t,parentStore:r,onAccept:e=>function(e,t,o,n){A().createAndCommit({userAction:"CollectionSettingsViewSource.handleSourcePickerAccept",environment:t,canUndo:!0,perform:n=>{ql({environment:t,collectionContextStore:o,source:{type:"collection",id:e.id,spaceId:e.getSpaceId()},transaction:n})}}),R().yl({collectionSettingsStore:n})}(e,i,t,o),collectionStore:a,context:bo().U9.Source,inputStore:d,suggestionConfig:u})}):null}const Wa=n.memo(Ua);var Ha=()=>o(302655),$a=()=>o(259476),Ga=()=>o(912720),Qa=()=>o(813297),qa=()=>o(254497),Ya=()=>o(447934);const Xa=(0,v().YK)({delete:{defaultMessage:"Delete",id:"database.deletedProperties.delete"},undo:{defaultMessage:"Undo",id:"database.deletedProperties.undo"},permanentlyDeleteAll:{defaultMessage:"Permanently delete all",id:"database.deletedProperties.permanentlyDeleteAll"}});function Ja({collectionSettingsStore:e,collectionContextStore:t,timelineViewTab:i}){const r=(0,l().v3)(),a=(0,h().DP)(),c=(0,s().O$)(t.normalizedDeletedSchemaStore),d=(0,v().tz)(),u=(0,h().IS)((()=>({permanentlyDeleteDescription:{color:O().Tj.text.secondary,fontSize:14,fontWeight:We().Wy.regular,marginTop:7,marginBottom:16}})),[]),p=(0,o(7667).A)(),g=(0,n.useCallback)((o=>{var n;p(o);const r=(0,bo().ZI)({timelineViewTab:i,collectionContextStore:t});R().yl({collectionSettingsStore:e}),"read_only"!==(null===(n=c[o])||void 0===n?void 0:n.synced_permissions)&&R().a2({collectionSettingsStore:e,item:{type:"property",property:o,formatKey:r}})}),[t,e,c,p,i]),m=(0,n.useMemo)((()=>Object.entries(c).map((([e,t])=>{if(t)return{propertyId:e,propertySchema:t}})).filter(b().O9)),[c]),S=(0,n.useCallback)((()=>0===m.length?(0,z.jsx)(x().A,{children:(0,z.jsx)(re().Ay,{title:(0,z.jsx)(v().sA,{defaultMessage:"No results",id:"database.viewSettings.deletedPropertiesTab.noResults"})})}):(0,z.jsx)(x().A,{extraPadding:!0,children:m.map((({propertyId:e,propertySchema:n})=>(0,z.jsx)(re().Ay,{title:(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,z.jsx)(Je().zB,{type:n.type,icon:n.icon,size:D().Ev.sm,theme:a,style:{fill:O().Tj.icon.primary}}),(0,z.jsx)("span",{style:{marginInlineStart:6,maxWidth:200,...We().RC},children:n.name})]}),right:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Fl().A,{icon:o(613601).arrowUTurnUpLeftSmallIcon,iconStyle:{width:D().Ev.sm,height:D().Ev.sm},ariaLabel:d.formatMessage(Xa.undo),onClick:()=>g(e)}),(0,z.jsx)(Fl().A,{icon:$a().trashSmallIcon,iconStyle:{width:D().Ev.sm,height:D().Ev.sm},ariaLabel:d.formatMessage(Xa.delete),onClick:()=>{!async function(e,t,o){const{automationActions:n}=await Qa().QV.automations.load();To().ui({message:(0,z.jsx)(v().sA,{id:"database.viewSettings.deletedPropertiesTab.permanentlyDeleteProperty.modal.prompt",defaultMessage:"Are you sure you want to delete this property?"}),showCancel:!0,keepFocus:!0,items:[{label:(0,z.jsx)(v().sA,{id:"database.viewSettings.propertyTab.deleteProperty.modal.confirmButton",defaultMessage:"Delete"}),color:"red",onAccept:async()=>{const i=t.collectionStore();if(i){const t=i.getLayoutStore();await(null==t?void 0:t.load()),A().createAndCommit({userAction:"CollectionSettingsDeletedProperties.handlePermanentlyDeleteDeletedPropertyClick",environment:o,canUndo:!0,perform:r=>{es(e,o,i,r,n.deleteAutomation,t),(0,qa().E)({collectionStore:i,update:{[e]:null},transaction:r})}})}}}]})}(e,t,r)}})]})},e)))})),[t,m,r,g,a,d]),y=(0,n.useCallback)((()=>0===m.length?null:(0,z.jsx)(x().A,{topBorder:!0,extraPadding:!0,children:(0,z.jsx)(so().A,{title:d.formatMessage(Xa.permanentlyDeleteAll),icon:$a().trashSmallIcon,isGray:!0,onClick:()=>{!async function(e,t,o,n){const{automationActions:i}=await Qa().QV.automations.load();To().ui({message:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(v().sA,{id:"database.viewSettings.deletedPropertiesTab.permanentlyDeleteAll.modal.prompt",defaultMessage:"Permanently delete all properties?"}),(0,z.jsx)("div",{style:n.permanentlyDeleteDescription,children:(0,z.jsx)(v().sA,{id:"database.viewSettings.deletedPropertiesTab.permanentlyDeleteAll.modal.description",defaultMessage:"This action cannot be undone."})})]}),showCancel:!0,keepFocus:!0,items:[{label:(0,z.jsx)(v().sA,{id:"database.viewSettings.propertyTab.deleteAllProperties.modal.confirmButton",defaultMessage:"Permanently Delete"}),color:"red",onAccept:async()=>{const n=t.collectionStore();if(!n)return;const r=n.getLayoutStore();await(null==r?void 0:r.load()),Ze().log({level:"info",type:"collectionPermanentlyDeleteAllProperties",from:"CollectionSettingsDeletedProperties",data:{miscDataToConvertToString:{collectionId:n.id,spaceId:n.getSpaceId(),deletedPropertyCount:e.length}}}),A().createAndCommit({userAction:"CollectionSettingsDeletedProperties.handlePermanentlyDeleteAllPropertiesClick",environment:o,canUndo:!0,perform:t=>{const l={};e.forEach((e=>{const{propertyId:a}=e;es(a,o,n,t,i.deleteAutomation,r),l[a]=null})),(0,qa().E)({collectionStore:n,update:l,transaction:t})}})}}]})}(m,t,r,u)}})})),[m,t,r,d,u]);return(0,z.jsx)(C().A,{collectionSettingsStore:e,title:(0,z.jsx)(v().sA,{defaultMessage:"Deleted properties",id:"database.viewSettings.propertyTab.deletedTitle"}),footer:y(),children:S()})}const Za=n.memo(Ja,Jl().A);function es(e,t,o,n,i,r){r&&(0,Ya().HD)({environment:t,layoutStore:r,property:e,transaction:n});const l=function(e,t){const o=e.getDeletedSchema(),n=o[t];if((0,b().O9)(n)&&(0,ae().nu)(n)&&n.automation_id)return Ha().d.createChildStore(e,{id:n.automation_id,spaceId:e.getSpaceId(),table:Ga().yB})}(o,e);l&&i({automationStore:l,environment:t,transaction:n})}var ts=()=>o(221844),os=()=>o(852507),ns=()=>o(118884),is=()=>o(760077),rs=()=>o(819757),ls=()=>o(680288),as=()=>o(306499);const ss=(0,v().YK)({inputPlaceholder:{defaultMessage:"Search for a viewâ€¦",id:"database.viewSettings.duplicateExistingViewTab.inputPlaceholder"}}),cs=7;function ds(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,i=(0,l().v3)(),r=(0,v().tz)(),a=(0,n.useMemo)((()=>new(ts().A)({name:"CollectionSettingsDuplicateExistingView"})),[]),c=(0,s().uB)(void 0,Xl().$),[d,u]=(0,n.useState)(""),p=(0,n.useRef)({lastDuplicatedViewId:void 0,didAccept:!1,wentBack:!1,initialViewType:void 0,preselectedViewPointer:void 0}),g=(0,s().O$)(t.collectionSettingsDuplicateExistingViewLimitStore),m=(0,n.useCallback)((e=>{t.collectionSettingsDuplicateExistingViewLimitStore.setState(e)}),[t.collectionSettingsDuplicateExistingViewLimitStore]),S=(0,n.useCallback)(((e,o)=>{if(e.id===p.current.lastDuplicatedViewId&&o)return;p.current.lastDuplicatedViewId=e.id;const n=t.collectionViewStore();if(!n)return;let r=n;o&&(r=n.clone(a)),(0,is().U)({viewToDuplicateStore:e,collectionContextStore:t,collectionViewStore:n,environment:i,temporaryStore:r})}),[t,i,a]);(0,os().w)((()=>{const e=t.collectionViewStore();if(!e)return;const o=(0,as().v)(e.id);p.current.preselectedViewPointer=null==o?void 0:o.viewPointer,i.defaultRecordCache.inMemoryRecordCache.addCacheOverride(a),p.current.initialViewType=e.getType()})),(0,ns().X)((()=>{const e=p.current;if(i.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(a),!e.didAccept&&!e.wentBack){const{viewStores:o}=ps(t,d,g),n=o.find((t=>t.id===e.lastDuplicatedViewId));if(!n)return;S(n,!1)}}));const y=(0,n.useCallback)((e=>{if(void 0===e)return p.current.lastDuplicatedViewId=void 0,void a.clearCache();S(e,!0)}),[S,a]),h=(0,W().Y)(y,500);(0,s().K8)((()=>{const e=c.state;if(f().A.isMobile||void 0===e.focus.indexLocal)return;const o=d.length>0;if(!o&&0===e.focus.section||o&&1===e.focus.section)return void h(void 0);const n=ps(t,d,g).viewStores,i=e.focus.indexLocal;if(i<0||i>=n.length)return;const r=n[i];h(r)}),[t,h,d,g,c]);const x=(0,n.useCallback)((e=>{i.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(a),(0,Sr().X)({environment:i,collectionContextStore:t,action:"click_duplicate_view"}),S(e,!1),R().R8({collectionSettingsStore:o,item:{type:"main",selectViewNameInitial:!0}}),p.current.didAccept=!0,m(!0)}),[t,o,S,i,m,a]),b=(0,n.useCallback)((()=>{(0,Sr().X)({environment:i,collectionContextStore:t,action:"click_new_empty_view"}),R().os({collectionSettingsStore:o}),R().a2({collectionSettingsStore:o,item:{type:"createView",analytics:void 0}}),p.current.didAccept=!0,m(!0)}),[t,o,i,m]),{viewStores:C,showMore:j}=(0,s().K8)((()=>ps(t,d,g)),[t,d,g]),w=(0,s().K8)((()=>(0,rs().f)(t)),[t]),A=(0,s().K8)((()=>{var e;return function(e){const{viewStores:t,showMore:o,preselectedViewPointerId:n,onDuplicateViewAccept:i,onShowMore:r,allowDashboardViews:l}=e,a=Ro().oE(t.map((e=>{const t=e.getType(),o=e.getFormat().collection_view_icon;if(!t||"page"===t||!l&&"dashboard"===t)return;const r=e.getName(),a=e.id,s={key:a,render:e=>(0,z.jsx)($().A,{...e,title:(0,z.jsx)(Ol().A,{collectionViewType:t,collectionViewName:r}),icon:(0,z.jsx)(El().h,{color:"regular",viewIcon:o,viewType:t,style:{marginInlineEnd:4,marginInlineStart:2}}),isChecked:n===a}),action:()=>{i(e)}};return s})));if(o>0){const e={key:"showMore",render:e=>(0,z.jsx)($().A,{...e,icon:(0,z.jsx)(H().I,{icon:Dl().ellipsisIcon,colorVariant:"secondary"}),style:{color:O().Tj.text.secondary},title:(0,z.jsx)(v().sA,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.duplicateExistingViewTab.showMore.title",values:{showMore:o}})}),action:()=>{r()}};a.push(e)}return a}({viewStores:C,showMore:j,preselectedViewPointerId:null===(e=p.current.preselectedViewPointer)||void 0===e?void 0:e.id,onDuplicateViewAccept:x,onShowMore:()=>{m(!1)},allowDashboardViews:w})}),[x,m,j,C,w]),I=(0,s().K8)((()=>(0,sa().getCollectionNameOrDefault)({intl:r,collectionStore:t.collectionStore()})),[t,r]),_=(0,n.useCallback)((e=>{u(e),c.setState({focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}}),m(!0)}),[c,m]),T=(0,n.useCallback)((()=>{p.current.wentBack=!0,R().yl({collectionSettingsStore:o})}),[o]);return(0,z.jsx)(us,{collectionSettingsStore:o,collectionName:I,inputValue:d,onInputValueChange:_,menuListItems:A,showMore:j,initialViewType:p.current.initialViewType,menuListStore:c,onNewEmptyViewClick:b,onBackArrowClick:T})}function us(e){const t=(0,v().tz)(),{collectionSettingsStore:o,collectionName:i,inputValue:r,menuListItems:l,showMore:a,initialViewType:s,menuListStore:c,onNewEmptyViewClick:d,onBackArrowClick:u,onInputValueChange:p}=e,g=(0,h().IS)((()=>({plusIconStyle:{color:O().Tj.icon.secondary}})),[]),m=(0,n.useMemo)((()=>{const e=s?ls().to[s].toLocaleLowerCase():void 0;return e?(0,z.jsx)(v().sA,{defaultMessage:"New {viewType} view",id:"database.viewSettings.createViewTab.newView1",values:{viewType:e}}):(0,z.jsx)(v().sA,{defaultMessage:"New view",id:"database.viewSettings.createViewTab.newView2"})}),[s]),S=(0,n.useMemo)((()=>({key:"emptyViewSection",items:[{key:"emptyViewMenuItem",render:e=>(0,z.jsx)(so().A,{...e,icon:jl().plusIcon,iconStyle:g.plusIconStyle,title:m}),action:d}],render:e=>(0,z.jsx)(x().A,{topBorder:r.length>0,...e})})),[m,r.length,d,g.plusIconStyle]);return(0,z.jsxs)(C().A,{collectionSettingsStore:o,title:(0,z.jsx)(v().sA,{defaultMessage:"New view",id:"database.viewSettings.createViewTab.newView"}),handleBackArrowClick:u,children:[a>0||r?(0,z.jsx)(x().A,{children:(0,z.jsx)(mt().Ay,{focusInitial:!f().A.isMobile||void 0,value:r,onChange:e=>{p(e.target.value)},placeholder:t.formatMessage(ss.inputPlaceholder),showClearButton:!0})}):null,(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:0,sections:Ro().oE([r.length?void 0:S,{key:"results",render:e=>0===l.length?(0,z.jsx)(Cn().A,{caption:(0,z.jsx)(v().sA,{defaultMessage:"No results",id:"database.viewSettings.duplicateExistingViewTab.noResultsTitle"})}):(0,z.jsx)(x().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Views on {collectionName}",id:"database.viewSettings.duplicateExistingViewTab.viewsTitle",values:{collectionName:i}}),...e}),items:l},r.length?S:void 0]),store:c})]})}function ps(e,t,o){const n=e.collectionViewBlockStore(),i=e.collectionStore(),r=e.collectionViewStore();if(!n||!i||!r)return{viewStores:[],showMore:0};const l=i.getParentBlockStore();if(!n||!l)return{viewStores:[],showMore:0};let a=(0,ur().Mf)({collectionStore:i,sourceCollectionViewBlockStore:l,currentCollectionViewBlockStore:n,currentCollectionViewStore:r,constraints:(0,as().v)(r.id)}),s=0;return t?a=a.filter((e=>(0,ur().As)(e,t))):o&&(s=a.length-cs,a=a.slice(0,cs)),{viewStores:a,showMore:s}}var gs=()=>o(135168),ms=()=>o(663807),Ss=()=>o(936802),ys=()=>o(651124),fs=()=>o(229833),hs=()=>o(797535);function xs(e){const{collectionStore:t,collectionViewStore:o,environment:n,selectedPropertyIds:i}=e;A().createAndCommit({environment:n,userAction:"updatePeopleCollectionScimPropertiesTransaction",perform:e=>{const r=t.getSchema(),l=(0,Ss().up)(),a=new Map(l.map((e=>[e.id,e])));let s={},c={};for(const t of Object.keys(r)){const e=a.has(t),o=i.has(t);e&&!o?c={...c,[t]:r[t]}:s={...s,[t]:r[t]}}for(const t of i)if(!(t in r)){const e=a.get(t);e&&(s={...s,[t]:{name:e.name,type:e.type,synced_permissions:"read_only"}})}(0,hs().I)({environment:n,collectionStore:t,update:{schema:s,deleted_schema:c},transaction:e}),function(e){const{collectionViewStore:t,newKeys:o,transaction:n}=e,i=t.getType();if(!i)return void Ze().log({level:"warning",from:"updatePeopleCollectionScimPropertiesTransaction",type:"collectionViewTypeNotFound",spaceId:t.getSpaceId(),data:{miscDataToConvertToString:{collectionViewType:i,collectionViewId:t.pointer.id}}});const r=(0,ys().u9)(i);if(!r)return void Ze().log({level:"warning",from:"updatePeopleCollectionScimPropertiesTransaction",type:"formatKeyNotFound",spaceId:t.getSpaceId(),data:{miscDataToConvertToString:{collectionViewType:i,collectionViewId:t.pointer.id}}});const l=t.getFormat()[r]||[],a=[],s=new Set;for(const c of l)o.has(c.property)&&(a.push(c),s.add(c.property));for(const c of o)s.has(c)||a.push({property:c,visible:!0});m().zA({stores:[t],update:{[r]:a},transaction:n})}({collectionViewStore:o,newKeys:new Set(Object.keys(s)),transaction:e})},canUndo:!1})}async function vs(e){const{collectionContextStore:t,environment:o,selectedPropertyIds:n}=e,i=t.collectionStore();if(!i)return;const r=t.collectionViewStore();r&&(xs({collectionStore:i,collectionViewStore:r,environment:o,selectedPropertyIds:n}),await async function(e){const{collectionStore:t,environment:o,from:n}=e,i=t.getSpaceId();try{const e=await kt().callApi({eventName:"scheduleReconcilePeopleCollection",environment:o,data:{spaceId:i}});"failed"===e.type&&Ze().log({level:"error",from:n,type:"scheduleReconcilePeopleCollectionFailed",error:(0,fs().convertErrorToLog)(e.error),spaceId:i})}catch(r){Ze().log({level:"error",from:n,type:"scheduleReconcilePeopleCollectionError",error:(0,fs().convertErrorToLog)(r),spaceId:i})}}({collectionStore:i,environment:o,from:"updatePeopleCollectionScimPropertiesTransaction"}))}var bs=()=>o(65402);function Cs(e){const{checkedProperties:t,collectionContextStore:o,intl:n,theme:i}=e,r=(0,l().v3)();return(0,z.jsxs)("div",{style:{display:"flex",flexDirection:"column",padding:4,textAlign:"center",gap:4},children:[(0,z.jsx)(re().Ay,{caption:(0,z.jsx)(v().sA,{defaultMessage:"{propertiesCount, plural, one {{propertiesCount} property selected} other {{propertiesCount} properties selected}}",id:"database.viewSettings.scimPropertiesTab.propertiesSelected",values:{propertiesCount:t.length}}),shouldWrapCaption:!0,captionStyle:{fontSize:14,color:i.text.secondary}}),(0,z.jsx)(M().A,{colorPalette:"blue",onClick:()=>{!function(e){const{checkedProperties:t,collectionContextStore:o,environment:n,intl:i,theme:r}=e,l=(0,gs().f)(o.collectionStore()),a=(null==l?void 0:l.getName())??"your workspace";To().ui({icon:(0,z.jsx)(H().I,{icon:ms().j,size:"xl"}),message:t.length>0?(0,z.jsx)(v().sA,{defaultMessage:"Everyone in {workspaceName} will see the following information",id:"database.viewSettings.scimPropertiesTab.dialogMessage",values:{workspaceName:a}}):(0,z.jsx)(v().sA,{defaultMessage:"No SCIM properties will be visible to members in {workspaceName}",id:"database.viewSettings.scimPropertiesTab.noVisibleScimProperties",values:{workspaceName:a}}),showCancel:!0,description:t.length>0?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)("div",{style:{display:"flex",flexDirection:"column",padding:12,background:r.background.secondaryTranslucent,borderRadius:8,gap:4},children:[(0,z.jsx)(P().D,{styleKey:"bodySemibold",colorVariant:"primary",children:i.formatMessage(bs().D.visibleToAllWorkspaceMembers)}),(0,z.jsx)("ul",{style:{textAlign:"start",margin:0,paddingInlineStart:20},children:t.map((e=>(0,z.jsx)("li",{children:(0,z.jsx)(P().D,{styleKey:"bodyRegular",children:e.name})},e.name)))})]}),(0,z.jsx)("div",{style:{textAlign:"center",paddingTop:12},children:(0,z.jsx)(P().D,{styleKey:"captionRegular",colorVariant:"secondary",children:i.formatMessage(bs().D.loadingDataMessage)})})]}):null,items:[{label:(0,z.jsx)(v().sA,{defaultMessage:"Continue",id:"database.viewSettings.scimPropertiesTab.continue"}),color:"blue",buttonType:"solid",onAccept:async()=>{const e=new Set(t.map((e=>e.id)));await vs({collectionContextStore:o,environment:n,selectedPropertyIds:e})}}],keepFocus:!0})}({checkedProperties:t,collectionContextStore:o,environment:r,intl:n,theme:i})},children:(0,z.jsx)(v().sA,{defaultMessage:"Update properties",id:"database.viewSettings.scimPropertiesTab.updatePropertiesButton"})})]})}function js(e,t){return{id:e.id,name:e.name,type:e.type,isSelected:t.has(e.id)}}function ws(e){const[t,o]=(0,n.useState)(""),i=(0,h().DP)(),r=(0,v().tz)(),l=(0,Ss().up)(),a=(0,s().K8)((()=>{const t=e.collectionContextStore.collectionStore();if(!t)throw new Error("Collection store not found");const o=t.getSchema(),n=Object.keys(o).filter((e=>l.some((t=>t.id===e))));return new Set(n)}),[e.collectionContextStore,l]),[c,d]=(0,n.useState)(a),u=(0,n.useMemo)((()=>l.filter((e=>!!e.name&&e.name.toLowerCase().includes(t.toLowerCase())))),[l,t]),p=(0,n.useCallback)((e=>{d((t=>{const o=new Set(t);return o.has(e)?o.delete(e):o.add(e),o}))}),[]),g=(0,n.useCallback)((e=>({key:e.id,render:t=>(0,z.jsx)($().A,{...t,focused:t.focused,onClick:()=>{p(e.id)},title:(0,z.jsx)("div",{children:e.name}),left:(0,z.jsx)("div",{children:(0,z.jsx)(qe().S,{size:14,checked:e.isSelected,onClick:()=>{p(e.id)},style:{borderRadius:2}})}),icon:(0,z.jsx)(Je().zB,{type:e.type,icon:void 0,size:D().Ev.sm,theme:i})}),action:()=>{}})),[p,i]);return(0,z.jsxs)(C().A,{collectionSettingsStore:e.collectionSettingsStore,title:(0,z.jsx)(v().sA,{defaultMessage:"SCIM Properties",id:"database.viewSettings.scimPropertiesTab.title"}),footer:(0,z.jsx)(Cs,{checkedProperties:l.filter((e=>c.has(e.id))).map((e=>js(e,c))),collectionContextStore:e.collectionContextStore,intl:r,theme:i}),children:[(0,z.jsx)(re().Ay,{caption:(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,z.jsx)("span",{children:(0,z.jsx)(v().sA,{defaultMessage:"Select which SCIM properties are visible on peopleâ€™s profiles",id:"database.viewSettings.scimPropertiesTab.caption"})}),(0,z.jsx)(Ye().m,{placement:"top",renderTooltip:()=>r.formatMessage(bs().D.learnMoreAboutScimAttributes),render:e=>(0,z.jsx)(Fl().A,{icon:oi().questionMarkCircleIcon,colorVariant:"tertiary",ariaLabel:r.formatMessage(bs().D.learnMoreAboutScimAttributes),href:"https://www.notion.com/help/provision-users-and-groups-with-scim#users",external:!0,...e})})]}),shouldWrapCaption:!0}),(0,z.jsx)(mt().Ay,{placeholder:r.formatMessage(bs().D.propertyInputPlaceholder),value:t,onChange:e=>o(e.target.value),style:{marginBottom:12}}),(0,z.jsx)(pt,{title:(0,z.jsx)(v().sA,{defaultMessage:"{checked, plural, one {1} other {#}} of {total} optional properties",id:"database.viewSettings.scimPropertiesTab.subtitle",values:{checked:c.size,total:l.length}}),disableCollapse:!0,disableSelectAll:!0,items:u.map((e=>js(e,c))).map(g)},"SCIM Properties")]})}var As=()=>o(158797),Is=()=>o(584262),_s=()=>o(413364),Ts=()=>o(343630),ks=()=>o(985156),Ms=()=>o(180762),Ps=()=>o(239529),Bs=()=>o(297175),Vs=()=>o(414360);var Fs=()=>o(245720),Ds=()=>o(334003),Es=()=>o(764781),Os=()=>o(267271),Rs=()=>o(517415),Ks=()=>o(962910),Ns=()=>o(496592),zs=()=>o(332690),Ls=()=>o(733539),Us=()=>o(810521),Ws=()=>o(495262),Hs=()=>o(345913);const $s=(0,v().YK)({deletedDataSource:{id:"collectionSettingsActions.dataSourceDeleted",defaultMessage:"Deleted {dataSourceName}"},deleteConfirmationTitle:{id:"collectionSettingsActions.deleteDataSourceConfirmation",defaultMessage:"Delete {dataSourceName}?"},deleteConfirmationDescriptionWithViews:{id:"collectionSettingsActions.deleteDataSourceConfirmationDescription",defaultMessage:"This will delete the data source and {numberOfViewsToDelete, plural, one {# view} other {# views}}."},deleteConfirmationDescriptionWithViewsAndDescription:{id:"collectionSettingsActions.deleteConfirmationDescriptionWithViewsAndDescription",defaultMessage:"This will delete the data source and {numberOfViewsToDelete, plural, one {# view} other {# views}}. Deleting it will also remove the database description."},deleteConfirmationButton:{id:"collectionSettingsActions.deleteDataSourceConfirmationButton",defaultMessage:"Delete data source"}});function Gs({collectionStore:e,parentBlockStore:t,relationPropertyUri:o,expectedType:n}){const i=e.getFormatStore().getKeyStore("app_uri_map").getValue();if(!i)return;const r=i[o];if(!r)return;const l=e.getSchemaStore().getKeyStore(r).getValue();if(!l||!ae().nC(l))return;const a=ae().Nv(l);if(!a)return;const s=xt().m.createChildStore(t,a);return s.getDatabaseType()===n?s:void 0}async function Qs({intl:e,environment:t,store:o,showToast:n=!0,showConfirmationDialog:i=!0,analytics:r}){var l,a;const s=(0,sa().getCollectionNameOrDefault)({collectionStore:o,intl:e}),c=o.getParentBlockStore();if(!c)return{result:"error"};const d=1===(null===(l=c.getCollectionStores())||void 0===l?void 0:l.length)&&!(0,pi().w9s)(o.getDescription()),u=(null===(a=c.getCollectionViewStores())||void 0===a?void 0:a.filter((e=>{var t;return(null===(t=e.getCollectionStore())||void 0===t?void 0:t.id)===o.id})))??[];if(i){let t;u.length>0&&(t=d?e.formatMessage($s.deleteConfirmationDescriptionWithViewsAndDescription,{numberOfViewsToDelete:u.length}):e.formatMessage($s.deleteConfirmationDescriptionWithViews,{numberOfViewsToDelete:u.length}));if(!(await To().Gh({message:e.formatMessage($s.deleteConfirmationTitle,{dataSourceName:s}),description:t,acceptLabel:e.formatMessage($s.deleteConfirmationButton)})).accept)return{result:"cancelled"}}const{sprintsCollectionStore:p,tasksCollectionStore:g}=function(e,t){const o=e.getDatabaseType();if(o===un().av){const o=Gs({collectionStore:e,parentBlockStore:t,relationPropertyUri:un().Hx.SprintToTaskRelation,expectedType:un().dC});if(o)return{sprintsCollectionStore:e,tasksCollectionStore:o}}if(o===un().dC){const o=Gs({collectionStore:e,parentBlockStore:t,relationPropertyUri:un().yx.TaskToSprintRelation,expectedType:un().av});if(o)return{sprintsCollectionStore:o,tasksCollectionStore:e}}return{sprintsCollectionStore:void 0,tasksCollectionStore:void 0}}(o,c);if(p&&g){const i=(0,sa().getCollectionNameOrDefault)({collectionStore:p,intl:e}),l=(0,sa().getCollectionNameOrDefault)({collectionStore:g,intl:e}),a=new Intl.ListFormat(e.locale,{style:"long",type:"conjunction"}).format([l,i]),d=await(0,Ks().h4)((0,Ks().kB)("delete",s,a),"delete");switch(d){case"cancel":return{result:"cancelled"};case"all":return function({environment:e,sprintsCollectionStore:t,tasksCollectionStore:o,parentBlockStore:n,analytics:i,toastMessage:r,showToast:l}){const a=n.getOwnedCollectionStores(),s=n.getLinkedCollectionStores(),c=new Set(a.map((e=>e.id))),d=2===a.length&&0===s.length&&c.has(t.id)&&c.has(o.id);A().createAndCommit({userAction:"dataSourceDeletionActions.deleteBothSprintsAndTasks",environment:e,canUndo:!0,perform:c=>{if(d)Hs().oD({environment:e,blocks:[n],transaction:c,permanentlyDelete:!1}),c.postSubmitCallbacks.push((async t=>{if(!t){await(0,zs().V)({environment:e,blocks:[n]});const t=Ls().default.state.undoStack.at(-1),o=Ls().default.state.invertedTextOperationIdMapper;setTimeout((()=>{t&&Ls().default.setState({undoStack:[t],redoStack:[],invertedTextOperationIdMapper:o}),l&&(0,Rs().r)({item:{label:r},undoFunc:()=>{Ws().tN({environment:e,preventSelectText:!0})}})}),200)}}));else{for(const r of[t,o])(0,Ns().removeCollectionFromCollectionViewBlock)({collectionViewBlockStore:n,collectionStore:r,transaction:c}),(0,Us().trackDeleteDataSource)(e,{collection_view_block_id:n.id,collection_id:r.id,owned_collection_count:a.length,linked_collection_count:s.length,data_source_session_id:i.dataSourceSessionId});l&&(0,Rs().r)({item:{label:r},undoFunc:()=>{Ws().tN({environment:e,preventSelectText:!0})}})}}})}({environment:t,sprintsCollectionStore:p,tasksCollectionStore:g,parentBlockStore:c,showToast:n,toastMessage:e.formatMessage($s.deletedDataSource,{dataSourceName:a}),analytics:r}),{result:"accepted"};case"one":return qs({environment:t,store:o,parentBlockStore:c,showToast:n,toastMessage:e.formatMessage($s.deletedDataSource,{dataSourceName:s}),analytics:r}),{result:"accepted"};default:(0,b().HB)(d)}}return qs({environment:t,store:o,parentBlockStore:c,showToast:n,toastMessage:e.formatMessage($s.deletedDataSource,{dataSourceName:s}),analytics:r}),{result:"accepted"}}function qs({environment:e,store:t,parentBlockStore:o,showToast:n,toastMessage:i,analytics:r}){var l,a;A().createAndCommit({userAction:"collectionSettingsActions.deleteDataSource",environment:e,canUndo:!0,perform:e=>{(0,Ns().removeCollectionFromCollectionViewBlock)({collectionViewBlockStore:o,collectionStore:t,transaction:e})}}),n&&(0,Rs().r)({item:{label:i},undoFunc:()=>{Ws().tN({environment:e,preventSelectText:!0})}}),(0,Us().trackDeleteDataSource)(e,{collection_view_block_id:o.id,collection_id:t.id,owned_collection_count:null===(l=o.getOwnedCollectionStores())||void 0===l?void 0:l.length,linked_collection_count:null===(a=o.getLinkedCollectionStores())||void 0===a?void 0:a.length,data_source_session_id:r.dataSourceSessionId})}var Ys=()=>o(799832),Xs=()=>o(811979),Js=()=>o(376049);const Zs=(0,v().YK)({dataSourceCopied:{id:"manageDataSourcesMenu.uuidCopied",defaultMessage:"{dataSourceName} ID copied"},copyDataSourceID:{id:"manageDataSourcesMenu.copyDataSourceID",defaultMessage:"Copy data source ID"},moveTo:{id:"manageDataSourcesMenu.moveTo",defaultMessage:"Move to"}});function ec({collectionStore:e,collectionViewBlockStore:t,analytics:o,orderedActions:i,buttonIconFill:r}){const a=(0,l().v3)(),c=(0,v().tz)(),d=(0,n.useRef)(null),u=(0,s().uB)(void 0,X().A),p=(0,s().K8)((()=>(0,sa().getCollectionNameOrDefault)({collectionStore:e,intl:c})),[e,c]),g=(0,h().IS)((()=>({buttonIcon:{width:20,height:20,fill:r},subMenuIcon:{fill:"inherit"}})),[r]);if(0===i.length)return null;const m={copyDataSourceId:{action:async()=>{const t=await(0,Ca().jd)();await t({environment:a,stringValue:e.id,copiedMessage:Zs.dataSourceCopied,copiedMessageValues:{dataSourceName:(0,sa().getCollectionNameOrDefault)({collectionStore:e,intl:c})}}),u.setState({open:!1})},render:e=>(0,z.jsx)($().A,{title:(0,z.jsx)(v().sA,{...Zs.copyDataSourceID}),icon:(0,z.jsx)(H().I,{icon:Es().V,style:g.subMenuIcon}),...e})},moveTo:{action:()=>{var n;return Js().L1({environment:a,collectionStore:e,collectionViewBlockStore:t,originRect:null===(n=d.current)||void 0===n?void 0:n.getBoundingClientRect(),moveToContext:"manage_data_sources",placementToOrigin:"left",onAccept:()=>{if(!f().A.isMobile)return;const e=(0,Ys().U)(t);e&&R().os({collectionSettingsStore:e.settingsStore})},analytics:o})},render:e=>(0,z.jsx)($().A,{title:(0,z.jsx)(v().sA,{...Zs.moveTo}),icon:(0,z.jsx)(H().I,{icon:Ds().F,style:g.subMenuIcon}),...e,ref:d})},delete:{action:async()=>{const{result:t}=await Qs({intl:c,environment:a,store:e,showConfirmationDialog:!0,showToast:!0,analytics:o});"accepted"===t&&u.setState({open:!1})},render:e=>(0,z.jsx)($().A,{title:(0,z.jsx)(v().sA,{...Os().AY.moveToTrashName}),icon:(0,z.jsx)(H().I,{icon:Q().trashIcon,style:g.subMenuIcon}),isRedOnHover:!0,...e})}};return(0,z.jsx)(Xs().A,{focused:!1,buttonPopupStore:u,alignmentToOrigin:"end",placementToOrigin:"bottom",bottomSheetInitialState:"half",popupType:f().A.isMobile?_().z.BottomSheet:_().z.Popup,renderOrigin:e=>(0,z.jsx)(Fl().A,{...e,icon:Dl().ellipsisIcon,iconStyle:g.buttonIcon,ariaLabel:c.formatMessage({id:"manageDataSourcesMenu.moreOptionsAriaLabel",defaultMessage:"Data source actions"})}),render:e=>(0,z.jsx)(tc,{collectionName:p,menuItems:i.map((e=>({key:e,...m[e]}))),onClose:e.close})})}function tc({collectionName:e,menuItems:t,onClose:o}){const i=(0,n.useMemo)((()=>f().A.isMobile?{title:e,menuType:T().gu.Modal,right:(0,z.jsx)(v().sA,{...Fs().W.done}),onClickRight:o}:{menuType:T().gu.Popup,width:200}),[e,o]);return(0,z.jsx)(B().A,{...i,children:(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:void 0,sections:[{key:"dataSourceOptions",items:t,render:e=>(0,z.jsx)(x().A,{...e})}]})})}function oc({collectionContextStore:e,collectionStore:t,onCloseParentMenu:i,analytics:r,...a},c){const d=(0,v().tz)(),u=(0,l().v3)(),p=(0,s().K8)((()=>{var o;return(null===(o=e.collectionViewBlockStore())||void 0===o?void 0:o.id)===t.getParentId()}),[e,t]),g=(0,s().K8)((()=>e.collectionViewBlockStore()),[e]),m=(0,s().K8)((()=>(0,o(457419).S)(g)),[g]),S=(0,s().K8)((()=>(0,Bs().h0)({collectionViewBlockStore:g,collectionStore:t})),[g,t]),y=(0,s().K8)((()=>{var e;return((null==g||null===(e=g.getCollectionViewStores())||void 0===e?void 0:e.length)??0)===S.length}),[g,S]),f=(0,s().K8)((()=>(0,Bs().h0)({collectionViewBlockStore:g,collectionStore:t})),[g,t]),x=(0,s().K8)((()=>({canAdmin:null==t?void 0:t.canAdmin(),canConfigureCollection:(0,o(33791).v)({collectionStore:t,collectionViewBlockStore:g,checkNavigableAncestorLocked:!1}),canConfigureBlock:e.permissionScopesStore.state.canConfigureBlock,canViewCollection:void 0!==t.getModel()})),[t,g,e]),b=(0,s().K8)((()=>{const e=(0,z.jsx)(ja().B6,{icon:t.getIcon(),iconRecordCategory:"collection",disabled:!0,isEmptyPage:!1,size:20});return p?e:(0,z.jsx)(o(168953).C,{icon:e})}),[t,p]),C=(0,s().K8)((()=>x.canViewCollection?(0,sa().getCollectionNameOrDefault)({collectionStore:t,intl:d}):d.formatMessage({id:"manageDataSourcesMenu.noAccess",defaultMessage:"No access"})),[t,d,x.canViewCollection]),j=p&&x.canAdmin&&!m,w=p&&x.canConfigureCollection&&!y,I=p,_=!p&&x.canConfigureBlock&&!y&&S.length>0,T=j||w||_||I,k=(0,n.useCallback)((()=>{const o=e.collectionViewBlockStore();o&&function({environment:e,collectionContextStore:t,collectionViewBlockStore:o,collectionStore:n}){var i;const r=(0,Bs().h0)({collectionViewBlockStore:o,collectionStore:n}),l=new Set(r.map((e=>e.id))),a=o.getCollectionViewStores().find((e=>!l.has(e.id)));if(!a)return;const s=null===(i=t.collectionViewStore())||void 0===i?void 0:i.id,c=s&&l.has(s);A().createAndCommit({userAction:"collectionSettingsActions.handleDeleteCollectionViews",environment:e,canUndo:!0,perform:e=>{for(const t of r)(0,Vs().T)({collectionViewBlockStore:o,collectionViewStore:t,transaction:e})}}),c&&(0,Ms().t)({environment:e,collectionContextStore:t,collectionViewId:a.id,isFullScreen:t.isFullScreenStore.state,isInPeekRenderer:t.isInPeekRendererStore.state,isRootChild:t.isRootChildStore.state})}({environment:u,collectionContextStore:e,collectionViewBlockStore:o,collectionStore:t})}),[u,e,t]),M=(0,h().IS)((()=>({wrapper:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",...T?{paddingInlineEnd:2}:{}},titleAndIcon:{display:"flex",flexDirection:"row",alignItems:"center",gap:8,marginInlineEnd:8,...!x.canViewCollection&&{color:O().Tj.icon.secondary,fill:O().Tj.icon.secondary}},title:{...We().RC},trashAndNumViews:{display:"flex",flexDirection:"row",alignItems:"center",gap:8},rightIcon:{fill:O().Tj.icon.secondary,width:20,height:20},viewsTooltipContent:{maxWidth:150,display:"flex",flexDirection:"column",gap:2}})),[T,x.canViewCollection]);return(0,z.jsx)($().A,{ref:c,style:M.wrapper,...a,titleStyle:M.titleAndIcon,title:(0,z.jsxs)(z.Fragment,{children:[b,(0,z.jsx)(o(404905).j,{children:(0,z.jsx)("span",{style:M.title,children:C})})]}),rightStyle:M.trashAndNumViews,right:(0,z.jsxs)(z.Fragment,{children:[0===f.length?null:(0,z.jsx)(Ye().m,{delayThreshold:400,render:e=>(0,z.jsx)("div",{...e,children:(0,z.jsx)(P().D,{colorVariant:"tertiary",children:(0,z.jsx)(v().sA,{id:"manageDataSourcesMenu.nViews",defaultMessage:"{numViews, select, 1 {1 view} other {{numViews} views}}",values:{numViews:f.length<100?f.length:"99+"}})})}),renderTooltip:e=>(0,z.jsxs)("div",{style:M.viewsTooltipContent,...e,children:[f.slice(0,20).map((e=>(0,z.jsx)(nc,{viewStore:e},e.id))),f.length<=20?null:(0,z.jsx)(P().D,{children:(0,z.jsx)(v().sA,{id:"manageDataSourcesMenu.plusMoreViews",defaultMessage:"{numViews, plural, one {+1 more} other {+{numViews} more}}",values:{numViews:f.length-20}})})]})}),(0,z.jsx)(ec,{collectionStore:t,collectionViewBlockStore:g,analytics:r,orderedActions:(0,Ro().oE)([I?"copyDataSourceId":void 0,j?"moveTo":void 0,w?"delete":void 0]),buttonIconFill:M.rightIcon.fill}),_?(0,z.jsx)(Ye().m,{delayThreshold:400,renderTooltip:()=>(0,z.jsx)(v().sA,{id:"manageDataSourcesMenu.deleteViewsTooltip",defaultMessage:"Delete {numViews, select, 1 {linked view} other {{numViews} linked views}}",values:{numViews:S.length}}),render:e=>(0,z.jsx)(Fl().A,{...e,icon:o(599813).xMarkIcon,iconStyle:M.rightIcon,ariaLabel:d.formatMessage({id:"manageDataSourcesMenu.deleteViewsAriaLabel",defaultMessage:"Delete linked views"}),onClick:k})}):null]})})}function nc({viewStore:e}){const{viewType:t,icon:o,name:n}=(0,s().K8)((()=>{const t=e.getType();return{viewType:t,icon:e.getFormat().collection_view_icon,name:(0,ur().OO)({collectionViewName:e.getName(),collectionViewType:t})}}),[e]),i=(0,h().IS)((()=>({viewsTooltipRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:8},name:{...We().RC}})),[]);return(0,z.jsxs)("div",{style:i.viewsTooltipRow,children:[(0,z.jsx)(El().h,{color:"lightGray",viewType:t,viewIcon:o,size:16}),(0,z.jsx)("div",{style:i.name,children:n})]})}const ic=n.forwardRef(oc);function rc({collectionStore:e,collectionContextStore:t}){var o;return(null===(o=t.collectionViewBlockStore())||void 0===o?void 0:o.id)===e.getParentId()}var lc=()=>o(394888),ac=()=>o(49210),sc=()=>o(106261),cc=()=>o(302996),dc=()=>o(723085),uc=()=>o(450648);const pc=(0,o(402390).wW)();async function gc(e){const{loaders:t,spaceId:o,primaryDataSourceIds:n}=e,i=Array.from(new Set(n.map((e=>e)))),r=await mc({loadPointer:t.loadPointer,spaceId:o,collectionIds:i}),l=i.filter((e=>!r.has(e))),a=function(e){const{collections:t,spaceId:o}=e,n=new Set;for(const i of t.values()){const e=i.getNormalizedSchema();for(const[,t]of(0,b().WP)(e)){if(!t||"relation"!==t.type)continue;if((0,ae().o2)(o,t))continue;const e=(0,ae().Nv)(t);(null==e?void 0:e.table)===Wl().Vl&&e.id&&n.add(e.id)}}return n}({collections:r,spaceId:o});for(const y of i)a.delete(y);const s=await mc({loadPointer:t.loadPointer,spaceId:o,collectionIds:Array.from(a)}),c=new Map([...r,...s]),d=await t.loadPointer({table:Si().NX,id:o}),u=new Set;for(const y of c.values()){const e=fc(y.getParentPointer());"team"===e.kind&&u.add(e.resourceIdOrUrn)}const p=await async function(e){const{loadPointer:t,spaceId:o,teamIds:n,getRecordModel:i}=e;if(0===n.length)return[];const r=Array.from(new Set(n)),l=await(0,Ko().lX)(r,5,(async e=>{const n=await t({table:yi().yK,id:e,spaceId:o});return{resourceId:e,name:hc(null==n?void 0:n.getName(),i),spaceResourceId:o}}));return l}({loadPointer:t.loadPointer,spaceId:o,teamIds:Array.from(u),getRecordModel:t.getRecordModel}),g=t.getRecordModel,m={resourceId:o,name:hc(null==d?void 0:d.getName(),g)},S=function(e){const{collections:t,spaceId:o,allowedTargets:n}=e,i=[];for(const[r,l]of t.entries()){const e=l.getNormalizedSchema();for(const[l,a]of(0,b().WP)(e)){if(!a||"relation"!==a.type)continue;if((0,ae().o2)(o,a))continue;const e=(0,ae().Nv)(a);if((null==e?void 0:e.table)!==Wl().Vl||!e.id)continue;const s=e.id;if(!n.has(s))continue;const c=t.get(s),d={table:Wl().Vl,id:r,spaceId:o,propertyId:l,propertySchema:a},u=void 0!==c&&(0,ae().G2)(d,c),p=`${r}:${l}->${s}:${a.property??""}`;i.push({id:p,source:{db:r,ds:r,propertyId:l},target:u&&a.property?{db:s,ds:s,propertyId:a.property}:{db:s,ds:s},direction:u?"two-way":"one-way",cardinality:1===a.limit?"1:1":"1:n"})}}return i}({collections:c,spaceId:o,allowedTargets:new Set(c.keys())});return{graph:{spaces:[m],teams:p,databases:Array.from(c.entries()).map((([e,t])=>({resourceId:e,name:hc(t.getName(),g)??e,parent:fc(t.getParentPointer()),dataSources:[e]}))),dataSources:Array.from(c.entries()).map((([e,t])=>{const n=hc(t.getName(),g)??e,i=t.getCreatedTime(),r=t.getCreatedById(),l=t.getLastEditedTime(),a=t.getLastEditedById();return{databaseResourceId:e,dataSourceResourceId:e,name:n,icon:t.getRawIcon(),properties:Sc({collection:t,spaceId:o}),created:i&&r?{time:new Date(i).toISOString(),userId:r}:void 0,lastEdited:l&&a?{time:new Date(l).toISOString(),userId:a}:void 0}})),edges:S},missingDataSourceIds:l,loadedDataSourceIds:Array.from(c.keys())}}async function mc(e){const{loadPointer:t,spaceId:o,collectionIds:n}=e,i=new Map;return await(0,Ko().lX)(n,5,(async e=>{const n=await t({table:Wl().Vl,id:e,spaceId:o});n&&n.getSpaceId()===o&&i.set(e,n)})),i}function Sc(e){const{collection:t,spaceId:o}=e,n=t.getNormalizedSchema(),i=[];for(const[r,l]of(0,b().WP)(n)){if(!l)continue;const e={propertyId:r,resourceId:r,name:l.name??r,type:yc(l.type)};if("relation"===l.type){if((0,ae().o2)(o,l)){i.push(e);continue}const t=(0,ae().Nv)(l);(null==t?void 0:t.table)===Wl().Vl&&t.id&&(e.relation={targetDataSourceResourceId:t.id,targetPropertyResourceId:l.property,limit:1===l.limit?1:void 0})}i.push(e)}return i}function yc(e){switch(e){case"title":case"text":case"number":case"select":case"multi_select":case"date":case"checkbox":case"url":case"email":case"phone_number":case"relation":return e;default:return"text"}}function fc(e){switch(e.table){case Si().NX:return{kind:"space",resourceIdOrUrn:e.id};case yi().yK:return{kind:"team",resourceIdOrUrn:e.id};default:return{kind:"page",resourceIdOrUrn:e.id}}}function hc(e,t){if(!e)return;if("string"==typeof e)return e||void 0;return(0,uc().r4)({textValue:e,getRecordModel:t,userTimeZone:"UTC",intl:pc})||void 0}function xc(e){const{collectionStore:t}=e;return{loadPointer:function(e){return e.table===Wl().Vl?Promise.resolve(xt().m.createChildStore(t,e).getModel()):e.table===Si().NX?Promise.resolve(cc().SpaceStore.createChildStore(t,e).getModel()):e.table===yi().yK?Promise.resolve(dc().h.createChildStore(t,e).getModel()):Promise.resolve(void 0)},getRecordModel:t.getRecordModel}}const vc=new(Ee().O2)("IacDataSourceGraph",(()=>o.e(60786).then(o.bind(o,623179)))),bc=(0,Ee()._h)(vc,(e=>e.IacDataSourceGraph)),Cc=(0,v().YK)({modalTitle:{id:"manageDataSourcesMenu.visualizeSources.modalTitle",defaultMessage:"Data sources"}});function jc(){const e=(0,h().IS)((()=>({header:{paddingTop:12,paddingInlineEnd:24,paddingBottom:8,paddingInlineStart:24,backgroundColor:O().Tj.background.primary},headerTitle:{fontSize:16,fontWeight:600,color:O().Tj.text.primary}})),[]);return(0,z.jsx)("div",{style:e.header,children:(0,z.jsx)("div",{style:e.headerTitle,children:(0,z.jsx)(v().sA,{...Cc.modalTitle})})})}function wc(e){const{spaceId:t,collectionStores:o}=e,i=(0,v().tz)(),r=(0,h().IS)((()=>({container:{height:"100%",width:"100%",display:"flex",flexDirection:"column",backgroundColor:O().Tj.background.primary},content:{flex:1,minHeight:0,position:"relative",paddingTop:8,paddingInlineEnd:24,paddingBottom:24,paddingInlineStart:24},status:{height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:12,paddingInline:24,textAlign:"center"},statusText:{color:O().Tj.text.secondary},errorText:{color:O().Tj.red.text.primary,whiteSpace:"pre-wrap"},graphContainer:{height:"100%",borderRadius:8,overflow:"hidden"}})),[]),[l,a]=(0,n.useState)({status:"loading"}),s=(0,n.useMemo)((()=>{if("ready"===l.status)return function(e){const{graph:t,requestedDataSourceIds:o}=e;if(0===o.length)return t;const n=new Set(o),i=t.edges.filter((e=>n.has(e.source.ds)||n.has(e.target.ds)));return{...t,edges:i}}(l.payload)}),[l]);if((0,n.useEffect)((()=>{!async function(){a({status:"loading"});try{const e=await async function(e){const{spaceId:t,collectionStores:o}=e,n=Array.from(new Set(o.map((e=>e.id))));if(0===n.length)throw new Error("At least one data source is required.");return{...await gc({loaders:xc({collectionStore:o[0]}),spaceId:t,primaryDataSourceIds:n}),requestedDataSourceIds:n}}({spaceId:t,collectionStores:o});a({status:"ready",payload:e})}catch(e){const t=e instanceof Error?e.message:i.formatMessage({id:"iac.dataSourceGraph.genericError",defaultMessage:"We couldn't build the data source graph. Please try again."});a({status:"error",message:t})}}()}),[o,i,t]),"loading"===l.status)return(0,z.jsxs)("div",{style:r.container,children:[(0,z.jsx)(jc,{}),(0,z.jsx)("div",{style:r.content,children:(0,z.jsxs)("div",{style:r.status,children:[(0,z.jsx)(dt().k,{}),(0,z.jsx)(P().D,{style:r.statusText,styleKey:"bodySemibold",children:(0,z.jsx)(v().sA,{id:"iac.dataSourceGraph.loading",defaultMessage:"Loading data source relationshipsâ€¦"})})]})})]});if("error"===l.status)return(0,z.jsxs)("div",{style:r.container,children:[(0,z.jsx)(jc,{}),(0,z.jsx)("div",{style:r.content,children:(0,z.jsx)("div",{style:r.status,children:(0,z.jsx)(P().D,{style:r.errorText,styleKey:"bodySemibold",children:l.message})})})]});const c=l.payload,d=s??c.graph;return(0,z.jsxs)("div",{style:r.container,children:[(0,z.jsx)(jc,{}),(0,z.jsx)("div",{style:r.content,children:(0,z.jsx)("div",{style:r.graphContainer,children:(0,z.jsx)(bc,{erd:d,missingDataSourceIds:c.missingDataSourceIds})})})]})}function Ac(e){const{collectionContextStore:t,analytics:o}=e,i=(0,l().v3)(),r=(0,v().tz)(),a=(0,U().X)("data_source_visualization"),c=(0,s().K8)((()=>{var e;return(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getOwnedCollectionStores())??[]}),[t]),d=(0,s().K8)((()=>{var e;return(0,Ro().hS)((null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[],(e=>{var t;return null===(t=e.getCollectionStore())||void 0===t?void 0:t.id})).flatMap((e=>{const o=e.getCollectionStore();if(!o)return[];return!rc({collectionStore:o,collectionContextStore:t})?[o]:[]}))}),[t]),u=(0,n.useMemo)((()=>(0,Ro().hS)([...c,...d],(e=>e.id))),[c,d]),p=(0,s().O$)(t.canConfigureBlockStore),g=(0,n.useCallback)((e=>(0,Bs().h0)({collectionViewBlockStore:t.collectionViewBlockStore(),collectionStore:e})[0]),[t]),[m,S]=(0,et().V$)((async(e,o)=>{var n;if(f().A.isMobile&&R().os({collectionSettingsStore:t.settingsStore}),!rc({collectionStore:e,collectionContextStore:t})){if(!e.getModel())return;return void(0,Ps().S)({environment:i,collectionStore:e,event:o,pageVisitSource:Is().y8.ManageDataSourcesMenu})}if(e.id===(null===(n=t.collectionStore())||void 0===n?void 0:n.id))return;const l=g(e);l?(0,Ms().t)({environment:i,collectionContextStore:t,collectionViewId:l.id,isFullScreen:t.isFullScreenStore.state,isInPeekRenderer:t.isInPeekRendererStore.state,isRootChild:t.isRootChildStore.state}):await async function(e){const{environment:t,collectionContextStore:o,collectionStore:n,intl:i}=e,r=(0,sa().getCollectionNameOrDefault)({intl:i,collectionStore:n});if(!(await To().Gh({message:(0,z.jsx)(v().sA,{id:"manageDataSourcesMenu.createNewView.title",defaultMessage:"Create a view for {dataSourceName}?",values:{dataSourceName:r}}),description:(0,z.jsx)(v().sA,{id:"manageDataSourcesMenu.createNewView.description",defaultMessage:"{dataSourceName} has no views",values:{dataSourceName:r}}),acceptLabel:(0,z.jsx)(v().sA,{id:"manageDataSourcesMenu.createNewView.acceptLabel",defaultMessage:"Create a view"}),cancelLabel:(0,z.jsx)(v().sA,{id:"manageDataSourcesMenu.createNewView.cancelLabel",defaultMessage:"Cancel"}),acceptColor:"blue"})).accept)return;A().createAndCommit({environment:t,userAction:"createNewViewFromEmptyDataSource",canUndo:!0,perform:e=>(0,ks().Z)({environment:t,collectionContextStore:o,collectionStore:n,newViewType:"table",transaction:e,settingsDestination:"skip"})})}({environment:i,collectionContextStore:t,collectionStore:e,intl:r})}),[t,i,r,g]),y=(0,n.useCallback)((()=>{var e,o;if(0===u.length)return;const n=(null===(e=t.collectionStore())||void 0===e?void 0:e.getSpaceId())??(null===(o=t.collectionViewBlockStore())||void 0===o?void 0:o.getSpaceId());n&&function(e){const{spaceId:t,collectionStores:o}=e;ac().T.showAsyncModal((e=>(0,z.jsx)(lc().s,{isOpen:e.isOpen,onDismiss:e.onDismiss,onClosed:e.onClosed,areaConstraint:{width:{type:"fixed",length:1150},height:{type:"fixed",length:715}},borderRadius:12,minimumOutsideSpacing:{type:"all",length:50},render:({displayMode:e})=>(0,z.jsx)(sc().B,{displayMode:e,showDismissButtonBackground:!1,title:(0,z.jsx)(v().sA,{...Cc.modalTitle}),children:(0,z.jsx)(wc,{spaceId:t,collectionStores:o})})})))}({spaceId:n,collectionStores:u})}),[t,u]),b=(0,h().IS)((()=>({textOverflow:We().RC,learnMoreSection:f().A.isMobile?{}:{marginTop:6}})),[]),j=(0,s().K8)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.canAddCollection()}),[t]),w=!(null!=j&&j.canAddView),I=(0,s().K8)((()=>{var e;return!(null!==(e=t.collectionViewBlockStore())&&void 0!==e&&e.canAddCollectionView())}),[t]),_=(0,s().K8)((()=>{const e=a&&u.length>0?{key:"visualizeDataSources",render:e=>(0,z.jsx)($().A,{title:(0,z.jsx)(P().D,{colorPalette:"gray",colorVariant:"secondary",children:(0,z.jsx)(v().sA,{defaultMessage:"Visualize data sources",id:"manageDataSourcesMenu.visualizeSources.title"})}),icon:(0,z.jsx)(H().I,{icon:_s().E,colorPalette:"gray",colorVariant:"secondary"}),titleStyle:b.textOverflow,...e}),action:()=>y()}:void 0,n=p?{key:"AddDatabase",render:e=>(0,z.jsx)(Ye().m,{render:t=>(0,z.jsx)($().A,{title:(0,z.jsx)(P().D,{colorPalette:"gray",colorVariant:"secondary",children:(0,z.jsx)(v().sA,{defaultMessage:"Add data source",id:"manageDataSourcesMenu.addDatabase.title"})}),icon:(0,z.jsx)(H().I,{icon:jl().plusIcon,colorPalette:"gray",colorVariant:"secondary"}),titleStyle:b.textOverflow,disabled:w,disabledFeedback:w,...e,...t}),renderTooltip:()=>(0,z.jsx)(Ts().k,{canAddCollectionResult:j}),placement:"right",disableTooltip:!w}),action:()=>{A().createAndCommit({environment:i,userAction:"createAndFocusNewDataSource",canUndo:!0,perform:e=>{(0,ks().n)({environment:i,collectionContextStore:t,transaction:e,analytics:{from:"addNewDatabaseButtonInManageDataSourcesMenu",dataSourceFrom:"manage_data_sources",dataSourceSessionId:o.dataSourceSessionId}})}})}}:void 0,r=p?{key:"LinkExisting",render:e=>(0,z.jsx)(Ye().m,{render:t=>(0,z.jsx)($().A,{title:(0,z.jsx)(P().D,{colorPalette:"gray",colorVariant:"secondary",children:(0,z.jsx)(v().sA,{defaultMessage:"Link existing data source",id:"manageDataSourcesMenu.linkExisting.title"})}),titleStyle:b.textOverflow,icon:(0,z.jsx)(H().I,{icon:jl().plusIcon,colorVariant:"secondary"}),disabled:I,disabledFeedback:I,...e,...t}),renderTooltip:()=>(0,z.jsx)(Ts().k,{canAddCollectionResult:{canAddView:!1,reason:"tooManyViews"}}),placement:"right",disableTooltip:!I}),action:()=>A().createAndCommit({environment:i,userAction:"createNewViewFromManageDataSourcesMenu",canUndo:!0,perform:e=>(0,ks().Z)({environment:i,collectionContextStore:t,newViewType:"table",transaction:e,settingsDestination:"linkToDatabase",analytics:{dataSourceFrom:"manage_data_sources",dataSourceSessionId:o.dataSourceSessionId}})})}:void 0,l=(0,Ro().oE)([...c.map((e=>{const n=Boolean(g(e))||p;return{key:e.id,render:i=>(0,z.jsx)(ic,{collectionContextStore:t,collectionStore:e,onCloseParentMenu:()=>{R().os({collectionSettingsStore:t.settingsStore})},analytics:o,disabled:!n,...i}),action:({event:t})=>S(e,t)}})),n]),s=l.length>0?{key:"manageDataSources",render:e=>(0,z.jsx)(x().A,{topBorder:!1,disableMobileBorders:!0,title:(0,z.jsx)(v().sA,{defaultMessage:"Source",id:"manageDataSourcesMenu.manageDataSources.sources.title"}),...e}),items:l}:void 0,m=(0,Ro().oE)([...d.map((e=>({key:e.id,render:n=>(0,z.jsx)(ic,{collectionContextStore:t,collectionStore:e,onCloseParentMenu:()=>{R().os({collectionSettingsStore:t.settingsStore})},analytics:o,disabled:!e.getModel(),...n}),action:({event:t})=>S(e,t)}))),r]),f=m.length>0?{key:"linkedDatabases",render:e=>(0,z.jsx)(x().A,{topBorder:void 0!==s,disableMobileBorders:!0,title:(0,z.jsx)(v().sA,{defaultMessage:"Linked",id:"manageDataSourcesMenu.manageDataSources.linked.title"}),...e}),items:m}:void 0,h=(0,Lo().x)("guides.dataSources"),C={key:"learnMore",render:e=>(0,z.jsx)(x().A,{...e,topBorder:!0,disableMobileBorders:!0,desktopStyle:b.learnMoreSection}),items:(0,Ro().oE)([e,{key:"learnMore",render:e=>(0,z.jsx)($().A,{...e,href:h,icon:(0,z.jsx)(H().I,{icon:oi().questionMarkCircleIcon,colorVariant:"secondary"}),titleStyle:b.textOverflow,title:(0,z.jsx)(P().D,{colorPalette:"gray",colorVariant:"secondary",children:(0,z.jsx)(v().sA,{id:"manageDataSourcesMenu.learnMore.title",defaultMessage:"Learn about data sources"})})}),action:({event:e})=>{var t;window.open(h,"_blank"),null==e||null===(t=e.preventDefault)||void 0===t||t.call(e)}}])};return(0,Ro().oE)([s,f,C])}),[p,c,u,d,w,b.textOverflow,b.learnMoreSection,j,i,t,o,I,g,S,y,a]);return(0,z.jsx)(C().A,{...e,title:(0,z.jsx)(v().sA,{id:"database.viewSettings.manageDataSources.title",defaultMessage:"Manage data sources"}),handleClose:()=>R().os({collectionSettingsStore:t.settingsStore}),children:(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:void 0,sections:_})})}const Ic=(0,v().YK)({inputPlaceholder:{defaultMessage:"Search for a pageâ€¦",id:"database.viewSettings.searchPages.inputPlaceholder"},searchResultsTitle:{defaultMessage:"Search results",id:"database.viewSettings.searchPages.searchResultsTitle"},recentPagesTitle:{defaultMessage:"Recent pages",id:"database.viewSettings.searchPages.recentPagesTitle"}}),_c=St().Store.createClass("",{name:"InputStore"}),Tc=n.memo((function(e){const{parentStore:t,onAccept:i,inputStore:r,currentPageId:l}=e,a=(0,v().tz)(),c=(0,s().uB)(r,_c),d=(0,s().uB)(void 0,Xl().$),u=(0,s().O$)(c),{results:p,isResultsLoading:g}=(0,ia().W)({query:u,limit:20,source:"page_view_selector",type:oa().Vz.BlocksInSpace,filters:{blockTypes:["page"]},options:{disable:0===u.length},peopleBlocksToInclude:"all"}),m=(0,s().K8)((()=>u.length>0?[]:(o(825972).wI.state||[]).filter((e=>{var t;return"page"===(null===(t=e.store)||void 0===t?void 0:t.getType())})).slice(0,10)),[u]),S=(0,h().IS)((()=>({menuItemSelected:{backgroundColor:O().Tj.buttonHoveredBackground}})),[]),y=(0,n.useMemo)((()=>{const e=[],o=(u.length>0?p:m).map((e=>{const o="id"in e?e.id:e.pageId,n="store"in e&&e.store?e.store:si().B.createChildStore(t,{table:"block",id:o,spaceId:t.getSpaceId()});return{key:o,action:()=>{i(n)},render:e=>{const t=n.id===l;return(0,z.jsx)(na().A,{...e,store:n,style:t?S.menuItemSelected:void 0})}}}));return e.push({key:"results",render:e=>(0,z.jsx)(x().A,{title:u.length>0?(0,z.jsx)(v().sA,{...Ic.searchResultsTitle}):o.length>0?(0,z.jsx)(v().sA,{...Ic.recentPagesTitle}):void 0,children:e.children}),items:o,showNoResultMessage:!g&&0===o.length&&u.length>0}),e}),[u.length,p,m,g,t,i,l,S.menuItemSelected]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(x().A,{isInput:!0,children:(0,z.jsx)(mt().Ay,{focusInitial:!0,value:u,onChange:e=>{c.setState(e.target.value),d.setState({focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})},placeholder:a.formatMessage(Ic.inputPlaceholder),showClearButton:!0})}),(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:0,sections:y.filter(b().O9),store:d})]})}),Jl().A);function kc(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,i=(0,l().v3)(),{collectionViewStore:r,collectionViewBlockStore:a,pagePointer:c}=(0,s().K8)((()=>{const e=t.collectionViewStore(),o=t.collectionViewBlockStore(),n=null==e?void 0:e.getFormat();return{collectionViewStore:e,collectionViewBlockStore:o,pagePointer:null==n?void 0:n.page_pointer}}),[t]),d=(0,n.useMemo)((()=>St().Store.createValue("")),[]),u=n.useCallback((e=>{r&&(A().createAndCommit({environment:i,userAction:"CollectionSettingsPageViewSource.handlePageAccept",canUndo:!0,perform:t=>{m().zA({stores:[r],update:{page_pointer:{id:e.id,table:"block",spaceId:e.getSpaceId()}},transaction:t})}}),R().yl({collectionSettingsStore:o}))}),[r,i,o]);return a?(0,z.jsx)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Source",id:"database.viewSettings.sourceTab.title"}),handleClose:()=>R().os({collectionSettingsStore:o}),children:(0,z.jsx)(Tc,{parentStore:a,onAccept:u,inputStore:d,currentPageId:null!=c&&c.id?c.id:void 0})}):null}const Mc=n.memo(kc);var Pc=()=>o(750294),Bc=()=>o(350013),Vc=()=>o(526278),Fc=()=>o(743246),Dc=()=>o(378711),Ec=()=>o(120201);const Oc=(0,v().YK)({noConfigurationFound:{defaultMessage:"No agent configuration found for this property.",id:"collectionSettings.propertyAgentAutofill.noConfigForProperty"},back:{defaultMessage:"Back",id:"propertyAgentAutofill.back"}});function Rc(e){const{collectionContextStore:t,workflowId:o,collectionSettingsStore:i}=e,r=(0,v().tz)(),l=(0,h().IS)((()=>({loadingText:{color:O().Tj.text.secondary,fontSize:14},arrowButton:{marginInlineEnd:8,marginInlineStart:-2,height:22},arrowIcon:{width:16,height:16}})),[]),a=(0,s().K8)((()=>null==t?void 0:t.collectionStore()),[t]),c=(0,s().K8)((()=>null==a?void 0:a.getSpaceId()),[a]),d=(0,s().K8)((()=>{if(!c||!a||!o)return;const e=a.getParentCollectionViewBlockStore();return e?Bc().N.createChildStore(e,{table:Fc().C0,id:o,spaceId:c}):null}),[a,o,c]),u=(0,n.useCallback)((()=>{R().yl({collectionSettingsStore:i})}),[i]),p=(0,n.useCallback)((()=>{R().os({collectionSettingsStore:i})}),[i]),{deleteButton:g}=(0,Dc().L)({collectionSettingsStore:i,collectionStore:a,spaceId:c,workflowStore:d});return a&&c?(0,z.jsx)("div",{children:(0,z.jsx)(C().A,{...e,backArrowButton:(0,z.jsx)(Fl().A,{icon:Vc().arrowStraightLeftIcon,style:l.arrowButton,iconStyle:l.arrowIcon,onClick:u,ariaLabel:r.formatMessage(Oc.back)}),topRightButton:d?(0,z.jsx)("div",{style:{display:"flex",alignItems:"center",gap:4},children:g}):void 0,children:(0,z.jsx)(Ec().e,{collectionContextStore:t,collectionStore:a,handleCloseParent:p,spaceId:c,workflowId:o})})}):(0,z.jsx)("div",{style:l.loadingText,children:(0,z.jsx)(v().sA,{...Oc.noConfigurationFound})})}var Kc=()=>o(396896),Nc=()=>o(362750),zc=()=>o(992214),Lc=()=>o(116089),Uc=()=>o(583289),Wc=()=>o(272200),Hc=()=>o(706654),$c=()=>o(385685),Gc=()=>o(135221),Qc=()=>o(486674),qc=()=>o(68465),Yc=()=>o(71304),Xc=()=>o(937199),Jc=()=>o(619206);function Zc(e,t){(0,n.useEffect)((()=>{const o=`abort-dismiss-settings-callback-${(0,yt().JW)()}`;return e.abortDismissSettingsCallbackStore.setState([o,t]),()=>{const t=e.abortDismissSettingsCallbackStore.state;t&&t[0]===o&&e.abortDismissSettingsCallbackStore.setState(void 0)}}),[e,t])}var ed=()=>o(363631),td=()=>o(84262),od=()=>o(704658),nd=()=>o(908375),id=()=>o(35091);const rd=(0,v().YK)({autoUpdateExplanationMessage:{defaultMessage:"Keep values updated with the latest edits to pages",id:"database.CollectionSettingsPropertyAiAutofill.autoUpdateExplanationMessage"},onlyWithAiUpgradeMessage:{defaultMessage:"Only with upgraded Notion AI",id:"database.CollectionSettingsPropertyAiAutofill.onlyWithAiUpgradeMessage"},updateOnPageEdits:{defaultMessage:"Auto-update on page edits",id:"database.viewSettings.propertyTab.aiAutofill.updateOnPageEdits"}});function ld({collectionContextStore:e,environment:t,setAiInference:o,aiInference:i,autofillFeatureAvailability:r}){const l=(0,n.useRef)(yt().JW()),a=(0,U().X)("upgrade_system_ai"),c=(0,n.useRef)(null),d=(0,v().tz)(),u=(0,s().K8)((()=>{const t=e.collectionStore();return t?(0,gs().f)(t):void 0}),[e]),p=!((0,xn().e2)(r)||null!=i&&i.auto_update_on_edit),g=(0,n.useCallback)((()=>{if(!e.collectionStore())return;if(!i)return;if(p&&!a)return void Hc().triggerAiAutofillUpsell({environment:t,from:"ai_autofill_on_page_edit",upsell:r.upsell,store:e.collectionStore()});const n={...i,auto_update_on_edit:!i.auto_update_on_edit};o(n)}),[e,i,p,a,o,t,r.upsell]);return i?p&&a?(0,z.jsx)(nd().c,{featureName:"collection_property_autofill",upsell:r.upsell,source:"ai_autofill_on_page_edit",showTooltip:!0,tooltipProps:{description:d.formatMessage(rd.autoUpdateExplanationMessage),placement:"top"},spaceStore:u,children:({handleClick:e,isDisabled:t})=>(0,z.jsx)("div",{ref:c,children:(0,z.jsx)(so().A,{title:(0,z.jsx)(v().sA,{...rd.updateOnPageEdits}),onClick:e,disabled:t,textWrapperStyle:{minWidth:"auto"},right:(0,z.jsx)(od().UpgradeButton,{display:"icon",showPlanName:!0,iconAlignment:"right",hoverRef:c,featureName:"collection_property_autofill",upsell:r.upsell,source:"ai_autofill_on_page_edit",spaceStore:u})})})}):(0,z.jsx)(Ye().m,{renderTooltip:()=>(0,z.jsxs)("div",{style:{width:169},children:[(0,z.jsx)("div",{style:{color:"white",fontWeight:500,wordWrap:"break-word",whiteSpace:"pre-wrap"},children:(0,z.jsx)(v().sA,{...rd.autoUpdateExplanationMessage})}),(0,td().Vi)(r,(()=>(0,z.jsx)("div",{style:{color:"#ACABA9",fontWeight:500},children:(0,z.jsx)(v().sA,{...rd.onlyWithAiUpgradeMessage})})))]}),render:e=>(0,z.jsx)(id().A,{title:(0,z.jsx)(v().sA,{...rd.updateOnPageEdits}),showChevron:!1,switcherProps:{inputId:l.current,on:Boolean(i.auto_update_on_edit),noColor:!1},onClick:g,disabled:!1,textWrapperStyle:{minWidth:"auto"},...e})}):null}var ad=()=>o(717137),sd=()=>o(255824);const cd=(0,v().YK)({extractPromptSectionTitle:{defaultMessage:"What key info to extract?",id:"database.viewSettings.propertyTab.aiAutofill.extractPromptSectionTitle"},customPromptSectionTitle:{defaultMessage:"What to generate?",id:"database.viewSettings.propertyTab.aiAutofill.customPromptSectionTitle"},extractPromptInputPlaceholder:{defaultMessage:"e.g. â€œKey topics in bulletsâ€ or â€œPeople mentioned on the pageâ€",id:"database.viewSettings.propertyTab.aiAutofill.extractPromptInputPlaceholder"},customPromptInputPlaceholder:{defaultMessage:"Tell AI what to generate from page content and propertiesâ€¦",id:"database.viewSettings.propertyTab.aiAutofill.customPromptInputPlaceholder"}});function dd({environment:e,aiInference:t,setAiInference:o,collectionContextStore:i,isAutofillSetupEnabled:r,shouldShowUserPromptIsInvalidError:l,setShouldShowUserPromptIsInvalidError:a}){var c;const d=(0,v().tz)(),u=function(e){if(!e)return;switch(e.type){case"summarize":case"translate":return;case"extract":return{aiInferenceType:e.type,sectionTitle:cd.extractPromptSectionTitle,inputPlaceholder:cd.extractPromptInputPlaceholder,value:e.prompt};case"custom":case"select":case"multi_select":return{aiInferenceType:e.type,sectionTitle:cd.customPromptSectionTitle,inputPlaceholder:cd.customPromptInputPlaceholder,value:e.prompt};default:(0,b().HB)(e)}}(t),p=(0,s().K8)((()=>{var t;return(0,ls().hn)({environment:e,spaceId:null===(t=i.collectionStore())||void 0===t?void 0:t.getSpaceId(),userId:e.currentUser.id})}),[e,i]),g=(0,n.useCallback)((e=>{if(i.collectionStore()&&u)switch(e.target.value&&e.target.value.length<=Nc().oV?a(!1):e.target.value.length>Nc().oV&&a(!0),u.aiInferenceType){case"extract":case"custom":o({type:u.aiInferenceType,prompt:e.target.value,auto_update_on_edit:(null==t?void 0:t.auto_update_on_edit)??p});break;case"select":case"multi_select":o({type:u.aiInferenceType,prompt:e.target.value,auto_update_on_edit:(null==t?void 0:t.auto_update_on_edit)??p,add_options:((null==t?void 0:t.type)===u.aiInferenceType&&(null==t?void 0:t.add_options))??!1});break;case"summarize":case"translate":return;default:(0,b().HB)(u.aiInferenceType)}}),[t,i,p,u,o,a]),m=(0,sd().a)(),S=(0,h().IS)((()=>({inputOuterStyle:{margin:f().A.isMobile?"8px 0":0,border:l?"1px solid red":void 0,backgroundColor:m?O().Tj.white:void 0}})),[m,l]);return u?(0,z.jsxs)(x().A,{title:d.formatMessage(u.sectionTitle),isInput:!0,style:{marginTop:-4},children:[(0,z.jsx)(ad().A,{debugName:"CollectionSettingsAiAutofillPromptInput",capture:!0,allowEsc:!0,children:(0,z.jsx)(mt().Ay,{inputOuterStyle:S.inputOuterStyle,type:"text",value:u.value||"",onChange:g,placeholder:d.formatMessage(u.inputPlaceholder),textarea:!0,disabled:!r,autosize:!0,autosizeMinHeight:100,autosizeMaxHeight:600},u.aiInferenceType)}),l?(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingInlineStart:12,fontSize:12},children:[(0,z.jsx)(H().I,{icon:Ta().exclamationMarkTriangleFillSmallIcon,size:"sm",colorPalette:"red",colorVariant:"accentPrimary"}),(0,z.jsx)("div",{style:{color:"#D34F43",paddingInlineStart:4},children:((null===(c=u.value)||void 0===c?void 0:c.length)??0)>Nc().oV?(0,z.jsx)(v().sA,{defaultMessage:"Instruction is too long",id:"CollectionSettings.propertyTab.aiAutofill.promptInput.exceedsMaxLength"}):(0,z.jsx)(v().sA,{defaultMessage:"Required",id:"CollectionSettings.propertyTab.aiAutofill.promptInput.required"})})]}):void 0]}):null}function ud(e){const{collectionContextStore:t,isAutofillSetupEnabled:o,draftAiInference:n,setDraftAiInference:i,environment:r,shouldShowUserPromptIsInvalidError:l,setShouldShowUserPromptIsInvalidError:a,autofillFeatureAvailability:s}=e;return n?"select"!==n.type&&"multi_select"!==n.type?null:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(x().A,{style:{marginBottom:10},children:[(0,z.jsx)(ld,{collectionContextStore:t,environment:r,setAiInference:i,aiInference:n,autofillFeatureAvailability:s}),(0,z.jsx)(ed().A,{setAiInference:i,aiInference:n})]}),n?(0,z.jsx)(x().A,{topBorder:!0,children:(0,z.jsx)(dd,{environment:r,aiInference:n,setAiInference:i,collectionContextStore:t,isAutofillSetupEnabled:o,shouldShowUserPromptIsInvalidError:l,setShouldShowUserPromptIsInvalidError:a})}):void 0]}):null}var pd=()=>o(449279),gd=()=>o(474587),md=()=>o(158115),Sd=()=>o(349679);const yd=new(X().A);var fd=()=>o(495159);const hd=(0,v().YK)({optionsSectionTitle:{defaultMessage:"Options",id:"database.viewSettings.propertyTab.aiAutofill.optionsSectionTitle"},whatToTranslate:{defaultMessage:"What to translate?",id:"CollectionSettingsPropertyAiAutofill.translateProperty.propertySelector"},translateTo:{defaultMessage:"Translate to",id:"CollectionSettingsPropertyAiAutofill.translateProperty.languageSelector"},selectorSearchPlaceholder:{defaultMessage:"Search",id:"CollectionSettingsPropertyAiAutofill.selectorOption.searchbar.placeholder"},allProperties:{defaultMessage:"All properties",id:"CollectionSettingsPropertyAiAutofill.selectorOption.allProperties.checkbox"},noAiAutofillSelected:{defaultMessage:"Select an option",id:"database.CollectionSettingsPropertyAiAutofill.noAiAutofillSelected"}});function xd(e){const{collectionContextStore:t,propertySchema:o,previousPromptByAiInferenceType:i,isAutofillSetupEnabled:r,draftAiInference:l,setDraftAiInference:a,environment:c,propertyId:d,collectionSchema:u,shouldShowUserPromptIsInvalidError:p,setShouldShowUserPromptIsInvalidError:g,autofillFeatureAvailability:m}=e,S=(0,v().tz)(),y=(0,h().DP)(),f=(0,U().X)("editor_basic_rtl"),C=(0,n.useMemo)((()=>[new(X().A),new(X().A)]),[]),j=(0,n.useMemo)((()=>(0,gd().fS)({includeRtlLanguages:f})),[f]),w=(0,n.useMemo)((()=>function({aiInference:e,collectionSchema:t,setAiInference:o,property:n,theme:i,optionsButtonPopupStores:r,translateLanguageOptions:l,intl:a}){var s;if(!e||!(0,ae().UH)(e.type))return[];switch(e.type){case"summarize":case"extract":case"custom":return[];case"translate":const c=Ro().oE((0,b().uv)(t).map((e=>{if(e===n)return;const o=t[e];if(o&&(0,gd().jm)(o)){var r;if("text"===o.type&&"translate"===(null===(r=o.ai_inference)||void 0===r?void 0:r.type))return;return{id:e,option:o.name,icon:(0,z.jsx)(Je().zB,{icon:o.icon,type:o.type,theme:i,size:D().Ev.sm})}}}))),d=c.findIndex((e=>"title"===e.id));if(d&&d>0){const e=c[d];c.splice(d,1),c.unshift(e)}for(;r.length<2;)r.push(new(X().A));return[{type:"multi",options:c,selectedIds:(null===(s=e.targetProperties)||void 0===s?void 0:s.length)>0?e.targetProperties:["title"],setSelectedIds:t=>{o({...e,targetProperties:t})},selectorTitle:hd.whatToTranslate,selectAllTitle:hd.allProperties,buttonPopupStore:r[0]},{type:"single",options:l.map((({key:e,name:t})=>({id:e,option:a.formatMessage(t)}))),selectedId:e.toLanguage,onSelect:t=>{o({...e,toLanguage:t})},selectorTitle:hd.translateTo,buttonPopupStore:r[1]}];default:(0,b().HB)(e)}}({aiInference:l,collectionSchema:u,setAiInference:a,property:d,theme:y,optionsButtonPopupStores:C,translateLanguageOptions:j,intl:S})),[l,u,a,d,y,C,j,S]),A=(0,s().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getSpaceId()}),[t]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(x().A,{style:{marginBottom:10,display:"flex",gap:8},children:[(0,z.jsx)(vd,{spaceId:A,propertySchema:o,previousPromptByAiInferenceType:i,draftAiInference:l,setDraftAiInference:a,environment:c}),(0,ae().bB)(l,"text")?(0,z.jsx)(ld,{collectionContextStore:t,environment:c,setAiInference:a,aiInference:l,autofillFeatureAvailability:m}):void 0]}),(0,ae().bB)(l,"text")?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(x().A,{topBorder:!0,children:(0,z.jsx)(dd,{environment:c,aiInference:l,setAiInference:a,collectionContextStore:t,isAutofillSetupEnabled:r,shouldShowUserPromptIsInvalidError:p,setShouldShowUserPromptIsInvalidError:g})}),(0,z.jsx)(Cd,{optionProps:w})]}):void 0]})}function vd({spaceId:e,propertySchema:t,previousPromptByAiInferenceType:o,draftAiInference:i,setDraftAiInference:r,environment:l}){const a=(0,s().K8)((()=>(0,ls().hn)({environment:l,userId:l.currentUser.id,spaceId:e})),[l,e]),c=(0,n.useCallback)((e=>{var n,i,l,s,c,d,u,p;if(!t||!(0,ae().$M)(t)||!e)return;let g;switch(e){case"summarize":g={type:e,auto_update_on_edit:a};break;case"translate":g={type:e,auto_update_on_edit:a,targetProperties:(null===(n=t.ai_inference)||void 0===n?void 0:n.type)===e?null===(i=t.ai_inference)||void 0===i?void 0:i.targetProperties:["title"],toLanguage:(null===(l=t.ai_inference)||void 0===l?void 0:l.type)===e?null===(s=t.ai_inference)||void 0===s?void 0:s.toLanguage:"english"};break;case"extract":g={type:e,prompt:(null===(c=t.ai_inference)||void 0===c?void 0:c.type)===e?null===(d=t.ai_inference)||void 0===d?void 0:d.prompt:o[e]??"",auto_update_on_edit:a};break;case"custom":g={type:e,prompt:(null===(u=t.ai_inference)||void 0===u?void 0:u.type)===e?null===(p=t.ai_inference)||void 0===p?void 0:p.prompt:o[e]??"",auto_update_on_edit:a};break;default:(0,b().HB)(e)}r(g)}),[a,o,t,r]),d=(0,v().tz)(),u=(0,h().IS)((()=>({buttonOutlineStyle:{borderTop:`1px solid ${O().Tj.outlineButtonBorder}`,borderRadius:4,paddingTop:12,paddingBottom:12}})),[]);return t&&(0,ae().$M)(t)?(0,z.jsx)(so().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Fill with",id:"CollectionSettingsPropertyAiAutofill.ClosedSelector.Title"}),right:(0,z.jsx)(_().A,{originGap:8,popupType:f().A.isMobile?_().z.BottomSheet:_().z.Popup,buttonPopupStore:yd,render:e=>{const t={key:"section",render:e=>(0,z.jsx)(x().A,{...e}),items:Ro().oE(Object.keys(fd().vr.text).map(((t,o,n)=>{if((0,ae().UH)(t))return{key:t,render:e=>{const r=fd().vr.text[t];return(0,z.jsx)(so().A,{focused:!1,buttonStyle:f().A.isMobile?{...u.buttonOutlineStyle,borderBottom:o===n.length-1?`1px solid ${O().Tj.outlineButtonBorder}`:void 0}:void 0,onClick:e.onClick,title:(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center",fontSize:f().A.isMobile?18:void 0},children:[r.svg({height:f().A.isMobile?20:16,width:f().A.isMobile?24:16,fill:O().Tj.purple.icon.accentPrimary,marginInlineEnd:6}),d.formatMessage(r.name)]}),right:(null==i?void 0:i.type)===t&&(0,z.jsx)(H().I,{icon:Sd().checkmarkSmallIcon,size:"xs",colorVariant:"primary"})})},action:()=>{e.close(),c(t)}}})))};return(0,z.jsx)(B().A,{menuType:T().gu.Popup,minWidth:260,maxWidth:"100vw",children:(0,z.jsx)(le().A,{style:{marginTop:f().A.isMobile?8:void 0},type:le().O.Vertical,initialFocus:0,sections:[t]})})},renderOrigin:e=>(0,z.jsx)("div",{...e,style:{userSelect:"none"},children:(0,z.jsx)(bd,{aiActionType:null==i?void 0:i.type})})})}):null}function bd({aiActionType:e}){const t=e&&(0,ae().UH)(e)?fd().vr.text[e]:{name:hd.noAiAutofillSelected,svg:()=>null},o=(0,h().IS)((()=>({wrapper:{display:"flex",alignItems:"center",cursor:"pointer",fontSize:f().A.isMobile?18:14,paddingInlineStart:15,paddingBottom:0},selectedOptionWrapper:{color:O().Tj.icon.tertiary},selectedOptionSvg:{height:16,width:16,marginInlineEnd:2},selectedOptionText:{color:O().Tj.text.tertiary,paddingInlineStart:4},selectedOptionChevron:{color:O().Tj.icon.tertiary,paddingInlineStart:4}})),[]);return(0,z.jsxs)("div",{style:o.wrapper,children:[(0,z.jsx)("div",{style:o.selectedOptionWrapper,children:t.svg(o.selectedOptionSvg)}),(0,z.jsx)("div",{style:o.selectedOptionText,children:(0,z.jsx)(v().sA,{...t.name})}),(0,z.jsx)("div",{style:o.selectedOptionChevron,children:(0,z.jsx)(H().I,{icon:md().arrowChevronSingleRightFillSmallIcon,size:"xs"})})]})}function Cd({optionProps:e}){const t=(0,v().tz)();return e&&e.length>0?(0,z.jsx)(x().A,{title:t.formatMessage(hd.optionsSectionTitle),isInput:!0,style:{marginTop:-4},children:e.map(((e,t)=>"multi"===e.type?(0,z.jsx)(jd,{options:e.options,selectedIds:e.selectedIds,setSelectedIds:e.setSelectedIds,selectorTitle:e.selectorTitle,selectAllTitle:e.selectAllTitle,buttonPopupStore:e.buttonPopupStore},t):(0,z.jsx)(wd,{options:e.options,selectedId:e.selectedId,onSelect:e.onSelect,selectorTitle:e.selectorTitle,buttonPopupStore:e.buttonPopupStore},t)))}):null}function jd({options:e,selectedIds:t,setSelectedIds:o,selectorTitle:i,selectAllTitle:r,buttonPopupStore:l}){const a=(0,v().tz)(),[s,c]=(0,n.useState)(""),d=e.filter((e=>t.includes(e.id))),u=Ro().sb(Ro().Ul(e.map((e=>e.id)))).join(",")===Ro().sb(Ro().Ul(t)).join(","),p=e=>{t.includes(e)?o(t.filter((t=>t!==e))):o(Ro().sb([...t,e]))},g=()=>{t.length<e.length?o(e.map((e=>e.id))):o(["title"])},m=(0,z.jsx)(x().A,{desktopStyle:{paddingTop:12,paddingBottom:4},children:(0,z.jsx)(mt().Ay,{focusInitial:!f().A.isMobile||void 0,focus:!f().A.isMobile||void 0,value:s,onChange:e=>{c(e.target.value)},placeholder:a.formatMessage(hd.selectorSearchPlaceholder)})});return(0,z.jsx)(_().A,{popupType:f().A.isMobile?_().z.SlideUp:_().z.Popup,buttonPopupStore:l,render:o=>{const n=e.filter((e=>{var t;const o=null===(t=e.option)||void 0===t?void 0:t.toLowerCase();return-1!==(null==o?void 0:o.indexOf(s.toLowerCase()))})).map((({id:e,option:o,icon:n})=>({key:e,render:i=>(0,z.jsx)($().A,{focused:!1,onClick:i.onClick,left:(0,z.jsx)(qe().S,{checked:t.includes(e),size:14,onClick:t=>{p(e)}}),icon:n,title:o}),action:()=>{p(e)}}))),i={key:"section",render:e=>(0,z.jsx)(x().A,{...e,topBorder:!0}),items:n},l={key:"all-items",render:e=>(0,z.jsx)(x().A,{...e}),items:[{key:"all-items",render:e=>(0,z.jsx)($().A,{focused:!1,onClick:()=>{g()},left:(0,z.jsx)(qe().S,{checked:u,size:14,onClick:()=>{g()}}),title:a.formatMessage(r)}),action:()=>{g()}}]};return(0,z.jsxs)(B().A,{menuType:T().gu.Popup,minWidth:260,maxWidth:"100vw",children:[m,0===n.length?(0,z.jsx)(x().A,{children:(0,z.jsx)(pd().u,{title:(0,z.jsx)(v().sA,{defaultMessage:"No results",id:"CollectionSettingsPropertyAiAutofill.searchBar.noResults.label"})})}):(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:void 0,sections:[l,i]})]})},renderOrigin:e=>(0,z.jsx)(so().A,{title:a.formatMessage(i),showChevron:!0,right:(0,z.jsx)("div",{style:{color:O().Tj.text.tertiary,paddingInlineStart:4,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"90%"},children:Ro().oE(d.map((({id:e,option:t,icon:o})=>t))).join(", ")}),rightStyle:{flexShrink:1},rotateChevron:l.state.open,disabled:!1,textWrapperStyle:{minWidth:"auto"},...e})})}function wd({options:e,selectedId:t,onSelect:o,selectorTitle:i,buttonPopupStore:r}){const l=(0,v().tz)(),[a,s]=(0,n.useState)(""),c=e.find((e=>e.id===t)),d=(0,z.jsx)(x().A,{desktopStyle:{paddingTop:12,paddingBottom:4},children:(0,z.jsx)(mt().Ay,{focusInitial:!f().A.isMobile||void 0,focus:!f().A.isMobile||void 0,value:a,onChange:e=>{s(e.target.value)},placeholder:l.formatMessage(hd.selectorSearchPlaceholder)})});return(0,z.jsx)(_().A,{popupType:f().A.isMobile?_().z.SlideUp:_().z.Popup,buttonPopupStore:r,render:n=>{const i=e.filter((e=>{var t;return-1!==(null===(t=e.option)||void 0===t?void 0:t.toLowerCase().indexOf(a.toLowerCase()))})).map((({id:e,option:i,icon:r})=>({key:e,render:o=>(0,z.jsx)($().A,{focused:!1,onClick:o.onClick,icon:r,title:i,isChecked:e===t}),action:()=>{n.close(),o(e)}}))),r={key:"section",render:e=>(0,z.jsx)(x().A,{...e}),items:i};return(0,z.jsxs)(B().A,{menuType:T().gu.Popup,minWidth:260,maxWidth:"100vw",children:[d,0===i.length?(0,z.jsx)(x().A,{children:(0,z.jsx)(pd().u,{title:(0,z.jsx)(v().sA,{defaultMessage:"No results",id:"CollectionSettingsPropertyAiAutofill.searchBar.noResults.label"})})}):(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:void 0,sections:[r]})]})},renderOrigin:e=>(0,z.jsx)(so().A,{title:l.formatMessage(i),showChevron:!0,right:c&&(0,z.jsxs)(z.Fragment,{children:[c.icon,(0,z.jsx)("div",{style:{color:O().Tj.text.tertiary,paddingInlineStart:4,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"90%"},children:c.option})]}),rightStyle:{flexShrink:1},rotateChevron:r.state.open,disabled:!1,textWrapperStyle:{minWidth:"auto"},...e})})}const Ad=(0,v().YK)({removeAutofillButton:{defaultMessage:"Turn off AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.removeAutofillButton"},toggleFillWithAiSectionLabel:{defaultMessage:"Actions",id:"database.viewSettings.propertyTab.aiAutofill.actionsSectionLabel"}});function Id(e){const t=(0,v().tz)(),{property:o,collectionContextStore:r,collectionSettingsStore:a}=e,c=(0,s().K8)((()=>r.normalizedSchemaStore.state[o]),[o,r.normalizedSchemaStore]),d=(0,s().K8)((()=>r.collectionStore()),[r]),u=(0,s().K8)((()=>r.normalizedSchemaStore.getState()),[r]),p=c&&(0,ae().$M)(c)?(0,ae().om)(c):void 0,g=(0,l().v3)(),m=Td(),S=(0,s().K8)((()=>{const e=r.collectionStore();return e&&(0,qc().jq)(Jc().A.getMode(g,e,e.getSpaceStore()),e)}),[g,r]),y=St().Store.createValue({stage:"not_started"},{name:"tryAutofillStore"});(0,n.useEffect)((()=>{var e,t;if("page"===r.getViewType())return;if(!1!==(null===(e=r.getPropertyFormat(o))||void 0===e?void 0:e.visible))return;const n=new(ts().A)({name:"CollectionSettingsPropertyAiAutofill"});g.defaultRecordCache.inMemoryRecordCache.addCacheOverride(n);const i=null===(t=r.formatStore())||void 0===t?void 0:t.clone(n),l=r.getPropertyFormatKey();return i&&l&&A().createAndCommit({userAction:"CollectionSettingsPropertyAiAutofill.open",environment:g,canUndo:!0,perform:e=>{(0,yr().a)({formatStore:i,formatKey:l,property:o,update:{visible:!0},transaction:e})}}),()=>{g.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(n)}}),[r,g,o]);const h=(0,n.useRef)({}),j=(0,s().K8)((()=>{var e;return(0,ls().hn)({environment:g,spaceId:null===(e=r.collectionStore())||void 0===e?void 0:e.getSpaceId(),userId:g.currentUser.id})}),[g,r]),[w,I]=(0,n.useState)(c&&Hc().getDefaultAiInference(c,j)),[_,T]=(0,n.useState)(!1),k=(0,n.useCallback)((()=>{const e=r.collectionStore();if(!e||!c||!(0,ae().$M)(c))return;const t=(0,ae().om)(c);t&&"prompt"in t&&(h.current={...h.current,[t.type]:t.prompt}),Hc().saveOrRemovePropertyAiInference({environment:g,propertySchema:c,collectionStore:e,property:o,draftAiInference:w})}),[r,c,w,o,g]),P=(0,s().K8)((()=>{const e=r.collectionStore();return e?(0,Yc().tS)({environment:g,intl:t,store:e}):(0,zc().L)(t)}),[r,g,t]),B=(0,s().K8)((()=>"page"===r.getViewType()),[r]),V=(0,n.useCallback)((async()=>{if(c&&(0,ae().$M)(c)&&Ro().n4(w,(0,ae().om)(c)))R().os({collectionSettingsStore:a});else if(w){var e;if("prompt"in w)if((0,ae().qD)(w)&&0===(null===(e=w.prompt)||void 0===e?void 0:e.length)||(0,b().O9)(w.prompt)&&w.prompt.length>Nc().oV)return void T(!0);(null==p||!p.auto_update_on_edit)&&null!=w&&w.auto_update_on_edit&&j&&c?await Uc().U({sourceAction:"auto_update",propertyName:c.name,collectionName:P})&&k():k()}}),[P,a,p,w,k,j,c]),F=(0,n.useCallback)((()=>{const e=r.collectionStore();e&&p&&c&&(Hc().saveOrRemovePropertyAiInference({environment:g,propertySchema:c,collectionStore:e,property:o,draftAiInference:null}),R().yl({collectionSettingsStore:a}))}),[r,p,g,c,o,a]),D=c&&(0,ae().$M)(c)&&Ro().n4(w,(0,ae().om)(c)),E=(0,n.useCallback)((async()=>new Promise((e=>{To().ui({showCancel:!1,keepFocus:!1,message:(0,z.jsxs)(Kc().VP,{alignItems:"center",gap:8,children:[(0,z.jsx)(H().I,{icon:Lc().x,size:"lg",style:m.confirmDiscardChangesDialogIconStyle}),(0,z.jsx)("div",{style:m.confirmDiscardChangesDialogMessageStyle,children:(0,z.jsx)(v().sA,{defaultMessage:"Do you want to discard changes for AI autofill?",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.message"})})]}),items:[{label:(0,z.jsx)(v().sA,{defaultMessage:"Discard",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.acceptLabel"}),color:"red",onAccept:()=>e(!0)},{label:(0,z.jsx)(v().sA,{defaultMessage:"Continue editing",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.cancelLabel"}),onAccept:()=>e(!1)}]})}))),[m]),O=(0,n.useCallback)((async()=>{(D||await E())&&R().yl({collectionSettingsStore:a})}),[D,a,E]),K=(0,n.useCallback)((async()=>{(D||await E())&&R().os({collectionSettingsStore:a})}),[D,a,E]),{spaceId:N,userId:L}=(0,s().K8)((()=>{var e;return{spaceId:null==d?void 0:d.getSpaceId(),userId:null===(e=ze().default.state.currentUserStore)||void 0===e?void 0:e.id}}),[d]),U=(0,Fn()._)({name:"collection_property_autofill",spaceId:N,userId:L,amount:"unknown"}),W=(0,n.useCallback)((async()=>{if(D)return!1;return!(await E())}),[D,E]);return Zc(r,W),c&&(0,ae().$M)(c)&&d?(0,z.jsx)(i().N,{debugName:"CollectionSettingsPropertyAiAutofill",capture:!0,onEsc:K,children:(0,z.jsxs)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Fill â€œ{propertyName}â€ with AI",id:"database.viewSettings.propertyTab.aiAutofill.title",values:{propertyName:c.name}}),handleBackArrowClick:O,handleClose:K,children:[S?void 0:(0,z.jsx)(x().A,{style:m.menuItemStyle,children:(0,z.jsx)(v().sA,{defaultMessage:"You donâ€™t have permission to set up AI autofill on this database.",id:"database.viewSettings.propertyTab.aiAutofill.noSetupPermission"})}),U&&"text"===c.type?(0,z.jsx)(xd,{collectionContextStore:r,propertySchema:c,previousPromptByAiInferenceType:h.current,isAutofillSetupEnabled:Boolean(S),draftAiInference:w,setDraftAiInference:I,environment:g,propertyId:o,collectionSchema:u,shouldShowUserPromptIsInvalidError:_,setShouldShowUserPromptIsInvalidError:T,autofillFeatureAvailability:U}):void 0,U&&(0,ae().lx)(c)?(0,z.jsx)(ud,{collectionContextStore:r,isAutofillSetupEnabled:Boolean(S),draftAiInference:w,setDraftAiInference:I,environment:g,shouldShowUserPromptIsInvalidError:_,setShouldShowUserPromptIsInvalidError:T,autofillFeatureAvailability:U}):void 0,(0,ae().bB)(w,c.type)?(0,z.jsxs)(x().A,{children:[(0,z.jsx)(_d,{environment:g,isAutofillSetupEnabled:S,collectionContextStore:r,tryAutofillStore:y,propertySchema:c,property:o,aiInference:w}),(0,z.jsx)(M().A,{colorPalette:"blue",style:{...m.buttonStyle,marginTop:8,marginInlineEnd:12,marginBottom:12,marginInlineStart:12,display:D?"none":"flex"},onClick:V,disabled:!S,children:D?(0,z.jsx)(v().sA,{defaultMessage:"Done",id:"database.viewSettings.propertyTab.aiAutofill.saveButtonAllSaved"}):(0,z.jsx)(v().sA,{defaultMessage:"Save changes",id:"database.viewSettings.propertyTab.aiAutofill.saveButtonWithChanges"})})]}):void 0,(0,z.jsxs)(x().A,{topBorder:!0,title:f().A.isMobile&&t.formatMessage(Ad.toggleFillWithAiSectionLabel),children:[U&&(0,ae().bB)(p,c.type)?(0,z.jsxs)(z.Fragment,{children:[B?void 0:(0,z.jsx)($c().Ve,{environment:g,collectionContextStore:r,collectionStore:d,property:o,propertySchema:c,autofillFeatureAvailability:U,isAutofillSetupEnabled:Boolean(S)}),(0,z.jsx)(so().A,{icon:Q().trashIcon,isRedOnHover:!0,focused:!1,title:t.formatMessage(Ad.removeAutofillButton),onClick:F,disabled:!S})]}):void 0,(0,z.jsx)(Ml().A,{href:(0,Lo().x)("guides.aiAutofill"),title:(0,z.jsx)(v().sA,{defaultMessage:"Learn about AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.learnMoreLink"}),analyticsFrom:"collection_ai_autofill_menu"})]})]})}):null}function _d({environment:e,isAutofillSetupEnabled:t,collectionContextStore:o,tryAutofillStore:i,propertySchema:r,property:l,aiInference:a}){const[c,d]=(0,n.useState)(yt().JW()),u=(0,n.useRef)(yt().JW()),p=(0,s().K8)((()=>i.state.stage),[i]),g=(0,s().K8)((()=>{const e=o.contextTypeFromStoreState;if("collectionPage"===e)return{type:"page",candidateBlockStores:Ro().oE([(0,Qc().a)()])};if("collectionTypedView"===e||"collectionView"===e)return{type:"collection",candidateBlockStores:o.resultsInViewOrder(5)};throw new Error(`Unexpected context type: ${e}`)}),[o]),m=(0,n.useCallback)((()=>{var t;Wc().trackAiAutofillAction(e,{ai_inference_type:a.type,type:"undo_from_collection_settings",inference_id:c,collection_id:null===(t=o.collectionStore())||void 0===t?void 0:t.id,session_id:u.current}),"not_started"!==p&&(Ws().tN({environment:e,preventSelectText:!1}),i.setState({stage:"not_started"}))}),[e,a,c,o,p,i]),S=!(0,s().O$)(Va().e),{spaceId:y,userId:h}=(0,s().K8)((()=>{var e;return{spaceId:null===(e=o.collectionStore())||void 0===e?void 0:e.getSpaceId(),userId:o.getCurrentUserId()}}),[o]),x=(0,Fn()._)({name:"collection_property_autofill",spaceId:y,userId:h,amount:5}),C=(0,b().EI)(g.candidateBlockStores),j=Td({isTryAutofillEnabled:t&&C}),w=Boolean((0,n.useContext)(Xc().sf));if(f().A.isMobile||w)return null;let A;return A=(0,xn().e2)(x)?C?"collection"===g.type?(0,z.jsx)(v().sA,{defaultMessage:"Updates the first {maxPages} pages. You can undo changes anytime.",id:"database.viewSettings.propertyTab.aiAutofill.tryOnCollectionDescription",values:{maxPages:5}}):(0,z.jsx)(v().sA,{defaultMessage:"Updates â€œ{propertyName}â€ on this page. You can undo changes anytime.",id:"database.viewSettings.propertyTab.aiAutofill.tryOnPageDescription",values:{propertyName:r.name}}):(0,z.jsx)(v().sA,{defaultMessage:"Add more pages or remove filters to try AI on this view.",id:"database.viewSettings.propertyTab.tryAutofillDisabledDescription"}):(0,z.jsx)(v().sA,{defaultMessage:"Upgrade Notion AI to try AI on this view",id:"database.viewSettings.propertyTab.aiAutofill.tryAutofillDisableAIUpsellDescription"}),(0,z.jsx)("div",{style:{margin:"8px 12px"},children:(0,z.jsxs)(Kc().fI,{gap:8,children:[(0,z.jsx)(he().p,{disabled:!t||!C,style:{...j.buttonStyle,...j.undoButtonStyle,..."not_started"===p&&{display:"none"}},onClick:m,children:(0,z.jsx)(v().sA,{defaultMessage:"Undo",id:"database.viewSettings.propertyTab.aiAutofill.undoButton"})}),(0,z.jsx)(Ye().m,{renderTooltip:()=>S?(0,z.jsx)("div",{children:(0,z.jsx)(v().sA,{...Os().AY.aiUnavailableOfflineTooltip})}):(0,z.jsx)("div",{children:A}),render:n=>(0,z.jsx)(he().p,{...n,disabled:!t||!C||S||!(0,xn().e2)(x),style:{...j.buttonStyle,...j.tryButtonStyle},hoveredStyle:j.tryButtonHoveredStyle,pressedStyle:j.tryButtonPressedStyle,onClick:async()=>{if(!x||(0,xn().e2)(x)){if((0,b().EI)(g.candidateBlockStores)){const t=yt().JW();d(t),i.setState({stage:"in_progress"}),await Hc().autofillPropertyForBlocks({environment:e,stores:g.candidateBlockStores,property:l,propertySchema:r,aiInferenceOverride:a,userEventForAnalytics:"generate_from_try_on_view_button",sessionIdForAnalytics:u.current,collectionContextStore:o,from:"ai_autofill_settings"}),i.setState({stage:"complete"})}}else Hc().triggerAiAutofillUpsell({environment:e,from:"ai_autofill_try_on_view",upsell:x.upsell,store:o.collectionStore()})},children:"in_progress"===p?(0,z.jsx)(Gc().A,{colorPalette:"purple"}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(H().I,{icon:Lc().x,size:"sm",style:{..."not_started"!==p&&{display:"none"}}}),"not_started"!==p?(0,z.jsx)(v().sA,{defaultMessage:"Try again",id:"database.viewSettings.propertyTab.aiAutofill.tryAgain"}):"collection"===g.type?(0,z.jsx)(v().sA,{defaultMessage:"Try on this view",id:"database.viewSettings.propertyTab.aiAutofill.tryOnCollection"}):(0,z.jsx)(v().sA,{defaultMessage:"Try on this page",id:"database.viewSettings.propertyTab.aiAutofill.tryOnPage"})]})})})]})})}function Td(e){const t=(0,h().eP)();return(0,h().IS)((()=>({buttonStyle:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8},menuItemStyle:{fontSize:13,borderRadius:6,background:O().Tj.palette.purple[50],color:O().Tj.palette.purple[500],margin:"8px 12px",padding:"8px 12px"},undoButtonStyle:{border:`1px solid ${O().Tj.palette.gray[100]}`,flex:1},tryButtonStyle:{fontWeight:500,flex:1,background:null!=e&&e.isTryAutofillEnabled?"light"===t?O().Tj.palette.purple[50]:O().Tj.palette.purple[200]:O().Tj.palette.gray[75],color:null!=e&&e.isTryAutofillEnabled?O().Tj.purple.text.accentPrimary:O().Tj.palette.gray[400]},fillAllPagesWandIconStyle:{fill:O().Tj.purple.icon.accentPrimary},tryButtonHoveredStyle:{background:O().Tj.palette.purple[100]},tryButtonPressedStyle:{background:O().Tj.palette.purple[200]},confirmDiscardChangesDialogIconStyle:{fill:O().Tj.purple.icon.accentPrimary,paddingTop:8},confirmDiscardChangesDialogMessageStyle:{textAlign:"center",fontWeight:500}})),[null==e?void 0:e.isTryAutofillEnabled,t])}var kd=()=>o(806080),Md=()=>o(413955),Pd=()=>o(29554),Bd=()=>o(938946),Vd=()=>o(208698),Fd=()=>o(858901);const Dd=(0,v().YK)({changeIcon:{id:"collectionSettingsPropertyType.iconButton.ariaLabel",defaultMessage:"Change icon"}});function Ed(e){const{collectionContextStore:t,collectionSettingsStore:o,onAccept:r,propertySchema:a,disableSuggestions:c,propertyGroupId:d}=e,{isDesktop:u}=(0,l().Y0)(),p=(0,v().tz)(),g=(0,h().DP)(),m=(0,h().eP)(),[S,y]=(0,n.useState)(""),[j,w]=(0,n.useState)(null==a?void 0:a.icon),[A,I]=(0,n.useState)(!1),_=(0,n.useCallback)((e=>{const{propertyType:t,isSuggestedProperty:o,propertyName:n}=e;r({propertyType:t,isSuggestedProperty:o,propertyName:S.length>0?S:n,propertyIcon:j})}),[r,S,j]),{suggestedAndSearchSections:T,propertyTypeSections:k,setShowSearchInput:M,setSearchInput:P,searchInput:B}=function(e){const{collectionContextStore:t,propertySchema:o,onAccept:i,userInput:r,disableSuggestions:a,propertyGroupId:c}=e,d=(0,l().v3)(),u=(0,v().tz)(),[p,g]=(0,n.useState)(""),[m,S]=(0,n.useState)(!1),y=(0,n.useCallback)((e=>{g(e.target.value)}),[g]),f=(0,n.useCallback)((()=>{S((e=>!e))}),[S]),x=(0,s().K8)((()=>{var e;if(!t)return;const o=null===(e=t.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.app_config_uri;return o?(0,fi().l)((0,Md().appConfigs)(),o):void 0}),[t]),{hasAiEnabled:C,showAiSuggestions:j}=(0,Bd().xv)({environment:d,collectionContextStore:t,appConfig:x}),w=(0,Bd().Re)({environment:d,propertySchema:o,onAccept:i,collectionContextStore:t,section:"all"}),A=(0,Bd().p1)({}),I=(0,n.useMemo)((()=>({...w,...A})),[w,A]),_=(0,Bd().D1)({collectionContextStore:t,propertySchema:o,propertyGroupId:c,propertyName:r}),[T,k]=(0,Bd().b9)({collectionContextStore:t}),M=p.length>0,P=(0,n.useCallback)((e=>e.splice(0,Bd().il)),[]),B=(0,n.useCallback)((e=>{let t;return t=M?e:P(e),Tl().filter(p,t).filter((e=>!(M&&(I.hasOwnProperty(e.original)||null!=_&&_.hasOwnProperty(e.original)||null!=k&&k.hasOwnProperty(e.original))))).map((e=>e.original.toString()))}),[M,p,I,_,k,P]),V=(0,Bd().ds)({hasAiEnabled:C,showAiSuggestions:j,collectionContextStore:t,propertySchema:o,onAccept:i,disableSuggestions:a,getFilteredSuggestedItemKeys:B}),F=(0,n.useMemo)((()=>{if("loading"===V)return[];const e=Object.values(V);return e.length>4?e.slice(0,4):e}),[V]),D=(0,n.useMemo)((()=>{const e=e=>void 0!==I[e.original]?[I[e.original]]:Object.values(I).find((t=>t.searchKeys.includes(e.original)))??[],t=Object.values(I).flatMap((e=>e.searchKeys));return(0,kd().sb)(Tl().filter(p,t).flatMap(e))}),[p,I]),E=(0,n.useMemo)((()=>_?Tl().filter(p,(0,b().uv)(_)).flatMap((e=>_[e.original])):[]),[_,p]),O=(0,n.useMemo)((()=>{if(!T)return{};const e={};return(0,b().uv)(T).forEach((t=>{const o=Tl().filter(p,(0,b().uv)(T[t])).flatMap((e=>T[t][e.original]));o.length>0&&(e[t]=o)})),e}),[T,p]),R=(0,h().IS)((()=>({titleContainer:{display:"flex",alignItems:"center"},desktopTitleStyle:{marginBottom:0,paddingBottom:0,marginTop:2},searchInputSectionStyle:{paddingBottom:0,marginBottom:4},standardSectionStyle:{paddingTop:0}})),[]),K=(0,z.jsx)("span",{style:R.titleContainer,children:(0,z.jsx)("span",{children:u.formatMessage(Bd().DZ.suggestedSectionTitle)})}),N=(0,Bd().D9)({filteredSuggestedPropertyItems:F,hasSearchInput:M,showAiSuggestions:j,disableSuggestions:Boolean(a||o),isLoading:"loading"===V,title:K,from:"collectionSettings"}),L=(0,Bd().bi)({searchProperties:{searchInput:p,showSearchInput:m,handleSearchInputChange:y,handleToggleSearchInput:f},titleText:u.formatMessage(Bd().DZ.typesSectionTitle),desktopTitleStyle:R.desktopTitleStyle,desktopStyle:R.searchInputSectionStyle,topBorder:N.items.length>0}),U=(0,Bd().Dm)({filteredStandardPropertyItems:D,key:"standard",desktopStyle:R.standardSectionStyle}),W=(0,Bd().bj)({filteredConnectedPropertyItems:E}),H=(0,Bd().f1)({filteredConnectedPropertyItemsPerIntegration:O}),$=(0,n.useMemo)((()=>[N,L]),[N,L]),G=(0,n.useMemo)((()=>[U,...H,W]),[U,H,W]);return{suggestedAndSearchSections:$,propertyTypeSections:G,setShowSearchInput:S,setSearchInput:g,searchInput:p}}({collectionContextStore:t,collectionSettingsStore:o,propertySchema:a,onAccept:_,disableSuggestions:c,userInput:S,propertyGroupId:d}),V=(0,n.useMemo)((()=>[...T,...k]),[T,k]),F=(0,s().K8)((()=>{const e=null==t?void 0:t.collectionStore();if(e)return(0,Pd().r4)(e.getName(),e)}),[t]),E=(0,s().K8)((()=>t.permissionScopesStore.state.isExternallyImportedAndSyncedCollection),[t.permissionScopesStore]),R=(0,sd().a)(),K=(0,n.useCallback)((e=>{y(e.target.value)}),[y]),N=(0,n.useCallback)((()=>{_({propertyType:"text",isSuggestedProperty:!1,propertyName:S})}),[_,S]),L=(0,n.useCallback)((()=>{I(!0)}),[]),W=(0,n.useCallback)((()=>{I(!1)}),[]),H=(0,n.useCallback)((e=>{e.key&&1===e.key.length&&/[a-zA-Z]/.test(e.key)&&(e.preventDefault(),P(e.key.toLowerCase()),M(!0))}),[P,M]),$=(0,n.useMemo)((()=>(0,Fd().rs)(k)),[k]),G=(0,Fd().zx)($),Q=(0,n.useMemo)((()=>T.reduce(((e,t)=>e+t.items.length),0)),[T]),q=(0,n.useMemo)((()=>{if(B.trim())return Q;if(!S.trim())return;const e=G(S);return void 0!==e?e+Q:void 0}),[G,S,B,Q]),Y=(0,n.useMemo)((()=>({enforceIconColor:"gray",backgroundColor:R?O().Tj.white:void 0,iconStyle:{fill:Vo().l8[m].gray},icon:e=>(0,z.jsx)(Je().zB,{type:"text",icon:j,size:D().Ev.sm,theme:g,style:e}),onSubmit:e=>{w(e)}})),[j,g,R,m]),X=(0,Vd().$)({iconButton:Y,onDelete:()=>{w(void 0)}}),J=(0,h().IS)((()=>({inputOuterStyle:R?{backgroundColor:O().Tj.white}:{},inputContainer:{padding:"0px 8px"}})),[R]),Z=(0,U().X)("jira_notion_only_properties");return E&&!Z?null:(0,z.jsxs)(C().A,{...e,title:a?p.formatMessage(Bd().DZ.changePropertyType):u&&F?p.formatMessage(Bd().DZ.newPropertyWithDatabaseName,{databaseName:F}):p.formatMessage(Bd().DZ.newProperty),children:[a?null:(0,z.jsx)(x().A,{isInput:!0,children:(0,z.jsx)(mt().Ay,{focusInitial:!f().A.isMobile||void 0,focus:!f().A.isMobile||void 0,autoFocus:!f().A.isMobile||void 0,value:S,onChange:K,onFocus:L,onBlur:W,inputOuterStyle:J.inputOuterStyle,style:J.inputContainer,placeholder:p.formatMessage(Bd().DZ.propertyNameInputPlaceholder),left:(0,z.jsx)(mt().KF,{icon:Y.icon,iconStyle:Y.iconStyle,onClick:X,ariaLabel:p.formatMessage(Dd.changeIcon)})})}),(0,z.jsx)(i().N,{debugName:"CollectionSettingsPropertyTypeTypeAhead",capture:!A,onKeypress:H,children:(0,z.jsx)(le().A,{type:le().O.Vertical,sections:V,disableInitialScroll:!0,initialFocus:q,resetInitialFocusOnSectionChange:!1,onEmptyEnter:N})})]})}function Od(e){const{collectionContextStore:t,collectionSettingsStore:o,property:i,initialPropertyName:r,formatKey:a,propertyGroupId:c,newPropertyFormat:d}=e,u=(0,l().v3)(),p=(0,n.useMemo)((()=>St().Store.createValue("")),[]),g=(0,s().K8)((()=>t.collectionViewBlockStore()),[t]),m=(0,s().K8)((()=>{var e;const t=(0,Cl().S)(o);if("setupRelation"===(null==t?void 0:t.type))return null===(e=t.targetCollectionPointer)||void 0===e?void 0:e.id}),[o]),S=(0,n.useMemo)((()=>({type:"relation",currentValue:m})),[m]),y=(0,n.useCallback)((e=>{if(!t.collectionStore())return;(0,Sr().X)({environment:u,collectionContextStore:t,action:"select_relation_source"});const{stack:n}=o.state,l=n.length<2?void 0:n[n.length-2];l&&"setupRelation"===l.type&&R().yl({collectionSettingsStore:o}),R().dP({collectionSettingsStore:o,item:{type:"setupRelation",property:i,initialPropertyName:r,formatKey:a,propertyGroupId:c,targetCollectionPointer:e.pointer,newPropertyFormat:d}})}),[t,u,o,i,r,a,c,d]),f=(0,n.useCallback)((()=>{R().os({collectionSettingsStore:o})}),[o]);return g?(0,z.jsx)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Related to",id:"database.viewSettings.selectNewRelationSourceTab.title"}),handleClose:f,children:(0,z.jsx)(ba,{collectionContextStore:t,onAccept:y,parentStore:g,context:bo().U9.Relation,inputStore:p,suggestionConfig:S})}):null}function Rd(e){const{collectionContextStore:t,collectionSettingsStore:o,module:i,onClose:r}=e,l=(0,n.useMemo)((()=>St().Store.createValue("")),[]),{collectionStore:a}=(0,Xc().bi)(),c=(0,s().K8)((()=>t.collectionViewBlockStore()),[t]),d=(0,n.useCallback)((e=>{R().dP({collectionSettingsStore:o,item:{type:"setupViewsModule",targetCollectionPointer:e.pointer,module:i,onClose:r}})}),[o,i,r]),u=(0,s().K8)((()=>{var e;return{type:"viewModuleTab",currentValue:null===(e=t.collectionStore())||void 0===e?void 0:e.id,collectionParentCollectionViewBlockStore:null==a?void 0:a.getParentCollectionViewBlockStore()}}),[t,a]);return c?(0,z.jsx)(C().A,{...e,handleClose:()=>R().os({collectionSettingsStore:o}),children:(0,z.jsx)(ba,{collectionContextStore:t,onAccept:d,parentStore:c,context:bo().U9.Relation,inputStore:l,collectionStore:a,suggestionConfig:u})}):null}var Kd=()=>o(935664),Nd=()=>o(155269),zd=()=>o(317406),Ld=()=>o(775584),Ud=()=>o(395963),Wd=()=>o(838038),Hd=()=>o(896427),$d=()=>o(992307),Gd=()=>o(860037);function Qd(e){const{collectionContextStore:t,collectionSettingsStore:o,formatKey:i,property:r,initialPropertyName:a,propertyGroupId:c,targetCollectionPointer:d,from:u,newPropertyFormat:p}=e,g=(0,l().v3)(),S=(0,v().tz)(),y=(0,s().K8)((()=>t.collectionStore()),[t]),f=(0,s().K8)((()=>{const e=t.collectionViewBlockStore();return function(e){const{targetCollectionPointer:t,collectionStore:o,collectionViewBlockStore:n}=e;if(!t)return;if(o&&o.pointer===t)return o;return n?xt().m.createChildStore(n,t):void 0}({targetCollectionPointer:d,collectionStore:y,collectionViewBlockStore:e})}),[t,y,d]),b=(0,s().K8)((()=>r?fr().Jq(t,r):void 0),[t,r]),j=Boolean(y&&f&&y.id===f.id),w=Boolean("relation"===(null==b?void 0:b.type)&&b.connectedRelation),I=Boolean("subitem"===u),_=Boolean("timeline_arrows_by"===u),T=I||_,k=(0,s().K8)((()=>t.contextTypeFromStoreState),[t]),M=(0,s().K8)((()=>{if(void 0!==a&&""!==a&&a!==ls().dC.relation)return a;const e=null==y?void 0:y.getSchema();return void 0===(null==b?void 0:b.name)&&f&&e?fr().$H(S,{targetCollectionStore:f,isSelfRelation:j,sourceSchema:e,createUnique:!0,from:u}):(null==b?void 0:b.name)||""}),[a,y,null==b?void 0:b.name,f,S,j,u]),[P,B]=(0,n.useState)(M),[V,F]=(0,n.useState)("no_limit"),[D,E]=(0,n.useState)({hasInverseRelation:T,inverseName:void 0,autoRelate:{enabled:!1}}),O=(0,h().IS)((()=>({relationOptions:{marginTop:10}})),[]),K=(0,n.useCallback)((()=>{R().a2({collectionSettingsStore:o,item:{type:"selectRelationSource",property:r,formatKey:i}})}),[o,r,i]),N=(0,n.useCallback)((()=>{if(!D)return;const{hasInverseRelation:e,inverseName:n,autoRelate:l}=D,a=t.collectionStore(),s=t.collectionViewStore(),d=t.normalizedFormatStore.state;if(!a||!f)return;const y=p&&i?{...d,[i]:p}:d,{performResult:h}=A().createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:g,canUndo:!0,perform:o=>{const d=r??(0,Nd().createProperty)({environment:g,collectionStore:a,collectionViewArgs:s&&i?{collectionViewStore:s,format:y,formatKey:i}:void 0,propertyType:"relation",transaction:o});if(Wd().cT({environment:g,collectionContextStore:t,collectionStore:a,property:d,propertyName:P,targetCollectionStore:f,hasInverseRelation:e,inverseName:n,autoRelate:l,propertyLimit:V,intl:S,transaction:o,from:u}),c&&d&&(0,Ud().En)({collectionStore:a,groupId:c,propertyId:d,transaction:o}),s){var p;const e=(null===(p=s.getFormat().table_properties)||void 0===p?void 0:p.find((e=>e.property===d)))??{property:d,visible:!0};m().zA({stores:[s],update:{table_properties:[...s.getFormat().table_properties??[],e]},transaction:o})}return"subitem"===u&&s?cr().zt({environment:g,collectionContextStore:t,relationPropertyId:d,transaction:o}):"timeline_arrows_by"===u&&s&&(zd().Tq({collectionViewStore:s,newProperty:d,transaction:o}),zd().L_({collectionContextStore:t,relationPropertyId:d,transaction:o})),d}});"subitem"===u||"timeline_arrows_by"===u?(R().yl({collectionSettingsStore:o}),R().a2({collectionSettingsStore:o,item:{type:"main"}})):R().n1({collectionSettingsStore:o,property:h,formatKey:i}),(0,Kd().Z)({environment:g,collectionContextStore:t,from:"collectionPage"===k?"page_properties":"view_settings",property_type:"relation",property_id:h}),(0,Ld().F)()&&R().os({collectionSettingsStore:t.settingsStore})}),[D,t,f,g,u,k,r,i,c,P,V,S,o,p]),L=(0,n.useCallback)((e=>{B(e.target.value)}),[B]),U=(0,n.useCallback)((e=>{F(e)}),[F]);return(0,z.jsxs)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"New relation",id:"database.viewSettings.setupRelationTab.title"}),children:[(0,z.jsxs)(x().A,{isInput:!0,children:[(0,z.jsx)(mt().Ay,{value:P,placeholder:S.formatMessage({defaultMessage:"Property name",id:"database.viewSettings.setupRelationTab.propertyNamePlaceholder"}),onChange:L,onBlur:kd().lQ,onSubmit:kd().lQ,focusInitial:!0,selectAll:!1}),(0,z.jsxs)("div",{style:O.relationOptions,children:[(0,z.jsx)(Gd().A,{isSelfRelation:j,collectionStore:f,showAs:"chevron",onClick:K,disabled:I}),u?null:(0,z.jsx)($d().o,{selectedKey:V,propertyType:"relation",onChange:U}),f&&!w?(0,z.jsx)(Hd().Ay,{collectionContextStore:t,targetCollectionStore:f,property:r,mode:"create",temporaryInverseState:D,setTemporaryInverseState:E,onSubmit:N,shouldEnforceTwoWayRelation:T}):null]})]}),(0,z.jsx)(x().A,{children:(0,z.jsx)(Ml().A,{href:(0,Lo().x)("guides.relations"),title:(0,z.jsx)(v().sA,{id:"database.viewSettings.propertyTab.relations.learnMoreButton.title",defaultMessage:"Learn about relations"}),analyticsFrom:"view_settings_property_relation"})})]})}var qd=()=>o(416504),Yd=()=>o(154017),Xd=()=>o(626318),Jd=()=>o(447453);function Zd(e){const{collectionContextStore:t,collectionSettingsStore:o,targetCollectionPointer:i,module:r,onClose:a}=e,c=(0,v().tz)(),{layoutStore:d,setModuleSelection:u}=(0,Xc().LH)(),{collectionStore:p}=(0,Xc().bi)(),g=(0,l().v3)(),m=(0,s().K8)((()=>d.inMemoryRecordCache),[d]),S=(0,s().K8)((()=>{if(!i)return;if(p&&p.pointer===i)return p;const e=t.collectionViewBlockStore();return e?xt().m.createChildStore(e,i):void 0}),[t,p,i]),y=(0,s().K8)((()=>null==S?void 0:S.canEditCollection()),[S]),b=Boolean(p&&S&&p.id===S.id),j=(0,s().K8)((()=>{var e;return null==S||null===(e=S.getModel())||void 0===e?void 0:e.getRenderTitle({getRecordModel:null==p?void 0:p.getRecordModel,intl:c,userTimeZone:(0,qd().P)()})}),[S,p,c]),w=(null==S?void 0:S.id)!==(null==p?void 0:p.id),[I,_]=(0,n.useState)(j??""),[T,k]=(0,n.useState)({hasInverseRelation:w,inverseName:void 0,autoRelate:{enabled:!1}}),[P,B]=(0,n.useState)(!1),V=(0,n.useCallback)((()=>{R().a2({collectionSettingsStore:o,item:{type:"selectViewsModuleSource",module:r}})}),[o,r]),F=(0,n.useCallback)((()=>{B((e=>!e))}),[]),D=(0,n.useCallback)((()=>{k((e=>({...e,hasInverseRelation:!1})))}),[]),E=(0,n.useCallback)((()=>{k((e=>({...e,hasInverseRelation:!0})))}),[]),K=(0,n.useCallback)((e=>{var t;const o=null!=T&&null!==(t=T.autoRelate)&&void 0!==t&&t.enabled?{enabled:!1}:{enabled:!0,bot_id:e};k((t=>({...t,autoRelate:{enabled:Boolean(o),bot_id:e}})))}),[T]),N=(0,n.useCallback)((e=>{k((t=>({...t,inverseName:e.target.value})))}),[]),L=(0,n.useCallback)((()=>{const e=null==t?void 0:t.collectionViewBlockStore();if(!e)throw new Error("Views module block not found");const{performResult:n}=A().createAndCommit({userAction:"CollectionSettingsSetupViewsModule.handleAddView",environment:g,canUndo:!0,perform:o=>{let n;if(P&&p){const e=(0,Nd().createProperty)({environment:g,collectionStore:p,collectionViewArgs:void 0,propertyType:"relation",transaction:o}),{inverseRelationPropertyId:i}=Wd().cT({environment:g,collectionContextStore:t,collectionStore:p,property:e,propertyName:I,targetCollectionStore:S??p,hasInverseRelation:T.hasInverseRelation,inverseName:T.inverseName,autoRelate:T.autoRelate,intl:c,transaction:o,propertyLimit:"no_limit"})??{};n=i??e}const i=(0,Xd().Bj)({environment:g,transaction:o,collectionViewBlockStore:e,targetCollectionPointer:null==S?void 0:S.pointer,viewName:I,relationPropertyId:n,inMemoryRecordCache:m});return u({type:"existing_module",moduleId:r.id,isDragging:!1}),{collectionViewPointer:i}}});null==a||a(),R().os({collectionSettingsStore:o});const{collectionViewPointer:i}=n??{};i&&(nr().default.afterNextFlush((()=>{t&&((0,Ms().t)({environment:g,collectionContextStore:t,collectionViewId:i.id,isFullScreen:!1,isRootChild:!1,isInPeekRenderer:!1}),(0,Jd().O)({collectionContextStore:t,collectionSettingsStore:t.settingsStore,closeOnEscape:!1}))})),t&&(0,Yd().b)({environment:g,collectionContextStore:t,view_type:"table",from:"viewsMain",is_in_page_builder:!0})),R().os({collectionSettingsStore:o})}),[t,g,o,P,p,I,S,T,c,m,u,r.id,a]),U=(0,s().K8)((()=>null==S?void 0:S.getIcon()),[S]),W=(0,h().IS)((()=>({chevronTitle:{marginInlineStart:4,display:"inline",wordBreak:"break-word",alignSelf:"center",...We().RC},relationMenuTitle:{display:"flex",alignItems:"center",whiteSpace:"pre"},helpIcon:{marginInlineStart:6},tooltip:{maxWidth:285,width:"max-content",overflowWrap:"break-word",textWrap:"wrap",whiteSpace:"pre-line"},tooltipSecondary:{color:O().Tj.text.inverseSecondary}})),[]),$=P&&S&&y;return(0,z.jsxs)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"New view",id:"database.viewSettings.setupViewTab.title"}),children:[(0,z.jsx)(x().A,{isInput:!0,children:(0,z.jsx)(mt().Ay,{value:I||"",placeholder:P?c.formatMessage({defaultMessage:"View & relation name",id:"database.viewSettings.mainTab.viewNameAndRelationNameSection.title"}):c.formatMessage({defaultMessage:"View name",id:"database.viewSettings.mainTab.viewNameSection.title"}),onChange:e=>_(e.target.value),onBlur:kd().lQ,onSubmit:kd().lQ,focusInitial:!0,selectAll:!1})}),(0,z.jsxs)(x().A,{children:[(0,z.jsx)(so().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"View of",id:"database.viewSettings.setupViewsModule.viewOf.title"}),showChevron:!0,onClick:V,disabled:!1,right:b?(0,z.jsx)(v().sA,{defaultMessage:"This database",id:"database.viewSettings.editRelation.selfRelationTarget.title"}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(ja().B6,{icon:U,iconRecordCategory:"collection",isEmptyPage:!1,size:20,disabled:!0}),(0,z.jsx)(jn().A,{store:S,style:W.chevronTitle})]}),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0}}),(0,z.jsx)(An().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Add new relation",id:"database.viewSettings.addRelationToggle"}),on:P,onClick:F,focused:!1,disabled:!y})]}),$?(0,z.jsx)(x().A,{topBorder:!0,children:(0,z.jsx)(Hd().EB,{currentInverseState:Boolean(null==T?void 0:T.hasInverseRelation),disableInverseRelation:D,enableInverseRelation:E,handleAutoRelateToggle:K,temporaryInverseState:T,collectionStore:p,targetCollectionStore:S,isTwoWayToggleDisabled:!b,isNameDisabled:!1,menuTitle:(0,z.jsxs)("div",{style:W.relationMenuTitle,children:[c.formatMessage(Hd().DZ.generic.title),f().A.isMobile?void 0:(0,z.jsx)(Ye().m,{placement:"bottom",textWrap:!0,style:W.tooltip,render:e=>(0,z.jsx)("div",{...e,style:W.helpIcon,children:(0,z.jsx)(H().I,{icon:Eo().questionMarkCircleSmallIcon,size:"sm",colorVariant:"tertiary"})}),renderTooltip:()=>(0,z.jsxs)(z.Fragment,{children:[b?c.formatMessage(eu.selfTwoWayRelationTooltip):c.formatMessage(eu.nonSelfTwoWayRelationTooltip),b?void 0:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("br",{}),(0,z.jsx)("span",{style:W.tooltipSecondary,children:(0,z.jsx)(v().sA,{...eu.nonSelfTwoWayRelationTooltipSecondary})})]})]})})]}),autoRelate:null==T?void 0:T.autoRelate,isSelfRelation:b,inverseRelationName:(null==T?void 0:T.inverseName)??"",handleInverseNameChange:N})}):void 0,(0,z.jsx)(x().A,{children:(0,z.jsx)(M().A,{colorPalette:"blue",style:{display:"flex",marginTop:0,marginInlineEnd:8,marginBottom:8,marginInlineStart:8},onClick:L,disabled:0===I.length,children:P?(0,z.jsx)(v().sA,{...eu.addViewAndRelationButton}):(0,z.jsx)(v().sA,{...eu.addViewButton})})})]})}const eu=(0,v().YK)({addViewButton:{defaultMessage:"Add view",id:"database.viewSettings.addViewButton"},addViewAndRelationButton:{defaultMessage:"Add view & relation",id:"database.viewSettings.addViewAndRelationButton"},selfTwoWayRelationTooltip:{defaultMessage:"Manage separate properties for each direction of a two-way relation.",id:"database.viewSettings.selfTwoWayRelationTooltip"},nonSelfTwoWayRelationTooltip:{defaultMessage:"Manage separate properties for each direction of a two-way relation.",id:"database.viewSettings.nonSelfTwoWayRelationTooltip"},nonSelfTwoWayRelationTooltipSecondary:{defaultMessage:"This setting is required for relations of linked databases in tabbed views.",id:"database.viewSettings.nonSelfTwoWayRelationTooltipSecondary"}});var tu=()=>o(68263),ou=()=>o(848538);var nu=()=>o(579627),iu=()=>o(484595);function ru({collectionSettingsStore:e,collectionContextStore:t,integrationName:i,integrationIcon:r,fullHeight:a}){const c=(0,l().v3)(),d=(0,h().IS)((()=>({promptTitle:{color:O().Tj.text.primary,fontWeight:We().Wy.semibold,fontSize:14}})),[]),[u,g]=(0,n.useState)(!1),m=(0,s().K8)((()=>t.collectionViewBlockStore()),[t]),S=(0,s().K8)((()=>null==m?void 0:m.getSpaceStore()),[m]),[{value:y}]=(0,et().Yb)((async()=>{if(!m||!S)return{numberOfGuests:void 0,numberOfUsers:void 0,isPublic:void 0};const e=(0,o(499764).i0)(m).map((e=>e.permissionItem));let t=!1,n=!1;for(const o of e)tu().FP(o)?t=!0:tu().Lg(o)&&!tu().$I(o.role)&&(n=!0);const i=Ro().oE(await(0,Ko().lX)(e,10,(async e=>{if("user_permission"===e.type){const t=(0,o(230711).dp)(S,e.user_id);return await t.load(),t}})));let r;if(n){r=await(0,o(237118).P)({environment:c,spaceId:S.id})??1}else r=i.filter((e=>{const t=e.getMembershipType();return t&&(0,ou().MN)(t)})).length;const l=i.filter((e=>{const t=e.getMembershipType();return t&&(0,ou().P)(t)})).length;return{numberOfGuests:l,numberOfUsers:r+l,isPublic:t}}),[m,c,S]),{numberOfGuests:f,numberOfUsers:b,isPublic:j}=(0,n.useMemo)((()=>y??{numberOfGuests:void 0,numberOfUsers:void 0,isPublic:void 0}),[y]);(0,n.useEffect)((()=>{j||1!==b||R().os({collectionSettingsStore:e})}),[e,j,b]);const w=(0,n.useCallback)((()=>{m&&(u&&function(e){const{environment:t,store:o}=e,n=t.currentUser.id;if(!n)return;A().createAndCommit({userAction:"CollectionSettingsSyncedContentShare.restrictAccessToSyncedContent",environment:t,canUndo:!0,perform:e=>{nu().wW({environment:t,store:o,shouldInherit:!1,transaction:e,permissionItem:{type:"user_permission",user_id:n,role:"editor"}})}})}({environment:c,store:m}),function(e,t){(0,p().DO_NOT_USE_trackLegacy)(e,"set_database_sync_permissions",t)}(c,{type:u?"restrict":"share"}),R().os({collectionSettingsStore:e}))}),[e,m,c,u]);if(!m)return null;const I=(0,z.jsx)("div",{style:d.promptTitle,children:(0,z.jsx)(v().sA,{id:"CollectionSettingsSyncedContentShare.header",defaultMessage:"Share synced content with"})}),_=(0,z.jsxs)(z.Fragment,{children:[0!==f?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(v().sA,{id:"CollectionSettingsSyncedContentShare.option.share.caption.usersWithGuests",defaultMessage:"{numberOfUsers} people (including you {numberOfGuests, plural, one {and {numberOfGuests} guest} other {and {numberOfGuests} guests}})",values:{numberOfUsers:b,numberOfGuests:f}})," "]}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(v().sA,{id:"CollectionSettingsSyncedContentShare.option.share.caption.usersWithoutGuests",defaultMessage:"{numberOfUsers} people (including you)",values:{numberOfUsers:b}})," "]}),j?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(v().sA,{id:"CollectionSettingsSyncedContentShare.option.share.caption.sharedWithPublic",defaultMessage:"and those with the link"})," "]}):void 0,(0,z.jsx)(v().sA,{id:"CollectionSettingsSyncedContentShare.option.share.caption.accessToIntegration",defaultMessage:"will get access to content synced from {integrationName}",values:{integrationName:i}})]}),T=(0,z.jsx)(Et().Ye,{style:{marginTop:10},children:(0,z.jsx)(M().A,{colorPalette:"blue",style:{flex:"0 0 100%"},size:"lg",onClick:w,children:(0,z.jsx)(v().sA,{id:"CollectionSettingsSyncedContentShare.continueButton",defaultMessage:"Continue"})})}),k=(0,z.jsx)(Et().Ye,{style:{paddingBottom:24},alignItems:"center",justifyContent:"center",children:(0,z.jsx)("img",{style:{width:40},src:r})}),P=(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:void 0,sections:[{key:"grant_permissions",items:[{key:"allow",action:()=>null,render:e=>(0,z.jsx)($().A,{...e,textWrapperStyle:{textAlign:"start"},title:(0,z.jsx)(v().sA,{id:"CollectionSettingsSyncedContentShare.option.share.title",defaultMessage:"Anyone on this page"}),shouldWrapCaption:!0,caption:_,icon:(0,z.jsx)(iu().A,{isSelected:!u}),onClick:()=>{g(!1)}})},{key:"restrict",action:()=>null,render:e=>(0,z.jsx)($().A,{...e,textWrapperStyle:{textAlign:"start"},title:(0,z.jsx)(v().sA,{id:"CollectionSettingsSyncedContentShare.option.restrict.title",defaultMessage:"Only you"}),shouldWrapCaption:!0,caption:(0,z.jsx)(v().sA,{id:"CollectionSettingsSyncedContentShare.option.restrict.caption",defaultMessage:"Youâ€™ll need to share with others using the share menu"}),icon:(0,z.jsx)(iu().A,{isSelected:u}),onClick:()=>{g(!0)}})}],render:e=>(0,z.jsx)(x().A,{...e})}]});return(0,z.jsx)(C().A,{collectionSettingsStore:e,fullHeight:a,children:(0,z.jsxs)(Et().Ye,{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:0,paddingInlineEnd:16,paddingBottom:16,paddingInlineStart:16},flexDirection:"column",children:[k,(0,z.jsxs)("div",{children:[I,P]}),T]})})}const lu=n.memo(ru,Jl().A);var au=()=>o(34026),su=()=>o(790515),cu=()=>o(252107),du=(o(410838),()=>o(944584)),uu=()=>o(661920),pu=()=>o(219348),gu=()=>o(761894),mu=()=>o(277942),Su=()=>o(140992),yu=()=>o(774952),fu=()=>o(324009),hu=()=>o(600434),xu=()=>o(791256),vu=()=>o(166442),bu=()=>o(703748),Cu=()=>o(631611),ju=()=>o(712505);const wu=(0,v().YK)({placeholder:{defaultMessage:"Describe the filter you want to create",id:"database.createFilterAI.placeholder"},thinking:{defaultMessage:"Thinking",id:"database.createFilterAI.thinking"},creatingFilters:{defaultMessage:"Creating filters",id:"database.createFilterAI.creatingFilters"}});function Au({parentStore:e,collectionSettingsStore:t}){const o=(0,l().v3)(),i=(0,v().tz)(),[r,a]=(0,n.useState)(0),[c,d]=(0,n.useState)(!1),[u,p]=(0,n.useState)(void 0),g=(0,hu().K7)("agent_db_filters"),m=(0,s().O$)(ze().AppStoreSidebarSpaceViewStore),S=(0,pu().DV)(m),y=(0,Su().zS)({clientStore:vu().defaultClientAIChatStore,threadStore:u}),f=(0,s().K8)((()=>(0,xu().Ft)({threadStore:u,clientStore:vu().defaultClientAIChatStore})),[u]),x=(0,n.useRef)(u),b=(0,n.useRef)(y),C=(0,n.useRef)(f),j=(0,h().eP)(),w=(0,h().IS)((()=>({container:{width:"100%",padding:"10px 11px",transition:"all 200ms ease"},inputWrapper:{width:"100%",maxWidth:"100%",position:"relative",display:"flex",background:O().Tj.background.primary,border:`1px solid ${O().Tj.border.secondary}`,borderRadius:12,minHeight:40,maxHeight:100,overflowY:"auto",overflowX:"hidden",outline:c?`2px solid ${O().Tj.blue.border.accentPrimary}`:void 0,transition:"outline 0.1s ease-in-out, height 0.2s ease"},assistantFace:{width:20,height:20,borderRadius:"50%",backgroundColor:O().Tj.background.elevated,flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",userSelect:"none",marginTop:10,marginInlineStart:8},inputContent:{flex:1,display:"flex",alignItems:"flex-start",paddingTop:7,paddingInlineEnd:7,paddingBottom:3,paddingInlineStart:7},loading:{width:"100%",height:40,borderRadius:8,background:"dark"===j?O().Tj.gray.background.secondary:O().Tj.background.secondary,animation:"pulse 1.5s ease-in-out infinite"}})),[c,j]),A=(0,s().K8)((()=>(0,Ys().U)(e)),[e]),I=(0,n.useRef)(void 0),_=(0,s().K8)((()=>{if(!A)return JSON.stringify({propertyFilters:[],combinatorFilter:null});const e=A.currentPropertyFiltersStore.state,t=A.currentCombinatorFilterStore.state;return JSON.stringify({propertyFilters:e,combinatorFilter:t})}),[A]),T=(0,n.useCallback)((({newThreadStore:e})=>{if(e&&o){if(p(e),A){const e=A.currentPropertyFiltersStore.state,t=A.currentCombinatorFilterStore.state;I.current=JSON.stringify({propertyFilters:e,combinatorFilter:t})}a((e=>e+1))}}),[o,A]),k=(0,s().K8)((()=>{if(!u)return[];const{steps:e}=(0,xu().A3)({clientStore:vu().defaultClientAIChatStore,threadStore:u});return e}),[u]),M=(0,s().K8)((()=>{if(!f||0===k.length)return"thinking";const e=k.findLast((e=>"agent-inference"===e.type));if(!e)return"thinking";const t=e.value;if(Array.isArray(t)&&t.length>0){const e=t[t.length-1];if(e&&"object"==typeof e&&"type"in e&&("tool_use"===e.type||"registered_tool_use"===e.type))return"creating"}return"thinking"}),[f,k]),P=(0,s().K8)((()=>!(f||!u||void 0===I.current)&&_===I.current),[f,u,_]);(0,n.useEffect)((()=>{if(!A||void 0===I.current)return;if(P)return;_!==I.current&&(A.filtersBarOpenStore.setState(!0),R().os({collectionSettingsStore:t}))}),[_,A,t,P]);const{nextConfig:B,setNextConfig:V}=(0,fu().I)({threadStore:void 0,spaceId:e.pointer.spaceId,defaultConfig:{type:"workflow",model:"anthropic-haiku-4.5",modelFromUser:!0}}),F=(0,n.useCallback)((()=>{du().trackAgentQuickAccessTypingStarted({environment:o,from:"db_filters"})}),[o]),D=(0,n.useCallback)((()=>{d(!0)}),[]),E=(0,n.useCallback)((()=>{d(!1)}),[]),K=(0,n.useCallback)((()=>{R().os({collectionSettingsStore:t})}),[t]),N=(0,n.useCallback)((()=>{if(!u||!o)return;const e=ju().default.state,n=ju().default.isCenterPeekOpen()&&e.open?e.targetStore:ze().default.state.mainEditorCurrentBlockStore;n&&(ju().default.isCenterPeekOpen()&&uu().VN({environment:o,from:"agent_sidebar_open"}),(0,bu().openChatPanel)({environment:o,store:n,source:"new_db_filter_creation",chatPanelState:{isOpen:!0,threadId:u.id}}),R().os({collectionSettingsStore:t}))}),[u,o,t]);return(0,n.useEffect)((()=>{P&&N()}),[P,N]),(0,n.useEffect)((()=>{x.current=u,b.current=y,C.current=f}),[u,y,f]),(0,ns().X)((()=>{C.current&&x.current&&b.current({userAction:"AgentChatTranscript.StopInference.keyboardInterrupt"})})),(0,z.jsx)("div",{style:w.container,children:f?(0,z.jsxs)("div",{style:w.inputWrapper,children:[(0,z.jsx)("div",{style:w.assistantFace,"aria-hidden":"true",children:(0,z.jsx)(gu().x,{accessory:S,variant:"xsmall"})}),(0,z.jsx)("div",{style:w.inputContent,children:(0,z.jsx)(yu().c,{message:"thinking"===M?wu.thinking:wu.creatingFilters})})]}):(0,z.jsxs)("div",{style:w.inputWrapper,onFocus:D,onBlur:E,children:[(0,z.jsx)("div",{style:w.assistantFace,"aria-hidden":"true",children:(0,z.jsx)(gu().x,{accessory:S,variant:"xsmall"})}),(0,z.jsx)("div",{style:w.inputContent,children:(0,z.jsx)(Cu().hP,{surface:Cu().wy.inferenceTranscriptChatView,children:(0,z.jsx)(mu().n_,{renderLoading:e=>e?(0,z.jsx)("div",{style:w.loading}):null,aiChatFeatureController:g,clientStore:vu().defaultClientAIChatStore,onThreadChange:T,onStartTyping:F,onEsc:K,threadStore:void 0,nextConfig:B,setNextConfig:V,placeholder:i.formatMessage(wu.placeholder),invokedFromBlockId:e.id},r)})})]})})}function Iu(e){const t=(0,v().tz)(),{context:o,collectionSettingsStore:i,collectionContextStore:r}=e,a=(0,l().v3)(),{hasAIAccessInWorkspace:c,isAiEnabledInWorkspace:d}=(0,cu().g)(r),u=(0,s().O$)(r.normalizedSchemaStore),p=(0,s().O$)(r.normalizedFormatStore),g=(0,s().O$)(r.canConfigureBlockStore),m=(0,s().K8)((()=>(0,su().S2)(r)),[r]),S=(0,s().K8)((()=>{var e;const t=r.collectionViewStore();return t?(0,su().LQ)({schema:u,filters:Mu(r),getRecordModel:t.getRecordModel,spaceIdCreator:a.idCreator.getSpaceIdCreatorSync((null===(e=t.pointer)||void 0===e?void 0:e.spaceId)??""),collectionSource:t.getCollectionSource()}):[]}),[r,u,a.idCreator]),y=(0,s().K8)((()=>r.contextTypeFromStoreState),[r]),f=(0,s().K8)((()=>{const e=r.collectionViewBlockStore();if(e&&e.isCollectionView())return e}),[r]),h=(0,U().X)("agent_filter_quick_access")&&c&&d&&f?(0,z.jsx)(Au,{parentStore:f,collectionSettingsStore:i}):void 0,b=(0,n.useCallback)((e=>{if(!e)return;const t=au().m({property:e,collectionContextStore:r,environment:a,schema:u});t&&function(e,t,o,n,i){if((0,Sr().X)({environment:i,collectionContextStore:t,action:"create_property_filter"}),o===bo().Bd.FilterBar||o===bo().Bd.TopbarFilterPopup){Tu(t,n);const o=t.getFilterBarItemSettingsStore(e);R().R8({collectionSettingsStore:o,item:{type:"filter"}})}else if(o===bo().Bd.ViewSettings){ku(n);const o=t.getFilterOptionsItemSettingsStore(e);R().R8({collectionSettingsStore:o,item:{type:"filter"}})}}(t,r,o,i,a)}),[r,i,o,a,u]),j=(0,n.useCallback)((()=>{au().x1({collectionContextStore:r,environment:a}),function(e,t,o,n){(0,Sr().X)({environment:n,collectionContextStore:e,action:"create_combinator_filter"}),t===bo().Bd.FilterBar||t===bo().Bd.TopbarFilterPopup?(Tu(e,o),R().R8({collectionSettingsStore:e.filterBarCombinatorFilterSettingsStore,item:{type:"filter"}})):t===bo().Bd.ViewSettings&&(ku(o),R().R8({collectionSettingsStore:e.filterOptionsCombinatorFilterSettingsStore,item:{type:"filter"}}))}(r,o,i,a)}),[r,i,o,a]);return(0,z.jsx)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Add filter",id:"database.viewSettings.createFilterTab.title"}),footer:g&&"collectionSettings"!==y&&(0,z.jsx)(x().A,{topBorder:!0,children:(0,z.jsx)(so().A,{icon:m>0?fn().filterIcon:jl().plusIcon,isGray:!0,title:m>0?(0,z.jsx)(v().sA,{...bs().D.advancedFilterTitle}):(0,z.jsx)(v().sA,{...bs().D.addAdvancedFilterTitle}),right:m>0&&(0,z.jsx)(v().sA,{...bs().D.advancedFilterRulesCount,values:{ruleCount:m}}),onClick:j})}),children:(0,z.jsx)(K().A,{schema:u,format:p,getProperties:()=>S.map((e=>e.property)),onAccept:b,inputPlaceholder:t.formatMessage(bs().D.inputPlaceholder),aiInputSection:h})})}const _u=n.memo(Iu,Jl().A);function Tu(e,t){e.filtersBarOpenStore.setState(!0),R().yl({collectionSettingsStore:t})}function ku(e){R().R8({collectionSettingsStore:e,item:{type:"main"}}),R().a2({collectionSettingsStore:e,item:{type:"filters"}})}function Mu(e){return e.currentPropertyFiltersStore.state}const Pu=(0,v().YK)({inputPlaceholder:{defaultMessage:"Sort byâ€¦",id:"database.viewSettings.createSortTab.inputPlaceholder"}});const Bu=function(e){const{context:t,collectionContextStore:n,collectionSettingsStore:i}=e,r=(0,l().v3)(),a=(0,v().tz)(),c=(0,s().O$)(n.normalizedSchemaStore),d=(0,s().O$)(n.normalizedFormatStore),u=(0,s().K8)((()=>Vu(n)),[n]),p=(0,s().K8)((()=>{var e;return null===(e=n.collectionViewStore())||void 0===e?void 0:e.getCollectionSource()}),[n]);return(0,z.jsx)(C().A,{...e,collectionSettingsStore:i,title:(0,z.jsx)(v().sA,{defaultMessage:"New sort",id:"database.viewSettings.createSortTab.title"}),children:(0,z.jsx)(K().A,{schema:c,format:d,getProperties:()=>Object.entries(c).filter((([e,t])=>!u.find((t=>t.property===e))&&(0,o(835195).oH)(t,p))).map((([e])=>e)),onAccept:e=>function(e,t,o,n,i){var r;if(!e)return;const l=o.collectionViewStore(),a=o.normalizedSchemaStore.state;if(!l||!a)return;const s=null===(r=a[e])||void 0===r?void 0:r.type;(0,Sr().X)({environment:t,collectionContextStore:o,action:"create_sort_accept",original_view_type:l.getType(),property_type:s});const c={property:e,direction:"ascending"},d=[...Vu(o),c];if(au().IU({environment:t,collectionContextStore:o,temporaryState:{...o.temporaryStateStore.state,sorts:{value:d}}}),n===bo().Bd.TopbarSortPopup||n===bo().Bd.FilterBar){o.filtersBarOpenStore.setState(!0),R().yl({collectionSettingsStore:i});const{filterBarSortSettingsStore:e}=o;R().R8({collectionSettingsStore:e,item:{type:"sort"}})}else n===bo().Bd.ViewSettings?(R().R8({collectionSettingsStore:i,item:{type:"main"}}),R().a2({collectionSettingsStore:i,item:{type:"sort"}})):n===bo().Bd.MobileSheet&&R().a2({collectionSettingsStore:i,item:{type:"sort"}})}(e,r,n,t,i),inputPlaceholder:a.formatMessage(Pu.inputPlaceholder)})})};function Vu(e){return e.currentSortsStore.state}var Fu=()=>o(711339),Du=()=>o(390650);const Eu=function(e){const{collectionContextStore:t,context:n,collectionSettingsStore:i}=e,r=(0,l().v3)(),a=(0,s().K8)((()=>t.collectionViewStore()),[t]),c=(0,s().O$)(t.normalizedSchemaStore),d=(0,s().K8)((()=>function(e){return e.currentCombinatorFilterStore.state}(t)),[t]),u=(0,s().K8)((()=>null==a?void 0:a.getType()),[a]);return a&&d&&u?(0,z.jsxs)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Advanced filter",id:"database.viewSettings.filterTab.title"}),unconstrainedWidth:!0,children:[(0,z.jsx)(j().i,{children:(0,z.jsx)(o(184979).tY,{index:0,level:0,combinatorFilter:d,schema:c,onChange:(e,o)=>function(e,t,o,n,i,r){var l,a;const s=null===(l=n.remoteResultStore.state)||void 0===l?void 0:l.sizeHint,c=Fu().default.DO_NOT_USE_markLegacy("collections.update_filter_lag");Fu().default.DO_NOT_USE_measureAfterNextFlushLegacy(c,{environment:o,getData:()=>Du().K6({from:"combinator_filter",collectionContextStore:n,sizeHintAtStart:s})}),au().IU({environment:o,collectionContextStore:n,temporaryState:{...n.temporaryStateStore.state,combinatorFilter:{value:t}}}),0===(null===(a=t.filters)||void 0===a?void 0:a.length)&&r===bo().Bd.MobileSheet&&R().yl({collectionSettingsStore:i});(0,Sr().X)({environment:o,collectionContextStore:n,action:"update_combinator_filter"})}(0,o,r,t,i,n),collectionContextStore:t,collectionViewType:u,collectionViewId:a.id,parentStore:a})}),(0,z.jsx)(x().A,{topBorder:!0,children:(0,z.jsx)(so().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Delete filter",id:"database.viewSettings.filterTab.deleteFilterButton.title"}),isRedOnHover:!0,icon:Q().trashIcon,onClick:()=>function(e,t,o,n){au().IU({environment:e,collectionContextStore:t,temporaryState:{...t.temporaryStateStore.state,combinatorFilter:{value:void 0}}}),o===bo().Bd.FilterBar?R().os({collectionSettingsStore:n}):o===bo().Bd.MobileSheet&&R().yl({collectionSettingsStore:n});(0,Sr().X)({environment:e,collectionContextStore:t,action:"delete_combinator_filter"})}(r,t,n,i)})})]}):null};var Ou=()=>o(148860),Ru=()=>o(789051),Ku=()=>o(392459),Nu=()=>o(427537),zu=()=>o(59400),Lu=()=>o(222334),Uu=()=>o(582684),Wu=()=>o(212727),Hu=()=>o(866913),$u=()=>o(637558),Gu=()=>o(700251),Qu=()=>o(838364);function qu(e){const{collectionSettingsStore:t,collectionContextStore:o,viewType:n}=e,i=(0,s().K8)((()=>{var e;return null===(e=o.collectionViewStore())||void 0===e?void 0:e.getType()}),[o]),r=(0,s().K8)((()=>(0,su().tG)(o)),[o]),l=(0,s().K8)((()=>(0,su().S2)(o)),[o]),a=(0,s().K8)((()=>{switch(n){case"filterAndSort":return(0,Ru().ye)(o)||(0,Ru().gv)(o);case"filter":return(0,Ru().ye)(o);default:(0,b().HB)(n)}}),[o,n]),c=(0,s().K8)((()=>(0,Nu().H)(o)),[o])?(0,z.jsx)(Xu,{collectionSettingsStore:t,collectionContextStore:o,activeFilterCount:l}):null,d=(0,z.jsx)(Ju,{collectionContextStore:o}),u=(0,h().IS)((()=>({menuScroller:{paddingBottom:Qu().H}})),[]);return(0,z.jsx)(C().A,{collectionSettingsStore:t,title:r>0?(0,z.jsx)(v().sA,{...bs().D.numberOfFiltersTitle,values:{numberOfFilters:r}}):(0,z.jsx)(v().sA,{...bs().D.noFiltersTitle}),menuScrollerStyle:u.menuScroller,children:(0,z.jsxs)("div",{children:[a?(0,z.jsx)(zu()._Q,{context:tp(n),collectionContextStore:o}):null,"filterAndSort"===n&&"map"!==i?(0,z.jsx)(Yu,{collectionContextStore:o,collectionSettingsStore:t}):void 0,l>0?(0,z.jsxs)(z.Fragment,{children:[c,d]}):(0,z.jsxs)(z.Fragment,{children:[d,c]})]})})}function Yu({collectionSettingsStore:e,collectionContextStore:t}){const o=(0,l().v3)(),i=(0,s().O$)(t.normalizedSchemaStore),r=(0,s().O$)(t.currentSortsStore),a=r.length>0,c=(0,s().K8)((()=>Boolean((0,Ru().Ml)(t,"normalized").sorts)),[t]),d=ep({isActive:a}),u=(0,n.useCallback)((()=>{(0,Sr().X)({environment:o,collectionContextStore:t,action:"click_sort"}),R().a2({collectionSettingsStore:e,item:{type:a?"sort":"createSort"}})}),[a,t,o,e]);return(0,z.jsx)(x().A,{children:(0,z.jsx)($().A,{title:(0,z.jsx)(v().sA,{...bs().D.sortTitle}),titleStyle:d.title,icon:(0,z.jsxs)("div",{style:d.iconContainer,children:[(0,z.jsx)(H().I,{icon:Uu().arrowUpDownIcon,style:d.icon}),c?(0,z.jsx)("div",{style:d.diffDot}):void 0]}),rightStyle:d.right,right:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{style:d.filterValue,children:(0,z.jsx)($u().v,{currentSorts:r,schema:i})}),(0,z.jsx)(H().I,{icon:Lu().arrowChevronSingleRightIcon,colorVariant:"tertiary",style:d.chevronIcon})]}),onClick:u,focused:!1})})}function Xu({collectionSettingsStore:e,collectionContextStore:t,activeFilterCount:o}){const i=(0,l().v3)(),r=o>0,a=(0,s().K8)((()=>Boolean((0,Ru().Ml)(t,"normalized").combinatorFilter)),[t]),c=ep({isActive:r}),d=(0,n.useCallback)((()=>{(0,Sr().X)({environment:i,collectionContextStore:t,action:"click_combinator_filter"}),au().x1({collectionContextStore:t,environment:i}),R().a2({collectionSettingsStore:e,item:{type:"filter"}})}),[t,i,e]);return(0,z.jsx)(x().A,{children:(0,z.jsx)($().A,{title:(0,z.jsx)(v().sA,{...bs().D.advancedFilterTitle}),titleStyle:c.title,icon:(0,z.jsxs)("div",{style:c.iconContainer,children:[(0,z.jsx)(H().I,{icon:Wu().gearIcon,style:c.icon}),a?(0,z.jsx)("div",{style:c.diffDot}):null]}),rightStyle:c.right,right:(0,z.jsxs)(z.Fragment,{children:[r?(0,z.jsx)("div",{style:c.filterValue,children:(0,z.jsx)(v().sA,{...bs().D.advancedFilterRulesCount,values:{ruleCount:o}})}):void 0,(0,z.jsx)(H().I,{icon:Lu().arrowChevronSingleRightIcon,colorVariant:"tertiary",style:c.chevronIcon})]}),onClick:d,focused:!1})})}function Ju({collectionContextStore:e}){const t=(0,l().v3)(),o=(0,v().tz)(),i=(0,s().O$)(e.normalizedSchemaStore),r=(0,s().O$)(e.normalizedFormatStore),a=(0,s().K8)((()=>e.collectionViewStore()),[e]),c=(0,s().K8)((()=>{var o;if(!a)return[];const n=e.currentPropertyFiltersStore.state;return[...new Set([...n.map((e=>e.filter)),...(0,su().LQ)({schema:i,filters:n,getRecordModel:a.getRecordModel,spaceIdCreator:t.idCreator.getSpaceIdCreatorSync((null===(o=a.pointer)||void 0===o?void 0:o.spaceId)??""),collectionSource:a.getCollectionSource()})])].map((e=>e.property))}),[a,e,i,t.idCreator]),d=(0,n.useCallback)((o=>{var n;if(!o)return;const r=au().m({property:o,collectionContextStore:e,environment:t,schema:i});if(!r)return;(0,Sr().X)({environment:t,collectionContextStore:e,action:"click_property_filter",original_view_type:void 0,property_type:null===(n=i[o])||void 0===n?void 0:n.type});const l=e.getFilterOptionsItemSettingsStore(r);R().R8({collectionSettingsStore:l,item:{type:"filter"}})}),[e,t,i]),u=(0,Gu().y$)(),p=(0,h().IS)((()=>({leftIcon:{marginInlineStart:6,marginInlineEnd:6,width:u,height:u}})),[u]);return(0,z.jsx)(K().A,{schema:i,format:r,getProperties:()=>c,onAccept:d,disableSortByPageFormat:!0,inputPlaceholder:o.formatMessage(bs().D.propertyInputPlaceholder),inputLeft:(0,z.jsx)(H().I,{icon:fn().filterIcon,style:p.leftIcon,colorVariant:"secondary"}),renderProperty:(t,o,n,r)=>a?(0,z.jsx)(Zu,{schema:i,collectionViewStore:a,collectionContextStore:e,property:o,propertySchema:r,onClick:t.onClick,focused:!1}):null})}function Zu(e){const{propertySchema:t,schema:o,collectionViewStore:i,collectionContextStore:r,property:a}=e,c=(0,l().v3)(),{name:d,type:u,icon:p}=t,[g,m,S]=(0,s().K8)((()=>{const e=r.currentPropertyFiltersStore.state.find((e=>e.filter.property===a));return[e,null==e?void 0:e.filter,null==e?void 0:e.id]}),[r,a]),y=Boolean(S&&(0,su().vu)(S)),f=m&&!(0,Ce().t_)(m),x=(0,s().K8)((()=>{if(!S)return!1;const e=(0,Ru().Ml)(r,"normalized");return e.filters.updated.includes(S)||e.filters.added.includes(S)&&f}),[r,S,f]),v=Boolean((null==t?void 0:t.icon)&&(0,Vo().T8)(t.icon)),b=ep({isActive:Boolean(f),isCustomIcon:v}),C=(0,h().DP)(),j=(0,s().K8)((()=>g?r.getFilterOptionsItemSettingsStore(g):null),[r,g]),w=(0,n.useCallback)((()=>{j&&(au().H2({environment:c,collectionContextStore:r}),R().os({collectionSettingsStore:j}))}),[j,c,r]),A=(0,s().K8)((()=>!!j&&j.state.open),[j]),I=(0,n.useCallback)((()=>j&&g?(0,z.jsx)(Hu().q,{collectionContextStore:r,collectionSettingsStore:j,collectionViewStore:i,context:Ku().aV.SettingsFilters,filter:g,schema:o}):null),[r,j,g,i,o]),_=(0,n.useCallback)((()=>(0,z.jsx)($().A,{title:d,titleStyle:b.title,icon:(0,z.jsxs)("div",{style:b.iconContainer,children:[(0,z.jsx)(Je().zB,{icon:p,type:u,size:D().lD.sm,theme:C,style:b.icon}),x?(0,z.jsx)("div",{style:b.diffDot}):void 0]}),disabled:y,rightStyle:b.right,right:(0,z.jsxs)(z.Fragment,{children:[f?(0,z.jsx)(_e().Ay,{propertyFilter:m,schema:o,valueOnly:!0,parentStore:i,style:b.filterValue}):void 0,y?void 0:(0,z.jsx)(H().I,{icon:Lu().arrowChevronSingleRightIcon,colorVariant:"tertiary",style:b.chevronIcon})]}),...e})),[i,x,p,f,y,d,m,e,o,b,C,u]);return(0,z.jsx)(Yn().zD,{popupType:fo().n.BottomSheet,open:A,trapFocus:!0,onDismiss:w,render:I,origin:_()})}function ep({isActive:e,isCustomIcon:t}){const o=(0,Gu().y$)({type:t?"custom":"system"});return(0,h().IS)((()=>({icon:{fill:e?O().Tj.blue.icon.accentPrimary:void 0,marginInlineStart:2,marginInlineEnd:2,width:o},iconContainer:{position:"relative"},title:{color:e?O().Tj.blue.text.accentPrimary:O().Tj.text.primary,marginInlineEnd:4,...We().RC},right:{display:"flex",alignItems:"center",justifyContent:"end",color:O().Tj.text.tertiary,fill:O().Tj.icon.tertiary,maxWidth:"50%"},filterValue:{...We().RC},chevronIcon:{marginInlineStart:4},diffDot:{position:"absolute",top:-1,insetInlineEnd:-1,background:O().Tj.orange.icon.accentPrimary,border:`1px solid ${O().Tj.background.primary}`,width:8,height:8,borderRadius:8}})),[e,o])}function tp(e){switch(e){case"filterAndSort":return"SettingsFiltersAndSort";case"filter":return"SettingsFilters";default:(0,b().HB)(e)}}function op(e){return f().A.isMobile?(0,z.jsx)(qu,{collectionContextStore:e.collectionContextStore,collectionSettingsStore:e.collectionSettingsStore,viewType:"filter"}):(0,z.jsx)(np,{...e})}const np=n.memo((function(e){const{collectionSettingsStore:t,collectionContextStore:i}=e,a=(0,l().v3)(),[c,d,u,p]=(0,s().K8)((()=>[i.currentPropertyFiltersStore.state,i.currentPropertyFiltersStore.state.map((e=>e.id)),i.permissionScopesStore.state,(0,Ru().I6)(i)]),[i]),g=(0,o(396182).I)(),m=(0,s().K8)((()=>(0,Nu().H)(i)?i.currentCombinatorFilterStore.state:void 0),[i]),S=(0,n.useCallback)((e=>{R().os({collectionSettingsStore:i.filterOptionsCombinatorFilterSettingsStore}),c.filter((t=>!e||t.id!==e)).forEach((e=>{const t=i.getFilterOptionsItemSettingsStore(e);R().os({collectionSettingsStore:t})}))}),[i,c]);(0,n.useEffect)((()=>{f().A.isMobile||S()}),[]);const y=(0,h().IS)((()=>({menuItem:{color:O().Tj.text.secondary},mobile:{paddingTop:8,background:O().Tj.background.primary}})),[]);return(0,z.jsx)("div",{onClick:e=>{(0,r().SQ)(e,r().y$.Click,S)},children:(0,z.jsx)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Filters",id:"database.viewSettings.filtersTab.title"}),footer:p&&(0,z.jsx)(x().A,{topBorder:!0,children:(0,z.jsx)(ip,{collectionContextStore:i})}),unconstrainedWidth:!0,children:(0,z.jsxs)(x().A,{children:[d.length>0||m?(0,z.jsxs)("div",{style:f().A.isMobile?y.mobile:void 0,children:[m?(0,z.jsx)(lp,{collectionContextStore:i}):void 0,rp()?(0,z.jsx)(w().Ay,{direction:"vertical",keys:d,renderKey:e=>{const t=d.indexOf(e);return(0,z.jsx)(ap,{collectionContextStore:i,filter:c[t],onClick:S})},onDrop:e=>function(e,t,o){const n=o.collectionViewBlockStore();if(!n)return;const i=o.currentPropertyFiltersStore.state,r=Ro().oE(e.map((e=>i.find((t=>t.id===e)))));au().IU({environment:t,collectionContextStore:o,temporaryState:{...o.temporaryStateStore.state,propertyFilters:{value:r}}}),(0,Sr().X)({environment:t,collectionContextStore:o,action:"reorder_filters"})}(e,a,i),onDragEnd:()=>g("CollectionSettingsViewDesktopFilters","CollectionSettingsViewDesktopFilters/onDragEnd"),disabled:!u.canConfigureBlock}):d.map((e=>{const t=d.indexOf(e);return(0,z.jsx)(ap,{collectionContextStore:i,filter:c[t],onClick:S},e)}))]}):void 0,(0,z.jsx)($().A,{focused:!1,icon:(0,z.jsx)(H().I,{icon:jl().plusIcon}),style:y.menuItem,title:(0,z.jsx)(v().sA,{defaultMessage:"Add filter",id:"database.viewSettings.filtersTab.newFilter.title"}),onClick:()=>{S(),function(e,t,o){(0,Sr().X)({environment:e,collectionContextStore:o,action:"click_new_filter"}),R().a2({collectionSettingsStore:t,item:{type:"createFilter"}}),o.filtersBarOpenStore.setState(!0)}(a,t,i)}})]})})})}));function ip({collectionContextStore:e}){return(0,z.jsx)(zu()._Q,{context:"SettingsFilters",collectionContextStore:e})}function rp(){return!f().A.isMobile}function lp({collectionContextStore:e}){return(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"4px 10px"},children:[rp()?(0,z.jsx)(Ou().t,{wrapperStyle:{marginInlineStart:6,marginInlineEnd:6,opacity:.4,cursor:void 0}}):void 0,(0,z.jsx)(o(958832).l,{context:Ku().aV.SettingsFilters,collectionContextStore:e,collectionSettingsStore:e.filterOptionsCombinatorFilterSettingsStore})]})}function ap({filter:e,collectionContextStore:t,onClick:n}){const i=(0,s().K8)((()=>t.getFilterOptionsItemSettingsStore(e)),[t,e]);return(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"4px 10px"},children:[rp()?(0,z.jsx)(Ou().t,{wrapperStyle:{marginInlineStart:6,marginInlineEnd:6}}):void 0,(0,z.jsx)(o(602141).A,{id:e.id,context:Ku().aV.SettingsFilters,collectionContextStore:t,collectionSettingsStore:i,onClick:n},e.id)]})}var sp=()=>o(106702),cp=()=>o(728567),dp=()=>o(152077),up=()=>o(457190),pp=()=>o(518773);var gp=()=>o(131849);function mp(e){const{collectionSettingsStore:t,collectionContextStore:o,fullHeight:n}=e,i=(0,l().v3)(),r=(0,s().K8)((()=>o.collectionViewBlockStore()),[o]),a=(0,s().O$)(ze().AppStoreSidebarSpaceStore),c=function({teamStore:e,collectionViewBlockStore:t}){const o=(0,s().K8)((()=>null==e?void 0:e.isDefined()),[e]),{isExplicitlySubscribedToFeed:n,isExplicitlyUnsubscribedToFeed:i,followDataIsLoaded:r}=(0,s().K8)((()=>{const e=null==t?void 0:t.getFollowStore();return{followDataIsLoaded:null==e?void 0:e.isReady(),isExplicitlySubscribedToFeed:null==e?void 0:e.isExplicitlySubscribedToFeed(),isExplicitlyUnsubscribedToFeed:null==e?void 0:e.isExplicitlyUnsubscribedToFeed()}}),[t]),l=(0,gp().a)(e);if(!r||!o)return;return n||l&&!i}({teamStore:(0,s().K8)((()=>{var e;const t=null===(e=o.collectionStore())||void 0===e?void 0:e.id;if(t&&a)return dc().h.createChildStore(a,{table:"team",id:t,spaceId:a.id})}),[o,a]),collectionViewBlockStore:r}),d=function({collectionViewBlockStore:e}){const{isExplicitlySubscribedToFeed:t,followDataIsLoaded:o}=(0,s().K8)((()=>{const t=null==e?void 0:e.getFollowStore();return{followDataIsLoaded:null==t?void 0:t.isReady(),isExplicitlySubscribedToFeed:null==t?void 0:t.isExplicitlySubscribedToFeed()}}),[e]);if(o)return t}({collectionViewBlockStore:r}),u=(0,dp().Vs)(),p=u?d:c,g=!u&&void 0===p,m=(0,s().K8)((()=>null==r?void 0:r.getModel()),[r]),S=(0,sp().$)();return(0,z.jsx)(C().A,{collectionSettingsStore:t,fullHeight:n,title:(0,z.jsx)(v().sA,{defaultMessage:"Your Feed settings",id:"database.viewSettings.followTab.title"}),desktopTitleType:"sectionHeader",children:(0,z.jsx)(x().A,{children:(0,z.jsx)(An().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Follow",id:"database.viewSettings.followMenuItem.title"}),icon:(0,z.jsx)(H().I,{icon:cp().squareOnSquarePlusSmallIcon,size:"sm"}),on:Boolean(p),focused:!1,disabled:g,onClick:()=>{!function(e,t,o,n,i){if(!t||!o||!n)return;const r=i?"unsubscribed":"subscribed",l=t.getFollowSettingsKey(),{following:a,followSettings:s}=(0,pp().A)(l,r);up().v({environment:e,followSettings:s,following:a,navigableBlockId:t.id,userId:o.id,spaceId:t.getSpaceId(),key:l,selectedKey:l,from:"more_menu"})}(i,r,S,m,Boolean(p))}})})})}var Sp=()=>o(812480),yp=()=>o(62371),fp=()=>o(330918),hp=()=>o(673900);const xp=function({numberGroupBy:e,collectionContextStore:t,schema:o,onChange:n}){const i=o[e.property];return(0,s().K8)((()=>t.collectionStore()),[t])&&i?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(x().A,{topBorder:!1,disableMobileBorders:!0,title:(0,z.jsx)(v().sA,{id:"database.groupMenu.numberGroupRange",defaultMessage:"Group range"}),children:(0,z.jsxs)("div",{style:{display:"flex",paddingInlineStart:14,paddingInlineEnd:14},children:[(0,z.jsx)(vp,{onChange:n,numberGroupBy:e,inputKey:"start"}),(0,z.jsx)("span",{style:{color:O().Tj.text.secondary,margin:"0 8px"},children:"â€“"}),(0,z.jsx)(vp,{onChange:n,numberGroupBy:e,inputKey:"end"})]})}),(0,z.jsx)(x().A,{topBorder:!1,disableMobileBorders:!0,title:(0,z.jsx)(v().sA,{id:"database.groupMenu.numberGroupSize",defaultMessage:"Group every"}),children:(0,z.jsxs)("div",{style:{paddingInlineStart:14,paddingInlineEnd:14},children:[(0,z.jsx)(vp,{onChange:n,numberGroupBy:e,inputKey:"size"}),(0,z.jsxs)("span",{style:{color:O().Tj.text.secondary,fontSize:12},children:[(0,z.jsx)(fp().d,{disabled:!0,groupBy:e,groupFormat:{property:e.property,value:{type:"number",value:{type:"range",start:e.start,end:e.start+e.size}}},schema:o,currentGroups:[],isHiddenGroup:!1,style:{display:"inline",paddingInlineEnd:0,paddingInlineStart:0},collectionContextStore:t,source:"collection_settings"}),", ",(0,z.jsx)(fp().d,{disabled:!0,groupBy:e,groupFormat:{property:e.property,value:{type:"number",value:{type:"range",start:e.start+e.size,end:e.start+2*e.size}}},schema:o,currentGroups:[],isHiddenGroup:!1,style:{display:"inline",paddingInlineEnd:0,paddingInlineStart:0},collectionContextStore:t,source:"collection_settings"}),", ..."]})]})})]}):null};function vp({numberGroupBy:e,inputKey:t,onChange:o}){return(0,z.jsx)(hp().v,{value:e[t],onChange:n=>{void 0!==n&&("size"===t&&n<=0&&(n=1),"start"===t&&n>e.end&&(n=e.end),"end"===t&&n<e.start&&(n=e.start),o({newNumberGroupBy:{...e,[t]:n}}))}})}const bp=function(e){return(0,z.jsx)(C().A,{...e,title:(0,z.jsx)(Cp,{collectionSettingsStore:e.collectionSettingsStore,collectionContextStore:e.collectionContextStore}),children:(0,z.jsx)(jp,{groupByKey:e.groupByKey,groupsFormatKey:e.groupsFormatKey,collectionContextStore:e.collectionContextStore})})};function Cp({collectionSettingsStore:e,collectionContextStore:t}){const o=(0,s().K8)((()=>(0,Cl().S)(e)),[e]),n=(0,s().O$)(t.normalizedSchemaStore),i=(0,s().O$)(t.normalizedFormatStore);if(!o||"groupByNumber"!==o.type||"chart_config"===o.groupByKey)return null;const r=i[o.groupByKey];return r?(0,Sp().hC)({groupBy:r,schema:n})??null:null}function jp({groupByKey:e,groupsFormatKey:t,collectionContextStore:o}){const n=(0,l().v3)(),i=(0,s().K8)((()=>o.collectionViewStore()),[o]),r=(0,s().O$)(o.normalizedSchemaStore),a=(0,s().O$)(o.normalizedFormatStore),c=(0,s().K8)((()=>(0,yp().H2)(a,e,t)),[a,e,t]);if(!c||!i)return null;const d=(0,Sp().bO)(c);return d?(0,z.jsx)(xp,{numberGroupBy:d,schema:r,onChange:r=>{if("number"===c.type)A().createAndCommit({userAction:"CollectionSettingsViewGroupByNumber.renderContent",environment:n,canUndo:!0,perform:o=>{m().zA({stores:[i],update:{[e]:r.newNumberGroupBy,[t]:void 0},transaction:o})}});else if("formula"===c.type){const o=Ro().cJ(r.newNumberGroupBy,"property"),l={...c,groupBy:o};A().createAndCommit({userAction:"CollectionSettingsViewGroupByNumber.renderContent",environment:n,canUndo:!0,perform:o=>{m().zA({stores:[i],update:{[e]:l,[t]:void 0},transaction:o})}})}(0,Sr().X)({environment:n,collectionContextStore:o,action:"group_by_number_update",original_view_type:void 0,property_type:c.type})},collectionContextStore:o}):null}const wp=n.memo((function(e){const{collectionContextStore:t,collectionSettingsStore:i,groupByKey:r,groupsFormatKey:a}=e,c=(0,l().v3)(),d=(0,s().K8)((()=>(0,Cl().S)(i)),[i]),u=(0,s().K8)((()=>t.collectionViewBlockStore()),[t]),p=(0,s().K8)((()=>t.collectionViewStore()),[t]),g=(0,s().K8)((()=>null==p?void 0:p.getType()),[p]),S=(0,s().K8)((()=>null==p?void 0:p.getCollectionSource()),[p]),y=(0,s().K8)((()=>{var e;return null===(e=(0,yp().H2)(t.normalizedFormatStore.state,r,a))||void 0===e?void 0:e.property}),[t,r,a]),f=(0,s().O$)(t.normalizedSchemaStore),h=(0,s().O$)(t.normalizedFormatStore),x=(0,s().K8)((()=>void 0!==g&&(0,o(934201).Qt)({viewType:g,groupByKey:r})),[r,g]),v=(0,n.useCallback)((()=>Object.entries(f).sort(Ap).map((e=>e[0])).filter((e=>{const t=f[e];return t&&(0,yp().Eg)(t,S)}))),[f,S]),b=(0,n.useCallback)((e=>{const o=t.collectionViewStore();if(o){if(e){const n=f[e];if(!n||!(0,yp().Eg)(n,S))return;const i=(0,yp().V0)({property:e,propertySchema:n,isCollectionTypedView:"collectionTypedView"===t.contextTypeFromStoreState});A().createAndCommit({userAction:"CollectionSettingsViewGroupByProperty.handlePropertyAccept",environment:c,canUndo:!0,perform:e=>{m().zA({stores:[o],update:{[r]:i,[a]:void 0},transaction:e})}}),(0,Sr().X)({environment:c,collectionContextStore:t,action:"group_by_property_accept",original_view_type:void 0,property_type:n.type})}else A().createAndCommit({userAction:"CollectionSettingsViewGroupByProperty.handlePropertyAccept",environment:c,canUndo:!0,perform:e=>{m().zA({stores:[o],update:{[r]:void 0,[a]:void 0},transaction:e})}}),(0,Sr().X)({environment:c,collectionContextStore:t,action:"group_by_property_accept"});R().R8({collectionSettingsStore:i,item:{type:"main"}}),R().a2({collectionSettingsStore:i,item:{type:"group",groupByKey:r,groupsFormatKey:a}})}}),[t,i,r,a,f,S,c]),j=(0,n.useMemo)((()=>d&&"groupByProperty"===d.type&&g?(0,Sp().rq)(d.groupByKey,g):null),[d,g]);return u&&p&&d&&g&&"groupByProperty"===d.type?(0,z.jsx)(C().A,{...e,collectionSettingsStore:i,title:j,children:(0,z.jsx)(K().A,{schema:f,format:h,currentProperty:y,showNoneOption:x,getProperties:v,onAccept:b})}):null}));function Ap(e,t){var o,n;const i=null==e||null===(o=e[1])||void 0===o?void 0:o.name,r=null==t||null===(n=t[1])||void 0===n?void 0:n.name;return void 0!==i&&void 0!==r?i.localeCompare(r,void 0,{sensitivity:"base"}):void 0!==i?1:void 0!==r?-1:0}var Ip=()=>o(718338);function _p(e){const t=(0,s().K8)((()=>{const t=e.collectionContextStore.collectionViewStore();return"chart"===(null==t?void 0:t.getType())}),[e.collectionContextStore]),o=(0,sd().a)();return(0,z.jsx)(C().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Layout",id:"database.viewSettings.layoutTab.title"}),desktopWidth:o?280:290,children:(0,z.jsx)(Ip().A,{...e,showDoneButton:t,menuType:"editViewLayout",analytics:void 0})})}var Tp=()=>o(203941);function kp(e){return(0,z.jsx)(qu,{...e,viewType:"filterAndSort"})}var Mp=()=>o(174638),Pp=()=>o(955363),Bp=()=>o(378518),Vp=()=>o(323550);const Fp=110,Dp=210,Ep=223,Op=25,Rp=87;function Kp(e){const{propertyName:t}=e,o=(0,h().IS)((()=>({dependenciesPreviewOutsideBorder:{margin:"0px 12px",border:`1px solid ${O().Tj.border.secondaryTranslucent}`,borderRadius:6,alignItems:"center",position:"relative",height:112,paddingInlineStart:19},svgContainer:{position:"absolute",width:"100%",height:"100%"},svgArrowTheme:{stroke:O().Tj.collectionValidDependencyArrow,strokeWidth:Bp().cC},dependencyPropertyNamePreview:{fontSize:12,position:"absolute",background:O().Tj.background.elevated,top:48,insetInlineStart:96},timelineItemPreview:{padding:4,margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center",borderRadius:5,background:O().Tj.background.secondaryTranslucent,boxShadow:O().Tj.buttonBoxShadow,width:100,justifyContent:"center"}})),[]);return(0,z.jsx)(x().A,{children:(0,z.jsxs)("div",{style:o.dependenciesPreviewOutsideBorder,children:[(0,z.jsxs)("svg",{style:o.svgContainer,children:[(0,z.jsx)(Vp().A,{startPoint:{x:Fp,y:Op},endPoint:{x:Fp,y:Rp},style:o.svgArrowTheme,showArrowHead:!0}),(0,z.jsx)(Vp().A,{startPoint:{x:Dp,y:Rp},endPoint:{x:Ep,y:Rp},style:o.svgArrowTheme,showArrowHead:!1}),(0,z.jsx)("circle",{cx:Ep,cy:Rp,r:Bp().w7,style:o.svgArrowTheme,fill:O().Tj.white})]}),(0,z.jsx)("div",{style:o.dependencyPropertyNamePreview,children:t}),(0,z.jsx)("div",{style:{...o.timelineItemPreview,marginTop:10,marginInlineStart:10},children:(0,z.jsx)("span",{children:"ðŸŒ±"})}),(0,z.jsx)("div",{style:{...o.timelineItemPreview,marginTop:34,marginInlineStart:111},children:(0,z.jsx)("span",{children:"ðŸŒ³"})})]})})}const Np=(0,v().YK)({subitemInputPlaceholder:{defaultMessage:"Sub-tasksâ€¦",id:"database.viewSettings.relationsPropertyTab.subitemInputPlaceholder"},timelineArrowsByInputPlaceholder:{defaultMessage:"Dependenciesâ€¦",id:"database.viewSettings.relationsPropertyTab.timelineArrowsByInputPlaceholder"}});const zp=function(e,t){const{collectionContextStore:i,collectionSettingsStore:r,formatSetting:a}=e,c=(0,l().Y0)(),d=(0,v().tz)(),u=(0,l().v3)(),p="collection_page_properties",[g]=(0,n.useState)("no_limit"),S="subitem"===a,y="timeline_arrows_by"===a,f=(0,s().K8)((()=>i.databaseTypeFromStoreState),[i]),b=(0,s().O$)(i.normalizedSchemaStore),j=(0,s().K8)((()=>i.collectionStore()),[i]),w=(0,s().K8)((()=>(null==j?void 0:j.getFormat())??{}),[j]),I=(0,s().K8)((()=>i.collectionViewStore()),[i]),k=(0,s().K8)((()=>{var e;return(null==I||null===(e=I.getFormat())||void 0===e?void 0:e.subitem_display_mode)??"show"}),[I]),M=(0,s().K8)((()=>{var e;return S?null===(e=i.currentSubitemFormatStoreForCollectionStore.state)||void 0===e?void 0:e.property:y?i.currentArrowsByFormatStore.state:void 0}),[i,S,y]),P=(0,s().K8)((()=>{var e,t;return S?null===(e=i.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.subitem_property:y?null===(t=i.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.collection_default_arrows_by:void 0}),[i,S,y]),V=(0,s().O$)(i.permissionScopesStore),F=(0,s().K8)((()=>fr().uu(i,b).length),[i,b]),D=(0,s().O$)(i.normalizedSchemaStore),E=(0,s().K8)((()=>{var e;const t=i.currentSubitemFormatStoreForCollectionStore.state,o=i.currentArrowsByFormatStore.state;let n;return S?n=t?b[t.property]:void 0:y&&(n=o?b[o]:void 0),null===(e=n)||void 0===e?void 0:e.name}),[i,b,S,y]),N=(0,s().K8)((()=>{const e=i.collectionStore();return null!=e&&e.isDefined()?fr().$H(d,{targetCollectionStore:e,isSelfRelation:!0,sourceSchema:D,createUnique:!0,from:a}):d.formatMessage({id:"database.viewSettings.relationsPropertyTab.initialPropertyName.placeholder",defaultMessage:"Related to target"})}),[i,D,d,a]),[L,U]=(0,n.useState)(E||N),W=(0,s().K8)((()=>{const e=i.currentSubitemFormatStoreForCollectionStore.state,t=i.currentArrowsByFormatStore.state;let o;if(S?o=e?b[e.property]:void 0:y&&(o=t?b[t]:void 0),o&&"relation"===o.type){var n;const e=o.property;return e?null===(n=b[e])||void 0===n?void 0:n.name:void 0}}),[i,b,S,y]),$=(0,s().K8)((()=>{const e=i.collectionStore();return null!=e&&e.isDefined()?fr().zF(d,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:a}):d.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[i,d,a]),G=(0,s().K8)((()=>"title"===i.normalizedFormatStore.state.table_subitem_toggle_column),[i]),[q,Y]=(0,n.useState)({hasInverseRelation:!0,inverseName:W,autoRelate:{enabled:!1}}),[J,Z]=(0,n.useState)(0===F),ee=(0,s().uB)(void 0,X().A),te=(0,s().O$)(ee).open,oe=(0,n.useCallback)((()=>fr().uu(i,b)),[i,b]),ne=(0,n.useCallback)((e=>{if(e){const t=b[e];if(t&&"relation"===t.type){const e=t.property;if(e){const t=b[e];if(t&&q){const e=t.name;Y({hasInverseRelation:null==q?void 0:q.hasInverseRelation,inverseName:e,autoRelate:null==q?void 0:q.autoRelate})}}U(t.name)}}}),[b,q,U]),ie=(0,n.useCallback)((e=>{const{collectionViewStore:t,newProperty:o,transaction:n}=e;S?(0,Ro().b0)(t.getFormat().table_subitem_toggle_column)&&m().zA({stores:[t],update:{table_subitem_toggle_column:"title"},transaction:n}):y&&zd().Tq({collectionViewStore:t,newProperty:o,transaction:n})}),[S,y]),re=(0,n.useCallback)((e=>{const{relationPropertyId:t,transaction:o}=e;S&&cr().zt({environment:u,collectionContextStore:i,relationPropertyId:t,transaction:o}),y&&zd().L_({collectionContextStore:i,relationPropertyId:t,transaction:o})}),[S,y,u,i]),le=(0,n.useCallback)((e=>{const t=i.collectionViewStore();t&&(A().createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handleDefaultPropertySelect",environment:u,canUndo:!0,perform:o=>{ie({collectionViewStore:t,newProperty:e,transaction:o}),re({relationPropertyId:e,transaction:o})}}),ne(e),Z(!1),R().os({collectionSettingsStore:r}),(0,Sr().X)({action:S?"update_default_subitem":"update_default_timeline_arrows_by",original_view_type:void 0,property_type:e?"relation":void 0,environment:u,collectionContextStore:i}))}),[i,u,Z,ne,r,S,ie,re]),ae=(0,n.useCallback)((e=>{const t=i.collectionViewStore();t&&(A().createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handlePropertySelect",environment:u,canUndo:!0,perform:o=>{ie({collectionViewStore:t,newProperty:e,transaction:o})}}),ne(e),Z(!1),R().os({collectionSettingsStore:r}),(0,Sr().X)({action:S?"update_subitem":"update_timeline_arrows_by",original_view_type:void 0,property_type:e?"relation":void 0,environment:u,collectionContextStore:i}))}),[i,u,ne,r,S,ie]),se=(0,n.useCallback)((()=>{nr().default.afterNextFlush((()=>{Z(!0),Y({hasInverseRelation:!0,inverseName:$,autoRelate:{enabled:!1}}),U(N)}))}),[$,N]),ce=(0,n.useCallback)((()=>{if(!q)return;const{hasInverseRelation:e,inverseName:t,autoRelate:o}=q,n=i.collectionStore(),l=n,s=i.collectionViewStore();if(!n||!l)return;const{performResult:c}=A().createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:u,canUndo:!0,perform:r=>{const c=(0,Nd().createProperty)({environment:u,collectionStore:n,collectionViewArgs:s&&p?{collectionViewStore:s,format:s.getFormat(),formatKey:p}:void 0,propertyType:"relation",transaction:r});return Wd().cT({environment:u,collectionContextStore:i,collectionStore:n,property:c,propertyName:L,targetCollectionStore:l,hasInverseRelation:e,inverseName:t,autoRelate:o,propertyLimit:g,intl:d,transaction:r,from:a}),s&&(ie({collectionViewStore:s,newProperty:c,transaction:r}),re({relationPropertyId:c,transaction:r})),c}});R().yl({collectionSettingsStore:r}),R().a2({collectionSettingsStore:r,item:{type:"main"}}),(0,Kd().Z)({environment:u,collectionContextStore:i,from:a,property_type:"relation",property_id:c})}),[i,u,r,p,d,g,L,q,a,ie,re]),de=(0,n.useCallback)((()=>{const e=i.collectionViewStore();e&&(gl().jP({environment:u,collectionViewStore:e,currentValue:i.normalizedFormatStore.state.table_subitem_toggle_column}),(0,Sr().X)({environment:u,collectionContextStore:i,action:"toggle_table_subitem_toggle_on_title"}))}),[i,u]),ue=!V.canConfigureBlock,pe=(0,h().IS)((()=>({emptyStateText:{color:O().Tj.text.secondary,fontSize:14,margin:"0px 12px"},useExistingTitle:{fontSize:12,color:O().Tj.text.secondary,marginInlineStart:12,marginTop:12},existingRelationButton:{marginTop:6,marginInlineEnd:12,marginBottom:6,marginInlineStart:12,width:"auto"}})),[]);if(!j)return null;const ge=S&&V.canConfigureBlock&&E,me=V.canConfigureCollection,Se=(e,t,n,r)=>(0,z.jsx)(o(148079).A,{version:"v1",menuProps:e,property:t,defaultProperty:P,isChecked:n,propertySchema:r,collectionContextStore:i,handleDefaultPropertySelect:le,handlePropertySelect:ae});return(0,z.jsxs)(C().A,{...e,title:(0,z.jsx)(v().sA,{...(0,sr().mv)({feature:a,databaseType:f})}),footer:(0,z.jsxs)(x().A,{topBorder:F>0&&!J,children:[ge&&!J?(0,z.jsx)(ml().d,{showImage:!ue,caption:d.formatMessage(sr().Ic.toggleNestingOnTitleMenuItemTooltip),tooltipImage:Zt().A.images.tooltips.collectionSettings.subitemsToggleOnTitlePng,tooltipImageScale:.3,render:e=>(0,z.jsx)(id().A,{...e,icon:()=>(0,z.jsx)(H().I,{icon:pl().U,size:"sm",style:{marginInlineStart:4,marginInlineEnd:2}}),title:(0,z.jsx)(v().sA,{defaultMessage:"Show nesting toggle on title",id:"database.viewSettings.layoutTab.tableSubitemToggleOnTitle"}),switcherProps:{disallowTabbing:!0,on:G},disabled:ue,onClick:de,isGray:!0})}):void 0,me&&F>0&&!J?(0,z.jsx)(so().A,{icon:jl().plusIcon,title:(0,z.jsx)(v().sA,{id:"database.viewSettings.subitemTab.newRelation",defaultMessage:"Create new relation"}),isGray:!0,onClick:se}):void 0,J?void 0:(0,z.jsx)(z.Fragment,{children:V.canConfigureBlock&&!V.canConfigureCollection?(0,z.jsx)(so().A,{title:(0,z.jsx)(v().sA,{id:"database.viewSettings.relationsPropertyTab.removeSubitemRelation.removeSubitemButton.title",defaultMessage:"Turn off for this view"}),isRedOnHover:!0,onClick:()=>ae(void 0)}):V.canConfigureBlock&&(0,z.jsx)(_().A,{popupType:c.isPhone?Yn().nl.SlideUp:Yn().nl.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",originGap:0,renderOrigin:e=>(0,z.jsx)(z.Fragment,{children:V.canConfigureBlock&&M?(0,z.jsx)(so().A,{isGray:!0,icon:Q().trashIcon,title:(0,z.jsx)(v().sA,{...(0,sr().Pf)({feature:a,databaseType:f})}),isRedOnHover:!0,...e}):void 0}),render:e=>{let t;return t=c.isPhone?{menuType:T().gu.ActionSheet}:{menuType:T().gu.Popup,width:300},(0,z.jsx)(B().A,{...t,footer:(0,z.jsxs)(x().A,{topBorder:!0,children:[V.canConfigureBlock?(0,z.jsx)(so().A,{title:(0,z.jsx)(v().sA,{id:"database.viewSettings.relationsPropertyTab.removeRelation.removeRelationButton.title",defaultMessage:"Turn off for this view"}),isRedOnHover:!0,onClick:()=>ae(void 0)}):void 0,V.canConfigureCollection?(0,z.jsx)(so().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Turn off for all new views",id:"database.viewSettings.relationsPropertyTab.removeRelation.removeAllDefaultButton.title"}),isRedOnHover:!0,onClick:()=>{le(void 0)}}):void 0]})})}})})]}),children:[S?(0,z.jsx)(_r,{propertyName:L||N,inversePropertyName:(null==q?void 0:q.inverseName)||$,subitemsDisplayMode:k}):void 0,y?(0,z.jsx)(Kp,{propertyName:L||N}):void 0,J?void 0:(0,z.jsx)("div",{style:pe.useExistingTitle,children:(0,z.jsx)(v().sA,{defaultMessage:"Use an existing relation",id:"database.viewSettings.relationsPropertyTab.useExistingRelation.title"})}),F>0&&!J?(0,z.jsx)("div",{style:{paddingBottom:"6px"},children:(0,z.jsx)(x().A,{children:(0,z.jsx)(_().A,{buttonPopupStore:ee,render:e=>{let t;return t=c.isPhone?{menuType:T().gu.ActionSheet}:{menuType:T().gu.Popup,width:300},(0,z.jsx)(B().A,{...t,footer:(0,z.jsx)(K().A,{schema:b,format:w,getProperties:oe,onAccept:V.canConfigureBlock&&!V.canConfigureCollection?ae:kd().lQ,inputPlaceholder:d.formatMessage(S?Np.subitemInputPlaceholder:Np.timelineArrowsByInputPlaceholder),currentProperty:M,defaultShowPropertyCount:5,renderProperty:V.canConfigureBlock&&!V.canConfigureCollection?void 0:Se})})},renderOrigin:e=>{var t;return(0,z.jsx)(so().A,{title:(0,z.jsx)(v().sA,{id:"database.viewSettings.relationsPropertyTab.existingRelation",defaultMessage:"Property"}),showChevron:!0,right:M?null===(t=b[M])||void 0===t?void 0:t.name:void 0,rotateChevron:te,disabled:!1,icon:Pp().arrowDiagonalUpRightIcon,...e})},popupType:c.isPhone?Yn().nl.SlideUp:Yn().nl.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",originGap:0})})}):me&&(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(x().A,{children:(0,z.jsx)("div",{style:pe.emptyStateText,children:(0,z.jsx)(v().sA,{defaultMessage:"Rename (optional)",id:"database.viewSettings.relationsPropertyTab.emptyStateDescription"})})}),(0,z.jsx)(x().A,{children:(0,z.jsx)(mt().Ay,{value:L,placeholder:L,onChange:e=>U(e.target.value),onBlur:kd().lQ,onSubmit:kd().lQ,focusInitial:!0,selectAll:!1})}),(0,z.jsx)(Hd().Ay,{collectionContextStore:i,targetCollectionStore:j,property:void 0,temporaryInverseState:q,setTemporaryInverseState:Y,onSubmit:ce}),F>0?(0,z.jsx)("div",{style:{margin:"auto",textAlign:"center"},children:(0,z.jsx)(he().p,{onClick:()=>{nr().default.afterNextFlush((()=>{Z(!1)}))},colorPalette:"gray",style:pe.existingRelationButton,children:(0,z.jsx)(v().sA,{id:"database.viewSettings.relationsPropertyTab.newRelation",defaultMessage:"Use existing relation"})})}):void 0]})]})};var Lp=()=>o(748259);function Up({context:e,collectionContextStore:t,collectionSettingsStore:o,fullHeight:n,hideDesktopHeader:i}){const r=(0,l().v3)(),[a,c,d,u,p,g]=(0,s().K8)((()=>[t.collectionViewStore(),(0,Ru().gv)(t),t.normalizedSchemaStore.state,t.normalizedFormatStore.state,t.permissionScopesStore.state,Wp(t)]),[t]),m=(e===bo().Bd.ViewSettings||e===bo().Bd.MobileSheet)&&c;return a?(0,z.jsx)(C().A,{collectionSettingsStore:o,fullHeight:n,hideDesktopHeader:i,title:(0,z.jsx)(v().sA,{defaultMessage:"Sort",id:"database.viewSettings.sortTab.title"}),footer:m&&(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{style:{paddingTop:24}}),(0,z.jsx)(x().A,{topBorder:!0,children:(0,z.jsx)(Hp,{collectionContextStore:t})})]}),unconstrainedWidth:!0,children:(0,z.jsx)(Lp().A,{collectionContextStore:t,schema:d,format:u,sorts:g,disabled:!p.canConfigureBlock,parentStore:a,onChange:e=>function(e,t,o){!function(e,t,o){const n=t.collectionViewStore();if(!n)return;au().IU({environment:o,collectionContextStore:t,temporaryState:{...t.temporaryStateStore.state,sorts:{value:e}}})}(e,o,t)}(e,r,t),showDeleteAll:!0,onDeleteAll:()=>function(e,t){t===bo().Bd.FilterBar&&R().os({collectionSettingsStore:e})}(o,e)})}):null}function Wp(e){return e.currentSortsStore.state}function Hp({collectionContextStore:e}){return(0,z.jsx)(zu()._Q,{context:"SettingsSort",collectionContextStore:e})}var $p=()=>o(338907),Gp=()=>o(922952);function Qp(e){const t=e.getParentStore();if(t&&(0,Gp().u)(t))return t}var qp=()=>o(663247),Yp=()=>o(736982),Xp=()=>o(231314),Jp=()=>o(902842);const Zp=new(Ee().O2)("WorkflowTemplatesTooltip",(async()=>await Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(44854),o.e(87017),o.e(46414),o.e(61165),o.e(47668),o.e(24587),o.e(67494),o.e(3651),o.e(48486),o.e(92924),o.e(71481)]).then(o.bind(o,428137)))),eg=(0,Ee()._h)(Zp,(e=>e.WorkflowTemplatesTooltip));var tg=()=>o(3486);const og=14,ng=32;function ig(e){const{collectionTemplate:t,iconStyle:o,captionStyle:n,onAcceptCollectionTemplate:i,parentStore:r,collectionTemplateParentStore:l,hideIconBackground:a,nameOverride:s,hideCaption:c,aiPrompt:d,origin:u,dataSourceAnalytics:p}=e,{templateId:g,description:m}=t,{name:S}=t.value.targetCollection,y=(0,tg().P)(t.value.targetCollection.icon),f=(0,z.jsx)(Jp().z,{template:t,size:og,iconStyle:o});return{key:g,render:e=>(0,z.jsx)(eg,{placement:"left",collectionTemplate:t,render:t=>(0,z.jsx)(Yp().I,{buttonMenuItemProps:{...(0,ao().A)(e,t),alignIconTop:!0},title:s??S,caption:c?void 0:(0,z.jsx)("div",{style:n,children:m}),icon:(0,z.jsx)(Xp().y,{backgroundSize:ng,icon:f,backgroundColor:a?"#00000000":O().Tj[y].background.secondary})})}),action:()=>{i({template:t,collectionViewBlockStore:r,collectionViewBlockParentStore:l,flowId:void 0,aiPrompt:d,origin:u,dataSourceAnalytics:p})}}}function rg({collectionStore:e,collectionSettingsStore:t,createdCollectionRecordPointerMap:o,analytics:n}){return{key:"more_settings",render:e=>(0,z.jsx)(x().A,{topBorder:!0,...e}),items:[{key:"link_database",render:e=>(0,z.jsx)(lg,{buttonMenuItemProps:e}),action:()=>{R().dP({collectionSettingsStore:t,item:{type:"createViewSource",existingCollectionStore:e,createdCollectionRecordPointerMap:o,analytics:n}}),R().a2({collectionSettingsStore:t,item:{type:"linkToDatabase",existingCollectionStore:e,analytics:n}})}}]}}function lg({buttonMenuItemProps:e}){const t=(0,h().IS)((()=>({iconWrapper:{width:ng},linkDatabaseIcon:{fill:O().Tj.text.secondary,margin:"auto"}})),[]);return(0,z.jsx)(Yp().I,{buttonMenuItemProps:e,title:(0,z.jsx)(v().sA,{id:"createViewSourceMenuBody.linkDataSource",defaultMessage:"Link to existing data source"}),icon:(0,z.jsx)("div",{style:t.iconWrapper,children:(0,z.jsx)(H().I,{icon:qp().arrowDiagonalUpRightFillIcon,size:"sm",style:t.linkDatabaseIcon})})})}function ag({input:e,setInput:t,placeholderText:o}){const i=(0,s().uB)(void 0,Xl().$);return(0,n.useMemo)((()=>({key:"input",render:e=>(0,z.jsx)(x().A,{shouldShowBottomDivider:!1,...e}),items:[{key:"input",action:()=>{},render:n=>(0,z.jsx)(mt().Ay,{...n,value:e,onChange:e=>{t(e.target.value),i.setState({focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})},focusInitial:!f().A.isMobile,autoFocus:!f().A.isMobile,placeholder:o,showClearButton:!0})}]})),[e,i,o,t])}var sg=()=>o(536095),cg=()=>o(727722),dg=()=>o(160475),ug=()=>o(913454),pg=()=>o(820579);function gg(e){const{buttonMenuItemProps:t,isLinkedView:o}=e,n=(0,l().v3)(),i=(0,h().IS)((()=>({importIcon:{width:20,height:33,margin:"auto"},iconWrapper:{width:o?24:ng}})),[o]);return(0,os().w)((()=>{(0,dg().t)({environment:n,action:"view",from:"database_create_empty_state"})})),(0,z.jsx)(Yp().I,{buttonMenuItemProps:t,title:(0,z.jsx)(v().sA,{id:"createViewSourceMenuBody.importButton",defaultMessage:"Import CSV"}),icon:(0,z.jsx)("div",{style:i.iconWrapper,children:(0,z.jsx)(H().I,{icon:pg().arrowLineDownIcon,style:i.importIcon})})})}const mg=(0,v().YK)({setupWithAI:{defaultMessage:"Build with AI",id:"database.viewSettings.searchCollections.setupWithAI"}});function Sg(e){const{newButtonMenuItem:t,collectionTemplateParentStore:o,onAcceptCollectionTemplate:n,parentStore:i,showTopBorder:r,hideCaption:a,searchInput:c,settingsSupportsSuggestedTemplates:d,origin:u,isLinkedView:p,dataSourceAnalytics:g,showBuildWithAi:m=!0}=e,S=(0,v().tz)(),y=(0,l().v3)(),f=(0,hr().ET)(),[b,C]=(0,s().K8)((()=>[f.collectionViewBlockStore(),f.getIsInDashboardBuildMode()]),[f]),j=(0,h().IS)((()=>({icon:{width:20,height:20,...e.iconStyle},caption:e.captionStyle??{},tableWrapperStyle:e.sectionMenuItemStyle??{}})),[e.iconStyle,e.captionStyle,e.sectionMenuItemStyle]);return(0,s().K8)((()=>{if(!t||C)return;const e=[t];if((0,ug().getIsSetupGeneratorEnabled)(void 0,void 0)&&m&&o&&d&&Va().A.state.online){const t=ug().globalWorkflowTemplates.fromIdOfType({type:"collection",templateId:sg().MH});e.push(ig({collectionTemplate:t,iconStyle:j.icon,captionStyle:j.caption,onAcceptCollectionTemplate:n,parentStore:i,collectionTemplateParentStore:o,nameOverride:S.formatMessage(mg.setupWithAI),hideIconBackground:!0,hideCaption:a,aiPrompt:(0,pi().x9d)(c),origin:u,dataSourceAnalytics:g}))}if($e().default.checkGate({gateName:"contextualized_import_entrypoints"})&&!p){const t={key:"import_button",render:e=>(0,z.jsx)(gg,{buttonMenuItemProps:e,isLinkedView:p}),action:()=>{(0,dg().t)({environment:y,action:"click",from:"database_create_empty_state"}),b&&(0,cg().T)({environment:y,store:b,analytics:{from:"database_create_empty_state",...g}})}};e.push(t)}return{key:"newButton",render:e=>(0,z.jsx)(x().A,{...e,topBorder:r,style:j.tableWrapperStyle}),items:e}}),[t,o,d,j.icon,j.caption,j.tableWrapperStyle,n,i,S,a,c,r,u,p,b,y,g,C,m])}var yg=()=>o(343666),fg=()=>o(839754);function hg({buttonMenuItemProps:e,iconStyle:t,hideButton:o,menuItemStyle:n}){const i=(0,h().IS)((()=>({buttonMenuItem:{display:o?"none":"flex",...n}})),[o,n]);return(0,z.jsx)($().A,{style:i.buttonMenuItem,...e,title:(0,z.jsx)(P().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,z.jsx)(v().sA,{id:"addWorkflowTemplateMenu.moreTemplates",defaultMessage:"More templates"})}),icon:(0,z.jsx)(H().I,{icon:Dl().ellipsisIcon,colorVariant:"secondary",style:t})})}var xg=()=>o(575154);var vg=()=>o(349379),bg=()=>o(239924),Cg=()=>o(466934);const jg=(0,v().YK)({suggested:{defaultMessage:"Suggested",id:"database.viewSettings.createViewTab.suggested"}});function wg(e){const{input:t,parentStore:o,onAcceptCollectionTemplate:i,collectionContextStore:r,settingsSupportsSuggestedTemplates:a,origin:c,dataSourceAnalytics:d}=e,p=(0,l().v3)(),[g]=(0,n.useState)((0,u().Ay)()),m=(0,h().IS)((()=>({icon:{marginInlineStart:6,marginInlineEnd:6},moreIcon:{marginInline:(ng-D().Ev.default)/2},caption:{fontSize:Uo().vQ,whiteSpace:"normal"}})),[]),S=(0,s().K8)((()=>Qp(o)),[o]),f=(0,xg().q)({parentStore:S}),v=(0,nt().Ay)(t,f,(e=>e.value.targetCollection.name)),b=v.slice(0,ug().TRUNCATE_COLLECTION_TEMPLATE_ITEMS_AT),C=b.length<v.length,j=(0,n.useMemo)((()=>S?b.map(((e,t)=>ig({collectionTemplate:e,iconStyle:m.icon,captionStyle:m.caption,hideCaption:!0,onAcceptCollectionTemplate:o=>{i(o),(0,vg().os)({environment:p,eventProperties:{from_modal_template_picker:!1,selected_index:t,collection_template_ids_shown:b.map((e=>e.templateId)),...(0,Cg().gM)({origin:c,parentStore:S,collectionTemplate:e,flowId:g,dataSourceAnalytics:d,collectionTemplatesSearchQuery:void 0})}})},parentStore:o,collectionTemplateParentStore:S,aiPrompt:void 0,origin:c,dataSourceAnalytics:d}))):[]),[S,i,o,m,b,p,g,c,d]),w=(0,n.useMemo)((()=>{const e={key:"see_more_workflow_templates",render:e=>(0,z.jsx)(hg,{buttonMenuItemProps:e,iconStyle:m.moreIcon,menuItemStyle:(0,Yp().h)()}),action:()=>function({environment:e,parentStore:t,collectionContextStore:o,origin:n,flowId:i,dataSourceAnalytics:r}){const l=t.getParentStore(),a=o.collectionViewBlockStore();if(!l||!a||l.table===yg().SN||!(0,Gp().u)(l))return;const s={collectionStore:o.collectionStore(),collectionViewStore:o.collectionViewStore(),collectionViewBlockStore:a};(0,bg().openTemplateOnboardingModal)({parentStore:l,template:void 0,version:(0,bg().getTemplateOnboardingVersion)({template:void 0}),origin:n,existingCollectionInfo:s,navigateToOnFinish:"skip",flowId:i,dataSourceAnalytics:r,onClose:t=>(0,fg().ZM)({environment:e,userAction:"CreateViewSourceMenuBodyNew.handleClickMoreButton",result:t,existingCollectionViewBlockStore:a,existingCollectionStore:s.collectionStore})})}({parentStore:o,collectionContextStore:r,environment:p,origin:c,flowId:g,dataSourceAnalytics:d})};return{key:"suggestedCollectionTemplates",items:[...j,...C?[e]:[]],render:e=>(0,z.jsx)(x().A,{title:ea().A.formatMessage(jg.suggested),...e})}}),[j,C,m.moreIcon,p,o,r,c,g,d]);if(function({collectionTemplateIds:e,origin:t,flowId:o,blockId:i}){const r=(0,l().v3)(),a=(0,n.useRef)(!1);(0,n.useEffect)((()=>{a.current||((0,y().u)({environment:r,event:{eventName:"suggested_collection_templates_shown",eventProperties:{origin:t,collection_template_ids_shown:e,block_id:i,flow_id:o}}}),a.current=!0)}))}({collectionTemplateIds:b.map((e=>e.templateId)),origin:c,blockId:o.id,flowId:g}),a)return 0===j.length?void 0:w}function Ag({environment:e,collectionContextStore:t,template:o,collectionViewBlockStore:n,collectionViewBlockParentStore:i,flowId:r,aiPrompt:l,origin:a,dataSourceAnalytics:s}){var c;if(null!==(c=o.value.onboarding)&&void 0!==c&&c.isMinimal)return void(0,bg().createMinimalCollectionTemplateWithoutModal)({environment:e,template:o,parentStore:i,existingCollectionInfo:{collectionViewBlockStore:n,collectionStore:t.collectionStore(),collectionViewStore:t.collectionViewStore()},relationInfos:[]});const d={collectionViewBlockStore:n,collectionStore:t.collectionStore(),collectionViewStore:t.collectionViewStore()};(0,bg().openSelectedTemplateOnboardingModalForInAppFlows)({environment:e,template:o,parentStore:i,existingCollectionInfo:d,origin:a,dataSourceAnalytics:s,navigateToOnFinish:"skip",flowId:r,aiPrompt:l,onClose:t=>(0,fg().ZM)({environment:e,userAction:"CreateViewSourceMenuBodyNew.onAcceptCollectionTemplate",result:t,existingCollectionViewBlockStore:n,existingCollectionStore:d.collectionStore})})}const Ig=(0,v().YK)({search:{defaultMessage:"Search...",id:"database.viewSettings.searchCollections.search"}});function _g({collectionContextStore:e,parentStore:t,collectionStore:o,input:i,setInput:r,newButtonMenuItem:a,analytics:c}){const d=(0,v().tz)(),u=(0,l().v3)(),p=(0,s().K8)((()=>(0,$p().u)(u)),[u]),g=i.length>0,m=(0,h().IS)((()=>({sectionMenuItem:{...g&&{position:"sticky",bottom:0,backgroundColor:O().Tj.popoverBackground}}})),[g]),S=(0,s().K8)((()=>Qp(t)),[t]),y=(0,s().O$)(e.isFullScreenStore)?"collection_settings_add_new_database":"collection_settings_add_new_database_inline",f=(0,n.useCallback)((t=>Ag({...t,environment:u,collectionContextStore:e,origin:y})),[u,e,y]),x=wg({input:i,onAcceptCollectionTemplate:f,parentStore:t,collectionContextStore:e,settingsSupportsSuggestedTemplates:p,origin:y,dataSourceAnalytics:c}),b=Sg({newButtonMenuItem:a,collectionTemplateParentStore:S,onAcceptCollectionTemplate:f,parentStore:t,showTopBorder:Boolean(x)&&g,sectionMenuItemStyle:m.sectionMenuItem,hideCaption:!0,searchInput:i,settingsSupportsSuggestedTemplates:p,origin:y,isLinkedView:!1,dataSourceAnalytics:c}),C=ag({input:i,setInput:r,placeholderText:d.formatMessage(Ig.search)}),j=rg({collectionStore:o,collectionSettingsStore:e.settingsStore,createdCollectionRecordPointerMap:void 0,analytics:c}),w=(0,n.useMemo)((()=>(0,Ro().oE)(g?[C,x,b]:[p?C:void 0,b,x,j])),[g,C,x,b,p,j]);return(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,sections:w})}var Tg=()=>o(664594),kg=()=>o(798880),Mg=()=>o(359454),Pg=()=>o(594794),Bg=()=>o(295304),Vg=()=>o(272600);const Fg=(0,v().YK)({newEmptyDataSource:{defaultMessage:"New empty data source",id:"database.viewSettings.createViewTab.newEmptyDataSource"},newDataSourceWithName:{defaultMessage:"New â€œ{name}â€ data source",id:"database.viewSettings.createViewTab.newDataSourceWithName"}});function Dg({phase:e,baseViewType:t,onComplete:o,input:n,originalTitle:i,existingCollectionStore:r,analytics:a}){const c=(0,l().v3)(),d=(0,Tg().T)(),u=(0,v().tz)(),p=(0,hr().ET)(),g=p.settingsStore,{collectionViewBlockStore:m,collectionStore:S,collectionViewStore:y}=(0,s().K8)((()=>({collectionViewBlockStore:p.collectionViewBlockStore(),collectionStore:p.collectionStore(),collectionViewStore:p.collectionViewStore()})),[p]);return(0,s().K8)((()=>{if("initialized"!==e&&"initialized_source"!==e)return;if(!d)return;const t=n.length>0?u.formatMessage(Fg.newDataSourceWithName,{name:n}):u.formatMessage(Fg.newEmptyDataSource);return{key:"newButton",render:e=>(0,z.jsx)(Yp().I,{buttonMenuItemProps:e,title:t,icon:(0,z.jsx)(Xp().y,{icon:(0,z.jsx)(H().I,{icon:F().plusSmallIcon,size:"sm",colorVariant:"secondary"}),backgroundSize:ng})}),action:()=>{var e;if(!m)throw new Error("collectionViewBlockStore is undefined");const t=!S&&"uninitialized"===p.getCollectionViewBlockSourceState(),o=n.length>0&&!i,l=Boolean(r&&r.id!==(null==S?void 0:S.id));(t||l||o)&&A().createAndCommit({userAction:"CollectionSettingsCreateViewSource.createNewEmptyDataSource",environment:c,canUndo:!0,perform:e=>{if(t){const t=(0,Pg().Z1)({environment:c,table:Wl().Vl,spaceId:m.getSpaceId()}),o=$l().vt({environment:c,table:Wl().Vl,args:{id:t,name:(0,pi().x9d)(n),parent:m.pointer,space_id:m.getSpaceId(),alive:!0,schema:{},createdBy:{table:kg().oo,id:d}},inMemoryRecordCache:m.inMemoryRecordCache,transaction:e});(0,Vg().p)({collectionViewBlockStore:m,collectionPointer:o.pointer,transaction:e})}else if(l){if(!y)throw new Error("collectionViewStore should be defined");(0,Vs().T)({collectionViewBlockStore:m,collectionViewStore:y,transaction:e}),(0,ks().n)({environment:c,collectionContextStore:p,transaction:e,collectionName:n,analytics:{from:"addNewDatabaseButton",dataSourceFrom:(null==a?void 0:a.dataSourceFrom)??"view_creation",dataSourceSessionId:(null==a?void 0:a.dataSourceSessionId)??""}})}else if(o){const t=null==S?void 0:S.getNameStore();t&&Bg().R9({environment:c,store:t,value:(0,pi().x9d)(n),transaction:e})}}}),R().os({collectionSettingsStore:g}),"collection_view_page"!==(null===(e=p.collectionViewBlockStore())||void 0===e?void 0:e.getType())||0!==n.length||i||nr().default.afterNextFlush((()=>{(0,Mg().P)({environment:c,collectionContextStore:p})})),(0,Us().trackCreateNewEmptyDataSource)(c,{data_source_from:null==a?void 0:a.dataSourceFrom,data_source_session_id:null==a?void 0:a.dataSourceSessionId,collection_view_block_id:null==m?void 0:m.id,collection_id:null==S?void 0:S.id,owned_collection_count:null==m?void 0:m.getOwnedCollectionStores().length,linked_collection_count:null==m?void 0:m.getLinkedCollectionStores().length})}}}),[c,e,n,m,u,a,S,g,p,i,y,r,d])}function Eg(e){const{collectionSettingsStore:t,collectionContextStore:o,collectionStore:i,analytics:r}=e,l=(0,s().K8)((()=>o.collectionViewBlockStore()),[o]),[a,c]=(0,n.useState)(""),d=Dg({phase:"initialized",input:a,originalTitle:void 0,baseViewType:"table",existingCollectionStore:void 0,analytics:r}),u=(0,n.useCallback)((()=>R().os({collectionSettingsStore:t})),[t]),p=(0,s().K8)((()=>null!=l&&l.hasMultipleOwnedOrLinkedCollections()?(0,z.jsx)(v().sA,{defaultMessage:"New data source",id:"database.viewSettings.addNewDatabaseTab.newDataSource"}):(0,z.jsx)(v().sA,{defaultMessage:"New database",id:"database.viewSettings.addNewDatabaseTab.newDatabase"})),[l]);return(0,z.jsx)(C().A,{...e,title:p,handleClose:u,children:l?(0,z.jsx)(_g,{collectionContextStore:o,parentStore:l,collectionStore:i,input:a,setInput:c,newButtonMenuItem:d,analytics:r}):void 0})}var Og=()=>o(654062),Rg=()=>o(943919),Kg=()=>o(403905),Ng=()=>o(755735),zg=()=>o(382607),Lg=()=>o(635019);function Ug({collectionContextStore:e,showDoneButton:t,collectionSettingsStore:o,onDoneClick:n,menuType:i}){const r=(0,l().v3)(),a=(0,s().K8)((()=>e.collectionViewStore()),[e]),c=(0,h().IS)((()=>({doneButtonSection:{paddingTop:0,marginBottom:zg().Qm}})),[]),d=(0,s().K8)((()=>"viewsMain"!==e.viewsModuleContextStore.getViewModuleType()),[e]);return a?(0,z.jsxs)(z.Fragment,{children:[d?(0,z.jsx)(x().A,{topBorder:!1,extraPadding:!0,children:(0,z.jsx)(Lg().f,{collectionContextStore:e,collectionSettingsStore:o})}):null,t?(0,z.jsx)(x().A,{extraPadding:!0,disableMobileBorders:!0,style:c.doneButtonSection,children:(0,z.jsx)(M().A,{colorPalette:"blue",style:{display:"flex",margin:`0 ${zg().Qm}px`},onClick:()=>{"createView"===i&&(0,Sr().X)({environment:r,collectionContextStore:e,action:"click_create_view_done"}),n&&n()},children:(0,z.jsx)(v().sA,{defaultMessage:"Done",id:"pageViewSettings.doneButton"})})}):void 0]}):null}const Wg=function(e){const{collectionContextStore:t,collectionSettingsStore:i,analytics:r}=e,a=(0,v().tz)(),c=(0,h().eP)(),d=(0,l().v3)(),u=(0,s().K8)((()=>t.collectionViewStore()),[t]),p=(0,s().K8)((()=>null==u?void 0:u.isDefined()),[u]),[g,m]=(0,n.useState)(""),S=(0,s().K8)((()=>null==u?void 0:u.getFormat().collection_view_icon),[u]),y=(0,s().K8)((()=>null==u?void 0:u.getType()),[u]),b="page"===y,j=(0,sd().a)(),w=(0,n.useCallback)((()=>{$g(g,d,a,i,t)}),[g,d,a,i,t]);return u&&p?(0,z.jsxs)(C().A,{...e,collectionSettingsStore:i,title:b?(0,z.jsx)(v().sA,{defaultMessage:"New page view",id:"database.viewSettings.createPageViewTab.title"}):(0,z.jsx)(v().sA,{defaultMessage:"New view",id:"database.viewSettings.createViewTab.title"}),desktopWidth:j?280:290,children:[(0,z.jsx)(x().A,{isInput:!0,children:(0,z.jsx)(Ng().B,{initialValue:g,placeholder:a.formatMessage(o(395859).X.viewNamePlaceholderMessage),focusInitial:!f().A.isMobile||void 0,onBlur:e=>Hg(e,d,t,a),onChange:e=>m(e),iconButton:{icon:e=>(0,z.jsx)(El().h,{color:"gray",viewIcon:S,viewType:y}),iconStyle:{fill:Vo().l8[c].gray},enforceIconColor:"gray",onSubmit:e=>function(e,t,o){const n=t.collectionViewStore();if(!n||!n.isDefined())return;A().createAndCommit({userAction:"CollectionSettingsCreateView.handleViewIconSubmit",environment:e,canUndo:!0,perform:e=>{(0,Rg().o)({collectionViewStore:n,icon:o,transaction:e})}}),(0,Sr().X)({environment:e,collectionContextStore:t,action:"change_icon",icon:o})}(d,t,e)},onSubmit:e=>$g(e,d,a,i,t)})}),b?(0,z.jsx)(Ug,{collectionContextStore:t,collectionSettingsStore:i,showDoneButton:!f().A.isMobile,onDoneClick:w,menuType:"createView"}):(0,z.jsx)(Ip().A,{collectionContextStore:t,collectionSettingsStore:i,showDoneButton:!f().A.isMobile,onDoneClick:w,menuType:"createView",analytics:r})]}):null};function Hg(e,t,o,n){const i=o.collectionViewStore();if(!i)return;if(!i.isDefined())return;const r=(0,Kg().V)(e,i.getType(),n);i.getName()!==r&&A().createAndCommit({userAction:"CollectionSettingsCreateView.handleViewNameBlur",environment:t,canUndo:!0,perform:e=>{(0,Og().F)({collectionViewStore:i,update:{name:r},transaction:e})}})}function $g(e,t,o,n,i){Hg(e,t,i,o),R().R8({collectionSettingsStore:n,item:{type:"main"}}),(0,Sr().X)({environment:t,collectionContextStore:i,action:"rename"})}var Gg=()=>o(714042),Qg=()=>o(789586),qg=()=>o(564037),Yg=()=>o(424599);function Xg(e){const{collectionContextStore:t,environment:o,collectionStore:n,collectionSettingsStore:i,createdCollectionStore:r,userAction:l,analytics:a}=e,s=t.collectionViewBlockStore();if(!s)return;const c=t.collectionViewStore();if(!c)return;if(A().createAndCommit({userAction:l,environment:o,canUndo:!0,perform:e=>{var l;ql({environment:o,collectionContextStore:t,source:{type:"collection",id:n.id,spaceId:n.getSpaceId()},transaction:e}),r&&(0,Ns().removeCollectionFromCollectionViewBlock)({collectionViewBlockStore:s,collectionStore:r,transaction:e}),t.isInHomeWidgetStore.state&&R().os({collectionSettingsStore:i});const a=s.getBlockTitleStore(),c=null==s||null===(l=s.getTitleStore())||void 0===l?void 0:l.getValue();a&&c&&Bg().R9({environment:o,store:a,value:c,transaction:e})}}),(0,Us().trackLinkedExistingDataSource)(o,{collection_view_block_id:s.id,collection_view_id:c.id,collection_id:n.id,data_source_from:null==a?void 0:a.dataSourceFrom,data_source_session_id:null==a?void 0:a.dataSourceSessionId}),(0,qg().getIsWorkflowEditorOpen)(o))return void R().os({collectionSettingsStore:i});const d=t.viewsModuleContextStore.isInLayoutBuilder();(0,Yg().M)({environment:o,collectionStore:n,collectionContextStore:t,collectionSettingsStore:i,shouldSkipViewSelection:d})}function Jg(e){var t;return Boolean((null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.isInlineCollectionView())&&"uninitialized"===e.getCollectionViewBlockSourceState())}var Zg=()=>o(965454);const em=(0,v().YK)({placeholder:{defaultMessage:"Describe what you want to build",id:"database.createDatabaseAI.placeholder"}});function tm({parentStore:e,onThreadCreated:t,collectionSettingsStore:o}){const i=(0,l().v3)(),r=(0,v().tz)(),[a,c]=(0,n.useState)(0),[d,u]=(0,n.useState)(!1),p=(0,hu().K7)("agent_new_db_quick_access"),g=(0,s().O$)(ze().AppStoreSidebarSpaceViewStore),m=(0,pu().DV)(g),S=(0,Zg().AD)(),y=(0,h().eP)(),f=(0,h().IS)((()=>({container:{width:"100%",padding:"10px 11px",transition:"all 200ms ease"},inputWrapper:{width:"100%",maxWidth:"100%",position:"relative",display:"flex",background:O().Tj.background.primary,border:`1px solid ${O().Tj.border.secondary}`,borderRadius:12,minHeight:40,maxHeight:100,overflowY:"auto",overflowX:"hidden",outline:d?`2px solid ${O().Tj.blue.border.accentPrimary}`:void 0,transition:"outline 0.1s ease-in-out, height 0.2s ease"},assistantFace:{width:20,height:20,borderRadius:"50%",backgroundColor:O().Tj.background.elevated,flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",userSelect:"none",marginTop:10,marginInlineStart:8},inputContent:{flex:1,display:"flex",alignItems:"flex-start",paddingTop:7,paddingInlineEnd:7,paddingBottom:3,paddingInlineStart:7},loading:{width:"100%",height:40,borderRadius:8,background:"dark"===y?O().Tj.gray.background.secondary:O().Tj.background.secondary,animation:"pulse 1.5s ease-in-out infinite"}})),[d,y]),x=(0,n.useCallback)((({newThreadStore:e})=>{if(!e||!i)return;const n=ju().default.state,r=ju().default.isCenterPeekOpen()&&n.open?n.targetStore:ze().default.state.mainEditorCurrentBlockStore;r&&(ju().default.isCenterPeekOpen()&&uu().VN({environment:i,from:"agent_sidebar_open"}),(0,bu().openChatPanel)({environment:i,store:r,source:"new_db_creation",chatPanelState:{isOpen:!0,threadId:e.id}}),R().os({collectionSettingsStore:o}),S.reset(),c((e=>e+1)),null==t||t(e))}),[i,t,o,S]),{nextConfig:b,setNextConfig:C}=(0,fu().I)({threadStore:void 0,spaceId:e.pointer.spaceId}),j=(0,n.useCallback)((()=>{du().trackAgentQuickAccessTypingStarted({environment:i,from:"collections_new_db"})}),[i]),w=(0,n.useCallback)((()=>{u(!0)}),[]),A=(0,n.useCallback)((()=>{u(!1)}),[]),I=(0,n.useCallback)((()=>{R().os({collectionSettingsStore:o})}),[o]);return(0,z.jsx)("div",{style:f.container,children:(0,z.jsxs)("div",{style:f.inputWrapper,onFocus:w,onBlur:A,children:[(0,z.jsx)("div",{style:f.assistantFace,"aria-hidden":"true",children:(0,z.jsx)(gu().x,{accessory:m,variant:"xsmall"})}),(0,z.jsx)("div",{style:f.inputContent,children:(0,z.jsx)(Cu().hP,{surface:Cu().wy.inferenceTranscriptChatView,children:(0,z.jsx)(mu().n_,{renderLoading:e=>e?(0,z.jsx)("div",{style:f.loading}):null,aiChatFeatureController:p,clientStore:vu().defaultClientAIChatStore,onThreadChange:x,onStartTyping:j,onEsc:I,threadStore:void 0,nextConfig:b,setNextConfig:C,placeholder:r.formatMessage(em.placeholder),invokedFromBlockId:e.id},a)})})]})})}const om=(0,v().YK)({link:{defaultMessage:"Link...",id:"database.viewSettings.searchCollections.link"},search:{defaultMessage:"Search...",id:"database.viewSettings.searchCollections.search"},addOrLinkDataSource:{defaultMessage:"Add or link data source...",id:"database.viewSettings.searchCollections.addOrLinkDataSource"}}),nm={type:"noSuggestions"};function im({collectionContextStore:e,collectionSettingsStore:t,parentStore:o,existingCollectionStore:i,createdCollectionRecordPointerMap:r,input:a,setInput:c,newButtonMenuItem:d,context:u,handleAcceptExistingCollection:p,hideSearchTitle:g,analytics:m}){const S=(0,l().v3)(),f=(0,v().tz)(),x=(0,l().WS)(),b=(0,n.useRef)(0),C=(0,s().K8)((()=>function({environment:e,collectionContextStore:t}){var o;return!!(0,$p().u)(e)&&(!Jg(t)&&!Boolean("chart"===(null===(o=t.collectionViewStore())||void 0===o?void 0:o.getType())))}({environment:S,collectionContextStore:e})),[S,e]),j=a.length>0,[w,A,I]=(0,s().K8)((()=>{var t;return[Jg(e),e.getIsInDashboardBuildMode(),"chart"===(null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType())]}),[e]),_=j||!C,{hasAIAccessInWorkspace:T,isAiEnabledInWorkspace:k}=(0,cu().g)(e),M=(0,n.useMemo)((()=>!(!k||!T)&&!(x||w||A)),[k,T,x,w,A]),{resultsSection:P,searchSessionId:B,searchSessionFlowNumber:V,hasResults:F}=ga({input:a,collectionContextStore:e,hideSearchTitle:g,parentStore:o,context:u,handleAcceptExistingCollection:p,searchResultsItemsLimit:3,showLoadMoreResultsButton:j,isSearchSurfacesHookEnabled:!0,suggestionConfig:nm,peopleBlocksToInclude:"none"}),D=(0,n.useMemo)((()=>{if(_&&F)return P}),[P,_,F]);(0,n.useEffect)((()=>{b.current=V}),[V]),(0,n.useEffect)((()=>((0,y().u)({environment:S,event:{eventName:"source_collection_search_open",eventProperties:{search_session_id:B,using_secondary_search_surfaces_hook:!0,source:"source"}}}),()=>{(0,y().u)({environment:S,event:{eventName:"source_collection_search_close",eventProperties:{search_session_id:B,source:"source",using_secondary_search_surfaces_hook:!0,search_session_flow_number:b.current}}})})),[S,B]);const E=(0,h().IS)((()=>({sectionMenuItem:{...j&&{position:"sticky",bottom:0,backgroundColor:O().Tj.popoverBackground}}})),[j]),R=(0,s().K8)((()=>Qp(o)),[o]),K=(0,s().O$)(e.isFullScreenStore)?"collection_settings_create_view_source":"collection_settings_create_view_source_inline",N=(0,n.useCallback)((t=>Ag({...t,environment:S,collectionContextStore:e,origin:K})),[S,e,K]),L=wg({input:a,onAcceptCollectionTemplate:N,parentStore:o,collectionContextStore:e,settingsSupportsSuggestedTemplates:C,origin:K,dataSourceAnalytics:void 0}),U=w?void 0:L,W=Sg({newButtonMenuItem:d,collectionTemplateParentStore:R,onAcceptCollectionTemplate:N,parentStore:o,showTopBorder:!C&&_&&(Boolean(U)||F),showBuildWithAi:!M,sectionMenuItemStyle:E.sectionMenuItem,hideCaption:!0,searchInput:a,settingsSupportsSuggestedTemplates:C,origin:K,isLinkedView:w,dataSourceAnalytics:void 0}),H=!_||M&&I?rg({collectionStore:i,collectionSettingsStore:t,createdCollectionRecordPointerMap:r,analytics:m}):void 0,$=ag({input:a,setInput:c,placeholderText:(0,s().K8)((()=>void 0===d||A?null!=e&&e.isInHomeWidgetStore.state?f.formatMessage(om.search):f.formatMessage(om.link):f.formatMessage(om.addOrLinkDataSource)),[e,d,f,A])}),G=function({parentStore:e,collectionSettingsStore:t}){return(0,n.useMemo)((()=>({key:"ai_database_creation",render:()=>(0,z.jsx)(tm,{parentStore:e,collectionSettingsStore:t}),items:[],showTopBorder:!1})),[e,t])}({parentStore:o,collectionSettingsStore:t}),Q=(0,n.useMemo)((()=>(0,Ro().oE)(j?[M?G:$,D,U,W,H]:[M?G:$,W,D,U,H])),[j,M,G,$,D,U,W,H]);return(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:M&&G?void 0:0,resetFocusOnMouseOut:!0,sections:Q})}function rm(e){const t=(0,v().tz)(),{collectionSettingsStore:i,collectionContextStore:r,existingCollectionStore:a,analytics:c}=e,d=(0,l().v3)(),u=(0,s().K8)((()=>r.viewsModuleContextStore.isInLayoutBuilder()),[r]),p=d.currentUser.id,[g,m,S,y,f]=(0,s().K8)((()=>{var e;return[r.collectionViewBlockStore(),r.collectionViewStore(),r.collectionStore(),r.getCollectionViewBlockSourceState(),null===(e=r.collectionStore())||void 0===e?void 0:e.getSpaceId()]}),[r]),[h,x]=(0,n.useState)(void 0),[b,j]=(0,n.useState)(void 0),[[w,I],_]=(0,n.useState)([a,void 0]),T=(0,n.useCallback)((e=>{if(_(e),i.state.open){const[t,o]=e;R().dP({collectionSettingsStore:i,item:{type:"createViewSource",existingCollectionStore:t,createdCollectionRecordPointerMap:o,analytics:c}})}}),[i,c]),[k,M]=(0,n.useState)(""),P=(0,s().K8)((()=>S&&r.hasSingleCollection()),[r,S]),B=(0,Qg().P)({name:"view_chart",spaceId:f,userId:p,amount:"unknown"}),[V,F]=(0,n.useState)("boot");(0,n.useEffect)((()=>{if("boot"===V&&m){var e,t,o;const l=null==m?void 0:m.id,a=l?null===(e=(0,as().v)(l))||void 0===e?void 0:e.viewType:void 0,s=a||(null==m?void 0:m.getType());x(a??(null==m?void 0:m.getType()));const c=null===(t=r.collectionViewBlockStore())||void 0===t?void 0:t.getTitleValue();var n;if(null!=c&&null!==(o=c[0])&&void 0!==o&&null!==(o=o[0])&&void 0!==o&&o.length)j(null===(n=r.collectionViewBlockStore())||void 0===n?void 0:n.getTitleValue());"chart"===s&&Gg().Z({environment:d,collectionContextStore:r,collectionViewId:l,from:"slash_menu"}).then((e=>{if("success"===(null==e?void 0:e.type)){const t=e.data.can_view_chart;B||t||"singleSource"!==r.getCollectionViewBlockSourceState()||R().os({collectionSettingsStore:i})}})),F("initializing")}}),[B,r,i,m,d,V,f]);const D=(0,n.useCallback)((async e=>{const t=r.collectionViewStore(),n=r.collectionViewBlockStore();if(!t||!n)return;let i;b?i=b:null!=e&&e.length&&(i=(0,pi().x9d)(e)),await async function(e){const{environment:t,collectionName:n,collectionContextStore:i,collectionViewBlockStore:r,collectionViewStore:l,baseViewType:a,createdCollectionRecordPointerMap:s,setCreatedCollection:c,isInLayoutBuilder:d}=e,u=l,p=r;(0,Sr().X)({environment:t,collectionContextStore:i,action:"select_new_collection"}),"chart"===a&&i.isCreatingNewChartCollectionStore.setState(!0);const{addCollectionViewSourceToNewCollection:g}=await o.e(12071).then(o.bind(o,711996));A().createAndCommit({userAction:"CollectionSettingsCreateViewSourceNew.handleCreateDB",environment:t,canUndo:!d,perform:e=>{var o;$l().zv({store:u,data:{name:a?ls().to[a]:void 0,query2:void 0,type:a??"table",..."chart"!==a&&{format:void 0}},transaction:e});const{createdCollectionId:r,recordPointerMap:l}=g({environment:t,collectionViewStore:u,collectionViewBlockStore:p,name:n,transaction:e,targetCollectionRecordPointerMap:s})??{},d=null===(o=p.getCollectionStores())||void 0===o?void 0:o.find((e=>e.id===r));i.setContext({type:"collectionView",collectionViewBlockStore:p,collectionStore:d,collectionViewStore:u,pageVisitSourceOverride:void 0}),c([d,l])}})}({environment:d,baseViewType:h,collectionName:i,collectionContextStore:r,collectionViewBlockStore:n,collectionViewStore:t,createdCollectionRecordPointerMap:I,setCreatedCollection:T,isInLayoutBuilder:u})}),[r,b,d,h,I,T,u]);(0,n.useEffect)((()=>{if("initializing"===V){if(a)return T([a,I]),void F("initialized");"singleSource"===y?F("initialized_source"):"linked"===y||r.isEditableHomeCollectionStore.state?F("initialized_linked"):(D(),F("initialized"))}}),[h,r,g,D,a,I,P,V,y,T]);const E=Dg({phase:V,baseViewType:h,onComplete:D,input:k,originalTitle:b,existingCollectionStore:w}),O=(0,s().K8)((()=>i.state.hideSettingsHeader),[i]),K=(0,n.useCallback)((e=>{Xg({collectionContextStore:r,environment:d,collectionStore:e,collectionSettingsStore:i,createdCollectionStore:w,userAction:"CollectionSettingsCreateViewSource.handleSourcePickerAccept",analytics:c})}),[r,i,w,d,c]);return(0,z.jsx)(C().A,{...e,title:t.formatMessage(lm.newDatabase),handleClose:()=>{R().os({collectionSettingsStore:i})},children:g?(0,z.jsx)(im,{collectionContextStore:r,collectionSettingsStore:i,parentStore:g,existingCollectionStore:w,createdCollectionRecordPointerMap:I,input:k,setInput:M,newButtonMenuItem:E,handleAcceptExistingCollection:K,context:ha.Source,hideSearchTitle:O,analytics:c}):void 0})}const lm=(0,v().YK)({newDatabase:{defaultMessage:"New database",id:"database.viewSettings.collectionSettingsCreateViewSource.newDatabase"}});var am=()=>o(920198);var sm=()=>o(58488),cm=()=>o(173215),dm=()=>o(729368),um=()=>o(366437);function pm({formBlockStore:e,disabled:t}){const o=(0,s().K8)((()=>e.getIsFormPublic()),[e]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(gm,{formBlockStore:e,disabled:t}),(0,z.jsx)(mm,{formBlockStore:e,disabled:t}),(0,z.jsxs)(x().A,{topBorder:!0,children:[o?void 0:(0,z.jsx)(ym,{formBlockStore:e,disabled:t}),(0,z.jsx)(fm,{formBlockStore:e,disabled:t})]})]})}function gm({formBlockStore:e,disabled:t}){const o=(0,s().K8)((()=>e.getFormConfigStore().getKeyStore("custom_confirmation_screen_title")),[e]);return(0,z.jsx)(x().A,{title:(0,z.jsx)(v().sA,{id:"formCustomizeSettings.customizeConfirmationScreen.title",defaultMessage:"Confirmation title"}),style:{paddingBottom:8},children:(0,z.jsx)(Sm,{formBlockStore:e,disabled:t,textStore:o,settingName:"custom_confirmation_screen_title"})})}function mm({formBlockStore:e,disabled:t}){const o=(0,s().K8)((()=>e.getFormConfigStore().getKeyStore("custom_confirmation_screen_body")),[e]);return(0,z.jsx)(x().A,{title:(0,z.jsx)(v().sA,{id:"formCustomizeSettings.customizeConfirmationScreen.body",defaultMessage:"Confirmation body"}),style:{paddingBottom:12},children:(0,z.jsx)(Sm,{formBlockStore:e,disabled:t,textStore:o,textarea:!0,settingName:"custom_confirmation_screen_body"})})}function Sm({formBlockStore:e,disabled:t,textStore:o,textarea:i,settingName:r}){const a=(0,l().v3)(),c=(0,h().IS)((()=>({input:{fontSize:14,lineHeight:"20px",borderRadius:6,boxShadow:O().Tj.inputBoxShadow,background:O().Tj.inputBackground,cursor:"text",padding:"3px 6px",margin:"0 8px",width:"auto",overflow:"hidden",height:i?68:28,textWrap:i?"wrap":"nowrap",opacity:t?.4:1}})),[i,t]),d=(0,s().K8)((()=>e.getSpaceId()),[e]),u=(0,Ro().sg)((0,n.useCallback)((()=>{(0,y().u)({environment:a,event:{eventName:"form_settings_changed",eventProperties:{form_id:e.id,form_setting:r}}})}),[e.id,a,r]),1e3),p=(0,cm().x)({textStore:o,parentStore:e,spaceId:d,disabled:!0});return t?(0,z.jsx)("div",{style:c.input,children:p}):(0,z.jsx)(dm().A,{disabled:t,store:o,pasteBehavior:"inline",inPageFind:um().Os.none,style:c.input,disabledMentionTypes:{page:!1,date:!1,user:!0,createPage:!0,inviteUserToWorkspace:!0,inviteUserToPage:!0,reminder:!0,bot:!0,heading:!0,group:!0,templateVariable:!0,property:!0},disableSlashCommands:!0,disableEmbedMenu:!0,disableMobileActionBar:!0,disableComment:!0,disableEnter:!0,disableHorizontalEdgeScroll:!0,disableEquationInteraction:!0,disableFilters:!0,disableRightMarginHoverStyling:!0,disableSuggestEdit:!0,disableShiftEnter:!0,onChange:u,onTab:Ro().D_,onUntab:Ro().D_})}function ym({formBlockStore:e,disabled:t}){const o=(0,l().v3)(),i=(0,n.useRef)(yt().JW()),{allowViewResponseStore:r,allowViewResponse:a}=(0,s().K8)((()=>{const t=e.getFormConfigStore().getKeyStore("allow_view_response");return{allowViewResponseStore:t,allowViewResponse:(null==t?void 0:t.getValue())??!0}}),[e]),c=(0,n.useCallback)((()=>{r&&(A().createAndCommit({userAction:"formSettings.setFormConfig.allowViewResponse",environment:o,canUndo:!0,perform:e=>{$l().KY({store:r,value:!a,transaction:e})}}),(0,y().u)({environment:o,event:{eventName:"form_settings_changed",eventProperties:{form_setting:"allow_view_response",form_id:e.id}}}))}),[o,r,a,e.id]);return(0,z.jsx)(Ye().m,{renderTooltip:()=>(0,z.jsx)(v().sA,{id:"formCustomizeConfirmationScreenSettings.allowViewResponse.tooltip",defaultMessage:"Show or hide the button that lets respondents view their submission after submitting."}),placement:"left",alignment:"center",textWrap:!0,render:e=>(0,z.jsx)("div",{...e,children:(0,z.jsx)(id().A,{title:(0,z.jsx)(v().sA,{id:"formCustomizeConfirmationScreenSettings.allowViewResponse.label",defaultMessage:"View my response button"}),showChevron:!1,switcherProps:{inputId:i.current,on:a,noColor:!1},onClick:c,disabled:t,textWrapperStyle:{minWidth:"auto"}})})})}function fm({formBlockStore:e,disabled:t}){const o=(0,l().v3)(),i=(0,n.useRef)(yt().JW()),{allowEmailResponseStore:r,allowEmailResponse:a}=(0,s().K8)((()=>{const t=e.getFormConfigStore().getKeyStore("allow_email_response");return{allowEmailResponseStore:t,allowEmailResponse:(null==t?void 0:t.getValue())??!0}}),[e]),c=(0,n.useCallback)((()=>{r&&(A().createAndCommit({userAction:"formSettings.setFormConfig.allowEmailResponse",environment:o,canUndo:!0,perform:e=>{$l().KY({store:r,value:!a,transaction:e})}}),(0,y().u)({environment:o,event:{eventName:"form_settings_changed",eventProperties:{form_setting:"allow_email_response",form_id:e.id}}}))}),[o,r,a,e.id]);return(0,z.jsx)(Ye().m,{renderTooltip:()=>(0,z.jsx)(v().sA,{id:"formCustomizeConfirmationScreenSettings.allowEmailResponse.tooltip",defaultMessage:"Show or hide the button that lets respondents email themselves a copy of their submission."}),placement:"left",alignment:"center",textWrap:!0,render:e=>(0,z.jsx)("div",{...e,children:(0,z.jsx)(id().A,{title:(0,z.jsx)(v().sA,{id:"formCustomizeConfirmationScreenSettings.allowEmailResponse.label",defaultMessage:"Email me a copy button"}),showChevron:!1,switcherProps:{inputId:i.current,on:a,noColor:!1},onClick:c,disabled:t,textWrapperStyle:{minWidth:"auto"}})})})}var hm=()=>o(717895),xm=()=>o(594952),vm=()=>o(435644),bm=()=>o(769314);const Cm=30,jm=(0,v().YK)({submitButtonTextPlaceholder:{id:"formCustomizeSettings.customizeSubmitButton.text.placeholder",defaultMessage:"Submit"}});function wm({formBlockStore:e,disabled:t}){return(0,z.jsxs)(x().A,{title:(0,z.jsx)(v().sA,{id:"formCustomizeSettings.customizeSubmitButton.title",defaultMessage:"Submit button"}),children:[(0,z.jsx)(Am,{formBlockStore:e,disabled:t}),(0,z.jsx)(Im,{formBlockStore:e,disabled:t})]})}function Am({formBlockStore:e,disabled:t}){const o=(0,l().Y0)(),{customSubmitButtonColorStore:i,currentColor:r}=(0,s().K8)((()=>{const t=e.getFormConfigStore().getKeyStore("custom_submit_button_color");return{customSubmitButtonColorStore:t,currentColor:(null==t?void 0:t.getValue())??"gray"}}),[e]),a=(0,z.jsx)(v().sA,{...Vo().jd[r]}),c=(0,n.useCallback)((({environment:t,color:o})=>{i&&(A().createAndCommit({userAction:"formSettings.setFormConfig.customSubmitButtonColor",environment:t,canUndo:!0,perform:e=>{$l().KY({store:i,value:o,transaction:e})}}),(0,y().u)({environment:t,event:{eventName:"form_settings_changed",eventProperties:{form_setting:"custom_submit_button_color",form_id:e.id}}}))}),[i,e.id]),d=(0,h().eP)(),u=(0,h().IS)((()=>({colorLabelWrapper:{display:"flex",alignItems:"center",gap:2},selectedCircle:{stroke:Vo().l8[d][r],fill:Vo().l8[d][r]},colorLabel:{fontSize:14,lineHeight:"18px"}})),[r,d]);return(0,z.jsx)(_().A,{popupType:o.isPhone?fo().n.SlideUp:fo().n.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",disabled:t,originGap:0,renderOrigin:e=>(0,z.jsx)(so().A,{...e,title:(0,z.jsx)(v().sA,{id:"formCustomizeSettings.customizeSubmitButton.color",defaultMessage:"Color"}),disabled:t,icon:xm().I,right:(0,z.jsxs)("div",{style:u.colorLabelWrapper,children:[(0,z.jsx)(H().I,{icon:hm().K,size:"lg",style:u.selectedCircle}),(0,z.jsx)("div",{style:u.colorLabel,children:a})]}),showChevron:!0}),render:e=>(0,z.jsx)(bm().A,{parent:e,currentColor:r,onColorSelected:c}),style:{padding:"5px 0"}})}function Im({formBlockStore:e,disabled:t}){const o=(0,l().v3)(),i=(0,v().tz)(),{customSubmitButtonTextStore:r,currentText:a}=(0,s().K8)((()=>{const t=e.getFormConfigStore().getKeyStore("custom_submit_button_text");return{customSubmitButtonTextStore:t,currentText:(null==t?void 0:t.getValue())??""}}),[e]),c=(0,n.useCallback)((t=>{r&&(A().createAndCommit({userAction:"formSettings.setFormConfig.customSubmitButtonText",environment:o,canUndo:!0,perform:e=>{$l().KY({store:r,value:t,transaction:e})}}),(0,y().u)({environment:o,event:{eventName:"form_settings_changed",eventProperties:{form_setting:"custom_submit_button_text",form_id:e.id}}}))}),[r,o,e.id]),d=(0,Ro().sg)(c,500);return(0,z.jsx)(re().Ay,{title:(0,z.jsx)(v().sA,{id:"formCustomizeSettings.customizeSubmitButton.text",defaultMessage:"Text"}),icon:(0,z.jsx)(H().I,{icon:vm().a,style:{marginInlineStart:4}}),right:(0,z.jsx)(Ng().B,{disabled:t,initialValue:a,placeholder:i.formatMessage(jm.submitButtonTextPlaceholder),onBlur:c,onSubmit:c,onChange:d,inputOuterStyle:{margin:0,width:160},maxLength:Cm,textWrapperStyle:{margin:0}}),style:{paddingTop:2,paddingInlineEnd:0,paddingBottom:2,paddingInlineStart:4,lineHeight:"28px"},disabled:t})}function _m(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,n=function(){const e=(0,l().v3)(),t=(0,am().L)(),o=e.currentUser.id,n=null==t?void 0:t.id;return(0,Fn()._)({name:"form_customization",spaceId:n,userId:o})}(),i="unavailable"===(null==n?void 0:n.type)&&(0,td().wy)(n.upsell),r=Boolean(i),a=(0,s().K8)((()=>t.collectionViewStore()),[t]),c=(0,s().K8)((()=>{if(!a)throw new Error("No CollectionViewStore found");return a.getFormBlockStore()}),[a]),d=(0,s().K8)((()=>null==c?void 0:c.getSpaceStore()),[c]);return a&&c?(0,z.jsx)(sm().I,{children:(0,z.jsx)(C().A,{collectionSettingsStore:o,title:(0,z.jsx)(v().sA,{id:"formCustomizeSettings.menuTitle",defaultMessage:"Submit screen"}),menuScrollerStyle:f().A.isMobile?void 0:{maxHeight:600},children:(0,z.jsxs)("div",{style:{padding:"0 4px 4px"},children:[i?(0,z.jsx)("div",{style:{margin:"8px 14px"},children:(0,z.jsx)(od().UpgradeButton,{display:"button",source:"forms_customize_settings",upsell:n.upsell,featureName:"form_customization",spaceStore:d})}):null,(0,z.jsx)(wm,{formBlockStore:c,disabled:r}),(0,z.jsx)(pm,{formBlockStore:c,disabled:r})]})})}):null}var Tm=()=>o(430896),km=()=>o(882722),Mm=()=>o(31503),Pm=()=>o(894995),Bm=()=>o(348241),Vm=()=>o(425940),Fm=()=>o(467248);const Dm={text:Fm().i,select:Vm().a,title:Fm().i,multi_select:Vm().a,relation:Pp().arrowDiagonalUpRightIcon,date:ri().D,person:o(835607).F,file:o(609616).o,number:o(965134).i,checkbox:yn().i,email:o(537193).b,url:o(742852).linkIcon,phone_number:o(686832).phoneIcon,place:o(727577).T},Em=o(299733).questionMarkCircleFillIcon;function Om(e){const{propertyType:t}=e;return(0,s().K8)((()=>(0,z.jsx)(H().I,{icon:(0,Mm().XO)(t)?Dm[t]:Em,colorVariant:"secondary"})),[t])}var Rm=()=>o(98205),Km=()=>o(630960),Nm=()=>o(465741),zm=()=>o(300789),Lm=()=>o(978846),Um=()=>o(63667),Wm=()=>o(478573);function Hm(e){const{questionStore:t,name:o}=e,{collectionStore:n}=(0,Xc().LH)(),i=(0,s().K8)((()=>{const e=t.getPropertyId();if(!n||!e)return;const o=n.getSchema();return(0,we()._g)({schema:o,property:e})}),[n,t]);if(!i)return null;const r=i.type;return(0,z.jsx)(Wm().A,{...e,icon:(0,z.jsx)(Om,{propertyType:i.type}),name:o,subText:ls().dC[r],disabled:!1})}var $m=()=>o(959733);function Gm(e){const{area:t,moduleId:o,parentModuleId:n,parentConditionalGroupId:i,collectionContextStore:r}=e,l=(0,v().tz)(),{layoutStore:a}=(0,Xc().LH)(),c=(0,s().K8)((()=>r.collectionStore()),[r]);return(0,s().K8)((()=>c?(null==a?void 0:a.getNormalizedFormQuestionStoresForFormLayout({collectionSchema:c.getSchema()}))??[]:[]),[a,c]).length>=Nm().eb?(0,z.jsx)(C().A,{...e,title:l.formatMessage(Nm().Gi.questionLimitReachedTitle),children:(0,z.jsx)("div",{style:{padding:16,paddingTop:2,fontSize:12},children:l.formatMessage(Nm().Gi.questionLimitReachedSubtitle)})}):(0,z.jsx)(C().A,{...e,title:(0,z.jsx)(v().sA,{id:"formQuestionCreateSettings.menuTitle",defaultMessage:"Select type"}),menuScrollerStyle:f().A.isMobile?void 0:{maxHeight:600},children:(0,z.jsx)(qm,{area:t,moduleId:o,parentModuleId:n,parentConditionalGroupId:i,collectionContextStore:r})})}const Qm=(0,v().YK)({showMore:{defaultMessage:"Show {numAdditionalProperties} more",id:"formQuestionCreateSettings.showMore"}});function qm(e){const t=(0,v().tz)(),{area:o,moduleId:i,parentModuleId:r,parentConditionalGroupId:a,collectionContextStore:c}=e,[d,u]=(0,n.useState)(!1),p=function(e){const{area:t,collectionContextStore:o,moduleId:n,parentModuleId:i,parentConditionalGroupId:r}=e,a=(0,l().v3)(),{layoutStore:c,collectionStore:d}=(0,Xc().LH)(),u=(0,s().K8)((()=>{var e;return Boolean(null===(e=o.collectionViewStore())||void 0===e||null===(e=e.getFormBlockStore())||void 0===e?void 0:e.hasSitePublicPermission())}),[o]),p=Ym({area:t,moduleId:n,parentModuleId:i,parentConditionalGroupId:r,collectionContextStore:o}),g=(0,Km().in)({layoutStore:c,collectionStore:d});return(0,s().K8)((()=>{if(!d)return[];const e=d.getSchema(),t=g.map((t=>{const o=(0,we()._g)({schema:e,property:t});if(!o)return;const n=(0,Nm().CK)({environment:a,propertyType:o.type,propertySchema:o,isPublicForm:u});let i=null;return"invalid_property_type_for_public_form"===n?i=(0,z.jsx)(v().sA,{...Km().yh.unsupportedPublicQuestionType}):"related_collection_not_public"===n&&(i=(0,z.jsx)(v().sA,{...Km().yh.relatedCollectionNotPublic})),{key:t,keywords:[o.name],render:({ref:e,...o})=>(0,z.jsx)("div",{style:{width:"100%"},children:(0,z.jsx)(Um().k,{...o,propertyId:t,tooltip:i,disabled:Boolean(n)})}),action:()=>{p({type:"existingProperty",propertyId:t})}}})).filter(b().O9);return t}),[d,g,a,u,p])}({area:o,collectionContextStore:c,moduleId:i,parentModuleId:r,parentConditionalGroupId:a}),g=function(e){const{area:t,moduleId:o,parentModuleId:n,parentConditionalGroupId:i,collectionContextStore:r}=e,a=(0,l().v3)(),c=(0,s().K8)((()=>{var e;return Boolean(null===(e=r.collectionViewStore())||void 0===e||null===(e=e.getFormBlockStore())||void 0===e?void 0:e.hasSitePublicPermission())}),[r]),d=Ym({area:t,moduleId:o,parentModuleId:n,parentConditionalGroupId:i,collectionContextStore:r}),u=(0,$m().g)({actionHandler:e=>d({type:"newProperty",propertyType:(0,ae().v2)(e)}),renderIcon:e=>(0,z.jsx)(Om,{propertyType:(0,ae().v2)(e)}),tooltip:e=>{if("invalid_property_type_for_public_form"===(0,Nm().CK)({environment:a,propertyType:(0,ae().v2)(e),isPublicForm:c}))return{image:void 0,caption:Km().yh.unsupportedPublicQuestionType}},disabled:e=>{const t=(0,Nm().CK)({environment:a,propertyType:(0,ae().v2)(e),isPublicForm:c});return Boolean(t)}}),p=(0,U().X)("place_property");return(0,s().K8)((()=>Mm().m3.filter((e=>"select"!==e&&!("place"===e&&!p))).map((e=>{if("relation"!==e&&(0,Mm().XO)(e))return"title"!==e?u(e):void 0})).filter(b().O9)),[u,p])}({area:o,moduleId:i,parentModuleId:r,parentConditionalGroupId:a,collectionContextStore:c}),m=function(e,t,o){const i=(0,v().tz)(),r=(0,l().v3)(),{layoutStore:a,collectionStore:c,setModuleSelection:d,sessionId:u}=(0,Xc().LH)(),p=(0,s().K8)((()=>a.getModules()),[a]),g=(0,s().K8)((()=>[...p.form_layout_schema,...Object.values(p.form_conditional_modules??{})].filter((e=>"formQuestion"===e.type))),[p]),m=(0,s().K8)((()=>(0,Mm().Cg)({moduleId:o??e,modulesByArea:p})),[p,e,o]),S=o?m.length-1:m.length,y=(0,n.useCallback)((e=>{const o=e.parentConditionalGroupId===t,n=m.includes(e.id),i=(0,Rm().Yg)({currentModule:e,nestedModules:p.form_conditional_modules||{},includePlaceholders:!0}).maxDepth+S>Mm().mh;return!o&&!n&&!i}),[t,m,p,S]),f=(0,n.useCallback)((o=>{void 0!==t&&void 0!==e&&(A().createAndCommit({userAction:"FormQuestionCreateSettings.moveExistingQuestion",canUndo:!0,environment:r,perform:n=>{(0,Lm().E)({position:{type:"absolute",area:"form_conditional_modules",parentConditionalGroupId:t,parentModuleId:e},moduleId:o.id,environment:r,layoutStore:a,transaction:n,sessionId:u})}}),d({type:"existing_module",moduleId:o.id,isDragging:!1}))}),[r,t,e,a,d,u]);return(0,s().K8)((()=>{if(!c)return[];const e=g.filter(y).map((e=>{const t=Tm().c.createChildStore(a,{table:"form_question",id:e.formQuestionId,spaceId:a.getSpaceId()??""});if(void 0===t)return;const o=(0,uc().r4)({textValue:t.getNameStore().getValue(),getRecordModel:t.getRecordModel,deterministic:!0,userTimeZone:(0,qd().P)(),intl:i});return{key:t.id,keywords:[o],render:({ref:e,...n})=>(0,z.jsx)("div",{style:{width:"100%"},children:(0,z.jsx)(Hm,{...n,name:o,questionStore:t})}),action:()=>{f(e)}}})).filter(b().O9);return e}),[c,g,y,a,i,f])}(r,a,i),S=(0,h().IS)((()=>({showMoreButton:{height:42,color:O().Tj.text.tertiary,marginInlineStart:0}})),[]),y=function(e){const{key:o,title:n,items:i,limit:r}=e,l={key:"show-more",keywords:[],action:()=>{},render:e=>(0,z.jsx)($().A,{...e,id:km().v4C,icon:(0,z.jsx)(H().I,{icon:Dl().ellipsisIcon,colorVariant:"tertiary"}),title:t.formatMessage(Qm.showMore,{numAdditionalProperties:r?i.length-r:i.length}),desktopIconStyle:{marginInlineStart:7,marginInlineEnd:5},style:S.showMoreButton,onClick:e=>{u(!0),e.stopPropagation()}})},a=void 0!==r&&i.length>r,s=[...a?i.slice(0,r):i,...a?[l]:[]];return{key:o,render:e=>(0,z.jsx)(x().A,{title:n,...e,style:{display:"flex",flexDirection:"column",alignItems:"center",paddingInlineStart:"8px",paddingInlineEnd:"8px",paddingTop:"new-properties"===o&&p.length>0?8:0,paddingBottom:0},desktopTitleStyle:{alignSelf:"flex-start",paddingInlineStart:"8px"}}),items:s}},f=d?void 0:5,C=y({key:"existing-properties",title:(0,z.jsx)(v().sA,{id:"formQuestionCreateSettings.existingPropertiesSectionTitle",defaultMessage:"Existing properties"}),items:p,limit:f}),j=y({key:"new-properties",title:p.length>0||m.length>0?(0,z.jsx)(v().sA,{id:"formQuestionCreateSettings.newPropertiesSectionTitle",defaultMessage:"New question"}):void 0,items:g}),w=y({key:"existing-questions",title:m.length>0?(0,z.jsx)(v().sA,{id:"formQuestionCreateSettings.existingQuestionsSectionTitle",defaultMessage:"Existing questions"}):void 0,items:m});return(0,z.jsx)(x().A,{children:(0,z.jsx)(le().A,{initialFocus:0,type:le().O.Vertical,sections:[...m.length>0&&void 0!==r&&void 0!==a?[w]:[],...p.length>0?[C]:[],...g.length>0?[j]:[]]})})}function Ym(e){const{area:t,moduleId:o,parentModuleId:i,parentConditionalGroupId:r,collectionContextStore:a}=e,c=(0,l().v3)(),{layoutStore:d,collectionStore:u,setModuleSelection:p,sessionId:g}=(0,Xc().LH)(),{autofocusedQuestionTextStore:m,formAddConditionalLogicTooltipStore:S}=(0,Bm().cJ)(),y=(0,s().O$)(ze().AppStoreCurrentUserSettingsStore);return(0,n.useCallback)((e=>{A().createAndCommit({userAction:"FormQuestionCreateSettings.createFormQuestion",environment:c,canUndo:!0,undoCheckpoint:`form_layout_new_question_${o}`,perform:n=>{if(!u)throw new Error("Collection store not found");const l=(()=>{if("existingProperty"===e.type)return e.propertyId;const t=e.propertyType;return(0,Nd().createProperty)({environment:c,collectionStore:u,collectionViewArgs:void 0,propertyName:ls().dC[t],propertyType:t,transaction:n})})(),s=(()=>{if("existingProperty"===e.type){const e=u.getSchema()[l];return null==e?void 0:e.type}return e.propertyType})();if(!("form_conditional_modules"!==t||i&&r))throw new Error("Parent module ID and parent conditional group ID are required for nested modules");const{updatedModuleId:f,formQuestionId:h}=(0,Pm().createFormQuestionAndUpdateOrCreateModule)({environment:c,transaction:n,layoutStore:d,moduleId:o,propertyId:l,initialQuestionTitle:(()=>{if("existingProperty"===e.type){const e=u.getSchema()[l];return e?e.name:""}{const t=e.propertyType;if((0,Mm().XO)(t)&&"select"!==t)return Nm().mY[t]}})()??"",shouldSyncQuestionNameToPropertyName:"newProperty"===e.type,collectionContextStore:a,autofocusTitle:{shouldAutofocus:!0,autofocusedQuestionTextStore:m},sessionId:g,..."form_conditional_modules"===t&&i&&r?{area:t,parentModuleId:i,parentConditionalGroupId:r}:{area:"form_layout_schema"}});p({type:"existing_module",moduleId:f,isDragging:!1});const x=null==y?void 0:y.getSettingsStore().getKeyStore("seen_forms_add_conditional_logic_tooltip").getValue();"checkbox"!==s||x||S.setState({openTooltip:(0,Rm().fY)({formQuestionId:h})})}}),zm().HH(c,Rm().wG)}),[c,g,u,d,o,a,m,t,i,r,p,S,y])}const Xm=function(e){return(0,z.jsx)(sm().I,{children:(0,z.jsx)(Gm,{...e})})};var Jm=()=>o(792485),Zm=()=>o(876338),eS=()=>o(665589),tS=()=>o(419178),oS=()=>o(566534),nS=()=>o(655923),iS=()=>o(112282),rS=()=>o(638045);const lS={viewBox:"0 0 20 20",fittedViewBox:"3.9 3.07 12.2 13.86",svg:(0,z.jsx)("path",{d:"M10 3.075c.345 0 .625.28.625.625v5.217l4.518-2.608a.625.625 0 1 1 .625 1.082L11.25 10l4.518 2.609a.625.625 0 0 1-.625 1.082l-4.518-2.609V16.3a.625.625 0 0 1-1.25 0v-5.218l-4.518 2.61a.625.625 0 1 1-.625-1.083l4.518-2.61-4.518-2.608a.625.625 0 1 1 .625-1.082l4.518 2.608V3.7c0-.345.28-.625.625-.625"})},aS=(0,D().wt)("asterisk",lS,"default");var sS=()=>o(222080),cS=()=>o(765974),dS=()=>o(594088);const uS={viewBox:"0 0 20 20",fittedViewBox:"2.49 2.5 15.01 15.01",svg:(0,z.jsx)("path",{d:"M2.5 5a2.5 2.5 0 1 1 3.125 2.421V12.5c0 1.036.84 1.875 1.875 1.875h5.079a2.501 2.501 0 1 1 0 1.25h-5.08A3.125 3.125 0 0 1 4.376 12.5V7.421A2.5 2.5 0 0 1 2.5 5M5 3.75a1.25 1.25 0 1 0 0 2.5 1.25 1.25 0 0 0 0-2.5M13.75 15a1.25 1.25 0 1 0 2.5 0 1.25 1.25 0 0 0-2.5 0"})},pS=(0,D().wt)("nodeTopLeftBottomRight",uS,"default");var gS=()=>o(813197),mS=()=>o(688311),SS=()=>o(500993),yS=()=>o(475140),fS=()=>o(251822),hS=()=>o(901952),xS=()=>o(832857),vS=()=>o(802975),bS=()=>o(37165);function CS(e){const{environment:t,module:o,collectionStore:n,formQuestionStore:i,transaction:r,position:l,layoutStore:a,autofocusTitle:s,duplicateModuleMapping:c,questionModulePropertyUpdateMap:d,propertyIdMapping:u,sessionId:p,collectionContextStore:g}=e;if("formQuestion"===o.type){const e=null==i?void 0:i.getConfig(),m=d.get(o.id);if(!m)return;(0,at().F)({environment:t,collectionStore:n,update:{[m.newProperty]:m.newPropertySchema},transaction:r}),(0,Pm().createModuleForNewlyDuplicatedProperty)({type:o.type,environment:t,module:o,layoutStore:a,collectionStore:n,propertyId:m.newProperty,position:l,collectionContextStore:g,autofocusTitle:s,shouldLogEvent:!1,existingFormQuestionConfig:e,duplicateModuleMapping:c,sessionId:p,transaction:r,propertyIdMapping:u})}else(0,Pm().createModuleForNewlyDuplicatedProperty)({type:o.type,environment:t,module:o,layoutStore:a,collectionContextStore:g,shouldLogEvent:!1,position:l,duplicateModuleMapping:c,sessionId:p,transaction:r})}function jS(e){const{environment:t,questionStore:o,autofocusedQuestionTextStore:n,currValue:i}=e;A().createAndCommit({userAction:"formQuestion.toggleShowDescription",environment:t,canUndo:!0,perform:e=>{const t=!i;A().applyOperation({store:o,operation:{pointer:o.pointer,path:["config","showDescription"],command:"set",args:t},transaction:e}),t||function(e){var t;const{questionStore:o,autofocusedQuestionTextStore:n,transaction:i}=e;void 0===(null===(t=o.getConfig())||void 0===t?void 0:t.description)&&A().applyOperation({store:o,operation:{pointer:o.pointer,path:["config","description"],command:"set",args:(0,pi().x9d)("")},transaction:i});n.autofocusQuestionDescription({questionId:o.id})}({questionStore:o,autofocusedQuestionTextStore:n,transaction:e})}})}var wS=()=>o(536308),AS=()=>o(266405),IS=()=>o(907808),_S=()=>o(142110);function TS({children:e}){return(0,z.jsx)(Ye().m,{renderTooltip:()=>(0,z.jsx)(v().sA,{id:"FormSettingsNameSyncTooltip.tooltip",defaultMessage:"Renaming a question also renames its linked database property. Disable to keep names separate."}),placement:"left",alignment:"center",textWrap:!0,render:t=>(0,z.jsx)("div",{...t,children:e})})}function kS({tooltipState:e,disableTooltip:t,children:o}){const i=(0,n.useMemo)((()=>{if(!e)return null;switch(e){case"deleted_property":return(0,z.jsx)(v().sA,{id:"FormSettingsComingSoonTooltip.deletedProperty",defaultMessage:"The linked property has been deleted."});case"invalid_property_type":return(0,z.jsx)(v().sA,{id:"FormSettingsComingSoonTooltip.invalidProperty",defaultMessage:"The linked property is an unsupported type."});case"invalid_property_type_for_public_form":return(0,z.jsx)(v().sA,{...Km().yh.unsupportedPublicQuestionType});case"related_collection_not_public":return(0,z.jsx)(v().sA,{...Km().yh.relatedCollectionNotPublic});case"generic_error":return(0,z.jsx)(v().sA,{id:"FormSettingsErrorTooltip.genericError",defaultMessage:"There is an issue with this linked property."});default:(0,b().HB)(e)}}),[e]);return(0,z.jsx)(Ye().m,{renderTooltip:()=>i,disableTooltip:t,placement:"left",render:e=>(0,z.jsx)("div",{...e,children:o})})}function MS(e){const{collectionContextStore:t,collectionSettingsStore:o,formQuestionId:n,moduleId:i}=e,r=(0,l().v3)(),{collectionViewStore:a,formBlockStore:c}=(0,s().K8)((()=>{var e;return{collectionViewStore:t.collectionViewStore(),formBlockStore:null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormBlockStore()}}),[t]),d=(0,s().K8)((()=>{if(!a)throw new Error("no collectionViewStore found");const e=a.getSpaceId();if(!e)throw new Error("no spaceId found");return Tm().c.createChildStore(a,{table:"form_question",id:n,spaceId:e})}),[a,n]),u=(0,s().K8)((()=>{var e;return null===(e=d.getConfig())||void 0===e?void 0:e.propertyId}),[d]),p=(0,s().K8)((()=>{if(!u)return;return t.normalizedSchemaStore.state[u]}),[t.normalizedSchemaStore,u]),g=(0,s().K8)((()=>{const e=t.normalizedSchemaStore.state;return d?(0,AS().e)(r,d,e,null==c?void 0:c.hasSitePublicPermission()):"generic_error"}),[t.normalizedSchemaStore,r,c,d]),m=(0,s().K8)((()=>{if(p)return p.type}),[p]);return u?(0,z.jsx)(sm().I,{children:(0,z.jsxs)(C().A,{...e,title:(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.menuTitle",defaultMessage:"Question options"}),children:[(0,z.jsxs)(x().A,{children:[(0,z.jsx)(VS,{collectionContextStore:t,formQuestionStore:d}),(0,z.jsx)(LS,{collectionContextStore:t,formQuestionStore:d}),(0,z.jsx)(BS,{collectionContextStore:t,propertySchema:p,formQuestionStore:d})]}),(0,z.jsxs)(x().A,{topBorder:!0,children:[(0,z.jsx)(PS,{collectionSettingsStore:o,collectionContextStore:t,formQuestionStore:d,propertyId:u,propertyType:m,questionErrorState:g}),(0,z.jsx)(NS,{collectionSettingsStore:o,collectionContextStore:t,formQuestionStore:d,questionErrorState:g}),(0,z.jsx)(FS,{collectionContextStore:t,formQuestionStore:d})]}),(0,z.jsxs)(x().A,{topBorder:!0,children:[(0,z.jsx)($S,{collectionSettingsStore:o,moduleId:i}),(0,z.jsx)(WS,{moduleId:i,propertyId:u,propertySchema:p}),(0,z.jsx)(HS,{moduleId:i}),(0,z.jsx)(QS,{collectionSettingsStore:o,collectionContextStore:t,moduleId:i,propertyId:u,propertySchema:p,formQuestionStore:d}),(0,z.jsx)(zS,{collectionSettingsStore:o,collectionContextStore:t,moduleId:i,formQuestionStore:d})]})]})}):null}function PS({collectionSettingsStore:e,collectionContextStore:t,formQuestionStore:o,propertyId:i,propertyType:r,questionErrorState:a}){const c=(0,l().v3)(),{layoutStore:d}=(0,Xc().LH)(),{isCollectionEmpty:u}=(0,Bm().cJ)(),{collectionStore:p,collectionSchema:g,collectionViewStore:m,formatKey:S}=(0,s().K8)((()=>({collectionStore:t.collectionStore(),collectionSchema:t.normalizedSchemaStore.state,collectionViewStore:t.collectionViewStore(),formatKey:t.getPropertyFormatKey()})),[t]),y=(0,s().K8)((()=>r&&(0,Mm().XO)(r)?"select"===r?"multi_select":r:"not_found"),[r]),f=a?cS().exclamationMarkTriangleFillIcon:sS().s,x=(0,h().eP)(),b=(0,h().IS)((()=>({iconContainer:{background:"light"===x?O().Tj.white:O().Tj.palette.translucentGray[100],borderWidth:1,borderStyle:"solid",borderColor:"light"===x?O().Tj.palette.gray[100]:O().Tj.palette.translucentGray[300],minWidth:32,width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,overflow:"hidden"}})),[x]),C=(0,Km().in)({layoutStore:d,collectionStore:p}),j=(0,U().X)("place_property"),w=Mm().m3.filter((e=>"place"!==e||j)),I=(0,s().K8)((()=>{const e=[];return w.forEach((t=>{"select"!==t&&e.push({key:t,type:"button",title:Nm().mY[t],hideOption:"title"===t&&!C.includes(ae().rn)||"relation"===t,icon:(0,z.jsx)("div",{style:b.iconContainer,children:(0,z.jsx)(Om,{propertyType:t})})})})),e.push({key:"not_found",type:"button",hideOption:!0,title:(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.questionType.propertyNotFound",defaultMessage:"Not Found"})}),e}),[w,C,b.iconContainer]),_=(0,s().K8)((()=>null==p?void 0:p.getDatabaseType()),[p]),T=(0,n.useCallback)((e=>{(0,hS().V)({environment:c,collectionContextStore:t,property:i,new_property_type:e,from:"form_editor",action:"change_type"}),A().createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyTypeAccept",environment:c,canUndo:!0,perform:n=>{if(p)if(r!==ae().rn)e===ae().rn?($l().KY({store:o.getConfigStore().getKeyStore("propertyId"),value:ae().rn,transaction:n}),u&&((0,st().B)({environment:c,collectionStore:p,schema:g,property:i,transaction:n}),n.postSubmitCallbacks.push((e=>{e||wS().formEditorActions.maybeSyncQuestionNameToPropertyName({environment:c,questionStore:o,collectionStore:p,collectionContextStore:t})})))):(0,IS().H)({environment:c,collectionStore:p,property:i,type:e,transaction:n});else{const t=(0,Nd().createProperty)({environment:c,collectionStore:p,propertyType:e,transaction:n,collectionViewArgs:m&&S?{collectionViewStore:m,format:m.getFormat(),formatKey:S}:void 0});$l().KY({store:o.getConfigStore().getKeyStore("propertyId"),value:t,transaction:n})}}})}),[c,p,r,m,S,o,u,g,i,t]),k=(0,n.useCallback)((e=>{if("not_found"===e||!p)return;const o=g[i];_S().g({environment:c,collectionContextStore:t,propertyId:i,propertySchema:o,handlePropertyTypeChange:()=>T(e)})}),[c,t,i,p,g,T]);return p?(0,z.jsx)(kS,{tooltipState:a,disableTooltip:void 0===a,children:(0,z.jsx)(oo().A,{icon:f,options:I,disabled:"not_found"===y||void 0!==_,title:(0,z.jsx)(v().sA,{defaultMessage:"Question type",id:"formQuestionEditSettings.questionType.menuTitle"}),selectedKey:y,menuItemOptionsStyle:{paddingTop:4,paddingBottom:4},onChange:k})}):null}function BS(e){const{propertySchema:t,formQuestionStore:o,collectionContextStore:n}=e,i=(0,s().K8)((()=>{const e=null==t?void 0:t.type;if(e&&!(0,Mm().XO)(e)||!e)return null;switch(e){case"title":case"text":return(0,z.jsx)(KS,{formQuestionStore:o,propertyType:e,collectionContextStore:n});case"select":return(0,z.jsx)(US,{formQuestionStore:o,collectionContextStore:n,propertySchema:t});case"multi_select":return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(US,{formQuestionStore:o,collectionContextStore:n,propertySchema:t}),(0,z.jsx)(RS,{formQuestionStore:o,propertySchema:t,collectionContextStore:n})]});case"relation":case"person":return(0,z.jsx)(RS,{formQuestionStore:o,propertySchema:t,collectionContextStore:n});case"date":return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(DS,{formQuestionStore:o,collectionContextStore:n}),(0,z.jsx)(ES,{formQuestionStore:o,collectionContextStore:n})]});case"file":case"number":case"checkbox":case"email":case"url":case"phone_number":case"place":return(0,z.jsx)(z.Fragment,{});default:(0,b().HB)(e)}}),[n,o,t]);return(0,z.jsx)(z.Fragment,{children:i})}function VS({collectionContextStore:e,formQuestionStore:t}){const o=(0,s().K8)((()=>t.isRequired()),[t]),i=(0,l().v3)(),r=(0,n.useCallback)((()=>{!function(e){const{questionStore:t,environment:o,currValue:n}=e;A().createAndCommit({userAction:"formQuestion.toggleRequired",environment:o,canUndo:!0,perform:e=>{A().applyOperation({store:t,operation:{pointer:t.pointer,path:["config","required"],command:"set",args:!n},transaction:e})}})}({environment:i,questionStore:t,currValue:t.isRequired()})}),[i,t]),a=qS({collectionContextStore:e,formQuestionStore:t});return(0,z.jsx)(id().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Required",id:"formQuestionEditSettings.isRequired.title"}),switcherProps:{on:o},icon:aS,onClick:r,disabled:a})}function FS({collectionContextStore:e,formQuestionStore:t}){const o=(0,s().K8)((()=>t.shouldSyncQuestionNameToPropertyName()),[t]),i=(0,l().v3)(),r=(0,n.useCallback)((()=>{!function(e){const{questionStore:t,environment:o,currValue:n}=e;A().createAndCommit({userAction:"formQuestion.toggleShouldSyncQuestionNameToPropertyName",environment:o,canUndo:!0,perform:e=>{A().applyOperation({store:t,operation:{pointer:t.pointer,path:["config","shouldSyncQuestionNameToPropertyName"],command:"set",args:!n},transaction:e})}})}({environment:i,questionStore:t,currValue:t.shouldSyncQuestionNameToPropertyName()})}),[i,t]),a=qS({collectionContextStore:e,formQuestionStore:t});return(0,z.jsx)(TS,{children:(0,z.jsx)(id().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Sync with property name",id:"formQuestionEditSettings.shouldSyncQuestionNameToPropertyName.title"}),switcherProps:{on:o},icon:mS().h,onClick:r,disabled:a})})}function DS({collectionContextStore:e,formQuestionStore:t}){const o=(0,l().v3)(),i=(0,s().K8)((()=>{var e;return(null===(e=t.getPropertyTypeSpecificConfig("date"))||void 0===e?void 0:e.endDate)??!1}),[t]),r=(0,n.useCallback)((()=>{!function(e){const{questionStore:t,environment:o,currValue:n}=e;A().createAndCommit({userAction:"formQuestion.changeEndDateSetting",environment:o,canUndo:!0,perform:e=>{A().applyOperation({store:t,operation:{pointer:t.pointer,path:["config","propertyTypeSpecificConfig","date","endDate"],command:"set",args:!n},transaction:e})}})}({environment:o,questionStore:t,currValue:i})}),[i,o,t]),a=qS({collectionContextStore:e,formQuestionStore:t});return(0,z.jsx)(id().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"End date",id:"formQuestionEditSettings.date.endDate.title"}),switcherProps:{on:i},icon:ri().D,onClick:r,disabled:a})}function ES({collectionContextStore:e,formQuestionStore:t}){const o=(0,l().v3)(),i=(0,s().K8)((()=>{var e;return(null===(e=t.getPropertyTypeSpecificConfig("date"))||void 0===e?void 0:e.includeTime)??!1}),[t]),r=(0,n.useCallback)((()=>{!function(e){const{questionStore:t,environment:o,currValue:n}=e;A().createAndCommit({userAction:"formQuestion.changeIncludeTimeSetting",environment:o,canUndo:!0,perform:e=>{A().applyOperation({store:t,operation:{pointer:t.pointer,path:["config","propertyTypeSpecificConfig","date","includeTime"],command:"set",args:!n},transaction:e})}})}({environment:o,questionStore:t,currValue:i})}),[i,o,t]),a=qS({collectionContextStore:e,formQuestionStore:t});return(0,z.jsx)(id().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Include time",id:"formQuestionEditSettings.date.includeTime.title"}),switcherProps:{on:i},icon:Jn().clockIcon,onClick:r,disabled:a})}const OS=Km().Jz.map((e=>e.key));function RS({collectionContextStore:e,formQuestionStore:t,propertySchema:o}){const i=(0,l().v3)(),r=(0,v().tz)(),{selectedKey:a,maxSelection:c}=(0,s().K8)((()=>{const e=(0,Mm().hm)(o,t.getModel()),n=null==e?void 0:e.toString();let i="custom";return void 0===e?i="unlimited":n&&OS.includes(n)&&(i=n),{selectedKey:i,maxSelection:e}}),[t,o]),[d,u]=(0,n.useState)("custom"===a?null==c?void 0:c.toString():""),p=(0,n.useCallback)(((e,n,r)=>{let l;switch(e){case"unlimited":l=void 0;break;case"custom":if(!r)return;l=parseInt(r,10);break;default:l=parseInt(e,10)}void 0!==l&&(isNaN(l)||!Number.isInteger(l)||l<1||l>1e3)?u(""):A().createAndCommit({environment:i,userAction:"MaxSelectionComponent.handleUpdateSelection",canUndo:!0,perform:e=>{$l().KY({store:t.getKeyStore("config").getKeyStore("propertyTypeSpecificConfig").getKeyStore(o.type).getKeyStore("maxSelectionCount"),value:l,transaction:e})}})}),[i,t,o.type,u]);function g(e){const t=/[^0-9]/g;t.test(e)&&yo().D6({label:(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.maxSelection.nonNumberWarning",defaultMessage:"Please enter a number."})});const o=e.replace(t,"");u(o)}const m=(0,n.useMemo)((()=>{const e={key:"custom",type:"input",inputValue:d,onSubmit:p,onChange:g};return[...Km().Jz,e]}),[p,d]),S=qS({collectionContextStore:e,formQuestionStore:t});return(0,z.jsx)(Ye().m,{textWrap:!0,alignment:"center",placement:"left",disableTooltip:!((0,we().bu)(o)&&o.limit),renderTooltip:()=>{if((0,we().bu)(o)&&void 0!==o.limit)return(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.maxSelection.error.tooltip",defaultMessage:"A limit of 1 has been set on the linked property. Please remove the limit on the linked property in order to configure this questionâ€™s max selection."})},render:e=>(0,z.jsx)(oo().A,{...e,title:(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.maxSelection.title",defaultMessage:"Max selection"}),icon:gS().L,selectedKey:a,options:m,onChange:p,disabled:S||(0,we().bu)(o)&&void 0!==o.limit,inputPlaceholder:r.formatMessage({id:"formQuestionEditSettings.maxSelection.inputPlaceholder",defaultMessage:"Custom"})})})}function KS({collectionContextStore:e,formQuestionStore:t,propertyType:o}){const i=(0,s().K8)((()=>{var e;return(null===(e=t.getPropertyTypeSpecificConfig(o))||void 0===e?void 0:e.longAnswer)??!1}),[t,o]),r=(0,l().v3)(),a=(0,n.useCallback)((()=>{!function(e){const{questionStore:t,environment:o,currValue:n,propertyType:i}=e;A().createAndCommit({userAction:"formQuestion.changeName",environment:o,canUndo:!0,perform:e=>{A().applyOperation({store:t,operation:{pointer:t.pointer,path:["config","propertyTypeSpecificConfig",i,"longAnswer"],command:"set",args:!n},transaction:e})}})}({environment:r,questionStore:t,currValue:i,propertyType:o})}),[i,r,t,o]),c=qS({collectionContextStore:e,formQuestionStore:t});return(0,z.jsx)(id().A,{title:(0,z.jsx)(v().sA,{defaultMessage:"Long answer",id:"formQuestionEditSettings.longAnswer.title"}),switcherProps:{on:i},icon:eS().l,onClick:a,disabled:c})}function NS({collectionContextStore:e,collectionSettingsStore:t,formQuestionStore:o,questionErrorState:n}){const i=(0,h().DP)(),r=(0,l().v3)(),a=(0,s().K8)((()=>{var e;return null===(e=o.getConfig())||void 0===e?void 0:e.propertyId}),[o]),c=(0,s().K8)((()=>{if(!a)return;const t=e.normalizedSchemaStore.state[a];return t?t.name:void 0}),[e.normalizedSchemaStore,a]),{layoutStore:d,collectionStore:u}=(0,Xc().LH)(),p=(0,Km().in)({layoutStore:d,collectionStore:u}),g=(0,s().K8)((()=>{const t=[];return p.forEach((o=>{const n=e.normalizedSchemaStore.state[o];n&&(0,Mm().Sg)(n)&&t.push({key:o,type:"button",title:n.name,icon:(0,z.jsx)(Je().zB,{type:n.type,theme:i,icon:void 0,size:D().Ev.sm,style:{fill:i.icon.primary}})})})),t.push({key:"not_found",type:"button",hideOption:!0,title:(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.linkedProperty.propertyNotFound",defaultMessage:"Not Found"})}),t}),[i,e.normalizedSchemaStore,p]);return(c||n)&&a?"deleted_property"===n?(0,z.jsx)(oo().A,{disabled:g.every((e=>!0===e.hideOption)),icon:Zn().c,title:(0,z.jsx)(v().sA,{defaultMessage:"Linked property",id:"formQuestionEditSettings.linkedProperty.title"}),selectedKey:"not_found",onChange:e=>wS().formEditorActions.remapQuestionToNewProperty({environment:r,formQuestionStore:o,newPropertyId:e}),options:g}):(0,z.jsx)(so().A,{icon:Zn().c,title:(0,z.jsx)(v().sA,{defaultMessage:"View linked property",id:"formQuestionEditSettings.viewLinkedProperty.title"}),showChevron:!0,onClick:()=>{R().a2({collectionSettingsStore:t,item:{type:"property",formatKey:void 0,property:a}})}}):null}function zS({collectionContextStore:e,collectionSettingsStore:t,moduleId:o,formQuestionStore:i}){const{layoutStore:r,sessionId:a}=(0,Xc().LH)(),{isCollectionEmpty:c}=(0,Bm().cJ)(),d=(0,l().v3)(),u=(0,s().K8)((()=>(0,yS().Ib)({modulesByArea:r.getModules(),find:e=>o===e.id})),[r,o]),p=(0,n.useCallback)((()=>{void 0!==u&&A().createAndCommit({userAction:"formActions.deleteFormQuestion",environment:d,canUndo:!0,perform:o=>{(0,vS().B)({environment:d,module:u.module,sessionId:a,layoutStore:r,transaction:o,collectionSettingsStore:t,isCollectionEmpty:c,collectionContextStore:e,area:u.area,updateParentModule:!0})}})}),[e,t,d,c,r,a,u]);return(0,z.jsx)(so().A,{icon:Q().trashIcon,title:(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.deleteQuestion.title",defaultMessage:"Delete question"}),onClick:p})}function LS({formQuestionStore:e,collectionContextStore:t}){const o=(0,l().v3)(),{autofocusedQuestionTextStore:i}=(0,Bm().cJ)(),r=(0,s().K8)((()=>{var t;return Boolean(null===(t=e.getConfig())||void 0===t?void 0:t.showDescription)}),[e]),a=(0,n.useCallback)((()=>{jS({environment:o,questionStore:e,autofocusedQuestionTextStore:i,currValue:r})}),[i,o,e,r]),c=qS({collectionContextStore:t,formQuestionStore:e});return(0,z.jsx)(id().A,{icon:Fm().i,title:(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.addDescription.title",defaultMessage:"Description"}),onClick:a,disabled:c,switcherProps:{on:r}})}function US({collectionContextStore:e,formQuestionStore:t,propertySchema:o}){const i=(0,l().v3)(),r=null==o?void 0:o.type,a=(0,s().K8)((()=>(0,Nm().KU)({formQuestionStore:t,propertySchema:o})),[t,o]),c=(0,n.useCallback)((o=>{r&&A().createAndCommit({environment:i,userAction:"DisplayModeComponent.handleUpdateDisplayMode",canUndo:!0,perform:n=>{var l;$l().KY({store:t.getKeyStore("config").getKeyStore("propertyTypeSpecificConfig").getKeyStore(r).getKeyStore("displayMode"),value:o,transaction:n});const a=t.getParentStore();a&&(0,y().u)({environment:i,event:{eventName:"form_question_display_mode_changed",eventProperties:{...(0,Nm().YA)({collectionContextStore:e,propertyId:(null===(l=t.getConfig())||void 0===l?void 0:l.propertyId)??"",questionId:t.id,area:"form_layout_schema",layoutStore:a}),new_display_mode:o}}})}})}),[i,t,r,e]),d=(0,n.useMemo)((()=>[{key:"list",type:"button",title:(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.displayMode.list",defaultMessage:"List view"})},{key:"dropdown",type:"button",title:(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.displayMode.dropdown",defaultMessage:"Dropdown"})}]),[]),u=qS({collectionContextStore:e,formQuestionStore:t});return(0,U().X)("forms_select_question_display_mode_setting")?(0,z.jsx)(oo().A,{icon:dS().A,title:(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.displayMode.title",defaultMessage:"Show options as"}),selectedKey:a??"list",options:d,onChange:c,disabled:u}):null}function WS({moduleId:e,propertyId:t,propertySchema:o}){const i=(0,l().v3)(),r=(0,Tg().T)(),a=(0,Jm().S)(),c=(0,s().K8)((()=>{var e;return null==a||null===(e=a.spaceStore)||void 0===e?void 0:e.id}),[a]),{layoutStore:d,sessionId:u,setModuleSelection:p}=(0,Xc().LH)(),g=(0,Fn()._)({name:"forms_conditional_logic",spaceId:c,userId:r}),m=null==g?void 0:g.upsell,S=(0,td().wy)(m)&&"unavailable"===(null==g?void 0:g.type),y=(0,s().K8)((()=>{if(o)return"checkbox"===o.type||"select"===o.type||"multi_select"===o.type?o.type:void 0}),[o]),f=(0,s().K8)((()=>(0,Mm().Cg)({moduleId:e,modulesByArea:d.getModules()}).length>=Mm().mh),[d,e]),h=y&&!f,x=(0,s().K8)((()=>(0,SS().A)(e,d.getModules())),[d,e]),b=(0,n.useCallback)((()=>{"unavailable"!==(null==g?void 0:g.type)||"product"!==(null==m?void 0:m.type)?y&&"available"===(null==g?void 0:g.type)&&xS().lF({environment:i,layoutStore:d,currentQuestionModule:x.module,area:x.area,property:t,filterValue:{type:y,value:void 0},setModuleSelection:p,sessionId:u}):kn().K(i,{upsell:m,from:"forms_conditional_logic",spaceStore:(0,Zm().$)(a)})}),[null==g?void 0:g.type,m,y,i,d,x.module,x.area,t,p,a,u]),C=n.useRef(null);if(!h)return null;const j=(0,Zm().$)(a);return S?(0,z.jsx)(nd().c,{showTooltip:!0,tooltipProps:{placement:"right",showIcon:!1},upsell:m,source:"forms_conditional_logic",spaceStore:j,children:({handleClick:e})=>(0,z.jsx)("div",{ref:C,children:(0,z.jsx)(so().A,{icon:pS,title:(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.addConditionalLogic.title",defaultMessage:"Add conditional logic"}),right:(0,z.jsx)(od().UpgradeButton,{display:"icon",upsell:m,source:"forms_conditional_logic",hoverRef:C,spaceStore:j}),onClick:e})})}):(0,z.jsx)(so().A,{icon:pS,title:(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.addConditionalLogic.title",defaultMessage:"Add conditional logic"}),onClick:b})}function HS({moduleId:e}){const t=(0,l().v3)(),{layoutStore:o,sessionId:i}=(0,Xc().LH)(),r=(0,s().K8)((()=>{var t;if(o)return null===(t=o.getModules().form_conditional_modules)||void 0===t?void 0:t[e]}),[o,e]),a=(0,n.useCallback)((()=>{r&&"formQuestion"===r.type&&xS().Ix({environment:t,layoutStore:o,formQuestionModule:r,sessionId:i})}),[t,o,r,i]);return r?(0,z.jsx)(so().A,{icon:oS().U,title:(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.removeFromConditionalGroup.title",defaultMessage:"Remove from conditional group"}),onClick:a}):null}function $S({collectionSettingsStore:e,moduleId:t}){const o=(0,s().uB)(void 0,X().A),{layoutStore:n}=(0,Xc().LH)(),i=(0,s().K8)((()=>(0,yS().Ib)({modulesByArea:n.getModules(),find:e=>e.id===t})),[n,t]),{currentModuleIndex:r,numChildrenInGroup:l}=(0,s().K8)((()=>(0,yS().y1)({modulesByArea:n.getModules(),moduleId:t})),[n,t]),{numHeaderModules:a,numFooterModules:c}=(0,s().K8)((()=>{if("form_layout_schema"===(null==i?void 0:i.area)){const e=n.getModules(),t=(0,fS().jS)(i.area,e[i.area]),o=t.nonMoveableHeaderModules,r=t.nonMoveableFooterModules,l="moveableFooterModules"in t?t.moveableFooterModules:[];return{numHeaderModules:o.length,numFooterModules:l.length+r.length}}return{numHeaderModules:0,numFooterModules:0}}),[null==i?void 0:i.area,n]);return void 0===i||void 0===r||void 0===l||l-a-c==1?null:(0,z.jsx)(Xs().A,{focused:!1,popupType:_().z.Popup,alignmentToOrigin:"center",placementToOrigin:"right",buttonPopupStore:o,renderOrigin:e=>(0,z.jsx)(so().A,{...e,showChevron:!0,title:(0,z.jsx)(v().sA,{defaultMessage:"Move question",id:"formQuestionEditSettings.moveQuestion.title"}),icon:rS().t,disabled:!1}),render:t=>(0,z.jsx)(GS,{collectionSettingsStore:e,parent:t,currentModuleAndArea:i,currentModuleIndex:r,numChildrenInGroup:l,numHeaderModules:a,numFooterModules:c})})}function GS(e){const{collectionSettingsStore:t,parent:o,currentModuleIndex:i,currentModuleAndArea:r,numChildrenInGroup:a,numHeaderModules:s,numFooterModules:c}=e,d=(0,l().v3)(),{layoutStore:u,sessionId:p}=(0,Xc().LH)(),{isFirstInGroup:g,isLastInGroup:m}=(0,n.useMemo)((()=>({isFirstInGroup:0===i-s,isLastInGroup:i===a-c-1})),[i,a,s,c]),S=(0,n.useMemo)((()=>{if("form_conditional_modules"===r.area){const e=r.module.parentConditionalGroupId,t=r.module.parentModuleId;if(!e||!t)return;return{type:"absolute",area:"form_conditional_modules",parentConditionalGroupId:e,parentModuleId:t,index:0}}return{type:"absolute",area:"form_layout_schema",index:s}}),[r,s]);if(!S)return null;const y=[],f={key:"default",items:[{key:"moveUp",render:(e,t)=>g?null:(0,z.jsx)(so().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Move up",id:"formQuestionEditSettings.rearrangeQuestion.moveUp"}),icon:iS().arrowStraightUpIcon,disabled:!1}),action:()=>{(0,Lm().E)({environment:d,layoutStore:u,position:{...S,index:i-1},moduleId:r.module.id,sessionId:p}),o.close(),R().os({collectionSettingsStore:t})}},{key:"moveDown",render:(e,t)=>m?null:(0,z.jsx)(so().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Move down",id:"formQuestionEditSettings.rearrangeQuestion.moveDown"}),icon:nS().arrowStraightDownIcon,disabled:!1}),action:()=>{(0,Lm().E)({environment:d,layoutStore:u,position:{...S,index:i+1},moduleId:r.module.id,sessionId:p}),o.close(),R().os({collectionSettingsStore:t})}},{key:"moveToTop",render:(e,t)=>g?null:(0,z.jsx)(so().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Move to top of group",id:"formQuestionEditSettings.rearrangeQuestion.moveToTop"}),icon:tS().Q,disabled:!1}),action:()=>{(0,Lm().E)({environment:d,layoutStore:u,position:S,moduleId:r.module.id,sessionId:p}),o.close(),R().os({collectionSettingsStore:t})}},{key:"moveToBottom",render:(e,t)=>m?null:(0,z.jsx)(so().A,{...e,title:(0,z.jsx)(v().sA,{defaultMessage:"Move to bottom of group",id:"formQuestionEditSettings.rearrangeQuestion.moveToBottom"}),icon:pg().arrowLineDownIcon,disabled:!1}),action:()=>{(0,Lm().E)({environment:d,layoutStore:u,position:{...S,index:a-c-1},moduleId:r.module.id,sessionId:p}),o.close(),R().os({collectionSettingsStore:t})}}],render:e=>(0,z.jsx)(x().A,{...e})};y.push(f);const h={menuType:T().gu.Popup,width:280,maxHeight:400};return(0,z.jsx)(B().A,{...h,children:(0,z.jsx)(le().A,{initialFocus:void 0,type:le().O.Vertical,sections:y,resetFocusOnMouseOut:!0})})}function QS({collectionContextStore:e,moduleId:t,propertyId:o,formQuestionStore:i,propertySchema:r}){const a=(0,l().v3)(),c=(0,v().tz)(),{layoutStore:d,sessionId:u,setModuleSelection:p}=(0,Xc().LH)(),{collectionStore:g,autofocusedQuestionTextStore:m}=(0,Bm().cJ)(),S=(0,s().K8)((()=>d.getSpaceId()),[d]),y=(0,s().K8)((()=>{var e;return g?(null===(e=d.getNormalizedFormQuestionStoresForFormLayout({collectionSchema:g.getSchema()}))||void 0===e?void 0:e.length)??0:0}),[d,g]),f=(0,s().K8)((()=>{const e=d.getModules();return(0,SS().A)(t,e)}),[t,d]),h=(0,n.useCallback)((async()=>{S&&(y>=Nm().eb?yo().D6({label:c.formatMessage(Nm().Gi.questionLimitReachedFullMessage)}):await async function({environment:e,module:t,sessionId:o,layoutStore:n,collectionStore:i,collectionContextStore:r,autofocusedQuestionTextStore:l,area:a,spaceId:s,setModuleSelection:c}){const d=n.getModules().form_conditional_modules??{},u=(0,Rm().Yg)({currentModule:t,nestedModules:d,includePlaceholders:!0}),p=new Map,g=new Map,m=new Map,S=i.getSchema(),{currentModuleIndex:y}=(0,yS().y1)({modulesByArea:n.getModules(),moduleId:t.id});for(const f of u.formQuestionDescendants){const t=(0,lt().Ay)();if(p.set(f.id,t),"formQuestion"!==f.type)continue;const o=Tm().c.createChildStore(n,{table:bS().lo,id:f.formQuestionId,spaceId:s}).getPropertyId();if(!o)continue;const r=await(0,ur().W4)({environment:e,schema:S,property:o,parentStore:i,propertyGroups:void 0,spaceId:s});r&&(g.set(f.id,r),m.set(o,r.newProperty))}A().createAndCommit({userAction:"CollectionSettingsProperty.handleDuplicateClick",environment:e,canUndo:!0,perform:d=>{for(const c of u.formQuestionDescendants){const u=c.id===t.id,S="formQuestion"===c.type?Tm().c.createChildStore(n,{table:bS().lo,id:c.formQuestionId,spaceId:s}):void 0,f={type:"module_relative",direction:"below",area:"form_layout_schema",relativeToModuleId:c.id},h=c.parentConditionalGroupId&&c.parentModuleId?{type:"absolute",area:"form_conditional_modules",parentConditionalGroupId:c.parentConditionalGroupId,parentModuleId:p.get(c.parentModuleId)??c.parentModuleId,index:u&&void 0!==y?y+1:void 0}:void 0,x=u&&"form_layout_schema"===a?f:h;if(!x)return;CS({environment:e,module:c,collectionStore:i,layoutStore:n,formQuestionStore:S,collectionContextStore:r,position:x,sessionId:o,autofocusTitle:u?{shouldAutofocus:!0,autofocusedQuestionTextStore:l}:void 0,duplicateModuleMapping:p,questionModulePropertyUpdateMap:g,propertyIdMapping:m,transaction:d})}const S=p.get(t.id);S&&c({type:"existing_module",moduleId:S,isDragging:!1})}})}({environment:a,module:f.module,sessionId:u,collectionStore:g,layoutStore:d,collectionContextStore:e,autofocusedQuestionTextStore:m,area:f.area,spaceId:S,setModuleSelection:p}))}),[m,e,g,f.area,f.module,y,a,c,d,u,S,p]);return r&&(0,ae().vB)(r)&&S?(0,z.jsx)(so().A,{icon:Es().V,title:(0,z.jsx)(v().sA,{id:"formQuestionEditSettings.duplicateQuestion.title",defaultMessage:"Duplicate question"}),onClick:h}):null}function qS({collectionContextStore:e,formQuestionStore:t}){const o=(0,l().v3)(),{collectionStore:n,formBlockStore:i}=(0,s().K8)((()=>{var t;return{collectionStore:e.collectionStore(),formBlockStore:null===(t=e.collectionViewStore())||void 0===t?void 0:t.getFormBlockStore()}}),[e]);return void 0!==(0,s().K8)((()=>{if(!n)return"generic_error";const e=n.getSchema();return e&&t?(0,AS().e)(o,t,e,null==i?void 0:i.hasSitePublicPermission()):"generic_error"}),[n,o,i,t])}var YS=()=>o(160632);function XS(e){const{collectionContextStore:t}=e,o=(0,U().X)("forms_apply_template"),n=(0,s().K8)((()=>t.collectionViewStore()),[t]),i=(0,s().K8)((()=>{if(!n)throw new Error("No CollectionViewStore found");return n.getFormBlockStore()}),[n]),r=(0,s().K8)((()=>t.collectionStore()),[t]);return o&&n&&i&&r?(0,z.jsx)(sm().I,{children:(0,z.jsx)(C().A,{collectionSettingsStore:e.collectionSettingsStore,title:(0,z.jsx)(v().sA,{id:"formSelectTemplateSettings.menuTitle",defaultMessage:"Select template"}),menuScrollerStyle:f().A.isMobile?void 0:{maxHeight:600},children:(0,z.jsx)("div",{style:{padding:"0 4px 4px"},children:(0,z.jsx)(JS,{collectionStore:r,formBlockStore:i})})})}):null}function JS(e){const{collectionStore:t,formBlockStore:o}=e,i=(0,l().v3)(),r=(0,s().K8)((()=>t.getTemplatePageStores()),[t]),a=(0,s().K8)((()=>t.getDefaultTemplatePageStore()),[t]),c=(0,s().K8)((()=>o.getFormSubmissionTemplate()),[o]),d=(0,n.useCallback)((e=>{(0,Pm().changeFormSubmissionTemplate)({environment:i,formBlockStore:o,template:e})}),[i,o]),u=r.map((e=>{const o={type:"page",pointer:e.pointer},i=ZS(c,a,o),r={key:e.id,render:o=>(0,n.createElement)(YS().K,{...o,key:e.id,isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:e,isMobile:!1,locked:!0,isChecked:i,onCancelClick:kd().lQ,draggable:!1}),action:()=>{d(o)}};return r})),p=ZS(c,a,{type:"empty"}),g={key:"empty",render:e=>(0,n.createElement)(YS().K,{...e,key:"empty",isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:void 0,isChecked:p,isMobile:!1,locked:!0,onCancelClick:kd().lQ,draggable:!1}),action:()=>{d({type:"empty"})}};return(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,z.jsx)(x().A,{...e,title:(0,z.jsx)(v().sA,{id:"formSelectTemplateSettings.menuHeader",defaultMessage:"Select template for form submissions"})}),items:[g,...u]}]})}function ZS(e,t,o){return e?!!(0,Ro().n4)(e,o):(void 0===t||"empty"===t.id)&&"empty"===o.type||!("page"!==o.type||!(0,Ro().n4)(null==t?void 0:t.pointer,o.pointer))}var ey=()=>o(899725);const ty={type:"newView"},oy=(0,v().YK)({link:{defaultMessage:"Link...",id:"database.viewSettings.searchCollections.link"},search:{defaultMessage:"Search...",id:"database.viewSettings.searchCollections.search"}});function ny({existingCollectionStore:e,analytics:t}){const o=(0,v().tz)(),r=(0,l().v3)(),[a,c]=(0,n.useState)(""),d=(0,hr().ET)(),[u,p]=(0,s().K8)((()=>[d.settingsStore,d.settingsStore.state.hideSettingsHeader]),[d]),g=(0,s().K8)((()=>{const e=d.collectionViewBlockStore();if(!e)throw new Error("collectionViewBlockStore is required");return e}),[d]),m=(0,s().uB)(void 0,Xl().$),S=(0,n.useCallback)((o=>{Xg({collectionContextStore:d,environment:r,collectionStore:o,collectionSettingsStore:u,createdCollectionStore:e,userAction:"LinkToDatabaseMenu.handleAcceptExistingSource",analytics:t})}),[d,u,e,r,t]),{suggestedSection:f,resultsSection:h,fetchMoreResults:j,searchSessionId:w,searchSessionFlowNumber:I}=ga({input:a,collectionContextStore:d,hideSearchTitle:p,parentStore:g,context:ha.Source,handleAcceptExistingCollection:S,suggestionConfig:ty,peopleBlocksToInclude:"none"}),_=(0,n.useRef)(0);(0,n.useEffect)((()=>{_.current=I}),[I]);const T=(0,s().K8)((()=>"on"===$e().default.getEligibleGroup({experimentId:"search_surfaces_collection_search",defaultGroup:"unassigned"})),[]);(0,n.useEffect)((()=>((0,y().u)({environment:r,event:{eventName:"source_collection_search_open",eventProperties:{search_session_id:w,using_secondary_search_surfaces_hook:T,source:"source"}}}),()=>{(0,y().u)({environment:r,event:{eventName:"source_collection_search_close",eventProperties:{search_session_id:w,source:"source",using_secondary_search_surfaces_hook:T,search_session_flow_number:_.current}}})})),[r,T,w]);const k=(0,s().K8)((()=>null!=d&&d.isInHomeWidgetStore.state?oy.search:oy.link),[d]),M=(0,n.useCallback)((()=>{var e;if(null!=d&&d.isDashboardWidget()&&null!=d&&d.getIsInDashboardBuildMode()&&(null==d||null===(e=d.collectionViewStore())||void 0===e||!e.getCollectionStore())){var t;const e=null==d||null===(t=d.collectionViewStore())||void 0===t?void 0:t.id;if(e)return A().createAndCommit({environment:r,userAction:"dashboard.deleteWidget.noSource",canUndo:!0,perform:t=>{(0,ey().T)({transaction:t,collectionContextStore:d,viewId:e})}}),!0}return!1}),[d,r]),P=(0,n.useCallback)((()=>{M(),R().os({collectionSettingsStore:u})}),[M,u]);return Zc(d,(()=>(M(),!1))),(0,z.jsx)(i().N,{debugName:"LinkToDatabaseMenu",capture:!0,onEsc:P,children:(0,z.jsxs)(C().A,{collectionSettingsStore:u,title:(0,z.jsx)(v().sA,{defaultMessage:"Link to existing data source",id:"database.viewSettings.createViewTab.linkToExistingDataSource"}),handleClose:P,children:[(0,z.jsx)(x().A,{shouldShowBottomDivider:!1,children:(0,z.jsx)(mt().Ay,{value:a,onChange:e=>{c(e.target.value),m.setState({focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})},focusInitial:!0,placeholder:o.formatMessage(k),showClearButton:!0})}),(0,z.jsx)(le().A,{type:le().O.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,sections:[f,h].filter(b().O9)}),T?(0,z.jsx)(Yl().A,{onChange:(e,t)=>{j&&e<Zl().A.incrementScrollOffset&&j()}}):null]})})}function iy(e){var t;const{collectionSettingsStore:o,collectionContextStore:d}=e,u=(0,l().v3)(),[p,m]=(0,n.useState)(),S=(0,s().K8)((()=>(0,Cl().S)(o)),[o]),y=(0,s().K8)((()=>d.getViewType()),[d]),f=(0,s().K8)((()=>d.allowScrollingWhenCollectionSettingsSidebarOpen()),[d]),h=(0,s().K8)((()=>o.state.closeOnEscape),[o]);(0,a().A)({capture:!f,preventType:c().A.Y});const x=(0,s().K8)((()=>{if("property"===(null==S?void 0:S.type))return(0,bo().Jq)({collectionContextStore:d,property:S.property})}),[d,S]),{dashboardMode:v,dashboardViewId:b}=(0,s().K8)((()=>{const e=d.dashboardWidgetStore.state;return e?{dashboardMode:d.getIsInDashboardBuildMode()?"build":"view",dashboardViewId:e.dashboardViewStore.id}:{dashboardMode:void 0,dashboardViewId:void 0}}),[d]);(0,n.useEffect)((()=>{if(S&&p!==S)if("propertyType"===S.type){var e,t,o,n;g(u,{view_type:y,menu:S.type,is_database_name_empty:!Boolean(null==d||null===(e=d.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString()),collection_id:null===(t=d.collectionStore())||void 0===t?void 0:t.id,collection_view_id:null===(o=d.collectionViewStore())||void 0===o?void 0:o.id,collection_view_block_id:null===(n=d.collectionViewBlockStore())||void 0===n?void 0:n.id,database_visit_id:d.visitSessionId,..."button"===(null==x?void 0:x.type)&&{builder_type:"modal"},dashboard_mode:v,dashboard_view_id:b})}else{var i,r,l;const e=(0,bo().u7)(S);g(u,{view_type:y,menu:S.type,collection_id:null===(i=d.collectionStore())||void 0===i?void 0:i.id,collection_view_id:null===(r=d.collectionViewStore())||void 0===r?void 0:r.id,collection_view_block_id:null===(l=d.collectionViewBlockStore())||void 0===l?void 0:l.id,database_visit_id:d.visitSessionId,builder_type:"modal",data_source_from:null==e?void 0:e.dataSourceFrom,data_source_session_id:null==e?void 0:e.dataSourceSessionId,dashboard_mode:v,dashboard_view_id:b})}m(S)}),[d,S,v,b,u,p,null==x?void 0:x.type,y]);const C=(0,n.useCallback)((e=>{!1!==h&&(0,r().SQ)(e,r().y$.Click,(()=>{R().os({collectionSettingsStore:o})}))}),[h,o]),j=function(e){return{main:t=>(0,z.jsx)(ry,{tab:t,...e}),source:()=>(0,z.jsx)(of,{...e}),createViewSource:t=>(0,z.jsx)(Xy,{tab:t,...e}),addNewDataSource:t=>(0,z.jsx)(Yy,{tab:t,...e}),createSyncedViewSource:t=>(0,z.jsx)(ay,{tab:t,...e}),selectAccountForExternalSource:t=>(0,z.jsx)(sy,{tab:t,...e}),shareSyncedView:t=>(0,z.jsx)(cy,{tab:t,...e}),propertyType:t=>(0,z.jsx)(dy,{tab:t,...e}),propertyAiAutofill:t=>(0,z.jsx)(py,{tab:t,...e}),createView:t=>(0,z.jsx)(uy,{tab:t,...e}),propertyAgentAutofill:t=>(0,z.jsx)(gy,{tab:t,...e}),duplicateExistingView:()=>(0,z.jsx)(ds,{...e}),properties:t=>(0,z.jsx)(my,{tab:t,...e}),propertyVisibility:t=>(0,z.jsx)(Sy,{tab:t,...e}),compactCardSettings:t=>(0,z.jsx)(yy,{tab:t,...e}),property:t=>(0,z.jsx)(fy,{tab:t,...e}),deletedProperties:t=>(0,z.jsx)(hy,{tab:t,...e}),selectRelationSource:t=>(0,z.jsx)(xy,{tab:t,...e}),setupRelation:t=>(0,z.jsx)(vy,{tab:t,...e}),selectViewsModuleSource:t=>(0,z.jsx)(by,{tab:t,...e}),setupViewsModule:t=>(0,z.jsx)(Cy,{tab:t,...e}),layout:()=>(0,z.jsx)(_p,{...e}),group:t=>(0,z.jsx)(jy,{tab:t,...e}),groupByProperty:t=>(0,z.jsx)(wy,{tab:t,...e}),subitem:t=>(0,z.jsx)(Iy,{tab:t,...e}),arrowsBy:t=>(0,z.jsx)(Ty,{tab:t,...e}),githubConfig:t=>(0,z.jsx)(Py,{tab:t,...e}),filters:()=>(0,z.jsx)(op,{...e}),phoneFilterAndSort:()=>(0,z.jsx)(kp,{...e}),groupByNumber:t=>(0,z.jsx)(Ay,{tab:t,...e}),filter:t=>(0,z.jsx)(By,{tab:t,...e}),createFilter:()=>(0,z.jsx)(_u,{...e}),createSort:()=>(0,z.jsx)(Bu,{...e}),sort:()=>(0,z.jsx)(Up,{...e}),follow:()=>(0,z.jsx)(mp,{...e}),page:()=>(0,z.jsx)(ly,{...e}),editProperties:t=>(0,z.jsx)(Vy,{tab:t,...e}),editScimProperties:t=>(0,z.jsx)(Fy,{tab:t,...e}),automationSettings:t=>(0,z.jsx)(Dy,{tab:t,...e}),mobileCreateAutomation:t=>(0,z.jsx)(Ry,{tab:t,...e}),mobileEditAutomation:t=>(0,z.jsx)(Ky,{tab:t,...e}),mobileEditButtonAutomation:t=>(0,z.jsx)(Ny,{tab:t,...e}),externalProjectsSyncSettings:t=>(0,z.jsx)(Ey,{tab:t,...e}),connectedRelationDatabaseActions:t=>(0,z.jsx)(Oy,{tab:t,...e}),dependencies:t=>(0,z.jsx)(ky,{tab:t,...e}),relationFeaturesAdvancedSettings:t=>(0,z.jsx)(My,{tab:t,...e}),subitemV2:t=>(0,z.jsx)(_y,{tab:t,...e}),sprintSettings:t=>(0,z.jsx)(zy,{tab:t,...e}),confirmAddTemplate:t=>(0,z.jsx)($y,{tab:t,...e}),views:t=>(0,z.jsx)(Gy,{tab:t,...e}),linked_collections:t=>(0,z.jsx)(Qy,{tab:t,...e}),connectionFeatures:t=>(0,z.jsx)(qy,{tab:t,...e}),formQuestionEditSettings:t=>(0,z.jsx)(Ly,{tab:t,...e}),formQuestionCreateSettings:t=>(0,z.jsx)(Uy,{tab:t,...e}),formCustomizeSettings:t=>(0,z.jsx)(Wy,{tab:t,...e}),formSelectTemplate:t=>(0,z.jsx)(Hy,{tab:t,...e}),linkToDatabase:t=>(0,z.jsx)(Jy,{tab:t,...e}),databaseSettings:t=>(0,z.jsx)(Zy,{tab:t,...e}),databaseProperties:t=>(0,z.jsx)(ef,{tab:t,...e}),manageDataSources:t=>(0,z.jsx)(tf,{tab:t,...e}),conditionalColors:()=>(0,z.jsx)(Fe,{...e}),createConditionalColor:()=>(0,z.jsx)(De,{...e})}}(e),w=S?null===(t=j[S.type])||void 0===t?void 0:t.call(j,S):null;return w?(0,z.jsx)(i().N,{debugName:"CollectionSettings",capture:!0,onEsc:C,children:w}):null}function ry(e){const{collectionContextStore:t,tab:o}=e,n=(0,s().K8)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.id}),[t]),i=(0,s().K8)((()=>t.collectionViewStore()),[t]);return"main"===o.type&&i?(0,z.jsx)(Tp().gt,{selectViewNameInitial:o.selectViewNameInitial,collectionViewStore:i,...e},n):null}function ly(e){const{collectionContextStore:t}=e,o=(0,l().v3)(),n=(0,s().K8)((()=>t.collectionViewStore()),[t]);return n?(0,z.jsx)(C().A,{...e,title:"Select page to display",children:(0,z.jsx)("div",{style:{margin:12},children:(0,z.jsx)(d().A,{showClearButton:!0,placeholder:"Enter page ID",focusInitial:!0,onChange:e=>{Yi.setState({pageId:e.target.value})},onSubmit:()=>{const e=Yi.state.pageId;if(!e)return null;A().createAndCommit({userAction:"collectionSettings.pageView.selectPage",environment:o,canUndo:!0,perform:t=>{m().zA({stores:[n],update:{page_pointer:{id:(0,u().G2)(e),spaceId:t.spaceId,table:"block"}},transaction:t})}})}})})}):null}function ay(e){const{tab:t}=e;return"createSyncedViewSource"!==t.type?null:(0,z.jsx)(_l().a,{...e,...t})}function sy(e){const{tab:t}=e;return"selectAccountForExternalSource"!==t.type?null:(0,z.jsx)(wl,{...e,...t})}function cy(e){const{tab:t}=e;return"shareSyncedView"!==t.type?null:(0,z.jsx)(lu,{...e,...t})}function dy(e){const{tab:t}=e;return"propertyType"!==t.type?null:(0,z.jsx)(Ed,{...e,...t})}function uy(e){const{tab:t}=e;return"createView"!==t.type?null:(0,z.jsx)(Wg,{...e,...t})}function py(e){const{tab:t}=e;return"propertyAiAutofill"!==t.type?null:(0,z.jsx)(Id,{...e,...t})}function gy(e){const{tab:t}=e;return"propertyAgentAutofill"!==t.type?null:(0,z.jsx)(Rc,{...e,...t})}function my(e){const{tab:t}=e;return"properties"!==t.type?null:(0,z.jsx)(Mp().A,{...e,propertiesMenuType:"editPropertiesAndOrderAndVisibility",timelineViewTab:t.timelineViewTab})}function Sy(e){const{tab:t}=e;return"propertyVisibility"!==t.type?null:(0,z.jsx)(Mp().A,{...e,propertiesMenuType:"editVisibilityAndOrder",timelineViewTab:t.timelineViewTab})}function yy(e){const{tab:t}=e;return"compactCardSettings"!==t.type?null:(0,z.jsx)(Mp().A,{...e,propertiesMenuType:"editOrderAndWidth",timelineViewTab:t.timelineViewTab})}function fy(e){const{tab:t}=e;return"property"!==t.type?null:(0,z.jsx)(Pc().t_,{...e,...t,titleOverride:e.collectionSettingsPropertyTitleOverride},t.property)}function hy(e){const{tab:t}=e;return"deletedProperties"!==t.type?null:(0,z.jsx)(Za,{...t,...e})}function xy(e){const{tab:t}=e;return"selectRelationSource"!==t.type?null:(0,z.jsx)(Od,{...e,...t})}function vy(e){const{tab:t}=e;return"setupRelation"!==t.type?null:(0,z.jsx)(Qd,{...e,...t})}function by(e){const{tab:t}=e;return"selectViewsModuleSource"!==t.type?null:(0,z.jsx)(Rd,{...e,...t})}function Cy(e){const{tab:t}=e;return"setupViewsModule"!==t.type?null:(0,z.jsx)(Zd,{...e,...t})}function jy(e){const{tab:t}=e;return"group"!==t.type?null:(0,z.jsx)(Sp().oz,{...e,...t})}function wy(e){const{tab:t}=e;return"groupByProperty"!==t.type?null:(0,z.jsx)(wp,{...e,...t})}function Ay(e){const{tab:t}=e;return"groupByNumber"!==t.type?null:(0,z.jsx)(bp,{...e,...t})}function Iy(e){const{tab:t}=e;return"subitem"!==t.type?null:(0,z.jsx)(zp,{...e,...t,formatSetting:"subitem"})}function _y(e){const{tab:t}=e;return"subitemV2"!==t.type?null:(0,z.jsx)(al,{...e,feature:"subitem",from:t.from})}function Ty(e){const{tab:t}=e;return"arrowsBy"!==t.type?null:(0,z.jsx)(zp,{...e,...t,formatSetting:"timeline_arrows_by"})}function ky(e){const{tab:t}=e;return"dependencies"!==t.type?null:(0,z.jsx)(al,{...e,feature:"timeline_arrows_by",from:t.from})}function My(e){const{tab:t}=e;return"relationFeaturesAdvancedSettings"!==t.type?null:(0,z.jsx)(vl,{...e,feature:t.feature})}function Py(e){const{tab:t}=e;return"githubConfig"!==t.type?null:(0,z.jsx)(As().A,{...e,property:t.property})}function By(e){const{tab:t}=e;return"filter"!==t.type?null:(0,z.jsx)(Eu,{...e})}function Vy(e){const{tab:t}=e;return"editProperties"!==t.type?null:(0,z.jsx)(Mp().A,{...e,propertiesMenuType:"editPropertiesOnly",timelineViewTab:t.timelineViewTab})}function Fy(e){const{tab:t}=e;return"editScimProperties"!==t.type?null:(0,z.jsx)(ws,{...e})}function Dy(e){const{tab:t}=e;return"automationSettings"!==t.type?null:(0,z.jsx)(Re,{...e,tabSettings:t})}function Ey(e){const{tab:t}=e;return"externalProjectsSyncSettings"!==t.type?null:(0,z.jsx)(Qn,{...e,tabSettings:t})}function Oy(e){const{tab:t}=e;return"connectedRelationDatabaseActions"!==t.type?null:(0,z.jsx)(go,{...e,tabSettings:t})}function Ry(e){const{tab:t,collectionContextStore:o,collectionSettingsStore:n}=e;return"mobileCreateAutomation"!==t.type?null:(0,z.jsx)(S().u,{collectionSettingsStore:n,collectionContextStore:o,mode:"create",from:t.from,source:t.source})}function Ky(e){const{tab:t,collectionContextStore:o,collectionSettingsStore:n}=e;if("mobileEditAutomation"!==t.type)return null;const{automationId:i}=t;return(0,z.jsx)(S().u,{collectionSettingsStore:n,collectionContextStore:o,mode:"update",source:t.source,automationId:i})}function Ny(e){const{tab:t,collectionContextStore:o,collectionSettingsStore:n}=e;return"mobileEditButtonAutomation"!==t.type?null:(0,z.jsx)(S().N,{collectionSettingsStore:n,collectionContextStore:o,property:t.property,propertySchema:t.propertySchema})}function zy({tab:e,collectionContextStore:t,collectionSettingsStore:o}){return"sprintSettings"!==e.type?null:(0,z.jsx)(Bi,{collectionContextStore:t,collectionSettingsStore:o,from:e.from})}function Ly({tab:e,collectionContextStore:t,collectionSettingsStore:o}){return"formQuestionEditSettings"!==e.type?null:(0,z.jsx)(MS,{collectionContextStore:t,collectionSettingsStore:o,formQuestionId:e.formQuestionId,moduleId:e.moduleId})}function Uy({tab:e,collectionContextStore:t,collectionSettingsStore:o}){return"formQuestionCreateSettings"!==e.type?null:(0,z.jsx)(Xm,{collectionContextStore:t,collectionSettingsStore:o,moduleId:e.moduleId,area:e.area,parentModuleId:e.parentModuleId,parentConditionalGroupId:e.parentConditionalGroupId})}function Wy({tab:e,collectionContextStore:t,collectionSettingsStore:o}){return"formCustomizeSettings"!==e.type?null:(0,z.jsx)(_m,{collectionContextStore:t,collectionSettingsStore:o})}function Hy({tab:e,collectionContextStore:t,collectionSettingsStore:o}){return"formSelectTemplate"!==e.type?null:(0,z.jsx)(XS,{collectionContextStore:t,collectionSettingsStore:o})}function $y({tab:e,collectionSettingsStore:t}){return"confirmAddTemplate"!==e.type?null:(0,z.jsx)(Ji,{template:e.template,collectionSettingsStore:t})}function Gy({tab:e,collectionSettingsStore:t,collectionContextStore:o}){return"views"!==e.type?null:(0,z.jsx)(or,{collectionSettingsStore:t,collectionContextStore:o})}function Qy({tab:e}){return"linked_collections"!==e.type?null:(0,z.jsx)(er,{})}function qy(e){const{tab:t}=e;return"connectionFeatures"!==t.type?null:(0,z.jsx)(Ne,{...e})}function Yy(e){const{tab:t}=e;return"addNewDataSource"!==t.type?null:(0,z.jsx)(Eg,{collectionStore:t.collectionStore,analytics:t.analytics,...e})}function Xy(e){const{tab:t}=e;return"createViewSource"!==t.type?null:(0,z.jsx)(rm,{existingCollectionStore:t.existingCollectionStore,createdCollectionRecordPointerMap:t.createdCollectionRecordPointerMap,analytics:t.analytics,...e})}function Jy(e){const{tab:t}=e;return"linkToDatabase"!==t.type?null:(0,z.jsx)(ny,{existingCollectionStore:t.existingCollectionStore,analytics:t.analytics,...e})}function Zy(e){const{tab:t}=e;return"databaseSettings"!==t.type?null:(0,z.jsx)(Rl,{...e})}function ef(e){const{tab:t}=e;return"databaseProperties"!==t.type?null:(0,z.jsx)(Vl,{...e})}function tf(e){const{tab:t}=e;return"manageDataSources"!==t.type?null:(0,z.jsx)(Ac,{...e,analytics:t.analytics})}function of(e){const{collectionContextStore:t}=e;return"page"===(0,s().K8)((()=>t.getViewType()),[t])?(0,z.jsx)(Mc,{...e}):(0,z.jsx)(Wa,{...e})}},535959:(e,t,o)=>{o.d(t,{G:()=>a});var n=()=>o(920198),i=()=>o(484714),r=()=>o(706021),l=()=>o(528093);function a(){const e=(0,i().v3)(),t=(0,n().L)(),o=(0,l()._)({spaceId:null==t?void 0:t.id,userId:e.currentUser.id,name:"dashboard_view"});return{isSupported:!!o&&(0,r().e2)(o),isLoading:!o,featureAvailability:o}}},536308:(e,t,o)=>{o.r(t),o.d(t,{formEditorActions:()=>n()});var n=()=>o(894995)},546754:(e,t,o)=>{o.d(t,{N:()=>s,u:()=>a});o(296540);var n=()=>o(79926),i=()=>o(806080),r=o(474848);const l=new(n().O2)("builder-modals",(()=>Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(62475),o.e(3151),o.e(98629),o.e(45158),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(44854),o.e(87017),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(44584),o.e(24587),o.e(67494),o.e(3651),o.e(38293),o.e(40992),o.e(88455),o.e(64556),o.e(33893),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(68637),o.e(74562),o.e(39986),o.e(47431),o.e(76677),o.e(68609),o.e(15553),o.e(77345),o.e(67720),o.e(37759),o.e(41423),o.e(21627),o.e(77777),o.e(3261),o.e(81803),o.e(32625),o.e(11424),o.e(46162),o.e(79665)]).then(o.bind(o,404845)))),a=(0,n()._h)(l,(e=>e.AutomationBuilderModal),{renderLoading:()=>(0,r.jsx)(c,{})}),s=(0,n()._h)(l,(e=>e.ButtonBuilderModal),{renderLoading:()=>(0,r.jsx)(c,{})});function c(){return(0,r.jsx)(o(401634).i,{handleOnDismiss:i().lQ,canSave:!1,handleOnSave:i().lQ,mode:"loading",children:(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",overflow:"hidden"},children:(0,r.jsx)(o(98126).k,{})})})}},554840:(e,t,o)=>{o.d(t,{e:()=>H,a:()=>W});o(898992),o(354520);var n=o(296540),i=()=>o(484714),r=()=>o(590526),l=()=>o(401497),a=()=>o(127833),s=()=>o(250910),c=()=>o(118307),d=()=>o(546926),u=()=>o(890492),p=()=>o(955363),g=()=>o(69708),m=()=>o(100622),S=()=>o(534177),y=()=>o(284371),f=()=>o(69267),h=()=>o(115512),x=(o(944114),o(581454),o.n(o(844751))),v=()=>o(726637),b=()=>o(807449),C=()=>o(81068),j=()=>o(663639),w=()=>o(736847),A=()=>o(452004),I=()=>o(651124),_=()=>o(390066),T=()=>o(589407),k=()=>o(496603),M=()=>o(314638),P=()=>o(680288),B=()=>o(736767),V=()=>o(419357),F=o(474848);const D=2,E=(0,g().YK)({inputPlaceholder:{defaultMessage:"Search for a propertyâ€¦",id:"database.viewSettings.propertySelect.inputPlaceholder"}});function O(e){const t=(0,g().tz)(),{currentProperty:o,getGroupedProperties:i,onAccept:a,renderProperty:s,inputPlaceholder:c,schema:d,format:u,defaultShowPropertyGroupCount:p}=e,y=(0,r().uB)(void 0,A().$),f=(0,r().K8)((()=>i()),[i]),[h,j]=(0,n.useState)(!1),[M,O]=(0,n.useState)(""),N=(0,_().L)(u,d,void 0,I().jf.Page).collection_page_properties||[],z=(0,n.useCallback)((e=>{O(e.target.value),y.setState({...y.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}}),j(!1)}),[y]),L=(0,l().IS)((()=>({showMoreButton:{color:m().Tj.text.secondary}})),[]),U=k().Ul(f,(e=>Math.min(...e.map((e=>N.findIndex((t=>t.property===e))))))),W=[{key:"input",comp:(0,F.jsx)(w().A,{children:(0,F.jsx)(V().Ay,{focusInitial:!v().A.isMobile||void 0,focus:!v().A.isMobile||void 0,value:M,onChange:z,placeholder:c||t.formatMessage(E.inputPlaceholder)})})}];if(M){const e=U.map((e=>e.filter((e=>{const t=d[e],o=t?`${t.name} ${P().dC[t.type]}`:"";return Boolean(x().match(M,o))})))).filter((e=>e.length>0));if(0===e.length)W.push({key:"noResults",comp:(0,F.jsx)(B().A,{caption:(0,F.jsx)(g().sA,{defaultMessage:"No results",id:"database.viewSettings.propertySelect.noResultsTitle"})})});else{const t=[{key:"results",render:e=>(0,F.jsx)(w().A,{...e}),items:e.flat().map((e=>K({onAccept:a,property:e,schema:d,currentProperty:o,renderProperty:s}))).filter(S().O9)}];W.push(R({sections:t,menuListStore:y}))}}else{const e=p||D;let t,n;if(!h&&U.length>e){t=U.slice(0,e);const o=k().cz(U.slice(e).map((e=>e.length)));n={key:"show_more",render:e=>(0,F.jsx)(C().A,{...e,icon:(0,F.jsx)(b().I,{icon:T().ellipsisIcon,colorVariant:"secondary"}),style:L.showMoreButton,title:(0,F.jsx)(g().sA,{defaultMessage:"{moreCount} more",id:"database.viewSettings.propertySelect.showMoreTitle",values:{moreCount:o}})}),action:()=>{j(!0)}}}else t=U;const i=t.map(((e,i)=>({key:e.join("-"),render:e=>(0,F.jsx)(w().A,{...e,topBorder:0!==i}),items:e.map((e=>K({onAccept:a,property:e,schema:d,currentProperty:o,renderProperty:s}))).concat(i===t.length-1?[n]:[]).filter(S().O9)})));W.push(R({sections:i,menuListStore:y}))}return(0,F.jsx)(F.Fragment,{children:W.map((({key:e,comp:t})=>(0,F.jsx)(n.Fragment,{children:t},e)))})}function R(e){const{menuListStore:t,sections:o}=e;return{key:"properties",comp:(0,F.jsx)(j().A,{type:j().O.Vertical,initialFocus:0,sections:o,store:t})}}function K(e){const{schema:t,currentProperty:o,onAccept:n,renderProperty:i,property:r}=e,l=t[r];if(!l)return;return{key:r,render:e=>{const t=r===o;return i?i(e,r,t,l):(0,F.jsx)(M().G,{...e,propertySchema:l,format:M().e.Name,isChecked:t})},action:()=>{n(r)}}}var N=()=>o(497222),z=()=>o(380468),L=()=>o(148079),U=()=>o(557336);function W(e){const{currentPropertyId:t,feature:o,collectionContextStore:n,permissionScopes:i,onPropertySelect:l,buttonPopupStore:a,disabled:s}=e,c=(0,g().tz)(),d=(0,r().K8)((()=>{var e,t;return"subitem"===o?null===(e=n.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.subitem_property:"timeline_arrows_by"===o?null===(t=n.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.collection_default_arrows_by:void(0,S().HB)(o)}),[o,n]),u=(0,r().K8)((()=>n.databaseTypeFromStoreState),[n]),{handleDefaultPropertySelect:m,handlePropertySelect:y,getProperties:h}=(0,U().Tv)({collectionContextStore:n,feature:o,onPropertySelect:l}),x=(0,f().uX)({feature:o,databaseType:u});return(0,F.jsx)($,{intl:c,icon:p().arrowDiagonalUpRightIcon,caption:(0,F.jsx)(g().sA,{...x}),collectionContextStore:n,buttonPopupStore:a,shouldGroupProperties:!0,getGroupedProperties:h,currentProperty:t,disabled:s,onAccept:i.canConfigureBlock&&i.canConfigureCollection?y:()=>{},renderProperty:(e,t,i,r)=>(0,F.jsx)(L().A,{version:"v2",feature:o,menuProps:e,property:t,defaultProperty:d,isChecked:i,propertySchema:r,collectionContextStore:n,handleDefaultPropertySelect:m,handlePropertySelect:y})})}function H(e){const{currentPropertyId:t,collectionContextStore:o,onPropertyChanged:i,disabled:l,title:a}=e,s=(0,g().tz)(),d=(0,r().uB)(void 0,c().A),u=(0,r().O$)(o.normalizedSchemaStore),p=(0,n.useCallback)((()=>Object.keys(u).filter((e=>{const t=u[e];return"date"===(null==t?void 0:t.type)})).filter(S().O9)),[u]);return(0,F.jsx)($,{intl:s,buttonPopupStore:d,title:a,collectionContextStore:o,shouldGroupProperties:!1,getProperties:p,currentProperty:t,disabled:l,onAccept:e=>{e&&i(e),d.setState({open:!1})}})}function $(e){const{currentProperty:t,icon:o,caption:n,buttonPopupStore:c,collectionContextStore:p,disabled:S,title:f,shouldGroupProperties:x}=e,v=(0,i().Y0)(),b=(0,r().K8)((()=>{var e;return(null===(e=p.collectionStore())||void 0===e?void 0:e.getFormat())??{}}),[p]),C=(0,r().O$)(p.normalizedSchemaStore),j=(0,l().IS)((()=>({caption:{fontSize:h().Kw,color:m().Tj.text.secondary,marginTop:0,marginInlineEnd:12,marginBottom:12,marginInlineStart:14}})),[]),w=(0,r().K8)((()=>c.state.open),[c]),A=(0,r().K8)((()=>v.isPhone?{menuType:d().gu.ActionSheet}:{menuType:d().gu.Popup,width:300}),[v.isPhone]);return(0,F.jsxs)(F.Fragment,{children:[n?(0,F.jsx)("div",{style:j.caption,children:n}):void 0,(0,F.jsx)(s().A,{popupType:v.isPhone?a().nl.SlideUp:a().nl.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",disabled:S,originGap:0,renderOrigin:e=>{var n;return(0,F.jsx)(N().A,{title:f??(0,F.jsx)(g().sA,{id:"database.viewSettings.relationFeatures.propertyPicker.default.title",defaultMessage:"Property"}),showChevron:!0,right:t?(0,F.jsx)("span",{style:y().RC,children:null===(n=C[t])||void 0===n?void 0:n.name}):void 0,rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0},rotateChevron:w,disabled:S,icon:o,...e})},render:t=>(0,F.jsx)(u().A,{...A,children:x?(0,F.jsx)(O,{...e,getGroupedProperties:e.getGroupedProperties,format:b,schema:C}):(0,F.jsx)(z().A,{getProperties:e.getProperties,currentProperty:e.currentProperty,onAccept:e.onAccept,format:b,schema:C})}),buttonPopupStore:c})]})}},557336:(e,t,o)=>{o.d(t,{Me:()=>h,QZ:()=>v,Tv:()=>x,lk:()=>b});var n=o(296540),i=()=>o(484714),r=()=>o(590526),l=()=>o(69708),a=()=>o(534177),s=()=>o(436696),c=()=>o(935664),d=()=>o(896628),u=()=>o(155269),p=()=>o(113105),g=()=>o(920836),m=()=>o(317406),S=()=>o(838038),y=()=>o(547149),f=()=>o(926203);function h(e){const{collectionContextStore:t,feature:o}=e,n=(0,l().tz)();return{initialPropertyName:(0,r().K8)((()=>{const e=t.collectionStore();if(null!=e&&e.isDefined()){const i=t.normalizedSchemaStore.state;return p().$H(n,{targetCollectionStore:e,isSelfRelation:!0,sourceSchema:i,createUnique:!0,from:o})}return n.formatMessage({id:"database.viewSettings.relationsPropertyTab.initialPropertyName.placeholder",defaultMessage:"Related to target"})}),[t,n,o])}}function x(e){const{feature:t,collectionContextStore:o,onPropertySelect:x}=e,v=(0,i().v3)(),b=(0,l().tz)(),{initialPropertyName:C}=h({collectionContextStore:o,feature:t}),j=(0,n.useCallback)((e=>{const{collectionViewStore:o,newProperty:n,transaction:i}=e;"timeline_arrows_by"===t&&m().Tq({collectionViewStore:o,newProperty:n,transaction:i})}),[t]),w=(0,r().O$)(o.normalizedSchemaStore),A=(0,n.useCallback)((()=>p().qw(o,w)),[o,w]),I=(0,n.useCallback)((e=>{const{relationPropertyId:n,transaction:i}=e;"subitem"===t?g().zt({environment:v,collectionContextStore:o,relationPropertyId:n,transaction:i}):"timeline_arrows_by"===t?m().L_({collectionContextStore:o,relationPropertyId:n,transaction:i}):(0,a().HB)(t)}),[o,v,t]),_=(0,n.useCallback)((e=>{const{featureType:t,from:n}=e,i=o.collectionStore(),r=i,l=o.collectionViewStore();if(!i||!r)return;const{performResult:s}=y().createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:v,canUndo:!0,perform:n=>{const a=(0,u().createProperty)({environment:v,collectionStore:i,collectionViewArgs:l?{collectionViewStore:l,format:l.getFormat(),formatKey:"collection_page_properties"}:void 0,propertyType:"relation",transaction:n});return S().cT({environment:v,collectionContextStore:o,collectionStore:i,property:a,propertyName:C,targetCollectionStore:r,hasInverseRelation:!0,inverseName:void 0,autoRelate:{enabled:!1},propertyLimit:"no_limit",intl:b,transaction:n,from:t}),l&&(j({collectionViewStore:l,newProperty:a,transaction:n}),I({relationPropertyId:a,transaction:n})),"timeline_arrows_by"===t&&(0,f().Wf)({environment:v,intl:b,collectionStore:i,transaction:n,newConfig:e.dateShiftingConfig}),a}});let d;"subitem"===t?d="notion://tasks/sub_task_feature":"timeline_arrows_by"===t?d="notion://tasks/task_dependencies_feature":(0,a().HB)(t),(0,c().Z)({environment:v,collectionContextStore:o,from:t,property_type:"relation",property_id:s,feature:{id:s,from:n,type:d}})}),[o,v,C,b,I,j]),T=(0,n.useCallback)((e=>{const n=o.collectionViewStore();if(!n)return;let i;y().createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handleDefaultPropertySelect",environment:v,canUndo:!0,perform:t=>{j({collectionViewStore:n,newProperty:e,transaction:t}),I({relationPropertyId:e,transaction:t})}}),x(e),"subitem"===t?i="update_default_subitem":"timeline_arrows_by"===t?i="update_default_timeline_arrows_by":(0,a().HB)(t),(0,s().X)({action:i,original_view_type:void 0,property_type:e?"relation":void 0,environment:v,collectionContextStore:o})}),[o,v,x,t,j,I]),k=(0,n.useCallback)((e=>{const n=o.collectionViewStore();if(!n)return;let i;y().createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handlePropertySelect",environment:v,canUndo:!0,perform:t=>{j({collectionViewStore:n,newProperty:e,transaction:t})}}),x(e),"subitem"===t?i="update_subitem":"timeline_arrows_by"===t?i="update_timeline_arrows_by":(0,a().HB)(t),(0,s().X)({action:i,original_view_type:void 0,property_type:e?"relation":void 0,environment:v,collectionContextStore:o})}),[o,v,x,t,j]),M=(0,n.useCallback)((()=>{const e=o.collectionViewStore();e&&y().createAndCommit({userAction:"actionRegistry.clearCollectionViewSubitemConfig",environment:v,canUndo:!0,perform:t=>{d().zA({stores:[e],update:{subitem_display_mode:void 0,subitem_filter_scope:void 0},transaction:t})}})}),[o,v]),P=(0,n.useCallback)((e=>{const{subitemFilterScope:t}=e,n=o.collectionViewStore();n&&y().createAndCommit({userAction:"actionRegistry.setSubitemFilterScopeOnSubitemEnable",environment:v,canUndo:!0,perform:e=>{d().zA({stores:[n],update:{subitem_filter_scope:t},transaction:e})}})}),[o,v]);return{handlePropertySelect:k,handleDefaultPropertySelect:T,handleAddRelation:_,getProperties:A,clearCollectionViewSubitemConfig:M,setSubitemFilterScope:P}}function v(e){const{feature:t,collectionContextStore:o}=e;let n,i;var r,l;if("subitem"===t)i=null===(r=o.collectionStore())||void 0===r?void 0:r.getFormatStore().getKeyStore("subitem_property").getValue(),n="flattened"===(null===(l=o.collectionViewStore())||void 0===l?void 0:l.getFormat().subitem_display_mode)?void 0:i;else if("timeline_arrows_by"===t){var s;n=o.currentArrowsByFormatStore.state,i=null===(s=o.collectionStore())||void 0===s?void 0:s.getFormatStore().getKeyStore("collection_default_arrows_by").getValue()}else(0,a().HB)(t);const c=o.normalizedSchemaStore.state,d=p().uu(o,c);(0,a().O9)(n)&&!d.includes(n)&&(n=void 0),(0,a().O9)(i)&&!d.includes(i)&&(i=void 0);const u=n??i;if(u){var g;const e=Boolean(n),r="hidden"!==(null===(g=o.collectionViewStore())||void 0===g?void 0:g.getFormat().subitem_display_mode),l="subitem"===t?r:e;return{property:u,isDefault:u===i,enabledOnView:e,enabledOnCollection:Boolean(i),supportedInView:(0,f().v9)({feature:t,viewType:o.getViewType()}),isVisibleInView:l}}}function b(e){const{feature:t,collectionContextStore:o}=e;return(0,r().K8)((()=>v({feature:t,collectionContextStore:o})),[o,t])}},564037:(e,t,o)=>{o.r(t),o.d(t,{getCurrentAgentThreadId:()=>I,getCurrentCustomAgentThreadId:()=>_,getCurrentWorkflowNavigationState:()=>C,getDefaultClosedNavigationState:()=>h,getDefaultOpenNavigationState:()=>f,getIsWorkflowEditorOpen:()=>v,getIsWorkflowEditorStateOpen:()=>x,getIsWorkflowNavigationStateCurrent:()=>b,getMergedWorkflowNavigationState:()=>j,useIsWorkflowEditorOpen:()=>A,useWorkflowNavigationState:()=>w});var n=()=>o(755531),i=()=>o(484714),r=()=>o(590526),l=()=>o(350013),a=()=>o(743246),s=()=>o(496603),c=()=>o(671593),d=()=>o(638681),u=()=>o(990402);const p=d().object({required:{isOpen:d().literal(!0)},optional:{}}),g={agent:d().intersection([p,d().object({required:{type:d().literal("agent")},optional:{}})]),activity:d().intersection([p,d().object({required:{type:d().literal("activity")},optional:{}})])},m=d().union(Object.values(g)),S=d().object({required:{isOpen:d().literal(!1)},optional:{}}),y=d().union([m,S]);function f(){return{isOpen:!0,type:"agent"}}function h(){return{isOpen:!1}}function x(e){return(null==e?void 0:e.isOpen)??!1}function v(e){return x(C(e))}function b(e){const{currentNavigationState:t,navigationState:o}=e,n=j({defaultNavigationState:{isOpen:!1},currentNavigationState:t,newNavigationState:o});return(0,s().n4)(t,n)}function C(e){const{RouterStore:t}=e;if("agent"!==t.state.route.name)return;const o=t.state.route.workflowId,i=(0,n().S)();if(!i)return;const r=l().N.createChildStore(i,{id:o,table:a().C0,spaceId:i.id});return(0,u().m)(r)?function(e){const{workflowViewType:t}=e;switch(t){case"agent":case"activity":return{isOpen:!0,type:t};default:return}}(t.state.route):void 0}function j(e){const{defaultNavigationState:t,currentNavigationState:o,newNavigationState:n}=e,i={...t};if(o)for(const[l,a]of Object.entries(o))i[l]=a;if(n)for(const[l,a]of Object.entries(n))i[l]=a;const r=(0,c().tf)(y,i);if(r)throw r;return i}function w(){const e=(0,i().v3)();return(0,r().K8)((()=>C(e)??{isOpen:!1}),[e])}function A(){const e=(0,i().v3)();return(0,r().K8)((()=>v(e)),[e])}function I(e){const{RouterStore:t}=e,o=t.state.route;if("agent"===o.name||"page"===o.name||"chat"===o.name)return o.chatThreadId}function _(e){const{RouterStore:t}=e,o=t.state.route;if("agent"===o.name)return o.agentChatThreadId}},566534:(e,t,o)=>{o.d(t,{U:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"4.12 2.37 14.01 15.25",directional:!0,svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M6.25 2.375A2.125 2.125 0 0 0 4.125 4.5v11c0 1.174.951 2.125 2.125 2.125h7.5a2.125 2.125 0 0 0 2.125-2.125v-1.062h-1.25V15.5a.875.875 0 0 1-.875.875h-7.5a.875.875 0 0 1-.875-.875v-11c0-.483.392-.875.875-.875h7.5c.483 0 .875.392.875.875v1.125h1.25V4.5a2.125 2.125 0 0 0-2.125-2.125z"}),(0,n.jsx)("path",{d:"M17.942 9.558a.625.625 0 0 1 0 .884l-2.5 2.5a.625.625 0 1 1-.884-.884l1.408-1.408H10a.625.625 0 1 1 0-1.25h6.016l-1.458-1.458a.625.625 0 1 1 .884-.884z"})]})},r=(0,o(340498).wt)("arrowRightFromRectangle",i,"default")},575154:(e,t,o)=>{o.d(t,{q:()=>p});o(898992),o(354520),o(581454);var n=()=>o(590526),i=()=>o(929219),r=()=>o(663077),l=()=>o(496603),a=()=>o(863987),s=()=>o(793863),c=()=>o(200277),d=()=>o(756790),u=()=>o(580101);function p({parentStore:e,returnAllTemplates:t}){const o=(0,n().K8)((()=>{const e=a().A.getState();return((null==e?void 0:e.templatesWithRowIds)??[]).map((e=>e.template)).filter((e=>(0,r().Xq)(e,"collection")))}),[],{useDeepEqual:!0}),p=(0,n().K8)((()=>{u().A.getState();const e=(0,d().p)().function;return e&&(0,r().AU)(e)?e:void 0}),[]),g=(0,n().K8)((()=>(0,c().$)({persona:p,parentStore:e})),[p,e],{useDeepEqual:!0}),m=!(0,n().O$)(i().e);return(0,n().K8)((()=>m?[]:(0,l().hS)([...o,...g,...t?(0,s().oA)():[]],(e=>e.templateId))),[o,g,t,m])}},580101:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){}}const i=new n},614525:(e,t,o)=>{o.d(t,{A:()=>a});o(296540);var n=()=>o(69708),i=()=>o(436696),r=()=>o(339798),l=o(474848);const a=function({collectionContextStore:e}){const t=(0,o(484714).v3)(),{viewType:a,isViewsModule:s,isDashboardWidget:c}=(0,o(590526).K8)((()=>{var t;return{viewType:null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType(),isViewsModule:Boolean(e.viewsModuleContextStore.state),isDashboardWidget:Boolean(e.isDashboardWidget())}}),[e]);if(!a||s||c)return null;let d=(0,l.jsx)(n().sA,{defaultMessage:"Copy link to view",id:"database.viewSettings.mainTab.copyLinkButton.title"});return"chart"===a&&(d=(0,l.jsx)(n().sA,{defaultMessage:"Copy link to chart",id:"database.viewSettings.mainTab.copyLinkButton.title.chart"})),(0,l.jsx)(o(497222).A,{icon:o(742852).linkIcon,title:d,onClick:()=>function(e,t){const o=t.collectionViewStore();o&&(r().GH({environment:e,collectionContextStore:t,collectionViewStore:o}),(0,i().X)({environment:e,collectionContextStore:t,action:"click_copy_link",original_view_type:o.getType()}))}(t,e)})}},626318:(e,t,o)=>{o.d(t,{Bj:()=>v,ZX:()=>x});o(16280);var n=()=>o(675133),i=()=>o(295633),r=()=>o(732810),l=()=>o(278238),a=()=>o(206267),s=()=>o(454984),c=()=>o(688728),d=()=>o(475140),u=()=>o(179034),p=()=>o(869558),g=()=>o(183558),m=()=>o(384944),S=()=>o(594794),y=()=>o(547149),f=()=>o(978846),h=()=>o(38e3);function x(e){var t,o;const{environment:n,layoutStore:r,relationPropertyId:l,targetCollectionPointer:u,viewName:p,viewIcon:m}=e,S=null===(t=r.getModel())||void 0===t?void 0:t.firstRawModuleOfType("editor"),x=null===(o=r.getModel())||void 0===o?void 0:o.firstRawModuleOfType("viewsMain");if(!S&&!x)throw new Error("Invalid state: no editor or viewsMain module");const{performResult:b}=y().createAndCommit({environment:n,canUndo:!0,perform:e=>{const{inMemoryRecordCache:t}=r;let o,b=x;if(b){var C;if("viewsMain"!==(null===(C=b)||void 0===C?void 0:C.type))throw new Error("Invalid state: editor or viewsMain module is not of the expected type");o=i().B.createChildStore(r,b.collection_view_block_pointer)}else{const t=(0,g().Ay)(),{collectionViewBlockStore:i}=(0,h().$)({environment:n,layoutStore:r,transaction:e});o=i,b={id:t,type:"viewsMain",collection_view_block_pointer:{...o.pointer,spaceId:o.getSpaceId()}};const l=(0,d().JO)(r.getModules(),(e=>"editor"===e.type));if(!l||!S||"form_conditional_modules"===l.area)throw new Error("Invalid state: no editor module");if("views_main_tab_modules"===l.area)throw new Error("Cannot add views main module when editor is already in views main module");y().applyOperation({store:r,transaction:e,operation:s().N4.deleteModuleInArea({pointer:r.pointer,area:c().Zm[l.area],moduleId:S.id})}),(0,f().UQ)({position:{type:"absolute",area:l.area,index:l.index},module:b,layoutStore:r,transaction:e,environment:n,sessionId:(0,a().JW)(),isPropertyCreation:!1})}if(!b)throw new Error("Invalid state: no views main module");const j=v({environment:n,transaction:e,targetCollectionPointer:u,collectionViewBlockStore:o,viewName:p,viewIcon:m,relationPropertyId:l,inMemoryRecordCache:t});return{viewsMainModule:b,collectionViewBlockPointer:o.pointer,collectionViewPointer:j}},userAction:"viewsModuleActions.addViewToViewsMainModule"});if(!b)throw new Error("Transaction to add collection view to views main module failed");return{viewsMainModule:b.viewsMainModule,collectionViewPointer:b.collectionViewPointer,collectionViewBlockPointer:b.collectionViewBlockPointer}}function v({environment:e,transaction:t,targetCollectionPointer:o,collectionViewBlockStore:i,viewName:s,viewIcon:c,relationPropertyId:d,inMemoryRecordCache:g}){const f=(0,S().JH)({environment:e,table:p().Gy,spaceId:i.getSpaceId()}).id;let h=c;if(!h&&o){const e=r().m.createChildStore(i,o).getIcon();null!=e&&e.icon&&(0,l().T8)(e.icon)&&(h=e.icon)}const x={id:f,type:"table",parent_id:i.pointer.id,parent_table:u().ev,space_id:i.getSpaceId(),alive:!0,name:s??n().A.formatMessage(b.view),format:{hide_linked_collection_name:!0,collection_pointer:o,collection_view_icon:h,...d?{property_filters:[{id:a().JW(),filter:{property:d,filter:{operator:"relation_contains",value:{type:"relative",value:{type:"current_page_in_related_collection"}}}}}]}:{},subitem_display_mode:d?"disabled":void 0,subitem_filter_scope:d?"parents_and_subitems":void 0}};return y().applyOperation({store:i,operation:{pointer:i.pointer,path:["view_ids"],command:"listAfter",args:{id:f}},transaction:t}),m().eC({environment:e,table:p().Gy,value:x,inMemoryRecordCache:g,transaction:t}),{id:f,table:p().Gy,spaceId:i.getSpaceId()}}const b=(0,o(69708).YK)({view:{defaultMessage:"View",id:"pageLayout.viewsModuleActions.defaultViewName"}})},635019:(e,t,o)=>{o.d(t,{f:()=>l});var n=o(296540),i=()=>o(69708),r=o(474848);const l=n.memo((function({collectionContextStore:e,collectionSettingsStore:t}){const n=(0,o(484714).v3)(),{collectionViewStore:l,targetStore:a,icon:s}=(0,o(590526).K8)((()=>{var t;const n=e.collectionViewStore(),i=e.collectionViewBlockStore(),r=null==n?void 0:n.getFormat(),l=null==r?void 0:r.page_pointer;let a;return l&&i&&(a=o(295633).B.createChildStore(i,{table:l.table,id:l.id,spaceId:l.spaceId})),{collectionViewStore:n,targetStore:a,icon:null===(t=a)||void 0===t?void 0:t.getIcon()}}),[e]);return l?(0,r.jsx)(o(497222).A,{icon:o(688311).h,title:(0,r.jsx)(i().sA,{defaultMessage:"Source",id:"database.viewSettings.mainTab.sourceButton.title"}),showChevron:!0,right:a?(0,r.jsxs)(r.Fragment,{children:[s?(0,r.jsx)(o(187820).B6,{disabled:!0,bucket:"secure",store:a,icon:s,iconRecordCategory:"pageBlock",isEmptyPage:!1,size:20,style:{marginInlineEnd:4,opacity:.6}}):void 0,(0,r.jsx)(o(16006).A,{store:a})]}):(0,r.jsx)("span",{style:{opacity:.5},children:(0,r.jsx)(i().sA,{defaultMessage:"Select a page",id:"pageViewTargetSetting.selectPage"})}),textWrapperStyle:{flexShrink:0},rightStyle:{flexShrink:1},onClick:()=>{(0,o(436696).X)({environment:n,collectionContextStore:e,action:"click_source"}),o(339798).a2({collectionSettingsStore:t,item:{type:"source"}})}}):null}))},637558:(e,t,o)=>{o.d(t,{v:()=>r});var n=o(296540),i=o(474848);const r=n.memo((function({currentSorts:e,schema:t}){const n=(0,o(401497).IS)((()=>({property:{maxWidth:"clamp(100px, 40vw, 150px)"}})),[]),r=e.length;if(0===r)return null;const l=e[0].property;return 1===r&&null!=t&&t[l]?(0,i.jsx)(o(422164).mA,{propertySchema:t[l],showIcon:!1,style:n.property}):(0,i.jsx)("span",{children:r})}))},638045:(e,t,o)=>{o.d(t,{t:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"5.83 0.79 8.33 18.41",svg:(0,o(474848).jsx)("path",{d:"M13.977 5.393a.625.625 0 0 1-.883 0l-2.47-2.469v5.662a.625.625 0 1 1-1.25 0V2.924L6.907 5.393a.625.625 0 0 1-.884-.884L9.558.974a.625.625 0 0 1 .884 0l3.535 3.535a.625.625 0 0 1 0 .884m-3.352 6.026a.625.625 0 1 0-1.25 0v5.648l-2.469-2.469a.625.625 0 1 0-.884.884l3.536 3.535c.244.245.64.245.884 0l3.535-3.535a.625.625 0 0 0-.883-.884l-2.47 2.469z"})},i=(0,o(340498).wt)("arrowUpDownStacked",n,"default")},653002:(e,t,o)=>{o.d(t,{Q:()=>i});var n=()=>o(869558);function i(e){const{collectionViewId:t,spaceId:o}=e;return{id:t,table:n().Gy,spaceId:o}}},663807:(e,t,o)=>{o.d(t,{j:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"1.59 1.59 16.81 16.81",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10 12.125a.75.75 0 1 1 0 1.5.75.75 0 0 1 0-1.5m0-5.875c.345 0 .625.28.625.625v3.5a.625.625 0 1 1-1.25 0v-3.5c0-.345.28-.625.625-.625"}),(0,n.jsx)("path",{d:"M8.498 2.222c.83-.83 2.175-.83 3.005 0l6.275 6.276c.83.83.83 2.175 0 3.005l-6.275 6.275c-.83.83-2.175.83-3.005 0l-6.276-6.275a2.125 2.125 0 0 1 0-3.005zm2.121.884a.875.875 0 0 0-1.237 0L3.106 9.382a.875.875 0 0 0 0 1.237l6.276 6.276a.875.875 0 0 0 1.237 0l6.276-6.276a.875.875 0 0 0 0-1.237z"})]})},r=(0,o(340498).wt)("exclamationDiamond",i,"default")},673900:(e,t,o)=>{o.d(t,{v:()=>d});var n=o.n(o(901080)),i=o(296540),r=()=>o(401497),l=()=>o(31511),a=()=>o(100622),s=()=>o(496603),c=o(474848);function d({value:e,onChange:t,onBlur:o,onKeyDown:d,inputProps:u}){const[p,g]=(0,i.useState)(""),m=(0,i.useRef)(""),S=(0,i.useRef)(e);(0,i.useEffect)((()=>{const t=void 0===e?"":e.toString();g(t),m.current=t,S.current=e}),[e]);const y=(0,i.useCallback)((e=>s().sg((e=>{null==t||t(e)}),300)(e)),[t]),f=(0,i.useCallback)((e=>{const o=e.target.value;if(g(o),m.current=o,t){const e=n()(o);y(isNaN(e)?void 0:e)}}),[y,t]),h=(0,i.useCallback)((e=>{const t=n()(e.target.value);null==o||o(isNaN(t)?void 0:t)}),[o]),x=(0,i.useRef)(o),v=(0,i.useCallback)((e=>{if("Enter"===e.key){const e=n()(p);null==d||d(isNaN(e)?void 0:e)}}),[p,d]);(0,i.useEffect)((()=>()=>{var e;if((null===(e=S.current)||void 0===e?void 0:e.toString())!==m.current){var t;const e=n()(m.current);null===(t=x.current)||void 0===t||t.call(x,isNaN(e)?void 0:e)}}),[]);const b=(0,r().IS)((()=>({input:{background:a().Tj.background.primary}})),[]);return(0,c.jsx)(l().A,{type:"number",value:p,inputClassName:"input-hide-arrows",style:b.input,onChange:f,onBlur:o?h:void 0,onKeyDown:d?v:void 0,...u})}},674582:(e,t,o)=>{o.d(t,{m:()=>d});o(296540);var n=()=>o(401497),i=()=>o(807449),r=()=>o(377114),l=()=>o(558687),a=()=>o(100622),s=()=>o(284371),c=o(474848);function d(e){const{title:t,description:o,integrationIconUrl:d,integrationIcon:u,children:p,styles:g}=e,m=(0,n().IS)((()=>({header:{fontWeight:s().Wy.bold,fontSize:26,textAlign:"center",marginBottom:4,lineHeight:"32px"},iconGroup:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gridColumnGap:9,marginBottom:12,height:40},arrowRight:{width:20,height:20,opacity:.4,fontWeight:s().Wy.bold,padding:3},notionLogo:{height:40,width:40,color:a().Tj.icon.primary},icon:{height:32,width:32},description:{textAlign:"center",color:a().Tj.text.secondary,fontWeight:s().Wy.regular,fontSize:14,lineHeight:"20px"}})),[]);return(0,c.jsxs)("div",{style:null==g?void 0:g.wrapper,children:[(0,c.jsxs)("div",{style:{...m.iconGroup,...null==g?void 0:g.iconGroup},children:[(0,l().notionIcon)(m.notionLogo),(0,c.jsx)(i().I,{icon:r().arrowLeftRightIcon,style:{...m.arrowRight,...null==g?void 0:g.arrowRight}}),d?(0,c.jsx)("img",{style:{...m.icon,...null==g?void 0:g.icon},src:d,alt:"Integration Icon"}):u]}),t?(0,c.jsx)("div",{style:{...m.header,...null==g?void 0:g.header},children:t}):void 0,o?(0,c.jsx)("div",{style:{...m.description,...null==g?void 0:g.description},children:o}):void 0,p]})}},675326:(e,t,o)=>{o.d(t,{S:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.25 15.35",svg:(0,o(474848).jsx)("path",{d:"M8.901 8.802a.223.223 0 0 1 .367-.197l4.99 4.208a.224.224 0 0 1-.117.393l-1.83.208 1.842 3.31a.67.67 0 1 1-1.174.65l-1.805-3.241-1.07 1.576a.224.224 0 0 1-.409-.1zM6.376 12.74a.625.625 0 0 1 .884.884l-1.768 1.768a.625.625 0 1 1-.884-.884zM5.5 9.375a.625.625 0 1 1 0 1.25H3a.625.625 0 1 1 0-1.25zm11.5 0a.625.625 0 1 1 0 1.25h-2.5a.625.625 0 1 1 0-1.25zM4.608 4.608a.625.625 0 0 1 .884 0L7.26 6.376a.625.625 0 1 1-.884.884L4.608 5.492a.625.625 0 0 1 0-.884m9.9 0a.625.625 0 1 1 .884.884L13.624 7.26a.625.625 0 0 1-.884-.884zM10 2.375c.345 0 .625.28.625.625v2.5a.625.625 0 1 1-1.25 0V3c0-.345.28-.625.625-.625"})},i=(0,o(340498).wt)("cursorClick",n,"default")},704640:(e,t,o)=>{o.d(t,{A:()=>a});o(898992),o(354520);var n=o(296540),i=()=>o(590526),r=()=>o(339798),l=o(474848);const a=function({collectionContextStore:e,collectionSettingsStore:t,disabled:a}){const s=(0,o(484714).v3)(),c=(0,i().O$)(e.permissionScopesStore),d=(0,i().K8)((()=>{var t;return null==e||null===(t=e.collectionStore())||void 0===t?void 0:t.getSchema()}),[e]),u=(0,i().K8)((()=>(0,o(790515).tG)(e)),[e]),p=(0,i().K8)((()=>e.currentPropertyFiltersStore.state.filter((e=>!(0,o(214388).t_)(e.filter)))),[e]),g=(0,n.useMemo)((()=>{if(0!==u){if(1===u&&1===p.length&&d){const e=null==d?void 0:d[p[0].filter.property];if(e)return(0,l.jsx)(o(404905).j,{placement:"left",style:{maxWidth:150},children:e.name})}return u}}),[u,d,p]);return(0,l.jsx)(o(497222).A,{disabled:a,icon:o(170350).filterIcon,title:(0,l.jsx)(o(69708).sA,{defaultMessage:"Filter",id:"database.viewSettings.mainTab.filterButton.title"}),showChevron:!0,right:g,rightStyle:{marginInlineStart:12},onClick:()=>{(0,o(436696).X)({environment:s,collectionContextStore:e,action:"click_filters"}),o(726637).A.isMobile||function(e,t){return Boolean(e.currentPropertyFiltersStore.state.length>0||e.currentCombinatorFilterStore.state&&t.canConfigureBlock)}(e,c)?r().a2({collectionSettingsStore:t,item:{type:"filters"}}):r().a2({collectionSettingsStore:t,item:{type:"createFilter"}})}})}},711433:(e,t,o)=>{o.d(t,{l:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.75 13.75",svg:(0,o(474848).jsx)("path",{d:"M14.375 4.25c0-.621-.504-1.125-1.125-1.125h-9c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125h9c.621 0 1.125-.504 1.125-1.125zm-10 .125h8.75v1.25h-8.75zm4.875 3.75c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125h-5a1.125 1.125 0 0 1-1.125-1.125v-1.5c0-.621.504-1.125 1.125-1.125zm-.125 1.25h-4.75v1.25h4.75zm6.625 3.75c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125H4.25a1.125 1.125 0 0 1-1.125-1.125v-1.5c0-.621.504-1.125 1.125-1.125zm-.125 1.25H4.375v1.25h11.25z"})},i=(0,o(340498).wt)("chartBarYAxis",n,"default")},717895:(e,t,o)=>{o.d(t,{K:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"7 7 6 6",svg:(0,o(474848).jsx)("path",{d:"M10 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6"})},i=(0,o(340498).wt)("dotFill",n,"fill")},719889:(e,t,o)=>{o.d(t,{X:()=>Jo});var n=o(296540),i=()=>o(907258),r=()=>o(59226),l=()=>o(484714),a=()=>o(590526),s=()=>o(401497),c=()=>o(736847),d=()=>o(282339),u=()=>o(901610),p=()=>o(566910),g=()=>o(69708),m=()=>o(908201),S=()=>o(339798),y=()=>o(322638),f=(o(16280),o(581454),()=>o(804773)),h=()=>o(726637),x=()=>o(718827),v=()=>o(807449),b=()=>o(26697),C=()=>o(382607),j=()=>o(100622),w=()=>o(534177),A=o(474848);const I={column:o(551222).q,bar:o(711433).l,line:o(267654).g,donut:o(748696).w};function _({chartConfig:e,disabled:t}){const o=(0,a().K8)((()=>{if(!e)return;const t=e.type;if("placeholder"===t)throw new Error("Should not happen");return t}),[e]);return(0,A.jsx)("div",{style:{display:"flex",gap:h().A.isMobile?C().X1:C().Qm,...h().A.isMobile?{marginTop:0,padding:C().X1,background:j().Tj.background.elevated}:{marginInlineStart:C().Qm,marginInlineEnd:C().Qm,paddingBlockEnd:C().Lh}},children:(0,w().uv)(I).map((e=>(0,A.jsx)(T,{chartType:e,currentlySelectedChartType:o,disabled:t},e)))})}function T({chartType:e,currentlySelectedChartType:t,disabled:o}){const i=(0,m().ET)(),r=(0,l().v3)(),c=(0,g().tz)(),{itemRef:d,isTabbable:u,onKeyDown:p}=(0,f().e)(),S=(0,s().IS)((()=>{const e=h().A.isMobile?50:40;return{button:{display:"flex",alignItems:"center",justifyContent:"center",flexGrow:1,borderRadius:8,padding:6,boxShadow:h().A.isMobile?`0 0 0 1.5px ${j().Tj.border.primary} inset`:`0 0 0 1px ${j().Tj.border.primary} inset`,position:"relative",width:"100%",height:e,...h().A.isMobile?{background:j().Tj.background.elevated}:{}},selectedButton:{...h().A.isMobile?{background:j().Tj.background.elevated}:{},boxShadow:`0 0 0 2px ${j().Tj.blue.icon.accentPrimary} inset`}}}),[]),C=(0,a().O$)(i.normalizedSchemaStore),w=(0,n.useCallback)((e=>{const t=i.collectionViewStore(),o=null==t?void 0:t.getChartConfig();t&&o&&(0,y().QJ)(e,o,r,t,i,C)}),[i,r,C]);return(0,A.jsx)(b().m,{placement:"top",alignment:"center",renderTooltip:t=>c.formatMessage(y().FZ[e]),render:i=>(0,n.createElement)(x().Ay,{...i,ref:d,key:e,style:{...S.button,...e===t&&S.selectedButton},onClick:()=>{w(e)},onKeyDown:p,disallowTabbing:!u,disabled:o||e===t,disabledFeedback:o,ariaLabel:c.formatMessage(y().FZ[e])},(0,A.jsx)(v().I,{icon:I[e],size:"lg",colorPalette:e===t?"blue":void 0,colorVariant:e===t?"accentPrimary":"secondary"}))})}o(944114),o(898992),o(672577),o(803949);var k=()=>o(594013),M=()=>o(100594),P=()=>o(499755),B=()=>o(67657),V=()=>o(62371),F=()=>o(713998),D=()=>o(340498);const E={viewBox:"0 0 20 20",fittedViewBox:"2.37 0.12 17.5 17.51",svg:(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("path",{d:"M12.25.125a.625.625 0 0 0-.625.625v7a.625.625 0 0 0 .625.625h7c.345 0 .625-.28.625-.625A7.625 7.625 0 0 0 12.25.125m.625 7v-5.72a6.38 6.38 0 0 1 5.72 5.72z"}),(0,A.jsx)("path",{d:"M10 2.375A7.625 7.625 0 1 0 17.625 10 .625.625 0 0 0 17 9.375h-6.375V3A.625.625 0 0 0 10 2.375M3.625 10c0-3.31 2.523-6.03 5.75-6.345V10a.625.625 0 0 0 .625.625h6.345A6.376 6.376 0 0 1 3.625 10"})]})},O=(0,D().wt)("chartPieCutout",E,"default");var R=()=>o(765974),K=()=>o(979251),N=()=>o(496603),z=()=>o(284371),L=()=>o(436696),U=()=>o(384944),W=()=>o(274031),H=()=>o(390650),$=()=>o(547149),G=(o(354520),o(737550),o.n(o(844751))),Q=()=>o(383036),q=()=>o(250910),Y=()=>o(118307),X=()=>o(546926),J=()=>o(890492),Z=()=>o(81068),ee=()=>o(449279),te=()=>o(663639),oe=()=>o(852424),ne=()=>o(965134),ie=()=>o(525955),re=()=>o(811979),le=()=>o(419357),ae=()=>o(662971),se=()=>o(527438),ce=()=>o(497222);const de="search-item",ue="default",pe="aggregate",ge="distinct",me={main_property:[ue],aggregation_property:[ue,pe,ge],y_axis_stacked_groups:[ue]},Se=["sum","average","min","max","median"];function ye(e){return"unique"===e||"sum"===e||"average"===e||"min"===e||"max"===e||"median"===e}function fe(e){switch(e.type){case"none":case"record_count":return e.type;case"property_group":{const t=e.groupByOption??"undefined";return`group:${e.property}-${t}`}case"aggregation":return`aggregation:${e.property}-${e.aggregation??"undefined"}`;default:(0,w().HB)(e)}}function he(e){const{collectionContextStore:t,selectedProperty:o,properties:i,callsite:r,handlePropertySelect:l,originProps:d,disabled:u,rightStyle:p,...m}=e,S=(0,g().tz)(),[f,x]=n.useState(""),b=(0,a().uB)(void 0,Y().A),C=(0,a().O$)(b).open,I=(0,a().O$)(t.normalizedSchemaStore),_=i.length>se().R8,T=(0,a().K8)((()=>{const e=N().$z(i,(e=>e.sectionName));return me[r].map((t=>{const o=e[t]??[];return[...o.filter((e=>"none"===e.key.type)),...o.filter((e=>"none"!==e.key.type)).sort(((e,t)=>e.name<t.name?-1:e.name>t.name?1:0))]}))}),[i,r]),k=(0,a().K8)((()=>{if(f.length>0){return T.map((e=>G().filter(f,e,{extract:e=>e.name}).map((({original:e})=>e))))}return T}),[f,T]),M=(0,s().DP)(),P=(0,s().IS)((()=>({propertyIcon:{fill:j().Tj.icon.primary}})),[]);function B(){if(!o)return(0,A.jsx)(g().sA,{...y().G_.none});const e=e=>{for(let t=0;t<e.length;t++){const n=e[t];if(fe(n.key)===fe(o))return n}},t=e(i);if(t)return"property_group"===t.key.type&&t.sectionName===ge?(0,A.jsx)("span",{style:z().RC,children:`${t.name} (${(0,y().TQ)({aggregation:{property:t.key.property,aggregator:"unique"},databaseType:void 0,intl:S})})`}):(0,A.jsx)("span",{style:z().RC,children:t.name});const n=(t=>{for(let o=0;o<t.length;o++){const n=t[o];if(n.subMenuItems){const t=e(n.subMenuItems);if(t)return{subMenuItem:t,menuItem:n}}}})(i);return n?(0,A.jsx)("span",{style:z().RC,children:`${n.menuItem.name} (${n.subMenuItem.name})`}):(0,A.jsx)(g().sA,{...y().G_.none})}function V(e){const{key:t,name:n,subMenuItems:i}=e;let r;if("record_count"===t.type)r=(0,A.jsx)(v().I,{icon:ne().i});else if("property_group"===t.type){const e=(0,F()._g)({schema:I,property:t.property});r=e?(0,A.jsx)(oe().zB,{type:e.type,icon:e.icon,size:D().Ev.sm,theme:M,style:{fill:P.propertyIcon.fill}}):void 0}if(i&&i.length>0){return{key:n,render:(e,t)=>(0,A.jsx)(ae().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,A.jsx)(Z().A,{...e,ref:t,title:n,icon:r}),renderExtension:(e,o)=>{let n;return n=h().A.isMobile?{menuType:X().gu.ActionSheet}:{menuType:X().gu.Popup,width:200},(0,A.jsx)(J().A,{...n,...e,children:(0,A.jsx)(te().A,{type:te().O.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,A.jsx)(c().A,{...e}),items:N().oE(null==i?void 0:i.map(V))}],onAccept:t.onAccept})})}}),action:()=>null}}const a=o&&fe(o)===fe(t);let s=n;"aggregation"===t.type&&(s="value"===t.aggregation?S.formatMessage(y().bg.chartAggregateByValues):"unique"===t.aggregation?S.formatMessage(xe.distinctValues):ie().zY[t.aggregation]);const d={key:n,render:e=>(0,A.jsx)(Z().A,{...e,title:s,icon:r,isChecked:a}),action:t=>{l(e)}};return d}return(0,A.jsx)(re().A,{focused:!1,buttonPopupStore:b,alignmentToOrigin:"end",placementToOrigin:"bottom",popupType:h().A.isMobile?q().z.SlideUp:q().z.Popup,onClose:()=>{x((()=>""))},renderOrigin:e=>(0,A.jsx)(ce().A,{...(0,Q().A)(e,m),showChevron:!0,rotateChevron:C,icon:d.icon,title:d.title,right:B(),disabled:u,rightStyle:p}),render:e=>{const t=h().A.isMobile?{menuType:X().gu.ActionSheet}:{menuType:X().gu.Popup,width:250,maxHeight:400},o=[];if(_){const e={key:de,items:[{key:de,render:(e,t)=>(0,A.jsx)(le().Ay,{...e,value:f,onChange:e=>{x((()=>e.target.value))},focusInitial:!0,placeholder:S.formatMessage({id:"database.viewSettings.ChartSettingsPropertySearchMenuItem.searchPlaceholder",defaultMessage:"Search properties..."})}),action:e=>{}}],showNoResultMessage:!0,render:e=>(0,A.jsx)(c().A,{isInput:!0,...e})};o.push(e)}if(k.some((e=>e.length>0)))k.forEach((e=>{if(0===e.length)return;const t=e[0].sectionName,n={key:t,items:e.map(V).filter(w().O9),render:e=>(0,A.jsx)(c().A,{...e,topBorder:t!==ue})};o.push(n)}));else{const e=S.formatMessage(y().bg.noResultsMenuItem),t={key:e,items:[{key:`${e}-item`,action:()=>{},render:e=>(0,A.jsx)(ee().u,{title:(0,A.jsx)(g().sA,{...y().bg.noResultsMenuItem})})}],render:e=>(0,A.jsx)(c().A,{...e})};o.push(t)}return(0,A.jsx)(J().A,{...t,children:(0,A.jsx)(te().A,{initialFocus:0,type:te().O.Vertical,sections:o,onAccept:t=>{t.key!==de&&e.close()}})})}})}const xe=(0,g().YK)({distinctValues:{id:"database.viewSettings.ChartSettingsPropertySearchMenuItem.distinctValues",defaultMessage:"Distinct values"}});function ve(e){var t;const{environment:o,menuItem:n,chartConfig:i,collectionSchema:r,collectionViewStore:l,collectionContextStore:a,mainPropertyId:s}=e,{key:c,sectionName:d}=n,p=(0,k().o_)({property:s,collectionSchema:r,hideEmptyGroups:"donut"===i.type||Boolean(null===(t=i.chartFormat)||void 0===t?void 0:t.axisHideEmptyGroups)});if(!p)return;let g=(0,N().mg)(i);const m="groups_reducer"===g.dataConfig.type?g.dataConfig.groupBy:p;if(m){if("property_group"===c.type){if(d!==ge)return;"donut"===g.type?g.dataConfig={type:"groups_reducer",groupBy:m,aggregationConfig:{aggregation:{aggregator:"unique",property:c.property}}}:g=(0,M().CN)({chartConfig:g,xAxisPropertyId:s,newDataConfigType:"groups_reducer",groupBy:m,aggregation:{aggregator:"unique",property:c.property}})}"donut"===g.type?"record_count"===c.type?g.dataConfig={type:"groups_reducer",groupBy:m,aggregationConfig:{aggregation:{aggregator:"count"}}}:"aggregation"===c.type&&("value"===c.aggregation?g.dataConfig={type:"results_reducer",nameProperty:s,valueProperty:c.property}:g.dataConfig={type:"groups_reducer",groupBy:m,aggregationConfig:{aggregation:{aggregator:c.aggregation,property:c.property}}}):"record_count"===c.type?g=(0,M().CN)({chartConfig:g,xAxisPropertyId:s,newDataConfigType:"groups_reducer",groupBy:m,aggregation:{aggregator:"count"}}):"aggregation"===c.type&&(g="value"===c.aggregation?(0,M().CN)({chartConfig:g,xAxisPropertyId:s,newDataConfigType:"results_reducer",groupBy:m,valueProperty:c.property}):(0,M().CN)({chartConfig:g,xAxisPropertyId:s,newDataConfigType:"groups_reducer",groupBy:m,aggregation:{aggregator:c.aggregation,property:c.property}})),$().createAndCommit({userAction:(0,u().m)(g)?"chartSettings.setYAxis":"chartSettings.setDonutSlice",environment:o,canUndo:!0,perform:e=>{U().zv({store:l.getFormatStore().getKeyStore("chart_config"),data:g,transaction:e})}}),(0,L().X)({environment:o,collectionContextStore:a,action:(0,u().m)(g)?"charts_y_axis_what_to_show":"charts_donut_slice_value",charts_analytics_context:(0,H().nL)(a)})}}var be=()=>o(812480);function Ce({chartConfig:e,chartError:t,disabled:o}){const i=(0,l().v3)(),r=(0,m().ET)(),c=(0,g().tz)(),u=(0,s().IS)((()=>({errorIcon:{...(0,y().FE)()}})),[]),p=(0,y().k1)(),S=(0,a().K8)((()=>r.collectionViewStore()),[r]),f=(0,a().O$)(r.normalizedSchemaStore),h=null==e?void 0:e.dataConfig,x=(0,a().K8)((()=>{if("groups_reducer"===(null==h?void 0:h.type)){const e=h.groupBy;return(0,V().sj)(e)||(0,V().Ik)(e)?{type:"property_group",property:e.property,groupByOption:e.groupBy}:{type:"property_group",property:h.groupBy.property}}if("results_reducer"===(null==h?void 0:h.type))return{type:"property_group",property:h.nameProperty}}),[h]),C=t&&(0,d().lc)(t)?()=>(0,A.jsx)(v().I,{icon:R().exclamationMarkTriangleFillIcon,style:u.errorIcon}):K().j,j=(0,a().K8)((()=>{const e=(0,w().WP)(f),t=[];return e.forEach((([e,o])=>{o&&((0,V().iF)(o.type)?t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ue,subMenuItems:V().PC.map((t=>({key:{type:"property_group",property:e,groupByOption:t},name:c.formatMessage(be().eD[t]),sectionName:ue})))}):(0,M().zn)(o)?t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ue,subMenuItems:V().BI.map((t=>({key:{type:"property_group",property:e,groupByOption:t},name:c.formatMessage(be().WK[t]),sectionName:ue})))}):(0,V().Eg)(o)&&t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ue}))})),t}),[f,c]),I=n.useCallback((t=>{var o;const{key:n}=t,{property:l,groupByOption:a}=n;if(!e||!S)return;const s=f[l],c=(0,k().o_)({property:l,collectionSchema:f,hideEmptyGroups:!0});if(!s||!c)return;const d=Object.keys(f),u="results_reducer"===e.dataConfig.type?e.dataConfig.valueProperty:d.find((e=>{const t=f[e];return Boolean(t&&(0,k().Iw)(t))})),p={aggregator:"count"},g=N().mg(e);if(s&&(0,k().tH)(s)&&u)g.dataConfig={type:"results_reducer",nameProperty:l,valueProperty:u};else if(a){const e=(0,M().xS)({property:l,propertySchema:s,groupByOption:a,hideEmptyGroups:!0});e&&(g.dataConfig={type:"groups_reducer",groupBy:e,aggregationConfig:{aggregation:p}})}else if(c){const t="groups_reducer"===e.dataConfig.type?e.dataConfig.aggregationConfig.aggregation:p;g.dataConfig={type:"groups_reducer",groupBy:c,aggregationConfig:{aggregation:t}};const o="formula"===c.type?c.groupBy.sort:c.sort;g.chartFormat={...e.chartFormat,mainSort:s&&(0,P().e0)(s)?P().S0.yDescending:(0,P().gN)(o)}}(0,y().Qn)({environment:i,collectionContextStore:r,chartConfig:g,sort:null===(o=g.chartFormat)||void 0===o?void 0:o.mainSort}),$().createAndCommit({userAction:"chartSettings.setDonutGroupBy",environment:i,canUndo:!0,perform:e=>{U().zv({store:S.getFormatStore().getKeyStore("chart_config"),data:g,transaction:e})}}),(0,L().X)({environment:i,collectionContextStore:r,action:"charts_donut_property",charts_analytics_context:(0,H().nL)(r)})}),[f,S,i,e,r]);return(0,A.jsx)(b().m,{textWrap:!0,placement:"left",disableTooltip:!t||!(0,d().lc)(t),renderTooltip:e=>t?(0,A.jsx)("span",{...e,children:(0,W().y)(t)}):null,render:e=>(0,A.jsx)(he,{...e,collectionContextStore:r,selectedProperty:x,properties:j,handlePropertySelect:I,originProps:{title:(0,A.jsx)("span",{children:(0,A.jsx)(g().sA,{...y().bg.chartWhatToShow})}),icon:C},callsite:"main_property",disabled:o,rightStyle:p.whatToShowRightText})})}function je({chartConfig:e,chartError:t,disabled:o}){const i=(0,g().tz)(),r=(0,l().v3)(),c=(0,m().ET)(),u=(0,s().IS)((()=>({errorIcon:{...(0,y().FE)(),marginInlineStart:4}})),[]),p=(0,y().k1)(),S=(0,a().K8)((()=>c.collectionViewStore()),[c]),f=(0,a().K8)((()=>c.databaseTypeFromStoreState),[c]),h=(0,a().O$)(c.normalizedSchemaStore),x=null==e?void 0:e.dataConfig,C=(0,a().K8)((()=>{if(x)return"groups_reducer"===x.type?x.groupBy.property:x.nameProperty}),[x]),j=C?h[C]:void 0,I=(0,a().K8)((()=>{if(x)if("groups_reducer"===x.type){const e=null==x?void 0:x.aggregationConfig.aggregation;if((0,B().Iq)(e))return{type:"record_count"};if(ye(e.aggregator)){const t=(0,F()._g)({schema:h,property:e.property});if(!t)return;return(0,M().JW)(t)||"unique"!==e.aggregator?{type:"aggregation",property:e.property,aggregation:e.aggregator}:{type:"property_group",property:e.property}}}else if("results_reducer"===x.type&&x.valueProperty)return{type:"aggregation",property:x.valueProperty,aggregation:"value"}}),[h,x]),_=(0,a().K8)((()=>{if(!x||!j)return[];const e=[];(0,w().WP)(h).forEach((([t,o])=>{if(!o||t===C||!(0,V().Eg)(o))return;const n=[];(0,k().Iw)(o)&&(0,k().tH)(j)&&n.push({key:{type:"aggregation",property:t,aggregation:"value"},name:i.formatMessage(y().bg.chartAggregateByValues),sectionName:pe});const r=(0,M().JW)(o);if(r){Se.forEach((e=>{const o={aggregator:e,property:t},r={key:{type:"aggregation",property:t,aggregation:e},name:(0,y().TQ)({aggregation:o,databaseType:f,intl:i})||"",sectionName:pe};n.push(r)}));const e={key:{type:"aggregation",property:t,aggregation:"unique"},name:(0,y().TQ)({aggregation:{aggregator:"unique",property:t},databaseType:f,intl:i})||"",sectionName:pe};n.push(e)}const l={key:{type:"property_group",property:t},name:o.name,sectionName:r?pe:ge,subMenuItems:n};e.push(l)}));return[{key:{type:"record_count"},name:(0,y().TQ)({aggregation:{aggregator:"count"},databaseType:f,intl:i})||"",sectionName:"default"},...e]}),[x,j,h,f,i,C]),T=(0,a().K8)((()=>t&&(0,d().dG)(t)?function(){return(0,A.jsx)(v().I,{icon:R().exclamationMarkTriangleFillIcon,style:u.errorIcon})}:O),[t,u.errorIcon]),P=n.useCallback((t=>{S&&e&&C&&ve({environment:r,menuItem:t,chartConfig:e,collectionSchema:h,collectionViewStore:S,collectionContextStore:c,mainPropertyId:C})}),[e,h,S,r,C,c]);return(0,A.jsx)(b().m,{textWrap:!0,placement:"left",disableTooltip:!t||!(0,d().dG)(t),renderTooltip:e=>t?(0,A.jsx)("span",{...e,children:(0,W().y)(t)}):null,render:e=>(0,A.jsx)(he,{...e,collectionContextStore:c,selectedProperty:t?void 0:I,properties:_,handlePropertySelect:P,originProps:{title:(0,A.jsx)("span",{style:z().RC,children:(0,A.jsx)(g().sA,{...y().bg.chartSliceDonutAggregation})}),icon:T},callsite:"aggregation_property",disabled:o,rightStyle:p.donutSliceValueRightText})})}var we=()=>o(664594),Ae=()=>o(300474),Ie=()=>o(357264),_e=()=>o(991003),Te=()=>o(140934),ke=()=>o(245720),Me=()=>o(98126),Pe=()=>o(406094),Be=()=>o(160432),Ve=(o(964979),o(814603),o(147566),o(198721),()=>o(692031)),Fe=()=>o(675133),De=()=>o(792057),Ee=()=>o(128933),Oe=()=>o(148307),Re=()=>o(526920),Ke=()=>o(423213);function Ne(e){return{width:Ke().o0+Ke().eq+Ke().PB,height:Ke().p0+Ke().jQ+Ke().PB}}async function ze(e){const{environment:t,previewCanvas:o,chartStore:n}=e,{chart:i,responsiveChartOptions:r,exportBackgroundColor:l}=n.state;if(o)if("png"===e.format){const c=o.toDataURL("image/png");if("copy"===e.type){const d=await(0,Ve().r)();async function u(){const e=await fetch(c);return await e.blob()}const p=new ClipboardItem({"image/png":u()});try{await navigator.clipboard.write([p]),Ee().D6({label:Fe().A.formatMessage(d.copiedImageToClipboard)})}catch(s){De().f1(Fe().A.formatMessage(d.copyImageError))}}else if(t.device.isMobileNative){var a;null===(a=t.mobileNative)||void 0===a||a.showLightBoxV2({url:c,downloadName:`${Fe().A.formatMessage(Ke().jV.chart)}.png`,type:"image",from:"chart",state:"url_ready"})}else{const g=document.createElement("a");g.href=c,g.download=`${Fe().A.formatMessage(Ke().jV.chart)}.png`,g.click()}}else if("svg"===e.format){if("copy"===e.type)return;null==i||i.exportChartLocal({type:"image/svg+xml",filename:Fe().A.formatMessage(Ke().jV.chart)},{...(0,Ke().j2)(l),...r??{}})}else(0,w().HB)(e.format)}var Le=()=>o(532564),Ue=()=>o(789586);const We=290,He=8,$e=14;const Ge=function(e){const t=(0,g().tz)(),n=(0,l().Y0)();return h().A.isMobile&&n.isAndroid?null:(0,A.jsx)(re().A,{focused:!1,popupType:h().A.isMobile?q().z.SlideUp:q().z.Popup,placementToOrigin:"top",alignmentToOrigin:"center",render:e=>(0,A.jsx)(Qe,{menuParent:e}),renderOrigin:n=>(0,A.jsx)(ce().A,{...n,showChevron:!0,disabled:e.disabled,title:t.formatMessage(Ke().jV.exportChart),icon:o(820579).arrowLineDownIcon})})};function Qe(e){const t=(0,l().v3)(),o=(0,we().T)(),i=(0,g().tz)(),r=(0,Le().V)(),d=(0,m().ET)(),u=(0,Ae().r)(),p=(0,Ue().P)({name:"watermarkless_chart_export",spaceId:u,userId:o}),S=n.useRef(null),{isLoading:y,hasError:f,exportDisabled:x}=(0,a().K8)((()=>({isLoading:"loading"===r.state.previewCanvasState,hasError:"error"===r.state.previewCanvasState,exportDisabled:"loading"===r.state.previewCanvasState||"error"===r.state.previewCanvasState})),[r]),v=(0,n.useMemo)((()=>Re().Q1.filter((e=>!(!p&&"none"===e)))),[p]),b=(0,s().IS)((()=>({copyButton:{height:h().A.isMobile?36:32,fontSize:h().A.isMobile?16:14},downloadButton:{height:h().A.isMobile?36:32,fontSize:h().A.isMobile?16:14,display:"flex",justifyContent:"center",marginTop:8,background:j().Tj.background.primary}})),[]),C=h().A.isMobile?{menuType:X().gu.Modal,title:i.formatMessage(Ke().jV.exportChart),right:(0,A.jsx)(g().sA,{...ke().W.done}),onClickRight:e.menuParent.close}:{menuType:X().gu.Popup,width:We},w=[{key:"preview",render:e=>(0,A.jsx)(qe,{...e,previewCanvasRef:S,isLoading:y,hasError:f}),items:[]},{key:"background",render:e=>(0,A.jsx)(c().A,{...e,title:i.formatMessage(Ke().jV.exportChartBackground),mobileTitleStyle:{lineHeight:void 0},disableMobileBorders:!0,children:(0,A.jsx)("div",{style:{display:"flex",justifyContent:"space-between",paddingInlineStart:$e+3,paddingInlineEnd:$e+3,paddingTop:He,paddingBottom:He},children:e.children})}),items:v.map((e=>({key:e,render:t=>(0,A.jsx)(Xe,{menuListItemProps:t,disabled:x,colors:v,color:e}),action:()=>{r.setState({...r.state,exportBackgroundColor:e})}})))},{key:"export",render:e=>(0,A.jsx)(c().A,{...e,topBorder:!0,disableMobileBorders:!0,children:(0,A.jsx)("div",{style:{display:"flex",flexDirection:"column",padding:"8px 14px",paddingTop:8},children:e.children})}),items:[{key:"copyPng",render:e=>(0,A.jsx)(Be().A,{colorPalette:"blue",...e,style:b.copyButton,disabled:x,children:i.formatMessage(Ke().jV.copyPng)}),action:async()=>{await ze({environment:t,previewCanvas:S.current,chartStore:r,type:"copy",format:"png"}),(0,L().X)({environment:t,collectionContextStore:d,action:"charts_export_copy_png",charts_analytics_context:(0,H().nL)(d)})}},{key:"downloadPng",render:e=>(0,A.jsx)(Pe().A,{...e,size:"lg",style:b.downloadButton,disabled:x,disabledFeedback:x,children:i.formatMessage(Ke().jV.downloadPng)}),action:async()=>{await ze({environment:t,previewCanvas:S.current,chartStore:r,type:"download",format:"png"}),(0,L().X)({environment:t,collectionContextStore:d,action:"charts_export_download_png",charts_analytics_context:(0,H().nL)(d)})}},{key:"downloadSvg",render:e=>h().A.isMobile?null:(0,A.jsx)(Pe().A,{...e,size:"lg",style:b.downloadButton,disabled:x,disabledFeedback:x,children:i.formatMessage(Ke().jV.downloadSvg)}),action:async()=>{await ze({environment:t,previewCanvas:S.current,chartStore:r,type:"download",format:"svg"})}}]}];return(0,A.jsx)(J().A,{...C,children:(0,A.jsx)(te().A,{initialFocus:0,type:te().O.Vertical,sections:w})})}function qe(e){const t=(0,g().tz)(),o=(0,s().eP)(),i=(0,j().O4)({theme:o}),r=(0,Le().V)(),l=(0,a().K8)((()=>r.state.exportBackgroundColor),[r]),d=(0,_e().A)(!0,Ke().Yp,0,!1);n.useEffect((()=>{const t=new(Te().ComputedStore)((()=>({chart:r.state.chart,exportBackgroundColor:r.state.exportBackgroundColor,responsiveChartOptions:r.state.responsiveChartOptions})),{debugName:"chartDrawingStateStore"});function o(){const o=e.previewCanvasRef.current;o&&function(e,t,o,n){const{chart:i,responsiveChartOptions:r,exportBackgroundColor:l}=t;o((()=>{}));const a=e.getContext("2d");if(!i||!a)return;let s;setTimeout((()=>{o((e=>void 0===e?"loading":e))}),Ke().Yp);try{s=i.getSVG({...(0,Ke().j2)(l),...r??{}})}catch(f){return console.error(f),void o((()=>"error"))}const c=new Blob([s],{type:"image/svg+xml;charset=utf-8"}),d=URL.createObjectURL(c),u=new Image,p=new Image,g=new Image,m=new Promise(((e,t)=>{"gradient"===l?(u.onload=()=>e(u),u.onerror=()=>t(new Error("Failed to load gradient image")),u.src="light"===n.mode?Oe().A.images.charts.chartsExportGradientLightPng:Oe().A.images.charts.chartsExportGradientDarkPng):e(u)})),S=new Promise(((e,t)=>{p.onload=()=>e(p),p.onerror=()=>t(new Error("Failed to load chart image")),p.src=`data:image/svg+xml;charset=utf-8;base64,${btoa(unescape(encodeURIComponent(s)))}`})),y=new Promise(((e,t)=>{g.onload=()=>e(g),g.onerror=()=>t(new Error("Failed to load chart image")),g.src="light"===n.mode?Oe().A.images.charts.chartsExportLogoLightPng:Oe().A.images.charts.chartsExportLogoDarkPng}));Promise.all([m,S,y]).then((([t,i,r])=>{URL.revokeObjectURL(d);const s=Ne();if(e.width=s.width*Ke().Zz,e.height=s.height*Ke().Zz,a.scale(Ke().Zz,Ke().Zz),"gradient"===l?a.drawImage(t,0,0,e.width,e.height):"none"===l?(a.fillStyle=n.background.primary,a.fillRect(0,0,e.width,e.height)):(a.fillStyle=(0,Re().NF)(n,l,!1),a.fillRect(0,0,e.width,e.height)),"none"!==l&&(a.strokeStyle=j().Tj.border.secondaryTranslucent,a.fillStyle=n.background.primary,a.shadowColor="dark"===n.mode?"rgba(0, 0, 0, 0.25)":"rgba(0, 0, 0, 0.07)",a.shadowBlur=24,a.shadowOffsetY=8,a.beginPath(),a.roundRect(Ke().iq,Ke().XC,e.width/Ke().Zz-Ke().eq,e.height/Ke().Zz-Ke().jQ,12),a.stroke(),a.fill(),a.shadowColor="transparent"),"none"!==l){const e=Fe().A.formatMessage(Ke().jV.madeWithNotion);a.font=`14px ${z().Tf.sans}`;const t=s.width/2+Ke().ev+Ke().kC,o=s.height-Ke().XC/2;a.textAlign="center",a.textBaseline="middle",a.fillStyle=n.text.tertiary,a.fillText(e,t,o);const i=a.measureText(e),l=s.width/2-i.width/2,c=o-Ke().kC/2;a.drawImage(r,0,0,r.width,r.height,l,c,Ke().kC,Ke().kC)}"none"===l?a.drawImage(i,Ke().AI,Ke().AI):a.drawImage(i,Ke().iq+Ke().AI,Ke().XC+Ke().AI),o((()=>"success"))})).catch((()=>{o((()=>"error"))}))}(o,t.state,r.updatePreviewState,i)}return o(),t.addListener(o),()=>{t.removeListener(o)}}),[e.previewCanvasRef,r,i]);const u=(0,s().IS)((()=>{const t=We-2*$e,o=Ne(),n=t*(o.height/o.width);return{container:{width:`calc(100% - ${2*$e})`,height:e.isLoading||e.hasError?n:void 0,display:"flex",alignItems:"center",justifyContent:"center",marginTop:He,marginInlineStart:$e,marginInlineEnd:$e,border:`1px solid ${j().Tj.border.secondaryTranslucent}`,borderRadius:6,fontSize:12,color:j().Tj.text.tertiary},canvas:{width:"100%",borderRadius:6,display:e.isLoading||e.hasError?"none":"block"}}}),[e.hasError,e.isLoading,l]);return(0,A.jsx)(c().A,{title:t.formatMessage(Ke().jV.exportChartPreview),disableMobileBorders:!0,mobileTitleStyle:{lineHeight:void 0},children:(0,A.jsxs)("div",{style:u.container,children:[(0,A.jsx)("canvas",{style:u.canvas,ref:e.previewCanvasRef}),d&&e.isLoading?(0,A.jsx)(Me().k,{}):void 0,e.hasError?(0,A.jsx)("span",{children:t.formatMessage(Ie().k.generic_error)}):void 0]})})}const Ye=10;function Xe(e){const t=(0,g().tz)(),o=(0,Le().V)(),n=(0,a().K8)((()=>e.color===o.state.exportBackgroundColor),[o,e.color]),i=(0,s().DP)(),r=(0,s().IS)((()=>({button:{position:"relative",width:`calc((100%  / ${e.colors.length}) - ${Ye}px)`,height:h().A.isMobile?36:28,borderRadius:4,boxShadow:`0 0 0 2px ${j().Tj.popoverBackground}, 0 0 0 3px ${j().Tj.border.secondaryTranslucent}`,background:(0,Re().NF)(i,e.color,!1)},selectedButton:{boxShadow:`0 0 0 2px ${j().Tj.popoverBackground}, 0 0 0 4px ${j().Tj.blue.border.accentPrimary}`},hoveredStyle:{background:(0,Re().NF)(i,e.color,!0)},pressedStyle:{background:(0,Re().NF)(i,e.color,!1)}})),[e.color,e.colors.length,i]);return(0,A.jsx)(x().Ay,{...e.menuListItemProps,style:{...r.button,...n?r.selectedButton:{}},hoveredStyle:r.hoveredStyle,pressedStyle:r.pressedStyle,ariaLabel:t.formatMessage((0,Re().nH)(e.color)),disabled:e.disabled,disabledFeedback:e.disabled})}const Je={viewBox:"0 0 20 20",fittedViewBox:"3.75 9 12.5 2.01",svg:(0,A.jsx)("path",{d:"M4.75 9a1 1 0 1 1 0 2 1 1 0 0 1 0-2m3.5 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2m3.5 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2m3.5 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"})},Ze=(0,D().wt)("dottedLineHorizontal",Je,"default");var et=()=>o(695115),tt=()=>o(606476),ot=()=>o(493552),nt=()=>o(617668),it=()=>o(236262);var rt=()=>o(206267);function lt(e,t,o,n,i,r){var l;const a=n.getChartFormatStore();if(!a||!o.chartFormat)return;const s=(null===(l=o.chartFormat)||void 0===l?void 0:l.referenceLines)??[];if(!s.some((t=>t.id===e)))return;const c=s.map((o=>o.id===e?{...o,...t}:o));$().createAndCommit({userAction:"chartSettings.updateReferenceLine",environment:i,canUndo:!0,perform:e=>{U().KY({store:a.getKeyStore("referenceLines"),value:c,transaction:e})}}),(0,L().X)({environment:i,collectionContextStore:r,action:"charts_style_reference_line_update"})}function at(e,t,o,n,i){var r;const l=o.getChartFormatStore();if(!l||!t.chartFormat)return;const a=(null===(r=t.chartFormat)||void 0===r?void 0:r.referenceLines)??[];if(!a.some((t=>t.id===e)))return;const s=a.filter((t=>t.id!==e));$().createAndCommit({userAction:"chartSettings.removeReferenceLine",environment:n,canUndo:!0,perform:e=>{U().KY({store:l.getKeyStore("referenceLines"),value:s,transaction:e})}}),(0,L().X)({environment:n,collectionContextStore:i,action:"charts_style_reference_line_remove"})}var st=()=>o(278238),ct=()=>o(854705),dt=()=>o(29037);const ut=(0,g().YK)({gray:{defaultMessage:"Black",id:"chartReferenceLineColorPicker.color.gray"}});function pt(e){return"gray"===e?ut.gray:st().jd[e]}function gt(e){const{collectionViewStore:t,chartConfig:o,disabled:i,referenceLineId:r}=e,s=(0,g().tz)(),c=(0,l().v3)(),d=(0,m().ET)(),u=(0,a().uB)(void 0,Y().A),p=(0,n.useMemo)((()=>{var e;const t=null===(e=o.chartFormat)||void 0===e||null===(e=e.referenceLines)||void 0===e||null===(e=e.find((e=>e.id===r)))||void 0===e?void 0:e.color;return t||"gray"}),[o,r]),S=(0,n.useCallback)(((e,n)=>{lt(r,{color:e},o,t,c,d),n.close()}),[r,o,t,c,d]);return(0,A.jsx)(q().A,{popupType:h().A.isMobile?q().z.BottomSheet:q().z.Popup,buttonPopupStore:u,bottomSheetInitialState:"half",renderOrigin:e=>h().A.isMobile?(0,A.jsx)(St,{...e,selectedColor:p,disabled:i,title:s.formatMessage(y().v5.color)}):(0,A.jsx)(mt,{...e,selectedColor:p,buttonPopupStore:u,disabled:i,title:s.formatMessage(y().v5.color)}),render:e=>h().A.isMobile?(0,A.jsx)(ft,{selectedColor:p,onColorChange:t=>{S(t,e)}}):(0,A.jsx)(yt,{selectedColor:p,onColorChange:t=>{S(t,e)}})})}function mt({selectedColor:e,buttonPopupStore:t,disabled:o,title:n,...i}){const r=(0,g().tz)(),l=(0,a().K8)((()=>t.state.open),[t]),c=(0,s().eP)(),d=(0,s().IS)((()=>({colorMenuButton:{display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",gap:4,height:24,marginInlineStart:"auto"},colorDisplayContainer:{display:"flex",alignItems:"center",gap:8},colorCircle:{width:16,height:16,borderRadius:4,backgroundColor:st().l8[c][e]},chevronIcon:{transform:l?void 0:"rotate(calc(var(--direction, 1) * -90deg))",transition:"transform 0.2s ease"}})),[l,e,c]);return(0,A.jsx)(ce().A,{...i,icon:void 0,title:n,disabled:o,right:(0,A.jsxs)("div",{style:d.colorMenuButton,children:[(0,A.jsxs)("div",{style:d.colorDisplayContainer,children:[(0,A.jsx)("div",{style:d.colorCircle}),(0,A.jsx)(ot().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:r.formatMessage(pt(e))})]}),(0,A.jsx)(v().I,{icon:ct().arrowChevronSingleDownFillSmallIcon,size:"sm",colorVariant:"tertiary",style:d.chevronIcon})]})})}function St({selectedColor:e,disabled:t,title:o,...n}){const i=(0,g().tz)(),r=(0,s().eP)(),l=(0,s().IS)((()=>({colorCircle:{width:22,height:22,borderRadius:6,margin:0,backgroundColor:st().l8[r][e]},colorDisplayContainer:{display:"flex",alignItems:"center",gap:8}})),[e,r]);return(0,A.jsx)(ce().A,{...n,icon:void 0,title:o,disabled:t,right:(0,A.jsxs)("div",{style:l.colorDisplayContainer,children:[(0,A.jsx)("div",{style:l.colorCircle}),(0,A.jsx)(ot().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:i.formatMessage(pt(e))})]}),showChevron:!0})}function yt({selectedColor:e,onColorChange:t}){const o=(0,s().IS)((()=>({container:{padding:4},colorGrid:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:8,padding:"6px"}})),[]);return(0,A.jsx)("div",{style:o.container,children:(0,A.jsx)("div",{style:o.colorGrid,children:st().v3.map((o=>{const n=o===e;return(0,A.jsx)(ht,{color:o,onClick:()=>{t(o)},focused:n,selected:n},o)}))})})}function ft({selectedColor:e,onColorChange:t}){const o=[{key:"reference-line-colors",render:e=>(0,A.jsx)(c().A,{...e,children:e.children}),items:st().v3.map((o=>({key:o,action:()=>{t(o)},render:t=>{const n=o===e;return(0,A.jsx)(ht,{...t,color:o,selected:n,focused:n,shouldShowLabel:!0})}})))}];return(0,A.jsx)(J().A,{menuType:X().gu.Modal,title:(0,A.jsx)(g().sA,{defaultMessage:"Select color",id:"ChartReferenceLineColorMenuItem.selectColorTitle"}),children:(0,A.jsx)(te().A,{type:te().O.Vertical,initialFocus:0,sections:o})})}function ht({color:e,selected:t,focused:o,onClick:i,shouldShowLabel:r,...l}){const[a,c]=(0,n.useState)(!1),d=(0,g().tz)().formatMessage(pt(e)),u=(0,s().eP)(),p=(0,s().IS)((()=>{const o=st().l8[u][e];return{tooltipStyle:{display:"inline-block",width:30,padding:0,lineHeight:1},buttonStyle:{display:"inline-block",width:"100%",height:"100%",margin:0,padding:2,position:"relative"},menuItemStyle:{margin:0,padding:0,gap:0,minHeight:20},disableButtonStyleHoverOrPressed:{background:"transparent"},icon:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:r?22:20,height:r?22:20,textAlign:"center",padding:8,margin:0,borderRadius:6,backgroundColor:o,boxShadow:`inset 0 0 0 ${t||a?"2px":"1px"} ${o}`},checkmark:{fill:"white"}}}),[a,t,e,r,u]),m=(0,n.useCallback)((()=>(0,A.jsx)("div",{style:p.icon,"aria-hidden":"true",children:t?(0,A.jsx)(v().I,{icon:dt().checkmarkIcon,style:p.checkmark,size:"xs"}):null})),[p.icon,p.checkmark,t]);return r?(0,A.jsx)(Z().A,{...l,onClick:i,focused:o??!1,icon:m(),title:(0,A.jsx)(g().sA,{...pt(e)})}):(0,A.jsx)(b().m,{renderTooltip:()=>(0,A.jsx)("div",{children:d}),render:e=>(0,A.jsx)("div",{style:p.tooltipStyle,...e,onMouseEnter:t=>{var o;c(!0),null===(o=e.onMouseEnter)||void 0===o||o.call(e,t)},onMouseLeave:t=>{var o;c(!1),null===(o=e.onMouseLeave)||void 0===o||o.call(e,t)},children:(0,A.jsx)(Z().A,{...l,onClick:i,focused:o??!1,icon:m(),style:p.menuItemStyle,hoveredStyle:p.disableButtonStyleHoverOrPressed,pressedStyle:p.disableButtonStyleHoverOrPressed,buttonStyle:p.buttonStyle})})})}var xt=o.n(o(901080)),vt=()=>o(31511);function bt(e){const{title:t,value:o,inputType:i,placeholder:r,disabled:l=!1,maxLength:a,onChange:c,onBlur:d,onSubmit:u,rightIconButton:p}=e,g=(0,s().IS)((()=>({container:{display:"flex",flexDirection:"column",paddingInlineStart:8,paddingInlineEnd:8,marginBottom:2,...h().A.isMobile&&{backgroundColor:j().Tj.background.primary,paddingBottom:6,paddingTop:6,gap:4}},header:{display:"flex",justifyContent:"space-between",alignItems:"center"},title:h().A.isMobile?{color:j().Tj.text.secondary,lineHeight:1.1,fontSize:15}:{color:j().Tj.text.secondary,fontSize:12,lineHeight:"120%",minHeight:24,display:"flex",alignItems:"center",justifyContent:"center"},input:{flexGrow:1,backgroundColor:j().Tj.background.secondary},inputContainer:{flexGrow:1}})),[]),[m,S]=(0,n.useState)(""),y=(0,n.useRef)(""),f=(0,n.useRef)(o);(0,n.useEffect)((()=>{const e=void 0===o?"":o.toString();S(e),y.current=e,f.current=o}),[o]);const x=(0,n.useCallback)((e=>{if("number"===i){if(""===e.trim())return;const t=xt()(e);return isNaN(t)?void 0:t}return""===e.trim()?void 0:e}),[i]),v=(0,n.useCallback)((e=>{const t=e.target.value;S(t),y.current=t;const o=x(t);c(o)}),[c,x]),b=(0,n.useCallback)((()=>{const e=x(y.current);d&&d(e)}),[d,x]),C=(0,n.useCallback)((e=>{if("Enter"===e.key){const e=x(y.current);u&&u(e)}}),[u,x]);return(0,A.jsxs)("div",{style:g.container,children:[(0,A.jsxs)("div",{style:g.header,children:[(0,A.jsx)("div",{style:g.title,children:t}),p||null]}),(0,A.jsx)("div",{style:g.inputContainer,children:(0,A.jsx)(vt().A,{type:"number"===i?"number":"text",value:m,placeholder:r||t,inputClassName:"number"===i?"input-hide-arrows":void 0,maxlength:a,disabled:l,onChange:v,onBlur:b,onKeyDown:C,style:g.input})})]})}const Ct=50;function jt(e){var t,o;const{collectionViewStore:i,chartConfig:r,disabled:l}=e,a=(0,n.useCallback)((e=>{const t=[{key:`chartReferenceLineValue-${e}`,render:(t,o)=>(0,A.jsx)(It,{menuListItemProps:t,parent:o,collectionViewStore:i,chartConfig:r,disabled:l,referenceLineId:e}),action:()=>{}},{key:`chartReferenceLineLabel-${e}`,render:(t,o)=>(0,A.jsx)(At,{menuListItemProps:t,parent:o,collectionViewStore:i,chartConfig:r,disabled:l,referenceLineId:e}),action:()=>{}},{key:`chartReferenceLineStrokeStyle-${e}`,render:(t,o)=>(0,A.jsx)(wt,{menuListItemProps:t,parent:o,collectionViewStore:i,chartConfig:r,disabled:l,referenceLineId:e}),action:()=>{}},{key:`chartReferenceLineColor-${e}`,render:()=>(0,A.jsx)(gt,{collectionViewStore:i,chartConfig:r,disabled:l,referenceLineId:e}),action:()=>{}}];return h().A.isMobile&&t.push({key:`chartReferenceLineDelete-${e}`,render:t=>(0,A.jsx)(Tt,{menuListItemProps:t,collectionViewStore:i,chartConfig:r,disabled:l,referenceLineId:e}),action:()=>{}}),t}),[r,i,l]),d=(0,n.useMemo)((()=>{var e;return((null===(e=r.chartFormat)||void 0===e?void 0:e.referenceLines)??[]).map((e=>({referenceLineId:e.id,items:a(e.id)})))}),[r,a]),u=h().A.isMobile?{menuType:X().gu.ActionSheet}:{menuType:X().gu.Popup,minWidth:280,maxHeight:400},p=void 0===(null===(t=r.chartFormat)||void 0===t?void 0:t.referenceLines)||0===(null===(o=r.chartFormat)||void 0===o||null===(o=o.referenceLines)||void 0===o?void 0:o.length),m=(0,s().IS)((()=>({containerMobile:{padding:12,gap:12,display:"flex",flexDirection:"column",backgroundColor:j().Tj.background.secondary},container:{padding:12,gap:12,display:"flex",flexDirection:"column"},menuItemWrapper:{background:j().Tj.background.secondary,borderRadius:8},emptyStateOuterContainer:{display:"flex",flexDirection:"column",margin:12,gap:12},emptyStateText:{textAlign:"center"}})),[]);return p?(0,A.jsx)(J().A,{...u,children:(0,A.jsxs)("div",{style:m.emptyStateOuterContainer,children:[(0,A.jsx)(ot().D,{styleKey:"captionRegular",colorVariant:"secondary",style:m.emptyStateText,children:(0,A.jsx)(g().sA,{...y().v5.emptyStateDescription})}),(0,A.jsx)(_t,{collectionViewStore:i,chartConfig:r,disabled:l,isReferenceLineEmpty:p})]})}):(0,A.jsx)(J().A,{...u,children:(0,A.jsxs)("div",{style:h().A.isMobile?m.containerMobile:m.container,children:[d.map(((e,t)=>{const o=(0,A.jsx)(te().A,{initialFocus:void 0,type:te().O.Vertical,sections:[{key:`default-${e.referenceLineId}`,items:e.items,render:e=>(0,A.jsx)(c().A,{...e})}],resetFocusOnMouseOut:!0},`menu-list-${e.referenceLineId}`);return h().A.isMobile?(0,A.jsx)(c().A,{title:(0,A.jsx)(g().sA,{defaultMessage:"Reference line {index}",id:"chartSettings.referenceLine.index",values:{index:t+1}}),mobileStyle:{marginBottom:8},children:o},`menu-wrapper-${e.referenceLineId}`):(0,A.jsx)("div",{style:m.menuItemWrapper,children:o},`menu-wrapper-${e.referenceLineId}`)})),(0,A.jsx)(te().A,{type:te().O.Vertical,sections:[{key:"add-reference-line",render:e=>(0,A.jsx)(c().A,{...e,disableDesktopPadding:!0}),items:[{key:"add-reference-line",render:e=>(0,A.jsx)(_t,{...e,collectionViewStore:i,chartConfig:r,disabled:l,isReferenceLineEmpty:p}),action:()=>{}}]}],initialFocus:void 0})]})})}function wt(e){const{collectionViewStore:t,chartConfig:o,disabled:i,referenceLineId:r,menuListItemProps:s}=e,d=(0,g().tz)(),u=(0,l().v3)(),p=(0,m().ET)(),S=(0,a().uB)(void 0,Y().A),f=(0,n.useMemo)((()=>{var e;const t=null===(e=o.chartFormat)||void 0===e||null===(e=e.referenceLines)||void 0===e||null===(e=e.find((e=>e.id===r)))||void 0===e?void 0:e.dashStyle;return t||"Solid"}),[o,r]),x=()=>{const e=(0,w().WP)(y().b$).map((([e,n])=>{const i=f===e,l={key:e,render:e=>(0,A.jsx)(Z().A,{...e,title:(0,A.jsx)(g().sA,{...n}),isChecked:i}),action:()=>{lt(r,{dashStyle:e},o,t,u,p)}};return l}));return e};return(0,A.jsx)(re().A,{...s,popupType:h().A.isMobile?q().z.BottomSheet:q().z.Popup,disabled:i,focused:!1,buttonPopupStore:S,renderOrigin:t=>(0,A.jsx)(ce().A,{...t,icon:void 0,showChevron:!0,rotateChevron:S.state.open,title:d.formatMessage(y().v5.strokeStyle),right:f?(0,A.jsx)(ot().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:d.formatMessage(y().b$[f])}):null,disabled:e.disabled}),render:t=>(0,A.jsx)(J().A,{menuType:X().gu.Popup,children:(0,A.jsx)(te().A,{type:te().O.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"gridStyles",render:e=>(0,A.jsx)(c().A,{...e}),items:x()}]})})})}function At(e){const{collectionViewStore:t,chartConfig:o,disabled:i,referenceLineId:r}=e,a=(0,g().tz)(),s=(0,l().v3)(),c=(0,m().ET)(),d=(0,n.useMemo)((()=>{var e;const t=null===(e=o.chartFormat)||void 0===e||null===(e=e.referenceLines)||void 0===e?void 0:e.find((e=>e.id===r));return(null==t?void 0:t.label)??""}),[o,r]),u=e=>{lt(r,{label:null==e?void 0:e.toString()},o,t,s,c)};return(0,A.jsx)(bt,{title:a.formatMessage(y().v5.label),value:d,inputType:"text",placeholder:a.formatMessage(y().v5.label),disabled:i,maxLength:Ct,onChange:u,onBlur:u,onSubmit:u})}function It(e){var t;const{collectionViewStore:o,chartConfig:i,disabled:r,referenceLineId:a}=e,s=(0,g().tz)(),c=(0,l().v3)(),d=(0,m().ET)(),u=(0,n.useMemo)((()=>{var e;return null===(e=i.chartFormat)||void 0===e||null===(e=e.referenceLines)||void 0===e||null===(e=e.find((e=>e.id===a)))||void 0===e?void 0:e.value}),[null===(t=i.chartFormat)||void 0===t?void 0:t.referenceLines,a]),p=e=>{"number"==typeof e&&lt(a,{value:e},i,o,c,d)};return(0,A.jsx)(bt,{title:s.formatMessage(y().v5.value),value:u,inputType:"number",placeholder:s.formatMessage(y().v5.value),disabled:r,onChange:p,onBlur:p,onSubmit:p,rightIconButton:h().A.isMobile?null:(0,A.jsx)(et().A,{icon:it().trashIcon,ariaLabel:s.formatMessage(y().v5.deleteReferenceLine),onClick:()=>{at(a,i,o,c,d)}})})}function _t(e){var t;const{collectionViewStore:o,chartConfig:i,disabled:r,isReferenceLineEmpty:c}=e,d=(0,g().tz)(),u=(0,l().v3)(),p=(0,m().ET)(),S=((null===(t=i.chartFormat)||void 0===t||null===(t=t.referenceLines)||void 0===t?void 0:t.length)??0)>=M().io,f=function({chartConfig:e,collectionContextStore:t}){const o=(0,Le().V)();return(0,a().K8)((()=>{const e=null==o?void 0:o.state.chart;if(null!=e&&e.yAxis&&e.yAxis.length>0){const t=e.yAxis[0].getExtremes();if(void 0!==t.min&&void 0!==t.max&&t.min!==t.max)return{minValue:t.min,maxValue:t.max}}}),[o])}({chartConfig:i,collectionContextStore:p}),x=(0,n.useMemo)((()=>(0,y().$1)(null==f?void 0:f.minValue,null==f?void 0:f.maxValue)),[f]),C=(0,n.useCallback)((()=>{!function(e,t,o,n,i){var r;const l=t.getChartFormatStore();if(!l||!e.chartFormat)return;const a=(null===(r=e.chartFormat)||void 0===r?void 0:r.referenceLines)??[];if(a.length>=M().io)return;const s={id:rt().JW(),value:i??0,label:"",color:"gray",dashStyle:"Dash"},c=[...a,s];$().createAndCommit({userAction:"chartSettings.addReferenceLine",environment:o,canUndo:!0,perform:e=>{U().KY({store:l.getKeyStore("referenceLines"),value:c,transaction:e})}}),(0,L().X)({environment:o,collectionContextStore:n,action:"charts_style_reference_line_add"})}(i,o,u,p,x)}),[i,o,u,p,x]),w=(0,s().IS)((()=>({button:{width:"100%",justifyContent:"center",...!c&&{borderColor:j().Tj.border.secondary},...h().A.isMobile&&{height:"48px",borderRadius:12},...h().A.isMobile&&!c&&{backgroundColor:j().Tj.background.primary,border:"none"}}})),[c]);return c?(0,A.jsx)(b().m,{disableTooltip:!S,renderTooltip:()=>d.formatMessage(y().v5.maxReferenceLinesReached),render:e=>(0,A.jsxs)(Be().A,{style:w.button,disabled:r||S,onClick:C,colorPalette:"blue",...e,children:[(0,A.jsx)(v().I,{icon:nt().plusIcon}),(0,A.jsx)(g().sA,{...y().v5.addReferenceLine})]})}):(0,A.jsx)(b().m,{disableTooltip:!S,renderTooltip:()=>d.formatMessage(y().v5.maxReferenceLinesReached),render:e=>(0,A.jsxs)(tt().A,{style:w.button,disabled:r||S,onClick:C,...e,children:[(0,A.jsx)(v().I,{icon:nt().plusIcon}),(0,A.jsx)(g().sA,{...y().v5.addReferenceLine})]})})}function Tt(e){const{menuListItemProps:t,collectionViewStore:o,chartConfig:i,disabled:r,referenceLineId:a}=e,s=(0,l().v3)(),c=(0,m().ET)(),d=(0,n.useCallback)((()=>{at(a,i,o,s,c)}),[a,i,o,s,c]);return(0,A.jsx)(Z().A,{...t,focused:!1,icon:(0,A.jsx)(v().I,{icon:it().trashIcon}),onClick:d,title:(0,A.jsx)(g().sA,{...y().v5.deleteReferenceLine}),isRedOnHover:!0,disabled:r})}function kt(e){var t;const{collectionViewStore:o,chartConfig:n,disabled:i}=e,r=(0,a().uB)(void 0,Y().A),l=(null===(t=n.chartFormat)||void 0===t||null===(t=t.referenceLines)||void 0===t?void 0:t.length)??0;return(0,A.jsx)(re().A,{focused:!1,popupType:h().A.isMobile?q().z.BottomSheet:q().z.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",buttonPopupStore:r,renderOrigin:e=>(0,A.jsx)(ce().A,{...e,showChevron:!0,title:(0,A.jsx)(g().sA,{...y().v5.referenceLine}),right:(0,A.jsx)(g().sA,{defaultMessage:"{numberOfReferenceLines, plural, one {1 line} other {{numberOfReferenceLines} lines}}",id:"database.viewSettings.chartStyleTab.referenceLine.referenceLinePreview",values:{numberOfReferenceLines:l}}),rotateChevron:r.state.open,icon:Ze,disabled:i}),render:e=>(0,A.jsx)(jt,{parent:e,collectionViewStore:o,chartConfig:n,disabled:i})})}var Mt=()=>o(622317),Pt=()=>o(708685),Bt=()=>o(582684),Vt=()=>o(447385);const Ft=(0,g().YK)({alphabetical:{defaultMessage:"{propertyName} A â†’ Z",id:"charts.settings.sort.alphabetical"},reverseAlphabetical:{defaultMessage:"{propertyName} Z â†’ A",id:"charts.settings.sort.reverseAlphabetical"},chronological:{defaultMessage:"Old â†’ New",id:"charts.settings.sort.chronological"},reverseChronological:{defaultMessage:"New â†’ Old",id:"charts.settings.sort.reverseChronological"},lowHigh:{defaultMessage:"{propertyName} Low â†’ High",id:"charts.settings.sort.lowHigh"},highLow:{defaultMessage:"{propertyName} High â†’ Low",id:"charts.settings.sort.highLow"},ascending:{defaultMessage:"{propertyName} Ascending",id:"charts.settings.sort.ascending"},descending:{defaultMessage:"{propertyName} Descending",id:"charts.settings.sort.descending"},manual:{defaultMessage:"Manual",id:"charts.settings.sort.manual"},advanced:{defaultMessage:"Advanced",id:"charts.settings.sort.advanced"}});function Dt(e,t){const o=null==e?void 0:e.type;if(!o)return t?Ft.ascending:Ft.descending;if(t)switch(o){case"formula":switch((0,Pt().getFormulaPropertySchemaResultType)(e)){case"date":return Ft.chronological;case"text":return Ft.alphabetical;case"number":return Ft.lowHigh;default:return Ft.ascending}case"title":case"text":case"url":case"email":case"phone_number":case"relation":case"created_by":case"last_edited_by":return Ft.alphabetical;case"date":case"created_time":case"last_edited_time":case"last_visited_time":return Ft.chronological;case"number":return Ft.lowHigh;default:return Ft.ascending}switch(o){case"formula":switch((0,Pt().getFormulaPropertySchemaResultType)(e)){case"date":return Ft.reverseChronological;case"text":return Ft.reverseAlphabetical;case"number":return Ft.highLow;default:return Ft.descending}case"title":case"text":case"url":case"email":case"phone_number":case"relation":case"created_by":case"last_edited_by":return Ft.reverseAlphabetical;case"date":case"created_time":case"last_edited_time":case"last_visited_time":return Ft.reverseChronological;case"number":return Ft.highLow;default:return Ft.descending}}var Et=()=>o(646060),Ot=()=>o(75544),Rt=()=>o(396671),Kt=()=>o(352377),Nt=()=>o(828973);function zt({chartConfig:e,chartError:t,disabled:o,sortType:i}){const r=(0,l().v3)(),s=(0,m().ET)(),c=(0,g().tz)(),d=(0,Et().x)({chartConfig:e,chartError:t,collectionContextStore:s}),{collectionViewStore:p,databaseType:f,collectionSettingsStore:h,numberOfSorts:x}=(0,a().K8)((()=>({collectionViewStore:s.collectionViewStore(),databaseType:s.databaseTypeFromStoreState,collectionSettingsStore:s.settingsStore,numberOfSorts:s.currentSortsStore.state.length})),[s]),v=(0,a().O$)(s.normalizedSchemaStore),b=(0,y().uB)(e,v),{stackedPropertySchema:C,stackedGroupBy:j}=(0,a().K8)((()=>{var t;if("results_reducer"===(null==e?void 0:e.dataConfig.type)||"donut"===(null==e?void 0:e.type))return{stackedPropertySchema:void 0,stackedGroupBy:void 0};const o=null==e||null===(t=e.dataConfig.aggregationConfig.stackOptions)||void 0===t?void 0:t.groupBy,n=null==o?void 0:o.property;return n?{stackedPropertySchema:(0,F()._g)({schema:v,property:n}),stackedGroupBy:o}:{stackedPropertySchema:void 0,stackedGroupBy:void 0}}),[e,v]),w="stacked"===i?C:b,I=(0,a().K8)((()=>!w||"formula"!==w.type||(0,M().Yp)(w)),[w]),_=(0,a().K8)((()=>{var t,o;if(null!=e&&null!==(t=e.chartFormat)&&void 0!==t&&t.mainSort&&"main"===i)return e.chartFormat.mainSort;if("groups_reducer"===(null==e||null===(o=e.dataConfig)||void 0===o?void 0:o.type)){var n;const t="stacked"===i&&j?j:null==e||null===(n=e.dataConfig)||void 0===n?void 0:n.groupBy,o=(0,V().Kq)(t);return"formula"===t.type&&"formula"===(null==b?void 0:b.type)?(0,M().Yp)(b)||(0,M().Yp)(b)?(0,P().gN)(o):M().Rb[i]:(0,P().gN)(o)}return M().Rb[i]}),[e,b,i,j]),T=(0,y().Zv)(e,v),k=(0,a().K8)((()=>{var t;if("groups_reducer"===(null==e||null===(t=e.dataConfig)||void 0===t?void 0:t.type)){const t=null==e?void 0:e.dataConfig.aggregationConfig.aggregation;return(0,y().TQ)({aggregation:t,databaseType:f,intl:c})}return null==T?void 0:T.name}),[e,f,c,T]),B=(0,y().k1)(),D=n.useCallback(((t,o)=>{if(!(p&&e&&b&&I))return;const n=N().mg(e);if("stacked"===i&&"groups_reducer"===n.dataConfig.type&&(0,u().m)(n)){var l;const e=null===(l=n.dataConfig.aggregationConfig.stackOptions)||void 0===l?void 0:l.groupBy;e&&("formula"===e.type?e.groupBy.sort=Ut(t,e.groupBy.type):e.sort=Ut(t,e.type))}if("main"===i&&(n.chartFormat={...n.chartFormat,mainSort:t},"groups_reducer"===n.dataConfig.type&&n.dataConfig.groupBy)){const e=n.dataConfig.groupBy;"formula"===e.type?e.groupBy.sort=Ut(t,e.groupBy.type):e.sort=Ut(t,e.type)}(0,y().Qn)({environment:r,collectionContextStore:s,chartConfig:n,sort:t}),$().createAndCommit({userAction:"chartSettings.setMainSort",environment:r,canUndo:!0,perform:e=>{U().zv({store:p.getFormatStore().getKeyStore("chart_config"),data:n,transaction:e})}}),(0,L().X)({environment:r,collectionContextStore:s,action:"charts_x_axis_sort",charts_analytics_context:(0,H().nL)(s)}),t!==P().S0.manual&&o&&o.close(),t===P().S0.resultsAdvanced&&(0===x?S().a2({collectionSettingsStore:h,item:{type:"createSort"}}):S().a2({collectionSettingsStore:h,item:{type:"sort"}}))}),[p,e,b,I,i,r,s,x,h]);if(!I||!w)return null;const E=[];E.push({key:P().S0.xAscending,type:"button",title:c.formatMessage(Dt(w,!0),{propertyName:w.name})}),E.push({key:P().S0.xDescending,type:"button",title:c.formatMessage(Dt(w,!1),{propertyName:w.name})});const O=[];O.push({key:P().S0.yAscending,type:"button",title:c.formatMessage(Ft.lowHigh,{propertyName:k})}),O.push({key:P().S0.yDescending,type:"button",title:c.formatMessage(Ft.highLow,{propertyName:k})});const R=[];"groups_reducer"===(null==e?void 0:e.dataConfig.type)&&null!=w&&w.type&&(0,y().Iq)(w)&&R.push({key:P().S0.manual,type:"button",title:c.formatMessage(Ft.manual)});return!("checkbox"===(null==w?void 0:w.type)||"person"===(null==w?void 0:w.type)||"formula"===(null==w?void 0:w.type)&&("checkbox"===(0,Pt().getFormulaPropertySchemaResultType)(w)||"person"===(0,Pt().getFormulaPropertySchemaResultType)(w)))&&R.push(...E),"stacked"!==i&&(0,P().e0)(w)&&R.push(...O),"results_reducer"===(null==e?void 0:e.dataConfig.type)&&R.push({key:P().S0.resultsAdvanced,type:"button",title:c.formatMessage(Ft.advanced)}),(0,A.jsx)(Nt().A,{title:(0,A.jsx)(g().sA,{...y().bg.chartSortBy}),selectedKey:_,options:R,icon:Bt().arrowUpDownIcon,iconStyle:{transform:"main"===i?"rotate(-90deg)":void 0},onChange:D,disabled:o,disableParentClose:!0,rightStyle:B.sortByRightText,children:d&&e?(0,A.jsx)(Lt,{groupedChartReducer:d,sortType:i,chartConfig:e}):void 0})}function Lt({groupedChartReducer:e,sortType:t,chartConfig:o}){var n;const i=(0,m().ET)(),r={...e,returnHiddenGroups:!0},l="stacked"===t?"chart_subgroups":"collection_groups",s=null===(n=o.chartFormat)||void 0===n?void 0:n.mainSort,c=(0,a().K8)((()=>{const e=i.normalizedFormatStore.state,o=(0,V().H2)(e,"chart_config",l);return"stacked"===t?(0,V().H2)(e,"chart_config","chart_subgroups"):o}),[i.normalizedFormatStore,l,t]),d=(0,a().K8)((()=>(0,Vt().x)()),[]),u=(0,Ot().A)({id:"chart_subgroups"===l?Mt().VQ:Mt().Ri,reducer:r,collectionContextStore:i,debounceWait:d}),p=(0,Rt().d)("stacked"===t?{subGroupBy:c,reducerResult:u}:{groupBy:c,reducerResult:u}),g=(0,a().K8)((()=>{const e=c?(0,V().Kq)(c):void 0;return"manual"!==(null==e?void 0:e.type)||"main"===t&&("y-ascending"===s||"y-descending"===s)}),[s,c,t]);return c?(0,A.jsx)(Kt().L,{collectionContextStore:i,groupBy:c,groupByKey:"chart_config",groupsFormatKey:"stacked"===t?"chart_subgroups":"collection_groups",groupsDisplayState:p,disableReorder:g}):null}function Ut(e,t){switch(e){case P().S0.manual:return{type:"manual"};case P().S0.xAscending:return{type:"ascending"};case P().S0.xDescending:return{type:"descending"};case P().S0.yAscending:case P().S0.yDescending:default:return(0,V()._o)(t)||"number"===t?{type:"ascending"}:{type:"manual"}}}var Wt=()=>o(287188),Ht=()=>o(638045),$t=()=>o(202017);const Gt={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.69 15.25 11.18",svg:(0,A.jsx)("path",{d:"M14.424 5.248c1.181-1.18 3.201-.344 3.201 1.326V14c0 1.036-.84 1.875-1.875 1.875H4.25A1.875 1.875 0 0 1 2.375 14v-1.959c0-.497.198-.974.55-1.326l2.54-2.54a1.875 1.875 0 0 1 2.65 0l1.25 1.25c.244.243.64.243.884 0zm1.951 1.326a.625.625 0 0 0-1.067-.442l-4.175 4.176a1.875 1.875 0 0 1-2.652 0L7.232 9.059a.625.625 0 0 0-.884 0l-2.54 2.54a.63.63 0 0 0-.183.442V14c0 .345.28.625.625.625h11.5c.345 0 .625-.28.625-.625z"})},Qt=(0,D().wt)("graphArea",Gt,"default"),qt={viewBox:"0 0 20 20",fittedViewBox:"2.51 3.18 14.97 13.63",svg:(0,A.jsx)("path",{d:"M8.455 16.066c-.367.422-.855.747-1.473.747-.838 0-1.426-.584-1.83-1.227-.414-.658-.743-1.54-1.028-2.484-.28-.925-.53-1.957-.777-2.968l-.02-.084c-.255-1.046-.505-2.066-.782-2.962a.625.625 0 1 1 1.194-.37c.29.94.55 1.998.802 3.036l.017.067c.249 1.024.493 2.028.763 2.92.277.92.568 1.67.889 2.18.329.523.59.642.772.642.136 0 .308-.063.53-.318q.344-.394.683-1.226c.45-1.109.817-2.605 1.198-4.167l.008-.035c.371-1.52.757-3.103 1.246-4.306.246-.606.537-1.163.898-1.577.367-.422.855-.747 1.473-.747.837 0 1.422.586 1.824 1.228.412.657.74 1.54 1.024 2.482.276.913.526 1.93.77 2.929l.03.123c.256 1.046.508 2.066.788 2.961a.625.625 0 1 1-1.193.373c-.294-.94-.555-1.998-.81-3.037l-.026-.109c-.247-1.01-.489-1.998-.755-2.878-.278-.92-.568-1.67-.887-2.18-.33-.526-.587-.641-.765-.641-.136 0-.309.062-.53.317q-.345.394-.683 1.226c-.45 1.109-.817 2.605-1.198 4.167l-.008.035c-.371 1.52-.757 3.103-1.246 4.306-.247.606-.537 1.163-.898 1.577"})},Yt=(0,D().wt)("lineCurve",qt,"default");var Xt=()=>o(813197),Jt=()=>o(594952);const Zt={viewBox:"0 0 20 20",fittedViewBox:"2.55 2.37 15.08 15.06",svg:(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("path",{d:"M11 5.938a1 1 0 1 1-2 0 1 1 0 0 1 2 0m1.166 1.896A1 1 0 1 0 13.58 6.42a1 1 0 0 0-1.415 1.414M14.063 11a1 1 0 1 1 0-2 1 1 0 0 1 0 2M7.834 7.835A1 1 0 1 0 6.42 6.42a1 1 0 0 0 1.414 1.415"}),(0,A.jsx)("path",{d:"M2.988 7a7.627 7.627 0 1 1 8.853 10.4l-.042.01-.042.005c-1.061.115-2.019-.829-1.804-1.962l.262-1.38a1.188 1.188 0 0 0-1.282-1.402l-2.025.199c-2.848.28-5.044-2.462-4.148-5.18l.185-.563.015-.05.012-.04zm1.164.457-.02.062-.185.562c-.613 1.86.89 3.737 2.84 3.546l2.023-.2a2.437 2.437 0 0 1 2.633 2.881l-.261 1.38c-.05.262.16.493.408.487a6.375 6.375 0 1 0-7.438-8.718"})]})},eo=(0,D().wt)("paintPalette",Zt,"default");var to=()=>o(922189);const oo={viewBox:"0 0 20 20",fittedViewBox:"4.12 2.37 11.75 15.25",svg:(0,A.jsx)("path",{d:"M15.875 4.5a2.125 2.125 0 0 0-2.125-2.125h-7.5A2.125 2.125 0 0 0 4.125 4.5v11c0 1.174.951 2.125 2.125 2.125h7.5a2.125 2.125 0 0 0 2.125-2.125zm-2.125-.875c.483 0 .875.392.875.875v4.875h-9.25V4.5c0-.483.392-.875.875-.875zm-8.375 7h9.25V15.5a.875.875 0 0 1-.875.875h-7.5a.875.875 0 0 1-.875-.875z"})},no=(0,D().wt)("rectangleSplit2Vertical",oo,"default");var io=()=>o(467248);const ro={viewBox:"0 0 20 20",fittedViewBox:"1.62 4.12 16.75 11.76",svg:(0,A.jsx)("path",{d:"M11.72 4.403a.625.625 0 1 0-1.04.694l2.804 4.205v3.223a.625.625 0 0 0 1.25 0V9.21l2.742-4.113a.625.625 0 0 0-1.04-.694L14.078 7.94zm-7.543.037a.625.625 0 1 0-1.016.729l2.504 3.496-2.504 3.496a.625.625 0 1 0 1.016.728l2.257-3.151 2.257 3.15a.625.625 0 1 0 1.016-.727L7.203 8.665l2.504-3.496a.625.625 0 1 0-1.016-.728L6.434 7.59zM2.25 14.625a.625.625 0 1 0 0 1.25h.005a.625.625 0 0 0 0-1.25zm1.933 0a.625.625 0 1 0 0 1.25h.01a.625.625 0 0 0 0-1.25zm1.937 0a.625.625 0 1 0 0 1.25h.01a.625.625 0 0 0 0-1.25zm1.938 0a.625.625 0 1 0 0 1.25h.01a.625.625 0 0 0 0-1.25zm1.937 0a.625.625 0 1 0 0 1.25h.01a.625.625 0 0 0 0-1.25zm1.938 0a.625.625 0 1 0 0 1.25h.01a.625.625 0 0 0 0-1.25zm1.937 0a.625.625 0 1 0 0 1.25h.01a.625.625 0 0 0 0-1.25zm1.938 0a.625.625 0 1 0 0 1.25h.01a.625.625 0 0 0 0-1.25zm1.937 0a.625.625 0 1 0 0 1.25h.005a.625.625 0 0 0 0-1.25z"})},lo=(0,D().wt)("textXYunderline",ro,"default");var ao=()=>o(651987),so=()=>o(406007),co=()=>o(755735),uo=()=>o(35091);const po=1e3;function go({collectionViewStore:e,chartConfig:t,disabled:o}){var i;const r=(0,l().v3)(),a=(0,m().ET)(),c=(0,s().eP)(),d=(0,n.useCallback)((e=>{var t;const o=null===(t=(0,Re().BV)(e,c))||void 0===t?void 0:t.slice(0,5);return{key:e,type:"button",title:(0,A.jsx)(g().sA,{...y().pP[e]}),caption:o?(0,A.jsx)("div",{style:{display:"flex"},children:null==o?void 0:o.map((e=>(0,A.jsx)("div",{style:{background:e,borderRadius:2,width:12,height:12,marginInlineEnd:3,marginTop:1}},e)))}):null,captionInline:!0,captionStyle:{marginInlineStart:"auto"},inlineSpacerStyle:{display:"none"}}}),[c]),u=(0,n.useMemo)((()=>[M().kq.map(d),M().VY.map(d)]),[d]),p=(null===(i=t.chartFormat)||void 0===i?void 0:i.colorTheme)||"auto",S=(0,s().IS)((()=>({icon:{width:20,height:20,marginInlineStart:2}})),[]);return(0,A.jsx)(Nt().A,{disabled:o,title:(0,A.jsx)(g().sA,{...y().Zr.chartColor}),selectedKey:p,sections:u,icon:eo,iconStyle:S.icon,hideCheck:!0,onChange:o=>{if(!o)return;const n=(0,N().mg)(t);n.chartFormat||(n.chartFormat={}),n.chartFormat.colorTheme=o,(0,Re().Pi)(o)||(n.chartFormat.weightColorValue=!1),$().createAndCommit({userAction:"chartSettings.setChartConfig",environment:r,canUndo:!0,perform:t=>{U().zv({store:e.getFormatStore().getKeyStore("chart_config"),data:n,transaction:t})}}),(0,L().X)({environment:r,collectionContextStore:a,action:"charts_style_color"})}})}function mo(e){const t=(0,a().uB)(void 0,Y().A);return(0,A.jsx)(re().A,{focused:!1,popupType:h().A.isMobile?q().z.SlideUp:q().z.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",buttonPopupStore:t,renderOrigin:o=>(0,A.jsx)(ce().A,{...o,showChevron:!0,title:(0,A.jsx)(g().sA,{...y().bg.chartMoreStyle}),rotateChevron:t.state.open,icon:Jt().I,disabled:e.disabled}),render:t=>(0,A.jsx)(So,{parent:t,collectionViewStore:e.collectionViewStore,chartConfig:e.chartConfig,disabled:e.disabled})})}function So(e){const{collectionViewStore:t,chartConfig:o,disabled:n}=e,i=(0,m().ET)(),l=(0,a().O$)(i.normalizedSchemaStore),d=(0,r().X)("donut_chart_negative_values"),p=(0,a().K8)((()=>i.isDashboardWidget()),[i]),g=(0,a().K8)((()=>{var e;if((0,u().m)(o))return"groups_reducer"===(null==o||null===(e=o.dataConfig)||void 0===e?void 0:e.type)?(0,F()._g)({schema:l,property:o.dataConfig.groupBy.property}):void 0}),[o,l]),S=[],y={key:"default",items:(0,N().oE)([p?void 0:{key:"chartHeight",render:(e,i)=>(0,A.jsx)(yo,{menuListItemProps:e,parent:i,collectionViewStore:t,chartConfig:o,disabled:n}),action:()=>{}},{key:"groupStyle",render:(e,i)=>(0,u().m)(o)&&"groups_reducer"===o.dataConfig.type&&o.dataConfig.aggregationConfig.stackOptions?(0,A.jsx)(fo,{menuListItemProps:e,parent:i,collectionViewStore:t,chartConfig:o,disabled:n}):null,action:()=>{}},{key:"gridLine",render:(e,i)=>(0,u().m)(o)?(0,A.jsx)(ho,{menuListItemProps:e,parent:i,collectionViewStore:t,chartConfig:o,disabled:n}):null,action:()=>{}},{key:"axisLabel",render:(e,i)=>(0,u().m)(o)?(0,A.jsx)(vo,{menuListItemProps:e,parent:i,collectionViewStore:t,chartConfig:o,disabled:n}):null,action:()=>{}},{key:"axisAvatarStyle",render:(e,i)=>(0,u().m)(o)&&g&&(0,M().fn)(g)?(0,A.jsx)(xo,{menuListItemProps:e,parent:i,collectionViewStore:t,chartConfig:o,disabled:n}):null,action:()=>{}},{key:"donutValue",render:e=>"donut"!==o.type?null:(0,A.jsx)(wo,{menuListItemProps:e,collectionViewStore:t,chartConfig:o,disabled:n}),action:()=>{}},{key:"hideNegativeValues",render:e=>"donut"===o.type&&d?(0,A.jsx)(Ao,{menuListItemProps:e,collectionViewStore:t,chartConfig:o,disabled:n}):null,action:()=>{}},{key:"colorByValue",render:e=>{var i;const r=null===(i=o.chartFormat)||void 0===i?void 0:i.colorTheme;return"line"===o.type||!r||r&&!(0,Re().Pi)(r)?null:(0,A.jsx)(_o,{menuListItemProps:e,collectionViewStore:t,chartConfig:o,disabled:n})},action:()=>{}},{key:"smoothLine",render:e=>"line"!==o.type?null:(0,A.jsx)(Co,{menuListItemProps:e,collectionViewStore:t,chartConfig:o,disabled:n}),action:()=>{}},{key:"areaFill",render:e=>"line"!==o.type?null:(0,A.jsx)(jo,{menuListItemProps:e,collectionViewStore:t,chartConfig:o,disabled:n}),action:()=>{}},{key:"legend",render:e=>(0,A.jsx)(To,{menuListItemProps:e,collectionViewStore:t,chartConfig:o,disabled:n}),action:()=>{}},{key:"dataLabels",render:e=>(0,u().m)(o)&&(0,M().D5)(o)?(0,A.jsx)(Mo,{...e,collectionViewStore:t,chartConfig:o,disabled:n}):null,action:()=>{}},{key:"donutDataLabels",render:(e,i)=>"donut"!==o.type?null:(0,A.jsx)(Po,{menuListItemProps:e,parent:i,collectionViewStore:t,chartConfig:o,disabled:n}),action:()=>{}},{key:"valueLabel",render:e=>{var i;return"donut"!==o.type||null!==(i=o.chartFormat)&&void 0!==i&&i.donutHideValue?null:(0,A.jsx)(Io,{menuListItemProps:e,collectionViewStore:t,chartConfig:o,disabled:n})},action:()=>{}},{key:"caption",render:e=>(0,A.jsx)(ko,{...e,collectionViewStore:t,chartConfig:o,disabled:n}),action:()=>{}}]),render:e=>(0,A.jsx)(c().A,{...e})};S.push(y);const f=h().A.isMobile?{menuType:X().gu.ActionSheet}:{menuType:X().gu.Popup,width:280,maxHeight:400},x=(0,s().IS)((()=>({menuList:{paddingTop:8,paddingBottom:8}})),[]);return(0,A.jsx)(J().A,{...f,children:(0,A.jsx)(te().A,{initialFocus:void 0,type:te().O.Vertical,sections:S,resetFocusOnMouseOut:!0,style:x.menuList})})}function yo(e){var t;const{chartConfig:o,collectionViewStore:i}=e,r=(0,l().v3)(),a=(0,l().Y0)(),s=null==o||null===(t=o.chartFormat)||void 0===t?void 0:t.height,d=s||so().Z,u=(0,n.useCallback)((e=>{const t=(0,N().mg)(o);t.chartFormat||(t.chartFormat={}),t.chartFormat.height=e,$().createAndCommit({userAction:"chartSettings.setChartConfig",environment:r,canUndo:!0,perform:e=>{U().zv({store:i.getFormatStore(),data:{chart_config:t},transaction:e})}})}),[o,i,r]),p=(0,n.useMemo)((()=>(0,w().WP)(y().WG).map((([e,t])=>{const o=d===e;return{key:e,render:e=>(0,A.jsx)(Z().A,{...e,title:(0,A.jsx)(g().sA,{...t}),isChecked:o}),action:()=>{u(e)}}}))),[d,u]);return(0,A.jsx)(ae().A,{...e.menuListItemProps,openOnFocus:!0,onFocus:e.parent.onFocus,renderOrigin:e=>(0,A.jsx)(ce().A,{...e,showChevron:!0,title:(0,A.jsx)(g().sA,{...y().Zr.chartHeight}),icon:Ht().t,right:d?(0,A.jsx)(g().sA,{...y().WG[d]}):null}),renderExtension:(t,o)=>{const n=bo({title:(0,A.jsx)(g().sA,{...y().Zr.chartHeight}),device:a,onClickRight:o.close,popupEvents:t});return(0,A.jsx)(J().A,{...n,children:(0,A.jsx)(te().A,{type:te().O.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"chartHeight",render:e=>(0,A.jsx)(c().A,{...e}),items:p}]})})}})}function fo(e){var t;const{chartConfig:o,collectionViewStore:i}=e,r=(0,l().v3)(),a=(0,l().Y0)(),s=(null==o||null===(t=o.chartFormat)||void 0===t?void 0:t.axisGroupStyle)??M().PC.normal,d=(0,n.useCallback)((e=>{const t=(0,N().mg)(o);t.chartFormat||(t.chartFormat={axisGroupStyle:M().PC.normal}),t.chartFormat.axisGroupStyle=e,$().createAndCommit({userAction:"chartSettings.setChartConfig",environment:r,canUndo:!0,perform:e=>{U().zv({store:i.getFormatStore(),data:{chart_config:t},transaction:e})}})}),[o,i,r]),u=(0,n.useMemo)((()=>(0,w().WP)(y().TP).map((([e,t])=>{const o=s===e;return{key:e,render:e=>(0,A.jsx)(Z().A,{...e,title:(0,A.jsx)(g().sA,{...t}),isChecked:o}),action:()=>{d(e)}}}))),[s,d]);return(0,A.jsx)(ae().A,{...e.menuListItemProps,openOnFocus:!0,onFocus:e.parent.onFocus,renderOrigin:e=>(0,A.jsx)(ce().A,{...e,showChevron:!0,title:(0,A.jsx)(g().sA,{...y().Zr.chartGroupStyle}),icon:no,right:s?(0,A.jsx)(g().sA,{...y().TP[s]}):null}),renderExtension:(t,o)=>{const n=bo({title:(0,A.jsx)(g().sA,{...y().Zr.chartGroupStyle}),device:a,onClickRight:o.close,popupEvents:t});return(0,A.jsx)(J().A,{...n,children:(0,A.jsx)(te().A,{type:te().O.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"groupStyles",render:e=>(0,A.jsx)(c().A,{...e}),items:u}]})})}})}function ho(e){var t;const o=(0,l().v3)(),i=(0,m().ET)(),r=(0,l().Y0)(),a=(null===(t=e.chartConfig.chartFormat)||void 0===t?void 0:t.axisGridLine)??"horizontal",s=(0,n.useCallback)((t=>{const n=(0,N().mg)(e.chartConfig);n.chartFormat||(n.chartFormat={axisGridLine:M().JQ.horizontal}),n.chartFormat.axisGridLine=t,$().createAndCommit({userAction:"chartSettings.setChartConfig",environment:o,canUndo:!0,perform:t=>{U().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:n,transaction:t})}}),(0,L().X)({environment:o,collectionContextStore:i,action:"charts_style_grid_line"})}),[e.chartConfig,o,e.collectionViewStore,i]),d=(0,n.useMemo)((()=>(0,w().WP)(y().G_).map((([e,t])=>{const o=a===e;return{key:e,render:e=>(0,A.jsx)(Z().A,{...e,title:(0,A.jsx)(g().sA,{...t}),isChecked:o}),action:()=>{s(e)}}}))),[a,s]);return(0,A.jsx)(ae().A,{...e.menuListItemProps,openOnFocus:!0,onFocus:e.parent.onFocus,renderOrigin:t=>(0,A.jsx)(ce().A,{...t,showChevron:!0,title:(0,A.jsx)(g().sA,{...y().Zr.chartGridLine}),right:a?(0,A.jsx)(g().sA,{...y().G_[a]}):null,icon:Ze,disabled:e.disabled}),renderExtension:(t,o)=>{const n=bo({title:(0,A.jsx)(g().sA,{...y().Zr.chartGridLine}),device:r,onClickRight:o.close,popupEvents:t});return(0,A.jsx)(J().A,{...n,children:(0,A.jsx)(te().A,{type:te().O.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"gridStyles",render:e=>(0,A.jsx)(c().A,{...e}),items:d}]})})}})}function xo(e){var t;const o=(0,l().v3)(),i=(0,l().Y0)(),r=(0,y().k1)(),a=(null===(t=e.chartConfig.chartFormat)||void 0===t?void 0:t.axisAvatar)||M().GL.avatar,s=(0,n.useCallback)((t=>{const n=(0,N().mg)(e.chartConfig);n.chartFormat||(n.chartFormat={axisAvatar:M().GL.avatar}),n.chartFormat.axisAvatar=t,$().createAndCommit({userAction:"chartSettings.updateAxisAvatarFormat",environment:o,canUndo:!0,perform:t=>{U().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:n,transaction:t})}})}),[e.chartConfig,e.collectionViewStore,o]),d=(0,n.useMemo)((()=>(0,w().WP)(y().RO).map((([e,t])=>{const o=a===e;return{key:e,render:e=>(0,A.jsx)(Z().A,{...e,title:(0,A.jsx)(g().sA,{...t}),isChecked:o}),action:()=>{s(e)}}}))),[a,s]);return(0,A.jsx)(ae().A,{...e.menuListItemProps,openOnFocus:!0,onFocus:e.parent.onFocus,renderOrigin:t=>(0,A.jsx)(ce().A,{...t,showChevron:!0,title:(0,A.jsx)(g().sA,{...y().Zr.chartAxisAvatarFormat}),right:a?(0,A.jsx)("span",{style:z().RC,children:(0,A.jsx)(g().sA,{...y().RO[a]})}):null,rightStyle:r.avatarStyle,icon:to().personCircleFillIcon,disabled:e.disabled}),renderExtension:(t,o)=>{const n=bo({title:(0,A.jsx)(g().sA,{...y().Zr.chartAxisName}),device:i,onClickRight:o.close,popupEvents:t});return(0,A.jsx)(J().A,{...n,children:(0,A.jsx)(te().A,{type:te().O.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"avatarStyles",render:e=>(0,A.jsx)(c().A,{...e}),items:d}]})})}})}function vo(e){var t;const o=(0,l().v3)(),i=(0,m().ET)(),r=(0,l().Y0)(),s=(null===(t=e.chartConfig.chartFormat)||void 0===t?void 0:t.axisLabel)??M().tG.none,d=(0,a().K8)((()=>"bar"===e.chartConfig.type),[e.chartConfig]),u=(0,n.useMemo)((()=>d?s===M().tG.x_axis?y().Le.y_axis:s===M().tG.y_axis?y().Le.x_axis:y().Le[s]:y().Le[s]),[d,s]),p=(0,n.useCallback)((t=>{const n=(0,N().mg)(e.chartConfig);n.chartFormat||(n.chartFormat={axisLabel:M().tG.none}),n.chartFormat.axisLabel=t,$().createAndCommit({userAction:"chartSettings.updateAxisLabel",environment:o,canUndo:!0,perform:t=>{U().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:n,transaction:t})}}),(0,L().X)({environment:o,collectionContextStore:i,action:"charts_style_axis_label"})}),[e.chartConfig,e.collectionViewStore,o,i]),S=(0,n.useMemo)((()=>{let e=(0,w().WP)(y().Le);if(d){const t=[];for(const[o,n]of e)o===M().tG.x_axis?t.push([M().tG.y_axis,n]):o===M().tG.y_axis?t.push([M().tG.x_axis,n]):t.push([o,n]);e=t}return e.map((([e,t])=>{const o=s===e;return{key:e,render:e=>(0,A.jsx)(Z().A,{...e,title:(0,A.jsx)(g().sA,{...t}),isChecked:o}),action:()=>{p(e)}}}))}),[d,s,p]);return(0,A.jsx)(ae().A,{...e.menuListItemProps,openOnFocus:!0,onFocus:e.parent.onFocus,renderOrigin:t=>(0,A.jsx)(ce().A,{...t,showChevron:!0,title:(0,A.jsx)(g().sA,{...y().Zr.chartAxisName}),right:u?(0,A.jsx)(g().sA,{...u}):null,icon:lo,disabled:e.disabled}),renderExtension:(t,o)=>{const n=bo({title:(0,A.jsx)(g().sA,{...y().Zr.chartAxisName}),device:r,onClickRight:o.close,popupEvents:t});return(0,A.jsx)(J().A,{...n,children:(0,A.jsx)(te().A,{type:te().O.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"gridStyles",render:e=>(0,A.jsx)(c().A,{...e}),items:S}]})})}})}function bo(e){return h().A.isMobile?{menuType:X().gu.ActionSheet,...e.popupEvents}:{menuType:X().gu.Popup,width:200,...e.popupEvents}}function Co(e){const t=(0,l().v3)(),o=(0,m().ET)(),i=(0,n.useMemo)((()=>{var t;return Boolean(null===(t=e.chartConfig)||void 0===t||null===(t=t.chartFormat)||void 0===t?void 0:t.smoothLine)}),[e.chartConfig]),r=(0,n.useCallback)((()=>{var n;const i=(0,N().mg)(e.chartConfig);i.chartFormat||(i.chartFormat={smoothLine:!1}),i.chartFormat.smoothLine=!(null!==(n=e.chartConfig.chartFormat)&&void 0!==n&&n.smoothLine),$().createAndCommit({userAction:"chartSettings.setChartConfig",environment:t,canUndo:!0,perform:t=>{U().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:i,transaction:t})}}),(0,L().X)({environment:t,collectionContextStore:o,action:"charts_style_smooth_line"})}),[t,e.chartConfig,e.collectionViewStore,o]);return(0,A.jsx)(uo().A,{...e.menuListItemProps,title:(0,A.jsx)(g().sA,{...y().Zr.chartSmoothLine}),showChevron:!1,switcherProps:{on:i},icon:Yt,onClick:r,disabled:e.disabled})}function jo(e){const t=(0,l().v3)(),o=(0,m().ET)(),i=(0,n.useMemo)((()=>{var t;return!(null!==(t=e.chartConfig)&&void 0!==t&&null!==(t=t.chartFormat)&&void 0!==t&&t.hideLineFillArea)}),[e.chartConfig]),r=(0,n.useCallback)((()=>{var n;const i=(0,N().mg)(e.chartConfig);i.chartFormat||(i.chartFormat={hideLineFillArea:!1}),i.chartFormat.hideLineFillArea=!(null!==(n=e.chartConfig.chartFormat)&&void 0!==n&&n.hideLineFillArea),$().createAndCommit({userAction:"chartSettings.setChartConfig",environment:t,canUndo:!0,perform:t=>{U().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:i,transaction:t})}}),(0,L().X)({environment:t,collectionContextStore:o,action:"charts_style_area_fill"})}),[t,e.chartConfig,e.collectionViewStore,o]);return(0,A.jsx)(uo().A,{...e.menuListItemProps,title:(0,A.jsx)(g().sA,{...y().Zr.chartLineFillArea}),showChevron:!1,switcherProps:{on:i},icon:Qt,onClick:r,disabled:e.disabled})}function wo(e){var t;const o=(0,l().v3)(),i=(0,m().ET)(),{collectionViewStore:r,chartConfig:a,disabled:s}=e,c=(0,n.useMemo)((()=>{var e;return!(null!=a&&null!==(e=a.chartFormat)&&void 0!==e&&e.donutHideValue)}),[null==a||null===(t=a.chartFormat)||void 0===t?void 0:t.donutHideValue]),d=(0,n.useCallback)((()=>{var e;const t=(0,N().mg)(a);t.chartFormat||(t.chartFormat={donutHideValue:!1}),t.chartFormat.donutHideValue=!(null!==(e=a.chartFormat)&&void 0!==e&&e.donutHideValue),$().createAndCommit({userAction:"chartSettings.setChartConfig",environment:o,canUndo:!0,perform:e=>{U().zv({store:r.getFormatStore().getKeyStore("chart_config"),data:t,transaction:e})}}),(0,L().X)({environment:o,collectionContextStore:i,action:"charts_style_donut_value"})}),[a,r,o,i]);return(0,A.jsx)(uo().A,{...e.menuListItemProps,title:(0,A.jsx)(g().sA,{...y().Zr.chartShowDonutValue}),showChevron:!1,switcherProps:{on:c},icon:ne().i,onClick:d,disabled:s})}function Ao(e){const t=(0,l().v3)(),o=(0,m().ET)(),i=(0,r().X)("donut_chart_negative_values"),a=(0,n.useMemo)((()=>{var t;return Boolean(null===(t=e.chartConfig)||void 0===t||null===(t=t.chartFormat)||void 0===t?void 0:t.hideNegativeValues)}),[e.chartConfig]),s=(0,n.useCallback)((()=>{var n;if(!i)return;const r=(0,N().mg)(e.chartConfig);r.chartFormat||(r.chartFormat={hideNegativeValues:!1}),r.chartFormat.hideNegativeValues=!(null!==(n=e.chartConfig.chartFormat)&&void 0!==n&&n.hideNegativeValues),$().createAndCommit({userAction:"chartSettings.setChartConfig",environment:t,canUndo:!0,perform:t=>{U().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:r,transaction:t})}}),(0,L().X)({environment:t,collectionContextStore:o,action:"charts_style_hide_negative_values"})}),[t,e.chartConfig,e.collectionViewStore,o,i]);return i?(0,A.jsx)(uo().A,{...e.menuListItemProps,title:(0,A.jsx)(g().sA,{...y().Zr.chartHideNegativeValues}),showChevron:!1,switcherProps:{on:a},icon:Xt().L,onClick:s,disabled:e.disabled}):null}function Io(e){var t;const o=(0,l().v3)(),i=(0,g().tz)(),r=(0,m().ET)(),{collectionViewStore:a,chartConfig:c,disabled:d}=e,u=(0,n.useMemo)((()=>{var e;return null==c||null===(e=c.chartFormat)||void 0===e?void 0:e.valueLabel}),[null==c||null===(t=c.chartFormat)||void 0===t?void 0:t.valueLabel]),p=(0,n.useCallback)((e=>{const t=(0,N().mg)(c);t.chartFormat||(t.chartFormat={valueLabel:void 0}),t.chartFormat.valueLabel=e,$().createAndCommit({userAction:"chartSettings.setChartConfig",environment:o,canUndo:!0,perform:e=>{U().zv({store:a.getFormatStore().getKeyStore("chart_config"),data:t,transaction:e})}}),(0,L().X)({environment:o,collectionContextStore:r,action:"charts_style_value_label"})}),[c,a,o,r]),S=(0,s().IS)((()=>({inputContainer:{padding:"4px 0",marginInlineStart:34,marginInlineEnd:4}})),[]);return(0,A.jsx)("div",{style:S.inputContainer,children:(0,A.jsx)(co().B,{initialValue:u||"",placeholder:i.formatMessage(y().Zr.chartValueLabelPlaceholder),onBlur:p,onChange:p,onSubmit:p,disabled:d})})}function _o(e){var t;const o=(0,l().v3)(),i=(0,m().ET)(),r=(null===(t=e.chartConfig.chartFormat)||void 0===t?void 0:t.weightColorValue)??!1,a=(0,n.useCallback)((()=>{var t;const n=(0,N().mg)(e.chartConfig);n.chartFormat||(n.chartFormat={weightColorValue:!1}),n.chartFormat.weightColorValue=!(null!==(t=e.chartConfig.chartFormat)&&void 0!==t&&t.weightColorValue),$().createAndCommit({userAction:"chartSettings.setChartConfig",environment:o,canUndo:!0,perform:t=>{U().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:n,transaction:t})}}),(0,L().X)({environment:o,collectionContextStore:i,action:"charts_style_weight_color_value"})}),[o,e.chartConfig,e.collectionViewStore,i]);return(0,A.jsx)(uo().A,{...e.menuListItemProps,title:(0,A.jsx)(g().sA,{...y().Zr.chartWeightColorValue}),showChevron:!1,switcherProps:{on:r},icon:Xt().L,onClick:a,disabled:e.disabled})}function To(e){var t;const o=(0,l().v3)(),i=(0,m().ET)(),r=(0,ao().hu)(e.chartConfig),a=!(null!==(t=e.chartConfig.chartFormat)&&void 0!==t&&t.hideLegend||r),s=(0,n.useCallback)((()=>{var t;const n=(0,N().mg)(e.chartConfig);n.chartFormat||(n.chartFormat={hideLegend:!1}),n.chartFormat.hideLegend=!(null!==(t=e.chartConfig.chartFormat)&&void 0!==t&&t.hideLegend),$().createAndCommit({userAction:"chartSettings.setChartConfig",environment:o,canUndo:!0,perform:t=>{U().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:n,transaction:t})}}),(0,L().X)({environment:o,collectionContextStore:i,action:"charts_style_legend_toggle"})}),[o,e.chartConfig,e.collectionViewStore,i]);return r?null:(0,A.jsx)(uo().A,{...e.menuListItemProps,title:(0,A.jsx)(g().sA,{...y().Zr.chartLegend}),showChevron:!1,switcherProps:{on:a},icon:$t().n,onClick:s,disabled:e.disabled})}function ko({collectionViewStore:e,chartConfig:t,disabled:o}){const i=(0,g().tz)(),r=(0,l().v3)(),a=(0,m().ET)(),{showCaption:c,caption:d}=(0,n.useMemo)((()=>{var e,o;return"placeholder"===t.type?{showCaption:!1,caption:""}:{showCaption:(null===(e=t.chartFormat)||void 0===e?void 0:e.showCaption)??!1,caption:(null===(o=t.chartFormat)||void 0===o?void 0:o.caption)??""}}),[t]),u=(0,n.useCallback)((()=>{const t=e.getChartFormatStore();t&&($().createAndCommit({userAction:"chartSettings.setChartFormat.showCaption",environment:r,canUndo:!0,perform:e=>{U().zv({store:t,data:{showCaption:!c},transaction:e})}}),(0,L().X)({environment:r,collectionContextStore:a,action:"charts_style_show_caption"}))}),[e,r,a,c]),p=(0,n.useCallback)((t=>{const o=e.getChartFormatStore();o&&($().createAndCommit({userAction:"chartSettings.setChartFormat.updateCaption",environment:r,canUndo:!0,perform:e=>{U().zv({store:o,data:{caption:t},transaction:e})}}),(0,L().X)({environment:r,collectionContextStore:a,action:"charts_style_update_caption"}))}),[a,e,r]),S=(0,s().IS)((()=>({captionInputContainer:{padding:"4px 0",marginInlineStart:34,marginInlineEnd:4}})),[]);return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(ce().A,{title:(0,A.jsx)(g().sA,{...y().Zr.chartCaption}),showChevron:!1,right:(0,A.jsx)(Wt().A,{on:c,onClick:u,disabled:o}),icon:io().i,onClick:u,disabled:o}),(0,A.jsx)("div",{style:S.captionInputContainer,children:(0,A.jsx)(co().B,{initialValue:d,placeholder:i.formatMessage(y().Zr.chartCaptionPlaceholder),onBlur:p,onChange:p,onSubmit:p,disabled:o,textarea:!0,maxLength:po})})]})}function Mo({collectionViewStore:e,chartConfig:t,disabled:o}){const i=(0,l().v3)(),r=(0,m().ET)(),s=(0,a().K8)((()=>(0,M().q_)(t)),[t]),c=(0,n.useCallback)((()=>{const o=(0,N().mg)(t);o.chartFormat||(o.chartFormat={axisShowDataLabels:!0}),o.chartFormat.axisShowDataLabels=!s,$().createAndCommit({userAction:"chartSettings.setChartFormat.dataLabels",environment:i,canUndo:!0,perform:t=>{U().zv({store:e.getFormatStore().getKeyStore("chart_config"),data:o,transaction:t})}}),(0,L().X)({environment:i,collectionContextStore:r,action:"charts_style_data_labels"})}),[t,e,i,s,r]);return(0,A.jsx)(ce().A,{title:(0,A.jsx)(g().sA,{...y().Zr.chartDataLabels}),showChevron:!1,right:(0,A.jsx)(Wt().A,{on:s,onClick:c,disabled:o}),icon:ne().i,onClick:c,disabled:o})}function Po(e){var t;const o=(0,l().v3)(),i=(0,m().ET)(),r=(0,l().Y0)(),a=(0,y().k1)(),s=(null===(t=e.chartConfig.chartFormat)||void 0===t?void 0:t.donutDataLabels)??M().D0.none,d=(0,n.useCallback)((t=>{const n=(0,N().mg)(e.chartConfig);n.chartFormat||(n.chartFormat={donutDataLabels:M().D0.none}),n.chartFormat.donutDataLabels=t,$().createAndCommit({userAction:"chartSettings.setChartConfig",environment:o,canUndo:!0,perform:t=>{U().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:n,transaction:t})}}),(0,L().X)({environment:o,collectionContextStore:i,action:"charts_style_donut_data_labels"})}),[e.chartConfig,o,e.collectionViewStore,i]),u=(0,n.useMemo)((()=>(0,w().WP)(y().zH).map((([e,t])=>{const o=s===e;return{key:e,render:e=>(0,A.jsx)(Z().A,{...e,title:(0,A.jsx)(g().sA,{...t}),isChecked:o}),action:()=>{d(e)}}}))),[s,d]);return(0,A.jsx)(ae().A,{...e.menuListItemProps,openOnFocus:!0,onFocus:e.parent.onFocus,renderOrigin:t=>(0,A.jsx)(ce().A,{...t,showChevron:!0,title:(0,A.jsx)(g().sA,{...y().Zr.chartDataLabels}),right:s?(0,A.jsx)("div",{style:{...a.donutDataLabelsRightText,...z().RC},children:(0,A.jsx)(g().sA,{...y().zH[s]})}):null,icon:ne().i,disabled:e.disabled}),renderExtension:(t,o)=>{const n=bo({title:(0,A.jsx)(g().sA,{...y().Zr.chartDataLabels}),device:r,onClickRight:o.close,popupEvents:t});return(0,A.jsx)(J().A,{...n,children:(0,A.jsx)(te().A,{type:te().O.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"donutDataLabelsStyle",render:e=>(0,A.jsx)(c().A,{...e}),items:u}]})})}})}var Bo=()=>o(457056),Vo=()=>o(896628);function Fo({chartConfig:e,chartError:t,disabled:o}){const i=(0,l().v3)(),r=(0,m().ET)(),c=(0,g().tz)(),u=(0,s().IS)((()=>({errorIcon:{...(0,y().FE)()}})),[]),p=(0,y().k1)(),S=(0,a().K8)((()=>r.collectionViewStore()),[r]),f=(0,a().O$)(r.normalizedSchemaStore),h=null==e?void 0:e.dataConfig,x=(0,a().K8)((()=>{if("groups_reducer"===(null==h?void 0:h.type)){const e="formula"===h.groupBy.type?h.groupBy.groupBy:h.groupBy;return(0,V().sj)(e)||(0,V().Ik)(e)?{type:"property_group",property:h.groupBy.property,groupByOption:e.groupBy}:{type:"property_group",property:h.groupBy.property}}if("results_reducer"===(null==h?void 0:h.type))return{type:"property_group",property:h.nameProperty}}),[h]),C=t&&(0,d().lc)(t)?()=>(0,A.jsx)(v().I,{icon:R().exclamationMarkTriangleFillIcon,style:u.errorIcon}):Bo().o,j=(0,a().K8)((()=>{const e=(0,w().WP)(f),t=[];return e.forEach((([e,o])=>{o&&((0,V().iF)(o.type)?t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ue,subMenuItems:V().PC.map((t=>({key:{type:"property_group",property:e,groupByOption:t},name:c.formatMessage(be().eD[t]),sectionName:ue})))}):(0,M().zn)(o)?t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ue,subMenuItems:V().BI.map((t=>({key:{type:"property_group",property:e,groupByOption:t},name:c.formatMessage(be().WK[t]),sectionName:ue})))}):(0,V().Eg)(o)&&t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ue}))})),t}),[f,c]),I=n.useCallback((t=>{var o,n;const{key:l}=t,{property:a,groupByOption:s}=l;if(!e||!S)return;const c=(0,F()._g)({schema:f,property:a}),d=(0,k().o_)({property:a,collectionSchema:f,hideEmptyGroups:Boolean(null===(o=e.chartFormat)||void 0===o?void 0:o.axisHideEmptyGroups)});if(!c||!d)return;const u=Object.keys(f),p="results_reducer"===e.dataConfig.type?e.dataConfig.valueProperty:u.find((e=>{const t=f[e];return Boolean(t&&(0,k().Iw)(t))})),g={aggregator:"count"};let m=N().mg(e);if((0,k().tH)(c)&&p)m=(0,M().CN)({chartConfig:m,xAxisPropertyId:a,newDataConfigType:"results_reducer",valueProperty:p,groupBy:d});else if(s){var h;const e=(0,M().xS)({property:a,propertySchema:c,groupByOption:s,hideEmptyGroups:Boolean(null===(h=m.chartFormat)||void 0===h?void 0:h.axisHideEmptyGroups)});e&&(m=(0,M().CN)({chartConfig:m,xAxisPropertyId:a,newDataConfigType:"groups_reducer",groupBy:e,aggregation:g}))}else if(d){const e={aggregator:"count"};m=(0,M().CN)({chartConfig:m,xAxisPropertyId:a,newDataConfigType:"groups_reducer",groupBy:d,aggregation:e})}(0,y().Qn)({environment:i,collectionContextStore:r,chartConfig:m,sort:null===(n=m.chartFormat)||void 0===n?void 0:n.mainSort}),$().createAndCommit({userAction:"chartSettings.setXAxis",environment:i,canUndo:!0,perform:e=>{U().zv({store:S.getFormatStore().getKeyStore("chart_config"),data:m,transaction:e}),"week"===t.key.groupByOption&&Vo().Jo(S,e)}}),(0,L().X)({environment:i,collectionContextStore:r,action:"charts_x_axis_what_to_show",charts_analytics_context:(0,H().nL)(r)})}),[e,S,f,i,r]);return(0,A.jsx)(b().m,{textWrap:!0,placement:"left",disableTooltip:!t||!(0,d().lc)(t),renderTooltip:e=>t?(0,A.jsx)("span",{...e,children:(0,W().y)(t)}):null,render:e=>(0,A.jsx)(he,{...e,collectionContextStore:r,selectedProperty:x,properties:j,handlePropertySelect:I,originProps:{title:(0,A.jsx)("span",{children:(0,A.jsx)(g().sA,{...y().bg.chartWhatToShow})}),icon:C},callsite:"main_property",disabled:o,rightStyle:p.whatToShowRightText})})}function Do({collectionViewStore:e,chartConfig:t,disabled:o}){var i;const r=(0,l().v3)(),a=(0,m().ET)(),s=Boolean(null==t||null===(i=t.chartFormat)||void 0===i?void 0:i.axisHideEmptyGroups),c=n.useCallback((()=>{if(!t)return;const o=N().mg(t);o.chartFormat={...o.chartFormat,axisHideEmptyGroups:!s},"groups_reducer"===o.dataConfig.type&&(o.dataConfig.groupBy.hideEmptyGroups=!s),$().createAndCommit({userAction:"chartSettings.setChartConfig",environment:r,canUndo:!0,perform:t=>{U().zv({store:e.getFormatStore().getKeyStore("chart_config"),data:o,transaction:t})}}),(0,L().X)({environment:r,collectionContextStore:a,action:"charts_x_axis_hide_empty_groups",charts_analytics_context:(0,H().nL)(a)})}),[t,e,r,s,a]);return(0,A.jsx)(uo().A,{title:(0,A.jsx)(g().sA,{...y().Zr.chartHideEmptyGroups}),switcherProps:{on:s},onClick:c,icon:p().e,disabled:o})}var Eo=()=>o(745130);const Oo={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.75 13.75",svg:(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("path",{d:"M13.125 4.25c0-.621.504-1.125 1.125-1.125h1.5c.621 0 1.125.504 1.125 1.125v11.5c0 .621-.504 1.125-1.125 1.125h-1.5a1.125 1.125 0 0 1-1.125-1.125zm1.25.125v11.25h1.25V4.375zM3.125 10.75c0-.621.504-1.125 1.125-1.125h1.5c.621 0 1.125.504 1.125 1.125v5c0 .621-.504 1.125-1.125 1.125h-1.5a1.125 1.125 0 0 1-1.125-1.125zm1.25.125v4.75h1.25v-4.75z"}),(0,A.jsx)("path",{d:"M13.125 4.25c0-.621.504-1.125 1.125-1.125h1.5c.621 0 1.125.504 1.125 1.125v11.5c0 .621-.504 1.125-1.125 1.125h-1.5a1.125 1.125 0 0 1-1.125-1.125zm1.25.125v11.25h1.25V4.375zM9.25 6.398c-.621 0-1.125.504-1.125 1.125v8.227c0 .621.504 1.125 1.125 1.125h1.5c.621 0 1.125-.504 1.125-1.125V7.523c0-.62-.504-1.125-1.125-1.125zm.125 9.227V7.648h1.25v7.977z"})]})},Ro=(0,D().wt)("chartBarXAxisCumulative",Oo,"default"),Ko={viewBox:"0 0 20 20",fittedViewBox:"0.25 5.12 19.38 9.76",svg:(0,A.jsx)("path",{d:"M6.625 5.125c2.327 0 4 2.211 4 4.877s-1.673 4.873-4 4.873-4-2.207-4-4.873 1.673-4.877 4-4.877m0 1.25c-1.4 0-2.75 1.389-2.75 3.627s1.349 3.623 2.75 3.623 2.75-1.386 2.75-3.623-1.35-3.627-2.75-3.627m9-1.25c2.327 0 4 2.211 4 4.877s-1.673 4.873-4 4.873-4-2.207-4-4.873 1.673-4.877 4-4.877m0 1.25c-1.4 0-2.75 1.389-2.75 3.627s1.349 3.623 2.75 3.623 2.75-1.386 2.75-3.623-1.35-3.627-2.75-3.627M1.25 12.79a1 1 0 1 1 0 2 1 1 0 0 1 0-2"})},No=(0,D().wt)("decimal",Ko,"default");var zo=()=>o(72135),Lo=()=>o(154378),Uo=()=>o(673900),Wo=()=>o(66486);function Ho({chartConfig:e,chartError:t,disabled:o}){const i=(0,g().tz)(),r=(0,l().v3)(),c=(0,m().ET)(),u=(0,s().IS)((()=>({errorIcon:{...(0,y().FE)(),marginInlineStart:4}})),[]),p=(0,y().k1)(),S=(0,a().K8)((()=>c.collectionViewStore()),[c]),f=(0,a().K8)((()=>c.databaseTypeFromStoreState),[c]),h=(0,a().O$)(c.normalizedSchemaStore),x=null==e?void 0:e.dataConfig,C=(0,a().K8)((()=>{if(x)return"groups_reducer"===x.type?x.groupBy.property:x.nameProperty}),[x]),j=(0,a().K8)((()=>C?(0,F()._g)({schema:h,property:C}):void 0),[C,h]),I=(0,a().K8)((()=>{if(x)if("groups_reducer"===x.type){const e=x.aggregationConfig.aggregation;if((0,B().Iq)(e))return{type:"record_count"};if(ye(e.aggregator)){const t=(0,F()._g)({schema:h,property:e.property});if(!t)return;return(0,M().JW)(t)||"unique"!==e.aggregator?{type:"aggregation",property:e.property,aggregation:e.aggregator}:{type:"property_group",property:e.property}}}else if("results_reducer"===x.type&&x.valueProperty)return{type:"aggregation",property:x.valueProperty,aggregation:"value"}}),[h,x]),_=(0,a().K8)((()=>{if(!x||!j)return[];const e=[];(0,w().WP)(h).forEach((([t,o])=>{if(!o||t===C||!(0,V().Eg)(o))return;const n=[];(0,k().Iw)(o)&&(0,k().tH)(j)&&n.push({key:{type:"aggregation",property:t,aggregation:"value"},name:i.formatMessage(y().bg.chartAggregateByValues),sectionName:pe});const r=(0,M().JW)(o);if(r){Se.forEach((e=>{const o={aggregator:e,property:t},r={key:{type:"aggregation",property:t,aggregation:e},name:(0,y().TQ)({aggregation:o,databaseType:f,intl:i})||"",sectionName:pe};n.push(r)}));const e={key:{type:"aggregation",property:t,aggregation:"unique"},name:(0,y().TQ)({aggregation:{aggregator:"unique",property:t},databaseType:f,intl:i})||"",sectionName:pe};n.push(e)}const l={key:{type:"property_group",property:t},name:o.name,sectionName:r?pe:ge,subMenuItems:n};e.push(l)}));return[{key:{type:"record_count"},name:(0,y().TQ)({aggregation:{aggregator:"count"},databaseType:f,intl:i})||"",sectionName:ue},...e]}),[x,j,h,f,i,C]),T=(0,a().K8)((()=>t&&(0,d().dG)(t)?function(){return(0,A.jsx)(v().I,{icon:R().exclamationMarkTriangleFillIcon,size:18,style:u.errorIcon})}:Eo().E),[t,u.errorIcon]),P=n.useCallback((t=>{S&&e&&C&&ve({environment:r,menuItem:t,chartConfig:e,collectionSchema:h,collectionViewStore:S,collectionContextStore:c,mainPropertyId:C})}),[e,c,h,S,r,C]);return(0,A.jsx)(b().m,{textWrap:!0,placement:"left",disableTooltip:!t||!(0,d().dG)(t),renderTooltip:e=>t?(0,A.jsx)("span",{...e,children:(0,W().y)(t)}):null,render:e=>(0,A.jsx)(he,{...e,collectionContextStore:c,selectedProperty:t&&!(0,d().xG)(t)?void 0:I,properties:_,handlePropertySelect:P,originProps:{title:(0,A.jsx)("span",{children:(0,A.jsx)(g().sA,{...y().bg.chartWhatToShow})}),icon:T},callsite:"aggregation_property",disabled:o,rightStyle:p.whatToShowRightText})})}function $o({chartConfig:e,chartError:t,disabled:o}){const i=(0,g().tz)(),r=(0,l().v3)(),c=(0,m().ET)(),u=(0,s().IS)((()=>({errorIcon:{...(0,y().FE)()}})),[]),p=(0,y().k1)(),S=(0,a().O$)(c.normalizedSchemaStore),f=(0,a().K8)((()=>c.collectionViewStore()),[c]),h=(0,a().K8)((()=>{var t,o,n,i,r;if(!e||"groups_reducer"!==(null===(t=e.dataConfig)||void 0===t?void 0:t.type))return;const l=e.dataConfig.aggregationConfig,a="formula"===(null===(o=l.stackOptions)||void 0===o?void 0:o.groupBy.type)?null===(n=l.stackOptions)||void 0===n?void 0:n.groupBy.groupBy:null===(i=l.stackOptions)||void 0===i?void 0:i.groupBy,s=null===(r=l.stackOptions)||void 0===r?void 0:r.groupBy.property;return a&&s?(0,V().sj)(a)||(0,V().Ik)(a)?{type:"property_group",property:s,groupByOption:a.groupBy}:{type:"property_group",property:s}:{type:"none"}}),[e]),x=(0,a().K8)((()=>{const e=(0,w().WP)(S),t=[],o={key:{type:"none"},name:i.formatMessage(y().bg.noneMenuItem),sectionName:ue};return t.push(o),e.forEach((([e,o])=>{o&&((0,V().iF)(o.type)?t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ue,subMenuItems:V().PC.map((t=>({key:{type:"property_group",property:e,groupByOption:t},name:i.formatMessage(be().eD[t]),sectionName:ue})))}):(0,M().zn)(o)?t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ue,subMenuItems:V().BI.map((t=>({key:{type:"property_group",property:e,groupByOption:t},name:i.formatMessage(be().WK[t]),sectionName:ue})))}):(0,V().Eg)(o)&&t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ue}))})),t}),[S,i]),C=(0,a().K8)((()=>t&&(0,d().ic)(t)?function(){return(0,A.jsx)(v().I,{icon:R().exclamationMarkTriangleFillIcon,style:u.errorIcon})}:no),[t,u.errorIcon]),j=n.useCallback(((t,o)=>{var n,i;const l=(0,F()._g)({schema:S,property:t});if(!f||!l||!e||"groups_reducer"!==(null===(n=e.dataConfig)||void 0===n?void 0:n.type))return;const a=(0,M().xS)({property:t,propertySchema:l,groupByOption:o,hideEmptyGroups:!0});if(!a||!(0,V().rj)(a.type))return;const s=N().mg(e);if("groups_reducer"!==s.dataConfig.type)return;const d=e.dataConfig.aggregationConfig;let u;if(s.dataConfig.aggregationConfig={...d,stackOptions:{groupBy:a}},"bar"===e.type||"column"===e.type)u=M().PC.normal;else if("line"===e.type){var p;u=null!==(p=e.chartFormat)&&void 0!==p&&p.axisCumulative?M().PC.normal:M().PC.side_by_side}const g=null===(i=e.chartFormat)||void 0===i?void 0:i.axisGroupStyle;s.chartFormat={...s.chartFormat,axisGroupStyle:g||u},$().createAndCommit({userAction:"chartSettings.setYAxisStackBy",environment:r,canUndo:!0,perform:e=>{U().zv({store:f.getFormatStore().getKeyStore("chart_config"),data:s,transaction:e}),"week"===o&&Vo().Jo(f,e)}}),(0,L().X)({environment:r,collectionContextStore:c,action:"charts_y_axis_group_by",charts_analytics_context:(0,H().nL)(c)})}),[S,e,f,r,c]),I=n.useCallback((()=>{var t;if(!e||"groups_reducer"!==(null===(t=e.dataConfig)||void 0===t?void 0:t.type))return;const o=e.dataConfig.aggregationConfig;f&&$().createAndCommit({userAction:"chartSettings.clearYAxisStackBy",environment:r,canUndo:!0,perform:t=>{if(o){const n=N().mg(e);if("groups_reducer"!==n.dataConfig.type)return;n.dataConfig.aggregationConfig={...o,stackOptions:void 0},U().zv({store:f.getFormatStore().getKeyStore("chart_config"),data:n,transaction:t})}}})}),[f,e,r]),_=n.useCallback((e=>{const{key:t}=e;if("none"===t.type)I();else{const{property:e,groupByOption:o}=t;j(e,o)}}),[I,j]);return(0,A.jsx)(b().m,{textWrap:!0,placement:"left",disableTooltip:!t||!(0,d().ic)(t),renderTooltip:e=>t?(0,A.jsx)("span",{...e,children:(0,W().y)(t)}):null,render:e=>(0,A.jsx)(he,{...e,collectionContextStore:c,selectedProperty:h,properties:x,handlePropertySelect:_,originProps:{title:(0,A.jsx)("span",{style:z().RC,children:(0,A.jsx)(g().sA,{...y().bg.chartGroupBy})}),icon:C},callsite:"y_axis_stacked_groups",disabled:o,rightStyle:p.groupByRightText})})}function Go({chartConfig:e,disabled:t}){var o;const i=(0,l().v3)(),r=(0,m().ET)(),s=(0,a().K8)((()=>r.collectionViewStore()),[r]),c=Boolean(null==e||null===(o=e.chartFormat)||void 0===o?void 0:o.axisCumulative),d=(0,n.useCallback)((()=>{var t,o;if(!s||!e)return;const n=N().mg(e),l=!(null!==(t=n.chartFormat)&&void 0!==t&&t.axisCumulative);n.chartFormat={...n.chartFormat,axisCumulative:l};const a=Boolean("groups_reducer"===n.dataConfig.type&&(null===(o=n.dataConfig)||void 0===o||null===(o=o.aggregationConfig)||void 0===o||null===(o=o.stackOptions)||void 0===o?void 0:o.groupBy));"line"===e.type&&a&&l&&(n.chartFormat={...n.chartFormat,axisGroupStyle:M().PC.normal}),$().createAndCommit({userAction:"chartSettings.setCumulative",environment:i,canUndo:!0,perform:e=>{U().zv({store:s.getFormatStore().getKeyStore("chart_config"),data:n,transaction:e})}}),(0,L().X)({environment:i,collectionContextStore:r,action:"charts_y_axis_cumulative",charts_analytics_context:(0,H().nL)(r)})}),[e,s,i,r]);return e&&!(0,ao().CS)(e)?null:(0,A.jsx)(uo().A,{title:(0,A.jsx)(g().sA,{...y().bg.chartCumulative}),switcherProps:{on:c},onClick:d,icon:Ro,disabled:t})}function Qo(e){const{chartConfig:t,disabled:o}=e,i=null==t?void 0:t.chartFormat,r=(0,l().v3)(),d=(0,g().tz)(),u=(0,a().uB)(void 0,Y().A),p=(0,m().ET)(),S=(0,a().K8)((()=>p.collectionViewStore()),[p]),f=void 0!==(null==i?void 0:i.yAxisMin)||void 0!==(null==i?void 0:i.yAxisMax),[v,b]=(0,n.useState)(void 0!==(null==i?void 0:i.yAxisMin)&&void 0!==(null==i?void 0:i.yAxisMax)&&i.yAxisMin>i.yAxisMax),[C,w]=(0,n.useState)(void 0!==(null==i?void 0:i.yAxisMin)&&void 0!==(null==i?void 0:i.yAxisMax)&&i.yAxisMin>i.yAxisMax),I=(0,n.useCallback)((e=>{if(!S||!t)return;var o,n;if("yAxisMin"in e&&"yAxisMax"in e){if(e.yAxisMin===(null===(o=t.chartFormat)||void 0===o?void 0:o.yAxisMin)&&e.yAxisMax===(null===(n=t.chartFormat)||void 0===n?void 0:n.yAxisMax))return}else if("yAxisMin"in e){var l;if(e.yAxisMin===(null===(l=t.chartFormat)||void 0===l?void 0:l.yAxisMin))return}else if("yAxisMax"in e){var a;if(e.yAxisMax===(null===(a=t.chartFormat)||void 0===a?void 0:a.yAxisMax))return}if("yAxisMin"in e){const t=void 0!==e.yAxisMin&&void 0!==(null==i?void 0:i.yAxisMax)&&e.yAxisMin>i.yAxisMax;if(b(t),t)return;void 0===e.yAxisMin&&b(!1)}if("yAxisMax"in e){const t=void 0!==e.yAxisMax&&void 0!==(null==i?void 0:i.yAxisMin)&&e.yAxisMax<i.yAxisMin;if(w(t),t)return;void 0===e.yAxisMax&&w(!1)}const s=S.getAxisChartFormatStore();s&&($().createAndCommit({userAction:"chartSettings.setYAxisRange",environment:r,canUndo:!0,perform:t=>{U().zv({store:s,data:N().LG(e,(e=>void 0===e?null:e)),transaction:t})}}),(0,L().X)({environment:r,collectionContextStore:p,action:"charts_y_axis_range",charts_analytics_context:(0,H().nL)(p)}))}),[t,null==i?void 0:i.yAxisMax,null==i?void 0:i.yAxisMin,p,S,r]),_=(0,n.useCallback)((e=>I({yAxisMin:e})),[I]),T=(0,n.useCallback)((e=>I({yAxisMax:e})),[I]),k=(0,n.useCallback)((()=>I({yAxisMin:void 0,yAxisMax:void 0})),[I]),M=(0,s().IS)((()=>({container:{paddingBottom:16},icon:{transform:"bar"===(null==t?void 0:t.type)?"rotate(90deg)":void 0},title:{display:"flex",justifyContent:"space-between",width:"100%"},resetButton:{float:"inline-end",color:j().Tj.blue.text.accentPrimary,cursor:"pointer"},inputContainer:{display:"flex",paddingInlineStart:14,paddingInlineEnd:14},separator:{color:j().Tj.text.secondary,margin:"0 8px"}})),[null==t?void 0:t.type]);return(0,A.jsx)(re().A,{focused:!1,popupType:h().A.isMobile?q().z.SlideUp:q().z.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",buttonPopupStore:u,renderOrigin:e=>(0,A.jsx)(ce().A,{...e,showChevron:!0,title:(0,A.jsx)(g().sA,{...y().bg.chartYAxisRange}),rotateChevron:u.state.open,icon:Ht().t,iconStyle:M.icon,disabled:o,right:(0,A.jsx)(g().sA,{...f?y().bg.chartYAxisRangeCustom:y().bg.chartYAxisRangeAuto})}),render:()=>(0,A.jsx)(c().A,{topBorder:!1,disableMobileBorders:!0,title:(0,A.jsx)("div",{style:M.title,children:(0,A.jsx)(g().sA,{...y().bg.chartYAxisRangeMenu})}),right:f?(0,A.jsx)(x().Ay,{style:M.resetButton,onClick:k,children:(0,A.jsx)(g().sA,{...y().bg.chartYAxisRangeReset})}):void 0,style:M.container,children:(0,A.jsxs)("div",{style:M.inputContainer,children:[(0,A.jsx)(Uo().v,{value:null==i?void 0:i.yAxisMin,onBlur:_,onKeyDown:_,inputProps:{placeholder:d.formatMessage(y().bg.chartYAxisRangeMinPlaceholder),errorOutline:v}}),(0,A.jsx)("span",{style:M.separator,children:"-"}),(0,A.jsx)(Uo().v,{value:null==i?void 0:i.yAxisMax,onBlur:T,onKeyDown:T,inputProps:{placeholder:d.formatMessage(y().bg.chartYAxisRangeMaxPlaceholder),errorOutline:C}})]})})})}function qo(e){const{chartConfig:t,disabled:o}=e,i=null==t?void 0:t.chartFormat,r=(0,l().v3)(),s=(0,g().tz)(),c=(0,m().ET)(),d=(0,a().K8)((()=>c.collectionViewStore()),[c]),u=(0,a().O$)(c.normalizedSchemaStore),p=null==t?void 0:t.dataConfig,S=(0,a().K8)((()=>{if(p&&"results_reducer"===p.type)return p.valueProperty}),[p]),y=(0,a().K8)((()=>{if(S)return(0,F()._g)({schema:u,property:S})}),[S,u]),f=(0,a().K8)((()=>y?(0,Lo().i5)(y):void 0),[y]),h=(0,n.useMemo)((()=>{const e=zo().iv.map((e=>({key:e,type:"button",title:(0,Wo().D)(s,e)})));return f&&"precision_uncapped"!==f?[...e,{key:"precision_from_number_property",type:"button",title:s.formatMessage({id:"collection.chartYAxisSettings.fromNumberProperty",defaultMessage:"Use property value ({value})"},{value:zo().Qq[f]})}]:e}),[s,f]),x=(0,n.useCallback)((e=>{if(!d||!t)return;const o=d.getAxisChartFormatStore();o&&($().createAndCommit({userAction:"chartSettings.setYAxisPrecision",environment:r,canUndo:!0,perform:t=>{U().zv({store:o,data:{numberPrecisionOverride:e},transaction:t})}}),(0,L().X)({environment:r,collectionContextStore:c,action:"charts_y_axis_precision",charts_analytics_context:(0,H().nL)(c)}))}),[t,c,d,r]);return(0,A.jsx)(b().m,{placement:"right",textWrap:!0,renderTooltip:()=>(0,A.jsx)(g().sA,{defaultMessage:"Rounding defaults to 2 decimal places. Use this setting to override.",id:"database.chartSettings.numberOptions.numberPrecision.tooltip"}),render:e=>(0,A.jsx)(Nt().A,{...e,icon:No,title:(0,A.jsx)(g().sA,{defaultMessage:"Decimal places",id:"database.chartSettings.numberOptions.numberPrecision"}),selectedKey:(null==i?void 0:i.numberPrecisionOverride)??zo().pS,options:h,onChange:x,disabled:o})})}var Yo=()=>o(34423),Xo=()=>o(459004);const Jo=n.memo((function({collectionSettingsStore:e}){const t=(0,l().v3)(),r=(0,g().tz)(),s=(0,m().ET)(),S=(0,a().O$)(s.normalizedSchemaStore),f=(0,a().K8)((()=>s.collectionViewStore()),[s]),h=(0,a().K8)((()=>s.normalizedFormatStore.state.chart_config),[s.normalizedFormatStore]),{canViewChart:x}=(0,o(204957).f)({collectionContextStore:s}),v=!x,b=(0,a().K8)((()=>{const e=(0,d().ye)({chartConfig:h,collectionSchema:S});if(void 0!==e)return e;return f?s.chartErrorStore.getState().get(f.id):void 0}),[h,s.chartErrorStore,S,f]),C=(0,a().O$)(s.isInHomeWidgetStore),j=(0,a().K8)((()=>{var e;const t=null===(e=s.collectionViewBlockStore())||void 0===e?void 0:e.id;return!!t&&(0,o(635462).s)(t)}),[s]),w=(0,n.useMemo)((()=>j?{feature:"tasks",from:"tasks_more_menu"}:{feature:"custom_db",from:"custom_db_more_menu"}),[j]),I=!(0,a().O$)(s.canConfigureBlockStore)||v,T=ln(I),k=(0,a().K8)((()=>s.isPeopleCollection()),[s]),M=!k;return f&&S&&h&&"placeholder"!==h.type?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(c().A,{extraPadding:!0,style:{paddingTop:0,paddingBottom:4},children:(0,A.jsx)(o(203941).Ct,{collectionContextStore:s,collectionSettingsStore:e})}),(0,A.jsx)(c().A,{extraPadding:!0,topBorder:!0,style:{paddingBottom:4},title:r.formatMessage(y().bg.chartType),mobileStyle:{boxShadow:"none"},desktopTitleStyle:T.disabled,mobileTitleStyle:T.disabled,children:(0,A.jsx)(_,{chartConfig:h,disabled:I})}),"donut"===h.type?(0,A.jsx)(tn,{chartConfig:h,chartError:b,disabled:I}):null,(0,u().m)(h)?"bar"===h.type?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(nn,{collectionViewStore:f,chartConfig:h,chartError:b,disabled:I,useXAxisLabel:!0}),(0,A.jsx)(on,{collectionViewStore:f,chartConfig:h,chartError:b,disabled:I,useYAxisLabel:!0})]}):(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(on,{collectionViewStore:f,chartConfig:h,chartError:b,disabled:I}),(0,A.jsx)(nn,{collectionViewStore:f,chartConfig:h,chartError:b,disabled:I})]}):null,(0,A.jsx)(rn,{collectionContextStore:s,chartConfig:h,paywallDisabled:Boolean(v)}),M?(0,A.jsx)(en,{collectionContextStore:s,collectionSettingsStore:e,paywallDisabled:Boolean(v)}):void 0,(0,A.jsxs)(c().A,{extraPadding:!0,topBorder:!0,children:[(0,A.jsx)(Ge,{chartConfig:h,disabled:I}),(0,A.jsx)(o(48382).z,{collectionContextStore:s,collectionSettingsStore:e}),C?(0,A.jsx)(ce().A,{icon:p().e,title:r.formatMessage(o(885749).u.hide),showChevron:!1,onClick:()=>{i().default.state.sidebarSpaceViewStore&&o(944027).WO({environment:t,currentSpaceViewStore:i().default.state.sidebarSpaceViewStore,...w})}}):void 0]}),k?(0,A.jsx)(o(83486).Y,{collectionContextStore:s,collectionSettingsStore:e}):void 0,(0,A.jsx)(c().A,{extraPadding:!0,topBorder:!0,children:(0,A.jsx)(o(95441).A,{href:(0,o(232930).x)("guides.charts"),title:(0,A.jsx)(g().sA,{...y().bg.chartHelp}),analyticsFrom:"view_settings_charts_help"})})]}):null}));function Zo(){const e=(0,m().ET)(),t=(0,a().K8)((()=>{var t;return Boolean(null===(t=e.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.subitem_property)}),[e]),o=(0,a().K8)((()=>null==e?void 0:e.settingsStore),[e]),i=(0,n.useCallback)((()=>{(0,S().a2)({collectionSettingsStore:o,item:{type:"subitemV2",from:"view_settings"}})}),[o]);return t?(0,A.jsx)(Xo().I,{collectionContextStore:e,onClick:i}):null}function en(e){const{collectionContextStore:t,collectionSettingsStore:n,paywallDisabled:i}=e;return(0,A.jsxs)(c().A,{extraPadding:!0,topBorder:!0,children:[(0,A.jsx)(o(542984).Q,{collectionContextStore:t,collectionSettingsStore:n,disabled:i}),(0,A.jsx)(o(704640).A,{collectionContextStore:t,collectionSettingsStore:n,disabled:i})]})}function tn(e){const t=ln(e.disabled);return(0,A.jsxs)(c().A,{extraPadding:!0,style:{paddingTop:4,paddingBottom:4},title:(0,A.jsx)(g().sA,{...y().bg.chartData}),desktopTitleStyle:t.disabled,mobileTitleStyle:t.disabled,children:[(0,A.jsx)(Ce,{...e}),(0,A.jsx)(je,{...e}),(0,A.jsx)(zt,{...e,sortType:"main"}),(0,A.jsx)(Zo,{})]})}function on(e){const{collectionViewStore:t,useYAxisLabel:o,...n}=e,i=ln(e.disabled),r=(0,a().K8)((()=>{if("groups_reducer"===e.chartConfig.dataConfig.type)return e.chartConfig.dataConfig.groupBy}),[e.chartConfig.dataConfig]);return(0,A.jsxs)(c().A,{extraPadding:!0,title:o?(0,A.jsx)(g().sA,{...y().bg.chartYAxis}):(0,A.jsx)(g().sA,{...y().bg.chartXAxis}),style:{paddingTop:4,paddingBottom:4},desktopTitleStyle:i.disabled,mobileTitleStyle:i.disabled,children:[(0,A.jsx)(Fo,{...n}),r?(0,A.jsx)(Yo().T,{groupBy:r}):null,(0,A.jsx)(zt,{...n,sortType:"main"}),(0,A.jsx)(Do,{...e})]})}function nn(e){var t,o;const{useXAxisLabel:n,disabled:i,collectionViewStore:l}=e,s=ln(i),d=(0,r().X)("chart_view_reference_line"),u=(0,a().K8)((()=>{var t;if("results_reducer"===e.chartConfig.dataConfig.type)return;return null===(t=e.chartConfig.dataConfig.aggregationConfig.stackOptions)||void 0===t?void 0:t.groupBy}),[e.chartConfig.dataConfig]),p=(0,a().K8)((()=>{var t;const o=null===(t=e.chartConfig)||void 0===t?void 0:t.dataConfig;return"results_reducer"===(null==o?void 0:o.type)||"groups_reducer"===(null==o?void 0:o.type)&&("max"===o.aggregationConfig.aggregation.aggregator||"min"===o.aggregationConfig.aggregation.aggregator||"median"===o.aggregationConfig.aggregation.aggregator||"average"===o.aggregationConfig.aggregation.aggregator||"sum"===o.aggregationConfig.aggregation.aggregator)}),[null===(t=e.chartConfig)||void 0===t?void 0:t.dataConfig]);return(0,A.jsxs)(c().A,{extraPadding:!0,title:n?(0,A.jsx)(g().sA,{...y().bg.chartXAxis}):(0,A.jsx)(g().sA,{...y().bg.chartYAxis}),style:{paddingTop:4,paddingBottom:4},desktopTitleStyle:s.disabled,mobileTitleStyle:s.disabled,children:[(0,A.jsx)(Ho,{...e}),p?(0,A.jsx)(qo,{...e}):void 0,"groups_reducer"!==(null===(o=e.chartConfig)||void 0===o||null===(o=o.dataConfig)||void 0===o?void 0:o.type)?null:(0,A.jsx)($o,{...e}),u?(0,A.jsx)(Yo().T,{groupBy:u}):null,u?(0,A.jsx)(zt,{...e,sortType:"stacked"}):null,(0,A.jsx)(Go,{...e}),(0,A.jsx)(Qo,{...e}),(0,A.jsx)(Zo,{}),d&&l?(0,A.jsx)(kt,{collectionViewStore:l,chartConfig:e.chartConfig,disabled:e.disabled}):null]})}function rn({collectionContextStore:e,chartConfig:t,paywallDisabled:o}){const n=(0,a().K8)((()=>e.collectionViewStore()),[e]),i=(0,a().O$)(e.canConfigureBlockStore),r=!t||!i||o,l=ln(r);return n&&t&&"placeholder"!==t.type?(0,A.jsxs)(c().A,{extraPadding:!0,style:{paddingTop:4},title:(0,A.jsx)(g().sA,{...y().bg.chartStyle}),desktopTitleStyle:l.disabled,mobileTitleStyle:l.disabled,children:[(0,A.jsx)(go,{collectionViewStore:n,chartConfig:t,disabled:r}),(0,A.jsx)(mo,{collectionViewStore:n,chartConfig:t,disabled:r})]}):null}function ln(e){return(0,s().IS)((()=>({disabled:{opacity:e?.4:void 0}})),[e])}},727577:(e,t,o)=>{o.d(t,{T:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"3.8 2.12 12.39 16.07",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10 5.702a2.775 2.775 0 1 0 0 5.55 2.775 2.775 0 0 0 0-5.55M8.475 8.477a1.525 1.525 0 1 1 3.05 0 1.525 1.525 0 0 1-3.05 0"}),(0,n.jsx)("path",{d:"M10 2.125a6.19 6.19 0 0 0-6.19 6.19v.129c0 1.403.467 2.767 1.327 3.876l4.37 5.626a.625.625 0 0 0 .986 0l4.37-5.626a6.32 6.32 0 0 0 1.328-3.876v-.128A6.19 6.19 0 0 0 10 2.125m-4.94 6.19a4.94 4.94 0 1 1 9.88 0v.129c0 1.126-.374 2.22-1.065 3.109L10 16.543l-3.875-4.99a5.07 5.07 0 0 1-1.066-3.109z"})]})},r=(0,o(340498).wt)("mapPin",i,"default")},728567:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>i,squareOnSquarePlusSmallIcon:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 16 16",fittedViewBox:"1.37 1.37 13.25 13.25",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M9.75 7.125a.625.625 0 0 0-.625.625v1.375H7.75a.625.625 0 1 0 0 1.25h1.375v1.375a.625.625 0 1 0 1.25 0v-1.375h1.375a.625.625 0 1 0 0-1.25h-1.375V7.75a.625.625 0 0 0-.625-.625"}),(0,n.jsx)("path",{d:"M3.25 1.375c-1.036 0-1.875.84-1.875 1.875v6c0 1.036.84 1.875 1.875 1.875h1.625v1.625c0 1.036.84 1.875 1.875 1.875h6c1.036 0 1.875-.84 1.875-1.875v-6c0-1.036-.84-1.875-1.875-1.875h-1.625V3.25c0-1.036-.84-1.875-1.875-1.875zM2.625 3.25c0-.345.28-.625.625-.625h6c.345 0 .625.28.625.625v1.625H6.75c-1.036 0-1.875.84-1.875 1.875v3.125H3.25a.625.625 0 0 1-.625-.625zm3.5 3.5c0-.345.28-.625.625-.625h6c.345 0 .625.28.625.625v6c0 .345-.28.625-.625.625h-6a.625.625 0 0 1-.625-.625z"})]})},r=(0,o(340498).wt)("squareOnSquarePlusSmall",i,"small")},739222:(e,t,o)=>{o.d(t,{$M:()=>V,RH:()=>R,Y7:()=>P,YQ:()=>B,YX:()=>M,cM:()=>K,ph:()=>$,sM:()=>G,tQ:()=>E,yF:()=>Q});o(898992),o(354520),o(672577),o(581454),o(296540);var n=()=>o(314529),i=()=>o(135168),r=()=>o(590526),l=()=>o(401497),a=()=>o(365917),s=()=>o(675133),c=()=>o(792057),d=()=>o(433337),u=()=>o(148307),p=()=>o(898244),g=()=>o(617871),m=()=>o(69708),S=()=>o(534177),y=()=>o(962910),f=()=>o(374562),h=()=>o(379830),x=()=>o(377093),v=()=>o(113105),b=()=>o(390650),C=()=>o(252833),j=()=>o(957606),w=()=>o(442025),A=()=>o(547149),I=()=>o(455338),_=()=>o(234675),T=o(474848);const k=(0,m().YK)({taskName:{id:"feature.turnIntoTasks.name",defaultMessage:"Tasks"},taskDescription:{id:"feature.turnIntoTasks.description",defaultMessage:"See your tasks in Home, manage tasks in sprints, and more"}}),M={uri:"notion://feature/turn_into_tasks_feature",name:s().A.formatMessage(k.taskName),description:s().A.formatMessage(k.taskDescription),tooltipImage:{img:u().A.images.tooltips.collectionSettings.turnIntoTasksPng,scale:.5},icon:"",collectionUri:_().R,isFeatureAdded:B};function P(e,t){const o=(0,j().$H)(),n=e.collectionStore(),i=null==n?void 0:n.getDatabaseType(),r=void 0===t||i===d().dC,l=i===d().pW,a=null==n?void 0:n.isExternalSyncedCollection();return o&&r&&!l&&!a}function B(e,t){var o;if(e.uri!==M.uri)return!1;return(null===(o=t.collectionStore())||void 0===o?void 0:o.getDatabaseType())===d().dC}function V(e){const{collectionContextStore:t,environment:o}=e;h().A.setState({isModalOpen:!0,databaseType:d().dC,collectionContextStore:t});const i=(0,b().sl)(t)||{};(0,n().DO_NOT_USE_trackLegacy)(o,"convert_db_start",{...i,database_type:d().dC})}function F(){const e=(0,l().IS)((()=>({confirmationModalDescription:{fontSize:12,display:"flex",textAlign:"center"}})),[]);return(0,T.jsx)("span",{style:e.confirmationModalDescription,children:(0,T.jsx)(m().sA,{id:"CollectionTaskTypeBadge.MoreMenu.RemoveFromHome.description",defaultMessage:"Tasks from this database will no longer appear in Home or work with Sprints."})})}function D(){const e=(0,l().IS)((()=>({confirmationModalTitle:{fontWeight:500},wrapper:{textAlign:"center"}})),[]);return(0,T.jsx)("div",{style:e.wrapper,children:(0,T.jsx)("span",{style:e.confirmationModalTitle,children:(0,T.jsx)(m().sA,{id:"CollectionTaskTypeBadge.UntypeDatabase.modal.title",defaultMessage:"Undo Task Database?"})})})}function E(e){const{environment:t,collectionContextStore:o}=e,n=[{label:(0,T.jsx)(m().sA,{id:"CollectionTaskTypeBadge.UntypeDatabase.modal.confirm",defaultMessage:"Remove"}),color:"red",onAccept:()=>{A().createAndCommit({environment:t,userAction:"CollectionTaskTypeBadge.untypeDatabase",canUndo:!0,perform:e=>{y().Fr({environment:t,collectionContextStore:o,transaction:e})}})}}];return()=>{c().ui({message:(0,T.jsx)(D,{}),description:(0,T.jsx)(F,{}),showCancel:!0,keepFocus:!0,items:n})}}const O=(0,m().YK)({featureName:{id:"feature.sprints.name",defaultMessage:"Sprints"},featureDescription:{id:"feature.sprints.description",defaultMessage:"Plan tasks in cycles with sprints"}}),R={uri:"notion://feature/sprints_feature",name:s().A.formatMessage(O.featureName),description:s().A.formatMessage(O.featureDescription),tooltipImage:{img:u().A.images.tooltips.properties.sprintsPng,scale:.5},icon:"/icons/run_gray.svg",collectionUri:_().R,isFeatureAdded:function(e,t){var o;if(e.uri!==R.uri)return!1;const n=null===(o=t.sprintSettingsContextStore.state)||void 0===o?void 0:o.permissionsContext;if(!n)return!1;return n.canEdit&&n.sprintsEnabled}};function K(e){if(!e.sprintSettingsContextStore.state)return!1;const t=e.databaseTypeFromStoreState;if(t===d().av){const t=e.collectionStore();return Boolean(t&&(0,w().$6)(t))}return t===d().dC&&function(e){const t=e.collectionStore();if(!t)return!1;const o=t.getMappedProperty(d().yx.TaskToSprintRelation),n=t.getSchema()[o];if(!n)return!0;const i=(0,v().pg)(e,n);return Boolean(i&&(0,w().$6)(i))}(e)}const N=(0,m().YK)({githubFeatureDescription:{id:"customizeMenu.github.featureDescription",defaultMessage:"Link PRs and set up automated task status updates based on PR changes"},googleDriveFeatureDescription:{id:"customizeMenu.googleDrive.featureDescription",defaultMessage:"Link Google Drive files"},figmaFeatureDescription:{id:"customizeMenu.figma.featureDescription",defaultMessage:"Link Figma pages"},zendeskFeatureDescription:{id:"customizeMenu.zendesk.featureDescription",defaultMessage:"Link Zendesk tickets"}}),z=[g().Hd,g().ob,g().e1,g().k0],L="notion://feature/connection_",U={[g().ob]:`${L}property_${g().ob}`,[g().Hd]:`${L}property_${g().Hd}`,[g().e1]:`${L}property_${g().e1}`,[g().k0]:`${L}property_${g().k0}`},W={[g().ob]:N.githubFeatureDescription,[g().Hd]:N.googleDriveFeatureDescription,[g().e1]:N.figmaFeatureDescription,[g().k0]:N.zendeskFeatureDescription},H={[g().ob]:u().A.images.tooltips.properties.githubSyncPullStatusPng,[g().Hd]:u().A.images.tooltips.properties.googleDrivePng,[g().e1]:u().A.images.tooltips.properties.figmaPng,[g().k0]:u().A.images.tooltips.properties.zendeskPng};function $(e){const t=(0,r().K8)((()=>{var t;return null===(t=(0,i().f)(e.collectionStore()))||void 0===t?void 0:t.canEdit()}),[e]),o=(0,r().K8)((()=>a().A.integrations.state),[]);return(0,r().K8)((()=>t?z.map((e=>{const t=o.find((t=>t.id===e));if(!t)return;const n=t.id===g().ob?(0,f().Jb)().name:t.name,i={uri:`${L}${e}`,name:n,description:s().A.formatMessage(W[e]),icon:t.info.icon,tooltipImage:{img:H[e],scale:.5},collectionUri:_().R,integrationId:e,isFeatureAdded:(e,t)=>Boolean(Q(t,e.integrationId))};return i})).filter(S().O9):[]),[t,o])}async function G(e){var t;const{environment:o,collectionContextStore:n,feature:i,intl:r}=e,l=a().A.integrations.state.find((e=>e.id===i.integrationId)),s=null==l||null===(t=l.info.original_url_patterns)||void 0===t?void 0:t.find((e=>{var t;return null===(t=e.additional_types)||void 0===t?void 0:t.connectedRelation}));if(!l||!s||!i.integrationId)return;const c={name:l.id===g().ob?(0,f().Jb)().name:(0,C().Fe)({pattern:s,integration:l}),pattern:s,integration:l};await x().XO({environment:o,collectionContextStore:n,connectedRelationProperty:c,intl:r,from:"customize_menu",untypedFeatureArgs:{propertyId:U[i.integrationId]},propertyGroupId:void 0}),(0,I().t)({featureName:i.name})}function Q(e,t){var o;const n=null===(o=e.collectionStore())||void 0===o?void 0:o.getSchema();if(n&&t)for(const[i,r]of Object.entries(n))if(r&&(0,p().UU)(r)&&r.connectedRelation.integration_id===t)return i}},743472:(e,t,o)=>{o.d(t,{BF:()=>n,_Q:()=>i});function n(e){return"chart"!==e&&"form_editor"!==e&&"feed"!==e&&"map"!==e&&"chat"!==e}function i(e){return"form_editor"!==e&&"feed"!==e&&"map"!==e&&"chat"!==e}},748259:(e,t,o)=>{o.d(t,{A:()=>I,B:()=>M});o(898992),o(354520),o(672577),o(581454),o(737550),o(296540);var n=()=>o(726637),i=()=>o(484714),r=()=>o(127833),l=()=>o(807449),a=()=>o(695115),s=()=>o(546926),c=()=>o(26697),d=()=>o(81068),u=()=>o(424400),p=()=>o(736847),g=()=>o(236262),m=()=>o(995847),S=()=>o(340498),y=()=>o(69708),f=()=>o(100622),h=()=>o(496603),x=()=>o(436696),v=()=>o(497222),b=()=>o(519200),C=()=>o(271205),j=()=>o(396223),w=o(474848);const A=(0,y().YK)({inputPlaceholder:{defaultMessage:"Search for a propertyâ€¦",id:"database.viewSettings.collectionSortMenu.inputPlaceholder"},deleteButtonTooltip:{defaultMessage:"Remove sort rule",id:"database.sortMenu.deleteButtonTooltip"}});const I=function({schema:e,format:t,sorts:l,showDeleteAll:a,disabled:c,parentStore:d,collectionContextStore:u,onChange:m,onDeleteAll:S}){const f=(0,y().tz)(),h=(0,i().v3)(),b=!!Object.keys(e).some((e=>!l.find((t=>t.property===e)))),C=a&&l.length>0,j=(0,o(590526).K8)((()=>{var e;return null===(e=u.collectionViewStore())||void 0===e?void 0:e.getCollectionSource()}),[u]);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(B,{sorts:l,schema:e,disabled:c,parentStore:d,collectionContextStore:u,onChange:m}),b||C?(0,w.jsxs)(p().A,{children:[b?(0,w.jsx)(o(250910).A,{popupType:n().A.isMobile?r().nl.SlideUp:r().nl.Popup,renderOrigin:e=>(0,w.jsx)(v().A,{icon:o(617668).plusIcon,isGray:!0,title:(0,w.jsx)(y().sA,{id:"database.viewSettings.sortTab.newSort",defaultMessage:"Add sort"}),...e}),render:i=>{let r;return r=n().A.isMobile?{menuType:s().gu.ActionSheet}:{menuType:s().gu.Popup,width:280,height:287},(0,w.jsx)(o(890492).A,{...r,children:(0,w.jsx)(o(380468).A,{schema:e,format:t,getProperties:()=>Object.entries(e).filter((([e,t])=>!l.find((t=>t.property===e))&&(0,o(835195).oH)(t,j))).map((([e])=>e)),onAccept:t=>{!function(e,t,o,n,i,r){var l;if(!e)return;const a=null===(l=o[e])||void 0===l?void 0:l.type,s=[...n,{property:e,direction:"ascending"}];i(s),(0,x().X)({environment:t,action:"create_sort_accept",collectionContextStore:r,property_type:a})}(t,h,e,l,m,u),i.close()},inputPlaceholder:f.formatMessage(A.inputPlaceholder)})})}}):void 0,C?(0,w.jsx)(v().A,{icon:g().trashIcon,isRedOnHover:!0,isGray:!0,title:(0,w.jsx)(y().sA,{id:"database.viewSettings.sortTab.deleteAllSorts",defaultMessage:"Delete sort"}),onClick:()=>function(e,t,o,n){t([]),null==n||n(),(0,x().X)({environment:e,action:"delete_all_sorts",collectionContextStore:o})}(h,m,u,S)}):void 0]}):void 0]})};function _(e,t,o,n,i,r){n(i.map(((o,n)=>n===e?t:o))),(0,x().X)({environment:o,collectionContextStore:r,action:"update_sort"})}function T(e,t,o,n,i){o(n.filter(((t,o)=>o!==e))),(0,x().X)({environment:t,action:"delete_sort",collectionContextStore:i})}function k({index:e,onChange:t,sorts:o,collectionContextStore:n}){const r=(0,i().v3)();return(0,w.jsx)(d().A,{title:(0,w.jsx)("div",{style:{color:f().oZ.red},children:(0,w.jsx)(y().sA,{defaultMessage:"Delete",id:"database.viewSettings.sortTab.mobileDeleteButtonTitle"})}),icon:(0,w.jsx)(l().I,{icon:g().trashIcon,colorPalette:"red",colorVariant:"accentPrimary"}),onClick:()=>T(e,r,t,o,n),focused:!1})}function M({onDeleteClick:e}){const t=(0,y().tz)();return(0,w.jsx)(c().m,{render:o=>(0,w.jsx)(a().A,{ariaLabel:t.formatMessage(A.deleteButtonTooltip),icon:m().xMarkSmallIcon,iconStyle:{width:S().Ev.sm,height:S().Ev.sm},onClick:e,style:{marginInlineEnd:-6},...o}),renderTooltip:()=>t.formatMessage(A.deleteButtonTooltip)})}function P({sort:e,index:t,schema:o,disabled:r,parentStore:l,collectionContextStore:a,onChange:s,sorts:c}){const d=(0,i().v3)();return n().A.isMobile?(0,w.jsxs)(p().A,{children:[(0,w.jsx)(j().Ay,{index:t,sort:e,schema:o,parentStore:l,collectionContextStore:a,onChange:(e,t)=>_(e,t,d,s,c,a)}),r?void 0:(0,w.jsx)(k,{onChange:s,sorts:c,collectionContextStore:a,index:t})]}):(0,w.jsx)(p().A,{extraTopPadding:!0,desktopStyle:{paddingTop:8,paddingInlineEnd:0,paddingBottom:0,paddingInlineStart:8,width:"100%"},children:(0,w.jsx)(u().Ay,{showDragHandle:!n().A.isMobile&&!r,title:(0,w.jsx)("div",{style:{display:"flex",alignItems:"center",flexGrow:1,whiteSpace:"nowrap"},onMouseDown:b().t,children:(0,w.jsx)(j().Ay,{index:t,sort:e,schema:o,parentStore:l,collectionContextStore:a,onChange:(e,t)=>_(e,t,d,s,c,a)})}),right:!r&&(0,w.jsx)(M,{onDeleteClick:()=>T(t,d,s,c,a)}),rightStyle:{marginInlineEnd:19}})})}function B({sorts:e,schema:t,disabled:o,parentStore:r,collectionContextStore:l,onChange:a}){const s=(0,i().v3)();if(n().A.isMobile)return(0,w.jsx)(w.Fragment,{children:e.map(((n,i)=>(0,w.jsx)(P,{schema:t,disabled:o,parentStore:r,collectionContextStore:l,onChange:a,sorts:e,sort:n,index:i},i)))});{const n=e.map(((e,t)=>t.toString()));return n.length>0?(0,w.jsx)("div",{style:{marginBottom:2},children:(0,w.jsx)(C().Ay,{direction:"vertical",keys:n,renderKey:n=>(0,w.jsx)(P,{schema:t,disabled:o,parentStore:r,collectionContextStore:l,onChange:a,sorts:e,sort:e[parseInt(n)],index:parseInt(n)}),onDrop:t=>function(e,t,o,n,i){o(h().oE(e.map((e=>n[parseInt(e)])))),(0,x().X)({environment:t,action:"reorder_sorts",collectionContextStore:i})}(t,s,a,e,l)})}):null}}},748696:(e,t,o)=>{o.d(t,{w:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.25 15.25",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M7.99 2.644a.624.624 0 0 1 .327 1.205 6.375 6.375 0 1 0 7.807 7.928.626.626 0 0 1 1.201.347 7.625 7.625 0 1 1-9.336-9.48"}),(0,n.jsx)("path",{d:"M7.857 6.475a.625.625 0 0 1 .65 1.068 2.875 2.875 0 1 0 3.905 4.022l.08-.1a.625.625 0 0 1 .969.78l-.144.207a4.125 4.125 0 1 1-5.46-5.977M10 2.375A7.625 7.625 0 0 1 17.625 10c0 .345-.28.625-.625.625h-3.5a.625.625 0 0 1-.625-.625A2.875 2.875 0 0 0 10 7.125a.625.625 0 0 1-.625-.625V3l.013-.126A.625.625 0 0 1 10 2.375m.625 3.547a4.13 4.13 0 0 1 3.452 3.453h2.267a6.376 6.376 0 0 0-5.719-5.72z"})]})},r=(0,o(340498).wt)("donutChart",i,"default")},751704:(e,t,o)=>{o.d(t,{S:()=>u});var n=o(296540),i=()=>o(484714),r=o(474848);const l={viewBox:"0 0 16 16",fittedViewBox:"2.37 2.37 11.26 11.26",svg:(0,r.jsx)("path",{d:"M11.8 2.375c-.788 0-1.46.5-1.715 1.2H5.05a2.525 2.525 0 1 0 0 5.05h6.05a1.275 1.275 0 1 1 0 2.55H5.915a1.826 1.826 0 1 0 0 1.25H11.1a2.525 2.525 0 1 0 0-5.05H5.05a1.275 1.275 0 1 1 0-2.55h5.035a1.826 1.826 0 1 0 1.715-2.45M11.225 4.2v-.005a.575.575 0 1 1 0 .01z"})},a=(0,o(340498).wt)("pathRoundEndsSmall",l,"small");var s=()=>o(69708),c=()=>o(468397),d=()=>o(497222);function u({collectionContextStore:e,isGray:t}){const o=(0,i().v3)(),l=(0,n.useCallback)((()=>{(0,c().q)(o,e)}),[o,e]);return(0,r.jsx)(d().A,{icon:a,title:(0,r.jsx)(s().sA,{defaultMessage:"Task sources",id:"database.viewSettings.mainTab.sourcesButton.title"}),showChevron:!0,onClick:l,isGray:t})}},762631:(e,t,o)=>{o.d(t,{U:()=>i});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"3.25 2.03 10.46 11.93",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M3.25 13.165a.8.8 0 0 0 1.203.69l8.854-5.164a.8.8 0 0 0 0-1.382L4.453 2.144a.8.8 0 0 0-1.203.691z"})},i=(0,o(340498).wt)("arrowCaretRightFillSmall",n,"fillSmall")},768627:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){return{searchQuery:"",searchLimit:n.limitIncrement,searchPopupOpen:!1,addingPage:!1}}}n.limitIncrement=20,n.resultsCacheTTL=2*o(720665).Xb,n.incrementScrollOffset=200;const i=n},793863:(e,t,o)=>{o.d(t,{H:()=>B,Mq:()=>F,oA:()=>V});o(581454);var n=o(296540),i=()=>o(907258),r=()=>o(484714),l=()=>o(590526),a=()=>o(401497),s=()=>o(807449),c=()=>o(493552),d=()=>o(663639),u=()=>o(736847),p=()=>o(536095),g=()=>o(177148),m=()=>o(421559),S=()=>o(826693),y=()=>o(201980),f=()=>o(69708),h=()=>o(778078),x=()=>o(496603),v=()=>o(310526),b=()=>o(902842),C=()=>o(913454),j=()=>o(239924),w=()=>o(458097),A=()=>o(699143),I=()=>o(100622),_=()=>o(115512),T=o(474848);const k=n.forwardRef(((e,t)=>{const{icon:n,label:i,description:l,...d}=e,{isPhone:u}=(0,r().Y0)(),p=(0,a().IS)((()=>({button:{width:"100%",borderRadius:12,margin:0,...(0,_().nl)({width:1,color:I().Tj.border.strong})},hovered:u?{}:{background:I().Tj.background.elevated,...(0,_().nl)({width:2,color:I().Tj.blue.border.strong})},pressed:{background:I().Tj.background.elevated,...(0,_().nl)({width:2,color:I().Tj.blue.border.accentPrimary})},templateIcon:{marginTop:l?2:0},enterIcon:{justifySelf:"end"}})),[l,u]);return(0,T.jsx)(o(81068).A,{...d,buttonStyle:p.button,hoveredStyle:p.hovered,pressedStyle:p.pressed,itemMarginLeft:0,itemMarginRight:8,ref:t,title:(0,T.jsxs)(A().Y1,{direction:"horizontal",align:l?"top-left":"center-left",gap:12,padding:"12px 14px",children:[(0,T.jsx)("div",{style:p.templateIcon,children:n}),(0,T.jsxs)(A().Y1,{gap:4,children:[(0,T.jsx)(c().D,{styleKey:"bodyMedium",children:i}),l?(0,T.jsx)(c().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:l}):void 0]}),d.focused?(0,T.jsx)("span",{style:p.enterIcon,children:(0,T.jsx)(s().I,{icon:o(412975).arrowTurnDownLeftIcon,colorVariant:"tertiary"})}):void 0]})})}));k.displayName="SearchResultButton";var M=()=>o(992032);function P(e){const{template:t,label:o,description:n}=e;return(0,T.jsx)(k,{icon:(0,T.jsx)(b().z,{template:t,size:18}),label:o??t.value.targetCollection.name,description:n??t.description,...e})}function B({query:e,onSelectTemplate:t,onAddEmptyPage:o,onAddEmptyDatabase:h,onMarketplaceClick:b,showEmptyPageButton:A}){const I=(0,l().K8)((()=>(0,C().getIsSetupGeneratorEnabled)(void 0,void 0)),[]),{isPhone:_}=(0,r().Y0)(),B=(0,a().IS)((()=>({optionIcon:{width:"auto"},section:{gap:8,paddingTop:0,paddingInlineEnd:0,paddingBottom:8,paddingInlineStart:0},sectionTitle:{paddingTop:16,paddingInlineEnd:0,paddingBottom:0,paddingInlineStart:0,marginTop:0,marginBottom:4}})),[]),D=function(e){const t=(0,l().K8)((()=>V()),[]);return(0,n.useMemo)((()=>F(e,t)),[e,t])}(e),E=(0,l().K8)((()=>C().globalWorkflowTemplates.fromIdOfType({templateId:p().MH,type:"collection"})),[]),O=D.map((e=>({key:e.templateId,render:({ref:t,...o})=>(0,T.jsx)(P,{template:e,...o}),action:()=>t(e,{type:"suggested_template",allOrderedTemplateIds:D.map((e=>e.templateId))})}))),R=(0,n.useMemo)((()=>I?{key:p().MH,render:({ref:t,...o})=>(0,T.jsx)(P,{template:E,label:(0,T.jsx)(f().sA,{id:"workflowTemplatesOnboardingModal.searchResults.buildWithAiLabel",defaultMessage:"Build â€œ{searchQuery}â€ with AI",values:{searchQuery:e}}),description:(0,T.jsx)(f().sA,{id:"workflowTemplatesOnboardingModal.searchResults.buildWithAiDescription",defaultMessage:"Use AI to generate a tailored setup"}),...o}),action:async()=>{t(E,{type:"ai_generated_template"});const o=w().default.state;if(!o.open||!o.setupGenerator)return;o.setupGenerator.store.setState({...o.setupGenerator.store.state,prompt:(0,y().x9d)(e)}),(0,j().moveToNextOnboardingStep)(_);await o.setupGenerator.submitPrompt({from:"initial-input"})&&(0,j().moveToNextOnboardingStep)(_)}}:void 0),[I,E,e,t,_]),K=(0,l().K8)((()=>{const e=i().default.state.sidebarSpaceViewStore;return(0,v().U)(e)}),[]),N=(0,n.useMemo)((()=>(0,x().oE)([A?{key:"new-page",render:t=>(0,T.jsx)(k,{icon:(0,T.jsx)(s().I,{icon:g().Y,colorVariant:"secondary",style:B.optionIcon}),label:(0,T.jsx)(f().sA,{id:"workflowTemplatesOnboardingModal.searchResults.newPage",defaultMessage:"New â€œ{searchQuery}â€ page",values:{searchQuery:e}}),...t}),action:()=>o({title:e})}:void 0,{key:"new-database",render:t=>(0,T.jsx)(k,{icon:(0,T.jsx)(s().I,{icon:m().T,colorVariant:"secondary",style:B.optionIcon}),label:(0,T.jsx)(f().sA,{id:"workflowTemplatesOnboardingModal.searchResults.newDatabase",defaultMessage:"New â€œ{searchQuery}â€ database",values:{searchQuery:e}}),...t}),action:()=>h({title:e})},{key:"marketplace",render:e=>K?null:(0,T.jsx)(k,{icon:(0,S().notionTemplateIcon)(B.optionIcon),label:M().Ac,...e}),action:e=>b(e.event)}])),[A,B.optionIcon,e,o,h,b,K]),z=(0,n.useMemo)((()=>[{key:"collection-templates",items:(0,x().oE)([...O,R]),render:e=>(0,T.jsx)(u().A,{title:(0,T.jsx)(c().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:(0,T.jsx)(f().sA,{id:"workflowTemplatesOnboardingModal.searchResults.topResults",defaultMessage:"Top results"})}),style:B.section,desktopTitleStyle:B.sectionTitle,mobileTitleStyle:B.sectionTitle,...e})},{key:"more-options",items:N,render:e=>(0,T.jsx)(u().A,{title:(0,T.jsx)(c().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:(0,T.jsx)(f().sA,{id:"workflowTemplatesOnboardingModal.searchResults.moreOptions",defaultMessage:"More options"})}),style:B.section,desktopTitleStyle:B.sectionTitle,mobileTitleStyle:B.sectionTitle,...e})}]),[O,R,N,B]);return(0,T.jsx)(d().A,{initialFocus:0,type:d().O.Vertical,sections:z})}function V(){const e=x().sb([...(0,p().dj)(),...(0,p().Lh)()]);return C().globalWorkflowTemplates.allOfType({templateIds:e,type:"collection"})}function F(e,t){return(0,h().Ay)(e,t,(e=>`${e.value.targetCollection.name} ${e.description}`),{minScore:h().qR,normalizeFuzzyScore:!0})}},810521:(e,t,o)=>{o.r(t),o.d(t,{trackCreateNewEmptyDataSource:()=>r,trackDeleteDataSource:()=>a,trackLinkedExistingDataSource:()=>l,trackManageDataSources:()=>i});var n=()=>o(564884);function i(e,t){(0,n().u)({environment:e,event:{eventName:"manage_data_sources",eventProperties:t}})}function r(e,t){(0,n().u)({environment:e,event:{eventName:"create_new_empty_data_source",eventProperties:t}})}function l(e,t){(0,n().u)({environment:e,event:{eventName:"linked_existing_data_source",eventProperties:t}})}function a(e,t){(0,n().u)({environment:e,event:{eventName:"delete_data_source",eventProperties:t}})}},817045:(e,t,o)=>{o.d(t,{S:()=>g});var n=o(296540),i=()=>o(394888),r=()=>o(89002),l=()=>o(835470),a=()=>o(69708),s=()=>o(898568),c=()=>o(241021),d=()=>o(838239),u=()=>o(227358),p=o(474848);function g({onCancel:e,onSubmit:t,headerText:o,bylineText:g,submitText:m}){const[S,y]=(0,n.useState)(!1);return(0,p.jsx)(i().s,{isOpen:!0,onDismiss:e,areaConstraint:{width:{type:"min",length:s().NF}},render:()=>(0,p.jsx)(r().t,{header:(0,p.jsx)(d().Y,{iconAndTitle:(0,p.jsx)(u().Z,{iconGroup:l().F,iconColorPalette:"red",iconColorVariant:"accentPrimary",title:o}),description:g}),footer:(0,p.jsx)(c().a,{primaryButtons:[{buttonType:"destructive",label:m,onClick:async()=>{y(!0),await t(),y(!1)},isDisabled:S}],secondaryButtons:[{buttonType:"dismiss",label:(0,p.jsx)(a().sA,{id:"destructiveActionModal.button.cancel",defaultMessage:"Cancel"})}],layout:"vertical"})})})}},858901:(e,t,o)=>{o.d(t,{rs:()=>i,zx:()=>r});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520);var n=o(296540);function i(e){const t=[];let o=0;for(const n of e)for(const e of n.items){if("searchKeys"in e&&Array.isArray(e.searchKeys)&&e.searchKeys.length>0)for(const n of e.searchKeys)t.push({key:n,globalIndex:o});else t.push({key:String(e.key),globalIndex:o});o+=1}return t}function r(e){const t=(0,n.useMemo)((()=>{const t=new Map;for(const o of e){const e=o.key.toLowerCase().trim().split(/\s+/).filter((e=>e.length>0));for(const n of e)t.has(n)||t.set(n,new Set),t.get(n).add(o)}return t}),[e]);return(0,n.useCallback)((e=>{var o;if(!e.trim())return;const n=e.toLowerCase().trim().split(/\s+/).filter((e=>e.length>0));if(0===n.length)return;const i=new Map;for(const a of n){const e=t.get(a);if(e)for(const t of e){const e=i.get(t)||0;i.set(t,e+1)}}let r,l=0;for(const[t,a]of i){const e=1e3*a-t.globalIndex;e>l&&(l=e,r=t)}return null===(o=r)||void 0===o?void 0:o.globalIndex}),[t])}},859236:(e,t,o)=>{o.d(t,{A:()=>G,g:()=>$});o(581454);var n=o(296540),i=()=>o(484714),r=()=>o(824862),l=()=>o(96689),a=()=>o(908928),s=()=>o(106702),c=()=>o(920198),d=()=>o(692031),u=()=>o(212497),p=()=>o(590526),g=()=>o(250910),m=()=>o(396896),S=()=>o(807449),y=()=>o(631524),f=()=>o(940148),h=()=>o(26697),x=()=>o(302501),v=()=>o(799288),b=()=>o(951105),C=()=>o(158661),j=()=>o(792071),w=()=>o(798880),A=()=>o(69708),I=()=>o(496603),_=()=>o(534177),T=()=>o(284371),k=()=>o(384100),M=o(474848);const P={container:{display:"flex",alignItems:"center",fontSize:T().J.UIRegular.desktop,overflow:"hidden"},userAvatar:{paddingInlineEnd:6},userName:{flexShrink:1,...T().RC}};function B(e,t){const o=j().Bj6.fromValue(r().GP,e);return o.getCreatedByTable()===w().oo&&o.getCreatedById()===t}function V({onRevokeToken:e}){const t=(0,A().tz)(),[i,r]=(0,n.useState)(!1);return(0,M.jsx)(h().m,{textWrap:!1,renderTooltip:()=>(0,M.jsx)(A().sA,{defaultMessage:"Revoke this token.",id:"revokeTokenButton.tooltip"}),placement:"right",render:n=>(0,M.jsx)(g().A,{popupType:g().z.Popup,placementToOrigin:"right",renderOrigin:e=>(0,M.jsx)(o(695115).A,{className:o(882722).hqd,ariaLabel:t.formatMessage({id:"revokeTokenButton.tooltip",defaultMessage:"Revoke this token."}),icon:o(259476).trashSmallIcon,colorPalette:"gray",colorVariant:"secondary",...n,...e}),onClick:()=>{r(!0)},render:t=>i?(0,M.jsx)(o(817045).S,{onCancel:t.close,onSubmit:e,headerText:(0,M.jsx)(A().sA,{id:"manageSCIMTokenTable.ConfirmDeletingTokenModal.message",defaultMessage:"Revoke this token?"}),bylineText:(0,M.jsx)(A().sA,{id:"manageSCIMTokenTable.ConfirmDeletingTokenModal.description",defaultMessage:"Existing SCIM configurations that use this token will no longer work once the token is revoked, and youâ€™ll have to provide them with a new token."}),submitText:(0,M.jsx)(A().sA,{id:"manageSCIMTokenTable.ConfirmDeletingTokenModal.acceptButton.label",defaultMessage:"Revoke token"})}):null})})}function F(){return(0,M.jsx)(h().m,{textWrap:!1,renderTooltip:()=>(0,M.jsx)(A().sA,{defaultMessage:"Outdated token. Revoke this token and generate a new one to view its contents.",id:"manageScimTokenTable.OutdatedWarningIcon.tooltip"}),placement:"right",render:e=>(0,M.jsx)("div",{...e,children:(0,M.jsx)(S().I,{icon:C().exclamationMarkTriangleFillSmallIcon,size:"xs",colorPalette:"orange",colorVariant:"accentPrimary"})})})}function D({clipboardTextFn:e}){const t=(0,i().v3)();return(0,M.jsx)(y().p,{size:"xs",onClick:async function(){const o=await e();if(void 0!==o){const[e,n]=await Promise.all([(0,d().r)(),(0,u().jd)()]);n({environment:t,stringValue:o,copiedMessage:e.copiedToClipboard,showCopyModal:!!t.device.isSafari||void 0})}},iconLeading:b().k,children:(0,M.jsx)(A().sA,{defaultMessage:"Copy",id:"codeBlock.copyToClipboard.button"})})}const E="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢";function O(){return(0,M.jsx)(h().m,{textWrap:!1,renderTooltip:()=>(0,M.jsx)(A().sA,{defaultMessage:"This token can only be viewed by its creator.",id:"manageScimTokenTable.renderTokenThatCannotBeViewed.tooltip"}),placement:"right",render:e=>(0,M.jsx)("div",{...e,children:E})})}function R({row:e}){const t=(0,i().v3)();return e.legacy?(0,M.jsxs)(m().fI,{alignItems:"center",gap:4,children:[E,(0,M.jsx)(F,{})]}):e.ownedByCurrentUser?(0,M.jsxs)(m().fI,{gap:2,children:[E,(0,M.jsx)(D,{clipboardTextFn:()=>a().dA({environment:t,botId:e.id})})]}):(0,M.jsx)(O,{})}const K={id:"token",headerTitle:(0,M.jsx)(A().sA,{id:"manageScimTokenTable.columnTitle.token",defaultMessage:"Token"}),renderCell:e=>(0,M.jsx)(R,{row:e}),widthData:{width:40},sortable:!1,hasClickableContents:!0};function N(){const e=P;return(0,M.jsx)(h().m,{textWrap:!1,renderTooltip:()=>(0,M.jsx)(A().sA,{defaultMessage:"This token was created by a user who is no longer an admin in the workspace.",id:"scimTableLegacyUserCell.tooltip"}),placement:"right",render:t=>(0,M.jsx)("div",{...t,children:(0,M.jsxs)("div",{style:e.container,children:[(0,M.jsx)(o(453697).A,{style:e.userAvatar,avatarShouldShowShadow:!0,size:20}),(0,M.jsx)("div",{style:e.userName,children:(0,M.jsx)("i",{children:"Deactivated user"})})]})})})}const z={id:"addedBy",headerTitle:(0,M.jsx)(A().sA,{id:"manageScimTokenTable.columnTitle.addedBy",defaultMessage:"Added by"}),renderCell:e=>{if(e.legacy)return(0,M.jsx)(N,{});{const t=e.ownedByCurrentUser?(0,M.jsx)(x().A,{isSecondaryColor:!0,style:{marginInlineStart:4,textAlign:"center"},children:(0,M.jsx)(A().sA,{id:"manageSCIMTokenTable.colums.addedBy.selfIndicator",defaultMessage:"(you)"})}):null;return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(o(317131).l,{isClickable:!1,userStores:[e.ownerUserStore]}),t]})}},widthData:{width:40},sortable:!1,hasClickableContents:!1},L={id:"created",headerTitle:(0,M.jsx)(A().sA,{id:"manageScimTokenTable.columnTitle.created",defaultMessage:"Created"}),renderCell:e=>(0,M.jsx)(o(625383).d,{includeTime:!0,dateTs:e.createdAt}),widthData:{width:40},sortable:!0,hasClickableContents:!1},U=[K,z,L,{id:"revokeToken",headerTitle:void 0,renderCell:e=>(0,M.jsx)(V,{onRevokeToken:e.onRevokeToken}),widthData:{width:10},sortable:!1,hasClickableContents:!0}];function W(e,{column:t,sortAscending:o}){const n=null==t?void 0:t.id;let i=e=>e.id;switch(n){case"name":i=e=>e.name;break;case"created":i=e=>e.createdAt;break;case"token":case"addedBy":case"revokeToken":case void 0:break;default:(0,_().HB)(n)}const r=I().Ul(e,i);return o||r.reverse(),r}function H({botStores:e,onRevokeToken:t}){const o=(0,s().$)(),i=(0,c().L)(),l=(0,A().tz)(),a=(0,p().K8)((()=>{if(!i)return[];const n=null==o?void 0:o.id;return I().oE(e.map((e=>{const o=e.getModel();if(!o||!(0,v().SZ)(o))return;const a={id:o.id,isClickable:!1,createdAt:o.getCreatedAt(),userLocale:l.locale,name:o.getName(),onRevokeToken:async()=>{await t(o.id)}},s=function(e){const t=j().Bj6.fromValue(r().GP,e);return"notion_user"===t.getCreatedByTable()&&t.getCreatedById()===w().BF.id}(o);return s?{...a,legacy:s}:{...a,legacy:s,ownedByCurrentUser:B(o,n),ownerUserStore:o.getCreatedByTable()===w().oo?(0,k().z)({userId:o.getCreatedById(),spaceStore:i}):void 0}})))}),[e,i,o,l.locale,t]),[d,u]=(0,n.useState)({column:L,sortAscending:!1}),g=(0,n.useMemo)((()=>(0,f().rC)({columnRenderInfo:U,containerMarginTop:0})),[]);return(0,M.jsx)(f().WE,{columnRenderInfo:U,rows:W(a,d),sortState:d,onSortStateChanged:u,onRowClick:()=>null,renderNoRowsComponent:()=>(0,M.jsx)(x().A,{isSmall:!0,style:{marginTop:15,marginBottom:40,textAlign:"center"},children:(0,M.jsx)(A().sA,{id:"manageSCIMTokenTable.noTokensFound.message",defaultMessage:"No active SCIM tokens."})}),styles:g})}async function $({environment:e,spaceId:t}){return(await a().Ju({environment:e,table:l().NX,id:t,type:"scim"})).botIds}const G=function({botIds:e,setBotIds:t,spaceStore:l}){const s=(0,i().v3)(),c=l.id;if((0,n.useEffect)((()=>{void 0===e&&$({environment:s,spaceId:c}).then(t)}),[e,s,t,c]),e){const n=e.map((e=>o(457205).v.createChildStore(l,{table:r().GP,id:e,spaceId:c})));return(0,M.jsx)(H,{botStores:n,onRevokeToken:async e=>{await a().KA({environment:s,botId:e,onSuccess:()=>{$({environment:s,spaceId:c}).then(t)}})}})}return(0,M.jsx)(o(98126).k,{})}},885749:(e,t,o)=>{o.d(t,{A:()=>d,u:()=>s});o(898992),o(803949),o(581454);var n=o(296540),i=()=>o(250910),r=()=>o(663639),l=()=>o(69708),a=o(474848);const s=(0,l().YK)({hide:{id:"PersonalHomePanel.moreDropdown.hide.title",defaultMessage:"Hide from Home"}});function c({actions:e}){const t=(0,l().tz)(),c=(0,n.useMemo)((()=>{const t={};return e.forEach((e=>{"custom"===e.type&&(t[e.item.key]=e.closeOnAccept)})),t}),[e]),d=[{key:"all",render:e=>(0,a.jsx)(o(736847).A,{...e}),items:e.map((e=>{switch(e.type){case"hide":return{key:"hide",render:e=>(0,a.jsx)(o(81068).A,{...e,icon:(0,a.jsx)(o(807449).I,{icon:o(566910).e}),title:t.formatMessage(s.hide),style:{borderRadius:o(665579)._g}}),action:e.hide};case"custom":return e.item;default:(0,o(534177).HB)(e)}}))}];return(0,a.jsx)(i().A,{popupType:i().z.Popup,alignmentToOrigin:"center",originGap:2,renderOrigin:e=>(0,a.jsx)(o(167068).A,{...e}),render:e=>(0,a.jsx)(o(890492).A,{menuType:o(546926).gu.Popup,children:(0,a.jsx)(r().A,{onAccept:t=>((e,t)=>{c[e.key]&&t.close()})(t,e),type:r().O.Vertical,sections:d,initialFocus:void 0})})})}const d=n.memo(c)},899725:(e,t,o)=>{o.d(t,{T:()=>c});o(944114),o(898992),o(354520);var n=()=>o(569797),i=()=>o(197636),r=()=>o(653002),l=()=>o(459894),a=()=>o(384944),s=()=>o(174826);function c(e){const{transaction:t,collectionContextStore:o,viewId:c,analytics:d}=e,u=o.dashboardWidgetStore.state,p=null==u?void 0:u.dashboardCollectionViewBlockStore,g=null==u?void 0:u.dashboardViewStore,m=p||o.collectionViewBlockStore();if(!m)return;const S=m.getSpaceId();if(!S)return;const y=(0,r().Q)({collectionViewId:c,spaceId:S}),f=n().p.createChildStore(m,y);a().zv({store:f,data:{alive:!1},transaction:t});let h,x=g,v=null;if(x){const e=x.getFormat();v=null==e?void 0:e.dashboard_layout_pointer}else{const e=m.getCollectionViewStores();for(const t of e)if("dashboard"===t.getType()){const e=t.getFormat();if(null!=e&&e.dashboard_layout_pointer){x=t,v=e.dashboard_layout_pointer;break}}}if(v&&x){const e=i().K.createChildStore(x,v),o=e.getRawModules(),n=(0,l().M)(o),r=[];for(const t of n){const e=t.modules.filter((e=>e.collection_view_id!==c));e.length>0&&r.push({...t,modules:e})}h=r.reduce(((e,t)=>e+t.modules.length),0),a().zv({store:e,data:{modules:{dashboard_layout_schema:r,page_layout_schema:(null==o?void 0:o.page_layout_schema)??void 0,page_info_layout_schema:(null==o?void 0:o.page_info_layout_schema)??void 0,form_layout_schema:(null==o?void 0:o.form_layout_schema)??void 0,person_profile_page_main:(null==o?void 0:o.person_profile_page_main)??void 0,person_profile_page_details:(null==o?void 0:o.person_profile_page_details)??void 0}},transaction:t})}d&&(0,s().Jy)({environment:d.environment,action:"delete_widget",entrypoint:d.entrypoint,dashboardViewId:d.dashboardViewId,widgetViewId:c,widgetCount:h??0})}},908375:(e,t,o)=>{o.d(t,{c:()=>j});var n=o(296540),i=()=>o(383036),r=()=>o(24796),l=()=>o(86269),a=()=>o(839897),s=()=>o(699143),c=()=>o(807449),d=()=>o(493552),u=()=>o(26697),p=()=>o(69708),g=()=>o(664594),m=()=>o(484714),S=()=>o(590526),y=()=>o(741615),f=()=>o(523036),h=()=>o(803025),x=()=>o(341233),v=()=>o(594843),b=()=>o(414236);var C=o(474848);function j(e){const{upsell:t,source:o,showTooltip:j,children:w,spaceStore:A}=e,{customTitleMessages:I,description:_,content:T,showIcon:k=!0,showTitle:M=!0,maxWidth:P=240,placement:B="bottom"}=e.tooltipProps??{},V=(0,p().tz)(),{upgradeEligibility:F,handleClick:D}=function({upsell:e,source:t,spaceStore:o}){const i=(0,m().v3)(),r=(0,h().q)(),l=(0,y()._3)({spaceId:null==o?void 0:o.id}),a=(0,f().R)(t),s=(0,g().T)(),[c,d]=(0,b().h)({upsell:e}),u=(0,S().K8)((()=>(0,v().a)({environment:i,upsell:e,spaceStore:o,salesStatus:r,offer:a,requestState:c,billingData:l,source:t})),[o,i,e,r,a,c,l,t]),p=n.useCallback((async()=>{const n="product"===e.type?e.product:void 0,{getUpgradeSystemAction:r}=await x().H.upgradeSystemActions.load(),a=r(u);await a({setRequestState:d,userId:s,source:t,spaceStore:o,product:n,billingData:l,environment:i})}),[d,u,s,t,o,e,l,i]);return{upgradeEligibility:u,handleClick:p}}({upsell:t,source:o,spaceStore:A}),E=F.status,O=(0,a().e)(E),R=j?null!=I&&I[E]?V.formatMessage(I[E]):O.label.text({intl:V,upsell:t}):null,K=!(k||_||T||M);if(O.disabledTooltip){const e=j?null!=I&&I[E]?V.formatMessage(I[E]):O.disabledTooltip({intl:V,upsell:t}):null;return(0,C.jsx)(r().T,{placement:j?B:void 0,tooltipMessage:e,children:w({upgradeStatus:E,handleClick:D,isDisabled:!0})})}return j?(0,C.jsx)(u().m,{placement:B,style:{maxWidth:P,width:"fit-content",padding:K?"4px 8px":M?"6px 8px":"0px 10px"},renderTooltip:()=>(0,C.jsxs)(s().Y1,{direction:"vertical",gap:8,width:"hug",children:[(0,C.jsxs)(s().Y1,{direction:"horizontal",gap:T?6:4,align:"top-left",children:[k?(0,C.jsx)(c().I,{...(0,l().e4)({icon:O.icon({upsell:t}),animationState:"initial"}),size:"xs"}):null,M?(0,C.jsx)(d().D,{styleKey:"captionMedium",colorVariant:"inversePrimary",children:R}):null]}),_?(0,C.jsx)(d().D,{styleKey:"captionRegular",colorVariant:"inverseSecondary",children:_}):null,T??null]}),render:e=>n.cloneElement(w({upgradeStatus:E,handleClick:D,isDisabled:!1}),(0,i().A)(e,w({upgradeStatus:E,handleClick:D,isDisabled:!1}).props)),textWrap:!0}):w({upgradeStatus:E,handleClick:D,isDisabled:!1})}},916727:(e,t,o)=>{o.d(t,{F:()=>d});o(296540);var n=()=>o(695115),i=()=>o(995847),r=()=>o(340498),l=()=>o(69708),a=()=>o(100622),s=()=>o(284371),c=o(474848);function d(e){const{title:t,icon:o,style:d,children:u,right:p,showCloseButton:g,onClose:m}=e,S=(0,l().tz)(),y=(0,c.jsx)(n().A,{ariaLabel:S.formatMessage({id:"collectionSettingsNotification.closeButton.ariaLabel",defaultMessage:"Close"}),onClick:m,style:{display:"flex",alignItems:"center",justifyContent:"center",background:void 0,borderRadius:6,width:16,height:16},icon:i().xMarkSmallIcon,iconStyle:{width:r().Ev.xs,height:r().Ev.xs,fill:a().Tj.text.secondary}});return(0,c.jsxs)("div",{style:{padding:"12px 16px",margin:"4px 12px",fontSize:12,background:a().Tj.palette.orange[50],borderRadius:6,...d},children:[t?(0,c.jsxs)("div",{style:{display:"flex",marginBottom:2,alignItems:"center"},children:[o,(0,c.jsx)("div",{style:{fontWeight:s().Wy.medium,flexGrow:1,...s().RC},children:t}),g?y:p]}):void 0,u]})}},926203:(e,t,o)=>{o.d(t,{$g:()=>D,Eg:()=>R,Wf:()=>W,Xm:()=>N,aH:()=>E,pz:()=>K,qd:()=>F,v9:()=>H});o(898992),o(354520),o(672577),o(581454);var n=o(296540),i=()=>o(484714),r=()=>o(590526),l=()=>o(401497),a=()=>o(792057),s=()=>o(718827),c=()=>o(160432),d=()=>o(736847),u=()=>o(862e3),p=()=>o(726275),g=()=>o(212727),m=()=>o(236262),S=()=>o(69708),y=()=>o(100622),f=()=>o(183558),h=()=>o(534177),x=()=>o(284371),v=()=>o(436696),b=()=>o(966759),C=()=>o(384944),j=()=>o(30244),w=()=>o(69267),A=()=>o(312296),I=()=>o(574036),_=()=>o(115512),T=()=>o(547149),k=()=>o(339798),M=()=>o(497222),P=()=>o(147361),B=()=>o(554840),V=o(474848);const F="consume_gap",D=!0;function E(e){var t;const{currentConfig:o,onConfigChange:a,disabled:s,collectionContextStore:c}=e,u=(0,r().K8)((()=>c.databaseTypeFromStoreState),[c]),p=(0,i().v3)(),g=null===(t=o.configWithoutDates)||void 0===t?void 0:t.mode,[m,y]=(0,n.useState)((0,h().O9)(o.configWithoutDates)?Boolean(o.configWithoutDates.avoid_weekends):D),f=(0,h().O9)(o.configWithoutDates)?Boolean(o.configWithoutDates.avoid_weekends):m;(0,n.useEffect)((()=>{if((0,h().O9)(o.configWithoutDates)){const e=Boolean(o.configWithoutDates.avoid_weekends);e!==m&&y(e)}}),[o,m]);const x=(0,l().IS)((()=>({dateShiftContainer:{marginInlineStart:4},previewContainer:{marginInlineStart:4},previewTitle:{paddingInlineStart:10}})),[]),b=(0,n.useCallback)((e=>{(0,h().O9)(o.configWithoutDates)&&(a({...o,configWithoutDates:{...o.configWithoutDates,avoid_weekends:e}}),(0,v().X)({environment:p,collectionContextStore:c,action:"update_dependency_date_shift_avoid_weekends",new_avoid_weekends:e}))}),[c,o,p,a]),C=(0,n.useCallback)((e=>{(0,h().O9)(e)?a({...o,configWithoutDates:{...o.configWithoutDates,mode:e,avoid_weekends:m}}):a({...o,configWithoutDates:void 0}),(0,v().X)({environment:p,collectionContextStore:c,action:"update_dependency_date_shift_mode",new_date_shift_mode:e??"none"})}),[c,o,p,m,a]);return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(d().A,{title:(0,V.jsx)(S().sA,{...w().Ic.dateShiftingSectionCaption}),disableMobileBorders:!0,style:x.previewContainer,desktopTitleStyle:x.previewTitle,children:(0,V.jsx)(P().r,{mode:g})}),(0,V.jsx)(d().A,{disableMobileBorders:!0,style:x.dateShiftContainer,children:(0,V.jsx)(L,{currentMode:g,onModeChange:C,databaseType:u,disabled:s})}),(0,V.jsxs)(d().A,{children:[(0,V.jsx)(z,{currentValue:f,databaseType:u,onChange:b,disabled:s||!(0,h().O9)(o.configWithoutDates)}),(0,V.jsx)(O,{...e})]})]})}function O(e){const{collectionContextStore:t,currentConfig:o,onConfigChange:i,disabled:l}=e,a=(0,r().K8)((()=>{const e=t.normalizedSchemaStore.state;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,u().$)(o)}))}),[t]),s=a.length,c=o.datePropertyId?a.find((e=>e!==o.datePropertyId)):void 0,d="string"==typeof o.datePropertyId&&(0,h().O9)(o.endDatePropertyId),p=(0,n.useCallback)(((e,t)=>{const n={[e]:t};if(d&&(0,h().O9)(o.datePropertyId)){const i="datePropertyId"===e?"endDatePropertyId":"datePropertyId";o[i]===t&&(n[i]=a.find((e=>e!==t)))}i({...o,...n})}),[o,a,i,d]);return!(0,h().O9)(o.configWithoutDates)||s<=1?null:(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(B().e,{collectionContextStore:t,currentPropertyId:o.datePropertyId,title:d?(0,V.jsx)(S().sA,{...w().Ic.startDate}):(0,V.jsx)(S().sA,{...w().Ic.datePropertyPickerTitle}),onPropertyChanged:e=>p("datePropertyId",e),disabled:l}),(0,h().O9)(c)&&"string"==typeof o.datePropertyId?(0,V.jsxs)(V.Fragment,{children:[(0,h().O9)(o.endDatePropertyId)?(0,V.jsx)(B().e,{collectionContextStore:t,currentPropertyId:o.endDatePropertyId,title:(0,V.jsx)(S().sA,{...w().Ic.endDate}),onPropertyChanged:e=>p("endDatePropertyId",e),disabled:l}):void 0,(0,V.jsx)(I().A,{title:(0,V.jsx)(S().sA,{id:"database.viewSettings.relationFeatures.datePropertyPicker.separateStartEnd",defaultMessage:"Separate start and end dates"}),focused:!1,on:d,disabled:l,disabledFeedback:!0,onClick:()=>{i({...o,endDatePropertyId:d?void 0:c})}})]}):void 0]})}function R(e){const{collectionSettingsStore:t,feature:o,permissionScopes:n}=e,i=!n.canConfigureCollection&&!n.canConfigureBlock;return(0,V.jsx)(M().A,{icon:g().gearIcon,showChevron:!0,disabled:i,title:(0,V.jsx)(S().sA,{...w().Ic.advancedSettings}),onClick:()=>{k().a2({collectionSettingsStore:t,item:{type:"relationFeaturesAdvancedSettings",feature:o}})}})}function K(e){const{feature:t,handleAddRelation:o,databaseType:n,permissionScopes:i}=e,r=(0,l().IS)((()=>({button:{width:"100%"},buttonWrap:{marginTop:0,marginInlineEnd:12,marginBottom:4,marginInlineStart:12}})),[]);if(!i.canConfigureBlock||!i.canConfigureCollection)return null;const a=(0,w().vP)({feature:t,databaseType:n});return(0,V.jsx)(d().A,{disableMobileBorders:!0,children:(0,V.jsx)("div",{style:r.buttonWrap,children:(0,V.jsx)(c().A,{colorPalette:"blue",style:r.button,onClick:o,size:"lg",children:(0,V.jsx)(S().sA,{...a})})})})}function N(e){const{feature:t,permissionScopes:o,propertyName:n,relationPropertyId:r,inversePropertyName:s,collectionContextStore:c,collectionSettingsStore:d,handleDefaultPropertySelect:u,databaseType:p,clearCollectionViewSubitemConfig:g}=e,f=(0,i().v3)(),h=(0,l().IS)((()=>({modalPropertyName:{color:y().Tj.darkTextColor,fontWeight:x().Wy.semibold}})),[]);if(!(o.canConfigureCollection&&o.canConfigureBlock&&n&&s))return null;const v=(0,w().Pf)({feature:t,databaseType:p}),C=(0,w().Ew)({feature:t,databaseType:p}),A={label:(0,V.jsx)(S().sA,{...w().Ic.turnOff}),color:"red",onAccept:async e=>{r&&(null!=e&&e.delete&&await async function(e){const{environment:t,collectionContextStore:o,propertyId:n,feature:i}=e,r=o.normalizedSchemaStore.state,l=o.collectionStore();if(!l)return;await T().createAndCommitAsync({environment:t,userAction:"CollectionSettingsViewRelationFeatures.handleTurnOffFeatureAndDeleteAccept",waitForServerCommit:!1,perform:e=>(0,j().P)({environment:t,collectionStore:l,schema:r,property:n,transaction:e})});const a=r[n];a&&(0,b().i)({environment:t,collectionContextStore:o,property_type:a.type,from:i,property:n})}({environment:f,propertyId:r,collectionContextStore:c,feature:t}),u(void 0),null==g||g(),k().R8({collectionSettingsStore:d,item:{type:"main"}}))}};return(0,V.jsx)(M().A,{icon:m().trashIcon,title:(0,V.jsx)(S().sA,{...v}),isRedOnHover:!0,onClick:()=>{a().ui({selectionItems:[{key:"delete",text:(0,V.jsx)(S().sA,{...w().Ic.removePropertiesTitle}),description:(0,V.jsx)(S().sA,{...w().Ic.removePropertiesDescription,values:{span:e=>(0,V.jsx)("span",{style:h.modalPropertyName,children:e}),property:n,inverseProperty:s}}),preSelected:!0},{key:"keep",text:(0,V.jsx)(S().sA,{...w().Ic.keepPropertiesTitle})}],selectType:"radio",message:(0,V.jsx)(S().sA,{...C}),showCancel:!0,keepFocus:!0,items:[A]})}})}function z(e){const{currentValue:t,onChange:o,disabled:n,databaseType:i}=e;return(0,V.jsx)(I().A,{title:(0,V.jsx)(S().sA,{...w().Ic.avoidWeekendsSwitcherTitle}),caption:(0,V.jsx)(S().sA,{...(0,w().nV)(i)}),shouldWrapCaption:!0,shouldWrapTitle:!0,focused:!1,on:t,disabled:n,disabledFeedback:!0,onClick:()=>o(!t)})}function L(e){const{currentMode:t,onModeChange:o,disabled:n,databaseType:i}=e,r=(0,l().IS)((()=>({wrap:{display:"flex",flexDirection:"column",rowGap:8,marginInlineStart:12,marginInlineEnd:12}})),[]);return(0,V.jsx)("div",{style:r.wrap,children:[...p().OY,void 0].map((e=>(0,V.jsx)(U,{dateShiftingMode:e,databaseType:i,onClick:()=>o(e),active:e===t,disabled:n},e??"none")))})}function U(e){const{dateShiftingMode:t,onClick:o,active:n,disabled:i,databaseType:r}=e,a=(0,l().IS)((()=>({buttonStyles:{fontSize:_().Kw,fontWeight:x().Wy.medium,borderRadius:6,width:"100%",padding:"8px 10px",boxShadow:`0 0 0 1px ${y().Tj.border.secondaryTranslucent}`,color:y().Tj.darkTextColor,fill:y().Tj.text.secondary,...n&&{boxShadow:`0 0 0 2px ${y().Tj.blue.border.accentPrimary}`,color:y().Tj.blue.text.accentPrimary,fill:y().Tj.blue.icon.accentPrimary},...i&&{opacity:.65}}})),[n,i]),c=(0,w().Zt)({dateShiftingMode:t,databaseType:r});return(0,V.jsx)(s().Ay,{style:a.buttonStyles,onClick:o,disabled:i,children:(0,V.jsx)(S().sA,{...c})})}function W(e){const{environment:t,newConfig:o,collectionStore:n,transaction:i,intl:r}=e;let l;if((0,h().O9)(o.configWithoutDates))if(o.datePropertyId)l={...o.configWithoutDates,date_property:o.datePropertyId,end_date_property:o.endDatePropertyId};else{const e=(0,f().Ay)(),a={name:r.formatMessage(w().Ic.newDateProperty),type:"date"};(0,A().F)({environment:t,collectionStore:n,update:{[e]:a},transaction:i}),l={...o.configWithoutDates,date_property:e,end_date_property:void 0}}C().zv({store:n.getFormatStore(),data:{dependency_date_shifting_config:l??null},transaction:i})}function H(e){const{viewType:t,feature:o}=e;return"timeline_arrows_by"===o?"timeline"===t:"subitem"===o||void(0,h().HB)(o)}},943666:(e,t,o)=>{o.d(t,{N:()=>r});var n=()=>o(590526),i=()=>o(700500);function r(e){return(0,n().K8)((()=>{const t=e.collectionViewBlockStore();return t?t.isType(i().xd.collectionView)?"inline":"full_page":"unknown"}),[e])}},943919:(e,t,o)=>{o.d(t,{o:()=>i});var n=()=>o(896628);function i(e){const{icon:t,collectionViewStore:o,transaction:i}=e;n().zA({stores:[o],update:{collection_view_icon:t},transaction:i})}},959733:(e,t,o)=>{o.d(t,{g:()=>I});var n=o(296540),i=()=>o(590526),r=()=>o(31503),l=()=>o(898244),a=()=>o(465741),s=()=>o(680288),c=()=>o(937199),d=()=>o(26697),u=()=>o(69708),p=()=>o(908201),g=()=>o(103448),m=()=>o(478573),S=()=>o(484714),y=()=>o(543906),f=()=>o(127833),h=()=>o(495262),x=()=>o(155269),v=()=>o(409198),b=()=>o(527438),C=()=>o(547149),j=o(474848);function w(e){var t;const{open:o,originRef:r,settingsViewToOpen:l,propertyType:a,isPropertyEditComplete:d,onPropertyEditComplete:u,onDismiss:p,rollbackIfEditIncomplete:g,collectionContextStore:m,collectionSettingsStore:w}=e,A=null===(t=r.current)||void 0===t?void 0:t.getBoundingClientRect(),I=(0,S().v3)(),{collectionStore:_}=(0,c().bi)(),[T,k]=(0,n.useState)(null),[M,P]=(0,n.useState)(!1),[B,V]=(0,n.useState)(null);(0,y().A)((()=>{const e=`CollectionPropertySettingsPopup.createNewProperty.${a}.${Date.now()}`,{performResult:t}=C().createAndCommit({userAction:"CollectionPropertySettingsPopup.createNewProperty",environment:I,canUndo:!0,undoCheckpoint:e,perform:e=>(0,x().createProperty)({environment:I,collectionStore:_,collectionViewArgs:void 0,propertyName:s().dC[a],propertyType:a,transaction:e})});w.update((e=>({...e,stack:[{...l,property:t}],open:!0}))),k(t),V(e)}),o);const F=(0,i().K8)((()=>{if(!T)return!1;const e=_.getSchema()[T];return!!e&&d(e)}),[_,d,T]);(0,n.useEffect)((()=>{F&&T&&!M&&(u(T),P(!0))}),[F,u,T,M]);const{setModuleSelection:D}=(0,c().LH)();return T?(0,j.jsx)(f().zD,{open:o,popupType:f().nl.Popup,render:()=>(0,j.jsx)(v().CollectionSettings,{context:b().Bd.TopbarFilterPopup,collectionContextStore:m,collectionSettingsStore:w,hideDesktopHeader:!0}),originRect:A,alignmentToOrigin:"center",placementToOrigin:"bottom",originGap:4,onDismiss:()=>{!F&&g&&(B&&h().JM({environment:I,namedRevisionId:B}),D(void 0)),p()}}):null}function A(e){const{icon:t,name:o,disabled:i,tooltip:r,propertySettingsPopup:a,propertyType:s,...c}=e,{image:S,caption:y}=r||{},f=(0,p().ET)(),h=n.useRef(null),x=n.useCallback((e=>(0,j.jsx)("div",{style:{width:"100%"},...e,children:(0,j.jsx)(m().A,{icon:t,name:o,disabled:i,...c,ref:h})})),[i,t,o,c]);let v;return!S&&y?v=(0,j.jsx)(d().m,{textWrap:!0,placement:"left",render:x,renderTooltip:()=>(0,j.jsx)(u().sA,{...y})}):S&&y&&(v=(0,j.jsx)(d().m,{placement:"left",render:x,renderTooltip:()=>(0,j.jsx)(g().A,{caption:(0,j.jsx)(u().sA,{...y}),imageURL:S,imageWidth:140,imageHeight:100,imageContainerStyle:{backgroundColor:"white"}})})),(0,j.jsxs)(j.Fragment,{children:[v||(0,j.jsx)(x,{}),a&&a.open?(0,j.jsx)(w,{originRef:h,propertyType:(0,l().v2)(s),collectionContextStore:f,collectionSettingsStore:f.settingsStore,...a}):void 0]})}function I({actionHandler:e,renderIcon:t,tooltip:o,disabled:d,propertySettingsPopupProps:u}){const[p,g]=n.useState(null),{layoutStore:m}=(0,c().LH)(),S=(0,i().K8)((()=>m.getLayoutType()),[m]);return(0,n.useCallback)((n=>({key:n,keywords:[s().dC[n]],render:({ref:e,...i})=>{const c=null==u?void 0:u(n);let m=s().dC[n];const y=(0,l().v2)(n);return"form"===S&&(0,r().XO)(y)&&"select"!==y&&(m=a().mY[y]),(0,j.jsx)(A,{icon:t(n),name:m,disabled:null==d?void 0:d(n),propertyType:n,propertySettingsPopup:c?{...c,open:p===n,onDismiss:()=>{g(null)}}:void 0,tooltip:null==o?void 0:o(n),ref:e,...i})},action:()=>{null!=u&&u(n)?g(n):e(n)}})),[e,d,S,p,u,t,o])}},974591:(e,t,o)=>{o.r(t),o.d(t,{toggleTwoWaySyncOnCollection:()=>B,updateSyncedData:()=>V});o(16280),o(898992),o(672577),o(803949);var n=()=>o(907258),i=()=>o(675133),r=()=>o(795732),l=(o(296540),()=>o(203913)),a=()=>o(128933),s=o(474848);function c(e){const{item:t,helpUrl:o}=e;a().D6({...t,right:(0,s.jsx)(l().J$,{helpUrl:o})})}var d=()=>o(295633),u=()=>o(26105),p=()=>o(165358),g=()=>o(282883),m=()=>o(179034),S=()=>o(343666),y=()=>o(201980),f=()=>o(229833),h=()=>o(312296),x=()=>o(789557),v=()=>o(135552),b=()=>o(747100),C=()=>o(232930),j=()=>o(252833),w=()=>o(150193),A=()=>o(612587),I=()=>o(547149),_=()=>o(559926),T=()=>o(769864),k=()=>o(934839),M=()=>o(896628),P=()=>o(680977);function B(e){var t;const{environment:o,taskCollectionStore:i,projectCollectionStore:l,openedFrom:a}=e,s=!(null===(t=i.getFormat().sync_state)||void 0===t?void 0:t.enable_two_way_sync);s?(!function(e){const{environment:t,taskCollectionStore:o}=e,n=o.getSchema(),i={};for(const r of g().En){const e=n[r];e&&"read_write"!==e.synced_permissions&&("notion://tasks/assign_property"===r&&"person"===e.type?i[r]={...e,synced_permissions:"read_write",limit:1}:i[r]={...e,synced_permissions:"read_write"})}Object.keys(i).length>0&&(I().createAndCommit({userAction:"updateSyncedCollectionActions.addSyncedPermissionsToSchema",environment:t,canUndo:!0,perform:e=>{(0,h().F)({environment:t,collectionStore:o,update:i,transaction:e})}}),p().log({level:"info",from:"updateSyncedCollectionActions",type:"addSyncedPermissionsToSchemaCompletedSuccessfully",data:{miscDataToConvertToString:{taskCollectionId:o.id,taskUpdate:i}}}))}({environment:o,taskCollectionStore:i}),a&&_().RR(o,{from:a,tier:void 0,step:"enable_jira_two_way_sync_toggle",project_collection_id:l.id,task_collection_id:i.id})):a&&_().RR(o,{from:a,tier:void 0,step:"disable_jira_two_way_sync_toggle",project_collection_id:l.id,task_collection_id:i.id});const c=i.getFormat().sync_state||{syncing:!1};I().createAndCommit({userAction:"updateSyncedCollectionActions.toggleTwoWaySyncOnCollection",environment:o,canUndo:!0,perform:e=>{M().zA({stores:[i,l],update:{sync_state:{...c,enable_two_way_sync:s}},transaction:e})}});const u=n().default.state.currentUserSettingsStore;u&&I().createAndCommit({userAction:"JiraTwoWaySyncInfoBanner.EnableClick",environment:o,canUndo:!1,perform:e=>{(0,P().m)({transaction:e,userSettingsStore:u,data:{seen_jira_two_way_sync_info_banner:!0}})}});const S=(0,b().cq)(i)?A().A:w().A;if(k().zA({bannerStore:S,id:"JiraTwoWaySyncInfoBanner"}),s){[i,l].forEach((e=>{var t,n;const i=null===(t=e.getParentPointer())||void 0===t?void 0:t.id;if((0,j().fo)({collectionStore:e})&&(0,j().z9)({collectionStore:e})&&i&&(null==u||null===(n=u.getSettings())||void 0===n||!n.seen_auth_missing_for_jira_synced_collection_view_banner)){const e={id:i,table:m().ev};k().HQ({bannerStore:S,id:"AuthMissingForJiraSyncedCollectionPageBanner",contentKey:"auth_missing_for_jira_user",styleKey:v().q.LightBlue,blockStore:new(d().B)(o,e),context:r().R.CollectionViewBlockFullScreen})}}))}else k().zA({bannerStore:S,id:"AuthMissingForJiraSyncedCollectionPageBanner"});p().log({level:"info",from:"updateSyncedCollectionActions",type:"toggleTwoWaySyncOnCollectionCompletedSuccessfully",data:{miscDataToConvertToString:{taskCollectionId:i.id,projectCollectionId:l.id,enable_two_way_sync:s}}})}async function V(e){const{transaction:t,environment:o}=e,n=t.operations.find((e=>(0,j().C0)(e)&&2===e.path.length&&"properties"===e.path[0]&&g().En.includes(e.path[1].toString())));if(n){const e=(0,j().sP)({transaction:t,updateOperation:n,environment:o});if(!e)return;return p().log({level:"info",from:"updateSyncedCollectionActions",type:"propertyUpdateTriggered",data:{message:"Property update triggered",spaceId:t.spaceId,miscDataToConvertToString:{updatePagePropertyOperation:n,transactionId:t.id}}}),await async function(e){const{transaction:t,environment:o,updateOperation:n,syncedCollectionStore:i}=e,r=()=>{try{return(0,j().jg)({updateOperation:n,transaction:t,collectionStore:i})}catch(e){throw F({}),p().log({level:"error",from:"updateSyncedCollectionActions",type:"handlePagePropertyUpdates",error:(0,f().convertErrorToLog)(e),data:{message:"Error extracting page property update payload",miscDataToConvertToString:{updateOperation:n,transactionId:t.id}}}),e}},l=r();if("UPDATE_PROPERTY"===l.syncCollectionUpdates[0].updateType){const e=l.syncCollectionUpdates[0].propertyId,t=j().vT({pageId:l.syncCollectionUpdates[0].collectionPagePointer.id,propertyId:e});j().Jv({uniquePropertyId:t});const n=await T().callApi({eventName:"updateSyncedCollectionData",environment:o,data:l});j().NW(t);const r=i.getSchema()[e];var a,s,c;if("success"!==n.type)throw F({syncCollectionType:i.getFormat().external_collection_type}),_().j2(o,{property_id:e,property_type:null==r?void 0:r.type,action:"sync_update_failure",integration:l.syncType,sync_status:"failure",error_code:(null===(a=n.error)||void 0===a||null===(a=a.name)||void 0===a?void 0:a.toString())??"Unknown error",collection_id:i.id}),new Error((null===(s=n.error)||void 0===s||null===(s=s.name)||void 0===s?void 0:s.toString())??"Unknown error");if(!n.data.success)throw F({errorCode:n.data.errorCode,syncCollectionType:i.getFormat().external_collection_type,propertyName:1===l.syncCollectionUpdates.length?null===(c=i.getSchema()[l.syncCollectionUpdates[0].propertyId])||void 0===c?void 0:c.name:void 0}),_().j2(o,{property_id:e,property_type:null==r?void 0:r.type,action:"sync_update_failure",integration:l.syncType,sync_status:"failure",error_code:n.data.errorCode,collection_id:i.id}),new Error(n.data.message);_().j2(o,{property_id:e,property_type:null==r?void 0:r.type,action:"sync_update_success",integration:l.syncType,collection_id:i.id})}}({transaction:t,environment:o,updateOperation:n,syncedCollectionStore:e}),void p().log({level:"info",from:"updateSyncedCollectionActions",type:"propertyUpdateCompleted",data:{message:"Property update completed",spaceId:t.spaceId,miscDataToConvertToString:{updatePagePropertyOperation:n,transactionId:t.id}}})}const i=t.operations.find((e=>"set"===e.command&&1===e.path.length&&"text"===e.path[0]));if(i&&i.pointer.table===S().SN){const e=(0,j().cb)({transaction:t,commentPointer:i.pointer,environment:o});if(!e)return;p().log({level:"info",from:"updateSyncedCollectionActions",type:"commentsUpdateTriggered",data:{message:"Comments update triggered",spaceId:t.spaceId,miscDataToConvertToString:{updatePageCommentOperation:i,transactionId:t.id}}});const{collectionStore:n,collectionPagePointer:r}=e;return await async function(e){const{transaction:t,environment:o,updateOperation:n,syncedCollectionStore:i,collectionPagePointer:r}=e,l=()=>{try{return(0,j().mE)({updateOperation:n,transaction:t,collectionStore:i,collectionPagePointer:r})}catch(e){throw F({}),e}},a=l();j().L$({commentId:n.pointer.id});const s=await T().callApi({eventName:"updateSyncedCollectionData",environment:o,data:a});var c;if(j().Rw(n.pointer.id),"success"!==(null==s?void 0:s.type))throw F({syncCollectionType:i.getFormat().external_collection_type}),new Error((null===(c=s.error)||void 0===c||null===(c=c.name)||void 0===c?void 0:c.toString())??"Unknown error");if(!s.data.success)throw F({errorCode:s.data.errorCode,syncCollectionType:i.getFormat().external_collection_type}),new Error(s.data.message)}({transaction:t,environment:o,updateOperation:i,syncedCollectionStore:n,collectionPagePointer:r}),void p().log({level:"info",from:"updateSyncedCollectionActions",type:"commentsUpdateCompleted",data:{message:"Comments update completed",spaceId:t.spaceId,miscDataToConvertToString:{updatePageCommentOperation:i,transactionId:t.id}}})}const r=t.operations.find((e=>{var t;return"update"===e.command&&1===e.path.length&&"properties"===e.path[0]&&(null===(t=e.args)||void 0===t?void 0:t.source)}));if(r){const e=(0,j().m0)({transaction:t,updateOperation:r,environment:o});if(!e)return;p().log({level:"info",from:"updateSyncedCollectionActions",type:"commentAttachmentUpdateTriggered",data:{message:"Comment attachment update triggered",spaceId:t.spaceId,miscDataToConvertToString:{updatePageCommentAttachmentOperation:r,pageCommentAttachmentUploadMetaInfo:e,transactionId:t.id}}});try{await async function(e){var t;const{transaction:o,environment:n,updateOperation:i,syncedCollectionStore:r,collectionPagePointer:l,commentPointer:a}=e,s=y().q4_(null===(t=i.args)||void 0===t?void 0:t.source);if(!s)return;const c=s.split(":").pop();if(!c)return;const d=Date.now(),u=c.includes(".")?c.substring(c.lastIndexOf(".")):"",g=`${c.includes(".")?c.substring(0,c.lastIndexOf(".")):c}_${d}${u}`;p().log({level:"info",from:"updateSyncedCollectionActions",type:"attachmentFilenameTransformed",data:{message:"Transformed attachment filename to avoid collisions",spaceId:o.spaceId,miscDataToConvertToString:{originalFileName:c,transformedFileName:g,timestamp:d,transactionId:o.id}}});const m=r.getFormat().external_collection_type;if(!m)throw F({}),new Error("Collection is not an external synced collection");const S={spaceId:o.spaceId,syncType:m,syncCollectionUpdates:[{collectionPagePointer:l,notionCommentId:a.id,attachment:{fileName:g,s3Data:{path:s}},updateType:"APPEND_ATTACHMENT"}]},f=await T().callApi({eventName:"updateSyncedCollectionData",environment:n,data:S});var h;if("success"!==(null==f?void 0:f.type))throw F({syncCollectionType:r.getFormat().external_collection_type}),new Error((null===(h=f.error)||void 0===h||null===(h=h.name)||void 0===h?void 0:h.toString())??"Unknown error");if(!f.data.success)throw F({errorCode:f.data.errorCode,syncCollectionType:r.getFormat().external_collection_type}),new Error(f.data.message)}({transaction:t,environment:o,updateOperation:r,syncedCollectionStore:e.collectionStore,collectionPagePointer:e.collectionPagePointer,commentPointer:e.commentPointer}),p().log({level:"info",from:"updateSyncedCollectionActions",type:"commentAttachmentUpdateCompleted",data:{message:"Comment attachment update completed",spaceId:t.spaceId,miscDataToConvertToString:{updatePageCommentAttachmentOperation:r,pageCommentAttachmentUploadMetaInfo:e,transactionId:t.id}}})}catch(l){const n=new(u().j)(o,e.commentPointer),i=new(d().B)(o,{id:r.pointer.id,table:m().ev,spaceId:t.spaceId});throw n&&i&&I().createAndCommit({userAction:"Comment.handleRemoveFileFromActionsDueToSyncFailure",environment:o,canUndo:!0,perform:e=>{x().L6({commentStore:n,fileBlocks:[i],transaction:e})}}),p().log({level:"error",from:"updateSyncedCollectionActions",type:"commentAttachmentUpdateFailed",data:{message:"Comment attachment update failed",spaceId:t.spaceId,miscDataToConvertToString:{updatePageCommentAttachmentOperation:r,pageCommentAttachmentUploadMetaInfo:e,transactionId:t.id}}}),l}}}function F(e){const{errorCode:t,syncCollectionType:o,propertyName:n}=e,r=i().A.getIntl();if(!o)return void c({item:{label:r.formatMessage({id:"syncedCollectionUpdateError.syncCollectionTypeMissing",defaultMessage:"Failed to update: incorrect sync collection setup"})},helpUrl:(0,C().x)("guides.externalImportAndSync")});if(!t)return void c({item:{label:`Failed to update ${n??o}, please try again in some time`},helpUrl:(0,C().x)("guides.externalImportAndSync")});c({item:{label:j().LA({syncCollectionType:o,errorCode:t,intl:r})},helpUrl:(0,C().x)("guides.externalImportAndSync")})}},983201:(e,t,o)=>{o.d(t,{z:()=>m});var n=o(296540),i=()=>o(401497),r=()=>o(807449),l=()=>o(493552),a=()=>o(26697),s=()=>o(29037),c=()=>o(69708),d=()=>o(100622),u=()=>o(284371),p=()=>o(815585),g=o(474848);function m({integrationIconUrl:e,integrationIcon:t,primaryText:o,secondaryText:m,compact:S=!1,tooltipContent:y}){const f=(0,i().IS)((()=>({tooltipActorName:{fontWeight:u().Wy.medium,color:d().Tj.text.inversePrimary},tooltipText:{color:d().Tj.text.inverseSecondary,fontSize:12},container:{borderRadius:8,border:"1px solid rgba(84, 72, 49, 0.15)",paddingTop:S?8:14,paddingBottom:S?8:14,paddingInline:S?8:14,gap:8,display:"flex",flexGrow:1,minWidth:0,overflow:"hidden"},icon:{width:18,height:18},textWrapper:{overflow:"hidden",minWidth:0,flex:1}})),[S]),h=(0,n.useMemo)((()=>{if(!y)return;const e=y.connectedAt?(0,p().nl)(y.connectedAt,{useCompactFormat:!0,useLowercase:!0}):void 0;return(0,g.jsx)(c().sA,{defaultMessage:"Connected by {connectedBy} {connectedAt}",id:"database.viewSettings.collectionSettingsExternalSource.salesforceConnectedBy",values:{connectedBy:(0,g.jsx)("span",{style:f.tooltipActorName,children:y.connectedBy}),connectedAt:e}})}),[y,f]),x=(0,g.jsx)(a().m,{renderTooltip:e=>(0,g.jsx)("span",{style:f.tooltipText,...e,children:h}),disableTooltip:!y,placement:"top",render:e=>(0,g.jsx)("div",{...e,style:{alignSelf:"center",cursor:"pointer"},children:(0,g.jsx)(r().I,{icon:s().checkmarkIcon,size:"default",colorVariant:"secondary"})})});return(0,g.jsxs)("div",{style:f.container,children:[e?(0,g.jsx)("img",{style:f.icon,src:e,alt:""}):t||void 0,(0,g.jsxs)("div",{style:f.textWrapper,children:[(0,g.jsx)(l().D,{textOverflow:"ellipsis",styleKey:"bodyRegular",colorVariant:"primary",children:o}),(0,g.jsx)(l().D,{textOverflow:"ellipsis",styleKey:"captionRegular",colorVariant:"secondary",children:m})]}),S?void 0:x]})}},988536:(e,t,o)=>{o.d(t,{C:()=>w,j:()=>A});o(898992),o(354520),o(672577);var n=o(296540),i=()=>o(484714),r=()=>o(590526),l=()=>o(401497),a=()=>o(365917),s=()=>o(457205),c=()=>o(849255),d=()=>o(493552),u=()=>o(373009),p=()=>o(484392),g=()=>o(617871),m=()=>o(824862),S=()=>o(798880),y=()=>o(69708),f=()=>o(100622),h=()=>o(284371),x=()=>o(674582),v=()=>o(859004),b=()=>o(254526),C=()=>o(983201),j=o(474848);function w({integrationIconUrl:e,integrationIcon:t,spaceStore:o,flowId:a,renderActions:s,captionText:c,forceReauthForBot:m=!1,from:S}){const b=(0,i().v3)(),w=(0,l().IS)((()=>({connectedByAdminName:{fontWeight:h().Wy.medium,color:f().Tj.text.inversePrimary},borderedContainer:{borderRadius:6,borderStyle:"solid",borderWidth:1,borderColor:f().Tj.border.secondary,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"16px 12px"},header:{fontWeight:h().Wy.medium,color:f().Tj.text.primary,fontSize:h().J.UIRegular.desktop,marginTop:0},iconGroup:{marginBottom:4},captionText:{fontSize:h().J.UISmall.desktop,color:f().Tj.text.secondary,fontWeight:h().Wy.regular,textAlign:"center",marginInlineEnd:"auto",marginBottom:4,marginInlineStart:"auto",maxWidth:"80%",lineHeight:"20px"},siteButton:{padding:"4px",borderRadius:6,display:"flex",justifyContent:"space-between",overflow:"hidden",width:"100%"},siteButtonTextContainer:{gap:8,display:"flex",minWidth:0,overflow:"hidden"},siteNameText:{fontSize:h().J.UIRegular.desktop,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},siteNameSecondaryText:{fontSize:h().J.UISmall.desktop,color:f().Tj.text.secondary,fontWeight:h().Wy.regular,textAlign:"start",whiteSpace:"nowrap"}})),[]),{status:I,instanceUrl:_,connectedByStore:T,spaceBotStore:k}=A({spaceStore:o}),M=(0,y().tz)(),{adminName:P,connectedAtTs:B}=(0,r().K8)((()=>{if(!T||!k)return{adminName:void 0,connectedAtTs:void 0};if(!k.getLastEditedAt())return{adminName:void 0,connectedAtTs:void 0};const e="number"==typeof k.getLastEditedAt()?k.getLastEditedAt():parseInt(String(k.getLastEditedAt()),10);return{adminName:T.getDisplayName(M),connectedAtTs:e}}),[T,M,k]),V=(0,n.useCallback)((()=>{let e="admin";e="no_user_access"===I?"user":"admin","connected"===I&&!1!==m&&(e=m.integration_id===g().mn?"admin":"user"),v().rT({environment:b,from:S,flowId:a,authType:e,isReAuth:Boolean("connected"===I&&m)})}),[b,S,a,I,m]),F=(0,n.useMemo)((()=>"not_connected"===I||"no_user_access"===I||"connected"===I&&m?(0,j.jsx)(x().m,{integrationIconUrl:e,integrationIcon:t,styles:{wrapper:w.borderedContainer,header:w.header,iconGroup:w.iconGroup,arrowRight:{height:24,width:24},icon:{height:36,width:36}},title:(0,j.jsx)(y().sA,{defaultMessage:"Authenticate Salesforce",id:"database.viewSettings.collectionSettingsExternalSource.connectToSalesforce.headline"}),description:(0,j.jsx)("div",{style:w.captionText,children:c}),children:(0,j.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,j.jsx)(u().E,{colorPalette:"blue",style:{marginInlineEnd:"auto",marginBottom:0,marginInlineStart:"auto"},onClick:V,children:(0,j.jsx)(d().D,{styleKey:"bodyRegular",children:m?(0,j.jsx)(y().sA,{defaultMessage:"Re-authenticate Salesforce",id:"database.viewSettings.collectionSettingsExternalSource.reAuthToSalesforce"}):(0,j.jsx)(y().sA,{defaultMessage:"Connect to Salesforce",id:"database.viewSettings.collectionSettingsExternalSource.connectToSalesforce"})})})})}):"connected"===I?(0,j.jsx)(C().z,{integrationIconUrl:e,integrationIcon:t,primaryText:(0,p().A)((null==_?void 0:_.split(".")[0])||""),secondaryText:_||"",compact:!0,tooltipContent:{connectedAt:B,connectedBy:P}}):null),[P,B,I,e,t,_,w,c,V,m]);return(0,j.jsxs)(j.Fragment,{children:[F,null==s?void 0:s(I)]})}function A(e){const{spaceStore:t}=e;return(0,r().K8)((()=>{var e;if(!t)return{status:"not_connected",spaceBotStore:void 0,externalAuthentication:void 0,instanceUrl:void 0,connectedByStore:void 0};const o=a().A.state;if(!o.loaded)return{status:"not_connected",spaceBotStore:void 0,externalAuthentication:void 0,instanceUrl:void 0,connectedByStore:void 0};const n=o.bots.filter((({integration_id:e})=>e===g().mn));if(0===n.length)return{status:"not_connected",spaceBotStore:void 0,externalAuthentication:void 0,instanceUrl:void 0,connectedByStore:void 0};const i=s().v.createChildStore(t,{table:m().GP,id:n[0].id,spaceId:t.id}),r=i.getLastEditedById(),{status:l,externalAuthentication:d}=(0,b().i_)(i),u=null===(e=o.externalEntities.find((e=>e.getBotId()===i.id)))||void 0===e||null===(e=e.getMetainfo())||void 0===e?void 0:e.instanceUrl,p=null==u?void 0:u.replace("https://",""),y=r?c().L.createChildStore(t,{table:S().oo,id:r}):void 0;return{status:l,spaceBotStore:i,externalAuthentication:d,instanceUrl:p,connectedByStore:y}}),[t])}},990402:(e,t,o)=>{o.d(t,{G:()=>r,m:()=>i});var n=()=>o(46986);function i(e){return e.canEdit()&&(0,n().re)()}function r(e){return e.canEdit()&&!e.isSystemBlock()&&(0,n().re)()}},992032:(e,t,o)=>{o.d(t,{VJ:()=>V,oI:()=>N,Ac:()=>K});o(581454);var n=o(296540),i=()=>o(564884),r=()=>o(907258),l=()=>o(484714),a=()=>o(590526),s=()=>o(401497),c=()=>o(929219),d=()=>o(718827),u=()=>o(807449),p=()=>o(631524),g=()=>o(493552),m=()=>o(536095),S=()=>o(529099),y=()=>o(569397),f=()=>o(177148),h=()=>o(421559),x=()=>o(826693),v=()=>o(69708),b=()=>o(100622),C=()=>o(496603),j=()=>o(310526),w=()=>o(913454),A=()=>o(575154),I=()=>o(349379),_=()=>o(466934),T=()=>o(458097),k=()=>o(606712),M=o(474848);function P({template:e,onSelect:t,index:i}){const r=(0,n.useCallback)((()=>t(e)),[t,e]),l=(0,o(3486).P)(e.value.targetCollection.icon),a=(0,s().eP)(),c=(0,s().IS)((()=>({button:{borderRadius:V,border:`1px solid ${b().Tj[l].border.primary}`,overflow:"hidden",transition:"background 0.2s ease",background:b().Tj[l].background.primaryTranslucent},buttonInner:{borderRadius:V},buttonHovered:{background:(0,k().R)({color:b().Tj[l].background.primaryTranslucent,mode:a,adjustmentFactor:2})},buttonPressed:{background:(0,k().y)({color:b().Tj[l].background.primaryTranslucent,mode:a,adjustmentFactor:4})},textContainer:{padding:"20px 20px 10px",color:b().Tj[l].text.primary},description:{marginTop:2,color:b().Tj[l].text.primary,opacity:.6,textWrap:"balance"},outerImageContainer:{overflow:"visible",position:"relative",height:108,width:"calc(100% - 22px)",marginInlineStart:22,marginTop:-4},imageContainer:{position:"absolute",top:0,transition:"top 0.2s ease",width:"100%",height:"100%",marginTop:4,lineHeight:0,borderRadius:"6px 0",overflow:"hidden",background:b().Tj[l].background.elevated,boxShadow:"dark"===a?`0 0 0 1px ${b().Tj[l].border.primary}`:`0px 0px 0px 1px ${b().Tj[l].border.primary}, 0px 2px 4px -1px rgba(0, 0, 0, 0.06), 0px 12px 32px -6px rgba(0, 0, 0, 0.12)`}})),[l,a]);return(0,M.jsx)(d().Ay,{style:c.button,hoveredStyle:c.buttonHovered,pressedStyle:c.buttonPressed,ariaLabel:e.value.targetCollection.name,onClick:r,children:(0,M.jsx)("div",{style:c.buttonInner,children:(0,M.jsxs)(o(699143).Y1,{gap:"auto",height:"fill",children:[(0,M.jsxs)("div",{style:c.textContainer,children:[(0,M.jsx)(g().D,{styleKey:"bodyMedium",children:e.value.targetCollection.name}),(0,M.jsx)(g().D,{styleKey:"captionRegular",style:c.description,children:e.description})]}),(0,M.jsx)("div",{style:c.outerImageContainer,children:(0,M.jsx)("div",{style:c.imageContainer,children:(0,M.jsx)(o(92924).i,{template:e,templateColor:l,index:i})})})]})})})}const B=n.memo(P),V=12,F={};function D({iconFn:e,iconColorName:t,label:o,onClick:n}){const i=(0,s().eP)(),r=(0,s().IS)((()=>({button:{padding:"16px 18px",borderRadius:V,borderWidth:1,borderStyle:"solid",borderColor:"dark"===i?b().Tj.border.secondary:b().Tj.border.primary},hovered:{background:b().Tj.buttonHoveredBackground,borderColor:b().Tj.palette.translucentGray[100]},icon:{height:19,width:"auto",color:t?b().Tj.icon[t]:void 0,marginBottom:8}})),[t,i]);return(0,M.jsxs)(d().Ay,{style:r.button,hoveredStyle:r.hovered,onClick:n,children:[(0,M.jsx)("div",{children:e(r.icon)}),(0,M.jsx)(g().D,{styleKey:"bodyMedium",children:o})]})}function E({iconFn:e,iconColorName:t,label:o,onClick:n}){const i=(0,s().IS)((()=>({button:{padding:"5px 12px",display:"flex",gap:8,justifyContent:"center",alignItems:"center",borderRadius:20,color:b().Tj.text.secondary},icon:{height:19,width:"auto",color:t?b().Tj.icon[t]:void 0,marginBottom:0}})),[t]);return(0,M.jsxs)(d().Ay,{style:i.button,onClick:n,children:[(0,M.jsx)("div",{children:e(i.icon)}),(0,M.jsx)(g().D,{styleKey:"bodyRegular",children:o})]})}const O=16,R=4,K=(0,M.jsx)(v().sA,{id:"workflowTemplatesOnboardingModal.button.marketplace",defaultMessage:"More in Marketplace"});function N({parentStore:e,onAddEmptyPage:t,onAddEmptyDatabase:o,onSelectTemplate:r,onMarketplaceClick:d,showEmptyPageButton:u,onPromptSubmit:y}){const x=(0,l().v3)(),{isPhone:b}=(0,l().Y0)(),j=(0,a().K8)((()=>T().default.getShouldShowExpandedTemplateList()),[]),k=(0,A().q)({parentStore:e,returnAllTemplates:j}),P=(0,a().K8)((()=>T().default.state.open&&"new_user_onboarding"===T().default.state.origin),[]),V=(0,a().K8)((()=>T().default.state.open&&("land_on_app_from_new_user_onboarding"===T().default.state.origin||P)),[P]),K=(0,n.useMemo)((()=>P?k.slice(0,R):j?k:function({arr:e,min:t}){if(e.length<=t)return[...e];return e.slice(0,2*Math.floor(e.length/2))}({arr:k,min:1})),[k,j,P]),N=(0,a().K8)((()=>(0,w().getIsSetupGeneratorEnabled)(void 0,void 0)&&!V&&c().A.state.online),[V]),L=P,U=!j,W=(0,n.useCallback)((()=>{T().default.setShouldShowExpandedTemplateList(!0),T().default.state.open&&(0,i().u)({environment:x,event:{eventName:"template_picker_show_more_templates_clicked",eventProperties:(0,_().gM)(T().default.state)}})}),[x]),H=(0,s().IS)((()=>({container:{width:"100%",maxWidth:560+O,alignSelf:"center",alignItems:"center"},basicButtonGrid:{display:"grid",gridTemplateColumns:`repeat(auto-fit, minmax(calc((100% - ${2*O}px) / 3), 1fr))`,maxWidth:"100%",gap:O,marginTop:O,marginBottom:b?26:2*O},newUserOnboardingButtons:{display:"flex",gap:4,margin:`${O}px auto 40px auto`,justifyContent:"center"},templateButtonGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:O,marginTop:b?13:P?36:18},showMoreButton:{marginTop:O,height:32,paddingInlineStart:12,paddingInlineEnd:12}})),[P,b]);(0,n.useEffect)((()=>{const{state:e}=T().default;e.open&&void 0!==e.flowId&&!F[e.flowId]&&((0,I().DF)({environment:x,eventProperties:{collection_template_ids_shown:K.map((e=>e.templateId)),...(0,_().gM)(e)}}),F[e.flowId]=!0)}),[K,x]);const $=(0,n.useCallback)((()=>{r(w().globalWorkflowTemplates.fromIdOfType({templateId:m().MH,type:"collection"}),{type:"ai_generated_template"})}),[r]),G=(0,n.useCallback)((e=>{r(e,{type:"suggested_template",allOrderedTemplateIds:K.map((e=>e.templateId))})}),[r,K]),Q=V?E:D,q=(0,C().oE)([u?(0,M.jsx)(Q,{iconFn:f().Y,iconColorName:"secondary",label:(0,M.jsx)(v().sA,{id:"workflowTemplatesOnboardingModal.button.emptyPage",defaultMessage:"Empty page"}),onClick:t},"emptyPage"):void 0,(0,M.jsx)(Q,{iconFn:h().T,iconColorName:"secondary",label:(0,M.jsx)(v().sA,{id:"workflowTemplatesOnboardingModal.button.emptyDatabase",defaultMessage:"Empty database"}),onClick:o},"emptyDatabase"),N?(0,M.jsx)(Q,{iconFn:S().aiFaceIcon,iconColorName:"secondary",label:(0,M.jsx)(v().sA,{id:"workflowTemplatesOnboardingModal.button.buildWithAi",defaultMessage:"Build with AI"}),onClick:$},"buildWithAi"):void 0]);return(0,M.jsxs)("div",{style:H.container,children:[P?void 0:(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("div",{style:V?H.newUserOnboardingButtons:H.basicButtonGrid,children:q}),(0,M.jsx)(g().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:(0,M.jsx)(v().sA,{defaultMessage:"Suggested",id:"workflowTemplatesOnboardingModal.templateSelection.heading"})})]}),(0,M.jsx)("div",{style:H.templateButtonGrid,children:K.map(((e,t)=>(0,M.jsx)(B,{template:e,onSelect:G,index:t},e.templateId)))}),L?null:U?(0,M.jsx)(p().p,{style:H.showMoreButton,onClick:W,children:(0,M.jsx)(g().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:(0,M.jsx)(v().sA,{id:"workflowTemplatesOnboardingModalSelectionLanding.seeMore",defaultMessage:"More templates"})})}):(0,M.jsx)(z,{onClick:d})]})}function z(e){const{onClick:t}=e,o=(0,a().K8)((()=>{const e=r().default.state.sidebarSpaceViewStore;return(0,j().U)(e)}),[]),n=(0,s().IS)((()=>({marketplaceButton:{marginTop:O,gap:6},marketplaceIcon:{height:19,width:"auto",color:b().Tj.icon.secondary}})),[]);return o?null:(0,M.jsxs)(p().p,{size:"lg",style:n.marketplaceButton,onClick:t,children:[(0,x().notionTemplateIcon)(n.marketplaceIcon),(0,M.jsx)(g().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:K}),(0,M.jsx)(u().I,{icon:y().arrowStraightRightSmallIcon,size:"sm",colorVariant:"secondary"})]})}}}]);