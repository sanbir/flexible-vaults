"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[57613,82641],{97835:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>s,inviteMemberIcon:()=>o});n(296540);var i=n(474848);const s={viewBox:"0 0 20 20",fittedViewBox:"3.68 2.37 15.82 17.13",svg:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("path",{d:"M10 2.375c-1.137 0-2.054.47-2.674 1.242-.608.757-.9 1.765-.9 2.824s.292 2.066.9 2.824c.62.772 1.537 1.241 2.674 1.241s2.055-.469 2.675-1.241c.608-.758.9-1.766.9-2.824 0-1.059-.292-2.067-.9-2.824-.62-.773-1.538-1.242-2.675-1.242M7.676 6.441c0-.842.233-1.554.624-2.042.38-.473.937-.774 1.7-.774s1.32.301 1.7.774c.391.488.624 1.2.624 2.042s-.233 1.554-.624 2.041c-.38.473-.937.774-1.7.774s-1.32-.3-1.7-.774c-.391-.487-.624-1.2-.624-2.041M10 11.63c-2.7 0-5.101 1.315-6.12 3.305-.361.706-.199 1.421.23 1.923.412.48 1.06.767 1.74.767h5.845a4.6 4.6 0 0 1-.28-1.25H5.85c-.342 0-.634-.148-.79-.33-.138-.162-.172-.336-.067-.54.761-1.488 2.672-2.626 5.007-2.626.83 0 1.605.144 2.294.395.269-.364.59-.688.952-.96A7.9 7.9 0 0 0 10 11.63"}),(0,i.jsx)("path",{d:"M16 19.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7m2.594-3.469a.625.625 0 0 0-.625-.625h-1.375v-1.375a.625.625 0 0 0-1.25 0v1.375h-1.375a.625.625 0 0 0 0 1.25h1.375v1.375a.625.625 0 1 0 1.25 0v-1.375h1.375c.345 0 .625-.28.625-.625"})]})},o=(0,n(340498).wt)("inviteMember",s,"default")},101749:(e,t,n)=>{n.d(t,{N:()=>r});n(296540);var i=()=>n(69708),s=()=>n(423657),o=n(474848);function r(e){const t=(0,s().A)(e);return t.isGuestRequestRequired?(0,o.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.guestRequestRequired",defaultMessage:"This guest must be approved by a workspace owner first"}):t.isStoreInTeam?t.teamAllowsGuests?void 0:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:(0,o.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine1",defaultMessage:"This teamspace doesn’t allow guests."})}),(0,o.jsx)("div",{children:(0,o.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue."})})]}):t.spaceAllowsGuests?void 0:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:(0,o.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine1",defaultMessage:"This workspace doesn’t allow guests."})}),(0,o.jsx)("div",{children:(0,o.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue."})})]})}},133507:(e,t,n)=>{n.d(t,{j:()=>d});n(296540);var i=()=>n(664594),s=()=>n(300474),o=()=>n(590526),r=()=>n(483226),a=()=>n(69708),l=()=>n(408895),u=n(474848);function d({featureAvailability:e}){const t=(0,s().r)(),n=(0,i().T)(),d=(0,o().K8)((()=>{const e=(0,l().M)({spaceId:t,userId:n,enforceIdsCheck:!1,debugFrom:"GuestLimitTooltip"});return e?(0,r().nb)(e)??0:0}),[t,n]),c={type:"unavailable",limit:{type:"cumulative",total:d,current:d},upsell:{type:"product",product:"plus",limit:{type:"cumulative",current:d,total:"unlimited"},trialability:"none"}};e??=c;const p=e.limit.total,m=e.upsell;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{children:(0,u.jsx)(a().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine1",defaultMessage:"Your plan allows up to {currentLimit, plural, one {{currentLimit} unique guest} other {{currentLimit} unique guests}}.",values:{currentLimit:p}})}),"product"===m.type?(0,u.jsx)("div",{children:(0,u.jsx)(a().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine2upgrade",defaultMessage:"Upgrade to get up to {upsellLimit, plural, one {{upsellLimit} guest} other {{upsellLimit} guests}}",values:{upsellLimit:m.limit.total}})}):(0,u.jsx)(a().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine2contactSales",defaultMessage:"Contact sales to get more guests"})]})}},176235:(e,t,n)=>{n.d(t,{M:()=>o});var i=n(296540),s=n(474848);const o=i.forwardRef((function(e,t){const{name:i,icon:o,...r}=e,a=i;return(0,s.jsx)(n(81068).A,{...r,ref:t,icon:(0,s.jsx)(n(865342).Z,{icon:o}),title:a})}))},313171:(e,t,n)=>{n.d(t,{L:()=>r});n(296540);var i=()=>n(970236),s=()=>n(69708),o=n(474848);function r(){return(0,o.jsx)(i().E,{content:(0,o.jsx)(s().sA,{id:"spaceUserMembershipType.restrictedMember",defaultMessage:"Restricted"}),color:"yellow"})}},366858:(e,t,n)=>{n.d(t,{A:()=>r});n(581454);var i=()=>n(484714),s=()=>n(590526),o=()=>n(592674);function r(e){const t=(0,i().v3)();return(0,s().K8)((()=>{var n;const i=null==e?void 0:e.id;if(i)return null===(n=o().A.getData(t,{spaceId:i}))||void 0===n?void 0:n.map((e=>e.domain))}),[t,e])}},381374:(e,t,n)=>{n.d(t,{p:()=>o});n(296540);var i=()=>n(69708),s=n(474848);function o({invalidInvites:e,showEmptyError:t,styles:n}){if(t)return(0,s.jsx)("div",{style:n,children:(0,s.jsx)(i().sA,{id:"inviteTargetsInput.invalidWarning.noEmails",defaultMessage:"Please enter an email address"})});if(0===e.length)return null;const o=e[0].value.text;return 1===e.length?(0,s.jsx)("div",{style:n,children:(0,s.jsx)(i().sA,{id:"inviteTargetsInput.invalidWarning.singleEmail",defaultMessage:"“{text}” is not a valid email",values:{text:o}})}):(0,s.jsx)("div",{style:n,children:(0,s.jsx)(i().sA,{id:"inviteTargetsInput.invalidWarning.multipleEmails",defaultMessage:"{additionalInvalid, plural, one {”{text}” and {additionalInvalid} other are not valid emails} other {”{text}” and {additionalInvalid} others are not valid emails}}",values:{text:o,additionalInvalid:e.length-1}})})}},423657:(e,t,n)=>{n.d(t,{A:()=>l});var i=()=>n(135168),s=()=>n(299545),o=()=>n(78846),r=()=>n(707396);function a(e,t){return(0,o().h)(e)?{isGuestRequestRequired:!0}:t?{isStoreInTeam:!0,teamAllowsGuests:!0,spaceAllowsGuests:!0,isGuestRequestRequired:!1}:{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1}}const l=function(e){return(0,n(590526).K8)((()=>{if((0,s().nw)(e))return{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1};if("workflow"===e.table){const t=(0,i().f)(e);return(0,r().r)(t)?a(t,void 0):{isStoreInTeam:!1,spaceAllowsGuests:!(null!=t&&t.getDisableGuests()),isGuestRequestRequired:!1}}if(!(0,s()._p)(e))return(0,r().r)(e)?a(e,void 0):{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1};const t=(0,n(74351).U)(e),o=(0,n(156202).p)(e),l=o||(0,i().f)(e);if((0,r().r)(l))return a(l,t);const u=!(null!=o&&o.getDisableGuests());return t?{isStoreInTeam:!0,teamAllowsGuests:!t.getDisableGuests(),spaceAllowsGuests:u,isGuestRequestRequired:!1}:{isStoreInTeam:!1,spaceAllowsGuests:u,isGuestRequestRequired:!1}}),[e])}},467211:(e,t,n)=>{n.d(t,{P:()=>u,S:()=>d});n(898992),n(354520),n(581454);var i=()=>n(876338),s=()=>n(741615),o=()=>n(842599),r=()=>n(542056),a=()=>n(519735);const l=n(496603).sg((({environment:e,flowId:t,billingData:i,origin:s})=>{n(134696).D2(e,{invite_flow_id:t,billingData:i,invite_origin:s})}),1e3);async function u(e){var t;const{environment:n,pageContext:u,event:d,flowId:c,inviteTargetsStore:p,inviteOrigin:m,onInputChanged:g}=e;null==g||g();const v=null===(t=(0,i().$)(u))||void 0===t?void 0:t.id,f=await(0,s().yk)({environment:n,spaceId:v});p.setState({...p.state,tokenQuery:d.target.value}),l({environment:n,flowId:c,billingData:f,origin:m});const y=d.target.value,{extractedEmails:h,invalidParts:b,newInputValue:S}=(0,o().l2)(y),x=[...await r().Ah(n,h),...b.map((e=>({type:"invalidUser",value:{text:e}})))].filter((e=>!a().P4({inviteTargetsStore:p,target:e}))),T=[...p.state.inviteTargets,...x];p.setState({...p.state,inviteTargets:T,tokenQuery:S})}function d(e){const{targetToRemove:t,inviteTargetsStore:n}=e;if(0===n.state.inviteTargets.length)return;const i=n.state.inviteTargets.filter((e=>e!==t));0===i.length?n.setState({...n.state,inviteTargets:[]}):n.setState({...n.state,inviteTargets:i})}},519735:(e,t,n)=>{n.d(t,{P4:()=>s,U1:()=>r,lW:()=>a});n(944114),n(898992),n(354520),n(737550);var i=()=>n(842599);function s(e){const{target:t,inviteTargetsStore:n}=e;return n.state.inviteTargets.some((e=>"newUser"===t.type?e.type===t.type&&t.value.email===e.value.email:"invalidUser"===t.type?e.type===t.type&&t.value.text===e.value.text:"group"===t.type?e.type===t.type&&e.value.group_id===t.value.group_id:e.type===t.type&&e.value.id===t.value.id))}function o(e){return"invalidUser"!==e.type}function r(e){const{inviteTargetsStore:t,includeInputFieldText:n}=e,r=[...t.state.inviteTargets];if(n){const e=function(e){const t=e.state.tokenQuery.trim();if(!(0,i().DT)(t))return;const n={type:"newUser",value:{email:t},source:"email"};return s({target:n,inviteTargetsStore:e})?void 0:n}(t);e&&r.push(e)}return r.filter(o)}function a(e){const{inviteTargetsStore:t,inviteTarget:n}=e;if(s({target:n,inviteTargetsStore:t})){const e=t.state.inviteTargets.filter((e=>"group"===n.type&&"group"===e.type?n.value.group_id!==e.value.group_id:"existingUser"===n.type&&"existingUser"===e.type?n.value.id!==e.value.id:"newUser"!==n.type||"newUser"!==e.type||n.value.email!==e.value.email));return t.setState({...t.state,inviteTargets:e}),!1}return t.setState({inviteTargets:[...t.state.inviteTargets,n],tokenQuery:""}),!0}},577829:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>s,personCropCircleBadgeExclamationPointSmallIcon:()=>o});n(296540);var i=n(474848);const s={viewBox:"0 0 16 16",fittedViewBox:"0.32 1.87 13.8 13.81",svg:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("path",{d:"M8 1.875a6.125 6.125 0 0 0-6.057 7.043.075.075 0 0 0 .1.059 4 4 0 0 1 1.058-.233.075.075 0 0 0 .068-.085 4.875 4.875 0 1 1 8.076 2.98c-.666-1.063-1.878-1.76-3.245-1.76-.52 0-1.02.1-1.474.285a.075.075 0 0 0-.032.115q.329.437.526.954a.075.075 0 0 0 .095.044c.274-.095.572-.148.885-.148.962 0 1.783.5 2.212 1.217a4.86 4.86 0 0 1-2.87.485.075.075 0 0 0-.085.069q-.045.555-.233 1.056a.075.075 0 0 0 .059.1q.449.069.917.069a6.125 6.125 0 0 0 0-12.25"}),(0,i.jsx)("path",{d:"M8 4.036c-.787 0-1.432.327-1.868.87-.424.528-.619 1.219-.619 1.927s.195 1.4.619 1.927c.436.543 1.081.87 1.868.87s1.433-.327 1.869-.87c.423-.528.618-1.219.618-1.927s-.195-1.4-.618-1.927c-.436-.543-1.082-.87-1.869-.87m-.893 1.652c.195-.243.48-.402.893-.402s.698.159.894.402c.207.258.343.653.343 1.145s-.136.887-.343 1.145c-.196.243-.48.402-.894.402-.413 0-.698-.159-.893-.402-.208-.258-.344-.653-.344-1.145s.136-.887.344-1.145M3.4 9.525a3.075 3.075 0 1 0 0 6.15 3.075 3.075 0 0 0 0-6.15m-.425 1.409a.425.425 0 1 1 .85 0v2a.425.425 0 0 1-.85 0zm0 3.44a.425.425 0 1 1 .85.002.425.425 0 0 1-.85-.002"})]})},o=(0,n(340498).wt)("personCropCircleBadgeExclamationPointSmall",s,"small")},582418:(e,t,n)=>{n.d(t,{D:()=>i});const i=(0,n(69708).YK)({personalAgentMentionName:{id:"botMention.personalAgent.name",defaultMessage:"Notion AI"}}).personalAgentMentionName},592674:(e,t,n)=>{n.d(t,{A:()=>s});const i=new(n(62175).U)(((e,{spaceId:t})=>`${e.currentUser.id}:${t}`),(async(e,{spaceId:t},n=!1)=>{var i;const s=await e.api.callApi({eventName:"getInternalDomains",environment:e,data:{spaceId:t}});return"success"===s.type?null===(i=s.data)||void 0===i?void 0:i.internalDomainsWithInfo:void 0}));n(852832).exposeDebugValue("InternalDomainsStore",i);const s=i},635455:(e,t,n)=>{n.d(t,{Hp:()=>z,Ju:()=>H,_h:()=>J});n(944114),n(898992),n(354520),n(581454),n(737550);var i=n(296540),s=()=>n(106702),o=()=>n(920198),r=()=>n(726637),a=()=>n(484714),l=()=>n(590526),u=()=>n(401497),d=()=>n(929219),c=()=>n(457205),p=()=>n(26697),m=()=>n(736847),g=()=>n(68169),v=()=>n(582418),f=()=>n(165358),y=()=>n(187174),h=()=>n(763884),b=()=>n(68263),S=()=>n(824862),x=()=>n(201980),T=()=>n(496703),I=()=>n(69708),w=()=>n(100622),A=()=>n(229833),M=()=>n(829300),_=()=>n(812182),j=()=>n(486674),k=()=>n(47373),C=()=>n(499764),P=()=>n(385979),U=()=>n(673477),E=()=>n(246766),R=()=>n(106628),D=()=>n(547149),B=()=>n(94522),F=()=>n(865342),q=()=>n(176235),L=()=>n(455971),G=n(474848);const K=100,N=(0,I().YK)({personalAgentTriggerWords:{id:"botMention.personalAgent.triggerWords",defaultMessage:"personal,ai,notion,agent,bot"},agentInviteToastTitle:{id:"agentMention.inviteToast.title",defaultMessage:"Invite agent to page?"},agentInviteToastDescription:{id:"agentMention.inviteToast.description",defaultMessage:"This agent doesn’t have access to this page yet."},agentInviteToastSettingsButton:{id:"agentMention.inviteToast.settingsButton",defaultMessage:"Agent Settings"},agentNoEditToastTitle:{id:"agentMention.noEditToast.title",defaultMessage:"Agent cannot access this page"},agentNoEditToastDescription:{id:"agentMention.noEditToast.description",defaultMessage:"Ask the owner of the agent to allow it access to this page."},agentNoEditToastViewButton:{id:"agentMention.noEditToast.viewButton",defaultMessage:"View Agent"},agentMentionTriggerToastTitle:{id:"agentMention.triggerToast.title",defaultMessage:"Have agent listen to mentions?"},agentMentionTriggerToastSettingsButton:{id:"agentMention.triggerToast.settingsButton",defaultMessage:"Agent Settings"},agentMentionTriggerToastMessage:{id:"agentMention.triggerToast.message",defaultMessage:"This agent is not triggered when it’s mentioned."}});function O(e,t){return`ShowBotMentionInvite-${e}-${t}`}function V(e){return`ShowMentionTrigger-${e}`}function W(e){const{bot:t,message:n}=e,i=(0,u().IS)((()=>{const e=(0,w().O4)({theme:"dark"});return{container:{display:"flex",flexDirection:"column",gap:4},tokenContainer:{paddingTop:4,paddingBottom:4},darkTooltip:{background:e.background.accentPrimary,color:e.text.inversePrimary}}}),[]);return(0,G.jsxs)("div",{style:i.container,children:[(0,G.jsx)(p().m,{overlayContainerZIndex:202,alignment:"center",originGap:2,placement:"top",renderTooltip:()=>t.name,render:e=>(0,G.jsx)("div",{style:i.tokenContainer,...e,children:(0,G.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"4px 8px",borderRadius:6,background:"rgba(55, 53, 47, 0.06)",fontSize:14,fontWeight:500},children:[(0,G.jsx)(F().Z,{icon:t.icon}),t.name]})}),style:i.darkTooltip}),(0,G.jsx)("div",{children:n})]})}function z(e){const{bot:t,environment:n,intl:i,pageStore:s}=e;if(!s)return;const o=Boolean(h().K.get({userId:n.currentUser.id,key:O(s.id,t.id)}));if(!(!r().A.isMobile&&!o))return;if(!t.workflowStore)return;const a={id:t.id,name:t.name,icon:t.icon,workflowStore:t.workflowStore},l=a.workflowStore.canEdit(),u=(d=a.workflowStore,((0,B().dh)(d).triggers||[]).filter((e=>{const t=e.state;return"notion.agent.mentioned"===(null==t?void 0:t.type)&&!1!==e.enabled})).length>0);var d;if(!u&&l){if(!Boolean(h().K.get({userId:n.currentUser.id,key:V(t.id)})))return h().K.set({userId:n.currentUser.id,key:V(t.id),value:!0}),void _().HK(function(e){const{environment:t,bot:n,intl:i}=e;return{id:`agent_mention_trigger_${n.id}`,title:i.formatMessage(N.agentMentionTriggerToastTitle,{agentName:n.name}),jsxMessage:(0,G.jsx)(W,{bot:n,message:(0,G.jsx)(I().sA,{...N.agentMentionTriggerToastMessage})}),actions:{primary:{title:i.formatMessage(N.agentMentionTriggerToastSettingsButton),onAction:()=>{h().K.set({userId:t.currentUser.id,key:V(n.id),value:!1});const e=(0,T().L)({workflowId:n.workflowStore.id,params:{workflowViewType:"settings"}});(0,E().navigate)({environment:t,url:e})}}}}}({environment:n,bot:a,intl:i,pageStore:s}))}if(u){if(function(e,t){try{const n=(0,C().X2)({botId:e,store:t});return!(!n||!n.role)&&"none"!==n.role&&(0,b().Tt)(n.role)}catch(n){return f().log({level:"error",from:"doesBotHavePageAccess",type:"BotPermissionCheckError",error:(0,A().convertErrorToLog)(n),data:{botId:e,pageId:t.id}}),!1}}(a.id,s))return;t.workflowStore&&(h().K.set({userId:n.currentUser.id,key:O(s.id,t.id),value:!0}),l?_().HK(function(e){const{environment:t,bot:n,intl:i,pageStore:s}=e;return{id:`agent_invite_${n.id}`,title:i.formatMessage(N.agentInviteToastTitle,{agentName:n.name}),jsxMessage:(0,G.jsx)(W,{bot:n,message:(0,G.jsx)(I().sA,{...N.agentInviteToastDescription})}),actions:{primary:{title:i.formatMessage(N.agentInviteToastSettingsButton),onAction:()=>{h().K.set({userId:t.currentUser.id,key:O(s.id,n.id),value:!1});const e=(0,T().L)({workflowId:n.workflowStore.id,params:{workflowViewType:"settings"}});(0,E().navigate)({environment:t,url:e})}}}}}({environment:n,bot:a,intl:i,pageStore:s})):_().HK(function(e){const{environment:t,bot:n,intl:i,pageStore:s}=e;return{id:`agent_no_edit_${n.id}`,title:i.formatMessage(N.agentNoEditToastTitle,{agentName:n.name}),jsxMessage:(0,G.jsx)(W,{bot:n,message:(0,G.jsx)(I().sA,{...N.agentNoEditToastDescription})}),actions:{primary:{title:i.formatMessage(N.agentNoEditToastViewButton),onAction:()=>{h().K.set({userId:t.currentUser.id,key:O(s.id,n.id),value:!1});const e=(0,T().L)({workflowId:n.workflowStore.id,params:{}});(0,E().navigate)({environment:t,url:e})}}}}}({environment:n,bot:a,intl:i,pageStore:s})))}}function J(e){const{query:t,disabled:n}=e,i=(0,a().v3)(),r=(0,I().tz)(),u=(0,l().O$)(d().e),c=(0,o().L)(),p=(0,s().$)(),m=(0,k().ke)(),h=(0,k().$C)(),b=!n&&Boolean(c)&&Boolean(p),[{value:S=[],status:x}]=(0,y().Yb)((async()=>{if(!b||!u)return[];try{if(!c||!p)return[];const n=[],s=r.formatMessage(v().D),o=r.formatMessage(N.personalAgentTriggerWords).split(",").map((e=>e.trim().toLowerCase())).filter(Boolean),a=t.toLowerCase();if(h&&(""===a||s.toLowerCase().includes(a)||o.some((e=>a.includes(e))))&&n.push({id:g().Lj,name:s,icon:void 0,workflowStore:void 0}),m){const s=await R().T.customAgentSearchService.load(),{workflowStores:o}=await s.getCustomAgents({environment:i,spaceStore:c,userStore:p}),r=s.searchWorkflowStores({query:t,workflowStores:o,limit:e.limit??3});for(const e of r){const t=s.getAvailableWorkflowData(e);if(!t)continue;if(!e.getAlive())continue;const i=t.name,o=t.icon,r=t.runtime_actor_pointer,a="bot"===(null==r?void 0:r.table)?r.id:void 0;i&&a&&n.push({id:a,name:i,icon:o,workflowStore:e})}}return n}catch(n){return f().log({level:"error",from:"botResults",type:"BotMentionSearchError",error:(0,A().convertErrorToLog)(n),data:{query:t}}),[]}}),[b,u,c,p,t,i,e.limit,m,r,h],{debounce:K});return{results:S,isLoading:"pending"===x}}function H(e){const{isFirstSection:t,query:n,setTemporaryInputData:s,disabled:o}=e,r=(0,a().v3)(),u=(0,I().tz)(),d=(0,l().K8)((()=>U().Ay.state.mentionTypes.bot),[]),{results:p,isLoading:v}=function(e){const t=(0,l().K8)((()=>U().Ay.state.open),[]),n=(0,l().K8)((()=>U().Ay.state.mentionTypes.bot),[])&&t&&!e.disabled;return J({query:e.query,disabled:!n})}({query:n,disabled:o}),f=(0,l().K8)((()=>(0,j().a)()),[]),y=(0,i.useCallback)((e=>{z({bot:e,environment:r,intl:u,pageStore:f})}),[r,u,f]),h=(0,i.useMemo)((()=>p.map((e=>{const t=e.id;return{key:t,render:n=>(n.focused&&s({title:e.name,icon:(0,G.jsx)(L().sL,{}),allowTabCompletion:!0}),(0,i.createElement)(q().M,{...n,key:t,name:e.name,icon:e.icon})),action:t=>{if(e.id===g().Lj)return void(0,D().createAndCommit)({userAction:"MentionMenu.botMenuItem",environment:r,canUndo:!0,perform:i=>{M().Ju({environment:r,editorMode:"default",annotations:[(0,x().Vb6)(e.id)],transaction:i,menuListItemAction:t,query:n,mentionType:"bot"})}});const i=new(c().v)(r,{table:S().GP,id:e.id});i.waitUntil((()=>i.isReady())).then((()=>{(0,D().createAndCommit)({userAction:"MentionMenu.botMenuItem",environment:r,canUndo:!0,perform:i=>{M().Ju({environment:r,editorMode:"default",annotations:[(0,x().Vb6)(e.id)],transaction:i,menuListItemAction:t,query:n,mentionType:"bot"})}}),y(e)}))}}}))),[p,r,n,s,y]),b=(0,P().h)({resultsCount:h.length,shouldShow:v,variant:"mention-menu-people"}),T=(0,i.useMemo)((()=>{if(!d)return;if(0===h.length&&!v)return;return{key:(()=>{const e=h.length>0;return v&&!e?"bot-results-loading":v||e?"bot-results":"bot-results-empty"})(),render:e=>(0,G.jsx)(m().A,{...e,title:(0,G.jsx)(I().sA,{defaultMessage:"Agents",id:"mentionMenu.botsSection.title"}),desktopTitleStyle:t?{paddingTop:4}:void 0,topBorder:!t}),items:[...h,...b]}}),[d,h,v,b,t]);return d?{botResultsSection:T,isBotResultsLoading:v,numberOfBotResults:p.length}:{botResultsSection:void 0,isBotResultsLoading:!1,numberOfBotResults:0}}},637573:(e,t,n)=>{n.d(t,{r:()=>a});var i=()=>n(907258),s=()=>n(484714),o=()=>n(590526),r=()=>n(379026);function a(){const e=(0,s().v3)();return(0,o().K8)((()=>{const{sidebarSpaceStore:t}=i().default.state;if(t)return(0,r().f)({environment:e,spaceId:t.id})}),[e])}},664133:(e,t,n)=>{n.d(t,{Sl:()=>G,i5:()=>q,ol:()=>F,xU:()=>L});n(898992),n(672577),n(803949);var i=()=>n(564884),s=()=>n(907258),o=()=>n(247584),r=()=>n(365917),a=()=>n(675133),l=()=>n(792057),u=()=>n(732810),d=()=>n(433337),c=()=>n(148307),p=()=>n(617871),m=()=>n(651124),g=()=>n(165358),v=()=>n(201980),f=()=>n(496603),y=()=>n(763824),h=()=>n(973647),b=()=>n(559926),S=()=>n(553003),x=()=>n(601734),T=()=>n(686504),I=()=>n(150193),w=()=>n(666803),A=()=>n(612587),M=()=>n(404141),_=()=>n(51781),j=()=>n(547149),k=()=>n(964556),C=()=>n(769864),P=()=>n(934839),U=()=>n(510683),E=()=>n(496414),R=()=>n(384944);const D=(0,n(69708).YK)({JiraAuthenticationInvalidDetails:{id:"jiraImport.invalidDetails",defaultMessage:"Invalid Details"},TasksCollectionName:{defaultMessage:"Issues",id:"appTemplates.tasks.issuesDatabaseName"}}),B=6e4;async function F(e){const{environment:t,userEmail:n,spaceId:s,flowId:r,authInfo:u}=e;(0,i().u)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira",actionType:"admin_auth_initiated",flowId:r}}});try{var d;const p=e.site.replace(/\/+$/,"");if(!t.currentUser.id)return l().rG({message:a().A.formatMessage(D.JiraAuthenticationInvalidDetails)}),void E().V();let m;if("Basic"===u.authType&&"DataCenter"===u.instance&&"username"in u&&"password"in u)m=await C().callApi({eventName:"authenticateJiraUser",environment:t,data:{userEmail:n,site:p,userId:t.currentUser.id,spaceId:s,instance:u.instance,username:u.username,password:u.password,authType:u.authType,isScopedToken:!1}});else{if(!("apiKey"in u))return;m=u.isScopedToken&&"cloudId"in u?await C().callApi({eventName:"authenticateJiraUser",environment:t,data:{userEmail:n,site:p,apiKey:u.apiKey,userId:t.currentUser.id,spaceId:s,instance:u.instance,isScopedToken:u.isScopedToken,cloudId:u.cloudId}}):await C().callApi({eventName:"authenticateJiraUser",environment:t,data:{userEmail:n,site:p,apiKey:u.apiKey,userId:t.currentUser.id,spaceId:s,instance:u.instance,isScopedToken:u.isScopedToken}})}await k().refreshExternalIntegrationStore({environment:t});const v="success"===m.type&&(null===(d=m)||void 0===d||null===(d=d.data)||void 0===d?void 0:d.isAdmin);if((0,i().u)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira",actionType:"admin_auth_status",flowId:r,status:v?"success":"failed"}}}),g().log({level:v?"info":"error",from:"jiraActions",type:"authenticateWithJira",data:{message:v?"authenticate with Jira is successful":"Failed to authenticate with Jira",miscDataToConvertToString:{authResponse:m}}}),"failed"===m.type){const e=(0,o().V4)(m);console.error(m.error);const t=w().Ay.getInitialState();w().Ay.setState(t),l().ui({message:e,showCancel:!1,keepFocus:!1,items:[{label:a().A.formatMessage(l()._0.dismissButtonLabel),onAccept:f().D_}]}),g().log({level:"error",from:"jiraActions",type:"authenticateWithJira",data:{message:"Failed to authenticate with Jira",miscDataToConvertToString:{errorMessage:e,authResponse:m}}})}else{var c;if(null!==(c=m)&&void 0!==c&&null!==(c=c.data)&&void 0!==c&&c.isAdmin){if("collection_settings_external_source"===w().Ay.state.from){const e=w().Ay.getInitialState();w().Ay.setState({...e,open:!1})}else w().Ay.setState({...w().Ay.state,type:"teamspace-selection",open:!0,flowId:r,site:p,botId:m.data.botId}),(0,i().u)({environment:t,event:{eventName:"external_sync_teamspace_selection",eventProperties:{integration:"jira",actionType:"teamspace_modal_render",flowId:r}}});const e=M().Ay.getInitialState();M().Ay.setState(e)}else w().Ay.setState({...w().Ay.state,type:"auth",open:!0,adminTokenError:!0,flowId:r,site:void 0}),(0,i().u)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira",actionType:"admin_auth_render",flowId:r}}})}E().V()}catch(p){(0,i().u)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira",actionType:"admin_auth_status",flowId:r,status:"failed"}}}),g().log({level:"error",from:"jiraActions",type:"authenticateWithJira",data:{message:"Failed to authenticate with Jira",miscDataToConvertToString:{err:p}}})}}async function q({environment:e,selectedTeamspaceId:t,siteUrl:n,botId:i,instanceType:o,syncName:r}){try{const{appTemplatesSetupActions:l,appConfigs:p}=await x().Aw.load(),{sidebarSpaceStore:g,sidebarSpaceViewStore:f,currentUserStore:y}=s().default.getState(),h=null==y?void 0:y.id;if(!h||!g)return;let T=g;if(t){const n=(await(0,_().getActiveTeamsMetadataForUserInSpace)({userId:h,spaceStore:g,environment:e})).find((e=>e.id===t));if(!n)return;T=(0,_().getTeamStore)({teamId:n.id,spaceStore:g})}if(!f||!T)return;const{serverCommitResult:I,performResult:w}=j().createAndCommit({environment:e,perform:t=>{var n;const i=d().tP,s=null===(n=(0,S().B)(p(),i))||void 0===n?void 0:n.uri;if(!s)return;const o=p().find((e=>e.uri===s));if(null==o?void 0:o.presets.find((e=>e.uri===i))){return l.initializeApp({environment:e,spaceViewStore:f,appParentStore:T,appUri:s,presetUri:i,transaction:t,from:"jira_import"})}return[]},canUndo:!0,userAction:"importActions.importJira"}),A=e.defaultRecordCache.inMemoryRecordCache;await I,null==w||w.forEach((t=>{const s=t.getFormat(),l=null==s?void 0:s.collection_pointer;if(l){const t=A.getRecord({pointer:l,userId:e.currentUser.id});t&&t.value&&j().createAndCommit({userAction:"jiraActions.updateFormatForCollections",environment:e,canUndo:!0,perform:s=>{const p=t.value,g=null==p?void 0:p.format;if(g){g.external_collection_type=m().uO.Jira,g.synced_collection_external_url=n,g.synced_collection_instance_type=o,g.bot_id=i,p.icon=g.app_config_uri===d().dC?c().A.images.appPackages.jiraTaskIconSvg:c().A.images.appPackages.jiraProjectIconSvg;const t=new(u().m)(e,l),f=g.app_config_uri===d().dC?a().A.formatMessage(D.TasksCollectionName):v().q4_(p.name);(r||g.app_config_uri===d().dC)&&(p.name=(0,v().x9d)(r?`${r} ${f}`:f)),R().zv({store:t,data:p,transaction:s})}}})}}));const M=null==w?void 0:w.find((e=>{var t;return(null===(t=e.getFormat())||void 0===t?void 0:t.app_config_uri)===d().d0}));return b().eH(e,{import_source:"jira",from:"modal"}),M}catch(l){g().log({level:"error",from:"jiraActions",type:"projectPageNotCreated",data:{message:"Error while creating project page for Jira sync",miscDataToConvertToString:{error:l}}})}}async function L(e){const{environment:t,spaceId:n}=e,s=r().A.integrations.state.find((({id:e})=>e===p().me));if(s&&n)try{const e=t.device.isElectron?await async function(e,t,n){const i=await U().Jq({environment:e,integration:t,spaceId:n,from:"connected_apps_settings"}),s=r().A.externalAuthentications.state,o=performance.now()+B,a=y().yX(),l=setInterval((()=>{const e=performance.now();o<e?a.resolve(void 0):r().A.externalAuthentications.state.length>s.length&&a.resolve("success")}),1e3);return await a.promise,clearInterval(l),i}(t,s,n):await U().Jq({environment:t,integration:s,spaceId:n,from:"connected_apps_settings"});e&&h().Q.isSuccess(e)&&((0,i().u)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira",flowId:w().Ay.state.flowId??"",status:"success",actionType:"member_auth_status"}}}),b().Gy(t,{from:"collection_view_page",step:"auth_success"}),P().zA({bannerStore:I().A,id:"AuthMissingForJiraSyncedCollectionPageBanner"}),P().zA({bannerStore:A().A,id:"AuthMissingForJiraSyncedCollectionPageBanner"}))}catch(o){g().log({level:"error",from:"syncedCollectionActions",type:"connectIntegrationFailed",data:{message:"Failed to authenticate",miscDataToConvertToString:{error:o}}}),b().Gy(t,{from:"collection_view_page",step:"auth_failure"})}}async function G(e){const{environment:t,blockStore:n,collectionStore:i}=e,s=(0,T().q6)(n),o=(0,T().r_)(i),r=n.getSpaceId();try{if(!s||!o||!r)return null;const e=await C().callApi({eventName:"getJiraIssueTransitions",environment:t,data:{issueId:s,site:o,spaceId:r}});return"success"===e.type?e.data.transitions:(g().log({level:"error",from:"jiraActions",type:"fetchJiraIssueTransitionsFailed",data:{message:"Failed to fetch JIRA issue status options",miscDataToConvertToString:{response:e,issueId:s,site:o,spaceId:r}}}),null)}catch(a){return g().log({level:"error",from:"jiraActions",type:"fetchJiraIssueTransitionsError",data:{message:"Failed to fetch JIRA transitions",miscDataToConvertToString:{error:a,issueId:s,site:o,spaceId:r}}}),null}}},686504:(e,t,n)=>{n.d(t,{WS:()=>o,ot:()=>r,q6:()=>a,r_:()=>l});n(944114),n(898992),n(672577),n(803949),n(737550);var i=()=>n(498212),s=()=>n(534177);function o(e){const{context:t,staticOptions:n,staticGroups:o,externalStatusOptions:r}=e;return t.collectionType&&"Jira"===t.collectionType?function(e){const{transitions:t,staticOptions:n,staticGroups:o}=e;if(!t)return null;return function(e){const{transitions:t,staticGroups:n}=e,o=[],r=[];return(0,s().WP)(t).forEach((([e,t])=>{const s=[];t.forEach((t=>{const n=(0,i().Ay)();o.push({id:n,value:t.name,color:u(e)}),s.push(n)}));const a=n.find((t=>t.name===e));a&&r.push({...a,optionIds:s})})),{options:o,groups:r}}({transitions:t,staticOptions:n,staticGroups:o})}({transitions:r,staticOptions:n,staticGroups:o}):null}function r(e){const{collectionStore:t,blockStore:n}=e,i=null==t?void 0:t.getFormat();return{collectionType:null==i?void 0:i.external_collection_type,spaceId:null==n?void 0:n.getSpaceId(),blockStore:n,collectionStore:t}}function a(e){const t=e.getProperties();for(const[n,i]of Object.entries(t||{}))if(Array.isArray(i)&&i.length>0){const e=i[0];if(Array.isArray(e)&&e.length>0){const t=e[0];if("string"==typeof t&&t.includes("/browse/")){const e=t.match(/\/browse\/([A-Z]+-\d+)/);if(e)return e[1]}}}return null}function l(e){const t=e.getFormat();return null==t?void 0:t.synced_collection_external_url}function u(e){switch(e){case"To-do":default:return"gray";case"In progress":return"blue";case"Complete":return"green"}}},690490:(e,t,n)=>{n.d(t,{i:()=>ue});var i=n(296540),s=()=>n(782482),o=()=>n(484714),r=()=>n(590526),a=()=>n(401497),l=()=>n(26697),u=()=>n(69708),d=()=>n(100622),c=()=>n(496603),p=()=>n(966505),m=()=>n(347160),g=()=>n(366858),v=(n(581454),()=>n(726637)),f=()=>n(352321),y=()=>n(114871),h=()=>n(467211),b=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),()=>n(135168)),S=()=>n(807449),x=()=>n(784892),T=()=>n(842599),I=()=>n(534177),w=()=>n(284371),A=()=>n(453697),M=()=>n(423657),_=()=>n(101749),j=n(474848);const k=function(e){const{store:t,target:s}=e,o=(0,u().tz)(),c=function(){const e=(0,a().IS)((()=>({verifiedDomain:{margin:2,backgroundColor:"rgba(83, 168, 63, 0.1)"},disabled:{margin:2,backgroundColor:"rgba(211, 79, 67, 0.1)",border:"dashed #D9655B 1px",paddingInlineStart:5},normal:{margin:2},guest:{margin:2,backgroundColor:"rgba(218, 163, 64, 0.2)"},error:{margin:2,backgroundColor:"rgba(195,90,75,0.2)",color:"#DE5550"},tokenContent:{display:"flex",alignItems:"center",maxWidth:"100%"},tokenSpan:{maxWidth:"100%"},tokenText:{marginInlineStart:4,...w().RC},base:{borderRadius:4}})),[]);return e}(),p=(0,r().K8)((()=>{const e=(0,n(299545).Yu)(t)?t:(0,b().f)(t);return new Set(null==e?void 0:e.getEmailDomains())}),[t]),m=(0,M().A)(t),g=(0,_().N)(t),f=(0,r().K8)((()=>{if("invalidUser"===s.type)return"invalidUser";if(e.tokenType)return e.tokenType;if("group"===s.type)return"group";if("existingUser"===s.type&&!Boolean(s.membershipType)){const e=t.getSpaceId();if(e){var i;const o=n(302996).SpaceStore.createChildStore(t,{table:n(96689).NX,id:e}),r=null===(i=(0,n(230711).sE)(o,s.value.id))||void 0===i?void 0:i.getMembershipType();s.membershipType=r??"none"}else s.membershipType="none"}if(!(0,n(743260).yi)(s))return"member";if(m.isGuestRequestRequired)return"guestRequestRequired";if(m.isStoreInTeam&&!m.teamAllowsGuests)return"teamGuestDisabled";if(!m.isStoreInTeam&&!m.spaceAllowsGuests||m.isStoreInTeam&&!m.teamAllowsGuests&&!m.spaceAllowsGuests)return"spaceGuestDisabled";const o=(0,T().zN)(s.value.email);return o&&p.has(o)?"verifiedDomain":"guest"}),[e.tokenType,s,p,m,t]),h=(0,i.useMemo)((()=>{const e=c.base;switch(f){case"member":case"group":return{...e,...c.normal};case"invalidUser":return{...e,...c.error};case"guest":case"guestRequestRequired":return{...e,...c.guest};case"verifiedDomain":return{...e,...c.verifiedDomain};case"spaceGuestDisabled":case"teamGuestDisabled":case"teamGroupOwner":return{...e,...c.disabled};default:(0,I().HB)(f)}}),[f,c]);function k(){switch(s.type){case"newUser":return s.value.email.trim();case"invalidUser":return s.value.text.trim();case"existingUser":return(0,n(695608).c6)(o,s.value);case"group":return(0,n(698449).Pf)({intl:o,groupName:s.value.name});default:(0,I().HB)(s)}}function C(){const e=(0,j.jsx)(S().I,{icon:n(721479).questionMarkCircleSmallIcon,size:"sm",style:{color:"#D34F43"}});switch(f){case"member":return(0,y().ju)(s)?(0,j.jsx)(A().A,{userValue:s.value,size:16}):(0,y().rP)(s)?(0,j.jsx)(A().A,{size:16,avatar:s.value}):(0,j.jsx)(A().A,{size:16});case"guest":case"guestRequestRequired":return(0,j.jsx)(S().I,{icon:n(101163).globeSmallIcon,size:"sm",style:{color:"#DAA340"}});case"invalidUser":return(0,j.jsx)(S().I,{icon:n(577829).personCropCircleBadgeExclamationPointSmallIcon,size:"sm",style:{color:"#DE5550"}});case"verifiedDomain":return(0,j.jsx)(S().I,{icon:n(833243).checkmarkCircleSmallIcon,size:"sm",style:{color:"#53A83F"}});case"group":return(0,j.jsx)("div",{style:{height:16,width:16,backgroundColor:d().IF.whiteWithAlpha(.8),borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,j.jsx)(S().I,{icon:n(668250).R,size:"xxs",style:{color:d().oZ.mediumTextColor}})});case"spaceGuestDisabled":case"teamGuestDisabled":case"teamGroupOwner":return e;default:(0,I().HB)(f)}}function P(t){const n=C();let i=k(),s=c.tokenText;return e.onlyShowTokenType&&(["guest","teamGuestDisabled","spaceGuestDisabled"].includes(t)?(i="Guest",s={...s,color:"#DAA340"}):(i="Member",s={...s,color:"#53A83F"})),(0,j.jsxs)("div",{style:c.tokenContent,children:[n,(0,j.jsx)("div",{style:s,children:i})]})}function U(t){var n;t.stopPropagation(),null===(n=e.onClickRemove)||void 0===n||n.call(e)}const E="newUser"===s.type?s.value.email:"invalidUser"===s.type?s.value.text:s.value.id,R="group"!==s.type&&"invalidUser"!==s.type?s.value.email:void 0;return(0,j.jsx)(l().m,{placement:"top",renderTooltip:()=>function(e){const{tokenType:t,target:n,email:i}=e;return"guest"===t?(0,j.jsx)(u().sA,{defaultMessage:"{email} will be invited as a guest",id:"inviteTargetToken.guest.tooltip",values:{email:i}}):"spaceGuestDisabled"===t||"teamGuestDisabled"===t||"guestRequestRequired"===t?g:"invalidUser"===n.type?(0,j.jsx)(u().sA,{defaultMessage:"{text} is not a valid email",id:"inviteTargetToken.invalidUser.tooltip",values:{text:n.value.text}}):"verifiedDomain"===t&&"group"!==n.type?(0,j.jsx)(u().sA,{defaultMessage:"{email}{br}will automatically be added to the workspace{br}since @{domain} is an allowed email domain.",id:"inviteTargetToken.verifiedDomain.tooltip",values:{email:n.value.email,br:(0,j.jsx)("br",{}),domain:(0,T().zN)(n.value.email)}}):"group"===n.type?n.value.name||(0,j.jsx)(u().sA,{defaultMessage:"Untitled group",id:"inviteTargetToken.group.untitled"}):i}({tokenType:f,email:R,target:s}),render:t=>(0,j.jsx)("div",{style:c.tokenSpan,...t,children:(0,j.jsx)(n(881690).A,{isSingle:!1,format:v().A.isMobile?x().NY.Large:x().NY.Medium,showRemoveButton:e.showRemoveButton,onClickRemove:U,disabledFeedback:!0,value:P(f),style:h,shouldWrap:!1})})},E)};const C=function(e){const{flowId:t,store:i,disabled:s,placeholder:l,right:u,focus:p,hideIconColorAndTooltips:m,showEmptyError:g,origin:b,onFocus:S,onSubmit:x,onInputChanged:T}=e,I=(0,n(792485).S)(),w=(0,o().v3)(),A=(0,r().uB)(e.inviteTargetsStore,y().Ay),M=(0,r().K8)((()=>A.state.inviteTargets),[A]),_=(0,r().K8)((()=>A.state.tokenQuery),[A]),C=M.map((e=>{const t="newUser"===e.type?e.value.email:"invalidUser"===e.type?e.value.text:e.value.id;return(0,j.jsx)(k,{store:i,target:e,showRemoveButton:!0,tokenType:m?"member":void 0,onClickRemove:()=>h().S({inviteTargetsStore:A,targetToRemove:e})},t)})),P=(0,a().IS)((()=>({tokenInputMenuItem:{paddingTop:C.length>0?4:6,paddingInlineStart:4,paddingInlineEnd:4,paddingBottom:4,borderRadius:4,minHeight:32,...p&&{background:"none"},...s&&{background:d().Tj.inputBackground,color:d().Tj.text.secondary,fill:d().oZ.white,opacity:.4}},inputAndTokenWrapRight:{gap:2},inputInnerStyle:{paddingTop:0},warningMessage:{color:"#DE5550"}})),[p,s,C]);return(0,j.jsx)(f().Ay,{focus:p,focusAfterAnimation:!0,onClick:()=>{v().A.isMobile||null==S||S()},format:f().le.Share,value:_,onChange:e=>h().P({environment:w,event:e,pageContext:I,inviteTargetsStore:A,inviteOrigin:b,flowId:t,onInputChanged:T}),type:"email",tokens:C,disabled:s,autoComplete:"off",placeholder:l,onRemoveLastToken:()=>{A.setState({...A.state,inviteTargets:A.state.inviteTargets.slice(0,-1)})},right:u,showBorder:!0,inputStyle:P.inputInnerStyle,inputAndTokenWrapRightStyle:P.inputAndTokenWrapRight,style:P.tokenInputMenuItem,onSubmit:x,inputFullWidth:!0,message:(0,j.jsx)(n(381374).p,{invalidInvites:(0,c().oE)(M.map((e=>"invalidUser"===e.type?e:void 0))),showEmptyError:g,styles:P.warningMessage})})};var P=()=>n(454354),U=()=>n(980270),E=()=>n(875497),R=(n(16280),n(898992),n(354520),n(737550),()=>n(664594)),D=()=>n(983610),B=()=>n(160432),F=()=>n(302501),q=()=>n(68263),L=()=>n(542056),G=()=>n(133507),K=()=>n(15897),N=()=>n(499764),O=()=>n(637573),V=()=>n(789586),W=()=>n(519735);function z(e){const{store:t,sudoModeStore:n,personPropertyInviteStore:s,onInviteCompleteFn:a,inviteOrigin:d}=e,c=(0,o().v3)(),m=(0,R().T)(),g=Q(),v=(0,r().uB)(e.inviteTargetsStore,y().Ay),f=(0,r().K8)((()=>s.state.isLoading),[s]),h=(0,i.useCallback)((e=>{s.setState({...s.state,isLoading:e,focus:E().E.NoFocus})}),[s]),[S,x]=(0,i.useState)("member"),T=(0,r().K8)((()=>{const{emailMessage:e}=s.state;return e}),[s]),I=(0,r().K8)((()=>{const{role:e}=s.state;return e}),[s]),w=(0,u().tz)(),A=(0,r().K8)((()=>s.state.flowId),[s]),k=(0,r().K8)((()=>(0,b().f)(t)),[t]),C=(0,r().K8)((()=>t.canEditMembership()),[t]),P=(0,r().K8)((()=>(0,W().U1)({inviteTargetsStore:v})),[v]),B=(0,i.useCallback)((async()=>{await U().handleEnterPress({environment:c,inviteTargetsStore:v,personPropertyInviteStore:s,allowShowEmptyError:!0})}),[c,v,s]),F=(0,i.useCallback)((()=>{const e=(0,W().U1)({inviteTargetsStore:v}),t=e.filter((({type:e})=>"newUser"===e)).map((({value:e})=>e.email)),n=e.filter((({type:e})=>"existingUser"===e)).map((({value:e})=>e.id));return N().FC({environment:c,subscriptionData:D().subscriptionDataStoreInstance.state,newGuestIds:[...t,...n]})}),[v,c]),z=(0,r().K8)((()=>F()),[F]),Y=(0,r().O$)(D().subscriptionDataStoreInstance),Z=(0,O().r)()??0,X=(0,r().K8)((()=>N().LS(Y,Z)),[Z,Y]),ee=(0,M().A)(t),te=(0,r().K8)((()=>{if(ee.isGuestRequestRequired)return!1;const e=ee.isStoreInTeam&&!ee.teamAllowsGuests,t=!ee.isStoreInTeam&&!ee.spaceAllowsGuests||ee.isStoreInTeam&&!ee.teamAllowsGuests&&!ee.spaceAllowsGuests,n=P.some((e=>"newUser"===e.type||("existingUser"===e.type?"page_guest"===e.membershipType||"none"===e.membershipType:void 0)));return(e||t)&&n}),[P,ee]),ne=(0,r().K8)((()=>null==k?void 0:k.getRole()),[k]),ie=(0,r().K8)((()=>!(!ne||!(0,q().NB)(ne))&&!(!k||k.getDisableMembershipRequests())),[ne,k]),se=(0,V().P)({name:"members",spaceId:null==k?void 0:k.id,userId:m,amount:1}),oe=Boolean(se&&ne&&(0,q().vp)(ne));(0,i.useEffect)((()=>{x(oe?"member":"guest")}),[oe]);const re=(0,_().N)(t),ae=T.length>1e3,le=(0,i.useCallback)((e=>{const{response:t,shouldDoCompleteFn:n,invitedUserEmails:i,isRequestMember:s}=e;t.success?n&&(p().cI(c,{invited_user_count:i.length,is_success:t.success,can_add_member:oe,invite_option:S,origin:d,invite_flow_id:A}),U().showMessageForInviteComplete({success:t.success,invitedUserEmails:i,isRequestMember:s}),h(!1),a(t)):(U().showMessageForInviteComplete({success:t.success,invitedUserEmails:i}),p().cI(c,{invited_user_count:i.length,is_success:t.success,can_add_member:oe,invite_option:S,origin:d}))}),[a,A,h,c,S,oe,d]),ue=(0,i.useCallback)((async e=>{const{invitedUserEmails:i,shouldDoCompleteFn:s}=e;return await U().handleGuestInvite({environment:c,inviteOrigin:d,role:I,emailMessage:T,inviteTargetsStore:v,blockStore:t,sudoModeStore:n,flowId:A,onInviteComplete:e=>{le({response:e,shouldDoCompleteFn:s||!1,invitedUserEmails:i})}})}),[c,I,T,t,n,A,v,le,d]),de=(0,i.useCallback)((async e=>{const{invitedUserEmails:t,disable_invite_email:n,guestInviteResponse:i,shouldDoCompleteFn:s}=e;if(!k)return null;const o=null!=i&&i.success?i.invitedUsers:void 0;await U().handleMemberInvite({environment:c,spaceStore:k,flowId:A,onInviteComplete:e=>{le({response:e,shouldDoCompleteFn:s||!1,invitedUserEmails:t})},intl:w,invitedUsers:o,inviteTargetsStore:v,inviteOrigin:d,disable_invite_email:n})}),[k,c,A,v,w,le,d]),ce=(0,i.useCallback)((async e=>{const{invitedUserEmails:n,guestInviteResponse:i}=e;if(!k)return null;const s=null!=i&&i.success?i.invitedUsers:void 0;s&&await U().handleMemberRequest({environment:c,spaceStore:k,originType:"person_property_invite",intl:w,invitedUsers:s,reasonMessage:void 0,originId:t.id,flowId:A,onInviteComplete:e=>{le({response:e,shouldDoCompleteFn:!0,invitedUserEmails:n,isRequestMember:!0})},inviteOrigin:d})}),[c,A,k,w,le,t,d]),pe=(0,i.useCallback)((async()=>{const e="member"===S,t=v.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email));if(0===t.length)return void p().N_(c,{invite_stage:"click_invite_button",invite_flow_id:A,error:"No valid input emails"});const n=F();if(h(!0),e)if(n)await de({invitedUserEmails:t,disable_invite_email:!1,guestInviteResponse:void 0,shouldDoCompleteFn:!0});else{const e=!oe&&!ie,n=await ue({invitedUserEmails:t,shouldDoCompleteFn:e});oe?await de({invitedUserEmails:t,disable_invite_email:!0,guestInviteResponse:n,shouldDoCompleteFn:!0}):ie&&await ce({invitedUserEmails:t,guestInviteResponse:n})}else n?p().N_(c,{invite_stage:"click_invite_button",invite_flow_id:A,error:"Invite guest with guest limitation exceed"}):await ue({invitedUserEmails:t,shouldDoCompleteFn:!0});h(!1),v.reset()}),[c,oe,ie,S,A,F,v,ue,de,ce,h]),me=(0,i.useCallback)((async()=>{await B();const e=(0,W().U1)({inviteTargetsStore:v}).length;p().u$(c,{invited_user_count:e,invite_option:S,can_add_member:oe,origin:d,inviteTargets:v.state.inviteTargets.map((e=>e.type.toString())),inviteTokenQuery:v.state.tokenQuery,invite_flow_id:A}),await pe()}),[c,A,B,pe,S,oe,v,d]);let ge;ge=te?re:ae?(0,j.jsx)(u().sA,{id:"shareMenu.inviteButton.emailOverMaxLength.tooltip",defaultMessage:"Message exceeds the limit of 1000 characters."}):void 0;const ve=(0,i.useMemo)((()=>[{key:"member",render:()=>(0,j.jsx)(l().m,{disableTooltip:oe||ie,renderTooltip:()=>(0,j.jsx)(u().sA,{id:"invite.person_property.invite_member.tooltip",defaultMessage:"You do not have permission to add or request members to this workspace"}),render:e=>(0,j.jsx)($,{isSelected:"member"===S,inviteOption:"member",events:e})}),isDisabled:!oe&&!ie},{key:"guest",render:()=>(0,j.jsx)(l().m,{disableTooltip:!z&&X,renderTooltip:()=>(0,j.jsx)(G().j,{}),render:e=>(0,j.jsx)($,{isSelected:"guest"===S,inviteOption:"guest",events:e})})}]),[S,z,X,ie,oe]);return(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,j.jsx)("div",{style:g.section,children:(0,j.jsx)(K().A,{items:ve,itemStyle:g.itemStyle,innerStyle:g.innerStyle,value:S,onChange:e=>{x(e),p().ZZ(c,{invite_option:e,invite_flow_id:A,origin:d})}})}),!z&&X||"guest"!==S?(0,j.jsx)(H,{tooltip:ge,disabled:!C||te||ae,onClick:me,isLoading:f}):(0,j.jsx)(J,{onClick:()=>{p().j$(c,{invited_user_count:P.length,invite_flow_id:A,origin:d}),L().D6({environment:c,upgradeButtonName:"user_permission_item",spaceStore:k})}})]})}function J(e){const{onClick:t}=e;return(0,j.jsx)(l().m,{disableTooltip:!1,renderTooltip:()=>(0,j.jsx)(G().j,{}),render:e=>(0,j.jsx)(B().A,{colorPalette:"blue",size:"lg",style:{marginTop:0,marginInlineEnd:16,marginBottom:16,marginInlineStart:16,borderRadius:6},onClick:t,...e,children:(0,j.jsx)(u().sA,{id:"invite.person_property.upgrade",defaultMessage:"Upgrade"})})})}function H(e){const{tooltip:t,disabled:n,onClick:i,isLoading:s}=e;return(0,j.jsx)(l().m,{disableTooltip:!Boolean(t),renderTooltip:()=>t,render:e=>(0,j.jsx)(B().A,{colorPalette:"blue",size:"lg",style:{marginTop:0,marginInlineEnd:16,marginBottom:16,marginInlineStart:16,borderRadius:6},disabled:n,onClick:i,...e,isLoading:s,children:(0,j.jsx)(u().sA,{id:"invite.person_property.invite",defaultMessage:"Invite"})})})}function $(e){const{isSelected:t,inviteOption:n,events:i}=e,s=Q(),o=t?s.mainTextSelected:s.mainTextUnselected;let r,a;switch(n){case"guest":r=(0,j.jsx)(u().sA,{id:"invite.person_property.addAsGuest.title",defaultMessage:"Add to page only"}),a=(0,j.jsx)(u().sA,{id:"invite.person_property.addAsGuest.subtitle",defaultMessage:"Invite as a Guest"});break;case"member":r=(0,j.jsx)(u().sA,{id:"invite.person_property.addAsMember.title",defaultMessage:"Add to Workspace"}),a=(0,j.jsx)(u().sA,{id:"invite.person_property.addAsMember.subtitle",defaultMessage:"Invite and bill as a Member"});break;default:throw new Error(`Unsupported invite option: ${n}`)}return(0,j.jsx)("div",{style:s.row,...i,children:(0,j.jsxs)("div",{style:o,children:[r,(0,j.jsx)(F().A,{isSmall:!0,style:s.optionSubtitle,children:a})]})})}function Q(){return(0,a().IS)((()=>({mainTextSelected:{fontWeight:w().Wy.medium,color:d().Tj.text.primary,fontSize:14,lineHeight:"14px"},mainTextUnselected:{color:d().Tj.text.secondary,fontSize:14,lineHeight:"14px"},row:{display:"flex",alignItems:"center",justifyContent:"center",gap:4,lineHeight:"14px"},section:{paddingTop:16,paddingInlineEnd:11,paddingBottom:16,paddingInlineStart:11},itemStyle:{margin:5,borderRadius:8,borderWidth:2},innerStyle:{borderWidth:0},optionSubtitle:{whiteSpace:"pre-wrap",paddingTop:2,fontSize:12}})),[])}var Y=()=>n(695115),Z=()=>n(62900),X=()=>n(340498);function ee({handleBackButtonClick:e}){const t=(0,a().IS)((()=>({container:{display:"flex",margin:"0 12px 0px",height:40}})),[]);return(0,j.jsx)("div",{style:t.container,children:(0,j.jsx)(te,{onClick:e})})}function te(e){const{onClick:t}=e,n=(0,u().tz)(),i=(0,a().IS)((()=>({topContainer:{display:"flex",alignItems:"center",width:"max-content"},iconButton:{marginInlineEnd:6,height:24,width:24},arrowIcon:{height:X().Ev.sm,width:X().Ev.sm},sendInviteLabel:{fontWeight:w().Wy.medium}})),[]);return(0,j.jsxs)("div",{style:i.topContainer,children:[(0,j.jsx)(Y().A,{icon:Z().arrowStraightLeftSmallIcon,iconStyle:i.arrowIcon,style:i.iconButton,onClick:t,ariaLabel:n.formatMessage({id:"shareMenu.backButton.iconButton",defaultMessage:"Go back to main share menu."})}),(0,j.jsx)(F().A,{style:i.sendInviteLabel,children:(0,j.jsx)(u().sA,{id:"invite.person_property.popup_title",defaultMessage:"Invite and mention"})})]})}var ne=()=>n(31511),ie=()=>n(456328),se=()=>n(250064);const oe=c().sg((({environment:e,flowId:t,origin:n})=>{p().IT(e,{origin:n,invite_flow_id:t})}),1e3);function re(e){const{inviteTargetsStore:t,personPropertyInviteStore:n,inviteOrigin:s}=e,a=(0,o().v3)(),{focus:l,emailMessage:u}=(0,r().K8)((()=>{const{focus:e,emailMessage:t}=n.state;return{focus:e,emailMessage:t}}),[n]),d=(0,r().K8)((()=>n.state.flowId),[n]),c=(0,i.useCallback)((()=>{t.reset()}),[t]),p=(0,i.useCallback)((e=>{n.setState({...n.state,focus:l,emailMessage:e.target.value}),oe({environment:a,flowId:d,origin:s})}),[a,n,d,s,l]),m=(0,i.useCallback)((()=>{c()}),[c]),g=(0,i.useCallback)((()=>{n.setState({...n.state,focus:E().E.MessageInput,emailMessage:u})}),[n,u]);return(0,j.jsx)(ae,{focus:l===E().E.MessageInput,value:u,onFocus:g,onChange:p,onCancel:m,maxLength:1e3,inviteTargetsStore:t})}function ae(e){const{focus:t,value:n,maxLength:i,inviteTargetsStore:s,onFocus:o,onChange:l,onCancel:c}=e,p=(0,u().tz)(),m=n.length/i>=.8,g=(0,ie().BS)(n),f=m||g,y=(0,a().IS)((()=>({container:{maxHeight:80,bottom:0,paddingTop:2,paddingInlineEnd:16,paddingBottom:2,paddingInlineStart:16,backgroundColor:d().Tj.background.elevated,pointerEvents:"all",transitionProperty:"max-height",transitionDuration:"0.3s",overflow:"hidden",zIndex:1,height:72},input:{maxHeight:80,borderTop:1,borderTopStyle:"solid",borderTopColor:d().Tj.border.secondaryTranslucent,padding:2,fontSize:14,transitionProperty:"max-height",transitionDuration:"0.3s",height:"100%"},inputBox:{paddingTop:0,paddingInlineEnd:4,paddingBottom:0,paddingInlineStart:4,boxShadow:d().Tj.inputBoxShadow,background:d().Tj.inputBackground,width:"auto",height:"100%",borderRadius:6,...t&&{background:"none",boxShadow:d().Tj.inputBlueFocusRing}}})),[t]),h=(0,r().K8)((()=>s.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email))),[s]),b=(0,r().K8)((()=>h.length>0?p.formatMessage({id:"invite.person_property.emailMessageInput.placeholder.withEmails",defaultMessage:"Add a message for {users}"},{users:(0,se().l)(h)}):p.formatMessage({id:"invite.person_property.emailMessageInput.placeholder.noEmails",defaultMessage:"Add a message to your invite..."})),[p,h]);return(0,j.jsxs)("div",{style:y.container,children:[f?(0,j.jsx)(le,{value:n,maxLength:i,shouldShowLengthWarning:m,shouldShowLinkWarning:g}):void 0,(0,j.jsx)(ne().A,{textarea:!0,focusInitial:!1,format:"transparent",placeholder:b,maxlength:i,focus:t,value:n,onFocus:o,onChange:l,inputStyle:y.input,onCancel:c,style:y.inputBox,onClick:()=>{v().A.isMobile||null==o||o()}})]})}function le(e){const{shouldShowLengthWarning:t,shouldShowLinkWarning:n,value:i,maxLength:s}=e,o=(0,a().IS)((()=>({container:{position:"absolute",top:0,display:"flex",justifyContent:"center",fontSize:12,color:d().Tj.text.tertiary,width:"100%"},warning:{display:"flex",justifyContent:"center",width:"calc(100% - 36px)",backgroundColor:d().Tj.background.elevated,marginTop:1}})),[]);return(0,j.jsx)("div",{style:o.container,children:(0,j.jsxs)("div",{style:o.warning,children:[t?(0,j.jsx)(u().sA,{defaultMessage:"{characters} / {maxCharacters} characters",id:"ContextualInvite.permissions_invites.messageLengthWarning",values:{characters:i.length,maxCharacters:s}}):void 0,t&&n?" · ":void 0,n?(0,j.jsx)(u().sA,{defaultMessage:"Links will be omitted from your message",id:"ContextualInvite.permissions_invites.removeLinkWarning"}):void 0]})})}function ue(e){const{store:t,handleBackButtonClick:n,onInviteCompleteFn:l,inviteTargetsStore:u,personPropertyInviteStore:d,inviteOrigin:p}=e,m=(0,r().uB)(void 0,P().A),g=(0,o().v3)(),v=(0,i.useCallback)((async()=>{await U().handleEnterPress({environment:g,inviteTargetsStore:u,personPropertyInviteStore:d,allowShowEmptyError:!1})}),[g,u,d]),f=(0,a().IS)((()=>({container:{position:"relative",width:450,transition:"all",transitionDuration:"0.3s",display:"flex",flexDirection:"column",maxHeight:500},searchBar:{paddingInlineStart:16,paddingInlineEnd:16,paddingBottom:16,paddingTop:16},horizontalLine:{margin:"0",color:"#E3E2E0",opacity:.3}})),[]);return(0,j.jsx)(s().N,{debugName:"PersonPropertyInvitePopup",capture:!0,onLeft:c().D_,onRight:c().D_,onSelectAll:c().D_,onRedo:c().D_,onUndo:c().D_,onCut:c().D_,onCopy:c().D_,onPaste:c().D_,onKeypress:c().D_,onDelete:c().D_,onBackspace:c().D_,onTab:c().D_,onEnter:v,children:(0,j.jsxs)("div",{style:f.container,children:[(0,j.jsx)(ee,{handleBackButtonClick:n}),(0,j.jsx)("hr",{style:f.horizontalLine}),(0,j.jsx)("div",{style:f.searchBar,children:(0,j.jsx)(de,{store:t,inviteTargetsStore:u,personPropertyInviteStore:d,inviteOrigin:p})}),(0,j.jsx)(re,{store:t,inviteTargetsStore:u,personPropertyInviteStore:d,inviteOrigin:p}),(0,j.jsx)("div",{children:(0,j.jsx)(z,{store:t,inviteTargetsStore:u,sudoModeStore:m,onInviteCompleteFn:l,personPropertyInviteStore:d,inviteOrigin:p})})]})})}function de(e){const{store:t,personPropertyInviteStore:n,inviteOrigin:i}=e,s=(0,u().tz)(),c=(0,o().v3)(),v=(0,r().uB)(e.inviteTargetsStore,y().Ay),f=(0,r().K8)((()=>t.getSpaceStore()),[t]),h=(0,g().A)(f),{focus:b,emailMessage:S}=(0,r().K8)((()=>{const{focus:e,emailMessage:t}=n.state;return{focus:e,emailMessage:t}}),[n]),{role:x,showEmptyError:T}=(0,r().K8)((()=>{const{role:e,showEmptyError:t}=n.state;return{role:e,showEmptyError:t}}),[n]),I=(0,r().K8)((()=>t.getType()),[t]),w=(0,r().K8)((()=>n.state.flowId),[n]),A=(0,r().K8)((()=>t.canEditMembership()),[t]),M=(0,a().IS)((()=>({permissionsRoleSelectButton:{display:"flex",whiteSpace:"nowrap",height:20,margin:0,borderRadius:4,color:d().oZ.uiGray}})),[]);return f&&h?(0,j.jsx)(l().m,{disableTooltip:A,renderTooltip:()=>{if(!A)return(0,j.jsx)(u().sA,{id:"shareMenu.inviteButton.fullAccessOnlyMessage.tooltip",defaultMessage:"Only those with full access can add people."})},render:e=>(0,j.jsx)("div",{style:{display:"flex"},...e,children:(0,j.jsx)(C,{inviteTargetsStore:v,store:f,disabled:!A,origin:i,flowId:w,focus:b===E().E.InviteInput,showEmptyError:T,onFocus:()=>{n.setState({...n.state,focus:E().E.InviteInput,emailMessage:S||""})},placeholder:s.formatMessage({id:"invite.person_property.inviteTargetsInput.placeholder",defaultMessage:"Add emails..."}),onInputChanged:()=>n.setState({...n.state,showEmptyError:!1}),right:(0,j.jsx)(m().Ay,{spaceStore:f,disabled:!A,role:x,table:"block",type:"user_permission",blockType:I,isInvite:!0,upgradeButtonName:"invite_permission_block",buttonStyle:M.permissionsRoleSelectButton,isMenuItem:!1,onChange:e=>{n.setState({...n.state,role:e}),p().et(c,{invited_role:e,invite_flow_id:w,origin:i})}})})})}):null}},744419:(e,t,n)=>{n.d(t,{RW:()=>u,bV:()=>l,nR:()=>d});var i=()=>n(513416),s=()=>n(686504),o=()=>n(252833),r=()=>n(769864),a=()=>n(664133);async function l({environment:e,blockPointer:t,query:n}){const s=await r().callApi({eventName:"getExternalUsersForSyncedCollection",environment:e,data:{blockPointer:t,query:n}});return(0,i().kX)(s)?[]:"success"===s.type?s.data.externalUsers:[]}async function u({environment:e,externalUser:t,blockPointer:n,externalSyncedCollectionType:s}){const a=await r().callApi({eventName:"getOrCreateNotionUserFromExternalUser",environment:e,data:{externalUser:(0,o().Vz)(t,s),blockPointer:n}});if(!(0,i().kX)(a))return"success"===a.type?a.data.notionUser:void 0}async function d({environment:e,blockStore:t,collectionStore:n}){if(!t||!n)return null;const i=(0,s().ot)({collectionStore:n,blockStore:t}).collectionType;return i&&"Jira"===i?await a().Sl({environment:e,blockStore:t,collectionStore:n}):null}},854212:(e,t,n)=>{n.d(t,{Y:()=>M,z:()=>_});n(898992),n(354520),n(581454),n(296540);var i=()=>n(664594),s=()=>n(300474),o=()=>n(590526),r=()=>n(401497),a=()=>n(874832),l=()=>n(81068),u=()=>n(449279),d=()=>n(663639),c=()=>n(736847),p=()=>n(764880),m=()=>n(437607),g=()=>n(798880),v=()=>n(69708),f=()=>n(496603),y=()=>n(744419),h=()=>n(993854),b=()=>n(267584),S=()=>n(106628),x=()=>n(666803),T=()=>n(528093),I=()=>n(453697),w=n(474848);function A({width:e}){const t=(0,r().IS)((()=>({row:{display:"flex",alignItems:"center",gap:8,padding:"8px 0",width:"100%"},avatar:{width:20,height:20,borderRadius:6},primary:{height:12,borderRadius:6,width:e},secondary:{height:10,borderRadius:6,width:"35%",marginTop:6},text:{flex:1}})),[e]);return(0,w.jsxs)("div",{style:t.row,children:[(0,w.jsx)(a().P,{style:t.avatar}),(0,w.jsxs)("div",{style:t.text,children:[(0,w.jsx)(a().P,{style:t.primary}),(0,w.jsx)(a().P,{style:t.secondary})]})]})}function M({environment:e,intl:t,store:n,isSyncedCollection:i,inputValue:s,value:o,surface:r,propertySchema:a,handlePersonPropertyMenuAddMentions:x,sectionMenuTitle:T,externalSyncedCollectionType:M,onDismiss:_,tokenLimit:j}){return{...{request:{query:s,actorPointers:o.filter(p().Pu),groupPointers:o.filter((e=>"string"!=typeof e&&(0,m().I6)(e)))},performRequest:async({query:t,actorPointers:i,groupPointers:s})=>({externalUsers:await y().bV({environment:e,blockPointer:n.pointer,query:t}),type:"externalUsers"}),render:(r,a,p)=>{if(r)return(0,w.jsx)(c().A,{title:T,loading:!p,children:(0,w.jsx)(u().u,{title:(0,w.jsx)(v().sA,{...h().Qg.searchErrorMessage})})});if(a&&"externalUsers"!==a.type)return(0,w.jsx)(c().A,{title:T,loading:!p,children:(0,w.jsx)(u().u,{title:(0,w.jsx)(v().sA,{...h().Qg.searchErrorMessage})})});const m=f().oE((a&&a.externalUsers||[]).map((s=>{const r=(0,w.jsx)(I().A,{avatar:{email:s.emailAddress,avatarUrl:"",name:s.displayName}});return{key:s.accountId,render:e=>(0,w.jsx)(l().A,{...e,title:s.displayName,caption:s.emailAddress,icon:r}),action:async()=>{await(async s=>{if(i&&s.emailAddress){const i=await S().T.searchActions.load(),o=await i.searchSpaceActors({environment:e,query:s.emailAddress,membersOnly:!1,userLocale:t.locale,limit:1});if(1===o.users.length)x([{table:g().oo,id:o.users[0].id}]);else{const t=await y().RW({environment:e,externalUser:s,blockPointer:n.pointer,externalSyncedCollectionType:M});t&&x([{table:g().oo,id:t.id}])}}})(s),(!j||j&&o.length>=j)&&_()}}}))),k=p?[]:b().eg.map(((e,t)=>({key:`external-user-shimmer-${String(e)}-${t}`,action:()=>{},render:t=>(0,w.jsx)(l().A,{...t,disabled:!0,disabledFeedback:!1,focused:!1,title:(0,w.jsx)(A,{width:e})})}))),C=f().oE([m.length>0||!p?{key:"external user section",render:e=>(0,w.jsx)(c().A,{...e,title:(0,w.jsx)(v().sA,{defaultMessage:"Select user from Jira",id:"database.personPropertyValue.externalUsers.searchPlaceholder"})}),items:[...m,...k]}:void 0]);return(0,w.jsx)(d().A,{type:d().O.Vertical,initialFocus:s.length>0?0:void 0,sections:C})}}}}function _(){const e=(0,s().r)(),t=(0,i().T)(),n=(0,o().K8)((()=>x().Ay.state.instanceValue),[])===x().cK.DataCenter?"collection_synced_database_jira_datacenter":"collection_synced_database_jira";return(0,T()._)({name:n,spaceId:e,userId:t})}},865342:(e,t,n)=>{n.d(t,{Z:()=>d});n(296540);var i=()=>n(807449),s=()=>n(651124),o=()=>n(529099),r=()=>n(534177),a=()=>n(756123),l=()=>n(854672),u=n(474848);function d(e){const{icon:t,size:n=18}=e;if(!t)return(0,u.jsx)(i().I,{icon:o().aiFaceIcon,size:n});const d=(0,s().WO)(t);if(!d)return(0,u.jsx)(i().I,{icon:o().aiFaceIcon,size:n});switch(d.type){case"unicode_emoji":return(0,u.jsx)(a().A,{size:n,emoji:d.emoji.unicode,disableShrinking:!0});case"notion_icon":case"app_package_asset":return(0,u.jsx)(l().A,{type:d.type,size:n,icon:t,alt:"bot icon",isLoading:!1,progressPercent:0});case"custom_emoji":case"url":return(0,u.jsx)("img",{src:t,alt:"bot icon",style:{width:n,height:n,objectFit:"cover",borderRadius:2}});default:return(0,r().HB)(d)}}},875497:(e,t,n)=>{n.d(t,{A:()=>o,E:()=>i});let i=function(e){return e.InviteInput="invite_input",e.MessageInput="message_input",e.NoFocus="no_focus",e}({});class s extends(()=>n(757695))().Store{getInitialState(){return{flowId:n(206267).JW(),role:"editor",focus:i.InviteInput,emailMessage:"",isLoading:!1,showEmptyError:!1}}}const o=s},980270:(e,t,n)=>{n.r(t),n.d(t,{handleEnterPress:()=>M,handleGuestInvite:()=>I,handleMemberInvite:()=>T,handleMemberRequest:()=>w,handlePopupClickWithEmail:()=>_,inviteToSpaceAsMembers:()=>A,showMessageForInviteComplete:()=>j});n(944114),n(898992),n(354520),n(430670),n(581454),n(737550),n(296540);var i=()=>n(128933),s=()=>n(483226),o=()=>n(842599),r=()=>n(165358),a=()=>n(206267),l=()=>n(68263),u=()=>n(69708),d=()=>n(319625),c=()=>n(229833),p=()=>n(966505),m=()=>n(769864),g=()=>n(579627),v=()=>n(542056),f=()=>n(250064),y=()=>n(499764),h=()=>n(134217),b=()=>n(475355),S=()=>n(519735),x=n(474848);async function T(e){const{environment:t,onInviteComplete:n,flowId:i,intl:s,spaceStore:o,invitedUsers:a,inviteTargetsStore:l,inviteOrigin:u,disable_invite_email:m}=e;let g={success:!1};try{g=await A({environment:t,spaceStore:o,invitedUsers:a,from:u,flowId:i,intl:s,inviteTargetsStore:l,disable_invite_email:m}),g.success?p().ke(t,{invited_user_count:Object.keys(g.invitedUsers).length,invite_flow_id:i,origin:u}):(p().N_(t,{invite_stage:"invite_member",invite_flow_id:i,error:g.error}),r().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite"}))}catch(v){const e=(0,d().A)(v);p().N_(t,{invite_stage:"invite_member",invite_flow_id:i,error:e}),r().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite",error:(0,c().convertErrorToLog)(v)})}finally{null==n||n(g)}}async function I(e){const{environment:t,blockStore:n,inviteTargetsStore:i,sudoModeStore:s,onInviteComplete:u,inviteOrigin:m,role:v,emailMessage:f,flowId:h}=e;let b={success:!1};try{if(b=await async function(e){const{environment:t,blockStore:n,sudoModeStore:i,inviteTargetsStore:s,role:r,inviteOrigin:u,emailMessage:d,onInviteStart:c}=e,p=e.flowId||a().JW();if(!(0,l().PW)(r))return{success:!1};const{tokenQuery:m,inviteTargets:v}=s.state;if((0,o().DT)(m.trim())&&0===v.length){const e={type:"newUser",value:{email:m.trim()},source:"email"};S().P4({target:e,inviteTargetsStore:s})||s.setState({inviteTargets:[...s.state.inviteTargets,e],tokenQuery:""})}const f=y().Nr(n,S().U1({inviteTargetsStore:s}));null==c||c();const h=await g().eP({environment:t,store:n,sudoModeStore:i,inviteTargets:f,inviteRole:r,isOnboarding:!1,invite:{inviteFlowId:p,inviteMessage:d,inviteOrigin:u}});return h}({environment:t,blockStore:n,sudoModeStore:s,inviteTargetsStore:i,role:v,emailMessage:f,inviteOrigin:m,flowId:h}),!b.success)return}catch(x){const e=(0,d().A)(x);p().N_(t,{invite_stage:"invite_guest",invite_flow_id:h,error:e}),r().log({level:"error",from:"personPropertyInviteAction",type:"handleGuestInvite",error:(0,c().convertErrorToLog)(x)})}finally{b.success&&p().oU(t,{invited_user_count:Object.keys(b.invitedUsers).length,origin:m,invite_flow_id:h}),null==u||u(b)}return b}async function w(e){const{environment:t,spaceStore:n,originId:s,originType:o,reasonMessage:a,intl:l,flowId:u,onInviteComplete:c,invitedUsers:g,inviteOrigin:v}=e,y=[];let h={success:!1};try{const e=Object.entries(g).map((([e,i])=>m().callApi({eventName:"requestAccess",environment:t,data:{type:"actor-to-space",forActorId:i,spaceId:n.id,message:a,attributes:{origin_id:s,origin_type:o,origin_table:"block",add_permissions_on_approval:!1}}}).catch((()=>y.push([e,i])))));await Promise.all(e),h={success:!0,invitedUsers:g,requestedUsers:{}}}catch(b){const e=(0,d().A)(b);return p().N_(t,{invite_stage:"request_member",invite_flow_id:u,error:e}),function(e,t){const n=Object.keys(t);if(0===n.length)return;i().D6({label:e.formatMessage({id:"contextual_invite.request_members_failure",defaultMessage:"Failed to request {users} to become members"},{users:(0,f().l)(n)})})}(l,g),r().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberRequest",data:{miscDataToConvertToString:{inviteTargetEmailsWithErrors:y}}}),h}finally{h.success&&p().d6(t,{invited_user_count:Object.keys(h.invitedUsers).length,origin:v,invite_flow_id:u}),null==c||c(h)}return h}async function A(e){const{environment:t,spaceStore:n,from:o,invitedUsers:a,intl:l,flowId:u,onInviteStart:d,inviteTargetsStore:c,disable_invite_email:p}=e,m=function(e){const t=[];if(!e)return t;for(const[n,i]of Object.entries(e))t.push({type:"existingUser",value:{id:i,email:n,version:1}});return t}(a),v=function(e){return e.state.inviteTargets.filter((e=>"newUser"===e.type))}(c).filter((e=>!m.some((t=>t.value.email===e.value.email)))),y=[...m,...v],S=(0,s().AI)(),x=S&&(0,h().fk)(S)?"owner":"member";let T={success:!1};if(!n.isTeamsEnabled()){if(!(await b().oH({environment:t,flowId:u,trackCreateTeamComplete:!1})))return T}try{null==d||d(),T=await g().cl({spaceStore:n,environment:t,inviteTargets:y.map((e=>({...e,membershipType:x}))),isOnboarding:!1,invite:{inviteOrigin:o,inviteFlowId:u,disable_invite_email:p}})}catch(I){return function(e,t){0!==t.length&&i().D6({label:e.formatMessage({id:"contextual_invite.contextual_invite_failure",defaultMessage:"{userCount, plural, one {Failed to invite {users} as member} other {Failed to invite {users} as members}}"},{users:(0,f().l)(t.flatMap((e=>e.value.email||[]))),userCount:t.length})})}(l,y),r().log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.inviteTargets",data:{miscDataToConvertToString:{usersToInviteAsMembers:y}}}),T}return T}async function M(e){const{environment:t,inviteTargetsStore:n,allowShowEmptyError:i,personPropertyInviteStore:s}=e,r=n.state.tokenQuery;if(""===r)return void(0===n.state.inviteTargets.length&&i&&s.setState({...s.state,showEmptyError:!0}));const a=(0,o().C3)(r),l=await v().Ah(t,a);let u=[];0===l.length&&(u=[{type:"invalidUser",value:{text:r}}]);const d=l.filter((e=>!S().P4({inviteTargetsStore:n,target:e}))),c=[...n.state.inviteTargets,...d,...u];n.setState({...n.state,inviteTargets:c,tokenQuery:""})}function _(e){const{email:t,inviteTargetsStore:n}=e,i={type:"newUser",value:{email:t},source:"email"},s=[...n.state.inviteTargets];S().P4({inviteTargetsStore:n,target:i})||s.push(i),n.setState({...n.state,inviteTargets:s})}function j(e){const{success:t,invitedUserEmails:n,isRequestMember:s}=e;t?0!==n.length&&(s?i().D6({label:(0,x.jsx)(u().sA,{id:"shareMenu.inviteSuccess.snackbarMessage.sendMemberRequest",defaultMessage:"Successfully sent request to admin to invite {users}",values:{users:(0,f().l)(n)}})}):i().D6({label:(0,x.jsx)(u().sA,{id:"shareMenu.inviteSuccess.snackbarMessage",defaultMessage:"Successfully invited {users}",values:{users:(0,f().l)(n)}})})):i().D6({label:(0,x.jsx)(u().sA,{id:"shareMenu.inviteFailure.snackbarMessage",defaultMessage:"Failed to invite {users}",values:{users:(0,f().l)(n)}})})}},993854:(e,t,n)=>{n.d(t,{gw:()=>ue,Qg:()=>le});n(944114),n(898992),n(354520),n(581454),n(737550);var i=n(296540),s=()=>n(230711),o=()=>n(59226),r=()=>n(726637),a=()=>n(484714),l=()=>n(590526),u=()=>n(401497),d=()=>n(929219),c=()=>n(128933),p=()=>n(245720),m=()=>n(546926),g=()=>n(352321),v=()=>n(26697),f=()=>n(890492),y=()=>n(81068),h=()=>n(449279),b=()=>n(663639),S=()=>n(736847),x=()=>n(764880),T=()=>n(31503),I=()=>n(824862),w=()=>n(437607),A=()=>n(798880),M=()=>n(201980),_=()=>n(173979),j=()=>n(69708),k=()=>n(496603),C=()=>n(534177),P=()=>n(877750),U=()=>n(515872),E=()=>n(88661),R=()=>n(251126),D=()=>n(313171),B=()=>n(448693),F=()=>n(27356),q=()=>n(862139),L=()=>n(854212),G=()=>n(635455),K=()=>n(457688),N=()=>n(486674),O=()=>n(267584),V=()=>n(135168),W=()=>n(483226),z=()=>n(250910),J=()=>n(807449),H=()=>n(842599),$=()=>n(906380),Q=()=>n(97835),Y=()=>n(100622),Z=()=>n(966505),X=()=>n(811979),ee=()=>n(980270),te=()=>n(114871),ne=()=>n(875497),ie=()=>n(690490),se=n(474848);function oe(e){const t=(0,l().uB)(void 0,te().Ay),n=(0,l().uB)(void 0,ne().A),{store:s,inputValue:o,intl:d,propertySchemaLimit:c,isLoading:p,handlePersonPropertyMenuChange:m,surface:g}=e,v=(0,a().v3)(),f=(0,u().IS)((()=>({moreBarTitleStyle:{color:Y().Tj.text.secondary,fontSize:11},desktopTitleStyle:{color:Y().Tj.text.secondary,fontSize:11},messageBodyStyle:{color:Y().Tj.text.tertiary,paddingInlineStart:2},messageTitleStyle:{color:Y().Tj.text.tertiary},inviteBodyStyle:{color:Y().Tj.text.primary}})),[]),b=(0,l().K8)((()=>{var e;return null===(e=(0,V().f)(s))||void 0===e?void 0:e.getName()}),[s]),x=(0,l().K8)((()=>n.state.flowId),[n]),{email:T,isEmail:I,inviteButtonTitle:w}=(0,i.useMemo)((()=>{const e=(0,H().qh)(o),t=(0,H().DT)(e),n=d.formatMessage({id:"invite.person_property.button.invite_people",defaultMessage:"Invite people"}),i=d.formatMessage({id:"invite.person_property.button.invite_email",defaultMessage:"Invite ”{email}”"},{email:e});return{email:e,isEmail:t,inviteButtonTitle:t?i:n}}),[o,d]),M=(0,i.useCallback)((()=>{I&&T&&ee().handlePopupClickWithEmail({email:T,inviteTargetsStore:t}),Z().TS(v,{origin:"person_property_invite",invite_flow_id:x})}),[I,x,T,v,t]),_=(0,i.useCallback)((()=>{Z().F$(v,{origin:"person_property_invite",invite_flow_id:x})}),[x,v]),k=(0,l().K8)((()=>{const e=function(e){const{canAddPermissions:t,isMobile:n,surface:i}=e,s="enterprise"===e.subscriptionTier;if(n||s||!t||(0,U().J)(i))return!1;return!0}({canAddPermissions:s.canEditMembership(),isMobile:r().A.isMobile,subscriptionTier:(0,W().AI)(),surface:g});return e&&Z().HJ(v,{origin:"person_property_invite",invite_flow_id:x}),e}),[s,x,v,g]),C=(0,l().K8)((()=>{if(!(0,U().J)(g))return(0,E().j)(c)}),[g,c]);return k?(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(S().A,{title:(0,se.jsx)(j().sA,{defaultMessage:"People",id:"database.personPropertyValue.selectPerson.noSearchResults.resultsTitle"}),desktopTitleStyle:f.desktopTitleStyle,loading:p,desktopStyle:{paddingBottom:4},children:(0,se.jsx)(h().u,{title:(0,se.jsx)("span",{style:f.messageBodyStyle,children:(0,se.jsx)(j().sA,{defaultMessage:"No matches in {spaceName}",id:"database.personPropertyMenu.noSearchResults.messageWithSpaceName",values:{spaceName:b}})}),titleStyle:f.messageTitleStyle})}),(0,se.jsx)(S().A,{title:(0,se.jsx)(j().sA,{defaultMessage:"More",id:"database.personPropertyValue.selectPerson.noSearchResults.suggestionTitle"}),desktopTitleStyle:f.moreBarTitleStyle,topBorder:!0,desktopStyle:{marginTop:0,paddingTop:10},children:(0,se.jsx)(X().A,{focused:!1,stopClickPropagation:!0,popupType:z().z.Popup,renderOrigin:e=>(0,se.jsx)(y().A,{...e,focused:!1,icon:(0,se.jsx)(J().I,{icon:Q().inviteMemberIcon,colorVariant:"primary"}),title:w,right:(0,se.jsx)(J().I,{icon:$().arrowChevronSingleRightSmallIcon,size:"sm",colorVariant:"secondary"}),textWrapperStyle:f.inviteBodyStyle}),onClick:M,onClose:_,borderRadius:8,render:e=>(0,se.jsx)(ie().i,{inviteOrigin:"person_property_invite",store:s,handleBackButtonClick:()=>e.close(),inviteTargetsStore:t,personPropertyInviteStore:n,onInviteCompleteFn:t=>{e.close();const n=(t.success?Object.values(t.invitedUsers):[]).map((e=>({table:A().oo,id:e})));m(n)}})})})]}):(0,se.jsx)(S().A,{title:C,loading:p,children:(0,se.jsx)(h().u,{title:(0,se.jsx)(j().sA,{defaultMessage:"No results",id:"database.personPropertyMenu.noSearchResults.message"})})})}var re=()=>n(838364),ae=()=>n(106628);const le=(0,j().YK)({searchForPeopleOrGroups:{defaultMessage:"Search for people or groups…",id:"database.personPropertyValue.searchPlaceholderPeopleOrGroups"},searchErrorMessage:{defaultMessage:"Something went wrong.",id:"database.personPropertyMenu.searchErrorMessage"},searchOfflineErrorMessage:{defaultMessage:"Unavailable offline.",id:"database.personPropertyMenu.searchOfflineErrorMessage"}});function ue(e){const t=(0,a().v3)(),n=(0,j().tz)(),{disabled:s,value:u,surface:g,valueIsUnpersistedDefaultValue:D,onChange:V,propertySchema:W,parentStore:z,isTemplatePage:J,insertChar:H,formQuestionStore:$,collectionStore:Q,showDoneButton:Y,onDismiss:Z}=e,X=(0,l().K8)((()=>z.getSpaceStore()),[z]),[ee,te]=(0,i.useState)((()=>H||"")),ne=(0,l().K8)((()=>{if(!(0,U().J)(g))return(0,E().j)(W.limit)}),[g,W.limit]),ie=(0,l().K8)((()=>{const e=W.limit;return(0,U().J)(g)&&$?(0,T().hm)(W,$.getModel()):e}),[$,g,W]),ue=(0,i.useCallback)((e=>{!function({newMentions:e,tokenLimit:t,value:n,valueIsUnpersistedDefaultValue:i,onChange:s}){1===t&&e.length>0?s({type:"personPropertyMenuUpdateReplacePerson",newValue:e[0]}):void 0===t?s(i?{type:"personPropertyMenuUpdateAddPerson",newValues:[...n,...e]}:{type:"personPropertyMenuUpdateAddPerson",newValues:e}):e.length+n.length<=t&&s({type:"personPropertyMenuUpdateAddPerson",newValues:e})}({newMentions:e,tokenLimit:ie,value:u,valueIsUnpersistedDefaultValue:D,onChange:V}),te("")}),[V,ie,u,D]),{tokens:pe,selectedTemplateAnnotationVariables:me}=(0,l().K8)((()=>{const e=[];return{tokens:u.map((t=>{if((0,M().MMZ)(t))return e.push(t),(0,se.jsx)(P().W,{templateVariableType:t,showRemoveButton:!s,onRemove:()=>{V({type:"personPropertyMenuUpdateRemovePerson",removedValue:t})},style:{marginTop:0,marginInlineEnd:6,marginBottom:6,marginInlineStart:0}},t);if((0,x().Pu)(t)){const e=(0,x().xC)({pointer:t,getRecordValue:z.getRecordValue});return(0,se.jsx)(B().Ay,{actor:e,format:r().A.isMobile?B().Ay.Format.Large:B().Ay.Format.Medium,showRemoveButton:!s,onClickRemove:()=>{D?c().D6({label:(0,se.jsx)(j().sA,{defaultMessage:"To replace the default user, add another person to this property.",id:"database.personPropertyMenu.defaultUserCannotBeRemoved"})}):V({type:"personPropertyMenuUpdateRemovePerson",removedValue:t})},shouldShrink:!0,isSingle:!0,hasPersonHoverCard:!0,spaceStore:X},t.id)}if((0,w().I6)(t)){const e=(0,w().S4)({spacePermissionGroupId:t.id,spaceId:t.spaceId});return(0,se.jsx)(F().UISpacePermissionGroupToken,{parentStore:z,groupPointer:e,format:r().A.isMobile?B().Ay.Format.Large:B().Ay.Format.Medium,showRemoveButton:!s,onClickRemove:()=>{V({type:"personPropertyMenuUpdateRemovePerson",removedValue:t})},shouldShrink:!0,isSingle:!0},e.id)}(0,C().HB)(t)})),selectedTemplateAnnotationVariables:e}}),[u,s,V,z,D,X]),ge=M().Wov.filter((e=>!me.includes(e))),ve=(0,o().X)("agent_in_person_property"),{results:fe}=(0,G()._h)({query:ee,disabled:!ve,limit:20}),ye=(0,l().K8)((()=>(0,N().a)()),[]),he=(0,l().K8)((()=>{const e=Boolean(Q&&Q.isExternallyImportedAndSyncedCollection()&&(null==Q?void 0:Q.getFormat().external_collection_type)),i=null==Q?void 0:Q.getFormat().external_collection_type,s=Boolean(null==W?void 0:W.derived_property_record_metadata);if((0,O().JD)(Q)&&e&&i&&s)return(0,L().Y)({environment:t,intl:n,store:z,isSyncedCollection:e,inputValue:ee,value:u,surface:g,propertySchema:W,handlePersonPropertyMenuAddMentions:ue,sectionMenuTitle:ne,externalSyncedCollectionType:i,onDismiss:Z,tokenLimit:ie});const o={request:{query:ee,actorPointers:u.filter(x().Pu),groupPointers:u.filter((e=>"string"!=typeof e&&(0,w().I6)(e)))},performRequest:async({query:e,actorPointers:i,groupPointers:s})=>{const o=await ae().T.searchActions.load(),r=await o.searchSpaceUsers({environment:t,query:e,membersOnly:!1,limit:20+i.length,placeSelfFirst:""===e||o.isPersonalPronoun(e,n.locale)}),a=o.searchSpaceGroups({query:e,intl:n});return{users:r.filter((e=>!i.some((t=>t.id===e.id)))).slice(0,20),groups:a.filter((e=>!s.some((t=>t.id===(0,w().HT)(e.pointer.id).spacePermissionGroupId)))).slice(0,20),type:"notionUsersAndGroups"}},render:(e,i,s)=>{if(e){const e=!d().A.state.online;return(0,se.jsx)(S().A,{title:ne,loading:!s,children:(0,se.jsx)(h().u,{title:e?(0,se.jsx)(j().sA,{...le.searchOfflineErrorMessage}):(0,se.jsx)(j().sA,{...le.searchErrorMessage})})})}if(i&&"notionUsersAndGroups"!==i.type)return(0,se.jsx)(S().A,{title:ne,loading:!s,children:(0,se.jsx)(h().u,{title:(0,se.jsx)(j().sA,{...le.searchErrorMessage})})});if(i&&0===i.users.length&&0===i.groups.length&&0===fe.length)return(0,se.jsx)(oe,{store:z,inputValue:ee,intl:n,propertySchemaLimit:W.limit,isLoading:!s,surface:g,handlePersonPropertyMenuChange:e=>{ue(e)}});const o=!(void 0!==ie&&u.length>=ie&&ie&&ie>1),r=k().oE((i&&i.users||[]).map((e=>{const t={key:e.id,render:t=>(0,se.jsx)(v().m,{disableTooltip:o,renderTooltip:()=>(0,se.jsx)(j().sA,{defaultMessage:"To select more, remove selection above",id:"database.personPropertyMenu.limitReached"}),render:n=>(0,se.jsx)(K().A,{...t,badge:(0,se.jsx)(ce,{user:e,spaceStore:X}),actor:(0,x().A7)(e),disabled:!o,disabledFeedback:!o,...n})}),action:()=>{ue([{table:A().oo,id:e.id}])}};return t}))),a=k().oE((i&&i.groups||[]).map((e=>{const t={key:e.group_id,render:t=>(0,se.jsx)(q()._,{group:e,menuListItemProps:t}),action:()=>{ue([e.getGroupPointer()])}};return t}))),l=k().oE(fe.map((e=>{const i={key:e.id,render:t=>{const n=(0,x().xC)({pointer:{table:I().GP,id:e.id},getRecordModel:z.getRecordModel});return(0,se.jsx)(v().m,{disableTooltip:o,renderTooltip:()=>(0,se.jsx)(j().sA,{defaultMessage:"To select more, remove selection above",id:"database.personPropertyMenu.limitReached"}),render:e=>(0,se.jsx)(K().A,{...t,actor:n,disabled:!o,disabledFeedback:!o,...e})})},action:()=>{ue([{table:I().GP,id:e.id}]),(0,G().Hp)({bot:e,environment:t,intl:n,pageStore:ye})}};return i}))),c=k().oE([r.length>0||a.length>0||l.length>0?{key:"person and group section",render:e=>(0,se.jsx)(S().A,{...e,title:ne,loading:!s}),items:[...r,...a,...l]}:void 0]);return(0,se.jsx)(b().A,{type:b().O.Vertical,initialFocus:ee.length>0?0:void 0,sections:c})}};return o}),[Q,ee,u,t,n,z,g,W,ue,ne,ie,X,fe,ye,Z]),be=(0,se.jsx)(de,{tokens:pe,disabled:s,onChange:V,value:u,inputValue:ee,setInputValue:te});let Se;return r().A.isMobile?(Se={menuType:m().gu.Modal,title:W.name,header:be,includeFixedHeaderSpacing:!0,scrollerStyle:{paddingBottom:re().H}},Y&&(Se={...Se,right:(0,se.jsx)(j().sA,{...p().W.done}),onClickRight:e.onDismiss})):Se={menuType:m().gu.Popup,header:be,tokenInputHeader:!0,maxHeight:333},s?(0,se.jsx)(f().A,{...Se}):(0,se.jsxs)(f().A,{...Se,children:[J?(0,se.jsx)(S().A,{title:(0,se.jsx)(j().sA,{defaultMessage:"Shortcuts",id:"PersonPropertyMenu.menuItem.shortcuts.label"}),children:ge.length>0?(0,se.jsx)(i.Fragment,{children:ge.map((e=>(0,se.jsx)(y().A,{focused:!1,title:(0,se.jsx)(P().W,{templateVariableType:e}),caption:(0,_().EC)(e,n),inline:!0,onClick:()=>{ue([e])}},`relative-person-shortcut-${e}`)))}):(0,se.jsx)(h().u,{title:(0,se.jsx)(j().sA,{id:"database.personPropertyMenu.noShorcuts.message",defaultMessage:"No shortcuts"})})}):void 0,(0,se.jsx)(R().A,{...he})]})}const de=i.memo((function(e){const{tokens:t,disabled:s,onChange:o,value:l,inputValue:d,setInputValue:c}=e,{isAndroid:p,isPhone:m}=(0,a().Y0)(),v=(0,j().tz)(),f=(0,u().IS)((()=>({tokenWrapStyle:{...(0,n(968021)._Q)({isPhone:m}).table.token,gap:4}})),[m]),y=(0,i.useCallback)((()=>{o({type:"personPropertyMenuUpdateRemovePerson",removedValue:l[l.length-1]})}),[o,l]);return(0,se.jsx)(S().A,{disableDesktopPadding:!0,children:(0,se.jsx)(g().Ay,{focus:!r().A.isMobile||void 0,focusAfterAnimation:!0,format:g().le.Person,tokens:t,tokenWrapStyle:f.tokenWrapStyle,placeholder:v.formatMessage(le.searchForPeopleOrGroups),hideInput:s,onRemoveLastToken:y,value:d,onChange:e=>c(e.target.value),dontShowBorderBottom:p||r().A.isMobile})})}));function ce({user:e,spaceStore:t}){const n=(0,s().V_)({userId:e.id,spaceStore:t});return t&&"restricted_member"===n?(0,se.jsx)(D().L,{}):null}}}]);