"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[40119],{34026:(t,e,o)=>{o.d(e,{Hs:()=>B,B$:()=>F,m:()=>K,x1:()=>L,RQ:()=>R,RZ:()=>z,H2:()=>V,IU:()=>P,Ms:()=>N,Aq:()=>O,LS:()=>D});o(898992),o(354520),o(672577),o(581454),o(296540);var n=()=>o(907258),r=()=>o(908006),i=()=>o(128933),a=()=>o(56268),l=()=>o(214388),s=()=>o(62371),c=()=>o(206267),u=()=>o(792071),p=()=>o(496603),d=()=>o(534177),m=()=>o(680977),S=()=>o(714042),g=()=>o(789051),f=()=>o(447453),v=()=>o(467676),x=()=>o(914701),y=()=>o(180762),C=()=>o(314660),h=()=>o(484714),b=()=>o(203913),k=()=>o(69708),j=()=>o(495262),A=o(474848);function _(){return(0,A.jsx)(k().sA,{defaultMessage:"Changes saved for everyone.",id:"database.filterBar.saved.title"})}function I(t){const{collectionContextStore:e,temporaryState:o}=t,n=(0,h().v3)();return(0,A.jsx)(b().Ag,{onClick:()=>{j().tN({environment:n,preventSelectText:!0}),i().N2(),P({environment:n,collectionContextStore:e,temporaryState:o})},children:(0,A.jsx)(k().sA,{defaultMessage:"Undo",id:"database.filterBar.undo.title"})})}var T=()=>o(611427),w=()=>o(547149),M=()=>o(790515);let B=function(t){return t[t.All=0]="All",t[t.Filters=1]="Filters",t[t.Sorts=2]="Sorts",t}({});function F(t){const{environment:e,collectionContextStore:o,targetCollectionViewStore:n,preventSnackbarNotification:r,type:a,transaction:l}=t,s=o.temporaryStateStore.state,c=o.currentPropertyFiltersStore.state,u=n.getPropertyFiltersStore(),p=(0,g().Ml)(o,"persisted");if(a===B.All||a===B.Filters){p.combinatorFilter&&(0,C().f)({collectionViewStore:n,update:{filter:p.combinatorFilter.value||null},transaction:l});for(const t of p.filters.removed)w().applyOperation({store:u,operation:{pointer:u.pointer,command:"keyedObjectListRemove",path:u.path,args:{remove:{id:t}}},transaction:l});for(const{id:t,beforeId:e}of p.filters.moveOps){const o=c.find((e=>e.id===t));o&&(e?w().applyOperation({store:u,operation:{pointer:u.pointer,command:"keyedObjectListBefore",path:u.path,args:{before:{id:e},value:o}},transaction:l}):w().applyOperation({store:u,operation:{pointer:u.pointer,command:"keyedObjectListAfter",path:u.path,args:{value:o}},transaction:l}))}for(const t of p.filters.updated){const e=c.find((e=>e.id===t));e&&w().applyOperation({store:u,operation:{pointer:u.pointer,command:"keyedObjectListUpdate",path:u.path,args:{value:e}},transaction:l})}}a!==B.All&&a!==B.Sorts||!p.sorts||(0,C().f)({collectionViewStore:n,update:{sort:p.sorts.value||null},transaction:l}),D({environment:e,collectionContextStore:o,temporaryState:a===B.All?void 0:a===B.Filters?{...s,combinatorFilter:void 0,propertyFilters:void 0}:{...s,sorts:void 0}}),r||i().D6({label:(0,A.jsx)(_,{}),right:(0,A.jsx)(I,{collectionContextStore:o,temporaryState:s})})}function R(t){const{environment:e,intl:o,collectionContextStore:n,transaction:i}=t,a=n.collectionViewStore(),l=n.isFullScreenStore.state,s=n.isRootChildStore.state,c=n.isInPeekRendererStore.state;if(!a)return;const u=n.collectionViewBlockStore(),p=(0,v().t)({environment:e,collectionViewBlockStore:u,collectionViewStore:a,intl:o,transaction:i});p&&(F({environment:e,type:B.All,collectionContextStore:n,targetCollectionViewStore:p,transaction:i}),p&&("chart"===p.getType()&&S().Z({environment:e,collectionContextStore:n,collectionViewId:p.id,from:"filter_save_as_new_view"}),(0,y().t)({environment:e,collectionContextStore:n,collectionViewId:p.id,isFullScreen:l,isRootChild:s,isInPeekRenderer:c}),r().default.afterNextFlush((()=>{(0,f().O)({collectionContextStore:n,collectionSettingsStore:n.settingsStore,selectViewNameInitial:!0})}))))}function V(t){const{environment:e,collectionContextStore:o}=t,n=o.currentPropertyFiltersStore.state,r=(0,g().Ml)(o,"normalized").filters.added,i=n.filter((t=>!(r.includes(t.id)&&(0,l().t_)(t.filter))));D({environment:e,collectionContextStore:o,temporaryState:{...o.temporaryStateStore.state,propertyFilters:{value:i}}})}function P(t){const{collectionContextStore:e}=t;D(t),e.isInLibraryBlock()||function(t){const{environment:e,collectionContextStore:o}=t,n=o.collectionViewStore(),r=o.collectionViewBlockStore();if(!n||!r)return;(o.isUnlistedViewStore.state&&o.isInlineViewStore.state||(0,a().r)({environment:e,store:r})&&o.permissionScopesStore.state.canConfigureBlock)&&w().createAndCommit({userAction:"collectionFilterActions.applyTemporaryStateIfPrivate",environment:e,canUndo:!0,perform:t=>{F({environment:e,collectionContextStore:o,type:B.All,targetCollectionViewStore:n,preventSnackbarNotification:!0,transaction:t})}})}(t)}function D(t){var e;const{environment:o,collectionContextStore:n,temporaryState:r}=t,i=n.collectionViewStore();if(!i)return;const a=o.currentUser.id;n.temporaryStateStore.setState(r||{}),(0,T().A)({currentUserId:a,collectionViewId:i.id,viewsModuleCurrentPageId:n.viewsModuleContextStore.isInLayoutBuilder()||null===(e=n.viewsModuleContextStore.currentPageStore())||void 0===e?void 0:e.id,temporaryState:r}),n.groupsStore.resetAllLimits()}function O(t){const{environment:e,seen:o}=t,{currentUserSettingsStore:r}=n().default.state;r&&w().createAndCommit({userAction:"collectionFilterActions.setSeenFiltersIntroTooltip",environment:e,canUndo:!0,perform:t=>{(0,m().m)({userSettingsStore:r,transaction:t,data:{seen_filters_tooltip:o}})}})}function z({transaction:t,newGroups:e,collectionContextStore:o,environment:n}){var r;const i=o.collectionViewStore(),a=o.currentCombinatorFilterStore.state,c=(0,p().mg)(a),u=null==c||null===(r=c.filters)||void 0===r?void 0:r.find(l().B9),m=(0,g().I6)(o);if(!(i&&c&&c.filters&&u))return;const S=u.filter.value.filter((t=>"exact"===t.type)).map((t=>t.value)).filter(d().O9),f=e.map((t=>t.value)).filter(s().D1).map((t=>t.value)).filter(s().WO).map((t=>t.id)),v=(0,p().FF)(f,...S);0!==v.length&&(u.filter.value=[...u.filter.value,...v.map((t=>({type:"exact",value:t})))],D({environment:n,collectionContextStore:o,temporaryState:{...o.temporaryStateStore.state,combinatorFilter:{value:c}}}),m||F({environment:n,collectionContextStore:o,type:B.Filters,targetCollectionViewStore:i,preventSnackbarNotification:!0,transaction:t}))}function N(t){var e;const o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.id,n=t.getCurrentUserId();o&&n&&((0,x().E)({userId:n,collectionViewId:o,isOpen:!1}),t.filtersBarOpenStore.setState(!1))}function K(t){var e,o,n;const{collectionContextStore:r,environment:i,property:a,schema:l}=t,s=r.currentPropertyFiltersStore.state,p=s.find((t=>t.filter.property===a));if(p)return p;const d=(null===(e=r.collectionViewBlockStore())||void 0===e?void 0:e.getRecordModel)??u().b4_.constant(void 0),m=i.idCreator.getSpaceIdCreatorSync((null===(o=r.collectionViewStore())||void 0===o||null===(o=o.pointer)||void 0===o?void 0:o.spaceId)??""),S=(0,M().SO)({property:a,schema:l,getRecordModel:d,spaceIdCreator:m,collectionSource:null===(n=r.collectionViewStore())||void 0===n?void 0:n.getCollectionSource()});if(!S)return;const g={id:c().JW(),filter:S};return P({environment:i,collectionContextStore:r,temporaryState:{...r.temporaryStateStore.state,propertyFilters:{value:[...s,g]}}}),g}function L(t){const{collectionContextStore:e,environment:o}=t,n=e.currentCombinatorFilterStore.state;if(n)return n;const r=l().Lx;return P({environment:o,collectionContextStore:e,temporaryState:{...e.temporaryStateStore.state,combinatorFilter:{value:r}}}),r}},56702:(t,e,o)=>{o.d(e,{t:()=>r});var n=()=>o(882722);function r(t){return t<=0?"":t%2==0?n().nhj:n().ueJ}},170479:(t,e,o)=>{o.d(e,{A:()=>re});var n=o(296540),r=()=>o(590526),i=()=>o(300474),a=()=>o(907258),l=()=>o(484714),s=()=>o(401497),c=()=>o(406094),u=()=>o(69708),p=()=>o(284371),d=()=>o(390650),m=()=>o(611947),S=()=>o(646355),g=()=>o(314529);function f(t,e){(0,g().DO_NOT_USE_trackLegacy)(t,"complete_sprint_action",e)}o(898992),o(354520),o(581454);var v=()=>o(726637),x=()=>o(725252),y=()=>o(79926),C=()=>o(757695),h=()=>o(560729),b=()=>o(295633),k=()=>o(874832),j=()=>o(245720),A=()=>o(250910),_=()=>o(807449),I=()=>o(695115),T=()=>o(416783),w=()=>o(546926),M=()=>o(631524),B=()=>o(160432),F=()=>o(890492),R=()=>o(81068),V=()=>o(663639),P=()=>o(736847),D=()=>o(584262),O=()=>o(433337),z=()=>o(784892),N=()=>o(597777),K=()=>o(869190),L=()=>o(324254),U=()=>o(740689),E=()=>o(617668),H=()=>o(995847),W=()=>o(696706),J=()=>o(179034),q=()=>o(864779),G=()=>o(201980),$=()=>o(100622),Q=()=>o(806080),Y=()=>o(534177),Z=()=>o(720665),X=()=>o(857783),tt=()=>o(813297),et=()=>o(599806),ot=()=>o(304681),nt=()=>o(113105),rt=()=>o(187820),it=()=>o(16006),at=()=>o(881690),lt=()=>o(707160),st=()=>o(862292),ct=()=>o(71304),ut=()=>o(115512),pt=()=>o(778708),dt=o(474848);const mt=(0,u().YK)({completedPercentSummary:{id:"completeAutomationSprintModal.sprintSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} total tasks"},selectNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectNextSprintLabel",defaultMessage:"Next sprint"},selectDatesForNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectDatesForNextSprintLabel",defaultMessage:"Start and end dates"},nextSprintDatesLabel:{id:"completeAutomationSprintModal.sprintSummary.nextSprintDatesLabel",defaultMessage:"Next sprint dates"},cancelButton:{id:"completeAutomationSprintModal.sprintSummary.cancel",defaultMessage:"Cancel"},fallbackSprintName:{id:"completeAutomationSprintModal.sprintName.placeholder",defaultMessage:"Sprint"}});function St({onDismiss:t,...e}){const{isOpen:o}=e,r=(0,l().v3)(),i=(0,n.useId)(),a=o=>{t();let n=!1;(0,Y().Gv)(o)&&(0,Y().O9)(o.clickedCancel)&&(n=!0===o.clickedCancel),f(r,{...(0,d().sl)(e.taskCollectionContextStore),action:n?"cancel_modal":"dismiss_modal"})};return(0,dt.jsx)(h().A,{ariaLabelledBy:i,isOpen:o,onDismiss:()=>a(),render:()=>(0,dt.jsx)(gt,{...e,onDismiss:a,titleAriaId:i})})}function gt(t){var e;const{completeSprintAutomationContext:o,setIsLoading:i,taskCollectionContextStore:s,onDismiss:c,completeSprintAutomationState:p,onAutomationComplete:d,titleAriaId:m}=t,{currentSprintId:S,querySprintsResult:g,currentSprintTaskSummary:f}=p,v=(0,u().tz)(),h=(0,l().v3)(),{value:k}=(0,y().fJ)(st().T.formulas),{value:j}=(0,y().fJ)(tt().QV.automationTypecheck),{value:A}=(0,y().fJ)(tt().QV.automationActionRegistry),_=(0,r().O$)(a().AppStoreCurrentUserSettingsStore),I=(0,r().K8)((()=>o.sprintCollectionStore),[o]),T=(0,r().K8)((()=>{var t;const e=null===(t=o.automationContext)||void 0===t?void 0:t.automationStore;return null==e?void 0:e.getRecurrence()}),[o]),w=(0,r().K8)((()=>{var t;return(null===(t=o.automationContext)||void 0===t||null===(t=t.automationActionStore.getConfig())||void 0===t?void 0:t.complete_sprint_action)??"complete_sprint_and_move_incomplete_tasks_to_next_sprint"}),[null===(e=o.automationContext)||void 0===e?void 0:e.automationActionStore]),F=(0,r().K8)((()=>I.getSpaceId()),[I]),R=(0,r().K8)((()=>{if(S)return b().B.createChildStore(I,{id:S,table:J().ev,spaceId:I.getSpaceId()})}),[S,I]),V=(0,r().K8)((()=>R?(0,ct().tS)({intl:v,environment:h,store:R,untitledFallback:mt.fallbackSprintName}):v.formatMessage(mt.fallbackSprintName)),[R,v,h]),P=(0,r().K8)((()=>ht({sprintBlockStore:R,sprintCollectionStore:I})),[R,I]),D=(0,r().K8)((()=>bt({sprintDateRange:P,intl:v})),[P,v]),[O,z]=n.useState(),K=(0,r().K8)((()=>C().Store.createValue(w)),[w]),L=n.useMemo((()=>{if(!T||null==P||!P.end_date)return;const t=(0,q().Vv)(T);return t?(0,q().Z3)({currentSprintEndDate:P.end_date,sprintSchedule:t}):void 0}),[T,null==P?void 0:P.end_date]),U=(0,r().K8)((()=>{if("pointer"!==(null==O?void 0:O.type))return;return ht({sprintBlockStore:b().B.createChildStore(I,O.pointer),sprintCollectionStore:I})}),[O,I]),[E,H]=n.useState(void 0),W=n.useMemo((()=>{if(E&&(0,N().oM)(E))return E}),[E]),G=n.useMemo((()=>{if(!g)return;const{nextSprintIds:t,futureSprintIds:e}=g;return t.length>0?t:e}),[g]),$=(0,r().K8)((()=>{if(void 0===G)return;const t=G[0];return t?{type:"pointer",pointer:{id:t,table:J().ev,spaceId:F}}:{type:"actionId"}}),[G,F]),Q=(0,r().K8)((()=>{var t;return!Boolean(null==_||null===(t=_.getSettings())||void 0===t?void 0:t.seen_sprint_settings_engagement_banner)}),[_]);n.useEffect((()=>{$&&z($)}),[$,z]),n.useEffect((()=>{H(U??L)}),[U,L,H]);const Y=n.useCallback((async()=>{if(c(),!(k&&j&&A&&O&&W&&o.automationContext))return;i(!0);const t=0===(null==f?void 0:f.incompleteTaskCount)?"complete_sprint":K.state;if(!o.automationContext)return;const e={type:"recurrence",recurrence:{type:"completeSprint",completeSprintActionType:t,nextSprintDateRange:W},automationStore:o.automationContext.automationStore,intl:v,parentRecordStore:o.currentCollectionViewBlockStore,formulasModule:k,isLoggedIn:h.currentUser.isLoggedIn(),automationTypecheckModule:j,automationActionRegistryModule:A},n=()=>{d()},{automationExecutionActions:r}=await tt().QV.automations.load();await r.executeClientAutomation({environment:h,clientContext:e,onUndo:()=>{i(!0),n(),i(!1)}}),n(),i(!1)}),[c,k,O,W,o.automationContext,o.currentCollectionViewBlockStore,j,A,i,null==f?void 0:f.incompleteTaskCount,K,v,h,d]),X=xt(),{status:et}=(0,x().L)({value:p,validateLoaded:t=>!1===t.isLoading,waitTimeInMs:Number(Z().Xb)});if("pending"!==et&&p.isLoading)return(0,dt.jsx)(ft,{titleAriaId:m,onDismiss:c,sprintCollectionStore:I});if(p.isLoading)return(0,dt.jsx)(vt,{titleAriaId:m,onDismiss:c});const{incompleteTaskCount:ot}=p.currentSprintTaskSummary,nt=Boolean(O)&&Boolean(W),rt=void 0!==G&&G.length>0;return(0,dt.jsxs)("div",{style:X.modalContainer,children:[(0,dt.jsx)("div",{style:X.header,id:m,children:(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.sprintSummary.title",defaultMessage:"{sprintName} summary",values:{sprintName:V}})}),(0,dt.jsx)(Ct,{currentSprintFormattedDateRange:D,currentSprintTaskSummary:f}),Q?(0,dt.jsx)(yt,{collectionContextStore:s,userSettingsStore:_,onDismissModal:c}):void 0,rt?(0,dt.jsxs)("div",{style:X.flexRow,children:[v.formatMessage(mt.selectNextSprintLabel),(0,dt.jsx)(It,{nextSprintInput:O,setNextSprintInput:z,completeSprintAutomationContext:o,sprintPageIds:G})]}):void 0,(0,dt.jsxs)("div",{style:X.flexRow,children:[rt?v.formatMessage(mt.selectDatesForNextSprintLabel):v.formatMessage(mt.nextSprintDatesLabel),(0,dt.jsx)(wt,{sprintDateRange:E,setSprintDateRange:H})]}),ot>0?(0,dt.jsxs)("div",{style:X.flexRow,children:[(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksLabel",defaultMessage:"{incompleteTaskCount, plural, one {{incompleteTaskCount} incomplete task} other {{incompleteTaskCount} incomplete tasks}}",values:{incompleteTaskCount:ot}}),(0,dt.jsx)(jt,{actionTypeStore:K})]}):void 0,(0,dt.jsx)(B().A,{colorPalette:"blue",disabled:!nt,onClick:()=>{Y()},style:X.button,children:(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButton",defaultMessage:"Complete {sprintName}",values:{sprintName:V}})}),(0,dt.jsx)(M().p,{onClick:()=>c({clickedCancel:!0}),style:X.button,children:v.formatMessage(mt.cancelButton)})]})}function ft(t){const{onDismiss:e,sprintCollectionStore:o,titleAriaId:n}=t,i=(0,l().v3)(),a=(0,u().tz)(),s=(0,r().K8)((()=>o.getParentBlockStore()),[o]),c=xt();return(0,dt.jsxs)("div",{style:c.modalContainer,children:[(0,dt.jsx)("div",{style:c.header,id:n,children:(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.missingCurrentSprint.title",defaultMessage:"No current sprint found"})}),(0,dt.jsx)(B().A,{colorPalette:"blue",onClick:()=>{s&&X().uK({environment:i,store:s,pageVisitSource:D().y8.LinkInPage})},style:{...c.button,marginTop:24},children:(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.missingCurrentSprint.navigateToSprintsDatabase",defaultMessage:"Fix in Sprints database"})}),(0,dt.jsx)(M().p,{onClick:e,style:c.button,children:a.formatMessage(mt.cancelButton)})]})}function vt(t){const{onDismiss:e,titleAriaId:o}=t,n=(0,u().tz)(),r=xt();return(0,dt.jsxs)("div",{style:r.modalContainer,children:[(0,dt.jsx)("div",{style:r.header,id:o,children:(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.sprintSummary.titlePlaceholder",defaultMessage:"Sprint summary"})}),(0,dt.jsx)("div",{style:r.subheader,children:(0,dt.jsx)(k().P,{style:r.subheaderShimmer})}),(0,dt.jsxs)("div",{style:r.flexRow,children:[n.formatMessage(mt.selectNextSprintLabel),(0,dt.jsx)(k().P,{style:r.flexRowShimmerBox1})]}),(0,dt.jsxs)("div",{style:r.flexRow,children:[n.formatMessage(mt.selectDatesForNextSprintLabel),(0,dt.jsx)(k().P,{style:r.flexRowShimmerBox2})]}),(0,dt.jsxs)("div",{style:r.flexRow,children:[(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksPlaceholder",defaultMessage:"Incomplete tasks"}),(0,dt.jsx)(k().P,{style:r.flexRowShimmerBox3})]}),(0,dt.jsx)(B().A,{colorPalette:"blue",disabled:!0,onClick:Q().lQ,style:r.button,children:(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButtonPlaceholder",defaultMessage:"Complete sprint"})}),(0,dt.jsx)(M().p,{onClick:e,style:r.button,children:n.formatMessage(mt.cancelButton)})]})}function xt(){return(0,s().IS)((()=>{const t={height:44,borderRadius:8,display:"flex",alignItems:"center",width:void 0},e={...t,marginTop:12,marginBottom:18};return{modalContainer:{width:400,display:"flex",fontSize:ut().vQ,flexDirection:"column",justifyContent:"center",padding:20},header:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:v().A.isMobile?18:16,fontWeight:p().Wy.semibold},subheader:{display:"flex",alignItems:"center",justifyContent:"center",color:$().Tj.text.tertiary,marginBottom:16,gap:8},separator:{height:2,width:2,borderRadius:2,backgroundColor:$().Tj.icon.tertiary},flexRow:{display:"flex",...v().A.isMobile?{flexDirection:"column",fontSize:14,color:$().Tj.text.secondary}:{justifyContent:"space-between",alignItems:"center",height:24,marginBottom:16}},completedTaskGroup:{display:"flex",gap:4},button:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:8,...v().A.isMobile&&t},subheaderShimmer:{borderRadius:4,marginTop:6,width:200,height:16,...v().A.isMobile&&{height:22}},flexRowShimmerBox1:{borderRadius:4,width:60,height:16,...v().A.isMobile&&e},flexRowShimmerBox2:{borderRadius:4,width:80,height:16,...v().A.isMobile&&e},flexRowShimmerBox3:{borderRadius:4,width:140,height:16,...v().A.isMobile&&e},dropdownButton:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:4,...v().A.isMobile&&{...e,border:`1px solid ${$().Tj.border.secondary}`,justifyContent:"space-between"}},dropdownChevronIcon:{color:$().Tj.icon.tertiary,width:12,height:"auto"}}}),[])}function yt(t){const e=(0,u().tz)(),{collectionContextStore:o,userSettingsStore:n,onDismissModal:r}=t,i=(0,l().v3)(),a=(0,s().IS)((()=>({banner:{width:"100%",display:"flex",alignItems:"start",backgroundColor:$().Tj.blue.background.secondaryTranslucent,borderRadius:4,padding:12,marginBottom:12,fontSize:12,lineHeight:1.5,gap:8},bannerContent:{flex:"1 1 auto",color:$().Tj.text.primary},bannerTitle:{fontWeight:p().Wy.regular},repeatIcon:{flex:"0 0 auto",marginBlockStart:3},closeButton:{marginTop:-3,borderRadius:"50%"},link:{color:$().Tj.blue.text.accentPrimary}})),[]);return(0,dt.jsxs)("div",{style:a.banner,children:[(0,dt.jsx)("div",{style:a.repeatIcon,children:(0,dt.jsx)(_().I,{icon:U().o,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"})}),(0,dt.jsx)("div",{style:a.bannerContent,children:(0,dt.jsx)("div",{style:a.bannerTitle,children:(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.turnOnAutomaticSprints.banner.title",defaultMessage:"Complete your sprints automatically. Turn on Automated sprints in <linkToSprintSettings>Settings</linkToSprintSettings>.",values:{linkToSprintSettings:(...t)=>(0,dt.jsx)(T().V,{onClick:()=>{n&&(r(),pt().cJ({environment:i,userSettingsStore:n}),pt().Dl(o))},disableUnderline:!0,style:a.link,children:t})}})})}),(0,dt.jsx)(I().A,{icon:H().xMarkSmallIcon,ariaLabel:e.formatMessage({id:"completeAutomationSprintModal.dismissBannerButton",defaultMessage:"Dismiss banner button"}),style:a.closeButton,onClick:()=>{n&&pt().cJ({environment:i,userSettingsStore:n})}})]})}function Ct(t){const{currentSprintFormattedDateRange:e,currentSprintTaskSummary:o}=t,n=(0,u().tz)(),r=xt(),i=o?n.formatMessage(mt.completedPercentSummary,{completedTaskCount:o.completedTaskCount,totalTaskCount:o.totalTaskCount}):void 0,a=e&&o?(0,dt.jsxs)(dt.Fragment,{children:[e,(0,dt.jsx)("div",{style:r.separator}),i]}):e||i;return void 0===a?null:(0,dt.jsx)("div",{style:r.subheader,children:a})}function ht(t){const{sprintBlockStore:e,sprintCollectionStore:o}=t;if(!e)return;const n=o.getPropertyMapping(),r=null==n?void 0:n[O().Hx.Dates];if(!r)return;const i=e.getPropertyValue(r);if(!i)return;const a=(0,G().Cok)(i)[0];return a?(0,N().HB)(a):void 0}function bt(t){const{sprintDateRange:e,intl:o}=t;if(e&&(0,N().oM)(e))return(0,K().ZF)({value:e,allowRelativeDates:!1,shortenDateAndRange:!0,displayInUserTimezone:!0,intl:o})}const kt={complete_sprint_and_move_incomplete_tasks_to_next_sprint:(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.sprintSummary.moveToNextSprintOption",defaultMessage:"Move to next sprint"}),complete_sprint_and_move_incomplete_tasks_to_backlog:(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.sprintSummary.moveToBacklogOption",defaultMessage:"Move to backlog"}),complete_sprint:(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.sprintSummary.keepInThisSprintOption",defaultMessage:"Keep in current sprint"})};function jt(t){const{actionTypeStore:e}=t,o=(0,r().O$)(e),n=xt();return(0,dt.jsx)(A().A,{popupType:v().A.isMobile?A().z.SlideUp:A().z.Popup,alignmentToOrigin:"start",placementToOrigin:"bottom",render:t=>(0,dt.jsx)(_t,{actionTypeStore:e,buttonPopupParent:t}),renderOrigin:t=>(0,dt.jsxs)(M().p,{...t,style:n.dropdownButton,children:[kt[o],(0,dt.jsx)(_().I,{icon:L().arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"tertiary"})]})})}const At=["complete_sprint_and_move_incomplete_tasks_to_next_sprint","complete_sprint_and_move_incomplete_tasks_to_backlog","complete_sprint"];function _t(t){const{actionTypeStore:e,buttonPopupParent:o}=t,n=(0,r().K8)((()=>At.map((t=>{const n=t===e.state;return{key:t,action:()=>{e.setState(t),o.close()},render:e=>(0,dt.jsx)(R().A,{...e,title:kt[t],isChecked:n})}}))),[e,o]);let i;return i=v().A.isMobile?{menuType:w().gu.ActionSheet}:{menuType:w().gu.Popup,maxHeight:"50vh",minWidth:230},(0,dt.jsx)(F().A,{...i,children:(0,dt.jsx)(V().A,{type:V().O.Vertical,initialFocus:0,sections:[{key:"sprint_automations",items:n,render:t=>(0,dt.jsx)(P().A,{...t})}]})})}function It(t){const{nextSprintInput:e,completeSprintAutomationContext:o,setNextSprintInput:n,sprintPageIds:i}=t,{sprintCollectionStore:a}=o,c=(0,l().v3)(),p=(0,u().tz)(),d=(0,r().K8)((()=>{if(void 0===e)return(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.sprintSelect.empty",defaultMessage:"Select sprint"});if("actionId"===e.type)return(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.sprintSelect.newSprint",defaultMessage:"New sprint"});if("pointer"===e.type){const t=b().B.createChildStore(a,e.pointer);return(0,ct().tS)({intl:p,environment:c,store:t,untitledFallback:mt.fallbackSprintName})}(0,Y().HB)(e)}),[e,p,a,c]),m=xt(),S=(0,s().IS)((()=>({button:{...void 0===e&&{color:$().Tj.text.tertiary}}})),[e]),g={...m.dropdownButton,...S.button};return 0===i.length||1===i.length?(0,dt.jsx)(M().p,{style:g,disabled:!0,children:d}):(0,dt.jsx)(A().A,{popupType:v().A.isMobile?A().z.SlideUp:A().z.Popup,alignmentToOrigin:"start",placementToOrigin:"bottom",render:t=>(0,dt.jsx)(Tt,{buttonPopupParent:t,completeSprintAutomationContext:o,sprintPageIds:i,nextSprintInput:e,setNextSprintInput:n}),renderOrigin:t=>(0,dt.jsxs)(M().p,{...t,style:g,children:[d,(0,dt.jsx)(_().I,{icon:L().arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"tertiary"})]})})}function Tt(t){const{sprintPageIds:e,completeSprintAutomationContext:o,buttonPopupParent:i,nextSprintInput:a,setNextSprintInput:l}=t,{sprintCollectionStore:c}=o,p=(0,r().K8)((()=>c.getSpaceId()),[c]),d=(0,r().K8)((()=>(0,nt().B7)({collectionStore:o.taskCollectionStore,property:O().yx.TaskToSprintRelation}).filter((t=>t.visible&&("title"===t.property||o.sprintCollectionSchema[t.property])))),[o]),m=(0,r().K8)((()=>new(ot().A)),[]),S=(0,s().IS)((()=>({plusIcon:{color:$().Tj.icon.tertiary,width:12,height:"auto"},createSprintRow:{display:"flex",gap:4},sprintRow:{display:"flex",maxHeight:22,alignItems:"center"},recordTitle:{...v().A.isMobile&&{marginInlineEnd:12}}})),[]),g="purple",f=(0,s().DP)(),x=(0,$().LD)(f,g),y=n.useMemo((()=>{const t="actionId"===(null==a?void 0:a.type);return{key:"new_sprint",action:()=>{l({type:"actionId"}),i.close()},render:e=>(0,dt.jsx)(R().A,{...e,icon:(0,dt.jsx)(_().I,{icon:E().plusIcon}),title:(0,dt.jsxs)("div",{style:S.createSprintRow,children:[(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.selectSprintDropdown.createNew",defaultMessage:"New sprint"}),(0,dt.jsx)(at().A,{isRound:!0,showRemoveButton:!1,value:(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.selectSprintDropdown.createNewToken",defaultMessage:"Next"}),format:z().NY.Medium,isSingle:!0,color:x.textColor,backgroundColor:x.backgroundColor,showColoredDot:g})]}),isChecked:t})}}),[a,i,l,S,x]),C=(0,r().K8)((()=>e.map((t=>{const e={id:t,table:J().ev,spaceId:p},o=b().B.createChildStore(c,e),n=o.getIcon(),r="pointer"===(null==a?void 0:a.type)&&W().L3.isEqual(a.pointer,e);return{key:t,action:()=>{l({type:"pointer",pointer:e}),i.close()},render:t=>(0,dt.jsx)(R().A,{...t,icon:n&&(0,dt.jsx)(rt().B6,{disabled:!0,icon:n,isEmptyPage:!1,size:20}),title:(0,dt.jsx)("div",{style:S.sprintRow,children:d.map((t=>"title"===t.property?(0,dt.jsx)(it().A,{store:o,style:S.recordTitle},"title"):(0,dt.jsx)(et().qm,{store:o,property:t.property,disabled:!1,locked:!1,surface:"relation",tableWrap:!1,blockPropertyValueOverlayStore:m,collectionStore:c},t.property))).filter(Y().O9)}),isChecked:r})}}))),[c,m,i,a,d,p,l,S,e]),h=[{key:"sprints",items:n.useMemo((()=>C.length>0?C:[y]),[C,y]),render:t=>(0,dt.jsx)(P().A,{...t})}];let k;return k=v().A.isMobile?{menuType:w().gu.ActionSheet}:{menuType:w().gu.Popup,maxHeight:"50vh",minWidth:230},(0,dt.jsx)(F().A,{...k,children:(0,dt.jsx)(V().A,{type:V().O.Vertical,initialFocus:0,sections:h})})}function wt(t){const{sprintDateRange:e,setSprintDateRange:o}=t,r=(0,u().tz)(),i=n.useMemo((()=>bt({sprintDateRange:e,intl:r})),[e,r]),a=xt(),l=(0,s().IS)((()=>({button:{...!i&&{color:$().Tj.text.tertiary}}})),[i]),c=(0,n.useMemo)((()=>i||(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.sprintSummary.nextSprintDate.placeholder",defaultMessage:"Select dates"})),[i]);return(0,dt.jsx)(A().A,{popupType:v().A.isMobile?A().z.SlideUp:A().z.Popup,alignmentToOrigin:"start",placementToOrigin:"bottom",render:t=>(0,dt.jsx)(Mt,{sprintDateRange:e,setSprintDateRange:o,onDismiss:()=>{t.close()}}),renderOrigin:t=>(0,dt.jsxs)(M().p,{...t,style:{...a.dropdownButton,...l.button},children:[c,(0,dt.jsx)(_().I,{icon:L().arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"tertiary"})]})})}function Mt(t){const{sprintDateRange:e,setSprintDateRange:o,onDismiss:r}=t,i=n.useMemo((()=>({starting:null!=e&&e.start_date?{type:"date",start_date:e.start_date}:void 0,ending:null!=e&&e.end_date?{type:"date",start_date:e.end_date}:void 0})),[e]);let a;return a=v().A.isMobile?{menuType:w().gu.Modal,right:(0,dt.jsx)(u().sA,{...j().W.done}),onClickRight:r}:{menuType:w().gu.Popup,maxHeight:"50vh",paddingTop:6},(0,dt.jsxs)(F().A,{...a,children:[(0,dt.jsx)(P().A,{children:(0,dt.jsx)(lt().A,{title:void 0,disableMenuWrap:!0,allowRelativeRangeFilter:!0,value:i,onUpdate:t=>{var e,n;if(t.error)return;const r={...i,...t.value},a=null===(e=r.starting)||void 0===e?void 0:e.start_date,l=null===(n=r.ending)||void 0===n?void 0:n.start_date;o({type:"daterange",start_date:a,end_date:l})},onDismiss:r})}),(0,dt.jsx)(P().A,{topBorder:!0,children:(0,dt.jsx)(R().A,{focused:!1,onClick:()=>{o(void 0)},title:(0,dt.jsx)(u().sA,{id:"completeAutomationSprintModal.sprintSummary.datePicker.clear",defaultMessage:"Clear"})})})]})}o(672577);var Bt=()=>o(416504),Ft=()=>o(187174),Rt=()=>o(799829),Vt=()=>o(769864),Pt=()=>o(950914),Dt=()=>o(374562);function Ot(t){if(!t)return;if("aggregation"!==t.type)return;if("text"!==t.aggregationResult.type)return;const e=t.aggregationResult.value,o=null==e?void 0:e.split("/");if(!o||2!==o.length)return;const n=Number(o[0]),r=Number(o[1]);return{completedTaskCount:n,incompleteTaskCount:r-n,totalTaskCount:r,completedTaskPercent:0===r?0:n/r}}function zt(t){if(!t)return;const e=t.getPropertyMapping(),o=null==e?void 0:e[O().yx.TaskToSprintRelation];if(!o)return;return Dt().jj.filter.property=o,{...Dt().jj.filter,property:o}}function Nt(t,e){if(!e)return;const o=e.getPropertyMapping(),n=zt(e);if(!n)return;const r=null==o?void 0:o[O().yx.Status];if(!r)return;const i=e.getSchema()[r];if(!i||"status"!==i.type)return;const a=(0,Pt().Q6)(t,i);return a?{type:"aggregation",filter:{operator:"and",filters:[n]},aggregation:{aggregator:{operator:"count_per_group",groupName:a},property:r}}:void 0}class Kt extends C().Store{getInitialState(){return{isLoading:!0,currentSprintId:void 0,querySprintsResult:void 0,currentSprintTaskSummary:void 0}}updateCurrentSprint(t){const{querySprintsResult:e,currentSprintTaskSummary:o}=this.state;void 0!==t&&void 0!==e&&void 0!==o?this.setState({isLoading:!1,currentSprintId:t,querySprintsResult:e,currentSprintTaskSummary:o}):t?this.setState({...this.state,currentSprintId:t}):this.setState({...this.state,isLoading:!0,currentSprintId:t})}updateNextAndFutureSprints(t){const{currentSprintId:e,currentSprintTaskSummary:o}=this.state;void 0!==e&&void 0!==t&&void 0!==o?this.setState({isLoading:!1,currentSprintId:e,querySprintsResult:t,currentSprintTaskSummary:o}):t?this.setState({...this.state,querySprintsResult:t}):this.setState({...this.state,isLoading:!0,querySprintsResult:t})}updateCurrentSprintTaskSummary(t){const{currentSprintId:e,querySprintsResult:o}=this.state;void 0!==e&&void 0!==o&&void 0!==t?this.setState({isLoading:!1,currentSprintId:e,querySprintsResult:o,currentSprintTaskSummary:t}):t?this.setState({...this.state,currentSprintTaskSummary:t}):this.setState({...this.state,isLoading:!0,currentSprintTaskSummary:t})}}const Lt=Kt;function Ut(t){const{taskCollectionContextStore:e,completeSprintAutomationContext:o,children:i,isModalOpen:a}=t,{sprintCollectionStore:s}=o,c=s.id,p=(0,l().v3)(),d=(0,r().K8)((()=>new Lt),[]),m=(0,r().O$)(d),S=(0,r().K8)((()=>{var t;const o=e.relativeVariableStore.state;return null==o||null===(t=o[c])||void 0===t?void 0:t.current}),[c,e]);n.useEffect((()=>{d.updateCurrentSprint(S)}),[S,d]);const[{value:g}]=(0,Ft().Yb)((async()=>await async function(t){var e;const{environment:o,completeSprintAutomationContext:n}=t,{sprintCollectionStore:r}=n,i=function(t){var e,o;const{sprintCollectionStore:n,sprintCollectionSchema:r}=t,i=n.getPropertyMapping(),a=null==i?void 0:i[O().Hx.StatusV2];if(!a)return;const l=r[a];if(!l||"status"!==l.type)return;const s=null===(e=l.options)||void 0===e||null===(e=e.find((t=>t.id===O().tO)))||void 0===e?void 0:e.value,c=null===(o=l.options)||void 0===o||null===(o=o.find((t=>t.id===O().Jd)))||void 0===o?void 0:o.value;if(!s||!c)return;const u=Rt().n$[O().av].next.reducer.getCombinatorFilter(r);if(!u)return;const p={type:"results",filter:u,limit:Et},d={type:"results",filter:{operator:"and",filters:[{property:a,filter:{operator:"status_is",value:{type:"is_option",value:c}}}]},limit:Et};return{[O().tO]:p,[O().Jd]:d}}(n),a=r.getPropertyMapping(),l=null==a?void 0:a[O().Hx.Dates],s=null==a?void 0:a[O().Hx.UniqueId];if(!i||!l||!s)return;const c={userId:o.currentUser.id,userTimeZone:(0,Bt().P)(),searchQuery:void 0,sort:[{property:l,direction:"ascending"},{property:s,direction:"ascending"}],reducers:i},u=null===(e=r.getParentBlockStore())||void 0===e?void 0:e.getCollectionViewStores()[0],p=r.getSpaceId();if(!u)return;const d=await Vt().callApi({eventName:"queryCollection",environment:o,data:{clientType:"notion_app",source:{type:"collection",id:r.id,spaceId:p},collectionView:{id:u.id,spaceId:p},loader:c},tracking:{src:"complete_sprint_modal_sprint_picker"}});if("success"!==d.type)return;const m=d.data.result.reducerResults[O().tO],S=d.data.result.reducerResults[O().Jd];if("results"!==m.type||"results"!==S.type)return;const g=m.blockIds,f=S.blockIds;return{nextSprintIds:g,futureSprintIds:f}}({environment:p,completeSprintAutomationContext:o})),[S,p,o]);n.useEffect((()=>{d.updateNextAndFutureSprints(g)}),[g,d]);const f=(0,u().tz)(),[{value:v}]=(0,Ft().Yb)((async()=>await async function(t){var e;const{environment:o,completeSprintAutomationContext:n,intl:r}=t,{taskCollectionStore:i}=n,a=Nt(r,i);if(!a)return;const l=zt(i);if(!l)return;const s={filter:{operator:"and",filters:[l]},userId:o.currentUser.id,userTimeZone:(0,Bt().P)(),searchQuery:"",sort:[],reducers:{completed_tasks_in_current_sprint:a}},c=null===(e=i.getParentBlockStore())||void 0===e?void 0:e.getCollectionViewStores()[0],u=i.getSpaceId();if(!c)return;const p=await Vt().callApi({eventName:"queryCollection",environment:o,data:{clientType:"notion_app",source:{type:"collection",id:i.id,spaceId:u},collectionView:{id:c.id,spaceId:u},loader:s},tracking:{src:"complete_sprint_modal_sprint_picker"}});if("success"!==p.type)return;return Ot(p.data.result.reducerResults.completed_tasks_in_current_sprint)}({intl:f,environment:p,completeSprintAutomationContext:o})),[S,p,o,a]);return n.useEffect((()=>{d.updateCurrentSprintTaskSummary(v)}),[v,d]),(0,dt.jsx)(dt.Fragment,{children:i({completeSprintAutomationState:m,onAutomationComplete:()=>{d.reset()}})})}const Et=5;var Ht=()=>o(765101),Wt=()=>o(789051),Jt=()=>o(101981),qt=()=>o(67775);function Gt(t){const{percentage:e}=t;return(0,dt.jsx)(qt().l,{numberValue:e,numberFormat:void 0,numberPrecision:void 0,numberShowAs:{type:"ring",maxValue:1,color:"blue",showValue:!1},shouldRenderTooltip:!1,progressSize:15})}const $t=function(t){const{isLoading:e,taskSummary:n,styles:r}=t;return(0,dt.jsx)("div",{style:{width:16,height:"auto",...r},children:e?(0,dt.jsx)(o(98126).k,{}):(0,dt.jsx)(Gt,{percentage:(null==n?void 0:n.completedTaskPercent)??0})})};function Qt(t){const{taskCollectionContextStore:e,children:o}=t,n=(0,r().K8)((()=>(0,Wt().y_)(e)),[e]),i=(0,r().K8)((()=>e.collectionStore()),[e]),a=(0,u().tz)(),l=(0,r().K8)((()=>Nt(a,i)),[i,a]);return!l||n?null:(0,dt.jsx)(Jt().A,{id:"completed_tasks_in_current_sprint_view",collectionContextStore:e,reducer:l,render:t=>{const e=Ot(t.state);return e?(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsx)(Yt,{currentSprintTasksInView:e}),o(e)]}):null}})}function Yt(t){const{currentSprintTasksInView:e}=t,o=(0,s().IS)((()=>({summary:{display:"flex",alignItems:"center",justifyContent:"center",columnGap:5,color:$().Tj.text.tertiary,fontSize:p().J.UIRegular.desktop,fontWeight:p().Wy.regular,whiteSpace:"nowrap"}})),[]),{isPhone:n}=(0,l().Y0)();return n?null:(0,dt.jsxs)("div",{style:o.summary,children:[(0,dt.jsx)($t,{styles:{paddingTop:1},isLoading:!1,taskSummary:e}),(0,dt.jsx)(u().sA,{id:"completeAutomationSprintAutomation.inlineSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} tasks",values:{completedTaskCount:e.completedTaskCount,totalTaskCount:e.totalTaskCount}})]})}function Zt(t){const{collectionContextStore:e,completeSprintAutomationContext:o}=t,i=(0,l().v3)(),[s,c]=n.useState(!1),[u,p]=n.useState(!1),g=n.useCallback((()=>{p(!1)}),[p]),v=o.permissionsContext.canEdit,x=(0,r().O$)(a().AppStoreCurrentUserSettingsStore),y=()=>{p(!0);"complete-sprint-button-tooltip"===(0,S().gt)(x,"sprints-onboarding")&&m().tutorialGoToNextStep(i,"sprints-onboarding"),f(i,{...(0,d().sl)(e),action:"open_modal"})};return v?(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsx)(Ut,{completeSprintAutomationContext:o,taskCollectionContextStore:e,isModalOpen:u,children:({completeSprintAutomationState:t,onAutomationComplete:n})=>(0,dt.jsx)(St,{completeSprintAutomationContext:o,isOpen:u,onDismiss:g,setIsLoading:c,taskCollectionContextStore:e,completeSprintAutomationState:t,onAutomationComplete:n})}),(0,dt.jsx)(Qt,{taskCollectionContextStore:e,children:()=>(0,dt.jsx)(Xt,{taskCollectionContextStore:e,onClick:y,isLoading:s})})]}):null}function Xt(t){const{taskCollectionContextStore:e,onClick:o,isLoading:a}=t,{isPhone:d}=(0,l().Y0)(),m=n.useRef(null),S=function(t){const{isPhone:e}=t;return(0,s().IS)((()=>({button:{height:26,marginInlineStart:8,fontWeight:p().Wy.medium,...e&&{flexGrow:1,borderRadius:8,height:44}}})),[e])}({isPhone:d}),g=(0,r().K8)((()=>e.collectionViewBlockStore()),[e]),f=(0,i().r)(),v=(0,r().K8)((()=>null==g?void 0:g.getSpaceId()),[g]);if(!g)return(0,dt.jsx)(dt.Fragment,{});const x=v===f;return(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsx)(c().A,{size:"lg",ref:m,onClick:o,style:S.button,disabled:a,disabledFeedback:a,children:(0,dt.jsx)(u().sA,{defaultMessage:"Complete sprint",id:"completeSprintAutomationButton.label"})}),x?(0,dt.jsx)(Ht().rY,{origin:m}):void 0]})}var te=()=>o(906745),ee=()=>o(443191);function oe(t){var e;const{collectionContextStore:o,sprintAutomationContext:n}=t,i=(0,s().IS)((()=>({summary:{display:"flex",alignItems:"center",justifyContent:"center",marginInlineStart:17,columnGap:5,color:$().Tj.text.tertiary,fontSize:p().J.UIRegular.desktop,fontWeight:p().Wy.regular,whiteSpace:"nowrap"},icon:{height:"auto",paddingTop:2}})),[]),{isPhone:a}=(0,l().Y0)(),c=(0,r().K8)((()=>{var t;const e=null===(t=n.automationContext)||void 0===t?void 0:t.automationStore.getRunAt();if(!e)return;const o=te().DateTime.fromMillis(e,{zone:"utc"}).toLocal().startOf("day"),r=te().DateTime.now().startOf("day"),i=o.diff(r,"days").days;return i<1?"soon":1===i?"today":2===i?"tomorrow":i-1}),[null===(e=n.automationContext)||void 0===e?void 0:e.automationStore]);return c?(0,dt.jsx)(Qt,{taskCollectionContextStore:o,children:()=>a?null:(0,dt.jsxs)("div",{style:i.summary,children:[(0,dt.jsx)(_().I,{icon:ee().J,size:"sm",style:i.icon}),(0,dt.jsx)(ne,{daysRemaining:c})]})}):null}function ne(t){const{daysRemaining:e}=t;return"soon"===e?(0,dt.jsx)(u().sA,{id:"completeAutomationSprintAutomation.inlineSummary.endingSoon",defaultMessage:"Ending soon"}):"today"===e?(0,dt.jsx)(u().sA,{id:"completeAutomationSprintAutomation.inlineSummary.endsToday",defaultMessage:"Ends today"}):"tomorrow"===e?(0,dt.jsx)(u().sA,{id:"completeAutomationSprintAutomation.inlineSummary.endsTomorrow",defaultMessage:"Ends tomorrow"}):(0,dt.jsx)(u().sA,{id:"completeAutomationSprintAutomation.inlineSummary.daysRemaining",defaultMessage:"Ends in {daysRemaining} days",values:{daysRemaining:e}})}const re=function(t){var e;const{collectionContextStore:o}=t,n=(0,r().K8)((()=>o.completeSprintButtonContextStore.state),[o]),i=(0,r().K8)((()=>{var t;return Boolean(null==n||null===(t=n.automationContext)||void 0===t?void 0:t.automationStore.isActive())}),[null==n||null===(e=n.automationContext)||void 0===e?void 0:e.automationStore]);return n?i?(0,dt.jsx)(oe,{collectionContextStore:o,sprintAutomationContext:n}):(0,dt.jsx)(Zt,{collectionContextStore:o,completeSprintAutomationContext:n}):null}},392459:(t,e,o)=>{o.d(e,{N9:()=>q,aV:()=>W,he:()=>Y});o(898992),o(354520),o(672577),o(803949),o(581454);var n=o(296540),r=()=>o(756117),i=()=>o(726637),a=()=>o(484714),l=()=>o(118884),s=()=>o(590526),c=()=>o(401497),u=()=>o(611648),p=()=>o(150669),d=()=>o(56702),m=()=>o(917150),S=()=>o(127833),g=()=>o(118307),f=()=>o(631524),v=()=>o(863330),x=()=>o(69708),y=()=>o(100622),C=()=>o(496603),h=()=>o(436696),b=()=>o(789051),k=()=>o(34026),j=()=>o(59400),A=()=>o(339798),_=()=>o(527438),I=()=>o(59822),T=()=>o(253579),w=()=>o(271205),M=()=>o(170479),B=()=>o(999140),F=()=>o(427537),R=()=>o(958832),V=()=>o(602141),P=()=>o(30537),D=()=>o(807449),O=()=>o(886358),z=()=>o(107023),N=()=>o(513402),K=()=>o(284371),L=()=>o(56394),U=o(474848);function E({collectionContextStore:t,collectionSettingsStore:e}){const o=(0,s().K8)((()=>e.state.open),[e]),r=(0,n.useCallback)((t=>{t&&(0,T().Rp)(t.target)||A().os({collectionSettingsStore:e})}),[e]),a=(0,n.useCallback)((()=>(0,U.jsx)(j().m$,{context:_().Bd.FilterBar,collectionContextStore:t,collectionSettingsStore:e,hideDesktopHeader:!0})),[t,e]);return(0,n.useEffect)((()=>()=>A().os({collectionSettingsStore:e})),[]),(0,U.jsx)(S().zD,{popupType:i().A.isMobile?P().n.SlideUp:P().n.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",open:o,origin:(0,U.jsx)(H,{collectionContextStore:t,collectionSettingsStore:e}),onDismiss:r,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:a})}function H({collectionContextStore:t,collectionSettingsStore:e}){const o=(0,a().v3)(),[r,i,l,u]=(0,s().K8)((()=>[t.currentSortsStore.state,(0,b().Ml)(t,"normalized"),t.normalizedSchemaStore.state,t.permissionScopesStore.state]),[t]),p=(0,s().K8)((()=>(0,F().b)(t)),[t]),d=u.canConfigureBlock||p,m=r[0],S=m?l[m.property]:void 0,g=(0,n.useCallback)((()=>{(0,h().X)({environment:o,collectionContextStore:t,action:"click_sort"}),A().R8({collectionSettingsStore:e,item:{type:"sort"}})}),[t,e,o]),f=(0,c().IS)((()=>({title:{marginTop:-1,maxWidth:220,...K().RC}})),[]);let v;return v=1===r.length?m&&"descending"===m.direction?O().arrowStraightDownFillSmallIcon:z().arrowStraightUpFillSmallIcon:N().arrowUpDownSmallIcon,(0,U.jsx)(L().A,{on:!0,hasDiff:Boolean(d&&i.sorts),icon:(0,U.jsx)(D().I,{icon:v,size:1===r.length?"xs":"sm",colorPalette:"blue",colorVariant:"accentPrimary",fitToViewBox:"horizontal"}),title:(0,U.jsx)("span",{style:f.title,children:1===r.length&&S?S.name:(0,U.jsx)(x().sA,{defaultMessage:"{sortCount} sorts",id:"database.filterBar.sorts.label",values:{sortCount:r.length}})}),onClick:g})}let W=function(t){return t[t.FilterBar=0]="FilterBar",t[t.SettingsFilters=1]="SettingsFilters",t}({});const J=o(757695).Store.createClass({open:!1,stack:[]},{name:"CreateFilterSettingsStore"});function q({collectionContextStore:t,showHoverActionsStore:e,createFilterSettingsStore:o,saveControlMoreActionsButtonPopupStore:r}){var i;const a=(0,s().uB)(r,g().A),S=(0,s().uB)(o,J),f=(0,s().K8)((()=>(0,b().y_)(t)),[t]),v=(0,s().K8)((()=>{const e=t.filterBarFlashTriggerStore.state;return(0,d().t)(e)}),[t.filterBarFlashTriggerStore]);(0,l().X)((()=>{t.filterBarFlashTriggerStore.setState(0)}));const x=(0,s().O$)(t.currentPropertyFiltersStore),C=(0,s().K8)((()=>t.currentSortsStore.state.length),[t.currentSortsStore]),h=(0,s().K8)((()=>t.filterBarSortSettingsStore.state.open),[t]),k="map"!==(0,s().K8)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()}),[t])&&(C>0||h),j=(0,s().O$)(t.isUnlistedViewStore),A=(0,s().K8)((()=>(0,F().H)(t)?t.currentCombinatorFilterStore.state:void 0),[t]),_=(0,s().uB)(void 0,p().A),T=null===(i=(0,B().Oz)(t))||void 0===i?void 0:i.background,w=(0,n.useCallback)((e=>{t.filtersBarOpenStore.setState(!0)}),[t]),R=(0,c().IS)((()=>({border:{width:"100%",borderTop:j?"none":`1px solid ${y().Tj.border.primary}`,marginTop:4,zIndex:86},container:{width:"100%",zIndex:86,borderRadius:"4px",...j&&{paddingInlineStart:16,paddingInlineEnd:16}}})),[j]);return(0,U.jsx)("div",{style:R.border,children:(0,U.jsx)("div",{style:R.container,className:v,onClick:w,tabIndex:0,role:"button",children:(0,U.jsxs)("div",{style:{display:"flex",paddingTop:4},children:[(0,U.jsxs)("div",{style:{position:"relative",flexGrow:0,overflow:"hidden"},children:[(0,U.jsxs)(m()._,{store:_,type:u().A.X,style:{display:"flex",alignItems:"center",paddingTop:8,paddingBottom:8},children:[k?(0,U.jsx)($,{collectionContextStore:t}):void 0,k?(0,U.jsx)(Y,{}):void 0,A?(0,U.jsx)(G,{collectionContextStore:t}):void 0,(0,U.jsx)(Z,{collectionContextStore:t,createFilterSettingsStore:S,propertyFilters:x}),(0,U.jsx)(et,{collectionContextStore:t,showHoverActionsStore:e,createFilterSettingsStore:S})]}),(0,U.jsx)(I().A,{store:_,backgroundColor:T})]}),(0,U.jsxs)("div",{style:{display:"flex",alignItems:"start",paddingTop:6,marginInlineStart:"auto",flexShrink:0},children:[f?(0,U.jsx)(X,{collectionContextStore:t,showHoverActionsStore:e,saveControlMoreActionsButtonPopupStore:a}):void 0,(0,U.jsx)(M().A,{collectionContextStore:t})]})]})})})}function G({collectionContextStore:t}){return(0,U.jsx)(R().l,{context:W.FilterBar,collectionSettingsStore:t.filterBarCombinatorFilterSettingsStore,collectionContextStore:t})}function $({collectionContextStore:t}){return(0,U.jsx)(E,{collectionContextStore:t,collectionSettingsStore:t.filterBarSortSettingsStore},"sort")}function Q({filter:t,collectionContextStore:e,onClick:o}){const n=(0,s().K8)((()=>e.getFilterBarItemSettingsStore(t)),[e,t]);return(0,U.jsx)(V().A,{id:t.id,context:W.FilterBar,collectionContextStore:e,collectionSettingsStore:n,onClick:o},t.id)}function Y(){return(0,U.jsx)("div",{style:{borderInlineEnd:`1px solid ${y().Tj.border.secondaryTranslucent}`,height:24,marginInlineEnd:12,marginInlineStart:8}})}function Z({propertyFilters:t,collectionContextStore:e,createFilterSettingsStore:o}){const r=(0,a().v3)(),i=(0,s().O$)(e.canConfigureBlockStore),[l]=(0,s().K8)((()=>[e.currentPropertyFiltersStore.state]),[e]),c=(0,n.useCallback)((t=>{A().os({collectionSettingsStore:o}),A().os({collectionSettingsStore:e.filterBarSortSettingsStore}),A().os({collectionSettingsStore:e.filterBarCombinatorFilterSettingsStore}),l.filter((e=>!t||e.id!==t)).forEach((t=>{const o=e.getFilterBarItemSettingsStore(t);A().os({collectionSettingsStore:o})}))}),[e,o,l]);if(i){const o=t.map((t=>t.id));return(0,U.jsx)(w().Ay,{direction:"horizontal",keys:o,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:o=>{const n=t.find((t=>t.id===o));if(n)return(0,U.jsx)(Q,{collectionContextStore:e,filter:n,onClick:c})},style:{display:"flex",flexShrink:0},onDrop:t=>function(t,e,o){if(!o.collectionViewBlockStore())return;const n=o.currentPropertyFiltersStore.state,r=C().oE(t.map((t=>n.find((e=>e.id===t)))));k().IU({environment:e,collectionContextStore:o,temporaryState:{...o.temporaryStateStore.state,propertyFilters:{value:r}}}),(0,h().X)({environment:e,collectionContextStore:o,action:"reorder_filters"})}(t,r,e)})}return(0,U.jsx)(U.Fragment,{children:t.map((t=>(0,U.jsx)(Q,{filter:t,collectionContextStore:e,onClick:c},t.id)))})}function X({collectionContextStore:t,showHoverActionsStore:e,saveControlMoreActionsButtonPopupStore:o}){return(0,U.jsx)(j()._Q,{context:"FilterBar",collectionContextStore:t,showHoverActionsStore:e,moreActionsButtonPopupStore:o})}function tt({collectionContextStore:t,createFilterSettingsStore:e}){return(0,U.jsx)(j().m$,{context:_().Bd.FilterBar,collectionContextStore:t,collectionSettingsStore:e,hideDesktopHeader:!0})}function et({collectionContextStore:t,showHoverActionsStore:e,createFilterSettingsStore:o}){const l=(0,a().v3)(),c=(0,n.useCallback)((t=>function(t,e){t&&"click"===t.type&&(0,T().Rp)(t.target)||A().os({collectionSettingsStore:e})}(t,o)),[o]),u=(0,n.useCallback)((()=>(0,U.jsx)(tt,{collectionContextStore:t,createFilterSettingsStore:o})),[t,o]),p=(0,n.useCallback)((()=>function(t,e,o){(0,h().X)({environment:t,collectionContextStore:e,action:"click_new_filter"}),A().R8({collectionSettingsStore:o,item:{type:"createFilter"}})}(l,t,o)),[l,t,o]),d=(0,s().K8)((()=>o.state.open),[o]),m=(0,s().K8)((()=>e.state||d),[e,d]);return(0,U.jsx)(S().zD,{open:d,placementToOrigin:"bottom",alignmentToOrigin:"start",popupType:i().A.isMobile?S().nl.BottomSheet:S().nl.Popup,bottomSheetInitialState:"half",origin:(0,U.jsx)(r().A,{tag:f().p,visible:m,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},iconLeading:{icon:v().plusSmallIcon,size:"xs"},size:"sm",colorVariant:"tertiary",hovered:d,onClick:p,style:{fontSize:14,borderRadius:12,paddingInlineStart:5,paddingInlineEnd:9,marginInlineEnd:12},children:(0,U.jsx)(x().sA,{defaultMessage:"Filter",id:"database.filterBar.addButton.title"})}),render:u,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,onDismiss:c})}},427537:(t,e,o)=>{function n(t){var e;const o=Boolean(null===(e=function(t){var e,o;if(!t.isInViewTabLayout())return;if("page"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()))return;return null===(o=t.collectionViewStore())||void 0===o?void 0:o.getCollectionStore()}(t))||void 0===e?void 0:e.canEditCollection());return t.permissionScopesStore.state.canConfigureBlock||t.isEphemeralView()||o}function r(t){var e;return!!t.isInViewTabLayout()&&(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.canEdit())}o.d(e,{H:()=>n,b:()=>r})},521855:(t,e,o)=>{o.d(e,{B:()=>f});var n=o(296540),r=()=>o(404694),i=()=>o(907258),a=()=>o(484714),l=()=>o(590526),s=()=>o(734762),c=()=>o(148297),u=()=>o(541235),p=()=>o(564884);const d=new Map;var m=()=>o(611947),S=()=>o(646355),g=o(474848);function f({tutorialId:t,tutorialStepId:e,onPrimaryButtonClick:o,displayStore:f,calloutId:v,enableTracking:x=!1,...y}){const C=(0,a().v3)(),h=function(t){const e=!d.get(t),o=(0,n.useRef)(e);return o.current&&d.set(t,!0),(0,n.useEffect)((()=>()=>{o.current&&d.set(t,!1)}),[t]),o.current}(`${t}.${e}`),b=(0,r().V)(),{currentStep:k,isLoading:j}=(0,l().K8)((()=>{var e;return{isLoading:!(null!==(e=i().default.state.currentUserSettingsStore)&&void 0!==e&&e.getSettings()),currentStep:(0,S().gt)(i().default.state.currentUserSettingsStore,t)}}),[t]);if((0,n.useEffect)((()=>{j||k!==e||!h?null==f||f.setState(!1):null==f||f.setState(!0)}),[j,k,e,h,f]),j||k!==e||!h)return null;const A=u().c$[t],_=A.steps.findIndex((t=>t.id===e)),I=A.steps.length,T=o=>{x&&function(t,e){(0,p().u)({environment:t,event:{eventName:"tutorial_tooltip_action",eventProperties:e}})}(C,{step:_+1,total_steps:I,tutorial_id:t,tutorial_step_id:e,action_type:o})},w=(0,g.jsx)(c().k,{onCloseClick:()=>{m().dismissTutorial(C,t),T("dismiss")},onPrimaryButtonClick:e=>{m().tutorialGoToNextStep(C,t),null==o||o(e),T("next")},onBackButtonClick:()=>{m().tutorialGoToPrevStep(C,t),T("back")},numSteps:I,currStepIndex:_,...y});return v?(0,g.jsx)(s().B,{calloutId:v,shouldShow:!0,inAppCalloutStore:b,children:w}):w}},602141:(t,e,o)=>{o.d(e,{A:()=>S});o(898992),o(354520),o(672577);var n=o(296540),r=()=>o(726637),i=()=>o(590526),a=()=>o(30537),l=()=>o(26697),s=()=>o(69708),c=()=>o(284371),u=()=>o(194390),p=()=>o(339798),d=o(474848);function m({id:t,context:e,collectionContextStore:c,collectionSettingsStore:m,onClick:S}){const f=(0,o(484714).v3)(),v=(0,o(401497).DP)(),{filter:x,isReadOnly:y}=(0,i().K8)((()=>{const e=function(t,e){const o=e.currentPropertyFiltersStore.state;return o.find((e=>e.id===t))}(t,c);return{filter:e,isReadOnly:Boolean(e&&(0,o(790515).vu)(e.id))}}),[c,t]),C=(0,i().K8)((()=>{const e=(0,o(789051).Ml)(c,"normalized");return e.filters.updated.includes(t)||e.filters.added.includes(t)}),[c,t]),h=(0,i().K8)((()=>c.collectionViewStore()),[c]),b=(0,i().O$)(c.normalizedSchemaStore),k=(0,i().K8)((()=>m.state.open),[m]),j=(null==x?void 0:x.id)===u().O||(null==x?void 0:x.id)===u().j,A=(0,n.useCallback)((t=>{t&&(0,o(253579).Rp)(t.target)||p().os({collectionSettingsStore:m})}),[m]),_=(0,n.useCallback)((()=>{var t;S&&S(null==x?void 0:x.id),x&&(m.state.open?p().os({collectionSettingsStore:m}):p().R8({collectionSettingsStore:m,item:{type:"filter"}}),(0,o(436696).X)({environment:f,collectionContextStore:c,action:"click_property_filter",original_view_type:void 0,property_type:null==c||null===(t=c.collectionStore())||void 0===t||null===(t=t.getSchema()[x.filter.property])||void 0===t?void 0:t.type}))}),[c,m,f,x,S]),I=(0,n.useCallback)(((t,e)=>{if(!h||!x)return null;const n=x.filter,i=!(0,o(214388).t_)(n),a=b[n.property],l=(null==a?void 0:a.icon)&&(0,o(278238).T8)(a.icon),s=(0,o(700251).xI)({size:"sm",type:l?"custom":"system",isMobile:r().A.isMobile});return(0,d.jsx)(o(56394).A,{icon:a&&(0,d.jsx)(o(852424).zB,{type:a.type,icon:a.icon,size:s,theme:v,style:{fill:"currentColor"}}),title:i?(0,d.jsx)(o(704452).Ay,{propertyFilter:n,schema:b,style:g(),parentStore:h}):(0,d.jsx)("span",{style:g(),children:null==a?void 0:a.name}),on:i,hasDiff:C,disabled:e,hideChevron:e,onClick:_,...t},x.id)}),[h,x,_,C,b,v]),T=(0,n.useCallback)((()=>j?(0,d.jsx)(l().m,{placement:"bottom",render:t=>I(t,!0),renderTooltip:()=>(0,d.jsx)(s().sA,{id:"database.filterBarPropertyFilter.cannotConfigureSubitemDisplayMode",defaultMessage:"To modify this filter, first change the subitem display mode."})}):(0,d.jsx)(l().m,{placement:"bottom",render:t=>I(t,!0),renderTooltip:()=>(0,d.jsx)(s().sA,{id:"database.filterBarPropertyFilter.cannotConfigure",defaultMessage:"This filter cannot be modified on this view."})})),[I,j]),w=(0,n.useCallback)((()=>h&&x?(0,d.jsx)(o(866913).q,{collectionContextStore:c,collectionSettingsStore:m,collectionViewStore:h,context:e,filter:x,schema:b}):null),[c,m,h,e,x,b]);return y?T():(0,d.jsx)(o(127833).zD,{popupType:r().A.isMobile?a().n.SlideUp:a().n.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",open:k,origin:y?T():I(void 0,!1),onDismiss:A,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:w,trapFocus:!0})}const S=n.memo(m,o(821062).A);function g(){return{maxWidth:180,...c().RC}}},704452:(t,e,o)=>{o.d(e,{Ay:()=>R,C3:()=>z,tl:()=>D});o(898992),o(354520),o(581454),o(296540);var n=()=>o(590526),r=()=>o(295633),i=()=>o(457205),a=()=>o(732810),l=()=>o(942194),s=()=>o(849255),c=()=>o(799288),u=()=>o(335452),p=()=>o(343462),d=()=>o(927826),m=()=>o(478367),S=()=>o(662149),g=()=>o(214388),f=()=>o(597777),v=()=>o(681873),x=()=>o(799829),y=()=>o(179034),C=()=>o(824862),h=()=>o(519831),b=()=>o(437607),k=()=>o(798880),j=()=>o(695608),A=()=>o(69708),_=()=>o(496603),I=()=>o(534177),T=()=>o(284371),w=()=>o(649746),M=()=>o(16006),B=()=>o(79877),F=o(474848);const R=function({schema:t,propertyFilter:e,parentStore:r,valueOnly:i,style:a}){const l=(0,n().K8)((()=>{const n=t[e.property];if(n&&(0,o(898244).nC)(n))return(0,o(113105).LQ)(n,r)}),[t,e,r]),{filter:s}=e,c=(0,g().s1)(s)?s.subfilter:s,d=(0,p().M)(c)&&!(0,g().fZ)(s),m={...a,maxWidth:void 0};return(0,F.jsx)("span",{style:(0,u().n)(c)?m:a,children:(0,F.jsx)(A().sA,{defaultMessage:"{propertyName}{colonSeparator} {filterOperator} {propertyValue}",id:"database.filterBarFilterValue.title",values:{propertyName:i?void 0:(0,F.jsx)(P,{propertyFilter:e,schema:t}),colonSeparator:i||d?void 0:":",filterOperator:(0,F.jsx)(D,{propertyFilter:e}),propertyValue:(0,F.jsx)(z,{propertyFilter:e,schema:t,parentStore:r,relatedCollectionAppConfigUri:l})}})})};function V(){return(0,F.jsx)(A().sA,{defaultMessage:"Not",id:"database.filterBarFilterValue.notOperator"})}function P({propertyFilter:t,schema:e}){const o=e[t.property];return o?(0,F.jsx)("span",{style:{fontWeight:T().Wy.medium},children:o.name}):null}function D({propertyFilter:t}){const{filter:e}=t,o=(0,g().s1)(e)?e.subfilter:e;if((0,S().Y)(o))return"string_contains"===o.operator||"string_is"===o.operator?null:"string_does_not_contain"===o.operator||"string_is_not"===o.operator?(0,F.jsx)(V,{}):(0,F.jsx)(F.Fragment,{children:(0,w().J)(o.operator)});if((0,p().M)(o))return(0,F.jsx)(F.Fragment,{children:(0,w().J)(o.operator)});if((0,g().Ui)(o)){if("checkbox_is_not"===o.operator)return(0,F.jsx)(V,{})}else{if((0,g().v0)(o))return"enum_is"===o.operator?null:"enum_is_not"===o.operator?(0,F.jsx)(V,{}):(0,F.jsx)(F.Fragment,{children:(0,w().J)(o.operator)});if((0,g().as)(o))return"enum_contains"===o.operator?null:"enum_does_not_contain"===o.operator?(0,F.jsx)(V,{}):"enum_contains_all"===o.operator?null:(0,F.jsx)(F.Fragment,{children:(0,w().J)(o.operator)});if((0,g().H$)(o))return"status_is"===o.operator?null:"status_is_not"===o.operator?(0,F.jsx)(V,{}):(0,F.jsx)(F.Fragment,{children:(0,w().J)(o.operator)});if((0,g().Pq)(o))return"relation_contains"===o.operator?null:"relation_does_not_contain"===o.operator?(0,F.jsx)(V,{}):(0,F.jsx)(F.Fragment,{children:(0,w().J)(o.operator)});if((0,m().I)(o))return"person_contains"===o.operator?null:"person_does_not_contain"===o.operator?(0,F.jsx)(V,{}):(0,F.jsx)(F.Fragment,{children:(0,w().J)(o.operator)});if((0,g().G)(o)){if("location_is"===o.operator)return null;if("location_is_not"===o.operator)return(0,F.jsx)(V,{})}else if((0,u().n)(o)){if("date_is"===o.operator)return null;if("date_is_after"===o.operator)return(0,F.jsx)(A().sA,{defaultMessage:"After",id:"database.filterValue.dateType.dateIsAfter.title"});if("date_is_before"===o.operator)return(0,F.jsx)(A().sA,{defaultMessage:"Before",id:"database.filterValue.dateType.dateIsBefore.title"});if("date_is_on_or_after"===o.operator)return(0,F.jsx)(A().sA,{defaultMessage:"On or after",id:"database.filterValue.dateType.dateIsOnOrAfter.title"});if("date_is_on_or_before"===o.operator)return(0,F.jsx)(A().sA,{defaultMessage:"On or before",id:"database.filterValue.dateType.dateIsOnOrBefore.title"});if(!(0,g().Cw)(o))return(0,F.jsx)(F.Fragment,{children:(0,w().J)(o.operator)});{const t=o.value;if(!t.value||"exact"!==t.type||!(0,f().jS)(t.value))return(0,F.jsx)(F.Fragment,{children:(0,w().kz)(t)});if(t.value.start_date&&t.value.end_date)return null;if(t.value.start_date)return(0,F.jsx)(A().sA,{defaultMessage:"Starting",id:"database.filterValue.dateType.starting.title"});if(t.value.end_date)return(0,F.jsx)(A().sA,{defaultMessage:"Ending",id:"database.filterValue.dateType.ending.title"})}}else{if((0,g().uU)(o))return"verification_is"===o.operator?null:"verification_is_not"===o.operator?(0,F.jsx)(V,{}):(0,F.jsx)(F.Fragment,{children:(0,w().J)(o.operator)});(0,I().HB)(o)}}return null}function O({index:t}){return(0,F.jsx)("span",{style:{whiteSpace:"pre"},children:(0,F.jsx)(A().sA,{defaultMessage:", ",id:"database.filterValue.commaSeparator"})},t)}function z({propertyFilter:t,schema:e,parentStore:o,relatedCollectionAppConfigUri:n}){const{filter:i}=t,l=(0,g().s1)(i)?i.subfilter:i;if(!(0,g().gc)(l))return null;if((0,S().Y)(l)||(0,p().M)(l)){const t=l.value.value;if(void 0!==t)return(0,F.jsx)("span",{children:t})}else if((0,g().Ui)(l)){const t=l.value.value;if(!0===t)return(0,F.jsx)("span",{children:(0,F.jsx)(A().sA,{defaultMessage:"Checked",id:"database.filterValue.checkboxType.checked.title"})});if(!1===t)return(0,F.jsx)("span",{children:(0,F.jsx)(A().sA,{defaultMessage:"Unchecked",id:"database.filterValue.checkboxType.unchecked.title"})})}else{if((0,g().v0)(l)||(0,g().as)(l)){const t=(0,g().v0)(l)?(0,g().Zl)(l):(0,g().SM)(l),e=_().oE(t.map((({value:t})=>t)));return 0===e.length?null:(0,F.jsx)("span",{children:(0,v().G)(e,(t=>(0,F.jsx)(O,{index:t})))})}if((0,g().H$)(l)){const t=(0,g().V6)(l),e=_().oE(t.map((({value:t})=>t)));return 0===e.length?null:(0,F.jsx)("span",{children:(0,v().G)(e,(t=>(0,F.jsx)(O,{index:t})))})}if((0,g().Pq)(l)){const t=(0,g().Rh)(l),e=_().oE(t.map(((t,e)=>{if(!t.value)return null;const i=t.type;if("exact"===i){const e=r().B.createChildStore(o,{table:y().ev,id:t.value});return(0,F.jsx)(M().A,{style:{display:"inline"},store:e},t.value)}if("relative"===i){var a;if("builtin"===t.value.type)return n?(0,F.jsx)("span",{children:(0,F.jsx)(A().sA,{...null===(a=x().n$[n])||void 0===a||null===(a=a[t.value.variable])||void 0===a?void 0:a.messageDescriptor})},e):null;if("current_page_in_related_collection"===t.value.type)return(0,F.jsx)("span",{children:(0,F.jsx)(A().sA,{defaultMessage:"This page",id:"database.filterAndSort.currentPagePropertyValue.title"})},e)}else(0,I().HB)(i)})));return(0,F.jsx)(F.Fragment,{children:(0,v().G)(e,(t=>(0,F.jsx)(O,{index:t})))})}if((0,m().I)(l))return(0,F.jsx)(N,{useFilter:l,parentStore:o});if((0,g().G)(l)){const t=(0,g().GK)(l),e=_().oE(t.map((t=>{if(t.value){const e=t.value,n=a().m.createChildStore(o,{table:h().Vl,id:e});return(0,F.jsx)(M().A,{style:{display:"inline"},store:n},e)}})));return(0,F.jsx)(F.Fragment,{children:(0,v().G)(e,(t=>(0,F.jsx)(O,{index:t})))})}if((0,u().n)(l)){const o=e[t.property],n=(o&&"date"===o.type?o.date_format:void 0)||f().vz;let r;if("exact"===l.value.type){const t=l.value;if(t.value)if((0,f().$P)(t.value))r=t.value;else if((0,f().jS)(t.value)){const e=(0,f().dq)(t.value);e&&(r=e.value)}}else if(!(0,g().Cw)(l))return(0,F.jsx)(F.Fragment,{children:(0,w().RR)(l.value)});if(r)return(0,F.jsx)(B().A,{style:{display:"inline"},value:r,dateFormat:n,shortenDateAndRange:!0})}else{if((0,g().uU)(l)){const t=(0,g().ms)(l).filter((({value:t})=>Boolean(t))).map(w().w0);return 0===t.length?null:(0,F.jsx)("span",{children:(0,v().G)(t,(t=>(0,F.jsx)(O,{index:t})))})}(0,I().HB)(l)}}return null}function N({parentStore:t,useFilter:e}){const o=(0,A().tz)(),r=(0,d().W)(e),a=(0,n().K8)((()=>_().oE(r.map(((e,n)=>{if("relative"===e.type)return(0,F.jsx)("span",{children:(0,F.jsx)(A().sA,{defaultMessage:"Me",id:"database.filterValue.personType.firstPersonPropertyValue.title"})},n);if(e.value){const a=e.value;if(a.table===k().oo){const e=s().L.createChildStore(t,{table:a.table,id:a.id});return(0,F.jsx)("span",{children:(0,j().c6)(o,e.getModel())},n)}if(a.table===C().GP){const e=i().v.createChildStore(t,{table:a.table,id:a.id});return(0,F.jsx)("span",{children:(0,c().Hg)(e.getModel())},n)}if(a.table===b().n){var r;const e=l().C.createChildStore(t,{table:a.table,id:(0,b().gK)({spaceId:a.spaceId,spacePermissionGroupId:a.id}),spaceId:a.spaceId});return(0,F.jsx)("span",{children:null===(r=e.getModel())||void 0===r?void 0:r.getName()},n)}}})))),[r,t,o]);return(0,F.jsx)(F.Fragment,{children:(0,v().G)(a,(t=>(0,F.jsx)(O,{index:t})))})}},765101:(t,e,o)=>{o.d(e,{Ni:()=>l,U7:()=>a,rY:()=>s});o(296540);var n=()=>o(69708),r=()=>o(521855),i=o(474848);function a({origin:t}){return(0,i.jsx)(r().B,{origin:t,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"current-sprint-view-tooltip",header:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.header",defaultMessage:"Manage the current sprint"}),content:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.content",defaultMessage:"Add tasks and update task status as your team makes progress during the sprint."})})}function l({origin:t}){return(0,i.jsx)(r().B,{origin:t,placementToOrigin:"bottom",tutorialId:"sprints-onboarding",tutorialStepId:"sprint-task-tooltip",header:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.header",defaultMessage:"Change tasks status"}),content:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.content",defaultMessage:"Drag this task to In progress."})})}function s({origin:t}){return(0,i.jsx)(r().B,{origin:t,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"complete-sprint-button-tooltip",header:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.header",defaultMessage:"Complete this sprint"}),content:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.content",defaultMessage:"Click the button when youre done with this sprint."})})}},778708:(t,e,o)=>{o.d(e,{Dl:()=>ot,U2:()=>Q,Zk:()=>nt,_R:()=>J,bE:()=>rt,c:()=>X,cJ:()=>et,eN:()=>tt,e_:()=>G,g4:()=>$,qy:()=>Z});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(803949),o(581454),o(737550);var n=()=>o(906745),r=()=>o(675133),i=()=>o(295633),a=()=>o(732810),l=()=>o(584262),s=()=>o(433337),c=()=>o(890409),u=()=>o(898244),p=()=>o(597777),d=()=>o(604995),m=()=>o(206267),S=()=>o(273900),g=()=>o(912720),f=()=>o(199378),v=()=>o(179034),x=()=>o(519831),y=()=>o(96689),C=()=>o(854150),h=()=>o(950914),b=()=>o(864779),k=()=>o(201980),j=()=>o(935664),A=()=>o(966759),_=()=>o(769864),I=()=>o(896628),T=()=>o(384944),w=()=>o(867201),M=()=>o(345913),B=()=>o(680977),F=()=>o(479788),R=()=>o(374562),V=()=>o(235059),P=()=>o(813297),D=()=>o(465364),O=()=>o(79650),z=()=>o(339798),N=()=>o(496592),K=()=>o(654062),L=()=>o(601734),U=()=>o(594794),E=()=>o(111379),H=()=>o(547149);const W="week";function J(t){const{environment:e,transaction:o,tasksBlockStore:n,sprintsBlockStore:r}=t,i=r.getCollectionPointerIfSingleSource(),l=n.getCollectionPointerIfSingleSource();if(!i||!l)return;const s=a().m.createChildStore(r,i),c=s.getRole()??"none";if(!(0,S().q_)(c,"editor"))return;s.getAutomationStores().some((t=>t.isCompleteSprintAutomation()))||q({environment:e,transaction:o,sprintCollectionStore:s,taskCollectionStore:a().m.createChildStore(n,l),sprintSettingsConfig:h().AL})}function q(t){const{environment:e,sprintSettingsConfig:o,transaction:n,sprintCollectionStore:r,taskCollectionStore:i}=t,a=r.getSpaceId(),l=(0,U().Z1)({environment:e,table:g().yB,spaceId:a}),s=(0,U().Z1)({environment:e,table:f().SC,spaceId:a});T().eC({environment:e,table:g().yB,inMemoryRecordCache:r.inMemoryRecordCache,value:{id:l,parent_id:r.id,parent_table:r.table,alive:!0,space_id:a,status:o.autoCompleteSprints?"active":"disabled",trigger:{id:m().JW(),type:"recurrence",recurrence:at(o)},action_ids:[s]},transaction:n}),I().zA({stores:[r],update:{automation_ids:[...r.getFormat().automation_ids??[],l]},transaction:n}),T().vt({environment:e,table:f().SC,inMemoryRecordCache:r.inMemoryRecordCache,transaction:n,args:{id:s,version:1,parent_id:l,parent_table:g().yB,type:"complete_sprint",alive:!0,space_id:a,config:{sprint_collection:r.getSpaceShardedPointer(),task_collection:i.getSpaceShardedPointer(),complete_sprint_action:o.actionConfig.complete_sprint_action}}})}function G(t){const{environment:e,automationStore:o,transaction:n,newDuration:r,currentSprintBlockStore:i}=t;T().zv({store:o.getTriggerStore().getKeyStore("recurrence"),data:{interval:r},transaction:n}),Y({environment:e,transaction:n,automationStore:o,currentSprintBlockStore:i})}function $(t){const{environment:e,automationStore:o,transaction:n,newWeekday:r,currentSprintBlockStore:i}=t;T().zv({store:o.getTriggerStore().getKeyStore("recurrence"),data:{weekdays:[r]},transaction:n}),Y({environment:e,transaction:n,automationStore:o,currentSprintBlockStore:i})}function Q(t){const{environment:e,actionStore:o,automationStore:n,transaction:r,newAutocompleteStatus:i,currentSprintBlockStore:a}=t;T().zv({store:n,data:{status:i?"active":"disabled"},transaction:r}),Y({environment:e,transaction:r,automationStore:n,currentSprintBlockStore:a});const l=n.getParentPointer();if(!l||l.table!==x().Vl)return;const s=(0,F().Q)(e),u={automation_id:n.id,automation_actions:[{automation_action_id:o.id,type:"complete_sprint"}],automation_triggers:[{type:"recurrence"}],collection_id:l.id};i?(0,c().Ah)(s,u):(0,c().vN)(s,u)}function Y(t){const{automationStore:e,currentSprintBlockStore:o,transaction:r,environment:i}=t;if(!e.isActive())return;const a=e.getRecurrence();if(!a)return;const l=(0,b().Vv)(a);if(!l)return;const c=o.getPropertyValue(s().Hx.Dates);if(!c)return;const u=(0,k().Cok)(c)[0];if(!u||"daterange"!==u.type)return;const d=u.start_date,{start_date:m,end_date:S}=(0,b().Me)({currentSprintStartDate:d,sprintSchedule:l});T().zv({store:e.getTriggerStore().getKeyStore("recurrence"),data:{start_date:(0,p().Rz)(n().DateTime.fromISO(m).plus({minutes:1}).toJSDate())},transaction:r}),D().D5({store:o,propertyId:s().Hx.Dates,transaction:r,environment:i,type:"dateValue",dateValue:{type:"daterange",start_date:d,end_date:S}})}function Z(t){const{transaction:e,newRemainingTasksBehavior:o,actionStore:n}=t;T().zv({store:n.getConfigStore(),data:{complete_sprint_action:o},transaction:e})}async function X(t){var e;const{appTemplatesSetupActions:o,appTemplatesSprintBoardActions:n,appConfigs:r}=await L().Aw.load(),{environment:a,collectionContextStore:c,from:u}=t,p=c.collectionStore(),d=null==p?void 0:p.getParentCollectionViewBlockStore(),m=null==d?void 0:d.getParentStore(),S=null==p||null===(e=p.getFormat())||void 0===e?void 0:e.app_config_uri,g=S&&(0,V().l)(r(),S),f=p?(0,E().k)(p.getSpaceId()):void 0;if(!p||!d||!m||!f||m.table!==y().NX&&m.table!==v().ev&&m.table!==C().yK||!g)return;const x=d.getFormat().app_id,h=x?await _().callApi({eventName:"getCollectionViewBlocksByAppId",environment:a,data:{spaceId:d.getSpaceId(),appId:x}}):void 0,b="success"===(null==h?void 0:h.type)&&h.data.result.length?h.data.result.map((t=>i().B.createChildStore(m,{table:v().ev,id:t.blockId,spaceId:d.getSpaceId()}))):[d];await it({environment:a,taskCollectionStore:p,executeFn:()=>{const t=H().createAndCommit({userAction:"sprintSettingsActions.handleTurnOnSprints",environment:a,canUndo:!0,perform:t=>{const e=(0,R().We)(),r=o.applyTypedFeatures({environment:a,spaceViewStore:f,appParentStore:m,appUri:g.uri,features:[{type:"simple",featureUri:e.uri}],transaction:t,createOrModify:"modify",appCollectionViewBlockStores:b}),i=n.createSprintPage({environment:a,spaceViewStore:f,appParentStore:m,transaction:t,blockStores:r,creationEntryPoint:{type:"sprint_settings"}});z().os({collectionSettingsStore:c.settingsStore});const l=u?{feature:{id:s().yx.TaskToSprintRelation,from:u,type:"notion://projects/tasks_with_sprints_feature"}}:{};return(0,j().Z)({environment:a,collectionContextStore:c,from:"view_settings",property:s().yx.TaskToSprintRelation,property_type:"relation",is_suggested_property:!0,property_id:s().yx.TaskToSprintRelation,...l}),i}});t.serverCommitResult.then((()=>{const e=t.performResult;e&&w().Y({environment:a,store:e,pageVisitSource:l().y8.Create})}))}})}async function tt(t){const{environment:e,collectionContextStore:o,sprintSettingsContext:n,sprintBoardViewBlockIds:r}=t,{sprintCollectionStore:a,automationContext:c,currentCollectionViewBlockStore:u,sprintCollectionViewBlockStore:p,taskCollectionStore:d,taskCollectionViewBlockStore:m}=n;if(!a||!p||!c)return;const S=m.getSpaceId(),g=[...p.getCollectionPointerIfSingleSource()?[p]:[],...r.map((t=>new(i().B)(e,{id:t,table:v().ev,spaceId:S})))];u.id===m.id?z().os({collectionSettingsStore:o.settingsStore}):w().Y({environment:e,store:m,pageVisitSource:l().y8.LeaveOrRemove});const{automationActions:f}=await P().QV.automations.load(),{automationStore:x}=c;await it({environment:e,taskCollectionStore:d,executeFn:()=>{H().createAndCommit({userAction:"sprintSettingsActions.handleTurnOffSprints",environment:e,canUndo:!0,perform:t=>{m.id===p.id&&(0,N().removeCollectionFromCollectionViewBlock)({collectionViewBlockStore:m,collectionStore:a,transaction:t}),function(t){const{transaction:e,blocksToDelete:o,environment:n,taskCollectionStore:r,sprintCollectionStore:i}=t;T().zv({store:i,transaction:e,data:{alive:!1}}),(0,O().B)({environment:n,collectionStore:r,schema:r.getSchema(),property:s().yx.TaskToSprintRelation,transaction:e,permanentlyDelete:!0}),M().oD({environment:n,blocks:o,transaction:e,permanentlyDelete:!0})}({environment:e,transaction:t,blocksToDelete:g,sprintCollectionStore:a,taskCollectionStore:d}),f.disableAutomation({automationStore:x,environment:e,transaction:t}),f.deleteAutomation({automationStore:x,environment:e,transaction:t})}}),(0,A().i)({environment:e,collectionContextStore:o,property_type:"relation",from:"view_settings",property:s().yx.TaskToSprintRelation})}})}function et(t){const{environment:e,userSettingsStore:o}=t;H().createAndCommit({userAction:"sprintSettingsActions.handleSeenSprintsEngagementBanner",environment:e,canUndo:!0,perform:t=>{(0,B().m)({userSettingsStore:o,data:{seen_sprint_settings_engagement_banner:!0},transaction:t})}})}function ot(t){t.settingsStore.setState({open:!0,stack:[{type:"main"},{type:"sprintSettings"}]})}function nt(t){const{environment:e,collectionContextStore:o,currentViewBlockStore:n,taskCollectionViewBlockStore:i}=t,a=o.collectionViewStore();if(!a)return;const l=a.getFormat(),c=a.getRawQuery();H().createAndCommit({userAction:"sprintSettingsActions.handleManageSprintFromThisView",environment:e,canUndo:!0,perform:t=>{if((0,K().F)({collectionViewStore:a,transaction:t,update:{name:r().A.formatMessage(R().DZ.tasksCurrentSprintV2ViewName),query2:{...c,filter:void 0},format:{...l,collection_view_icon:"/icons/playback-play-button_gray.svg",property_filters:R().Wo,app_config_uri:s().Lu,hide_linked_collection_name:!0}}}),n.id===i.id){var e;const o=(null===(e=n.getFormat())||void 0===e?void 0:e.app_uri_map)??{},r=l.app_config_uri;r&&delete o[r],I().zA({stores:[i],update:{app_uri_map:{...o,[s().Lu]:a.id}},transaction:t})}}})}function rt(t){const{environment:e,sprintSettingsContext:o}=t;if(!o)return;const n=o.sprintCollectionStore,r=(null==n?void 0:n.getRole())??"none";n&&(0,S().q_)(r,"editor")&&o.automationContextLoaded&&!o.automationContext&&H().createAndCommit({userAction:"sprintSettingsActions.ensureCompleteSprintAutomation",environment:e,canUndo:!0,perform:t=>{q({environment:e,transaction:t,sprintCollectionStore:n,taskCollectionStore:o.taskCollectionStore,sprintSettingsConfig:h().AL})}})}async function it(t){const{executeFn:e,environment:o,taskCollectionStore:n}=t;await async function(t){var e;const{environment:o,taskCollectionStore:n}=t,r=n.getFormat().app_uri_map,i=s().yx.TaskToSprintRelation,a=n.getSchema(),l=(null==r?void 0:r[i])??i,c=a[l];if(!c||!(0,u().nC)(c))return;const p=null===(e=(0,u().Nv)(c))||void 0===e?void 0:e.id;if(!p)return;const d=new Set([l]);Object.entries(a).forEach((([t,e])=>{var o;e&&(0,u().nC)(e)&&(null===(o=(0,u().Nv)(e))||void 0===o?void 0:o.id)===p&&d.add(t)}));const{serverCommitResult:m}=H().createAndCommit({userAction:"sprintSettingsActions.clearSprintRelationDataFromTaskCollection",environment:o,canUndo:!0,perform:t=>{for(const e of d)(0,O().B)({environment:o,transaction:t,permanentlyDelete:!0,collectionStore:n,schema:a,property:e});null==r||delete r[i],r&&I().zA({stores:[n],transaction:t,update:{app_uri_map:r}})}});await m}({environment:o,taskCollectionStore:n}),e()}function at(t){return{frequency:W,interval:t.recurrenceConfig.interval,weekdays:t.recurrenceConfig.weekdays,start_date:(0,p().Rz)(n().DateTime.local().set({hour:0,minute:0,second:0,millisecond:0}).toJSDate()),timezone:(0,d().dB)(),hour:0,minute:0}}},866913:(t,e,o)=>{o.d(e,{q:()=>p});o(898992),o(354520),o(581454);var n=o(296540),r=()=>o(590526),i=()=>o(711339),a=()=>o(436696),l=()=>o(34026),s=()=>o(249947),c=()=>o(339798),u=o(474848);const p=n.memo((function(t){const{collectionContextStore:e,collectionSettingsStore:p,collectionViewStore:d,context:m,filter:S,schema:g}=t,f=(0,o(484714).v3)(),v=(0,r().K8)((()=>(0,o(427537).H)(e)),[e]),x=(0,r().K8)((()=>{var t;return S?null==e||null===(t=e.collectionStore())||void 0===t||null===(t=t.getSchema()[S.filter.property])||void 0===t?void 0:t.type:void 0}),[e,S]),y=(0,n.useCallback)((t=>{o(726637).A.isMobile&&"selectOption"!==t&&l().H2({environment:f,collectionContextStore:e}),c().os({collectionSettingsStore:p})}),[e,p,f]),C=(0,n.useCallback)((t=>{var n;if(!S)return;const r=null===(n=e.remoteResultStore.state)||void 0===n?void 0:n.sizeHint,s=i().default.DO_NOT_USE_markLegacy("collections.update_filter_lag");i().default.DO_NOT_USE_measureAfterNextFlushLegacy(s,{environment:f,getData:()=>o(390650).K6({from:"property_filter",property_type:x,collectionContextStore:e,sizeHintAtStart:r})});const c=S.filter,u=e.currentPropertyFiltersStore.state.map((e=>{if(e.id===S.id){return{...S,filter:{...c,filter:t}}}return e}));l().IU({environment:f,collectionContextStore:e,temporaryState:{...e.temporaryStateStore.state,propertyFilters:{value:u}}}),(0,a().X)({environment:f,collectionContextStore:e,action:"update_property_filter",original_view_type:void 0,property_type:x})}),[e,f,S,x]),h=(0,o(395361).Y)(C,250),b=(0,n.useCallback)((()=>{var t;if(!S)return;const o=e.currentPropertyFiltersStore.state.filter((t=>t.id!==S.id));l().IU({environment:f,collectionContextStore:e,temporaryState:{...e.temporaryStateStore.state,propertyFilters:{value:o}}}),(0,a().X)({environment:f,collectionContextStore:e,action:"delete_property_filter",original_view_type:void 0,property_type:null==e||null===(t=e.collectionStore())||void 0===t||null===(t=t.getSchema()[S.filter.property])||void 0===t?void 0:t.type})}),[e,f,S]),k=(0,n.useCallback)((()=>{var t;if(!S)return;const{combinatorFilter:n,propertyFilters:r}=(0,o(790515).$4)(e,S);l().IU({environment:f,collectionContextStore:e,temporaryState:{...e.temporaryStateStore.state,propertyFilters:{value:r},combinatorFilter:{value:n}}});const i=m===o(392459).aV.FilterBar?e.filterBarCombinatorFilterSettingsStore:e.filterOptionsCombinatorFilterSettingsStore;c().R8({collectionSettingsStore:i,item:{type:"filter"}}),(0,a().X)({environment:f,collectionContextStore:e,action:"merge_filter_into_combinator",property_type:null==e||null===(t=e.collectionStore())||void 0===t||null===(t=t.getSchema()[S.filter.property])||void 0===t?void 0:t.type})}),[e,m,f,S]);return(0,u.jsx)(s().td,{collectionViewId:d.id,propertyFilter:S.filter,schema:g,parentStore:d,onChange:C,onChangeDebounced:h,onClose:y,onDelete:b,onAddToCombinatorFilter:k,context:s().mL.PropertyFilter,userCanConfigureFilters:v,allowRelativeDateFilter:!0,allowRelativePersonFilter:!0,collectionContextStore:e})}))},914701:(t,e,o)=>{o.d(e,{E:()=>i});var n=()=>o(763884),r=()=>o(540022);function i(t){const e=(0,r().N)(t.collectionViewId);n().K.set({userId:t.userId,key:e,value:t.isOpen})}},958832:(t,e,o)=>{o.d(e,{l:()=>k});o(898992),o(803949);var n=o(296540),r=()=>o(726637),i=()=>o(484714),a=()=>o(590526),l=()=>o(401497),s=()=>o(127833),c=()=>o(30537),u=()=>o(807449),p=()=>o(112412),d=()=>o(69708),m=()=>o(284371),S=()=>o(436696),g=()=>o(789051),f=()=>o(34026),v=()=>o(59400),x=()=>o(339798),y=()=>o(527438),C=()=>o(253579),h=()=>o(56394),b=o(474848);function k({collectionContextStore:t,collectionSettingsStore:e}){const o=(0,i().v3)(),[l,u]=(0,a().K8)((()=>[e.state.open,t.currentCombinatorFilterStore.state]),[t,e]),p=(0,n.useCallback)((()=>(0,b.jsx)(v().m$,{context:y().Bd.FilterBar,collectionContextStore:t,collectionSettingsStore:e,hideDesktopHeader:!0})),[t,e]),d=(0,n.useCallback)((n=>{var r;n&&(0,C().Rp)(n.target)||(x().os({collectionSettingsStore:e}),u&&0===(null===(r=u.filters)||void 0===r?void 0:r.length)&&f().IU({environment:o,collectionContextStore:t,temporaryState:{...t.temporaryStateStore.state,combinatorFilter:{value:void 0}}}))}),[t,e,o,u]);return(0,n.useEffect)((()=>()=>x().os({collectionSettingsStore:e})),[]),(0,b.jsx)(s().zD,{popupType:r().A.isMobile?c().n.SlideUp:c().n.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",open:l,origin:(0,b.jsx)(j,{collectionContextStore:t,collectionSettingsStore:e}),onDismiss:d,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:p})}function j({collectionContextStore:t,collectionSettingsStore:e}){var o;const r=(0,i().v3)(),s=(0,l().IS)((()=>({title:{maxWidth:180,...m().RC}})),[]),[c,f]=(0,a().K8)((()=>[Boolean((0,g().Ml)(t,"normalized").combinatorFilter),t.currentCombinatorFilterStore.state]),[t]),v=(0,n.useCallback)((()=>{if(!f)return;t.currentPropertyFiltersStore.state.forEach((e=>{const o=t.getFilterOptionsItemSettingsStore(e);x().os({collectionSettingsStore:o})})),x().R8({collectionSettingsStore:e,item:{type:"filter"}}),(0,S().X)({environment:r,collectionContextStore:t,action:"click_combinator_filter"})}),[t,e,r,f]);return f?(0,b.jsx)(h().A,{icon:(0,b.jsx)(u().I,{icon:p().filterSmallIcon,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary",fitToViewBox:"horizontal"}),title:(0,b.jsx)("span",{style:s.title,children:(0,b.jsx)(d().sA,{defaultMessage:"{ruleCount, plural, one {{ruleCount} rule} other {{ruleCount} rules}}",id:"database.filterBar.advancedFilterRulesCount.title",values:{ruleCount:(null===(o=f.filters)||void 0===o?void 0:o.length)||0}})}),on:!0,hasDiff:c,onClick:v},"combinator"):null}}}]);