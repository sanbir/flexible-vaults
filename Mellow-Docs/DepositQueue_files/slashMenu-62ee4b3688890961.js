"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[92903],{26947:(e,t,n)=>{n.d(t,{t:()=>c});var s=()=>n(907258),o=()=>n(242422),i=()=>n(726637),r=()=>n(262661);function c(){if(i().A.isMobile)return!1;const{currentUserSettingsStore:e}=s().default.state;if(!e)return!1;const t=(0,r().i)(e);return!("number"==typeof t&&t>7)&&"on"===o().default.getEligibleGroup({experimentId:"slash_menu_tooltip",defaultGroup:"control"})}},471945:(e,t,n)=>{n.d(t,{v:()=>i});var s=()=>n(916694),o=()=>n(626652);function i(e,t,n){const i=(0,o().a)(e,t,n?"@":"");return(0,s().m)(e,i)}},931202:(e,t,n)=>{n.r(t),n.d(t,{SlashMenu:()=>he});var s=n(296540),o=()=>n(484714),i=()=>n(590526),r=()=>n(232615),c=()=>n(564884),a=()=>n(843427),l=()=>n(587031),u=()=>n(375099),d=()=>n(471945);function p(e){return(0,d().v)(e.textStore,e.oldTextValue,!e.isAddMenu)}n(18107),n(967357);var h=()=>n(201980);var f=()=>n(683021);function g({environment:e,slashMenuState:t,textSelectionState:n}){const{analyticsDependencies:o}=(0,u().h)(),{trackCreateBlock:i}=o;(0,s.useEffect)((()=>{if(!t.open||!n||"editing"!==n.mode)return;const s=p(t),o=f().rA.state;let r=0,u=t;s&&(o?r=s.length-t.lettersAtLastResult:(u={...t,lettersAtLastResult:(null==s?void 0:s.length)??0,filter:s},f().Ay.setState(u)));const{multiSelection:d}=n;!t.open||(0,a().K)(d)&&d.start.store===u.textStore&&!function(e,t,n,s){if(void 0===e)return!0;if(t&&n>3)return!0;if(1===e.length){const t=e.at(-1);if(t&&/\s/g.test(t)){const e=s.getValue();if(e&&e.length>=1){const t=(0,h().q4_)(e);return!(2===t.length&&t.startsWith("/"))}}}else if(e.length>=2)return e.endsWith("  ");return!1}(s,o,r,u.textStore)||((0,c().u)({environment:e,event:{eventName:"close_slash_menu",eventProperties:{id:t.id,source:s?"auto_close":"backspace"}}}),(0,l().V)({environment:e,dismissed:!0,trackCreateBlock:i}))}),[e,t,n,i])}var m=()=>n(907258),v=()=>n(26947);var y=()=>n(711339);var S=()=>n(675133),k=()=>n(69708);const A=(0,k().YK)({addButtonPlaceholder:{defaultMessage:"Type to filter…",id:"text.commandsMenuOpen.placeholder"},slashInsertionPlaceholder:{defaultMessage:"Filter…",id:"slashMenu.slashInsertion.placeholder"}});var x=()=>n(404694),_=()=>n(726637),M=()=>n(609679),B=()=>n(201941),E=()=>n(964899),C=()=>n(127833),T=()=>n(30537),b=()=>n(546926),I=()=>n(792485),K=()=>n(876338),j=()=>n(349944),R=()=>n(890492),D=()=>n(736847),w=()=>n(452004),O=(n(898992),n(354520),()=>n(598790)),N=()=>n(906536),F=()=>n(700500);const P=new class{constructor(){this.lruKeyStore=new(n(29923).R)({key:"frequentlyUsedSlashMenuActions",namespace:"SlashMenu",important:!1,trackingType:"necessary"})}load(){const e=this.lruKeyStore.state;let t={};try{t=e&&JSON.parse(e)||{}}catch(n){}return t}get(){return this.load()}track(e){const t=this.load(),n=t[e.key];void 0!==(null==n?void 0:n.frequency)&&void 0!==(null==n?void 0:n.lastAccessed)?(n.frequency+=1,n.lastAccessed=Date.now()):t[e.key]={frequency:1,lastAccessed:Date.now()},this.lruKeyStore.setState(JSON.stringify(t))}};var U=()=>n(182412),V=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(581454),()=>n(59226));const L=2;n(430670),n(908872);var Y=()=>n(906745);class ${constructor(){this.UNVISITED_FRECENCY_SCORE=1}getFrecencyRankedActions(e,t){const n=Date.now();return Object.keys(e).sort(((s,o)=>{const i=e=>Math.ceil(e.frequency*this.getWeightForVisit(n,e.lastAccessed,t)),r=e[s],c=e[o],a=void 0!==(null==r?void 0:r.frequency)&&void 0!==(null==r?void 0:r.lastAccessed)?i(r):this.UNVISITED_FRECENCY_SCORE,l=void 0!==(null==c?void 0:c.frequency)&&void 0!==(null==c?void 0:c.lastAccessed)?i(c):this.UNVISITED_FRECENCY_SCORE;return a===l?0:l-a}))}getWeightForVisit(e,t,n){const{TIME_BUCKETS:s,DEFAULT_BUCKET_WEIGHT:o}=n,i=Y().DateTime.fromMillis(e).diff(Y().DateTime.fromMillis(t),"hours").as("hours");for(const r of s){if(i<=r.hours)return r.weight}return o}}function q(e){const{sections:t,isEmptyBlock:n,suggestionCount:s,context:o,suggestedActionBoosts:i,validateAction:r}=e,c=t.flatMap((e=>e.actions)).reduce(((e,t)=>(e[t.key]=t,e)),{}),a=function(e){const{actions:t}=e,n={TIME_BUCKETS:[{hours:4,weight:100},{hours:12,weight:80},{hours:24,weight:70},{hours:72,weight:60},{hours:168,weight:50},{hours:336,weight:40},{hours:672,weight:30}],DEFAULT_BUCKET_WEIGHT:20},s=new $;return s.getFrecencyRankedActions(t,n)}({actions:P.get()}),l=function(e){const{suggestionCount:t,actionsByKey:n,frecencyRankedActions:s,isEmptyBlock:o,context:i,validateAction:r}=e;let c=0;const a=Object.entries(n).filter((([e,t])=>{if(!r(t,i))return!1;if(!s.includes(e))return!1;if(H.includes(e))return!1;if(e.match(W)){if(o)return!0;c++}if(e.match(G)){if(o)return!1;c--}return c++,!0}));if(!o&&c<t)return[];const l=a.sort((([e,t],[n,o])=>s.indexOf(e)-s.indexOf(n))).slice(0,t).map((([e,t])=>e));if(l.length<t)return[];return l}({suggestionCount:s,actionsByKey:c,frecencyRankedActions:a,isEmptyBlock:n,context:o,validateAction:r}),u=function(e){const{suggestedActions:t,suggestedActionBoosts:n,allAvailableActionsByKey:s}=e,o=n.filter((e=>e.isEnabled()&&s[e.actionKey])).slice(0,L);if(0===o.length)return t;const i=o.map((e=>({...s[e.actionKey],isBoosted:!0,boostPosition:e.position}))),r=new Set(o.map((e=>e.actionKey))),c=t.filter((e=>!r.has(String(e.key)))),a=Math.max(0,o.length-(t.length-c.length)),l=c.slice(0,c.length-a);return[...i.filter((e=>"first"===e.boostPosition)),...l,...i.filter((e=>"last"===e.boostPosition))]}({suggestedActions:l.map((e=>c[e])),suggestedActionBoosts:i,allAvailableActionsByKey:c});return u}const G="(turn into|action).*",W="(action color).*",H=["action more"];n(672577);var z=()=>n(795732),J=()=>n(961232);var Q=()=>n(601947),X=()=>n(699143),Z=()=>n(493552),ee=n(474848);function te(){const{subscriptionsDependencies:e}=(0,u().h)(),{renderUpgradeButton:t}=e,n=(0,I().S)(),s=(0,i().K8)((()=>(0,K().$)(n)),[n]);return(0,ee.jsxs)(X().Y1,{direction:"vertical",gap:8,padding:"10px 12px",align:"center-left",children:[(0,ee.jsx)("div",{style:{paddingTop:2,paddingInlineEnd:8,paddingBottom:2,paddingInlineStart:2},children:(0,ee.jsx)(Z().D,{styleKey:"captionMedium",colorVariant:"secondary",children:(0,ee.jsx)(k().sA,{id:"blockLimitUpsell.label",defaultMessage:"Unlimited blocks on Plus"})})}),t({upsell:{type:"product",product:"plus",limit:{type:"none"},trialability:"none"},spaceStore:s})]})}var ne=()=>n(401497),se=()=>n(388926),oe=()=>n(81068),ie=()=>n(100622);function re(e){const{filter:t,sectionsIsEmpty:n,focused:s,onClick:o,isAddMenu:r}=e,c=(0,k().tz)(),a=(0,ne().IS)((()=>({divider:{color:ie().Tj.border.secondaryTranslucent},shortcut:{color:ie().Tj.text.tertiary,fontSize:12,whiteSpace:"nowrap"},titleText:{color:ie().Tj.text.tertiary},titleFilterText:{color:ie().Tj.text.primary}})),[]),l=c.formatMessage({id:"slashMenuItems.typeOnPage.message",defaultMessage:"Type '/{filter}' on the page"},{filter:t}),u=(0,ee.jsx)("div",{children:l.split("'").map(((e,n)=>{if(e===`/${t}`){const t=r?e.slice(1):e;return(0,ee.jsxs)("span",{style:a.titleText,children:["‘",(0,ee.jsx)("span",{style:a.titleFilterText,children:t}),"’"]},n)}return(0,ee.jsx)("span",{style:a.titleText,children:e},n)}))}),d=(0,i().K8)((()=>(0,Q().j)()),[]);return(0,ee.jsxs)(ee.Fragment,{children:[n?void 0:(0,ee.jsx)(se().A,{size:2,style:a.divider}),(0,ee.jsx)(D().A,{children:(0,ee.jsx)(oe().A,{focused:s,onClick:o,title:u,right:(0,ee.jsx)("span",{style:a.shortcut,children:"esc"}),desktopTitleStyle:d})})]})}const ce=4,ae=(0,k().YK)({suggestedSectionTitle:{id:"slashMenu.suggestedSection.title",defaultMessage:"Suggested"}});function le(e){const{sections:t,slashMenuState:n,menuProps:r,isEmptyBlock:a}=e,d=(0,o().v3)(),{subscriptionsDependencies:h,selectionDependencies:g,analyticsDependencies:m,blockSelectionDependencies:v,textActionsDependencies:y,transactionDependencies:k,actionMenuListDependencies:A}=(0,u().h)(),x=(0,i().K8)((()=>p(n)),[n]),_=(0,i().K8)((()=>v.getSelectedStores()),[v]),M=(0,I().S)(),B=(0,i().K8)((()=>h.validateCanCreateBlock(d,(0,K().$)(M))),[d,M,h]),E=(0,i().K8)((()=>(0,j().K)(d)),[d]),C=(0,s.useMemo)((()=>({environment:d,blocks:_,originRect:n.selectionRect,publicEditMode:void 0,analyticsFrom:"slash_menu",pageContext:M})),[d,_,n.selectionRect,M]),T=(0,i().O$)(f().rA),b=void 0!==x,L=(0,i().uB)(void 0,w().$),Y=(0,i().K8)((()=>L.getState().focus.footerFocused),[L]),$=(0,s.useCallback)((()=>{(0,c().u)({environment:d,event:{eventName:"close_slash_menu",eventProperties:{id:n.id,source:"click_type_on_page"}}}),(0,l().V)({environment:d,dismissed:!0,trackCreateBlock:m.trackCreateBlock})}),[d,n.id,m]),G=b?(0,ee.jsx)(re,{focused:Y??!1,filter:x,sectionsIsEmpty:T,onClick:$,isAddMenu:n.isAddMenu}):void 0,W=b?{onFooterEnter:$}:{},H=Boolean(x)&&!T,X=(0,i().K8)((()=>({desktopTitleStyle:(0,Q().j)(),itemMarginLeft:0,itemMarginRight:4})),[]),Z=function(e){const{slashMenuState:t,filter:n}=e,{registryDependencies:s}=(0,u().h)(),{GlobalBlockRegistry:o}=s,r=(0,i().K8)((()=>{const e=t.textStore.getRecordStoreUIParent();if(!e)return!1;const n=o.find((t=>t.getBlockStore()===e)),s=null==n?void 0:n.getNode();if(!s)return!1;const i=J().A.find((e=>{var t;const n=null===(t=e.getContentWrapEl)||void 0===t?void 0:t.call(e);return(null==n?void 0:n.contains(s))??!1}));return(null==i?void 0:i.blockContext)===z().R.WorkflowInstructionsInInlineComposer}),[t,o]);return!n&&!r}({slashMenuState:n,filter:x}),ne=function({showSuggestedSection:e}){const t=(0,V().X)("slash_menu_suggested_meeting_notes");return e?[{actionKey:`insert ${F().xd.transcription}`,isEnabled:()=>t,position:"first"},{actionKey:`insert ${F().sh.aiFreePromptBlock}`,isEnabled:()=>!1,position:"first"}]:[]}({showSuggestedSection:Z}),se=(0,i().K8)((()=>{if(Z){const e=function(e){const{sections:t,isEmptyBlock:n,context:s,suggestedActionBoosts:o,validateAction:i}=e,r=q({suggestionCount:ce,sections:t,isEmptyBlock:n,context:s,suggestedActionBoosts:o,validateAction:i});return r.length?{key:U().IZ,title:S().A.formatMessage(ae.suggestedSectionTitle),actions:r,render:e=>(0,ee.jsx)(D().A,{...e})}:void 0}({sections:t,isEmptyBlock:a,context:C,suggestedActionBoosts:ne,validateAction:A.validateAction});return e?[e,...t]:t}return t}),[C,a,t,Z,ne,A.validateAction]);return(0,ee.jsxs)(R().A,{...r,footer:G,children:[E&&!B?(0,ee.jsx)(te,{}):null,(0,ee.jsx)(ue,{showHeader:H,children:(0,ee.jsx)(A.ActionMenuList,{sections:se,onAccept:(e,t,n,s,o)=>{if(!B)return h.showBlockingExperienceToast(d,(0,K().$)(M));k.createAndCommit({userAction:"SlashMenu.handleAccept",environment:d,canUndo:!0,perform:t=>{!function(e){const{transaction:t,environment:n,action:s,sectionKey:o,searchEventSource:i,itemIndex:r,editSelection:a,trackBlockAction:u,trackCreateBlock:d,getSelectedStores:p,IM_SORRY_DANGEROUSLY_setValue:h}=e,g=f().Ay.state;if(g.open){const{textStore:e,oldTextValue:f,oldSelection:m,filter:v,id:y}=g,S=p()[0];if(S){const e=S.getType(),t=S.getFormat();u(n,{analyticsName:s.analyticsName,action_type:s.analyticsActionType,from:"slash_menu",block_id:S.id,block_type:e,is_toggleable:e?(0,F().Yt)(e,t):void 0,slash_menu_filter_length:v.length,slash_menu_section:o,parent_collection_id:S.getParentCollectionIdUpToTwoLevels(),slash_menu_id:y,is_boosted:s.isBoosted,boost_position:s.boostPosition})}h({environment:n,store:e,value:f,transaction:t});const k=void 0!==r?r+1:void 0;(0,c().u)({environment:n,event:{eventName:"slash_menu_search",eventProperties:{id:g.id,source:i||(g.filter?{type:"query",query:g.filter}:{type:"scroll",rank:k})}}}),P.track(s),(0,l().V)({dismissed:!1,trackCreateBlock:d});const A=(0,O().T)(e);A&&a({environment:n,store:A}),(0,N().t)({store:e,selection:m})}}({environment:d,transaction:t,action:e,sectionKey:s,itemIndex:o,editSelection:g.edit,trackBlockAction:m.trackBlockAction,trackCreateBlock:m.trackCreateBlock,getSelectedStores:v.getSelectedStores,IM_SORRY_DANGEROUSLY_setValue:y.setValue})}})},context:C,filter:x,flattenSectionsOnSearch:!0,initialFocus:0,resetFocusOnMouseOut:!0,useLimit:!0,showNoResultsMessage:!1,menuListStore:L,renderItemStyles:X,...W})})]})}function ue({showHeader:e,children:t}){return e?(0,ee.jsx)(D().A,{title:(0,ee.jsx)(k().sA,{id:"slashMenuItems.filteredResults",defaultMessage:"Filtered results"}),children:t}):t}function de(e){const{sections:t,slashMenuState:n,isEmptyBlock:s}=e,i=(0,o().v3)(),r=(0,o().Y0)(),{analyticsDependencies:a}=(0,u().h)(),{trackCreateBlock:d}=a,p=(0,x().V)(),h=(0,B().u)(),f=n.isAddMenu?8:12,g=r.isMobileNative&&!r.isTablet&&!r.isIpad,m=`min(448px, ${_().A.isMobile?"25vh":"40vh"})`;return(0,ee.jsx)(C().zD,{popupType:r.isMobileNative&&!r.isTablet?T().n.SlideUp:T().n.Popup,open:!0,originRect:n.selectionRect,placementToOrigin:"bottom",alignmentToOrigin:"start",originGap:f,disableMouseCapture:!0,disableContentScroll:!0,preventBlockRenderQueueOnEnter:!0,onDismiss:()=>{(0,c().u)({environment:i,event:{eventName:"close_slash_menu",eventProperties:{id:n.id,source:"esc"}}}),(0,l().V)({environment:i,dismissed:!0,trackCreateBlock:d})},render:()=>(0,ee.jsx)(E().n,{step:"create_page_beyond_text",showSidebarOverlays:!1,onBackButtonClick:()=>(0,l().V)({environment:i,dismissed:!0,trackCreateBlock:d}),onNextButtonClick:()=>(0,l().V)({environment:i,dismissed:!0,trackCreateBlock:d}),inAppCalloutStore:p,teamIds:h,children:(0,ee.jsx)(pe,{sections:t,slashMenuState:n,isMobileNative:g,environment:i,menuMaxHeight:m,isEmptyBlock:s})}),trapFocus:!1})}function pe(e){const{analyticsDependencies:t}=(0,u().h)(),{trackCreateBlock:n}=t,{sections:s,slashMenuState:o,isMobileNative:i,environment:r,menuMaxHeight:a,isEmptyBlock:d}=e;let p;return p=i?{menuType:b().gu.ActionSheet}:{menuType:b().gu.Popup,width:"fr-FR"===M().locale?375:324,maxHeight:a,onClickOutside:()=>{(0,c().u)({environment:r,event:{eventName:"close_slash_menu",eventProperties:{id:o.id,source:"click_outside"}}}),(0,l().V)({environment:r,dismissed:!0,trackCreateBlock:n})}},(0,ee.jsx)(le,{sections:s,slashMenuState:o,menuProps:p,isEmptyBlock:d})}function he(){const e=(0,o().v3)(),t=(0,i().O$)(f().Ay),n=t.open&&t.isAddMenu,c=(0,i().K8)((()=>t.open?r().default.state:void 0),[t]),a=function(e){const{slashMenuState:t,environment:n}=e,{actionRegistryDependencies:o}=(0,u().h)(),{getInsertAndSlashActionsStore:r}=o,c=(0,s.useMemo)((()=>t.open?r(n):void 0),[n,t.open,r]);return(0,i().K8)((()=>t.open&&c?t.isAddMenu?c.state.insertActions:c.state.slashActions:[]),[t,c])}({slashMenuState:t,environment:e}),l=t.open&&!t.oldTextValue;return function(){const e=(0,i().K8)((()=>f().Ay.state.open),[]),t=(0,s.useRef)(!0),n=(0,o().v3)();(0,s.useEffect)((()=>{let e=f().Ay.state.open;function n(n){if(n.state.open&&!e){const e=t.current?"slash_menu_first_open_lag":"slash_menu_open_lag";y().default.mark(e)}e=n.state.open}return f().Ay.addListener(n),()=>{f().Ay.removeListener(n)}}),[]),(0,s.useEffect)((()=>{if(e){const e=t.current?"slash_menu_first_open_lag":"slash_menu_open_lag";y().default.measure(e,{environment:n}),t.current=!1}}),[n,e])}(),function({slashMenuState:e,isAddMenu:t,textSelectionState:n}){const o=(0,s.useCallback)((t=>{if(!e.open)return;if(!t)return void e.temporaryInputDataStore.setState(void 0);const n=t.input===t.prefix?"addMenu"===t.type?S().A.formatMessage(A.addButtonPlaceholder):S().A.formatMessage(A.slashInsertionPlaceholder):"";e.temporaryInputDataStore.setState({prefix:t.prefix,suffix:"",completion:n,prefixIcon:void 0})}),[e]);(0,s.useEffect)((()=>{if(!e.open||"editing"!==(null==n?void 0:n.mode))return;const s=p(e);o(void 0!==s?t?{type:"addMenu",input:s,prefix:""}:{type:"slash",input:`/${s}`,prefix:"/"}:void 0)}),[e,t,o,n])}({slashMenuState:t,isAddMenu:n,textSelectionState:c}),function({environment:e,slashMenuState:t,textSelectionState:n}){const{educationDependencies:o}=(0,u().h)();(0,s.useEffect)((()=>{var s;if(!t.open||!n||"editing"!==n.mode)return;const{currentUserSettingsStore:i}=m().default.state;!i||null!==(s=i.getSettings())&&void 0!==s&&s.pressed_slash_tooltip||!(0,v().t)()||o.completePressSlashTooltip(e)}),[e,t,n,o])}({environment:e,slashMenuState:t,textSelectionState:c}),g({environment:e,slashMenuState:t,textSelectionState:c}),t.open?(0,ee.jsx)(de,{sections:a,slashMenuState:t,isEmptyBlock:l}):null}}}]);