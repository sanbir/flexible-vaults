"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[4586],{323779:(e,t,n)=>{n.r(t),n.d(t,{default:()=>he});var o=n(296540),i=()=>n(717137),s=()=>n(782482),r=()=>n(726637),a=()=>n(908006),l=()=>n(484714),c=()=>n(792485),u=()=>n(590526),d=()=>n(465628),p=()=>n(245720),k=()=>n(127833),f=()=>n(30537),m=()=>n(546926),g=()=>n(890492),v=()=>n(663639),x=()=>n(777447),y=()=>n(69708),I=()=>n(264879),h=()=>n(501666),S=()=>n(156988),b=()=>n(564884),T=()=>n(929219),A=()=>n(295633),w=()=>n(77311),B=()=>n(807449),P=()=>n(81068),j=()=>n(791177),C=()=>n(736847),L=()=>n(12193),M=()=>n(332737),U=()=>n(179034),E=()=>n(201980),R=()=>n(496603),V=()=>n(534177),_=()=>n(939768),F=()=>n(559926),H=()=>n(18387),K=()=>n(781286),N=()=>n(958163),W=()=>n(401497),D=()=>n(718827),q=()=>n(100622),Q=()=>n(187820),z=()=>n(16006),O=n(474848);function $(e){const{store:t,onClick:n}=e,o=(0,l().WS)(),i=(0,u().K8)((()=>t.getIcon()),[t]),s=(0,u().K8)((()=>t instanceof A().B&&t.isEmptyPage()),[t]),a=(0,u().K8)((()=>(0,Q().Te)(t)),[t]),c=(0,W().IS)((()=>({container:{display:"flex",alignItems:"center",padding:"4px 6px",marginInlineStart:12,marginInlineEnd:12,borderRadius:6,boxShadow:q().Tj.inputBoxShadow,background:q().Tj.inputBackground,height:28,fontSize:14,lineHeight:"120%"},phoneContainer:{display:"flex",alignItems:"center",padding:"4px 16px",boxShadow:`${q().Tj.border.secondaryTranslucent} 0px 1px 0px`,background:q().Tj.background.elevated,height:46}})),[]);return(0,O.jsxs)(D().Ay,{style:o?c.phoneContainer:c.container,onClick:n,children:[(0,O.jsx)(Q().B6,{disabled:!0,icon:i,iconRecordCategory:a,isEmptyPage:s,size:r().A.isMobile?24:20,style:{marginInlineEnd:4}}),(0,O.jsx)(z().A,{store:t})]})}var G=()=>n(419357),J=()=>n(711319);function Y(e){const{state:t,focusInitial:n,defaultValue:o,onBlur:i,onKeyDown:s,style:r,inputComboboxProps:a}=e,c=(0,l().WS)(),u=(0,y().tz)(),d=u.formatMessage({defaultMessage:"Paste link or search pages",id:"selectionLinkButton.search.createNewLinkPlaceholder"}),p=u.formatMessage({defaultMessage:"Edit link or search pages",id:"selectionLinkButton.search.editLinkPlaceholder"}),k=!c||!t.showCreateIn,f=c?void 0:!t.showCreateIn&&t.focusLinkInput,m=(0,S().lR)(t)?p:d;return k?(0,O.jsx)(G().Ay,{onFocus:S().Nd,placeholder:m,value:o||t.url,onChange:Z,onBlur:i,onKeyDown:s,focus:f,focusInitial:n,focusAfterAnimation:!0,preventCaptureArrowShortcuts:!0,style:r,...a}):null}function Z(e){const t=(0,S().t4)();t&&function(e,t){switch(e.type){case"text":return void J().A.setState({...e,url:t.target.value,focusLinkInput:!0});case"image":return void N().A.setState({...e,url:t.target.value,focusLinkInput:!0});default:(0,V().HB)(e)}}(t,e)}function X(e){const{state:t,showPreview:n,store:o,inputComboboxProps:i}=e,s=(0,l().WS)(),r=(0,S().Hx)(t),a=(0,S().lR)(t);return n&&o?(0,O.jsx)($,{store:o,onClick:S().Nd}):(0,O.jsx)(Y,{state:t,onBlur:S().gZ,onKeyDown:ee,defaultValue:n?r:void 0,style:a?void 0:{marginTop:6},focusInitial:!a||s&&"text"===t.type&&!t.focusTitleInput,inputComboboxProps:i})}function ee(e){"Escape"===e.key&&(e.stopPropagation(),(0,S().OY)())}var te=()=>n(547149);function ne(e){const{title:t,focus:n,defaultTitle:i}=e,s=(0,l().v3)(),r=(0,l().WS)(),[a,c]=(0,o.useState)(),u=(0,o.useRef)(!1),d=(0,o.useMemo)((()=>({environment:s,defaultTitle:i,setPlaceholder:c,hasTitleChanged:u})),[i,s]);return(0,o.useEffect)((()=>{const e=u.current;return()=>{e&&F().st(s)}}),[u,s]),(0,O.jsx)(G().Ay,{focus:n,focusInitial:r,onFocus:ie,onBlur:()=>se(d),onChange:e=>function(e,t){oe(e.target.value,t)}(e,d),onKeyDown:e=>function(e,t){"Enter"!==e.key&&"Escape"!==e.key||(e.stopPropagation(),se(t))}(e,d),value:a?"":t,placeholder:a,preventCaptureArrowShortcuts:!0,style:{paddingBottom:8}})}function oe(e,t){const n=J().A.state;if(!n.open)return;const{editingToken:o,savedTextSelectionState:i}=n;if(!o)return;if(!e)return void J().A.setState({...n,title:""});const{environment:s,setPlaceholder:r,hasTitleChanged:a}=t;te().createAndCommit({userAction:"LinkMenu.updateTitle",environment:s,canUndo:!0,perform:t=>{const l=h().ar({environment:s,title:e,transaction:t,editingToken:o,savedTextSelectionState:i});l&&J().A.setState({...n,...l,title:e}),r(void 0),a.current=!0}})}function ie(){(0,S().zE)(!0)}function se(e){!function(e){const t=J().A.state;if(!t.open)return;const{defaultTitle:n,setPlaceholder:o}=e;t.title||(oe(n,e),o(n))}(e),(0,S().zE)(!1)}var re=()=>n(295304),ae=(n(898992),n(581454),n(737550),()=>n(17022)),le=()=>n(991003),ce=()=>n(79926),ue=()=>n(187174),de=()=>n(305390),pe=()=>n(825972),ke=()=>n(106628);var fe=()=>n(236262);function me(e){const{state:t,onUnlink:n}=e,[i,s]=(0,j().$)(),a=(0,o.useMemo)((()=>(0,S().V8)(t)),[t]),c=(0,o.useMemo)((()=>(0,S().KX)(a)),[a]),p=function(e){const{state:t,inputUrl:n,query:i,handleLinkSelection:s}=e,{url:r}=t,a=(0,l().v3)(),c=(0,l().WS)(),d=(0,u().O$)(T().e),p=Boolean(r),k=(0,o.useMemo)((()=>{let e,o=!1;if(!n&&p)e=(0,O.jsx)(y().sA,{defaultMessage:"Type a complete URL to link",id:"selectionLinkButton.invalidUrl"}),o=!0;else{if(!n)return;if("notion"===n.type&&d)return;"web"===n.type?e=(0,O.jsx)(y().sA,{id:"selectionLinkButton.linkToWebPage",defaultMessage:"Link to web page"}):"notion"===n.type?e=(0,O.jsx)(y().sA,{id:"selectionLinkButton.linkToPage",defaultMessage:"Link to page"}):"other"===n.type?e=(0,O.jsx)(y().sA,{id:"selectionLinkButton.linkToURL",defaultMessage:"Link to URL"}):(0,V().HB)(n.type)}return{key:"link to url",action:()=>s(a,t,i,c),render:t=>(0,O.jsx)(P().A,{...t,title:r,caption:e,icon:(0,O.jsx)(B().I,{icon:L().globeIcon}),disabled:o})}}),[t,i,a,c,d,n,s,p,r]);return k}({state:t,inputUrl:c,query:a,handleLinkSelection:ge}),k=function(e){const{state:t,inputUrl:n,query:i,additionalItem:s}=e,r="text"===t.type?t.editingToken:t.imageHyperlink,a=(0,S().lR)(t),c=function(e){const{state:t,inputUrl:n,query:i,handleLinkSelection:s,disableEmptyQueryResults:r}=e,a=(0,l().v3)(),c=(0,l().WS)(),[{online:p}]=(0,u().$y)(T().A),k=(0,o.useMemo)((()=>{var e;const n="text"===t.type?null===(e=(0,d().H)(t.savedTextSelectionState.multiSelection))||void 0===e?void 0:e.store:t.store;if(n&&n instanceof A().B)return n}),[t]),f=(0,ce().fJ)(ke().T.searchActions),[{value:m,status:g}]=(0,ue().Yb)((async()=>{if(!p||"resolved"!==f.status)return[];if(!i)return r?[]:pe().NK.state.map((e=>e.pageId));const e=f.value;return(await e.searchMentionablePages({nearBlock:k,environment:a,query:i,source:"mention_menu",limit:10})).map((e=>e.id))}),[i,k,a,p,r,f.status,f.value]),v=(0,le().A)("resolved"===g,300,300),I=(0,o.useMemo)((()=>{if(n&&"notion"===n.type){const e="page"===n.notionPage.name?n.notionPage.blockId:n.notionPage.peekViewBlockId,t=m?R().FF(m,e):[];return[n,...t]}return m}),[m,n]);return(0,o.useMemo)((()=>{if(!I||0===I.length)return;if(n&&"web"===n.type&&n.url===i)return;const e=ae().e.withListenerIgnored(H().Z);if(!e)return;const o=t.url?5:3,r=(0,O.jsx)(y().sA,{id:"selectionLinkButton.linkToPage.linkToBlock",defaultMessage:"Link to block"}),l=(0,O.jsx)(y().sA,{defaultMessage:"Link to page",id:"selectionLinkButton.linkToPageSection.title"});return{items:(0,R().oE)(I.map(((n,o)=>{const{pageId:i,peekViewBlockId:l,scrollToBlockId:u,discussionId:d,collectionViewId:p}="object"==typeof n?{pageId:"page"===n.notionPage.name?n.notionPage.blockId:n.notionPage.peekViewBlockId,..."page"===n.notionPage.name?{scrollToBlockId:n.notionPage.scrollToBlockId,peekViewBlockId:n.notionPage.peekViewBlockId,discussionId:n.notionPage.discussionId,collectionViewId:n.notionPage.collectionViewId}:{scrollToBlockId:void 0,peekViewBlockId:void 0,discussionId:void 0,collectionViewId:void 0}}:{pageId:n,peekViewBlockId:void 0,scrollToBlockId:void 0,discussionId:void 0,collectionViewId:void 0};if(!i)return;const k=A().B.createChildStore(e,{table:U().ev,id:i});return{key:o,action:()=>{if("object"==typeof n){const e=(0,x().wv)({pageId:i,peekViewBlockId:l,peekMode:n.notionPage.peekMode,discussionId:d,collectionViewId:p,scrollToBlockId:u});s(a,t,e,c,k)}else s(a,t,(0,x().wv)({pageId:i}),c,k)},render:e=>{const t="object"==typeof n&&u;return(0,O.jsx)(de().A,{...e,store:k,caption:t?r:void 0,placeholder:v?(0,O.jsx)(y().sA,{id:"selectionLinkButton.linkToPage.unknownBlock",defaultMessage:"Unknown block"}):(0,O.jsx)(y().sA,{id:"selectionLinkButton.linkToPage.loading",defaultMessage:"Loading..."})})}}}))).slice(0,o),title:I.some((e=>Boolean("object"==typeof e&&"page"===e.notionPage.name&&e.notionPage.scrollToBlockId)))?r:l}}),[I,t,a,c,i,n,s,v])}({state:t,inputUrl:n,query:i,handleLinkSelection:ge,disableEmptyQueryResults:a}),p=(0,o.useMemo)((()=>{if(c||s){return{key:"results",items:R().oE([...(null==c?void 0:c.items)||[],s]),render:e=>(0,O.jsx)(C().A,{...e,title:r||i?void 0:(0,O.jsx)(y().sA,{id:"selectionLinkButton.recents.title",defaultMessage:"Recents"})})}}}),[c,s,r,i]);return p}({state:t,inputUrl:c,query:a,additionalItem:p}),f=(0,S().Hx)(t),m=f&&(0,x().lX)({url:f,baseUrl:r().A.domainBaseUrl,publicDomainName:r().A.publicDomainName}),g=(0,u().K8)((()=>{if(!m)return;const e=(0,H().Z)();return e?A().B.createChildStore(e,{table:U().ev,id:m}):void 0}),[m]),v=function(e){const{state:t,url:n,isEmptyResults:i,pageStore:s,inputComboboxProps:r}=e,a=(0,o.useMemo)((()=>{let e=(0,O.jsx)(y().sA,{defaultMessage:"Page or URL",id:"selectionLinkButton.currentInfo.pageOrUrl"});const o=!t.focusLinkInput&&i;let a;return s?a={key:"link to page",action:()=>{},render:()=>(0,O.jsx)(X,{state:t,showPreview:o,store:s,inputComboboxProps:r})}:n?a={key:"link to web",action:()=>{},render:()=>(0,O.jsx)(X,{state:t,showPreview:!0,inputComboboxProps:r})}:(e=void 0,a={key:"create link",action:()=>{},render:()=>(0,O.jsx)(X,{state:t,showPreview:o,inputComboboxProps:r})}),{key:"page or url",render:t=>(0,O.jsx)(C().A,{title:e,...t}),items:[a]}}),[t,n,i,s,r]);return a}({state:t,url:f,isEmptyResults:!Boolean(k),pageStore:g,inputComboboxProps:i}),I=function(e){const{state:t,url:n,pageStore:i}=e,s=(0,u().K8)((()=>i?E().q4_(i.getTitleValue()):void 0),[i]),r=(0,o.useMemo)((()=>{if("text"!==t.type)return;const{editingToken:e,title:o,focusTitleInput:i}=t;return e?{key:"link title",render:e=>(0,O.jsx)(C().A,{title:(0,O.jsx)(y().sA,{defaultMessage:"Link title",id:"selectionLinkButton.currentInfo.linkTitle"}),...e}),items:[{key:"update title",action:()=>{},render:()=>(0,O.jsx)(ne,{title:o,defaultTitle:s??n,focus:i})}]}:void 0}),[t,n,s]);return r}({state:t,url:f,pageStore:g}),h=function(e){const{state:t,onUnlink:n}=e,i=function(e){const{state:t,onUnlink:n}=e,i=(0,l().v3)();return(0,o.useMemo)((()=>{if((0,S().lR)(t))return{key:"unlink",action:()=>{n(i);const e=(0,S().Hx)(t);switch(t.type){case"text":F().Mi(i,{type:"remove_link",url:e});break;case"image":const n=e?(0,_().bk)(e):void 0;(0,b().u)({environment:i,event:{eventName:"image_hyperlink_action",eventProperties:{action:"remove_link",url_type:null!=n&&n.hostname?"external":"notion"}}});break;default:(0,V().HB)(t)}},render:e=>(0,O.jsx)(P().A,{...e,title:(0,O.jsx)(y().sA,{id:"selectionLinkButton.removeLink",defaultMessage:"Remove link"}),icon:(0,O.jsx)(B().I,{icon:fe().trashIcon})})}}),[n,t,i])}({state:t,onUnlink:n}),s=(0,o.useMemo)((()=>{const e=R().oE([i]);if(0!==e.length)return{key:"link actions",render:e=>(0,O.jsx)(C().A,{topBorder:!0,...e}),items:e}}),[i]);return s}({state:t,onUnlink:n});let w,M;return k?(M=1,w=R().oE([v,k])):(M=void 0,w=R().oE([v,I,h])),{initialFocus:M,sections:w,comboboxProps:s}}function ge(e,t,n,o,i){const s=(0,M().l)(n);if(!s)return;const r=(0,S().Hx)(t);if(te().createAndCommit({userAction:"LinkMenu.handleLinkSelection",environment:e,canUndo:!0,perform:n=>{switch(t.type){case"text":const{editingToken:r,savedTextSelectionState:a,title:l}=t;(0,w().k)(a.multiSelection)&&(i?re().Gf({environment:e,editorMode:"default",store:a.multiSelection.start.store,selection:{startIndex:a.multiSelection.start.index,endIndex:a.multiSelection.end.index},annotation:E().ld4(i.id,i.getSpaceId()),transaction:n,analyticsFrom:"block"}):re().yr({environment:e,store:a.multiSelection.start.store,tokens:[[s,[["a",s]]]],index:a.multiSelection.start.index,transaction:n}));const c=h().BK({environment:e,transaction:n,url:s,title:l,editingToken:r,savedTextSelectionState:a});c?(F().Mi(e,{type:"edit_link",url:s}),J().A.setState({...t,...c,url:"",focusLinkInput:!1,focusTitleInput:Boolean(o)})):(F().Mi(e,{type:"create_link",url:s}),J().A.reset());break;case"image":K().Uc({url:s,transaction:n}),N().A.reset()}}}),"image"===t.type){var a;const t=null!==(a=(0,_().bk)(s))&&void 0!==a&&a.hostname?"external":"notion";(0,b().u)({environment:e,event:{eventName:"image_hyperlink_action",eventProperties:{action:r?"edit_link":"create_link",url_type:t}}})}}var ve=()=>n(691298),xe=()=>n(963248),ye=()=>n(957763);const Ie=330;function he(){const e=(0,u().K8)((()=>(0,S().t4)()),[]),t=(0,l().Y0)(),n=null==e?void 0:e.trapFocus,i=(0,u().K8)((()=>!e||function(e){switch(e.type){case"text":return h().GC();case"image":return!e.open;default:(0,V().HB)(e)}}(e)),[e]);(0,o.useEffect)((()=>{e&&i&&function(e){switch(e){case"text":return void h().d();case"image":return void K().J6();default:(0,V().HB)(e)}}(e.type)}),[i,e]);const s=function(e){if(e)switch(e.type){case"text":return{onClose:h().d,onUnlink:h().sp};case"image":return{onClose:K().J6,onUnlink:K().PA};default:(0,V().HB)(e)}}(e);return s&&e?(0,O.jsx)(k().zD,{popupType:r().A.isMobile?t.isTablet?f().n.Popup:f().n.SlideUp:f().n.Popup,style:{width:Ie},keepFocus:t.isPhone,open:e.open,originRect:e.open?e.selectionRect:void 0,placementToOrigin:"bottom",alignmentToOrigin:"center",originGap:8,disableContentScroll:!0,onDismiss:s.onClose,render:()=>e.open?(0,O.jsx)(Se,{state:e,onClose:s.onClose,onUnlink:s.onUnlink}):void 0,preventBlockRenderQueueOnEnter:!r().A.isMobile,trapFocus:n}):null}function Se(e){const{state:t,onClose:n,onUnlink:r}=e,c=(0,l().WS)(),[u,d]=(0,o.useState)(!0);(0,o.useEffect)((()=>d(!1)),[]);const v=(0,o.useRef)(null);(0,o.useEffect)((()=>(v.current=document.createElement("input"),v.current.style.position="fixed",v.current.style.top="-9999px",v.current.style.left="-9999px",document.body.appendChild(v.current),()=>{v.current&&document.body.removeChild(v.current)})),[]);const x=c&&t.focusLinkInput&&("text"!==t.type||!t.focusTitleInput);(0,o.useEffect)((()=>{x&&a().default.afterNextFlush((()=>{v.current&&v.current.focus()}))}),[x]);const I=(0,o.useCallback)((()=>{a().default.afterNextFlush((()=>{v.current&&document.activeElement===v.current&&v.current.blur()}))}),[]);if((0,ve().A)({shouldPreserveTextSelection:x,shouldPreserveBlockSelection:!0,shouldRestoreSelection:!0,onClearSelection:I}),t.showCreateIn&&!c)return(0,O.jsx)(Te,{state:t});let h;return h=c?{menuType:m().gu.Modal,title:(0,O.jsx)(y().sA,{defaultMessage:"Link",id:"selectionLinkButton.mobile.title"}),right:(0,O.jsx)(y().sA,{...p().W.cancel}),onClickRight:n,footer:(0,O.jsx)(k().zD,{popupType:f().n.SlideUp,open:t.showCreateIn||!1,render:()=>(0,O.jsx)(Te,{state:t})})}:{menuType:m().gu.Popup},(0,O.jsxs)(i().A,{debugName:"LinkMenu",capture:t.open&&(u||t.focusLinkInput||"text"===t.type&&t.focusTitleInput),allowEsc:!0,children:[(0,O.jsx)(g().A,{...h,children:(0,O.jsx)(be,{state:t,onUnlink:r})}),(0,O.jsx)(s().N,{debugName:"LinkMenu",capture:!0,onCommandSlash:S().Nd})]})}function be(e){const{state:t,onUnlink:n}=e,{initialFocus:o,sections:i,comboboxProps:s}=me({state:t,onUnlink:n});return(0,O.jsx)(v().A,{type:v().O.Vertical,initialFocus:o,sections:i,comboboxProps:s})}function Te(e){var t,n;const{state:i}=e,s=(0,l().v3)(),r=null===(t=(0,c().S)())||void 0===t?void 0:t.spaceStore,a=(0,o.useCallback)((async e=>{var t;if(!(0,ye().E)(s,r))return;const n="text"===i.type?null===(t=(0,d().H)(i.savedTextSelectionState.multiSelection))||void 0===t?void 0:t.store:void 0;if(!n)return;const{performResult:{createInState:o}}=await te().createAndCommitAsync({environment:s,userAction:"LinkMenu.LinkCreateInMenu",waitForServerCommit:!0,perform:async t=>{const o=I().oj({environment:s,transaction:t,titleText:i.url||"",createInValue:e,recordStoreParentStore:n}),[r]=o.createdPages;return r&&"text"===i.type&&(h().BK({environment:s,url:(0,x().wv)({pageId:r.id}),transaction:t,editingToken:i.editingToken,savedTextSelectionState:i.savedTextSelectionState}),J().A.reset()),await o.moveToStorePromise,{createInState:o}}});await I().nT({analyticsFrom:"link_menu",createInState:o,spaceStore:r})}),[i,s,r]),u="text"===i.type?null===(n=(0,d().H)(i.savedTextSelectionState.multiSelection))||void 0===n?void 0:n.store:void 0,p=u&&"block"===u.table?u.id:void 0;return(0,O.jsx)(xe().v8,{blocksToMove:[],isAddTo:!0,isCreateIn:!0,onAccept:a,parentBlockId:p,onAutocompleteQueryChange:Ae,autocompleteQuery:i.createInQuery||"",desktopWidth:Ie,onCancel:we})}function Ae(e){const t=J().A.state;t.open&&J().A.setState({...t,createInQuery:e})}function we(){const e=J().A.state;e.open&&J().A.setState({...e,showCreateIn:!1,createInQuery:""})}}}]);